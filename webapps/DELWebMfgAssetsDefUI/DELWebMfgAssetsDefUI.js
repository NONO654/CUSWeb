define("DS/DELWebMfgAssetsDefUI/init",["UWA/Core","UWA/Data","UWA/Utils/InterCom","UWA/Class/Promise","DS/UIKIT/Mask","DS/Logger/Logger","DS/Core/Events","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","DS/DELWebMfgAssetsDefInstanceModel/InstanceModel","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefUIControls/Preferences","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefModelServices/IndexedDBUtils","DS/DELWebMfgAssetsDefUIServices/CommandsManager","DS/DELWebMfgAssetsDefUITableView/TableView","DS/DELWebMfgAssetsDefUIGenericLinksView/GenericLinksView","DS/DELWebMfgAssetsDefUIAuxiliaryView/AuxiliaryView","DS/DELWebMfgAssetsDefReferenceModel/ReferenceDisplayModel","DS/DELWebMfgAssetsDefInstanceModel/InstanceDisplayModel","DS/DELWebMfgAssetsDefModelServices/DocumentUtility","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/DocumentObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/ExternalEventsUtils","DS/DELWebMfgAssetsDefModelServices/CustoParametersSet","DS/DELWebMfgAssetsDefUIServices/TableViewPreferences","DS/DELWebMfgAssetsDefUIServices/SecurityContext","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil","i18n!DS/DELWebMfgAssetsDefModelServices/assets/nls/MGA_NLS","text!DS/DELWebMfgAssetsDefModelServices/assets/rsc/MGA_RSC.json","text!DS/ENOCollabSharingCmds/assets/catnls/CollabSharing_Workbench.CATNls","text!DS/ENOCollabSharingCmds/assets/catrsc/CollabSharing_Workbench.CATRsc"],function(e,L,U,C,G,a,V,j,Q,X,A,B,x,O,s,d,I,E,u,W,o,F,T,z,y,N,D,n,v,m,l,q,H,R,p){var S={name:"init",_logger:null,_xmlModelRelations:"DELWebMfgAssetsDefModelServices/DELWebMfgAssetsDefModelRelations",manageCommandsAvailability:function Y(){I.manageCommandsAvailability()},updateAggregationRules:function g(){var aa,Z;Z=function(ab){I._validChildTypesMap=ab;I._processCustomInstanceConfig()};aa=widget.getValue("oneDelmiaAggregationMode");O.webServiceRequest({url:"modeler/ppr/getChildTypes",method:"GET",data:{oneDelmiaAggregationMode:aa},onComplete:Z})},onLoad:function M(){if(!widget.getValue("x3dSharedId")&&!widget.getValue("x3dAppId")){widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"DELWebMfgAssets_appId"})}if(e.is(a)){S._logger=a.getLogger(S)}if(!e.is(S._isLoaded)){G.mask(widget.body);require(["css!DS/UIKIT/UIKIT.css","css!DS/egraph/views.css","css!DS/egraph/views_default.css","css!DS/DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUI.css"],function Z(){O.setWidgetTrigram("MGA");d.init();z.addRscFile(H,"DELWebMfgAssetsDefUI");z.addNlsFile(q);if(O.isStandAlone()){require(["DS/DELWebMfgAssetsDefModelServicesTst/standAloneModelUtils"],function(ab){if(e.is(S._logger)){S._logger.log("Test module IS there")}ab.standAloneModelUtils(O);require(["css!DS/UWA2/assets/css/standalone.css","css!DS/DELWebMfgAssetsDefCommandsTst/DELWebMfgAssetsDefUITST.css"],function(){var ad=document.getElementsByClassName("module"),af=document.getElementsByClassName("moduleContent"),ac;if(e.is(ad)){for(ac=(ad.length-1);ac>=0;ac--){ad[ac].classList.add("module-MGATST");ad[ac].classList.remove("module")}}if(e.is(af)){for(ac=(af.length-1);ac>=0;ac--){af[ac].classList.add("moduleContent-MGATST");af[ac].classList.remove("moduleContent")}}O.getInitPromise({preferences:A,securityContext:m,xmlModelRelation:S._xmlModelRelations}).then(function ae(){S._initApp.call(S,ab)})},function(ad){var ac;if(e.is(S._logger)){S._logger.log("Test CSS is NOT there")}if(ad.requireModules!==null){ac=ad.requireModules&&ad.requireModules[0];require.undef(ac)}})},function(ac){var ab;if(e.is(S._logger)){S._logger.log("Test module is NOT there")}if(ac.requireModules!==null){ab=ac.requireModules&&ac.requireModules[0];require.undef(ab)}})}else{O.getInitPromise({preferences:A,securityContext:m,xmlModelRelation:S._xmlModelRelations}).then(function aa(ab){S._initApp.call(S,null);S._initAlerts=ab})}S._isLoaded=true})}else{S.buildView()}},_loadRootStoredPref:function c(){var ab,aa,Z;ab=e.Json.decode(widget.getValue(A.getRootsPrefName()));if(e.is(ab.Default)){aa=ab.Default;Object.keys(aa).forEach(function(ac){switch(ac){case"TABLE":Z=S._bottomBloc;break;default:Z=S._auxiliaryView}if(aa[ac].length>0){Z._loadStoredRoots(aa[ac])}})}},_initUIPreferences:function t(Z){x.TableView=Z.Config.Preferences.TableView;x.LeftBloc=Z.Config.Preferences.LeftBloc;x.RightBloc=Z.Config.Preferences.RightBloc;x.AuxiliaryView=Z.Config.Preferences.AuxiliaryView;x.TableView.Title=z.getNLSValue("TableView.Title");x.LeftBloc.Title=z.getNLSValue("LeftBloc.Title");x.RightBloc.Title=z.getNLSValue("RightBloc.Title");x.TableView.Name="TableView";x.LeftBloc.Name="LeftBloc";x.RightBloc.Name="RightBloc"},_initApp:function f(ac){var ab=[],ad=["DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIConfig","DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIEditLinkAttributes","DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute"];ad.forEach(function(af){ab.push(new C(function ae(ah,ag){O.getXMLValues(af,ah,ag)}))});C.all(ab).then(function Z(af){S._initUIPreferences(af[0]);O.retrieveAttributesInfo({uiConfig:"DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIConfig",insertCmd:"DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute",editLink:"DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIEditLinkAttributes"},function ae(){O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIRelationsColumnMapping",function ag(ai){O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIRelationsDisplayAttributeConfig",function ah(aj){y.init({CollectionUtils:X,ModelUtils:O,relAttrToRelations:ai,iUIConfigRelValues:aj});S.buildUI.call(S)})})})},function aa(){O._logger.error("ModelUtils.retrieveAttributesInfo call FAILED!!!")});j.setDisplayModelClass(o);Q.setDisplayModelClass(F);X.init({standAloneModelUtils:ac,});widget.CollectionUtils=X;N.init({ModelUtils:O});T.init({modelUtils:O,uiUtils:B,collectionUtils:X});D.init();X.references.addEvent("onValidationFailure",function(af,ae){var ah={},ag;ah[ae.param]=ae.paramValue;ag=z.getNLSValue(ae.key,ah,"ValidationError");B.AlertManager.add({className:"warning",message:ag})});z.addCATNlsFile(R);z.addCATRscFile(p,"ENOCollabSharingCmds");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewReferenceAttribute");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewLinkAttribute");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIIndexMapping");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefRelationsDialogDisplayAttributeConfig");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIEditLinkAttributes");O.populateDocumentPolicies()},_initSearch:function b(){},buildUI:function i(){S.buildDOM();S.buildView()},buildDOM:function k(){var aa,ac,Z,ab;B.buildUI();B.setWidget(S);aa=B.getMGAElement("TableViewContainer");ac=B.getMGAElement("LeftBlocContainer");Z=B.getMGAElement("RightBlocContainer");ab=B.getMGAElement("AuxiliaryViewContainer");S._bottomBloc=new E({className:"tableView",renderTo:aa,referenceCollection:X.references,instanceCollection:X.instances,documentConnectionCollection:X.documentsConnection});B.setAcceptedTypesInTableView(["SYSTEM","OPERATION"]);S._leftBloc=new u({className:"leftBloc",name:"LeftBloc",viewPreferences:x.LeftBloc,modelPreferences:s.LeftBloc,renderTo:ac,referenceCollection:X.references,instanceCollection:X.instances,connectionCollection:X.connections,documentConnectionCollection:X.documentsConnection});S._rightBloc=new u({className:"rightBloc",name:"RightBloc",viewPreferences:x.RightBloc,modelPreferences:s.RightBloc,renderTo:Z,referenceCollection:X.references,instanceCollection:X.instances,connectionCollection:X.connections,documentConnectionCollection:X.documentsConnection});S._auxiliaryView=new W({className:"auxiliaryView",renderTo:ab,referenceCollection:X.references,instanceCollection:X.instances,documentConnectionCollection:X.documentsConnection})},buildView:function w(){var aa=B.getMGAElement("UIContainer"),ac=z.getNLSValue("init.buildView.NoSecurityContext"),ab,ad=function ad(af){S._logger.log("Authoring Context UI init message: "+JSON.stringify(af));G.unmask(widget.body)},ae=z.getIconURLFromKey("MGA");widget.setIcon(ae);B.updateWidgetTitle();widget.body.setContent(aa);B.AlertManager.inject(aa,"top");if(""===O.getSecurityContext()){B.AlertManager.add({className:"error",message:ac});if(e.is(S._logger)){S._logger.error("!!! No security context found for this user, please set one in widget preferences.")}}B.getMGAElement("FrameWindow").onActionBarReady(function Z(){var af=v.getWidgetLayoutValues();if(e.is(af)){if(e.is(af.AV)&&af.AV){B.CommandsCheckHeaderManager.getCmd("showAuxiliaryView").setState(true)}if(e.is(af.LV)&&!af.LV){B.CommandsCheckHeaderManager.getCmd("LeftBlock").setState(false)}if(e.is(af.RV)&&!af.RV){B.CommandsCheckHeaderManager.getCmd("RightBlock").setState(false)}if(e.is(af.TV)&&!af.TV){B.CommandsCheckHeaderManager.getCmd("BottomBlock").setState(false)}if(e.is(af.GV)&&af.GV){B.CommandsCheckHeaderManager.getCmd("BottomBlock").setState(true);B.CommandsCheckHeaderManager.getCmd("ShowGraphView").setState(true)}}I.initialize();B.initAuthoringContextUI({context:S,onComplete:ad});if(e.is(S._initAlerts)&&e.is(S._initAlerts.warnings,"array")){S._initAlerts.warnings.forEach(function(ag){B.AlertManager.add({className:"warning",message:ag})})}});ab=(widget.getValue("MGAViewAuxiliary")==="true")?true:false;if(ab&&l.isViewPersistanceOn()){B.getMGAElement("MainBlocLayout").setColumnsWidth(0,[0],250)}else{B.getMGAElement("MainBlocLayout").setColumnsWidth(0,[0],0,{minSize:0})}S._loadRootStoredPref()},onSearch:function r(Z){var aa,ac,ab,ad;if(e.is(Z,"string")){aa=Z.split(":");if(e.is(aa,"array")){if(aa.length>=2){ac=aa[0].replace(/^\s+/g,"").replace(/\s+$/g,"");ab=aa[1].replace(/^\s+/g,"").replace(/\s+$/g,"")}}}if(e.is(ac)&&e.is(ab)&&ac!==""&&ab!==""){ad={type:ac,externalId:ab};X.references.fetch({data:ad,proxy:"passport",headers:O.getHeaders(),wait:true,remove:false,onComplete:function ae(af,ag){ag.forEach(function(ai){var ah=af.get(ai.PID);ah.setDisplayModel({asRootInAuxiliaryView:true});widget.dispatchEvent("onShowAuxView",[{PPRType:ah.get("PPRTYPE")}])})}})}},onViewChange:function h(){},onResize:function K(){},onRefresh:function J(Z){B.refreshWidget(Z)},endEditPreferences:function P(){var ad,ab;B.updateWidgetTitle();S.updateAggregationRules();if(m.isChanged()){m.updateSecurityContext();if(e.is(O.xmlCache["DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute"])){delete O.xmlCache["DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute"]}O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute");O.populateDocumentPolicies()}if(n.isChanged()){for(ab in O.xmlCache){if(O.xmlCache.hasOwnProperty(ab)){delete O.xmlCache[ab]}}O.getXMLValues("DELWebMfgAssetsDefModelServices/DELWebMfgAssetsDefModelConfig",function Z(af){s.LeftBloc=af.Config.Preferences.LeftBloc;s.RightBloc=af.Config.Preferences.RightBloc});O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewReferenceAttribute");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewLinkAttribute");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIInsertCmdFormAttribute");O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefRelationsDialogDisplayAttributeConfig");ad=[new C(O._retrieveIndexMapping),new C(O._retrieveModelCustomRelations),new C(function aa(ag){O.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIConfig",function af(ah){v._TVColumnsPrefValue=null;S._initUIPreferences(ah);ag()})})];C.all(ad).then(function ae(){widget.body.querySelectorAll("div.ui-container").forEach(function af(ag){ag.remove()});B.buildUI();S.buildUI()},function ac(){O._logger.error("init.endEditPreferences FAILED !!!")})}}};return S});