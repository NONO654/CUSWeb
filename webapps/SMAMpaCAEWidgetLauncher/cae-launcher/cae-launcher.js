(function(a){require(["UWA/Core","UWA/Element","DS/DataDragAndDrop/DataDragAndDrop","DS/UIKIT/Input/Select","DS/UIKIT/Mask","DS/TransientWidget/TransientWidget","DS/Controls/Button","DS/UIKIT/Input/Toggle","DS/Utilities/Dom","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","i18n!DS/SMAMpaCAEWidgetLauncher/assets/nls/SMAMpaCAEWidgetLauncher","i18n!DS/SMAMpaCAEWidgetLauncher/assets/nls/SMAMpaCAEWidgetLauncherErrors"],function(e,j,t,p,A,H,F,c,x,w,G,n,J){var y,h,g,i,E,I,f,D,u,M,k,d,B,r,L,s,l,z,m,K,v,q,C,o,b={PROCESSTYPEERROR:"SMAMpaCAEWidgetLauncher.caeLauncher.1",COLLABSPACESWSERROR:"SMAMpaCAEWidgetLauncher.caeLauncher.2",VALIDATEPROCESSWSERROR:"SMAMpaCAEWidgetLauncher.caeLauncher.3",JOBERROR:"SMAMpaCAEWidgetLauncher.caeLauncher.4",NOPROCESSSELECTED:"SMAMpaCAEWidgetLauncher.caeLauncher.5",INVALIDSTUDYNAME:"SMAMpaCAEWidgetLauncher.caeLauncher.6"};o="Simulation,Simulation Process";C=function(O,Q,P,N){this.fire(this.COMMON_EVENTS.ERROR,{errorCode:O,isFatal:Q,replaceKey:P,message:N})};f=function(){this.$.caeLauncherUtil.sendRequest({uri:"/resources/bps/cspaces?tenant="+a.widget.getValue("x3dPlatformId"),appendSecurityContext:false,responseType:"json",isE6WCall:false,headers:{},method:"GET",payload:{},onComplete:y.bind(this),onError:C.bind(this,b.COLLABSPACESWSERROR,false)});this.CreateNewStudyToggle=new c({name:"studyModeChooser",className:"primary",id:"CreateNewStudyToggle",value:"newStudy",label:"Create New Study",checked:true,events:{onChange:function(){l.call(this)}.bind(this)}});this.UseExistingStudyToggle=new c({name:"studyModeChooser",className:"primary",id:"UseExistingStudyToggle",value:"existingStudy",label:"Resume Existing Study",checked:false,events:{onChange:z.bind(this)}});this.CreateNewStudyToggle.inject(this.$.studyModeChooser);this.UseExistingStudyToggle.inject(this.$.studyModeChooser);this.data.processObject=this.$.session.getObjectFromCompass(o);t.droppable.call(this,this.$.studyNameField,{drop:function(O){var R=null;var Q;try{R=JSON.parse(O)}catch(P){R=null;Q=P;if(!R&&a.console&&a.console.error){a.console.error("drop: Failed to parse data",Q,O)}}if(R&&R.data&&R.data.items){var S=R.data.items[0];if(S&&o.indexOf(S.objectType)>-1){I.call(this,S)}else{C.call(this,b.PROCESSTYPEERROR,false,null)}}}.bind(this)});var N=[];this.$.collabSpaceDropDownElement=new p({id:"collabSpaceDropDownElement",options:N,placeholder:"Collaborative Space",events:{onChange:s.bind(this)}});this.$.collabSpaceDropDownElement.inject(this.$.collabSpaceDropDown);this.$.dataView=document.createElement("ad-mdata-view");this.$.dataView.id="dataView";this.$.dataView.$.stationManager.setHasRefreshed(true);this.$.dataView.session=this.$.session;this.$.dataView.simToSoOff=true;this.$.dataView.addEventListener("successMessage",d.bind(this));this.$.dataView.addEventListener("errorMessage",r.bind(this));this.$.dataViewContainer.appendChild(this.$.dataView);this.$.caeProcessCreator.session=this.$.session;I.call(this,this.data.processObject,true);a.widget.addEvents({onRefresh:function(){this.$.session.queryProcessIDChanged()}.bind(this)})};D=function(){this.fire("componentAttached",{});this._categoryMessages={}};I=function(O,N){A.unmask(a.widget.body);this.data.processObject=O;if(this.data.processObject){a.widget.setValue("X3DContentId",JSON.stringify({data:{items:[this.data.processObject]}}));A.mask(a.widget.body);this.NLS=n;this.$.caeProcessCreator.validateProcess({options:{processID:this.data.processObject.objectId,onlyValidate:true,ExtensionName:this.adapterId,onComplete:q.bind(this),onError:C.bind(this,b.VALIDATEPROCESSWSERROR,true,null)}})}else{this.CreateNewStudyToggle.check();this.createNewStudy.call(this,N)}};q=function(){A.unmask(a.widget.body);this.UseExistingStudyToggle.check();z.call(this);this.$.studyNameField.value=this.data.processObject.displayName;this.$.session.queryProcessID=this.data.processObject.objectId;this.$.dataView.$.stationManager.refresh({refreshServers:true})};k=function(N){N.stopPropagation();N.cancelBubble=true;this.$.spSimulationSearch.multiSelect=false;this.$.spSimulationSearch.search()};v=function(P){var N=P.detail.getSelectedObjects();if(N&&N[0]){var O=N[0];if(O.objectType===undefined){C.call(this,b.PROCESSTYPEERROR,false,null);return}var Q=o.split(",").indexOf(O.objectType);if(Q!==-1){I.call(this,O,undefined)}else{C.call(this,b.PROCESSTYPEERROR,false,null)}}};l=function(N){if(!N){a.widget.setValue("X3DContentId")}this.DOM(this.$.studyNameField).removeClass("existingStudyName");this.DOM(this.$.studyNameField).addClass("newStudyName");this.$.studyNameField.removeAttribute("readonly");this.$.studyNameField.value=null;this.DOM(this.$.searchProcessButton).removeClass("existingStudyButton");this.DOM(this.$.searchProcessButton).addClass("newStudyButton");this.$.dataView.sessionRequired=false;this.$.session.reset();this.data={}};z=function(){this.DOM(this.$.studyNameField).removeClass("newStudyName");this.DOM(this.$.studyNameField).addClass("existingStudyName");this.$.studyNameField.setAttribute("readonly","");this.$.studyNameField.value=null;this.DOM(this.$.searchProcessButton).removeClass("newStudyButton");this.DOM(this.$.searchProcessButton).addClass("existingStudyButton");this.$.dataView.sessionRequired=true};s=function(N){N.stopPropagation();N.cancelBubble=true;if(this.$.collabSpaceDropDownElement.getValue()!==null&&this.$.collabSpaceDropDownElement.getValue().length>0){this.$.session.setWidgetPreference("collabspaces",this.$.collabSpaceDropDownElement.getValue()[0])}if(this.UseExistingStudyToggle.isChecked()&&this.data.processObject!==undefined){q.call(this)}};y=function(N){var P,O=[],S=[],Q=JSON.parse(N.response);if(Array.isArray(Q.cspaces)){Q=Q.cspaces;for(P=0;P<Q.length;P+=1){O.push({value:Q[P].name,label:Q[P].displayName});S.push(Q[P].name)}}this.$.collabSpaceDropDownElement.remove();var R=this.$.collabSpaceDropDownElement.getOption(0);if(R){R.disabled=true}this.$.collabSpaceDropDownElement.add(O);if(this.$.session.getWidgetPreference("collabspaces")!==undefined){if(this.$.session.isCollaSpaceValid(S,this.$.session.getWidgetPreference("collabspaces"))){this.$.collabSpaceDropDownElement.setValue(this.$.session.getWidgetPreference("collabspaces"));this.$.session.setWidgetPreference("collabspaces",this.$.session.getWidgetPreference("collabspaces"))}else{this.$.collabSpaceDropDownElement.setValue(S[0]);this.$.session.setWidgetPreference("collabspaces",S[0])}}else{this.$.collabSpaceDropDownElement.setValue(S[0]);this.$.session.setWidgetPreference("collabspaces",S[0])}};d=function(N){N.stopPropagation();N.cancelBubble=true;g.call(this,N.detail.message)};r=function(O){var N=J.get("UnknownError");O.stopPropagation();O.cancelBubble=true;if(O.detail.message){N=O.detail.message}h.call(this,N);if(O.detail.isFatal==="true"){I.call(this)}};L=function(P){var O={},Q,N;if(P.detail.level!=="clear-urgent"&&P.detail.level!=="clear-status"){O.type=P.detail.level;O.text=P.detail.message;if(P.detail.level==="success"||P.detail.level==="info"){O.autoRemove=true}Q=P.detail.category;if(typeof Q!=="undefined"&&Q&&Q.length>0){N=this._categoryMessages[Q];if(N){N=this.$.notification.logMessage(O,N)}else{this.$.notification.logMessage(O)}this._categoryMessages[Q]=N}else{this.$.notification.logMessage(O)}}return};B=function(Q){Q.stopPropagation();Q.cancelBubble=true;var P={},O="";P[a.DS.SMAProcSP.SPSearch.ERRORCODES.TRANSIENT]="TransientError";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.PARSEERROR]="ParseError";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.PROCESSKINDERROR]="ProcessKindError";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.TEMPLATEERROR]="TemplateError";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.CREATEPROCESSWSFAILED]="CreateProcessWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.GETTEMPLATEWSFAILED]="GetTemplateWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.GETTEMPLATEOPTIONSWSFAILED]="GetTemplateOptionsWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.INSTANTIATETEMPLATEWSFAILED]="InstantiateTemplateWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.VALIDATECAEPROCESSWSFAILED]="ValidateCAEProcessWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.GETPROCESSINFOWSFAILED]="GetProcessInfoWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.CONNECTREFRELATIONSHIPWSFAILED]="ConnectRefRelationshipWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.GETACTIVITYINFOFAILED]="GetActivityInfoFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.GETSTEPINFOWSFAILED]="GetStepInfoWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.UPDATESTEPINFOWSFAILED]="UpdateStepInfoWSFailed";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.MULTIPLEACTIVITIESPROCESS]="MultipleActivitiesProcess";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.INCORRECTADAPTOR]="IncorrectAdaptor";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.NOINTERNALDATA]="NoInternalData";P[a.DS.SMAMpaCAEWidgetLauncher.CAEProcessCreator.ERRORCODES.NOCLOUDINFO]="NoCloudInfo";P[a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES.PROCESSTYPEERROR]="ProcessTypeError";P[a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES.COLLABSPACESWSERROR]="CollabSpaceWSError";P[a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES.VALIDATEPROCESSWSERROR]="ValidateProcessWSError";P[a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES.JOBERROR]="JobError";P[a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES.NOPROCESSSELECTED]="ResumeEmptyStudy";P[a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES.INVALIDSTUDYNAME]="InvalidStudyName";P[a.DS.SMAMpaCAEWidgetLauncher.CAESession.ERRORCODES.NOTINSTANCIATED]="InstanciateProcess";if(Q.detail.replaceKey){var N={};N[Q.detail.replaceKey]=Q.detail.message?Q.detail.message:J.get("ContactAdmin");O=J.replace(J.get(P[Q.detail.errorCode]),N)}else{O=J.get(P[Q.detail.errorCode])}h.call(this,O);if(Q.detail.isFatal){I.call(this)}};h=function(N){A.unmask(a.widget.body);this.$.notification.logMessage({type:"error",text:N})};g=function(N){A.unmask(a.widget.body);this.$.notification.logMessage({type:"success",text:N,autoRemove:true})};u=function(){A.mask(a.widget.body);var N=this.templateDisplayName+n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.Property.DefaultStudyName");var O=this.querySelector("#studyNameField").value;if(!(O===null||O===undefined||O.length===0)){N=this.querySelector("#studyNameField").value}this.NLS=n;if(!/^[^\#\$\@\&\!\%\*\;\:\?\\\/\<\>\[\]\|\^\(\)\{\=\}]*$/g.test(N)||!this.isValidString(N,a.DS.SMAProcSP.SPBase.TYPESTRINGS.PROCESSNAME)){C.call(this,b.INVALIDSTUDYNAME,false);return}else{if(this.data.processObject===undefined&&this.CreateNewStudyToggle.isChecked()){this.$.caeProcessCreator.createCaeProcess({SimulationKind:"adhoc",SimulationName:n.replace(n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.Property.SimulationName"),{STUDYNAME:N}),ActivityName:this.templateDisplayLaunchName+n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.Property.ActivityName"),TemplateName:this.templateName,TemplateRevision:this.templateRevision,ExtensionName:this.adapterId,disconnectedData:this.$.session.managedData.childInstances,onComplete:i.bind(this)})}else{if(this.data.processObject===undefined){C.call(this,b.NOPROCESSSELECTED,false)}else{this.$.caeProcessCreator.validateProcess({options:{processID:this.data.processObject.objectId,TemplateName:this.templateName,TemplateRevision:this.templateRevision,ExtensionName:this.adapterId,ClearProductId:true,ActivityName:this.templateDisplayLaunchName+n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.Property.ActivityName"),onComplete:i.bind(this),}})}}}};i=function(N){this.$.caeLauncherUtil.executeSimulation({simulationId:N,onComplete:E.bind(this),onError:C.bind(this,b.JOBERROR,true,"reason")})};E=function(){g.call(this,this.templateDisplayLaunchName+n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.SUCCESS.LaunchingCAE"));if(this.$.session.queryProcessID===null||this.$.session.queryProcessID===""){var N={objectId:this.$.caeProcessCreator._Options.processID,displayName:this.$.caeProcessCreator._Options.SimulationName,objectType:"Simulation"};I.call(this,N)}};m=function(){if(!this.CAELicense.Run_Abaqus_CAE||this.CAELicense.Run_Abaqus_CAE!=="true"){this.fire("licenseError",{message:"You do not have the license required to access the selected application. Please contact your administrator."})}};K=function(){this.fire("licenseError",{message:"Error contacting the license service."})};a.DS.SMAMpaCAEWidgetLauncher=a.DS.SMAMpaCAEWidgetLauncher||{};a.DS.SMAMpaCAEWidgetLauncher.CAELauncher=a.Polymer({is:"cae-launcher",properties:{studyName:{type:Object,value:{placeholder:n.replace(n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.StudyFieldPlaceHolder"),{templateDisplayName:"CAE"})},},templateName:{type:String,value:"Abaqus/CAE_Launcher"},templateRevision:{type:String,value:"-"},templateDisplayName:{type:String,value:"CAE",observer:"templateDisplayNameChanged"},templateDisplayLaunchName:{type:String,value:"Abaqus/CAE"},collabSpaceTitle:{type:String,value:n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.CollabSpaceTitle")},cancelButtonTitle:{type:String,value:n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.CancelButtonText")},studyFieldTitle:{type:String,value:n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.studyFieldTitle")},launchButtonTitle:{type:String,computed:"createLaunchButtonTitle(templateDisplayLaunchName)"},data:{type:Object,value:{}},adapterId:{type:String,value:"com.dassault_systemes.smampa.adapter.cae3dx"}},ready:f,attached:D,launchCAE:u,cancellaunch:M,collabSpaceChanged:s,onSimulationSearch:v,searchProcess:k,showSuccessMessage:d,showErrorMessage:r,onAppMessage:L,createNewStudy:l,useExistingStudy:z,licenseDataReady:m,licenseError:K,displayError:B,createLaunchButtonTitle:function(N){return n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.RunButtonText")+N},templateDisplayNameChanged:function(N){this.studyName.placeholder=n.replace(n.get("SMAMpaCAEConnector.SMAMpaCAEWidgetLauncher.StudyFieldPlaceHolder"),{templateDisplayName:N});this.$.studyNameField.placeholder=this.studyName.placeholder},onSessionLoaded:function(){if(this.$.session.process.attributes){this.studyName.value=this.$.session.process.attributes.title;this.$.studyNameField.value=this.studyName.value}},listeners:{"sp-error":"displayError",appmessage:"onAppMessage"},behaviors:[a.DS.SMAProcSP.SPBase]});a.DS.SMAMpaCAEWidgetLauncher.CAELauncher.ERRORCODES=b})}(this));