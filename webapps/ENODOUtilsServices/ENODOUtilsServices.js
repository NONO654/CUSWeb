define("DS/ENODOUtilsServices/DOServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(h,e,b,g,f){var d=null;var a=null;var c={GetCurrentSecurityContext:function(){return new e(function(j,i){g.getInstance().getSecurityContext({onSuccess:function(k){a=k.SecurityContext.replace("ctx::","");j()},onFailure:function(){i()}})})},get3DSpaceUrl:function(){return this.getPlatformURL("3DSpace")},getPlatformId:function(){return(typeof widget!=="undefined"&&widget.getValue("x3dPlatformId"))?widget.getValue("x3dPlatformId"):"OnPremise"},retrievePlatformUrl:function(){return new e(function(j,i){if(d===null){f.getPlatformServices({onComplete:function(k){d=k;j()},onFailure:function(k){i(k)}})}else{j()}})},getTenantInfo:function(k){var j={};for(var i=0;i<d.length;i++){if(d[i].platformId===k){j=d[i];break}}return j},getPlatformURL:function(j){var l=this;if(!UWA.is(d,"array")){throw new Error("Platform services not initialize yet")}var i=0,m=l.getPlatformId(),k=l.getTenantInfo(m);if(k[j]===undefined){console.error("No "+j+" URL available for this tenant.");throw new Error("Unknown service "+j)}else{return k[j]}},SendServerRequest:function(j){var k=this;var i={};i.method=j.webService.verb;var l=k.GetCurrentSecurityContext();l.then(function(){i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:"ctx::"+a};i.type="json";i.proxy="passport";i.timeout=(typeof i.timeout!=="undefined")?i.timeout:30000;i.onComplete=j.callback.onComplete;i.onFailure=j.callback.onFailure;var m=j.data;i.data=JSON.stringify(m);var n=k.retrievePlatformUrl();n.then(function(){var o=k.get3DSpaceUrl();b.authenticatedRequest(o+j.webService.url,i)})})}};return c});