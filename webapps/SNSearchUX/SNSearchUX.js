/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNSearchUX/InContextSearch",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredefinedQueries","require"],function(k,l,c,h,d,i,e,j,f,a,g){var b=l.extend(c,h,{_socket:null,_registered_search_ctx:null,_isWidgetMaximized:false,_pubsub_loaded:false,init:function(m){this.setDebugMode(e.getDebugMode());this._socket=j.createSocket({socket_id:"incontextsearch_socket_id"});this.setOptions(m);var n=this;g(["DS/PubSub/PubSub"],function(o){n._pubsub_loaded=true;if(k.is(o)){o.add("onViewChange",function(u){var s=u.widgetId||u.id;var v,t,r,p=false,q={resetNLS:true,focus:false};if(k.is(k.Widgets)&&k.is(k.Widgets.instances)){k.Widgets.instances.filter(function(w){return k.is(w.id)&&w.id.indexOf("preview")!==-1&&!w.events.onDestroy}).forEach(function(w){w.addEvent("onDestroy",function(){if(n.computeSearchBar){n.computeSearchBar()}})});t=k.Widgets.instances.filter(function(x){return x.id===s});t=t.length>0?t[0]:null}r=k.is(n.getOption("addinMode"),"string")||(k.is(t)?(t.getValue("stayOnSearch")||false):false);if(k.is(t)&&true===t.getValue("noSearchModeChange")){p=true}if(k.is(n._registered_search_ctx)&&k.is(n.getInContextOptions(s))){v=n.getInContextOptions(s);if(v.id===s){if(u.type==="maximized"||u.type==="fullscreen"){n._isWidgetMaximized=true;if(k.is(v.search_delegation)&&v.search_delegation==="3ddashboard"&&!r){n._socket.dispatchEvent("onSetFindInTab",v)}else{if(!r){n._socket.dispatchEvent("onSetInAppContext",true);n._socket.dispatchEvent("onSetFindInApp",v)}}}else{if(u.type==="windowed"||u.type==="minimized"){n._isWidgetMaximized=false;n._socket.dispatchEvent("onSetInAppContext",false);if(e.getOption("find_in_this_tab_default")===true&&!r){n._socket.dispatchEvent("onSetFindInTab",null)}else{n._socket.dispatchEvent("clickOnChoiceSearch",q)}}}}}else{if(k.is(t)){if(t&&t.getValue("appId")==="X3DSEAR_AP"){n._socket.dispatchEvent("3DSearchWidgetmaximized",u.type)}if(t&&(t.getValue("appId")==="X3DSEAR_AP"&&(u.type==="maximized"||u.type==="fullscreen"))||(t.title==="3DSearch"&&-1<t.id.indexOf("preview"))){return}}if((u.type==="maximized"||u.type==="fullscreen")&&!r){n._isWidgetMaximized=true;if(false===p){n._socket.dispatchEvent("onSetFindInTab",t?(t.getValue("searchNLS")||null):null)}}else{if(u.type==="windowed"||u.type==="minimized"){n._isWidgetMaximized=false;n._socket.dispatchEvent("onSetInAppContext",false);if(e.getOption("find_in_this_tab_default")===true&&!r){if(false===p){n._socket.dispatchEvent("onSetFindInTab",null)}}else{if(false===p){n._socket.dispatchEvent("clickOnChoiceSearch",q)}}}}}})}});if(k.is(m.addinMode,"string")){require(["DS/PlatformAPI/PlatformAPI"],function(o){n.log("InContextSearch: addinMode found, start subscribing to webinwin:win:notification");o.subscribe("webinwin:win:notification",n._onWinNotif.bind(n))})}this._socket.addListener("RegisterContext",this._registerContext.bind(this));this._socket.addListener("TemporaryBypassFedsearch",this._temporaryBypassFedsearch.bind(this));this._socket.addListener("InContextSearch",this._inContextSearch.bind(this));this._socket.addListener("UnregisterContext",this._unregisterContext.bind(this))},_onWinNotif:function(m){if(k.is(m,"object")&&k.is(m.event,"string")&&k.is(m.content,"object")){switch(m.event){case"RegisterContext":this.log("webinwin:win:notification for RegisterContext notif received, options="+JSON.stringify(m));this._registerContext(m.content);break;case"InContextSearch":this.log("webinwin:win:notification for InContextSearch notif received, options="+JSON.stringify(m));this._inContextSearch(m.content);break}}else{this.log("webinwin:win:notification does not contain info in expected format")}},getInContextOptions:function(m){var n=this._registered_search_ctx.get({id:m}),o;if(k.is(n)){o=n.toJSON()}return o},_registerContext:function(n){this.log("Register Search Context");var m=this;if(!k.is(this._registered_search_ctx)){this._registered_search_ctx=new d()}this._cleanSourceValue(n);this._cleanOrderFields(n);var o=m.getInContextOptions(n.widget_id);if(k.is(o)){this.log("A Context in already registered for Widget Id "+n.widget_id+". Update it");this._registered_search_ctx.remove({id:n.widget_id});n.id=n.widget_id;this._registered_search_ctx.add(n)}else{this.log("Register the context for Widget Id "+n.widget_id);n.id=n.widget_id;this._registered_search_ctx.add(n)}if(this._amIAMaximizedWidget(n.widget_id)){m._isWidgetMaximized=true;if(k.is(o)){if(k.is(n.search_delegation)&&n.search_delegation==="3ddashboard"){if(!k.is(o.search_delegation)||o.search_delegation!=="3ddashboard"){m._socket.dispatchEvent("onSetInAppContext",false);m._socket.dispatchEvent("onSwitchToFindInTab",m.getInContextOptions(n.widget_id))}}else{if(k.is(o.search_delegation)&&o.search_delegation==="3ddashboard"){m._socket.dispatchEvent("onSwitchToFindInApp",m.getInContextOptions(n.widget_id))}}}else{if(k.is(n.search_delegation)&&n.search_delegation==="3ddashboard"&&!k.is(m.getOption("addinMode"),"string")){m._socket.dispatchEvent("onSetFindInTab",m.getInContextOptions(n.widget_id))}else{m._socket.dispatchEvent("onSetInAppContext",true);m._socket.dispatchEvent("onSetFindInApp",m.getInContextOptions(n.widget_id))}}}this._socket.dispatchEvent("RegisterContext_Response",n,n.app_socket_id)},_amIAMaximizedWidget:function(n){if(k.is(k.Widgets)&&k.is(k.Widgets.instances)){var m=k.Widgets.instances.filter(function(o){if(o.id===n&&o.getView().type==="maximized"){return true}else{return false}});return m.length!==0}return false},_temporaryBypassFedsearch:function(n){if(!k.is(n.bypass_url)){return}if(k.is(this._registered_search_ctx)){var p={id:n.widget_id};var o=this._registered_search_ctx.where(p);if(k.is(o)&&o.length>0){for(var m=0;m<o.length;m++){if(k.is(o[m])&&k.is(o[m]._attributes)){o[m]._attributes.bypass_url=n.bypass_url}}}else{this.log("No context registered with Widget Id "+n.widget_id)}}else{this.log("No context registered")}},_inContextSearch:function(o){this.log("In Context search Activated");var n=this;var m={inCtx_widget_id:o.widget_id};this._promise=new i(function(p){if(o.default_with_precond===true){if(k.is(o.default_search_criteria)&&o.default_search_criteria.length>0){if(o.default_search_criteria.indexOf(":")>0){require(["DS/SNResultUX/utils/WildcardMgr"],function(q){n._socket.dispatchEvent("fetchPQsFromServer");a.getPQFetchPromise().then(function(){var r=q.manageWildcardAddtion(o.default_search_criteria);r=f.replacePQsWithCVPrefixes(r);p(r)})})}else{p(o.default_search_criteria)}}else{p()}}else{p()}});this._promise.then(function(q){delete n._promise;n._promise=null;if(o.default_with_precond===true){if(k.is(o.default_search_criteria)&&o.default_search_criteria.length>0){m.value=q;m.displayValue=o.default_search_criteria;m.searchStringToDisplayInSearchField=o.default_search_criteria}else{}if(k.is(o.precond)){if(o.precond.trim().length>0){if(k.is(m.value)&&m.value.trim().length>0){m.value=m.value+" AND "+o.precond}else{m.value=o.precond}}}if(k.is(o.displayValue)){m.searchStringToDisplayInSearchField=o.displayValue}if(k.is(o.display_search_criteria)){m.searchStringToDisplayInSearchField=o.display_search_criteria}}else{m.focus=true}if(k.is(o.global_actions)){m.incontext_global_actions=o.global_actions}if(k.is(o.itemViewClickHandler)&&o.itemViewClickHandler.trim().length>0){m.itemViewClickHandler=o.itemViewClickHandler}n._cleanSourceValue(o);m.source=o.source;if(k.is(o.tenant)){m.tenant=o.tenant}if(k.is(o.advanced_search)){m.advanced_search=o.advanced_search;m.advanced_search.default_search_criteria=m.value}if(k.is(o.recent_search)){m.recent_search=o.recent_search}var s={id:o.widget_id};var r=n._registered_search_ctx.where(s);if(k.is(r)&&r.length>0){if(r.length===1){n.log("A Context in already registered for Widget Id "+o.widget_id+". Update it");var p=r[0].toJSON();if(k.is(o.context_title,"string")){n._registered_search_ctx.remove({id:o.widget_id});p.context_title=o.context_title;n._registered_search_ctx.add(p)}else{if(k.is(p.context_title,"string")){n._registered_search_ctx.remove({id:o.widget_id});delete p.context_title;n._registered_search_ctx.add(p)}}}else{throw new Error("2 search context have been registered for the same Widget Id "+o.widget_id)}}if(k.is(n.getOption("addinMode"))){m.forceWidgetUXRecreation=true}m.tag_filter=o.tag_filter;m.refine=o.tag_filter;f.autocompleteRendered().then(function(){n._socket.dispatchEvent("onInContextSearch",{inContextOptions:o,placeholder:undefined});n._socket.dispatchEvent("search",m)})})},_cleanOrderFields:function(m){if(k.is(m.order_field,"array")&&m.order_field.length>0&&k.is(m.order_by,"array")&&m.order_by.length>0){m.order_field=m.order_field[0];m.order_by=m.order_by[0]}else{m.order_field=undefined;m.order_by=undefined}},_cleanSourceValue:function(m){if(k.is(m.source)){if(k.is(m.source,"string")){m.source=[m.source]}}},_unregisterContext:function(o){this.log("Unregister search Context");var m=o;if(k.is(m,"string")){m={widget_id:o,widgetId:o}}if(k.is(this._registered_search_ctx)){var p={id:m.widget_id};var n=this._registered_search_ctx.where(p);if(k.is(n)&&n.length>0){this._registered_search_ctx.remove({id:m.widget_id});if(this._amIAMaximizedWidget(m.widget_id)){this._socket.dispatchEvent("onSetInAppContext",false);this._socket.dispatchEvent("onSetBackSearchOrFindInTab",{noFocus:true})}}else{this.log("No context registered with Widget Id "+m.widget_id)}}else{this.log("No context registered")}}});return b});define("DS/SNSearchUX/SearchHistoric",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(b,d,a){var c=d.singleton(a,{history:{},init:function(){},getHistoric:function(){if(!b.is(localStorage.SNSearchBoxStore)){return[]}return JSON.parse(localStorage.SNSearchBoxStore)},setHistoricInLocalStorage:function(){var e=this.getHistoric();localStorage.SNSearchBoxStore=JSON.stringify(e)},storeValueInDataBase:function(h){if(!b.is(h,"string")){throw new Error("null value given to SearchView._storeValueInLocalStorage!")}if(h.trim().length<=0){return}var g=this.getHistoric();if(g.indexOf(h)===-1){if(g.length>=100){g.shift()}g.push(h)}else{var f=g.indexOf(h);var e=g[f];g.splice(f,1);g.push(e)}localStorage.SNSearchBoxStore=JSON.stringify(g)}});return c});
/*!
  Script: Autocomplete.js

    This file is part of UWA JS Runtime.

  About: License

    Copyright 2006-2012 Netvibes, a Dassault SystÃ¨mes company.
    All rights reserved.
*/
define("DS/SNSearchUX/Autocomplete_ToMigrate",["UWA/Core","UWA/Event","UWA/Data","UWA/Json","UWA/Controls/Abstract"],function(d,b,c,a,f){var e=f.extend({typeTimeout:null,dataCache:{},itemCache:{},serverSuggests:{},defaultOptions:{suggestUrl:null,suggestKey:"",placeholder:"",shouldExist:false,itemDataKey:"item",dataParser:null,typeDelay:500,minLength:1,maxHeight:"auto",suggestFormat:"{name}",className:"uwa-autocomplete nv-autocomplete"},init:function(g){this._parent(g);this.buildSkeleton();this.attachEvents()},buildSkeleton:function(){var h=this.elements,g=this.options.className;h.form=d.createElement("form",{"class":g,autocomplete:"off"});h.inputContainer=d.createElement("div",{"class":g+"-searchbox"}).inject(h.form);h.input=d.createElement("input",{"class":g+"-input",placeholder:this.options.placeholder,type:"text"}).inject(h.inputContainer);this.resetInput();h.suggestsContainer=d.createElement("div",{"class":g+"-suggests"}).inject(h.form);h.serverSuggests=d.createElement("ul",{id:"search-suggests-server"}).inject(h.suggestsContainer);h.suggests=d.createElement("ul",{id:"search-suggests-history"}).inject(h.suggestsContainer);h.container=h.form},attachEvents:function(){var g=this.elements;g.input.addEvent("keyup",this.onKeyUp.bind(this));g.input.addEvent("blur",this.onBlur.bind(this));g.input.addEvent("focus",this.onFocus.bind(this));g.form.addEvent("submit",function(i){var h=this.itemCache[g.input.value.toLowerCase()];b.stop(i);if(d.is(this.serverSuggests)&&-1!==Object.keys(this.serverSuggests).indexOf(g.input.value)){this.dispatchEvent("onSelect",[g.input.value,this.serverSuggests[g.input.value]]);g.input.blur();this.dispatchEvent("onHideSuggests")}else{if(!this.options.shouldExist||h){if(this.options.suggestKey&&h){g.input.value=h[this.options.suggestKey]}this.dispatchEvent("onSelect",[g.input.value,h]);g.input.blur();this.dispatchEvent("onHideSuggests")}}return false}.bind(this))},dataParse:function(i){var k,g,h,j=this.options.dataParser;if(d.is(j,"function")){i=j(i)}else{if(a.isJson(i)){i=a.decode(i);h=true}else{i=a.xmlToJson(i);for(k in i){if(i.hasOwnProperty(k)){i=i[k];break}}}for(k in i){if(i.hasOwnProperty(k)){if(!g){g=k}if(Array.isArray(i[k])){i=i[k];h=true}}}if(!h&&g){i=[i[g]]}}return Array.isArray(i)?i:[]},getFormattedSuggest:function(g){return this.options.suggestFormat.replace(/\{(\w+)\}/g,function(j,k){var h=d.is(g,"string")?g:g[k];return h})},resetInput:function(){var g=this.elements;if(!g.input.placeholder){g.input.value=this.options.placeholder}else{g.input.value=""}this.resetCache()},getFocus:function(){this.elements.input.focus()},resetCache:function(){this.dataCache={};this.itemCache={}},onUpdateSuggests:function(h){var j,i,l,k=this.elements,g=this;this.dispatchEvent("onShowSuggests");if(h===null){k.suggests.empty();k.serverSuggests.empty()}if(d.is(h)&&d.is(h.serverSuggests,"array")&&h.serverSuggests.length>0){l=h.serverSuggests;k.serverSuggests.empty();g.serverSuggests={};l.forEach(function(m){j=g.createSuggestElement(true,m.command,m.icon,k.input.value,k.serverSuggests,m.label);g.serverSuggests[m.command]=g.querySuggest(m);j.addEvent("click",function(){g.dispatchEvent("onSelect",[m.command,g.serverSuggests[m.command]])})})}else{if(d.is(h)&&d.is(h.history,"Array")||Array.isArray(h)){l=h.history||h;k.suggests.empty();k.serverSuggests.empty();l.forEach(function(m){i=g.getFormattedSuggest(m);j=g.createSuggestElement(false,i,"clock",k.input.value,k.suggests);j.addEvent("click",function(n){var o=n.currentTarget.getText();g.dispatchEvent("onSelect",[o,n])})})}}this.resizeSuggests()},createSuggestElement:function(h,n,l,g,m,i){if(!String.prototype.replaceLast){String.prototype.replaceLast=function(r,q){var p=this.lastIndexOf(r);if(p>=0){return this.substring(0,p)+q+this.substring(p+r.length)}return this.toString()}}var o,k;if(h){k=d.createElement("div",{"class":"search-suggest-div-element",title:n})}else{k=d.createElement("div",{"class":"search-history-div-element",title:n})}if(l){var j=d.createElement("span",{"class":"fonticon fonticon-"+(l||"clock")});j.inject(k)}if(h){o=d.createElement("a",{"class":"search-suggest-element"}).inject(k)}else{o=d.createElement("a",{"class":"search-history-element"}).inject(k)}o.setText(n);if(g&&i){i=d.String.escapeHTML(i||"");g=d.String.escapeHTML(g.split(" ").pop());if(i&&n!==i){o.innerHTML='<span style="color:#ccc; font-size:13px;">'+o.innerHTML.replaceLast(i,"</span>"+i)}o.innerHTML=o.innerHTML.replaceLast(i,i.replace(new RegExp(g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),"<strong>$&</strong>"))}k.inject(m);return k},querySuggest:function(g){var h;h=g.command;return{search_type:"#search",value:h,searchStringToDisplayInSearchField:g.label,internalSearchCriteria:null,adv_search:false}},onSelect:function(g){this.elements.input.value=g;this.dispatchEvent("onHideSuggests")},onHideSuggests:function(){var g=this.elements;g.container.removeClassName(this.options.className+"-suggestsDisplayed")},onShowSuggests:function(){var g=this.elements;g.container.addClassName(this.options.className+"-suggestsDisplayed")},onBlur:function(){if(this.preventBlur===true){this.preventBlur=false;return}setTimeout(function(){this.dispatchEvent("onHideSuggests");this._cancel_suggest_update=true}.bind(this),200)}});return e});define("DS/SNSearchUX/SearchUX_TopBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","UWA/Promise","DS/WebappsUtils/WebappsUtils","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/InContextSearch","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/Api/SearchApi","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/Logger"],function(q,n,x,h,y,c,e,b,v,f,t,k,d,a,u,r,s,g,o,p,j,m,i,w){var l=n.singleton(x,h,{_resourcesMgt:null,_selectedSource:null,_url_settings:{},_socket:null,_active_3dsearch_widget:null,_wdg_ready:true,_ctx_search:null,_currentTabId:null,_topframe_search_delegation:false,_SWFilteringCheckDone:true,result_ux_customization:{},_PQEvaluationPromisePC:c.deferred(),_EasyType:null,_sidePanelClose:false,_topFrame:null,_firstInit:false,_sidePanelHide:false,init:function(z){var B=this;var C=window.location.search.substring(1);if(C){var D=C.split("&");for(var A=0;A<D.length;A++){var E=D[A].split("=");if(E.length===1){this._url_settings[E[0]]=true}else{if(E.length===2){(E[0].length>0)&&(this._url_settings[E[0]]=E[1])}}}k.urlSettings(this._url_settings)}this.setOptions(z);if(q.is(z)&&q.is(z.userId)){a.setUserId(z.userId);this.log("Connected User = "+a.getUserId())}else{this.log("SearchTopBar:init Input options do not contain the connected userId")}a.activateCompactOrComfortMode();a.ensureBetaStatus().then(function(){this.setDebugMode(k.getDebugMode());this._resourcesMgt=new f(q.is(z)?z.ressources:{});g.setResourceMgt(this._resourcesMgt);m.setResourceMgt(this._resourcesMgt);var F=this._resourcesMgt.getActiveTenant();k.getTenantSettings(F).then(function(){a.activateCompactOrComfortMode(F);if(z!==undefined){if(this.options.ressources!==undefined){this._buildUI()}}b.add("tab:change",function(H){B._currentTabId=H;B.computeSearchBar(H)});if(q.is(B.options.searchParams)){if(q.is(B.options.searchParams.close,"function")&&q.is(B.options.searchParams.isOpen,"function")&&q.is(B.options.searchParams.open,"function")){B._topframe_search_delegation=true}if(B.options.searchParams.pqAccessEvalcallback){B.pqAccessEvalcallback=B.options.searchParams.pqAccessEvalcallback}if(B.options.searchParams.resultUX_customization){B._addResultUX_customization(B.options.searchParams.resultUX_customization)}if(q.is(B.options.searchParams.searchHelper,"function")){B.searchHelper=B.options.searchParams.searchHelper}if(q.is(B.options.searchParams.search_settings,"object")){k.initialize({search_settings:B.options.searchParams.search_settings})}a.autocompleteRendered().then(function(){if(q.is(B.options.searchParams.onSearchInit,"function")){B.options.searchParams.onSearchInit.call()}})}if(t.getItem("integratedSearch")===true){var G="DS/TopFrame/TopFrame";require([G],function(H){B._topFrame=H;if(q.is(z.events)&&q.is(z.events.initFrame,"function")){z.events.initFrame.call(undefined,B._topFrame)}if(q.is(B._topFrame)&&q.is(B._topFrame._frame)){B._topFrame._frame.addEvent("onPanelClose",function(I){if(q.is(I)&&q.is(I.tag)&&I.tag!=="taggerCtn"){B._sidePanelClose=true;B._socket.dispatchEvent("showSearchInThisTab");B._socket.dispatchEvent("clearSearch")}});B._topFrame._frame.addEvent("onPanelOpen",function(L){if(q.is(L)&&q.is(L.tag)&&L.tag==="search"){if(q.is(L.position)){var J=0;var I=B._isSearchWidgetAvailable();if(I.maxIndex===undefined&&I.indexSide!==undefined){J=I.indexSide}else{J=I.maxIndex}if(q.is(I.wdg_search_items)&&I.wdg_search_items.length>0){if(q.is(I.wdg_search_items[J])){var K=I.wdg_search_items[J].get("widget_id");if(q.is(K)){if(L.position==="fitted"||L.position==="maximized"){if(a.getsearchType()===a.SearchTypeEnum.ADVANCED_SEARCH){B._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:K})}B._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:K,activation:false,position:L.position})}else{B._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:K,activation:true,position:L.position})}}}}require(["DS/PlatformAPI/PlatformAPI"],function(M){M.publish("sideOnPanelOpen",L)})}}})}})}}.bind(B))}.bind(this))},setTagPinnedToQuery:function(D){var B=JSON.parse(localStorage.getItem("taggerPinned"))||{};var E=a.getUserId();B=B[E]||{};var z=a.identifyClientInfo().identifier==="3DDashboard";z=document.querySelector(".topbar-app-brand")&&document.querySelector(".topbar-app-brand").innerText.match(/enovia/i)?false:z;var A="";if(!z){A=window.location.hostname}var F=B[A]||{keep:[]};var C={};F.keep&&F.keep.forEach(function(I){var H=JSON.parse(I.predicate);var G=H.predicate;H.disptext=H.dispValue;delete H.predicate;delete H.dispValue;C[G]=[H]});if(!D.refine&&q.is(C,"object")&&Object.keys(C).length>0){D.refine={allfilters:C}}},computeSearchBar:function(A){var B,C;var z={resetNLS:true,focus:false};A=A||this._currentTabId||a.getCurrentTabId();if(!q.is(this._ctx_search)||!q.is(this._ctx_search._socket)){return}var D=q.Widgets.instances.filter(function(E){return E.context===A&&E.getView().type==="maximized"});if(D.length===1){B=D[0];if(q.is(this._ctx_search._registered_search_ctx)){C=this._ctx_search.getInContextOptions(B.id);if(q.is(C)&&!B.getValue("stayOnSearch")){if(q.is(C.search_delegation)&&C.search_delegation==="3ddashboard"){this._ctx_search._socket.dispatchEvent("onSetFindInTab",C)}else{this._ctx_search._socket.dispatchEvent("onSetInAppContext",true);this._ctx_search._socket.dispatchEvent("onSetFindInApp",C)}}else{if(!B.getValue("stayOnSearch")){this._ctx_search._socket.dispatchEvent("onSetInAppContext",false);this._ctx_search._socket.dispatchEvent("onSetFindInTab",B.getValue("searchNLS")||null)}else{this._socket.dispatchEvent("clickOnChoiceSearch",z)}}}else{if(!B.getValue("stayOnSearch")&&(q.is(B.getTitle,"function")&&B.getTitle()!=="Unified Search")){this._ctx_search._socket.dispatchEvent("onSetInAppContext",false);this._ctx_search._socket.dispatchEvent("onSetFindInTab",B.getValue("searchNLS")||null)}else{this._socket.dispatchEvent("clickOnChoiceSearch",z)}}}else{var z={resetNLS:true,focus:false};this._ctx_search._socket.dispatchEvent("onSetInAppContext",false);if(k.getOption("find_in_this_tab_default")===true){this._socket.dispatchEvent("onSetFindInTab",null)}else{if(q.is(A)){this._socket.dispatchEvent("clickOnChoiceSearch",z)}else{this._socket.dispatchEvent("onSetBackSearchOrFindInTab",z)}}}},buildPQAccessMap:function(){var z=this;o.fetchPQsFromServer(z._resourcesMgt).then(function(){var C=o.getPQs();if(z.searchHelper){var B={};B.PQ={PQ:C.PQ,requested_info:["access"]};B.onComplete=function(E){var D=E.PQ.PQ;z.pqAccessMap={};D.forEach(function(F){z.pqAccessMap[F.pqid]=F.viewData.access});z._PQEvaluationPromisePC.resolve()};z.searchHelper.call(undefined,B)}else{if(z.pqAccessEvalcallback){var A={PQ:C.PQ,onComplete:function(D){z.pqAccessMap=D;z._PQEvaluationPromisePC.resolve()}};z.pqAccessEvalcallback.call(undefined,A)}else{z.pqAccessMap=null;z._PQEvaluationPromisePC.resolve()}}})},_buildUI:function(){if(k.getOption("universal_search")===true){var B=this,A;this.log("User "+this.options.userId+" belong to the white list");j.getPlatformServices({onComplete:function(N){if(q.is(N,"array")){var H=[];var F=0,L=N.length;for(F=0;F<L;F++){var M=N[F];var K={};K.id=M.platformId;K.name=M.displayName;K.services=[];var J=Object.getOwnPropertyNames(M);if(q.is(J,"array")){for(var G=0,I=J.length;G<I;G++){if(M[J[G]].indexOf("http")===0){K.services.push({id:J[G],url:M[J[G]]})}}}H.push(K)}a.setPlatforms(H)}},onFailure:function(){w.log("oFailure")}});var D=function(){w.log("Enter loginToSources");var H="";var F=B._resourcesMgt.getAvailableTenants();if(q.is(F,"array")&&F.length===1){H=F[0].tenantId;w.log("Single Tenant: "+H)}else{if(q.is(F,"array")&&F.length>1){var I=B._resourcesMgt.getActiveTenant();w.log("Multiple tenants avaialable, active tenant: "+I);if(I==="3DDashboard"){var G=t.getItem("defaultTenantId");w.log("Tenant from preferences: "+G);if(B._resourcesMgt.getTenantInfo(G)){H=G;w.log("Tenant found in preferences is available")}else{w.log("Tenant found in preferences is NOT available");H=F[0].tenantId}}else{H=I}}}w.log("Tenant for Login is: "+H);p.login({resources:B._resourcesMgt,tenantID:H,onComplete:function(){},onFailure:function(){}});if(true===k.getOption("force_loading_WebUX_js")){require(["WebUX/WebUX"],function(J){B.log("WebUX is LOADED")})}};var C=k.getOption("fed_search_init_timeout");if(q.is(C,"number")){if(C===0){D.call()}else{if(C>0){setTimeout(function(){D.call()},C*1000)}}}this._intializeSocket();this._ctx_search=new u({addinMode:this.getAddinMode()});this._ctx_search.computeSearchBar=this.computeSearchBar.bind(this);this._ctx_search._socket.addListener("addResultUX_customization",function(F){B._addResultUX_customization(F)});var E=function(G){B._EasyType=G.adv_search_field;B._updateTenantFromIncontextOptions(G);var J={selected_source:B._resourcesMgt.toJSON(),openTagger:B.options.events.openTagger,setTaggerMode:B.options.events.setTaggerMode,closeTagger:B.options.events.closeTagger};A=B.getResultUX_customization();if(q.is(A)){J.result_ux_customization=A}if(B._isWidgetReadyToLaunch()===true){var F=o.isAPrefixedPQSearch(G.value);if(q.is(B.searchHelper)&&q.is(F)&&!q.is(G.inCtx_widget_id)){var H=o.getPQObjFromPQPrefix(F);var I={};I.PQ={PQ:[H],requested_info:["datagridview_columns","global_actions"]};I.onComplete=function(L){var K=L.PQ.PQ[0];if(K.viewData&&K.viewData.datagridview_columns){G.viewData={SearchColumnCustoDefinition:{viewId:"###"+H.pqName,viewDefinition:[]}};H.viewData.datagridview_columns.forEach(function(M){G.viewData.SearchColumnCustoDefinition.viewDefinition.push({uri:M})})}if(K.viewData&&K.viewData.global_actions){if(!G.viewData){G.viewData={}}G.viewData.global_actions=K.viewData.global_actions}B._launchWdg(J,G)};B.searchHelper.call(undefined,I)}else{B._launchWdg(J,G)}}};var z=function(F,H){var G={};if(q.is(F,"object")){G=F}if(q.is(B.options)&&q.is(B.options.searchParams)){if(q.is(B.options.searchParams.source,"array")){G.source=B.options.searchParams.source}else{if(q.is(B.options.searchParams.getSources,"function")){var I=B.options.searchParams.getSources();if(q.is(I,"array")){G.source=I}}}}G.searchType=H;E(G)};this._socket.addListener("search",function(F){z(F,a.SearchTypeEnum.SEARCH);var G=true;v.publish({channel:"TopBar_Suggest",topic:"CancelSuggest",data:G});a.setsearchType(a.SearchTypeEnum.SEARCH)});this._socket.addListener("myContent",function(F){z(F,a.SearchTypeEnum.MY_CONTENT);a.setsearchType(a.SearchTypeEnum.MY_CONTENT)});this._socket.addListener("myRecentContent",function(F){z(F,a.SearchTypeEnum.MY_RECENT_CONTENT);a.setsearchType(a.SearchTypeEnum.MY_RECENT_CONTENT)});this._socket.addListener("advancedSearch",function(F){z(F,a.SearchTypeEnum.ADVANCED_SEARCH);a.setsearchType(a.SearchTypeEnum.ADVANCED_SEARCH)});this._socket.addListener("favoriteSearches",function(F){z(F,a.SearchTypeEnum.FAVORITE_SEARCH);a.setsearchType(a.SearchTypeEnum.FAVORITE_SEARCH)});this._socket.addListener("focusOnSearch",E);this._socket.addListener("hideAdvancedSearch",function(){B._socket.dispatchEvent("hideAdvancedSearch",{})});this._socket.addListener("showAdvancedSearch",function(G){if(!q.is(G)){return}var F=B._isSearchWidgetAvailable();if(q.is(F)&&F.wdg_available===true){var H=(F.maxIndex===undefined&&F.indexSide!==undefined)?F.indexSide:F.maxIndex;var I=F.wdg_search_items[H].get("widget_id");if(q.is(I)){G.widgetId=I}}B._socket.dispatchEvent("showAdvancedSearch",G)});this._socket.addListener("openTagger",function(){if(q.is(B.options.events.openTagger,"function")){B.options.events.openTagger()}});this._socket.addListener("openTagger",B.options.events.openTagger);this._socket.addListener("setTaggerMode",function(I){if(q.is(B.options.events.setTaggerMode,"function")){B.options.events.setTaggerMode(I)}if(B._firstInit===true&&q.is(I)&&I==="criteria"){var F=B._isSearchWidgetAvailable();if(q.is(F)&&F.wdg_available===true){var G=0;if(F.maxIndex===undefined&&F.indexSide!==undefined){G=F.indexSide}else{G=F.maxIndex}var H=F.wdg_search_items[G].get("widget_id");if(q.is(H)){B._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:H})}}B._firstInit=false}});this._socket.addListener("closeTagger",function(){if(q.is(B.options.events.closeTagger,"function")){B.options.events.closeTagger()}});this._socket.addListener("closeTagger",B.options.events.closeTagger);this._socket.addListener("clearSearch",function(){if(B._resourcesMgt.getActiveTenant()==="3DDashboard"&&q.is(B.options.events.clearSearch,"function")){B.options.events.clearSearch.call(undefined,null)}});this._socket.addListener("closeTransient",function(F){if(q.is(B.options.events.closeTagger,"function")){B.options.events.closeTagger.call(undefined,null)}if(B._topframe_search_delegation){B.options.searchParams.close.call(undefined,F)}else{if(k.getOption("transient_widget")){require(["DS/TransientWidget/TransientWidget"],function(G){G.closeWidget()})}}});this._socket.addListener("onDragStart",function(){if(B._topframe_search_delegation){B.options.searchParams.close.call()}else{if(!(q.is(B.options)&&q.is(B.options.addinMode)&&q.is(B.options.addinMode.value,"string")&&(B.options.addinMode.value==="solidworks"||B.options.addinMode.value==="catiav5"))){setTimeout(function(){require(["DS/TransientWidget/TransientWidget"],function(F){if(true===a.isTaggerOpenedByCode()){B._socket.dispatchEvent("closeTagger")}F.closeWidget()})},250)}}if(true===t.getItem("integratedSearch")){if(B._topFrame._frame.isPanelMaximized("right")||B._topFrame._frame.isPanelFitted("right")){B._topFrame.minimizeSidePanel();B._topFrame._onRightPanelStateChange("minimized");B._socket.dispatchEvent("showSearchInThisTab")}}});this._socket.addListener("onShowPQListUX",function(){B.buildPQAccessMap();B._PQEvaluationPromisePC.promise.then(function(){require(["DS/SNResultUX/SearchPQListUX"],function(F){F.showPQSelector({pqAccessMap:B.pqAccessMap,pqSelectionCallback:function(G){B._socket.dispatchEvent("onPQPrefixSelect",G)}})})})});this._socket.addListener("getsearchTopbarResouceJson",function(F){B._socket.dispatchEvent("searchTopbarResouceJson",{resources:B._resourcesMgt.toJSON(),tenants:B._resourcesMgt.getAvailableTenants(),active_tenant:B._resourcesMgt.getActiveTenant()},q.is(F)?F.socket_id:null)});this._socket.addListener("fetchPQsFromServer",function(){o.fetchPQsFromServer(B._resourcesMgt)});this._socket.addListener("hideSidePanel",function(){if(q.is(B._topFrame)&&q.is(B._topFrame._frame)){B._topFrame._frame.closePanel("right","search")}B._topFrame._onRightPanelStateChange("closed");B._sidePanelHide=true});this._socket.addListener("3DSearchWidgetmaximized",function(G){if(t.getItem("integratedSearch")===true&&B._topFrame){if(B._topFrame._visibleXApp==="search"){var F=B._topFrame._frame.isPanelOpen("right");if((G==="windowed"&&B._sidePanelHide===false)){B._topFrame._updateColumn("right","search");B._sidePanelHide=true}else{if(G==="maximized"&&F===true){B._sidePanelHide=false;B._topFrame._frame.closePanel("right","search");B._topFrame._onRightPanelStateChange("closed")}else{if(F===null&&(G==="windowed"&&B._sidePanelHide===true)&&B._sidePanelClose!==true){B._topFrame._updateColumn("right","search")}}}}}})}},_intializeSocket:function(){this.log("_intializeSocket");var z=this;this._active_3dsearch_widget=new y();this._socket=d.createSocket({socket_id:"searchtopbar_socket_id"});a.getSearchViewPromise().then(function(){z.log("SearchView promise resolved");z._socket.dispatchEvent("onSetSources",{sources:z._resourcesMgt.toJSON(),searchParams:z.options.searchParams});if(q.is(z.getAddinMode(),"string")){require(["DS/PlatformAPI/PlatformAPI"],function(A){z.log("publishing search_ready event");A.publish("webinwin:web:notification",JSON.stringify({event:"search_ready",source:a.SEARCH_APP_ID,version:"1.0",content:{status:true}}))})}a.setSearchReady()});this._socket.addListener("setSelectedSource",function(A){z.log("The selected source have been modified ["+A.value+"]");try{z._resourcesMgt.setActiveTenant(A.value)}catch(B){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+A.value+")")}});this._socket.addListener("onSearch",function(C){z.log("Launch command from the result wdg ["+C+"]");if(q.is(C.parameters,"object")&&q.is(C.parameters.search_criteria)){if(q.is(C.tabInfo,"object")){if(q.is(C.tabInfo.tenant,"string")&&true===C.transient_widget){try{z._resourcesMgt.setActiveTenant(C.tabInfo.tenant)}catch(F){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+C.tabInfo.tenant+")")}z._socket.dispatchEvent("onSelectTenantAfterTabActivation",{tenant:C.tabInfo.tenant})}}var A={focus:false,setTenant:false};var E=q.is(C.tabInfo,"object")&&(true===C.transient_widget||C.tabInfo.client_identifier!=="3DDashboard");if(C.parameters.search_criteria===a.SearchTypeEnum.MY_CONTENT){if(E){z._socket.dispatchEvent("clickOnChoiceMyContent",A)}}else{if(C.parameters.search_criteria===a.SearchTypeEnum.FAVORITE_SEARCH){if(E){z._socket.dispatchEvent("clickOnChoiceFavoriteSearch",A)}}else{if(C.parameters.search_criteria===a.SearchTypeEnum.MY_RECENT_CONTENT){}else{if(true===C.parameters.adv_search||C.parameters.search_criteria===a.SearchTypeEnum.ADVANCED_SEARCH){if(E){z._socket.dispatchEvent("clickOnChoiceAdvancedSearch",A)}}else{var G=C.parameters.search_criteria;if(q.is(C.parameters.originalSearchCriteria,"string")){G=C.parameters.originalSearchCriteria}if(q.is(C.parameters.search_criteria_to_display,"string")){G=C.parameters.search_criteria_to_display}var D=G;var H=C.parameters.search_criteria;var B=z._isWidgetMaximized(C.widget_id,z._currentTabId);if(!C.transient_widget&&!(B&&C.in_apps_search)){D=null;H=null}z._socket.dispatchEvent("onRefreshSearchField",{searchStringToDisplayInSearchField:D,internalSearchCriteria:H});if(E){z._socket.dispatchEvent("clickOnChoiceSearch",A)}}}}}}});this._socket.addListener("onSearchModeSwitch",function(A){if(q.is(A,"object")&&q.is(A.new_mode,"string")){z._socket.dispatchEvent("onSwitchMode",A);if(A.new_mode===a.SearchTypeEnum.MY_RECENT_CONTENT&&A.paramsFilter==="*"){z._socket.dispatchEvent("onRefreshSearchField","")}}});this._socket.addListener("onSearchFromCompass",function(B){z.init3DSearchWidgetCreatedFromCompass(B);var A=k.getOption("search_compact_mode");if(((q.is(window)&&q.is(window.innerWidth))?window.innerWidth>958:true)&&(q.is(z.getAddinMode(),"string")?["solidworks","catiav5"].indexOf(z.getAddinMode())===-1:true)&&A===false&&k.options.search_settings.taggerClosed!==true){var C="DS/TopFrame/TopFrame";require([C],function(D){var E=false;if(q.is(D)){try{if(q.is(D.isTaggerVisible,"function")&&true===D.isTaggerVisible()){E=true}}catch(F){if(q.is(D._isTaggerVisible)&&true===D._isTaggerVisible){E=true}w.log(F)}}if(false===E){if(q.is(z.options.events.openTagger,"function")){z.options.events.openTagger();a.setTaggerOpenedByCode(true)}}else{a.setTaggerOpenedByCode(false)}})}if(B.mode!=="windowed"){z._socket.dispatchEvent("onSetFocusInSearchField",{});setTimeout(function(){if(q.is(B)&&q.is(B.x3dPlatformId,"string")&&B.x3dPlatformId.length>0){z._socket.dispatchEvent("onSelectTenant",B.x3dPlatformId)}},200)}});this._socket.addListener("onWdgCreation",function(C){if(q.is(C.widget_id)){var E=false;if(q.is(C.tabid)){z._currentTabId=C.tabid;E=true}var A=z._currentTabId;if(A===null){A=a.getCurrentTabId()}var B=z._isWidgetMaximized(C.widget_id,A);var D={widgetId:C.widget_id,maximized:B};z._socket.dispatchEvent("toggleProxyFocus",D);if(E===true){if(E===true&&q.is(z._topFrame)){if(z._topFrame.toggleTagger){z._topFrame.toggleTagger(true)}}}z.log("onWdgCreation");z.log("Widget id ["+C.widget_id+"]");z.log("Active Tab id ["+A+"]");z.log("isMaximized ["+B+"]");z._active_3dsearch_widget.add({widget_id:C.widget_id,active_tab:A,isMaximized:B});if(C.transient_widget==="true"){z._socket.dispatchEvent("hideSearchInThisTab")}}z._wdg_ready=true});this._socket.addListener("onViewChange",function(C){z.log("onViewChange ["+C.widget_id+"]");var F={active_tab:z._currentTabId,widget_id:C.widget_id};var E=z._active_3dsearch_widget.where(F);if(q.is(E)&&E.length===1){z.log("Widget ["+E[0].get("widget_id")+"] in store with maximized option "+E[0].get("isMaximized"));var B=E[0].get("widget_id");var A=z._isWidgetMaximized(B,E[0].get("active_tab"));E[0].set("isMaximized",A);z.log("Maximized option is now set to "+E[0].get("isMaximized"));var D={widgetId:B,maximized:A};z._socket.dispatchEvent("toggleProxyFocus",D)}else{z.log("No widget with that id found in the store")}});this._socket.addListener("onDestroyWidget",function(A){var B=z._active_3dsearch_widget.where({widget_id:A.widget_id});z._active_3dsearch_widget.remove(B);d.unsubscribeServer(A.widget_id)});this._socket.addListener("onCloseTransient",function(){z._socket.dispatchEvent("showSearchInThisTab")});this._socket.addListener("onSetFocusInSearchField",function(){z._socket.dispatchEvent("onSetFocusInSearchField",{});setTimeout(function(){var A=require("DS/TopBar/TopBar");if(q.is(A)&&q.is(A.view)&&q.is(A.view.focusOnSearch,"function")){A.view.focusOnSearch()}},100)});this._socket.addListener("onSearchItemClick",this._manageExternalIdCardDelegation.bind(this))},_manageExternalIdCardDelegation:function(A){var C=this;if(q.is(C.options.searchParams)){var z=true;if(A.in_apps_search){z=q.is(A.in_apps_search.idcard_activated)?A.in_apps_search.idcard_activated:true}if(z){var B=false;if(A.in_apps_search){B=q.is(A.in_apps_search.external_idcard)?A.in_apps_search.external_idcard:false}else{if(q.is(C.options.searchParams.external_idcard,"function")){B=C.options.searchParams.external_idcard.call()}else{if(q.is(C.options.searchParams.external_idcard)){B=C.options.searchParams.external_idcard}}}if(B===true){if(q.is(C.options.searchParams.idcard,"function")){C.options.searchParams.idcard.call(undefined,A.model)}}}}},_addResultUX_customization:function(A){var z=this;Object.keys(A).forEach(function(B){z.result_ux_customization[B]=A[B]})},getResultUX_customization:function(z){if(z){return this.result_ux_customization[z]}if(Object.keys(this.result_ux_customization).length>0){return this.result_ux_customization}},_isSearchWidgetAvailable:function(A){var B=this;var H={wdg_available:false,maxIndex:undefined,indexSide:undefined,active_tab:null,wdg_search_items:null};H.active_tab=a.getCurrentTabId();if(H.active_tab===null){H.active_tab=B._currentTabId}var F={active_tab:H.active_tab};H.wdg_search_items=B._active_3dsearch_widget.where(F);B.log("Check if a widget is available for update");H.wdg_available=false;if(q.is(H.wdg_search_items)&&H.wdg_search_items.length>0){var D=true;if(q.is(A,"object")&&true===A.forceWidgetUXRecreation){D=false}if(D){var G=H.wdg_search_items.length;if(G){B.log("A search widget is already instanciated ==> Check if it is still in the active tab");var C=0;for(C=0;C<G;C++){var z=H.wdg_search_items[C].get("widget_id");if(q.Widgets.instances.length>0){var E=q.Widgets.instances.filter(function(J){if(((J.id===z&&J.context===H.active_tab)||J.getValue("search_wdg_id")===z)){var I="maximized";if(q.is(A,"object")&&q.is(A.viewType,"string")&&A.viewType.length>0){I=A.viewType}if(J.getView().type===I){B.log("Widget available reuse it");H.wdg_available=true;H.maxIndex=C}if(J.getView().type==="sidepanel"){B.log("Widget available reuse it Side");H.wdg_available=true;H.indexSide=C}if(q.is(A,"object")&&q.is(A.isRecentContent,"boolean")&&A.isRecentContent&&q.is(A.widgetId)&&J.id===A.widgetId){B.log("Type of search is recent content");H.wdg_available=true;H.indexSide=C}}})}}}}}else{B.log("No widget registered in the active tab")}return H},init3DSearchWidgetCreatedFromCompass:function(B){var A=this._isSearchWidgetAvailable({viewType:B.mode});var z={};z.active_tab=A.active_tab;if(A.wdg_available===true){var C=0;if(A.maxIndex===undefined&&A.indexSide!==undefined){C=A.indexSide;if(q.is(B.mode)&&B.mode==="windowed"){var E=this._isSearchWidgetAvailable({viewType:"maximized"});if(q.is(E)&&q.is(E.maxIndex)&&E.maxIndex!==undefined){C=E.maxIndex}}}else{C=A.maxIndex}z.ressources=new f(this.options.ressources);try{z.ressources.setActiveTenant(B.x3dPlatformId)}catch(D){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+B.x3dPlatformId+")")}this._socket.dispatchEvent("onSearchFromCompassInit",z,"widget_socket_"+A.wdg_search_items[C].get("widget_id"))}},_launchWdg:function(K,I){this.log("_launchWdg");var N=this;var A=t.getItem("integratedSearch");this.setTagPinnedToQuery(I);k.options.search_settings.adv_search_field=null;if((q.is(I.adv_search_field,"string")&&I.adv_search_field.length>0)){k.options.search_settings.adv_search_field=I.adv_search_field}var L=false;if(I.searchType===a.SearchTypeEnum.MY_RECENT_CONTENT){L=true}var E=this._isSearchWidgetAvailable({forceWidgetUXRecreation:I.forceWidgetUXRecreation,isRecentContent:L,widgetId:I.widgetId});I.active_tab=E.active_tab;var O;if(I){if(q.is(I.inCtx_widget_id,"string")){O=N._ctx_search.getInContextOptions(I.inCtx_widget_id);if(q.is(O)){I.customization_options=O;A=false;if(q.is(O.modifysavedsearch)&&O.modifysavedsearch===true){A=true}}}}var Y=function(){if(I&&((q.is(I.value,"string")&&I.value.length>0)||I.focus)){var Z=k.getOption("search_compact_mode");if(((q.is(window)&&q.is(window.innerWidth))?window.innerWidth>958:true)&&(q.is(N.getAddinMode(),"string")?["solidworks","catiav5"].indexOf(N.getAddinMode())===-1:true)&&Z===false&&k.options.search_settings.taggerClosed!==true){if(k.getOption("no_TopFrame_ODT")!==true){var aa="DS/TopFrame/TopFrame";require([aa],function(ab){var ac=false;if(q.is(ab)){try{if(q.is(ab.isTaggerVisible,"function")&&true===ab.isTaggerVisible()){ac=true}}catch(ad){if(q.is(ab._isTaggerVisible)&&true===ab._isTaggerVisible){ac=true}w.log(ad)}}if(false===ac){K.openTagger();a.setTaggerOpenedByCode(true)}else{a.setTaggerOpenedByCode(false)}})}}}};if(t.getItem("integratedSearch")&&A===false&&E.wdg_available===true){E.wdg_available=false}if(E.wdg_available===true){var M="SearchComServer";var U;var P=0;if(E.maxIndex===undefined&&E.indexSide!==undefined){P=E.indexSide}else{P=E.maxIndex}if(A===true&&E.indexSide!==undefined&&E.maxIndex!==undefined){if(N._topFrame&&N._topFrame._frame){if(N._topFrame._frame.isPanelOpen("right")===true&&(N._topFrame._frame.isPanelMaximized("right")||N._topFrame._frame.isPanelFitted("right"))){P=E.indexSide;E.maxIndex===undefined}}}U="widget_socket_"+E.wdg_search_items[P].get("widget_id");var G="SearchComServer_"+E.wdg_search_items[P].get("widget_id");if(q.is(N._socket.servers,"array")&&N._socket.servers[G]){M=G}var S=true;if(q.is(N._topFrame)&&(E.maxIndex===undefined)&&A===true){if(q.is(I)&&q.is(I.fromEmptyString)&&I.fromEmptyString===true){S=false;if(N._sidePanelClose===false){S=true}}if(N._sidePanelClose===true&&q.is(I)){I.addNewTab=true}if(N._sidePanelClose===true||I.searchType==="#advancedSearch"||N._topFrame._visibleXApp){var C={fit:true,appId:a.SEARCH_APP_ID};N._topFrame.openPanel("right",C).then(function(){Y.call();N._topFrame._onRightPanelStateChange("fitted")});N._topFrame._visibleXApp="search";N._sidePanelClose=false}else{N._topFrame._frame.showPanelContent("right","search")}}I.active_tenant=N._resourcesMgt.getActiveTenant();if(S===true){N._socket.dispatchEvent("onSearchWdgUpd",I,U,M)}if(I.searchType==="#advancedSearch"){var X={widgetId:E.wdg_search_items[P].get("widget_id"),maximized:true};N._socket.dispatchEvent("toggleProxyFocus",X)}}else{var F=false;if(N._topframe_search_delegation){F=N.options.searchParams.isOpen.call()}else{}if(F===true){N.log("A search widget is already instantiated ==> Update its content");N._socket.dispatchEvent("onSearchWdgUpd",I);N._wdg_ready=true}else{var B="";var D={search_ressources:K.selected_source,transient_context:"true",reSearch:I.refine,settings_topbar:k.serialize(),search_criteria_to_display:I.searchStringToDisplayInSearchField,recent_filter:I.searchStringToDisplayInSearchField};if(I&&q.is(I.value,"string")&&I.value.length>0){D.search_criteria=I.value;D.adv_search=I.adv_search;D.adv_search_field=I.adv_search_field}else{D.focus=true}var J=true;if(I){if(q.is(I.searchStringToDisplayInSearchField)){D.search_criteria_to_display=I.searchStringToDisplayInSearchField}if(q.is(O)){D.customization_options=O;if(D.customization_options&&I.advanced_search&&I.advanced_search.showByDefault){if(!D.customization_options.advanced_search){D.customization_options.advanced_search=I.advanced_search}D.adv_search=true;if(I.advanced_search.searchOnInit===true){J=true}D.customization_options.advanced_search.default_search_criteria=I.advanced_search.default_search_criteria;D.search_criteria="#advancedSearch";J=false}if(q.is(I.displayValue)){D.search_criteria_to_display=I.displayValue}else{D.search_criteria_to_display=""}if(q.is(O.bypass_url)){if(k.options.search_settings.temp_bypass_fedsearch==="5746ca20-811a-11e4-b116-123b93f75cba"||k.options.search_settings.temp_bypass_fedsearch==="5746cf02-811a-11e4-b116-123b93f75cba"){var z=D.search_ressources.available_tenants[D.search_ressources.active_tenant];if(q.is(z)&&q.is(z.sources)&&q.is(z.sources.search)){z.sources.search.url=O.bypass_url;N.log("Temporary bypass of fed_search url by app with UIID "+k.options.search_settings.temp_bypass_fedsearch+": "+z.sources.search.url)}}}if(I.recent_search){D.customization_options.recent_search=I.recent_search}}if(q.is(I.content,"string")){D.content=I.content}D.viewData=I.viewData;if(!q.is(D.viewData)){D.viewData={}}if(!q.is(D.viewData.global_actions)){var W=N.getResultUX_customization("global_actions");if(q.is(W)&&q.is(W.actions)&&q.is(W.app_socket_id)){D.viewData.global_actions=W}if(q.is(O)){if(q.is(I.incontext_global_actions)){D.viewData.global_actions={actions:I.incontext_global_actions,app_socket_id:O.app_socket_id}}else{if(O.global_actions){D.viewData.global_actions={actions:O.global_actions,app_socket_id:O.app_socket_id}}}}}D.incontext_global_actions=D.viewData.global_actions;if(q.is(I.itemViewClickHandler)){D.itemViewClickHandler=I.itemViewClickHandler}else{if(q.is(O)&&q.is(O.itemViewClickHandler)&&O.itemViewClickHandler.trim().length>0){D.itemViewClickHandler=O.itemViewClickHandler}}if(q.is(I.source)){D.source=I.source}else{if(q.is(O)&&q.is(O.source)){if(q.is(O.source,"array")){D.source=O.source}else{if(q.is(O.source,"string")){D.source=[O.source]}}}}if(q.is(I.search_mode)){D.search_mode=I.search_mode}else{D.search_mode="index"}}D.tag_filter=I.tag_filter;if(q.is(K.result_ux_customization)){D.result_ux_customization=K.result_ux_customization}var V=a.SEARCH_APP_ID;if(k.getOption("noAppId")===true&&Q){var R="",Q=true;if(q.is(k.options.search_settings.widget_server_url,"string")){R=decodeURIComponent(k.options.search_settings.widget_server_url);Q=false}else{R=N._resourcesMgt.getFedSearchUrl()+"/webapps"}var T=/\/$/;R=R.replace(T,"");R=R+"/SNResultUX/SearchResult_Wdg.htm";V=R}N.log("Widget App Id: "+V);N._wdg_ready=false;if(k.getOption("pcs_analysis")===true){w.info("Launch widget at: "+Date.now())}var H=function(){p.login({resources:N._resourcesMgt,onComplete:function(){},onFailure:function(){w.log("login for helper search FAILED")}});require(["DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper"],function(aa,Z,ab){var ac=function(){if(I&&I.advanced_search&&I.advanced_search.showByDefault){if(I.advanced_search.searchOnInit){I.value=I.advanced_search.default_search_criteria}if(I.advanced_search["ds6w:type"]){var af="";var ag=I.advanced_search["ds6w:type"];ag.forEach(function(ai){var aj=ai.uri.split(":");if(af.length>0){af=af+" OR "}af=af+'flattenedtaxonomies:"types/'+aj[aj.length-1]+'"'});if(af.length>0){if(q.is(I.value,"string")&&I.value.length>0){I.value=I.value+" AND  ("+af+")"}else{I.value=af}}}}if(I&&q.is(I.value,"string")&&I.value.length>0){var ad=I.value;if(ad!==a.SearchTypeEnum.ADVANCED_SEARCH&&J){var ae=q.is(I.inCtx_widget_id);if(!ae){ad=Z.manageWildcardAddtion(ad)}r.setResources({resources:N._resourcesMgt});var ah=new aa(null,{event:{onSetup:function(am){am._isAHelper=true;am.setSearchRessources(N._resourcesMgt);var al={query:ad,mode:D.search_mode,source:q.is(D.source)?D.source:[],refine:I.refine,originalSearchCriteria:I.searchStringToDisplayInSearchField};if(!q.is(al.source)||al.source.length<1){var ai=N.getOption("searchParams");if(q.is(ai)){if(q.is(ai.source,"array")){al.source=ai.source}else{if(q.is(ai.getSources,"function")){var an=N.options.searchParams.getSources();if(q.is(an,"array")){al.source=an}}}}}if(!ae){var aj=ab.getGlobalSearchTypeCustoQuery(ad);if(q.is(aj)){a.addSourceSpecificParameter(al,{sourceIds:["3dspace"],param:{id:"additional_query",value:aj}})}}if(q.is(D.customization_options)){am._ctx_options=D.customization_options}am.setRequestCriteria("fed_search",al,ae);if(I.viewData&&I.viewData.SearchColumnCustoDefinition&&I.viewData.SearchColumnCustoDefinition.viewDefinition){var ak=[];I.viewData.SearchColumnCustoDefinition.viewDefinition.forEach(function(ao){ak.push(ao.uri)});am.setAttributesToRetrieve(ak)}}}});a.setHelperCollection(a.TRANSIENT_WIDGET_HELPER_ID,ah);ah.getFirstPageOfResults({reset:true,onComplete:function(){ah._currentState=a.HelperCollectionStatus.SEARCH_SUCCEEDED;N.log("helper search succeeded");if(q.is(ah._CBOnComplete,"function")){N.log("launching _CBOnComplete");ah._CBOnComplete.apply(ah,arguments)}},onFailure:function(aj,ai){ah._currentState=a.HelperCollectionStatus.SEARCH_FAILED;N.log("helper search failed");if(q.is(ah._CBOnFailure,"function")){N.log("launching _CBOnFailure");ah._CBOnFailure.apply(ah,arguments)}else{ah.fedSearch_error=ai}}});N.log("helper search launched");ah._currentState=a.HelperCollectionStatus.SEARCH_IN_PROGRESS}}};if(I&&q.is(I.value,"string")&&I.value.indexOf(":")>0){o.getPQFetchPromise().then(ac)}else{ac.call()}})};if(N._SWFilteringCheckDone===false){require(["DS/SWXWebPlatformSearchApi/SWXWebSearchFilterApi"],function(Z){Z.isSWFilteringON(function(aa){N._SWFilteringCheckDone=true;N.log("call of isSWFilteringON DONE");if(q.is(aa)){if(aa.swxRole){N.log("SWFiltering is ON");s.setAdditionalQueryCriteria(aa.contract.query);s.setSelectPredicates(aa.contract.select_predicate);s.setSelectExcludeSynthesis(aa.contract.select_exclude_synthesis)}else{N.log("SWFiltering is OFF")}}H.call()})},function(Z){N._SWFilteringCheckDone=true;w.warn("ERROR: failed to load DS/SWXWebPlatformSearchApi/SWXWebSearchFilterApi");if(q.is(Z)){w.warn("ERROR: "+Z.message)}H.call()})}else{H.call()}if(A===false){Y.call()}if(N._topframe_search_delegation){N.options.searchParams.open.call(undefined,{app_id:V,widget_title:B,preferences_wdg:D})}else{if(q.is(N._topFrame)&&A===true){var C={fit:true,appId:V,data:D};N._topFrame._visibleXApp="search";N._topFrame.openPanel("right",C).then(function(){Y.call();N._topFrame._onRightPanelStateChange("fitted")});N._firstInit=true}else{require(["DS/TransientWidget/TransientWidget"],function(Z){D.x3dPlatformId=D.search_ressources.active_tenant;Z.showWidget(V,B,D)})}}}}},_isWidgetReadyToLaunch:function(){return this._wdg_ready},_updateTenantFromIncontextOptions:function(A){if(q.is(A)){if(q.is(A.tenant)){try{this._resourcesMgt.setActiveTenant(A.tenant)}catch(C){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+A.tenant+")")}}else{if(q.is(A.inCtx_widget_id,"string")){var B=this._ctx_search.getInContextOptions(A.inCtx_widget_id);if(q.is(B)&&q.is(B.tenant)){try{this._resourcesMgt.setActiveTenant(B.tenant)}catch(C){w.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+B.tenant+")")}}else{var z=this._resourcesMgt.getAvailableTenants();if(z.length===1){this._resourcesMgt.setActiveTenant(z[0].tenantId)}}}}}},getAddinMode:function(){var A;var z=this.getOption("addinMode");if(q.is(z,"object")){A=z.value}return A},_isWidgetMaximized:function(A,z){if(q.Widgets){var C=t.getItem("integratedSearch");var B=q.Widgets.instances.filter(function(D){if(C===false){if(q.is(D,"object")&&D.getView().type==="maximized"&&((D.id===A&&D.context===z)||D.getValue("search_wdg_id")===A)){return true}else{return false}}else{if(q.is(D,"object")&&(D.getView().type==="maximized"||D.getView().type==="sidepanel")&&((D.id===A&&D.context===z)||D.getValue("search_wdg_id")===A)){if(q.is(D.getValue("appId")===a.SEARCH_APP_ID)){D.context=z}return true}else{return false}}})}return(B&&B.length)?true:false}});return l});define("DS/SNSearchUX/SearchAutocomplete",["UWA/Core","UWA/Element","UWA/Event","DS/SNSearchUX/Autocomplete_ToMigrate","DS/MessageBus/MessageBus","require","css!DS/SNSearchUX/SNSearchUX.css","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/PlatformAPI/PlatformAPI","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","UWA/Promise","DS/UIKIT/Input/Toggle","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(UWACore,Element,Event,Autocomplete,MessageBus,localRequire,cssSearchAutocomplete,SearchRessources,SearchPreferences,SearchSettings,SearchUtils,PlatformAPI,SNSearchTypeCusto,PredicatesNLS,SearchLogin,Promise,UIKITToggle,nlsKeys){var bMultiTenant=false,sActiveTenant="";var SearchAutocomplete=Autocomplete.extend({_clearSearch:null,_autocompleteSuggests:null,_timeoutId:null,_suggestTimeout:null,_secondTimeoutId:null,_inAppContext:false,_temporarilyOutOfContext:false,_inContextOptions:null,_previouslyActiveSource:null,_enable_search:true,_srchChoice:null,_srchChoiceA:null,_enable_similar_search:true,_SimilarSearchChoice:null,_SimilarSearchChoiceA:null,_SimilarSearchIsActive:false,_SimilarCurrentSelectedPhysicalId:null,_enable_advanced_search:true,_AdvSearchChoice:null,_AdvSearchChoiceA:null,_enable_search_in_this_tab:true,_sitChoice:null,_sitChoiceA:null,_findInTabNLS:null,_enable_my_content:true,_myContentChoice:null,_myContentChoiceA:null,_myRecentContentChoice:null,_myRecentContentChoiceA:null,_myRecentContentIsActive:false,_enable_tenant_selection:true,_cstoreChoice:[],_cstoreChoiceA:[],_cstoreSources:[],_src_ressource:null,_adv_Search_activated:false,_searchStringToDisplayInSearchField:null,_internalSearchCriteria:null,_isTypeListMode:false,_isTypeListDone:false,_isTypeValue:null,_typeList:[],_easyTypeListUI:[],_easyTypeSelect:false,_otherLastBlockListUI:[],_LastSearchResults:null,_pqSelect:false,_enable_Last_Searches:true,_enable_PredefinedQuery:true,_predefinedQuery:null,_enable_FavoriteSearches:true,_suggestionsInPipeline:0,_cancel_suggest_update:false,_AsyncSearchDropdownPromise:Promise.deferred(),_searchResourcesSet:Promise.deferred(),_suggestPreviousQueries:function(autocomplete,value){var storedSearches=null;var actualSuggestions=null;if(this._typeList.length===0){this._typeList=SNSearchTypeCusto.getSearchTypeCustoList()}this._isTypeListMode=false;this._value=value;if((this._typeList.length)&&(value.length===0)){storedSearches=this._typeList;this._isTypeListMode=true}if(UWACore.is(localStorage.SNSearchBoxStore)){storedSearches=JSON.parse(localStorage.SNSearchBoxStore);var filteredSuggestions=[];if(!value||value.replace(/\s+/g,"")===""){filteredSuggestions=storedSearches}else{storedSearches.forEach(function(entry){if(entry.indexOf(value)===0&&(entry!==value)){filteredSuggestions.push(entry)}})}actualSuggestions=filteredSuggestions.reverse();if(actualSuggestions.length>4){actualSuggestions=actualSuggestions.slice(0,4)}autocomplete.dispatchEvent("onUpdateSuggests",[actualSuggestions]);autocomplete.dispatchEvent("onShowSuggests");autocomplete.typeTimeout=null}else{autocomplete.dispatchEvent("onUpdateSuggests",[actualSuggestions]);autocomplete.dispatchEvent("onShowSuggests")}this.historySuggestions=actualSuggestions},getServerSuggestions:function(query){var that=this;var options={query:query.replace(/^\s+|\s+$/g,""),input:query.replace(/^\s+|\s+$/g,"").split(" ")};if(!query.length){that.dispatchEvent("onUpdateSuggests",{serverSuggests:[]})}else{if(true===SearchUtils.isSuggestAvailable(sActiveTenant)){var getnShowSuggests=function(){var suggest_length=SearchSettings.getOption("suggest_length");if(((options.query.length)>(suggest_length-1))&&(!(UWACore.is(that._inContextOptions)))&&(that.elements.input.placeholder===that._getPlaceHolderTextDependingOnActiveTenant("search"))){that._suggestionsInPipeline++;that._src_ressource.getSuggestions(options,function(suggestions){that._suggestionsInPipeline--;suggestions=suggestions||[];var actualSuggestions=suggestions.map(function(sug){return{label:sug.entry,command:sug.entry,icon:"lightbulb"}});if(!that._cancel_suggest_update){if(actualSuggestions.length>0&&(that._suggestionsInPipeline===0)){that.dispatchEvent("onUpdateSuggests",{serverSuggests:actualSuggestions})}}})}};this.getSearchResources().then(function(){SearchLogin.login({resources:that._src_ressource,onComplete:function(){getnShowSuggests()},onFailure:function(){}})})}}},getSearchResources:function(){var that=this;return that._searchResourcesSet.promise},_buildSearchChoice:function(options){var allSources=options.sources;var that=this;MessageBus.subscribe({channel:"TopBar_Suggest",topic:"CancelSuggest",callback:function(){that._cancel_suggest_update=true}});var elements=this.elements;this.elements.container.addEvent("drop",function(ev){var list=null;var isIE=
/*@cc_on!@*/
false||!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;var Ms=isIE||isEdge;if(!Ms&&ev.dataTransfer.getData("shortData")!==""){ev.preventDefault();list=JSON.parse(ev.dataTransfer.getData("shortData"))}else{if(ev.dataTransfer.getData("text")!==""){var dragData=JSON.parse(ev.dataTransfer.getData("text"));list=[];dragData.data.items.forEach(function(obj){list.push('"'+obj.displayName+'"')})}}ev.target.value=list.join(" OR ");ev.stopPropagation();ev.preventDefault()});this.elements.container.addEvent("paste",function(ev){if(that.elements.input.placeholder!==that._getPlaceHolderTextDependingOnActiveTenant("search")){return}var nonSelectedChars=0;if(UWACore.is(ev.target)&&UWACore.is(ev.target.selectionStart)&&UWACore.is(ev.target.selectionEnd)){nonSelectedChars=ev.target.value.length-(ev.target.selectionEnd-ev.target.selectionStart)}if(0===nonSelectedChars&&UWACore.is(ev)){var pastedTxt=null;if(UWACore.is(ev.clipboardData)&&UWACore.is(ev.clipboardData.getData,"function")){pastedTxt=ev.clipboardData.getData("text/plain");that.getServerSuggestions(pastedTxt)}else{if(UWACore.is(window.clipboardData)&&UWACore.is(window.clipboardData.getData,"function")){pastedTxt=window.clipboardData.getData("Text");that.getServerSuggestions(pastedTxt)}}var stringToEnterInSearchField="";if(UWACore.is(pastedTxt,"string")&&pastedTxt.length>0){var bContainsTab=pastedTxt.indexOf("\t")>=0,bContainsCR=pastedTxt.indexOf("\n")>=0,bContainsDoublePipe=pastedTxt.indexOf("||")>=0,bContainsDoubleAnd=pastedTxt.indexOf("&&")>=0,bContainsEscapedAnd=pastedTxt.indexOf("\\&&")>=0,bContainsEscapedPipe=pastedTxt.indexOf("\\||")>=0;if(false===bContainsTab&&false===bContainsCR&&false===bContainsDoublePipe&&false===bContainsDoubleAnd){that._showClearSearchBtn();return}var listLines=pastedTxt.split("\n"),lineToSplit="",firstLineAdded=false;if(UWACore.is(listLines,"array")&&listLines.length>0){for(var i=0,nb=listLines.length;i<nb;i++){if(UWACore.is(listLines[i],"string")){listLines[i]=listLines[i].trim();if(listLines[i].length>0){lineToSplit=listLines[i];var listVal=null,operatorStr="AND";bContainsTab=lineToSplit.indexOf("\t")>=0;bContainsDoublePipe=lineToSplit.indexOf("||")>=0;bContainsDoubleAnd=lineToSplit.indexOf("&&")>=0;bContainsEscapedAnd=lineToSplit.indexOf("\\&&")>=0;bContainsEscapedPipe=lineToSplit.indexOf("\\||")>=0;if(true===bContainsEscapedAnd){lineToSplit=lineToSplit.replace(/\\\&/g,"##__##")}if(true===bContainsEscapedPipe){lineToSplit=lineToSplit.replace(/\\\|/g,"__##__")}if(true===bContainsTab){listVal=lineToSplit.split("\t")}else{if(true===bContainsDoubleAnd){listVal=lineToSplit.split("&&")}else{if(true===bContainsDoublePipe){listVal=lineToSplit.split("||");operatorStr="OR"}else{listVal=[lineToSplit]}}}var lineString="";for(var iVal=0,nbVal=listVal.length;iVal<nbVal;iVal++){if(UWACore.is(listVal[iVal],"string")){listVal[iVal].trim();if(listVal[iVal].length>0){if(true===bContainsEscapedAnd){listVal[iVal]=listVal[iVal].replace(/##__##/g,"&")}if(true===bContainsEscapedPipe){listVal[iVal]=listVal[iVal].replace(/__##__/g,"|")}if(lineString.length>0){lineString+=" "+operatorStr+" "}if(listVal[iVal].length>1&&listVal[iVal][0]==='"'&&listVal[iVal][listVal[iVal].length-1]==='"'){listVal[iVal]=listVal[iVal].substr(1,listVal[iVal].length-2)}listVal[iVal]=listVal[iVal].replace(/\\([\s\S])|(")/g,"\\$1$2");lineString+='"'+listVal[iVal]+'"'}}}if(lineString.length>0){if(true===firstLineAdded){stringToEnterInSearchField+=" OR "}if(nb>1){stringToEnterInSearchField+="("}stringToEnterInSearchField+=lineString;if(nb>1){stringToEnterInSearchField+=")"}firstLineAdded=true}}}}ev.target.value=stringToEnterInSearchField;if(stringToEnterInSearchField.length>0){that._showClearSearchBtn()}ev.stopPropagation();ev.preventDefault()}}}});if(!UWACore.is(allSources)){allSources=this.options.allSources}if(!UWACore.is(allSources,"object")){throw new Error("Invalid value for allSources in SearchAutocomplete._buildSearchChoice!")}allSources.loadPredicates=true;this._src_ressource=new SearchRessources(allSources);this._searchResourcesSet.resolve();this._cstoreSources=this._src_ressource.getAvailableTenants();elements.predefinedSearches=UWACore.createElement("ul",{"class":"predefined-searches",id:"search-combo-predefined-searches","data-rec-id":"search-combo-predefined-searches"}).inject(elements.suggestsContainer);if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_last_searches)){this._enable_Last_Searches=options.searchParams.enable_last_searches}if(this._enable_Last_Searches){var tooltipStrLastSearchResults=nlsKeys.get("LastSearchResults.shortHelp");var attributesObjLastSearchResults={};if(UWACore.is(tooltipStrLastSearchResults,"string")&&tooltipStrLastSearchResults.length>0){attributesObjLastSearchResults.title=tooltipStrLastSearchResults}this._LastSearchResults=UWACore.createElement("div",{id:"search-combo-search-recent",attributes:attributesObjLastSearchResults,"data-rec-id":"search-combo-search-recent"});var LastSearchResultsIcon=UWACore.createElement("span",{"class":"fonticon fonticon-search-recent"}).inject(this._LastSearchResults);var lastSearchResultsA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._LastSearchResults);lastSearchResultsA.setHTML(nlsKeys.get("LastSearchResults"));this._LastSearchResults.inject(elements.predefinedSearches);this._LastSearchResults.addEvent("click",function(){that._setFieldValue("");that._hideClearSearchBtn();that._deactivateOtherLastBlockList();that.dispatchEvent("onSelect",["","LastSearch"]);var noFocus={focus:false};that._clickOnChoiceSearch(noFocus)});this.hideLastSearch()}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_favorite_searches)){this._enable_FavoriteSearches=options.searchParams.enable_favorite_searches;SearchSettings.options.search_settings.global_action_save_search=(options.searchParams.enable_favorite_searches===true)}if(this._enable_FavoriteSearches===true){if(UWACore.is(SearchSettings.getOption("search_compact_mode"))&&SearchSettings.getOption("search_compact_mode")===true){this._enable_FavoriteSearches=false}}if(this._enable_FavoriteSearches){var tooltipStrMySavedSearches=nlsKeys.get("MySavedSearches.shortHelp");var attributesObjMySavedSearches={};if(UWACore.is(tooltipStrMySavedSearches,"string")&&tooltipStrMySavedSearches.length>0){attributesObjMySavedSearches.title=tooltipStrMySavedSearches}this._FavoriteSearches=UWACore.createElement("div",{id:"search-combo-favorite-searches",attributes:attributesObjMySavedSearches,"data-rec-id":"search-combo-favorite-searches"}).hide();var FavoriteSearchesIcone=UWACore.createElement("span",{"class":"fonticon fonticon-favorite-on"}).inject(this._FavoriteSearches);this._FavoriteSearchesA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._FavoriteSearches);this._FavoriteSearchesA.setHTML(nlsKeys.get("MySavedSearches"));this._FavoriteSearchesA.getParent().removeClassName("selected");this._FavoriteSearches.inject(elements.predefinedSearches);this._otherLastBlockListUI.push(this._FavoriteSearchesA);this._FavoriteSearches.addEvent("click",that._clickOnChoiceFavoriteSearches.bind(this))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_my_content)){this._enable_my_content=options.searchParams.enable_my_content}if(this._enable_my_content){var tooltipStrmycontent=nlsKeys.get("mycontent.shortHelp");var attributesObjmycontent={};if(UWACore.is(tooltipStrmycontent,"string")&&tooltipStrmycontent.length>0){attributesObjmycontent.title=tooltipStrmycontent}this._myContentChoice=UWACore.createElement("div",{id:"search-combo-search-my-content",attributes:attributesObjmycontent,"data-rec-id":"search-combo-search-my-content"});this._myContentChoiceAIcone=UWACore.createElement("span",{"class":"fonticon fonticon-user"}).inject(this._myContentChoice);this._myContentChoiceA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._myContentChoice);this._myContentChoiceA.setHTML(nlsKeys.get("mycontent"));this._myContentChoiceA.getParent().removeClassName("selected");this._myContentChoice.inject(elements.predefinedSearches);this._otherLastBlockListUI.push(this._myContentChoiceA);this._myContentChoice.addEvent("click",that._clickOnChoiceMyContent.bind(this))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_search)){this._enable_search=options.searchParams.enable_search}if(this._enable_search){elements.searchChoice=UWACore.createElement("ul",{"class":"search-choice",id:"search-combo-how-to-search","data-rec-id":"search-combo-how-to-search"}).inject(elements.suggestsContainer);this.howToSearchHeader=UWACore.createElement("div",{}).inject(elements.searchChoice);this.howToSearchHeader.setStyle("height","26px");this.howToSearchHeader.setStyle("border-left","0px");this.howToSearchHeader.setStyle("padding-left","0px");this.ChoiceA=UWACore.createElement("a",{"class":"choice-title"}).inject(this.howToSearchHeader);this.ChoiceA.setHTML(nlsKeys.get("Howtosearch"));var FD02=SearchSettings.getOption("newSearch19xFD02");var betaEnabled=SearchSettings.getOption("predefinedBetaUser");if(true===FD02&&betaEnabled){this.ChoiceX=UWACore.createElement("div",{"class":"beta-toggle"}).inject(this.howToSearchHeader);var betaStatus=SearchUtils.isInTheSimpleSearch();if(betaStatus){this.ChoiceX.addClassName("beta-active")}else{this.ChoiceX.removeClassName("beta-active")}this.ChoiceX.setStyle("right","0");this._betaToggler=new UIKITToggle({type:"switch",name:"3DSearch-beta-toggler",checked:betaStatus,label:nlsKeys.get("search-beta"),events:{onChange:function(){require(["DS/UIKIT/SuperModal"],function(SuperModal){var isBetaBeingActivated=that._betaToggler.isChecked();var okButtonText=nlsKeys.get("beta_activation_ok_title");var betaMessage=nlsKeys.get("beta_activation_msg1")+nlsKeys.get("beta_activation_msg2")+nlsKeys.get("beta_pagereload_msg");var betaDialogTitle=nlsKeys.get("beta_dialog_title");if(!isBetaBeingActivated){okButtonText=nlsKeys.get("beta_deactivation_ok_title");betaMessage=nlsKeys.get("beta_deactivation_msg1")+nlsKeys.get("beta_deactivation_msg2")+nlsKeys.get("beta_pagereload_msg")}var onUserAction=function(okPressed){if(true===okPressed){var newSSEFlag=that._betaToggler.isChecked();SearchPreferences.setItem("simple_search_experience",newSSEFlag);SearchPreferences.removeItem("LastSearchViewMode");SearchPreferences.removeItem("LastInAppsSearchViewMode");SearchPreferences.commit({onComplete:function(){location.reload()},onFailure:function(){console.warn("SearchPreferences.commit FAILED")}})}else{that._betaToggler.setCheck(SearchUtils.isInTheSimpleSearch())}};if(true===SearchSettings.getOption("warnUserForBetaActivation")){var warning=new SuperModal({renderTo:document.body,className:"betaWarning",closable:false});warning.dialog({body:betaMessage,title:betaDialogTitle,buttons:[{className:"primary",value:okButtonText,action:function(modal){onUserAction(true);modal.hide()}},{value:nlsKeys.get("beta_cancel_title"),action:function(modal){onUserAction(false);modal.hide()}}]})}else{onUserAction(true)}})}}}).inject(this.ChoiceX)}var tooltipStr=nlsKeys.get("search.shortHelp");var attributesObj={};if(UWACore.is(tooltipStr,"string")&&tooltipStr.length>0){attributesObj.title=tooltipStr}this._srchChoice=UWACore.createElement("div",{id:"search-combo-search-item",attributes:attributesObj,"data-rec-id":"search-combo-search-icon"});this._srchChoiceAIcone=UWACore.createElement("span",{"class":"fonticon fonticon-search",id:"search-combo-search-icon"}).inject(this._srchChoice);this._srchChoiceA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._srchChoice);this._srchChoiceA.setHTML(nlsKeys.get("search"));this._srchChoiceA.getParent().addClassName("selected");if(UWACore.is(this._cstoreSources,"array")&&this._cstoreSources.length>0){sActiveTenant=this._cstoreSources[0].tenantId}this._srchChoice.inject(elements.searchChoice);this._srchChoice.addEvent("click",this._clickOnChoiceSearch.bind(this));this._srchChoice.addEvent("click",this._findInthisTabOnClick.bind(this,false))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_similar_search)){this._enable_similar_search=options.searchParams.enable_similar_search}if(this._enable_similar_search){var tooltipStrsimilar_search=nlsKeys.get("similar_search.shortHelp");var attributesObjsimilar_search={};if(UWACore.is(tooltipStrsimilar_search,"string")&&tooltipStrsimilar_search.length>0){attributesObjsimilar_search.title=tooltipStrsimilar_search}this._SimilarSearchChoice=UWACore.createElement("div",{id:"search-combo-search-similar",attributes:attributesObjsimilar_search,"data-rec-id":"search-combo-search-similar"}).hide();this._SimilarSearchChoiceAIcone=UWACore.createElement("span",{"class":"fonticon fonticon-search-similar"}).inject(this._SimilarSearchChoice);this._SimilarSearchChoiceA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._SimilarSearchChoice);this._SimilarSearchChoiceA.setHTML(nlsKeys.get("similar_search"));this._SimilarSearchChoiceA.getParent().removeClassName("selected");this._SimilarSearchChoice.inject(elements.searchChoice);this._SimilarSearchChoice.addEvent("click",this._clickOnChoiceSimilarSearch.bind(this));PlatformAPI.subscribe("DS/PADUtils/PADCommandProxy/select",this._selectPartForSimilarSearch.bind(this));if(UWA.debug){that._SimilarSearchChoice.show()}else{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(compass){compass.getServiceUrl({serviceName:"OnePart",platformId:(UWACore.is(that._cstoreSources,"array")&&that._cstoreSources.length>0)?that._cstoreSources[0].tenantId:"ErrorNoTenant",onComplete:function(url){if(typeof url==="string"&&url!==""||url&&url[0]!==""){that._SimilarSearchChoice.show()}},onFailure:function(){console.error("getServiceUrl failure!")}})})}}this._findInTabNLS=nlsKeys.get("find_in_tab");if(UWACore.is(options.searchParams)){if(UWACore.is(options.searchParams.enable_search_in_this_tab)){this._enable_search_in_this_tab=options.searchParams.enable_search_in_this_tab}if(UWACore.is(options.searchParams.enable_search_in_this_tab)){this._findInTabNLS=options.searchParams.filter_nls}}if(this._enable_search_in_this_tab){var tooltipStrfind_in_tab=nlsKeys.get("find_in_tab.shortHelp");var attributesObjfind_in_tab={};if(UWACore.is(tooltipStrfind_in_tab,"string")&&tooltipStrfind_in_tab.length>0){attributesObjfind_in_tab.title=tooltipStrfind_in_tab}this._sitChoice=UWACore.createElement("div",{id:"search-combo-find-in-tab","data-rec-id":"search-combo-find-in-tab",attributes:attributesObjfind_in_tab});this._sitChoiceAIcone=UWACore.createElement("span",{"class":"fonticon fonticon-filter"}).inject(this._sitChoice);this._sitChoiceA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._sitChoice);this._sitChoiceA.setHTML(this._findInTabNLS);this._sitChoiceA.getParent().removeClassName("selected");this._sitChoice.inject(elements.searchChoice);this._sitChoice.addEvent("click",this._clickOnChoiceFindInTabOrApp.bind(this));this._sitChoice.addEvent("click",this._findInthisTabOnClick.bind(this,true))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_advanced_search)){this._enable_advanced_search=options.searchParams.enable_advanced_search}if(SearchUtils.isInTheSimpleSearch({tenant:allSources.active_tenant})===true){this._enable_advanced_search=false}if(UWACore.is(SearchSettings.getOption("NoadvOnMenu"))&&SearchSettings.getOption("NoadvOnMenu")===false){this._enable_advanced_search=true}if(this._enable_advanced_search){var tooltipStradv_search=nlsKeys.get("adv_search.shortHelp");var attributesObjadv_search={};if(UWACore.is(tooltipStradv_search,"string")&&tooltipStradv_search.length>0){attributesObjadv_search.title=tooltipStradv_search}this._AdvSearchChoice=UWACore.createElement("div",{id:"search-combo-advance-search",attributes:attributesObjadv_search,"data-rec-id":"search-combo-advance-search"}).hide();this._AdvSearchChoiceIcone=UWACore.createElement("span",{"class":"fonticon fonticon-search-cog"}).inject(this._AdvSearchChoice);this._AdvSearchChoiceA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._AdvSearchChoice);this._AdvSearchChoiceA.setHTML(nlsKeys.get("adv_search"));this._AdvSearchChoiceA.getParent().removeClassName("selected");this._AdvSearchChoice.inject(elements.searchChoice);this._AdvSearchChoice.addEvent("click",that._clickOnChoiceAdvancedSearch.bind(this))}if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_tenant_selection)){this._enable_tenant_selection=options.searchParams.enable_tenant_selection}if(this._cstoreSources.length>1){elements.tenantChoice=UWACore.createElement("ul",{"class":"tenant-choice"}).inject(elements.suggestsContainer);var bExpandMode=SearchPreferences.getItem("LastExpandModeForTenantList");if(!UWACore.is(bExpandMode)){bExpandMode=true}var iconTenantExpander=UWACore.createElement("span",{"class":"expander-icon"}).inject(elements.tenantChoice);iconTenantExpander.addClassName(bExpandMode===true?"fonticon fonticon-expand-up":"fonticon fonticon-expand-down");iconTenantExpander.setStyle("position","absolute");iconTenantExpander.setStyle("display","block");iconTenantExpander.setStyle("right","10px");iconTenantExpander.setStyle("line-height","26px");iconTenantExpander.setStyle("height","26px");iconTenantExpander.setStyle("pointer-events","none");this.ChoiceT=UWACore.createElement("a",{"class":"choice-title"}).inject(elements.tenantChoice);this.ChoiceT.setHTML(nlsKeys.get("Wheretosearch"));this.ChoiceT.bExpandMode=bExpandMode;this.ChoiceT.addEvent("mousedown",function(){that.preventBlur=true});this.ChoiceT.addEvent("mouseup",function(){that.preventBlur=false});this.ChoiceT.addEvent("click",function(item){item.currentTarget.bExpandMode=!item.currentTarget.bExpandMode;if(item.currentTarget.bExpandMode===true){iconTenantExpander.removeClassName("fonticon fonticon-expand-down");iconTenantExpander.addClassName("fonticon fonticon-expand-up")}else{iconTenantExpander.removeClassName("fonticon fonticon-expand-up");iconTenantExpander.addClassName("fonticon fonticon-expand-down")}SearchPreferences.setItem("LastExpandModeForTenantList",item.currentTarget.bExpandMode);SearchPreferences.commit();for(var i=0;i<that._cstoreChoice.length;i++){var text=that._cstoreChoice[i];if(item.currentTarget.bExpandMode===false){text.hide()}else{if(that._inAppContext){var selected_incontext_tenant=that._inContextOptions.tenant?that._inContextOptions.tenant===that._cstoreSources[i].tenantId:true;if(selected_incontext_tenant){text.show()}}else{text.show()}}}this.elements.input.focus()});if(false===this._enable_tenant_selection){elements.tenantChoice.hide()}bMultiTenant=true;for(var src=0;src<this._cstoreSources.length;src++){var tenantId=this._cstoreSources[src].tenantId;var tenantNLS=this._cstoreSources[src].displayName;this._cstoreChoice.push(UWACore.createElement("div"));this._cstoreChoiceA.push(UWACore.createElement("a",{"class":"search-combo-item search-combo-tenant-item","tenant-id":tenantId}).inject(this._cstoreChoice[src]));if(tenantId===this._src_ressource.active_tenant){that._setPlaceHolderValue(nlsKeys.replace(nlsKeys.get("search_in_active"),{tenant:tenantNLS}));this._cstoreChoiceA[src].getParent().addClassName("active");sActiveTenant=tenantId}var sNLSTenantMsg=UWACore.is(nlsKeys.tenant)?nlsKeys.replace(nlsKeys.get("tenant"),{tenant:tenantNLS}):tenantNLS;this._cstoreChoiceA[src].setHTML(sNLSTenantMsg);this._cstoreChoiceA[src].tenantId=tenantId;this._cstoreChoiceA[src].displayName=tenantNLS;this._cstoreChoice[src].inject(elements.tenantChoice);this._cstoreChoice[src].addEvent("click",this._clickOnChoiceSearchInTenant.bind(this,this._cstoreChoiceA[src]));this._cstoreChoice[src].addEvent("mousedown",function(){that.preventBlur=true});this._cstoreChoice[src].addEvent("mouseup",function(){that.preventBlur=false})}for(var i=0;i<that._cstoreChoice.length;i++){var text=that._cstoreChoice[i];if(bExpandMode===false){text.hide()}else{text.show()}}}var actualTypeSuggestions;if(this._typeList.length===0){this._typeList=SNSearchTypeCusto.getSearchTypeCustoList();actualTypeSuggestions=this._typeList;if(actualTypeSuggestions.length>7){actualTypeSuggestions=actualTypeSuggestions.slice(0,7)}}if(Array.isArray(actualTypeSuggestions)&&actualTypeSuggestions.length!==0){elements.TypeSuggestions=UWACore.createElement("ul",{"class":"what-choice"}).inject(elements.suggestsContainer);var iconDown=UWACore.createElement("span",{"class":"expander-icon fonticon fonticon-expand-up"}).inject(elements.TypeSuggestions);iconDown.setStyle("position","absolute");iconDown.setStyle("display","block");iconDown.setStyle("right","10px");iconDown.setStyle("line-height","26px");iconDown.setStyle("height","26px");iconDown.setStyle("pointer-events","none");this.ChoiceT=UWACore.createElement("a",{"class":"choice-title"}).inject(elements.TypeSuggestions);this.ChoiceT.setHTML(nlsKeys.get("Whattosearch"));this.ChoiceT.tpc=0;this.ChoiceT.addEvent("click",function(item){var hide=0;if(item.currentTarget.tpc===1){iconDown.removeClassName("fonticon fonticon-expand-down");item.currentTarget.tpc=0;iconDown.addClassName("fonticon fonticon-expand-up")}else{iconDown.removeClassName("fonticon fonticon-expand-up");item.currentTarget.tpc=1;iconDown.addClassName("fonticon fonticon-expand-down");hide=1}for(var i=0;i<that._easyTypeListUI.length;i++){var text=that._easyTypeListUI[i];if(hide===1){text.hide()}else{text.show()}}});var itemLi,itemDiv,itemIcon,itemA;PredicatesNLS.setResources({resources:this._src_ressource});var Option={};Option.onComplete=function(nlsresults){actualTypeSuggestions.forEach(function(item){var Obj=nlsresults[item];var suggestString=that.getFormattedSuggest(Obj.nlsName);itemDiv=UWACore.createElement("div");itemDiv.addClassName("whattosearch");itemIcon=UWACore.createElement("img").inject(itemDiv);itemA=UWACore.createElement("a").inject(itemDiv);itemA.setText(suggestString);itemA.getParent().removeClassName("selected");itemDiv.inject(elements.TypeSuggestions);that._easyTypeListUI.push(itemA);itemDiv.addEvent("click",function(itemDiv){var value=itemDiv;that._deactivateEasyTypeSearch(item);that.dispatchEvent("onSelect",[value,itemDiv,"AdvSearch"])}.bind(that,item))}.bind(that))};SNSearchTypeCusto.getSearchTypeCustoListNLSNames(Option)}elements.helpContent=UWACore.createElement("ul",{"class":"help-container",id:"search-combo-help-container","data-rec-id":"search-combo-help-container"}).inject(elements.suggestsContainer);if(UWACore.is(options.searchParams)&&UWACore.is(options.searchParams.enable_predefined_query)){this._enable_PredefinedQuery=options.searchParams.enable_predefined_query}if(SearchUtils.isInTheSimpleSearch({tenant:allSources.active_tenant})===true){this._enable_PredefinedQuery=false}if(UWACore.is(SearchSettings.getOption("NoPQMenu"))&&SearchSettings.getOption("NoPQMenu")===false){this._enable_PredefinedQuery=true}if(this._enable_PredefinedQuery){var tooltipStrPQ=nlsKeys.get("PredefinedQuery.shortHelp");var attributesObjPQ={};if(UWACore.is(tooltipStrPQ,"string")&&tooltipStrPQ.length>0){attributesObjPQ.title=tooltipStrPQ}this._predefinedQuery=UWACore.createElement("div",{id:"search-combo-pq-help",attributes:attributesObjPQ,"data-rec-id":"search-combo-pq-help"}).hide();var PredefinedQueryIcone=UWACore.createElement("span",{"class":"fonticon fonticon-help"}).inject(this._predefinedQuery);var PredefinedQueryA=UWACore.createElement("a",{"class":"search-combo-item"}).inject(this._predefinedQuery);PredefinedQueryA.setHTML(nlsKeys.get("PredefinedQuery"));PredefinedQueryA.getParent().removeClassName("selected");this._predefinedQuery.inject(elements.helpContent);this._otherLastBlockListUI.push(PredefinedQueryA);this._predefinedQuery.addEvent("click",function(PredefinedQueryA){that._setFieldValue("");that._showPQSelectionUX();that._deactivateOtherLastBlockList();that._pqSelect=true})}this._myRecentContentChoice=UWACore.createElement("div");this._myRecentContentChoiceA=UWACore.createElement("a").inject(this._myRecentContentChoice);this._myRecentContentChoiceA.setHTML(nlsKeys.get("myrecentcontent"));this._myRecentContentChoiceA.getParent().removeClassName("selected");this._myRecentContentChoice.inject(elements.helpContent);this._myRecentContentChoice.hide();this._myRecentContentChoice.addEvent("click",this._clickOnChoiceMyRecentContent.bind(this));SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){if(UWACore.is(that._AdvSearchChoice)){that._AdvSearchChoice.show()}if(UWACore.is(that._FavoriteSearches)){that._FavoriteSearches.show()}if(UWACore.is(that._predefinedQuery)){that._predefinedQuery.show()}}that._AsyncSearchDropdownPromise.resolve()});localRequire(["DS/SNInfraUX/SearchSettings"],function(SearchSettings){if(true===SearchSettings.getOption("find_in_this_tab_default")){that._clickOnChoiceFindInTabOrApp({focus:false})}});SearchUtils.setAutocompleteRendered()},_clickOnChoiceSearch:function(options){this.showTenantChoice();if(this._typeList.length===0){this._typeList=SNSearchTypeCusto.getSearchTypeCustoList()}if(((this._isTypeListMode)&&(this._isTypeListDone))&&(this._typeList.length)&&(this._typeList.indexOf(options.adv_search_field)!==-1)){this._clickOnChoiceAdvancedSearch(options);this._isTypeListMode=false;this._isTypeListDone=false;return}this._internalSearchCriteria=null;if(this._SimilarSearchIsActive===true){this._setFieldValue("")}this.elements.input.readOnly=false;if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||true===options.focus){this.elements.input.focus()}var placeHolderTxt=this._getPlaceHolderTextDependingOnActiveTenant("search");this._setPlaceHolderValue(placeHolderTxt);if(!UWACore.is(this._srchChoiceA)||!UWACore.is(this._srchChoiceA.getParent,"function")){return}this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateMyContent();this._deactivateSimilarSearch();this._deactivateAdvancedSearch();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}this._deactivateOtherLastBlockList();if(options&&options.resetNLS&&UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(this._findInTabNLS)}if(this._easyTypeSelect===false){this._srchChoiceA.getParent().addClassName("selected")}if(!this._inAppContext){this.showPredefinedQuery()}var valueToSetInSearchField=this.elements.input.value;if(options&&options.resetNLS){valueToSetInSearchField=""}this._setFieldValue(valueToSetInSearchField)},storeAppContext:function(){return function(that,alreadyInappSearch,inContextOptions){var prevActiveTenant=sActiveTenant;return function(options){if(that._inAppContext){if(options&&(!options.in_apps_search||options.in_apps_search.widget_id!==that._inContextOptions.widget_id)){return false}}that.elements.suggestsContainer.getChildren().forEach(function(suggestChild){suggestChild.show()});if(that._cstoreSources.length>1){for(var insrc=0;insrc<that._cstoreSources.length;insrc++){if(that._cstoreChoiceA[insrc].getParent().show){that._cstoreChoiceA[insrc].getParent().show()}if(that._cstoreSources[insrc].tenantId===prevActiveTenant){if(UWACore.is(that._cstoreChoiceA[insrc])){that._cstoreChoiceA[insrc].getParent().addClassName("active")}}else{that._cstoreChoiceA[insrc].getParent().removeClassName("active")}}}if(options&&options.in_apps_search&&options.in_apps_search.advanced_search&&options.in_apps_search.advanced_search.exclusive){that._showSearch()}if(alreadyInappSearch){}else{that.setInAppContext(false);sActiveTenant=prevActiveTenant;that.setBackSearchOrFindInTab({focus:false,noFocus:true})}}}(this,this._inAppContext,this._inContextOptions)},selectTenantOnTabActivation:function(options){if(UWACore.is(options,"object")&&UWACore.is(options.tenant,"string")&&options.tenant.length>0){if(options.tenant==="OnPremise"||false===bMultiTenant){return}sActiveTenant=options.tenant;for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===sActiveTenant){this._cstoreChoiceA[insrc].getParent().addClassName("active")}else{this._cstoreChoiceA[insrc].getParent().removeClassName("active")}}SearchPreferences.setItem("defaultTenantId",sActiveTenant);SearchPreferences.commit();this._updateMenuOnTanantSelection(sActiveTenant)}},_updateMenuOnTanantSelection:function(sActiveTenant){var that=this;SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){if(UWACore.is(that._AdvSearchChoice)){if(that._inAppContext){var hideAdvancedSearch=true;if(that._inContextOptions&&that._inContextOptions.advanced_search){hideAdvancedSearch=false}if(hideAdvancedSearch){that._AdvSearchChoice.hide()}else{that._AdvSearchChoice.show()}}else{that._AdvSearchChoice.show()}}if(UWACore.is(that._FavoriteSearches)){if(that._inAppContext){var hideFavoriteSearches=false;if(that._inContextOptions&&that._inContextOptions.UXOptions&&that._inContextOptions.UXOptions.menuMyFavorites===false){hideFavoriteSearches=true}if(hideFavoriteSearches){that._FavoriteSearches.hide()}else{that._FavoriteSearches.show()}}else{that._FavoriteSearches.show()}}if(that._inAppContext){var hideHelpOnTypeShortcut=true;if(hideHelpOnTypeShortcut){that.hidePredefinedQuery()}}else{that.showPredefinedQuery()}}else{if(UWACore.is(that._AdvSearchChoice)){that._AdvSearchChoice.hide()}if(UWACore.is(that._FavoriteSearches)){that._FavoriteSearches.hide()}that.hidePredefinedQuery()}})},_clickOnChoiceSearchInTenant:function(choiceClicked){if(!UWACore.is(choiceClicked)){throw new Error("E_INVALIDARG: no choiceClicked in _clickOnChoiceSearchInTenant function !")}this._internalSearchCriteria=null;this.elements.input.readOnly=false;var currentId="";if(UWACore.is(choiceClicked,"element")){currentId=choiceClicked.tenantId}else{currentId=choiceClicked}sActiveTenant=currentId;for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===currentId){this._cstoreChoiceA[insrc].getParent().addClassName("active")}else{this._cstoreChoiceA[insrc].getParent().removeClassName("active")}}if(sActiveTenant){this._src_ressource.setActiveTenant(sActiveTenant)}SearchPreferences.setItem("defaultTenantId",sActiveTenant);SearchPreferences.commit();this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("search"));this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateMyRecentContent();this._deactivateMyContent();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this._srchChoiceA.getParent().addClassName("selected");this.options.events.setSourceCStorage(currentId);this._setFieldValue(this.elements.input.value);this._updateMenuOnTanantSelection(sActiveTenant);if(!this._cancel_suggest_update){this.elements.input.focus()}},selectTenant:function(iTenant){this._src_ressource.setActiveTenant(sActiveTenant);if(iTenant==="OnPremise"||false===bMultiTenant){return}if(UWACore.is(this._cstoreSources,"array")){for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===iTenant){if(UWACore.is(this._cstoreChoiceA,"array")&&UWACore.is(this._cstoreChoiceA[insrc])){this._cstoreChoiceA[insrc].click()}}}}},_clickOnChoiceFindInTabOrApp:function(options){var searchNLS=options&&options.searchNLS?options.searchNLS:null;this._internalSearchCriteria=null;this.elements.input.readOnly=false;if(this._inAppContext){this._setPlaceHolderValue(nlsKeys.get("find_in_app"))}else{this._setPlaceHolderValue(searchNLS||this._findInTabNLS)}if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.getParent().addClassName("selected");if(!this._inAppContext){this._sitChoiceA.setHTML(searchNLS||this._findInTabNLS)}}if(!(UWACore.is(options)&&UWACore.is(options.focus)&&!(options.focus))){this.elements.input.focus()}this._deactivateSimilarSearch();this._deactivateMyRecentContent();this._deactivateMyContent();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this.hidePredefinedQuery();this.hideTenantChoice();if(this._inAppContext){this.options.events.setSourceCStorage(sActiveTenant)}else{this.options.events.setSourceDashboard()}this._setFieldValue(this.elements.input.value)},_clickOnChoiceMyContent:function(options){this.keepPreviousSearchMode();this._internalSearchCriteria=null;this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("mycontent"));this._setFieldValue("");this._hideClearSearchBtn();this.elements.input.readOnly=true;this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this._myContentChoiceA.getParent().addClassName("selected");this.showPredefinedQuery();this.showTenantChoice();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("myContent")}},_clickOnChoiceFavoriteSearches:function(options){this._internalSearchCriteria=null;this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches"));this._setFieldValue("");this._hideClearSearchBtn();this.elements.input.readOnly=true;this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateAdvancedSearch();this._deactivateOtherLastBlockList();this._FavoriteSearchesA.getParent().addClassName("selected");this.showPredefinedQuery();this.showTenantChoice();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("favoriteSearches")}},_clickOnChoiceMyRecentContent:function(options){this._myRecentContentIsActive=true;var noFocus={focus:false};this._clickOnChoiceSearch(noFocus);var sFilterToUse="*";if((options&&options.paramsFilter!=="*")&&(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")||this.elements.input.placeholder===nlsKeys.get("myrecentcontent"))){sFilterToUse=this.elements.input.value?this.elements.input.value:options.paramsFilter}this._internalSearchCriteria=null;this._myRecentContentChoiceA.getParent().addClassName("selected");this._deactivateMyContent();this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateEasyTypeSearch();this._deactivateAdvancedSearch();this.options.events.setSourceCStorage(sActiveTenant);if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){if(UWACore.is(options)){this.dispatchEvent("myRecentContent",{sFilter:sFilterToUse,widgetId:options.widgetId})}else{this.dispatchEvent("myRecentContent",{sFilter:sFilterToUse})}}},_clickOnChoiceSimilarSearch:function(){this._internalSearchCriteria=null;this._setPlaceHolderValue(nlsKeys.get("similar_search"));this._setFieldValue("");this.elements.input.readOnly=true;if(UWACore.is(this._SimilarSearchChoiceA)){this._SimilarSearchChoiceA.getParent().addClassName("selected")}this._SimilarSearchIsActive=true;this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateSearchIn();this._deactivateMyContent();this._deactivateMyRecentContent();this._deactivateAdvancedSearch();this.hidePredefinedQuery();this._setSimilarCurrentSelectedPhysicalId(this._SimilarCurrentSelectedPhysicalId)},_selectPartForSimilarSearch:function(cb_data){if(!UWACore.is(cb_data)){throw new Error("Invalid Arg in _selectPartForSimilarSearch")}if(UWACore.is(cb_data.data)&&UWACore.is(cb_data.data.paths)&&cb_data.data.paths.length>0&&cb_data.data.paths[0].length>0){var pId=cb_data.data.paths[0][cb_data.data.paths[0].length-1];if(pId.resourceid!==undefined){pId=pId.resourceid}this._setSimilarCurrentSelectedPhysicalId(pId)}},_setSimilarCurrentSelectedPhysicalId:function(physicalId){if(physicalId!==null){this._SimilarCurrentSelectedPhysicalId=physicalId;if(this._SimilarSearchIsActive===true){this._setFieldValue("#similarity/"+this._SimilarCurrentSelectedPhysicalId)}}},_clickOnChoiceAdvancedSearch:function(options){this._internalSearchCriteria=null;this._AdvSearchChoiceA.getParent().addClassName("selected");this._adv_Search_activated=true;this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("adv_search"));this._setFieldValue("");this.elements.input.readOnly=true;this._deactivateMyContent();this._deactivateMyRecentContent();this._deactivateSearchIn();this._deactivateEasyTypeSearch();this._deactivateSearch();this._deactivateOtherLastBlockList();this.hidePredefinedQuery();this.showTenantChoice();if(!UWACore.is(options,"object")||!UWACore.is(options.setTenant)||false!==options.setTenant){this.options.events.setSourceCStorage(sActiveTenant)}if(UWACore.is(options)&&UWACore.is(options.adv_search_field,"string")&&(options.adv_search_field.length>0)){this.dispatchEvent("advancedSearch",options.adv_search_field)}else{if(!UWACore.is(options,"object")||!UWACore.is(options.focus)||false!==options.focus){this.dispatchEvent("advancedSearch")}}},setInAppContext:function(isInAppContext){if(isInAppContext===false){this._inContextOptions=null}this._inAppContext=isInAppContext;this._temporarilyOutOfContext=false;if(UWACore.is(this._sitChoiceA)){if(this._inAppContext){this._sitChoiceA.setHTML(nlsKeys.get("find_in_app"))}else{this._sitChoiceA.setHTML(this._findInTabNLS)}}},setFindInContext:function(options,placeholder){this._setFindInContext(options);if(UWACore.is(placeholder)){this._setPlaceHolderValue(placeholder)}else{if(this._cstoreSources&&this._cstoreSources.length>1){}else{this._setPlaceHolderValue(nlsKeys.get("search"))}}},_setFindInContext:function(options){var that=this;this.keepPreviousSearchMode();this._internalSearchCriteria=null;this._setPlaceHolderValue(nlsKeys.get("find_in_app"));if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(nlsKeys.get("find_in_app"));this._sitChoiceA.getParent().addClassName("selected")}if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().addClassName("selected")}this.elements.input.readOnly=false;var hideLastSearch=true;if(hideLastSearch&&UWACore.is(options.widget_id)&&options.widget_id!=="widget_id_#saved_search_edit#"){this.hideLastSearch()}var hideFavoriteSearches=false;if(options&&options.UXOptions&&options.UXOptions.menuMyFavorites===false){hideFavoriteSearches=true}if(hideFavoriteSearches){this._AsyncSearchDropdownPromise.promise.then(function(){that.hideFavoriteSearches()})}this._deactivateMyContent();var hideMyContent=false;if(options&&options.UXOptions&&options.UXOptions.menuMyContent===false){hideMyContent=true}if(hideMyContent){this.hideMyContent()}this._deactivateMyRecentContent();this._deactivateAdvancedSearch();this._deactivateEasyTypeSearch();if(UWACore.is(options)&&UWACore.is(options.tenant)){this.options.events.setSourceCStorage(options.tenant);sActiveTenant=options.tenant;if(this._cstoreSources.length>1){for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===options.tenant){if(UWACore.is(this._cstoreChoiceA[insrc])){this._cstoreChoiceA[insrc].getParent().addClassName("active")}}else{if(UWACore.is(this._cstoreChoiceA[insrc])&&this._cstoreChoiceA[insrc].getParent().hide){this._cstoreChoiceA[insrc].getParent().removeClassName("active");this._cstoreChoiceA[insrc].getParent().hide()}}}}this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("search"))}else{this.options.events.setSourceCStorage(sActiveTenant)}var hideAdvancedSearch=true;if(options&&options.advanced_search){hideAdvancedSearch=false;if(options.advanced_search.exclusive){that._hideSearch()}}if(hideAdvancedSearch){this._AsyncSearchDropdownPromise.promise.then(function(){that.hideAdvancedSearch()})}var hideHelpOnTypeShortcut=true;if(hideHelpOnTypeShortcut){this._AsyncSearchDropdownPromise.promise.then(function(){that.hidePredefinedQuery()})}this._inContextOptions=options},_setFindInApp:function(options){this._internalSearchCriteria=null;this._setPlaceHolderValue(nlsKeys.get("find_in_app"));if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(nlsKeys.get("find_in_app"));this._sitChoiceA.getParent().addClassName("selected")}this._deactivateMyContent();this._deactivateMyRecentContent();this._deactivateAdvancedSearch();this._deactivateEasyTypeSearch();this._deactivateSearch();if(UWACore.is(options)&&UWACore.is(options.tenant)){this.options.events.setSourceCStorage(options.tenant);if(this._cstoreSources.length>1){for(var insrc=0;insrc<this._cstoreSources.length;insrc++){if(this._cstoreSources[insrc].tenantId===options.tenant){this._cstoreChoiceA[insrc].getParent().addClassName("active")}else{this._cstoreChoiceA[insrc].getParent().removeClassName("active")}}}this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))}else{this.options.events.setSourceCStorage(sActiveTenant)}this._inContextOptions=options},setBackSearchOrFindInTab:function(options){var noFocus={focus:false};if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.SEARCH_IN){this._clickOnChoiceFindInTabOrApp(options.noFocus?noFocus:null)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.SEARCH&&this._cstoreSources.length===1){this._clickOnChoiceSearch(noFocus)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.ADVANCED_SEARCH){this._clickOnChoiceAdvancedSearch(noFocus)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.MY_CONTENT){this._clickOnChoiceMyContent(noFocus)}else{if(UWACore.is(this._previouslyActiveSource,"string")&&this._previouslyActiveSource===SearchUtils.SearchTypeEnum.FAVORITE_SEARCH){this._clickOnChoiceFavoriteSearches(noFocus)}else{if(this._cstoreSources.length===1){this._clickOnChoiceSearch(noFocus)}else{if(this._cstoreSources.length>1){this._clickOnChoiceSearchInTenant(sActiveTenant)}}}}}}}if(options&&options.resetNLS&&UWACore.is(this._sitChoiceA)){this._sitChoiceA.setHTML(this._findInTabNLS)}this.showLastSearch();this.showFavoriteSearches();this.showMyContent();this.showAdvancedSearch(sActiveTenant)},switchToSearch:function(){if(this.elements.input.placeholder===this._findInTabNLS){}else{this._isTypeListDone=true;var typeValue={adv_search_field:this._isTypeValue,focus:false};this._clickOnChoiceSearch(typeValue)}},setFindInApp:function(options){this.keepPreviousSearchMode();this._setFindInApp(options)},onSetFindInTab:function(searchNLS){this.keepPreviousSearchMode();var options={focus:false,searchNLS:searchNLS};this._clickOnChoiceFindInTabOrApp(options)},keepPreviousSearchMode:function(){if((this.elements.input.placeholder===this._findInTabNLS)||(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.SEARCH_IN}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.SEARCH}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("mycontent")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.MY_CONTENT}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("adv_search")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.ADVANCED_SEARCH}else{if(this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")){this._previouslyActiveSource=SearchUtils.SearchTypeEnum.FAVORITE_SEARCH}else{this._previouslyActiveSource=SearchUtils.SearchTypeEnum.SEARCH_IN}}}}}},onSwitchToFindInTab:function(){this._clickOnChoiceFindInTabOrApp()},onSwitchToFindInApp:function(options){this._setFindInApp(options)},buildSkeleton:function(){this._parent()},resizeSuggests:function(){this._getSuggestions().setStyle("width","100%")},getSuggestions:function(text){var finalUrl,params,arrayUrl,that=this;if(!text){return}if(this.dataCache[text]){this.dispatchEvent("onUpdateSuggests",[this.dataCache[text]]);this.typeTimeout=null;return}if(this.options.suggestUrl){arrayUrl=this.options.suggestUrl.split("?");finalUrl=arrayUrl[0];params=arrayUrl[1].replace("{text}",text);if(UWACore.is(this.options.source)){params=this.options.source.getServicesData("suggest",text);return UWA.Data.request(finalUrl,{method:this.options.method||"POST",data:this.options.data||params,type:this.options.type||"json",headers:this.options.headers||{"Content-Type":"application/json"},onComplete:function(data){data=that.dataParse(data);if(data.length>0){that.dataCache[text]=data;that.dispatchEvent("onUpdateSuggests",[data])}that.typeTimeout=null;return that.typeTimeout},proxy:this.options.proxy||null})}}},onClick:function(e){var suggestion_display=this.elements.form.className;if(suggestion_display.indexOf("nv-autocomplete-suggestsDisplayed")===-1){this.onFocus(e)}},onFocus:function(){this._cancel_suggest_update=false;if(this._inContextOptions&&this._inContextOptions.advanced_search&&this._inContextOptions.advanced_search.exclusive){this.dispatchEvent("onUpdateSuggests",[[]]);return}var autocompleteVar=this;var inputValue=autocompleteVar.elements.input.value;this._suggestPreviousQueries(this,inputValue);this.getServerSuggestions(inputValue);if(inputValue===""){localRequire(["DS/SNInfraUX/SearchSettings"],function(SearchSettings){if(SearchSettings.options.search_settings.search_on_keyup===true){autocompleteVar.dispatchEvent("defaultSearch",{value:"*"})}})}},onKeyUp:function(e){var autocompleteVar=this;if(e.keyCode===38||e.keyCode===40){return}else{if(e.keyCode===37||e.keyCode===39||e.keyCode===35||e.keyCode===36){return}else{if(e.keyCode===27){return}else{if(UWACore.is(this.elements.input)&&this.elements.input.value==="?"){this._setFieldValue("");this._showPQSelectionUX();return}}}}this._setInternalCriteria(null);var target=Event.getElement(e);if(target.value){if(target.value.length>0){this._showClearSearchBtn();autocompleteVar._suggestPreviousQueries(autocompleteVar,target.value)}else{this._hideClearSearchBtn();autocompleteVar._suggestPreviousQueries(autocompleteVar,target.value)}}else{if(this.elements.input.placeholder!==this._findInTabNLS){this._hideClearSearchBtn()}autocompleteVar._suggestPreviousQueries(autocompleteVar,target.value)}localRequire(["DS/SNInfraUX/SearchSettings"],function(SearchSettings){if(SearchSettings.options.search_settings.search_on_keyup===false){clearTimeout(autocompleteVar._suggestTimeout);autocompleteVar._suggestTimeout=setTimeout(function(){autocompleteVar.getServerSuggestions(target.value)},150)}else{if(target.value&&target.value.length===0){clearTimeout(autocompleteVar._secondTimeoutId)}clearTimeout(autocompleteVar._timeoutId);autocompleteVar._timeoutId=setTimeout((function(value){return function(){if(value&&value.length>0){autocompleteVar.options.events.onSearch(value)}autocompleteVar._suggestPreviousQueries(autocompleteVar,value);clearTimeout(autocompleteVar._suggestTimeout);autocompleteVar._suggestTimeout=setTimeout(function(){autocompleteVar.getServerSuggestions(value)},150)}})(target.value),500)}})},attachEvents:function(){this._parent();var elm=this.elements;elm.input.addEvent("keydown",this.onKeyDown.bind(this));elm.input.addEvent("click",this.onClick.bind(this))},_escapeKeyOnSuggestions:function(){this.dispatchEvent("onHideSuggests")},_arrowKeyOnSuggestions:function(e,iDir){var children=this._getSuggestions().getChildren()[0].getChildren().concat(this._getSuggestions().getChildren()[1].getChildren());if(children.length<1){return}this.dispatchEvent("onShowSuggests");var currentItem=-1;var nextItem=-1;for(var i=0;i<children.length;i++){if(children[i].hasClassName("suggestion-selected")){currentItem=i;break}}nextItem=currentItem+iDir;if(nextItem<0){nextItem=children.length-1}if(nextItem>children.length-1){nextItem=0}if(currentItem>=0){children[currentItem].removeClassName("suggestion-selected")}if(nextItem>=0){children[nextItem].addClassName("suggestion-selected");var target=Event.getElement(e);if(UWACore.is(target)){target.value=children[nextItem].getText()}this._showClearSearchBtn()}},onKeyDown:function(e){var key=UWA.Event.whichKey(e);if(e.keyCode===38){this._arrowKeyOnSuggestions(e,-1)}else{if(e.keyCode===40){this._arrowKeyOnSuggestions(e,+1)}else{if(e.keyCode===27){this._escapeKeyOnSuggestions(e)}else{if(key==="ctrl+a"){e.stopPropagation()}}}}},_showPQSelectionUX:function(){this.dispatchEvent("showPQListUX")},setSelectedPQPrefix:function(prfix){this._setFieldValue(prfix);this.elements.input.focus();if(this._pqSelect===true){var noFocus={focus:false};this._clickOnChoiceSearch(noFocus)}this._pqSelect=false},onSelect:function(value,item,advSearch){if(UWACore.is(advSearch,"string")&&advSearch.length>0){this._isTypeListMode=true;this._value=""}this._parent(value,item);this._showClearSearchBtn()},_getClearSearchBtn:function(){if(this._clearSearch===null){this._clearSearch=UWACore.extendElement(document.body).getElement(".clear_btn_search")}return this._clearSearch},_showClearSearchBtn:function(){var clearSearchBtn=this._getClearSearchBtn();if(UWACore.is(clearSearchBtn)&&UWACore.is(clearSearchBtn.show,"function")){clearSearchBtn.setStyle("display","inline-block");clearSearchBtn.show();var inputField=UWACore.extendElement(document.body).getElement(".nv-autocomplete-input");if(UWACore.is(inputField)){inputField.addClassName("clear-visible")}}},_hideClearSearchBtn:function(){var clearSearchBtn=this._getClearSearchBtn();if(UWACore.is(clearSearchBtn)&&UWACore.is(clearSearchBtn.hide,"function")){clearSearchBtn.hide();var inputField=UWACore.extendElement(document.body).getElement(".nv-autocomplete-input");if(UWACore.is(inputField)){inputField.removeClassName("clear-visible")}}},_setPlaceHolderValue:function(sPlaceHolderValue){if(!UWACore.is(sPlaceHolderValue,"string")){throw new Error("Bad arg in _setPlaceHolderValue!")}if(!UWACore.is(this.elements.input)||!UWACore.is(this.elements.input.placeholder)){throw new Error("placeholder not found!")}this.elements.input.placeholder=sPlaceHolderValue},_getSuggestions:function(){if(this._autocompleteSuggests===null){this._autocompleteSuggests=UWACore.extendElement(document.body).getElement(".nv-autocomplete-suggests")}return this._autocompleteSuggests},hideSearchInThisTab:function(){if(this._sitChoice){this._sitChoice.hide()}},showSearchInThisTab:function(){if(this._sitChoice){this._sitChoice.show()}},hideLastSearch:function(){if(this._LastSearchResults){this._LastSearchResults.hide()}},showLastSearch:function(){if(!this._inAppContext){if(this._LastSearchResults){this._LastSearchResults.show()}}},hideFavoriteSearches:function(){if(this._FavoriteSearches){this._FavoriteSearches.hide()}},showFavoriteSearches:function(){var that=this;if(UWACore.is(that._FavoriteSearches)){SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){that._FavoriteSearches.show()}})}},hidePredefinedQuery:function(){if(this._predefinedQuery){this._predefinedQuery.hide()}},hideMyContent:function(){if(this._myContentChoice){this._myContentChoice.hide()}},showMyContent:function(){if(this._myContentChoice){this._myContentChoice.show()}},showAdvancedSearch:function(sActiveTenant){var that=this;if(UWACore.is(that._AdvSearchChoice)){SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){that._AdvSearchChoice.show()}})}},hideAdvancedSearch:function(){if(UWACore.is(this._AdvSearchChoice)){this._AdvSearchChoice.hide()}},showPredefinedQuery:function(){var that=this;if(this._srchChoice.className==="selected"||(this._myContentChoice&&this._myContentChoice.className==="selected")||(this._FavoriteSearches&&this._FavoriteSearches.className==="selected")){if(this._predefinedQuery){SearchUtils.isRoleAvailable(["CSV"],sActiveTenant,function(bIsRoleAvailable){if(true===bIsRoleAvailable){that._predefinedQuery.show()}})}}},_setInputValue:function(options){this.elements.input.value=options},_setFieldValue:function(options){this._setInputValue(options);this._searchStringToDisplayInSearchField=options;if((UWACore.is(options,"string")&&options.length>0)){this._showClearSearchBtn()}else{this._hideClearSearchBtn()}},_setInternalCriteria:function(options){this._internalSearchCriteria=options},_deactivateSearch:function(){if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().removeClassName("selected")}},_hideSearch:function(){if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().hide()}},_showSearch:function(){if(UWACore.is(this._srchChoiceA)){this._srchChoiceA.getParent().show()}},_deactivateSearchIn:function(){if(UWACore.is(this._sitChoiceA)){this._sitChoiceA.getParent().removeClassName("selected")}},_deactivateAdvancedSearch:function(){if(UWACore.is(this._AdvSearchChoiceA)){this._AdvSearchChoiceA.getParent().removeClassName("selected")}this._adv_Search_activated=false},_deactivateMyRecentContent:function(){if(UWACore.is(this._myRecentContentChoiceA)){this._myRecentContentChoiceA.getParent().removeClassName("selected")}this._myRecentContentIsActive=false},_deactivateMyContent:function(){if(UWACore.is(this._myContentChoiceA)){this._myContentChoiceA.getParent().removeClassName("selected")}},_deactivateSimilarSearch:function(){if(UWACore.is(this._SimilarSearchChoiceA)){this._SimilarSearchChoiceA.getParent().removeClassName("selected")}this._SimilarSearchIsActive=false},_getPlaceHolderTextDependingOnActiveTenant:function(sKey){if(!UWACore.is(sKey,"string")||0===sKey.length){throw new Error("E_INVALIDARG: need a key !")}var sPlaceHolderTxt=nlsKeys.get(sKey);if(this._cstoreSources.length>1){if(UWACore.is(nlsKeys[sKey+"_in_active"])){sPlaceHolderTxt=nlsKeys.replace(nlsKeys.get(sKey+"_in_active"),{tenant:this.getSelectedTenant().displayName})}else{sPlaceHolderTxt+=" "+this.getSelectedTenant().displayName}}return sPlaceHolderTxt},showTenantChoice:function(){if(true===this._enable_tenant_selection){if(UWACore.is(this.elements)&&UWACore.is(this.elements.tenantChoice)&&UWACore.is(this.elements.tenantChoice.hide,"function")){this.elements.tenantChoice.show()}}},hideTenantChoice:function(){if(UWACore.is(this.elements)&&UWACore.is(this.elements.tenantChoice)&&UWACore.is(this.elements.tenantChoice.hide,"function")){this.elements.tenantChoice.hide()}},isMultiTenantContext:function(){return bMultiTenant},getSelectedTenant:function(){if(!bMultiTenant){throw new Error("E_INVALIDARG: not in multi tenant context, check first using isMultiTenantContext before calling this function !")}if(!UWACore.is(this._cstoreChoice,"array")||this._cstoreChoice.length<=1||!UWACore.is(this._cstoreSources,"array")||this._cstoreChoice.length!==this._cstoreSources.length){throw new Error("E_UNEXPECTED: Supposed to be in multi tenant but invalid data !")}var currentTenant=null;for(var iTenant=0,nbTenant=this._cstoreChoice.length;iTenant<nbTenant&&currentTenant===null;iTenant++){if(UWACore.is(this._cstoreChoice[iTenant])&&UWACore.is(this._cstoreChoice[iTenant].className)){if(this._cstoreChoice[iTenant].className.indexOf("active")>=0){currentTenant={tenantId:this._cstoreSources[iTenant].tenantId,displayName:this._cstoreSources[iTenant].displayName}}}}if(null===currentTenant){currentTenant={tenantId:sActiveTenant,displayName:sActiveTenant}}return currentTenant},_deactivateEasyTypeSearch:function(iItem){this._easyTypeSelect=false;if(UWACore.is(this._easyTypeListUI,"array")&&this._easyTypeListUI.length>0){this._easyTypeListUI.forEach(function(item){item.getParent().removeClassName("selected")});if(UWACore.is(iItem)){for(var i=0;i<this._easyTypeListUI.length;i++){var text=this._easyTypeListUI[i].getText();if(text===iItem){this._easyTypeSelect=true;this._easyTypeListUI[i].getParent().addClassName("selected");break}}this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateSearch();this._deactivateMyRecentContent();this._deactivateMyContent()}}},_deactivateOtherLastBlockList:function(iItem){if(UWACore.is(this._otherLastBlockListUI,"array")&&this._otherLastBlockListUI.length>0){this._otherLastBlockListUI.forEach(function(item){if(UWACore.is(item)){item.getParent().removeClassName("selected")}});if(UWACore.is(iItem)){iItem.getParent().addClassName("selected");this._deactivateSearchIn();this._deactivateSimilarSearch();this._deactivateSearch();this._deactivateMyRecentContent();this._deactivateMyContent();this._deactivateAdvancedSearch()}}},_findInthisTabOnClick:function(iVal){if(true===iVal){this._restoreActiveSearchInTab()}if(SearchUtils.isOneSearchInternalProd()){SearchPreferences.setItem("find_in_this_tab_default",iVal);SearchSettings.changeSettings({find_in_this_tab_default:iVal});SearchPreferences.commit()}},_restoreActiveSearchInTab:function(){var that=this;var clientInfo=SearchUtils.identifyClientInfo();if("3DDashboard"===clientInfo.identifier){var Module3DD="DS/Dashboard/PublicAPI";require([Module3DD],function(DashboardPublicAPI){var activeDashboard=DashboardPublicAPI.getActiveTab();if(UWACore.is(activeDashboard)&&UWACore.is(activeDashboard.shouldPropagateSearch)&&true===activeDashboard.shouldPropagateSearch){if(UWACore.is(activeDashboard.shouldPropagateSearchArg,"string")&&0<activeDashboard.shouldPropagateSearchArg.length){that._setFieldValue(activeDashboard.shouldPropagateSearchArg)}}})}}});return SearchAutocomplete});define("DS/SNSearchUX/SearchView",["text!DS/SNSearchUX/assets/templates/SearchView.html","DS/Handlebars/Handlebars","UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Debug","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/SearchHistoric","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNSearchUX/SearchAutocomplete","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Tooltip"],function(g,b,k,l,a,c,f,d,j,e,n,o,m,i){var h;h=a.extend(c,{name:"DS/SNSearchUX/SearchView",uwaClassName:"SearchView",id:"global_ctn_search",className:"global_ctn_search topbar-search",domEvents:{"click div.run_ctn_search":"_onSearch","click div.clear_btn_search":"_onClearSearch","keyup input.input_search":"_onSearchInputKeyUp","keydown input.input_search":"_onSearchInputKeyDown"},template:b.compile(g),autocomplete:undefined,socket:undefined,selectedSource:undefined,_setSource:function(p){var q=this;require(["DS/SNSearchUX/SearchUX_TopBar"],function(r){if(k.is(r.getAddinMode(),"string")){p.searchParams=p.searchParams||{};p.searchParams.enable_search_in_this_tab=false}if(k.is(q.autocomplete)&&k.is(q.autocomplete._buildSearchChoice,"function")){q.autocomplete._buildSearchChoice(p)}})},setup:function(p){var q=this;this.debugMode=f.result(p,"debugMode");var r="DS/TopBar/TopBar";require([r],function(s){s.addEvent({events:{mobileSearchAction:function(t){switch(t.action){case"enable":if(k.is(q.autocomplete)){q.autocomplete.elements.input.focus()}break;case"disable":break}}}})});this.socket=j.createSocket({socket_id:"searchview_socket_id"});this.socket.addListener("onSetSources",function(s){q._setSource(s)});this.socket.addListener("onSetFindInApp",function(s){q.autocomplete.setFindInApp(s)});this.socket.addListener("onSetBackSearchOrFindInTab",function(s){q.autocomplete.setBackSearchOrFindInTab(s)});this.socket.addListener("onSetInAppContext",function(s){q.autocomplete.setInAppContext(s)});this.socket.addListener("openTagger",function(s){q.socket.dispatchEvent("openTagger",s)});this.socket.addListener("setTaggerMode",function(s){q.socket.dispatchEvent("setTaggerMode",s)});this.socket.addListener("closeTagger",function(s){q.socket.dispatchEvent("closeTagger",s)});this.socket.addListener("onSetFocusInSearchField",function(){setTimeout(function(){if(k.is(q.autocomplete)){q.autocomplete.elements.input.focus()}},100)});this.socket.addListener("onSelectTenant",function(s){if(k.is(q.autocomplete.selectTenant,"function")){q.autocomplete.selectTenant(s)}});this.socket.addListener("onSelectTenantAfterTabActivation",function(s){if(k.is(q.autocomplete.selectTenantOnTabActivation,"function")){q.autocomplete.selectTenantOnTabActivation(s)}});this.socket.addListener("onRefreshSearchField",function(s){if(s.searchStringToDisplayInSearchField===m.get("myContent_searchFav")&&s.internalSearchCriteria!==m.get("myContent_searchFav")){q.autocomplete._clickOnChoiceSearch({focus:false})}if(k.is(s,"string")){if(s.length>0){q.autocomplete._clickOnChoiceSearch()}q.autocomplete._setFieldValue(s)}else{if(k.is(s,"object")&&k.is(s.searchStringToDisplayInSearchField,"string")&&k.is(s.internalSearchCriteria,"string")){if(s.searchStringToDisplayInSearchField.length>0){q.autocomplete._clickOnChoiceSearch({focus:false})}q.autocomplete._setFieldValue(s.searchStringToDisplayInSearchField);q.autocomplete._setInternalCriteria(s.internalSearchCriteria)}}});this.socket.addListener("onSwitchMode",function(s){if(s&&f.SearchTypeEnum.MY_RECENT_CONTENT===s.new_mode){q.autocomplete._clickOnChoiceMyRecentContent(s)}});this.socket.addListener("onResetMyRecent",function(){q.autocomplete._deactivateMyRecentContent()});this._filterInProgress=false;this.socket.addListener("clickOnChoiceSearch",function(s){q.autocomplete._clickOnChoiceSearch(s)});this.socket.addListener("clickOnChoiceMyContent",function(s){q.autocomplete._clickOnChoiceMyContent(s)});this.socket.addListener("clickOnChoiceAdvancedSearch",function(s){q.autocomplete._clickOnChoiceAdvancedSearch(s)});this.socket.addListener("clickOnChoiceFavoriteSearch",function(s){q.autocomplete._clickOnChoiceFavoriteSearches(s)});this.socket.addListener("onSetFindInTab",function(s){q.autocomplete.onSetFindInTab(s)});this.socket.addListener("onSwitchToFindInTab",function(s){q.autocomplete.onSwitchToFindInTab(s)});this.socket.addListener("onSwitchToFindInApp",function(s){q.autocomplete.onSwitchToFindInApp(s)});this.socket.addListener("hideSearchInThisTab",function(s){q.autocomplete.hideSearchInThisTab(s)});this.socket.addListener("showSearchInThisTab",function(s){q.autocomplete.showSearchInThisTab(s)});this.socket.addListener("onPQPrefixSelect",function(s){q.autocomplete.setSelectedPQPrefix(s)});this.socket.addListener("onInContextSearch",function(s){if(!q.autocomplete._inAppContext){if(s.inContextOptions.mode==="furtive"||s.inContextOptions.app_socket_id!=="socket_id_#saved_search_edit#"){q.restoreAppContext=q.autocomplete.storeAppContext();q.autocomplete.setInAppContext(true);q.autocomplete.setFindInContext(s.inContextOptions,s.placeholder)}else{q.autocomplete._clickOnChoiceSearch({focus:false})}}});this.socket.addListener("onCloseTransient",function(s){if(k.is(q.restoreAppContext,"function")){if(q.restoreAppContext(s)){q.restoreAppContext=null}}else{q.autocomplete.setBackSearchOrFindInTab({noFocus:true})}});this.socket.addListener("onInContextSearchDeactivated",function(s){if(k.is(q.restoreAppContext,"function")){if(q.restoreAppContext(s)){q.restoreAppContext=null}}});this.socket.addListener("Last_Tag_Filter",function(s){if(!(q.autocomplete._inContextOptions&&q.autocomplete._inContextOptions.app_socket_id==="socket_id_#saved_search_edit#")){q.last_tag_filter=s}});this.socket.addListener("clearSearch",function(s){if(q.autocomplete&&q.autocomplete.elements.input.placeholder===q.autocomplete._getPlaceHolderTextDependingOnActiveTenant("search")){q._onClearSearch(s)}})},destroy:function(){this.stopListening(this.model);this._parent();this.container=null},_onSearch:function(p){var t=this;if(f.identifyClientInfo().identifier==="3DSwym"&&f.getDeviceCategory()==="iphone"){t.container.parentElement.parentElement.toggleClassName("search-active")}var u=this.autocomplete.elements.input.value;if(k.is(this.autocomplete._internalSearchCriteria,"string")&&this.autocomplete._internalSearchCriteria.length>0){u=this.autocomplete._internalSearchCriteria}if(k.is(this.autocomplete.showLastSearch,"function")){this.autocomplete.showLastSearch()}f.setsearchType(f.SearchTypeEnum.SEARCH);var s=this.autocomplete._adv_Search_activated;var r=this.autocomplete._inContextOptions;if(k.is(u,"string")&&u.length>0){this.autocomplete._searchStringToDisplayInSearchField=this.autocomplete.elements.input.value;if(!(r&&t.autocomplete._inContextOptions.app_socket_id==="socket_id_#saved_search_edit#")){this.reSearch=true;this.reSearchQuery={value:u,searchStringToDisplayInSearchField:this.autocomplete._searchStringToDisplayInSearchField}}}function q(){f.executeWithPQ({wait:function(){if(t.autocomplete.elements.input.value.indexOf(":")>0){t.socket.dispatchEvent("fetchPQsFromServer");return true}},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(v){var x={inCtx_widget_id:r.widget_id};var w=t.autocomplete.elements.input.value;w=v.manageWildcardAddtion(w);x.value=f.replacePQsWithCVPrefixes(w);if(k.is(r.precond)){if(r.precond.trim().length>0){x.searchStringToDisplayInSearchField=t.autocomplete.elements.input.value;if(k.is(x.value)&&x.value.trim().length>0&&x.value!=="*"){x.internalSearchCriteria="("+x.value+")AND("+r.precond+")";x.value="("+x.value+")AND("+r.precond+")"}else{x.internalSearchCriteria=r.precond;x.value=r.precond}x.displayValue=t.autocomplete.elements.input.value}}x.adv_search=s;x.source=r.source;if(!k.is(x.source)){x.source=[]}t.socket.dispatchEvent("search",x)})}})}if(true===this.autocomplete._myRecentContentIsActive&&u===""){f.setsearchType(f.SearchTypeEnum.MY_RECENT_CONTENT);this.socket.dispatchEvent("myRecentContent",{value:f.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:false,sFilter:"*"})}else{if(u===""){if(this.autocomplete._inAppContext&&this.autocomplete._temporarilyOutOfContext===false&&r!==null){q()}else{if(this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("mycontent")){f.setsearchType(f.SearchTypeEnum.MY_CONTENT);this.socket.dispatchEvent("myContent",{value:f.SearchTypeEnum.MY_CONTENT,adv_search:false})}else{if(this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("search")&&this.reSearch){this.socket.dispatchEvent("search",{value:this.reSearchQuery.value,adv_search:s,refine:this.last_tag_filter,source:[],reSearch:true,internalSearchCriteria:this.autocomplete._internalSearchCriteria,searchStringToDisplayInSearchField:this.reSearchQuery.searchStringToDisplayInSearchField,fromEmptyString:true});t.autocomplete._setFieldValue(this.reSearchQuery.searchStringToDisplayInSearchField)}else{if(this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("adv_search")){f.setsearchType(f.SearchTypeEnum.ADVANCED_SEARCH);this.socket.dispatchEvent("advancedSearch",{value:f.SearchTypeEnum.ADVANCED_SEARCH,adv_search:true,source:[],adv_search_field:p});t.autocomplete._AdvancedSearchField=null}else{this._filterInProgress=false;this.autocomplete._hideClearSearchBtn();this.socket.dispatchEvent("clearSearch");if(k.is(this.autocomplete.hideLastSearch,"function")){this.autocomplete.hideLastSearch()}if(k.is(this.autocomplete)&&k.is(this.autocomplete.elements)&&k.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS){if(this.model.hasEvent("search")){f.setsearchType(f.SearchTypeEnum.SEARCH_IN);this.model.dispatchEvent("search",{value:u,searchMode:f.SearchTypeEnum.SEARCH_IN})}}}}}}}else{this._filterInProgress=true;if(this.autocomplete._inAppContext&&this.autocomplete._temporarilyOutOfContext===false&&r!==null){if(t.autocomplete._searchStringToDisplayInSearchField){d.storeValueInDataBase(t.autocomplete._searchStringToDisplayInSearchField)}q()}else{if(k.is(this.autocomplete)&&k.is(this.autocomplete.elements)&&k.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS){if(this.model.hasEvent("search")){f.setsearchType(f.SearchTypeEnum.SEARCH_IN);this.model.dispatchEvent("search",{value:this.autocomplete.elements.input.value,searchMode:f.SearchTypeEnum.SEARCH_IN})}}else{if(true===this.autocomplete._myRecentContentIsActive){this.autocomplete._clickOnChoiceSearch()}if(u===t.autocomplete._searchStringToDisplayInSearchField){d.storeValueInDataBase(u)}f.executeWithPQ({wait:function(){if(u.indexOf(":")>0){t.socket.dispatchEvent("fetchPQsFromServer");return true}},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(v){f.setsearchType(f.SearchTypeEnum.SEARCH);u=v.manageWildcardAddtion(u);u=f.replacePQsWithCVPrefixes(u);t.reSearchQuery.value=u;t.socket.dispatchEvent("search",{value:u,adv_search:s,internalSearchCriteria:k.is(t.autocomplete)?t.autocomplete._internalSearchCriteria:null,searchStringToDisplayInSearchField:k.is(t.autocomplete)?t.autocomplete._searchStringToDisplayInSearchField:null})})}})}}}}},_onClearSearch:function(p){this.autocomplete._setInternalCriteria(null);this.autocomplete.elements.input.value="";this.autocomplete._hideClearSearchBtn();this.reSearch=false;if(k.is(this.autocomplete)&&k.is(this.autocomplete.elements)&&k.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS){if(this.model.hasEvent("clearSearch")){this.model.dispatchEvent("clearSearch")}}else{if((!k.is(p)||!k.is(p.destroy)||p.destroy!==true)&&(k.is(this.autocomplete._myRecentContentIsActive)&&true===this.autocomplete._myRecentContentIsActive)){this._onSearch()}}this.reSearch=true},_onSearchInputKeyUp:function(p){if(this.autocomplete.elements.input.value){this.autocomplete._showClearSearchBtn()}else{if(!this._filterInProgress){this.autocomplete._hideClearSearchBtn()}}l.stopPropagation(p)},_onSearchInputKeyDown:function(p){if(l.whichKey(p)==="return"){this._onSearch()}l.stopPropagation(p)},_storeValueInLocalStorage:function(s){if(!k.is(s,"string")){throw new Error("null value given to SearchView._storeValueInLocalStorage!")}if(s.trim().length<=0){return}var r=[];if(!k.is(localStorage.SNSearchBoxStore)){r.push(s);localStorage.SNSearchBoxStore=JSON.stringify(r)}else{r=JSON.parse(localStorage.SNSearchBoxStore);if(r.indexOf(s)===-1){if(r.length>=100){r.shift()}r.push(s);localStorage.SNSearchBoxStore=JSON.stringify(r)}else{var q=r.indexOf(s);var p=r[q];r.splice(q,1);r.push(p);localStorage.SNSearchBoxStore=JSON.stringify(r)}}},render:function(){var t=this,s;s=this.template(this.model.toJSON());this.container.setContent(s);var r=t.getElement(".clear_btn_search.fonticon.fonticon-cancel-circled");if(k.is(r)){var x=new i({position:"bottom",target:r,body:o.get("clear")})}var v=t.getElement(".run_btn_search.fonticon.fonticon-search");if(v){var u=new i({position:"bottom",target:v,body:o.get("search")})}var w=this.container.getElement("#input_search_div");var q=function(y){return y.suggest};var p="tempo_deactivated";this.autocomplete=new n({suggestUrl:p+"?query={text}",placeholder:o.search,typeDelay:500,minLength:1,suggestFormat:"{label}",dataParser:q,className:"sn-search-field uwa-autocomplete nv-autocomplete",events:{openTagger:function(){t.socket.dispatchEvent("openTagger")},setSourceDashboard:function(){t.socket.dispatchEvent("setSelectedSource",{value:"3DDashboard"});t.selectedSource="3DDashboard"},setSourceCStorage:function(y){t.socket.dispatchEvent("setSelectedSource",{value:y});t.selectedSource=y},onSelect:function(z,y){if(k.is(t.autocomplete._isTypeListMode)&&t.autocomplete._isTypeListMode===true){t.autocomplete._isTypeValue=z}var A=false;if(k.is(arguments[2])&&arguments[2]==="AdvSearch"){A=true}if(k.is(arguments[1])){t.autocomplete.switchToSearch()}t.autocomplete._searchStringToDisplayInSearchField=z;if(k.is(t.autocomplete.elements)&&k.is(t.autocomplete.elements.input)&&k.is(t.autocomplete.elements.input.value)&&t.autocomplete.elements.input.value!==z){t.autocomplete._searchStringToDisplayInSearchField=null;t.autocomplete._setInternalCriteria(null)}if(t.autocomplete._searchStringToDisplayInSearchField===null||A===true){t.autocomplete._AdvancedSearchField=z}if(A===false){t._onSearch(t.autocomplete._AdvancedSearchField)}if(k.is(this._value)&&this._value.length>0){t.autocomplete.elements.input.value=z}t.socket.dispatchEvent("onHideSuggests");if(k.is(this._value)&&this._value.length>0&&(!k.is(y,"object")||y.storeSearch===true)){d.storeValueInDataBase(z)}},onSearch:function(y){t._onSearch();if(k.is(t.autocomplete._isTypeListMode)&&t.autocomplete._isTypeListMode===true){d.storeValueInDataBase(y)}},myContent:function(){t.socket.dispatchEvent("myContent",{value:f.SearchTypeEnum.MY_CONTENT,adv_search:false})},favoriteSearches:function(){t.socket.dispatchEvent("favoriteSearches",{value:f.SearchTypeEnum.FAVORITE_SEARCH,adv_search:false})},myRecentContent:function(z){var y={value:f.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:false};if(k.is(z)&&k.is(z.sFilter,"string")&&0<z.sFilter.length){y.sFilter=z.sFilter}else{y.sFilter="*"}if(k.is(z)&&k.is(z.widgetId,"string")&&0<z.widgetId.length){y.widgetId=z.widgetId}t.socket.dispatchEvent("myRecentContent",y)},hideAdvancedSearch:function(){t.socket.dispatchEvent("hideAdvancedSearch",{})},showAdvancedSearch:function(){t.socket.dispatchEvent("showAdvancedSearch",{})},advancedSearch:function(y){t.socket.dispatchEvent("showAdvancedSearch",{adv_search_field:y},["searchtopbar_socket_id"]);t.socket.dispatchEvent("advancedSearch",{value:f.SearchTypeEnum.ADVANCED_SEARCH,adv_search:true,adv_search_field:y})},storeSuggestion:function(y){d.storeValueInDataBase(y)},showPQListUX:function(){t.socket.dispatchEvent("onShowPQListUX")}}}).inject(w);f.setSearchViewRendered();return this}});return h});