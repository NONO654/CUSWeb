/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
require([""],function(){var f=Polymer,i,y,B,j,w,b,A,z={DRM_OPTIONS_CHANGED:"drmoptionschanged"},u="__drm_property_popover__",r="__drm_property_editor__",g="cores",h=function(){return new Promise(function(D){require(["DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Number","DS/SMAPoweredByState/ad-state-cos/selectors","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-store"],function(G,K,J,F,E,I,H){i=G;y=K;B=J;j=F;w=E;A=I;b=H;D()})})},a=function(D,E){this.drmOptions[D]=(E.target.type==="checkbox")?E.target.checked:E.target.value;this.fire(z.DRM_OPTIONS_CHANGED,{value:this.drmOptions})},t=function(D){var F=false,E;if(this._drmDefinition&&this._drmDefinition.attributes){for(E=0;E<this._drmDefinition.attributes.length;E++){if((this._drmDefinition.attributes[E].name===g)&&(this._drmDefinition.attributes[E].value===D)){F=true;break}}}return F},p=function(D){var F=null,E;if(this._drmDefinition){for(E=0;E<this._drmDefinition.properties.length;E++){if(this._drmDefinition.properties[E].name===D){F=this._drmDefinition.properties[E];break}}}return F},e=function(){var D=document.createElement("div");D.className="form-group";return D},q=function(F,D){var E=document.createElement("label");E.className="control-label";E.setAttribute("for",r+F.name);E.textContent=F.displayName+(F.required?" *":"");D.appendChild(E)},k=function(J,E){var D,I,F,H,G;D=document.createElement("span");D.className="fonticon fonticon-help";E.appendChild(D);I=document.createElement("div");I.setAttribute("id",u+J.name);I.className="popover bottom in hidden";E.appendChild(I);G=function(){I.classList.toggle("hidden")};D.addEventListener("mouseover",G);D.addEventListener("mouseout",G);D.addEventListener("click",G);I.addEventListener("click",G);F=document.createElement("h3");F.className="popover-title";F.textContent=J.displayName;I.appendChild(F);H=document.createElement("div");H.className="popover-body";H.textContent=J.description;I.appendChild(H)},c=function(E,D){var F=new i({id:r+E.name,name:r+E.name,required:E.required,value:(this.drmOptions&&this.drmOptions[E.name])?this.drmOptions[E.name]:E.defaultValue,disabled:E.readOnly});F.inject(D);F.addEvent("onChange",a.bind(this,E.name),this)},n=function(E,D){c.call(this,E,D)},v=function(H,D,K,F){var I=0,L=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Math.pow(2,53)-1,J=t.call(this,H.name),E=J&&(K===A.LicenseType.CREDITS||K===A.LicenseType.TOKENS),M=(this.drmOptions&&this.drmOptions[H.name])?this.drmOptions[H.name]:H.defaultValue;if(J){I=1;this.cores=H.name;if(E){M=parseInt(F)}}var G=new j({id:r+H.name,name:r+H.name,min:I,max:L,required:H.required,value:M,disabled:H.readOnly||E});G.inject(D);if(E){}else{G.addEvent("onChange",a.bind(this,H.name),this)}},x=function(F,E){var D=new B({type:"switch",value:F.displayName,id:r+F.name,name:r+F.name,checked:(this.drmOptions&&this.drmOptions[F.name])?this.drmOptions[F.name]:F.defaultValue,disabled:F.readOnly});D.inject(E);D.addEvent("onChange",a.bind(this,F.name),this)},o=function(G,E){var F=[];G.choices.forEach(function(H){F.push({value:H})});var D=new y({placeholder:false,custom:false,options:F,name:G.name,id:r+G.name});D.setValue((this.drmOptions&&this.drmOptions[G.name])?this.drmOptions[G.name]:G.defaultValue);D.inject(E);D.addEvent("onChange",a.bind(this,G.name),this)},d=function(E,F){var D;this._drmDefinition.properties.forEach(function(G){if(G.visible){D=e.call(this,G);if(G.type===w.DRMPropertyType.BOOLEAN){x.call(this,G,D);if(G.description&&(G.description.length>0)){k.call(this,G,D)}}else{q.call(this,G,D);if(G.description&&(G.description.length>0)){k.call(this,G,D)}if(G.choices){o.call(this,G,D)}else{if(G.type===w.DRMPropertyType.INTEGER){v.call(this,G,D,E,F)}else{if(G.type===w.DRMPropertyType.REAL){n.call(this,G,D)}else{c.call(this,G,D)}}}}f.dom(this.$.customDRMContainer).appendChild(D)}}.bind(this))},C=function(){var E,D;Object.getOwnPropertyNames(this.drmOptions).forEach(function(F){E=p.call(this,F);if(E&&E.visible){D=document.getElementById(r+F);if(E.type===w.DRMPropertyType.BOOLEAN){D.checked=this.drmOptions[F]}else{if(E.choices){D.value=this.drmOptions[F]}else{D.value=this.drmOptions[F]}}}}.bind(this))},m=function(){this._drmDefinition=null;this.cores=null;while(f.dom(this.$.customDRMContainer).firstChild){f.dom(this.$.customDRMContainer).removeChild(f.dom(this.$.customDRMContainer).firstChild)}},l=function(D,E){return E&&((D&&E.drmMode===D.drmMode&&E.server===D.server&&JSON.stringify(E.customDRM)===JSON.stringify(D.customDRM)&&E.licenseOptions&&D.licenseOptions&&E.licenseOptions.licenseType===D.licenseOptions.licenseType&&E.numProcs===D.numProcs)||E.drmMode===w.DRMMode.CLOUD||E.drmMode===w.DRMMode.FIPER)},s=function(D){this.observeStore({select:A.jobExecutionOptions,compareFunc:l,selectArguments:[D],onChange:function(G){if(G){var H=G.drmOptions,I=w.customDRMDef(b.getStore().getState(),G.server,G.drmMode),F=G.numProcs,E=G.licenseOptions?G.licenseOptions.licenseType:null;this.load(I,H,F,E)}}.bind(this)})};DS.SMAPoweredByViews=DS.SMAPoweredByViews||{};DS.SMAPoweredByViews.ADCustomDRMFields=f({is:"ad-custom-drm-fields",properties:{drmOptions:{type:Object,value:null,readOnly:true},jobId:{type:String,value:null,observer:"jobIdChanged"},cores:{type:String,value:null}},ready:function(){this.isReady=this.initReduxBehavior().then(h.bind(this))},jobIdChanged:function(D){if(this.isReady){this.isReady.then(function(){this.unsubscribeAll();if(D){s.call(this,D)}}.bind(this))}},load:function(I,G,F,E){var H={},D,J=false;if(this.isReady){this.isReady.then(function(){m.call(this);D=this._drmDefinition;this._drmDefinition=I;if(this._drmDefinition&&this._drmDefinition.properties){this.$.drmConfigError.classList.add("hidden");d.call(this,E,F);if(!G||(D&&(D!==this._drmDefinition))){this._drmDefinition.properties.forEach(function(K){if(this.cores!==null&&K.name===this.cores&&(E===A.LicenseType.CREDITS||E===A.LicenseType.TOKENS)){H[K.name]=F}else{if(K.defaultValue){H[K.name]=K.defaultValue}}}.bind(this));this._setDrmOptions(H);J=true}else{Object.getOwnPropertyNames(G).forEach(function(K){if(this.cores!==null&&K===this.cores&&(E===A.LicenseType.CREDITS||E===A.LicenseType.TOKENS)){H[K]=F}else{H[K]=G[K]}}.bind(this));this._setDrmOptions(H);C.call(this)}if(J){this.fire(z.DRM_OPTIONS_CHANGED,{value:H})}}else{if(this._drmDefinition&&this._drmDefinition.error){this._setDrmOptions(null);this.$.drmConfigError.classList.remove("hidden")}}}.bind(this))}},behaviors:[DS.SMAProcSP.SPBase,DS.SMAPoweredByViews.ADReduxBehaviour]});DS.SMAPoweredByViews.ADCustomDRMFields.EVENTS=z});