(function(B){var L=null,j=null,r=null,y=null,C=null,K=null,o=null,s=null,F=null,k=null,H=null,d=null,v=null,A=null,q=null,h=null,E=null,t=null,m=null,l=null,b=null,i=null,c=null,G=null,J=null,z=null,f=null,D=null,e=null,w=null,p=null,I=null,n=null,u="commonFiles",g={loading:"loading",error:"error",ready:"ready"},x={uploading:"uploading",in3dx:"in3dx",onDisk:"onDisk",deleting:"deleting"};var a=function(M,P,N){for(var O=(P.length-1);O>=0;O--){this.boundJobActions.removeAllJobInputs(this.jobId,O)}N.forEach(function(R,Q){this.boundJobActions.setJobInputs(this.jobId,[R.id],Q);this.boundJobActions.setJobMainInput(this.jobId,R.id,Q)}.bind(this))};j=function(M){M.stopPropagation();M.cancelBubble=true;var N=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);a.call(this,this.jobId,N,M.detail.allInputs)};r=function(M){M.stopPropagation();M.cancelBubble=true;if(M.detail.inputs){this._selectedInputs=M.detail.inputs;if(M.detail.inputs.length===1&&typeof(M.detail.remove)!=="undefined"){if(!M.detail.remove){this.boundJobActions.addJobInput(this.jobId,M.detail.inputs[0])}else{this.boundJobActions.removeJobInput(this.jobId,M.detail.inputs[0])}}else{this.boundJobActions.setJobInputs(this.jobId,M.detail.inputs)}}};L=function(N){N.stopPropagation();N.cancelBubble=true;if(N.detail.inputs&&N.detail.inputs.length>0){for(var M=0;M<N.detail.inputs.length;M++){this._ADFileUtils.downloadFile(this.store,N.detail.inputs[M],N.detail.zip)}}};K=function(P){var O=P.detail.itemId,M=P.detail.multiple,N=this.$.fileChooser;O?N.containerId=O:N.containerId=null;M?N.multiple=M:N.multiple=null;this._recentUploads=[];this._recentUploadsCommon=[];N.showChooser()};o=function(P){var O=P.detail.itemId,M=P.detail.multiple,N=this.$.fileChooserCommon;O?N.containerId=O:N.containerId=null;M?N.multiple=M:N.multiple=null;this._recentUploads=[];this._recentUploadsCommon=[];N.showChooser()};s=function(M){var N={};M.stopPropagation();M.cancelBubble=true;N.file=M.detail.inputs[0];N.jobId=this.jobId;N.status=x.in3dx;this.fire("viewfile",N)};k=function(N){N.stopPropagation();N.cancelBubble=true;N.preventDefault();var M=N.currentTarget.getAttribute("tableId");this._ADDropZone.createDropZone({store:this.store,dashboardContentCallBack:function(O){if(O&&O.displayName){if(M===u){this._recentUploadsCommon.push(O.displayName)}else{this._recentUploads.push(O.displayName)}}this._ADFileUtils.addReferencedContent(this.store,O)}.bind(this),localFileCallBack:function(P,O){this._ADFileUtils.uploadFiles(this.store,P);if(O.detail.selectedInputs!==null){this._selectedInputs=O.detail.selectedInputs}if(M===u){this.recentFilesCommon=P}else{this.recentFiles=P}}.bind(this)},N)};H=function(O){O.stopPropagation();O.cancelBubble=true;var M=O.detail.input,N=this.store.getState().domain.study.managedDataRootID;if(M&&M.length>0){M.forEach(function(P){this._recentUploads.push(P.displayName);this.boundMDActions.addReferencedContent(N,P.objectId,P.displayName,P.objectType)}.bind(this))}};y=function(O){var M=O.detail.newId,Q=O.detail.oldId,P;O.stopPropagation();O.cancelBubble=true;P=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);for(var N=0;N<P.length;N++){if(P[N]===Q){this.boundJobActions.removeJobInput(this.jobId,Q,N);this.boundJobActions.setJobInputs(this.jobId,[M],N);this.boundJobActions.setJobMainInput(this.jobId,M,N);break}}};C=function(O){var M=O.detail.newId,Q=O.detail.oldId;O.stopPropagation();O.cancelBubble=true;var P=this._JobSelectors.jobWithID(this.store.getState(),this.jobId);for(var N=0;N<P.inputs.length;N++){if(P.inputs[N]===Q){this.boundJobActions.removeJobInput(this.jobId,Q);this.boundJobActions.addJobInput(this.jobId,M);break}}};I=function(N){var O=this._JobSelectors.batchJobIterations(this.store.getState(),this.jobId);var M={};O.forEach(function(Q,P){if(Q.inputs&&Q.inputs.length>0){M[Q.inputs[0].inputID]=P}});return M[N]};p=function(O){if(O){var N=this._JobSelectors.jobInputs(this.store.getState(),this.jobId,null,true);var M=this._JobSelectors.jobWithID(this.store.getState(),this.jobId,null,true);O.forEach(function(Q){if(N.indexOf(Q)!==-1){var P=I.call(this,Q);this.boundJobActions.removeJobInput(this.jobId,Q,P)}if(M.inputs.indexOf(Q)!==-1){this.boundJobActions.removeJobInput(this.jobId,Q)}}.bind(this))}};F=function(N){var M=N.detail.items,O=[],P;N.stopPropagation();N.cancelBubble=true;if(M&&M.length>0){M.forEach(function(Q){P=this._MDSelectors.managedDataParent(this.store.getState(),Q,false).type;if(P===this._MDSelectors.Types.NVDOCUMENT){O.push(this._MDSelectors.managedDataWithID(this.store.getState(),Q))}else{O.push(this._MDSelectors.managedDataParent(this.store.getState(),Q))}}.bind(this))}this.$.deletePrompt.type=DS.SMAPoweredByViews.ADDeletePrompt.TYPES.FILES;this.$.deletePrompt.isRemove=false;this.$.deletePrompt.items=O;this.$.deletePrompt.deleteCB=p.bind(this);this.$.deletePrompt.showDialog()};t=function(O,M,N){if(O==="inputTable"){this.boundJobActions.addJobInput(this.jobId,M,N);this.boundJobActions.setJobMainInput(this.jobId,M,N)}else{this.boundJobActions.addJobInput(this.jobId,M)}if(Number.isInteger(N)){N++}return N};E=function(M,U,V,Q,S,P){var R=null,N=false,O,T;if(M.type===this._MDSelectors.Types.FILE){if(M.persistenceOperation!==this._Defs.PersistenceOperation.CREATING){if(this._MDSelectors.hasVersions(this.store.getState(),M.id)){R=this._MDSelectors.managedDataChildren(this.store.getState(),M.id);T=R[R.length-1];if(S&&R){for(O=0;O<R.length;O++){if(S.indexOf(R[O].id)!==-1){N=true;break}}if(!N){if(Q&&Q.length>0&&Q.indexOf(U)!==-1&&T.persistenceOperation!==this._Defs.PersistenceOperation.CREATING){P=t.call(this,V,T.id,P);N=true}}}}else{if(S.indexOf(M.id)!==-1){N=true}if(!N){if(Q&&Q.length>0&&Q.indexOf(U)!==-1){P=t.call(this,V,M.id,P);N=true}}}}else{N=true}}return N};m=function(){if(this.recentFiles){[].forEach.call(this.recentFiles,function(M){this._recentUploads.push(M.name)}.bind(this))}if(this.recentFilesCommon){[].forEach.call(this.recentFilesCommon,function(M){this._recentUploadsCommon.push(M.name)}.bind(this))}};n=function(N,O){var M=I.call(this,N);this.boundJobActions.removeJobInput(this.jobId,N,M);this.boundJobActions.setJobInputs(this.jobId,[O],M);this.boundJobActions.setJobMainInput(this.jobId,O,M)};l=function(M,O,N){if(M.indexOf(N.title)!==-1){if((typeof O.persistenceOperation!=="undefined"&&O.persistenceOperation!==this._Defs.PersistenceOperation.CREATING)||typeof O.persistenceOperation==="undefined"){if(N.selectedVersion!==O.id){n.call(this,N.selectedVersion,O.id);N.selectedVersion=O.id}}}};b=function(N,V,Y){var Z,P,U,W,X,O,Q,R=false,T=0,S=[];X=N.title?N.title:N.name;if(Y==="inputTable"){V=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);T=V.length;S=this._recentUploads}else{var M=this._JobSelectors.jobWithID(this.store.getState(),this.jobId);V=M.inputs;T=null;S=this._recentUploadsCommon}O=E.call(this,N,X,Y,S,V,T);R=this._MDSelectors.isFileParentReferenced(this.store.getState(),N.id);Z={id:N.id,selected:O,type:N.type,title:X,referenced:R,modified:N.modified?this._ADDataFormatUtils.formatTimestamp(N.modified).replace(/,/g,""):"",filetype:this._ADDataFormatUtils.getFileType(N)};if(this._MDSelectors.Types.FILE===N.type){if(N.latestVersionInvalid){Z.latestVersionInvalid=true}Z.size=N.size?N.size:"";U=this._MDSelectors.managedDataChildren(this.store.getState(),N.id);W=U[U.length-1];if(U&&U.length>0){U.sort(function(ab,aa){return ab.version-aa.version});Z.versions=[];Z.selectedVersion=W.id;for(P=0;P<U.length;P++){Z.versions.push(U[P]);if((this._selectedInputs&&(this._selectedInputs.indexOf(U[P].id)!==-1))||(V&&V.indexOf(U[P].id)!==-1)){Z.selectedVersion=U[P].id}}l.call(this,S,W,Z)}else{Z.versions="--"}}else{Z.size="--";Z.versions="--"}Q=this._MDSelectors.getFileUploadProgress(this.store.getState(),N);if(N.persistenceOperation===this._Defs.PersistenceOperation.CREATING||Q!==null){Z.status=x.uploading;if(Q){Z.uploadPerc=Math.round((Q.uploaded/Q.total)*100)}}else{if(N.persistenceOperation===this._Defs.PersistenceOperation.DELETING){Z.status=x.deleting}else{Z.status=x.in3dx}}return Z};i=function(R,N){var O,M=[],Q;m.call(this);if(N==="inputTable"){Q=this._JobSelectors.jobInputs(this.store.getState(),this.jobId)}else{var P=this._JobSelectors.jobWithID(this.store.getState(),this.jobId);Q=P.inputs}for(O=0;O<R.length;O++){M.push(b.call(this,R[O],Q,N))}return M};c=function(N,P){var O=this;if(typeof N==="undefined"||N.length!==P.length){return false}var M=function(R){var Q=R.filter(function(S){return S.type===O._MDSelectors.Types.FILE||S.type===O._MDSelectors.Types.FILEVERSION});return Q.sort(function(T,S){if(T.id===S.id){return 0}else{return T.id<S.id?-1:1}}).reduce(function(S,U){var T;T=S+U.persistenceOperation+U.name+U.description+U.size+U.modified;if(typeof(U.uploadProgress)!=="undefined"){T=T+U.uploadProgress.uploaded}return T},"")};return M(N)===M(P)};q=function(){A.call(this,g.ready)};h=function(N){if(N!==null){var M=this.store.getState().domain.managedData.persistenceError;if(M&&(M.code!==this._MDSelectors.ErrorCodes.ADD_REF_CONTENT_EXISTS_ERROR)){this.content={status:g.error,errMsg:M,items:[]}}}};e=function(){var M=this._MDSelectors.allManagedData(this.store.getState(),[this._MDSelectors.Types.FILE]);var N=[];M.forEach(function(O){if(O.name&&O.name.indexOf(".inp")!==-1){N.push(O)}});return N};A=function(M){this.content={status:M,items:i.call(this,e.call(this),"inputTable")};this.commonFiles={status:M,items:i.call(this,this._MDSelectors.allManagedData(this.store.getState(),[this._MDSelectors.Types.FILE]),"commonTable")}};G=function(){var M=this;return new Promise(function(N){require(["DS/SMAPoweredByState/ad-state-domain-jobs/actions","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-managed-data/actions","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-app-alerts/selectors","DS/SMAPoweredByViews/Utils/ADDataFormatUtils","DS/SMAPoweredByViews/Utils/ADFileUtils","DS/SMAPoweredByViews/ad-drop-zone/ADDropZone","DS/SMAPoweredByState/ad-state-app/selectors","DS/UIKIT/Accordion"],function(X,U,P,W,V,Q,Z,Y,S,O,R,T){M._JobActions=X;M._JobSelectors=U;M._MDActions=P;M._MDSelectors=W;M._Defs=V;M._ADDataFormatUtils=Y;M._AlertActions=Q;M._AlertSelectors=Z;M._recentUploads=[];M._recentUploadsCommon=[];M._ADFileUtils=S;M._ADDropZone=O;M._AppSelectors=R;M._Accordian=T;N()})})};d=function(){this.isReady=Promise.resolve().then(this.initReduxBehavior.bind(this)).then(G.bind(this))};f=function(){return this._MDSelectors.allManagedData(this.store.getState())};D=function(){return this._MDSelectors.managedDataPersistenceError(this.store.getState())};J=function(){this.boundMDActions=this.getBoundActions(this._MDActions);this.boundJobActions=this.getBoundActions(this._JobActions);this.boundAlertActions=this.getBoundActions(this._AlertActions)};w=function(M){if(M!==null){(M===false)?this.$.adCreateJobInputs.isTransientWidget=false:this.$.adCreateJobInputs.isTransientWidget=true}};z=function(){this.unsubscribeAll();this.observeStore({select:f.bind(this),onChange:q.bind(this),compareFunc:c.bind(this)});this.observeStore({select:D.bind(this),onChange:h.bind(this)});this.observeStore({select:this._AppSelectors.isTransientWidget,onChange:w.bind(this)})};v=function(){if(this.handler&&this.jobId){this._recentUploads=[];this._recentUploadsCommon=[];this._selectedInputs=[];this.isReady.then(function(){J.apply(this);z.apply(this);var M=this.store.getState();if(M&&M.domain&&M.domain.study&&M.domain.study.managedDataRootID){this.$.adCreateJobInputs.reset();this.$.adCreateJobInputsCommon.reset()}else{this.boundAlertActions.addAlert("unabletoloadinputs","error",null,"SMAPoweredByState.ad-state-domain-managed-data.GET_CONTENT_WS_ERROR")}this.$.fileChooser.store=this.store;this.fire("reduxready",{})}.bind(this))}};B.Polymer({is:"ad-create-batch-job-inputs-container",properties:{isReady:{type:Promise},content:{type:Object},jobId:{type:Object,observer:"handlerOrJobIdChanged"},recentFiles:{type:Array,value:function(){return[]}},recentFilesCommon:{type:Array,value:function(){return[]}},handler:{type:Object,observer:"handlerOrJobIdChanged"}},ready:function(){return d.apply(this,arguments)},handlerOrJobIdChanged:function(){return v.apply(this)},onDownloadContent:function(){return L.apply(this,arguments)},onInputSelect:function(){return j.apply(this,arguments)},onInputSelectcommon:function(){return r.apply(this,arguments)},onSwitchInputVersion:function(){return y.apply(this,arguments)},onSwitchInputVersionCommon:function(){return C.apply(this,arguments)},onShowUploadFiles:function(){return K.apply(this,arguments)},onShowUploadFilesCommon:function(){return o.apply(this,arguments)},onPreviewContent:function(){return s.apply(this,arguments)},onDeleteContent:function(){return F.apply(this,arguments)},onRecentFilesChanged:function(M){M.stopPropagation();M.cancelBubble=true;this.recentFiles=M.detail.files},onRecentFilesChangedCommon:function(M){M.stopPropagation();M.cancelBubble=true;this.recentFilesCommon=M.detail.files},onAdd3DXContent:function(){return H.apply(this,arguments)},onDragEnter:function(){return k.apply(this,arguments)},behaviors:[DS.SMAProcSP.SPBase,DS.SMAPoweredByViews.ADReduxBehaviour]})}(this));