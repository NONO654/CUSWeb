(function(m){var l=null,h=null,A=null,q=null,r=null,w=null,B=null,C=null,s=null,a=null,o=null,y=null,n=null,c=null,p=null,g=null,z=null,x=null,k=null,v=null,u=null,b=null,t=null,j=null,f=null,d=null,e={loading:"loading",error:"error",ready:"ready"},i={uploading:"uploading",in3dx:"in3dx",onDisk:"onDisk",deleting:"deleting"};h=function(D){D.stopPropagation();D.cancelBubble=true;if(D.detail.inputs){this._selectedInputs=D.detail.inputs;if(D.detail.inputs.length===1&&typeof(D.detail.remove)!=="undefined"){if(!D.detail.remove){this.boundJobActions.addJobInput(this.jobId,D.detail.inputs[0])}else{this.boundJobActions.removeJobInput(this.jobId,D.detail.inputs[0])}}else{this.boundJobActions.setJobInputs(this.jobId,D.detail.inputs)}}};l=function(E){E.stopPropagation();E.cancelBubble=true;if(E.detail.inputs&&E.detail.inputs.length>0){for(var D=0;D<E.detail.inputs.length;D++){this._ADFileUtils.downloadFile(this.store,E.detail.inputs[D],E.detail.zip)}}};q=function(G){var F=G.detail.itemId,D=G.detail.multiple,E=this.$.fileChooser;F?E.containerId=F:E.containerId=null;D?E.multiple=D:E.multiple=null;this._recentUploads=[];E.showChooser()};r=function(D){var E={};D.stopPropagation();D.cancelBubble=true;E.file=D.detail.inputs[0];E.jobId=this.jobId;E.status=i.in3dx;this.fire("viewfile",E)};B=function(D){D.stopPropagation();D.cancelBubble=true;D.preventDefault();this._ADDropZone.createDropZone({store:this.store,dashboardContentCallBack:function(E){if(E&&E.displayName){this._recentUploads.push(E.displayName)}this._ADFileUtils.addReferencedContent(this.store,E)}.bind(this),localFileCallBack:function(F,E){this._ADFileUtils.uploadFiles(this.store,F);if(E.detail.selectedInputs!==null){this._selectedInputs=E.detail.selectedInputs}this.recentFiles=F}.bind(this)},D)};C=function(F){F.stopPropagation();F.cancelBubble=true;var D=F.detail.input,E=this.store.getState().domain.study.managedDataRootID;if(D&&D.length>0){D.forEach(function(G){this._recentUploads.push(G.displayName);this.boundMDActions.addReferencedContent(E,G.objectId,G.displayName,G.objectType)}.bind(this))}};A=function(F){var D=F.detail.newId,I=F.detail.oldId,G,H=this._JobSelectors.jobMainInput(this.store.getState(),this.jobId);F.stopPropagation();F.cancelBubble=true;G=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);for(var E=0;E<G.length;E++){if(G[E]===I){this.boundJobActions.removeJobInput(this.jobId,I);this.boundJobActions.addJobInput(this.jobId,D);if(I===H){this.boundJobActions.setJobMainInput(this.jobId,D)}}}};f=function(E){if(E){var D=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);E.forEach(function(F){if(D.indexOf(F)!==-1){this.boundJobActions.removeJobInput(this.jobId,F)}}.bind(this))}};w=function(E){var D=E.detail.items,F=[],G;E.stopPropagation();E.cancelBubble=true;if(D&&D.length>0){D.forEach(function(H){G=this._MDSelectors.managedDataParent(this.store.getState(),H,false).type;if(G===this._MDSelectors.Types.NVDOCUMENT){F.push(this._MDSelectors.managedDataWithID(this.store.getState(),H))}else{F.push(this._MDSelectors.managedDataParent(this.store.getState(),H))}}.bind(this))}this.$.deletePrompt.type=DS.SMAPoweredByViews.ADDeletePrompt.TYPES.FILES;this.$.deletePrompt.isRemove=false;this.$.deletePrompt.items=F;this.$.deletePrompt.deleteCB=f.bind(this);this.$.deletePrompt.showDialog()};c=function(E,D){var J=null,G=false,F,I,H=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);if(E.type===this._MDSelectors.Types.FILE){if(E.persistenceOperation!==this._Defs.PersistenceOperation.CREATING){if(this._MDSelectors.hasVersions(this.store.getState(),E.id)){J=this._MDSelectors.managedDataChildren(this.store.getState(),E.id);I=J[J.length-1];if(H&&J){for(F=0;F<J.length;F++){if(H.indexOf(J[F].id)!==-1){G=true;break}}if(!G){if(this._recentUploads&&this._recentUploads.length>0&&this._recentUploads.indexOf(D)!==-1&&I.persistenceOperation!==this._Defs.PersistenceOperation.CREATING){this.boundJobActions.addJobInput(this.jobId,I.id);G=true}}}}else{if(H.indexOf(E.id)!==-1){G=true}if(!G){if(this._recentUploads&&this._recentUploads.length>0&&this._recentUploads.indexOf(D)!==-1){this.boundJobActions.addJobInput(this.jobId,E.id);G=true}}}}else{G=true}}return G};p=function(){if(this.recentFiles){[].forEach.call(this.recentFiles,function(D){this._recentUploads.push(D.name)}.bind(this))}};d=function(D,E){this.boundJobActions.removeJobInput(this.jobId,D);this.boundJobActions.addJobInput(this.jobId,E)};g=function(D,J){var M,F,I,K,L,E,G,H=false;L=D.title?D.title:D.name;E=c.call(this,D,L);H=this._MDSelectors.isFileParentReferenced(this.store.getState(),D.id);M={id:D.id,selected:E,type:D.type,title:L,referenced:H,modified:D.modified?this._ADDataFormatUtils.formatTimestamp(D.modified).replace(/,/g,""):"",filetype:this._ADDataFormatUtils.getFileType(D)};if(this._MDSelectors.Types.FILE===D.type){if(D.latestVersionInvalid){M.latestVersionInvalid=true}M.size=D.size?D.size:"";I=this._MDSelectors.managedDataChildren(this.store.getState(),D.id);K=I[I.length-1];if(I&&I.length>0){I.sort(function(O,N){return O.version-N.version});M.versions=[];M.selectedVersion=K.id;for(F=0;F<I.length;F++){M.versions.push(I[F]);if((this._selectedInputs&&(this._selectedInputs.indexOf(I[F].id)!==-1))||(J&&J.indexOf(I[F].id)!==-1)){M.selectedVersion=I[F].id}}if(this._recentUploads.indexOf(M.title)!==-1){if((typeof K.persistenceOperation!=="undefined"&&K.persistenceOperation!==this._Defs.PersistenceOperation.CREATING)||typeof K.persistenceOperation==="undefined"){if(M.selectedVersion!==K.id){d.call(this,M.selectedVersion,K.id);M.selectedVersion=K.id}}}}else{M.versions="--"}}else{M.size="--";M.versions="--"}G=this._MDSelectors.getFileUploadProgress(this.store.getState(),D);if(D.persistenceOperation===this._Defs.PersistenceOperation.CREATING||G!==null){M.status=i.uploading;if(G){M.uploadPerc=Math.round((G.uploaded/G.total)*100)}}else{if(D.persistenceOperation===this._Defs.PersistenceOperation.DELETING){M.status=i.deleting}else{M.status=i.in3dx}}return M};z=function(G){var E,D=[],F;p.call(this);F=this._JobSelectors.jobInputs(this.store.getState(),this.jobId);for(E=0;E<G.length;E++){D.push(g.call(this,G[E],F))}return D};x=function(E,G){var F=this;if(typeof E==="undefined"||E.length!==G.length){return false}var D=function(I){var H=I.filter(function(J){return J.type===F._MDSelectors.Types.FILE||J.type===F._MDSelectors.Types.FILEVERSION});return H.sort(function(K,J){if(K.id===J.id){return 0}else{return K.id<J.id?-1:1}}).reduce(function(J,L){var K;K=J+L.persistenceOperation+L.name+L.description+L.size+L.modified;if(typeof(L.uploadProgress)!=="undefined"){K=K+L.uploadProgress.uploaded}return K},"")};return D(E)===D(G)};y=function(){o.call(this,e.ready)};n=function(E){if(E!==null){var D=this.store.getState().domain.managedData.persistenceError;if(D&&(D.code!==this._MDSelectors.ErrorCodes.ADD_REF_CONTENT_EXISTS_ERROR)){this.content={status:e.error,errMsg:D,items:[]}}}};o=function(D){this.content={status:D,items:z.call(this,this._MDSelectors.allManagedData(this.store.getState(),[this._MDSelectors.Types.FILE]))}};k=function(){var D=this;return new Promise(function(E){require(["DS/SMAPoweredByState/ad-state-domain-jobs/actions","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-managed-data/actions","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-app-alerts/selectors","DS/SMAPoweredByViews/Utils/ADDataFormatUtils","DS/SMAPoweredByViews/Utils/ADFileUtils","DS/SMAPoweredByViews/ad-drop-zone/ADDropZone","DS/SMAPoweredByState/ad-state-app/selectors"],function(N,K,G,M,L,H,P,O,J,F,I){D._JobActions=N;D._JobSelectors=K;D._MDActions=G;D._MDSelectors=M;D._Defs=L;D._ADDataFormatUtils=O;D._AlertActions=H;D._AlertSelectors=P;D._recentUploads=[];D._ADFileUtils=J;D._ADDropZone=F;D._AppSelectors=I;E()})})};s=function(){this.isReady=Promise.resolve().then(this.initReduxBehavior.bind(this)).then(k.bind(this))};b=function(){return this._MDSelectors.allManagedData(this.store.getState())};t=function(){return this._MDSelectors.managedDataPersistenceError(this.store.getState())};v=function(){this.boundMDActions=this.getBoundActions(this._MDActions);this.boundJobActions=this.getBoundActions(this._JobActions);this.boundAlertActions=this.getBoundActions(this._AlertActions)};j=function(D){if(D!==null){(D===false)?this.$.adCreateJobInputs.isTransientWidget=false:this.$.adCreateJobInputs.isTransientWidget=true}};u=function(){this.unsubscribeAll();this.observeStore({select:b.bind(this),onChange:y.bind(this),compareFunc:x.bind(this)});this.observeStore({select:t.bind(this),onChange:n.bind(this)});this.observeStore({select:this._AppSelectors.isTransientWidget,onChange:j.bind(this)})};a=function(){if(this.handler&&this.jobId){this._recentUploads=[];this._selectedInputs=[];this.isReady.then(function(){v.apply(this);u.apply(this);var D=this.store.getState();if(D&&D.domain&&D.domain.study&&D.domain.study.managedDataRootID){this.$.adCreateJobInputs.reset()}else{this.boundAlertActions.addAlert("unabletoloadinputs","error",null,"SMAPoweredByState.ad-state-domain-managed-data.GET_CONTENT_WS_ERROR")}this.$.fileChooser.store=this.store;this.fire("reduxready",{})}.bind(this))}};m.Polymer({is:"ad-create-job-inputs-container",properties:{isReady:{type:Promise},content:{type:Object},jobId:{type:Object,observer:"handlerOrJobIdChanged"},recentFiles:{type:Array,value:function(){return[]}},handler:{type:Object,observer:"handlerOrJobIdChanged"}},ready:function(){return s.apply(this,arguments)},handlerOrJobIdChanged:function(){return a.apply(this)},onDownloadContent:function(){return l.apply(this,arguments)},onInputSelect:function(){return h.apply(this,arguments)},onSwitchInputVersion:function(){return A.apply(this,arguments)},onShowUploadFiles:function(){return q.apply(this,arguments)},onPreviewContent:function(){return r.apply(this,arguments)},onDeleteContent:function(){return w.apply(this,arguments)},onRecentFilesChanged:function(D){D.stopPropagation();D.cancelBubble=true;this.recentFiles=D.detail.files},onAdd3DXContent:function(){return C.apply(this,arguments)},onDragEnter:function(){return B.apply(this,arguments)},behaviors:[DS.SMAProcSP.SPBase,DS.SMAPoweredByViews.ADReduxBehaviour]})}(this));