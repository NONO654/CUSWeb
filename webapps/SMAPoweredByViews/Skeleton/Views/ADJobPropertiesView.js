/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/SMAPoweredByViews/Skeleton/Views/ADJobPropertiesView",["UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView","DS/Redux/Redux","DS/SMAPoweredByState/ad-state-store","DS/SMAPoweredByState/ad-state-redux-observer","DS/SMAPoweredByHandler/ADHandlerFactory","DS/SMAPoweredByState/ad-state-cos/selectors","DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-domain-jobs/actions","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","WebappsUtils/WebappsUtils","DS/SMAPoweredByState/ad-state-loading-utils","DS/SMAPoweredByViews/Utils/ADDataFormatUtils"],function(r,t,e,l,m,b,k,v,p,q,i,c,h,g){var j,u,f={BAD_CHARACTER_IN_PROPERTY:"SMAPoweredByViews.Skeleton.ADJobPropertiesView.BAD_CHARACTER_IN_PROPERTY"},d="Local Private Station";var o=function(){j=e.bindActionCreators(p,this._store.dispatch);u=e.bindActionCreators(v,this._store.dispatch)},s=function(w){if(w){b.getHandler({jobTypeId:w.jobType,store:this._store}).then(function(I){var x=i.jobTypeWithID(this._store.getState(),w.jobType),J=x!==null&&typeof x.title!=="undefined"?x.title:"",z=w.configuration?g.getCommandLinePreview(w.configuration):"",C=q.jobOwner(this._store.getState(),w.id),L=g.getFormattedJobData(w,I.getJobTile(w.id,this._store.getState()).stepsMapping),G=L.status,K=q.jobWorkDirectory(this._store.getState(),w.id),B=K!==null&&typeof K.path!=="undefined"?K.path:"",A=q.jobExecutionOptions(this._store.getState(),w.id),F,E,y;if(I.Selectors.commandPreview){z=I.Selectors.commandPreview(this._store.getState(),w.id)}if(A&&A.station&&A.station==="{localhost}"){y=d}else{F=k.serverWithID(this._store.getState(),A.server);E=k.stationWithID(this._store.getState(),F,A.station);y=E!==null&&typeof E.name!=="undefined"?E.name:""}var H,D;if(typeof this._jobTitle!=="undefined"&&w.title===this._jobTitle){H=this.pres.$.jobTitle.value}else{H=w.title;this._jobTitle=w.title}if(typeof this._jobDescription!=="undefined"&&w.description===this._jobDescription){D=this.pres.$.jobDescription.value}else{D=w.description;this._jobDescription=w.description}this.pres.job={title:H,description:D,jobType:J,command:z,owner:C,status:G,started:w.started?g.formatTimestamp(w.started):"",ended:w.ended?g.formatTimestamp(w.ended):"",station:y,workDir:B};this.pres.parentElement.dispatchEvent(new CustomEvent("jobLoaded"))}.bind(this))}else{this.pres.parentElement.dispatchEvent(new CustomEvent("jobLoaded"))}},n=function(){var w=function(x){return q.jobWithID(x,this.model.id)};if(!this._observer){this._observer=new m();this._observer.observeStore({store:this._store,select:w.bind(this),onChange:s.bind(this)})}},a=function(){var w=DS.SMAPoweredByViews.ADJobProperties.EVENTS;this.pres.addEventListener(w.JOB_TITLE_CHANGED,function(x){if(q.jobWithID(this._store.getState(),this.model.id).title!==x.detail.value&&window.DS.SMAProcSP.SPBase.isValidString(x.detail.value,window.DS.SMAProcSP.SPBase.TYPESTRINGS.PROCESSNAME)){j.setJobTitle(this.model.id,x.detail.value)}else{if(q.jobWithID(this._store.getState(),this.model.id).title!==x.detail.value){u.addAlert("Job Properties","error",null,f.BAD_CHARACTER_IN_PROPERTY)}}}.bind(this));this.pres.addEventListener(w.JOB_DESCRIPTION_CHANGED,function(x){if(q.jobWithID(this._store.getState(),this.model.id).description!==x.detail.value&&window.DS.SMAProcSP.SPBase.isValidString(x.detail.value)){j.setJobDescription(this.model.id,x.detail.value)}else{if(q.jobWithID(this._store.getState(),this.model.id).description!==x.detail.value){u.addAlert("Job Properties","error",null,f.BAD_CHARACTER_IN_PROPERTY)}}}.bind(this))};return t.extend({tagName:"div",id:"jobPropertiesView",className:"jobPropertiesView",render:function(){var w=c.getWebappsBaseUrl()+"SMAPoweredByViews/ad-job-properties/ad-job-properties.html";h.loadWebComponent(w,"DS.SMAPoweredByViews.ADJobProperties",function(){this.pres=r.createElement("ad-job-properties");this.pres.readonly=this.model.get("readOnly");this.container.setContent(this.pres);this._store=l.getStore();o.apply(this);n.apply(this);a.apply(this);return this}.bind(this))},onDestroy:function(){if(this._observer){this._observer.unsubscribeAll()}}})});