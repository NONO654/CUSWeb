/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/SMAPoweredByViews/Skeleton/Views/ADFileHistoryView",["UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView","DS/Redux/Redux","DS/SMAPoweredByState/ad-state-store","DS/SMAPoweredByState/ad-state-redux-observer","DS/SMAPoweredByState/ad-state-domain-managed-data/actions","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-domain-study/selectors","WebappsUtils/WebappsUtils","DS/SMAPoweredByState/ad-state-loading-utils","DS/SMAPoweredByViews/Utils/ADFileUtils"],function(q,r,e,l,m,p,g,j,d,i,h){var c;var o=function(){c=e.bindActionCreators(p,this._store.dispatch)},f=function(u,t){if(typeof u==="undefined"||u.length!==t.length){return false}var s=function(v){return v.sort(function(x,w){if(x.id===w.id){return 0}else{return x.id<w.id?-1:1}}).reduce(function(w,x){return w+x.version+x.modified+x.comments+x.persistenceOperation},"")};return s(u)===s(t)},a=function(s){if(s){this.component.fileVersions=s;this.component.latestVersion=this.model.get("latestVersion");this.component.latestVersionInvalid=this.model.get("latestVersionInvalid")}},k=function(s){this.component.isReadOnly=s},n=function(){if(!this._observer){this._observer=new m()}var s=function(u){var t=this.model.id;return g.managedDataChildren(u,t)};this._observer.observeStore({store:this._store,select:s.bind(this),compareFunc:f,onChange:a.bind(this)});this._observer.observeStore({store:this._store,select:j.isReadOnly,onChange:k.bind(this)})},b=function(){this.component.addEventListener("commentsChanged",function(u){var s=u.detail.fileVersion.id,t=u.detail.newComment;c.setFileVersionComments(s,t)});this.component.addEventListener("downloadVersion",function(t){var s=t.detail.fileVersion.id;h.downloadFile(this._store,s,t.detail.zip)}.bind(this));this.component.addEventListener("deleteVersion",function(t){var s=t.detail.fileVersion.id;h.deleteFileVersion(this._store,s)}.bind(this))};return r.extend({tagName:"div",id:"fileHistoryView",className:"fileHistoryView",render:function(){this.component=q.createElement("ad-file-history");this.container.setContent(this.component);this._store=l.getStore();o.apply(this);n.apply(this);b.apply(this);return this},onDestroy:function(){if(this._observer){this._observer.unsubscribeAll()}}})});