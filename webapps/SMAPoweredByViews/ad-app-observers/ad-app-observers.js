/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
(function(){var t,f,m,j,s,c,r,g,k,q,u,d,a="not_set",i=function(){return new Promise(function(w){require(["DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-app-alerts/selectors","DS/SMAPoweredByState/ad-state-app/selectors","DS/SMAPoweredByState/ad-state-domain-connector-definitions/selectors","DS/SMAPoweredByState/ad-state-cos/selectors","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-domain-study/selectors","DS/SMAPoweredByState/ad-state-domain-study-templates/selectors","DS/SMAPoweredByState/ad-state-domain-work-data/selectors","i18n!DS/SMAPoweredByViews/assets/nls/ADAppObservers"],function(A,F,B,H,D,G,E,I,z,y,C,x){t=A;f=F;m=B;s=H;j=D;r=E;c=G;g=I;k=z;q=y;u=C;d=x;w()})})},l=function(x){var w=r.newlyFailedJobs(x,this._oldFailedJobs);this._oldFailedJobs=r.allJobs(x);return w.length>0?w:null},e=function(x){var w=r.newlyCompletedJobs(x,this._oldCompletedJobs);this._oldCompletedJobs=r.allJobs(x);return w.length>0?w:null},h=function(w){if(w&&w.length>0){w.forEach(function(z){var y=null,C=f.Level.ERROR,A=z.title,x=null;if(z.configuration&&z.configuration.attachToJobID){var B=r.jobWithID(this.store.getState(),z.configuration.attachToJobID);A=B.title;if(z.kind===r.JobKind.GENERATE_RESULT){x=this.AlertCodes.GENERATE_RESULTS_FAILED}else{if(z.kind===r.JobKind.UPLOAD){x=this.AlertCodes.UPLOADING_FAILED}}}else{if(z.progress&&typeof z.progress.stepsCompleted!=="undefined"){switch(z.progress.stepsCompleted+1){case 0:case 1:x=this.AlertCodes.JOB_FAILED_INITIALIZING;break;case 2:x=this.AlertCodes.JOB_FAILED_SOLVING;break;case 3:case 4:case 5:x=this.AlertCodes.JOB_FAILED_SAVING;break;default:x=this.AlertCodes.JOB_FAILED_UNKNOWN;break}}else{x=this.AlertCodes.JOB_FAILED_UNKNOWN}}this.boundActionsAlerts.addAlert(y,C,A,x)}.bind(this))}},v=function(w){if(w&&w.length>0){w.forEach(function(z){var y=null,B=f.Level.SUCCESS,A=z.title,x=this.AlertCodes.JOB_COMPLETED;this.boundActionsAlerts.addAlert(y,B,A,x)}.bind(this))}},p=function(){this.boundActionsAlerts=this.getBoundActions(t)},b=function(x){var w=g.uploadingFiles(x);return w&&w.length>0},o=function(y){var w=m.isAppInitialized(y),z=m.appPersistenceOperation(y),x=a;if(w&&z===null){x=m.securityContext(y)}return x},n=function(){this.observeStore({select:m.appPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:j.serversPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:j.stationsPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:s.connectorDefinitionsPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:c.jobTypesPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:r.jobsPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:g.managedDataPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:k.studyPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:q.studyTemplatesPersistenceError,onChange:"persistenceErrorChanged"});this.observeStore({select:u.workDataPersistenceError,onChange:"persistenceErrorChanged"});this._oldFailedJobs=r.allJobs(this.store.getState());this.observeStore({select:l.bind(this),onChange:"jobFailed"});this._oldCompletedJobs=r.allJobs(this.store.getState());this.observeStore({select:e.bind(this),onChange:"jobCompleted"});this.observeStore({select:b,onChange:"isUploadingChanged"});this.observeStore({select:k.isReadOnly,onChange:"studyReadOnlyChanged"});this.observeStore({select:m.isTransientWidget,onChange:"isTransientWidgetChanged"});this.observeStore({select:o,onChange:"securityContextChanged"})};DS.SMAPoweredByViews=DS.SMAPoweredByViews||{};DS.SMAPoweredByViews.ADAppObservers=window.Polymer({is:"ad-app-observers",properties:{},ready:function(){this.isReady=Promise.resolve().then(this.initReduxBehavior.bind(this)).then(i.bind(this)).then(p.bind(this)).then(n.bind(this))},persistenceErrorChanged:function(w){if(w){var y=null,A=w.errorLvl?w.errorLvl:f.Level.ERROR,z=w.context,x=w.code;this.boundActionsAlerts.addAlert(y,A,z,x)}},jobFailed:function(w){h.apply(this,[w])},jobCompleted:function(w){v.apply(this,[w])},isUploadingChanged:function(w){if(w){window.addEventListener("beforeunload",this.onBeforeUnload)}else{window.removeEventListener("beforeunload",this.onBeforeUnload)}},studyReadOnlyChanged:function(y){if(y){var x=null,A=f.Level.WARNING,z=null,w=this.AlertCodes.STUDY_READ_ONLY;this.boundActionsAlerts.addAlert(x,A,z,w)}},isTransientWidgetChanged:function(A){if(A){var x=null,z=f.Level.INFO,y=null,w=this.AlertCodes.IS_TRANSIENT_WIDGET;this.boundActionsAlerts.addAlert(x,z,y,w)}},securityContextChanged:function(y){if(!y){var x=null,A=f.Level.ERROR,z=null,w=this.AlertCodes.NO_SECURITY_CONTEXT_SET;this.boundActionsAlerts.addAlert(x,A,z,w)}},onBeforeUnload:function(w){w.returnValue=d.LeavePageWarning;return d.LeavePageWarning},AlertCodes:{JOB_COMPLETED:"SMAPoweredByViews.ad-app-observers.JOB_COMPLETED",JOB_FAILED_INITIALIZING:"SMAPoweredByViews.ad-app-observers.JOB_FAILED_INITIALIZING",JOB_FAILED_SOLVING:"SMAPoweredByViews.ad-app-observers.JOB_FAILED_SOLVING",JOB_FAILED_SAVING:"SMAPoweredByViews.ad-app-observers.JOB_FAILED_SAVING",JOB_FAILED_UNKNOWN:"SMAPoweredByViews.ad-app-observers.JOB_FAILED_UNKNOWN",GENERATE_RESULTS_FAILED:"SMAPoweredByViews.ad-app-observers.GENERATE_RESULTS_FAILED",UPLOADING_FAILED:"SMAPoweredByViews.ad-app-observers.UPLOADING_FAILED",STUDY_READ_ONLY:"SMAPoweredByViews.ad-app-observers.STUDY_READ_ONLY",IS_TRANSIENT_WIDGET:"SMAPoweredByViews.ad-app-observers.IS_TRANSIENT_WIDGET",NO_SECURITY_CONTEXT_SET:"SMAPoweredByViews.ad-app-observers.NO_SECURITY_CONTEXT_SET"},behaviors:[DS.SMAProcSP.SPBase,DS.SMAPoweredByViews.ADReduxBehaviour]})}(this));