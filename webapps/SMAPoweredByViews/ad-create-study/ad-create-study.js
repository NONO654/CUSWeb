/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/SMAPoweredByViews/ad-create-study/ad-create-study",["DS/SMAProcSP/PolymerLoader","DS/SMAPoweredByViews/ad-redux-behaviour/ReduxBehaviour","DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-app-alerts/selectors","DS/SMAPoweredByState/ad-state-domain-study/actions","DS/SMAPoweredByState/ad-state-domain-study/selectors","DS/SMAPoweredByState/ad-state-domain-study-templates/selectors","UWA/Drivers/Alone","DS/UIKIT/Spinner","text!DS/SMAPoweredByViews/ad-create-study/ad-create-study.html","i18n!DS/SMAPoweredByViews/assets/nls/ADCreateStudy","DS/SMAProcSP/import!../../SMAProcSP/sp-base/sp-base.html","css!DS/UIKIT/UIKIT.css"],function(l,f,a,m,j,e,b,h,c,d,k){var i={STUDY_TEMPLATE_NOT_FOUND:"SMAPoweredByViews.ad-create-study.STUDY_TEMPLATE_NOT_FOUND",CREATE_STUDY_FAILED:"SMAPoweredByViews.ad-create-study.CREATE_STUDY_FAILED",INVALID_STRING:"SMAPoweredByViews.ad-create-study.INVALID_STRING"},g=window.onkeydown;l.register(d);return window.Polymer({is:"ad-create-study",properties:{isOpen:{type:Boolean,value:false,observer:"_isOpenChanged"},studyTitle:{type:String,value:""},studyDescription:{type:String,value:""},isTitleValid:{type:Boolean,value:true,computed:"_computeIsTitleValid(studyTitle)"},isLoading:{type:Boolean,value:true,computed:"_computeIsLoading(studyTemplate)"},isCreating:{type:Boolean,value:false},studyTemplate:{type:Object,value:null,stateSelector:b.emptyStudyTemplate},studyPersistenceOperation:{type:String,value:null,stateSelector:e.studyPersistenceOperation},studyPersistenceError:{type:Object,value:null,stateSelector:e.studyPersistenceError}},observers:["_toggleSpinner(isLoading, isCreating)","_checkDone(isCreating, studyPersistenceOperation, studyPersistenceError)","_checkError(isCreating, studyPersistenceError)"],ready:function(){this.NLS=k;this.$.studyDescriptionInput.placeholder=k.DescriptionPlaceholder},_onKeyDown:function(n){switch(n.keyCode){case 13:if(document.activeElement!==this.$.studyDescriptionInput){this.$.okButton.click()}break;case 27:this.$.closeButton.click();break;default:break}},_reset:function(){this.isCreating=false;this.studyTitle="";this.studyDescription="";window.onkeydown=g},_isOpenChanged:function(n){if(n){this.$.studyTitleInput.focus();window.onkeydown=this._onKeyDown.bind(this)}},_toggleSpinner:function(n,o){if(!this._spinner){this._spinner=new c({renderTo:this.$.spinnerContainer,visible:false})}if(n||o){this._spinner.show()}else{this._spinner.hide()}},_checkDone:function(o,n,p){if(o&&n===null&&!p){this._reset();this.isOpen=false}},_checkError:function(n,o){if(n&&o){this.store.dispatch(a.addAlert("createStudy",m.Level.ERROR,null,i.CREATE_STUDY_FAILED))}},_computeIsTitleValid:function(p){var n=p!=="",o=window.DS.SMAProcSP.SPBase.isValidString(p,window.DS.SMAProcSP.SPBase.TYPESTRINGS.PROCESSNAME);return n&&o},_computeIsLoading:function(n){return !(n&&n.id)},_isOkDisabled:function(p,n,o){return !p||n||o},_computeModalClassList:function(n){return"modal fade"+(n?" show in":"")},_computeBodyClassList:function(n,o){return"modal-body"+(n||o?" loading-mask":"")},_computeTitleInputClassList:function(n){return"form-control"+(n?"":" invalid")},_onStudyTitleInputBlur:function(n){n.stopPropagation();n.cancelBubble=true;if(!this.isTitleValid&&this.studyTitle!==""){this.store.dispatch(a.addAlert("createStudy",m.Level.ERROR,null,i.INVALID_STRING))}},_onOk:function(n){n.stopPropagation();n.cancelBubble=true;if(this.isTitleValid){this.store.dispatch(j.createStudy(this.studyTemplate.id,this.studyTitle,this.studyDescription));this.isCreating=true}},_onClose:function(n){n.stopPropagation();n.cancelBubble=true;this._reset();this.isOpen=false},behaviors:[f]})});