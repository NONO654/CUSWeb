(function(){var C,i,l,A,a,w,m,x,k,r,e,h,c={TIMED_OUT_JOB_TYPES:"SMAPoweredByViews.ad-create-job-container.TIMED_OUT_JOB_TYPES",JOB_STARTING:"SMAPoweredByViews.ad-create-job-container.JOB_STARTING",JOB_STARTED_SUCCESS:"SMAPoweredByViews.ad-create-job-container.JOB_STARTED_SUCCESS"},E=25000,D={onDisk:"onDisk"},d={CREATE_BATCH_JOB:"createBatchJob",CREATE_JOB:"createJob",CLONE_JOB:"cloneJob",IMPORT_JOB:"importJob",RUN_JOB:"runJob"},s={JOB_CREATED:"jobcreated"},j=function(){return new Promise(function(I){require(["DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-app-alerts/selectors","DS/SMAPoweredByState/ad-state-cos/selectors","DS/SMAPoweredByState/ad-state-domain/actions","DS/SMAPoweredByState/ad-state-domain-jobs/actions","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","DS/SMAPoweredByState/ad-state-app-credentials/selectors","DS/SMAPoweredByHandler/ADHandlerFactory","i18n!DS/SMAPoweredByViews/assets/nls/ADCreateJobContainer","DS/SMAPoweredByViews/ad-select-application/ad-select-application"],function(L,P,N,S,J,O,M,R,Q,K){C=L;i=P;l=N;A=S;w=J;x=O;k=M;e=Q;r=R;h=K;I()})})},q=function(){this.$.selectApp.store=this.store;this.$.wizard.store=this.store},u=function(){a=this.getBoundActions(A);m=this.getBoundActions(w)},b=function(I){var J=function(L){var K=(L===null),M=(k.jobTypeWithID(this.store.getState(),I)!==null);return K&&M};return this.waitFor({select:k.jobTypesPersistenceOperation,isResolved:J.bind(this),timeout:E})["catch"](function(){var K=new Error(c.TIMED_OUT_JOB_TYPES);K.code=c.TIMED_OUT_JOB_TYPES;throw K})},F=function(I){return this.waitFor({isResolved:function(J){return J.jobType!==null},select:function(J){return x.jobWithID(J,I)},timeout:E})["catch"](function(){var J=new Error(c.TIMED_OUT_JOB_TYPES);J.code=c.TIMED_OUT_JOB_TYPES;throw J})},n=function(L,J){var I=x.newlyCreatedJobs(L,J);if(I&&I.length===1){return I[0]}else{if(I&&I.length>1){var K=new Error(h.MultipleNewJobError);K.name=x.ErrorCodes.JOB_NOT_FOUND;throw K}else{return null}}},o=function(I,M,O,P){var R=this.store,K=R.getState().domain.study.id,L,J=x.allJobs(R.getState()),Q=O||null,N=P||null;a[M](K,I,Q,N);return this.waitFor({select:function(S){return n(S,J)},isResolved:function(U){L=U;var T=(U!==null&&typeof U.id!=="undefined"),S=(U!==null&&typeof U.persistenceOperation==="undefined");return T&&S},checkError:x.jobsPersistenceError}).then(function(){return{jobId:L.id,jobTypeId:L.jobType}})},z=function(K,M,J,L){var I=L?d.CREATE_BATCH_JOB:d.CREATE_JOB;return b.apply(this,[J]).then(o.bind(this,J,I,K,M))},v=function(J,K,I){return F.apply(this,[I]).then(o.bind(this,I,d.CLONE_JOB,J,K))},y=function(J){var I=this.store;return e.getHandler({jobId:J,store:this.store}).then(function(M){var L=k.latestJobTypeWithTitle(I.getState(),M.outputJobTypeTitle),K=k.jobTypeWithID(I.getState(),L);return Promise.resolve(K)})},g=function(K,L){var S=this,P=this.store,J,R=x.jobWithID(P.getState(),K),O=x.DATA_TRANSFER_KEY,N,M,Q,I=(L.status===D.onDisk)?x.jobWorkDirectory(P.getState(),R):null;M=L.title.lastIndexOf(".");if(M>=0){N=L.title.substring(0,M)}else{N=L}Q=K+x.DATA_TRANSFER_DESCRIPTION_SEPARATOR+L.inputID+x.DATA_TRANSFER_DESCRIPTION_SEPARATOR+N+x.DATA_TRANSFER_DESCRIPTION_SEPARATOR+L.status;return y.apply(this,[K]).then(function(T){J=T;Q+=" "+J.description}).then(function(){return o.apply(S,[J.id,d.CREATE_JOB,O,Q])}).then(function(T){if(I){m.setJobExecutionWorkDirectory(T.jobId,I.id)}return Promise.resolve(T)})},B=function(J,I){if(x.isBatchJob(this.store.getState(),I)){m.updateBatchJob(J,I)}else{m.updateJob(J,I)}return this.waitFor({select:function(K){return x.jobPersistenceOperation(K,I)},checkError:function(K){return x.jobPersistenceError(K,I)}})},f=function(L,J){var I=x.newlyStartedJobs(L,J);J=x.allJobs(L);if(I&&I.length===1){return I[0]}else{if(I&&I.length>1){var K=new Error(h.MultipleNewJobError);K.name=x.ErrorCodes.JOB_NOT_FOUND;throw K}else{return null}}},t=function(N,I){var L=this.store,J=null,K=null,M=x.allJobs(L.getState());a.runJob(N,I,J,K);return this.waitFor({select:function(P){var O=x.jobWithID(P,I);return O?O.status:null},isResolved:function(){var O=f(L.getState(),M);return(O&&O.status===x.JobStatus.RUN_ACCEPTED)},checkError:function(O){return x.jobPersistenceError(O,I)}}).then(function(){return f(L.getState(),M)})},H=function(){var K=this.store.getState();var J=x.jobWithID(K,this._jobId),I=l.isRunAsJob(K,J);if(I){return this.waitFor({store:this.store,select:r.credentialsPersistenceOperation})}else{return Promise.resolve()}},G=function(J,I){return B.apply(this,[J,I]).then(H.bind(this)).then(t.bind(this,J,I))},p=function(J,I){m.deleteJobs(J,[I])};DS.SMAPoweredByViews=DS.SMAPoweredByViews||{};DS.SMAPoweredByViews.ADCreateJobContainer=window.Polymer({is:"ad-create-job-container",properties:{},ready:function(){this.isReady=Promise.resolve().then(this.initReduxBehavior.bind(this)).then(j.bind(this)).then(u.bind(this)).then(q.bind(this))},startCreateJob:function(){this.isReady.then(function(){this.$.selectApp.clonedJob=null;this.$.selectApp.isOpen=true}.bind(this))},startCloneJob:function(I){this.isReady.then(function(){var K=x.jobWithID(this.store.getState(),I);var J=x.isBatchJob(this.store.getState(),I);this.$.selectApp.clonedJob=K;this.$.selectApp.isOpen=true;this.$.selectApp.isBatchJob=J}.bind(this))},onApplicationSelected:function(I){if(I.detail.clonedJob){this.cloneJob(I.detail.jobTitle,I.detail.jobDescription,I.detail.clonedJob)}else{this.createNewJob(I.detail.jobTitle,I.detail.jobDescription,I.detail.jobTypeId,I.detail.isBatchJob)}},startGenerateResult:function(I,J){this.$.wizard.startLoading();this.$.wizard.showDialog();this.createImportJob(I,J)},onRunJob:function(){this.runJob()},onCancelCreateJob:function(){if(this.store.getState().domain.study&&this.store.getState().domain.study.id&&this._jobId){p(this.store.getState().domain.study.id,this._jobId)}},createNewJob:function(J,L,I,K){this.$.wizard.jobTypeId=I;this.$.wizard.isBatchJob=K;this.$.wizard.title=J;this.$.selectApp.isCreating=true;z.apply(this,[J,L,I,K]).then(function(M){this._jobId=M.jobId;this.$.wizard.jobId=M.jobId;this.$.wizard.showDialog();this.$.selectApp.isOpen=false;this.$.selectApp.isCreating=false;this.fire(s.JOB_CREATED,{})}.bind(this))["catch"](function(M){this.$.selectApp.isCreating=false;var O=d.CREATE_JOB,Q=i.Level.ERROR,N=M.code||M.name,P=null;this.store.dispatch(C.addAlert(O,Q,P,N))}.bind(this))},cloneJob:function(I,K,J){this.$.wizard.jobTypeId=J.jobType;this.$.wizard.title=I;this.$.wizard.isBatchJob=false;this.$.selectApp.isCreating=true;v.apply(this,[I,K,J.id]).then(function(L){this._jobId=L.jobId;this.$.wizard.jobId=L.jobId;this.$.wizard.jobTypeId=L.jobTypeId;this.$.wizard.showDialog();this.$.selectApp.isOpen=false;this.$.selectApp.isCreating=false;this.fire(s.JOB_CREATED,{})}.bind(this))["catch"](function(L){this.$.selectApp.isCreating=false;var N=d.CLONE_JOB,P=i.Level.ERROR,M=L.code||L.name,O=null;this.store.dispatch(C.addAlert(N,P,O,M))}.bind(this))},createImportJob:function(J,I){var K=x.jobWithID(this.store.getState(),J);this.$.wizard.title=h.GenerateResultFor+" "+K.title;g.call(this,J,I).then(function(L){this._jobId=L.jobId;this.$.wizard.jobTypeId=L.jobTypeId;this.$.wizard.jobId=L.jobId;this.$.wizard.isBatchJob=false;this.$.wizard.stopLoading();this.fire(s.JOB_CREATED,{})}.bind(this))["catch"](function(L){var N=d.IMPORT_JOB,P=i.Level.ERROR,M=L.code||L.name,O=null;this.store.dispatch(C.addAlert(N,P,O,M))}.bind(this))},runJob:function(){this.$.wizard.startLoading();var J=d.RUN_JOB,M=i.Level.INFO,K=null,I=c.JOB_STARTING;this.store.dispatch(C.addAlert(J,M,K,I));var L=this.store.getState().domain.study.id;G.apply(this,[L,this._jobId]).then(function(){this.$.wizard.hideDialog();this.$.wizard.stopLoading();var O=d.RUN_JOB,Q=i.Level.SUCCESS,N=c.JOB_STARTED_SUCCESS,P=null;this.store.dispatch(C.addAlert(O,Q,P,N))}.bind(this))["catch"](function(N){this.$.wizard.stopLoading();var P=d.RUN_JOB,R=i.Level.ERROR,O=N.code||N.name,Q=null;this.store.dispatch(C.addAlert(P,R,Q,O))}.bind(this))},isJobCreationOpen:function(){return(this.$.wizard.jobId!==null)},behaviors:[DS.SMAProcSP.SPBase,DS.SMAPoweredByViews.ADReduxBehaviour],ALERT_CODES:c})}(this));