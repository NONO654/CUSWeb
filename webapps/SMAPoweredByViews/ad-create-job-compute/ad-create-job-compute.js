(function(){var l,i,j,b,c,f={EXECUTION_OPTIONS_CHANGED:"executionoptionschanged",BATCH_CONFIGURATION_CHANGED:"batchconfigurationchanged",REFRESH_COS_SERVERS:"refreshcosservers",SAVE_CREDENTIALS:"savecredentials",REFRESH_STATIONS:"refreshstations"},m={CREDITS:"credits",TOKENS:"tokens",TOKENS_TRADITIONAL:"traditionalTokens"},k={LINEAR:"1",FREQUENCY:"2",LINEAR_DYNAMICS:"3",NONLINEAR:"4",EXPLICIT:"5"},a={SIZE_1:"1",SIZE_2:"2",SIZE_3:"3",SIZE_4:"4",SIZE_5:"5",SIZE_6:"6",SIZE_7:"7"},g={SIZE_1:"1",SIZE_2:"2",SIZE_3:"3",SIZE_4:"4",SIZE_5:"5",SIZE_6:"6",SIZE_7:"7"},e="ComputeCapacity",h="createNew",d=function(){return new Promise(function(n){require(["DS/SMAPoweredByState/ad-state-cos/selectors","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByViews/ad-browser-storage","DS/UIKIT/Input/Number","i18n!DS/SMAPoweredByViews/assets/nls/ADCreateJobCompute"],function(q,s,o,p,r){l=q;i=s;j=o;b=p;c=r;n()})})};DS.SMAPoweredByViews=DS.SMAPoweredByViews||{};DS.SMAPoweredByViews.ADCreateJobCompute=window.Polymer({is:"ad-create-job-compute",properties:{executionOptions:{type:Object,observer:"_bindExecutionOptions"},batchConfiguration:{type:Object,observer:"_bindBatchConfiguration"},jobId:{type:String},cosServers:{type:Object,value:{status:"READY",items:[]},observer:"_bindCosServers"},stations:{type:Object,value:{status:"READY",items:[]},observer:"_bindStations"},os:{type:Object,value:{items:[]},observer:"_bindOS"},workData:{type:Array,value:[],observer:"_bindExecutionDirectories"},cloudComputeNotSupported:{type:Boolean,value:false,observer:"_bindCloudComputeNotSupported"},isTenantIdSet:{type:Boolean,value:true,observer:"_bindCloudComputeNotSupported"},isBatchJob:{type:Boolean,value:false},uvm:{type:Object,value:null},osenabled:{type:Boolean,value:true}},_bindCloudComputeNotSupported:function(){var n=!this.cloudComputeNotSupported&&this.isTenantIdSet;this.$.onCloudOption.checked=n;this.$.onCloudOption.disabled=!n;this.$.onPremisesOption.checked=!n;if(this.isTenantIdSet===false&&!this.cloudComputeNotSupported){this.$.tenantIdError.classList.remove("hidden")}else{this.$.tenantIdError.classList.add("hidden")}},_bindLicensing:function(){if(this.executionOptions){var t=this.executionOptions?this.executionOptions.licenseOptions:null,o=!this.cloudComputeNotSupported&&this.isTenantIdSet;if(o&&t){this.$.licensingSection.classList.remove("hidden")}else{this.$.licensingSection.classList.add("hidden")}if(t&&t.licenseType){var s=(t.licenseType===m.CREDITS||t.licenseType===m.TOKENS),n=(t.licenseType===m.TOKENS),p=localStorage.getItem(j.PreferencePaths.ENABLE_TOKEN_QUEUEING),q=(this.executionOptions.drmMode!==l.DRMMode.CLOUD);this.$.traditionalTokenOption.disabled=!q;this.$.licenseType.value=t.licenseType;this.$.features.value=t.features;this.$.modelSize.value=t.modelSize;this.$.performance.value=t.performance;this.performance=t.performance;this.$.queuingToggle.checked=n?t.queue:(p&&(p==="true"));for(var r=1;r<this.$.modelSize.options.length+1;r++){if(this.uvm&&this.uvm.limits&&this.uvm.limits.svmLimit){this.$["modelSizeOption"+r].disabled=r>this.uvm.limits.svmLimit}else{this.$["modelSizeOption"+r].disabled=false}}if(n){this.$.queueSection.classList.remove("hidden")}else{this.$.queueSection.classList.add("hidden")}if(s){this.$.uvmSection.classList.remove("hidden")}else{this.$.uvmSection.classList.add("hidden")}if(this.uvm&&this.uvm.estimates){this.$.softwareEstimate.value=this.uvm.estimates.softwareRate+" "+t.licenseType;if(t.licenseType===m.CREDITS){this.$.softwareEstimate.value+="/"+c.Hour}this.$.hardwareEstimate.value=this.uvm.estimates.hardwareRate+" "+c.CreditsCost+"/"+c.Hour;this.$.cpuEstimate.value=this.uvm.estimates.cpus}if(this.uvm&&this.uvm.limits&&this.uvm.limits.cpuLimit&&this.executionOptions.drmMode===l.DRMMode.CLOUD){this.$.computeCapacity.textContent=c.get(e,{context:this.uvm.limits.cpuLimit});this.$.computeCapacity.classList.remove("hidden")}else{this.$.computeCapacity.classList.add("hidden")}}else{this.$.uvmSection.classList.add("hidden");this.$.queueSection.classList.add("hidden")}}},_bindCosServers:function(){if(this.executionOptions){var n=(this.cosServers.status==="LOADING"),p=(this.cosServers.status==="ERROR");this.$.cosServersSelect.disabled=n||p;var o=[];if(n){o=[{value:c.Loading,label:c.Loading,isSelected:true}]}else{this.cosServers.items.forEach(function(q){o.push({value:q.id,label:q.isDefault?q.id+" ["+c.Default+"]":q.id,selected:this.executionOptions.server===q.id})}.bind(this))}this.$.cosServersSelect.textContent="";o.map(function(r){var q=document.createElement("option");q.value=r.value;q.textContent=r.label;q.selected=r.selected;this.$.cosServersSelect.appendChild(q)}.bind(this));this._bindDRMs()}},_bindOS:function(){if(this.executionOptions){this.$.operatingSystem.textContent="";if(this.os&&this.os.items){this.os.items.map(function(o){var n=document.createElement("option");n.value=o.value;n.textContent=o.label;n.selected=o.selected;this.$.operatingSystem.appendChild(n)}.bind(this))}}},_bindDRMs:function(){if(this.executionOptions){var s=this.executionOptions.server,o=null,r=null,q,t=false;if(s){for(q=0;q<this.cosServers.items.length;q++){if(s===this.cosServers.items[q].id){o=this.cosServers.items[q];break}}}if(o){this.$.drmMode.textContent="";if(o.drmInfo){var p=o.drmInfo.filter(function(w){return w.name!==l.DRMMode.CLOUD}),v=[],u,n;p.forEach(function(w){u=(w.name===l.DRMMode.FIPER)?c.FiperDRM:(w.displayName?w.displayName:w.name);n=(this.executionOptions.drmMode===w.name)||(p.length===1);v.push({value:w.name,label:u,selected:n});if(n){r=w}}.bind(this));v.map(function(x){var w=document.createElement("option");w.value=x.value;w.textContent=x.label;w.selected=x.selected;this.$.drmMode.appendChild(w)}.bind(this))}}if(o&&o.drmInfo){for(q=0;q<o.drmInfo.length;q++){if((o.drmInfo[q].name!==l.DRMMode.CLOUD)&&(o.drmInfo[q].name!==l.DRMMode.FIPER)){t=true;break}}if(t){this.$.cosDRMs.classList.remove("hidden")}else{this.$.cosDRMs.classList.add("hidden")}}if(r&&(r.name!==l.DRMMode.CLOUD)){if(r.name===l.DRMMode.FIPER){this.$.fiperDRM.classList.remove("hidden");this.$.customDRM.classList.add("hidden")}else{this.$.fiperDRM.classList.add("hidden");this.$.customDRM.classList.remove("hidden")}}else{this.$.fiperDRM.classList.add("hidden");this.$.customDRM.classList.add("hidden")}}},_bindStations:function(){if(this.executionOptions){var n=(this.stations.status==="LOADING"),p=(this.stations.status==="ERROR");this.$.stationsSelect.disabled=n;if(p){this.$.stationsError.textContent=this.stations.errorMessage;this.$.stationsError.classList.remove("hidden")}else{this.$.stationsError.classList.add("hidden")}var o=[];if(n){o=[{value:c.Loading,label:c.Loading,isSelected:true}]}else{if(this.stations){this.stations.items.forEach(function(s){var r=s.name,q=this.executionOptions.station===s.id;if(s.id==="{localhost}"){r=c.PrivateStation}o.push({value:s.id,label:r,selected:q})}.bind(this))}}if(o.length===0){o=[{value:"",label:c.NoStationsFound,selected:true}];this.$.stationsSelect.disabled=true;this.$.noStationsAlert.classList.remove("hidden")}else{this.$.noStationsAlert.classList.add("hidden")}this.$.stationsSelect.textContent="";o.forEach(function(r){var q=document.createElement("option");q.value=r.value;q.textContent=r.label;q.selected=r.selected;this.$.stationsSelect.appendChild(q)}.bind(this));this._bindRunAs()}},_bindRunAs:function(){if(this.executionOptions){var q,p=null,n=null,r=null,o;for(o=0;o<this.cosServers.items.length;o++){q=this.$.cosServersSelect.options[this.$.cosServersSelect.selectedIndex];if(q&&(q.value===this.cosServers.items[o].id)){p=this.cosServers.items[o];break}}if(p){for(o=0;o<p.drmInfo.length;o++){q=this.$.drmMode.options[this.$.drmMode.selectedIndex];if(q&&(q.value===p.drmInfo[o].name)){n=p.drmInfo[o];break}}}if(n){if((n.name===l.DRMMode.FIPER)&&this.stations&&this.stations.items){for(o=0;o<this.stations.items.length;o++){q=this.$.stationsSelect.options[this.$.stationsSelect.selectedIndex];if(q&&(q.value===this.stations.items[o].id)){r=this.stations.items[o];break}}}}this.isReady.then(function(){var s=i.jobOS(this.store.getState(),this.jobId);this.$.credFields.enableRequiredRunAsFields(r,p,(n&&(n.name!==l.DRMMode.FIPER)),(n&&typeof n.error!=="undefined"),s)}.bind(this))}},_bindExecutionDirectories:function(){if(this.executionOptions){var n;this.$.executionDirectoriesSelect.textContent="";n=document.createElement("option");n.value=h;n.textContent=c.CreateNewDirectory;n.selected=(this.executionOptions&&!this.executionOptions.workDirectory);this.$.executionDirectoriesSelect.appendChild(n);if(this.workData){this.workData.forEach(function(p){if(p.type==="execdir"){var o=document.createElement("option");o.value=p.id;o.textContent=p.name;o.selected=(this.executionOptions&&p.id===this.executionOptions.workDirectory);this.$.executionDirectoriesSelect.appendChild(o)}}.bind(this))}}},_updateComputeLocation:function(){if(this.executionOptions){if(this.executionOptions.drmMode===l.DRMMode.CLOUD){this.$.onCloudOption.checked=true;this.$.onPremisesOption.checked=false;if(this.osenabled){this.$.OSSelectorSection.classList.remove("hidden")}else{this.$.OSSelectorSection.classList.add("hidden")}this.$.onCloudSection.classList.remove("hidden");this.$.onPremisesSection.classList.add("hidden")}else{this.$.onCloudOption.checked=false;this.$.onPremisesOption.checked=true;this.$.onCloudSection.classList.add("hidden");this.$.onPremisesSection.classList.remove("hidden")}}},onUpdateCredentials:function(n){var o=n.detail;if(o.windowsPassword!==""||o.linuxPassword!==""){this.fire(f.SAVE_CREDENTIALS,{domainName:o.domainName,windowsUser:o.windowsUser,windowsPassword:o.windowsPassword,linuxUser:o.linuxUser,linuxPassword:o.linuxPassword})}},populateCredentials:function(n){this.$.credFields.populateCredentials(n)},_bindExecutionOptions:function(){if(this.executionOptions){this._updateComputeLocation();this._bindLicensing(this.executionOptions);if(this.executionOptions.drmMode===l.DRMMode.CLOUD){this.$.operatingSystem.value=this.executionOptions.os}this.$.removeExecutionDirectory.checked=this.executionOptions.removeWorkDir;this._bindCosServers();this._bindOS();this._bindStations()}},_bindBatchConfiguration:function(){if(this.batchConfiguration){if(!this._maxBatchSize){this._maxBatchSize=new b({id:"maxBatchSize",name:"maxBatchSize",min:2,max:10000});this._maxBatchSize.inject(this.$.maxBatchSizeContainer)}this.isBatchJob=true;this.$.batchJobFields.classList.remove("hidden");if(this.batchConfiguration.isSequential){this.$.sequentialOption.checked=true;this._maxBatchSize.setDisabled(true)}else{if(this.batchConfiguration.maxBatchSize===0){this.$.allParallelOption.checked=true;this._maxBatchSize.setDisabled(true)}else{this.$.someParallelOption.checked=true;this._maxBatchSize.setValue(this.batchConfiguration.maxBatchSize);this._maxBatchSize.setDisabled(false)}}this._maxBatchSize.addEvent("onChange",this.maxBatchSizeChanged,this)}else{this.isBatchJob=false;this.$.batchJobFields.classList.add("hidden")}},executionOptionsChanged:function(){if(this.uvm&&this.uvm.limits&&this.uvm.limits.pvmLimit&&parseInt(this.$.performance.value)>this.uvm.limits.pvmLimit){this.$.performance.value=String(this.uvm.limits.pvmLimit)}var r=this.$.onCloudOption.checked?l.DRMMode.CLOUD:(this.$.drmMode.options[this.$.drmMode.selectedIndex]?this.$.drmMode.options[this.$.drmMode.selectedIndex].value:null);var o=this.$.cosServersSelect.options[this.$.cosServersSelect.selectedIndex]?this.$.cosServersSelect.options[this.$.cosServersSelect.selectedIndex].value:null;var v=this.$.stationsSelect.options[this.$.stationsSelect.selectedIndex]?this.$.stationsSelect.options[this.$.stationsSelect.selectedIndex].value:null;var t=this.$.executionDirectoriesSelect.options[this.$.executionDirectoriesSelect.selectedIndex]?this.$.executionDirectoriesSelect.options[this.$.executionDirectoriesSelect.selectedIndex].value:null;var p=this.$.onCloudOption.checked?this.$.operatingSystem.options[this.$.operatingSystem.selectedIndex]?this.$.operatingSystem.options[this.$.operatingSystem.selectedIndex].value:null:null;var u=this.$.licenseType.options[this.$.licenseType.selectedIndex]?this.$.licenseType.options[this.$.licenseType.selectedIndex].value:null;var n=this.$.features.options[this.$.features.selectedIndex]?this.$.features.options[this.$.features.selectedIndex].value:null;var s=this.$.modelSize.options[this.$.modelSize.selectedIndex]?this.$.modelSize.options[this.$.modelSize.selectedIndex].value:null;var q={drmMode:r,os:p,server:o,station:v,workDirectory:(t===h)?null:t,removeWorkDir:this.$.removeExecutionDirectory.checked,licenseOptions:{licenseType:u,features:n,modelSize:s,performance:this.$.performance.value,queue:(u===m.TOKENS)?this.$.queuingToggle.checked:false}};if((q.drmMode!==l.DRMMode.CLOUD)&&(q.drmMode!==l.DRMMode.FIPER)){q.drmOptions=this.$.customDRM.drmOptions}if(this.$.licensingSection.classList.contains("hidden")){delete q.licenseOptions}localStorage.setItem(j.PreferencePaths.ENABLE_TOKEN_QUEUEING,(this.$.queuingToggle.checked?"true":"false"));this.fire(f.EXECUTION_OPTIONS_CHANGED,{value:q})},cosServerChanged:function(){var n={drmMode:l.DRMMode.FIPER,os:null,server:this.$.cosServersSelect.options[this.$.cosServersSelect.selectedIndex]?this.$.cosServersSelect.options[this.$.cosServersSelect.selectedIndex].value:null,station:null,workDirectory:null,removeWorkDir:this.$.removeExecutionDirectory.checked,licenseOptions:{licenseType:this.$.licenseType.options[this.$.licenseType.selectedIndex]?this.$.licenseType.options[this.$.licenseType.selectedIndex].value:null,features:this.$.features.options[this.$.features.selectedIndex]?this.$.features.options[this.$.features.selectedIndex].value:null,modelSize:this.$.modelSize.options[this.$.modelSize.selectedIndex]?this.$.modelSize.options[this.$.modelSize.selectedIndex].value:null,performance:this.$.performance.value}};if(this.$.licensingSection.classList.contains("hidden")){delete n.licenseOptions}this.fire(f.EXECUTION_OPTIONS_CHANGED,{value:n})},_performanceChanged:function(o){var p=o.target.value,n=this.executionOptions&&this.executionOptions.licenseOptions?this.executionOptions.licenseOptions.performance:null;if(p!==n){this.executionOptionsChanged()}},maxBatchSizeChanged:function(){this.batchConfiguration.maxBatchSize=parseInt(this._maxBatchSize.getValue());this.fire(f.BATCH_CONFIGURATION_CHANGED,{value:this.batchConfiguration})},batchModeChanged:function(){this.batchConfiguration.isSequential=this.$.sequentialOption.checked;if(this.$.someParallelOption.checked){this.batchConfiguration.maxBatchSize=parseInt(this._maxBatchSize.getValue());this._maxBatchSize.setDisabled(false)}else{if(this.$.allParallelOption.checked){this.batchConfiguration.maxBatchSize=0;this._maxBatchSize.setDisabled(true)}else{this._maxBatchSize.setDisabled(true)}}this.fire(f.BATCH_CONFIGURATION_CHANGED,{value:this.batchConfiguration})},ready:function(){this.isReady=d.call(this).then(this.initReduxBehavior.bind(this)).then(this.$.customDRM.isReady).then(function(){return Promise.resolve()})},refreshCosServers:function(){this.fire(f.REFRESH_COS_SERVERS,{})},refreshStations:function(){this.fire(f.REFRESH_STATIONS,{})},_toggleQueuingPopover:function(){this.$.queuingPopover.classList.toggle("hidden")},_toggleFeaturesPopover:function(){this.$.featuresPopover.classList.toggle("hidden")},_toggleModelSizePopover:function(){this.$.modelSizePopover.classList.toggle("hidden")},_togglePerformancePopover:function(){this.$.performancePopover.classList.toggle("hidden")},_toggleCosServersSelectPopover:function(){this.$.cosServersSelectPopover.classList.toggle("hidden")},_toggleStationsSelectPopover:function(){this.$.stationsSelectPopover.classList.toggle("hidden")},_toggleRemoveExecutionDirectoryPopover:function(){this.$.removeExecutionDirectoryPopover.classList.toggle("hidden")},_toggleBatchConfigurationPopover:function(){this.$.batchConfigurationPopover.classList.toggle("hidden")},behaviors:[DS.SMAProcSP.SPBase,DS.SMAPoweredByViews.ADReduxBehaviour]});DS.SMAPoweredByViews.ADCreateJobCompute.EVENTS=f;DS.SMAPoweredByViews.ADCreateJobCompute.LICENSE_TYPE=m;DS.SMAPoweredByViews.ADCreateJobCompute.FEATURES=k;DS.SMAPoweredByViews.ADCreateJobCompute.MODEL_SIZE=a;DS.SMAPoweredByViews.ADCreateJobCompute.PERFORMANCE=g}());