/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/SMAPoweredByViews/ad-select-application/ad-select-application",["DS/SMAProcSP/PolymerLoader","DS/SMAPoweredByViews/ad-redux-behaviour/ReduxBehaviour","DS/SMAPoweredByState/ad-state-app/selectors","DS/SMAPoweredByState/ad-state-app-alerts/actions","DS/SMAPoweredByState/ad-state-app-alerts/selectors","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","DS/SMAPoweredByState/ad-state-domain-study/selectors","DS/SMAPoweredByViews/ad-browser-storage","UWA/Drivers/Alone","DS/UIKIT/Spinner","DS/Controls/ResponsiveTileView","DS/WebappsUtils/WebappsUtils","text!DS/SMAPoweredByViews/ad-select-application/ad-select-application.html","i18n!DS/SMAPoweredByViews/assets/nls/ADSelectApplication","DS/SMAProcSP/import!../../SMAProcSP/sp-base/sp-base.html","css!DS/UIKIT/UIKIT.css"],function(h,g,n,s,e,b,k,q,A,i,z,a,v,c){var x={RELEASED:"Released",OBSOLETE:"Obsolete"},o=["Abaqus/CAE Launcher","Import Simulation Results"],B=["Abaqus/Standard","Abaqus/Explicit","Abaqus/CAE","Abaqus/Python","Abaqus/Viewer","OS Command"],t={ABAQUS:"SMAPoweredByViews/assets/images/Abaqus48.png",CUSTOM:"SMAPoweredByViews/assets/images/OSCommand48.png"},y={INVALID_STRING:"SMAPoweredByViews.ad-select-application.INVALID_STRING"};var m="Abaqus",j="CloneHeader",d="disable-overlay-mask";function D(G){var F=new Date(Date.now());return G+"-"+F.getFullYear()+"."+F.toLocaleDateString(undefined,{month:"short"})+"."+F.getDate()+" "+F.toLocaleTimeString(undefined,{hour:"numeric",minute:"numeric",second:"numeric",hour12:false})}function C(F){return m.indexOf(F.title)!==-1}function E(F){return m.indexOf(F.title)===-1}function f(K,H,G){var F=G.lifecycleState===x.OBSOLETE,J=m.indexOf(G.title)!==-1,L=J?K:H,I=o.indexOf(G.title)!==-1;return !F&&L&&!I}function p(J,I,K,F){var H=B.indexOf(F.title)!==-1,G=(H&&!J)||(F.lifecycleState!==x.RELEASED&&I)||(!F.isLatestRevision&&K);return !G}function r(F){var G=c.rev+": "+F.revision;if(F.isLatestRevision){G+=" ("+c.Latest+")"}G+=", "+F.lifecycleState;return G}function u(F){var G;G=document.getElementById(this.selectedJobTypeID);if(G){G.dsModel.unhighlight()}G=document.getElementById(F);if(G){G.dsModel.highlight()}this.selectedJobTypeID=F}function l(F){if(m.indexOf(F)!==-1){return a.getWebappsBaseUrl()+t.ABAQUS}else{return a.getWebappsBaseUrl()+t.CUSTOM}}function w(F){var G=new z({domId:F.id,title:F.title,description:F.description,subtitle:r(F),picture:l(F.title),customTooltip:c.Revision+" "+F.revision+" : "+F.revisionComments,clickableTitle:true});G.getContent().setStyle("width","250px");G.getContent().setStyle("margin-bottom","5px");G.getContent().setStyle("margin-right","10px");G.elements.picture.style.backgroundSize="auto";if(!G.elements.container.dsModel){G.elements.container.dsModel=G}return G}h.register(v);return window.Polymer({is:"ad-select-application",properties:{isOpen:{type:Boolean,value:false,observer:"_isOpenChanged"},studyTitle:{type:String,value:"",stateSelector:function(F){var G=k.studyObject(F);return G?G.title:""}},jobTitle:{type:String,value:""},jobDescription:{type:String,value:""},clonedJob:{type:Object,value:null},isTitleValid:{type:Boolean,value:true,computed:"_computeIsTitleValid(jobTitle)"},isLoading:{type:Boolean,value:true,computed:"_computeIsLoading(appPersistenceOperation, isJobTypesInitialized)"},showExamples:{type:Boolean,value:true},showReleasedOnly:{type:Boolean,value:true},showLatestOnly:{type:Boolean,value:true},isCreating:{type:Boolean,value:false},hasAbaqusStudyLicense:{type:Boolean,value:null,stateSelector:function(F){return n.hasLicense(F,n.AppLicenses.ABAQUS_STUDY)}},hasSimulationCompanionLicense:{type:Boolean,value:null,stateSelector:function(F){return n.hasLicense(F,n.AppLicenses.SIMULATION_COMPANION)}},appPersistenceOperation:{type:String,value:null,stateSelector:n.appPersistenceOperation},isJobTypesInitialized:{type:Boolean,value:null,stateSelector:b.isJobTypesInitialized},allJobTypes:{type:Array,value:null,stateSelector:b.allJobTypes,arrayCompare:true},accessibleJobTypes:{type:Array,value:null,computed:"_computeAccessibleJobTypes(isLoading, hasAbaqusStudyLicense, hasSimulationCompanionLicense, allJobTypes)"},displayedCustomJobTypes:{type:Array,value:null,computed:"_computeDisplayedCustomJobTypes(isLoading, hasSimulationCompanionLicense, showExamples, showReleasedOnly, showLatestOnly, accessibleJobTypes)"},selectedJobTypeID:{type:String,value:null,observer:"_onSelectedJobTypeIDChanged"},clonedJobId:{type:String,value:null},isBatchJob:{type:Boolean,value:false,observer:"_batchJobFlagChanged"}},observers:["_toggleSpinner(isLoading, isCreating)","_renderJobTypes(accessibleJobTypes, displayedCustomJobTypes)"],ready:function(){this.NLS=c;var F=localStorage.getItem("BatchJobEnabled");if(F==="true"){this.$.selectBatchJob.classList.remove("LAFunction")}this.$.jobDescriptionInput.placeholder=c.JobDescriptionPlaceholder;this.showExamples=localStorage[q.PreferencePaths.SHOW_EXAMPLES]!=="false";this.showReleasedOnly=localStorage[q.PreferencePaths.SHOW_RELEASED_ONLY]!=="false";this.showLatestOnly=localStorage[q.PreferencePaths.SHOW_LATEST_ONLY]!=="false";this.selectedJobTypeID=localStorage[q.PreferencePaths.LAST_SELECTED_JOB_TYPE_ID]},_isOpenChanged:function(F){if(F){this.jobTitle=D(this.studyTitle);this.jobDescription="";if(this.clonedJob){u.call(this,this.clonedJob.jobType)}this.$.jobTitleInput.focus();this.$.jobTitleInput.select()}},_toggleSpinner:function(F,G){if(!this._spinner){this._spinner=new i({renderTo:this.$.spinnerContainer,visible:false})}if(F||G){this._spinner.show()}else{this._spinner.hide()}},_computeHeader:function(F){return F?c.get(j,{title:F.title}):c.NewHeader},_computeSelectApplicationOverlayClass:function(F){return F?d:""},_computeIsLoading:function(G,F){return G!==null||!F},_computeIsTitleValid:function(H){var F=H!=="",G=window.DS.SMAProcSP.SPBase.isValidString(H,window.DS.SMAProcSP.SPBase.TYPESTRINGS.PROCESSNAME);return F&&G},_computeIsNextDisabled:function(I,F,G,H){return !I||F||G||!H},_computeAccessibleJobTypes:function(F,H,G,J){var I=null;if(!F&&J&&J.length>0){I=J.filter(f.bind(this,H,G))}return I},_computeDisplayedCustomJobTypes:function(G,I,J,H,L,K){var F=null;if(!G&&K&&K.length>0&&I){F=K.filter(E).filter(p.bind(this,J,H,L))}return F},_computeModalClassList:function(F){return"modal fade"+(F?" show in":"")},_computeBodyClassList:function(F,G){return"modal-body"+(F||G?(" "+d):"")},_computeTitleInputClassList:function(F){return"form-control"+(F?"":" invalid")},_computeIsError:function(F,G){return !F&&(!G||G.length===0)},_computeIsNoCustomApps:function(F,G,H){return !F&&G&&(H&&H.length>0)&&(H.filter(E).length===0)},_computeIsAllCustomAppsFiltered:function(G,H,I,F){return !G&&H&&(I&&I.length>0)&&(I.filter(E).length!==0)&&(!F||F.length===0)},_renderJobTypes:function(J,F){var H=this;H.$.abaqusJobTypesContainer.textContent="";H.$.customJobTypesContainer.textContent="";var I=[],G=function(){I.forEach(function(L){L.unhighlight()})},K=function(L){L.stopPropagation();L.cancelBubble=true;G();this.highlight();H.selectedJobTypeID=this.domId};if(J){J.filter(C).forEach(function(L){var M=w(L);M.addEventListener("click",K.bind(M));I.push(M);if(M.domId===H.selectedJobTypeID){M.highlight()}M.inject(H.$.abaqusJobTypesContainer)})}if(F){F.forEach(function(L){var M=w(L);M.addEventListener("click",K.bind(M));I.push(M);if(M.domId===H.selectedJobTypeID){M.highlight()}M.inject(H.$.customJobTypesContainer)})}},_onSelectedJobTypeIDChanged:function(F){if(F&&localStorage[q.PreferencePaths.LAST_SELECTED_JOB_TYPE_ID]!==F){localStorage[q.PreferencePaths.LAST_SELECTED_JOB_TYPE_ID]=F}},_onJobTitleInputBlur:function(F){F.stopPropagation();F.cancelBubble=true;if(!this.isTitleValid&&this.jobTitle!==""){this.store.dispatch(s.addAlert("selectApplication",e.Level.ERROR,null,y.INVALID_STRING))}},_onShowExamplesChanged:function(F){F.stopPropagation();F.cancelBubble=true;this.showExamples=this.$.showExamplesToggle.checked;localStorage[q.PreferencePaths.SHOW_EXAMPLES]=this.showExamples},_onShowReleasedOnlyChanged:function(F){F.stopPropagation();F.cancelBubble=true;this.showReleasedOnly=this.$.showReleasedOnlyToggle.checked;localStorage[q.PreferencePaths.SHOW_RELEASED_ONLY]=this.showReleasedOnly},_onShowLatestOnlyChanged:function(F){F.stopPropagation();F.cancelBubble=true;this.showLatestOnly=this.$.showLatestOnlyToggle.checked;localStorage[q.PreferencePaths.SHOW_LATEST_ONLY]=this.showLatestOnly},_onNext:function(F){F.stopPropagation();F.cancelBubble=true;if(this.clonedJob){this.fire("next",{jobTitle:this.jobTitle,jobDescription:this.jobDescription,clonedJob:this.clonedJob,isBatchJob:this.isBatchJob})}else{this.fire("next",{jobTitle:this.jobTitle,jobDescription:this.jobDescription,jobTypeId:this.selectedJobTypeID,isBatchJob:this.isBatchJob})}},_onClose:function(F){F.stopPropagation();F.cancelBubble=true;this.isOpen=false},_updateBatchJobOpt:function(G){G.stopPropagation();G.cancelBubble=true;var F=G.currentTarget.querySelector("input");G.currentTarget.classList.add("toggle-primary");F.checked=true;this.isBatchJob=F.id==="batch"},_batchJobFlagChanged:function(F){if(F){this.$.batchRunOuter.classList.add("toggle-primary");this.$.singleRunOuter.classList.remove("toggle-primary")}else{this.$.batchRunOuter.classList.remove("toggle-primary");this.$.singleRunOuter.classList.add("toggle-primary")}this.$.single.checked=!F;this.$.batch.checked=F},behaviors:[g]})});