define("DS/DEL3DLeanCollections/Store.collection",["pluginDS!DS/VENBackbone/backbone.1.3.3/backbone"],function(c){var b=c.Collection.extend({constructor:function a(){c.Collection.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanCollections/Document.collection",["pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","DS/DEL3DLeanModels/documents/DocumentModel"],function(d,c){var b=d.Collection.extend({model:c,constructor:function a(){d.Collection.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanCollections/Collection.manager",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","UWA/Class/Promise","DS/Logger/Logger","DS/DEL3DLeanModels/Model.manager","DS/DEL3DLeanFactory/ModelFactory","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanEnums/Collection.enum"],function(e,l,i,m,j,c,g,h,a,b){var d=null;var f=i.Object.extend({name:"CollectionManager",_logger:null,liveChannel:m.channel("live"),constructor:function f(){i.Object.prototype.constructor.apply(this,arguments)},initialize:function(){this._logger=c.getLogger(f);this.onLiveModelCreationDelegate=$.proxy(this.onLiveModelCreation,this);this.liveChannel.on("model:creation",this.onLiveModelCreationDelegate)},getRelationsFrom:function(p,o){o=o||{collectionType:["statics","floatables"]};return this._getRelationsFrom(p,{filter:o})},getRelationsTo:function(p,o){o=o||{collectionType:["statics","floatables"]};return this._getRelationsTo(p,{filter:o})},getStaticsRelationsFrom:function(o){return this._getRelationsFrom(o,{filter:{collectionType:["statics"]}})},getStaticsRelationsTo:function(o){return this._getRelationsTo(o,{filter:{collectionType:["statics"]}})},getFloatablesRelationsFrom:function(o){return this._getRelationsFrom(o,{filter:{collectionType:["floatables"]}})},getFloatablesRelationsTo:function(o){return this._getRelationsTo(o,{filter:{collectionType:["floatables"]}})},getTasksRelationsFrom:function(o){return this._getRelationsFrom(o,{filter:{collectionType:["tasks"]}})},findModel:function(r,t){if(!t){t=b.getAllCollections()}var q=null;var s=Array.isArray(t)||"object"===typeof t?t:[t];var o=null;for(var p in s){o=s[p];if("string"===typeof o){o=b.getFromType(o);o=o.sessionInstance}q=this._findModelIn(r,o);if(q){return q}}return q},createModel:function(x,u,z,v,w){v=v||{};w=w||a.COORD;var r=u;var o=null;var p=null;var t=null;var q=null;var A=null;var y=null;var s=this;if(e.is(x)){p=g.isModel(x)?x.id:x}if(!e.is(u)){this._logger.warn("model is a mandatory parameter");v.error("Object creation failed");return r}o=function(B){r=s.spyModelSuccess(B);y=g.isOfType(r,{collectionType:"relations"});if(!y&&e.is(p)){t=h.createModel(w,{from:p,to:r.id},{success:function(C){if(v.success){v.success.call(v.context,C,r)}},error:function(){v.error("Database access failed")}});b.RELATIONS.sessionInstance.add(t)}else{if(v.success){v.success.call(v.context,r)}}};if(!g.isModel(r)){q=r.collectionType;r=h.createModel(r,z,{success:o,error:v.error,context:this})}else{q=a.getFromConstructor(r.constructor).collectionType}A=b.getFromType(q);A.sessionInstance.add(r);return r},onLiveModelCreation:function n(r){if(e.is(r)&&e.is(r.serverType)&&e.is(r.attributes)){var q=a.getFromServerType(r.serverType);if(e.is(q)&&e.is(q.modelConstructor)&&e.is(q.collectionType)){var p=new q.modelConstructor(r.attributes,{doNotSend:true});var o=b.getFromType(q.collectionType);if(e.is(p)&&e.is(o)){o.sessionInstance.add(p)}else{this._logger.error("3DLeanLive - Impossible to create and add model")}}else{this._logger.error("3DLeanLive - Wrong serverType retrieved")}}else{this._logger.error("3DLeanLive - Parameters missing for model creation")}},spyModelSuccess:function(o){return o},linkModels:function(r,p,v,x,u){var s=v||a.COORD;var o=g.isModel(r)?r.id:r;var q=g.isModel(p)?p.id:p;var w={from:o,to:q};w=l.extend(w,x);var t=h.createModel(s,w,u);b.RELATIONS.sessionInstance.add(t);return t},removeModel:function(z,B){var A=z instanceof Array?z:[z];var p=B instanceof Array?B:[B];var s=null;var r=null;var u=null;var q=null;var x=null;var w=null;var o=function(D){b.RELATIONS.sessionInstance.remove(D)};var y=function(){};for(var C in A){s=A[C];r="string"===typeof s?s:s.id;for(var v in p){u=p[v];if(u){q="string"===typeof u?u:u.id;w=b.RELATIONS.sessionInstance.findWhere({from:q,to:r});w.destroy({success:o,error:y})}else{x=b.RELATIONS.sessionInstance.where({to:r});for(var t in x){w=x[t];w.destroy({success:o,error:y})}}}}},_findModelIn:function(q,p){var o=p.findWhere({physicalid:q});return o},_getRelationsFrom:function(p,o){o=o||{};o.direction="from";return this._getRelations(p,o)},_getRelationsTo:function(p,o){o=o||{};o.direction="to";return this._getRelations(p,o)},_getRelations:function(q,p){var r=null;var s=null;var u=this;var t=e.getGlobal();var o={fromPid:q,enumerate:b,options:p||{},manager:this};if(!t.sessionLoaded){return new b.RELATIONS.constructor(null,o)}if(!e.is(q)){this._logger.error("pid parameter is mandatory")}s=b.RELATIONS.sessionInstance.filter(function(x){var v=x.get(p.direction==="to"?"to":"from")===q;var w=undefined;if(v===true){w=u.findModel(x.get(p.direction==="to"?"from":"to"))}return v&&w&&g.isOfType(w,p.filter)});r=new b.RELATIONS.constructor(s,o);return r}});function k(){if(!e.is(d)){d=new f()}return d}return k()});define("DS/DEL3DLeanCollections/ACollection.collection",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanHttpRequest/HttpRequest"],function(b,f,c,e){var d=f.Collection.extend({headerParameters:{},urlParameters:{},constructor:function a(){f.Collection.prototype.constructor.apply(this,arguments)},model:function(i){var g=c.getFromServerType(i.type);var j=g.modelConstructor;if(c.STICKYNOTE.modelConstructor===j){var h=i.V_DEL3DL_Category||i["DEL3DL_Sticky_Note.V_DEL3DL_Category"];switch(h){case"ISSUE":j=c.ISSUENOTE.modelConstructor;break;case"ACTION":j=c.TASKNOTE.modelConstructor;break;default:j=c.NOTE.modelConstructor;break}}return j},create:function(m,j){var i=j?b.clone(j):{};var k=i.wait;var g=this;var l=i.success;var h=this._prepareModel(m,i);if(!h){return false}if(!k){this.add(m,i)}i.success=function(p,n,o){if(k){g.add(p,o)}if(l){l.call(o.context,p,n,o)}};if(i.save){h.save(null,i)}return h},sync:function(m,k,j){b.defaults(j||(j={}),{emulateHTTP:f.emulateHTTP,emulateJSON:f.emulateJSON});var n=null;var g=null;var l=null;var i=null;var h=null;n={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};g=n[m];if(!j.url){l=b.result(k,"url")||f.urlError()}h={data:i,type:g,error:j.error,success:j.success,headerParameters:j.headerParameters,urlParameters:j.urlParameters};e.request(l,h)},_prepareModel:function(i,h){if(this._isModel(i)){if(!i.collection){i.collection=this}return i}h=h?b.clone(h):{};h.collection=this;var j=this.model(i,h);var g=new j(i,h);if(!g.validationError){return g}this.trigger("invalid",this,g.validationError,h);return false}});return d});define("DS/DEL3DLeanCollections/Task.collection",["DS/DEL3DLeanCollections/ACollection.collection"],function(a){var b=a.extend({constructor:function c(){a.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanCollections/Static.collection",["DS/DEL3DLeanCollections/ACollection.collection"],function(a){var b=a.extend({constructor:function c(){a.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanCollections/People.collection",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanCollections/ACollection.collection","DS/DEL3DLeanModels/team/Person.model","DS/DEL3DLeanHttpRequest/HttpRequest"],function(k,j,d,h,a,b,c,e,i){var g=c.extend({model:e,headerParameters:function(){var l=d.getGlobal();return{"Content-Type":"application/json","X-DS-CSRFTOKEN":l.sessionToken}},urlParameters:function(){return{embed:"people",tenant:widget.getValue("PlatformID"),select:"members"}},url:function(){var l=d.getGlobal();return"/resources/modeler/pno/collabspace/"+l.privateTeamCollabSpace},constructor:function f(){c.prototype.constructor.apply(this,arguments);this._logger=a.getLogger(g)},loadTeam:function(){var l=d.getGlobal();if(d.is(l)){var q=l.leanSessionManager.get3DLeanSession();if(d.is(q)){if(q.has("V_DEL3DL_Members_Groups")){var p=q.get("V_DEL3DL_Members_Groups")}else{var o=this.url();var m=h.deferred();var n={type:"GET",urlParameters:k.result(this,"urlParameters"),headerParameters:k.result(this,"headerParameters"),success:function(r,s){this._loadPeoples(r,s,m)}.bind(this),error:function(r,s){this._onLoadTeamFailed(r,s,m)}.bind(this)};i.request(o,n)}}}return m.promise},_loadPeoples:function(n,r,m){var o=JSON.parse(n);var p=null;for(var l in o.members){p=o.members[l];var q=this.getOrFetch(p.name);q.initPrivileges(p.couples)}m.resolve(this.models)},_onLoadTeamFailed:function(m,n,l){this._logger.warn(m);l.reject(b.getTranslation("ERR0x00000911"))},loadPeoples:function(m,l){var n=this.getOrFetch(m,l);return n},getPerson:function(m){var l=m||{};l=d.is(l,"object")?l:{name:l};var n=null;if(l.name){n=this.findWhere({login:l.name})}else{if(l.pid){n=this.get(l.pid)}else{if(l.session){n=this.find(function(p){var o=p._sessionInfoCache||{};return o.session===l.session})}}}return n},getOrFetch:function(n,x){var r=this;var p=k.isArray(n);var v=p?n:[n];var u;var s=[];var t=[];var w=undefined;var q=undefined;var l=function(){w.resolve();r.add(q,{merge:true})};x=x||{};for(u in v){var m=v[u];w=h.deferred();if(d.is(m,"string")){if(/^[0-9a-fA-F]{32}$/i.test(m)){m={pid:m}}else{m={name:m}}}if(!m||(!m.name&&!m.pid)){s.push(new this.model());continue}var o=this.findWhere(m);if(o){s.push(o);continue}q=new this.model(m);if(Object.keys(m)[0]==="name"){this.add(q,{merge:true})}s.push(q);q.fetch({success:l,error:w.reject});t.push(w.promise)}if(x.success&&x.error){h.all(t).then(x.success,function(){x.error("Loading person failed")})}return p?s:s[0]},_prepareModel:function(){return j.Collection.prototype._prepareModel.apply(this,arguments)}});return g});define("DS/DEL3DLeanCollections/Floatable.collection",["DS/DEL3DLeanCollections/ACollection.collection"],function(a){var b=a.extend({constructor:function c(){a.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanCollections/Relation.collection",["UWA/Core","DS/DEL3DLeanCollections/ACollection.collection","DS/DEL3DLeanModels/Model.manager"],function(e,a,g){var b=a.extend({_COLLECTIONS:null,_fromPid:null,_options:null,_manager:null,constructor:function i(){a.prototype.constructor.apply(this,arguments)},initialize:function f(l,k){k=k||{};this._COLLECTIONS=k.enumerate;this._fromPid=k.fromPid;this._options=k.options||{};this._manager=k.manager;if(this._COLLECTIONS){this.listenTo(this._COLLECTIONS.RELATIONS.sessionInstance,"add",this.onAdd.bind(this));this.listenTo(this._COLLECTIONS.RELATIONS.sessionInstance,"remove",this.onRemove.bind(this));this.listenTo(this._COLLECTIONS.RELATIONS.sessionInstance,"destroy",this.onRemove.bind(this));this.listenTo(this._COLLECTIONS.RELATIONS.sessionInstance,"reset",this.onReset.bind(this))}},onAdd:function j(m){if(this._fromPid&&e.is(m)){var k=this._fromPid===m.get("from");var l=this._manager.findModel(m.get("to"));var n=e.is(this.findWhere({physicalid:m.get("physicalid")}))&&g.isOfType(l,{collectionType:["floatables"]});if(k&&!n&&g.isOfType(l,this._options.filter)){this.add(m)}}},onRemove:function c(k){this.remove(k)},onReset:function d(){this.reset()},setFromPid:function h(l){var k=null;this._fromPid=l;this.reset();k=this._COLLECTIONS.RELATIONS.sessionInstance.filter(function(o){var m=o.get("from")===this._fromPid;var n=this._manager.findModel(o.get("to"));return m&&g.isOfType(n,this._options.filter)},this);this.set(k,{remove:false})}});return b});