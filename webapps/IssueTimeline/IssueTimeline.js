define("DS/IssueTimeline/IssueTimeline",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","css!DS/IssueTimeline/IssueTimeline.css"],function(e,g,f,c,b,a){var d=e.extend({name:"DS/IssueTimeline/IssueTimeline",tagName:"div",className:"timeline-component",defaultOptions:{parser:""},_logger:null,view:null,_subscriberTokens:[],setup:function(h){var i=this;this._logger=b.getLogger(i.name);this._logger.debug("Initializing the timeline...");h=g.merge(h||{},i.defaultOptions);i._parent(h);i._deferred={};i.isLoaded=new Promise(function(k,j){i._deferred.resolve=k;i._deferred.reject=j});i._subscribers()},render:function(){var h=this;require(["DS/IssueTimeline/views/Rows"],function(j){var i=h.view=new j({physicalId:h.getOption("physicalId"),parser:h.getOption("parser"),parent:h});h.container.setContent(i.render().container);setTimeout(function(){h._deferred.resolve();h.dispatchEvent("onReady",{})},1000)});return h},reset:function(){var h=this;h.isLoaded=new Promise(function(j,i){h._deferred.resolve=j;h._deferred.reject=i});h._subscriberTokens.forEach(function(i){a.unsubscribe(i)});h.view.destroy()},destroy:function(){var h=this;h.reset()},refresh:function(h){var i=this;i.reset();i.setOption("physicalId",h);i.render();return i.isLoaded},resize:function(){var h=this;h.dispatchEvent("onResize")},_subscribers:function(){var h=this;h._subscriberTokens.push(a.subscribe("DS/Object/update",function(i){var j=i.data.paths.reduce(function(l,k){l.push(k.pop());return l},[]);if(j.indexOf(h.getOption("physicalId"))>-1){h.view.destroy();require(["DS/IssueTimeline/views/Rows"],function(l){var k=h.view=new l({physicalId:h.getOption("physicalId"),parser:h.getOption("parser"),parent:h});h.container.setContent(k.render().container)})}}))}});return d});define("DS/IssueTimeline/services/Services",["UWA/Class/Promise","UWA/Core","DS/WAFData/WAFData","DS/IssueServices/services/PlatformServices"],function(e,f,a,d){var c={HEADER_ACCEPT_JSON:"application/json",HEADER_CONTENT_TYPE_JSON:"application/json",TEN_MINUTES:600000};var b={getHistory:function(g){var h={};g.method="GET";h.headers={Accept:c.HEADER_ACCEPT_JSON,"Content-Type":c.HEADER_CONTENT_TYPE_JSON,SecurityContext:"ctx::"+d.getSecurityContext()};h.timeout=c.TEN_MINUTES;return new e(function(j,i){h.onComplete=function(k){if(f.is(k,"string")){k=JSON.parse(k)}j(k)};h.onFailure=function(k){if(f.is(k,"string")){k=JSON.parse(k)}i(k)};a.authenticatedRequest(d.assembleURLFor3DSpace("/resources/issues/"+g.physicalId+"/history",""),h)})}};return b});define("DS/IssueTimeline/models/Entry",["UWA/Class/Model","DS/Logger/Logger","DS/IssueServices/utils/Performance"],function(f,d,e){var c={ICON_BY_ACTION:{"default":"fonticon-info",create:"fonticon fonticon-newspaper",addinterface:"fonticon fonticon-list-add",modify:"fonticon fonticon-arrows-ccw",connect:"fonticon fonticon-flow-branch ",disconnect:"fonticon fonticon-flow-branch ",checkin:"fonticon fonticon-down-circled",checkout:"fonticon fonticon-up-circled",movefiles:"fonticon fonticon-shuffle",promote:"fonticon fonticon-up-bold",demote:"fonticon fonticon-down-bold"},CLASS_BY_STATE:{"default":"primary",Create:"create",Assign:"assign",Active:"active",Review:"review",Closed:"closed"}};var b=0;var a=f.extend({name:"DS/IssueTimeline/models/Entry",defaults:{id:"",physicalId:"",date:"",title:"",action:"",state:"",author:{user:"",fullName:""},content:"",timestamp:0,subEntries:null,icon:"fonticon-info",className:"primary"},_logger:null,setup:function(){var i=this;i._logger=d.getLogger("DS/IssueTimeline/Model");i._logger.debug("Initializing an entry...");e.start(i.name+" setup");i.set("id",b+=1);i.set({timestamp:new Date(i.get("date")).getTime()});var l=require("DS/IssueTimeline/collections/Entries");if(i.get("subEntries")&&Array.isArray(i.get("subEntries"))&&i.get("subEntries").length>0){i.set("subEntries",new l(i.get("subEntries")))}else{i.set("subEntries",null)}var k=i.get("action").trim();var j=i.get("state").trim();var h=c.ICON_BY_ACTION[k]!==undefined?c.ICON_BY_ACTION[k]:c.ICON_BY_ACTION["default"],g=c.CLASS_BY_STATE[j]!==undefined?c.CLASS_BY_STATE[j]:c.CLASS_BY_STATE["default"];i.set({icon:h,className:g});e.end(i.name+" setup")}});return a});define("DS/IssueTimeline/utils/Parser",["UWA/Class/Promise","UWA/Core","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueTimeline/assets/nls/Timeline"],function(f,h,b,a,e,g){var d={ACTIONS:{CREATE:"create",CONNECT:"connect",DISCONNECT:"disconnect",PROMOTE:"promote",DEMOTE:"demote",MODIFY:"modify",CHANGE:"change",ADD:"add"},DESCRIPTION:{REPORTED_AGAINST:"Issue to",RESOLVED_BY:"Resolved To to",DOCUMENT:"Document to ",ASSIGNED:"Assigned"}};var c={parse:function(k,i){var j=this;return j.getAttributes(i.physicalId).then(function(o){var l=[[],[]];o.results[0].data.forEach(function(u){if(u.name==="Priority"){l[0].push(u.name);l[1].push([u.nls,u.value[0]])}else{l[0].push(u.name);l[1].push(u.nls)}});var q=[];var r=[];while(k.length>0&&k[0].action!==d.ACTIONS.CREATE){k.shift()}for(var p=k.length-1;p>-1;p--){var s=k[p];if(j.validEntryByAttribute(s)){var m=new Date(s.date);var t={};t.date=j.getDay(m);t.action=s.action;t.description=s.description;t.state=s.state;t.author={user:s.author.user,fullName:s.author.fullName};t.content=s.description;t.title="";t.subEntries=[];switch(s.action){case d.ACTIONS.CREATE:case d.ACTIONS.PROMOTE:case d.ACTIONS.DEMOTE:t.content=j[s.action](s);t.subEntries=r;r=[];q.unshift(t);break;case d.ACTIONS.MODIFY:var n=j[s.action](k,p,l);p=n[1];t.content=n[0];if(t.content.length>0){r.push(t)}break;case d.ACTIONS.CHANGE:case d.ACTIONS.CONNECT:case d.ACTIONS.DISCONNECT:n=j[s.action](k,p);p=n[1];t.content=n[0];if(t.content.length>0){r.push(t)}break;default:}}}return q})},getAttributes:function(i){var j=this;return new f(function(n,m){var l={};var k="/resources/v1/collabServices/attributes/op/read";l.method="POST";l.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang,SecurityContext:j._getCurrentSecurityContext()};l.data=JSON.stringify({lIds:[],relIDs:[],busIDs:[i],plmparameters:"false",attributes:"true",navigateToMain:"true",readonly:"false",debug_properties:""});l.onComplete=function(o){var p=JSON.parse(o);n(p)};l.onFailure=function(o){m(o)};b.authenticatedRequest(e.assembleURLFor3DSpace(k),l)})},create:function(){return(g.parser.created)},promote:function(i){if(g.parser.maturity[i.state.toLowerCase()]){return(g.replace(g.parser.promoted,{state:g.parser.maturity[i.state.toLowerCase()].bold()}))}else{return(g.replace(g.parser.promoted,{state:i.state.bold()}))}},demote:function(i){if(g.parser.maturity[i.state.toLowerCase()]){return(g.replace(g.parser.demoted,{state:g.parser.maturity[i.state.toLowerCase()].bold()}))}else{return(g.replace(g.parser.demoted,{state:i.state.bold()}))}},connect:function(l,j){var k=this;if(l[j].description){if(k._isStatus(l[j].description,d.DESCRIPTION.ASSIGNED)){return(k._combineSameContentAssign(l,j))}else{if(k._isStatus(l[j].description,d.DESCRIPTION.DOCUMENT)){return(k._combineSameContentDocument(l,j))}else{if(k._isStatus(l[j].description,d.DESCRIPTION.RESOLVED_BY)||k._isStatus(l[j].description,d.DESCRIPTION.REPORTED_AGAINST)||k._isStatus(l[j].description,d.DESCRIPTION.DOCUMENT)){return(k._combineSameContentConnect(l,j))}}}}return([[],j])},disconnect:function(l,j){var k=this;return(k.connect(l,j))},modify:function(s,t,k){var v=this,p=t,o=[];var l=new Date(s[p].date),w=l.getTime();var y=l,m=w,r=s[p].user;var u=[];var q=60*1000;while(m>w-q&&((r===s[t].user)||"User Agent")&&p>-1&&s[p].action===d.ACTIONS.MODIFY){if(s[p].description){var n=v._getModify(s[p].description,k);if(n){u.push(v.escapeHtml("<li class= mod-li>"+n.join("")+"</li>"))}}p--;if(p>-1){y=new Date(s[p].date);m=y.getTime();r=s[p].user}}if(u.length>0){var x=g.parser.IssueHasBeen+'<span class="timeline-modified-operations" data-list="'+u.join("")+'">'+g.parser.updated+"</span>";o.push(x)}return([o,p+1])},change:function(n,l){var m=n[l];var j=m.description.trim().indexOf("owner:"),o=m.description.trim().indexOf("was:");if(j>-1){var k=m.description.slice(j+"owner: ".length+1,-m.description.trim().length+o);m.content=g.replace(g.parser.owner,{name:k.bold()});return([m.content,l])}return([])},_combineSameContentAssign:function(o,q){var p=this;var l=q,k=[],u;var i=new Date(o[q].date),s=i.getTime();var v=null,y=[];var x=i,w=s,n=o[l].user,r=o[l].description;var m=60*1000;while(w>s-m&&((n===o[q].user)||"User Agent")&&l>0&&p._isSameConnectStatus(o[q].description,r,d.DESCRIPTION.ASSIGNED)||o[l].action===d.ACTIONS.ADD){if(o[l].description&&p._isStatus(o[l].description,d.DESCRIPTION.ASSIGNED)){var t=p._getPerson(o[l].description);if(v===null||v===o[l].action){y.unshift(t);v=o[l].action}else{if(v===d.ACTIONS.CONNECT){u=g.replace(g.parser.assigned,{name:y.join(", ")})}else{if(v===d.ACTIONS.DISCONNECT){u=g.replace(g.parser.unassigned,{name:y.join(", ")})}}y=[];y.unshift(t);if(u!==null){k.unshift(u)}}v=o[l].action}l--;if(l>0){x=new Date(o[l].date);w=x.getTime();n=o[l].user;r=o[l].description}}if(v===d.ACTIONS.CONNECT){u=g.replace(g.parser.assigned,{name:y.join(", ")})}else{if(v===d.ACTIONS.DISCONNECT){u=g.replace(g.parser.unassigned,{name:y.join(", ")})}}if(u!==null){k.unshift(u)}return[k.join("<br>"),l+1]},_combineSameContentDocument:function(p,r){var q=this;var l=r,k=[],v,m;var i=new Date(p[r].date),t=i.getTime();var w=null,z=[],u=null;var y=i,x=t,o=p[l].user,s=p[l].description;var n=60*1000;while(x>t-n&&((o===p[r].user)||"User Agent")&&l>0&&q._isSameConnectStatus(p[r].description,s,d.DESCRIPTION.DOCUMENT)){if(p[l].description){m=q._getConnectStatus(p[l].description);if(m!==null){if(p[l].action===d.ACTIONS.CONNECT){if(m===d.DESCRIPTION.DOCUMENT){u="reference"}}else{if(p[l].action===d.ACTIONS.DISCONNECT){if(m===d.DESCRIPTION.DOCUMENT){u="unreference"}}}if(w===null||w===u){z.unshift(q._getXPrd(p[l].description))}else{if(w){v=g.replace(g.parser[w],{number:z.length,name:z.join(", ")})+"<br>";k.unshift(v);z=[];z.unshift(q._getXPrd(p[l].description))}}w=u}}l--;if(l>0){y=new Date(p[l].date);x=y.getTime();o=p[l].user;s=p[l].description}}if(w){v=g.replace(g.parser[w],{number:z.length,name:z.join(", ")})+"<br>";if(v!==null){k.unshift(v)}}return[k,l+1]},_combineSameContentConnect:function(p,r){var q=this;var l=r,k=[],v,m;var i=new Date(p[r].date),t=i.getTime();var w=null,z=[],u=null;var y=i,x=t,o=p[l].user,s=p[l].description;var n=60*1000;while(x>t-n&&((o===p[r].user)||"User Agent")&&l>0&&q._isConnectObject(p[r].description,s)){if(p[l].description){m=q._getConnectStatus(p[l].description);if(m!==null){if(p[l].action===d.ACTIONS.CONNECT){if(m===d.DESCRIPTION.REPORTED_AGAINST){u="reported"}else{if(m===d.DESCRIPTION.RESOLVED_BY){u="resolved"}}}else{if(p[l].action===d.ACTIONS.DISCONNECT){if(m===d.DESCRIPTION.REPORTED_AGAINST){u="unreported"}else{if(m===d.DESCRIPTION.RESOLVED_BY){u="unresolved"}}}}if(w===null||w===u){z.unshift(q._getXPrd(p[l].description))}else{if(w){v=g.replace(g.parser[w],{name:z.join(", ")});k.unshift(v);z=[];z.unshift(q._getXPrd(p[l].description))}}w=u}}l--;if(l>0){y=new Date(p[l].date);x=y.getTime();o=p[l].user;s=p[l].description}}if(w){v=g.replace(g.parser[w],{name:z.join(", ")});if(v!==null){k.unshift(v)}}return[k,l+1]},_isSameConnectStatus:function(k,j,i){var l=this;return(l._isStatus(k,i)===l._isStatus(j,i))},_isStatus:function(j,i){if(!j){return false}var k=j.indexOf(i);return(k>-1)},_isConnectObject:function(k,j){var i=this;if(i._isStatus(k,d.DESCRIPTION.RESOLVED_BY)){return(i._isStatus(j,d.DESCRIPTION.RESOLVED_BY)||i._isStatus(j,d.DESCRIPTION.REPORTED_AGAINST))}else{if(i._isStatus(k,d.DESCRIPTION.REPORTED_AGAINST)){return(i._isStatus(j,d.DESCRIPTION.RESOLVED_BY)||i._isStatus(j,d.DESCRIPTION.REPORTED_AGAINST))}else{return(false)}}},_getConnectStatus:function(j){var i=this;if(i._isStatus(j,d.DESCRIPTION.RESOLVED_BY)){return(d.DESCRIPTION.RESOLVED_BY)}else{if(i._isStatus(j,d.DESCRIPTION.REPORTED_AGAINST)){return(d.DESCRIPTION.REPORTED_AGAINST)}else{if(i._isStatus(j,d.DESCRIPTION.DOCUMENT)){return(d.DESCRIPTION.DOCUMENT)}else{return(null)}}}},_getDoc:function(j){var k=j.indexOf("Document to Document"),i;if(k>-1){i="<b>"+j.slice(k,-1).trim()+"</b>"}return i},_getModify:function(r,j){var o=r.indexOf(":"),i=r.indexOf("was:"),m=r.indexOf(":GMT"),q="",l=["Field"," "];if(o>-1){q=r.slice(0,o).trim();var n=j[0].indexOf(q);if(n>-1){if(i>-1){if(q==="Priority"){l[0]="<b>"+j[1][n][0]+"</b>";var p=r.slice(o,i).trim();var k="nls";switch(p){case": Pre-assigned":k=": "+j[1][n][1];break;case": Low":k=": "+j[1][n][1];break;case": Medium":k=": "+j[1][n][1];break;case": High":k=": "+j[1][n][1];break;case": Urgent":k=": "+j[1][n][1];break;default:}l[1]=k+"</br>"}else{if(m>-1){l[0]="<b>"+j[1][n]+"</b>";l[1]=r.slice(o,m-9).trim()+"</br>"}else{l[0]="<b>"+j[1][n]+"</b>";l[1]=r.slice(o,i).trim()+"</br>"}}}}else{if(q==="description"){l[0]="<b>"+g.parser.description+"</b>";l[1]=r.slice(o,r.length).trim()+"</br>"}else{l=null}}}else{l=null}return l},escapeHtml:function(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},_getPerson:function(k){var j=k.indexOf("Person"),i="";if(j>-1){i=k.slice(j+7,k.length-1).trim();return('<span class="timeline-psn" data-adress=" ">'+i+"</span>")}return g.parser.anObject},_getXPrd:function(n){var l=/\w*\sxPrd-\d*\s.{3}/g;var i="";while((i=l.exec(n))!==null){if(i.index===l.lastIndex){l.lastIndex++}var o=i.toString().split(" ");return('<span class="timeline-tnr" data-type="'+o[0]+'" data-name="'+o[1]+'" data-revision="'+o[2]+'"><span>'+i+"</span></span>")}var k=n.indexOf("prd");if(k>-1){i=n.slice(k,n.length-1).trim();return('<span class="timeline-tnr" "><span>'+i+"</span></span>")}var p=n.indexOf(d.DESCRIPTION.DOCUMENT);if(p>-1){i=n.slice(p+21,n.length-1).trim();return('<span class="timeline-tnr" "><span>'+i+"</span></span>")}var j=n.indexOf("3sh");if(j>-1){i=n.slice(j,n.length-1).trim();return('<span class="timeline-tnr" "><span>'+i+"</span></span>")}return g.parser.anObject},validEntryByAttribute:function(i){if(!i){return false}if(!i.hasOwnProperty("date")||h.is(i.date,null)||!h.is(i.date,"string")){return false}if(!i.hasOwnProperty("description")){return false}if(!i.hasOwnProperty("action")||h.is(i.action,null)||!h.is(i.action,"string")){return false}if(!i.hasOwnProperty("state")||h.is(i.state,null)||!h.is(i.state,"string")){return false}if(!i.hasOwnProperty("author")||h.is(i.state,null)||!h.is(i.author,"object")){return false}if(!i.author.hasOwnProperty("user")||h.is(i.author.user,null)||!h.is(i.author.user,"string")){return false}if(!i.author.hasOwnProperty("fullName")||h.is(i.author.fullName,null)||!h.is(i.author.fullName,"string")){return false}return true},getDay:function(i){var j=a.get("widget");return i.toLocaleString(j.lang)},_getCurrentSecurityContext:function(){var j="";var i=a.get("widget");if(i.getPreference("securityContext")){j=i.getPreference("securityContext").value}if(j.contains("ctx::")){return j.split("::")[1]}else{return j}}};return c});define("DS/IssueTimeline/utils/Utils",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/IssueServices/services/PlatformServices"],function(d,b,c){var a={getFullName:function(){return b.getUser().firstName.trim()+" "+b.getUser().lastName.trim()},getUserName:function(){return b.getUser().login},escape:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},getLocaleDate:function(e){return e.toLocaleString(window.widget.lang)},getUserImage:function(e){return c.get3DSwymUrl()+"/api/user/getpicture/login/"+e+"/format/mini"}};return a});define("DS/IssueTimeline/views/Row",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueTimeline/utils/Utils","i18n!DS/IssueTimeline/assets/nls/Timeline","css!DS/IssueTimeline/IssueTimeline.css"],function(g,b,e,h,c,d,f,i){var a=b.extend({name:"DS/IssueTimeline/views/Row",tagName:"div",className:"timeline-row",_logger:null,parent:null,isSubRow:false,data:{},subRows:[],elements:{icon:null,expander:null,panel:null},isExpanded:false,_isSubRowsRendered:false,_tooltips:[],setup:function(j){var k=this;d.start(k.name+" setup");k.container.set("id","row_"+k.model.get("id"));k.parent=j.parent;k.isSubRow=j.isSubRow===true;k.data={};k.subRows=[];k.elements={icon:null,expander:null,panel:null};k.isExpanded=false;k._isSubRowsRendered=false;k._tooltips=[];var l=k.model.get("subEntries");if(l!==null&&l.length>0){l.forEach(function(n){var m=new a({model:n,parent:k.parent,isSubRow:true});k.subRows.push(m)})}d.end(k.name+" setup");return k},render:function(){var m=this;d.start(m.name+" render");var l=null,o=null,k=null,n=null;if(m.isSubRow===true){m.container.addClassName("sub")}l=e.createElement("div",{"class":"timeline-icon",html:'<div class="bg-'+m.model.get("className")+'"><span class="fonticon  '+m.model.get("icon")+'"></span></div>'});m.elements.header=o=e.createElement("div",{"class":"timeline-row-header",html:[e.createElement("span",{"class":"timeline-row-header-user",html:[e.createElement("div",{"class":"timeline-row-header-user-image",html:e.createElement("img",{src:f.getUserImage(m.model.get("author").user),title:m.model.get("author").fullName,events:{click:function(){c.getUserProfile(m.model.get("author").user)}}})}),e.createElement("span",{"class":"timeline-row-header-user-name",html:m.model.get("author").fullName})]}),e.createElement("span",{"class":"timeline-row-header-date",html:m.model.get("date")})]});if(m.subRows.length>0){m.elements.expander=n=e.createElement("div",{"class":"expander",html:i.common.show})}m.elements.panel=k=e.createElement("div",{"class":"timeline-panel timeline-content",html:[o,e.createElement("div",{"class":"panel-body",html:m.model.get("content")}),n!==null?n:""]});m.container.setContent([{html:[l,k]}]);var j=e.Element.getElements.call(m.container,".timeline-modified-operations");j.forEach(function(p){m._tooltips.push(new h({position:"top",target:p,body:'<ul class="mod-Panel" >'+p.dataset.list+"</ul>",trigger:"touch",}))});m._fetchContentData();m._subscribers();d.end(m.name+" render");return m},destroy:function(){var j=this;j.container.destroy();j.parent=null;j.isSubRow=false;j.data={};j.subRows=[];j.elements={icon:null,expander:null,panel:null};j.isExpanded=false;j._isSubRowsRendered=false;j._tooltips.forEach(function(k){k.destroy()});j._tooltips=[]},show:function(){var j=this;j.container.setStyle("display","inherit");j.parent.dispatchEvent("onScroll",{height:j.parent.container.offsetHeight,position:j.parent._position})},hide:function(){var j=this;j.container.setStyle("display","none");j.container.removeClassName("active")},expand:function(){var m=this;d.start(m.name+" expand");if(m._isSubRowsRendered===false){m._isSubRowsRendered=true;for(var l=0;l<m.subRows.length;l++){m.container.parentNode.insertBefore(m.subRows[l].render().container,m.container);m.parent.addRow(m.subRows[l]);m.parent.dispatchEvent("onScroll",{height:m.parent.container.offsetHeight,position:m.parent._position})}}else{for(var k=0;k<m.subRows.length;k++){m.subRows[k].show()}}d.end(m.name+" expand")},collapse:function(){var k=this;d.start(k.name+" collapse");for(var j=0;j<k.subRows.length;j++){k.subRows[j].hide()}d.end(k.name+" collapse")},_fetchContentData:function(){},_subscribers:function(){var j=this;if(j.elements.expander!==null){j.elements.expander.addEventListener("click",function(){if(j.isExpanded===false){j.isExpanded=true;j.elements.expander.setContent(i.common.hide);j.expand()}else{j.isExpanded=false;j.elements.expander.setContent(i.common.show);j.collapse()}})}}});return a});define("DS/IssueTimeline/collections/Entries",["UWA/Class/Collection","DS/Logger/Logger","DS/IssueTimeline/models/Entry","DS/IssueServices/services/PlatformServices","DS/IssueTimeline/services/Services","DS/IssueTimeline/utils/Parser","DS/IssueServices/utils/Performance"],function(e,b,a,f,d,h,c){var g=e.extend({name:"DS/IssueTimeline/collections/Entries",model:a,_logger:null,setup:function(k,i){var j=this;j._logger=b.getLogger("DS/IssueTimeline/Model");j._logger.debug("Initializing the entries...");c.start(j.name+" setup");j.physicalId=i.physicalId;if(Array.isArray(k)&&k.length>0){j.add(k)}c.end(j.name+" setup");return j},fetch:function(i){var j=this;j._logger.debug("Fetching all entries...");c.start(j.name+" fetch");f.initPlatformServices().then(function(){return d.getHistory({physicalId:j.physicalId})}).then(function(k){var l=k.body;j._logger.debug("Entries fetched");i.physicalId=j.physicalId;if(i.parser!==null){i.parser.parse(l,i).then(function(m){j.reset(m)})}else{j.parse(l,i).then(function(m){j.reset(m)})}if(i&&typeof i.onComplete==="function"){i.onComplete(l)}c.end(j.name+" fetch")},function(k){j._logger.error("Fetch entries failed: %o",k);j.reset([]);if(i&&typeof i.onFailure==="function"){i.onFailure(k)}c.end(j.name+" fetch")})},parse:function(k,i){var j=this;j._logger.debug("Parsing entries...");c.start(j.name+" parse");k=h.parse(k,i);c.end(j.name+" parse");return k}});return g});define("DS/IssueTimeline/views/Rows",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Logger/Logger","DS/IssueTimeline/collections/Entries","DS/IssueServices/utils/Performance","DS/IssueTimeline/views/Row","i18n!DS/IssueTimeline/assets/nls/Timeline","css!DS/IssueTimeline/IssueTimeline.css"],function(k,b,i,h,f,e,c,d,a,l){var j={FLAT_LIMIT:9999};var g=b.extend({name:"DS/IssueTimeline/views/Rows",tagName:"div",className:"timeline-default flat animated",defaultOptions:{parser:"",flat:j.FLAT_LIMIT},parent:null,physicalId:"",_logger:null,_scroller:null,_position:0,_rows:[],setup:function(n){var o=this;d.start(o.name+" setup");o._logger=e.getLogger(o);o._logger.debug("Initialize the view to build the rows");n=i.merge(n||{},o.defaultOptions);o._parent(n);o.parent=n.parent;o.physicalId=n.physicalId;var m=o.collection=new c([],{physicalId:o.physicalId});o.listenTo(m,"onReset",o._onReset);o.listenTo(n.parent,"onResize",o._onResize);o.listenTo(o,"onScroll",o._onScroll);new k(function(q){try{require([o.getOption("parser")],function(r){if(r&&typeof r.parse==="function"){q(r)}else{q(null)}})}catch(p){q(null)}}).then(function(p){m.fetch({reset:true,parser:p,onComplete:function(){}})});o._scroller=null;o._position=0;o._rows=[];d.end(o.name+" setup");return o},render:function(){var p=this;d.start(p.name+" render");var o=p.container.offsetWidth;if(o>=p.getOption("flat")){p.container.removeClassName("flat")}else{if(o<p.getOption("flat")&&!p.container.hasClassName("flat")){p.container.addClassName("flat")}}p.container.setAttribute("id","timeline-top");var m=i.createElement("div",{"class":"timeline-main"});p._scroller=new f({element:p.container}).inject(m);var n=function(){var r=p._position=p._scroller._infos.y.scrollPosition;p.dispatchEvent("onScroll",{height:p.container.offsetHeight,position:r})};var q={scroll:n.bind(this)};p._scroller.elements.content.addEvents(q);h.mask(p.container);d.end(p.name+" render");return p},destroy:function(){var n=this;n.stopListening(n.collection,"onReset");n.stopListening(n.getOption("parent"),"onResize");n.stopListening(n,"onScroll");n.parent=null;n._scroller.destroy();n._scroller=null;n._position=0;for(var m=0;m<n._rows.length;m++){n._rows[m].destroy()}n._rows=[];n.collection=null;n.container.destroy();n.container=null},_onReset:function(q,o){var p=this;d.start(p.name+" _onReset");var m=p._scroller.getInnerElement();if(q.length>0){p.container.addClassName("timeline");q.forEach(function(r){var s=new a({model:r,parent:p,options:o}).render();p.addRow(s);m.insertBefore(s.container,m.firstChild)});h.unmask(p.container);p.dispatchEvent("onScroll",{height:p.container.offsetHeight,position:0})}else{p.container.removeClassName("timeline");var n=i.createElement("div",{"class":"timeline-error",html:l.common.errorMessage});m.insertBefore(n,m.firstChild);h.unmask(p.container);p.dispatchEvent("onScroll",{height:p.container.offsetHeight,position:0})}d.end(p.name+" _onReset")},addRow:function(n){var m=this;m._rows.push(n)},_onScroll:function(n){var q=this;var m=n.height;var r=q._rows;for(var p=0;p<r.length;p++){var s=r[p].container;var o=(s.getBoundingClientRect().top-q.container.getBoundingClientRect().top)+s.offsetHeight;if(m>o){if(!s.hasClassName("active")){s.addClassName("active")}}}},_onResize:function(){var o=this;var m=o.container.offsetHeight,n=o.container.offsetWidth;o.dispatchEvent("onScroll",{height:m,position:o._position});if(n>=o.getOption("flat")){o.container.removeClassName("flat")}else{if(n<o.getOption("flat")&&!o.container.hasClassName("flat")){o.container.addClassName("flat")}}}});return g});