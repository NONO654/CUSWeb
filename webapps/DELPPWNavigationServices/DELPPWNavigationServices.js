define("DS/DELPPWNavigationServices/NavigationBase",["UWA/Core","UWA/Class"],function(g,b){var a=b.extend({init:function e(h){if(!h.collectionUtils){throw new Error("collectionUtils option not defined")}this.collectionUtils=h.collectionUtils},_addToCollections:function f(j,h){h=h||{};j.onComplete=function i(k){if(h.hasOwnProperty("callback")&&h.callback instanceof Function){h.callback(k)}};this.collectionUtils.addToCollections(j)},_onDocumentComplete:function d(k){var j=Object.keys(k),h=j.length,i=0;return function(){i++;if(h===0||h===i){}}},_addDocuments:function c(j,h,k){var i=function(o){var m=o.data,n=[],p,l;if(k instanceof Function){k()}};if(j.length>0){}}});return a});define("DS/DELPPWNavigationServices/NavigateOnIndex",["UWA/Core","DS/DELPPWNavigationServices/NavigationBase","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWDicoServices/DicoUtils","DS/DELPPWIndexServices/IndexParser","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils"],function(g,c,i,l,e,p,d,j){var k=c.extend({_selectFacet:[],_computeBo:[],_selectPredicates:{},init:function q(y){y=y||{};this._parent(y);this.selectPredicates={}},getSelectUnit:function f(z){var B=e.translatePredicateToAttribute(z),y={},A;B.forEach(function(D,C){A=l.getAttributeInfo(D);if(A&&A.ManipulationUnit){y[z[C]]=p.getLabelForUnit(A.Magnitude,A.ManipulationUnit)}});return y},fetchOnIndex:function v(D,E){var z=i.get3DSpaceUrl()+"cvservlet/fetch/v2",y=E||{},I=g.is(y.type,"string")?y.type:"entity",J=g.is(y.context)?y.context:null,C=g.is(D)?g.is(D,"array")?D:[D]:null,H=g.is(y.select_predicate)?y.select_predicate:this.getSelectPredicate(I),G=this.getSelectUnit(H),F={label:d.getCVServletLabel(),physicalid:C,select_predicate:H,locale:widget.locale,lang:widget.lang,select_unit:G,with_synthesis_attribute:true};i.webServiceRequest({url:z,method:"POST",headers:i.getHeaders({isJsonOnly:true}),data:g.Json.encode(F),onComplete:function B(L){var K=[],M=g.is(L)?g.is(L.results,"array")?L.results:[L.results]:null;if(g.is(M,"array")){M.forEach(function(N){var P=e.parseFetchResult(N),O=e.translatePredicateToAttribute(P.attributes);g.merge(O,e.translatePredicateToAttribute(P.ds6w,{type:I,fromExpandService:true}));P.attributes=O;K.push(P)})}if(g.is(y.onComplete,"function")){K=(K.length>0)?(K.length>1)?K:K[0]:null;y.onComplete.call(J,K)}},onFailure:function A(K){if(g.is(y.onFailure,"function")){y.onFailure.call(J,K)}}})},setSelectPredicate:function r(z,B){var y,A,C=["PID","type","interface","PLM_ExternalID","isAggregatedBy","isInstanceOf","V_discipline","V_TreeOrder"];C.forEach(function(D){if(B.indexOf(D)===-1){B.push(D)}});y=g.is(this._selectPredicates[z])?this._selectPredicates[z]:{};A={entity:e.translateAttributeToPredicate(B,{type:"entity"}),relation:e.translateAttributeToPredicate(B,{type:"relation"})};if(g.is(y.entity)||g.is(y.relation)){A.entity.forEach(function(D){if(y.entity.indexOf(D)===-1){y.entity.push(D)}});A.relation.forEach(function(D){if(y.relation.indexOf(D)===-1){y.relation.push(D)}});this._selectPredicates[z]=y}else{this._selectPredicates[z]=A}},getSelectPredicate:function n(A,z){var y=[],B=this._selectPredicates;A=A||"entity";if(!z){switch(A){case"entity":Object.keys(B).forEach(function(D){var E=B[D].entity,C=Object.keys(E).map(function(F){return E[F]});C.forEach(function(F){if(y.indexOf(F)===-1){y.push(F)}})});break;case"relation":Object.keys(B).forEach(function(D){var E=B[D].relation,C=Object.keys(E).map(function(F){return E[F]});C.forEach(function(F){if(y.indexOf(F)===-1){y.push(F)}})});break;default:}}else{switch(A){case"entity":y=B[z].entity;break;case"relation":y=B[z].relation;break;default:}}return y},navigateOnIndex:function h(G,H,J){var z=i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),y=[],B,F={},D,I,E=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));B=E.length;while(B--){I=E[B];if(!F[I]){y.unshift(I);F[I]=true}}J=J||{};if(!(G instanceof Array)){G=[G]}if(J.selectBo instanceof Array){y=J.selectBo}y.push("pathsr");D={label:d.getCVServletLabel(),input_physical_ids:G,primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"},navigate_from_sr:{id:2,mode:"ends",filter:{role:["52"],category:["7"]}}},{navigate_to_sr:{id:3,filter:{role:["51"],category:["5"]},mode:"path"},navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}},{navigate_to_sr:{id:5,filter:{role:["203"],category:["5"]},mode:"path"},navigate_from_sr:{id:6,filter:{role:["203"],category:["5"]}}},{navigate_to_sr:{id:7,filter:{role:["204"],category:["6"]},mode:"path"},navigate_from_sr:{id:8,filter:{role:["204"],category:["6"]}}},{navigate_to_sr:{id:9,filter:{role:["296"],category:["1"]},mode:"path"},navigate_from_sr:{id:10,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:11,filter:{role:["363"],category:["1"]},mode:"path"},navigate_from_sr:{id:12,filter:{role:["363"],category:["1"]}}},{navigate_to_rel:{id:13,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"},navigate_from_rel:{id:14,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"}},{navigate_to_rel:{id:15,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]}},navigate_from_rel:{id:16,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]},mode:"return_rel"}},{navigate_to_sr:{id:17,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:18,filter:{role:["308"],category:["7"]},mode:"path"},navigate_from_sr:{id:19,filter:{role:["308"],category:["7"]}}},{navigate_to_sr:{id:20,filter:{role:["307"],category:["5"]},mode:"path"},navigate_from_sr:{id:21,filter:{role:["307"],category:["5"]}}},{navigate_to_rel:{id:22,filter:{rel_type:["VPLMrel_47_PLMConnection_47_V_Owner"]}},navigate_to_sr:{id:23,filter:{role:["87"],category:["1"]},mode:"path"}},{navigate_to_sr:{id:24,filter:{role:["248"],category:["1"]},mode:"path"},navigate_from_sr:{id:25,mode:"ends",filter:{role:["248"],category:["1"]}}},{navigate_to_sr:{id:26,filter:{role:["249"],category:["1"]},mode:"path"},navigate_from_sr:{id:27,mode:"ends",filter:{role:["249"],category:["1"]}}},{navigate_to_sr:{id:28,filter:{role:["295"],category:["1"]},mode:"path"},navigate_from_sr:{id:29,filter:{role:["295"],category:["1"]}}},{navigate_to_sr:{id:30,filter:{role:["294"],category:["1"]},mode:"path"},navigate_from_sr:{id:31,filter:{role:["294"],category:["1"]}}}],patterns:{scope_pathSR:[{id:2},{id:3}],scopeInverse_pathSR:[{id:4},{id:1}],candidateResource_pathSR:[{id:6},{id:7}],candidateResourceInverse_pathSR:[{id:8},{id:5}],mbomSystemOutput_pathSR:[{id:15},{id:10},{id:11}],mbomSystemOutputInverse_pathSR:[{id:12},{id:9}],mbomSystemOutputInverse_relation:[{id:12},{id:17},{id:16}],mbomOperationOutput_pathSR:[{id:10},{id:11}],mbomOperationOutputInverse_pathSR:[{id:12},{id:9}],alternate_relation:[{id:13}],alternateInverse_relation:[{id:14}],historization_pathSR:[{id:19},{id:20}],historizationInverse_pathSR:[{id:21},{id:18}],document_pathSR:[{id:22},{id:23}],productFlow_pathSR:[{id:25},{id:26}],productFlowInverse_pathSR:[{id:27},{id:24}],productMbomImplement_pathSR:[{id:3}],productMbomImplementInverse_pathSR:[{id:4}],Material_pathSR:[{id:29},{id:30}],MaterialInverse_pathSR:[{id:31},{id:28}],operationProcessImplement_pathSR:[{id:2},{id:3}],operationProcessImplementInverse_pathSR:[{id:4},{id:1}]},patternTypeFilters:{mbomSystemOutputInverse_pathSR:{typesReturn:["DELLmiProdSystemIOPort"]},mbomOperationOutputInverse_pathSR:{typesToNotReturn:["DELLmiProdSystemIOPort"]},productMbomImplementInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","DELFmiFunctionIdentifiedInstance","MfgProductionPlanning"]},scope_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},scopeInverse_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},operationProcessImplement_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"},operationProcessImplementInverse_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"}},attributes:y,fileAttributes:[],version:3};if(g.is(J.expandIter,"string")){D.expand_iter=J.expandIter}D=g.Json.encode(D);i.webServiceRequest({url:z,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",},data:D,onComplete:function C(K){if(H instanceof Function){H.call(J.context,K)}},onFailure:function A(K){if(J.onFailure instanceof Function){J.onFailure(K)}},})},navigateNodes:function a(y,D,C,z){var B=[],A=function(E){if(g.is(E)&&g.is(E.result,"array")){this.onNavigatedNodes(E,B,D)}C(B)};z=z||{};if(y.length>0){this.navigateOnIndex(y,A,g.extend(z,{context:this}))}else{C(B)}},onNavigatedNodes:function x(y,D,C){var A=y.result,z=this,B=function(M,F,E,G,L){var J=E.physicalid,I,O,K,N,H;L=L||{};if(l.isEntityConnection(F.type)&&(l.isEntityReference(E.type)||l.isEntityInstance(E.type))){if("Document"===E.type&&C.documentIdMap){if(!(C.documentIdMap[M] instanceof Array)){C.documentIdMap[M]=[]}C.documentIdMap[M].push(J)}else{F=g.merge(e.translatePredicateToAttribute(F,{type:"entity"}),e.translatePredicateToAttribute(F,{type:"relation"}));if(G){F.from=M;F.to=J}else{F.from=J;F.to=M}if("ProductImplementLinkOcc"===F.type){if(L.occurencePath){if(G){F.to=L.occurencePath}else{F.from=L.occurencePath}F.PID="ProductImplementLinkOcc|"+M+"|"+g.Json.encode(L.occurencePath)}}else{if("ProcessImplementLinkOcc"===F.type){if(g.is(L.owner)&&g.is(L.owner.pathsr)){K=z.getPathsFromSR(L.owner.pathsr);if(g.is(K)&&g.is(K.from)){O=K.from;M=O.toString()}if(g.is(K)&&g.is(K.to)){N=K.to;I=N.toString()}}if(L.occurencePath){if(G){F.to=L.occurencePath;I=L.occurencePath.toString();if(g.is(O)){F.from=O}}else{F.from=L.occurencePath;if(g.is(N)){F.to=N}}F.PID="ProcessImplementLinkOcc|"+M+"|"+I}}else{if("DELLmiTimeConstraintCnx"===F.type){if(g.is(L.owner)&&g.is(L.owner.pathsr)){K=z.getPathsFromSR(L.owner.pathsr);if(g.is(K)&&g.is(K.from)){O=K.from}if(g.is(K)&&g.is(K.to)){N=K.to}if(G){F.from=O;F.to=N}else{F.to=O;F.from=N}}}else{if("SystemImplementLink"===F.type||"ProcessImplementLink"===F.type||"ProductImplementLink"===F.type){F.PID=F.type+"|"+F.from+"|"+F.to}}}}C.stackedConnections.push(F);if(l.isEntityReference(E.type)&&D.indexOf(J)===-1){D.push(J)}else{if(l.isEntityInstance(E.type)){if(!z.collectionUtils.isInstance(J)&&E.hasOwnProperty("from.physicalid")){H=E["from.physicalid"];if(g.is(H)){if(D.indexOf(H)===-1){D.push(H)}}}}}}}};A.forEach(function(E){var L=E.outputs,J,H,G=E.input_object.physicalid,I,F,K;C.stackedReferences.some(function(M){if(M.PID===G){M.queriedForConnections=true;M.queriedForDocuments=true;return true}return false});C.stackedInstances.some(function(M){if(M.PID===G){M.queriedForConnections=true;return true}return false});for(J in L){if(L.hasOwnProperty(J)){H=L[J];K=J.indexOf("Inverse")===-1;if(J.indexOf("_pathSR")!==-1){H.forEach(function(M){var N,O;if(M&&M.elements){if(J.indexOf("productMbomImplement")!==-1){N=M.elements.map(function(P){return P.physicalid});O=M.elements[M.elements.length-1];F={type:"ProductImplementLinkOcc"};B(G,F,O,K,{occurencePath:N})}else{if(J.indexOf("operationProcessImplement")!==-1){N=M.elements.map(function(P){return P.physicalid});O=M.elements[M.elements.length-1];F={type:"ProcessImplementLinkOcc"};B(G,F,O,K,{occurencePath:N,owner:M.owner})}else{if(J.indexOf("productFlow")!==-1){N=M.elements.map(function(P){return P.physicalid});O=M.elements[M.elements.length-1];F=M.owner;B(G,F,O,K,{occurencePath:N,owner:M.owner})}else{if(J.indexOf("Material")!==-1){I=null;M.elements.reverse().some(function(Q){var P=false;if(l.isEntityInstance(Q.type)){I=Q;P=true}return P});if(g.is(I)){F=M.owner;B(G,F,I,K)}}else{I=M.elements[0];F=M.owner;B(G,F,I,K)}}}}}})}else{if(J.indexOf("_relation")!==-1){H.forEach(function(O){var M,N;if(J.indexOf("alternate")!==-1){F=O;I=K?O.to:O.from;delete O["from.physicalid"];delete O["to.physicalid"];B(G,F,I,K)}else{if(J.indexOf("mbomSystemOutput")!==-1){M=J.split("_relation")[0];N=L[M+"_pathSR"];I=O.from;if(N){N.forEach(function(P){if(P&&P.elements){if(P.elements[0].physicalid===O.to.physicalid){F=P.owner}}});if(F){B(G,F,I,K)}}}}})}}}}})},expandOnIndex:function t(N,L,O){var z=i.get3DSpaceUrl()+"cvservlet/expand",y=this.getSelectPredicate("entity"),M=this.getSelectPredicate("relation"),K=this.getSelectUnit(y),I=this._selectFacet,J=this._computeBo,G,E,F,B,D=["union","intersection","minus"],H;O=O||{};if(g.is(O.selectBo,"array")){y=O.selectBo}if(g.is(O.selectRel,"array")){M=O.selectRel}if(g.is(O.selectFacets,"array")){I=O.selectFacets}if(g.is(O.computeBo,"array")){J=O.computeBo}if(g.is(O.filterQuery,"object")){G=O.filterQuery}E={label:d.getCVServletLabel(),select_bo:y,select_rel:M,select_ds6w_facet:I,compute_select_bo:J,locale:widget.locale,lang:widget.lang,select_unit:K};F=["MfgProcessAlternate"];if(g.is(G)){g.merge(E,G);for(B in G){if(G.hasOwnProperty(B)){if(D.indexOf(B)!==-1){H=G[B].expand;if(g.is(H,"array")){H.forEach(function(P){P.no_type_filter_rel=F});break}}}}z=i.get3DSpaceUrl()+"cvservlet/multiexpand"}else{if(N instanceof Array){E.multi_root_physicalid=N}else{E.root_physicalid=N}if(g.is(O.expandIter,"string")){E.expand_iter=O.expandIter}E.no_type_filter_rel=F}E=g.Json.encode(E);i.webServiceRequest({url:z,method:"POST",headers:i.getHeaders({isJsonOnly:true}),data:E,onComplete:function C(Q){var P;if(L instanceof Function){P=e.parseNavigateResult(Q);L.call(O.context,P)}},onFailure:function A(P){if(O.onFailure instanceof Function){O.onFailure.call(O.context,P)}},})},expandNodes:function s(D,B,E,H){var G=this,z,y,C,A=[],F;H=H||{};z=g.is(H.context)?H.context:this;y=isNaN(H.expandLevel)?d.getPrefExpandLevel():H.expandLevel;C=g.is(H.filterQuery)?H.filterQuery:null;F=function(I){if(!g.is(I,"array")){j.debug("ERROR in expand result")}else{G.onExpandedNodes(I,A,B,y,C)}E.call(z,A)};if(D.length>0){G.expandOnIndex(D,F,g.extend(H,{context:G,expandIter:y.toString()}))}else{E.call(z,A)}},onExpandedNodes:function o(B,z,F,E,D,A){var y=this,C;if(isNaN(A)){A=0}if((E===-1||A<=E)&&g.is(B,"array")){B.forEach(function(I){var H=e.translatePredicateToAttribute(I,{type:"entity",fromExpandService:true}),G;if(E===-1||A<E){H.queriedForChildren=true}z.push(H.PID);F.stackedReferences.push(H);I.getChildren().forEach(function(J){C=J.getChildren().filter(function(K){return l.isEntityReference(K.type.value)&&J.type.value!=="MfgProcessAlternate"});if(C.length>0){G=e.translatePredicateToAttribute(J,{type:"relation",fromExpandService:true});if(g.is(D)){G.filterQuery=D}z.push(G.PID);F.stackedInstances.push(G);y.onExpandedNodes(C,z,F,E,D,A+1)}})})}},findMissingLinkedObjects:function w(z,E){var G=this,B=[],C={referencesPID:[z],instancesPID:[]},A={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};G.collectionUtils.expandOnBackbone(z,C);C.referencesPID.forEach(function D(H){var J=G.collectionUtils.getReferenceFromCollection(H),I;if(g.is(J)){I=J.pick("PID");A.stackedReferences.push(I)}});C.instancesPID.forEach(function F(H){var J=G.collectionUtils.getInstanceFromCollection(H),I;if(g.is(J)){I=J.pick("PID");A.stackedInstances.push(I)}});B=G.collectionUtils._removeDuplicate(C.referencesPID.slice().concat(C.instancesPID.slice()));G.navigateNodes(B,A,function y(I){G.expandNodes(I,A,function H(){G._addToCollections(A,E)},E)})},getDescendants:function m(B,A){var z=this,C={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};A=A||{};if(!(B instanceof Array)){B=[B]}this.expandNodes(B,C,function y(D){z.navigateNodes(D,C,function E(G){z.expandNodes(G,C,function F(){z._addToCollections(C,A)})})},A)},getConnectionsByModel:function u(J,A,E,F,z){var K=this,C=[],G=g.is(J)?J.id:null,B=g.is(A)?A.id:null,D={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},H={documentIdMap:D.documentIdMap},y=function y(){var N=[],R=[],P=[],S={callback:function T(){if(g.is(z,"function")){z(N)}}},M={stackedReferences:[],stackedInstances:[],},O=function O(Y){var Z=Y.get("from"),aa=Y.get("to"),X=Y.get("type"),V=true,W=function W(ac,ab){if(g.is(ac,"array")){ac.forEach(function ad(ae){if(g.is(ae,"string")&&!K.collectionUtils.isInstance(ae)){P.push(ae)}})}else{if(g.is(ac,"string")){if(ab){if(!K.collectionUtils.isReference(ac)){R.push(ac)}}else{if(!K.collectionUtils.isInstance(ac)){P.push(ac)}}}}};if("ProductImplementLinkOcc"===X||"DELLmiTimeConstraintCnx"===X||"DELLmiMaterialPathCnxCust"===X){V=false}W(Z,V);W(aa,V)},L=function L(W){var V=function V(Y){var X=g.is(Y.attributes)?Y.attributes:Y;if(g.is(Y.ds6w)){X.ds6w=Y.ds6w}M.stackedReferences.push(X)};if(g.is(W)){if(g.is(W,"array")){W.forEach(V)}else{V(W)}}K._addToCollections(M,S)},U=function U(){if(R.length>0){K.fetchOnIndex(R,{onComplete:L,context:K.collectionUtils})}else{L()}},Q=function Q(W){var V=function V(Y){var X=g.is(Y.attributes)?Y.attributes:Y;if(g.is(Y.ds6w)){X.ds6w=Y.ds6w}M.stackedInstances.push(X);if(g.is(X.isInstanceOf,"string")&&(""!==X.isInstanceOf)){if(!K.collectionUtils.isReference(X.isInstanceOf)){R.push(X.isInstanceOf)}}};if(g.is(W)){if(g.is(W,"array")){W.forEach(V)}else{V(W)}}U()};N=K.collectionUtils.getImpactedConnections(G,B,{relationTypes:E,isRefRefOnly:F});if(g.is(N,"array")){N.forEach(O)}if(P.length>0){K.fetchOnIndex(P,{onComplete:Q,context:K.collectionUtils,type:"relation"})}else{Q()}},I=function I(){var N={queriedForConnections:true},L={callback:function M(){if(g.is(J)){J.setAdditionalInfo(N)}if(g.is(A)){A.setAdditionalInfo(N)}y()}};K._addToCollections(D,L)};if(g.is(G)){if(K.collectionUtils.needToQueryForConnections(K.collectionUtils.references,G)){C.push(G)}}if(g.is(B)){if(K.collectionUtils.needToQueryForConnections(K.collectionUtils.instances,B)){C.push(B)}}if(C.length>0){K.navigateNodes(C,D,I,H)}else{y()}},getPathsFromSR:function b(z){var F=null,A,B,y,E,C,D;A=z.indexOf(" PS ");A=A+4;B=z.indexOf(" PE ");if(A===-1||B===-1){j.log("Error parsing fromOcc from attribute pathSR: "+z);return null}y=z.substring(A,B);E=y.split(" ");A=z.indexOf(" PS ",A);A=A+4;B=z.indexOf(" PE",B+4);if(A===-1||B===-1){j.log("Error parsing toOcc from attribute pathSR: "+z);return null}C=z.substring(A,B);D=C.split(" ");if(g.is(E)&&g.is(D)){F={from:E,to:D}}return F}});return k});define("DS/DELPPWNavigationServices/NavigateOnDB",["UWA/Core","DS/DELPPWNavigationServices/NavigationBase","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWModelParsers/ConnectionParser","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWIndexServices/IndexParser"],function(h,l,a,n,c,e,m){var f=l.extend({init:function p(r){r=r||{};this._parent(r)},_getDescendants:function k(x,u,w,A){var z=this,s,r,t,v;A=A||{};r=isNaN(A.expandLevel)?c.getPrefExpandLevel():A.expandLevel;v={pid:Array.isArray(x)?null:x,expandLevel:r,ordered:h.is(A)?(h.is(A.ordered,"boolean")?A.ordered:true):true};t=h.is(A.context)?A.context:this;s={url:"modeler/ppr/getDescendants",method:"POST",onComplete:function y(B){z.onGetDescendants(B,u,r,A,x);w.call(t)}};s.data=h.Json.encode(v);if(h.is(A.onFailure,"function")){s.onFailure=A.onFailure}if(h.is(A.onTimeout,"function")){s.onTimeout=A.onTimeout}if(h.is(A.onCancel,"function")){s.onCancel=A.onCancel}a.webServiceRequest(s)},onGetDescendants:function b(z,s,r,y,w){var t=(r===-1)?true:false,x=Array.isArray(w)?w:[w],v=h.clone(x);z.forEach(function(B){var A=B.attributesValue;if(A.hasOwnProperty("isInstanceOf")){s.stackedInstances.push(B);if(2===r){if(x.indexOf(A.isAggregatedBy)>-1){v.push(A.isInstanceOf)}}}else{B.queriedForChildren=t;s.stackedReferences.push(B)}});if(2===r){s.stackedReferences.forEach(function u(A){if(v.indexOf(A.attributesValue.PID)>-1){A.queriedForChildren=true}})}},_getDescendantsAndLinks:function o(z,v,y,B){var A=this,s,t,r,u=[],x;B=B||{};r=isNaN(B.expandLevel)?c.getPrefExpandLevel():B.expandLevel;x={expandLevel:r,ordered:h.is(B)?(h.is(B.ordered,"boolean")?B.ordered:true):true};t=h.is(B.context)?B.context:this;s={method:"POST",onComplete:function w(C){if(Array.isArray(C)){C.forEach(function D(E){A.onGetDescendantsAndLinks(E,u,v,r,B,z)})}else{A.onGetDescendantsAndLinks(C,u,v,r,B,z)}y.call(t,u)}};if(Array.isArray(z)&&(z.length>1)){x.pidArray=z;s.url="modeler/ppr/getMultipleDescendantsAndLinks"}else{s.url="modeler/ppr/getDescendantsAndLinks";x.pid=Array.isArray(z)?z[0]:z}s.data=h.Json.encode(x);if(h.is(B.onFailure,"function")){s.onFailure=B.onFailure}if(h.is(B.onTimeout,"function")){s.onTimeout=B.onTimeout}if(h.is(B.onCancel,"function")){s.onCancel=B.onCancel}a.webServiceRequest(s)},onGetDescendantsAndLinks:function j(D,u,v,s,C,A){var t=h.is(C.withLinksResolved,"boolean")?(C.withLinksResolved?u:null):u,x=(s===-1)?true:false,B=Array.isArray(A)?A:[A],z=h.clone(B);v.documentIdMap=D.documents;if(h.is(D.instancesAndReferences)){D.instancesAndReferences.forEach(function w(F){var E=F.attributesValue;if(E.hasOwnProperty("isInstanceOf")){F.queriedForConnections=true;v.stackedInstances.push(F);if(2===s){if(B.indexOf(E.isAggregatedBy)>-1){z.push(E.isInstanceOf)}}}else{F.queriedForChildren=x;F.queriedForConnections=true;v.stackedReferences.push(F)}});if(2===s){v.stackedReferences.forEach(function y(E){if(z.indexOf(E.attributesValue.PID)>-1){E.queriedForChildren=true}})}}D.connections.forEach(function r(E){n.parse(E,v,t)})},getDescendants:function i(v,u){var s=this,w={},x=u.stackedObjects||{stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};u=u||{};if(h.is(u.silentMode)){w={silent:true}}if(h.is(u.withLinks,"boolean")&&u.withLinks){s._getDescendantsAndLinks(v,x,function r(y){if(y.length>0){if(h.is(u)){u.withLinksResolved=false}u.stackedObjects=x;s.getDescendants(y,u)}else{u=h.merge(u,w);s._addToCollections(x,u)}},u)}else{s._getDescendants(v,x,function t(){u=h.merge(u,w);s._addToCollections(x,u)},u)}},getConnectionsByModel:function g(A,v,w,x,t){var B=this,D,y=h.is(t,"function"),z=h.is(A)?A.id:null,s=h.is(v)?v.id:null,C;D={relationTypes:w,isRefRefOnly:x,onComplete:function u(){C=B.collectionUtils.getImpactedConnections(z,s,D);if(y){t(C)}},onFailure:function r(){if(y){t(C)}}};B.fetchConnections(z,s,D)},fetchConnections:function q(B,u,y){var C=this,w,x,z,r,A,t;y=y||{};z=C.collectionUtils.needToQueryForConnections(C.collectionUtils.references,B)?B:null;r=C.collectionUtils.needToQueryForConnections(C.collectionUtils.instances,u)?u:null;if(h.is(z)||h.is(r)){A=h.is(y.isRefRefOnly)?y.isRefRefOnly:false;t=h.is(y.relationTypes,"array")?y.relationTypes:[];C.collectionUtils.connections.fetch({data:{parentPID:B,instancePID:u,gridIDs:h.Json.encode(t)},proxy:"passport",headers:a.getHeaders(),wait:true,remove:false,onComplete:function v(){var D;if(h.is(B)&&!A){w=C.collectionUtils.getReferenceFromCollection(B);if(h.is(w)){if("PART"===w.get("PPRTYPE")){D=m.translatePredicateToAttribute(w._attributes,{type:"entity"});w.set(D)}w.setAdditionalInfo({queriedForConnections:true})}else{e.debug(C.name,"could not get reference pid %s",B)}}if(h.is(u)&&!A){x=C.collectionUtils.getInstanceFromCollection(u);if(h.is(x)){x.setAdditionalInfo({queriedForConnections:true})}}if(h.is(y.onComplete,"function")){y.onComplete.call(null)}},onFailure:function s(){e.debug(C.name,"Fetching of connections failed: %s , %s",B,u);if(h.is(y.onFailure,"function")){y.onFailure.call(null)}}})}else{if(h.is(y.onComplete,"function")){y.onComplete.call(null)}}},getWhereUsedReferences:function d(z,s){var A=this,y=h.is(s,"function"),t,v,B={callback:function x(D){var C=[],E=[];if(h.is(D)&&h.is(D.instancesAndReferences,"array")){D.instancesAndReferences.forEach(function(F){if(F.isReference()){C.push(F)}else{E.push(F)}})}if(y){s(C,E)}}},w={stackedReferences:[],stackedInstances:[]};if(h.is(z)){t=z.id}a.webServiceRequest({url:"modeler/ppr/whereUsed",method:"GET",data:{pid:t},onComplete:function u(C){C.forEach(function(D){v=D.attributesValue;if(h.is(v)){if(!v.hasOwnProperty("isInstanceOf")){w.stackedReferences.push(D)}else{w.stackedInstances.push(D)}}});A._addToCollections(w,B)},onFailure:function r(){if(y){s([])}}})}});return f});define("DS/DELPPWNavigationServices/NavigateUtil",["UWA/Core","UWA/Class","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWModelParsers/ConnectionParser","DS/DELPPWIndexServices/IndexParser","DS/DELPPWModelServices/ModelUtils","DS/DELPPWModelServices/Navigation/IndexedDBUtils","DS/DELPPWNavigationServices/NavigateOnDB","DS/DELPPWNavigationServices/NavigateOnIndex","DS/DELPPWLoggerModel/LoggerUtils"],function(e,o,g,h,d,c,k,b,j,i){var a=o.singleton({name:"NavigateUtil",uninitializedCalls:"throw",init:function n(v){var u=this;v=v||{};if(!(v.indexMappingXML)){throw new Error("indexMappingXML option not defined")}u.options=v;k.init();a._connectionParser=h.init({collectionUtils:u.options.collectionUtils})},setup:function m(A,x){var v=this,u={collectionUtils:v.options.collectionUtils},z=new e.Promise(function(D,C){g.getXMLValues(v.options.indexMappingXML,function E(F){d.setIndexMapping(F);a.navigateOnDB=new b(u);a.navigateOnIndex=new j(u);D()},function B(F){C(F)})});z.then(function y(){i.debug("Succesfully initialized navigations.");A()},function w(B){i.debug("Failed to initialize Navigations. Failure desc:"+B);x(B)})},getConnectionParser:function p(){return a._connectionParser},getDescendantsFromServer:function f(z,y,w){var x=w||{},A=c.getNavigateOnIndex(),v=e.is(x.context)?x.context:null,u=e.is(x.forceDBMode,"boolean")?x.forceDBMode:false,B=function B(C){if(e.is(y,"function")){y.call(v,C)}};x=e.merge({callback:B,fillLinksAndDocuments:false,withLinks:true},x);if(A&&!u){this.navigateOnIndex.getDescendants(z,x)}else{this.navigateOnDB.getDescendants(z,x)}},setSelectPredicate:function q(u,v){this.navigateOnIndex.setSelectPredicate(u,v)},fetchOnIndex:function s(u,v){this.navigateOnIndex.fetchOnIndex(u,v)},findMissingLinkedObjects:function t(w,v,x){var u=e.merge({callback:v},x);this.navigateOnIndex.findMissingLinkedObjects(w,u)},getConnectionsByModel:function r(w,v,x){var y=x||{},u=e.is(y.forceDBMode)?y.forceDBMode:false;if(c.getNavigateOnIndex()&&!u){this.navigateOnIndex.getConnectionsByModel(w,v,y.relationTypes,y.isRefRefOnly,y.onComplete)}else{this.navigateOnDB.getConnectionsByModel(w,v,y.relationTypes,y.isRefRefOnly,y.onComplete)}},getWhereUsedReferences:function l(u,v){this.navigateOnDB.getWhereUsedReferences(u,v)}});return a});