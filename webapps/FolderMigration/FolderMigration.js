define("DS/FolderMigration/FolderMigration",["DS/FolderEditor/utils/UserPreference","DS/PADUtils/PADUtilsServices"],function(a,e){function f(){return"folderTreeStrucure - "+e.getPlatformId()}function d(i){var h=false;var k={};for(var j in i){var m=j;var l=i[j];if(l.e!==true){m="_X_"+j}else{h=true}var g=d(l.c);if(l.e===true||g.oneIsExpanded){k[m]=g.elements}h=h||g.oneIsExpanded}return{oneIsExpanded:h,elements:k}}function c(j){if(j){var h=j.root;var i={};var g=d(h.c);if(g.oneIsExpanded){i={root:g.elements}}widget.setValue("folderTreeStructure",JSON.stringify(i))}}var b=function(h){var g={expand:true};function i(){if(Object.keys(g).length==0){widget.setValue("vMigration",h)}}function j(k){delete g.expand;i();k()}this.migrateExpandPreferences=function(k){if(widget.getValue("vMigration")>=1){return j(k)}var m=widget.getValue("folderTreeStructure");if(g.expand){if(!m){a.get(f(),function(n){c(n);j(k)},true)}else{if(m.indexOf('"e"')>=0){try{m=m?JSON.parse(m):{}}catch(l){m={}}c(m);j(k)}else{j(k)}}}}};return b});