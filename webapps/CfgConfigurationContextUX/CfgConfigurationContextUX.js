define("DS/CfgConfigurationContextUX/CfgConfigurationContextCriteria",["DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Collection","UWA/Class/Model","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","DS/Controls/Toggle","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],function(d,e,h,l,g,c,a,k,i,f,j){var b=a.extend({collection:null,className:"CfgConfigurationContextCriteria",enabledCriteria:{feature:"false",productState:"false",unit:"false",contextualDate:"false",milestone:"false",manufacturingPlan:"false"},setup:function(){},init:function(m){var n=this;this.alertDiv=new h({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"error"});this.options=m;this.enabledCriteriaFromNative=JSON.parse(JSON.stringify(m.enabledCriterias));var o=function(p){console.log(p);if(p.isLicenseValid!=undefined&&p.isLicenseValid==false){return}n.caid=p.change.id};i.get2(o)},render:function(n){this.collection=n;var m=this;return(m.createCriteriaView())},getActiveCriteria:function(){var n=f.ActivatedCriteria;var m=this.ROCriteriaView=new UWA.createElement("div",{"class":"ROCriteria-container",title:n,html:n});this.renderActiveCriteria(this.options.enabledCriterias);return m},renderActiveCriteria:function(m){var o="<b>"+f.ActivatedCriteria+"  :  </b>";var n="";(m.productState==="true"||m.productState==="mixedState")?n+=f.Product_state+", ":false;(m.manufacturingPlan==="true"||m.manufacturingPlan==="mixedState")?n+=f.Manufacturing_Plan+", ":false;(m.contextualDate==="true"||m.contextualDate==="mixedState")?n+=f.Date+", ":false;(m.milestone==="true"||m.milestone==="mixedState")?n+=f.Milestone+", ":false;(m.unit==="true"||m.unit==="mixedState")?n+=f.Unit+", ":false;(m.feature==="true"||m.feature==="mixedState")?n+=f.Variant_Options+", ":false;n=n.replace(/,\s*$/,"");this.ROCriteriaView.setContent(o+n);this.ROCriteriaView.setAttributes({title:n})},onResize:function(){if(this.criteriaContent&&this.criteriaContent.getParent().getStyle("display")!="none"){var m=(this.criteriaContent.getParent().offsetWidth<=448)?true:false;if(m){this.criteriaContent.addClassName("main-CriteriaContent-mobilemode");if(this.evolutionCritView){this.evolutionCritView.addClassName("evolutionCrit-containert-mobilemode")}if(this.variantCritView){this.variantCritView.addClassName("variantCrit-container-mobilemode")}}else{this.criteriaContent.removeClassName("main-CriteriaContent-mobilemode");if(this.evolutionCritView){this.evolutionCritView.removeClassName("evolutionCrit-containert-mobilemode")}if(this.variantCritView){this.variantCritView.removeClassName("variantCrit-container-mobilemode")}}}},createCriteriaView:function(){var p=this;var m=this.evolutionCritView=new UWA.createElement("div",{"class":"evolutionCrit-container",html:[{tag:"div","class":"evoCritContainer",html:['<h5 class="evoCritHeader">'+f.Evolution+"</h5>",{tag:"div","class":"evoCritContent",}]}]});var o=this.variantCritView=new UWA.createElement("div",{"class":"variantCrit-container",html:[{tag:"div","class":"varCritContainer",html:['<h5 class="varCritHeader">'+f.Variants+"</h5>",{tag:"div","class":"varCritContent",}]}]});var q=this.criteriaContent=new UWA.createElement("div",{"class":"main-CriteriaContent"});this.Spinner=new d({className:"Spinners"}).inject(q);m.inject(this.criteriaContent);o.inject(this.criteriaContent);var n=p.options.enabledCriterias?p.options.enabledCriterias:p.enabledCriteria;p.enabledCriteriasUX=n;l.checkDecouplingActivation().then(function(r){p.AllowedCriteria=r;p.renderCriteriaView(p.enabledCriteriasUX);p.criteriaContent.addEvent("resize",function(){p.onResize()})});return q},updateCollection:function(m,n){this.collection=m;if(UWA.is(n)){this.enabledCriteriasUX=n;this.renderActiveCriteria(this.enabledCriteriasUX)}if(this.collection.length==0&&(window.enoviaServerFilterWidget.mode=="Native")){this.enabledCriteriaFromNative=this.enabledCriteriasUX=JSON.parse(JSON.stringify(this.enabledCriteria))}},renderCriteriaViewNative:function(r){var q=this;var n=q.enabledCriteriasUX;var m=q.evolutionCritView.getElement(".evoCritContent");var p=q.variantCritView.getElement(".varCritContent");var o=q.evolutionCritView.getElement(".evoCritHeader");var s=q.variantCritView.getElement(".varCritHeader");p.setContent("");m.setContent("");if(r.indexOf("products")>=0){q.productstateCheckbox=new j({type:"checkbox",value:"productState",className:"primary",checkFlag:(n.productState==="true"||n.productState==="mixedState")?true:false,label:f.Product_state,mixedState:n.productState==="mixedState"?true:false,disabled:(q.enabledCriteriaFromNative.productState=="true")?true:false}).inject(m);q.productstateCheckbox.addEventListener("click",function(t){q.setUnsetCriteria(q.productstateCheckbox)})}else{q.enabledCriteriasUX.productState="false";q.enabledCriteriaFromNative.productState="false"}if((r.indexOf("manufacturingPlans")>=0)&&q.options.IsManufPlanAllowedFromNative){q.manufacturingPlanCheckbox=new j({type:"checkbox",value:"manufacturingPlan",className:"primary",checkFlag:(n.manufacturingPlan==="true"||n.manufacturingPlan==="mixedState")?true:false,label:f.Manufacturing_Plan,mixedState:n.manufacturingPlan==="mixedState"?true:false,disabled:(q.enabledCriteriaFromNative.manufacturingPlan=="true")?true:false}).inject(m);q.manufacturingPlanCheckbox.addEventListener("click",function(t){q.setUnsetCriteria(q.manufacturingPlanCheckbox)})}else{q.enabledCriteriasUX.manufacturingPlan="false";q.enabledCriteriaFromNative.manufacturingPlan="false"}if(q.AllowedCriteria.contextualDate){q.contextualDatebox=new j({type:"checkbox",value:"contextualDate",className:"primary",checkFlag:(n.contextualDate==="true"||n.contextualDate==="mixedState")?true:false,label:f.Date,mixedState:n.contextualDate==="mixedState"?true:false,disabled:(q.enabledCriteriaFromNative.contextualDate=="true")?true:false}).inject(m);q.contextualDatebox.addEventListener("click",function(t){q.setUnsetCriteria(q.contextualDatebox)})}else{q.enabledCriteriasUX.contextualDate="false";q.enabledCriteriaFromNative.contextualDate="false"}if(q.AllowedCriteria.unit&&r.indexOf("builds")>=0){q.unitCheckbox=new j({type:"checkbox",value:"unit",className:"primary",checkFlag:(n.unit==="true"||n.unit==="mixedState")?true:false,label:f.Unit,mixedState:n.unit==="mixedState"?true:false,disabled:(q.enabledCriteriaFromNative.unit=="true")?true:false}).inject(m);q.unitCheckbox.addEventListener("click",function(t){q.setUnsetCriteria(q.unitCheckbox)})}else{q.enabledCriteriasUX.unit="false";q.enabledCriteriaFromNative.unit="false"}if(r.indexOf("variant")>=0){q.featureCheckbox=new j({type:"checkbox",value:"feature",className:"primary",checkFlag:(n.feature==="true"||n.feature==="mixedState")?true:false,label:f.Variant_Options,mixedState:n.feature==="mixedState"?true:false,disabled:(q.enabledCriteriaFromNative.feature=="true")?true:false}).inject(p);q.featureCheckbox.addEventListener("click",function(t){q.setUnsetCriteria(q.featureCheckbox)})}else{q.enabledCriteriasUX.feature="false";q.enabledCriteriaFromNative.feature="false"}q.renderActiveCriteria(q.enabledCriteriasUX)},renderCriteriaView:function(){var n=this;var m=n.enabledCriteriasUX;var o=new Promise(function(t,s){var u=[];n.collection.forEach(function(x,w){u.push({id:"pid:"+x.id})});var q="/resources/modeler/browsing/model/getcriteria";var r={version:"1.0.0",modelIds:u};r=JSON.stringify(r);var v=function(w){t(w)};var p=function(w){console.log("fail to get last product evolution")};l.makeWSCall(q,"POST","enovia","application/json",r,v,p,true)});o.then(function(s){var r=s;var w=[];for(var t in r.criteria){var p=r.criteria[t];var u=[];var u=Object.keys(p);for(var z in u){if((p[u[z]]=="TRUE"||p[u[z]]=="True")&&(w.indexOf(u[z])==-1)){w.push(u[z])}}}if(window.enoviaServerFilterWidget.mode=="Native"){n.renderCriteriaViewNative(w)}else{var v=n.evolutionCritView.getElement(".evoCritContent");var q=n.variantCritView.getElement(".varCritContent");var y=n.evolutionCritView.getElement(".evoCritHeader");var A=n.variantCritView.getElement(".varCritHeader");q.setContent("");v.setContent("");if((w.indexOf("products")>=0)||(w.indexOf("products")==-1&&m.productState=="true")){n.productstateCheckbox=new j({type:"checkbox",value:"productState",className:"primary",checkFlag:(m.productState==="true"||m.productState==="mixedState")?true:false,label:f.Product_state,mixedState:m.productState==="mixedState"?true:false,disabled:(w.indexOf("products")==-1&&m.productState=="true")?true:false}).inject(v);n.productstateCheckbox.addEventListener("click",function(x){n.setUnsetCriteria(n.productstateCheckbox)})}if((w.indexOf("manufacturingPlans")>=0)||(w.indexOf("manufacturingPlans")==-1&&m.manufacturingPlan=="true")){n.manufacturingPlanCheckbox=new j({type:"checkbox",value:"manufacturingPlan",className:"primary",checkFlag:(m.manufacturingPlan==="true"||m.manufacturingPlan==="mixedState")?true:false,label:f.Manufacturing_Plan,mixedState:m.manufacturingPlan==="mixedState"?true:false,disabled:(w.indexOf("manufacturingPlans")==-1&&m.manufacturingPlan=="true")?true:false}).inject(v);n.manufacturingPlanCheckbox.addEventListener("click",function(x){n.setUnsetCriteria(n.manufacturingPlanCheckbox)})}if(n.AllowedCriteria.contextualDate){n.contextualDatebox=new j({type:"checkbox",value:"contextualDate",className:"primary",checkFlag:(m.contextualDate==="true"||m.contextualDate==="mixedState")?true:false,label:f.Date,mixedState:m.contextualDate==="mixedState"?true:false,}).inject(v);n.contextualDatebox.addEventListener("click",function(x){n.setUnsetCriteria(n.contextualDatebox)})}if((n.AllowedCriteria.unit&&w.indexOf("builds")>=0)||(w.indexOf("builds")==-1&&m.unit=="true")){n.unitCheckbox=new j({type:"checkbox",value:"unit",className:"primary",checkFlag:(m.unit==="true"||m.unit==="mixedState")?true:false,label:f.Unit,mixedState:m.unit==="mixedState"?true:false,disabled:(w.indexOf("builds")==-1&&m.unit=="true")?true:false}).inject(v);n.unitCheckbox.addEventListener("click",function(x){n.setUnsetCriteria(n.unitCheckbox)})}if((w.indexOf("variant")>=0)||((w.indexOf("variant")==-1&&m.feature=="true"))){n.featureCheckbox=new j({type:"checkbox",value:"feature",className:"primary",checkFlag:(m.feature==="true"||m.feature==="mixedState")?true:false,label:f.Variant_Options,mixedState:m.feature==="mixedState"?true:false,disabled:(w.indexOf("variant")==-1&&m.feature=="true")?true:false}).inject(q);n.featureCheckbox.addEventListener("click",function(x){n.setUnsetCriteria(n.featureCheckbox)})}}})},setUnsetCriteria:function(o){var q=this;q.toggleLastState=q.enabledCriteriasUX[o.value];q.enabledCriteriasUX[o.value]=o.checkFlag.toString();e.mask(this.criteriaContent);if(window.enoviaServerFilterWidget.mode=="Native"){q.renderActiveCriteria(q.enabledCriteriasUX);e.unmask(this.criteriaContent)}else{var n=null;if(q.caid!=""){n={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+q.caid}}}var m=[];for(var p=0;p<q.options.selection.length;p++){m.push(q.options.selection[p].id)}var r=new Promise(function(w,v){var t="/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1";var x=function(y){w(y)};var u={version:"1.2",pidList:m,content:{enabledCriteria:q.enabledCriteriasUX,}};var u=JSON.stringify(u);var s=function(y,z){if(q.toggleLastState=="mixedState"){q.enabledCriteriasUX[o.value]=q.toggleLastState;o.mixedState=true}else{q.enabledCriteriasUX[o.value]=(!(o.checkFlag)).toString();o.checkFlag=(!(o.checkFlag))}v(z)};l.makeWSCall(t,"POST","enovia","application/json",u,x,s,true,n)});r.then(function(s){q.renderActiveCriteria(q.enabledCriteriasUX);e.unmask(q.criteriaContent)},function(s){q.alertDiv.add({message:f.SetCriteriaFailed,style:{position:"absolute"},className:"error"});q.alertDiv.show();if(s.errorMessage.contains("No model(s) attached to the reference")==true){l.showwarning(f.EnableCriteriaFail,"error")}else{l.showwarning(f.EnableCriteriaFailGeneric,"error")}e.unmask(q.criteriaContent)})}},});return b});define("DS/CfgConfigurationContextUX/CfgContextTileView",["DS/W3DXComponents/Views/Item/TileView",],function(b){var a=b.extend({name:"CfgContextTileView",that:this,template:function(){return'                                        <div class="'+this.getClassNames("-check")+' {{#unless withMultisel}}hidden{{/unless}}">                                            <div class="toggle toggle-primary">                                                <input type="checkbox" name="radios" value="" id="checkbox-{{cid}}">                                                <label class="control-label" for="checkbox-{{cid}}"></label>                                            </div>                                        </div>                                        <div class="'+this.getClassNames("-sub-container")+'" draggable="true">                                            <div class="'+this.getClassNames("-header")+'">                                                {{#if image}}<img src="{{#unless lazyLoading}}{{image}}{{/unless}}" {{getImgAttrs imgAttrs}} class="'+this.getClassNames("-image")+'" draggable="false"/>{{/if}}                                            </div>                                            <div class="'+this.getClassNames("-body")+'">                                                {{#if icon}}<img src="{{icon}}" class="'+this.getClassNames("-icon")+'" draggable="false"/>{{/if}}	                                                <div class="'+this.getClassNames("-title")+'" style="white-space: nowrap;">{{{title}}}</div>                                                <div class="'+this.getClassNames("-subtitle")+'">{{{subtitle}}}</div>                                                <div class="'+this.getClassNames("-content")+'">{{{content}}}</div>                                            <progress max="100" value="10" class="'+this.getClassNames("-progress")+'"></progress>                                            </div>                                            <div class="'+this.getClassNames("-actions")+'">                                                <div class="actions-inline-container" style="display:'+(this.model._attributes.isToPropagate!=true?"none":"flex")+'">                                                    <div class="action-container single-action hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x"></span></div>                                                    </div>                                                    <div class="action-container actions-inline-dotted hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x fonticon-down-open"></span></div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    '},select:function(c){c||(c={});if(c.event.type=="click"){if(this.container.getElement("."+this.name+"-check input").checked==false){this.container.getElement("."+this.name+"-check input").checked=true;this.container.addClassName("selected");this.dispatchEvent("onSelect")}else{this.container.getElement("."+this.name+"-check input").checked=false;this.unSelect(c)}}else{if(c.event.type=="change"){if(this.container.getElement("."+this.name+"-check input").checked==false){this.unSelect(c)}else{this.container.addClassName("selected");this.dispatchEvent("onSelect")}}}},domEvents:function(){return{"click .tile-sub-container":function(c){if(!c||!c.target||!this.container.getElement(".actions-inline-container")||!this.container.getElement(".actions-inline-container").contains(c.target)){this.dispatchEvent("onClick",[c])}},"contextmenu .tile-sub-container":function(c){c.preventDefault();this.dispatchEvent("onContextMenu",[c]);return false},dragstart:this.dispatchAsEventListener("onDrag"),"dblclick .tile-sub-container":function(c){if(!c||!c.target||!this.container.getElement(".actions-inline-container")||!this.container.getElement(".actions-inline-container").contains(c.target)){this.dispatchEvent("onDblClick",[c])}},"change .tile-check input":this.dispatchAsEventListener("onClick")}}});return a});define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView",["DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/W3DXComponents/Views/Layout/GridView","DS/UIKIT/Iconbar","DS/CfgConfigurationContextUX/CfgContextTileView","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Collection","UWA/Class/Model","DS/UIKIT/Scroller","DS/Handlebars/Handlebars","text!DS/CfgConfigurationContextUX/CfgEditConfigurationContextDialogTemplate.html","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","DS/WebappsUtils/WebappsUtils","UWA/Class/View","DS/UIKIT/Tooltip","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgConfigurationContextUX/CfgConfigurationContextCriteria","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","DS/UIKIT/Mask","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],function(i,m,b,a,l,n,w,k,u,f,e,t,d,r,s,p,c,h,g,q,x){var j=f.compile(e);var o=null;var v=r.extend({collection:null,className:"CfgEditConfigurationContextView",gridListView:null,CfgFloatingPanel:null,toolBar:null,activatedView:"ModelView",caid:"",selectedModelsList:[],modelDefination:k.extend({defaults:function(){return{id:null,type:"",marketingName:"",name:"",state:"",description:"",label:"",subLabel:"",icon:"",thumbnail:"",maturity:"",isactive:false}}}),setup:function(){},init:function(z){this._parent(z);this.alertDiv=new i({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"error"});var y={};var B={};if(window.enoviaServerFilterWidget.mode!=="Native"){y.selection=z.selection}y.enabledCriterias=z.enabledCriteriaArray;if(z.IsManufPlanAllowedFromNative!=undefined){y.IsManufPlanAllowedFromNative=z.IsManufPlanAllowedFromNative}if(JSON.parse(q).isCriteriaViewEnabled){this.criteriaView=new g(y)}var A=this;var C=function(D){console.log(D);if(D.isLicenseValid!=undefined&&D.isLicenseValid==false){return}A.caid=D.change.id};h.get2(C)},render:function(){this.selectedModelsList=[];var A="";var F={};F.NoModelAttached=t.NoModelAttached;var C=this;x.mask(this.container);x.unmask(this.container);this.getDefaultImage();this.createCollection(this.options);var z=UWA.createElement("div",{"class":"main-Context-container"});var B=this.headercontainer=new UWA.createElement("div",{"class":"header-container",html:[{tag:"div","class":"currCriteria-container"},{tag:"div","class":"toolbar-container"}]});var y=UWA.createElement("div",{"class":"no-model-attached",});var D=UWA.createElement("div",{"class":"gridlistview-dialog-container",});var E=this.criteriaContent=new UWA.createElement("div",{"class":"CriteriaContent"});this.container.addContent(B);if(this.criteriaView){this.criteriaContent.setContent(this.criteriaView.render(this.collection))}z.addContent(this.criteriaContent);z.addContent(y);z.addContent(D);z.setStyle("height","calc(100% - 50px)");new u({element:z}).inject(this.container);this.createToolbar();this.createHeader();this.createView();this.GridView=this.container.getElement(".gridlistview-dialog-container");this.EmptyView=this.container.getElement(".no-model-attached");this.EmptyView.setContent("<span><img src="+this.defaultIcon+' style="width:25%;"></img></span><br>');this.EmptyView.addContent('<font-size="17px">'+F.NoModelAttached+"</font>");this.EmptyView.setStyle("color","silver");this.EmptyView.setStyle("text-align","center");this.EmptyView.setStyle("display","inline-flex");this.EmptyView.setStyle("flex-direction","column");this.EmptyView.setStyle("justify-content","center");this.filpflopDivs();this.alertDiv.inject(this.container,"top");this.collection.addEvent("onAdd",function(){C.createToolbar();C.filpflopDivs();var H=C.countExistingCriteria(C.criteriaView.enabledCriteriasUX);if(C.collection&&C.collection.length==1&&(H==0||(window.enoviaServerFilterWidget.mode=="Native"))){var I=[];C.collection.forEach(function(K,J){I.push({id:"pid:"+K.id})});var G;C.isModelVersionAvailable(I).then(function(N){G=N;var J=N;var M=N.criteria;var L=[];M.forEach(function(R,P){var O=M[P];var Q=[];var Q=Object.keys(O);Q.forEach(function(T,S){if((O[Q[S]]=="TRUE"||O[Q[S]]=="True")&&(L.indexOf(Q[S])==-1)){L.push(Q[S])}})});var K={feature:(L.indexOf("variant")>=0)?"true":"false",productState:(L.indexOf("products")>=0)?"true":"false"};if(C.criteriaView){C.criteriaView.updateCollection(C.collection,K)}if(C.criteriaView){C.criteriaView.renderCriteriaView()}})}else{if(C.criteriaView){C.criteriaView.updateCollection(C.collection)}if(C.criteriaView){C.criteriaView.renderCriteriaView()}}});this.collection.addEvent("onRemove",function(){C.createToolbar();C.filpflopDivs();if(C.criteriaView){C.criteriaView.updateCollection(C.collection);C.criteriaView.renderCriteriaView()}});z.addEvent("resize",function(){setTimeout(function(){},50)});return this.container},onResize:function(){},createToolbar:function(){if(this.toolBar){this.toolBar.destroy()}var y=this;this.toolBar=new a({renderTo:this.container.getElement(".toolbar-container"),items:y.getToolBarItems(),})},getToolBarItems:function(){var y=this;var z=[];z.push({fonticon:"plus",text:t.Attach,handler:function(B,A){y.activateSearch()}});if(this.selectedModelsList.length>0){z.push({fonticon:"trash",text:t.Detach,handler:function(E,D){x.mask(y.container);var C=null;if(y.caid!=""){C={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+y.caid}}}if(y.selectedModelsList.length>0){if(window.enoviaServerFilterWidget.mode=="Native"){for(D=0;D<y.selectedModelsList.length;){var B=y.selectedModelsList[D];y.selectedModelsList.splice(0,1);y.collection.remove(B);x.unmask(y.container)}}else{var A=[];for(D=0;D<y.options.selection.length;D++){A.push(y.options.selection[D].id)}y.setConfigurationContext("RemoveContext",C,A,y.selectedModelsList).then(function(F){if(F.result=="SUCCEED"){y.ondetach(y,F,"SUCCEED");x.unmask(y.container)}else{if(F.result=="FAILED"){y.ondetach(y,F,"FAILED");x.unmask(y.container)}else{y.alertDiv.add({message:t.DetachFailed,style:{position:"absolute"},className:"error"});y.alertDiv.show();x.unmask(y.container)}}},function(){y.alertDiv.add({message:t.DetachFailed,style:{position:"absolute"},className:"error"});y.alertDiv.show();x.unmask(y.container)})}}}})}if(this.criteriaView){if(this.collection&&this.collection.length>0&&this.options.isCriteriaEditable){if(this.activatedView==="ModelView"){z.push({fonticon:"cog",text:t.EditCriteria,handler:function(B,A){y.editCriteria(true)}})}else{if(this.activatedView==="CriteriaView"){z.push({className:"criteriaActiveCog",fonticon:"cog",text:t.EditCriteria,handler:function(B,A){y.editCriteria(false)}})}}}}return z},setConfigurationContext:function(A,H,z,C,E){var B=this;var D=[];var F=[];var G=[];if(z!=null&&z!=undefined){D=z}if((A=="PropagateContext"||A=="AddContext")&&C!=undefined&&C!=null){F=C}else{if(A=="RemoveContext"&&C!=undefined&&C!=null){G=C}}var y=new Promise(function(M,L){var J="/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1";var N=function(O){M(O)};var K={version:"1.2",pidList:D,content:{attachCfgCtxt:F,detachCfgCtxt:G}};if(E!=undefined&&E!=null){K.content.enabledCriteria=E}var K=JSON.stringify(K);var I=function(O){console.log(O);L(O)};n.makeWSCall(J,"POST","enovia","application/json",K,N,I,true,H)});return y},createHeader:function(){var y=this.container.getElement(".currCriteria-container");if(this.criteriaView){y.setContent(this.criteriaView.getActiveCriteria())}},ondetach:function(G,K,N){var L=false;var A=0;var I=0;var J=0;var C=[];var D=[];var y=[];for(var P=0;P<K.details.length;P++){for(var E=0;E<K.details[P].contexts.content.length;E++){var B=K.details[P].contexts.content[E];if(B.status=="detached"){var z=B.attributes[0].physicalID;var F=G.selectedModelsList.indexOf(z);if(C.indexOf(z)==-1){C.push(z);A++}if(N=="SUCCEED"){if(F!==-1){G.selectedModelsList.splice(F,1)}L=true;G.collection.remove(z)}}else{if(B.status=="ERROR"){if(D.indexOf(B.attributes[0].physicalID)==-1){D.push(B.attributes[0].physicalID)}var H=B.attributes[0].basicData.length;var M="";for(var O=0;O<H;O++){if(B.attributes[0].basicData[O].name=="name"&&B.attributes[0].basicData[O].value!=undefined){M=B.attributes[0].basicData[O].value[0]}}if(B.errorCode=="03"){I++;y.push(M)}else{if(B.errorCode=="02"){J++}}}}}}if(C.length!=null&&C.length>=1){D.forEach(function(R,Q){if(C.indexOf(D[Q])!=-1){C.pop(D[Q])}})}C.forEach(function(S,Q){var R=G.selectedModelsList.indexOf(C[Q]);if(R!==-1){G.selectedModelsList.splice(R,1)}L=true;G.collection.remove(C[Q])});if(K.result=="FAILED"&&(A>=1||I>=1||J>=1)){if(I>=1&&A>=1){G.alertDiv.add({message:t.PartialDetachFailed,style:{position:"absolute"},className:"error"});G.alertDiv.show()}else{if(I>=1&&A==0){y.forEach(function(Q,R){G.alertDiv.add({message:y[R]+" "+t.HasEffectivityReferences,style:{position:"absolute"},className:"error"});G.alertDiv.show()})}else{if(J>=1){G.alertDiv.add({message:t.HasProductConfigurationsReferences,style:{position:"absolute"},className:"error"});G.alertDiv.show()}else{G.alertDiv.add({message:t.DetachFailed,style:{position:"absolute"},className:"error"});G.alertDiv.show()}}}}if(L==true){for(var E=0;E<G.selectedModelsList.length;E++){G.collection.get(G.selectedModelsList[E])._attributes.isactive=false}G.selectedModelsList=[]}G.filpflopDivs()},filpflopDivs:function(){if(this.collection.length<=0){this.activatedView="ModelView";this.GridView.setStyle("display","none");this.EmptyView.setStyle("display","flex");this.criteriaContent.setStyle("display","none");var A=this.container.getElement(".currCriteria-container");A.setStyle("display","none")}else{var A=this.container.getElement(".currCriteria-container");A.setStyle("display","flex");if(this.activatedView==="ModelView"){this.GridView.setStyle("display","flex");this.EmptyView.setStyle("display","none");this.criteriaContent.setStyle("display","none")}else{if(this.activatedView==="CriteriaView"){var z=this.headercontainer.getDimensions().height;var B=this.criteriaContent.getDimensions().height;var y=(this.GridView.getDimensions().height)-(B+z);this.GridView.setStyle("height",y);this.GridView.setStyle("display","flex");this.EmptyView.setStyle("display","none");this.criteriaContent.setStyle("display","block")}}}},flipflopMinusButton:function(){},searchcomponentcallback:function(D,B){var y=[];var D=this;D.iFromSearchPanel=B;for(var A=0;A<B.length;A++){y.push(B[A].get("id"))}x.mask(D.container);var F=function(I,K){if(I.length>0){var H=null;if(D.caid!=""){H={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+D.caid}}}var G=[];var J=K;for(A=0;A<D.options.selection.length;A++){G.push(D.options.selection[A].id)}D.setConfigurationContext("AddContext",H,G,y,J).then(function(L){if(L.result=="SUCCEED"){D.onattach(D,L);x.unmask(D.container)}else{D.alertDiv.add({message:t.AttachFailed,style:{position:"absolute"},className:"error"});D.alertDiv.show();x.unmask(D.container)}},function(L){if(L.errorID=="103"){D.alertDiv.add({message:t.V5AttachFailed,style:{position:"absolute"},className:"error"});D.alertDiv.show()}else{D.alertDiv.add({message:t.AttachFailed,style:{position:"absolute"},className:"error"});D.alertDiv.show()}x.unmask(D.container)})}};var C=D.countExistingCriteria(D.criteriaView.enabledCriteriasUX);if(D.collection&&D.collection.length==0&&C==0){var z;var E=[];y.forEach(function(G){E.push({id:"pid:"+G})});o=null;D.isModelVersionAvailable(E).then(function(K){z=K;var G=K;var J=K.criteria;var I=[];J.forEach(function(O,M){var L=J[M];var N=[];var N=Object.keys(L);N.forEach(function(Q,P){if((L[N[P]]=="TRUE"||L[N[P]]=="True")&&(I.indexOf(N[P])==-1)){I.push(N[P])}})});var H={feature:(I.indexOf("variant")>=0)?"true":"false",productState:(I.indexOf("products")>=0)?"true":"false"};F(D.iFromSearchPanel,H)})}else{F(D.iFromSearchPanel)}},countExistingCriteria:function(y){var A=Object.keys(y);var B=y;var z=0;A.forEach(function(D,C){if(B[A[C]]=="true"){z++}});return z},isModelVersionAvailable:function(y){var z=this;if(o!=null){return o}var A=new Promise(function(F,E){var G=[];G=y;var C="/resources/modeler/browsing/model/getcriteria";var D={version:"1.0.0",modelIds:G};D=JSON.stringify(D);var H=function(J){var I=J;var L=J.criteria;var K=[];L.forEach(function(P,N){var M=L[N];var O=[];var O=Object.keys(M);O.forEach(function(R,Q){if((M[O[Q]]=="TRUE"||M[O[Q]]=="True")&&(K.indexOf(O[Q])==-1)){K.push(O[Q])}})});console.log("resulltArray : "+K);F(J)};var B=function(I){console.log("fail to get last product evolution")};n.makeWSCall(C,"POST","enovia","application/json",D,H,B,true)});o=A;return A},onattach:function(G,E){if(window.enoviaServerFilterWidget.mode=="Native"){var z;z=E.contextList;if(z.length>0){z.forEach(function(N){if(N&&N.physicalID){var R="";var O="";var L="";var K="";var V="";var T="";var S="";var M=N.isToPropagate;var U=N.basicData.length;for(var P=0;P<U;P++){if(N.basicData[P].name=="type"&&N.basicData[P].value!=undefined){R=N.basicData[P].value}if(N.basicData[P].name=="name"&&N.basicData[P].value!=undefined){T=L=S=O=N.basicData[P].value}if(N.basicData[P].name=="current"&&N.basicData[P].value!=undefined){K=N.basicData[P].value[1]}if(N.basicData[P].name=="owner"&&N.basicData[P].value!=undefined){V=N.basicData[P].value}}if(N.propValue!=undefined){M=N.propValue}var Q=new G.modelDefination({id:N.physicalID,type:R||"",marketingName:O||"",name:L||"",state:K,description:V||"",label:T,subLabel:S,thumbnail:"",maturity:"",isactive:false,preview_url:N.preview_url,icon:G.defaultIcon,isToPropagate:M});G.collection.add(Q);G.filpflopDivs()}})}}else{for(var C=0;C<E.details.length;C++){for(var H=0;H<E.details[C].contexts.content.length;H++){var F=E.details[C].contexts.content[H];if(F.attributes[0].preview_url==""){F.attributes[0].preview_url=G.defaultImage}var A=" ";if(F.attributes[0].data[0].value!=undefined){A=F.attributes[0].data[0].value[0]}if(F.status=="attached"){var B="";var y="";var J="";var I=F.attributes[0].basicData.length;for(var D=0;D<I;D++){if(F.attributes[0].basicData[D].name=="name"&&F.attributes[0].basicData[D].value!=undefined){B=F.attributes[0].basicData[D].value[0]}if(F.attributes[0].basicData[D].name=="owner"&&F.attributes[0].basicData[D].value!=undefined){J=F.attributes[0].basicData[D].value[0]}if(F.attributes[0].basicData[D].name=="current"&&F.attributes[0].basicData[D].value!=undefined){y=F.attributes[0].basicData[6].value[0]}}var F=new G.modelDefination({id:F.attributes[0].physicalID,type:F.attributes[0].type,marketingName:A,name:B,state:y,description:J,label:B,subLabel:B,thumbnail:"",maturity:"",isactive:false,preview_url:F.attributes[0].preview_url,icon:G.defaultIcon,isToPropagate:false});G.collection.add(F)}else{if(F.status=="alreadyAttached"){var B="";var y="";var J="";var I=F.attributes[0].basicData.length;for(var D=0;D<I;D++){if(F.attributes[0].basicData[D].name=="name"&&F.attributes[0].basicData[D].value!=undefined){B=F.attributes[0].basicData[D].value[0]}if(F.attributes[0].basicData[D].name=="owner"&&F.attributes[0].basicData[D].value!=undefined){J=F.attributes[0].basicData[D].value[0]}if(F.attributes[0].basicData[D].name=="current"&&F.attributes[0].basicData[D].value!=undefined){y=F.attributes[0].basicData[6].value[0]}}var F=new G.modelDefination({id:F.attributes[0].physicalID,type:F.attributes[0].type,marketingName:A,name:B,state:y,description:J,label:B,subLabel:B,thumbnail:"",maturity:"",isactive:false,preview_url:F.attributes[0].preview_url,icon:G.defaultIcon,isToPropagate:false});G.collection.add(F)}}}G.filpflopDivs()}}},activateSearch:function(){if(window.enoviaServerFilterWidget.mode=="Native"){var E=this;var H=[];E.collection.forEach(function(O,N){H.push(O.id)});var y={modelIds:H,};var I=JSON.stringify(y);var z={eventName:"cfgConfigurationContext",operation:"ActivateSearch",operationVersion:"1.0",content:I};n.sendNotificationWebInWin(z)}else{var G="";var F="Model";var C=enoviaServerFilterWidget.myRole;var J='( NOT current:"Inactive")';var L="";var M=new p(true);var E=this;var K=function(N){E.searchcomponentcallback(E,N)};var A=[];for(var B=0;B<this.collection.length;B++){var D=this.collection.at(B);A.push(D.id)}M.activate(G,F,C,K,J,A)}},editCriteria:function(y){if(y==true){this.activatedView="CriteriaView"}else{this.activatedView="ModelView"}this.filpflopDivs();this.createToolbar()},createCollection:function(y){var z,B=[];var A=this;var C;C=y.contextList;if(C!=undefined&&C.length>0){C.forEach(function(G){if(G&&G.physicalID){var J="";var H="";var E="";var D="";var O="";var L="";var K="";var F=true;var N="";var M=G.basicData.length;for(var I=0;I<M;I++){if(G.basicData[I].name=="type"&&G.basicData[I].value!=undefined){J=G.basicData[I].value}if(G.basicData[I].name=="name"&&G.basicData[I].value!=undefined){L=E=K=H=G.basicData[I].value}if(G.basicData[I].name=="current"&&G.basicData[I].value!=undefined){D=G.basicData[I].value[1]}if(G.basicData[I].name=="owner"&&G.basicData[I].value!=undefined){O=G.basicData[I].value}}if(G.data.length>0){H=G.data[0].value[0]}if(G.preview_url==null||G.preview_url==undefined||G.preview_url==""){N=A.defaultImage}else{N=G.preview_url}if(G.isToPropagate!=undefined){F=G.isToPropagate}z={id:G.physicalID,type:J||"",marketingName:H||"",name:E||"",state:D,description:O||"",label:L,subLabel:K,thumbnail:"",maturity:"",isactive:false,preview_url:N,icon:A.defaultIcon,isToPropagate:F};B.push(z)}})}this.collection=new w(B,{model:this.modelDefination})},getDefaultImage:function(){this.defaultImage=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png";this.defaultIcon=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png"},createView:function(){var y=this;this.gridListView=new b({collection:y.collection,withMultisel:false,selectionMode:"nullToMany",useInfiniteScroll:false,itemView:l,itemViewOptions:{className:"item-view",mapping:{title:"marketingName",image:function(){if(this.model.get("preview_url")==null){return y.defaultImage}else{return this.model.get("preview_url")}},subtitle:function(){var z=new UWA.Element("div",{id:"subtitle",html:"<span class=type>"+this.model.get("subLabel")+"</span>",styles:{"white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}});new s({target:z,body:this.model.get("subLabel")});return z.innerHTML},content:function(){var B=this.model.get("state");if(B=="Preliminary"){B=t.Preliminary}else{if(B=="Marketing"){B=t.Marketing}else{if(B=="Review"){B=t.Review}else{if(B=="Active"){B=t.Active}else{if(B=="Inactive"){B=t.Inactive}}}}}var A=new UWA.Element("div",{id:"pcStatus",html:"<span class=type>"+t.Maturity+":"+B+"</span>"});var C=new UWA.Element("div",{id:"pcDesc",html:"<span class=type>"+t.Owner+":"+this.model.get("description")+"</span>",styles:{"white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}});var z=new UWA.Element("div",{id:"pcCont"});z.appendChild(A);z.appendChild(C);new s({target:C,body:this.model.get("description")});return z.innerHTML},icon:"icon"},contextualActions:[{id:"PropagateModel",text:t.PropagateModelTooltip,fonticon:"propagate",icon:"PropagateModel",multisel:true,handler:function(D){var C=y.container;x.mask(C);var G=y;var z=D.container.getElementsByClassName("actions-inline-container");var H=null;if(y.caid!=""){H={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+y.caid}}}var E=[];var F=[];var A=D.model.get("marketingName");F.push(D.model.id);for(var B=0;B<y.options.selection.length;B++){E.push(y.options.selection[B].id)}y.setConfigurationContext("PropagateContext",H,E,F).then(function(I){if(I.result=="SUCCEED"){z[0].style.display="none";x.unmask(C);n.showwarning(A.toString()+" "+t.PropagateModelSuccessful,"success")}else{x.unmask(C);n.showwarning(A.toString()+" "+t.PropagateModelFailed,"error")}},function(I){if(I.errorID=="103"){y.alertDiv.add({message:t.V5AttachFailed,style:{position:"absolute"},className:"error"});y.alertDiv.show()}else{y.alertDiv.add({message:t.PropagateModelFailed,style:{position:"absolute"},className:"error"});y.alertDiv.show()}x.unmask(C)})}}]},events:{onItemViewClick:function(A,z){y.ontileviewclick(this,A,z)},onItemViewCheck:function(A,z){y.ontileviewclick(this,A,z)}}});this.gridListView.render().inject(this.container.getElement(".gridlistview-dialog-container"))},ontileviewclick:function(B,A,y){if(A.model._attributes.isactive==true){A.model._attributes.isactive=false;B._selectionState.isActive=false;var z=this.selectedModelsList.indexOf(A.model.id);if(z!==-1){this.selectedModelsList.splice(z,1)}}else{A.model._attributes.isactive=true;B._selectionState.isActive=true;var z=this.selectedModelsList.indexOf(A.model.id);if(z==-1){this.selectedModelsList.push(A.model.id)}}this.createToolbar()},getModelIdsAndEnabledCriteria:function(z){var B=this;var C=[];B.collection.forEach(function(F,E){C.push(F.id)});var y=[];y=Object.getOwnPropertyNames(B.criteriaView.enabledCriteriasUX);var A=[];y.forEach(function(E){if(B.criteriaView.enabledCriteriasUX[E]=="true"){A.push(E)}});var D={modelIds:C,enabledCriteria:A,};return D}});return v});define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextDialog",["DS/UIKIT/Alert","DS/ENOFloatingPanel/ENOFloatingPanel","DS/CfgBaseUX/scripts/CfgDialog","DS/UIKIT/Input/Button","UWA/Class/Collection","UWA/Class/Model","DS/UIKIT/Scroller","DS/Handlebars/Handlebars","text!DS/CfgConfigurationContextUX/CfgEditConfigurationContextDialogTemplate.html","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","UWA/Class/View","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgContainerView","DS/UIKIT/Mask","DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],function(e,j,m,h,q,g,o,b,a,n,l,c,k,i,d,r){var f=b.compile(a);var p=l.extend({collection:null,className:"CfgEditConfigurationContextDialog",gridListView:null,CfgFloatingPanel:null,caid:"",selectedModelsList:[],setup:function(){},init:function(s){this._parent(s);this.alertDiv=new e({visible:false,autoHide:true,hideDelay:3000,closeOnClick:true,maximumVisibleMessages:3,className:"error"});var t=this;var u=function(v){console.log(v);if(v.isLicenseValid!=undefined&&v.isLicenseValid==false){return}t.caid=v.change.id};c.get2(u);this.criteriaEditable=true},render:function(){var v=this;this.selectedModelsList=[];var y="";var t={};t.NoModelAttached=n.NoModelAttached;var w=[{label:n.Cancel,handler:function(){v.CfgFloatingPanel.closeDialog()},className:"primary"}];r.mask(this.container);r.unmask(this.container);var B={};B.enabledCriteriaArray=this.getActivatedCriteriaStates(v.options.response.enabledCriteria,v.options.selection);B.contextList=this.createCollectionForView(v.options.response);B.selection=v.options.selection;this.isCriteriaEditableCheck(v.options.response.referencesInfo);B.isCriteriaEditable=this.criteriaEditable;var x=new k(B);var s="";if(this.options.selection.length>1){s=n.Header+" - "+this.options.selection.length+" "+n.Header_All_Ref}else{s=n.Header+" - "+this.options.selection[0].alias}this.MainContainer=new UWA.Element("div",{id:"CtxView",html:x.render(),styles:{width:"100%",height:"100%"}});var u={className:"CfgEditConfigurationFloatingPanel",title:s,body:this.MainContainer,overlay:true,mode:"DashboardConfigurationContext",closable:false,animate:true,resizable:true,footer:w,appNamePosition:0,style:{"min-height":"350px"},dialogue:{header:s,buttonArray:w,target:widget.body,}};var A=UWA.createElement("div",{"class":"no-model-attached",});var z=UWA.createElement("div",{"class":"gridlistview-dialog-container",});this.CfgFloatingPanel=new m(u);u.parent=widget.body;u.parentElement=widget.body;u.dialogue.object=this.CfgFloatingPanel;this.MainContainer.inject(this.CfgFloatingPanel.container);this.CfgFloatingPanel.render();this.CfgFloatingPanel.resizeDialog=function(){if((document.querySelector("div.header-container").getDimensions().height)>75){document.querySelector("div.main-Context-container").setStyle("height","calc(100% - 80px)")}else{document.querySelector("div.main-Context-container").setStyle("height","calc(100% - 50px)")}};document.getElementsByClassName("CfgDashboardConfigurationContextDialog")[0].setAttribute("style",document.getElementsByClassName("CfgDashboardConfigurationContextDialog")[0].getAttribute("style")+"min-height:300px !important;min-width:350px !important;");this.alertDiv.inject(this.container,"top");widget.addEvent("onResize",function(){})},getActivatedCriteriaStates:function(v,t){var u={};for(var s=0;s<v.length;s++){if(v[s].activatedFor.length==t.length){u[v[s].criteriaName]="true"}else{if((v[s].activatedFor.length<t.length)&&(v[s].activatedFor.length>0)){u[v[s].criteriaName]="mixedState"}else{if(v[s].activatedFor.length==0){u[v[s].criteriaName]="false"}}}}return u},createCollectionForView:function(s){var t,v=[];var u=this;var w;if(s.version=="1.0"){w=s.contextInfo}if(w.length>0){w.forEach(function(x){if(x&&x.modelPID){var y=true;if(x.notContextOf.length==0&&x.notContextOf.length!=undefined&&x.notContextOf.length!=null){y=false}t=x.content.results[0];t.isToPropagate=y;v.push(t)}})}return v},isCriteriaEditableCheck:function(t){var s=this;t.forEach(function(u){if(u.isCriteriaEditable=="NO"){s.criteriaEditable=false}})},onResize:function(){},closeDialog:function(){if(this.CfgFloatingPanel){this.CfgFloatingPanel.destroy()}},renderNative:function(s){var u=this;var t={isHeader:false,isFooter:true,firstButtonText:"Close",headerText:"",onButtonClickCB:function(){var w=u.CfgEditMultipleConfigurationContextView.getModelIdsAndEnabledCriteria();w=JSON.stringify(w);var v={eventName:"cfgConfigurationContext",operation:"onClose",operationVersion:"1.0",content:w};i.sendNotificationWebInWin(v)}};this.contextViewContainer=new d(t).render();this.contextViewContainer.inject(s.parent);s.parent=this.contextViewContainer._body;s.isCriteriaEditable=this.criteriaEditable;this.CfgEditMultipleConfigurationContextView=new k(s);if(this.CfgEditMultipleConfigurationContextView){s.parent.setHTML(this.CfgEditMultipleConfigurationContextView.render())}},onModelSearchOK:function(s){this.CfgEditMultipleConfigurationContextView.onattach(this.CfgEditMultipleConfigurationContextView,s)}});return p});