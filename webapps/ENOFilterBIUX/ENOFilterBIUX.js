define("DS/ENOFilterBIUX/FBISettings",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Data","DS/WebappsUtils/WebappsUtils","text!DS/ENOFilterBIUX/assets/FBISettings.json"],function(e,g,d,c,h,a,f){var i=function(j){var k=/(http|https):\/\//;return k.test(j)};var b=g.singleton(d,c,{options:{fbi_settings:{},},loadComplete:false,settings_loaded:[],onCompleteLoad:undefined,init:function(j){this.options=JSON.parse(f);this.debugMode=this.getDebugMode()},load:function(j){this.log("FBISettings load");if(this.settings_loaded.indexOf(j.url)){this.onCompleteLoad=j.onComplete;this._loadSettings(j.url);this.settings_loaded.push(j.url)}},urlSettings:function(k){if(e.is(k.debug_me)){this.options.FBI_settings.debug_mode=true}if(this.options.FBI_settings.debug_mode===true){this.debugMode=true}this.log("updateSettings from the URL done");for(var j in k){if(j==="debug_me"){this.log("Debug mode already taken into account")}else{var l=k[j];if(((typeof l!="undefined")&&(typeof l.valueOf()=="string"))&&l.length>0){if(l.toLowerCase()=="false"){l=false}else{if(l.toLowerCase()=="true"){l=true}}}this.options.FBI_settings[j]=l}}},initialize:function(j){this.options=UWA.extend(this.options,j,true);this.debugMode=this.getDebugMode()},setOption:function(j,k){this.options.fbi_settings[j]=k},serialize:function(){return JSON.stringify(this.options)},getDebugMode:function(){if(UWA.is(this.options)&&UWA.is(this.options.fbi_settings)&&this.options.fbi_settings.debug_mode){return true}else{return false}},getOption:function(j){if(UWA.is(this.options)){if(UWA.is(this.options.fbi_settings)&&UWA.is(this.options.fbi_settings[j])){return this.options.fbi_settings[j]}else{if(UWA.is(this.options.NGF_settings)&&UWA.is(this.options.NGF_settings[j])){return this.options.NGF_settings[j]}else{if(UWA.is(this.options[j])){return this.options[j]}}}}else{return undefined}},_loadSettings:function(k){var n=this;var p={};var j={timeout:50000,method:"GET",data:p,type:"json",headers:{Accept:"application/ds-json"},onComplete:function(s){n.log("FBISettings load settings onComplete");var q={},r={};if(e.is(s,"string")){q=JSON.parse(s)}else{q=s}if(q.error){n.log("Bad format for FBISettings")}else{n.initialize(q)}n.loadComplete=true;if(e.is(n.onCompleteLoad,"function")){n.onCompleteLoad.call(undefined,null)}n.log("Available FBI Settings:\n"+JSON.stringify(n.options))},onFailure:function(q){e.log("No settings found");if(e.is(n.onCompleteLoad,"function")){n.onCompleteLoad.call(undefined,null)}},onTimeout:function(q){n.log("No settings found timeout reach")}};try{if(!i(k)){var m="";m=a.getWebappsBaseUrl();var l=/\/$/;m=m.replace(l,"");this.log("Base URL "+m);if(!i(m)){this.log("The base URL is not a valid one (webapp context?)");m=""}k=m+k}this.log("Used URL "+k);h.request(k,j)}catch(o){this.log("Failure : "+o)}}});return b});define("DS/ENOFilterBIUX/FilterBIProxyController",["UWA/Class","UWA/Core"],function(c,b){var a=[];var d=c.singleton({WIDGETS_PRIORITIES:[],init:function(e){d.WIDGETS_PRIORITIES.push(0)},add:function(e){a.push(e)},addPriority:function(g){var e=d.WIDGETS_PRIORITIES.length;for(var f=0;f<e;f++){if(d.WIDGETS_PRIORITIES[f]!==g){d.WIDGETS_PRIORITIES.push(g);break}}},minPriority:function(){return Math.min.apply(null,d.WIDGETS_PRIORITIES)},removePriority:function(g){var e=d.WIDGETS_PRIORITIES.length;for(var f=0;f<e;f++){if(d.WIDGETS_PRIORITIES[f]===g){delete d.WIDGETS_PRIORITIES[f]}}},remove:function(e){var h=a.length;for(var g=h-1;g>=0;g--){var f=a[g];if(f.appId===e.appId&&f.widgetId===e.widgetId){a.splice(g,1);break}}if(1===a.length){a[0].setProxyAsMaster()}},synchronize:function(f,g,e){a.forEach(function(h){if(h.appId===f){g(e)}})}});return d});Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};define("DS/ENOFilterBIUX/FBIServices",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Promise","UWA/Date","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOFilterBIUX/FBISettings","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/UWPClientCode/I18n"],function(h,i,c,e,g,f,a,d,j,b){var k=i.singleton(c,{DEFAULT_LANG:"en",_nodes:[],_groupedData:{},_tree:[],_fetchV2URL:null,_expandSynthesisURL:null,_tenantId:null,init:function(){},_setTree:function(l){this._tree=l},_setNodes:function(l){this._nodes=l},cleanAll:function(){this._groupedData={};this._tree=[];this._nodes=[]},getPlatformServices:function(m){var l=this;return new e(function(o,n){if(null===l._fetchV2URL){a.getPlatformServices({onComplete:function(q){l.setOption("str_platformServices",q);for(var p=0;p<q.length;p++){if(m===q[p].platformId){l._fetchV2URL=q[p]["3DSpace"]+"/cvservlet/fetch/v2";l._tenantId=m;o(l._fetchV2URL)}}},onFailure:function(p){n(p)}})}else{o(l._fetchV2URL)}})},getPlatformUrlAccordingToTenant:function(p){var n;var o=p?p:this._tenantId;var m=this.getOption("str_platformServices");for(var l=0;l<m.length;l++){if(o===m[l].platformId){n=m[l]}}return n},getRESTHeaders:function(){var l={Accept:"application/json","Content-Type":"application/json","Accept-Language":k.getLanguage().toLowerCase()};return l},getPlatformId:function(){var l=null;l=this.getPlatformUrlAccordingToTenant().platformId;return l},fetch:function(r,m,t){this._setTree(t);this._setNodes(m);var o=this,s=this._buildArrayPid(),n=1000,p=s.length/n,q=Number.isInteger(p)?p:parseInt(p)+1,l=[];return new e(function(v,u){k.getPlatformServices(o._tenantId).then(function(){var w=[];for(var x=0;x<q;x++){var y=[];l.push(o._executeFetch(s,w,y,(x*n),n))}}).then(function(w){return e.all(l).then(function(x){var B=null;if(x.length){var A={results:[]};for(var z=0;z<x.length;z++){if(x[z].results){for(var y=0;y<x[z].results.length;y++){A.results.push((x[z].results)[y])}}}B=o._parse(A)}else{B=o._parse(x[0])}v(B)})})})},_buildArrayPid:function(){var l=this._nodes,o=l.length,n=[];for(var m=0;m<o;m++){n[m]=l[m]}return n},_parse:function(p){var t=p.results,u=this,w={},v=[],n=[],x={};for(var y=0;y<t.length;y++){var r=t[y].attributes,o=u._getIdPathsForID(r[0].value);for(var s=1;s<r.length;s++){if(r[s].format!=="internal"){if(!w[r[s].name]){w[r[s].name]={}}if(r[s].format==="attribute"){if(!x[r[s].name]){x[r[s].name]=true;n.push({sixw:r[s].name,type:r[s].type.toLowerCase()})}}if(r[s].type==="date"){r[s].value=r[s].value.split("-").join("/").substr(0,10)}if(!w[r[s].name][r[s].value]){w[r[s].name][r[s].value]={};w[r[s].name][r[s].value].format=r[s].format;w[r[s].name][r[s].value].type=r[s].type;w[r[s].name][r[s].value].dispValue=r[s].dispValue||r[s].value;w[r[s].name][r[s].value].value=r[s].value||r[s].dispValue}for(var q=0;q<o.length;q++){w[r[s].name][r[s].value][o[q].id]={pathID:o[q].id,path:o[q].path}}}}}for(var m in w){if(w.hasOwnProperty(m)){for(var l in w[m]){if(w[m].hasOwnProperty(l)){if(w[m][l].format==="ds6w_facet"){v.push({object:w[m][l].value,sixw:m,count:u._getObjectSize(w[m][l]),type:w[m][l].type,dispValue:w[m][l].dispValue,})}}}}}h.extend(u._groupedData,w,true);return{response:p,grouped:w,summary:v,suggested:n,unfilteredStructure:u._groupedData}},_getObjectSize:function(n){var m=0,l;for(l in n){if(n.hasOwnProperty(l)&&!h.is(n[l],"string")&&-1===l.lastIndexOf("dispValue")&&-1===l.lastIndexOf("value")){m++}}return m},findColoredPaths:function(o,m){var n={},p={};if(m.type==="date"){p=o[m.predicate];for(var l in p){if(p.hasOwnProperty(l)){if(l.indexOf(m.object)!==-1){h.merge(n,p[l])}}}}else{if(Array.isArray(m.object)){n=o[m.predicate][this._buildValueForHierarchicalTags(m.object)]}else{n=o[m.predicate][m.object]}}return n},_buildValueForHierarchicalTags:function(m){var o=false;var p=m[m.length-1];if(m.length>1&&(p.contains("/"))){o=true;var l;for(var n=0;n<m.length-2;n++){l=m[n].concat(","+m[n+1])}if(l){p=l+","+p}p=p.replace(/\//g,",")}if(o){return p}else{return m}},_getIdPathsForID:function(m){var l=this;return this._tree.filter(function(n){var o=n.path;return m===l._nodes[o[o.length-1]]})},convertFromIndexToPID:function(s,r){var n=[],q="";for(var p=0;p<r.length;p++){for(var o=0;o<r[p].length;o++){q+=s[r[p][o]];if(o<r[p].length-1){q+="-"}}var m=false;if(n.lastIndexOf(q)>-1){for(var l=n.length-1;l>=0;l--){if(n[l].lastIndexOf(q+"_")>-1){q+="_"+(parseInt(n[l].substring((n[l].lastIndexOf("_")+1)))+1);m=true;break}}if(false===m){q+="_1"}}n.push(q);q=""}return n},convertFromPIDToIndexAsync:function(t,s,r,m){var u=[],v=[],w=[];function l(z,x,p,o,q){q=q||window;o=o||100;var n=0;function y(){var A=o;while(A--&&n<z.length){x.call(q,z[n],n,z);++n}if(n<z.length){setTimeout(y,1)}else{p.call(r,u)}}y()}l(s,function(o){if(o.lastIndexOf("-")>-1){v=o.split("-");for(var n=0;n<v.length;n++){if(v[n].lastIndexOf("_")>-1){v[n]=v[n].substr(0,v[n].indexOf("_"))}w.push(t.indexOf(v[n]))}v=[]}else{w.push(t.indexOf(o))}u.push(w);w=[]},m,25,this)},convertFromPIDToIndex:function(r,l){var q=[],p=[],o=[];for(var n=0;n<l.length;n++){if(l[n].lastIndexOf("-")>-1){p=l[n].split("-");for(var m=0;m<p.length;m++){if(p[m].lastIndexOf("_")>-1){p[m]=p[m].substr(0,p[m].indexOf("_"))}o.push(r.indexOf(p[m]))}p=[]}else{o.push(r.indexOf(l[n]))}q.push(o);o=[]}return q},splitListOfPID:function(l){var n=[];if(l.lastIndexOf("-")>-1){n=l.split("-");for(var m=0;m<n.length;m++){if(n[m].lastIndexOf("_")>-1){n[m]=n[m].substr(0,n[m].indexOf("_"))}}}else{if(l.lastIndexOf("_")>-1){l=l.substr(0,l.indexOf("_"))}n.push(l)}return n},getLanguage:function(){if(typeof widget!=="undefined"){return widget.lang}return b.getCurrentLanguage()},getNlsInfosForFacets:function(u){var r=this;var w=UWA.clone(u);var o={};for(var p=0;p<w.length;p++){var l=w[p];if(l.sixw){var t=h.is(l.object,"array")&&(l.object.length);if(t){w[p].dispValue=l.object.join("/")}else{var m=l.sixw.split("/");var s=m.length-1;if(!o[m[s]]){o[m[s]]=[]}o[m[s]].push(l.object)}}else{if(l.format==="ds6w_facet"){var n=h.is(l.value,"array")&&(l.value.length&&h.is(l.value[0],"array"));if(n){w[p].dispValue=l.value[0].join("/")}else{var q=l.name.split("/");var v=q.length-1;if(!o[q[v]]){o[q[v]]=[]}o[q[v]].push(l.value)}}}}return new e(function(y,x){j.getNlsOfPropertiesValues(JSON.stringify(o),{tenantId:k.getPlatformId(),lang:k.getLanguage(),onComplete:function(A){for(var F in A){if(A.hasOwnProperty(F)){var z=A[F];for(var D=0;D<w.length;D++){var C=w[D].sixw||w[D].name;var E=C.lastIndexOf("/");if(-1!==C.indexOf(F,E)){var B=w[D].object||w[D].value;w[D].dispValue=z[B]||B}}}}y(w)},onFailure:function(){console.log("NLS types ...... Retrieve the Nls predefined types failed !");w.forEach(function(z){z.dispValue=z.object});y(w)}})})},_executeFetch:function(m,l,p,q,o){var n=this;return new e(function(s,r){f.authenticatedRequest(n._fetchV2URL,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:m,tenant:n._tenantId,with_synthesis_attribute:true,nresults:o||1000,start:q||0,select_file:l||[],local:k.getLanguage().toLowerCase(),select_predicate:p||[]}),onComplete:function(v){var w=[];for(var u=0;u<v.results.length;u++){for(var t=0;t<v.results[u].attributes.length;t++){w.push(v.results[u].attributes[t])}}k.getNlsInfosForFacets(w).then(function(y){for(var A=0;A<v.results.length;A++){for(var z=0;z<v.results[A].attributes.length;z++){for(var x=0;x<y.length;x++){if((v.results[A].attributes[z].name===y[x].name)&&(v.results[A].attributes[z].value===y[x].value)){v.results[A].attributes[z].dispValue=y[x].dispValue}}}}s(v)})},onFailure:function(t){r(t)}})})},getInfosFromIds:function(m,l){var n=this;return new e(function(r,q){var o=[];var p=["ds6w:label"];n.getPredicatesInfosFromIds(m,p,l).then(function(t){var x=t.length;for(var w=0;w<x;w++){var z={};z.id=t[w].id;z.thumbnail=t[w].thumbnail;z.icon=t[w].icon;z.label="";var y=[];for(var u=0;u<p.length;u++){for(var s=0;s<t[w].predicates.length;s++){var v=t[w].predicates[s];if(v.name.endsWith(p[u])){y.push(v.value)}}}if(y.length){z.label=y.toString().split(",").join(" ")}o.push(z)}r(o)})})},getPredicatesInfosFromIds:function(p,n,o){var q=this;var s=0;var m=p.length;var l=[];var r=[];if(UWA.is(o,"boolean")&&o===true){l=["icon","thumbnail_2d"];r=["preview_url","type_icon_url"]}return new e(function(u,t){q.getPlatformServices(q._tenantId).then(function(){q._executeFetch(p,l,n,s,m).then(function(C){var H=r.concat(n);var A=H.length;var F=[];var I=(C.results)?C.results.length:0;for(var z=0;z<I;z++){var x=C.results[z].attributes;var G=x.length;var E={};var y=[];for(var w=0;w<G;w++){var B=x[w];if("resourceid"===B.name){E.id=B.value}else{if("preview_url"===B.name){E.thumbnail=B.value}else{if("type_icon_url"===B.name){E.icon=B.value}else{for(var v=0;v<A;v++){var D=B.name;if(B.name.endsWith(H[v])){y.push(B);break}}}}}}if(E.id){E.predicates=y;F.push(E)}}u(F)},function(v){console.log(v);t([])})})})}});return k});Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};define("DS/ENOFilterBIUX/NGFServices",["UWA/Core","UWA/Class","UWA/Date","UWA/Class/Options","UWA/Class/Promise","DS/WAFData/WAFData","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(i,j,h,c,f,g,k,d,a,b){var e=j.singleton(c,{CVQUERY_VERSIONS:["420.6.1"],CVQUERY_TYPE:"CVQuery",APP_EXPANDMODE:"expand",getGetFiltersFromIdsUrl:function(l){if(!i.is(k.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return k.getPlatformUrlAccordingToTenant(l)["3DSpace"]+"/resources/FilterBIAPI/Filter/getFiltersFromIds"},getGetFilterFromIdUrl:function(l){if(!i.is(k.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return k.getPlatformUrlAccordingToTenant(l)["3DSpace"]+"/resources/FilterBIAPI/Filter/getFilterFromId"},getExpandSynthesisUrl:function(l){if(!i.is(k.getOption("str_platformServices"),"array")){throw new Error("Platform services not initialize yet")}return k.getPlatformUrlAccordingToTenant(l)["3DSpace"]+"/cvservlet/multiexpand"},getRetrieveFiltersUrl:function(l){var m;if(i.is(k.getOption("str_platformServices"),"array")){m=k.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/FilterBIAPI/Filter/retrieveFilters"}return m},getAllDataFromFilterIds:function(l,r){var n=this,m={},o={},q=[];l=UWA.is(l,"array")?l:[l];var p=new f(function(t,s){g.authenticatedRequest(n.getGetFiltersFromIdsUrl(r),{headers:k.getRESTHeaders(),method:"POST",data:JSON.stringify(l),type:"json",proxy:"passport",onComplete:function(w){m={};if(w.success){m.success=[];o.success=[];for(var v=0;v<w.success.length;v++){var x=Object.keys(w.success[v]);for(var u=0;u<x.length;u++){if(!m.success[x[u]]){m.success[x[u]]=[]}n._upgradeFilterSpecification(w.success[v][x[u]]);w.success[v][x[u]].filterPhysicalId=x[u];m.success[x[u]].push(w.success[v][x[u]]);q[u]=m.success[x[u]][u]}o.success.push(q[v])}}else{o.failure=w.failure}t(o)},onFailure:function(u){t(u)}})});return p},getFilterDataFromFilterId:function(l,p){var o=this,n={};l=UWA.is(l,"array")?l:[l];var m=new f(function(r,q){e.getAllDataFromFilterIds(l,p).then(function(s){if(s.success){r(s)}if(s.failure){o.manageNlsDroppedErrorMessages(s);r(s)}})});return m},getFilterDataFromFilterNames:function(o){var l=this,m={};o=UWA.is(o,"array")?o:[o];var n=new f(function(q,p){g.authenticatedRequest(l.getRetrieveFiltersUrl(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(o),type:"json",proxy:"passport",onComplete:function(r){if(r.success){m.success=[];r.success.forEach(function(s){l._upgradeFilterSpecification(s);m.success.push(s)});q(m)}},onFailure:function(r){l.manageNlsDroppedErrorMessages(r);q(r)}})});return n},manageNlsDroppedErrorMessages:function(l){if(l.failure){for(var m=0;m<l.failure.length;m++){if(l.failure[m].filterName){l.failure[m].msg=l.failure[m].filterName+" : "+b.get(l.failure[m].msg)}else{l.failure[m].msg=b.get(l.failure[m].msg)}}}return l},expandWithSynthesis:function(o,n,l){var m=this;l=(l===undefined)?{"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}:l;return new f(function(v,u){var s={};s.union={};s.union.expand=[];for(var t=0;t<n.length;t++){s.union.expand[t]={root_physicalid:n[t],expand_iter:"-1",};var p=UWA.merge(s.union.expand[t],l);s.union.expand[t]=p}s.max_count_path="1";var r=new h();var q=i.Date.strftime(r,"%Y-%m-%dT%H:%M:%S%z");s.label="FilterBI_ExpandSynthesis_"+q;g.authenticatedRequest(e.getExpandSynthesisUrl(o),{headers:k.getRESTHeaders(),method:"POST",data:JSON.stringify(s),type:"json",proxy:"passport",timeout:d.getOption("timeoutExpandSynthesis"),onComplete:function(x){var w=x.facets||[];k.getNlsInfosForFacets(w).then(function(y){v(y)})},onFailure:function(w){u(w)}})})},filteredExpandWithSynthesis:function(p,l,n){var o=this;var m=UWA.clone(l);if(!n){n="expand"}return new f(function(y,z){var w={};if(!m||0===m.length){y([])}else{if(1===m.length){if("expand3d"===n){w=m[0].objQuery.CVQuery3D?m[0].objQuery.CVQuery3D:m[0].objQuery.CVQuery}else{w=m[0].objQuery.CVQuery?m[0].objQuery.CVQuery:m[0].objQuery.CVQuery3D}}else{var r,q;for(var v=0;v<m.length;v++){var t="CVQuery";if("expand3d"===n){t="CVQuery3D"}r=e.getCombinationType(m[v].objQuery[t]);if("union"===r){q=e.getQueryExpandType(m[v].objQuery[t][r]);if(!w[r]){w[r]={}}if(!w[r][q]){w[r][q]=[]}for(var u=0;u<m[v].objQuery[t][r][q].length;u++){w[r][q].push(m[v].objQuery[t][r][q][u])}}else{console.log("NGFServices.filteredExpandWithSynthesis : not union case of filtered root : "+r)}}}}if(undefined===w){console.log("NGFServices.filteredExpandWithSynthesis KO : queryForExpandSynthesis undefined");y([])}w.max_count_path="1";w.synthesis_mode=d.getOption("synthesis_mode");var s=new h();var x=i.Date.strftime(s,"%Y-%m-%dT%H:%M:%S%z");w.label="FilterBI_FilteredExpandWithSynthesis_"+x;g.authenticatedRequest(e.getExpandSynthesisUrl(p),{headers:k.getRESTHeaders(),method:"POST",data:JSON.stringify(w),type:"json",proxy:"passport",timeout:d.getOption("timeoutExpandSynthesis"),onComplete:function(B){var A=B.facets||[];k.getNlsInfosForFacets(A).then(function(C){y(C)})},onFailure:function(A){z(A)}})})},upgradeAndCompleteQuery:function(t){var w={};var v=(t.CVQuery)?t.CVQuery:t;v=UWA.is(v,"string")?JSON.parse(v):v;var A=v.specVersion||undefined;if(e.isLastSpecificationVersion(A)){w.CVQuery=v;w.CVQuery.specVersion=A}else{var x=v;var o=e.CVQUERY_VERSIONS;var l=o.length;var r=o.indexOf(A);for(var s=r+1;s<l;s++){x=this._migrateCVQuery(x,o[s])}w.CVQuery=x;w.CVQuery.specVersion=e.getCurrentSpecificationVersion()}var n=e.getCombinationQuery(w.CVQuery);if(w.CVQuery&&n){w.CVQuery3D=UWA.clone(w.CVQuery);if(!n.expand3d){var p=e.getCombinationQuery(w.CVQuery3D);var y=e.getQueryExpand(p);p.expand3d=y;delete p.expand}}var m=e.getCombinationQuery(w.CVQuery3D);var z=e.getQueryExpand(m);for(var q=0;q<z.length;q++){if(z[q].sequence_filter){if("seq_cut"===z[q].sequence_filter[0].option[0]){z[q].sequence_filter[0].option=["seq_keep"]}}}var u=e.getCombinationType(w.CVQuery3D);w.CVQuery3D[u].expand3d=z;return w},_migrateCVQuery:function(l,n){var m={};switch(n){case e.CVQUERY_VERSIONS[0]:if(l.union){m=l}else{m=e.buildGlobalUnionCVQuery(l)}break;default:}return m},buildGlobalUnionCVQuery:function(m){var l={};l.union={};l.union.expand=[];l.union.expand[0]=m;if(m.root_physicalid){l.union.expand[0].root_path_physicalid=[[m.root_physicalid]];delete m.root_physicalid}return l},getCurrentSpecificationVersion:function(){var l=e.CVQUERY_VERSIONS.length-1;return e.CVQUERY_VERSIONS[l]},isLastSpecificationVersion:function(l){return(this.getCurrentSpecificationVersion()===l)?true:false},getCombinationQuery:function(l){return l.union||l.intersection||l.minus},getCVQueryType:function(m){var l;if(m.CVQuery){l="CVQuery"}else{if(m.CVQuery3D){l="CVQuery3D"}}return l},getCombinationType:function(m){var l;if(m.union){l="union"}else{if(m.intersection){l="intersection"}else{if(m.minus){l="minus"}}}return l},getQueryExpand:function(l){return l.expand||l.expand3d},getQueryExpandType:function(m){var l;if(m.expand){l="expand"}else{if(m.expand3d){l="expand3d"}}return l},setAppQueryParam:function(l){this._appQueryParam=l},getAppQueryParam:function(){return this._appQueryParam},setAppExpandMode:function(l){e.APP_EXPANDMODE=l;if("expand"===e.APP_EXPANDMODE){this.setQueryType("CVQuery")}else{if("expand3d"===e.APP_EXPANDMODE){this.setQueryType("CVQuery3D")}}},getAppExpandMode:function(){return e.APP_EXPANDMODE},setQueryType:function(l){e.CVQUERY_TYPE=l},getQueryType:function(){return e.CVQUERY_TYPE},isConfigAvailable:function(){var l;return new f(function(n,m){l=1;n(l)})},_buildEmptyFilter:function(o){var n='"CVQuery":{"root_physicalid":"'+o+'"}';var m=n;m=m.replace('"CVQuery"','"CVQuery3D"');m=m.replace('"expand"','"expand3d"');var l="{"+n+","+m+"}";return l},_upgradeFilterSpecification:function(o){var n={toFeedUI:{combinationOfSpecification:"union",keepChildren:true}};var q=o.filterUIComponents[0];if(i.is(q,"object")){var m=q.toFeedUI;if(m){if(!m.combinationOfSpecification){o.filterUIComponents.unshift(n)}}else{o.filterUIComponents=[n,{isActivated:"1",filterSpecificationName:b.get("defaultGroupName"),toFeedUI:o.filterUIComponents}]}}else{var l=b.get("defaultGroupName");var r=[n];for(var p=0;p<o.filterUIComponents.length;p++){r.push({isActivated:"1",filterSpecificationName:l,toFeedUI:o.filterUIComponents[p]})}o.filterUIComponents=r}if(undefined===o.filterCVQuery){o.filterCVQuery=o.filterDescription;o.filterDescription=q.filterDescription||"";o.filterDescription=("null"===o.filterDescription)?"":o.filterDescription;delete o.filterUIComponents[0].filterDescription}},getFilterSpecifications:function(l){return l.filterUIComponents},isTimeInDateActivated:function(){var l=d.getOption("TimeInDateAttribute");l=(!l&&(-1!==window.location.href.indexOf("NGFTimeInDate")))?true:l;return l}});return e});define("DS/ENOFilterBIUX/BIEngine",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","UWA/Class/Debug","WebappsUtils/WebappsUtils","DS/ENOFilterBIUX/FBIServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices",],function(g,h,e,f,d,b,i,a){var c=h.extend(d,{init:function(){this._biPredCriteriaMatchingBIPredLabel={};this._BISummary=[];this._colorMap={};this._BIColoredSubject=[];this._rulesData=[];this._BIMatchingSubjects={};this._intervals=[];this._BICusto=[];this._BICustoLabelColor=[];this._BICustoMatchingSubjects={};this._biCustoRulesURL=null;this._BICustoComputedSubjects={};return this},cleanAll:function(){this._BIMatchingSubjects={};this._fromBIPredLabelToAttribute={}},_getBIPredLabelToDisplay:function(k){var j=k;if(j.indexOf("/")>=0){j=j.slice(j.indexOf("/")+1,j.length)}return j},getBIRules:function(){var k=this;if(!sessionStorage.getItem("FBI_getBIRules")){new e(function(m,l){a.getPlatformServices({onComplete:function(n){k._biRulesURL=i.getPlatformUrlAccordingToTenant()["3DSpace"]+"/resources/SNAPI/birule_services/birules";f.authenticatedRequest(k._biRulesURL,{headers:{Accept:"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(o){k._parseBIRules(o);sessionStorage.setItem("FBI_getBIRules",JSON.stringify(o));m(o)},onFailure:function(o){console.log(o);l(o)}})},onFailure:function(n){l(n)}})})}else{var j=JSON.parse(sessionStorage.getItem("FBI_getBIRules"));return this._parseBIRules(j)}},parseCustoBIRule:function(o,m,l,p){var n=this;var j=[];m.forEach(function(q){n._BISummary.push({object:q.BILabel,sixw:o,dispValue:"",count:-1,type:"string"});if(!n._colorMap[o]){n._colorMap[o]=[]}n._colorMap[o].push({color:q.BIColor,object:q.BILabel,type:"string"});j.push({color:q.BIColor,label:q.BILabel,type:q.BIType});if(!n._BICustoLabelColor[q.BILabel]){n._BICustoLabelColor[q.BILabel]=[]}n._BICustoLabelColor[q.BILabel].color=q.BIColor});var k=n._getBIPredLabelToDisplay(o);if(!n._BICusto[k]){n._BICusto[k]=[]}n._BICusto[k]={label:k,biProgram:l,biFunction:p,info:j}},_parseBIRules:function(l){var k=l.birules;var j=this;if(null===k||undefined===k){return}k.forEach(function(m){var q=m.name;var s=[];var o=j._getBIPredLabelToDisplay(q);if(!j._biPredCriteriaMatchingBIPredLabel[o]){j._biPredCriteriaMatchingBIPredLabel[o]=[];j._biPredCriteriaMatchingBIPredLabel[o].push(m.bipredicates[0])}var p=JSON.parse(m.biexpression);if(p){for(var r in p){if(p.hasOwnProperty(r)){if("BITags"===r){j.parseCustoBIRule(q,p[r],p.biProgram,p.biFunction)}}}for(var n=0;n<p.length;n++){if(!p.BITags){j._BISummary.push({object:p[n].BILabel,sixw:q,dispValue:"",count:-1,type:"string"});if(!j._colorMap[q]){j._colorMap[q]=[]}j._colorMap[q].push({color:p[n].BIColor,object:p[n].BILabel,type:"string"});s.push({color:p[n].BIColor,label:p[n].BILabel,type:p[n].BIType,Cond:p[n].Cond})}}if(!j._rulesData[o]){j._rulesData[o]=[]}j._rulesData[o]={biPredCriteria:m.bipredicates[0],info:s}}})},_computeFilterfromWS:function(k,j){if(this._BICustoComputedSubjects){this._BICustoMatchingSubjects={};for(var m in j){if(j.hasOwnProperty(m)){var l=this._getBIPredLabelToDisplay(j[m].object);var n=this._biPredCriteriaMatchingBIPredLabel[k];if(this._BICustoComputedSubjects[n]){if(this._BICustoComputedSubjects[n][l]){if(!this._BICustoMatchingSubjects[n]){this._BICustoMatchingSubjects[n]={}}if(!this._BICustoMatchingSubjects[n][l]){this._BICustoMatchingSubjects[n][l]={}}this._BICustoMatchingSubjects[n][l]=this._BICustoComputedSubjects[n][l]}}}}}return this._BICustoMatchingSubjects},computeBIRule:function(n,m,j,l){var k=this._getBIPredLabelToDisplay(m);var o=this._biPredCriteriaMatchingBIPredLabel[k][0];this._BIColoredSubject=[];this._computeIntervals(k,l);this._getMatchingSubjects(o,n[o],this._intervals[k],j)},_getMatchingSubjects:function(t,q,s,j){this._BIMatchingSubjects={};for(var n in q){if(q.hasOwnProperty(n)){for(var p=0;p<s.length;p++){if(s[p].interval.match(n)){var u=Object.keys(q[n]);for(var o=0;o<u.length;o++){if(u[o]!=="format"&&u[o]!=="type"&&u[o]!=="dispValue"&&u[o]!=="value"){var v=[];var k=u[o];v.push(k);var r=i.convertFromPIDToIndex(j,v);this._BIColoredSubject.push({path:r[0],color:s[p].color});if(!this._BIMatchingSubjects[t]){this._BIMatchingSubjects[t]={}}if(!this._BIMatchingSubjects[t][n]){this._BIMatchingSubjects[t][n]={}}this._BIMatchingSubjects[t][n][k]=({pathID:k,interval:s[p],label:s[p].label})}}}}}}},_computeNumericIntervals:function(q,m,l,r,t){var v=function(){this.lowerBound=null;this.upperBound=null;this.lowerBoundInclusive=false;this.upperBoundInclusive=false};v.prototype.match=function(w){return(this.lowerBoundInclusive?w>=this.lowerBound:w>this.lowerBound)&&(this.upperBoundInclusive?w<=this.upperBound:w<this.upperBound)};var n=q.split(":");for(var u=0;u<n.length;u++){var k=new v();var s=n[u].trim();if(s.indexOf(",")>=0){var j=s.split(",");var p=j[0].trim();var o=j[1].trim();if(p.length>0){if(p.indexOf("[")===0){k.lowerBoundInclusive=true;p=p.substr(1)}else{if(p.indexOf("(")===0){p=p.substr(1)}}if(p.length>0){k.lowerBound=parseFloat(p)}else{k.lowerBound=Number.NEGATIVE_INFINITY}}if(o.indexOf("]")>=0){k.upperBoundInclusive=true;o=o.slice(0,-1)}else{if(o.indexOf(")")>=0){o=o.slice(0,-1)}}if(o.length>0){k.upperBound=parseFloat(o)}else{k.upperBound=Number.POSITIVE_INFINITY}}m.push({interval:k,cond:s,color:l,type:r,label:t})}},_computeRegexIntervals:function(q,o,l,p,n){var m=function(){this.regex=null};m.prototype.match=function(r){return this.regex.test(r)};var j=q;var k=new m();if(q.trim()){q=q.trim().split("@");k.regex=new RegExp(q[0],q[1])}o.push({interval:k,cond:j,color:l,type:p,label:n})},_computeDateIntervals:function(r,n,l,s,u){var x=function(){this.lowerBound=null;this.upperBound=null;this.lowerBoundInclusive=false;this.upperBoundInclusive=false};x.prototype.matchNumInterval=function(v,y){return(v.lowerBoundInclusive?y>=v.lowerBound:y>v.lowerBound)&&(v.upperBoundInclusive?y<=v.upperBound:y<v.upperBound)};x.prototype.match=function(z){var y=false;if(z.length>0){z=new Date(Date.parse(z));for(var v=0;v<n.length;v++){if(this.matchNumInterval(n[v].interval,z)){y=true;break}}}return y};var o=r.split(":");for(var m=0;m<o.length;m++){var k=new x();var t=o[m].trim();if(t.indexOf(",")>=0){var j=t.split(",");var q=j[0].trim();var p=j[1].trim();if(q.length>0){if(q.indexOf("[")===0){k.lowerBoundInclusive=true}if(q.indexOf("[")===0||q.indexOf("(")===0){q=q.substr(1)}if(q.length>0){k.lowerBound=new Date(Date.parse(q))}else{k.lowerBound=new Date(Date.UTC(0,0,0))}if(!k.lowerBoundInclusive){k.lowerBound.setDate(k.lowerBound.getDate()+1);k.lowerBoundInclusive=true}}if(p.indexOf("]")>=0){k.upperBoundInclusive=true}if(p.indexOf("]")>=0||p.indexOf(")")>=0){p=p.slice(0,-1)}if(p.length>0){k.upperBound=new Date(Date.parse(p))}else{k.upperBound=new Date(Date.UTC(10000,0,0))}if(k.upperBoundInclusive){k.upperBound.setDate(k.upperBound.getDate()+1);k.upperBoundInclusive=false}}else{if(t.indexOf("!")>=0){var w=new Date(Date.parse(t.substr(1)));k.lowerBound=new Date(Date.UTC(0,0,0));k.upperBound=w;k=new x();k.lowerBound=new Date(w);k.lowerBound.setDate(k.lowerBound.getDate()+1);k.lowerBoundInclusive=true;k.upperBound=new Date(Date.UTC(10000,0,0))}else{k.lowerBoundInclusive=true;k.lowerBound=new Date(Date.parse(t));k.upperBoundInclusive=false;k.upperBound=new Date(Date.parse(t));k.upperBound.setDate(k.lowerBound.getDate()+1)}}n.push({interval:k,cond:t,color:l,type:s,label:u})}},_computeStringIntervals:function(o,m,k,p,r){var s=function(){this.stringValue=null};s.prototype.match=function(t){return this.stringValue===t};var n=o.split(",");for(var l=0;l<n.length;l++){var j=new s();var q=n[l].trim();j.stringValue=q;m.push({interval:j,cond:q,color:k,type:p,label:r})}},_computeIntervals:function(n,m){if(this._rulesData[n]){this._intervals[n]=[];for(var l=0;l<m.length;l++){var p=m[l];for(var k=0;k<this._rulesData[n].info.length;k++){if(m==="all"||this._rulesData[n].info[k].label===p.object){var o=this._rulesData[n].info[k].type;switch(o.toLowerCase()){case"numeric":this._computeNumericIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;case"regex":this._computeRegexIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;case"date":this._computeDateIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;case"string":this._computeStringIntervals(this._rulesData[n].info[k].Cond,this._intervals[n],this._rulesData[n].info[k].color,o,this._rulesData[n].info[k].label);break;default:console.log("BIEngine.computeBIRule - NON SUPPORTED TYPE");console.log(o);break}}}if(m==="all"){break}}}},});return c});Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};define("DS/ENOFilterBIUX/FBIProxyServices",["UWA/Core","UWA/Class","UWA/Class/Options","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBISettings"],function(c,e,d,f,b){var a=e.singleton(d,{completeCVQueryWithAppSpecs:function(g,u,t){var s=UWA.clone(g);var h=f.getCombinationQuery(s);if(u.volume_filter&&Object.keys(u.volume_filter).length){if(h&&h.expand3d){for(var r=0;r<h.expand3d.length;r++){if(h.expand3d[r].volume_filter){h.expand3d[r].volume_filter.and=UWA.extend(u.volume_filter,h.expand3d[r].volume_filter)}else{h.expand3d[r].volume_filter=UWA.clone(u.volume_filter)}if(t&&(u.volume_filter&&u.volume_filter.assemblyshape&&h.expand3d[r].config_filter)){h.expand3d[r].volume_filter.assemblyshape.config_filter=h.expand3d[r].config_filter}}}else{s.volume_filter=UWA.clone(u.volume_filter);if(t&&(s.config_filter&&s.volume_filter&&s.volume_filter.assemblyshape)){s.volume_filter.assemblyshape.config_filter=s.config_filter}}}if(u.find_in_context&&Object.keys(u.find_in_context).length){if(h&&h.expand){for(var q=0;q<h.expand.length;q++){h.expand[q].find_in_context=UWA.clone(u.find_in_context)}}else{if(h&&h.expand3d){for(var p=0;p<h.expand3d.length;p++){h.expand3d[p].find_in_context=UWA.clone(u.find_in_context)}}else{s.find_in_context=UWA.clone(u.find_in_context)}}}if(u.root_path_physicalid&&Object.keys(u.root_path_physicalid).length){if(h&&h.expand){for(var o=0;o<h.expand.length;o++){h.expand[o].root_path_physicalid=UWA.clone(u.root_path_physicalid)}}else{if(h&&h.expand3d){for(var n=0;n<h.expand3d.length;n++){h.expand3d[n].root_path_physicalid=UWA.clone(u.root_path_physicalid)}}else{s.root_path_physicalid=UWA.clone(u.root_path_physicalid)}}}return s},getCompletedQueriesFromFilterIds:function(g,j){var i={};var h=new UWAPromise(function(l,k){f.getAllDataFromFilterIds(that._dropedFilterIds,j).then(function(o){if(o.success){for(var n=0;n<o.success.length;n++){i.success.push(f.upgradeAndCompleteQuery(JSON.parse(o.success[n].filterCVQuery)))}}if(o.failure){for(var m=0;m<o.failure.length;m++){i.failure.push(o.failure[m])}}l(i)})});return h},completeCVQueryWithAppParams:function(o,r,p){o.CVQuery=c.is(o.CVQuery,"string")?JSON.parse(o.CVQuery):o.CVQuery;o.CVQuery3D=c.is(o.CVQuery3D,"string")?JSON.parse(o.CVQuery3D):o.CVQuery3D;var g=f.getCombinationQuery(o.CVQuery);var i=f.getCombinationQuery(o.CVQuery3D);var s=f.getAppQueryParam();var t=(r===undefined)?{expand_iter:"-1"}:{expand_iter:r};if(g){var q=f.getQueryExpand(g);var m=f.getQueryExpand(i);for(var n=0;n<q.length;n++){var u=c.merge(q[n],t);u=c.merge(q[n],s);q[n]=u}for(var l=0;l<q.length;l++){var h=c.merge(m[l],t);h=c.merge(m[l],s);m[l]=h}}else{o.CVQuery=c.merge(o.CVQuery,t);o.CVQuery=c.merge(o.CVQuery,s);o.CVQuery3D=c.merge(o.CVQuery3D,t);o.CVQuery3D=c.merge(o.CVQuery3D,s)}if(p){o.CVQuery.synthesis_mode=b.getOption("synthesis_mode");o.CVQuery3D.synthesis_mode=b.getOption("synthesis_mode")}return o},});return a});define("DS/ENOFilterBIUX/ExpandV2FormatServices",["UWA/Core","UWA/Class","UWA/Class/Options","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBISettings"],function(c,e,d,f,a){var b=e.singleton(d,{emptyFilterFormat:function(i){var g={};g.filter={};g.filter.or={};g.filter.or.filters=[];var h={};h.and={};h.and.filters=[];g.filter.or.filters.push(h);return g},getCombinationType:function(h){var g;if(h.union){g="union"}else{if(h.intersection){g="intersection"}else{if(h.minus){g="minus"}}}return g},updateWithAppParams:function(g,o,p){var j=UWA.clone(o);var r=this.getV2CombinationType(j.filter);var l={};if("and_not"===r){l=j.filter[r].left.and}else{l=j.filter[r]}for(var m=0;m<l.filters.length;m++){var q=this.getV2CombinationType(l.filters[m]);var n=[];if(p.prefixPathArray&&p.prefixPathArray.length){n.push(this.prefixPathFormat(g,p.prefixPathArray))}if(p.inFrustumObj&&Object.keys(p.inFrustumObj).length){n.push(this.appInFrustumFormat(p.inFrustumObj))}if(p.appQueryStr){n.push(this.appSequenceFormat(p.appQueryStr))}if(p.volumeObj&&Object.keys(p.volumeObj).length){console.log("RCIII UpdateFilterQueryV2WithAppParams, volumeObj : TO DO")}if(p.find_in_context){n.push(this.appSequenceFormat(p.find_in_context))}for(var h=0;h<n.length;h++){if("and_not"===q){l.filters[m][q].left.and.filters.push(n[h])}else{l.filters[m].and.filters.push(n[h])}}}return j},explicitPathsFormat:function(j){var h={};h.prefix_filter={};h.prefix_filter.prefix_path=[];for(var g=0;g<j.length;g++){h.prefix_filter.prefix_path.push(j[g])}return h},sequenceFilterFormat:function(h){if(h&&h.length){var g={};g.sequence_filter={};g.sequence_filter.sequence=[];for(var k=0;k<h.length;k++){var j={};j.uql=h[k];g.sequence_filter.sequence.push(j)}return g}return},configFormat:function(h){if(h){var g={};g.config_filter=h;return g}return},volumeBoxFilterFormat:function(g){if(g&&Object.keys(g).length){var h={};h.box_filter=g;return h}return},volumeSphereFilterFormat:function(g){if(g&&Object.keys(g).length){var h={};h.sphere_filter=g;return h}return},volumeAssemblyShapeFilterFormat:function(g){if(g&&Object.keys(g).length){var j={};j.assembly_shape_filter={};j.assembly_shape_filter.assembly_shape_path={};j.assembly_shape_filter.assembly_shape_path.physical_id_path=[];for(var h=0;h<g.root_path_physicalid.length;h++){j.assembly_shape_filter.assembly_shape_path.physical_id_path.push(g.root_path_physicalid[h])}j.assembly_shape_filter.distance=g.distance;j.assembly_shape_filter.intersection_mode=g.intersection_mode;return j}return},volumeFormat:function(h){if(h&&Object.keys(h).length){var j=Object.keys(h);var i={};i[j]={};i[j].filters=[];var k=Object.keys(h[j]);for(var g=0;g<k.length;g++){if("NGFVolumeBox"===k[g]){i[j].filters.push(this.volumeBoxFilterFormat(h[j][k[g]]))}else{if("NGFVolumeSphere"===k[g]){i[j].filters.push(this.volumeSphereFilterFormat(h[j][k[g]]))}else{if("NGFVolumeAssemblyShape"===k[g]){i[j].filters.push(this.volumeAssemblyShapeFilterFormat(h[j][k[g]]))}}}}return i}return},getFilterCombinationFormat:function(h){var g="or";switch(h.toLowerCase()){case"union":g="or";break;case"intersection":g="and";break;case"minus":g="and_not";break;default:console.log("ExpandV2FormatServices.filterCombinationFormat, non supported format => OR by default",+CVData.combinationStr);g="or";break}return g},getV2CombinationType:function(h){var g;if(h.or){g="or"}else{if(h.and){g="and"}else{if(h.and_not){g="and_not"}else{console.log(" RCIII getV2CombinationTYpe : unknown combination")}}}return g},filterLeftRightFormat:function(g){if(g.needsRemove){var h={};h.and_not={};h.and_not.left={};h.and_not.right={};return h}return},filterKeepFormat:function(h){var g={};g.and={};g.and.filters=[];if(h.CVQueryMigratedKeys.NGFSequenceAddObj&&Object.keys(h.CVQueryMigratedKeys.NGFSequenceAddObj).length){g.and.filters.push(this.sequenceFilterFormat(h.CVQueryMigratedKeys.NGFSequenceAddObj))}if(h.CVQueryMigratedKeys.NGFConfObj&&Object.keys(h.CVQueryMigratedKeys.NGFConfObj).length){g.and.filters.push(this.configFormat(h.CVQueryMigratedKeys.NGFConfObj))}if(h.CVQueryMigratedKeys.NGFExplicitAddArray&&Object.keys(h.CVQueryMigratedKeys.NGFExplicitAddArray).length){g.and.filters.push(this.explicitPathsFormat(h.CVQueryMigratedKeys.NGFExplicitAddArray))}if(h.CVQueryMigratedKeys.NGFVolumeObj&&Object.keys(h.CVQueryMigratedKeys.NGFVolumeObj).length){g.and.filters.push(this.volumeFormat(h.CVQueryMigratedKeys.NGFVolumeObj))}return g},filterRemoveFormat:function(g){var h={};h.and={};h.and.filters=[];this.prefixPathFormat(g.rootID,g.NGFExplicitRemoveArray);this.sequenceFilterFormat(g.NGFSequenceRemoveObj);return h},prefixPathFormat:function(i,h){var g={};if(h&&h.length>0){g=this.explicitPathsFormat(h)}else{g.prefix_filter={};g.prefix_filter.prefix_path=[];g.prefix_filter.prefix_path.push({physical_id_path:[i]})}return g},appSequenceFormat:function(h){if(h){var g={};g.sequence_filter={};g.sequence_filter.sequence=[];g.sequence_filter.sequence.push({uql:h});return g}return},appInFrustumFormat:function(h){if(h&&Object.keys(h).length){var g={};g.in_frustum=h;return g}return},filterQueryV2Format:function(j){var g={};g.filter={};var h=this.filterCombinationFormat(j.CVQueryMigratedKeys);g.filter[h]={};g.filter[h].filters=[];var m=this.filterLeftRightFormat(j.CVQueryMigratedKeys);var i=g;var k=this.filterKeepFormat(j);if(m){i.and_not.left.filter[h].filters.push(k)}else{i.filter[h].filters.push(k)}if(j.needsRemove){var l=this.filterRemoveFormat(j.CVQueryMigratedKeys);i.and_not.right.filter[h].filters.push(l)}return g},queryTstFormat:function(i,h){var g={};g.batch={};g.batch.expands=[];g.batch.expands[0]={};g.batch.expands[0].parameters={limit_timeout_in_ms:3000};g.batch.expands[0].label="TST RCI";g.batch.expands[0].root={physical_id:i};g.outputs={};g.outputs.select_object=["physicalid"];g.outputs.select_relation=["physicalid"];return g},fromNGFV1ToV2:function(z,s,D){if(!s){console.log("fromNGFV1ToV2: !CVQuery as input");return}var g=f.getCombinationType(s);var M=f.getQueryExpandType(s[g]);var x=s[g][M];var q=this.getFilterCombinationFormat(g);var r={};r.filter={};var C=0;if("and_not"===q){C=1;r.filter.and_not={};r.filter.and_not.left={};r.filter.and_not.right={}}else{r.filter[q]={}}var Q=[];for(var E=0;E<x.length;E++){var v=0;var p=[];var P=[];if(x[E].sequence_filter&&x[E].sequence_filter.length){var t=x[E].sequence_filter;for(var H=0;H<t.length;H++){var o=t[H].definition;for(var G=0;G<o.length;G++){if(o[G]["q.query"]){if(o[G].type_filter_bo){if("seq_remove"===t[H].option[0]){P.push('(flattenedtaxonomies:"types/'+o[G].type_filter_bo+'" AND '+o[G]["q.query"]+")");v=1}else{p.push('(flattenedtaxonomies:"types/'+o[G].type_filter_bo+'" AND '+o[G]["q.query"]+")")}}else{if("seq_remove"===t[H].option[0]){P.push(o[G]["q.query"]);v=1}else{p.push(o[G]["q.query"])}}}}}}var h=[];if(x[E].root_path_physicalid&&x[E].root_path_physicalid.length>1){for(var J=0;J<x[E].root_path_physicalid.length;J++){h.push({physical_id_path:x[E].root_path_physicalid[J]})}}var y=[];if((x[E].find_path_filter&&x[E].find_path_filter.length)){for(var w=0;w<x[E].find_path_filter.length;w++){for(var O=0;O<x[E].find_path_filter[w].path_physicalid.length;O++){y.push({physical_id_path:x[E].find_path_filter[w].path_physicalid[O]})}}v=1}var B={};if(x[E].config_filter){B=x[E].config_filter}var u={};if(x[E].volume_filter){var L=null,I=null,K=null;if(x[E].volume_filter.and&&x[E].volume_filter.and.length){L=x[E].volume_filter.and;u.and={};for(var F=0;F<L.length;F++){if(L[F].box){u.and.NGFVolumeBox=L[F].box}else{if(L[F].sphere){u.and.NGFVolumeSphere=L[F].sphere}else{if(L[F].assemblyshape){u.or.NGFVolumeAssemblyShape=I[F].assemblyshape}else{console.log("RCI NGFServices.fromNGFV1ToV2, non supported case of volume",+L[F])}}}}}else{if(x[E].volume_filter.or&&x[E].volume_filter.or.length){I=x[E].volume_filter.or;u.or={};for(var A=0;A<I.length;A++){if(L[A].box){u.or.NGFVolumeBox=I[A].box}else{if(L[A].sphere){u.or.NGFVolumeSphere=I[A].sphere}else{if(L[A].assemblyshape){u.or.NGFVolumeAssemblyShape=I[A].assemblyshape}else{console.log("RCI NGFServices.fromNGFV1ToV2, non supported case of volume",+L[A])}}}}}}}var N={};if(v){N.and_not={};N.and_not.left={};N.and_not.left.and={};N.and_not.left.and.filters=[];N.and_not.right={};N.and_not.right.and={};N.and_not.right.and.filters=[]}else{N.and={};N.and.filters=[]}if(p&&p.length){if(N.and_not&&N.and_not.left){N.and_not.left.and.filters.push(this.sequenceFilterFormat(p))}else{N.and.filters.push(this.sequenceFilterFormat(p))}}if(P&&P.length){N.and_not.right.and.filters.push(this.sequenceFilterFormat(P))}if(h&&h.length){if(N.and_not&&N.and_not.left){N.and_not.left.and.filters.push(this.explicitPathsFormat(h))}else{N.and.filters.push(this.explicitPathsFormat(h))}}if(y&&y.length){if(N.and_not&&N.and_not.right){N.and_not.right.and.filters.push(this.explicitPathsFormat(y))}}if(B&&Object.keys(B).length){if(N.and_not&&N.and_not.left){N.and_not.left.and.filters.push(this.configFormat(B))}else{N.and.filters.push(this.configFormat(B))}}if(u&&Object.keys(u).length){if(N.and_not&&N.and_not.left){N.and_not.left.and.filters.push(this.volumeFormat(u))}else{N.and.filters.push(this.volumeFormat(u))}}Q.push(N)}if(Q.length){if(C){r.filter.and_not.left.and={};r.filter.and_not.left.and.filters=[];r.filter.and_not.left.and.filters.push(Q[0]);r.filter.and_not.right.and={};r.filter.and_not.right.and.filters=[];r.filter.and_not.right.and.filters.push(Q[1])}else{r.filter[q]={};r.filter[q].filters=[];for(var J=0;J<Q.length;J++){r.filter[q].filters.push(Q[J])}}}return r},});return b});define("DS/ENOFilterBIUX/Abstract_FBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/Toggle","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX/BIEngine","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/ExpandV2FormatServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(p,q,g,d,i,j,r,h,n,f,c,m,k,l,b,a,e){var o=q.extend(g,{init:function(s){var t=this;this.optionsToKeep=s;this._predicates=[];this._nodes=[];this._paths=[];this._tree=[];this._unFilteredPathIDs=[];this._unfilteredTree=[];this._filteredData={};this._colorizedData={};this._nodesIN=[];this._odtSummary=[];this._filterBIToKeep={};this._isFetchCustoDone=false;this._keepVolatileTags=[];this.volatileTags={};this._tenantId=this.optionsToKeep.tenant;f.getPlatformServices(this._tenantId);k.isConfigAvailable().then(function(u){t._configUsed=u});if(s.volumeFilterAvailable){sessionStorage.setItem("NGFilter_Volume_"+this.optionsToKeep.appId+"-"+this.optionsToKeep.widgetId,true)}this._expandIterParam=s.expandIterParam?s.expandIterParam:"-1";if(s.volumeFilterAvailable&&s.volumeAsMaster){k.setAppQueryParam(s.appQueryParam)}else{k.setAppQueryParam(s.appQueryParam)}a.subscribe("NGFilter.toggleProxyFocus",this._onToggleProxyFocus.bind(this));a.subscribe("NGFilter.updateTags",this._onUpdateTags.bind(this));a.subscribe("NGFilter_Volume",this._onFilterVolume.bind(this));a.subscribe("Frame3DXInfra.onPanelClose",this._onCloseFilterPanel.bind(this));a.subscribe("Frame3DXInfra.onPanelOpen",this._onOpenFilterPanel.bind(this));a.subscribe("Frame3DXInfra.ViewChange",this.viewChange.bind(this));this._expandSynthesisON=s.ExpandSynthesisON?true:false;this._arrayRootsInSession=[];this._nbRootsWithTags=0;this._applyNGFilterCount=0;this._currentTags={};this._appliedTags={};this._synthesis_priority=this.optionsToKeep.synthesis_priority;this._arrayFilteredRootsInSession=[]},destroy:function(){sessionStorage.removeItem("NGFilter_Volume_"+this.optionsToKeep.appId+"-"+this.optionsToKeep.widgetId);if(sessionStorage.getItem("FBI_droppedFilters")){sessionStorage.removeItem("FBI_droppedFilters")}this._cleanNGFSessionItems();this._parent()},_cleanNGFSessionItems:function(){for(var t=0;t<this._arrayRootsInSession.length;t++){var u="NGF_isUXBuilt_"+this._arrayRootsInSession[t];var s="NGF_tagMgtRunning_"+this._arrayRootsInSession[t];if(sessionStorage.getItem(u)){sessionStorage.removeItem(u)}if(sessionStorage.getItem(s)){sessionStorage.removeItem(s)}}},_onToggleProxyFocus:function(s){if(s&&this.myTagProxy&&this.optionsToKeep){var t=s.widgetId;if(this.optionsToKeep.widgetId===t){var u=s.focus||true;this.myTagProxy.toggleProxyFocus(u)}}},_onUpdateTags:function(s){if(s&&this.myTagProxy&&this.optionsToKeep){var t=s.widgetId;if(this.optionsToKeep.widgetId===t){var u=s.tags;if(u){this._taggerUpdatedFromFilter=true;this.myTagProxy.clearLocalFilter();this.myTagProxy.setLocalFilter(u)}else{this.unsetTags()}}}},updateTenant:function(s){this._tenantId=s;f.getPlatformServices(this._tenantId)},odtSetFilters:function(s){if(this.myTagProxy){this.myTagProxy.filters=s}},odtKeepActiveFilters:function(s){if(s){this._filterBIToKeep=s}},setTags:function(u,t,x){var w=this;var y="FilteringOnServer";if(null!==t&&undefined!==t){y="FilteringOnServer"}else{if(null!==u&&undefined!==u){y="WithFilteringServices"}}var v=w.optionsToKeep;var s={widgetId:v.widgetId,tenant:v.tenant,filteringMode:y,colorize:v.colorize,events:v.events,};if(!this.myTagProxy){this.myTagProxy=h.createProxy(s);if(this._setVolatilesSummariesAfterProxyCreation){this.setVolatileTags(this._setVolatilesSummariesAfterProxyCreation)}this.myTagProxy.addEvent("colorize",this.filterBIColorize.bind(this));this.myTagProxy.addEvent("unColorize",this.filterBIUnColorize.bind(this));this.myTagProxy.addEvent("onFilterChange",this.filterBIFilter.bind(this))}if(!this._expandSynthesisON){if(this.myTagProxy){this.myTagProxy.filters=this.myTagProxy.getCurrentFilter()}if(Object.keys(this.myTagProxy.filters).length){if(Object.keys(this.myTagProxy.filters.allfilters).length&&(0===f._getObjectSize(this._filterBIToKeep)||(this._filterBIToKeep&&this._filterBIToKeep.allfilters&&(Object.keys(this.myTagProxy.filters.allfilters).length>=Object.keys(this._filterBIToKeep.allfilters).length)))){if(this._currentlyDispatchingAVolatileFilterEvent===true){this._currentlyDispatchingAVolatileFilterEvent=false}else{this.filterBIFilter(this.myTagProxy.filters)}}}}if(y==="FilteringOnServer"){if(this.myTagProxy.filters){this._filterBIToKeep=this.myTagProxy.filters}if(p.is(t,"array")&&t.length){if(this._expandSynthesisON&&!t[0].dispValue){f.getNlsInfosForFacets(t).then(function(z){w.myTagProxy.setTags(u,z,x)})}else{this.myTagProxy.setTags(u,t,x)}}else{this.myTagProxy.setTags(null,[])}}else{console.log("FilterBIComponentProxy.setTags , non supported case")}},unsetTags:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.unsetTags()}},filterBIColorize:function(s){},filterBIUnColorize:function(s){this.dispatchEvent("FilterBIUnColorizeEvent",s)},_cleanUnFilteredTree:function(s,u,t){if(t){if(s===u){return true}else{return false}}else{if(s.includes(u)){return true}else{return false}}},_cleanTree:function(s,u,t){if(t){if(s===u){return true}else{return false}}else{if(s.includes(u)){return true}else{return false}}},cleanProxy:function(){this._unfilteredTree=[];this._allNodes=[];this._unFilteredPathIDs=[];f.cleanAll();if(this._biEngine){this._biEngine.cleanAll()}this._currentNGFilter=""},filterBIFilter:function(t,s){},addSubjects:function(s){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.addSubjects(s)}},focusOnSubjects:function(s,t){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.focusOnSubjects(s,t)}},unfocus:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.unfocus()}},toggleProxyFocus:function(s){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.toggleProxyFocus(s)}},getCurrentFilter:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){return this.myTagProxy.getCurrentFilter()}},die:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.die()}},activate:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){return this.myTagProxy.activate()}},deactivate:function(){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){return this.myTagProxy.deactivate()}},setPredicates:function(s){this._predicates=s},setPathTags:function(s,t){},removeRoot:function(s){this._unFilteredPathIDs=this._unFilteredPathIDs.filter(function(u){if(u===s){return false}else{return true}});for(var t in this._unfilteredTree){if(this._unfilteredTree.hasOwnProperty(t)){if(this._unfilteredTree[t].id===s){delete this._unfilteredTree[t]}}}},emptyFilter:function(s){this._currentNGFilter=s;s.rootIds=this._arrayRootsInSession;this.dispatchEvent("ApplyNGFilter",s);this._cleanNGFSessionItems()},_keepRootsInSession:function(s){for(var t=0;t<s.length;t++){if(this._arrayRootsInSession.indexOf(s[t])<0){this._arrayRootsInSession.push(s[t])}}if(this._nbRootsWithTags){this._nbRootsWithTags=this._arrayRootsInSession.length}},_cleanRootsInSession:function(t){t=UWA.is(t,"array")?t:[t];this._cleanNGFSessionItems();for(var u=0;u<t.length;u++){var s=this._arrayRootsInSession.indexOf(t[u]);if(-1!==s){this._arrayRootsInSession.splice(s,1)}}if(this._nbRootsWithTags){this._nbRootsWithTags=this._arrayRootsInSession.length}},_cleanFilteredStructure:function(t){this._cleanNGFSessionItems();for(var s=0;s<this._arrayFilteredRootsInSession.length;s++){if(this._arrayFilteredRootsInSession[s].filterRootId===t){this._arrayFilteredRootsInSession.splice(s,1);break}}},isRootFiltered:function(t){if(this._arrayFilteredRootsInSession.length){for(var s=0;s<this._arrayFilteredRootsInSession.length;s++){if(this._arrayFilteredRootsInSession[s].filterRootId===t){return true}}}return false},getQueriesInSession:function(t){if(this._arrayFilteredRootsInSession.length){for(var s=0;s<this._arrayFilteredRootsInSession.length;s++){if(this._arrayFilteredRootsInSession[s].filterRootId===t){if(!this._arrayFilteredRootsInSession[s].objQuery){return undefined}else{return{objQuery:this._arrayFilteredRootsInSession[s].objQuery,objQueryV2:this._arrayFilteredRootsInSession[s].objQueryV2?this._arrayFilteredRootsInSession[s].objQueryV2:undefined,filterId:this._arrayFilteredRootsInSession[s].filterId?this._arrayFilteredRootsInSession[s].filterId:undefined,fakeFilter:this._arrayFilteredRootsInSession[s].fakeFilter?this._arrayFilteredRootsInSession[s].fakeFilter:undefined}}}}}return undefined},_keepCVQueryV2InSession:function(u,t){if(this._arrayFilteredRootsInSession.length){for(var s=0;s<this._arrayFilteredRootsInSession.length;s++){if(this._arrayFilteredRootsInSession[s].filterRootId===u){this._arrayFilteredRootsInSession[s].objQueryV2=t}}}return undefined},_keepFilterIdInSession:function(u,s){if(this._arrayFilteredRootsInSession.length){for(var t=0;t<this._arrayFilteredRootsInSession.length;t++){if(this._arrayFilteredRootsInSession[t].filterRootId===u){this._arrayFilteredRootsInSession[t].filterId=s}}}return undefined},_cleanCVQueryV2InSession:function(u,t){if(this._arrayFilteredRootsInSession.length){for(var s=0;s<this._arrayFilteredRootsInSession.length;s++){if(this._arrayFilteredRootsInSession[s].filterRootId===u){if(this._arrayFilteredRootsInSession[s].objQueryV2){delete this._arrayFilteredRootsInSession[s].objQueryV2}}}}return undefined},_updateFilteredRootsInSessionArray:function(x,w){var t={};var v=0,s;if(!w){t.CVQuery={};t.CVQuery.union={};t.CVQuery.union.expand=[];t.CVQuery.union.expand[0]={};t.CVQuery.union.expand[0].root_path_physicalid=[[x]];s=true}else{t=w}t=k.upgradeAndCompleteQuery(t);t=this.completeCVQueryWithAppParams(t,this._expandIterParam,this._expandSynthesisON);if(this._arrayFilteredRootsInSession.length){for(var u=0;u<this._arrayFilteredRootsInSession.length;u++){if(this._arrayFilteredRootsInSession[u].filterRootId===x){v=1;this._arrayFilteredRootsInSession[u].objQuery=t;this._arrayFilteredRootsInSession[u].fakeFilter=s;break}}if(!v){this._arrayFilteredRootsInSession.push({filterRootId:x,objQuery:t,fakeFilter:s})}}else{this._arrayFilteredRootsInSession.push({filterRootId:x,objQuery:t,fakeFilter:s})}},_onSavedFilter:function(s){this._keepFilterIdInSession(s.rootID,s.filterId)},onApplyNGFilter:function(s){},setNGFilterOptions:function(s){this._ngExpand=s.expandServices;this._ngAppId=s.appID;k.setAppExpandMode(this._ngExpand);a.subscribe("onApplyNGFilter",this.onApplyNGFilter.bind(this));a.subscribe("NGFilter_saved",this._onSavedFilter.bind(this));if(sessionStorage.getItem("FBI_droppedFilters")){sessionStorage.removeItem("FBI_droppedFilters")}},resetNGFilterUI:function(t){var s=t.widgetId||"?";if(s===this.optionsToKeep.widgetId){t.appId=this.optionsToKeep.appId;t.rootIds=t.rootIds?t.rootIds:this._arrayRootsInSession;sessionStorage.removeItem("FBI_droppedFilters");this._cleanNGFSessionItems();a.publish("NGFilter.RemoveFilter",t)}else{console.log(" Invalid data for reset filter ( widgetId  = "+s+")")}},retrieveFiltersFromIds:function(w){var v=this;if(this._tenantId!==w.droppedEnvId){console.log("ERROR FilterBIComponentProxy : tenant has to be updated : newTenant = "+w.droppedEnvId+", previous tenant ="+this._tenantId);return}w.filtersIds=w.objectId?w.objectId:w.filterIds;w.filtersIds=UWA.is(w.filtersIds,"array")?w.filtersIds:[w.filtersIds];if(w.filtersIds.length>1){var u={success:[],failure:[{msg:e.get("multiFiltersDrop"),eventID:"warning"}]};this._callbackOnDrop=w.callback;this._applyFilterOnDrop(u)}else{for(var t=0;t<w.filterObjects.length;t++){var s=w.filterObjects[t];var x=s.objectId?s.objectId:w.filtersIds;f.getPlatformServices(this._tenantId).then(function(){k.getFilterDataFromFilterId(x,v._tenantId).then(function(y){if(y.success){v._fromBIFilterToNGFUX({rootID:y.success[0].rootPhysicalId,filterIds:x,filterNames:s.filterNames,NGFState:w.fromDropOnFilter?"dropOnFilter":"drop",})}else{if(!y.success){y.success=[]}v._callbackOnDrop=w.callback;v._applyFilterOnDrop(y)}})})}if(v._subscribe0){v._subscribe0.unsubscribe("NGFilter.ApplyDroppedFilters");v._subscribe0=undefined}v._callbackOnDrop=w.callback;v._subscribe0=a.subscribe("NGFilter.ApplyDroppedFilters",v._applyFilterOnDrop.bind(this))}},_fromBIFilterToNGFUX:function(t){var s=this;var u=t.rootID;f.getInfosFromIds([u],false).then(function(B){var x;for(var w=0;w<B.length;w++){if(u===B[w].id){x=B[w].label}}s._fromDropOnFilter=t.NGFState;var v=s._computeFilterId(u);var z=t.filterIds;var y={appId:s.optionsToKeep.appId,widgetId:s.optionsToKeep.widgetId,widgetTenant:s._tenantId,rootAlias:x,appQueryParam:k.getAppQueryParam(),filterId:v,filterPId:z,configUsed:s._configUsed,};var A=p.merge(t,y);a.publish("Frame3DXInfra.Update",{type:"Filter",display:"false",options:A})})},retrieveFilters:function(x){var w=this;if(x.filterObjects.length>1){var v={success:[],failure:[{msg:e.get("multiFiltersDrop"),eventID:"warning"}]};this._callbackOnDrop=x.callback;this._applyFilterOnDrop(v)}else{if(x.filterIds){x.droppedEnvId=x.filterObjects[0].envId;return this.retrieveFiltersFromIds(x)}for(var t=0;t<x.filterObjects.length;t++){if(x.filterObjects[0].objectId){x.droppedEnvId=x.filterObjects[0].envId;x.filterIds=x.filterObjects[0].objectId;return this.retrieveFiltersFromIds(x)}var s=x.filterObjects[t];var y=x.filterObjects[t].objectId?x.filterObjects[t].objectId:x.filterIds;var u=x.filterObjects[t].displayName;f.getPlatformServices(this._tenantId).then(function(){k.getFilterDataFromFilterNames(u).then(function(z){if(z.success){w._fromBIFilterToNGFUX({rootID:z.success[0].rootPhysicalId,filterIds:y,filterNames:u,NGFState:x.fromDropOnFilter?"dropOnFilter":"drop",})}if(z.failure){if(!z.success){z.success=[]}w._callbackOnDrop=x.callback;w._applyFilterOnDrop(z)}})})}if(w._subscribe0){w._subscribe0.unsubscribe("NGFilter.ApplyDroppedFilters");w._subscribe0=undefined}w._callbackOnDrop=x.callback;w._subscribe0=a.subscribe("NGFilter.ApplyDroppedFilters",w._applyFilterOnDrop.bind(this))}},_applyFilterOnDrop:function(x){if(this._callbackOnDrop){this._setFocusToWidget();var t=x.success.length;for(var u=0;u<t;u++){if("tbd"===x.success[u].filter){x.success[u].filter=this.getQueriesInSession(x.success[u].rootId)?this.getQueriesInSession(x.success[u].rootId).objQuery:undefined;x.success[u].filter.filterRootIds=[x.success[u].rootId];x.success[u].filter.appId=this.optionsToKeep.appId;x.success[u].filter.widget=this.optionsToKeep.widgetId}if(x.success[u].filter){this._cleanCVQueryV2InSession(x.success[u].rootId);if(this._expandSynthesisON){var w=k.getCVQueryType(x.success[u].filter);var v=k.getCombinationType(x.success[u].filter[w]);var s=k.getQueryExpandType(x.success[u].filter[w][v]);this._keepRootsInSession(x.success[u].filter.filterRootIds);if("dropOnFilter"!==x.success[u].fromDropOnFilter){this._updateFilteredRootsInSessionArray(x.success[u].filter.filterRootIds[0],x.success[u].filter);this._setTagsWithFilteredExpandSynthesis(this._arrayFilteredRootsInSession)}else{this._updateFilteredRootsInSessionArray(x.success[u].filter.filterRootIds[0])}this._keepFilterIdInSession(x.success[u].rootId,x.success[u].filterId);x.success[u].hideChildren=this._checkCutInfo(x.success[u].filter[w])}}sessionStorage.setItem("NGF_tagMgtRunning_"+x.success[u].filter.filterRootIds[0],false)}this._callbackOnDrop(x)}this._callbackOnDrop=undefined},cleanDroppedFilters:function(s){},setVolatileTags:function(x){var u=[],w=this;if(this.myTagProxy){if(x.summary){this._summary=this._summary.concat(x.summary);this._volatileTags=x.summary;this.myTagProxy.setTags(null,this._summary);for(var v=0;v<x.summary.length;v++){var s=x.summary[v].sixw;if(this._keepVolatileTags.indexOf(s)===-1){this._keepVolatileTags.push(s)}}}if(x.colorMap){for(var t in x.colorMap){if(x.colorMap.hasOwnProperty(t)){if(this._keepVolatileTags.indexOf(t)===-1){this._keepVolatileTags.push(t)}}}this.myTagProxy.setColorMap(x.colorMap)}delete this._setVolatilesSummariesAfterProxyCreation}else{this._setVolatilesSummariesAfterProxyCreation=x}},checkVolatileTags:function(w){var y,v,u,s={};s.isVolatileTag=false;u=this.volatileTags;if(w){for(var x in u){if(u.hasOwnProperty(x)){if(w[x]===undefined){delete this.volatileTags[x]}}}for(var t in w){if(w.hasOwnProperty(t)){if(this._keepVolatileTags.indexOf(t)>-1){y=t;v=w[y];if(this.volatileTags[y]){if(v.length===this.volatileTags[y].length){this.volatileTags[y]=v;s.isVolatileTag=true;s.predicateName=y;return s}}else{this.volatileTags[y]=v;s.isVolatileTag=true;s.predicateName=y;return s}}}}}else{this.volatileTags={};return s}return s},completeCVQueryWithAppSpecs:function(u,s,t){return m.completeCVQueryWithAppSpecs(u,s,t)},completeCVQueryWithAppParams:function(t,u,s){return m.completeCVQueryWithAppParams(t,u,s)},_onCloseFilterPanel:function(s){if("dataFilterPanel"===s.tag){if(("dropOnFilter"===this._fromDropOnFilter)&&this._expandSynthesisON){this._setTagsWithFilteredExpandSynthesis(this._arrayFilteredRootsInSession)}this.dispatchEvent("NGFilter_CloseAbstract",s);for(var t=0;t<this._arrayRootsInSession.length;t++){sessionStorage.setItem("NGF_tagMgtRunning_"+this._arrayRootsInSession[t],false)}}},_onOpenFilterPanel:function(s){if("taggerCtn"===s.tag){if(("dropOnFilter"===this._fromDropOnFilter)&&this._expandSynthesisON){this._setTagsWithFilteredExpandSynthesis(this._arrayFilteredRootsInSession)}this.dispatchEvent("NGFilter_CloseAbstract",s);for(var t=0;t<this._arrayRootsInSession.length;t++){sessionStorage.setItem("NGF_tagMgtRunning_"+this._arrayRootsInSession[t],false)}}},_computeFilterId:function(s){var t=this.optionsToKeep.appId+"_"+s;return t},_onFilterVolume:function(s){if(this.optionsToKeep.appId===s.appId&&this.optionsToKeep.volumeFilterAvailable){this.dispatchEvent("NGFilter_VolumeAbstract",s)}},setVolume:function(w){var x;var s=w.volume;if(s){var t=s.root_path_physicalid;if(t&&t.length){x=t[0][0];w.rootId=x;w.filterId=this._computeFilterId(x);var v=this;var u;if("proximity"===w.volume.type){u=w.volume.root_path_physicalid[0]}else{u=[x]}f.getInfosFromIds(u,true).then(function(D){var z=[];var C=u.length;var y=D.length;for(var B=0;B<C;B++){for(var A=0;A<y;A++){if(u[B]===D[A].id){z.push(D[A].label)}}}v._updateFilter(x,w,z)},function(y){v._updateFilter(x,w)})}}if(undefined===x){a.publish("NGFilter_CancelVolumeDefined",{})}},_updateFilter:function(y,w,t){w.volume.root_path_alias=t;if(w.id){var v=w.id.split("_");if(2<=v.length){var x=v[1].split("-");if(2<=x.length){w.specId=parseInt(x[0]);w.setId=parseInt(x[1])}}}var u=this._computeFilterId(y);var s={type:"Filter",options:{widgetTenant:this._tenantId,rootID:y,rootAlias:(t.length)?t[0]:undefined,appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId,filterId:u,configUsed:this._configUsed,appQueryParam:k.getAppQueryParam(),volumeUsed:true,filterToApply:{event:"NGFilter_VolumeDefined",data:w}}};a.publish("Frame3DXInfra.Update",s)},viewChange:function(t){if(this.optionsToKeep.widgetId===t.id){var s={type:t.type,appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId};a.publish("NGFilter_ViewChange",s)}},_onSubscribeRemoveWidget:function(s){a.publish("FBIProxy.RemoveWidget",s)},setProxyAsMaster:function(s){this.optionsToKeep.synthesis_priority=1},GetFilterSpec:function(t,v){var x=this.getQueriesInSession(t);if(!x&&!v){return}if(!x&&v.V1&&!Object.keys(v.V1).length){return}if(!x&&v.V2&&!Object.keys(v.V2).length){return}if(v.V1){var C={};if(!x){x.objQuery=k._buildEmptyFilter(t)}if(Object.keys(v.V1).length){var y=Object.keys(x.objQuery);for(var u=0;u<y.length;u++){var A=y[u];C[A]={};C[A]=UWA.clone(this.completeCVQueryWithAppSpecs(A,v.V1))}}else{C=UWA.clone(x.objQuery)}return C}else{if(v.V2&&Object.keys(v.V2).length){var B={};var z=v.V2;var w=l.emptyFilterFormat(t);if(!x){B=UWA.clone(l.updateWithAppParams(t,w,z))}else{if(undefined===x.objQueryV2){var s=l.fromNGFV1ToV2(t,x.objQuery.CVQuery,z);var D=UWA.clone(s);B=UWA.clone(l.updateWithAppParams(t,D,z));this._keepCVQueryV2InSession(t,D)}else{B=UWA.clone(l.updateWithAppParams(t,x.objQueryV2,z))}}return B}}},HasFilter:function(u){var s={hasFilter:false};var t=this.getQueriesInSession(u);if(t&&t.objQuery){if(t.fakeFilter){s.hasFilter=false}else{s.hasFilter=true;s.filterId=t.filterId}}return s},RetrievePrdFromFilterId:function(t){var s=this;return new b(function(v,u){if(t.length<1){var w=t[0];f.getPlatformServices(this._tenantId).then(function(){k.getFilterDataFromFilterId(w,s._tenantId).then(function(x){if(x.success){s._fromBIFilterToNGFUX({rootID:x.success[0].rootPhysicalId,filterIds:w,NGFState:"dropOnFilter",});v(x.success[0].rootPhysicalId)}else{u({msg:e.get("multiFiltersDrop"),eventID:"warning"})}})})}else{u({msg:e.get("multiFiltersDrop"),eventID:"warning"})}})},_checkCutInfo:function(w){var u=false;if(w&&w.sequence_filter){if("seq_cut"===w.sequence_filter.option){u=true}}else{var v=k.getCombinationQuery(w);if(v){var t=k.getQueryExpand(v);if(t&&t[0].sequence_filter){var s=t[0].sequence_filter[0].option;if(-1!==s.indexOf("seq_cut")){u=true}}}}return u},_setFocusToWidget:function(){if(widget){widget.dispatchEvent("onViewRequest",{focus:true})}}});return o});define("DS/ENOFilterBIUX/FilterBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/Toggle","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX_ExSy/ExSy_FBIComponentProxy","DS/ENOFilterBIUX_Fetch/Fetch_FBIComponentProxy","DS/ENOFilterBIUX/BIEngine","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(n,o,g,d,i,j,q,h,p,r,m,f,c,l,k,b,a,e){var s=o.extend(g,{init:function(t){if(t.ExpandSynthesisON){this._biFilter=new p(t)}else{this._biFilter=new r(t)}this._biFilter.addEvent("FilterBIColorizeEvent",this.filterBIColorize.bind(this));this._biFilter.addEvent("FilterBIUnColorizeEvent",this.filterBIUnColorize.bind(this));this._biFilter.addEvent("FilterBIFilteringEvent",this.filterBIFilter.bind(this));this._biFilter.addEvent("ColorizeVolatileEvent",this.filterBIColorizeVolatile.bind(this));this._biFilter.addEvent("FilterVolatileEvent",this.filterBIFilterVolatile.bind(this));this._biFilter.addEvent("ApplyNGFilterAbstract",this.NGFApplyNGFilter.bind(this));this._biFilter.addEvent("NGFilter_VolumeAbstract",this.filterBIFilterVolume.bind(this));this._biFilter.addEvent("NGFilter_CloseAbstract",this.filterBICloseFilterPanel.bind(this));return this},cleanProxy:function(){this._biFilter.cleanProxy()},setPathTags:function(t,u){this._biFilter.setPathTags(t,u)},removeRoot:function(t){this._biFilter.removeRoot(t)},setVolume:function(t){this._biFilter.setVolume(t)},updateTenant:function(t){this._biFilter.updateTenant(t)},odtSetFilters:function(t){this._biFilter.odtSetFilters(t)},odtKeepActiveFilters:function(t){this._biFilter.odtKeepActiveFilters(t)},addFilterChangeListenerThruBI:function(t){this._biFilter.addFilterChangeListenerThruBI(t)},filterBIColorize:function(t){this.dispatchEvent("FilterBIColorize",t)},filterBIColorizeVolatile:function(t){this.dispatchEvent("ColorizeVolatile",t)},filterBIUnColorize:function(t){this.dispatchEvent("FilterBIUnColorize",t)},filterBIFilter:function(t){this.dispatchEvent("FilterBIFilteringEvent",t)},filterBIFilterVolatile:function(t){this.dispatchEvent("FilterVolatile",t)},NGFApplyNGFilter:function(t){this.dispatchEvent("ApplyNGFilter",t)},filterBIFilterVolume:function(t){this.dispatchEvent("NGFilter_Volume",t)},filterBICloseFilterPanel:function(t){this.dispatchEvent("NGFilter_Close",t)},viewChange:function(u){if(this.optionsToKeep.widgetId===u.id){var t={type:u.type,appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId};a.publish("NGFilter_ViewChange",t)}},_cleanUnFilteredTree:function(t,v,u){this._biFilter._cleanUnFilteredTree(t,v,u)},_cleanTree:function(t,v,u){this._biFilter._cleanTree(t,v,u)},setPredicates:function(t){this._predicates=t},addSubjects:function(t){if(null!==this.myTagProxy&&undefined!==this.myTagProxy){this.myTagProxy.addSubjects(t)}},destroy:function(){this._biFilter.destroy()},setTags:function(u,t,v){this._biFilter.setTags(u,t,v)},unsetTags:function(){this._biFilter.unsetTags()},focusOnSubjects:function(t,u){this._biFilter.focusOnSubjects(t,u)},unfocus:function(){this._biFilter.unfocus()},toggleProxyFocus:function(t){this._biFilter.toggleProxyFocus(t)},getCurrentFilter:function(){this._biFilter.getCurrentFilter()},die:function(){this._biFilter.die()},activate:function(){this._biFilter.activate()},deactivate:function(){this._biFilter.deactivate()},setVolatileTags:function(t){this._biFilter.setVolatileTags(t)},checkVolatileTags:function(t){this._biFilter.checkVolatileTags(t)},emptyFilter:function(t){this._biFilter.emptyFilter(t)},setNGFilterOptions:function(t){this._biFilter.setNGFilterOptions(t)},resetNGFilterUI:function(t){this._biFilter.resetNGFilterUI(t)},retrieveFiltersFromIds:function(t){this._biFilter.retrieveFiltersFromIds(t)},retrieveFilters:function(t){this._biFilter.retrieveFilters(t)},setTagsWithExpandSynthesis:function(u,t){this._biFilter.setTagsWithExpandSynthesis(u,t)},setSynthesisMode:function(t){this._biFilter.setSynthesisMode(t)},completeCVQueryWithAppSpecs:function(v,t,u){return l.completeCVQueryWithAppSpecs(v,t,u)},completeCVQueryWithAppParams:function(u,v,t){return l.completeCVQueryWithAppParams(u,v,t)},GetFilterSpec:function(t,u){return this._biFilter.GetFilterSpec(t,u)},HasFilter:function(t){return this._biFilter.HasFilter(t)},RetrievePrdFromFilterId:function(t){return this._biFilter.RetrievePrdFromFilterId(t)},setProxyAsMaster:function(t){this._biFilter.setProxyAsMaster(t)}});return s});define("DS/ENOFilterBIUX/FilterComponent",["UWA/Core","UWA/Class","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/ENOFilterBIUX/FilterBIComponentProxy"],function(f,e,a,d,c){var b=e.extend({_tree:[],init:function(g){var i;this._nodesPath=g.nodesPath;this._widgetID=g.widgetID;this._fedSearchURL="https://vdevpril862dsy.ux.dsone.3ds.com/federated/search";this._groupedData={};var h=this;this._filterBIProxy=this._instanciateProxy();this._filterBIProxy.addEvent("FilterBIColorize",h.onTaggerColorization.bind(h));this._filterBIProxy.addEvent("FilterBIUnColorize",h.onTaggerUnColorization.bind(h));this._filterBIProxy.addEvent("FilterBIFilter",h.onTaggerFilter.bind(h));this._setPredicates(["ds6w:description"]);this._filterBIProxy.setPathTags(this._nodesPath)},_buildQuery:function(){var h=this._nodesPath.nodes.length;this._currentQuery="";for(var g=0;g<h;g++){this._currentQuery+='physicalid:"'+this._nodesPath.nodes[g]+'"';if(h!==g+1){this._currentQuery+=" OR "}}},fetch:function(){a.proxifiedRequest(this._fedSearchURL,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({query:this._currentQuery,order_by:"asc",order_field:"update",locale:"en",nresults:40,start:0,tenant:"OnPremise",select_predicate:["ds6w:created"],label:"FBIServices"}),onComplete:this._parse.bind(this),onFailure:function(g){console.log(g)}})},_parse:function(g){var i=g.results,k=g.facets,j=this,h=[];i.forEach(function(q){var m=q.attributes,p=[];for(var o=0;o<m.length;o++){if(m[o].format!=="internal"){if(!j._groupedData[m[o].name]){j._groupedData[m[o].name]={}}p=j._getIdPathsForID(m[0].value);if(j._groupedData[m[o].name][m[o].value]){for(var n=0;n<p.length;n++){j._groupedData[m[o].name][m[o].value].push(p[n].id)}}else{j._groupedData[m[o].name][m[o].value]=[];for(var l=0;l<p.length;l++){j._groupedData[m[o].name][m[o].value].push(p[l].id)}}}}})},_getIdPathsForID:function(h){var g=this;return this._tree.filter(function(i){var j=i.path;return h===g._nodesPath.nodes[j[j.length-1]]})},_instanciateProxy:function(){var g={widgetId:this._widgetID,tenant:"OnPremise",processingMode:"appProcessing",colorize:true,};return new c(g)},_setPredicates:function(g){this._filterBIProxy.setPredicates(g)},onTaggerColorization:function(g){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerColorization")},onTaggerUnColorization:function(g){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerUnColorization")},onTaggerFilter:function(g){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerFilter")},_findLastItems:function(n,h){var m=[],k={},g,l;for(var j=0;j<h.length;j++){l=h[j];g=l[l.length-1];if(k[g]){k[g].count+=1}else{k[g]={id:n[g],count:1}}}return},});return b});