define("DS/ENOGantt/Controller/MainController",["DS/ENOGantt/Ven/Ext","DS/ENOGantt/Controller/Finder","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants","DS/Foundation2/FoundationV2Data",],function(a,c,b,d,e){a.define("DS/ENOGantt/Controller/MainController",{extend:"Ext.app.ViewController",alias:"controller.GanttViewController",control:{"#dpmprojectgantt":{beforetaskresize:"beforetaskresize",beforetaskdrag:"beforetaskdrag",aftertaskresize:"aftertaskresize",taskdrop:"taskdrop",dependencydrop:"dependencydrop"},"[reference=zoomToFit]":{click:"onzoomToFit"},"[reference=zoomOut]":{click:"onZoomOut"},"[reference=zoomIn]":{click:"onZoomIn"},"[reference=expandAll]":{click:"onExpandAll"},"#rmbExpandAll":{click:"onExpandAll"},"#expandLevel_1":{click:"onExpandNLevelHandler"},"#expandLevel_2":{click:"onExpandNLevelHandler"},"#expandLevel_3":{click:"onExpandNLevelHandler"},"#expandLevel_4":{click:"onExpandNLevelHandler"},"#expandLevel_5":{click:"onExpandNLevelHandler"},"#expandLevel_all":{click:"onExpandAll"},"[reference=highlightCrit]":{click:"onHighlightCrit"},"[reference=statusDatePicker]":{click:"onStatusDatePicker"},"[reference=print]":{click:"onPrint"},"[reference=collapseGanttChart]":{click:"onCollapseGanttChart"},"[reference=SaveAll]":{click:"onSave",},"[reference=resetAll]":{click:"onReset"},"[reference=viewDropDown]":{click:"toggleView"},"[reference=showRollUpTask]":{click:"toggleRollUpTaskView"},"[reference=refinement]":{click:"showRefinement"},"[reference=calculateFloatData]":{click:"calculateFloatData"},"#RMB_expandLevel_1":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_2":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_3":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_4":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_5":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_all":{click:"onExpandAll"},"#rmbOpenTaskAction":{click:"openTask"},"[reference=find]":{change:"find"},"[reference=filterByName]":{keyup:"filterByName"},"[reference=filter]":{click:"filter"},"[reference=resetFilter]":{click:"resetFilter"},"[reference=hide]":{click:"hide"},},getGantt:function(){return this.getView()},beforetaskdrag:function(g,f,j,h){return f.isStartDateEditable()&&f.isEndDateEditable()},beforetaskresize:function(g,f,j,h){return b.isValidTaskResize(f,j,h)},aftertaskresize:function(g,f,j){var k=f.data;var n=k.Policy;var l=k.Duration;if(n!="Project Review"&&(l!=null&&l==0)){var h=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];alert(h);f.reject();return}},taskdrop:function(g,p,n){var j=p.data;var o=j.Policy;var f=j.StartDate;var k=j.EndDate;var h=j.Duration;var l=j.DurationUnit;if(k==null&&f!=undefined){var q=j.Duration;var l=j.DurationUnit;k=a.Date.add(f,l,q)}p.setConstraint("startnoearlierthan",f)},dependencydrop:function(k,f,j,h){var g=a.ComponentQuery.query("#dpmprojectgantt")[0];if(!j){return false}},onzoomToFit:function(){var f=this.getGantt();f.zoomToFit()},onZoomOut:function(){var f=this.getGantt();f.zoomOut()},onZoomIn:function(){var f=this.getGantt();f.zoomIn()},onExpandAll:function(h,g){var f=this.getGantt();new UWA.Promise(function(k,j){var l;if(h.scope){l=h.scope.rec}b.isReadyToExpand(l,k)}).then(function(j){f.setLoading(false);f.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]);setTimeout(function(){console.time("expand");if(!App.Gantt.toolbar){App.Gantt.toolbar={expandAll:{expanded:false,}}}App.Gantt.toolbar.expandAll.expanded=true;if(h.scope){var k=h.scope.rec;if(k.data.depth===1){f.expandAll()}else{k.expand(true)}}else{f.expandAll()}f.setLoading(false);App.Gantt.toolbar.expandAll.expanded=false;console.timeEnd("expand")},50)})},onExpandNLevelHandler:function(g){var f=this.getGantt();new UWA.Promise(function(j,h){var k;if(g.scope){k=g.scope.rec}b.isReadyToExpand(k,j,g.level)}).then(function(h){f.setLoading(false);f.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]);setTimeout(function(){console.time("expand");if(!App.Gantt.toolbar){App.Gantt.toolbar={expandAll:{expanded:true,}}}else{App.Gantt.toolbar.expandAll.expanded=true}if(g.scope){var j=g.scope.rec;b.selectiveExpandFromRMB(j,g.level)}else{b.selectiveExpand(f,g.level)}f.setLoading(false);App.Gantt.toolbar.expandAll.expanded=false;console.timeEnd("expand")},100)})},onHighlightCrit:function(h){var g=this.getGantt();var f=g.getSchedulingView();if(h.pressed||h.checked){f.highlightCriticalPaths(true)}else{f.unhighlightCriticalPaths(true)}},onStatusDatePicker:function(h){var k=this.getGantt();var g=h.getValue();var j=k.getTimeAxis();var f=j.getEnd();if(g>=f){g=f-1}progressLine=k.plugins[5];progressLine.setStatusDate(g);progressLine.enable()},onPrint:function(){var f=this.getGantt();f.print()},onCollapseGanttChart:function(j){var h=j.icon;var g=this.getGantt();var k=enoviaServer.computeUrl("/common/images/");var f=k+"iconActionComplianceExport.png";var l=k+"iconActionImportDesignSyncModule.png";if(g.lockedGrid.getWidth()>d.gantt.lockedGrid.width||h.contains("iconActionImportDesignSyncModule.png")){g.normalGrid.setCollapsed(false);g.lockedGrid.setWidth(d.gantt.lockedGrid.width);b.enableButtons(d.toolbarBtnListToEnableDisable);j.setIcon(f);j.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"])}else{g.lockedGrid.setWidth(g.ownerGrid.getWidth()+g.normalGrid.getWidth());g.normalGrid.collapse(true);b.disableButtons(d.toolbarBtnListToEnableDisable);j.setIcon(l);j.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"])}},onSave:function(){var f=this.getGantt();f.getCrudManager().sync();this.filter()},onReset:function(){var g=this.getGantt();g.getCrudManager().reject();var h=a.ComponentQuery.query("#dpmresourceutilizationpanel")[0];var f=h.getStore();f.rejectChanges()},togglePlanView:function(g){var n=g.pressed;var k=this.getView();var o=enoviaServer.computeUrl("/common/images/");var h=o+"I_HidePlanActual32.png";var l=o+"I_ShowPlanActual32.png";var f=k.getColumns();for(i=0,m=f.length;i<m;i++){if(f[i].name=="BaselineDuration"||f[i].name=="BaselineStartDate"||f[i].name=="BaselineEndDate"){f[i].setVisible(n)}}App.Infra.BaselineRequired=n;k.baselineVisible=App.Infra.BaselineRequired;k.setReadOnly(n);k.getView().refresh();if(n){k.showBaseline();enoviaServer.viewId=App.Nls.viewStore[2].viewId;g.setTooltip(App.Nls.viewStore[0].name);g.setIcon(h);a.getCmp("tBarActionRollUpTask").disable()}else{k.hideBaseline();enoviaServer.viewId=App.Nls.viewStore[0].viewId;g.setTooltip(App.Nls.viewStore[2].name);g.setIcon(l);a.getCmp("tBarActionRollUpTask").enable()}var j=a.ComponentQuery.query("panel#GanttRefinementPanel")[0];if(j&&j.isVisible()){j.hide();this.showRefinement()}},toggleView:function(f){var g=this;if(App.Infra.Load.Level!=0){if(App.Infra.ViewId==App.Infra.Views.VIEW_STATUS_REPORT){App.Infra.LoadStatusActualData=true}new UWA.Promise(function(k,j){var h;var l=a.ComponentQuery.query("#dpmprojectgantt")[0];b.getStoreTaskExpandStatus(l.taskStore);b.isReadyToExpand(h,k,0)}).then(function(h){g.togglePlanView(f)})}else{g.togglePlanView(f)}},toggleRollUpTaskView:function(f){var j=f.pressed;var h=this.getView();var l=enoviaServer.computeUrl("/common/images/");var g=l+"I_ShowRollupTask32.png";var k=l+"I_HideRollupTask32.png";h.setShowRollupTasks(j);if(j){f.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.hideRollUpTasks"]);f.setIcon(k)}else{f.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.showRollUpTasks"]);f.setIcon(g)}},showRefinement:function(){var f=a.ComponentQuery.query("panel#GanttRefinementPanel")[0];f.show()},openTask:function(k){var g=this.getGantt();if(k.scope){var f=k.scope.rec;var j=f.getId();if(j.indexOf("_")>=0){j=j.split("_")[0]}var h="../../common/emxNavigator.jsp?physicalId="+j;if(window.isIFWE){h=enoviaServer.computeUrl("/common/emxNavigator.jsp?physicalId=")+j}window.open(h)}},resetCache:function(){if(App.Gantt.filter.filterBy){for(var f in App.Gantt.filter.filterBy){if("Name"!==f){delete App.Gantt.filter.filterBy[f]}}}},resetFilter:function(){var f=this.getView();f.reset();enoviaServer.resetRefinement=true;this.resetCache();this.filter()},hide:function(){this.getView().hide()},filter:function(){var n=a.ComponentQuery.query("panel#GanttRefinementPanel")[0];var g=n.getValues();this.resetCache();for(var k in g){if(App.Gantt.filter.filterBy){var l=g[k];var j=false;if(l instanceof Array){if(l.join("")!=""){j=true;l=l.join("@")}}else{if(l+""!=""){j=true}}if(j){if(App.Gantt.filter.filterBy[k]){var h=App.Gantt.filter.filterBy[k];h=h+"@"+l.toString();App.Gantt.filter.filterBy[k]=h}else{App.Gantt.filter.filterBy[k]=l.toString()}}}}var f=App.Gantt.filter.filterBy;if(f&&Object.keys(f).length>0){this.getView().store.filterTreeBy()}else{this.getView().store.clearTreeFilter();App.Gantt.filter.filterBy={}}},filterByName:function(h,g){if(g.getKey()===g.ESC){delete App.Gantt.filter.filterBy.Name;h.reset()}var f=h.getValue();if(f.length>0){App.Gantt.filter.filterBy.Name=f;this.getGantt().getTaskStore().filterTreeBy()}else{delete App.Gantt.filter.filterBy.Name;this.getGantt().getTaskStore().filterTreeBy(true)}},find:function(l,k,h){var f=this.getView();var g=f.getTaskStore();l.focus(false);var j=this;this.finder=new c({field:l,view:f,store:g,newValue:k,oldValue:h,});a.Function.defer(function(){var n=j.finder.find()},500)},clear:function(f){f.focus(false);this.finder.reset()},previous:function(g){g.focus(false);var f=this.finder.find(true)},next:function(g){g.focus(false);var f=this.finder.find()},calculateFloatData:function(){var h=this.getGantt();if(h.crudManager.hasChanges()){var j=confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]);if(j){h.getCrudManager().reject()}else{return false}}var g="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,getFloatValues";h.setLoading(false);h.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingRollUp"]);var f=function(o){var k=a.ComponentQuery.query("#dpmprojectgantt")[0];var w=k.getTaskStore();var n=o.data;for(var r=0,p=n[0].relateddata.getFloatValues.length;r<p;r++){var u=n[0].relateddata.getFloatValues[r];var s=u.id;var v=u.dataelements.totalFloat;var q=u.dataelements.freeFloat;var l=w.getModelById(s);if(l){l.set("TotalFloat",v);l.set("FreeFloat",q)}}var t=k.crudManager;t.commit();k.setLoading(false)};e.ajaxRequest({url:g,type:"GET",dataType:"json",callback:f})},})});