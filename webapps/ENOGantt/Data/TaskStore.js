define("DS/ENOGantt/Data/TaskStore",["UWA/Class","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/Data/ResponseUtil","DS/Foundation2/FoundationV2Data","DS/ENOGantt/GanttUtil",],function(a,d,f,e,b){var c={patternMatches:function(i,h){var g=new RegExp(Ext.String.escapeRegex(i),"i");return g.test(h)},nameMatchFound:function(g){var j=Ext.getCmp("filterField").getValue();var i=g.get("Name");var h=new RegExp(Ext.String.escapeRegex(j),"i");return h.test(i)},dateMatchFound:function(i,l,j){var k=new Date(j[0]);var h=new Date(j[1]);var g=new Date(i.get(l));g.setHours(0);g.setMinutes(0);g.setSeconds(0);if(!isNaN(k)&&!isNaN(h)){return(k<=g)&&(g<=h)}else{if(!isNaN(k)){return k<=g}else{return g<=h}}},deviationMatchFound:function(g,n,o,m){var l=false;var q=App.Nls["emxProgramCentral.DurationUnits.Days"];if(m==null||m==""){return l}m=m.substring(0,m.indexOf(q));var h=parseInt(m);for(var k=0;k<o.length;k++){var s=[];var j=o[k];j=j.substring(0,j.indexOf(q));s=j.split(" - ");var r=parseInt(s[0]);var p=parseInt(s[1]);if(h>=r&&h<=p){l=true;break}}return l}};return a.extend({init:function(h){var g=this;if(!Ext.ClassManager.isCreated("DS.ENOGantt.Data.TaskModel")){Ext.define("DS.ENOGantt.Data.TaskModel",{extend:"Gnt.model.Task",autoCalculateCostForParentTask:false,autoCalculateCost:false,fields:function(){var i=new Array();var k=App.Infra.Columns;var m=k.length;i.push({name:"TaskProjectId",mapping:"TaskProjectId"});i.push({name:"ExternalDependencies",mapping:"ExternalDependencies"});i.push({name:"ExternalRawDependencies",mapping:"ExternalRawDependencies"});i.push({name:"hasEditAccess",mapping:"hasEditAccess"});i.push({name:"Color",mapping:"Color",type:"string"});i.push({name:"EnglishType",mapping:"EnglishType"});for(idx=0;idx<m;idx++){var l=k[idx];var n=l.dataIndex;var j=l.xtype;var o=l.excludeInRefinement;if("datecolumn"==j){i.push({name:n,mapping:n,excludeInRefinement:o,type:"date",dateFormat:"c"})}else{i.push({name:n,mapping:n,excludeInRefinement:o,})}}return i}(),getEarlyStartDateDefaultValue:function(k){var l=this,j=k.taskStore||l.getTaskStore(true),n=l.getProject();var i=l.data.TaskProjectId;if(i){var m=j.getModelById(l.data.TaskProjectId).data;return m.ConstraintDate?m.ConstraintDate:j.getProjectStartDate()}return n?n.getStartDate():j.getProjectStartDate()},isEditable:function(k){if(App.Infra.CustomeColumnDataIndex.includes(k)){return App.Infra.customeColumnEditableData[k].isEditable}if(this.getReadOnly()){return false}var j=this.get("parentId");if("root"==j){return false}var i=["State","Status","TaskSequenceId","Type","PercentDone","Assignee","Deviation","FreeFloat","TotalFloat"];if(i.indexOf(k)!=-1){return false}if(k=="StartDate"){return this.isStartDateEditable()}else{if(k=="EndDate"){return this.isEndDateEditable()}else{if(k=="Duration"){return this.isDurationEditable()}else{if(k=="Dependency"){return this.isDependencyEditable()}}}}return this.callParent(arguments)},isExpandable:function(){var i=this;if(i.get("expandable")){return !(i.isLeaf())}return false},isReadOnly:function(){var i=false;if(this.getReadOnly()){i=true}return i},isMilestone:function(i){var l=false;var k=this.get("EnglishType");var j=this.hasChildNodes();if(j){l=false}else{if("Gate"==k||"Milestone"==k){l=true}}return l},isStartDateEditable:function(){var k=App.Nls.Active;var m=App.Nls.Review;var i=App.Nls.Complete;var l=this.get("State");var j=!(this.isLeaf());if(l==k||l==m||l==i||j||App.Infra.TypeOf.ProjectTemplate){return false}return true},isEndDateEditable:function(){var l=App.Nls.Review;var i=App.Nls.Complete;var k=this.get("State");var j=!(this.isLeaf());if(k==l||k==i||j||App.Infra.TypeOf.ProjectTemplate){return false}return true},isDurationEditable:function(){var n=App.Nls.Review;var j=App.Nls.Complete;var m=this.get("State");var l=!(this.isLeaf());var k=this.isMilestone();var i=this.get("PercentDone");if(100==i||m==n||m==j||l||k){return false}return true},isDependencyEditable:function(){var i=App.Nls.Complete;var j=this.get("State");if(j==i){return false}return true},})}Ext.define("MyDependencyStore",{override:"Gnt.data.DependencyStore",autoLoad:true,proxy:{type:"memory",reader:{type:"json"},},getDependencyError:function(k,i,p,r,t){var s=this.callParent(arguments);if(s<=0&&s==-2&&App.Infra.Load.Level!=0){s=0}var l=Ext.ComponentQuery.query("#dpmprojectgantt")[0];if(s>=0){if(k instanceof d.model.Dependency){p=k.getType();i=k.getTargetId()}else{if(p===null||p===undefined){var q=this.model.getField(this.model.prototype.typeField).defaultValue;p=q!==undefined?q:this.model.Type.EndToStart}}var u=App.Nls.Review;var m=App.Nls.Active;var n=App.Nls.Complete;var o=l.taskStore.getModelById(i);var j=o.data.State;if((j===u||j===m)&&(0===p||2===p)){s=-101}if((1===p||3===p)&&o.hasChildNodes()){s=-102}if(j===n){s=-104}}return s}});Ext.define("DS.ENOGantt.Data.TaskStore",{extend:"Gnt.data.TaskStore",model:"DS.ENOGantt.Data.TaskModel",sortOnLoad:false,autoNormalizeNodes:false,scheduleByConstraints:true,RefinementUtil:c,keepExpandStateWhileFiltered:true,allowExpandCollapseWhileFiltered:true,calendar:new d.data.calendar.BusinessTime({name:"General",calendarId:"General"}),proxy:{type:"memory",reader:{type:"json"},},getCriticalPaths:function(){var l=this,i=[],j=l.toArray()[1].data.Id;if(!j){this.callParent(arguments)}else{url="/resources/v1/modeler/projects/"+j+"?$indexBasedImages=false&$include=none,tasks&level=0&$fields=none,tasks.criticalTask";var m=e.calculateFinalUrl(url);var k={url:m,type:"GET",async:false,dataType:"json",callback:function(n){if(n.success){var o=n.data[0];if(o.relateddata&&o.relateddata.tasks&&o.relateddata.tasks.length>0){i=f.getCriticalTasksArray(o.relateddata.tasks,l)}}}};b.authenticateReqAndCall(k);return Ext.Array.map(i,function(n){return n.getCriticalPaths()})}},find:function(v,r,s,q){var p=f.getGanttTableColumnArray(false);if(p&&p.length>0){var l=p.length;var o=this.toArray();var t=o.length;if(v){var u=q-1;if(u==-1){u=t-1}for(var n=u;n>0;n--){var k=o[n];if(k.raw.visible){if(this.performFind(r,k,l,p)){return{model:k,index:n}}}}}else{var u=q+1;for(var n=u,m=o.length;n<m;n++){var k=o[n];if(k.raw.visible){if(this.performFind(r,k,l,p)){return{model:k,index:n}}}}}}},performFind:function(q,i,l,n){var p=false;for(var m=0;m<l;m++){var o=n[m];var r=i.get(o.dataIndex);if(r==undefined||r.toString()==""){continue}if(o.columnDataType=="datefield"){var j=o.format;r=Ext.util.Format.date(r,j)}if(o.dataIndex=="Duration"){r=o.getValueToRender(r,null,i)}if(q.test(r)){p=true;break}}return p},filterTreeBy:function(i){this.callParent([{filter:function(k){if(k.get("parentId")=="root"){return true}if(k.get("ExternalTask")){return false}if(k.parentNode&&(!k.parentNode.isExpanded())&&!i){return false}var u=App.Gantt.filter.filterBy;var m=true;for(var s in u){if(u.hasOwnProperty(s)){var t=App.Gantt.filter.fields[s]?App.Gantt.filter.fields[s].fieldDataType:undefined;var r=s;var l=u[s].split("@");var j=k.get(r);if("Name"==s){var q=App.Gantt.filter.filterBy.Name;var p=new RegExp(Ext.String.escapeRegex(q),"i");m=p.test(k.getName())}else{if("datefield"==t){m=c.dateMatchFound(k,r,l);if(!m){break}}else{if(s=="Deviation"){m=this.doDeviationFilter(k,r,l,j);if(!m){break}}else{if(!(j==undefined)){if("numberfield"==t){j=Math.round(Number(j)*100)/100;if(s=="Duration"){var n=App.Nls["emxProgramCentral.DurationUnits.Days"];j=j+" "+n.toLowerCase()}}var o=l.indexOf(j.toString());if(o>=0){continue}else{m=false;break}}else{m=false;break}}}}}}return m},checkParents:true}])},doDeviationFilter:function(j,q,r,p){var n=false;var o=App.Nls["emxProgramCentral.DurationUnits.Days"];if(p==null||p==""){return n}p=p.substring(0,p.indexOf(o));var k=parseInt(p);for(var m=0;m<r.length;m++){var u=[];var l=r[m];l=l.substring(0,l.indexOf(o));u=l.split(" - ");var t=parseInt(u[0]);var s=parseInt(u[1]);if(k>=t&&k<=s){n=true;break}}return n}})},getStore:function(){return Ext.create("DS.ENOGantt.Data.TaskStore")}})});