define("DS/IssueServices/Contexts",["UWA/Class","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger"],function(e,c,b,d){var f="20x FD00";var a=e.singleton(b,c,{name:"DS/IssueServices/Contexts",version:f,_logger:null,_contexts:{},init:function(){var g=this;g._logger=d.getLogger(g.name);g._contexts={}},add:function(g,h){var i=this;if(i._contexts.hasOwnProperty(g)){i._logger.warn("The context %s already exists, now replaced by the given context",g)}i._contexts[g]=h},remove:function(g){var h=this;if(!h._contexts.hasOwnProperty(g)){h._logger.warn("The context %s does not exist, cannot remove it",g)}delete h._contexts[g]},get:function(g){var h=this;if(h._contexts[g]===undefined){h._logger.error("The context %s does not exist",g);return null}else{return h._contexts[g]}},reset:function(){var g=this;g._contexts={}}});return a});define("DS/IssueServices/utils/Parser",["UWA/Core"],function(c){var b={MAPPING:{id:"resourceid",typeIcon:"type_icon_url",previewUrl:"preview_url",owner:"owner",name:"ds6w:identifier",title:"ds6w:label",state:"ds6w:status",type:"ds6w:type",responsible:"ds6w:responsible",modified:"ds6w:modified",created:"ds6w:created",revision:"ds6wg:revision",organization:"ds6w:organizationResponsible",isLastRevision:"ds6wg:PLMReference.V_isLastVersion"},};var a={parseFetchResponse:function(d){var e={value:{},display:{}};if(c.is(d,"object")&&d.hasOwnProperty("attributes")){for(var g=0;g<d.attributes.length;g++){var h=d.attributes[g];var f=c.is(h.name,"string")?h.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):h.name;switch(f){case b.MAPPING.id:e.value.id=h.value;e.display.id=h.value;e.value.physicalId=h.value;e.display.physicalId=h.value;break;case b.MAPPING.typeIcon:e.value.typeIcon=h.value;e.display.typeIcon=h.value;break;case b.MAPPING.previewUrl:e.value.previewUrl=h.value;e.display.previewUrl=h.value;break;case b.MAPPING.owner:e.value.owner=h.value;e.display.owner=h.value;break;case b.MAPPING.name:e.value.name=h.value;e.display.name=h.dispValue;break;case b.MAPPING.title:e.value.title=h.value;e.display.title=h.dispValue;break;case b.MAPPING.state:e.value.state=c.is(h.value,"string")?h.value.replace("Issue.",""):h.value;e.display.state=c.is(h.dispValue,"string")?h.dispValue.replace("Issue.",""):h.dispValue;break;case b.MAPPING.type:e.value.type=h.value;e.display.type=h.dispValue;break;case b.MAPPING.responsible:e.value.responsible=h.value;e.display.responsible=h.dispValue;break;case b.MAPPING.modified:e.value.modified=h.value;e.display.modified=h.dispValue;break;case b.MAPPING.created:e.value.created=h.value;e.display.created=h.dispValue;break;case b.MAPPING.revision:e.value.revision=h.value;e.display.revision=h.value;break;case b.MAPPING.organization:e.value.organization=h.value;e.display.organization=h.dispValue;break;case b.MAPPING.isLastRevision:var i=h.value;if(i&&i!==""){e.value.isLastRevision=i.toLowerCase()==="true";e.display.isLastRevision=i.toLowerCase()==="true"}else{e.value.isLastRevision=null;e.display.isLastRevision=null}break;default:if(f&&f!==""){e.value[f]=h.value;e.display[f]=h.value}else{e.value[f]=null;e.display[f]=null}break}}}return e}};return a});define("DS/IssueServices/services/PlatformServices",["UWA/Class/Promise","UWA/Core","UWA/Utils/InterCom","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData"],function(g,d,j,a,k,i,h){var e={APP_ID_MY_PROFILE:"X3DPRFL_AP",TENANT_FIRST_POSITION:"?tenant=",ON_PREMISE:"onpremise",ROLE_INDEX:0,ORGANIZATION_INDEX:1,COLLABORATIVE_SPACE_INDEX:2,DEFAULT_SC:0};var l=null;var b={};var f={platformServices:l,securityContexts:b,getCurrentTenantIndex:function(){if(!Array.isArray(l)){throw new Error("Platform services have not been initialized correctly")}var o=window.widget.getValue("x3dPlatformId"),n=-1;if(d.is(o,"string")){for(var m=0;m<l.length;m++){if(l[m].platformId===o){n=m}}}if(n===-1){return 0}else{return n}},getSearchOptions:function(m){var n={title:"",role:"",mode:"furtive",default_with_precond:true,precond:"",show_precond:false,multiSel:true,idcard_activated:false,select_result_max_idcard:false,itemViewClickHandler:"",app_socket_id:m.socket,widget_id:m.widget,search_delegation:"3dsearch",default_search_criteria:""};n=d.merge(m||{},n);return n},getSecurityContexts:function(n){var m={};m.method="GET";m.headers={Accept:"application/json","Content-Type":"application/json"};m.cache=-1;return new g(function(q,p){m.onComplete=function(s){q(JSON.parse(s))};m.onFailure=function(s){p(s)};var o=f.getCurrentTenantIndex(),r=l[o].platformId;h.authenticatedRequest(n+"/resources/modeler/pno/person?tenant="+r+"&current=true&select=preferredcredentials&select=collabspaces",m)}).then(function(L){var A=function(P,O,Q){return"ctx::"+Q+"."+O+"."+P};var u=function(P,O,Q){if(O===""){return P+" ● "+Q}return P+" ● "+O+" ● "+Q};var K=function(Q){var T="",S="",R="";for(var O in Q){if(Q.hasOwnProperty(O)){var P=Q[O];switch(O){case"organization":T=P.name;break;case"role":S=P.name;if(P.nls){R=P.nls}else{R=S}break;default:break}}}return{org:T,role:S,roleNls:R}};var p="ctx:",r=L.pid,z=[];var J="",o="",N="";for(var M in L.preferredcredentials){if(L.preferredcredentials.hasOwnProperty(M)){var v=L.preferredcredentials[M];switch(M){case"collabspace":J=v.name;break;case"organization":o=v.name;break;case"role":N=v.name;break;default:break}}}p=A(J,o,N);var q=[];for(var D in L.collabspaces){if(L.collabspaces.hasOwnProperty(D)){var t=L.collabspaces[D];for(var F=0;F<t.couples.length;F++){var s=K(t.couples[F]);q.push(s.org)}}}var G=q.every(function(Q,P,O){return Q===O[q.length-1]});for(var B in L.collabspaces){if(L.collabspaces.hasOwnProperty(B)){var H=L.collabspaces[B];for(var C=0;C<H.couples.length;C++){var w=K(H.couples[C]);var I=A(H.name,w.org,w.role);var x=H.title?H.title:H.name;var E=u(x,!G?w.org:"",w.roleNls);var y={csName:x,label:E,value:I};if(p===I){y.isDefault=true}z.push(y)}}}if(J===""||o===""||N===""){if(z.length>0){p=z[e.DEFAULT_SC].value}}return{userId:r,securityContext:p,cspaces:z}})}};var c={_internals:f,initPlatformServices:function(){var m=this;if(l!==null){return g.resolve()}return new g(function(o,n){a.getPlatformServices({onComplete:function(p){l=m._internals.platformServices=p;o()},onFailure:function(p){n(p)}})}).then(function(){return f.getSecurityContexts(m.get3DSpaceUrl())}).then(function(n){b=m._internals.securityContexts=n;return m},function(n){throw new Error("Could not init the platform services. "+n)})},isCloudEnvironment:function(){var p=window.widget;var n=false;var o=p.getValue("x3dPlatformId");if(d.is(o,"string")&&o!==""){var m=o.toLowerCase();n=m.indexOf(e.ON_PREMISE)===-1}return n},search:function(o){o=d.merge(o||{},{title:"",widget_id:window.widget.id,app_socket_id:window.widget.name+"_"+window.widget.id,default_search_criteria:""});var q=f.getSearchOptions(o);var n=new j.Socket(q.app_socket_id,{dispatchRetryInterval:5});n.subscribeServer("SearchComServer");n.dispatchEvent("RegisterContext",q);n.dispatchEvent("InContextSearch",q);var p=function(){};var m=function(s){if(typeof o.callback==="function"){o.callback.call(null,s)}p()};n.addListener("Selected_Objects_search",m);var r=function(){if(typeof o.cancel==="function"){o.cancel.call(null)}p()};n.addListener("onCloseTransient",r);p=function(){n.dispatchEvent("UnregisterContext",{widget_id:q.widget_id});n.unsubscribeServer("SearchComServer");n.removeListener("Selected_Objects_search",m);n.removeListener("onCloseTransient",r);n.disconnect()}},getUserProfile:function(m){var n=this;require(["DS/TransientWidget/TransientWidget"],function(o){o.showWidget(e.APP_ID_MY_PROFILE,"",{login:m,url:n.get3DSwymUrl()})})},getCompassPubSub:function(){return k},get3DSearchUrl:function(){var m=f.getCurrentTenantIndex();if(l[m]["3DSearch"]===undefined){throw new Error("No 3DSearch URL available for this tenant")}return l[m]["3DSearch"]},get3DSpaceUrl:function(){var m=f.getCurrentTenantIndex();if(l[m]["3DSpace"]===undefined){throw new Error("No 3DSpace URL available for this tenant")}return l[m]["3DSpace"]},get3DSwymUrl:function(){var m=f.getCurrentTenantIndex();if(l[m]["3DSwym"]===undefined){return""}return l[m]["3DSwym"]},get3DCompassUrl:function(){var m=f.getCurrentTenantIndex();if(l[m]["3DCompass"]===undefined){throw new Error("No 3DCompass URL available for this tenant")}return l[m]["3DCompass"]},get3DDashboardUrl:function(){var m=f.getCurrentTenantIndex();if(l[m]["3DDashboard"]===undefined){throw new Error("No 3DDashboard URL available for this tenant")}return l[m]["3DDashboard"]},getSecurityContexts:function(){return b},getSecurityContext:function(){var o="";var n=window.widget;if(n.hasPreference("securityContext")&&n.getPreference("securityContext")){o=n.getPreference("securityContext").value}else{o=n.getValue("securityContext")}if(d.is(o,"string")&&o.contains("ctx::")){var m=o.split("::");return m[m.length-1]}return o},getTenants:function(){var o=this;var n=[];for(var m in l){if(l.hasOwnProperty(m)){n.push({label:l[m].displayName,value:l[m].platformId})}}return{platforms:n,tenant:o.getTenant()}},getTenant:function(){var m=f.getCurrentTenantIndex();return l[m].platformId},getCurrentCredentials:function(){var m=this;var o=m.getSecurityContext();var n=o.split(".");if(n.length!==3){return{role:"",organization:"",collaborativeSpace:""}}return{role:n[e.ROLE_INDEX],organization:n[e.ORGANIZATION_INDEX],collaborativeSpace:n[e.COLLABORATIVE_SPACE_INDEX]}},getUserName:function(){return i.getUser().login},getFullName:function(){return i.getUser().firstName.trim()+" "+i.getUser().lastName.trim()},getUserImage:function(m,n){var o=this,p="";if(n&&n.format==="mini"){p="/format/mini"}return o.assembleURLFor3DSwym("/api/user/getpicture/login/"+m+p)},getUserInfo:function(n,o){var p=this;var m=d.clone(o);m.method="GET";m.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:p.getSecurityContext()};m.cache=-1;h.authenticatedRequest(p.assembleURLFor3DSpace("/resources/modeler/pno/person/"+n),m)},assembleURLFor3DSpace:function(m,o){var n=this;var p="";if(d.is(o,"string")&&o.length>0){if(o.charAt(0)!=="&"){throw new Error("The parameters argument should start with &")}p=o}else{p=""}var q="";if(m.indexOf(e.TENANT_FIRST_POSITION)===-1){q=e.TENANT_FIRST_POSITION+n.getTenant()}return n.get3DSpaceUrl()+m+q+p},assembleURLFor3DSwym:function(m,o){var n=this;var p="";if(d.is(o,"string")&&o.length>0){if(o.charAt(0)!=="&"){throw new Error("The parameters argument should start with &")}p=o}else{p=""}var q="";if(m.indexOf(e.TENANT_FIRST_POSITION)===-1){q=e.TENANT_FIRST_POSITION+n.getTenant()}return n.get3DSwymUrl()+m+q+p}};return c});define("DS/IssueServices/utils/Performance",["UWA/Class","DS/Logger/Logger"],function(c,b){var a={ROUTINE_FREQUENCY:10000};var d=c.singleton({name:"DS/IssueServices/utils/Performance",_logger:null,_dumpRoutineInterval:null,init:function(){var e=this;e._logger=b.getLogger("DS/IssueServices/Utils");e._dumpRoutineInterval=null;window.performances={};window.performances.dump=e.dump;window.performances.clear=e.clear;window.performances.clear();e.enableDumpRoutine()},start:function(e){window.performance.mark(e+"_start")},end:function(g){var f=this;try{window.performance.mark(g+"_end");window.performance.measure(g,g+"_start",g+"_end")}catch(e){f._logger.warn("The mark %s cannot be ended",g)}},dump:function(){var k=this;try{var l=window.performance.getEntriesByType("measure"),h={};for(var g=0;g<l.length;g++){if(h[l[g].name]===undefined){h[l[g].name]=l[g].duration}else{h[l[g].name]+=l[g].duration}}var j=Object.keys(h).length;if(j===0){k._logger.info("No entries to be dumped for this interval")}else{k._logger.info("Dumping %s entries...",j)}for(var e in h){if(h.hasOwnProperty(e)){k._logger.info("%s: %s ms",e,h[e])}}}catch(f){k._logger.warn("Dumping has failed unexpectedly: ",f.message)}},clear:function(){var f=this;try{window.performance.clearMarks();window.performance.clearMeasures()}catch(e){f._logger.warn("Clearing has failed unexpectedly: ",e.message)}},enableDumpRoutine:function(){var f=this;try{if(f._dumpRoutineInterval!==null){f._logger.warn("A routine is already set, please disable it first")}f._dumpRoutineInterval=setInterval(function(){try{f._logger.info("Performance measured from %s %s for an interval of %s ms:",window.widget.name,window.widget.id,a.ROUTINE_FREQUENCY);f.dump();f.clear()}catch(g){f._logger.warn("Dumping routine interval has failed unexpectedly: ",g.message)}},a.ROUTINE_FREQUENCY)}catch(e){f._logger.warn("Enabling dump routine has failed unexpectedly: ",e.message)}},disableDumpRoutine:function(){var f=this;try{if(f._dumpRoutineInterval!==null){clearInterval(f._dumpRoutineInterval);f._dumpRoutineInterval=null}}catch(e){f._logger.warn("Disabling dump routine has failed unexpectedly: ",e.message)}}});return d});define("DS/IssueServices/services/IssueServices",["UWA/Class/Promise","UWA/Core","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(g,d,h,b,a){var e={HEADER_ACCEPT_JSON:"application/json",HEADER_CONTENT_TYPE_JSON:"application/json",TEN_MINUTES:600000,CACHE_LIMIT:5,FETCH_PREDICATES:["owner","ds6w:identifier","ds6w:label","ds6w:status","ds6w:type","ds6w:responsible","ds6w:state","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:organizationResponsible","ds6wg:PLMReference.V_isLastVersion","lastrevision"],MAXIMUM_RECENT_OBJECTS:100,DELTA_TIME_RECENT_OBJECTS:300};var f={getCurrentSecurityContext:function(){return a.getSecurityContext()},getCurrentTenant:function(){return a.getTenant()},isJson:function(k){try{JSON.parse(k)}catch(j){return false}return true},getHeaderForJson:function(k){var j=k&&d.is(k.version,"string")?k.version:"1.0";var l=b.get("widget")||window.widget;return{Accept:"application/json","Content-Type":"application/json","Accept-Language":l.lang,"DS-API-Version":j,SecurityContext:"ctx::"+f.getCurrentSecurityContext()}},setPromise:function(j){var l=d.clone(j.onComplete);var k=d.clone(j.onFailure);return new g(function(n,m){j.onComplete=function(o){if(d.is(o,"string")&&o!==""){o=JSON.parse(o)}if(j.mustEmbedInBody===true){delete j.mustEmbedInBody;o={success:true,body:o}}if(d.is(l,"function")){l(o)}n(o)};j.onFailure=function(p,o){if(d.is(o,"string")&&o!==""){o=JSON.parse(o)}if(j.mustEmbedInBody===true){delete j.mustEmbedInBody;o={success:false,body:o}}if(d.is(k,"function")){k(o)}m(o)}})}};var i={recent:function(j){return new g(function(q,p){var o=b.get("widget")||window.widget;var l=e.FETCH_PREDICATES;if(Array.isArray(j.predicates)){l=l.concat(j.predicates)}var n={label:o.name+"-"+a.getUserName()+"-"+Date.now(),nresults:e.MAXIMUM_RECENT_OBJECTS,delta_time_interval:e.DELTA_TIME_RECENT_OBJECTS,tenant:f.getCurrentTenant(),select_predicate:l,select_file:["icon","thumbnail_2d"]};var m={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:e.TEN_MINUTES,onComplete:function(s){try{var r=JSON.parse(s);q(r)}catch(t){p(t)}},onFailure:p,data:JSON.stringify(n)};var k=a.get3DSearchUrl()+"/recent?tenant="+f.getCurrentTenant()+"&_="+Date.now();h.authenticatedRequest(k,m)})},consolidateWithRecentObjects:function(k){var l=this;var j=k.predicates,n=k.physicalIds,m=k.responseFromFetch;return new g(function(s,r){var o={};try{o=JSON.parse(m)}catch(p){r(p)}if(Array.isArray(o.results)&&o.results.length===n.length){s(o)}else{var q=[];if(Array.isArray(o.results)){var t=o.results.map(function(u){return l._getPhysicalId(u)});q=n.filter(function(u){return t.indexOf(u)===-1})}else{q=n}l.recent({predicates:j}).then(function(u){if(Array.isArray(u.results)){var w=d.clone(o);if(!Array.isArray(w.results)){w.results=[]}for(var v=0;v<u.results.length;v++){var x=l._getPhysicalId(u.results[v]);if(q.indexOf(x)!==-1){w.results.push(u.results[v]);w.infos.nhits+=1;w.infos.nresults+=1}}s(w)}else{s(o)}})["catch"](function(){s(o)})}})},_getPhysicalId:function(k){var j="";for(var l=0;l<k.attributes.length;l++){var m=k.attributes[l];if(m.name==="resourceid"){j=m.value}}return j}};var c={internals:f,fetcher:i,search:function(j){var k={};k.method="POST";k.headers={Accept:"application/json","Content-Type":"application/json"};k.timeout=e.TEN_MINUTES;if(!d.is(j.data,"object")){return g.reject(new Error('Invalid argument "options.data". Expected an Object.'))}var m=b.get("widget")||window.widget;var l=d.merge(d.clone(j.data),{label:m.name+"-"+a.getUserName()+"-"+Date.now(),nresults:100,start:0,tenant:f.getCurrentTenant()});k.data=JSON.stringify(l);k.mustEmbedInBody=true;var n=f.setPromise(k);h.authenticatedRequest(a.get3DSearchUrl()+"/search",k);return n},fetch:function(r){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:r.version});m.timeout=e.TEN_MINUTES;var j=r.data.objects.reduce(function(t,s){t.push(s.physicalId);return t},[]);var p=e.FETCH_PREDICATES;if(Array.isArray(r.data.predicates)){p=p.concat(r.data.predicates)}var o=b.get("widget")||window.widget;var n={label:o.name+"-"+a.getUserName()+"-"+Date.now(),nresults:r.data.objects.length,physicalid:j,start:0,tenant:f.getCurrentTenant(),select_predicate:p};m.data=JSON.stringify(n);var l=d.clone(r.onComplete);var k=d.clone(r.onFailure);var q=new g(function(t,s){m.onComplete=function(u){var v="";i.consolidateWithRecentObjects({predicates:p,physicalIds:j,responseFromFetch:u}).then(function(w){v=d.clone(w)})["catch"](function(){v=d.clone(u)})["finally"](function(){if(d.is(v,"string")&&v!==""){v=JSON.parse(v)}v={success:true,body:v};if(d.is(l,"function")){l(v)}t(v)})};m.onFailure=function(u){if(d.is(u,"string")&&u!==""){u=JSON.parse(u)}u={success:false,body:u};if(d.is(k,"function")){k(u)}s(u)}});h.authenticatedRequest(a.assembleURLFor3DSpace("/cvservlet/fetch/v2"),m);return q},recent:i.recent,comments:{retrieve:function(k){var l={};l.method="GET";l.headers=f.getHeaderForJson({version:k.version});l.timeout=e.TEN_MINUTES;l.onComplete=k.onComplete;l.onFailure=k.onFailure;l.mustEmbedInBody=true;var n=f.setPromise(l);var j="/resources/commentproxy/subjects/pid:"+k.data.physicalId+"/contributions";var m="&page_number=0&page_size=8&total_pages=0&sort_by=time&order_by=reverse_time";h.authenticatedRequest(a.assembleURLFor3DSpace(j,m),l);return n}},custom:{getCustomAttributes:function(j){var k={};k.method="GET";k.headers=f.getHeaderForJson({version:j.version});k.timeout=e.TEN_MINUTES;k.onComplete=j.onComplete;k.onFailure=j.onFailure;var l=f.setPromise(k);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/custom/attributes",""),k);return l}},"export":{pptx:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});delete m.headers.Accept;m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"GET",url:"resources/issues/"+k.data.objects[l].physicalId+"/export/pptx"})}m.data=JSON.stringify({requests:j});m.responseType="arraybuffer";m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/export/batch",""),m);return n}},getRevisions:function(j){var k={};k.method="POST";k.headers=f.getHeaderForJson({version:j.version});k.timeout=e.TEN_MINUTES;k.data=JSON.stringify(j.data);k.onComplete=j.onComplete;k.onFailure=j.onFailure;k.mustEmbedInBody=true;var l=f.setPromise(k);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/v1/dslc/versiongraph","&withIsLastVersion=1"),k);return l},images:{retrieve:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"GET",url:"resources/issues/"+k.data.objects[l].physicalId+"/images/primary"})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},update:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/images/primary",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},"delete":function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/images/primary",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n}},issues:{filter:function(r){var k={};k.method="GET";k.headers=f.getHeaderForJson({version:r.version});k.timeout=e.TEN_MINUTES;var l=b.get("widget")||window.widget;var n=b.get("component");var j=r.data.filter;var p=[];if(d.is(n.getSessionOrFilteredRoots,"function")){p=n.getSessionOrFilteredRoots()}else{if(j.session===true){p=l.getValue("roots")}}if(p.length>0){return c.issues.retrieve({data:{objects:p.map(function(s){return{physicalId:s}})}}).then(function(s){var t=s.map(function(u){return u.body});return{success:true,body:t}})}var o="";var m=["owned","assigned","reported","responsible","participated","closed"];m.forEach(function(s){if(j[s]&&d.is(j[s],"boolean")){o+="&"+s+"="+j[s]}else{o+="&"+s+"=false"}});k.onComplete=r.onComplete;k.onFailure=r.onFailure;var q=f.setPromise(k);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues",o),k);return q},create:function(j){var k={};k.method="POST";k.headers=f.getHeaderForJson({version:j.version});k.timeout=e.TEN_MINUTES;k.data=JSON.stringify(j.data);k.onComplete=j.onComplete;k.onFailure=j.onFailure;var l=f.setPromise(k);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues",""),k);return l},retrieve:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"GET",url:"resources/issues/"+k.data.objects[l].physicalId})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},update:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId,body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},"delete":function(j){var k={};k.method="POST";k.headers=f.getHeaderForJson({version:j.version});k.timeout=e.TEN_MINUTES;var l={data:[],options:[]};j.data.objects.forEach(function(n){l.data.push({physicalid:n.physicalId})});k.data=JSON.stringify(l);k.type="json";k.onComplete=j.onComplete;k.onFailure=j.onFailure;k.mustEmbedInBody=true;var m=f.setPromise(k);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/lifecycle/Delete/structure/",""),k);return m},promote:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/promotion",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},demote:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/demotion",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},close:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/closure",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},duplicate:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"POST",url:"resources/issues/"+k.data.objects[l].physicalId+"/duplication",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n}},organizations:{getCompanies:function(j){var k={};k.method="GET";k.headers=f.getHeaderForJson({version:j.version});k.timeout=e.TEN_MINUTES;k.onComplete=j.onComplete;k.onFailure=j.onFailure;var l=f.setPromise(k);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/organizations",""),k);return l}},people:{retrieve:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"GET",url:"resources/issues/"+k.data.objects[l].physicalId+"/people"})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},update:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/people",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},"delete":function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"DELETE",url:"resources/issues/"+k.data.objects[l].physicalId+"/people",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n}},preferences:{get:function(k){var l={};l.method="GET";l.headers=f.getHeaderForJson({version:k.version});l.timeout=e.TEN_MINUTES;l.data=k.data;var m="/resources/AppsMngt/user/getPreferences",j="";if(a.isCloudEnvironment()===true){j=a.get3DCompassUrl()+m;delete l.headers.SecurityContext}else{j=a.assembleURLFor3DSpace(m)}l.onComplete=k.onComplete;l.onFailure=k.onFailure;l.mustEmbedInBody=true;var n=f.setPromise(l);h.authenticatedRequest(j,l);return n},set:function(k){var l={};l.method="PUT";l.headers=f.getHeaderForJson({version:k.version});l.headers["Content-Type"]="application/x-www-form-urlencoded";l.timeout=e.TEN_MINUTES;l.data=k.data;var m="/resources/AppsMngt/user/preference",j="";if(a.isCloudEnvironment()===true){j=a.get3DCompassUrl()+m;delete l.headers.SecurityContext}else{j=a.assembleURLFor3DSpace(m)}l.onComplete=k.onComplete;l.onFailure=k.onFailure;l.mustEmbedInBody=true;var n=f.setPromise(l);h.authenticatedRequest(j,l);return n}},related:{retrieve:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"GET",url:"resources/issues/"+k.data.objects[l].physicalId+"/related"})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},update:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/related",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},"delete":function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"DELETE",url:"resources/issues/"+k.data.objects[l].physicalId+"/related",body:k.data.objects[l]})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n}},routes:{retrieve:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"GET",url:"resources/issues/"+k.data.objects[l].physicalId+"/routes"})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},approve:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/routes/approval",body:{comment:k.data.objects[l].comment,action:k.data.objects[l].action}})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n},reject:function(k){var m={};m.method="POST";m.headers=f.getHeaderForJson({version:k.version});m.timeout=e.TEN_MINUTES;var j=[];for(var l=0;l<k.data.objects.length;l++){j.push({id:l,method:"PUT",url:"resources/issues/"+k.data.objects[l].physicalId+"/routes/rejection",body:{reason:k.data.objects[l].reason,action:k.data.objects[l].action}})}m.data=JSON.stringify({requests:j});m.onComplete=k.onComplete;m.onFailure=k.onFailure;var n=f.setPromise(m);h.authenticatedRequest(a.assembleURLFor3DSpace("/resources/issues/batch",""),m);return n}}};return c});define("DS/IssueServices/utils/Views",["DS/i3DXCompassPlatformServices/OpenWith","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(d,a,c){var b={getOpenWith:function(){return new d()},getCompassPubSub:function(){return c.getCompassPubSub()}};return b});define("DS/IssueServices/services/SwymServices",["UWA/Class/Promise","UWA/Core","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(f,g,b,a,e){var d={getToken:function(){var h=a.get("widget");return new f(function(l,k){var i=e.assembleURLFor3DSwym("/api/index/tk");var j={};j.method="GET";j.headers={};j.headers.Accept="application/json";j.headers["Content-Type"]="application/json";j.headers["Accept-Language"]=h.lang;j.onComplete=function(n){var m=null;m=g.is(n,"string")?JSON.parse(n).result:n.result;l(m.ServerToken)};j.onFailure=function(m){var n=null;n=g.is(m,"string")?JSON.parse(m):m;k(n)};b.authenticatedRequest(i,j)})},find:function(h){var i=a.get("widget");return d.getToken().then(function(j){return new f(function(n,m){var k=e.assembleURLFor3DSwym("/api/user/find");var l={};l.method="POST";l.headers={};l.headers.Accept="application/json";l.headers["Content-Type"]="application/json";l.headers["Accept-Language"]=i.lang;l.headers["X-DS-SWYM-CSRFTOKEN"]=j;l.data=JSON.stringify({params:{hash_key:"",login:h.user}});l.onComplete=function(o){o=g.is(o,"string")?JSON.parse(o):o;n(o)};l.onFailure=function(o){o=g.is(o,"string")?JSON.parse(o):o;m(o)};b.authenticatedRequest(k,l)})})}};var c={_internals:d,users:{retrieve:function(h){return d.find({user:h.user}).then(function(j){var i=j.result;return{user:i.login,address:i.address,city:i.city,company:i.company,country:i.country,email:i.email,name:i.first_name+" "+i.last_name}})}}};return c});define("DS/IssueServices/utils/Support",["UWA/Core","DS/Logger/Logger","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueServices/assets/nls/IssueServices"],function(g,d,a,e,f){var c={UNKNOWN:f.support.unknown,BROWSERS:{Chrome:60,Firefox:52,IE:11}};var b={checkBrowserSupport:function(){var j=this;j._logger=d.getLogger("DS/IssueServices/Support");j._logger.info("Checking the browser support");var i=j.utils.getBrowser();if(!c.BROWSERS[i.name]){j._logger.warn(f.replace(f.support.browser,{name:i.name,version:i.version,supported:j.utils.getSupportedBrowsers()}));return false}else{var h=parseFloat(i.version);if(h<c.BROWSERS[i.name]){j._logger.warn(f.replace(f.support.browser,{name:i.name,version:i.version,supported:j.utils.getSupportedBrowsers()}));return true}return true}},checkSwymSupport:function(){var i=this;i._logger=d.getLogger("DS/IssueServices/Support");i._logger.info("Checking Swym support");var h=e.get3DSwymUrl();if(h===""){i._logger.error("Swym is not available on this server");require(["DS/PADUtils/views/PADAlert"],function(j){j.displayNotification({msg:f.support.swym,eventID:"error"})});return false}return true},utils:{getBrowser:function(){try{var j=navigator.userAgent,h,k=j.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(k[1])){h=/\brv[ :]+(\d+)/g.exec(j)||[];return{name:"IE",version:(h[1]||"")}}if(k[1]==="Chrome"){h=j.match(/\b(OPR|Edge)\/(\d+)/);if(h!==null){return{name:h[1].replace("OPR","Opera"),version:h[2]}}}k=k[2]?[k[1],k[2]]:[navigator.appName,navigator.appVersion,"-?"];if((h=j.match(/version\/(\d+)/i))!==null){k.splice(1,1,h[1])}return{name:k[0],version:k[1]}}catch(i){return{name:c.UNKNOWN,version:c.UNKNOWN}}},getSupportedBrowsers:function(){var h=[];for(var i in c.BROWSERS){if(c.BROWSERS.hasOwnProperty(i)){h.push(i+" ("+c.BROWSERS[i]+")")}}return h.join(", ")}}};return b});define("DS/IssueServices/utils/LocalStorage",["UWA/Core","DS/Logger/Logger","DS/IssueServices/Contexts"],function(d,c,a){var b={setItem:function(l,k){var h=this;h._logger=c.getLogger("DS/IssueServices/LocalStorage");var g=a.get("widget");var m=g.id,j=g.name;var f={};f[l]=k;try{if(localStorage.getItem(j+"/"+m)===null){localStorage.setItem(j+"/"+m,JSON.stringify(f))}else{var e=JSON.parse(localStorage.getItem(j+"/"+m));e[l]=k;localStorage.setItem(j+"/"+m,JSON.stringify(e))}}catch(i){h._logger.error("Cannot set the value %o for the key %s: %s",k,l,i.message)}},getItem:function(g){var h=this;h._logger=c.getLogger("DS/IssueServices/LocalStorage");var j=a.get("widget");var k=j.id,e=j.name;try{var i=JSON.parse(localStorage.getItem(e+"/"+k));return i[g]}catch(f){h._logger.info("Cannot get the value for the key %s: %s",g,f.message);return null}},clear:function(){var f=this;f._logger=c.getLogger("DS/IssueServices/LocalStorage");var g=a.get("widget");var h=g.id,e=g.name;localStorage.setItem(e+"/"+h,JSON.stringify({}))}};return b});define("DS/IssueServices/utils/Migration",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Input/Button","DS/Logger/Logger","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/LocalStorage","i18n!DS/IssueServices/assets/nls/IssueServices","css!DS/IssueServices/IssueServices.css"],function(k,g,i,c,d,b,j,l){var h={TIME_BEFORE_REFRESH:500};var a={placeholder:function(){return g.createElement("div",{"class":"placeholder-migration-container",html:[{tag:"div","class":"placeholder-migration-label",html:[{tag:"span","class":"migration-text saving",html:[l.migration.upgrading,{tag:"span",html:"."},{tag:"span",html:"."},{tag:"span",html:"."}]}]}]})}};var f=c.getLogger("DS/IssueServices/Migration");var e={isUpToDate:function(){var n=d.get("widget");var m=n.getValue("version");if(m&&g.is(m,"number")){f.info("Widget is not up-to-date (previous to 19x FD03)");return false}if(!m||!g.is(m,"string")){f.info("The version is not set (first initialization), we set it to version %s",d.version);n.setValue("version",d.version);return true}if(m<d.version){f.info("Widget is not up-to-date");return false}f.info("Widget is up-to-date");return true},upgrade:function(){var m=this;var n=d.get("widget");f.info("The widget is now upgrading");a.placeholder().inject(n.body);return b.initPlatformServices().then(function(){var o=b.getSecurityContexts();n.addPreference({name:"securityContext",type:"list",label:"",options:o.cspaces,defaultValue:o.securityContext})}).then(function(){f.info("The platform services have been initialized");var o=null;m.reset().then(function(){return m.migrate()}).then(function(){f.info("Widget has been upgraded")})["catch"](function(p){o=p;f.error(o)})["finally"](function(){var p=new i({value:l.migration.refresh,icon:"arrows-ccw"});p.addEvent("onClick",function(){p.load();setTimeout(function(){window.top.location.reload(true)},h.TIME_BEFORE_REFRESH)});n.body.getElement(".placeholder-migration-label").setContent([{tag:"span","class":"placeholder-migration-label-text",html:(o!==null)?l.migration.preferences.error:l.migration.upgrade},{tag:"div","class":"placeholder-migration-label-button",html:p}])})})},reset:function(){var m=d.get("widget");f.info("Resetting the parameters");return new k(function(n){j.clear();m.setValue("version",d.version);f.info("Preferences reset and version set to %s",d.version);n()})},migrate:function(){return new k(function(m){m()})},getVersion:function(){return d.version}};return e});