define("DS/SMAAnalyticsLauncher/SMAAnalyticsWidgetLoadModule",["UWA/Core","UWA/Promise","UWA/Utils","DS/UIKIT/Mask","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SMAAnalyticsNLS/assets/nls/SMAAnalyticsWidgetNLSfile"],function(c,f,e,G,h,b,o,i){var d="3DSpace";var r="Results_Analytics";var p="x3dPlatformId";var E="createcollabspaces";var y="";var j="";var n="";var g=null;var F=null;var s=(function(){var H=h;b.setNotificationManager(H);b.setFadeOutPolicy(1);b.setStackingPolicy(0);return{successNotif:function(I,J){H.addNotif({level:"success",sticky:"false",title:J?J:"Results Analytics",message:I?I:""})},errorNotif:function(I,J){H.addNotif({level:"error",sticky:"false",title:J?J:"Results Analytics",message:I?I:""})}}})();var u=document.createElement("sp-dashboard");var q=document.createElement("sp-serviceurl");var B=document.createElement("sp-webservice");var A;window.widget.body.appendChild(u);window.widget.body.appendChild(q);window.widget.body.appendChild(B);var C=function(){return new f(function(K,J){var I=new Error(i.get("ERROR_NO_LICENSE"));var M="/resources/slmservices/license?appNames="+r;M+="&SecurityContext="+encodeURIComponent(window.widget.getValue(E));var L=function(O){var P=JSON.parse(O.response);if(typeof P[r]!=="undefined"&&P[r].toLowerCase()==="true"){var Q=P.csrf||{};if(typeof Q.name!=="undefined"&&(typeof Q.value!=="undefined"||typeof Q.CSRFToken!=="undefined")){j=Q.CSRFToken||Q.value;n=Q.name}K()}else{J(I)}};var N={Accept:"text/plain"},H={uri:y+M,verb:"GET",headers:N,onComplete:L.bind(this),onError:function(O){I.originalError=O;J(I)}.bind(this)};A.sendRequest(H)}.bind(this))};var w=function(){var H=new Error(i.get("ERROR_PLATFORM_URL"));return new f(function(K,J){var I={serviceName:d,platformId:window.widget.getValue(p),onComplete:function(L){y=(typeof L==="string")?L:L[0].url;if(e.isValidUrl(y)&&y.length>0){K(y)}else{J(H)}}.bind(this),onError:function(L){H.originalError=L;J(H)}.bind(this)};o.getServiceUrl(I)}.bind(this))};var m=function(){if(!A){A=document.createElement("sp-mcsservice")}window.widget.body.appendChild(A)};var v=function(H){H=H||"";return H!==decodeURIComponent(H)};var l=function(H){var I=new Error(i.get("ERROR_PLATFORM_SC"));return new f(function(K,J){require(["DS/WAFData/WAFData"],function(L){var M=window.widget.getValue(p);L.authenticatedRequest(y+"/resources/bps/cspaces?tenant="+M,{type:"json",onComplete:function(P){var N=P&&P.cspaces||[];var O=widget.getPreference(E);O.options=N.map(function(R,Q){if(R.isDefault||Q===0){O.defaultValue=encodeURIComponent(R.name)}return{value:encodeURIComponent(R.name),label:R.displayName}});widget.addPreference(O);widget.setValue("collabspaces",widget.getValue(E));m();K()}.bind(this),onFailure:function(N){I.originalError=N;J(I)}.bind(this)})}.bind(this),function(L){var M=new Error(i.get("ERROR_NO_WAF"));M.originalError(L);I.originalError=M;J(I)})}.bind(this))};var k=function(){return new f(function(K,J){var O=[],M=-1,I=g.getEERList();try{O=I.map(function(P){if(P.secureStation===true){return{label:"{localhost} ("+P.name+")",value:"{localhost}"}}else{return{label:P.name,value:P.name}}},this);var H=window.widget.getValue("stations");if(H.length>0){M=O.findIndex(function(P){return P.value===H})}}catch(L){console.warn("Error retrieving the list of available stations."+I)}function N(P){return P.sort(function(R,Q){if(R.label.indexOf("{localhost}")>-1){return -1}else{return 1}})}N(O);O.push({label:i.get("ANY_STATION"),value:""});window.widget.addPreference({name:"stations",label:i.get("STATION"),type:"list",options:O,defaultValue:M>-1?O[M].label:"",onchange:"preferencesChanged"});K()}.bind(this))};var a=function(){return new f(function(I,H){g.searchForStations().then(k.bind(this)).then(I,H)["catch"](H)}.bind(this))};var z=function(){return new f(function(I,H){require(["DS/SMAAnalyticsLauncher/SMAAnalyticsWidgetEERWrapper"],function(J){g=new J(y);g.findEEDServers().then(function(K){F=K;a.call(this).then(I,function(M){var L=new Error(i.get("ERROR_LOAD_EER"));L.originalError=M;H(L)})}.bind(this),function(L){var K=new Error(i.get("ERROR_LOAD_EED_SERVER"));K.originalError=L;H(K)}.bind(this))}.bind(this),function(K){var J=new Error(i.get("ERROR_LOAD_EED"));J.originalError=K;H(J)})}.bind(this))};var t=function(){return new f(function(I,H){w().then(l.bind(this)).then(C.bind(this)).then(I,H)["catch"](H)}.bind(this))};var x=function(){return new f(function(I,H){t().then(z.bind(this)).then(function(){var J={};J.serverUrl=y;J.csrf={header:n,token:j};I(J)}.bind(this),function(J){H(J)})["catch"](function(J){H(J)})}.bind(this))};var D={notifs:s,loadServerPrereqs:x,refreshStations:a};return D});define("DS/SMAAnalyticsLauncher/SMAAnalyticsServantCache",["UWA/Core","UWA/Utils","UWA/Class","UWA/Class/Promise","UWA/Class/Events","DS/WAFData/WAFData"],function(g,f,c,e,b,a){var d=c.singleton(b,{_SERVANT_PREF_KEY_:"analytics-engine",_servantMap:{},_pingCachedServant:function(h){return new e(function(l,k){var j=this._servantMap[h];if(g.is(j)){var i={method:"GET",cache:-1,headers:{"ra-from-user":j.userId,"X-CSRFToken":j.token},data:{caseID:j.caseId,_t:Date.now()},onComplete:l,onFailure:k,onError:k};a.request(j.uri+"ping",i)}else{k()}}.bind(this))},_refreshServantInCache:function(h,i){return new e(function(k,j){this._pingCachedServant(h).then(function(l){this._servantMap[h].token=l;if(i){window.widget.setValue(this._SERVANT_PREF_KEY_,JSON.stringify(this._servantMap))}k()}.bind(this),function(){this.removeServantFromCache(h,false);if(i===true){window.widget.setValue(this._SERVANT_PREF_KEY_,JSON.stringify(this._servantMap));j()}else{k()}}.bind(this))}.bind(this))},getCachedServantForCase:function(h){return g.is(h,"string")?this._servantMap[h]:undefined},getCachedServants:function(){return this._servantMap||{}},addServantToCache:function(h){if(g.is(h,"object")){if(f.isValidUrl(h.uri)&&g.is(h.caseId,"string")&&g.is(h.token,"string")&&g.is(h.userId,"string")){this._servantMap[h.caseId]={uri:h.uri,caseId:h.caseId,token:h.token,userId:h.userId,eer:h.eer,eerIP:h.eerIP,eedJobId:h.eedJobId,secureStation:h.secureStation};window.widget.setValue(this._SERVANT_PREF_KEY_,JSON.stringify(this._servantMap));window.widget.dispatchEvent("onAddServant",[h])}}},removeServantFromCache:function(i,h){delete this._servantMap[i];if(h!==false){window.widget.setValue(this._SERVANT_PREF_KEY_,JSON.stringify(this._servantMap));window.widget.dispatchEvent("onCloseServant",[i])}},removeAllServantsFromCache:function(){Object.keys(this._servantMap).forEach(function(h){delete this._servantMap[h]},this);window.widget.deleteValue(this._SERVANT_PREF_KEY_);this.dispatchEvent("closeAllServants")},hasLiveServant:function(h){return this._refreshServantInCache(h,true)},refreshAll:function(){return new e(function(j){if(g.is(window.widget)){var h=window.widget.getValue(this._SERVANT_PREF_KEY_);if(g.is(h)&&h.length>0){this._servantMap=JSON.parse(h)}else{j()}}else{j()}if(this._servantMap){var i=[];Object.keys(this._servantMap).forEach(function(k){if(this._servantMap.hasOwnProperty(k)){i.push(this._refreshServantInCache(k))}},this);if(i.length>0){e.all(i).then(function(){window.widget.setValue(this._SERVANT_PREF_KEY_,this._servantMap);j()}.bind(this),function(){window.widget.deleteValue(this._SERVANT_PREF_KEY_);j()}.bind(this))}else{j()}}else{this._servantMap={}}}.bind(this))}});return d});define("DS/SMAAnalyticsLauncher/SMAAnalyticsWidgetEERWrapper",["UWA/Core","UWA/Class","UWA/Utils","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI"],function(f,a,d,c,b){var e=a.extend({_spCos:null,_spCosService:null,_spMcsService:null,_eedServerId:"",_activeUserId:"",_mcsUri:"",_eedRunAs:false,_eerList:[],_eedServerUri:"",_eedPublicKey:"",_plmID:"",_eedServers:[],_getUserPLMId:function(){return new c(function(i,h){this._activeUserId=b.getUser().login;var j={Accept:"application/json"},g={uri:this._mcsUri+"/resources/modeler/pno/person/"+this._activeUserId,verb:"GET",headers:j,onComplete:function(k){var l=JSON.parse(k.response);if(l){i(l.pid)}else{h(null)}},onError:h.bind(this,null)};this._spMcsService.sendRequest(g)}.bind(this))},_getEEDTicket:function(h,i,g){var j=function(k){return new c(function(l){if(typeof k==="undefined"||k===null||k.length===0){this._getUserPLMId().then(l,l)}else{l(k)}}.bind(this))};return new c(function(l,k){j.call(this,h).then(function(m){var n=f.is(i)&&i.length>0?i:this._eedServerId;this._spCosTickets=document.querySelector("sp-costickets");this._spCosTickets.cosTicketUrl=this._mcsUri+"/resources/eepservices/cos/configurations/"+n+"/ticket";this._spCosTickets.getServerTicket(n,m,f.is(g,"boolean")?g:true,function(o,p){p?l(p):k()},k)}.bind(this),k)}.bind(this))},_getEEDRunAsStatus:function(g,h){return new c(function(k,j){this._eedServerUri=this._spCos.getUrlForServer(g);var l={Accept:"text"};if(h&&h.length>0){l.EEDTicket=h}var i={uri:this._eedServerUri+"/admin/runAsEnabled",verb:"GET",headers:l,onComplete:function(m){var p=m.response;var o={};for(var n=0;n<this._eedServers.length;n++){if(g===this._eedServers[n].id){o=this._eedServers[n];break}}o.runAs=p;k(p)}.bind(this),onError:j};this._spCosService.sendRequest(i)}.bind(this))},_getEEDVersion:function(g){var h=this;return new c(function(k,j){var i={onComplete:k,onFailure:j};h._spCos.requestCosVersionForServer(g,i)})},_isRunAsStation:function(h,g){if(g!==true&&g!=="true"){return false}h=h.toUpperCase();if(h.length===0||h==="DEFAULT"||h==="ENABLED"){return true}else{if(h==="DISABLED"||h==="UNSECURED"){return false}else{return false}}},_getActiveEEDStations:function(g,h,i){return new c(function(l){g=g||this._spCos.getDefaultServerId();var m={Accept:"application/json"},k={ActiveOnly:true,AllowedUser:h},j={uri:this._spCos.getUrlForServer(g)+"/admin/station/query",headers:m,data:k,verb:"GET",onComplete:function(n){try{var p=JSON.parse(n.response).StationList;if(!f.is(p)||!f.is(p.Station)){l([])}else{p=p.Station;if(!f.is(p)){l([])}else{if(!Array.isArray(p)){p=[p]}this._parseEERList(g,p,i,l)}}}catch(o){l([])}}.bind(this),onError:l.bind(this,[])};this._spCosService.sendRequest(j)}.bind(this))},_parseEERList:function(i,j,l,h){if(!Array.isArray(j)){h([]);return}var g=[];var k=function(n){if(n&&n["@name"]&&n["@name"].length>0&&n.GeneralInfo&&n.GeneralInfo["@hostIP"]&&n.GeneralInfo["@hostIP"].length>3){if(n["@status"].toLowerCase()!=="running"){return}if(n.GeneralInfo["@allowedUsers"].length>0){if(n.GeneralInfo["@allowedUsers"].indexOf(this._activeUserId)===-1){return}}var m={};m.name=n["@name"];m.hostIp=n.GeneralInfo["@hostIP"];m.hostDNS=n.GeneralInfo["@hostDNS"];m.osName=n.GeneralInfo["@osName"];m.domain=n.GeneralInfo["@domain"];m.drmMode=n.GeneralInfo["@drmMode"];m.runAs=this._isRunAsStation(n.GeneralInfo["@disableRunAs"],l);m.secureStation=false;m.uri="";m.eedServerId=i;g.push(m)}};j.forEach(k,this);h(g)},_getPrivateStation:function(g){return new c(function(i,h){g=g||this._spCos.getDefaultServerId();this._getEEDVersion(g).then(function(k){if(this._spCos.utils.isCosVersionSameOrNewer(k,418,3)){var j={onFailure:i,onComplete:function(m){if(!Array.isArray(m)){i([])}else{var n=m.filter(function(o){return((o.info.cosid===g)&&d.matchUrl(this._mcsUri,o.info.spaceurl)&&(o.info.user===this._activeUserId))},this);var l=n.map(function(o){return{name:o.info.name,hostIp:o.info.ip,hostDNS:"",osName:o.info.os,domain:"",drmMode:"",runAs:false,secureStation:true,uri:o.uri,eedServerId:o.info.cosid}},this);i(l)}}.bind(this)};this._spCos.getPrivateStationInfo(j)}else{i([])}}.bind(this),h)}.bind(this))},_loadEED:function(){return new c(function(h,g){var i=function(j){if(!Array.isArray(j)){g()}this._eedServerId=this._spCos.getDefaultServerId();this._eedServers=j;this._checkCosServers()["finally"](h)};this._spCos.getCosConfiguration({onComplete:i.bind(this),onFailure:g})}.bind(this))},_fetchEERInfo:function(g,h){return new c(function(j,i){var k=[];k.push(this._getActiveEEDStations(g,this._activeUserId,h.runAs));k.push(this._getPrivateStation(g));c.all(k).then(j,i)}.bind(this))},_consolidateEERInfo:function(g){return new c(function(k,j){if(!Array.isArray(g)){j()}var h=g[0],i=Array.isArray(g[1])?g[1]:[];this._eerList=this._eerList.concat(h.concat(i));k(this._eerList)}.bind(this))},getEEDPublicKey:function(g){return new c(function(j,i){if(this._eedPublicKey.length>0){j(this._eedPublicKey)}this._eedServerId=this._eedServerId||this._spCos.getDefaultServerId();this._eedServerUri=this._spCos.getUrlForServer(this._eedServerId);var h={uri:this._eedServerUri+"/execution/pubkey",verb:"GET",headers:{EEDTicket:g,Accept:"application/json"},onComplete:function(k){var l=k.response?k.response:"";l=JSON.parse(l);if(l.KeyRep){j((this._eedPublicKey=l.KeyRep.$?encodeURIComponent(l.KeyRep.$):""))}else{console.warn("Error obtaining EED public key");i()}}.bind(this),onFailure:function(){console.warn("Error obtaining EED public key");i()}};this._spCosService.sendRequest(h)}.bind(this))},_checkCosServers:function(){return new c(function(i){var h=this._eedServers.map(function(k){return k.id});var g=[];var j=function(k){return new c(function(m){var l=this.getEEDTicket();if(l&&l!==null){l.then(function(n){this._getEEDRunAsStatus(k,n).then(m,function(o){for(var p=0;p<this._eedServers.length;p++){if(k===this._eedServers[p].id){this._eedServers.splice(p,1);break}}m()}.bind(this))}.bind(this))}else{m()}}.bind(this))};h.forEach(function(k){g.push(j.call(this,k))},this);c.all(g)["finally"](i)}.bind(this))},searchForStations:function(){return new c(function(i,h){console.log("Initiate station search");var g=[];this._eerList=[];this._eedServers.forEach(function(j){g.push(function(k){return new c(function(m,l){this._fetchEERInfo(k.id,k).then(this._consolidateEERInfo.bind(this)).then(m.bind(this))["catch"](l)}.bind(this))}.call(this,j))},this);c.all(g).then(i.bind(this,this._eerList),h.bind(this))}.bind(this))},getEERList:function(){return this._eerList||[]},getEEDRunAsStatus:function(){return this._eedRunAs},getCurrentUserId:function(){if(f.is(this._activeUserId,"string")){return this._activeUserId}else{return(this._activeUserId=b.getUser().login)}},getCurrentUser:function(){var g=b.getUser();return{userID:g.login,userName:g.firstName+" "+g.lastName}},getEEDServerId:function(){return this._eedServerId},getEEDTicket:function(g){return this._getEEDTicket(g)},setPLMId:function(g){if(f.is(g,"string")){this._plmID=g}else{this._plmID=""}},killEEDJob:function(g,h){return new c(function(k,j){if(!f.is(g,"string")||g.length===0){j()}else{if(!f.is(this._eedServerUri,"string")||this._eedServerUri.length===0){this._eedServerUri=this._spCos.getUrlForServer(this._eedServerId)}var i={uri:this._eedServerUri+"/execution/"+g+"/cancel",verb:"PUT",objectId:h,headers:{Accept:"text/plain",Credentials:""},onComplete:k,onFailure:j,onError:j};this._spCosService.sendRequest(i)}}.bind(this))},setMCSUri:function(g){if(f.is(g,"string")&&g.length>0){this._mcsUri=g}},findEEDServers:function(){return new c(function(h,g){this._loadEED().then(function(){h(this._eedServers)}.bind(this),function(i){g(i)})}.bind(this))},init:function(g){this._activeUserId=b.getUser().login;this._spMcsService=document.querySelector("sp-mcsservice");this._spDashboard=document.querySelector("sp-dashboard");this._spCos=document.querySelector("sp-cos");if(!this._spCos){this._spCos=document.createElement("sp-cos");window.widget.body.appendChild(this._spCos)}this._spCosService=document.querySelector("sp-cosservice");if(!this._spCosService){this._spCosService=document.createElement("sp-cosservice");window.widget.body.appendChild(this._spCosService)}this._spCosTickets=document.querySelector("sp-costickets");if(!this._spCosTickets){this._spCosTickets=document.createElement("sp-costickets");window.widget.body.appendChild(this._spCosTickets)}if(f.is(g,"string")&&g.length>0){this._mcsUri=g}else{this._mcsUri=this._spDashboard.getMcsUri()}}});return e});define("DS/SMAAnalyticsLauncher/SMAAnalyticsWidgetLaunchModule",["UWA/Core","UWA/Utils","UWA/Class","UWA/Class/Events","UWA/Class/Promise","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/Loader","DS/Controls/LineEditor","DS/WAFData/WAFData","DS/UIKIT/Mask","DS/SMAAnalyticsLauncher/SMAAnalyticsWidgetEERWrapper","DS/SMAAnalyticsLauncher/SMAAnalyticsServantCache","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SMAAnalyticsNLS/assets/nls/SMAAnalyticsWidgetNLSfile"],function(h,c,o,k,d,i,l,e,j,r,p,b,s,n,m,f,a,g){var q=o.singleton(k,{_notificationManager:null,_spDashboard:null,_spCos:null,_spCosService:null,_spMcsService:null,_mcsUri:"",_caseId:"",_csrftokn:"",_ADVISE_SERVICE_LOC:"/resources/slmservices/advise/",_eedServerId:"",_eedUri:"",_eedRunAs:false,_eedJobId:"",_eedPublicKey:"",_eerWrapper:null,_eer:null,_eerCred:false,_eerList:[],_localHostIp:"",_eXMLString:"",_launchDialog:null,_launchDialogStationElem:null,_launchLoader:null,_launchInfo:null,_appDataXML:null,_timer_BB:null,_translator:null,_servantMessageTopic:"ResultsServantDowloadingFile",_launchCount:0,_launchLimit:900,_jobRunning:true,_destroyDialog:false,_frameWnd:null,_EXECUTING_LAUNCH_:null,_IS_COLLAB_USER_:false,_getUserInfo:function(){return new d(function(v,u){var t={headers:{Accept:"*/*"},uri:this._mcsUri+this._ADVISE_SERVICE_LOC+"currentUser",verb:"GET",onComplete:function(x){var y=JSON.parse(x.response);if(h.is(y,"object")&&h.is(y.xml)){var w=h.Json.xmlToJson(y.xml);v({userID:y.id||"",userName:h.is(w)&&h.is(w.Person)?w.Person.fullname||"":""})}else{u()}},onError:u};this._spMcsService.sendRequest(t)}.bind(this))},_cancelServantLaunch:function(){this._updateLaunchDialogText("STOP_LAUNCH");if(typeof this._EXECUTING_LAUNCH_!=="undefined"&&this._EXECUTING_LAUNCH_!==null){this._EXECUTING_LAUNCH_=null}var u=function(){window.clearInterval(this._timer_BB);this._launchLoader.off();this._launchDialog.destroy();this._launchDialog=undefined;if(s.isMasked(window.widget.body)){s.unmask(window.widget.body)}this.dispatchEvent("onInterrupt")};var t=m.getCachedServantForCase(this._caseId);if(h.is(t)){this.stopServant(t)["finally"](u.bind(this))}else{this._eerWrapper.killEEDJob(this._eedJobId,this._caseId)["finally"](u.bind(this))}},_createLaunchSpinner:function(){var t=new h.Element("div",{id:"launch-dialog-content","class":"wux-control-inline-container",style:{"vertical-align":"top"}});this._launchLoader=new r({text:"Loading...",showButtonFlag:false}).inject(t);this._launchLoader.on();return t},_getCollabSpace:function(){var t=window.widget.getPreference("collabspaces");return h.is(t,"string")?t:window.widget.getPreference("collabspaces").defaultValue},_updateLaunchDialogText:function(u,t){if(typeof u!=="undefined"&&u!==null&&u.length>0){if(h.is(t,"boolean")&&t===false){this._launchLoader.text=u}else{this._launchLoader.text=this._translator.translate(u)}}},_getEERNameForDialog:function(){if(h.is(this._eer)&&h.is(this._eer.name,"string")){return this._eer.name}else{var t=m.getCachedServantForCase(this._caseId);if(h.is(t)){return t.eer}else{return window.widget.getValue("stations")||""}}},_updateStationNameInDialog:function(u){if(!h.is(this._launchDialogStationElem)){return}if(!h.is(u,"string")){u=""}var t="";if(u.length>0){t=" "+this._translator.translate("STATION")+": "+u}this._launchDialogStationElem.querySelector(".ra-widget-station-name").innerText=t},_setEERNameForDialog:function(u){try{if(!h.is(u,"string")||u.length===0){return null}var t=" "+this._translator.translate("STATION")+": "+u;this._launchDialogStationElem=h.createElement("span",{"class":"fonticon fonticon-monitor ra-widget-station",html:h.createElement("span",{"class":"ra-widget-station-name",text:t}).outerHTML});this._launchDialogStationElem.inject(this._launchDialog.getContent().querySelector(".wux-controls-loader-label"),"after");return this._launchDialogStationElem}catch(v){}},_createLauncherDialog:function(v,w){if(!h.is(v)){return}var u=document.querySelector(".wux-windows-dialog.wux-ui-is-rendered");if(h.is(u)&&u!==null){this._launchDialog=u}else{var x={title:h.is(w)?g.get(w):g.get("RA_LAUNCH"),content:this._createLaunchSpinner(),immersiveFrame:v.getImmersiveFrame(),id:"ra-launch-progress-dlg",visibleFlag:true,modalFlag:true,buttons:{Cancel:new l({onClick:function(){this._cancelServantLaunch()}.bind(this)})}};this._launchDialog=new i(x);this._launchDialog.addEventListener("close",this._cancelServantLaunch.bind(this));var y=this._launchDialog.getContent();y.classList.add("ra-launch-dialog");var t=this._getEERNameForDialog()||"";if(t.length>0){this._setEERNameForDialog(t)}this._updateLaunchDialogText("INIT_LA")}},_htmlUnescape:function(t){return String(t).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},_getLaunchInfo:function(t){return new d(function(w,v){this._updateLaunchDialogText("GET_LA");var x={Accept:"*/*"},u={uri:this._mcsUri+this._ADVISE_SERVICE_LOC+"getAnalyticsLaunchInfo?caseID="+t+"&mcsURI="+encodeURIComponent(this._mcsUri),verb:"GET",headers:x,onComplete:function(y){var z=JSON.parse(y.response);if(z){this._appDataXML=unescape(encodeURIComponent(this._htmlUnescape(z.encodedJobXML)));this._localHostIp=z.localIP;this._launchInfo=z;this._updateLaunchDialogText("GET_PUBKEY");w()}else{v()}}.bind(this),onError:v};this._spMcsService.sendRequest(u)}.bind(this))},_getEERAffinity:function(){if(h.is(this._eer)){if(this._eer.secureStation===true||this._eer.secureStation==="true"){var t=c.loadXml(this._appDataXML),u=t.getElementsByTagName("Application")[0].appendChild(t.createElement("HasLocalHost"));u.appendChild(t.createTextNode("true"));this._appDataXML=c.xmlToString(t);return"{localhost}"}else{return this._eer.name}}},_addOptimizationTechniquesInExml:function(){return('<Plugin name="OPTIMIZATION_TECH_ASA" type="com.dassault_systemes.sma.plugin.optimization.Asa" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c520" /><Plugin name="OPTIMIZATION_TECH_DHS" type="com.dassault_systemes.sma.plugin.optimization.DownhillSimplex" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c521" /><Plugin name="OPTIMIZATION_TECH_EVOL" type="com.dassault_systemes.sma.plugin.optimization.Evol" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c522" /><Plugin name="OPTIMIZATION_TECH_HOOKEJEEVES" type="com.dassault_systemes.sma.plugin.optimization.HookeJeeves" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c523" /><Plugin name="OPTIMIZATION_TECH_MIGA" type="com.dassault_systemes.sma.plugin.optimization.Miga" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c524" /><Plugin name="OPTIMIZATION_TECH_MOPS" type="com.dassault_systemes.sma.plugin.optimization.Mops" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c525" /><Plugin name="OPTIMIZATION_TECH_NLPQL" type="com.dassault_systemes.sma.plugin.optimization.Nlpql" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c526" />')},_createAdviseEXML:function(){if(h.is(this._eXMLString,"string")&&this._eXMLString.length>0){return this._eXMLString}var v=h.createElement("a");v.href=this._mcsUri;var t='<?xml version="1.0" encoding="UTF-8"?><fiper_Model rootComponentId="812da46e-811e-11e2-ae82-e9ce6b18c519" version="6.419.0"><Properties modelName="AdviseServant" modelId="6a53ba4c-811e-11e2-ae82-e9ce6b18c519" modelVersion="6.419.0"/><Component name="AdviseServant" id="812da46e-811e-11e2-ae82-e9ce6b18c519" type="com.dassault_systemes.smacomponent.adviseservant" ><Variable name="host" dispName="host" type="com.engineous.datatype.String" id="bb27e8af-811e-11e2-ae82-e9ce6b18c519" role="Parameter" structure="Scalar" mode="Input" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Value><![CDATA['+v.protocol+"//"+v.hostname+(v.port?":"+v.port:"")+']]></Value></Variable><Variable name="dashboardhost" dispName="dashboardhost" type="com.engineous.datatype.String" id="bg27e8af-811e-11e2-ae82-e9ce6b18c519" role="Parameter" structure="Scalar" mode="Input" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Value><![CDATA['+window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+']]></Value></Variable><Variable name="token" dispName="token" type="com.engineous.datatype.String" id="bc27e8af-811e-11e2-ae82-e9ce6b18c519" role="Parameter" structure="Scalar" mode="Input" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Value><![CDATA['+this._csrftokn+']]></Value></Variable><Variable name="caseId" dispName="caseId" type="com.engineous.datatype.String" id="be27e8af-811e-11e2-ae82-e9ce6b18c519" role="Parameter" structure="Scalar" mode="Input" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Value><![CDATA['+this._caseId+']]></Value></Variable><Variable name="serverUrl" dispName="serverUrl" type="com.engineous.datatype.String" id="bf27e8af-811e-11e2-ae82-e9ce6b18c519" role="Parameter" structure="Scalar" mode="Input" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Value><![CDATA['+this._mcsUri+"]]></Value></Variable>";var w=this._getEERAffinity();if(h.is(w,"string")&&w.length>0){t+='<Variable name="affinities" id="812da46e-811e-11e2-ae82-e9ce6b18c519:affinities" role="Property" structure="Aggregate" mode="Local" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Variable name="Host" dispName="serverUrl" type="com.engineous.datatype.String" id="812da46e-811e-11e2-ae82-e9ce6b18c519:Host" role="Property" typeWrittenVersion="2.0.0" structure="Scalar" mode="Local" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519:affinities" ><Value><![CDATA['+w+"]]></Value></Variable></Variable>"}var u=widget.getInt("timeout");if(h.is(u,"number")&&u!=30){t+='<Variable name="_SERVANT_TIMEOUT_" dispName="_SERVANT_TIMEOUT_" type="com.engineous.datatype.Integer" id="by27e8af-811e-11e2-ae82-e9ce6b18c519" role="Parameter" structure="Scalar" mode="Input" saveToDB="true" parentId="812da46e-811e-11e2-ae82-e9ce6b18c519" ><Value><![CDATA['+u+"]]></Value></Variable>"}t+=this._addOptimizationTechniquesInExml()+'</Component><Component name="Task1" id="6a5a22ed-811e-11e2-ae82-e9ce6b18c519" type="com.dassault_systemes.sma.adapter.Task" ></Component>';t+="</fiper_Model>";v.destroy();return t},_getEERForLaunch:function(t){this._updateLaunchDialogText("GET_EER");return new d(function(y,x){var v=widget.getValue("stations"),u={},w=function(z){return z.filter(function(A){return(A.secureStation===true||A.secureStation==="true")},this)[0]};this._eerWrapper.searchForStations()["finally"](function(){var z=this._eerWrapper.getEERList();if(!Array.isArray(z)||z.length===0){console.warn("Unable to retrieve any active stations.");x()}if(h.is(v,"string")&&v.length>0){u=z.filter(function(A){return v===A.name},this)[0]}if(!h.is(u)||!h.is(u.name,"string")||u.name.length===0){u=w(z)}if(!h.is(u)||!h.is(u.name,"string")||u.name.length===0){u=z.filter(function(A){return this._localHostIp===A.hostIp},this)[0]}if(!h.is(u)||!h.is(u.name,"string")||u.name.length===0){u=z[0]}this._eedServerId=u.eedServerId;this._eedUri=this._spCos.getUrlForServer(this._eedServerId);this._eedRunAs=u.runAs;this._eer=u;this._eerList=z;this._updateStationNameInDialog(u.name);y(u)}.bind(this))}.bind(this))},_createRunAsForm:function(z,Y,P){var D=this._eerList.filter(function(Z){return Z.runAs===true},this),w=this._eerList.filter(function(Z){return D.indexOf(Z)===-1},this),L=D.map(function(Z){return{labelItem:Z.name,valueItem:Z}},this),B=w.map(function(Z){return{labelItem:Z.name,valueItem:Z}},this);var G=function(Z){return((Z.osName||"").toLowerCase().indexOf("windows")>-1)};var Q=new h.Element("div",{id:"run-as-container","class":"wux-control-inline-container"}),U=new h.Element("div",{id:"run-as-form","class":"wux-control-inline-container"}),F=document.querySelector("#launch-dialog-content");var y="width:300px",M="margin:0px;padding:0px",S="float:left;text-align:right;width:100px;margin:7px;padding:0px;",X="display:inline-block;text-align:left;width:150px;margin:5px;padding:0px;",W="display:inline-block;text-align:left;width:160px;margin:5px;padding:0px;",J="position:relative;left:110px;width: 150px;margin:5px";var O=function(aa){var Z=aa.dsModel;if(Z.checkFlag===true){R.elementsList=L;U.style.display="block"}else{R.elementsList=B;U.style.display="none"}};var E=function(Z){z=Z.dsModel.currentValue;if(z.runAs===false){U.style.display="none"}else{V.getContent().querySelector("input").style.border="1px solid #b4b6ba";I.getContent().querySelector("input").style.border="1px solid #b4b6ba";U.style.display="block";if(G(z)===true){V.placeholder="Windows User Id";I.placeholder="Windows Password"}else{V.placeholder="Linux User Id";I.placeholder="Linux Password"}}};var x=function(Z){Z.dsModel.getContent().querySelector("input").style.border="1px solid #b4b6ba"};var K=function(){var Z=function(){F.style.display="block";v.destroy();Q.destroy()};if(z.runAs===false){Z();if(typeof Y==="function"){Y(z,false)}}else{if(V.value.length>0&&I.value.length>0){var ae="",ac="",ad="",ab="";if(G(z)===true){ae=V.value||"";ac=I.value||""}else{ad=V.value||"";ab=I.value||""}var aa={domainName:N.value.length>0?N.value:"",windowsUser:ae,windowsPass:ac,linuxUser:ad,linuxPass:ab};Z();if(typeof Y==="function"){Y(z,aa)}}else{if(V.value.length===0){V.getContent().querySelector("input").style.border="1px solid red"}if(I.value.length===0){I.getContent().querySelector("input").style.border="1px solid red"}}}};var A=new e({label:this._translator.translate("RUN_AS_ONLY"),disabled:B.length===0,checkFlag:true});A.addEventListener("buttonclick",O.bind(this));var u=h.createElement("label",{"class":"wux-layouts-treeview-label",html:"Station Name"});var R=new j({elementsList:L,enableSearchFlag:false,actionOnClick:true,currentValue:z.runAs===true?z.name:L[0].labelItem});R.addEventListener("change",E.bind(this));var H=h.createElement("label",{"class":"wux-layouts-treeview-label",html:"Domain"}),T=h.createElement("label",{"class":"wux-layouts-treeview-label",html:"User Id"}),C=h.createElement("label",{"class":"wux-layouts-treeview-label",html:"Password"}),N=new p({placeholder:"Domain Name"}),V=new p({requiredFlag:true,placeholder:(G(z)===true?"Windows User Id":"Linux User Id")}),I=new p({requiredFlag:true,placeholder:(G(z)===true?"Windows Password":"Linux Password"),displayStyle:"password"}),v=new l({emphasize:"primary",label:"Ok",onClick:K.bind(this)});V.addEventListener("change",x);I.addEventListener("change",x);Q.style.cssText=y;U.style.cssText=M;A.elements.container.style.cssText=J;u.style.cssText=S;R.elements.container.style.cssText=W;H.style.cssText=S;T.style.cssText=S;C.style.cssText=S;N.elements.container.style.cssText=X;V.elements.container.style.cssText=X;I.elements.container.style.cssText=X;A.inject(Q);u.inject(Q);R.inject(Q);U.inject(Q);H.inject(U);N.inject(U);T.inject(U);V.inject(U);C.inject(U);I.inject(U);v.getContent().inject(this._launchDialog.getContent().querySelector(".wux-windows-dialog-buttons"),"top");F.style.display="none";var t=this._launchDialog.content.parentNode;if(typeof t.insertAdjacentElement==="function"){this._launchDialog.content.parentNode.insertAdjacentElement("afterbegin",Q)}else{t.insertBefore(Q,t.firstChild)}},_getEERCredentials:function(t){return new d(function(v,u){if(t.secureStation===true){v((this._eerCred=false));return}if(t.runAs===false){v((this._eerCred=false));return}this._updateLaunchDialogText("GET_EER_CRED");this._createRunAsForm(t,function(w,x){this._eer=w;this._eedServerId=w.eedServerId;this._eedUri=this._spCos.getUrlForServer(this._eedServerId);this._eedRunAs=w.runAs;this._eerCred=x;v()}.bind(this),u.bind(this))}.bind(this))},_claimEEDJob:function(t){return new d(function(v,u){if(!h.is(t,"string")||t.length===0){this._updateLaunchDialogText("JOB_FAIL");u()}this._eedJobId=t;if(this._eer.secureStation!==true&&this._eer.secureStation!=="true"){v(t);return}this._updateLaunchDialogText("NOTIFY_SEC_STN");var w=new XMLHttpRequest();w.open("GET",this._eer.uri+"/station/claim?jobids="+t);w.onload=function(){if(w.readyState===4&&w.status===200){v(t)}else{this._updateLaunchDialogText("SEC_STN_FAIL");u()}}.bind(this);w.send()}.bind(this))},_bbMonitorFailure:function(u,t,v){console.warn(u);window.clearInterval(t.monitorTimer);if(h.is(v,"string")){this._updateLaunchDialogText(v)}t.onFailure(u)},_bbMonitorSuccess:function(w,v){var x=JSON.parse(w.response),u="";try{u=x.MonitoringMessages.MessageList.Message.$}catch(y){u=""}if(u.length>4){if(this._servantMessageTopic==="ResultsServantDowloadingFile"){this._updateLaunchDialogText("DWLD_DATA");this._servantMessageTopic="ResultsServantURL";this._launchCount=0;this._launchLimit=900;this._jobRunning=true}else{window.clearInterval(v.monitorTimer);if(c.isValidUrl(u)){v.onComplete(u)}else{var A=this._launchInfo.proxyServer;if(h.is(u,"string")&&c.isValidUrl(A)){if(A.substr(A.length-1)!=="/"){A+="/"}v.onComplete(this._launchInfo.proxyServer+u)}}}}else{var z=x.MonitoringMessages,t=z["@status"];if(t.toLowerCase()==="running"&&this._jobRunning===false){this._updateLaunchDialogText("WAIT_FOR_SERVANT");this._launchCount=0;this._jobRunning=true}else{if(t.toLowerCase()==="done"){this._bbMonitorFailure(null,v)}}}},_errMonitorSuccess:function(v,u){var y="";try{var w=JSON.parse(v.response);y=w.MonitoringMessages.MessageList.Message.$}catch(x){return}if(h.is(y,"string")){var z=y[y.length-1].textContent,t=JSON.parse(z);if(h.is(t)){switch(t.operation){case"PLMBATCH":var z=this._translator("LAUNCH_PLMBATCH_EXEC")+t.current+"/"+t.max;this._updateLaunchDialogText(z,false);u.onComplete(z);break;default:this._updateLaunchDialogText(z);window.clearInterval(u.monitorTimer);throw z}}}},_errMonitorFailure:function(u,t){t.onFailure(u)},_monitorForError:function(t,x,w,v){var u={monitorTimer:x,onComplete:w,onFailure:v};this._spCosService.sendRequest({uri:this._eedUri+"/job/"+t+"/monitor?Topic=ResultsServantError&TimeStamp=0",verb:"GET",objectId:this._caseId,onComplete:function(y){this._errMonitorSuccess(y,u)}.bind(this),onFailure:function(y){this._errMonitorFailure(y,u)}.bind(this)})},_monitorBulletinBoard:function(t,x,w,v){var u={monitorTimer:x,onComplete:w,onFailure:v};this._launchCount++;if(this._launchCount>this._launchLimit){if(confirm(this._translator.translate("XTND_LAUNCH"))){this._launchCount=0;this._launchLimit=150}else{this._bbMonitorFailure("SERVANT_TIMEOUT",u)}}this._spCosService.sendRequest({uri:this._eedUri+"/job/"+t+"/monitor?Topic="+this._servantMessageTopic+"&TimeStamp=0",verb:"GET",objectId:this._caseId,onComplete:function(y){this._bbMonitorSuccess(y,u)}.bind(this),onFailure:function(y){this._bbMonitorFailure(y,u)}.bind(this)})},_waitForServantURI:function(t){this._timer_BB=setInterval(function(){this._monitorBulletinBoard(t.jobId,this._timer_BB,t.onComplete,t.onFailure);this._monitorForError(t.jobId,this._timer_BB,t.onComplete,t.onFailure)}.bind(this),2000)},_storeServantData:function(v,t){if(v.substr(v.length-1)!=="/"){v+="/"}var u={uri:v,caseId:this._caseId,token:this._csrftokn,eer:h.is(this._eer)?this._eer.name:t,userId:this._eerWrapper.getCurrentUserId(),eerIP:h.is(this._eer)?this._eer.hostIp:"",eedJobId:this._eedJobId,secureStation:h.is(this._eer)?this._eer.secureStation:false};m.addServantToCache(u);return u},_createEEDJobForServant:function(){return new d(function(u,t){this._eerWrapper.getEEDTicket(this._caseId,undefined,true).then(function(y){this._csrftokn=y;this._updateLaunchDialogText("CREATE_RA_JOB");var v=this._getCollabSpace();if(this.isEncoded(v)){v=decodeURIComponent(v)}var w=this._createAdviseEXML();var x=new SPRun();x.simOID=this._caseId;x.timeout=20000;x.runURL=this._eedUri+"/execution/run";x.cosPubkeyURL=this._eedUri+"/execution/pubkey";x.encryptURL=this._mcsUri+"/resources/slmservices/data/getEncryptedCreds?SecurityContext="+v;x.mcsTicketURL=this._mcsUri+"/ticket/get?SecurityContext="+v;x.addEventListener("success",function(z){this._updateLaunchDialogText("JOB_SUCC");u(z.detail.result.EEDJobID)}.bind(this));x.addEventListener("error",function(z){this._updateLaunchDialogText("JOB_FAIL");t(z)}.bind(this));if(this._eer.secureStation===true||this._eer.secureStation==="true"){x.runInfo="<RunInfo logLevel='Debug' submissionHost='"+this._eer.name+"'></RunInfo>";x.runEXML({},w,this._caseId,y,false,this._appDataXML,true,this._eedServerId)}else{x.runInfo="<RunInfo logLevel='Debug' submissionHost=''></RunInfo>";if(!h.is(this._eerCred)){this._eerCred=false}x.runEXML({},w,this._caseId,y,this._eerCred,this._appDataXML,false,this._eedServerId)}}.bind(this),t)}.bind(this))},isEncoded:function(t){t=t||"";return t!==decodeURIComponent(t)},_launchNewAdviseServant:function(t){return new d(function(w,v){console.group("Launch Analytics Servant...");this._createLauncherDialog(this._frameWnd);this._caseId=t;this._eerWrapper.setPLMId(t);var u=function(y){console.info("Analytics Servant Launch Failed..",[y]);console.groupEnd();this._updateLaunchDialogText("SERVANT_ERR");v(y)};var x=function(y){if(!h.Utils.isValidUrl(y)){console.warn("Analytics Servant Launch Complete. Invalid servant url was received..",[y]);u.call(this,"Invalid servant url was received: "+y);return}console.info("Analytics Servant Launch Complete..",[y]);console.groupEnd();this._updateLaunchDialogText("READING_DATA");if(this._destroyDialog===true){this._launchDialog.destroy();this._launchDialog=undefined;this._launchDialogStationElem=undefined}if(y.substr(y.length-1)!=="/"){y+="/"}w(this._storeServantData(y))};this._getLaunchInfo(t).then(this._getEERForLaunch.bind(this)).then(this._getEERCredentials.bind(this)).then(this._eerWrapper.getEEDTicket.bind(this._eerWrapper,t,this._eedServerId)).then(this._eerWrapper.getEEDPublicKey.bind(this._eerWrapper)).then(this._createEEDJobForServant.bind(this)).then(this._claimEEDJob.bind(this)).then(function(y){this._updateLaunchDialogText("CREATE_RA_JOB");this._waitForServantURI({jobId:y,onComplete:x.bind(this),onFailure:u.bind(this)})}.bind(this))["catch"](u.bind(this))}.bind(this))},_getExistingServant:function(t){return new d(function(v,u){m.hasLiveServant.call(m,t).then(function(){var w=m.getCachedServantForCase(t);if(this._destroyDialog===true){this._launchDialog.destroy();this._launchDialog=undefined}v(JSON.stringify(w))}.bind(this),u.bind(this))}.bind(this))},_collaborationHandShake:function(u,t){return new d(function(w,v){if(!h.is(u)){v();return}this.executeServantCommand(this._caseId,"handshake","collaboration","GET",{userInfo:t},{no_mask:true,servant:u}).then(w,function(x){v(x[1])})}.bind(this))},getServant:function(u,v,t){if(h.is(u,"string")){this._caseId=u}if(h.is(v,"boolean")){this._destroyDialog=v}if(h.is(t,"string")&&t.length>0){this._eXMLString=t}if(!s.isMasked(widget.body)){s.mask(widget.body)}this._IS_COLLAB_USER_=false;if(!h.is(this._EXECUTING_LAUNCH_)){this._EXECUTING_LAUNCH_=new d(function(y,x){var z=function(A){y(A);this._EXECUTING_LAUNCH_=undefined;setTimeout(function(){if(h.is(this._launchDialog)&&this._launchDialog!==null){this._launchDialog.destroy();this._launchDialog=undefined}s.unmask(widget.body)}.bind(this),3000)};var w=function(A){x(A);this._EXECUTING_LAUNCH_=undefined;s.unmask(widget.body)};this.addEvent("onInterrupt",x,{},0);if(this._eXMLString.length>0){this._launchNewAdviseServant(u).then(z.bind(this),w.bind(this))}else{this._getExistingServant(u).then(z.bind(this),function(){this._launchNewAdviseServant(u).then(z.bind(this),w.bind(this))}.bind(this))}}.bind(this))}return this._EXECUTING_LAUNCH_},stopServant:function(t){if(!h.is(t)){throw {message:"Unable to stop the servant due to invalid / empty servant data.",data:t}}return new d(function(w,v){var x=function(){m.removeServantFromCache(t.caseId);w(t.caseId)};var u=function(y){console.warn("Unable to stop the Results Analytics servant.",[y]);m.removeServantFromCache(t.caseId);v()};b.request(t.uri+"stop?t="+Date.now(),{method:"POST",cache:-1,headers:{"X-CSRFToken":t.token,"ra-from-user":t.userId},onComplete:x.bind(this),onFailure:u.bind(this)})}.bind(this))},_showErrorNotification:function(v,t){var u={level:"error",sticky:false};u.title=h.is(v,"string")?v:"";u.message=h.is(t,"string")?t:this._translator.translate("RA_ERROR");this._notificationManager.addNotif(u)},_showSuccessNotification:function(v,t){var u={level:"success",sticky:false};u.title=h.is(v,"string")?v:"";u.message=h.is(t,"string")?t:"";this._notificationManager.addNotif(u)},shutDownMultipleLaunchedCase:function(t){return new d(function(v,u){this.getLaunchDialog({message:this._translator.translate("EXIT_CONFIRM_MULTIPLE")+" "+this._translator.translate("EXIT_CONFIRM_TAIL"),station:"",translate:false,buttons:{Ok:{emphasize:"primary",label:this._translator.translate("CLOSE"),onClick:function(x){this.destroyLaunchDialog();var w=[];t.forEach(function(y){var z=m.getCachedServantForCase(y);if(h.is(z)){w.push(this.stopServant.call(this,z))}}.bind(this));d.all(w).then(function(y){v(y)}.bind(this))}.bind(this)},Cancel:{label:this._translator.translate("Cancel"),onClick:function(w){this.destroyLaunchDialog();u()}.bind(this)}}})}.bind(this))},shutDownLaunchedCase:function(t){return new d(function(z,y){var w=m.getCachedServantForCase(t);if(!h.is(w)){this._showErrorNotification("",this._translator.translate("INVALID_SERVANT")+" "+this._translator.translate("CASE_CLOSE_ERROR"));y()}var u=w.eer||"",x=widget._frameWnd.getUIFrame();var v=function(){if(s.isMasked(x)){s.unmask(x)}this.destroyLaunchDialog();this._showErrorNotification("",this._translator.translate("CASE_CLOSE_ERROR",u));y()};if(!s.isMasked(x)){s.mask(x)}this.getLaunchDialog({message:this._translator.translate("EXIT_CONFIRM")+" "+this._translator.translate("EXIT_CONFIRM_TAIL"),station:u,translate:false,buttons:{Ok:{emphasize:"primary",label:this._translator.translate("CLOSE"),onClick:function(A){this.stopServant(w).then(function(){if(s.isMasked(x)){s.unmask(x)}this.destroyLaunchDialog();this._showSuccessNotification("",this._translator.translate("CLOSE_SUCCESS",u));z()}.bind(this),v.bind(this))["catch"](v.bind(this))}.bind(this)},Cancel:{label:this._translator.translate("Cancel"),onClick:function(A){this.destroyLaunchDialog();if(s.isMasked(x)){s.unmask(x)}y()}.bind(this)}}},true)}.bind(this))},executeServantCommand:function(t,w,u,y,x,v){return new d(function(E,D){v=h.is(v)?v:{};if(!v.no_mask&&!s.isMasked(widget.body)){s.mask(widget._frameWnd.getUIFrame())}var B=function(H,G){console.warn("Unable to execute servant request.",[H,G]);if(!v.no_mask&&s.isMasked(widget._frameWnd.getUIFrame())){s.unmask(widget._frameWnd.getUIFrame())}D([H,G])};try{var C=m.getCachedServantForCase(t)||v.servant;if(!h.is(C)){B("Servant details were not found.")}if(!h.is("commandName","string")||w.length===0){B("No usable command name was found.")}if(!h.is(y,"string")||y.length===0){y="GET";if(w.toLowerCase().startsWith("set")){y="POST"}}if(!h.is(v.headers)){v.headers={}}if(y==="POST"||y==="PUT"){v.headers["X-CSRFToken"]=C.token}v.headers["ra-from-user"]=C.userId;if(!h.is(v.timeout,"number")){v.timeout=120000}var A=C.uri+"executeCommand?";if(h.is(u,"string")&&u.length>0){A+="commandGroup="+u+"&"}A+="commandName="+w;var z={method:y,cache:-1,headers:v.headers,timeout:v.timeout,onComplete:function(G){if(!v.no_mask&&s.isMasked(widget._frameWnd.getUIFrame())){s.unmask(widget._frameWnd.getUIFrame())}E(G)},onFailure:B.bind(this),onError:B.bind(this)};if(h.is(x)){z.data=x}b.request(A,z)}catch(F){B(F)}}.bind(this))},saveCaseInServant:function(t,u){return new d(function(y,x){var z={};if(h.is(u,"object")){z={};for(var v in u){if(u.hasOwnProperty(v)){z[v]=u[v]}}}var w={timeout:300000,no_mask:true};this.executeServantCommand(t,"storeAdviseCase","","POST",Object.keys(z).length>0?z:undefined,w).then(y.bind(this),x.bind(this))}.bind(this))},_updateLaunchDialogContent:function(t){if(h.is(t.content,"object")){this._launchDialog.content=t.content}if(h.is(t.buttons,"object")){var v={};for(var u in t.buttons){if(t.buttons.hasOwnProperty(u)){v[u]=new l(t.buttons[u])}}if(Object.keys(v).length>0){this._launchDialog.buttons=v}}},getLaunchDialog:function(w,t){if(!h.is(this._frameWnd)){return null}try{var v=this._launchDialog.getContent();if(!h.is(v)){throw {}}}catch(u){this._createLauncherDialog(this._frameWnd,"RA_CLOSE")}if(h.is(w,"object")){this._updateLaunchDialogContent(w);this._updateLaunchDialogText(w.message,w.translate);if(h.is(w.station,"string")){this._updateStationNameInDialog(w.station)}}this._launchLoader.on();if(h.is(t,"boolean")&&t===true){}else{}return this._launchDialog.getContent()},joinExistingSession:function(t,w,v,u,x){return new d(function(A,z){console.group("Joining Existing Analytics Session...");var y=function(C){console.info("Error joining Analytics session..",[C]);console.groupEnd();if(h.is(C,"string")&&C.toLowerCase().indexOf("has an active session")>0){this._updateLaunchDialogText("JOIN_DUP_SESS_ERR")}else{this._updateLaunchDialogText("JOINSESS_ERR")}z(C)};var B=function(C){if(!h.Utils.isValidUrl(C)){console.warn("Unable to join Analytics session. Invalid session servant url received.",[C]);y.call(this,"Invalid servant url was received: "+C);return}console.info("Joining Analytics session complete..",[C]);console.groupEnd();this._updateLaunchDialogText("READING_DATA");if(C.substr(C.length-1)!=="/"){C+="/"}var D=this._storeServantData(C,u);this._updateLaunchDialogText("VERIFY_USER");this._getUserInfo().then(function(E){this._collaborationHandShake(D,JSON.stringify(E)).then(function(F){this._IS_COLLAB_USER_=true;D.userList=JSON.parse(F);D.collaborationUser=E;this._launchDialog.destroy();this._launchDialog=undefined;A(D)}.bind(this),function(F){y.call(this,F)}.bind(this))}.bind(this),z)};this._createLauncherDialog(this._frameWnd);this._updateLaunchDialogText("JOIN_SESSION");this._caseId=t;this._csrftokn=x;this._eerWrapper.setPLMId(t);this._eedServerId=w;this._eedJobId=v;this._eedUri=this._spCos.getUrlForServer(this._eedServerId);this._getLaunchInfo(t).then(this._eerWrapper.getEEDPublicKey.bind(this._eerWrapper)).then(function(){this._updateLaunchDialogText("RETRIEVE_SESS");this._servantMessageTopic="ResultsServantURL";this._waitForServantURI({jobId:v,onComplete:B.bind(this),onFailure:y.bind(this)})}.bind(this))["catch"](y.bind(this))}.bind(this))},destroyLaunchDialog:function(){this._launchDialog.destroy();this._launchDialog=null},getCurrentUserId:function(){return this._eerWrapper.getCurrentUserId()},getEEDServerId:function(){return this._eedServerId||this._eerWrapper.getEEDServerId()},setFrameWindow:function(t){this._frameWnd=t},isCollaborationUser:function(){return this._IS_COLLAB_USER_},setMCSUri:function(t){if(h.is(t,"string")&&t.length>0){this._mcsUri=t}},loadEED:function(){this._eedLoaded=new d(function(u,t){this._eerWrapper=new n(this._mcsUri);this._eerWrapper.findEEDServers().then(u,t)}.bind(this));return this._eedLoaded},init:function(){this._spCos=document.querySelector("sp-cos");this._spDashboard=document.querySelector("sp-dashboard");this._spWebService=document.querySelector("sp-webservice");this._spMcsService=document.querySelector("sp-mcsservice");this._spCosService=document.querySelector("sp-cosservice");if(!this._translator){this._translator=widget._ra_translator}this._notificationManager=f;a.setNotificationManager(this._notificationManager);a.setFadeOutPolicy(0)}});return q});