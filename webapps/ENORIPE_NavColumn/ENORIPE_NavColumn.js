/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/ENORIPE_NavColumn/NavWSProxy",["UWA/Core","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","UWA/Promise","DS/ENORIPE_Relations/RelationsTabSettings"],function(e,g,c,f,a){var h=function(j){return typeof j==="string"?JSON.parse(j):j};var d=function(k,j,m){var l=null;l=g.authenticatedRequest(k,j);return l};var i=function(k,j,l){return new f(function(n,m){j.onComplete=function(q){var p=h(q);var o=p;if(l){o=l(p)}n(o)};j.onFailure=function(o){m(o)};if(j.data){j.data=JSON.stringify(j.data)}d(k,j,false)})};var b={getrelationprofiles:function(l,j){var k=c.get3DSpaceUrl(),m={};k=k+"/resources/enorelnav/navigate/getProfiles?tenant="+c.getPlatformId();m.method="POST";m.headers={Accept:"application/json","Content-Type":"application/json"};m.data={widgetId:c.getWidgetId(),roles:l,profileVersion:2};return i(k,m,false)},setpreferences:function(k){var l=c.get3DSpaceUrl(),m={};l=l+"/resources/enorelnav/navigate/setpreferences?tenant="+c.getPlatformId();m.method="POST";m.headers={Accept:"application/json","Content-Type":"application/json"};var j=[];j=j.concat(a.getOption("displayNameAttributes"));j=j.concat(a.getOption("detailAttributesLevel1"));j=j.concat(a.getOption("detailAttributesLevel2"));m.data={widgetId:c.getWidgetId(),relations:k,attributes_for_detailview:j,countmanagement:true};return i(l,m)},getDetail:function(m){var j=c.get3DSpaceUrl(),l={};j=j+"/resources/enorelnav/navigate/getecosystem?tenant="+c.getPlatformId();l.method="POST";l.headers={Accept:"application/json","Content-Type":"application/json"};var k=c.getWidgetId();l.data={widgetId:k,ids:m,debug:false};return i(j,l)},getRelationCount:function(l){var j=c.get3DSpaceUrl(),m={};j=j+"/resources/enorelnav/navigate/getrelationcount?tenant="+c.getPlatformId();m.method="POST";m.headers={Accept:"application/json","Content-Type":"application/json"};var k=c.getWidgetId();m.data={widgetId:k,ids:l.ids,relations:l.relations};return i(j,m)}};return b});define("DS/ENORIPE_NavColumn/RelationProfiles",["DS/ENORIPE_NavColumn/NavWSProxy","DS/Core/ModelEvents","DS/PlatformAPI/PlatformAPI","i18n!DS/ENORIPE_Relations/assets/nls/Relations"],function(d,e,b,c){var c;var a={fetchandStoreProfiles:function(f){var g=this;d.getrelationprofiles(f).then(function(h){var h=typeof h==="string"?JSON.parse(h):h;var k=g._getRelationsSet();if(k){for(var j=0;j<k.length;j++){h.profiles.splice(j+1,0,k[j])}}g.storeProfiles(h.profiles)})},storeProfiles:function(f){var k=this._fetchLastStoredProfile();this._profiles=f;this._profileNames=[];var j=false;for(var h=0;h<this._profiles.length;h++){var l=this._profiles[h];if(k){if(k===l.name){this.setCurrentProfile(l.name);j=true}}this._profileNames.push(l.name)}if(!j&&this._profileNames.length){var g=false;for(h=0;h<this._profileNames.length;h++){if(this._profileNames[h]==="Designer"){this.setCurrentProfile(this._profileNames[h]);g=true;break}}if(g===false){this.setCurrentProfile(this._profileNames[0])}}},getProfileNames:function(){return this._profileNames},getNlsForProfileNames:function(k){var j=[];for(var h=0;this._profileNames&&h<this._profileNames.length;h++){var g=this._profileNames[h];var f=c[g]||g;j.push({name:g,nls:f})}return j},getNlsForMenu:function(){return c["Manage-Relations"]},setCurrentProfile:function(f){if(this._currentProfile!==f||typeof this._currentProfile==="undefined"){this._currentProfile=f;this.publish("CurrentProfileChanged")}},getCurrentProfile:function(){return this._currentProfile},getCurrentProfileNls:function(){var f=c[this._currentProfile]||this._currentProfile;return f},getCurrentProfileRelations:function(){relations=[];var h=this._getCurrentProfileData();for(var f=0;h&&f<h.relations.length;f++){var g=h.relations[f];relations.push(g.name)}return relations},publish:function(f){this._ensureModelEvents();this._modelEvents.publish({event:f})},subscribe:function(f,g){this._ensureModelEvents();return this._modelEvents.subscribe({event:f},g)},_getCurrentProfileData:function(){for(var f=0;this._profiles&&f<this._profiles.length;f++){var g=this._profiles[f];if(g.name===this._currentProfile){return g}}return null},_ensureModelEvents:function(){if(!this._modelEvents){this._modelEvents=new e()}},_getRelationsSet:function(){var f=localStorage.getItem(this.getUserID()+"_ENORIPE_CustomRelationsSet");if(f){return JSON.parse(f)}},getUserID:function(){var f=b.getUser(),g=(f!==null&&f!==undefined&&f.login!==undefined)?b.getUser().login:"";return g},_fetchLastStoredProfile:function(){var f="LastUsedProfile-defaultID";if(typeof widget!=="undefined"&&widget!==null){return widget.getValue(f)}else{return localStorage.getItem(f)}}};return a});define("DS/ENORIPE_NavColumn/AdditionalColumns",["css!DS/ENORIPE_NavColumn/ENORIPE_NavColumn","i18n!DS/ENORIPE_NavColumn/assets/nls/ENORIPE_NavColumn.json","UWA/Core","UWA/Class","DS/PADUtils/PADContext","DS/ENORIPE_NavColumn/RelationProfiles","DS/ENORIPE_NavColumn/NavWSProxy","DS/Utilities/Dom","DS/ENORIPE_Relations/RelationsTabSettings","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/AttributesViewMgt"],function(k,m,f,c,i,g,l,a,d,e,j){function h(p,o,n){if(p[o]){p[o].hasNONPS+=n}else{p[o]={hasNONPS:n}}}var b=c.singleton({_columnDataIndex:["hasNONPS"],_columnDef:{hasNONPS:{dataIndex:"hasNONPS",text:m.hasNONPS,isDraggable:true,width:50,minWidth:50,isHidden:true,onCellRequest:function(r){if(r.manager.getColumnOptions("hasNONPS").isHidden===false){if(r.isHeader){var q=m.hasNONPS+"["+g.getCurrentProfileNls()+"]";r.model.setCellContent(q);r.cellView.getContent().setHTML(q);r.cellView._updateToolTip()}else{var n=false,p=r.nodeModel.options.grid.hasNONPS;if(p!==undefined&&p!==""){var o=""+p;if(p>0){r.cellView.reuseCellContent("padCheck")}else{r.cellView.getContent().setContent(" ")}}else{r.cellView.reuseCellContent("padLoaderCol")}}}},xnav_options:{dataIndex:"hasNONPS",exportable:{lock:false,value:true},layout:{hidden:true,width:50}}}},_columnDefDGV:{hasNONPS:{dataIndex:"hasNONPS",alignmentValue:"center",editableFlag:false,sortableFlag:false,width:50,minWidth:50,visibleFlag:false,isAdditionalColumn:true,getCellTypeRepresentation:function(o){if(o.nodeModel){var n=o.nodeModel.options.grid.hasNONPS;if(n!==undefined&&n!==""){if(n>0){return"relationCheck"}else{return"relationNone"}}else{return"relationLoading"}}},getCellSemantics:function(o){j.completeCellSemantics(o);if(o.nodeModel){var n=o.nodeModel.options.grid.hasNONPS;if(n===undefined||n===""||n===0){return{disabled:true}}}},customisation:{dataIndex:"hasNONPS",exportable:{lock:false,value:true},layout:{removable:false}}}},init:function(n){this._parent(n);var o=this;g.subscribe("CurrentProfileChanged",function(q){function u(z){if(z.options&&z.options.grid){z.options.grid.hasNONPS=0}}var v=i.get();if(v){var t=v.getPADTreeDocument();var y=t.getRoots();for(var s=0;s<y.length;s++){var w=y[s];u(w);w.processDescendants({processNode:u})}var r=v.getPADTreeListView();if(r&&r._datagrid){var p=r.getManager();if(!p.isColumnHidden("hasNONPS")){p.hideColumn("hasNONPS");p.showColumn("hasNONPS")}}else{var x=v.options.views?v.options.views.datagridview:undefined;if(x){if(!x.isColumnHidden("hasNONPS")){x.changeColumnTitle("hasNONPS",m.hasNONPS+"["+g.getCurrentProfileNls()+"]");x.hideColumn("hasNONPS");x.showColumn("hasNONPS")}}}d.setProfile(g.getCurrentProfile())}})},isAdditionalColumnsAvailable:function(p){if(f.is(p,"function")===false){throw new Error("A callback function should be defined")}var o={getPlatformID:function(){return e.getPlatformId()},getServiceID:function(){return"3DSpace"}};var n={isDraggable:true};d.isAvailable(o,n).then(function(q){if(f.is(q,"object")){e.app_initialization(function(){g.fetchandStoreProfiles(q.roles);p(true)})}else{p(false)}},function(){p(false)})},getName:function(){return m.hasNONPS+"["+g.getCurrentProfileNls()+"]"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(n){return true},updateAttributes:function(q,p){if(f.is(q,"object")===false){throw new Error("The object ids to modify must be specify")}if(f.is(p,"function")===false){throw new Error("A callback function should be defined")}var o={pids:{},relids:{}};q.pids.forEach(function(r){o.pids[r]={hasNONPS:undefined}});var n=g.getCurrentProfileRelations();l.getRelationCount({relations:n,ids:q.pids}).then(function(t){q.pids.forEach(function(v){o.pids[v]={hasNONPS:0}});var s=t.New&&t.New.Counts?t.New.Counts:[];for(var r=0;r<s.length;r++){var u=s[r];if(q.pids.indexOf(u.source)!==-1){h(o.pids,u.source,parseInt(u.count))}}p(o)})["catch"](function(r){console.error(r);q.pids.forEach(function(s){o.pids[s]={hasNONPS:0}});p(o)})},getAdditionalColumnsUX:function(q){var p=[];for(var o=0;o<q.length;o++){p.push(q[o].dataIndex)}for(var s=0;s<this._columnDataIndex.length;s++){var t=this._columnDataIndex[s];var r=f.clone(this._columnDef[t]);var n=p.indexOf(t);if(n===-1){q.push(r)}else{q[n]=f.extend(r,q[n],true);q[n].text=m[q[n].dataIndex]}}},getAdditionalColumnsUXDGV:function(q){var p=[];for(var o=0;o<q.length;o++){p.push(q[o].dataIndex)}for(var s=0;s<this._columnDataIndex.length;s++){var t=this._columnDataIndex[s];var r=f.clone(this._columnDefDGV[t]);var n=p.indexOf(t);if(n===-1){r.text=this.getName();q.push(r)}else{q[n]=f.extend(q[n],r,true);q[n].text=this.getName()}}},provideDisplayTooltip:function(o){var n=null;if(o.nodeModel&&o.dataIndex==="hasNONPS"){n=o.nodeModel.options.grid.hasNONPS}return n},registerReusableCellContent:function(n){n.getManager().registerReusableCellContent({id:"padCheck",buildContent:function(){return a.createElement("div",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"})}});n.getManager().registerReusableCellContent({id:"padLoaderCol",buildContent:function(){return a.createElement("div",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}})},getTypeRepresentations:function(){return{relationCheck:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS}}},relationNone:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS}}},relationLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},getOnCellClickCB:function(n){var o=this;if(this._columnDataIndex.indexOf(n)===0){return function(q){if(q.nodeModel){var p=q.nodeModel.options.grid.hasNONPS;if(p>0){require(["DS/ApplicationFrame/CommandsManager"],function(r){var s=r.getCommandCheckHeader("RightSidePanel");if(s){if(s.getState()===false){s.setState(true,false)}s._propertiesWdg.selectFacet("relations")}})}}}}},getAdditionalCtxMenu:function(r){var s=false,p;if(r.ctxParams.treeview){s=r.ctxParams.treeview.isHeader;p=r.ctxParams.treeview.dataIndex}else{if(r.view==="datagridview"){s=r.ctxParams.cellInfos.rowID===-1;p=r.ctxParams.collectionView.getColumnOrGroup(r.ctxParams.cellInfos.columnID).dataIndex}}var q=[];if(s===true&&p==="hasNONPS"){q={type:"PushItem",title:g.getNlsForMenu(),fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related-cog",family:WUXManagedFontIcons.Font3DS},submenu:[]};var t=g.getNlsForProfileNames();for(var o=0;o<t.length;o++){var n=t[o];q.submenu.push({type:"RadioItem",title:n.nls,state:g.getCurrentProfile()===n.name?"selected":"",action:{context:n.name,callback:function(u){g.setCurrentProfile(u.context)}}})}r.callback(g.getNlsForMenu(),q)}else{r.callback(null)}}});return b});