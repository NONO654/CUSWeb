define("DS/IssueCommon/commands/Open",["UWA/Class","DS/ApplicationFrame/Command"],function(b,c){var a=b.extend(c,{execute:function(){require(["DS/IssueComponents/open/Open"],function(d){d.openWith()})}});return a});define("DS/IssueCommon/utils/Selector",["DS/IssueServices/Contexts"],function(a){var c={ISSUE_TYPE:"Issue",ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_3D_REVIEW:"ENX3DIR_AP"};var b={getIntersection:function(d){var m=a.get("widget"),e={ids:[],map:{}};if(m.name===c.ISSUE_MANAGEMENT){var o=a.get("component");for(var l=0;l<d.length;l++){var g=d[l];var f=o.getNodesById(g),h=null;h=f.pop();if(h!==undefined){e.ids.push(g);e.map[g]={id:h.options.id,type:h.options.type,name:h.options.name,title:h.options.title}}}}else{if(m.name===c.ISSUE_3D_REVIEW){var n=a.get("component").getIssues().map;for(var k=0;k<d.length;k++){var g=d[k];var p=n[g];if(p!==undefined){e.ids.push(g);e.map[g]={id:p.id,type:p.type,name:p.name,title:p.title}}}}else{e={ids:d,map:d.reduce(function(i,j){i[j]={id:j};return i},{})}}}return e},getSelected:function(){var m=a.get("widget"),k={ids:[],map:{}};if(m.name===c.ISSUE_MANAGEMENT){var e=a.get("component").getSelectedNodes();for(var h=0;h<e.length;h++){var l=e[h];if(l.options.type===c.ISSUE_TYPE){k.ids.push(l.options.id);k.map[l.options.id]={id:l.options.id,type:l.options.type,name:l.options.name,title:l.options.title}}}}else{if(m.name===c.ISSUE_3D_REVIEW){var g=a.get("component").getSelectedIssues();for(var f=0;f<g.length;f++){var d=g[f];if(d.type===c.ISSUE_TYPE){k.ids.push(d.id);k.map[d.id]={id:d.id,type:d.type,name:d.name,title:d.title}}}}}return k}};return b});define("DS/IssueCommon/commands/Delete",["UWA/Class","DS/ApplicationFrame/Command"],function(a,c){var b=a.extend(c,{init:function(d){var e=this;e._parent(d)},execute:function(){require(["DS/IssueComponents/delete/Delete","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(g,e,d){var h=d.get("widget");var f=e.getSelected();if(h.body.getElement(".delete-issues-dialog")){return}new g({physicalIds:f.ids}).render()})}});return b});define("DS/IssueCommon/utils/TaskManager",["UWA/Core","UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","css!DS/IssueCommon/IssueCommon.css"],function(g,f,b,e,a){var d={METADATA:{ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},TASKS:{FILTER:"FILTER",SELECT_IN_3D:"SELECT_IN_3D",PREFERENCES:"PREFERENCES",ADD_OBJECTS:"ADD_OBJECTS",TAKE_SCREENSHOT:"TAKE_SCREENSHOT"},TASK_STATE:{NEW:"NEW",PROCESSING:"PROCESSING"},FIRST_INDEX:0};var c=f.singleton(b,{_counter:0,_taskList:[],_subscriber:[],_metadataOpts:{},init:function(){var h=this;h._counter=0;h._taskList=[];h._subscriber=[];h._metadataOpts={};h._metadataOpts[d.METADATA.ISU_TASK_MANAGER]=d.METADATA.ISU_TASK_MANAGER;h._subscriber.push(e.subscribe("DS/IssueManagementTask/ready",h._ready.bind(h)));h._subscriber.push(e.subscribe("DS/IssueManagementTask/done",h._end.bind(h)))},destroy:function(){var j=this;if(j._subscriber&&j._subscriber.length>0){for(var h=0;h<j._subscriber.length;h++){e.unsubscribe(j._subscriber[h])}j._subscriber=[]}j._counter=0;j._taskList=[];j._metadataOpts={}},add:function(l,k,n,o){var j=this;if(!g.is(l,"string")){throw new Error('Invalid arguments[0] "type". Expected a String')}else{if(Object.keys(d.TASKS).indexOf(l)===-1){throw new Error('Task type "'+l+'" is not supported')}}if(!g.is(k,"array")){throw new Error('Invalid arguments[1] "args". Expected an Array')}if(!g.is(n,"function")){throw new Error('Invalid arguments[2] "callback". Expected a Function')}if(g.is(o)&&!g.is(o,"function")){throw new Error('Invalid arguments[3] "cancelCallback". Expected a Function')}var i=a.get("widget")||window.widget;j._counter+=1;var m={taskType:l,taskId:"id-"+j._counter,state:d.TASK_STATE.NEW,widgetIdIM:i.id,widgetId3D:"",args:k,callback:n,cancelCallback:o||null};j._taskList.push(m);var p=[],h={};p.push([m.taskId]);h[m.taskId]={taskType:m.taskType,widgetIdIM:m.widgetIdIM};e.publish("DS/IssueManagementTask/add",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:g.clone(j._metadataOpts)},data:{paths:p,attributes:h},version:"1.0"});return m},cancelAll:function(){var j=this;var k=j._taskList.slice();for(var h=0;h<k.length;h++){j.cancel(k[h].taskId)}},getTaskList:function(){var h=this;return h._taskList},_searchTask:function(j){var k=this;for(var h=0;h<k._taskList.length;h++){if(k._taskList[h].taskId===j){return k._taskList[h]}}return null},_removeTask:function(j){var k=this;for(var h=0;h<k._taskList.length;h++){if(k._taskList[h].taskId===j){k._taskList.splice(h,1);break}}},_end:function(m){var j=this;var l=a.get("widget")||window.widget;var k=function(){var o=l.body.getDimensions().height,p=window.getComputedStyle(l.body);if(o===0||p.display==="none"){return false}return true};if(m.data.paths.length>0){var n=m.data.paths[d.FIRST_INDEX][d.FIRST_INDEX];var i=m.data.attributes[n];var h=j._searchTask(n);if(k()&&h&&h.widgetIdIM===i.widgetIdIM&&h.widgetId3D===i.widgetId3D){j._removeTask(h.taskId);if(m.metadata.options.canceled){if(g.is(h.cancelCallback,"function")){h.cancelCallback()}}else{h.callback(i.response)}}else{}}else{}},cancel:function(i){var j=this;var h=j._searchTask(i);if(!h){}else{if(h.widgetId3D!==""){j.publish(h,"cancel")}else{j._removeTask(h.taskId);if(g.is(h.cancelCallback,"function")){h.cancelCallback()}}}},publish:function(i,j){var k=this;var l=a.get("widget")||window.widget;var m=[],h={};m.push([i.taskId]);h[i.taskId]={taskId:i.taskId,taskType:i.taskType,widgetIdIM:i.widgetIdIM,widgetId3D:i.widgetId3D};e.publish("DS/IssueManagementTask/"+j,{metadata:{appId:l.id,appName:l.name,timestamp:Math.floor(Date.now()),options:g.clone(k._metadataOpts)},data:{paths:m,attributes:h},version:"1.0"})},addSelectIn3DTask:function(j,h){var i=this;return i.add(d.TASKS.SELECT_IN_3D,[],j,h)},addFilterTask:function(i,k){var j=this;if(!g.is(i,"array")){throw new Error('Invalid arguments[0] "ids". Expected an Array')}if(!g.is(k,"function")){throw new Error('Invalid arguments[1] "callback". Expected a Function')}var h=[i];return j.add(d.TASKS.FILTER,h,k,null)},addPreferencesTask:function(j){var i=this;if(!g.is(j,"function")){throw new Error('Invalid arguments[1] "callback". Expected a Function')}var h=[];return i.add(d.TASKS.PREFERENCES,h,j,null)},addObjectsTask:function(j,h){var i=this;return i.add(d.TASKS.ADD_OBJECTS,[],j,h)},addTakeScreenshotTask:function(j,h){var i=this;return i.add(d.TASKS.TAKE_SCREENSHOT,[],j,h)},_isMasked:function(h){return h.hasClassName("masked")},_ready:function(m){var k=this;var l=a.get("widget")||window.widget;if(m.data.paths.length>0){var o=m.data.paths[d.FIRST_INDEX][d.FIRST_INDEX];var j=m.data.attributes[o];var i=k._searchTask(o);if(i&&i.widgetIdIM===j.widgetIdIM&&i.state===d.TASK_STATE.NEW){i.state=d.TASK_STATE.PROCESSING;i.widgetId3D=j.widgetId3D;var n=[],h={};n.push([i.taskId]);h[i.taskId]={taskId:i.taskId,taskType:i.taskType,widgetIdIM:i.widgetIdIM,widgetId3D:i.widgetId3D,args:i.args};e.publish("DS/IssueManagementTask/exec",{metadata:{appId:l.id,appName:l.name,timestamp:Math.floor(Date.now()),options:g.clone(k._metadataOpts)},data:{paths:n,attributes:h},version:"1.0"})}else{}}else{}}});return c});define("DS/IssueCommon/commands/Compare",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command","DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts"],function(g,d,f,b,a){var c={TRANSIENT:{WIDTH:700,HEIGHT:800}};var e=d.extend(f,{execute:function(){var l=this;var k=[];var h=a.get("component").getSelectedNodes();for(var j=0;j<h.length;j++){k.push(h[j].options.id)}l.showCompare(k)},showCompare:function(i){var k=[];i.forEach(function(l){k.push({envId:"",serviceId:"",contextId:"",objectId:l,objectType:"",displayName:""})});if(k.length>0){var h={protocol:"3DXContent",version:"1.0",source:"ENXISSU_AP",data:{items:k}};var j={mode:"panel",height:c.TRANSIENT.HEIGHT,width:c.TRANSIENT.WIDTH};b.showWidget("ENOCOMP_AP","",{X3DContentId:JSON.stringify(h)},j)}}});return e});define("DS/IssueCommon/commands/WhereUsed",["DS/ApplicationFrame/Command"],function(c){var b={TRANSIENT:{WIDTH:700,HEIGHT:800}};var a=c.extend({execute:function(){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(e,d,i){var h=d.get("component");var f=h.getSelectedNodes();var k=[];f.forEach(function(l){k.push({envId:i.getTenant(),serviceId:"3DSpace",contextId:"",objectId:l.options.id,objectType:"",displayName:""})});if(k.length>0){var g={protocol:"3DXContent",version:"1.1",source:d.get("widget").name,data:{items:k}};var j={mode:"panel",height:b.TRANSIENT.HEIGHT,width:b.TRANSIENT.WIDTH};e.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(g)},j)}})}});return a});define("DS/IssueCommon/commands/CommandsManager",["DS/ApplicationFrame/CommandsManager"],function(b){var a={disabled:false,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}};var c={disableAll:function(){if(a.disabled===true){return}var d=b.getCommands(),k=d?Object.keys(d):[];var g=b.getCommandCheckHeaders(),h=g?Object.keys(g):[];a={disabled:true,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}};for(var f=0;f<k.length;f++){if(d[k[f]].isEnabled()){a.commands.toEnable.push(k[f])}else{a.commands.toDisable.push(k[f])}}for(var e=0;e<h.length;e++){if(g[h[e]].isEnabled()){a.commandCheckHeaders.toEnable.push(h[e])}else{a.commandCheckHeaders.toDisable.push(h[e])}}b.disableAll()},enableAll:function(){if(a.disabled===false){return}b.enableAll();var e=b.getCommands();if(a&&a.commands){for(var g=0;g<a.commands.toEnable.length;g++){e[a.commands.toEnable[g]].enable()}for(var f=0;f<a.commands.toDisable.length;f++){e[a.commands.toDisable[f]].disable()}}var h=b.getCommandCheckHeaders();if(a&&a.commandCheckHeaders){for(var d=0;d<a.commandCheckHeaders.toEnable.length;d++){h[a.commandCheckHeaders.toEnable[d]].enable()}for(var k=0;k<a.commandCheckHeaders.toDisable.length;k++){h[a.commandCheckHeaders.toDisable[k]].disable()}}a={disabled:false,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}}},getCommand:function(d){return b.getCommand(d)},getCommandCheckHeader:function(d){return b.getCommandCheckHeader(d)}};return c});define("DS/IssueCommon/commands/Duplicate",["UWA/Class","DS/ApplicationFrame/Command"],function(a,b){var c=a.extend(b,{init:function(d){var e=this;e._parent(d)},execute:function(){require(["DS/IssueComponents/duplicate/Duplicate","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(h,e,d){var g=d.get("widget");var f=e.getSelected();if(g.body.getElement(".duplicate-issues-dialog")){return}new h({physicalIds:f.ids}).render()})}});return c});define("DS/IssueCommon/commands/AttachmentManager",["UWA/Class","UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],function(b,f,e,d){var a={ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_3D_REVIEW:"ENX3DIR_AP",RESIZE_THROTTLE_WAIT:100,DEFAULT_AUTHORING:true};var c=b.extend(d,e,{_instances:[],init:function(g){var h=this;h._parent(g,{isAsynchronous:true});h.authoring=null;h.selectedObject=null},execute:function(){var g=this;require(["DS/ENOFloatingPanel/ENOFloatingPanel","DS/PlatformAPI/PlatformAPI","DS/IssueAttachmentManager/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","UWA/Class/Promise","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(i,p,m,l,h,k,n,q){var j=h.get("widget"),o=h.get("component"),s=h.get("eventsHandler");var r=new n(function(w){var y="",x="",v="";if(f.is(g.selectedObject)&&f.is(g.selectedObject.physicalId,"string")&&f.is(g.selectedObject.title,"string")&&f.is(g.selectedObject.name,"string")){w({id:g.selectedObject.physicalId,title:g.selectedObject.title,name:g.selectedObject.name})}else{if(j.name===a.ISSUE_MANAGEMENT){var t=o.getSelectedNodes();if(t.length>0){y=t[t.length-1].options.id;x=t[t.length-1].options.title;v=t[t.length-1].options.name}w({id:y,title:x,name:v})}else{if(j.name===a.ISSUE_3D_REVIEW){var u=o.getSelectedIssues();if(u.length>0){y=u[u.length-1].id;x=u[u.length-1].title;v=u[u.length-1].name}w({id:y,title:x,name:v})}}}});r.then(function(C){var v=C.id;var B=C.title;var u=C.name;var y=Date.now();var t=j.body.getDimensions();var w={mode:1,catalogLayout:2,catalogVisibility:true,sliderVisibility:false,height:t.height-100,width:t.width-100,top:"20px",left:"50px",annotationPreLaunchCallback:function(){if(g._instances.hasOwnProperty(y)){l.Mask.mask(g._instances[y].elements.container)}if(j.name===a.ISSUE_3D_REVIEW){try{this.annotationCanvasTarget=f.Element.getElement.call(o.get3DContext().root.getFrameWindow().elements.viewerFrame,"canvas")}catch(F){}}else{this.annotationCanvasDefaultDimensions={width:t.width-50,height:t.height-50}}},annotationSaveCallback:function(){if(g._instances.hasOwnProperty(y)){l.Mask.unmask(g._instances[y].elements.container)}},annotationExitCallback:function(){if(g._instances.hasOwnProperty(y)){l.Mask.unmask(g._instances[y].elements.container)}}};var A=f.clone(j.getValue("attachmentManagerModalPreferences"));var x=f.clone(j.getValue("attachmentManagerPreferences"));var E=f.merge(A||{},w);E=f.merge(x||{},E);E.id=v;E.authoring=f.is(g.authoring,"boolean")?g.authoring:a.DEFAULT_AUTHORING;var z=new m(E);var D=g._instances[y]=new i({animate:true,autocenter:true,closable:true,limitParent:false,overlay:false,resizable:true,visible:true,className:"isu-am-modal",title:q.replace(q.attachments.title,{title:B,name:u}),header:null,body:z,events:{onShow:function(){var F=this;F.attachmentManager=z;F.instanceId=y;F._subscriberId=Math.random().toString(36).substr(2,9);F.attachmentManager.render();F.attachmentManager.isLoaded.then(function(){g._utils._addCustomCommands.apply(F);F.attachmentManager.container.setAttribute("tabindex","0");F.attachmentManager.container.focus();F.attachmentManager.resize();var H=l.throttle(function(){F.attachmentManager.resize()},a.RESIZE_THROTTLE_WAIT);g.listenTo(F,"onResizeFloating",H);g.listenTo(F.attachmentManager,"onUpdate",function(O){var P=[],K={};var N=Object.keys(O.objects);for(var J=0;J<N.length;J++){P.push([O.objects[N[J]].physicalId]);K[O.objects[N[J]].physicalId]={id:O.objects[N[J]].physicalId,type:O.objects[N[J]].type||"Issue",modifiedAttributes:["attachments"]}}var M="DS/Object/update";var L={metadata:{appId:h.get("widget").id,appName:h.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:P,attributes:K},version:"1.0"};if(s!==null){s.publish(F._subscriberId,M,L)}else{p.publish(M,L)}});F._eventListeners=[{event:"DS/Object/update",listener:function(K){if(F.attachmentManager&&F.attachmentManager.id){var L=K.data.paths;var J=L.some(function(M){return(F.attachmentManager.id===M[0])});if(J){F.attachmentManager.refresh()}}},conditions:{type:"issue",attributes:["attachments"]}},{event:"DS/Object/select",listener:function(M){if(!F._holdIssueFlg){var K="";if(M.data.paths.length===1){K=M.data.paths.pop().pop()}if(K!==""&&K!==F.attachmentManager.collection.id){var N="",L="";if(M.data.attributes.hasOwnProperty(K)){var J=M.data.attributes[K];N=J.title;L=J.name}F.setTitle(q.replace(q.attachments.title,{title:N,name:L}));F.attachmentManager.refresh(K).then(function(){g._utils._addCustomCommands.apply(F)})}}},conditions:{type:"issue"}}];for(var I=0;I<F._eventListeners.length;I++){var G=F._eventListeners[I];if(s!==null){G.token=s.subscribe(F._subscriberId,G.event,G.listener.bind(F),G.conditions)}else{G.token=p.subscribe(G.event,G.listener.bind(F))}}g.authoring=null;g.selectedObject=null;g.end()})},onClose:function(){var F=this;j.setValue("attachmentManagerModalPreferences",{width:F.elements.container.clientWidth,height:F.elements.container.clientHeight,top:F.elements.container.offsetTop,left:F.elements.container.offsetLeft});g.stopListening(F,"onResizeFloating");g.stopListening(F.attachmentManager,"onUpdate");if(Array.isArray(F._eventListeners)){for(var H=0;H<F._eventListeners.length;H++){var G=F._eventListeners[H];if(s!==null){s.unsubscribe(G.token)}else{p.unsubscribe(G.token)}}}F._eventListeners=[];F.attachmentManager.destroy();F.attachmentManager=null;delete g._instances[F.instanceId];F.destroy()}}});D.inject(j.body);D.elements.container.setStyle("height",E.height);D.elements.container.setStyle("width",E.width)})})},_utils:{_addCustomCommands:function(){var g=this;require(["i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(j){var h=function(){g._holdIssueFlg=!g._holdIssueFlg;var k=g.attachmentManager.views.header.iconBar;k.getItem("hold").elements.container.toggleClassName("active",g._holdIssueFlg);g.attachmentManager.contextualMenu.customCommands.forEach(function(l){if(l.name==="hold"){l.state=g._holdIssueFlg?"selected":"unselected"}})};g.attachmentManager.views.header.iconBar.addItem({id:"hold-issue-divider",className:"divider btn-hidden"});g._holdIssueFlg=false;g.attachmentManager.views.header.iconBar.addItem({id:"hold",fonticon:"pin",text:j.attachments.holdIssue,selectable:true,handler:h});if(g.attachmentManager&&g.attachmentManager.contextualMenu&&g.attachmentManager.contextualMenu.customCommands){var i=g.attachmentManager.contextualMenu.customCommands.some(function(k){return k.name==="hold"});if(!i){g.attachmentManager.contextualMenu.customCommands.push({name:"hold",title:j.attachments.holdIssue,type:"RadioItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pin"},data:null,state:g._holdIssueFlg?"selected":"unselected",action:{callback:h}})}}})}}});return c});define("DS/IssueCommon/commands/Close",["UWA/Class","DS/ApplicationFrame/Command"],function(a,c){var b=a.extend(c,{init:function(d){var e=this;e._parent(d)},execute:function(){require(["DS/IssueComponents/close/Close","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(f,e,d){var h=d.get("widget");var g=e.getSelected();if(h.body.getElement(".isu-close-dialog")){return}new f({physicalIds:g.ids}).render()})}});return b});define("DS/IssueCommon/commands/History",["UWA/Class","DS/ApplicationFrame/Command"],function(b,d){var a={TRANSIENT:{WIDTH:700,HEIGHT:800}};var c=b.extend(d,{execute:function(){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(j,h,f){var e=[];var g=h.get("component").getSelectedNodes();for(var k=0;k<g.length;k++){e.push(g[k].options.id)}var l=[];e.forEach(function(i){l.push({envId:f.getTenant(),serviceId:"3DSpace",contextId:"",objectId:i,objectType:"",displayName:""})});if(l.length>0){var n={protocol:"3DXContent",version:"1.1",source:"ENXISSU_AP",data:{items:l}};var m={mode:"panel",height:a.TRANSIENT.HEIGHT,width:a.TRANSIENT.WIDTH};j.showWidget("ENOLCMI_AP","",{X3DContentId:JSON.stringify(n)},m)}})}});return c});define("DS/IssueCommon/utils/Utils",["UWA/Class/Promise","UWA/Controls/Input","UWA/Core","DS/UIKIT/Mask","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/services/PlatformServices","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(j,i,g,e,c,b,d,a,l){var h={CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed",DATES:["created","modified","estimatedStartDate","estimatedEndDate","actualStartDate","actualEndDate","resolutionDate"],MASK_DELAY:10,SHARED_ISSUE_URL_PREFIX:"#dashboard:/tab:/app:ENXISSU_AP/content:XSharedContentId=",MAX_SHAREABLE_ISSUES:100};var f={getIconByState:function(n){var m="";switch(n){case h.CREATE_STATE:m=d.getWebappsAssetUrl("IssueCommon","icons/22/iconCreateState.png");break;case h.ASSIGN_STATE:m=d.getWebappsAssetUrl("IssueCommon","icons/22/iconAssignState.png");break;case h.ACTIVE_STATE:m=d.getWebappsAssetUrl("IssueCommon","icons/22/iconActiveState.png");break;case h.REVIEW_STATE:m=d.getWebappsAssetUrl("IssueCommon","icons/22/iconReviewState.png");break;case h.CLOSED_STATE:m=d.getWebappsAssetUrl("IssueCommon","icons/22/iconClosedState.png");break;default:break}return m},getColorByState:function(n){var m="";switch(n){case h.CREATE_STATE:m="#9B2C98";break;case h.ASSIGN_STATE:m="#FF8A2E";break;case h.ACTIVE_STATE:m="#009DDB";break;case h.REVIEW_STATE:m="#6FBC4B";break;case h.CLOSED_STATE:m="#ADADAD";break;default:break}return m},getFormattedDate:function(n,m){var q=window.widget.lang;var p=h.DATES;for(var o=0;o<p.length;o++){if(!isNaN(Date.parse(n[p[o]]))){n[p[o]]=new Date(n[p[o]]).toLocaleString(q,m)}else{n[p[o]]=""}}return n},getTextFromHTML:function(m){var n=g.createElement("div",{html:m});return n.textContent||n.innerText||""},timeSince:function(n){var o=Math.floor((new Date()-n)/1000);var m=Math.floor(o/31536000);if(m>1){return l.replace(l.dates.years,{number:m})}m=Math.floor(o/2592000);if(m>1){return l.replace(l.dates.months,{number:m})}m=Math.floor(o/86400);if(m>1){return l.replace(l.dates.days,{number:m})}m=Math.floor(o/3600);if(m>1){return l.replace(l.dates.hours,{number:m})}m=Math.floor(o/60);if(m>1){return l.replace(l.dates.minutes,{number:m})}return l.replace(l.dates.seconds,{number:Math.floor(o)})},getFilesFromDrop:function(p){var o=[];if(p.dataTransfer.items){for(var n=0;n<p.dataTransfer.items.length;n++){if(p.dataTransfer.items[n].kind==="file"){o.push(p.dataTransfer.items[n].getAsFile())}}}else{for(var m=0;m<p.dataTransfer.files.length;m++){o.push(p.dataTransfer.files[m])}}return o},uploadImages:function(m){var n=this;return new j(function(p){var o=new i.File("Input.File",{visibility:"hidden",styles:{display:"none"}});o.elements.container.setStyle("display","none");o.elements.input.multiple=(m!==undefined)?m:true;o.elements.input.accept="image/png, image/jpeg";o.elements.input.addEventListener("change",function(q){o.destroy();o=null;p(q.target.files)},false);o.elements.input.addEventListener("click",function(q){q.stopPropagation()});o.elements.input.click()}).then(function(o){o=Array.from(o);if(o.length===0){return j.reject(new Error("No selected files to be uploaded"))}var p=[];o.forEach(function(q){p.push(n.isImage(q))});return j.all(p)}).then(function(o){o=o.reduce(function(q,p){if(p.status==="success"){q.push(p.file)}else{b.displayNotification({msg:l.replace(l.images.errorUpload,{name:p.file.name}),eventID:"error"})}return q},[]);if(o.length===0){return j.reject(new Error("No valid files to be uploaded"))}return j.resolve(o)})},isImage:function(n){var m=new FileReader();return new j(function(p){m.onload=function o(s){var r=s.target.result,q=new Uint8Array(r);if(q[0]===255&&q[1]===216&&q[q.byteLength-2]===255&&q[q.byteLength-1]===217){p({status:"success",file:n})}else{if(q[0]===137&&q[1]===80&&q[2]===78&&q[3]===71){p({status:"success",file:n})}else{if(q[0]===71&&q[1]===73&&q[2]===70&&q[3]===56){p({status:"error",file:n})}else{if(q[0]===66&&q[1]===77){p({status:"error",file:n})}else{p({status:"error",file:n})}}}}};m.readAsArrayBuffer(n)})},readImageURI:function(n){var m=new FileReader();return new j(function(o){m.onload=function(p){o(p.target.result)};m.readAsDataURL(n)})},getDroppableData:function(m){var o={};var u=g.is(m.dataTransfer.types.indexOf,"function")?"indexOf":"contains",r="";var p=["text/searchitems","text/plain","Text"];for(var t=0;t<p.length&&r==="";t++){var s=m.dataTransfer.types[u](p[t]);if((g.is(s,"number")&&s>=0)||(g.is(s,"boolean")&&s===true)){r=p[t]}}var n={};if(r===""){throw new Error("Unknown type in DnD")}else{n=m.dataTransfer.getData(r)}try{o=JSON.parse(n)}catch(q){o={data:{items:[]}}}return o},_debounceTimeouts:[],debounce:function(o,q,m){var n=this;var p;return function(){var v=this,u=arguments;var s=function(){p=null;if(!m){o.apply(v,u)}};var r=m&&!p;clearTimeout(p);var t=n._debounceTimeouts.indexOf(p);if(t!==-1){n._debounceTimeouts.splice(t,1)}p=setTimeout(s,q);n._debounceTimeouts.push(p);if(r){o.apply(v,u)}}},throttle:function k(n,p,t){var m,r,u;var s=null;var q=0;if(!t){t={}}var o=function(){q=t.leading===false?0:Date.now();s=null;u=n.apply(m,r);if(!s){m=r=null}};return function(){var v=Date.now();if(!q&&t.leading===false){q=v}var w=p-(v-q);m=this;r=arguments;if(w<=0||w>p){if(s){clearTimeout(s);s=null}q=v;u=n.apply(m,r);if(!s){m=r=null}}else{if(!s&&t.trailing!==false){s=setTimeout(o,w)}}return u}},isValid3DXContent:function(m){if(g.equals(m,null)||g.equals(m,undefined)){return false}if(!m.hasOwnProperty("protocol")||!g.equals(m.protocol,"3DXContent")){return false}if(!m.hasOwnProperty("version")||!g.is(m.version,"string")){return false}if(!m.hasOwnProperty("source")||!g.is(m.source,"string")){return false}if(m.hasOwnProperty("widgetId")&&!g.is(m.widgetId,"string")){return false}if(!m.hasOwnProperty("data")||!g.is(m.data,"object")){return false}if(!m.data.hasOwnProperty("items")||!g.is(m.data.items,"array")){return false}if(m.data.items.length>0){var n=m.data.items.every(function(o){if(!o.hasOwnProperty("envId")||!g.is(o.envId,"string")){return false}if(!o.hasOwnProperty("objectId")||!g.is(o.objectId,"string")){return false}if(!o.hasOwnProperty("serviceId")||!g.is(o.serviceId,"string")){return false}if(!o.hasOwnProperty("objectType")||!g.is(o.objectType,"string")){return false}if(o.hasOwnProperty("displayName")&&!g.is(o.displayName,"string")){return false}if(o.hasOwnProperty("contextId")&&!g.is(o.contextId,"string")){return false}if(o.hasOwnProperty("displayPreview")&&!g.is(o.displayPreview,"string")){return false}if(o.hasOwnProperty("displayIcon")&&!g.is(o.displayIcon,"string")){return false}if(o.hasOwnProperty("path")){if(!g.is(o.path,"array")){return false}else{var p=o.path.every(function(q){if(!q.hasOwnProperty("resourceid")||!g.is(q.resourceid,"string")){return false}if(q.hasOwnProperty("type")&&!g.is(q.type,"string")){return false}return true});if(!p){return false}}}return true});if(!n){return false}}return true},computeSharedIssuesURL:function(n){var m=a.get3DDashboardUrl()+h.SHARED_ISSUE_URL_PREFIX;m+=encodeURIComponent(JSON.stringify({issues:g.clone(n)}));return m},copyTextToClipboard:function(o){var n=document.createElement("textarea");n.style.position="fixed";n.style.top=0;n.style.left=0;n.style.width="2em";n.style.height="2em";n.style.padding=0;n.style.border="none";n.style.outline="none";n.style.boxShadow="none";n.style.background="transparent";n.value=o;document.body.appendChild(n);n.select();try{document.execCommand("copy")}catch(m){}document.body.removeChild(n)},isJson:function(n){try{JSON.parse(n)}catch(m){return false}return true},isInteger:function(m){return Number.isInteger?Number.isInteger(m):typeof m==="number"&&isFinite(m)&&Math.floor(m)===m},Mask:{_timeouts:[],mask:function(n,m){var p=this;var o=g.merge({},m);var r=p._timeouts.every(function(s){return s.element!==n});if(r===true){var q=setTimeout(function(){e.mask(n,o.message)},o.delay||h.MASK_DELAY);if(!Array.isArray(p._timeouts)){p._timeouts=[]}p._timeouts.push({element:n,timeout:q})}},unmask:function(n){var o=this;var m=-1;o._timeouts.some(function(q,p){if(q.element===n){m=p;return true}else{return false}});if(m>-1){clearInterval(o._timeouts[m].timeout);o._timeouts.splice(m,1)}if(e.isMasked(n)){e.unmask(n)}}}};return f});define("DS/IssueCommon/commands/ChangeOwner",["UWA/Core","DS/ApplicationFrame/Command"],function(d,c){var b={INTERVAL_CHECK_DIALOG:200};var a=c.extend({init:function(e){var f=this;f._parent(e,{isAsynchronous:true});require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(m,l,i,j,h,g){var k=g.get("widget"),n=j.getCommand("TransferOwnershipCmd_"+k.id);l.app_initialization(function(){if(!d.is(n,"object")){n=new m({ID:"TransferOwnershipCmd_"+k.id})}n.onEnd(function(){f.end();var o=setInterval(function(){if(n.transferOwnershipPanel&&n.transferOwnershipPanel.addEvent){clearInterval(o);n.transferOwnershipPanel.addEvent("onClose",function(){var t=[],q={};var r=h.getSelected();var s=r.ids;for(var p=0;p<s.length;p++){t.push([r.map[s[p]].id]);q[r.map[s[p]].id]={id:r.map[s[p]].id,type:r.map[s[p]].type,name:r.map[s[p]].name,title:r.map[s[p]].title,modifiedAttributes:["owner"]}}i.publish("DS/Object/update",{metadata:{appId:k.id,appName:k.name,timestamp:Math.floor(Date.now())},data:{paths:t,attributes:q},version:"1.0"})})}},b.INTERVAL_CHECK_DIALOG)})})})},execute:function(){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(k,j,g,h,f,e){var i=e.get("widget"),l=h.getCommand("TransferOwnershipCmd_"+i.id);if(d.is(l,"object")){l.begin()}})}});return a});define("DS/IssueCommon/commands/Share",["UWA/Class","DS/ApplicationFrame/Command","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Selector","DS/IssueCommon/utils/Utils","DS/IssueServices/services/PlatformServices","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(d,a,e,b,g,c,i){var f={SHARED_ISSUE_URL_PREFIX:"#dashboard:/tab:/app:ENXISSU_AP/content:XSharedContentId=",MAX_SHAREABLE_ISSUES:100};var h=d.extend(a,{init:function(j){var k=this;k._parent(j)},execute:function(){var k=b.getSelected().ids;var j=g.computeSharedIssuesURL(k);g.copyTextToClipboard(j);if(k.length>=f.MAX_SHAREABLE_ISSUES){e.displayNotification({msg:i.replace(i.share.info,{number:f.MAX_SHAREABLE_ISSUES}),eventID:"info"})}else{e.displayNotification({msg:i.replace(i.share.success,{number:k.length}),eventID:"info"})}}});return h});define("DS/IssueCommon/commands/Templates",["UWA/Class","DS/ApplicationFrame/Command","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts"],function(b,e,d,a){var c=b.extend(e,{init:function(f){var g=this;g._parent(f,{isAsynchronous:true})},execute:function(){var f=this;if(f.utils.isAlreadyRunning()===true){return}require(["DS/IssueComponents/templates/Templates"],function(g){var h=a.get("widget");f.component=new g(h.body,{editMode:true,onClose:function(){},onEnd:function(){}});f.component.render();f.component.isLoaded["finally"](function(){f.end()})})},beginExecute:function(){var f=this;if(f.utils.isAlreadyRunning()===true){return}var g=a.get("widget");d.Mask.mask(g.body)},endExecute:function(){var f=a.get("widget");d.Mask.unmask(f.body)},utils:{isAlreadyRunning:function(){var f=a.get("widget");return f.body.getElement(".create-template-chooser-dialog")!==null||f.body.getElement(".create-view-dialog")!==null}}});return c});define("DS/IssueCommon/commands/Create",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Class/Promise","DS/ApplicationFrame/Command","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts"],function(d,b,i,h,a,g,c){var f={ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_3D_REVIEW:"ENX3DIR_AP"};var e=b.extend(a,i,{mode:"",component:null,init:function(j){var k=this;k._parent(j,{isAsynchronous:true})},execute:function(){var k=this;if(k.utils.isAlreadyRunning()===true){k._reset();k.end();return}var l=c.get("widget"),j=c.get("component");new h(function(m){if(l.name===f.ISSUE_3D_REVIEW&&j.isDisplayed()!==true){require(["DS/UIKIT/Mask","DS/ApplicationFrame/CommandsManager"],function(o,n){o.mask(l.body);k.listenTo(j,"onDisplay",function(){k.stopListening(j,"onDisplay");o.unmask(l.body);m()});n.getCommandCheckHeader("Display").toggleState()})}else{m()}}).then(function(){var m=k.getArguments();if(m&&m.length>0){k.mode=m[m.length-1].Value}if(k.utils[k.mode]!==undefined){k.utils[k.mode].apply(k)}else{k.utils.IFB.apply(k)}})},beginExecute:function(){var j=this;if(j.utils.isAlreadyRunning()===true){return}var k=c.get("widget");g.Mask.mask(k.body)},endExecute:function(){var j=c.get("widget");g.Mask.unmask(j.body);this.mode=null},_reset:function(){var j=this;j.autoFillData=null;j.template=null;j.mode=null},utils:{isAlreadyRunning:function(){var j=c.get("widget");return j.body.getElement(".create-template-chooser-dialog")!==null||j.body.getElement(".create-view-dialog")!==null},IFB:function(){var j=this;require(["DS/IssueComponents/create/Create"],function(l){var m=c.get("widget");var k=(m.name===f.ISSUE_3D_REVIEW);j.component=new l(m.body,{escapeToClose:!k});j.component.render();j.component.isLoaded.then(function(){if(d.is(j.autoFillData,"object")){var n={id:"template-"+m.id+"-"+Date.now(),info:{description:null,name:null},ui:{},data:d.clone(j.autoFillData),hidden:{}};return j.component.applyTemplate(n)}else{return h.resolve()}})["finally"](function(){j._reset();j.end()})})},_openCreateAndApplyTemplate:function(j){var k=this;require(["DS/PADUtils/views/PADAlert","DS/IssueComponents/create/Create","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(l,o,q){var p=c.get("widget");var n=(p.name===f.ISSUE_3D_REVIEW);if(j!==null){var m=new o(p.body,{escapeToClose:!n});m.render();m.isLoaded.then(function(){var r=d.clone(j);if(d.is(k.autoFillData,"object")){var s=d.extend(r,{data:d.clone(k.autoFillData)},true);r=s}return m.applyTemplate(r)})["catch"](function(r){m._logger.error(r);l.displayNotification({msg:q.replace(q.create.templateApplyError,{name:j.info.name}),eventID:"error"})})["finally"](function(){k._reset();k.end()})}else{k._reset();k.end()}})},IFT:function(){var k=this;if(d.is(k.template,"object")){var j=d.clone(k.template);k.utils._openCreateAndApplyTemplate.call(k,j)}else{require(["DS/IssueComponents/templates/Templates"],function(l){var m=c.get("widget");k.component=new l(m.body,{editMode:false,onClose:function(){k._reset();k.end()},onEnd:k.utils._openCreateAndApplyTemplate.bind(k)});k.component.render();k.component.isLoaded["finally"](function(){})})}}}});return e});