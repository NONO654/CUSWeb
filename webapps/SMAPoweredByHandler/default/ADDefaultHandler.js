/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define(["UWA/Core","DS/SMAPoweredByHandler/ADAbstractHandler","DS/SMAPoweredByHandler/activity/ActivityUtils","DS/SMAPoweredByHandler/default/rules","DS/SMAPoweredByHandler/default/JobTile","DS/SMAPoweredByHandler/common/CreateWizardFacets","DS/SMAPoweredByHandler/common/JobFacets","DS/SMAPoweredByHandler/common/Actions","DS/SMAPoweredByHandler/common/selectors","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","DS/SMAPoweredByState/ad-state-domain-connector-definitions/selectors","DS/SMAPoweredByState/ad-state-domain-jobs/actions"],function(d,r,l,p,s,o,b,g,j,f,c,n,h,k,t,m){var a={};function q(v,u){return v.name===u.name}function e(u,v){var w;w=t.connectorOption(v,u.name);if(!w&&u.Choices){w=t.connectorOption(v,u.value||u.defaultValues);if(w.optionType==="Standalone"){w.active=true}}else{if(!w){w=u}else{if(u.value){w.value=u.value.toString()}else{if(u.optionType==="Standalone"){w.active=u.active}else{if(u.defaultValues){w.value=u.defaultValues}else{if(u.Choices&&(Array.isArray(u.Choices))&&u.Choices.length>0){w.value=u.Choices[0]}}}}}}return w}function i(w,y,u){if(u){for(var x=0;x<w.length;x++){var z=n.jobArguments(y,u).filter(q.bind(null,w[x]));if(z.length===1){var v=z[0];if(v.value){w[x].value=v.value}if(v.optionType==="Standalone"){w[x].active=v.active}w[x].displayed=true}}}}a.init=function(u){this._parent(u);if(u){this.boundActionsJob=this.stateRedux.getBoundActions(m,this.store.dispatch)}};a.hasPredefinedApp=function(w,u){var v=n.jobWithID(w,u),y,x;if(v&&v._plmActivity){y=l.getOSCommandStep(v._plmActivity);x=l.isApplicationDefined(y)}return x};a.getArgs=function(u){var v,w=n.getApplication(this.store.getState(),u);return new Promise(function(y,x){this.stateRedux.waitFor({store:this.store,select:t.connectorDefinitionsPersistenceOperation,isResolved:function(z){return((z===null)&&(t.connectorDefinitionForApp(this.store.getState(),w.appName,w.appVersion)!==null))}.bind(this)}).then(function(){v=d.clone(t.connectorDefinitionForApp(this.store.getState(),w.appName,w.appVersion));i(v.options,this.store.getState(),u);this.setArgs(v.options,u);y(v.options)}.bind(this),x)}.bind(this))};a.setArgs=function(B,x){var z,D,A,u,w,v=n.getApplication(this.store.getState(),x);z=d.clone(t.connectorDefinitionForApp(this.store.getState(),v.appName,v.appVersion));u=[];w=false;for(var y=0;y<B.length;y++){D=B[y];if(D.displayed){A=e(D,z);u.push(A);if(A.optionType==="Option-Value"||A.optionType==="Standalone-Value"){w=w||(n.jobArgumentValue(this.store.getState(),x,D.name)!==A.value)}else{var C=n.jobArguments(this.store.getState(),x).filter(q.bind(null,A));w=w||(C.length!==1)||(C[0].active!==A.active)}}else{if(typeof(D.displayed)!=="undefined"&&!D.displayed){this.boundActionsJob.removeJobArgument(x,D.name)}}}if(w){this.boundActionsJob.setJobArguments(x,u)}return u};a.jobFacets=b;a.wizardFacets=o;a.jobTile=s;a.actions=[g.viewDetails,g.cloneJob,g.divider,g.abortJob,g.divider,g.deleteJob];a.Selectors=j;a.Rules=p;a.outputJobTypeTitle="Import Simulation Results";a.addJobId=function(u){this._parent(u);p.setStore(this.store);p.startListening(u)};a.unsubscribeAll=function(){this._parent();this.stateRedux.unsubscribeAll();p.unsubscribeAll()};return r.extend(a)});