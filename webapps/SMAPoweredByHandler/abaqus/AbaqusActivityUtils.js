/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByHandler/activity/ActivityUtils","DS/SMAPoweredByHandler/generateResults/GenerateResultsActivityUtils","DS/SMAPoweredByState/ad-state-app/selectors"],function(b,c,d){var a={};a.setEnvironmentVariablesState=function(h,g){var f,e;b.setEnvironmentVariablesState(h,g);for(f=g.configuration.environmentVariables.length-1;f>=0;f--){e=g.configuration.environmentVariables[f].name;if((e==="SMA_ABQSTUDY")||(e==="ABQLMIMPL")||(e==="ABQCUSTID")||(e==="SMA_MAXCPUS")||(e==="ABQ_USERUVM_PVM")||(e==="ABQ_USERUVM_SVM")||(e==="ABQDSLSSERVER")||(e==="SMA_VM_CPUS")||(e==="SMA_VM_OS")){g.configuration.environmentVariables.splice(f,1)}}};a.setExecutionOptionsPLM=function(g,h,f){var e=b.getActivityConfig(h);b.setExecutionOptionsPLM(g,h,f);if(g.executionOptions.licenseOptions){e.SXALicenseOptions=g.executionOptions.licenseOptions}};a.setExecutionOptionsState=function(h,g,f){var e=b.getActivityConfig(h);b.setExecutionOptionsState(h,g,f);if(e&&e.SXALicenseOptions){g.executionOptions.licenseOptions={licenseType:((e.SXALicenseOptions.licenseType)?e.SXALicenseOptions.licenseType:(d.isCloudEnabled(f)?"credits":"traditionalTokens")),features:((e.SXALicenseOptions.features)?e.SXALicenseOptions.features:"1"),modelSize:((e.SXALicenseOptions.modelSize)?e.SXALicenseOptions.modelSize:"1"),performance:((e.SXALicenseOptions.performance)?e.SXALicenseOptions.performance:"1")}}else{g.executionOptions.licenseOptions={licenseType:"traditionalTokens",features:"1",modelSize:"1",performance:"1"}}};a.setEnvironmentVariablesPLM=function(g,k,f){var j=b.getOSCommandStep(k),h,e=0;b.setEnvironmentVariablesPLM(g,k);if(g.executionOptions.licenseOptions&&g.executionOptions.licenseOptions.licenseType&&(g.executionOptions.licenseOptions.licenseType!=="traditionalTokens")){if(!j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable]||!j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values||((j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.length===1)&&(j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values[0]["0"]===null))){j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable]={values:[]}}e=j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.length;h={};h[String(e++)]="SMA_ABQSTUDY=1";j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="ABQLMIMPL="+((g.executionOptions.licenseOptions.licenseType==="tokens")?"DSLS":"CREDIT");j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="ABQCUSTID="+d.currentWhereUsedTenantID(f);j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="SMA_MAXCPUS="+((g.executionOptions.numProcs&&(!isNaN(g.executionOptions.numProcs)))?g.executionOptions.numProcs:4);j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="ABQ_USERUVM_PVM="+((g.executionOptions.licenseOptions.performance&&!isNaN(g.executionOptions.licenseOptions.performance))?g.executionOptions.licenseOptions.performance:"1");j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="ABQ_USERUVM_SVM="+((g.executionOptions.licenseOptions.modelSize&&!isNaN(g.executionOptions.licenseOptions.modelSize))?g.executionOptions.licenseOptions.modelSize:"1");j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="ABQDSLSSERVER="+d.dslsURL(f);j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);if(g.executionOptions.drmMode==="Cloud"){h={};h[String(e++)]="SMA_VM_CPUS=uvm";j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h);h={};h[String(e++)]="SMA_VM_OS=self";j.FlowItem.stepConfig.properties[b.JOB_OBJECT_KEYS.OSCommandEnvironmentVariable].values.push(h)}}};a.setResultsOptionsState=c.setResultsOptionsState;return a});