define("DS/ReviseFromWidget/util/TreeSyncMgr",["UWA/Controls/Abstract","DS/LifecycleServices/Utils"],function(b,a){return b.extend({nextId:1,syncing:false,add:function(c,d){var f=this;var g=d||false;this.trees=this.trees||[];this.debouncedSyncScroll=this.debouncedSyncScroll||a.debounce(this.syncScrollTo.bind(this),200);var e=f.nextId++;c.getManager().onReady(function(){var h=0;if(g&&f.trees.length>0){h=f.trees[0].id}f.trees.push({id:e,tree:c});c.getManager().getScroller().onScroll(function(){f.debouncedSyncScroll(e)});if(h!==0){f.syncScrollTo(h)}c.onExpand(function(i){f.syncNodes(e,i.data.nodeModel._rowID,function(j){j.expand()})});c.onCollapse(function(i){f.syncNodes(e,i.data.nodeModel._rowID,function(j){j.collapse()})})});return e},remove:function(c){},syncScrollTo:function(e){var c=this.trees.find(function(g){return g.id===e});if(!c){return}var f=c.tree.getManager().getScrollerPosition();var d=this;this.trees.forEach(function(g){if(g.id===e){return}d.syncing=true;g.tree.getManager().setScrollerPosition(f);d.syncing=false})},syncNodes:function(e,f,c){var d=this;if(d.syncing){return}d.syncing=true;this.trees.forEach(function(g){if(g.id===e){return}var h=g.tree.getManager().getTreeNodeModelFromRowID(f);if(h){c(h)}});d.syncing=false}})});define("DS/ReviseFromWidget/NewRevisionFromTree",["UWA/Class","UWA/Class/Events","DS/UIKIT/Mask","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/WAFData/WAFData","DS/LifecycleControls/AssemblyTreeList","DS/UIKIT/Input/Select","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/ArrayFunctions"],function(j,e,g,a,d,i,f,h,c,k){var b=j.extend(e,{init:function(m,p,o,l){this.roots=[];this.tenant=p;this.context=o;for(var n=0;n<m.length;++n){this.roots.push({id:m[n]})}this.filterDuplicateInstances=l},openAdvancedTree:function(l,n,m){if(!this.container){this.container=l;this.container.setStyle("min-height","250px");g.mask(this.container);if(!m){this.createExpandedTree(n)}else{this.createTree(m,n)}}},getAssembly:function(){return this.assembly},getInstances:function(l){return this.treeList.getSameNodes(l)},getNewRevFromData:function(n,r){var l=this.treeList.tree.getDocument().getNthRoot(0);var q=[];var m=[];var s=0;this.addNodeData(q,l,m,s,n,r);var p={physicalid:l.options.physicalId,treeData:q};if(document.debugNRF){p.Dbg_label=l.options.label}var o=[];o.push(p);return o},addNodeData:function(K,B,G,l,q,F){if(G.indexOf(B.options.nodeId)!==-1){return}G.push(B.options.nodeId);var C=B.dropdownListSelectedIndex;var J=C?C.action:0;var E=this.getOptions({occId:B.options.occId}).options;var x=E[J];if(x==="exclude"){return}var H=x==="insertnew";var A=x==="reuse";var M=k.getOccurence(this.assembly,B.options.occId);if(H&&F&&M.insertedInstance){return}var D=k.getNode(this.assembly,B.options.nodeId);var L={physicalid:!H?D.clonedFromPhysicalid?D.clonedFromPhysicalid:B.options.physicalId:"",operation:x,physicalid_dup:B.options.physicalId,level:l};if(document.debugNRF){L.Dbg_label=B.options.label}if(!A&&B.hasChildren()){L.children=[];var r=B.getChildren();var m=r.length;var u=0;for(u=0;u<m;u++){var t=r[u];var p=k.getNode(this.assembly,t.options.nodeId);var o=t.dropdownListSelectedIndex;var I=o?o.action:0;var n=this.getOptions({occId:t.options.occId}).options;var w=n[I];if(w==="exclude"){continue}var s=w==="insertnew";var z=w==="reuse";var v=k.getOccurence(this.assembly,t.options.occId);if(s&&F&&v.insertedInstance){continue}var y={physicalid:!s?p.clonedFromPhysicalid?p.clonedFromPhysicalid:t.options.physicalId:"",operation:w,physicalid_dup:t.options.physicalId};if(document.debugNRF){y.Dbg_label=t.options.label}if(q){if(v.refOccRelId){y.rel_physicalid=v.refOccRelId}if(v.relId){y.rel_physicalid_dup=v.relId}}L.children.push(y);if(!z&&(!s||F)&&t.hasChildren()){this.addNodeData(K,t,G,l+1,q,F)}}}K.push(L)},collapseParents:function(m){var l=this.treeList.getNodes(function(o){if(m.includes(o.options.nodeId)){return true}});l.forEach(function(p){var o=p.getParent();o._treeNode.collapse()})},hideNodes:function(m){var l=this.treeList.getNodes(function(o){if(m.includes(o.options.nodeId)){return true}});l.forEach(function(o){o._treeNode.hide()})},getOptions:function(o){var m=k.getOccurence(this.assembly,o.occId);var l=[];var n=[];if(m.actionInfo){if(m.actionInfo.revise){l.push("revise");n.push(c.revise)}if(m.actionInfo.reuse){l.push("reuse");n.push(c.reuse)}if(m.actionInfo.insertnew){l.push("insertnew");n.push(c.insert)}if(m.actionInfo.exclude){l.push("exclude");n.push(c.exclude)}}else{l.push("");n.push("")}return{options:l,translated:n}},createExpandedTree:function(l){var m=this;d.getSecurityContextPromise(this.tenant,this.context).then(function(n){m.expandStructure(n,function(o){g.unmask(m.container);m.assembly=k.convertFromExpandFormat(o);m.updateAssemblyNodesWithParentInfo();m.createAdvancedTree(l);var p={};m.dispatchEvent("onTreeCreated",p)})})},createTree:function(l,m){var n=this;g.unmask(n.container);n.assembly=l;n.createAdvancedTree(m);var o={};n.dispatchEvent("onTreeCreated",o)},createAdvancedTree:function(n){var p=["revision"];if(n.addActionCol){p.push("action")}this.treeList=new f({getChildrenInTreeOrder:n.getChildrenInTreeOrder,allCols:p});var r={filterDuplicates:this.filterDuplicateInstances};this.container.setContent(this.treeList);var q=this;if(n.addActionCol){var l={column:"action",translated:c.action};this.treeList.insertDropdownListCol(0,l.column,l.translated,function o(s){return q.getOptions(s).translated},function m(t,s,u){var w=q.treeList.getSameNodes(u.options.nodeId);w.forEach(function(x){var y=x.getAllDescendants();y.forEach(function(A){var z=q.treeList.getSameNodes(A.options.nodeId);q.treeList.setDropdownSelectionIf(z,0,l.column)})});var v={preSelIdx:t,selIdx:s,selNodes:w};q.dispatchEvent("onDropdownListChange",v);q.treeList.tree.getManager().updateView()})}this.treeList.load(this.assembly,p,r);this.container.getElement(".wux-layouts-gridengine").setStyle("min-height","150px");this.adjustHeight();this.treeList.tree.getDocument().expandAll()},setTreeNodeChildrenToReuse:function(n){var m=this;var l=[];if(n.hasChildren()){n.getChildren().forEach(function(o){var p=m.treeList.getSameNodes(o.options.nodeId);p.forEach(function(q){var s=q.options.occId;var r=k.getOccurence(m.assembly,s);if(r.actionInfo.revise&&r.actionInfo.reuse){l.push(q)}})})}m.treeList.setDropdownSelectionIf(l,1,"action")},updateAssemblyNodesWithParentInfo:function(){var l=this;l.assembly.nodes.forEach(function(m){if(m.followsParent===undefined){m.followsParent=m.type==="CATIA Embedded Component"||m.type==="3DShape"}})},getHtmlParent:function(l,n){var m=l;do{if(m.className===n){return m}m=m.getParent()}while(m!==null)},getParentHeight:function(n){var m=this.getHtmlParent(this.container,"reviseFrom_popup");if(m==null){return 0}var l=Number(m.getStyle("height").slice(0,-2));var o=n.getBoundingClientRect().top-m.getBoundingClientRect().top;return l-o},adjustHeight:function(){var m=this.container.getElements(".wux-layouts-gridengine");for(var n=0;n<m.length;++n){var o=m[n];var l=this.getParentHeight(o);o.setStyle("height",l)}},sortOccRelsOnOrder:function(){if(!this.assembly){return}if(!this.assembly.occurrencerelationships){return}this.assembly.occurrencerelationships.sort(function(m,l){if(m.parent>l.parent){return 1}if(m.parent<l.parent){return -1}if(m.order&&l.order){if(m.order>l.order){return 1}if(m.order<l.order){return -1}}return 0})},collapsedNodes:[],isNodeCollapsed:function(m){if(m.isExpanded()){return false}var l=m.getChildren();if(!l){return false}if(l.length>1){return true}return l[0].isHidden()==false},storeAllCollapsed:function(){if(!this.treeList||!this.treeList.tree){return}var l=this.treeList.tree.getDocument().getAllDescendants();l.forEach(function(m){if(this.isNodeCollapsed(m)){this.collapsedNodes.push(m._options.occId)}},this)},restoreAllCollapsed:function(){if(!this.treeList||!this.treeList.tree){return}var l=this.treeList.tree.getDocument().getAllDescendants();l.forEach(function(m){if(this.collapsedNodes.includes(m._options.occId)){m.collapse()}},this);this.collapsedNodes=[]},expandStructure:function(o,l){var n=this;var p={intent:"explore_2D",debug:false,type_filter_bo:["CATProduct","CATProcess","CATPart","CATDrawing","CATAnalysis","CATIA Embedded Component","CATIA CGR","CATShape","CATIA V4 Model","CATIA Design Table","VPMReference","VPMRepReference","3DShape"],roots:this.roots,level:"-1",source:"cstorage",authored:true,root_physicalid:this.roots[0].id};var m=a.get3DSpaceWSUrl(this.tenant,"/resources/enopad/lwc/expand",null);i.authenticatedRequest(m,{method:"POST",headers:a.getHeaders(encodeURIComponent(o)),timeout:600000,data:JSON.stringify(p),type:"json",onComplete:function(q){l(q)},onFailure:function(r){var q=r;if(r.hasOwnProperty("error")){q=r.error}else{if(r.hasOwnProperty("message")){q=r.message}}n.dispatchEvent("onError",q);console.error("NewRevisionFromTree.expandStructure: onFailure -> "+r)},onTimeout:function(q){n.dispatchEvent("onError",c.connectionTimeout);console.log("NewRevisionFromTree.expandStructure timeout error -> "+q)}})}});return b});define("DS/ReviseFromWidget/ReviseFromModel",["UWA/Controls/Abstract"],function(b){var a=b.extend({init:function(){this.histLinksNodes={};this.histLinksConnections={}},setHistLinksData:function(d){var c=JSON.parse(d);if(c.hasOwnProperty("nodes")){this.histLinksNodes=c.nodes}if(c.hasOwnProperty("connections")){this.histLinksConnections=c.connections}},getHistLinksNodes:function(){return this.histLinksNodes},getHistLinksConnections:function(){return this.histLinksConnections},getDuplicates:function(n,q){var m=[];var g=[];var p;for(var h=0;h<this.histLinksNodes.length;++h){if(this.histLinksNodes[h].id===n){p=this.histLinksNodes[h].nId;break}}for(var f=0;f<this.histLinksConnections.length;++f){var o=this.histLinksConnections[f];var c=o.typ;if(o.src===p){if(c==="duplicate"||(q&&(c==="evolution"||c==="revision"||c==="revisionFrom"))){g.push(o.trg)}}else{if(q&&o.trg===p){if(c==="duplicate"||c==="evolution"||c==="revision"||c==="revisionFrom"){g.push(o.src)}}}}for(var e=0;e<g.length;++e){for(var d=0;d<this.histLinksConnections.length;++d){var o=this.histLinksConnections[d];var c=o.typ;if(o.src===g[e]){if(c==="revision"||c==="revisionFrom"||(q&&(c==="duplicate"||c==="evolution"))){if(o.trg!=p&&g.indexOf(o.trg)<0){g.push(o.trg)}}}else{if(q&&o.trg===g[e]){if(c==="duplicate"||c==="evolution"||c==="revision"||c==="revisionFrom"){if(o.src!=p&&g.indexOf(o.src)<0){g.push(o.src)}}}}}}if(g.length>0){m=this.histLinksNodes.filter(function(k){for(var j=0;j<g.length;++j){if(g[j]===k.nId){return true}}return false})}return m},});return a});define("DS/ReviseFromWidget/ReviseFromController",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/ReviseFromWidget/ReviseFromModel","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleCmd/MessageMediator"],function(g,c,a,f,i,b,e,h){var d=g.extend({tenant:null,context:null,init:function(){this.model=new f();this.commandManager=new e()},setContext:function(j){this.context=j},getDuplicates:function(k){var j=this;c.getSecurityContextPromise(this.tenant,this.context).then(function(l){j.getRevisionHistory(k,l)})},getObjectInfo:function(l,m,j){var k=this;c.getSecurityContextPromise(this.tenant,this.context).then(function(n){k.getAttributes(l,n,m,j)})},createNewRevisionFrom:function(k){var j=this;c.getSecurityContextPromise(this.tenant,this.context).then(function(l){j.reviseFromServiceRequest(k,l)})},getRevisionHistory:function(o,m){var l=this;var k=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/history/links",null);var p=function(q){console.log("getRevisionHistory: COMPLETED");l.onObjectLinksDownloaded(q)};var j=function(q,r){l.dispatchEvent("onError",c.parseWebServiceError(q,r));console.log("Failed to retrive data from the server")};var n=function(q){l.dispatchEvent("onError",b.timeout);console.log("Timeout error")};if(o.hasOwnProperty("physicalid")){i.authenticatedRequest(k,{method:"GET",headers:a.getHeaders(encodeURIComponent(m)),timeout:600000,onComplete:p,data:"physicalid="+o.physicalid+"&depth=100",ontimeout:n,onFailure:j,type:"text"})}},onObjectLinksDownloaded:function(j){this.model.setHistLinksData(j);this.dispatchEvent("onDuplicatesRetrieved")},getAttributes:function(p,m,q,k){var l=this;var o=JSON.stringify(p);var j=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/attributeList",null);var n=function(r){l.dispatchEvent("onError",b.timeout);console.log("Timeout error")};i.authenticatedRequest(j,{method:"POST",headers:a.getHeaders(encodeURIComponent(m)),timeout:600000,onComplete:q,data:o,ontimeout:n,onFailure:k,type:"json"})},reviseFromServiceRequest:function(p,m){var l=this;console.log("reviseFrom:");var o=JSON.stringify(p);var k=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/revise/from",null);var q=function(x){console.log("reviseFrom: COMPLETED");if(x!==undefined&&x!==null&&x.hasOwnProperty("status")&&x.hasOwnProperty("report")){if(x.status==="failure"){var v=b.reviseFailed;for(var t=0;t<x.report.length;t++){var z=x.report[t];if(!!z.error&&z.error!==v){v=z.error;break}}l.dispatchEvent("onError",v);return}}var w={created:[],deleted:[],modified:[]};w.context=this.context;var y=x.results;function s(B){return B.level==0}var r=p.data[0].treeData.findIndex(s);var A=[];A.push(p.data[0].treeData[r]);var u=l.commandManager.findObjectDerivedFromSelection(y,A);u.forEach(function(C){var B=false;if(C.hasOwnProperty("derivedfromphysicalid")){B=true}var D={physicalid:C.physicalid,sourceObjectId:C.derivedfromphysicalid,operation:"Revise",refreshPSD:B};if(C.hasOwnProperty("folders")){w.refreshFolder=true;D.folders=C.folders}w.created.push(D)});h.dispatchEvent("onModification",w);l.dispatchEvent("onReviseSuccess")};var j=function(r,s){l.dispatchEvent("onError",c.parseWebServiceError(r,s).toString());console.log("Failed to retrive data from the server")};var n=function(r){l.dispatchEvent("onError",b.timeout);console.log("Timeout error")};i.authenticatedRequest(k,{method:"POST",headers:a.getHeaders(encodeURIComponent(m)),timeout:1000*60*60*6,onComplete:q,data:o,ontimeout:n,onFailure:j,type:"json"})},setTenant:function(j){this.tenant=j}});return d});define("DS/ReviseFromWidget/ReviseFromWidget",["css!DS/ReviseFromWidget/ReviseFromWidget","UWA/Core","UWA/Controls/Abstract","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleServices/LifecycleServicesSettings","DS/ReviseFromWidget/ReviseFromController","DS/ReviseFromWidget/util/TreeSyncMgr","DS/WAFData/WAFData","DS/ReviseFromWidget/NewRevisionFromTree","DS/LifecycleServices/AssemblyJson","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/DictionaryServices"],function(j,k,i,e,f,o,d,c,b,m,a,n,h,g){var l=i.extend({securityContext:null,context:null,tenant:null,dupes:null,pickDialog:null,refReviseFromTree:null,srcReviseFromTree:null,resReviseFromTree:null,resStructDiv:null,folderId:null,filterDuplicateInstances:false,srcStructDiv:null,srcStructDivhidden:null,irpcBehavior:false,activePDTabElPath:".facets-list > .facet.interactive.tab-behavior.selected",activePDTabName:null,activePDTabNameWidgetPref:"LCS_NRF_LastPDActiveTabName",init:function(){var p=this;this.physicalIds=[];this.onCompleteFnArr=[];this.resultRevisionCalculated=false;this.commandManager=new o();this.controller=new c()},executeCmd:function(q,p,t){this._setupEventHandlers(q,t);this.context=p.context;this.folderId=p.targetFolderId;try{if(d.getActiveFolder!==undefined){var r=d.getActiveFolder();if(r.id!==undefined&&r.id!==null&&r.id!==""){this.folderId=r.id;this.securityContex=r.sc!==""&&r.sc!==undefined?r.sc:this.securityContex;require(["DS/PlatformAPI/PlatformAPI"],function(u){u.publish("FolderEditor.ActiveFolderCallBack",{id:r.id,label:r.label})})}}}catch(s){this.folderId=p.targetFolderId;this.securityContex=d.getCurrentFolderSecurityContext()}this.controller.setContext(this.context);this.setObjects(q)},_handleError:function(p){document.body.style.cursor="default";this.showError(p);this._onComplete()},_saveLastPDTabPref:function(){var q=null;var p=null;if(this.srcStructDiv){p=this.srcStructDiv.getElement(this.activePDTabElPath)}if(p){q=p.dataset.name}else{if(this.activePDTabName){q=this.activePDTabName}}if(q){widget.setValue(this.activePDTabNameWidgetPref,q)}},_setupEventHandlers:function(p,q){this.addEvent("onReady",function(){this._showCommandUI(p)},this);this.addEvent("onComplete",function(){this._saveLastPDTabPref();this.onCompleteFnArr.forEach(function(r){r.apply(this)},this);q()},this);this.controller.addEvent("onDuplicatesRetrieved",function(){document.body.style.cursor="default";var r=this.controller.model.getDuplicates(this.physicalIds[0],this.irpcBehavior);if(r.length<1){this.showNotification(e.noDuplicatesCreated,"error");this._onComplete()}else{this.dupes=r;this.dispatchEvent("onReady")}},this);this.controller.addEvent("onError",this._handleError.bind(this));this.controller.addEvent("onReviseSuccess",function(r){document.body.style.cursor="default";this.showNotification(e.reviseSuccessful);this._onComplete()},this)},_showCommandUI:function(p){this.refReviseFromTree=new a([this.physicalIds[0]],this.tenant,this.context,this.filterDuplicateInstances);this.refReviseFromTree.addEvent("onTreeCreated",this._handleRefTreeCreated.bind(this));this.refReviseFromTree.addEvent("onError",this._handleError.bind(this));this.resReviseFromTree=new a([this.physicalIds[0]],this.tenant,this.context,this.filterDuplicateInstances);var q=this._renderDialogContent(p[0].displayName);var s=new h();var r=s.create(q,{title:e.newRevisionFrom,OKBtnText:e.NRFOK,imageUrl:p[0].imageUrl||"",resizable:true,closeButton:true,onOk:function(){this.createNewRevision()},onClose:function(){this._onComplete()},enableCmd:function(){return this.resultRevisionCalculated},events:{onResizeFloating:function(){var t=this.elements.container.getElements(".wux-layouts-gridengine");for(var u=0;u<t.length;++u){var x=t[u];var w=this.elements.container.getElement(".reviseFrom_popup");var v=Number(w.getStyle("height").slice(0,-2));var y=x.getBoundingClientRect().top-w.getBoundingClientRect().top;x.setStyle("height",v-y)}}}},this);r.inject(widget.body);r.setNewBodySize({width:800,height:600});r.setNewSize({});this.onCompleteFnArr.push(function(){s.destroy()});this.addEvent("ResultRevisionCalculated",function(){this.createResultTree();s.updateUI();this.treeSyncMgr=new b();this.treeSyncMgr.add(this.refReviseFromTree.treeList.tree);this.treeSyncMgr.add(this.srcReviseFromTree.treeList.tree);this.resTreeSyncId=this.treeSyncMgr.add(this.resReviseFromTree.treeList.tree)},this)},_renderDialogContent:function(z){var x=document.createElement("div");x.className="reviseFrom_popup";var C=k.createElement("table",{"class":"table",id:"newRevFromTable",height:"100%",width:"100%"});var s=k.createElement("thead");var u=k.createElement("tr");var D=k.createElement("th");D.setHTML(e.refStructure);D.inject(u);var A=k.createElement("th");A.setHTML(e.srcStructure);A.inject(u);var t=k.createElement("th");t.setHTML(e.resPreview);t.inject(u);u.inject(s);s.inject(C);var r=k.createElement("tbody");var y=k.createElement("tr");var p=k.createElement("td");var w=k.createElement("div",{id:"div1"});p.setHTML(w);p.inject(y);var B=k.createElement("td");this.srcStructDiv=k.createElement("div",{id:"div2"});this.srcStructDiv.style.height="100%";this.srcStructDivhidden=k.createElement("div",{id:"div3"});B.setHTML(this.srcStructDiv);B.inject(y);var v=k.createElement("td");this.resStructDiv=k.createElement("div");this.resStructDiv.style.padding="0";v.setHTML(this.resStructDiv);v.inject(y);y.inject(r);r.inject(C);this.refReviseFromTree.openAdvancedTree(w,{addActionCol:false,getChildrenInTreeOrder:true});var q=k.createElement("div",{"class":"mainDiv",styles:{"min-width":"1200px",height:"100%"}});C.inject(q);x.appendChild(q);return x},_onComplete:function(){this.dispatchEvent("onComplete")},setObjects:function(r){var q=this;if(r.length===0){throw e.noObject}else{if(r.length>1){throw e.multipleSelection}else{var p=r[0];this.tenant=p.tenant;if(p.hasOwnProperty("physicalid")&&p.physicalid===""){throw e.epmtyPhysicalId}if(p.hasOwnProperty("type")){g.getIsKindOfPromise(this.tenant,["CATPart","CATProduct","VPMReference"],p.type).then(function(s){if(!s){q._handleError(e.objectTypeNotSupported)}else{g.getIsKindOfPromise(q.tenant,["VPMReference"],p.type).then(function(t){q.irpcBehavior=t})}})}this.physicalIds.push(p.physicalid);this.tenant=p.tenant;this.commandManager.setTenant(this.tenant);this.controller.setTenant(this.tenant);document.body.style.cursor="wait";this.controller.getDuplicates(p)}}if(typeof this.tenant=="undefined"||this.tenant===null){this.tenant="OnPremise"}},_handleRefTreeCreated:function(p){if(this.dupes.length===1){this._renderDuplicateTree(this.dupes[0].id,this.srcStructDiv)}else{this._renderSelectionList(this.srcStructDiv,this.srcStructDivhidden)}},_handleSrcTreeCreated:function(p){this.getObjectInfo()},addPhysIdsToData:function(r,u){var q=r.nodes;var v=q.length;for(var s=0;s<v;s++){var t=q[s];var p={physicalid:t.physicalid};u.push(p)}},getObjectInfo:function(){document.body.style.cursor="wait";var s={data:[],attributes:["physicalid","attribute[MCADInteg-ClonedFrom]","attribute[PLMReference.V_DerivedFrom]","attribute[PLMEntity.V_usage]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","firstRevision","nextRevisionVG","last.current","last.current.revisionable","hasReviseAccess","last.attribute[Title]","last.attribute[PLMEntity.V_Name]","logicalid","attribute[PLMReference.V_fromExternalID]","attribute[PLMEntity.PLM_ExternalID]","revision","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]};if(this.irpcBehavior){s.attributes.push("majorids.bestsofar.physicalid");s.attributes.push("majorids.bestsofar.revision");s.attributes.push("majorids.bestsofar.attribute[PLMReference.V_DerivedFrom]")}var q=this.srcReviseFromTree.getAssembly();this.addPhysIdsToData(q,s.data);var p=this.refReviseFromTree.getAssembly();this.addPhysIdsToData(p,s.data);var r=this;this.controller.getObjectInfo(s,function t(v){document.body.style.cursor="default";r.onCompleteGetObjectInfo(v)},function u(v){document.body.style.cursor="default";r.showError(v);r._onComplete()})},addObjectInfo:function(p,F,u){var J=F.nodes;var N=J.length;var I=p.length;var C=[];for(var O=0;O<I;O++){var H=p[O];for(var M=0;M<N;M++){var L=J[M];if(H.physicalid===L.physicalid){if(u.addClonedFrom){var v=false;var A=null;var P=H["attribute[MCADInteg-ClonedFrom]"];if(P){v=true}else{var T=H.logicalid;for(var D=0;D<I;D++){var s=p[D];if(s.physicalid!=H.physicalid&&s.logicalid===T){P=s.physicalid;v=true;break}}if(!v){P=H["attribute[PLMReference.V_DerivedFrom]"];if(P){for(var D=0;D<I;D++){var s=p[D];if(s.physicalid===P){v=true;break}}}}if(!v){var K=H["attribute[PLMReference.V_fromExternalID]"];if(K){for(var D=0;D<I;D++){var s=p[D];var r=s["attribute[PLMEntity.PLM_ExternalID]"];r+=" "+s.revision;if(r===K){P=s.physicalid;v=true;break}}}}if(!v){var K=H["attribute[PLMReference.V_fromExternalID]"];if(K){for(var D=0;D<I;D++){var s=p[D];var r=s["attribute[PLMEntity.PLM_ExternalID]"];if(s.physicalid!=H.physicalid&&K.startsWith(r)){P=s.physicalid;v=true;break}}}}if(!v){for(var D=0;D<I;D++){var s=p[D];var S=s["attribute[PLMReference.V_DerivedFrom]"];if(S&&S===H.physicalid){P=s.physicalid;v=true;break}}}if(!v){var x=H["majorids.bestsofar.physicalid"];if(x){var E=x.split("\x07");for(var D=0;D<I;D++){var s=p[D];if(s.physicalid===H.physicalid){continue}var y=s["majorids.bestsofar.attribute[PLMReference.V_DerivedFrom]"];if(y){var R=y.split("\x07");var B=R.some(function(q){return E.indexOf(q)>=0});if(B){P=s.physicalid;v=true;break}}}}}}if(v&&P){var z=P.split("|");A=z[0]}L.clonedFromPhysicalid=A}if(u.addFirstRevision){L.firstRevision=H.firstRevision}if(u.addNextRevision){L.nextRevision=H.nextRevisionVG}if(u.addIsRevisionable){var t=H["last.current.revisionable"];L.isRevisionable=t==="TRUE"?true:false;L.hasReviseAccess=H.hasReviseAccess}if(u.addLatestRevTitle){L.latestRevTitle=H["last.attribute[Title]"];if(!L.latestRevTitle){L.latestRevTitle=H["last.attribute[PLMEntity.V_Name]"]}}if(L.type==="3DShape"){var Q=H["attribute[PLMEntity.V_usage]"];var G=H["attribute[PLMCoreRepReference.V_isOnceInstantiable]"]==="TRUE"?true:false;if(Q){if(Q==="3DPart"){if(G){L.onceInstantiable3DShape=true}L.followsParent=true}else{if(Q==="3DShape"&&G){L.followsParent=true;L.onceInstantiable3DShape=true}else{L.followsParent=false}}}}var w=H["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]==="TRUE"?true:false;if(w){L.followsParent=true}if(L.onceInstantiable3DShape){C.push(L.nodeid)}break}}}return{shapeNodes:C}},getNodeFromPhysicalId:function(q,r){var p=q.nodes;var u=p.length;for(var s=0;s<u;s++){var t=p[s];if(t.physicalid===r){return t}}return null},verifyRootIsRevisionable:function(q){var s=n.getRootOccurenceId(q);var r=n.getNodeIdFromOccurenceId(q,s);var p=n.getNode(q,r);if(p.isRevisionable&&p.hasReviseAccess&&!p.followsParent){return true}if(p.followsParent){this.showError(e.selectParentToPerformOperation)}else{this.showRootNotRevisionableErrMsg(p)}return false},showRootNotRevisionableErrMsg:function(q){var s=q.Title;var t="<b>"+s+"</b>";var p;if(!q.isRevisionable){p="cannotBeRevised"}else{p="noReviseAccess"}var r=e.replace(e.get(p),{dispName:t});this.showError(r)},verifyNoMultipleDuplicates:function(y,r){var q={};var p=y.nodes;var u=p.length;for(var w=0;w<u;w++){var v=p[w];if(v.clonedFromPhysicalid){var t=q[v.clonedFromPhysicalid];if(!t){q[v.clonedFromPhysicalid]=v.physicalid}else{if(v.physicalid!==t){var x=this.getNodeFromPhysicalId(r,v.clonedFromPhysicalid);var s=this.getNodeFromPhysicalId(y,t);this.showMultiDupeErrMsg(x,v,s);return false}}}}return true},showMultiDupeErrMsg:function(q,r,p){var t=q.Title+" "+q.revision;var w=r.Title+" "+r.revision;var v=p.Title+" "+p.revision;var u="<b>"+t+"</b>";var s=e.replace(e.get("multipleDuplicates"),{dupeSource:u});s=s+"<br>";s=s+"&nbsp;&nbsp;<b>"+w+"</b><br>";s=s+"&nbsp;&nbsp;<b>"+v+"</b><br>";s=s+e.pleaseUpdateStruct;this.showError(s)},onCompleteGetObjectInfo:function(y){var B=y.results;var w=this.srcReviseFromTree.getAssembly();var v={addClonedFrom:true,addFirstRevision:true,addNextRevision:false,addIsRevisionable:false,addLatestRevTitle:false};var t=this.addObjectInfo(B,w,v);this.srcReviseFromTree.shapeNodes=t.shapeNodes;var p=this.refReviseFromTree.getAssembly();var z={addClonedFrom:false,addFirstRevision:false,addNextRevision:true,addIsRevisionable:true,addLatestRevTitle:true};t=this.addObjectInfo(B,p,z);this.refReviseFromTree.shapeNodes=t.shapeNodes;var C=n.getRootOccurenceId(w);var D=n.getNodeIdFromOccurenceId(w,C);var u=n.getNode(w,D);if(!u.clonedFromPhysicalid){var x=n.getRootOccurenceId(p);var s=n.getNodeIdFromOccurenceId(p,x);var A=n.getNode(p,s);u.clonedFromPhysicalid=A.physicalid}var q=this.verifyRootIsRevisionable(p);if(!q){this._onComplete();return}var r=this.verifyNoMultipleDuplicates(w,p);if(r===true){this.resultRevisionCalculated=true;this.dispatchEvent("ResultRevisionCalculated")}else{this._onComplete()}},createResultTree:function(){var w=this;var p=this.refReviseFromTree.getAssembly();var s=this.srcReviseFromTree.getAssembly();var r={uicontroltype:"piecewisecgrviewer",version:2,rootoccurrence:0,nodes:[],occurrences:[],occurrencerelationships:[]};var u={resOccId:0,resNodeId:0,refOccId:10000,refNodeId:10000,srcOccId:10000,srcNodeId:10000};var t=n.getRootOccurenceId(p);var q=n.getRootOccurenceId(s);var v=this.addNode(r,u,p,t,s,q,null,null,null,1);this.srcReviseFromTree.sortOccRelsOnOrder();this.refReviseFromTree.createAdvancedTree({addActionCol:false,getChildrenInTreeOrder:true});this.refReviseFromTree.hideNodes(this.refReviseFromTree.shapeNodes);this.srcReviseFromTree.createAdvancedTree({addActionCol:true,getChildrenInTreeOrder:false});this.srcReviseFromTree.hideNodes(this.srcReviseFromTree.shapeNodes);this.resReviseFromTree.openAdvancedTree(this.resStructDiv,{addActionCol:false,getChildrenInTreeOrder:false},r);this.resReviseFromTree.hideNodes(v.shapeNodes);this.srcReviseFromTree.addEvent("onDropdownListChange",function(x){w.resReviseFromTree.storeAllCollapsed();x.selNodes.forEach(function(D){var F=D.options.occId;var C=w.srcReviseFromTree.getAssembly();var A=w.resReviseFromTree.getAssembly();var y=n.getOccurence(C,F);var E=n.getNodeIdFromOccurenceId(A,y.resOccId);var B=n.getNode(A,E);var z=x.selIdx===0;if(z){B.revision=B.nextRevision;B.Title=B.latestRevTitle}else{B.revision=B.currentRevision;B.Title=B.currentRevTitle}w.setChildrenToReviseOrReuse(z,p,C,A,F);if(z){w.srcReviseFromTree.setTreeNodeChildrenToReuse(D)}});w.resReviseFromTree.createAdvancedTree({addActionCol:false,getChildrenInTreeOrder:false});w.resReviseFromTree.hideNodes(v.shapeNodes);w.resReviseFromTree.restoreAllCollapsed();w.treeSyncMgr.remove(w.resTreeSyncId);w.resTreeSyncId=w.treeSyncMgr.add(w.resReviseFromTree.treeList.tree,true)})},updateInsertNewResNodeForReviseOrReuse:function(p,w,u){var x=n.getNodeIdFromOccurenceId(w,u);var t=n.getNode(w,x);if(this.irpcBehavior||p){delete t.revision;delete t.Title;delete t.type_icon_url}else{t.revision="";t.Title="";t.type_icon_url=""}var v=n.getChildOccurenceIds(w,u,this.filterDuplicateInstances);var q=v.length;for(var s=0;s<q;s++){var r=v[s];this.updateInsertNewResNodeForReviseOrReuse(p,w,r)}},updateExcludeResNodeForReviseOrReuse:function(q,p,z,w){var A=n.getNodeIdFromOccurenceId(z,w);var u=n.getNode(z,A);var x=n.getOccurence(z,w);var B=n.getNodeIdFromOccurenceId(p,x.refOccId);var v=n.getNode(p,B);if(q){delete u.revision;delete u.Title;delete u.type_icon_url}else{u.revision=v.revision;u.Title=v.Title;u.type_icon_url=v.attributes.type_icon_url}var y=n.getChildOccurenceIds(z,w,this.filterDuplicateInstances);var r=y.length;for(var t=0;t<r;t++){var s=y[t];var u=n.getNode(z,A);this.updateExcludeResNodeForReviseOrReuse(q,p,z,s)}},setChildrenToReviseOrReuse:function(s,q,A,z,B){var y=this;var C=n.getNodeIdFromOccurenceId(A,B);var p=n.getChildOccurenceIds(A,B,this.filterDuplicateInstances);var t=p.length;var x=function(G){var F=y.srcReviseFromTree.getInstances(G);var E=F.every(function(I){var H=I.getParent();if(H.options.occId===B||H.options.nodeId===C){return true}var J=H.dropdownListSelectedIndex;return J.action===0});return E};var r=function(G){var L=G.options.occId;var I=n.getNodeIdFromOccurenceId(A,L);var K=n.getNode(A,I);var H=n.getOccurence(A,L);if(!H.actionInfo){return}if(H.actionInfo.insertnew){y.updateInsertNewResNodeForReviseOrReuse(s,z,H.resOccId);return}if(H.actionInfo.exclude){y.updateExcludeResNodeForReviseOrReuse(s,q,z,H.resOccId);return}var M=n.getNodeIdFromOccurenceId(z,H.resOccId);var J=n.getNode(z,M);var F=false;if(!s&&H.actionInfo.revise){H.actionInfo.revise=false;J.revision=J.currentRevision;J.Title=J.currentRevTitle;H.canBeRevised=true;if(K.followsParent){H.actionInfo.reuse=true}F=true}else{if(s&&!H.actionInfo.revise){if(H.canBeRevised){var E=x(G.options.nodeId);if(E){H.actionInfo.revise=true;if(K.followsParent){H.actionInfo.reuse=false;J.revision=J.nextRevision;J.Title=J.latestRevTitle}F=true}}}}if(F&&(!s||K.followsParent)){y.setChildrenToReviseOrReuse(s,q,A,z,L)}};for(var w=0;w<t;w++){var v=p[w];var u=n.getNodeIdFromOccurenceId(A,v);var D=this.srcReviseFromTree.getInstances(u);D.forEach(r)}},addNode:function(ab,ae,B,S,r,s,y,P,p,L,Z){var C=null;var ap=null;var N={revise:false,reuse:false,insertnew:false,exclude:false};var O=Z||{shapeNodes:[]};if(s===null){N.exclude=true;var X={nodeid:ae.srcNodeId,physicalid:"0",Title:"",mod:"",type:"",cgrurl:"",attributes:{type_icon_url:""}};r.nodes.push(X);ae.srcNodeId=ae.srcNodeId+1;var I={occurrenceid:ae.srcOccId,nodeid:X.nodeid,actionInfo:N};s=ae.srcOccId;ae.srcOccId=ae.srcOccId+1;r.occurrences.push(I);if(p!==null){var an={parent:p,child:I.occurrenceid,order:L};r.occurrencerelationships.push(an)}if(P!==null){I.refOccRelId=n.getRelationshipId(B,P,S)}var T={nodeid:ae.resNodeId,physicalid:"0",Title:"",mod:"",type:"",cgrurl:"",attributes:{type_icon_url:""}};ab.nodes.push(T);ae.resNodeId=ae.resNodeId+1;ap={occurrenceid:ae.resOccId,nodeid:T.nodeid};ap.refOccId=S;I.resOccId=ae.resOccId;C=ae.resOccId;ae.resOccId=ae.resOccId+1;ab.occurrences.push(ap);if(y!==null){var R={parent:y,child:ap.occurrenceid,order:L};ab.occurrencerelationships.push(R)}var v=n.getNodeIdFromOccurenceId(B,S);var at=n.getNode(B,v);if(at&&at.onceInstantiable3DShape===true){O.shapeNodes.push(T.nodeid);this.srcReviseFromTree.shapeNodes.push(X.nodeid)}}else{var v=n.getNodeIdFromOccurenceId(B,S);var at=n.getNode(B,v);var Y=Object.create(at);Y.nodeid=ae.resNodeId;ab.nodes.push(Y);C=ae.resOccId;var ac={occurrenceid:C,nodeid:Y.nodeid};ac.refOccId=S;ab.occurrences.push(ac);ae.resNodeId=ae.resNodeId+1;ae.resOccId=ae.resOccId+1;if(y!==null){var E={parent:y,child:ac.occurrenceid,order:L};ab.occurrencerelationships.push(E)}var U=n.getNodeIdFromOccurenceId(r,s);var V=n.getNode(r,U);var A=n.getOccurence(r,s);var W=false;if(P!==null){var x=n.getNodeIdFromOccurenceId(B,P);var M=n.getNode(B,x);if(M.followsParent){at.followsParent=M.followsParent}var u=n.getOccurence(r,p);W=u.actionInfo.reuse&&!u.actionInfo.revise}V.followsParent=at.followsParent;V.onceInstantiable3DShape=at.onceInstantiable3DShape;if(!at.isRevisionable||!at.hasReviseAccess||W||(!this.irpcBehavior&&at.physicalid===V.physicalid)){N.reuse=true}else{A.canBeRevised=true;N.revise=true;var aq=n.getRootOccurenceId(r);if(s!==aq&&!at.followsParent){N.reuse=true}Y.currentRevision=this.irpcBehavior?V.revision:Y.revision;Y.nextRevision=at.nextRevision;Y.currentRevTitle=this.irpcBehavior?V.Title:Y.Title;Y.latestRevTitle=at.latestRevTitle;Y.revision=Y.nextRevision;Y.Title=Y.latestRevTitle}A.actionInfo=N;A.resOccId=C;if(p!==null){A.relId=n.getRelationshipId(r,p,s)}if(P!==null){A.refOccRelId=n.getRelationshipId(B,P,S)}}var aa=n.getChildOccurenceIdsTreeOrder(B,S,this.filterDuplicateInstances);var aj=aa.length;var w=[];if(r!==null&&s!==null){w=n.getChildOccurenceIds(r,s,this.filterDuplicateInstances)}var ai=w.length;var H=[];for(var ao=0;ao<aj;ao++){var J=aa[ao];var t=n.getNodeIdFromOccurenceId(B,J);var G=n.getNode(B,t);var D=null;for(var am=0;am<ai;am++){var ak=w[am];if(H.indexOf(ak)!==-1){continue}var Q=n.getNodeIdFromOccurenceId(r,ak);var af=n.getNode(r,Q);if((af.clonedFromPhysicalid&&af.clonedFromPhysicalid===G.physicalid)||af.physicalid===G.physicalid){D=ak;H.push(D);break}}var ar=ao+1;this.addNode(ab,ae,B,J,r,D,C,S,s,ar,O);n.setOccurenceRelationshipOrder(B,S,J,ar);if(D!==null){n.setOccurenceRelationshipOrder(r,s,D,ar);if(this.filterDuplicateInstances){this.updateMatchingChildOccurrenceData(r,s,D,ar)}}}var ah=H.length;if(ah<ai){var F=aj;for(var al=0;al<ai;al++){var ag=w[al];var z=false;for(var ad=0;ad<ah;ad++){var K=H[ad];if(ag===K){z=true;break}}if(!z){this.addNodeForInsertNew(B,r,ab,ae,s,ag,S,C,F,O)}}}if(Y&&Y.onceInstantiable3DShape){O.shapeNodes.push(Y.nodeid)}return O},updateMatchingChildOccurrenceData:function(q,u,s,r){var v=n.getOccurence(q,s);var p=n.getChildOccurenceIds(q,u,false);var t=p.forEach(function(w){if(w!==s){var x=n.getOccurence(q,w);if(x.nodeid===v.nodeid){x.actionInfo=v.actionInfo;x.canBeRevised=v.canBeRevised;x.resOccId=v.resOccId;n.setOccurenceRelationshipOrder(q,u,w,r)}}})},addNodeForInsertNew:function(K,M,r,C,y,s,F,u,L,z){var v={revise:false,reuse:false,insertnew:true,exclude:false};var q=n.getOccurence(M,s);q.actionInfo=v;if(y!==null){q.relId=n.getRelationshipId(M,y,s)}L=L+1;var t={nodeid:C.refNodeId,physicalid:"0",Title:"",mod:"",type:"",cgrurl:"",attributes:{type_icon_url:""}};K.nodes.push(t);C.refNodeId=C.refNodeId+1;var J={occurrenceid:C.refOccId,nodeid:t.nodeid};C.refOccId=C.refOccId+1;K.occurrences.push(J);if(F!==null){var N={parent:F,child:J.occurrenceid,order:L};K.occurrencerelationships.push(N)}var A=n.getNodeIdFromOccurenceId(M,s);var D=n.getNode(M,A);var x=Object.create(D);var w=null;if(D.clonedFromPhysicalid&&D.clonedFromPhysicalid.length>0){w=n.getNodeFromPhysicalId(K,D.clonedFromPhysicalid)}if(this.irpcBehavior){if(w){x.currentRevision=this.irpcBehavior?D.revision:w.revision;x.nextRevision=w.nextRevision;x.currentRevTitle=this.irpcBehavior?D.Title:w.Title;x.latestRevTitle=w.latestRevTitle;x.revision=w.nextRevision;x.Title=w.latestRevTitle;q.insertedInstance=true;q.actionInfo.insertnew=false;q.actionInfo.revise=true;q.actionInfo.reuse=w.followsParent?false:true}else{x.currrentRevision=x.revision;x.firstRevision=D.firstRevision;x.revision=x.firstRevision}}x.nodeid=C.resNodeId;r.nodes.push(x);var E={occurrenceid:C.resOccId,nodeid:x.nodeid};E.refOccId=J.occurrenceid;r.occurrences.push(E);q.resOccId=C.resOccId;C.resNodeId=C.resNodeId+1;C.resOccId=C.resOccId+1;if(u!==null){var B={parent:u,child:E.occurrenceid,order:L};r.occurrencerelationships.push(B)}if(D.onceInstantiable3DShape){x.onceInstantiable3DShape=t.onceInstantiable3DShape=D.onceInstantiable3DShape;z.shapeNodes.push(x.nodeid);this.refReviseFromTree.shapeNodes.push(t.nodeid)}n.setOccurenceRelationshipOrder(M,y,s,L);if(this.filterDuplicateInstances){this.updateMatchingChildOccurrenceData(M,y,s,L)}var H=n.getChildOccurenceIds(M,s,this.filterDuplicateInstances);var G=H.length;for(var I=0;I<G;I++){var p=H[I];this.addNodeForInsertNew(K,M,r,C,s,p,J.occurrenceid,E.occurrenceid,L,z)}},_renderDuplicateTree:function(p,q){this.srcReviseFromTree=new a([p],this.tenant,this.context,this.filterDuplicateInstances);this.srcReviseFromTree.addEvent("onTreeCreated",this._handleSrcTreeCreated.bind(this));this.srcReviseFromTree.addEvent("onError",this._handleError.bind(this));this.srcReviseFromTree.openAdvancedTree(q,{addActionCol:true,getChildrenInTreeOrder:false})},_renderSelectionList:function(r,v){var u=this;var p=null;var t=d.get3DSpaceBaseUrl(u.tenant);document.body.style.cursor="wait";var s="DS/CompareWidget/PickDialog";var q="i18n!DS/CompareWidget/assets/nls/CompareWidget";require([s,q],function(A,z){var x=z.noRevision;var w=z.noAlternateDesign;z.noRevision=e.noRevisions;z.noAlternateDesign=e.noDuplicates;document.body.style.cursor="default";p=new A(r,v,t,"passport",u.irpcBehavior?false:true);u.onCompleteFnArr.push(function(){z.noRevision=x;z.noAlternateDesign=w});var y=widget.getValue(u.activePDTabNameWidgetPref);if(!y){y="alternateDesignsFacet"}if(u.pickDialog===null){var B={physicalid:u.physicalIds[0]};p.load(B,function(D){var C=r.getElement(u.activePDTabElPath);if(C){u.activePDTabName=C.dataset.name}u._renderDuplicateTree(D.physicalid,r)},y,u.irpcBehavior?false:true,u.irpcBehavior?"all":"direct",u.irpcBehavior?"all":"derivedFrom",u.context,u.tenant,true,false);u.pickDialog=p}},function(w){document.body.style.cursor="default";u.showNotification(e.commandNotSupported,"error");u._onComplete()})},clone:function(p){return JSON.parse(JSON.stringify(p))},addRelationsAndAppendInstances:function(t,r,p,u){p.sort();u.sort();var v=Math.max(p.length,u.length);for(var q=0;q<v;++q){var s=r;if(q>0){s=this.clone(r);t.push(s)}s.rel_physicalid=p.length>q?p[q]:null;s.rel_physicalid_dup=u.length>q?u[q]:null}},attachRelationships:function(u){var r=u.length;for(var v=0;v<r;++v){var z=n.getNodeFromPhysicalId(this.refReviseFromTree.assembly,u[v].physicalid);var s=n.getNodeFromPhysicalId(this.srcReviseFromTree.assembly,u[v].physicalid_dup);if(u[v].hasOwnProperty("children")){var w=u[v].children.length;for(var t=0;t<w;++t){var p=n.getNodeFromPhysicalId(this.refReviseFromTree.assembly,u[v].children[t].physicalid);var y=n.getNodeFromPhysicalId(this.srcReviseFromTree.assembly,u[v].children[t].physicalid_dup);var x=[];var q=[];if(z!==null&&p!==null){x=n.getRelationships(this.refReviseFromTree.assembly,z.nodeid,p.nodeid)}if(s!==null&&y!==null){q=n.getRelationships(this.srcReviseFromTree.assembly,s.nodeid,y.nodeid)}this.addRelationsAndAppendInstances(u[v].children,u[v].children[t],x,q)}}}},createNewRevision:function(){var p={};p.data=this.srcReviseFromTree.getNewRevFromData(!this.filterDuplicateInstances,this.irpcBehavior);p.folderid=this.folderId;if(this.filterDuplicateInstances){this.attachRelationships(p.data[0].treeData)}document.body.style.cursor="wait";this.controller.createNewRevisionFrom(p)},showNotification:function(p,r){if(typeof this.context.displayNotification==="function"){var q={eventID:typeof r==="string"?r:"primary",msg:p};this.context.displayNotification(q)}else{alert(p)}},showError:function(q){if(typeof this.context.displayNotification==="function"){var p={eventID:"error",msg:q};this.context.displayNotification(p)}else{alert(q)}}});return l});