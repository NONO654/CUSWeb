define("DS/DELPPWWebServices/CommonService",["UWA/Core","UWA/Class","UWA/Date","DS/WebappsUtils/WebappsUtils","DS/DELPPWModelServices/ModelUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DELPPWLoggerModel/LoggerUtils"],function(c,p,q,b,a,e,h,g){var r=p.extend({name:"CommonService",_servicesURL:{"3DSpace":"NOT_DEFINED","3DSearch":"NOT_DEFINED"},_platformId:{"3DSpace":"NOT_DEFINED","3DSearch":"NOT_DEFINED"},_3DSpaceServiceName:"3DSpace",_defaultSecurityContext:"ctx::FakeDefaultRole.FakeDefaultOrga.FakeDefaultCommonSpace",init:function o(){g.debug(this.name,"initialized")},getDefault3DSpaceBaseURL:function n(){var v=/^(https?:\/\/)?([\da-z\.-]+)(:[0-9]{2,5})?([\/\w \.-]*3DDashboard\/)*/,x=b.getWebappsBaseUrl(),w=x.match(v),u="";if(c.is(w)&&c.is(w,"array")){u=(c.is(w[1])?w[1]:"")+w[2]+(c.is(w[4])?"":w[3])+(c.is(w[4])?w[4].replace(/3DDashboard\/?/,"3DSpace/"):"/3DSpace/")}return u},getPlatformID:function m(u){var v=null;u=u||{serviceId:this._3DSpaceServiceName};if(c.is(u.serviceId,"string")){v=this._platformId[u.serviceId]}else{g.debug(this.name,"ERROR: Couldn't retrieve the platform ID")}return v},get3DSpaceServiceName:function f(){return this._3DSpaceServiceName},get3DSpaceUrl:function l(){if("NOT_DEFINED"===this._servicesURL[this._3DSpaceServiceName]){this._servicesURL[this._3DSpaceServiceName]=this.getDefault3DSpaceBaseURL()}return this._servicesURL[this._3DSpaceServiceName]},getTimeoutPreference:function i(){return a.getTimeoutPreference()},setSecurityContext:function j(v){var u="ctx::";g.debug("setDefaultSecurityContext: "+c.Json.encode(v));this._defaultSecurityContext=c.is(v)?u+v:""},getSecurityContext:function k(){return this._defaultSecurityContext},getHeaders:function d(u){var B="en",w=u||{},y=c.is(w.isJsonOnly)?w.isJsonOnly:false,v=c.is(w.isAuthoringCtx)?w.isAuthoringCtx:false,x=c.is(w.minorVersion)?w.minorVersion:"",A=this._getAuthoringContextHdr(),z={"Accept-Language":c.is(widget)?(c.is(widget.lang,"string")?widget.lang:B):B,SecurityContext:this.getSecurityContext()};if(y){z.Accept="application/json";z["Content-Type"]="application/json"}else{z.Accept="application/json,text/javascript,*/*";z["Content-Type"]="application/ds-json"}if(v){z=c.extend(z,A)}if(""!==x){z["DS-API-Version"]=x}return z},_getAuthoringContextHdr:function s(){var v=e.get(),u=c.is(v)?c.is(v.AuthoringContextHeader)?v.AuthoringContextHeader:{}:{};return u},_retrieveServiceURL:function t(u,y,v){var w=this,z=c.is(widget)?(c.is(widget.getValue,"function")?widget.getValue("x3dPlatformId"):""):"";h.getServiceUrl({serviceName:u,platformId:z,onComplete:function x(A){if(c.is(A,"array")){if(A.length>0){if(c.is(A[0].url)){w._servicesURL[u]=A[0].url+(u===w._3DSpaceServiceName?"/":"");w._platformId[u]=A[0].platformId}}}else{if(c.is(A,"string")){w._servicesURL[u]=A+(u===w._3DSpaceServiceName?"/":"");w._platformId[u]=""}}y()},onFailure:v})}});return r});define("DS/DELPPWWebServices/WebService",["UWA/Core","UWA/Class","UWA/Class/Promise","UWA/Date","DS/WAFData/WAFData","DS/DELPPWLoggerModel/LoggerUtils",],function(d,a,f,h,g,b){var i,c=a.extend({name:"Webservice",_webServicesCount:1,init:function j(p,q,o){var l=this;i=p.commonService;f.all([new f(function k(s,r){i._retrieveServiceURL("3DSpace",s,r)})]).then(function n(){q()},function m(r){b.debug(r);o()})},webServiceRequest:function e(r){var s=/^https?:\/\//i,u=this,v,t,p,m,n,l,o,k,q;if(!d.is(r)){b.debug(this.name,"iOptions must exist in Webservice.webServiceRequest call.");return}if(!d.is(r.url,"string")){b.debug(this.name,"iOptions.url must be a string in Webservice.webServiceRequest call.");return}if(!d.is(r.method,"string")){b.debug(this.name,"iOptions.method must be be defined in Webservice.webServiceRequest call.");return}v=s.test(r.url)?r.url:(i.get3DSpaceUrl()+"resources/"+r.url);t=d.is(r.type)?r.type:"json";p=d.is(r.data)?r.data:null;m=d.is(r.headers)?r.headers:i.getHeaders();n=d.is(r.async)?r.async:true;l=d.is(r.context)?r.context:this;o=d.is(r.noProxy)?null:"passport";k=d.is(r.authenticated)?r.authenticated:true;q=i.getTimeoutPreference();document.body.style.cursor="wait";(function(){var y=h.now(),w=u._webServicesCount+"-START- "+r.url+" request / Time: "+new h(y).toISOString(),F=u._webServicesCount+"-END- "+r.url+" request",E=u._webServicesCount+"-FAIL- "+r.url+" request",x=u._webServicesCount+"-TIME OUT- "+r.url+" request",J,G,C,H,z,B,D,I,A;G=function G(K,L){document.body.style.cursor="default";D=h.now();B=D-y;z=" / Duration: "+B+" ms";I=F+z;b.debug(I);if(d.is(r.onComplete)){r.onComplete.call(l,K,L)}if(d.is(r.logMessage)){b.debug(r.logMessage)}};C=function C(M,L,K){document.body.style.cursor="default";b.debug(E);b.debug(M);if(d.is(r.onFailure)){r.onFailure.call(l,M,L,K)}if(d.is(r.logMessage)){b.debug(r.logMessage+L)}};H=function H(K){document.body.style.cursor="default";b.debug(x);b.debug(K);if(d.is(r.onTimeout)){r.onTimeout.call(l,K)}if(d.is(r.logMessage)){b.debug(r.logMessage)}};b.debug(w);J={headers:m,method:r.method,type:t,onComplete:G,data:p,onFailure:C,onTimeout:H,async:n};if(!r.noProxy){J.proxy=o}if(d.is(q)){J.timeout=q}if(d.is(r.logMessage)){b.debug(r.logMessage)}if(k){b.debug("Call to WAFData.authenticatedRequest(URL, options): ",v+", "+d.Json.encode(J));g.authenticatedRequest(v,J)}else{b.debug("Call to WAFData.proxifiedRequest(URL, options): ",v+", "+d.Json.encode(J));g.proxifiedRequest(v,J)}u._webServicesCount++})()}});return c});define("DS/DELPPWWebServices/WebserviceUtils",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/DELPPWModelServices/ModelUtils","DS/DELPPWWebServices/CommonService","DS/DELPPWWebServices/WebService","DS/DELPPWLoggerModel/LoggerUtils"],function(e,u,d,c,v,r,h){var x,k;var s=u.singleton({name:"WebserviceUtils",_xmlCache:null,_xmlConfiguration:null,_custoParamSetPID:null,init:function t(y){y=y||{};this.options=y},setup:function p(A,z){var y;k=new v();if(true===c.isStandAlone()){y=["DS/DELPPWWebServicesTst/StandaloneService","DS/DELPPWWebServicesTst/StandaloneModelService"];require(y,function(C,B){x=new C({commonService:k});e.extend(s,B);s.initStorage({StandaloneService:x});A()})}else{x=new r({commonService:k},A,z)}},getTenant:function m(){return k.getPlatformID()},get3DSpaceUrl:function o(){return k.get3DSpaceUrl()},getWebServicesURL:function i(){return k.get3DSpaceUrl()+"resources/modeler/pprirpc"},setXMLConfiguration:function w(z,y){this._xmlCache={};this._xmlConfiguration=z;this._custoParamSetPID=y},fetchXMLValues:function b(A,E,D){var G=this,H,F=e.is(this._custoParamSetPID)?"&custoParamSetPID="+this._custoParamSetPID:"",B=function y(I){h.debug(G.name,"WebserviceUtil._fetchXMLValues(), REQUEST: "+A);if(e.is(I)){G._xmlCache[A]=I.fileContent;if(e.is(E)){E(G._xmlCache[A])}h.debug(G.name,G._xmlCache[A])}else{h.debug(G.name,"configurationXML response data is undefined for requested  XML Key : "+A)}},z=function C(I){h.debug(G.name,"!!! WebserviceUtil._fetchXMLValues(), ERROR: "+A);h.debug(I);if(e.is(D)){D(I)}};if(e.is(this._xmlConfiguration[A])){H=this._xmlConfiguration[A]}else{z("xmlKey is not defined in configurationXML  : "+A);return}H=H.split("/");if(!(e.is(H,"array")&&(H.length===2))){z("xmlPath is not correctly defined in configurationXML  : "+A);return}this.webServiceRequest({url:"modeler/ppr/configurationXML?frameworkName="+H[0]+"&fileName="+H[1]+".xml"+F,method:"GET",onComplete:B,onFailure:z})},getXMLValues:function l(A,y,z){var D,B={dataCache:[],convert:function C(G,F){var I=G.split("."),H=this,E;if(!e.is(this.dataCache[F])){for(E=0;E<I.length;++E){if(!e.is(H[I[E]])){H=null;break}else{H=H[I[E]]}}if(e.is(H)){if(!(e.typeOf(H)==="array")){H=[H]}this.dataCache[F]={};for(E=0;E<H.length;++E){this.dataCache[F][H[E][F]]=H[E];delete this.dataCache[F][H[E][F]][F]}}}return this.dataCache[F]}};if(e.is(this._xmlCache[A])){D=e.merge(this._xmlCache[A],B);if(e.is(y,"function")){y(e.clone(D))}}else{if(e.is(z,"function")){z("xmlKey is not defined in configurationXML  : "+A)}}return e.clone(D)},webServiceRequest:function a(y){return x.webServiceRequest(y)},setSecurityContext:function j(y){return k.setSecurityContext(y)},get3DSpaceServiceName:function g(){return k.get3DSpaceServiceName()},getPlatformID:function q(y){return k.getPlatformID(y)},getSecurityContext:function n(){return k.getSecurityContext()},getHeaders:function f(y){return k.getHeaders(y)}});return s});