define("DS/RevisionFamily/RevisionFamilyModel",["UWA/Controls/Abstract","DS/LifecycleServices/ArrayFunctions"],function(c,b){var a=c.extend({init:function(){this.objects={};this.currentObject={}},setCurrentObject:function(d){if(this.currentObject!==d){this.currentObject=d}},getCurrentObject:function(){return this.currentObject},setObjects:function(e){var d=JSON.parse(e);if(d.hasOwnProperty("data")){this.objects=d.data;var f=this.objects.find(function(g){if(g.id===this.currentObject.id){return true}return false},this);if(f!=null){this.setCurrentObject(f)}}},getObjects:function(){return this.objects},removeObjects:function(d){if(!UWA.is(d,"array")){return}d.forEach(function(e){this.removeObject(e)},this)},removeObject:function(e){var d=0;for(;d<this.objects.length;++d){if(this.objects[d].id===e){this.objects.splice(d,1);return}}},setObjectsInternal:function(d){this.objects=d},getObjectTitle:function(d){for(var e=0;e<this.objects.length;++e){if(this.objects[e].id===d){return this.objects[e].displayName}}},objectIsInModel:function(d){for(var e=0;e<this.objects.length;++e){if(this.objects[e].id===d){return true}}return false},});return a});define("DS/RevisionFamily/RevisionFamilyController",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/RevisionFamily/RevisionFamilyModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(h,c,e,d,f,a,g){var b=h.extend({tenant:null,init:function(){this.model=new e()},initTree:function(j){var i=this;d.getSecurityContextPromise(this.tenant).then(function(k){i.getRevisionHistory(j,k)})},getRevisionHistory:function(k,j){if(!k.hasOwnProperty("physicalid")){return}var i=this;var l=f.get3DSpaceWSUrl(i.tenant,"/resources/lifecycle/revision/family",null);a.authenticatedRequest(l,{method:"GET",type:"text",headers:f.getHeaders(encodeURIComponent(j)),timeout:600000,data:"physicalid="+k.physicalid,onComplete:function(m){i.model.setObjects(m);i.dispatchEvent("onTreeInfoChanged");i.dispatchEvent("onCompleteGetRevisionHistory")},onFailure:function(m,n){i.dispatchEvent("onError",d.parseWebServiceError(m,n))},ontimeout:function(){i.dispatchEvent("onError",g.connectionTimeout)}})},setTenant:function(i){this.tenant=i}});return b});define("DS/RevisionFamily/RevisionFamily",["css!DS/RevisionFamily/RevisionFamily","UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/ApplicationFrame/CommandsManager","DS/LifecycleCmd/CommandAPI","DS/RevisionFamily/RevisionFamilyModel","DS/UIBehaviors/ContextualMenuManager","DS/Menu/Menu","DS/WebInWinHelper/WebInWinHelper","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","WebappsUtils/WebappsUtils","DS/ENO6WPlugins/jQuery","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/LifecycleServices/LifecycleAlert"],function(a,k,t,n,x,h,c,o,g,f,m,p,d,w,b,j,q,s,r,u,i){var e=false;var v="PushItem";var l=t.extend({context:null,currentObject:undefined,defaultOptions:{wintop:false,},WebToWinComSocket:null,ContextualMenuData:null,init:function(D,y,A,z,B){var C=this;this.widget=D;this.bottomMargin=A;b.getHistoryConfigPromise().then(function(E){u.historyConfig=E},function(){u.historyConfig=null});this._parent(z);this._buildSkeleton();this._getParentContainer=function(){if(y){return y}else{return k.Element.getElement.call(D.body,".history_popup")}};this.parentWidget=y;this.contextMenuObject=null;if(C.options.wintop==true){this.WebToWinComSocket=z.webToWinComSocket}this.context=B;this.id=Date.now()},updateObjectTitle:function(y,A){var z=document.getElementById(this.getUniqueHtmlIdForNode(y));if(z){z.textContent=A+"\u00A0"}},getUniqueHtmlIdForNode:function(y){return y+"revision"},showCompare:function(D,C){var A=this;if(A.options.wintop==true){if(A.ContextualMenuData!=null){p.launchWinCompare(A.WebToWinComSocket,D,C)}}else{var F=[];var B=widget.getValue("x3dPlatformId");if(null!==D){F.push({envId:B,serviceId:"",contextId:"",objectId:D.id,objectType:"",displayName:""})}if(null!==C){F.push({envId:B,serviceId:"",contextId:"",objectId:C.id,objectType:"",displayName:""})}if(F.length>0){var y={envId:B,protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:F}};var z=new n.Socket("compassPageSocket");z.subscribeServer("com.ds.compass",window.parent);z.dispatchEvent("onSetX3DContent",y,"compassPageSocket");z.addListener("launchApp",function(G){console.log("Response = "+JSON.stringify(G));this.response=G.response});var E={appId:"ENOCOMP_AP"};z.dispatchEvent("onLaunchApp",E,"compassPageSocket")}}},_buildSkeleton:function(){var B=this;var C=this.elements.container=k.createElement("div");C.className="revision-main";C.setAttribute("data-rec-id",C.className);this.revisionTab=document.createElement("div");this.revisionTab.className="revision-table";this.revisionTab.setAttribute("data-rec-id",this.revisionTab.className);var y=document.createElement("div");y.className="revision-NLVView";y.setAttribute("data-rec-id",y.className);this.revisionTab.NLVView=y;this.revisionTab.appendChild(y);C.appendChild(this.revisionTab);this.revisionTab.NLVView.style.display="block";var z=k.createElement("div",{"class":"revisionFamilyNLVViewContainer"});z.setAttribute("data-rec-id","revisionFamilyNLVViewContainer");z.inject(y);var A=r.SELECTION_MODES.SINGLE_SELECT_ONLY;if(B.options.clientOptions!==undefined&&B.options.clientOptions.Multiselect==="true"){A=r.SELECTION_MODES.MULTI_SELECT_ONLY}if(!(B.options.clientOptions!==undefined&&B.options.clientOptions.NoContextMenu==="true")){A=A|r.SELECTION_MODES.WITH_COMMANDS}B.versionExplorer=new s({versionGraphContainer:z,selectionMode:A,customOnDrop:function(D){B.dispatchEvent("DropEvent",D)},widget:B.options.wintop===true?undefined:B.widget,autoUpdate:false});B.versionExplorer.subscribeEvent("select",function(D){B.onSelectForVersionExplorer(D.data.nodeModel)},false);B.versionExplorer.subscribeEvent("unselect",function(D){B.onUnSelectForVersionExplorer(D.data.nodeModel)},false);B.versionExplorer.subscribeEvent("ENOXVersionExplorerDropdownMenu",function(D){var E=D.data||D;B.onPickContextForVersionExplorer(E.treeNode,E.selectedNodes,E.position)},true);B.versionExplorer.subscribeEvent("ENOXVersionExplorerError",function(E){var D={eventID:"error",msg:d.objectNotFound};i.displayNotification(D)},false)},onResize:function(y){},_updateHistoryTree:function(){var y=this;this.revisionTab.style.display="none";this.revisionTab.style.display="block";this.dispatchEvent("ModelUpdated",this.currentObject);b.getSecurityContext(w.getTenant(),function(A){var z={displayLegend:false};if(u.historyConfig&&u.historyConfig.settings){if(u.historyConfig.settings.defaultView){z.displayMode=r.DISPLAY_MODES[u.historyConfig.settings.defaultView]}if(u.historyConfig.settings.thumbnailGraph){if(u.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout){z.thumbnailGraphLayout=u.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout}if(u.historyConfig.settings.thumbnailGraph.displayThumbnailOverview){z.displayThumbnailOverview=u.historyConfig.settings.thumbnailGraph.displayThumbnailOverview==="true"}}if(u.historyConfig.settings.subwayGraph){if(u.historyConfig.settings.subwayGraph.subwaySort){z.subwaySortAscending=u.historyConfig.settings.subwayGraph.subwaySort==="asc"}if(u.historyConfig.settings.subwayGraph.viewMode==="SUBWAY_COMPACT_VIEW"||u.historyConfig.settings.subwayGraph.viewMode==="SUBWAY_COMFORTABLE_VIEW"){z.subwayViewMode=u.historyConfig.settings.subwayGraph.viewMode}}}u.loadUserSettingsPromise(z).then(function(){y.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:y.currentObject.id,tenantId:y.tenant,securityContext:A,type:y.currentObject.type,context:y.context,onComplete:function(){var B=false;if(y.options.clientOptions!==undefined){if(y.options.clientOptions.SelectAnyRevison==="false"){var E=y.versionExplorer.applyFilter(function(G){var F=true;if(y.options.clientOptions.ActiveObjectSelectable==="false"){F=y.currentObject.id!==G._options.id}if(F===true){F=G._options.grid.__isLeaf__===true}return F});if(E.length===1){y.versionExplorer.unselectAll();E[0].select();if(y.options.clientOptions!==undefined&&y.options.clientOptions.AutoFire==="true"){B=true}}}else{if(y.options.clientOptions.ActiveObjectSelectable==="false"){var E=y.versionExplorer.applyFilter(function(F){return y.currentObject.id!==F._options.id});if(E.length===1){y.versionExplorer.unselectAll();E[0].select();if(y.options.clientOptions!==undefined&&y.options.clientOptions.AutoFire==="true"){B=true}}}else{y.versionExplorer.select(y.currentObject.id)}}}var D=y.versionExplorer.getSelectedNodes();var C={selectedNodes:D,autoFire:B};y.versionExplorer.reframeAll();y.dispatchEvent("onVersionExplorerLoaded",C)},dataModelType:(y.options.clientOptions!==undefined&&y.options.clientOptions.modelRevisions==="true")?r.DATA_MODEL_TYPES.MODEL_REVISION:r.DATA_MODEL_TYPES.MODEL_HISTORY})},function(B){console.log(B)})},function(z){console.log(z)});y.onResize()},displayError:function(y){var z=this;document.body.style.cursor="default";z.showError(y)},showError:function(z){if(this.context!==undefined&&this.context!==null){if(this.hasOwnProperty("context")&&typeof this.context.displayNotification==="function"){var y={eventID:"warning",msg:z};this.context.displayNotification(y)}}},setObjects:function(A){if(A.length===0){this.displayError(d.noObject)}else{if(A.length===1){var B={};B.data=A;var z=A[0];if(z.hasOwnProperty("physicalid")&&z.physicalid===""){this.displayError(d.epmtyPhysicalId)}else{this.tenant=z.tenant;if(z.hasOwnProperty("displayName")&&z.displayName&&z.displayName.trim().length>0){var y=z.type;this.currentObject={id:z.physicalid,displayName:z.displayName,revision:z.revision,type:y}}else{var y=z.type;this.currentObject={id:z.physicalid,type:y}}this._updateHistoryTree();this.dispatchEvent("onDataUpdated",this.currentObject)}}else{this.displayError(d.multipleSelection)}}},onSetCtxMenuForItem:function(y){var z=this;z.ContextualMenuData=p.parseContextualMenu(y);if(z.contextMenuObject!=null){if(!this.options.wintop){w.isOpenWithCATIAV5Available(function(A){z.doPickContext(z.contextMenuObject,A)})}else{z.doPickContext(z.contextMenuObject)}}},onSelectForVersionExplorer:function(E){var D=this;var A=D.versionExplorer.getSelectedNodes();var z=E._options.id;var y=E._options.label;var C=E._options.grid.code;if(this.options.clientOptions!==undefined&&this.options.clientOptions.ActiveObjectSelectable==="false"){if(this.currentObject.id===z){if(A.length===1){D.versionExplorer.unselectAll()}return}}var B={data:{physicalid:z,displayName:y,revision:C,tenant:D.tenant,selectedNodes:A}};D.dispatchEvent("onSelectedObject",B)},onUnSelectForVersionExplorer:function(E){var D=this;var A=D.versionExplorer.getSelectedNodes();var z=E._options.id;var y=E._options.label;var C=E._options.grid.code;var B={data:{physicalid:z,displayName:y,revision:C,tenant:D.tenant,selectedNodes:A}};D.dispatchEvent("onUnSelectedObject",B)},onPickContextForVersionExplorer:function(A,C,B){var y=this;if(!(y.options.disableContextMenu===true)){y.contextMenuObject=k.merge({pos:[B.x,B.y],selectedNodes:C},A.options.data);var z=[];z.push(A.options.data);if(y.options.wintop===true){p.fetchContextFromSelection(y.WebToWinComSocket,z)}else{w.isOpenWithCATIAV5Available(function(D){y.doPickContext(z[0],D)})}}},_showOpenInCATIAMenu:function(y){try{if(y.options.wintop){return false}if(b.isInPSEditorWidget(y.context.widget)){return false}if(b.isInXCADEditorWidget(y.context.widget)){return true}if(b.isDECType(y.contextMenuObject.type)){return true}return false}catch(z){return true}},doPickContext:function(X,U){var V=this;var K=this;if(V.context.hasOwnProperty("widget")){V._isWidget=true}else{V._isWidget=false}var S=[];function y(aj,ak){var am=j.getWebappsBaseUrl();var al=ak||"RevisionFamily";return"url("+am+al+"/assets/icons/32/"+aj+")"}var G;var H=j.getWebappsBaseUrl()+"RevisionFamily/assets/icons/32/";var ac=false;var J=K.versionExplorer.getSelectedNodes();for(var af=0;af<J.length;af++){var aa=J[af];if(aa._options.id===X.physicalid){ac=true;break}}for(var af=0;af<K.contextMenuObject.selectedNodes.length;af++){var aa=K.contextMenuObject.selectedNodes[af];if(aa._options.id===X.physicalid){ac=true;break}}if(K.contextMenuObject){if(K.options.wintop==true){var P=K.ContextualMenuData[0];var F=V.contextMenuObject.displayName;var Z={id:V.contextMenuObject.physicalid,displayName:F};p.onBuildWinContextMenu(K.WebToWinComSocket,P,S,Z)}else{var T=true;var ai=c.getCommand("HistoryHdr",widget);if(ai&&ai.isEditMode===false){T=false}for(var af=0,L=o.commands.length;af<L;af++){var ag=o.commands[af];if((V._isWidget&&ag==="MaturityHdr")){continue}if((ag==="Properties"||ag==="DeleteHdr"||ag==="ReviseFromHdr"||ag==="MaturityHdr"||ag==="RevisionHdr"||ag==="NewBranchHdr"||ag==="DuplicateHdr")&&T===false){continue}if(o.checkAvailability(ag,[V.contextMenuObject],K,V.options.context)){S.push({label:o.getTitle(ag),icon:o.getIcon(ag),callback:o.getCallbackFunction(ag,[V.contextMenuObject],K,V.options.context)})}}S.push({label:d.whereUsed,icon:y("ENORIPE32.png","FolderEditor"),callback:function ab(){var ak=require("DS/PADUtils/PADCommandProxy");var aj=ak.create();require(["DS/PADUtils/PADUtilsServices"],function(ap){var am=[];am.push({envId:"",serviceId:"",contextId:"",objectId:V.contextMenuObject.physicalid,objectType:V.contextMenuObject.type,displayName:V.contextMenuObject.displayName});var al={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:am}};var ao={attributes:{},paths:[],version:"1.1"};var an=new n.Socket("compassPageSocket");an.subscribeServer("com.ds.compass",window.parent);an.dispatchEvent("onSetX3DContent",al,"compassPageSocket");an.addListener("launchApp",function(aq){aj.select(ao);aj.destroy();console.log("Response = "+JSON.stringify(aq))});an.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")})}});if(this._showOpenInCATIAMenu(K)){S.push({label:d.openCATIA,icon:y("ENOV5MA_AP_AppIcon.png","FolderEditor"),callback:function ad(){x.mask(V._getParentContainer(),d.openCATIALaunchMessage);require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(am,ao){var ak={version:"1",structures:{references:[],connections:[],trees:{}}};ak.structures.references.push({localid:"0",physicalid:K.contextMenuObject.physicalid,type:"CATProduct"});ak.structures.trees["0"]={selected:true};var al={data:ak,onComplete:function(ap){var ar=k.is(ap,"string")?JSON.parse(ap):ap;am.setStructure_4_open_in_cv5({completeselection:ar});var aq=new n.Socket("compassPageSocket");aq.subscribeServer("com.ds.compass",window.parent);aq.addListener("launchApp",function(at){console.log("Response = "+JSON.stringify(at));x.unmask(V._getParentContainer())});aq.dispatchEvent("onLaunchApp",{appId:"ENOV5MA_AP"},"compassPageSocket")},onFailure:function(ap){console.error("PADWSAccess.completeselection",ap);x.unmask(V._getParentContainer())},timeout:0};if(V._isWidget){console.log("isWidget true, initialize PADSettingsMgt and PADUtilsServices");var aj=require("DS/PADUtils/PADSettingsMgt");aj.set_app_context("enopad");am.app_initialization(function an(){ao.completeselection(al)})}else{ao.completeselection(al)}})}})}if(V._displayOpenWithCATIAV5(K,U)){var ae=function(aj){b.getSecurityContext(w.getTenant(),function(al){x.mask(V._getParentContainer(),d.openCATIALaunchMessage);var ak={objectId:K.contextMenuObject.physicalid,envId:w.getTenant(),contextId:al};require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(an){var ao={};ao.version="2.1";ao.results=[{id:"0",phid:K.contextMenuObject.physicalid}];ao.structures=[{structure:[{id:"0",show:true,select:true,children:[]}]}];ao.viewpoint=[];var am=an.get();if(am){ao.workUnder=am}var ap=JSON.stringify(ao);require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(aq){var ar=new n.Socket("compassPageSocket");ar.subscribeServer("com.ds.compass",window.parent);ar.addListener("launchApp",function(au){console.log("Response = "+JSON.stringify(au));x.unmask(V._getParentContainer())});if(ao.workUnder!==undefined&&ao.workUnder.AuthoringContextHeader){var at={appId:"MAP-CATCDVEAP",fileContent:ap,fileName:"-file",widgetId:K.id,envId:w.getTenant(),contextId:al};aq.publish("resetObject");ar.dispatchEvent("onLaunchApp",at,"compassPageSocket")}else{aq.publish("setObject",ak);ar.dispatchEvent("onLaunchApp",{appId:"MAP-CATCDVEAP"},"compassPageSocket")}})})},function(ak){console.error("_displayOpenWithCATIAV5",ak);x.unmask(V._getParentContainer())})};var ah={title:d.OpenWith,label:d.openCATIA,icon:y("ENOV5MA_AP_AppIcon.png","FolderEditor"),type:v,callback:ae,submenu:[{type:v,title:d.OpenWithCV5,icon:"url("+j.getWebappsAssetUrl("ENXNav","icons/ENOV5MA_AP_AppIcon.png")+")",action:{"this":K,callback:ae}}]};if(e){ah.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export",family:WUXManagedFontIcons.Font3DS,};ah.icon=undefined}S.push(ah)}}var I=true;if(J.length==0){I=false}if(!ac&&I){G="url("+H+"I_Compare.png)";var z=function O(){var aj;if(J.length>0){var ak=J[0];K.showCompare({id:ak._options.id},{id:V.contextMenuObject.physicalid})}};var E={callback:z,"this":K};S.push({title:d.compare,label:d.compare,type:v,icon:G,action:E,callback:z})}if(K.options.wintop!=true){var A=function(aj){if(aj===undefined){return false}if(aj.indexOf("Workspace")>=0||aj==="ENOCLG_LibraryReference"||aj.indexOf("Folder")>=0){return true}return false};var Q;if(A(V.contextMenuObject.type)){Q=["select","properties","|","delete_","|","whereUsed"]}else{Q=["select","properties","compare","|","maturity","newRevision","newRevisionFrom","newBranch","delete_","duplicate","|","whereUsed","openCATIA"]}S=Q.map(function(aj){if(aj==="|"){return{type:(e?"SeparatorItem":"separator")}}return S.find(function(ak){return d[aj]===ak.label})}).filter(function(aj){return aj});var Y=false;var N=[];var M=S.length;for(var R=0;R<M;R++){if((S[R].type==="SeparatorItem")||(S[R].type==="separator")){if(N.length===0||Y===true){continue}N.push(S[R]);Y=true}else{N.push(S[R]);Y=false}}S=N;if(e){S=S.map(function(aj){return typeof aj.type==="string"?aj:k.extend(aj,{title:aj.label,type:v,action:{"this":K,callback:aj.callback}})})}}}var Z;if(K.options.wintop==true){var C=(window.location.search.indexOf("touch")>=0);var B=(window.location.search.indexOf("replace")>=0);var D={target:Z,nodes:S};var W={input:C?"touch":"mouse",position:{x:K.contextMenuObject.pos[0],y:K.contextMenuObject.pos[1]},submenu:(S.length==1)?"outside":(B?"replace":"auto")};m.show(S,W)}else{var D={target:Z,nodes:S};var W={input:C?"touch":"mouse",position:{x:K.contextMenuObject.pos[0],y:K.contextMenuObject.pos[1]},submenu:(S.length==1)?"outside":(B?"replace":"auto")};if(e){m.show(S,W)}else{f.show(D,K.contextMenuObject.pos)}}},_displayOpenWithCATIAV5:function(y,A){try{if(y.options.wintop){return false}if(b.isInPSEditorWidget(y.context.widget)){return false}if(b.isInXCADEditorWidget(y.context.widget)){return false}if(b.isDECType(y.contextMenuObject.type)){return false}return true}catch(z){return false}},cleanup:function(){this.versionExplorer.cleanup()}});return l});