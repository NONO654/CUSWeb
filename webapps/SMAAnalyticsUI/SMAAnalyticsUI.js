define("DS/SMAAnalyticsUI/SMAAnalyticsOptimizeSettings",["UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/Tweakers/TypeRepresentationFactory","UWA/Json"],function(g,d,c,f){function b(h){return new Promise(function(j,i){require(["text!SMAProcWebExtensions/assets/extensions/SMAWflOptimization"+h+"/descriptor.xml"],function(m){var n=g.Json.xmlToJson(m);var l=n["wfext:Extension"]["Properties"]["Property"];for(var k=0;k<l.length;k++){if(l[k].name==="Technique Options"){j(l[k]["Property"]);return}}i("Technique options not found.")})})}var e=["Asa","Mops"];var a=function(i){var h=this;this.ready=new Promise(function(k){h.savedSettings={};for(var j=0;j<e.length;j++){h.savedSettings[e[j]]={}}h.selectedTechnique;h.improvementsOnly;Promise.all(e.map(b)).then(function(l){var m=new f();m.onReady=function(){var q=new g.Element("div");var s=new d({title:"Settings",content:q,height:200,resizableFlag:true,visibleFlag:false,closeButtonFlag:false,buttons:{Ok:new c({onClick:function(){s.hide();if(h.onClick){h.onClick()}}})}});h.show=function(){s.show()};h.hide=function(){s.hide()};h.isVisible=function(){return s.visibleFlag};s.inject(i);var n=new g.Element("table");n.inject(q);var w=new g.Element("tr");w.inject(n);g.Element("td",{text:"Display"}).inject(w).colSpan=2;var t=function(x){x.style.paddingLeft="2em"};var u=[];u.push(m.generateView(false,{}).then(function(y){var z=new g.Element("tr");z.inject(n);t(g.Element("td",{text:"Improvements only:"}).inject(z));var x=new g.Element("td");x.inject(z);y.inject(x);y.addEventListener("change",function(A){h.improvementsOnly=A.dsModel.value});y.onChange()}));var v=new g.Element("table");v.inject(q);var r=function(x,y){return m.generateView(JSON.parse(x.Value),{}).then(function(A){var B=new g.Element("tr");B.technique=y;B.inject(v);t(g.Element("td",{text:x.name+":"}).inject(B));var z=new g.Element("td");z.inject(B);A.inject(z);A.addEventListener("change",function(C){h.savedSettings[y][x.name]=C.dsModel.value});A.onChange()})};for(var p=0;p<l.length;p++){for(var o=0;o<l[p].length;o++){u.push(r(l[p][o],e[p]))}}m.registerEnum("techniques",e);u.push(m.generateView(e[0],{typePath:"techniques"}).then(function(y){var z=new g.Element("tr");z.inject(v,"top");g.Element("td",{text:"Optimization Technique:"}).inject(z);var x=new g.Element("td");x.inject(z);y.inject(x);y.addEventListener("change",function(C){var B=v.getChildren();for(var A=1;A<B.length;A++){if(B[A].technique===C.dsModel.value){B[A].show()}else{B[A].hide()}}h.selectedTechnique=C.dsModel.value});y.onChange()}));Promise.all(u).then(function(){k()})}})})};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsSvgShapes",["DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(a){var b=function(){this.defaultImgHeight=14;this.defaultImgWidth=14;this.shapes={};this.addShape("circle",function(m,i,l){m.append("circle").attr("cx",l/2+1).attr("cy",i/2+1).attr("r",Math.min(l,i)/2)});this.addShape("square",function(m,i,l){m.append("rect").attr("x",1).attr("y",1).attr("width",l).attr("height",i)});this.addShape("triangle",function(m,i,l){m.append("polygon").attr("points","0,"+i+" "+l/2+",0 "+l+","+i)});this.addShape("downtriangle",function(m,i,l){m.append("polygon").attr("points","0,0 "+l/2+","+i+" "+l+",0")});this.addShape("cross2d",function(m,i,l){m.append("rect").attr("x",0).attr("y",i/4).attr("width",l).attr("height",i/2);m.append("rect").attr("x",l/4).attr("y",0).attr("width",l/2).attr("height",i)});this.addShape("verticalbar",function(m,i,l){m.append("polygon").attr("points",l/4+",0 "+(l-l/4)+",0 "+(l-l/4)+","+i+" "+l/4+","+i)});this.addShape("upperrighttriangle",function(m,i,l){m.append("polygon").attr("points","0,0 "+l+",0 "+l+","+i)});this.addShape("upperlefttriangle",function(m,i,l){m.append("polygon").attr("points","0,0 "+l+",0 0,"+i)});this.addShape("righttriangle",function(m,i,l){m.append("polygon").attr("points","0,0 "+l/2+","+i/2+" 0,"+i)});this.addShape("lowerrighttriangle",function(m,i,l){m.append("polygon").attr("points",l+",0 "+l+","+i+" 0,"+i)});this.addShape("lowerlefttriangle",function(m,i,l){m.append("polygon").attr("points","0,0 "+l+","+i+" 0,"+i)});this.addShape("horizontalbar",function(m,i,l){m.append("polygon").attr("points","0,"+i/5+" "+l+","+i/5+" "+l+","+(i-i/5)+" 0,"+(i-i/5))});this.addShape("pentagon",function(m,i,l){m.append("polygon").attr("points",l/2+","+i*0.025+" "+Number(l)+","+i*0.39+" "+l*0.81+","+i*0.975+" "+l*0.19+","+i*0.975+" "+l*0+","+i*0.39)});this.addShape("hexagon",function(m,i,l){m.append("polygon").attr("points",l/4+",0 "+(l-l/4)+",0 "+l+","+i/2+" "+(l-l/4)+","+i+" "+l/4+","+i+" 0,"+i/2)});var f=["1","2","3","4","5","6","7","8","9"];var j=["+","*"];var k=["a","b","c","d","e","f","g","h","i","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"];var g=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","Q","R","S","T","U","V","W","X","Y","Z"];var c={α:"alpha",β:"beta",γ:"gamma",δ:"delta",ε:"epsilon",ζ:"zeta",η:"eta",θ:"theta",κ:"kappa",λ:"lambda",μ:"mu",ξ:"xi",π:"pi",ρ:"rho",ς:"final sigma",σ:"sigma",τ:"tau",φ:"phi",χ:"chi",ψ:"psi",ω:"omega"};var e;var h=function(i){return function(n,l,m){n.append("text").attr("text-anchor","middle").attr("font-size",l).attr("x",m/2).attr("y",l).text(i)}};for(e=0;e<j.length;e++){this.addShape("symbol-"+j[e],h(j[e]))}for(e=0;e<f.length;e++){this.addShape("number-"+f[e],h(f[e]))}for(e=0;e<k.length;e++){this.addShape("letter-"+k[e],h(k[e]))}for(e=0;e<g.length;e++){this.addShape("letter-"+g[e],h(g[e]))}var d;for(d in c){if(c.hasOwnProperty(d)){this.addShape("greek-"+c[d],h(d))}}};b.prototype.addShape=function(c,d){if(this.shapes.hasOwnProperty(c)){throw a.translate("NAME_CONFLICT",": "+c)}this.shapes[c]=d};b.prototype.generate=function(g){var c=g.imgHeight||this.defaultImgHeight;var d=g.imgWidth||this.defaultImgWidth;var f=g.svgCanvas||d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("height",c+2).attr("width",d+2);var e=f.append("g");if(typeof g.classed!=="undefined"){e.classed(g.classed,true)}if(this.shapes.hasOwnProperty(g.shape)){this.shapes[g.shape].call(this,e,c,d)}if(typeof g.returnGroup!=="undefined"&&(g.returnGroup===true||g.returnGroup==="true")){return e}return f[0][0]};return b});define("DS/SMAAnalyticsUI/SMAAnalyticsHLineChart",["UWA/Core"],function(j){var i=undefined;var e={pointClick:"_hchart_point_l_click",pointRightClick:"_hchart_point_r_click",addToBasket:"_hchart_add_basket",addToDataSet:"_hchart_add_data"};var b={color:"#EA4F37",width:2,dashStyle:"shortdot"};var q="pline-lbound";var k="pline-ubound";var p=false;var c=5;var h=0;function d(r){return Number(r)===r&&r%1!==0}function a(r){return(typeof r!=="undefined"&&r!==null&&!isNaN(Number(r)))}var f=function(){if(d(this.value)){var r=this.value;if(Math.abs(r)>Math.pow(10,c)||Math.abs(r)<Math.pow(10,-1*c)){return r.toExponential(c)}else{return r.toPrecision(c)}}return this.value};function m(){var r={};r.useHTML=true,r.style={pointerEvents:"auto"};r.formatter=function(){return"<ra-hc-tooltip point-id="+(this.point.rowID||this.point.index)+" point-value="+this.y+"></ra-hc-tooltip>"};return r}function g(r){var s=this.index;h=s;Highcharts.charts.forEach(function(u){if(!j.is(u)){return}var t=u.series[0].points[s];if(j.is(t)&&typeof t.highlight==="function"){t.highlight(r)}});i.dispatchEvent(new CustomEvent(e.pointClick,{detail:{rowIndex:s,rowID:this.rowID}}))}function o(r){if(j.is(this)&&typeof this.highlight==="function"){this.highlight(r,true)}Highcharts.charts.forEach(function(t){if(!j.is(t)){return}if(t.index!==this.series.chart){var s=t.series[0].points[this.index];if(j.is(s)&&typeof s.highlight==="function"){s.highlight(r)}}},this);i.dispatchEvent(new CustomEvent(e.pointRightClick,{detail:{rowIndex:this.index,rowID:this.rowID}}))}function n(v,u,s,r){if(!s){s={}}if("_listeners" in v&&u in v._listeners){for(var t=0;t<v._listeners[u].length;t++){v._listeners[u][t].call(v,s)}}if(r&&!s.defaultPrevented){r(s)}}Highcharts.wrap(Highcharts.Axis.prototype,"hideCrosshair",function(r){if(!p){r.call(this)}});Highcharts.Point.prototype.highlight=function(s,r){if(r){this.series.chart.tooltip.refresh(this,s)}this.series.chart.xAxis[0].drawCrosshair(s,this);this.series.chart.yAxis[0].drawCrosshair(s,this)};Highcharts.wrap(Highcharts.Tooltip.prototype,"refresh",function(s,r,t){if(t&&t.type!=="mousemove"){Highcharts.charts.forEach(function(u){if(u&&u.tooltip&&typeof u.tooltip.destroy==="function"){u.tooltip.destroy()}},this);s.call(this,r,t)}});Highcharts.wrap(Highcharts.Chart.prototype,"firstRender",function(v){v.call(this);var w=this,s=this.container,t=this.plotLeft,y=this.plotTop,x=this.plotWidth,z=this.plotHeight,u=this.inverted,r=this.pointer;s.oncontextmenu=function(E){var C=w.hoverPoint,A=r.chartPosition;this.rightClick=true;E=r.normalize(E);E.cancelBubble=true;E.returnValue=false;if(E.stopPropagation){E.stopPropagation()}if(E.preventDefault){E.preventDefault()}if(!r.hasDragged){if(C&&r.inClass(E.target,"highcharts-tracker")){var D=C.plotX,B=C.plotY;Highcharts.extend(C,{pageX:A.left+t+(u?x-B:D),pageY:A.top+y+(u?z-D:B)});n(C.series,"contextmenu",Highcharts.extend(E,{point:C}));C.firePointEvent("contextmenu",E)}}}});function l(z,t,E,A,w,s,B){if(!j.is(Highcharts)||typeof Highcharts.chart!=="function"){console.error("Highcharts library is unavailable or not loaded. Please check the installation.");return undefined}var y=this;this._chart=undefined;if(j.is(B)){i=B}else{i=z}t=j.is(t,"string")?t:"";E=Array.isArray(E)?E:(E||[{}]);A=j.is(A,"object")?A:{};p=A.disableDefaultCrossHairBehavior||false;this._isStandalonePlot=Boolean(A.standalone_mode);var x=(j.is(A.label_x,"string")&&A.label_x.length>0)?A.label_x:"",v=(j.is(A.label_y,"string")&&A.label_y.length>0)?A.label_y:"";var r={chart:{events:{click:function(){}}},boost:{useGPUTranslations:true},title:{text:t},yAxis:{title:{text:v},crosshair:{width:2,color:"gray",dashStyle:"shortdot"},labels:{formatter:f},plotLines:[]},xAxis:{tickmarkPlacement:"on",gridLineWidth:1,title:{text:x},allowDecimals:false,crosshair:{width:2,color:"gray",dashStyle:"shortdot"},labels:{formatter:f},plotLines:[]},tooltip:m.call(this),credits:{enabled:false},legend:{enabled:false},exporting:{enabled:false},series:[{name:t,data:(Array.isArray(E)?E:(j.is(E)?[E]:[])),lineColor:"#4682b4",turboThreshold:0}],plotOptions:{series:{label:{connectorAllowed:true},pointStart:1,marker:{enabled:true},point:{events:{contextmenu:o,click:g}}}}};w=j.is(w,"number")?w:600;s=j.is(s,"number")?s:300;if(A.constraintLines){if(a(A.constraintLines.lowerBound)){var C=j.clone(b);C.id=q;C.value=A.constraintLines.lowerBound;r.yAxis.plotLines.push(C)}if(a(A.constraintLines.upperBound)){var u=j.clone(b);u.id=k;u.value=A.constraintLines.upperBound;r.yAxis.plotLines.push(u)}}this._chart=Highcharts.chart(z,j.extend(A,r,true));this._chart.setSize(w,s);try{this._chart.series[0].points[0].highlight()}catch(D){}}l.prototype._redrawCrossHairs=function(){var r=p;p=false;this._chart.xAxis[0].hideCrosshair();this._chart.yAxis[0].hideCrosshair();p=r;if(h>=this._chart.series[0].points.length){h=0}try{this._chart.series[0].points[h].highlight()}catch(s){}};l.prototype.setSize=function(s,r){if(j.is(this._chart)&&!isNaN(s)&&!isNaN(r)&&(s>=0)&&(r>=0)){this._chart.setSize(s,r);this._redrawCrossHairs.call(this)}};l.prototype.getChartObject=function(){return this._chart};l.prototype.destroyChart=function(){if(this._chart&&typeof this._chart.destroy==="function"){this._chart.destroy()}};l.prototype.setSeriesData=function(s,r){r=isNaN(r)?r:0;this._chart.series[r].setData(Array.isArray(s)?s:(j.is(s)?[s]:[]));this._redrawCrossHairs.call(this)};l.prototype.updateConstraintLines=function(t){if(t){this._chart.yAxis[0].removePlotLine(q);this._chart.yAxis[0].removePlotLine(k);if(a(t.lowerBound)){var s=j.clone(b);s.id=q;s.value=t.lowerBound;this._chart.yAxis[0].addPlotLine(s)}if(a(t.upperBound)){var r=j.clone(b);r.id=k;r.value=t.upperBound;this._chart.yAxis[0].addPlotLine(r)}}};return l});define("DS/SMAAnalyticsUI/SMAAnalyticsJQuery",["jquery"],function(b){b.fn.run=function(d){var e=Array.prototype.slice.call(arguments,1),c=d.apply(this,e);return c};b.param=function(c,e){var d=[],g=function(h,i){i=b.isFunction(i)?i():i;d[d.length]=encodeURIComponent(h)+"="+encodeURIComponent(i)};if(e===undefined){e=b.ajaxSettings.traditional}if(b.isArray(c)||(c.jquery&&!b.isPlainObject(c))){b.each(c,function(){g(this.name,this.value)})}else{for(var f in c){g(f,c[f])}}return d.join("&")};var a=b.noConflict();b.fn.contextPopup=function(e){var d={contextMenuClass:"contextMenuPlugin",gutterLineClass:"gutterLine",headerClass:"header",seperatorClass:"divider",title:"",items:[]};a.extend(d,e);function c(f){var g=a('<ul class="'+d.contextMenuClass+'"><div class="'+d.gutterLineClass+'"></div></ul>').appendTo(document.body);if(d.title){a('<li class="'+d.headerClass+'"></li>').text(d.title).appendTo(g)}d.items.forEach(function(k){if(k){var j="<li><a><span></span></a></li>";var l=a(j).appendTo(g);var h,i;if(k.icon){k.iconType=k.iconType||"";if(typeof k.iconType==="string"||k.iconType instanceof String){h=k.iconType}else{h=k.iconType()}if(h==="jquery"){i=a('<div class="sim-ui-contextMenuIcon ui-icon">');i.addClass(k.icon)}else{i=a("<img>");i.attr("src",k.icon)}i.insertBefore(l.find("span"))}if(typeof k.label==="string"||k.label instanceof String){l.find("span").text(k.label)}else{l.find("span").text(k.label())}if(k.action){l.find("a").click(function(){k.action(f)})}}else{a('<li class="'+d.seperatorClass+'"></li>').appendTo(g)}});g.find("."+d.headerClass).text(d.title);return g}this.bind("contextmenu",function(i){var j=c(i).show();var h=i.pageX+5,g=i.pageY;if(g+j.height()>=a(window).height()){g-=j.height()}if(h+j.width()>=a(window).width()){h-=j.width()}j.css({zIndex:1000001,left:h,top:g}).bind("contextmenu",function(){return false});var f=a("<div></div>").css({left:0,top:0,width:"100%",height:"100%",position:"absolute",zIndex:1000000}).appendTo(document.body).bind("contextmenu click",function(){f.remove();j.remove();return false});j.find("a").click(function(){f.remove();j.remove();return false});return false});return this};b.fn.refreshContextPopup=function(c){this.unbind("contextmenu");this.contextPopup(c)};return b.noConflict(true)});define("DS/SMAAnalyticsUI/SMAAnalyticsParametersGrid",["DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(f,d,c){var g,i;var e=function(k){return k.nodeModel.options.grid.ptype===this.type};var j=function(k){return k.nodeModel.options.grid.pid===this.pid};var b=function(k,l){l=l||5;if(Math.abs(k)>Math.pow(10,l)||Math.abs(k)<Math.pow(10,-1*l)){return k.toExponential(l)}else{return k.toPrecision(l)}};var h=function(l,k){if(UWA.is(l,"number")||UWA.is(l,"string")){if(UWA.is(l,"number")&&typeof l.toPrecision==="function"){return(l===0?"0.0":b(l,k))}return l}return"N/A"};function a(l){this.settings={};this.gridBox=document.createElement("div");this.gridBox.id="paramgrid-content";l.appendChild(this.gridBox);g=UWA.createElement("div",{id:"sidepanel-header-container",text:c.translate("POINT",0)});g.inject(this.gridBox);var m=UWA.createElement("div",{id:"sidepanel-valueslist-container"});m.inject(this.gridBox);var k=new f({apiVersion:2,expanderStyle:"none",selection:false,height:"auto",width:"auto",show:{rowHeaders:false,columnHeaders:false},shouldAcceptDrag:function(){return false},readOnly:true,escapeHTML:true,columns:[{dataIndex:"tree",isHidden:false,isEditable:false,width:"45%"},{dataIndex:"paramvalue",isHidden:false,isEditable:false,width:"55%"}],roots:[{label:c.translate("INPUTS"),grid:{paramvalue:undefined,ptype:"input"}},{label:c.translate("OUTPUTS"),grid:{paramvalue:undefined,ptype:"output"}}]}).inject(m);i=k.getDocument()}a.prototype={refresh:function(m,l){if(m){g.innerText=c.translate("POINT",m)}if(l){var k=i.getRoots().filter(function(n){return(typeof n.getChildren()!=="undefined")});if(i.getAllDescendants().length===(l.length+k.length)){l.forEach(function(n){var o=i.search({match:j.bind(n)})[0];if(o){o.options.grid.paramvalue=h(n.value)}})}else{this.purgeTreeNodes();l.forEach(function(o){var n=new d({label:o.title,isGroup:false,grid:{paramvalue:h(o.value),pid:o.pid}});var p=false;if(o.type){if(!this[o.type]){this[o.type]=i.search({match:e.bind({type:o.type})})[0]}if(this[o.type]){this[o.type].addChild(n);p=true}}if(!p){i.getNthRoot(0).addChild(n)}},{})}i.expandAll()}},purgeTreeNodes:function(k){var l=i.getAllDescendants();var m=function(o){o.remove()};if(!k||k===null){l.filter(function(o){return !o.isRoot()}).forEach(m)}else{k=(Array.isArray(k))?k:[k];k.forEach(m)}}};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsMGridBase",["UWA/Core"],function(b){function a(c,d){this._viewInitialized=false;this._viewId=c;this._gridBaseContainerId=d;this._tileResizeEventType="__tile_resize__";this._tileReOrderedEventType="__tile_reordered__";this._docElem=document.documentElement;this._view=document.getElementById(this._viewId);this._gridBaseContainer=this._view.querySelector("#"+this._gridBaseContainerId);this._gridElement=undefined;this._grid=undefined;this._dragCounter=0;this._isDraggingEnabled=true;this._defaultMuuriGridOptions={items:[],layout:{fillGaps:true,alignRight:false,alignBottom:false,horizontal:false},layoutDuration:400,layoutEasing:"ease",dragEnabled:true,dragSortInterval:50,dragContainer:this._gridBaseContainer,dragStartPredicate:function(f,e){if(!this._isDraggingEnabled){return false}if(e.deltaTime>50){return Muuri.ItemDrag.defaultStartPredicate(f,e)}}.bind(this),dragReleaseDuration:400,dragReleseEasing:"ease"}}a.prototype={_gridTileDragEvents:{dragStart:function(){++this._dragCounter;this._docElem.classList.add("dragging")},dragEnd:function(){if(--this._dragCounter<1){this._docElem.classList.remove("dragging")}}},_dragEndEvent:function(){var c=this._grid.getItems().map(function(d){return d.getElement().id});this._view.dispatchEvent(new CustomEvent(this._tileReOrderedEventType,{detail:c}))},removeTilesFromGrid:function(c){if(b.is(this._grid)){if(!Array.isArray(c)){c=this._grid.getItems()}if(c.length>0){this._grid.remove(c,{removeElements:true})}}},addTilesToGrid:function(c){if(typeof c==="undefined"||c===null){return}c=(!Array.isArray(c))?[c]:c;if(this._grid&&typeof this._grid.add==="function"){this._grid.add(c);if(typeof this._grid.layout==="function"){this._grid.layout()}}},disableTileDrag:function(){this._isDraggingEnabled=false},enableTileDrag:function(){this._isDraggingEnabled=true},refreshGrid:function(){if(b.is(this._grid)){this._grid.refreshItems();this._grid.layout()}},initializeGridView:function(){if(!b.is(Muuri)){console.error("Muuri js library is unavailable or not loaded. Please check the installation.");return undefined}if(this._viewInitialized){return}if(typeof this._view===undefined||null===this._view){this._view=document.getElementById(this._viewId)}if(typeof this._gridBaseContainer===undefined||null===this._gridBaseContainer){this._gridBaseContainer=this._view.querySelector(this._gridBaseContainerId)}this._gridElement=this._gridBaseContainer.querySelector(".grid");if(null!==this._gridElement){this._gridElement.innerHTML=""}else{this._gridElement=document.createElement("div");this._gridElement.className="grid";this._gridBaseContainer.appendChild(this._gridElement)}this._grid=new Muuri(this._gridElement,this._defaultMuuriGridOptions);Object.keys(this._gridTileDragEvents).forEach(function(c){if(this._gridTileDragEvents.hasOwnProperty(c)){this._grid.on(c,this._gridTileDragEvents[c].bind(this))}},this);this._view.addEventListener(this._tileResizeEventType,function(){this._grid.refreshItems();this._grid.layout()}.bind(this));this._grid.on("dragReleaseEnd",this._dragEndEvent.bind(this))}};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsDTContextMenu",[],function(){function a(b){this.defaultSettings={contextMenuClass:"contextMenuPlugin",gutterLineClass:"gutterLine",headerClass:"header",seperatorClass:"divider",title:"",items:[]};this.userSettings={};this.$simjq=b}a.prototype.defineContextOptions=function(b){this.userSettings=b};a.prototype.createMenu=function(d){var b=this.$simjq;var c=b.extend({},this.defaultSettings,this.userSettings);var f=b('<ul class="'+c.contextMenuClass+'"><div class="'+c.gutterLineClass+'"></div></ul>').appendTo(document.body);if(c.title){b('<li class="'+c.headerClass+'"></li>').text(c.title).appendTo(f)}c.items.forEach(function(i){if(i&&i!=="separator"){var h="<li><a><span></span></a></li>";var j=b(h).appendTo(f);var e,g;if(i.icon){i.iconType=i.iconType||"";if(typeof i.iconType==="string"||i.iconType instanceof String){e=i.iconType}else{e=i.iconType()}if(e==="jquery"){g=b('<div class="sim-ui-contextMenuIcon ui-icon">');g.addClass(i.icon)}else{g=b("<img>");g.attr("src",i.icon)}g.insertBefore(j.find("span"))}if(typeof i.label==="string"||i.label instanceof String){j.find("span").text(i.label)}else{j.find("span").text(i.label())}if(i.action){j.find("a").click(function(){i.action(d)})}}else{b('<li class="'+c.seperatorClass+'"></li>').appendTo(f)}});f.find("."+c.headerClass).text(c.title);return f};a.prototype.renderContext=function(f){f.stopPropagation();var g=this.createMenu(f).show();var d=f.pageX+5,c=f.pageY;if(c+g.height()>=this.$simjq(window).height()){c-=g.height()}if(d+g.width()>=this.$simjq(window).width()){d-=g.width()}g.css({zIndex:1000001,left:d,top:c}).bind("contextmenu",function(){return false});var b=this.$simjq("<div></div>").css({left:0,top:0,width:"100%",height:"100%",position:"absolute",zIndex:1000000}).appendTo(document.body).bind("contextmenu click",function(){b.remove();g.remove();return false});g.find("a").click(function(){b.remove();g.remove()});return false};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsResizableMTile",[],function(){function a(q){this._view=q;this._tileContentResizeHandler=undefined;this._tileContentRef=undefined;this._resizePreProcessor=undefined;this._defaults={min_width:400,min_height:250};this._otherTiles=function(){return document.querySelectorAll(".item:not(#"+this._tileElem.id+")")};var f=document.createElement("div");f.innerHTML='<div class="item resizable"><div class="item-content"></div><div class="resizer bottom-right"></div></div>';var p=20;var k=0;var e=0;var n=0;var l=0;var c=0;var b=0;var r=f.querySelectorAll(".resizer");var g;var m="__tile_resize__";try{g=new Event(m)}catch(o){g=document.createEvent("Event");g.initEvent(m,true,true)}var d=function(u){var t,i;if(this.classList.contains("bottom-right")){t=k+(u.pageX-c);i=e+(u.pageY-b);if(t>p){this.parentElement.style.width=t+"px"}if(i>p){this.parentElement.style.height=i+"px"}}else{if(this.classList.contains("bottom-left")){i=e+(u.pageY-b);t=k-(u.pageX-c);if(i>p){this.parentElement.style.height=i+"px"}if(t>p){this.parentElement.style.width=t+"px";this.parentElement.style.left=n+(u.pageX-c)+"px"}}else{if(this.classList.contains("top-right")){t=k+(u.pageX-c);i=e-(u.pageY-b);if(t>p){this.parentElement.style.width=t+"px"}if(i>p){this.parentElement.style.height=i+"px";this.parentElement.style.top=l+(u.pageY-b)+"px"}}else{t=k-(u.pageX-c);i=e-(u.pageY-b);if(t>p){this.parentElement.style.width=t+"px";this.parentElement.style.left=n+(u.pageX-c)+"px"}if(i>p){this.parentElement.style.height=i+"px";this.parentElement.style.top=l+(u.pageY-b)+"px"}}}}};var j=function(w,y,z,u){if(u){u()}var A=this;w.preventDefault();A._tileElem.classList.add("resizer-dragging");if(null!==A._tileElem.querySelector(".highcharts-container")){A._tileElem.querySelector(".highcharts-container").classList.add("resizer-drag-effect")}[].forEach.call(this._otherTiles(),function(B){B.classList.add("resizer-drag-effect")});var t=getComputedStyle(A._tileElem,null);k=parseFloat(t.getPropertyValue("width").replace("px",""));e=parseFloat(t.getPropertyValue("height").replace("px",""));n=A._tileElem.getBoundingClientRect().left;l=A._tileElem.getBoundingClientRect().top;c=w.pageX;b=w.pageY;var i=d.bind(y);var v=this;A._view.addEventListener("mousemove",i);A._view.addEventListener("mouseup",function x(E){A._view.removeEventListener("mousemove",i);if(z){var D=getComputedStyle(y.parentElement,null);var B=parseFloat(D.getPropertyValue("width").replace("px",""));var C=parseFloat(D.getPropertyValue("height").replace("px",""));console.log("Chart resize fired...");z(B-7,C-7)}this.dispatchEvent(g);A._view.removeEventListener("mouseup",x);if(null!==A._tileElem.querySelector(".highcharts-container")){A._tileElem.querySelector(".highcharts-container").classList.remove("resizer-drag-effect")}[].forEach.call(v._otherTiles(),function(F){F.classList.remove("resizer-drag-effect")});A._tileElem.classList.remove("resizer-dragging")})};for(var h=0;h<r.length;h++){var s=r[h];s.addEventListener("mousedown",function(i){j.call(this,i,s,this._tileContentResizeHandler,this._resizePreProcessor)}.bind(this))}this._tileElem=f.firstChild;this._tileElem.addEventListener("dblclick",function(i){}.bind(this))}a.prototype.setTileContentReference=function(b){this._tileContentRef=b};a.prototype.setTileContentResizeHandler=function(b){this._tileContentResizeHandler=(typeof b==="function")?b:undefined};a.prototype.setResizePreProcessor=function(b){this._resizePreProcessor=(typeof b==="function")?b:undefined};a.prototype.setTileId=function(b){if(b&&b!==null&&b.length>0){this._tileElem.id=b}};a.prototype.getTileId=function(){if(this._tileElem&&this._tileElem!==null){return this._tileElem.id}};a.prototype.getTile=function(){return this._tileElem};a.prototype.setSize=function(c,b){if(!isNaN(c)&&c>=this._defaults.min_width){this._tileElem.style.width=c+"px"}if(!isNaN(b)&&b>=this._defaults.min_height){this._tileElem.style.height=b+"px"}};return a});define("DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsModel",["UWA/Core","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils",],function(f,b,g,e){var k;var h=function(p){var n={label:p.displayName,grid:{id:p.ID,name:p.name,type:"raparameter",dataType:p.dataType,role:p.role,structure:p.structure,elementData:p.elementData,dimensions:p.dimensions}};if(p.structure==="ARRAY"){var o=p.name;n.grid.currentIndex=[];p.dimensions.forEach(function(q){o+="[0]";n.grid.currentIndex.push(0)});n.grid.paramData=n.grid.elementData[o]}return n};var j=function(p,o){var o=h(p);var n=o.grid.paramData||p;return c(n,o)};var a=function(p){var o=h(p);var n=o.grid.paramData||p;l(n,o);return d(n,o)};var c=function(n,o){o.grid.stringFreqsDominated=n.stringFreqsDominated;o.grid.stringFreqsPareto=n.stringFreqsPareto;o.grid.stringFreqsInfeasible=n.stringFreqsInfeasible;o.grid.stringFreqsExcluded=n.stringFreqsExcluded;o.grid.stringSortedByFreqs=n.stringSortedByFreqs;return o};var l=function(n,o){n=i(n);o.grid.sum=n.sum;o.grid.mean=n.mean;o.grid.stdDev=n.stdDev;o.grid.percentiles=n.percentiles;o.grid.percentileNames=n.percentileNames;o.grid.quantiles=n.quantiles;o.grid.numValues=n.numValues;o.grid.histogramValues=n.histogramValues;o.grid.min=n.min;o.grid.max=n.max;o.grid.variance=n.variance;o.grid.skewness=n.skewness;o.grid.kurtosis=n.kurtosis;return o};var d=function(n,o){if(n.uncertainty){o.grid.distributionType=n.uncertainty.type;o.grid.distributionMean=n.uncertainty.mean;o.grid.distributionVariance=n.uncertainty.variance}return o};var i=function(n){if(n!==null){n.mean=new Number(n.mean).toFixed(5);n.variance=new Number(n.stdDev*n.stdDev).toFixed(5);n.stdDev=new Number(n.stdDev).toFixed(5);n.skewness=new Number(n.skewness).toFixed(5);n.kurtosis=new Number(n.kurtosis).toFixed(5);n.percentiles=["100%","75%","50%","25%","0%"];n.percentileNames=[e.translate("Maximum"),e.translate("Upper Quartile"),e.translate("Median"),e.translate("Lower Quartile"),e.translate("Minimum")];n.quantiles=[new Number(n.max).toFixed(5),new Number(n.upperQuartile).toFixed(5),new Number(n.mean).toFixed(5),new Number(n.lowerQuartile).toFixed(5),new Number(n.min).toFixed(5)];n.numValues=0;if(n.histogramValues instanceof Array){n.histogramValues.forEach(function(o){n.numValues+=o},this)}else{n.histogramValues=[]}}return n};var m=b.extend({init:function(n){n=n||{};this._raFilterList=[];this._parent(n)},setParamData:function(n){this._addParameterData(n)},updateRAParamTree:function(o){this.prepareUpdate();var q=o.map(function(s,r){return{id:s.ID,originalIndex:r}});var p=this.getChildren();if(p instanceof Array){p.forEach(function(s){var r=q.some(function(v,t){var u=o[v.originalIndex];if(s.options.grid.id===u.ID){this._updateRAParamModel(s,u);if(!this._isNodeFiltered(s)){s.show()}else{s.hide()}q.splice(t,1);return true}return false},this);if(!r){s.remove()}},this)}if(q.length>0){var n=umappedParamData.map(function(r){return o[r.originalIndex]});this._addParameterData(n)}this.pushUpdate()},filterParameterData:function(n,o){this._updateFilter(n,o);this.prepareUpdate();this.search({match:function(p){if(!this._isNodeFiltered(p.nodeModel)){p.nodeModel.show();return true}else{p.nodeModel.hide();return false}}.bind(this)});this.pushUpdate()},_addParameterData:function(n){var o;n.forEach(function(p){if(p.dataType==="STRING"){o=this._createStringModel(p)}else{if(p.dataType==="INTEGER"||p.dataType==="REAL"){o=this._createNumericModel(p)}}this.addChild(o)},this)},_clearRAFilterList:function(){this._raFilterList=[]},_createStringModel:function(o){var n=j(o);return new g(n)},_createNumericModel:function(o){var n=a(o);return new g(n)},setSelectedArray:function(n,o){if(o instanceof Array){n.prepareUpdate();n.options.grid.currentIndex=o;var p=n.options.grid.name;n.options.grid.currentIndex.forEach(function(q){p+="["+q+"]"});n.options.grid.paramData=n.options.grid.elementData[p];if(n.options.grid.dataType==="STRING"){c(n.options.grid.paramData,n.options)}else{if(n.options.grid.dataType==="REAL"||n.options.grid.dataType==="INTEGER"){l(n.options.grid.paramData,n.options);d(n.options.grid.paramData,n.options)}}n.updateOptions(n.options);n.pushUpdate()}},_clearStringOptions:function(n){delete n.options.grid.stringFreqsDominated;delete n.options.grid.stringFreqsPareto;delete n.options.grid.stringFreqsInfeasible;delete n.options.grid.stringFreqsExcluded;delete n.options.grid.stringSortedByFreqs},_clearNumericOptions:function(n){delete n.options.grid.sum;delete n.options.grid.mean;delete n.options.grid.stdDev;delete n.options.grid.percentiles;delete n.options.grid.percentileNames;delete n.options.grid.quantiles;delete n.options.grid.numValues;delete n.options.grid.histogramValues;delete n.options.grid.min;delete n.options.grid.max},_clearArrayOptions:function(n){delete n.options.grid.elementData},_selectArrayOption:function(n,p){this.prepareUpdate();var o=this.getChildren();if(o instanceof Array){o.some(function(q){if(q.options.grid.id===p){q.options.grid.selectedArrayIndex=n;return true}})}this.pushUpdate()},_updateRAParamModel:function(o,p){var n={};if(o.options.grid.dataType==="STRING"){if(p.dataType!=="STRING"){_clearStringOptions(o);n=a(p)}else{n=j(p)}}else{if(p.dataType==="STRING"){this._clearNumericOptions(o);n=j(p)}else{n=a(p)}}o.updateOptions(n)},_isNodeFiltered:function(n){return this._raFilterList.some(function(o){if(n.options.grid[o.category]===o.value||o.value==="all"){return false}else{return true}})},_updateFilter:function(n,p){var o=this._raFilterList.some(function(q){if(q.category===n){q.value=p;return true}});if(!o){this._raFilterList.push({category:n,value:p})}}});return m});define("DS/SMAAnalyticsUI/SMAAnalyticsTimer",[],function(){function a(b){this.nameString=b+": "||""}a.prototype.startTimer=function(){this.startTime=new Date().getTime();this.startInterval=new Date().getTime()};a.prototype.restartTimer=function(){this.startTime=new Date().getTime();this.startInterval=new Date().getTime()};a.prototype.getTotalTime=function(c){var b=new Date().getTime()-this.startTime;if(c){console.log(this.nameString+c+b)}return b};a.prototype.getInterval=function(c){var b=new Date().getTime()-this.startInterval;if(c){console.log(this.nameString+c+b)}return b};a.prototype.resetInterval=function(){this.startInterval=new Date().getTime()};a.prototype.getAndResetInterval=function(c){var b=this.getInterval();this.resetInterval();if(c){console.log(this.nameString+c+b)}return b};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsCssEditor",[],function(){function a(){this.styleSheet=null;this.styleRules={}}a.prototype.setStyleSheet=function(b){this.styleSheet=b};a.prototype.addStyle=function(d,c,b){if(typeof this.styleRules[d]==="undefined"){this.styleSheet.insertRule(d+" { "+c+" : "+b+" }",0);this.styleRules[d]=this.styleSheet.cssRules[0]}else{this.styleRules[d].style[c]=b}};a.prototype.removeStyle=function(c,b){if(typeof this.styleRules[c]!=="undefined"){this.styleRules[c].style[b]=""}};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsUICommon",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(b,c,d){var a={hideAlert:function(){b(".sim-ui-advise-alert-message").hide()},INFO:0,WARN:1,ERROR:2,SUCCESS:3,_notificationManager:null,alertMessage:function(h,j,g,i){try{if(typeof h!=="number"){i=g;g=j;j=h;h=this.INFO}if(window.parent&&window.parent.postMessageToWidget){var f={eventType:"NOTIFICATION",eventSubType:h,messageText:j};window.parent.postMessageToWidget(f)}else{if(h===this.ERROR){this.showErrorNotification("",j)}else{if(h===this.WARN){this.showWarningNotification("",j)}else{if(h===this.SUCCESS){this.showSuccessNotification("",j)}else{this.showInfoNotification("",j)}}}}if(typeof g==="undefined"){g=5000}if(g>0){b(".sim-ui-advise-alert-message").animate({opacity:0},g,function(){b(".sim-ui-advise-alert-message").hide();if(typeof i==="function"){i()}})}else{if(typeof i==="function"){i()}}}catch(e){}},_initNotifManager:function(){this._notificationManager=c;d.setNotificationManager(this._notificationManager);d.setFadeOutPolicy(1);d.setStackingPolicy(0)},showErrorNotification:function(h,f,e){if(!UWA.is(this._notificationManager)){this._initNotifManager()}var g={level:"error",sticky:false};g.title=UWA.is(h,"string")?h:"";g.message=UWA.is(f,"string")?f:this._translator.translate("RA_ERROR");if(UWA.is(e,"string")&&e.length>0){g.category=e}this._notificationManager.addNotif(g)},showWarningNotification:function(h,f,e){if(UWA.is(f,"string")&&f.length>0){if(!UWA.is(this._notificationManager)){this._initNotifManager()}var g={level:"warning",sticky:false};g.title=UWA.is(h,"string")?h:"";g.message=UWA.is(f,"string")?f:this._translator.translate("RA_ERROR");if(UWA.is(e,"string")&&e.length>0){g.category=e}this._notificationManager.addNotif(g)}},showInfoNotification:function(h,f,e){if(!UWA.is(this._notificationManager)){this._initNotifManager()}var g={level:"info",sticky:false};g.title=UWA.is(h,"string")?h:"";g.message=UWA.is(f,"string")?f:"";if(UWA.is(e,"string")&&e.length>0){g.category=e}this._notificationManager.addNotif(g)},showSuccessNotification:function(h,f,e){if(!UWA.is(this._notificationManager)){this._initNotifManager()}var g={level:"success",sticky:false};g.title=UWA.is(h,"string")?h:"";g.message=UWA.is(f,"string")?f:"";if(UWA.is(e,"string")&&e.length>0){g.category=e}this._notificationManager.addNotif(g)}};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsMarkers",["DS/SMAAnalyticsUI/SMAAnalyticsSvgShapes","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json"],function(a,c){c=JSON.parse(c);var b=15;var d={svgShapeGenerator:new a(),dataSetMarkers:{},makeDataSetMarker:function(f,e){var g=this;if(!this.svgShapeGenerator.shapes.hasOwnProperty(e)){console.log("Error in AdviseUtils, makeDataSetMarker!");throw"Attempted to use an undefined shape: "+e}this.dataSetMarkers[f]=function(h){if(typeof h!=="undefined"){h.shape=e}else{h={shape:e}}return g.svgShapeGenerator.generate(h)}},getDataMark:function(f,g){var e;if(typeof f==="undefined"||this.availableSymbols.length===0){return document.createElementNS("http://www.w3.org/2000/svg","svg")}else{if(typeof this.dataSetMarkers[f]!=="undefined"){return this.dataSetMarkers[f](g)}else{if(typeof this.dataSetMarkers[(e=this.getRollOverValue(f))]!=="undefined"){return this.dataSetMarkers[e](g)}else{if(f.startsWith("USER_CREATED_OPTIMIZATION")){return this.dataSetMarkers.USER_CREATED_OPTIMIZATION(g)}var h=this.getRollOverIndex(f)-1;h=(!isNaN(h)?h:0);this.makeDataSetMarker(f,this.availableSymbols[h]);return this.dataSetMarkers[f](g)}}}},getRollOverValue:function(h){if(!h.contains("SET_")){return h}var g=h.substring(0,h.indexOf("SET_")+4);var j=h.replace(g,"");if(j.contains("_SEL")){selected=true;j=j.replace("_SEL","")}var i=parseInt(j);var f=i%b;if(f==0){f=b}var e=g+f;return e},getRollOverIndex:function(g){var f=g.substring(0,g.indexOf("SET_")+4);var i=g.replace(f,"");if(i.contains("_SEL")){selected=true;i=i.replace("_SEL","")}var h=parseInt(i);var e=h%b;if(e==0){e=b}return e},availableSymbols:{},initializeDataSetMarkers:function(h){var e=h.getDataSets(),g;var j=Object.keys(this.svgShapeGenerator.shapes),f=j.length;this.svgShapeGenerator.addShape("predictedIcon",function(l,i,k){l.append("svg:image").attr("x",0).attr("y",0).attr("width",k).attr("height",i).attr("xlink:href","../../common/images/smaAdviseIconApproximation.gif")});this.svgShapeGenerator.addShape("optimizeicon",function(l,i,k){l.append("svg:image").attr("x",0).attr("y",0).attr("width",k).attr("height",i).attr("xlink:href",c.ICON_LOCATION+"optimize16"+c.ICON_EXTENSION)});this.svgShapeGenerator.addShape("diamond",function(l,i,k){l.append("polygon").attr("points","0,"+i/2+" "+k/2+",0 "+k+","+i/2+" "+k/2+","+i)});this.svgShapeGenerator.addShape("fivepointstar",function(l,i,k){l.append("polygon").attr("points",k/2+",0 "+k/5+","+i+" "+k+","+i/2.5+" 0,"+k/2.5+" "+(k-k/5)+","+i)});this.makeDataSetMarker("PREDICTED","predictedIcon");this.makeDataSetMarker("USER_CREATED","diamond");this.makeDataSetMarker("IN_BASKET","fivepointstar");this.makeDataSetMarker("USER_CREATED_OPTIMIZATION","optimizeicon");this.availableSymbols=j;for(g=0;g<e.length;g++){if(e[g].alias!=="PREDICTED"&&e[g].alias!=="USER_CREATED"&&e[g].alias!=="IN_BASKET"&&!e[g].alias.startsWith("USER_CREATED_OPTIMIZATION")){this.makeDataSetMarker(e[g].alias,this.availableSymbols[this.getRollOverIndex(e[g].alias)-1])}}}};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsTextArea",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,a){var c=function(h){var k=this,j={target:null,saveButton:null,revertButton:null,hasSave:true,hasRevert:false,saveOnBlur:false,getFunction:null,saveFunction:null,defaultText:a.translate("ADD_NTES")+" ..."},g=b.extend({},j,h);var d=g.target instanceof b?g.target:null;var f=g.hasSave?g.saveButton instanceof b?g.saveButton:b("<button>"+a.translate("Apply")+"</button>").insertAfter(d):null;g.hasSave=f!==null;var e=g.revertButton instanceof b?g.revertButton:g.hasRevert?b("<button>"+a.translate("Revert")+"</button>").insertAfter(d):null;g.hasRevert=e!==null;g.saveOnBlur=f===null;k._getText=function(p){var n={};var m=g.getFunction(n);var l=m.promise;var o=a.translate("RETR_TXT")+" ...";if(!l){o=m}else{if(l){b.when(m).done(function(){o=n.content;o=o.replace(/%27/g,"'");o=decodeURIComponent(o);if(p&&typeof p==="function"){p(o)}}).fail(function(){o=a.translate("NTE_RTV_ERR");if(p&&typeof p==="function"){p(o)}})}else{o=a.translate("NTE_RTV_ERR")}}return o};k.unlock=function(){if(e!==null){e.removeClass("hidden")}if(f!==null){f.removeClass("hidden")}};k.lock=function(){if(e!==null){e.addClass("hidden")}if(f!==null){f.addClass("hidden")}};k.update=function(){var l="";l=k.displayNotes();if(typeof l!=="undefined"&&l!==null&&l.length>0){d[0].textContent=l}k.lock()};k.save=function(){var l=d[0].textContent;l=l.replace(/'/g,"%27");k._getText(function(m){if(l==g.defaultText){l=""}if(m!=l){g.saveFunction(l)}});k.lock()};var i=function(){d.data("emptyTextArea","is_empty");return g.defaultText};k.displayNotes=function(l){l=k._getText(function(m){if(m.length<=0||m==="null"){m=i()}else{d.removeData("emptyTextArea")}d[0].textContent=m})};if(e!==null&&e.length>0){e.addClass("sim-ui-btn").click(function(){k.update();if(d.html().length>0&&d.html()!=="<br>"){d.removeData("emptyTextArea")}})}if(f!==null&&f.length&&f.length>0){f.addClass("sim-ui-btn").click(function(){k.save()})}if(d&&d.length>0){d.on("focus",function(){var l=b(this);if(l.data("emptyTextArea")=="is_empty"){l.removeData("emptyTextArea");l.html("")}l.data("before",l.html());return l}).on("blur keyup paste",function(m){var l=b(this);if(l.data("before")!==l.html()){l.data("before",l.html());k.unlock()}if((l.html().length==0||l.html()=="<br>")&&m.type=="blur"){d[0].textContent=i()}return l});if(g.saveOnBlur){d.on("blur",function(){k.save()})}}k.lock();return k};return c});define("DS/SMAAnalyticsUI/SMAAnalyticsScatterSupportFns",["DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsDTContextMenu"],function(a,c){function b(){}b.prototype.setExcludeCallback=function(d){this.excludeCallback=d};b.prototype.setIncludeCallback=function(d){this.includeCallback=d};b.prototype.setSelectedPoints=function(d){this.selectedPoints=d};b.prototype.showRectangleContextMenu=function(g){var f=new c($simjq);var h=this;var e={label:a.translate("Exclude Rows"),iconType:"image",icon:"./assets/icons/exclude.png",action:function(){proxy.excludePoints(h.selectedPoints)}};var i={label:a.translate("Include Rows"),iconType:"jquery",icon:"ui-icon-plusthick",action:function(){proxy.includePoints(h.selectedPoints)}};var d={items:[e,i]};f.defineContextOptions(d);f.renderContext(d3.event)};return b});define("DS/SMAAnalyticsUI/SMAAnalyticsDataPlot",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,a){function c(i,d,e,f,g){this.div=i;this.options=d;this.plot={};this.dataNames=g;this.plot.lastDropped="";this.plot.pairs=[];this.plot.tempPairs=[];this.plot.axisBin={};this.plot.axisBin.x1=[];this.plot.axisBin.x2=[];this.plot.axisBin.y1=[];this.plot.axisBin.y2=[];this.plot.titleText=[];this.plot.pairData=[];this.data=f;this.savedDataArray=e;this.axes=["x1","y1","x2","y2"];var h=this.div.split("_");if(typeof this.options.graphID!=="undefined"){this.graphID=this.options.graphID}else{this.graphID=parseInt(h[1],10)}this.options.axis.x1.position=[0,this.options.plot.height+this.options.plot.y-1.5*this.options.axis.thickness-this.options.dropzone.thickness];this.options.axis.y1.position=[this.options.plot.x+2*this.options.axis.thickness+this.options.dropzone.thickness,0];this.options.axis.x2.position=[0,this.options.plot.y+2*this.options.axis.thickness+this.options.dropzone.thickness];this.options.axis.y2.position=[this.options.plot.x-this.options.dropzone.thickness+this.options.plot.width-2*this.options.axis.thickness,0];this.options.axis.x1.label=[this.options.plot.x+(-this.options.dropzone.thickness+this.options.plot.width-2*this.options.axis.thickness)/2,this.options.axis.x1.position[1]+2*this.options.axis.thickness-5];this.options.axis.y1.label=[this.options.plot.y+this.options.plot.height/2,this.options.axis.y1.position[0]-2*this.options.axis.thickness+5];this.options.axis.x2.label=[this.options.plot.x+(-this.options.dropzone.thickness+this.options.plot.width-2*this.options.axis.thickness)/2,this.options.axis.x2.position[1]-this.options.axis.thickness];this.options.axis.y2.label=[this.options.plot.y+this.options.plot.height/2,this.options.axis.y2.position[0]+this.options.axis.thickness*2.5-5];this.options.dropzones={};this.canvas={};this.canvas.x=this.options.plot.x-this.options.dropzone.thickness;this.canvas.y=this.options.plot.y+this.options.margin*0.5-this.options.dropzone.thickness;this.canvas.width=this.options.plot.width+this.options.dropzone.thickness+this.options.axis.thickness;this.canvas.height=this.options.plot.height+this.options.dropzone.thickness;this.options.dropzones.x1={x:this.canvas.x+2*this.options.dropzone.thickness,y:this.canvas.y+this.options.plot.height-1,width:this.options.plot.width-2*this.options.dropzone.thickness,height:this.options.dropzone.thickness,text:{x:this.options.axis.x1.label[0],y:this.options.axis.x1.label[1]+10+this.options.dropzone.thickness}};this.options.dropzones.y1={x:this.canvas.x+1,y:this.canvas.y+2*this.options.dropzone.thickness,width:this.options.dropzone.thickness,height:this.options.plot.height-2*this.options.dropzone.thickness-this.options.axis.thickness,text:{x:this.options.axis.y1.label[0],y:this.options.axis.y1.label[1]-10-this.options.axis.thickness}};this.options.dropzones.x2={x:this.canvas.x+2*this.options.axis.thickness,y:this.canvas.y+1,width:this.options.plot.width-2*this.options.dropzone.thickness,height:this.options.dropzone.thickness,text:{x:this.options.axis.x2.label[0],y:this.options.axis.x2.label[1]-10-this.options.dropzone.thickness}};this.options.dropzones.y2={x:this.canvas.x+this.options.plot.width+this.options.axis.thickness-1,y:this.canvas.y+2*this.options.dropzone.thickness,width:this.options.dropzone.thickness,height:this.options.plot.height-2*this.options.dropzone.thickness-this.options.axis.thickness,text:{x:this.options.axis.y2.label[0]+10+this.options.dropzone.thickness,y:this.options.axis.y2.label[1]+this.options.axis.thickness}}}c.prototype.loadData=function(){if(this.savedDataArray[this.graphID]!==null&&this.savedDataArray[this.graphID]!=="empty"){this.plot.pairs=this.savedDataArray[this.graphID].pairs;this.plot.titleText=this.savedDataArray[this.graphID].title;if(this.options.hasTitle){this.makeTitle()}this.makePlot()}else{if(this.options.hasTitle){this.makeTitle()}this.makePlaceholderText()}};c.prototype.makeSVG=function(){this.chart=d3.select("#"+this.div).append("svg").attr("class","sim-ui-data-plot").attr("x",this.options.margin).attr("y",0).attr("width",this.options.width).attr("height",this.options.height);this.plotGroup=this.chart.append("g").attr("class","sim-ui-data-plot")};c.prototype.makeCanvas=function(){if(this.options.hasCanvasRect){this.canvasRect=this.plotGroup.append("rect").attr("class","sim-ui-data-plot-canvas").attr("x",this.canvas.x).attr("y",this.canvas.y).attr("width",this.canvas.width).attr("height",this.canvas.height)}};c.prototype.makeScales=function(g,e){var f=Math.min.apply(null,g),d=Math.max.apply(null,g);return d3.scale.linear().range(e).domain([f,d])};c.prototype.plotLineGraph=function(h,e,k,j,i,g){var d=d3.svg.line().x(function(l){return k(l.x)}).y(function(l){return j(l.y)}).interpolate("linear");var f=this.plotGroup.append("g").attr("class","sim-ui-data-plot-line-group");f.append("path").attr("class","sim-ui-data-plot-line").datum(h).attr("d",function(l){return d(l)}).style("stroke",e).style("stroke-width",this.options.plot.stroke).attr("id",i);if(this.options.hasActions){this.makeRightClickMenu(f.node())}if(this.options.hasLabels){this.makeLabels(f,g,e,i)}};c.prototype.makeAxes=function(d){var f=this;this.axisGroup={};var e=d3.svg.axis().scale(this.scale[d]).tickSize(2).tickPadding(5).tickFormat(function(g){return g.toPrecision(3)}).ticks(f.options.numTicks).orient(this.options.axis[d].orient);this.axisGroup[d]=this.plotGroup.append("g").style("stroke-width",this.options.plot.stroke).attr("class","sim-ui-data-plot-axis").attr("transform","translate("+this.options.axis[d].position+")").call(e)};c.prototype.makeDropzones=function(){var j=this;var g=function g(i){if(i.preventDefault){i.preventDefault()}};var h=function(i){if(i.preventDefault){i.preventDefault()}d3.select(this).classed("selected-dropzone",true)};var f=function(i){if(i.preventDefault){i.preventDefault()}d3.select(this).classed("selected-dropzone",false)};var d=function(k){if(k.preventDefault){k.preventDefault()}var l=k.dataTransfer.getData("text");var i={};i[this.id]=l;j.plot.tempPairs.push(i);j.watchDropzones();return false};this.dropzones={};this.dropzoneGroup=this.plotGroup.append("g").attr("class","sim-ui-data-plot-dropzone");for(var e=0;e<this.axes.length;e++){this.dropzones[this.axes[e]]=this.dropzoneGroup.append("rect").attr("id",this.axes[e]).attr("x",this.options.dropzones[this.axes[e]].x).attr("y",this.options.dropzones[this.axes[e]].y).attr("width",this.options.dropzones[this.axes[e]].width).attr("height",this.options.dropzones[this.axes[e]].height);this.dropzones[this.axes[e]].node().addEventListener("dragover",g,false);this.dropzones[this.axes[e]].node().addEventListener("dragenter",h,false);this.dropzones[this.axes[e]].node().addEventListener("dragleave",f,false);this.dropzones[this.axes[e]].node().addEventListener("drop",d,false)}};c.prototype.makeTitle=function(){var d=this;if(typeof this.plot.titleText==="undefined"||this.plot.titleText.length===0){this.plot.titleText="Array Plot "+(this.graphID+1)}this.title=b('<div class="sim-ui-data-plot-title" contenteditable="true"></div>').appendTo(b("#"+this.div));this.title.text(this.plot.titleText);this.title.css({top:this.options.margin*0.5,left:this.options.margin,width:this.canvas.width});this.title.on("blur",function(){d.plot.titleText=b(this).text();d.saveData()})};c.prototype.makeParamBox=function(j,m,i){this.listDiv=j;this.dataNames=m;var h=b('<div class="sim-ui-data-plot-list-header"></div>').appendTo(b("#"+this.listDiv));var e=b('<div class="sim-ui-data-plot-list-body"></div>').appendTo(b("#"+this.listDiv));var g=this;var d=function(q){var p="";for(var o=0;o<q.length;o++){if(q[o].children.length===0){p+='<li draggable="true"><span class="sim-ui-data-plot-list-handles ui-icon ui-icon ui-icon-radio-on"></span><a style="cursor:pointer">'+q[o].name+"</a></li>"}else{p+='<li><span class="sim-ui-data-plot-list-handles ui-icon ui-icon ui-icon-triangle-1-e"></span>'+q[o].name+"<ul>"+d(q[o].children)+"</ul></li>"}}return p};var k='<ul id="listContainer">'+i;k=k+d(this.dataNames);e.html(k);var l=function(){b(e).find("li:has(ul)").click(function(o){if(this===o.target||this===o.target.parentElement){if(b(this).children("span").hasClass("ui-icon-triangle-1-s")){b(this).children("span").removeClass("ui-icon-triangle-1-s");b(this).children("span").addClass("ui-icon-triangle-1-e")}else{b(this).children("span").addClass("ui-icon-triangle-1-s");b(this).children("span").removeClass("ui-icon-triangle-1-e")}b(this).children("ul").toggle("medium")}return false}).children("ul").hide()};b(document).ready(function(){l()});var n=b('<button style="cursor:pointer">Expand All</button>').appendTo(e);n.on("click",function(){b(e).find("li:has(ul)").each(function(){b(this).children("span").addClass("ui-icon-triangle-1-s");b(this).children("span").removeClass("ui-icon-triangle-1-e");b(this).children("ul").css("display","block")})}).css({position:"absolute",top:g.options.plot.y+g.options.plot.height-g.options.paramBox.header.height-50,width:"78px","font-size":"8pt","margin-right":"2px",left:g.options.paramBox.width+g.options.margin-135});var f=b('<button style="cursor:pointer">Collapse All</button>').appendTo(e);f.on("click",function(){b(e).find("li:has(ul)").each(function(){b(this).children("span").addClass("ui-icon-triangle-1-e");b(this).children("span").removeClass("ui-icon-triangle-1-s");b(this).children("ul").css("display","none")})}).css({position:"absolute",top:g.options.plot.y+g.options.plot.height-g.options.paramBox.header.height-50,width:"78px","font-size":"8pt","margin-right":"2px",left:g.options.paramBox.width+g.options.margin-245});h.text(this.options.paramBox.header.text);b("#"+this.listDiv).css({height:this.options.plot.height+this.options.dropzone.thickness,top:this.options.plot.y})};c.prototype.eventHandler=function(){var g=this;var e=function(h){this.style.opacity="0.4";h.dataTransfer.effectAllowed="copy";h.dataTransfer.setData("text",d3.select(this).select("a").text());d3.selectAll(".sim-ui-data-plot-dropzone").classed("dropzone-drag",true)};var d=function(){this.style.opacity="1";d3.selectAll(".sim-ui-data-plot-dropzone").classed("dropzone-drag",false);return false};var f=document.querySelectorAll("#"+this.listDiv+" li[draggable=true]");[].forEach.call(f,function(h){h.addEventListener("dragstart",e,false);h.addEventListener("dragend",d,false)})};c.prototype.populatePairData=function(){var m,p,d,g=[];this.plot.pairData=[];for(var o=0;o<this.plot.pairs.length;o++){p=0;var q=[];for(var n=0;n<2;n++){var e={};for(var h=0;h<this.axes.length;h++){if(this.plot.pairs[o][n][this.axes[h]]!=="Indices"&&typeof this.plot.pairs[o][n][this.axes[h]]!=="undefined"){e[this.axes[h]]=this.data[this.plot.pairs[o][n][this.axes[h]]];m=this.plot.pairs[o][n][this.axes[h]];g.push(e[this.axes[h]].length)}else{if(this.plot.pairs[o][n][this.axes[h]]==="Indices"){p++;d=this.axes[h]}}}q.push(e)}if(p===1){for(var n=0;n<2;n++){if(b.isEmptyObject(q[n])){q[n][d]=[];for(var f=0;f<this.data[m].length;f++){q[n][d].push(f)}}}this.plot.pairData.push(q)}else{if(p===2){alert(a.translate("atleast_one_param_vector"));this.plot.pairs.splice(o,1)}else{if(g[0]===g[1]){this.plot.pairData.push(q)}else{alert(a.translate("vector_equal_length"));this.plot.pairs.splice(o,1)}}}}};c.prototype.watchDropzones=function(){var j=this;var e=0,h=0,f=false;if(this.plot.tempPairs.length===1){if(Object.keys(this.plot.tempPairs[0])[0]==="y1"||Object.keys(this.plot.tempPairs[0])[0]==="y2"){this.dropzoneGroup.append("text").attr("class","dropped-param").text(a.translate("Dropped val",this.plot.tempPairs[0][Object.keys(this.plot.tempPairs[0])[0]])).attr("x",function(){return(-1*j.options.dropzones[Object.keys(j.plot.tempPairs[0])[0]].text.x)}).attr("y",j.options.dropzones[Object.keys(j.plot.tempPairs[0])[0]].text.y).attr("transform","rotate(-90)")}else{this.dropzoneGroup.append("text").attr("class","dropped-param").text(a.translate("Dropped val",this.plot.tempPairs[0][Object.keys(this.plot.tempPairs[0])[0]])).attr("x",function(){return j.options.dropzones[Object.keys(j.plot.tempPairs[0])[0]].text.x}).attr("y",j.options.dropzones[Object.keys(j.plot.tempPairs[0])[0]].text.y)}return}else{if(this.plot.tempPairs.length===2){d3.selectAll(".dropped-param").remove();for(var g=0;g<2;g++){for(var d=0;d<this.axes.length;d++){if(typeof this.plot.tempPairs[g][this.axes[d]]!=="undefined"){if(this.axes[d]==="x1"||this.axes[d]=="x2"){e++}else{h++}}}}if(e===1&&h===1){f=true}else{this.plot.tempPairs=[]}}}if(f){if(this.plot.pairs.length<=10){this.plot.pairs.push(this.plot.tempPairs);this.plot.tempPairs=[];this.makePlot()}else{this.plot.tempPairs=[];alert(a.translate("cannot_plot_more_overlays"))}}};c.prototype.makeAxesBins=function(){(this.plot.axisBin.x1=[]),(this.plot.axisBin.y1=[]),(this.plot.axisBin.x2=[]),(this.plot.axisBin.y2=[]);for(var f=0;f<this.plot.pairs.length;f++){for(var e=0;e<2;e++){for(var d=0;d<this.axes.length;d++){if(typeof this.plot.pairs[f][e][this.axes[d]]!=="undefined"){this.plot.axisBin[this.axes[d]]=this.plot.axisBin[this.axes[d]].concat(this.plot.pairData[f][e][this.axes[d]])}}}}};c.prototype.makePlot=function(){this.populatePairData();this.makePlaceholderText();var e=[this.options.axis.y1.position[0],this.options.axis.y2.position[0]];var l=[this.options.axis.x1.position[1],this.options.axis.x2.position[1]];d3.select("#"+this.div).selectAll(".sim-ui-data-plot-axis").remove();d3.select("#"+this.div).selectAll(".sim-ui-data-plot-line-group").remove();this.makeAxesBins();this.scale={};for(var n=0;n<this.axes.length;n++){if(this.plot.axisBin[this.axes[n]].length!==0){if(this.axes[n]=="x1"||this.axes[n]=="x2"){this.scale[this.axes[n]]=this.makeScales(this.plot.axisBin[this.axes[n]],e)}else{this.scale[this.axes[n]]=this.makeScales(this.plot.axisBin[this.axes[n]],l)}}}var q,g,r=[],f,p;var d=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];for(var n=0;n<this.plot.pairs.length;n++){q=null;g=null;f=[];p=[];var o={xAxis:null,xParam:null,yAxis:null,yParam:null};for(var m=0;m<2;m++){r=[];for(var h=0;h<this.axes.length;h++){if(typeof this.plot.pairs[n][m][this.axes[h]]!=="undefined"){if(this.axes[h]==="x1"||this.axes[h]==="x2"){q=this.scale[this.axes[h]];f=this.plot.pairData[n][m][this.axes[h]];o.xAxis=this.axes[h];o.xParam=this.plot.pairs[n][m][this.axes[h]]}else{g=this.scale[this.axes[h]];p=this.plot.pairData[n][m][this.axes[h]];o.yAxis=this.axes[h];o.yParam=this.plot.pairs[n][m][this.axes[h]]}if(this.options.hasAxes){this.makeAxes(this.axes[h])}}}}for(var h=0;h<f.length;h++){r.push({x:f[h],y:p[h]})}r.sort(this.sortPoints);this.plotLineGraph(r,d[n],q,g,n,o);this.saveData()}};c.prototype.sortPoints=function(e,d){return e.x-d.x};c.prototype.makeRightClickMenu=function(e){var g=this;var d=function(i){i.preventDefault();b("#"+g.div).find(".sim-ui-data-plot-right-click").remove();var j=b('<div class="sim-ui-data-plot-right-click"></div>').appendTo("#"+g.div);b('<div class="menu-option">Remove</div>').appendTo(j);j.css({position:"absolute",left:i.layerX+5,top:i.layerY+5});var h=this;j.on("click",function(){g.removeOverlay(h)})};var f=function(){b("#"+g.div).find(".sim-ui-data-plot-right-click").remove()};e.addEventListener("contextmenu",d);document.getElementById(this.div).addEventListener("click",f)};c.prototype.addPlot=function(){this.makeSVG();this.makeCanvas();this.makeDropzones();this.loadData()};c.prototype.makeLabels=function(g,h,e,j){var i=this;var d=this.getUnits(h.xParam,h.yParam);var f=g.append("g").attr("class","sim-ui-data-plot-label");if(this.plot.pairs.length===1){f.attr("text-anchor","middle");var f=g.append("g").attr("class","sim-ui-data-plot-label");f.append("text").text(h.xParam+d[0]).style("fill",e).attr("x",function(){return i.options.axis[h.xAxis].label[0]}).attr("y",this.options.axis[h.xAxis].label[1]);f.append("text").text(h.yParam+d[1]).style("fill",e).attr("y",function(){return i.options.axis[h.yAxis].label[1]}).attr("x",function(){return(-1*i.options.axis[h.yAxis].label[0])}).attr("transform","rotate(-90)")}else{if(this.options.hasLegends){f.append("rect").attr("width",20).attr("height",20).attr("x",this.options.plot.x+this.options.plot.width+2*this.options.axis.thickness).attr("y",this.options.plot.y+this.options.axis.thickness+50*j).style("fill",e);f.append("text").text(h.xAxis+": "+h.xParam+d[0]).attr("x",65+this.options.plot.x+this.options.plot.width+2*this.options.axis.thickness).attr("y",5+this.options.plot.y+this.options.axis.thickness+50*j);f.append("text").text(h.yAxis+": "+h.yParam+d[1]).attr("x",65+this.options.plot.x+this.options.plot.width+2*this.options.axis.thickness).attr("y",5+this.options.plot.y+this.options.axis.thickness+50*j+20)}}};c.prototype.removeOverlay=function(d){var e=d3.select(d).select("path").attr("id");this.plot.pairs.splice(e,1);this.makePlot();this.saveData()};c.prototype.saveData=function(){var d={pairs:this.plot.pairs,title:this.plot.titleText};this.savedDataArray[this.graphID]=d};c.prototype.getSaveData=function(){return this.savedDataArray};c.prototype.makePlaceholderText=function(){if(this.plot.pairs.length===0){this.plotGroup.append("text").text("Drag And Drop!").attr("class","placeholder-text").style("fill","gray").style("font-size","20pt").attr("x",this.options.plot.x+this.options.plot.width/2-95).attr("y",this.options.plot.y+this.options.plot.height/2)}else{this.plotGroup.select(".placeholder-text").remove()}};c.prototype.getUnits=function(e,d){var j=e.slice(0,e.indexOf("["));var h=d.slice(0,d.indexOf("["));var k="",f="";for(var g=0;g<this.dataNames.length;g++){if(this.dataNames[g].name===j){k=this.dataNames[g].unit;if(typeof k!=="undefined"&&k.length>0){k=" ("+k+")"}}if(this.dataNames[g].name===h){f=this.dataNames[g].unit;if(typeof f!=="undefined"&&f.length>0){f=" ("+f+")"}}}return[k,f]};return c});define("DS/SMAAnalyticsUI/SMAAnalyticsPageSetupUtil",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery"],function(a){function b(){}b.prototype={addExpandControl:function(d,h,f,j,i,k){var c=a('<div class="sim-ui-expansionControl-rootDiv">').appendTo(d),g=a('<div class="ui-icon ui-icon-plus">').appendTo(c);g.attr("title","Expand");g.tooltip({content:g.attr("title")});f.rootDiv=d;f.controller=true;var l=function(){var n=g,m=a('<div class="sim-ui-expandedContent-rootDiv">').appendTo(j);d.appendTo(m);n.unbind("click",l);n.bind("click",e);n.attr("title","Collapse");n.tooltip({content:n.attr("title")});n.trigger("mouseleave");n.addClass("ui-icon-minus");n.removeClass("ui-icon-plus");if(i[k]&&i[k].resize){i[k].resize()}f.expanded.state=true};var e=function(){var m=g;d.appendTo(h);m.bind("click",l);m.unbind("click",e);m.attr("title","Expand");m.tooltip({content:m.attr("title")});m.trigger("mouseleave");m.removeClass("ui-icon-minus");m.addClass("ui-icon-plus");a(".sim-ui-expandedContent-rootDiv").remove();if(i[k]&&i[k].resize){i[k].resize()}f.expanded.state=false};f.expanded.collapse=e;g.bind("click",l)},getExpansionTracker:function(){var c={expanded:{state:false},events:{}};c.setEvents=function(e){for(var d in e){c.events[d]=e[d]}};return c}};return b.prototype});define("DS/SMAAnalyticsUI/exportview/SMAAnalyticsExportModel",["UWA/Core","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon"],function(g,d,f,b,c){var a;var e=g.Class.extend({init:function(h){a=this;a.requirementList=h.requirementList;a.paramMap=h.paramMap;a.allParamsFlat=h.allParamsFlat;a._paramData=null;a.analyticsParamOptionsMap=this._getParamOptions();a.autoMappingData=this._parseParamMap();a.autoMappingDataByRequirement=new Map();a.reqExportDoc=new d({useAsyncPreExpand:true});this._setExportModel()},_findMatchingParameter:function(j){for(var h=0;h<this.allParamsFlat.length;h++){if(this.allParamsFlat[h].ID===j){return this.allParamsFlat[h]}}},_parseParamMap:function(){var h=[],l=this.paramMap;for(var j in l){var m=l[j].split("|");var n=this._findMatchingParameter(j);var i={reqParamId:m[0],analyticsParamId:j,analyticsParamName:n.name};h.push(i)}return h},_getMappedAnalyticsParam:function(j){for(var h=0;h<this.autoMappingData.length;h++){if(this.autoMappingData[h].reqParamId===j){return this.autoMappingData[h]}}},_getParamOptions:function(){var h=new Map();this.allParamsFlat.forEach(function(i){h.set(i.ID,{name:i.name,dataType:i.dataType})});return h},_setExportModel:function(){var h=[];var i=this;this.requirementList.forEach(function(n){var k=true;var l=new f({label:n.title,grid:{id:n.id,name:n.name,type:"requirement"}});if(n.parametersList&&n.parametersList.parameterList.length>0){var m=n.parametersList.parameterList;m.forEach(function(o){var p=new f({label:o.title,grid:{type:"parameter",requirementId:n.id,physicalId:o.physicalId,analyticsParamTitle:b.translate("not_mapped"),analyticsParamID:"not_mapped",exportReqParam:"target",dataType:o.type,displayedDataType:b.translate(o.type),parameterValue:o.parameterValue,minimum:o.minimum,maximum:o.maximum,minRangeProperty:o.minRangeProperty,maxRangeProperty:o.maxRangeProperty,currReqParamValue:o.parameterValue}});l.addChild(p);if(k){k=false;l.expand()}});i.autoMappingDataByRequirement.set(n.id,[]);var j=l.getChildren();if(j){j.forEach(function(o){o._options.grid.analyticsParamOptions=i._updateParamOptionsForDropDown(o._options.grid.requirementId,o._options.grid.analyticsParamID,o._options.grid.dataType)})}}h.push(l)});this.reqExportDoc.addChild(h)},updateParamOptions:function(o,h,j){var m=this;var n=this.autoMappingDataByRequirement.get(o);var i=n.indexOf(h);if(i>-1){n.splice(i,1)}n.push(j);this.autoMappingDataByRequirement.set(o,n);var l=this.reqExportDoc.getChildren();var k=null;l.forEach(function(p){if(p.options.grid.id===o){k=p.getChildren()}});if(k){k.forEach(function(p){p.options.grid.analyticsParamOptions=m._updateParamOptionsForDropDown(o,p.options.grid.analyticsParamID,p.options.grid.dataType)})}},_updateParamOptionsForDropDown:function(m,j,h){var l=this.autoMappingDataByRequirement.get(m),k=this;var i=[{labelItem:b.translate("not_mapped"),valueItem:"not_mapped"}];this.analyticsParamOptionsMap.forEach(function(p,o){if(k._isValidOption(l,o,p.dataType,j,h)){var n=p.name;if(n){try{n=decodeURI(n);n=decodeURI(n)}catch(q){}}i.push({labelItem:n,valueItem:o})}});return i},_isValidOption:function(k,l,i,h,j){if(k.indexOf(l)===-1||l===h){if(i.toUpperCase()==="STRING"||j.toUpperCase()==="STRING"){return i.toUpperCase()===j.toUpperCase()}else{return true}}else{return false}},getExportModel:function(){return this.reqExportDoc},updateParamValues:function(i){this._paramData=i;this.reqExportDoc.prepareUpdate();var h=this.reqExportDoc.getChildren();if(h){h.forEach(function(k){var j=k.getChildren();if(j){j.forEach(function(l){var n="";if(l.options.grid.analyticsParamID.length>0){for(var o in i){if(o===l.options.grid.analyticsParamID){n=i[o]}}}l.updateOptions({grid:{analyticsParamValue:n}});var m=l.options.grid;if(m.analyticsParamTitle!=="Not Mapped..."){sessionInfo.exportView.exportModel.checkExportPossible(m)}},i)}},i)}this.reqExportDoc.pushUpdate()},updateModelAutomap:function(j){var i=this;this.reqExportDoc.prepareUpdate();var h=this.reqExportDoc.getChildren();if(h){h.forEach(function(m){if(!m.isExpanded()){m.expand()}var k=m.getChildren();var l=[];if(k){k.forEach(function(n){var o=null;if(j){o=i._getMappedAnalyticsParam(n.options.grid.physicalId);if(o){l.push(o.analyticsParamId)}}n.updateOptions({grid:{analyticsParamTitle:o&&o!==null?o.analyticsParamName:b.translate("not_mapped"),analyticsParamID:o&&o!==null?o.analyticsParamId:"not_mapped",analyticsParamValue:""}})}.bind(i));i.autoMappingDataByRequirement.set(m.options.grid.id,l);var k=m.getChildren();k.forEach(function(n){n.updateOptions({grid:{analyticsParamOptions:i._updateParamOptionsForDropDown(n._options.grid.requirementId,n._options.grid.analyticsParamID,n._options.grid.dataType)}})}.bind(i))}}.bind(i))}this.reqExportDoc.pushUpdate();if(j){this.updateParamValues(this._paramData)}else{sessionInfo.exportView.isExportPossible={}}},checkExportPossible:function(h){var k=h.physicalId;var l=document.querySelector(".sim-ui-popover-footerButton");if(h.analyticsParamID!=="not_mapped"){if(h.exportReqParam==="minimal_value"){if(h.parameterValue===""&&h.maximum===""){sessionInfo.exportView.isExportPossible[k]={isPossible:true,errorcode:"NO_ERROR"}}else{if(h.parameterValue!==""&&(h.minRangeProperty==="1"||h.minRangeProperty==="3")){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue<=h.parameterValue)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_RANGE_ERROR"}}else{if(h.parameterValue!==""){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue<h.parameterValue)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_RANGE_ERROR"}}else{if(h.parameterValue===""){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue<h.maximum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_RANGE_ERROR"}}}}}}else{if(h.exportReqParam==="maximal_value"){if(h.parameterValue===""){sessionInfo.exportView.isExportPossible[k]={isPossible:true,errorcode:"NO_ERROR"}}else{if(h.parameterValue!==""&&(h.maxRangeProperty==="1"||h.maxRangeProperty==="3")){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue>=h.parameterValue)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_RANGE_ERROR"}}else{if(h.parameterValue!==""){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue>h.parameterValue)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_RANGE_ERROR"}}else{if(h.parameterValue===""){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue>h.minimum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_RANGE_ERROR"}}}}}}else{if(h.exportReqParam==="target"){if(h.minimum!==""&&h.maximum!==""){sessionInfo.exportView.isExportPossible[k]=(h.maxRangeProperty==="1"||h.maxRangeProperty==="3")?((h.analyticsParamValue<=h.maximum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"}):((h.analyticsParamValue<h.maximum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"});if(sessionInfo.exportView.isExportPossible[k].isPossible){sessionInfo.exportView.isExportPossible[k]=(h.minRangeProperty==="1"||h.minRangeProperty==="3")?((h.analyticsParamValue>=h.minimum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"}):((h.analyticsParamValue>h.minimum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"})}}else{if(h.minimum===""&&h.maximum===""){sessionInfo.exportView.isExportPossible[k]={isPossible:true,errorcode:"NO_ERROR"}}else{if(h.minimum===""&&(h.maxRangeProperty==="1"||h.maxRangeProperty==="3")){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue<=h.maximum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"}}else{if(h.minimum===""){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue<h.maximum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"}}else{if(h.maximum===""&&(h.minRangeProperty==="1"||h.minRangeProperty==="3")){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue>=h.minimum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"}}else{if(h.maximum===""){sessionInfo.exportView.isExportPossible[k]=(h.analyticsParamValue>h.minimum)?{isPossible:true,errorcode:"NO_ERROR"}:{isPossible:false,errorcode:"REQ_EXPORT_TARGET_ERROR"}}}}}}}}}}if(sessionInfo.exportView.isExportPossible.hasOwnProperty(k)&&sessionInfo.exportView.isExportPossible[k].isPossible){delete sessionInfo.exportView.isExportPossible[k]}else{function j(m,o){for(var n in m){if(m.hasOwnProperty(n)&&m[n].valueItem===o){return n}}return false}if(h.analyticsParamTitle==="Not Mapped..."){var i=j(h.analyticsParamOptions,h.analyticsParamID);h.analyticsParamTitle=h.analyticsParamOptions[i].labelItem}if(g.is(sessionInfo.exportView.isExportPossible[k])&&sessionInfo.exportView.isExportPossible[k].errorcode!=="NO_ERROR"){c.alertMessage(c.ERROR,b.translate(sessionInfo.exportView.isExportPossible[k].errorcode,h.analyticsParamTitle,h.analyticsParamValue,h.minimum,h.maximum,h.parameterValue));l.disabled=true;l.style.opacity="0.3";if(k){document.getElementById("analyticsParamValue"+k).childNodes[0].style.color="red"}}}if(Object.keys(sessionInfo.exportView.isExportPossible).length===0){l.disabled=false;l.style.opacity="1";if(k){document.getElementById("analyticsParamValue"+k).childNodes[0].style.color="black"}}}}});return e});define("DS/SMAAnalyticsUI/SMAAnalyticsControlPanel",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery"],function(a){a.widget("sim.adviseControlGroup",{options:{expandCollapseButton:"",option2:a.noop},_create:function(){this.collapsed=false;this.animationActive=false;a.noop()},_init:function(){},toggleCollapseExpand:function(e){if(this.animationActive){return}this.animationActive=true;var d=this.element.find(".sim-ui-panel-controlgroup-contentpanel");var c=0,f=this.element.attr("data-size");if(typeof f==="undefined"){f=parseInt(d[0].clientHeight,10);this.element.attr("data-size",f)}var b=c;if(this.collapsed){a(d).css("overflow","");a(e.target).removeClass("ui-icon-triangle-1-s");a(e.target).addClass("ui-icon-triangle-1-n");b=f}else{a(e.target).removeClass("ui-icon-triangle-1-n");a(e.target).addClass("ui-icon-triangle-1-s")}a(d).animate({height:b+"px"},1000,function(){this.collapsed=!this.collapsed;if(!this.collapsed){a(d).css("overflow","hidden")}this.animationActive=false}.bind(this))}});a.widget("sim.adviseControlPanel",{options:{option2:a.noop},_create:function(){this.element.find(".sim-ui-panel-controlgroup").adviseControlGroup()},_init:function(){}});window.toggleCollapseExpand=function(b){var c=b.srcElement||b.target;a(c).parent().parent().parent().adviseControlGroup("toggleCollapseExpand",b)};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsViewButton",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json"],function(a,b){b=JSON.parse(b);a.widget("sim.adviseViewButton",{options:{viewID:"",layoutChanged:a.noop},_create:function(){var e=this;var g=e.element.attr("data-view");if(!(typeof g==="undefined"||g=="undefined"||g=="")){e.option("viewID",g)}var f=e.element.parent().parent();var d=f.find("#"+e.option("viewID")+".sim-ui-panel-content-view").attr("data-primary");if(d=="true"){e.element.addClass("sim-ui-panel-content-viewbutton-current")}var c=e.element.attr("data-icon");if(!(typeof c==="undefined"||c=="undefined"||c=="")){e.element.css("");e.element.css("background","url('"+b.ICON_LOCATION+c+b.ICON_EXTENSION+"') no-repeat center center transparent");e.element.tooltip()}e.element.click(function(h){e.element.parent().find(".sim-ui-panel-content-viewbutton-current").removeClass("sim-ui-panel-content-viewbutton-current");e.element.addClass("sim-ui-panel-content-viewbutton-current");f.find(".sim-ui-panel-content-view").hide();f.find("#"+e.option("viewID")+".sim-ui-panel-content-view").show();h.iaEventSource=e;h.iaEventType="viewchange";e.element.parent().parent().parent().advisePage("triggerEvent",h)})},_init:function(){}});return a});define("DS/SMAAnalyticsUI/SMAAnalyticsDataTableProxy",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils"],function(e,d,b){d=JSON.parse(d);var a=e;function c(f){this.proxy=f}c.prototype.makeDataTableCall=function(i,h,j){h=h||{};var f=this.proxy.executeCommand({commandName:i,data:h,commandGroup:"dataTable"});if(typeof j==="function"){f.done(j)}else{if(typeof j==="object"){for(var g in j){if(j.hasOwnProperty(g)&&f[g]){f[g](callback)}}}}return f};c.prototype.sortTableByParameter=function(l,k,i,j,f){var h={parameterIdList:j,rowIndexList:f,getMetaData:"true",getFixedData:"true",getColumnData:"true",parameterId:l,reverseSort:i};var g=k==="false"?"sortTableByParam":"sortTableByFixedParam";return this.makeDataTableCall(g,h)};c.prototype.getParameterData=function(){return this.proxy.varGroup};c.prototype.getDataRows=function(f,i){var h="getTableDataByIndex";var g={parameterIdList:i,rowIndexList:f,getColumnData:"true"};return this.makeDataTableCall(h,g)};c.prototype.getNewColumns=function(g,i){var h={parameterIdList:i,rowIndexList:g,getMetaData:"true",getFixedData:"false",getColumnData:"true"};if(h.rowIndexList.length===0||h.parameterIdList.length===0){var f=new e.Deferred();f.resolve();return f}return this.getTableDataByIndex(h)};c.prototype.getTableMetadata=function(){var g="getTableMetadata";var f={};return this.makeDataTableCall(g,f)};c.prototype.getTableData=function(f,h){var g={parameterIdList:h,rowIndexList:f,getMetaData:"true",getFixedData:"true",getColumnData:"true"};return this.getTableDataByIndex(g)};c.prototype.getNewRows=function(f,h){var g={parameterIdList:h,rowIndexList:f,getMetaData:"true",getFixedData:"true",getColumnData:"false"};return this.getTableDataByIndex(g)};c.prototype.getTableDataByIndex=function(g){var f="getTableDataByIndex";return this.makeDataTableCall(f,g)};c.prototype.testGetRows=function(){var f=this.getDataRows([1,2,3,4,5],this.proxy.getAllParametersAsFlatList());f.done(function(h,i,g){console.log(b.getJSONFromResponse([h,i,g]))})};c.prototype.setDataValuesFromIndex=function(h){var g={values:JSON.stringify(h)};var f="setDataValuesFromIndex";var k=this.proxy.getNewTransactionDeferred();var j={tags:{startEditMode:true}};var i=this;this.makeDataTableCall(f,g).done(function(m,n,l){i.proxy.setVarGroup(b.getJSONFromResponse([m,n,l]));i.proxy.decodeVarGroupFields();j.iaEventType=d.EVENT_TYPE_DATASET_CHANGED;j.tags={startEditMode:true};i.proxy.propagateEvent([j],k);i.proxy.updateApproximationStatus();k.resolve()}).fail(function(){k.resolve()})};c.prototype.setDataValuesFromIndexShort=function(h){var g={values:JSON.stringify(h)};var f="setDataValuesFromIndex";var k=this.proxy.getNewTransactionDeferred();var j={tags:{startEditMode:true}};var i=this;this.makeDataTableCall(f,g)};c.prototype.editCells=function(f){};c.prototype.deleteRow=function(f){};c.prototype.deleteParameter=function(f){};c.prototype.addRow=function(f){};c.prototype.addParameter=function(f){};c.prototype.moveParameter=function(g,f){};return c});define("DS/SMAAnalyticsUI/exportview/SMAAnalyticsExportView",["UWA/Core","DS/Tree/TreeListView","DS/Controls/ComboBox","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/exportview/SMAAnalyticsExportModel"],function(h,e,c,b,f){var a;var d=function(i){console.log(i)};var g=h.Class.extend({init:function(i){a=this;a.valueData=null;a.matchedNodesList=null;a.exportModel=new f(i);a.allParamsFlat=i.allParamsFlat;a.isExportPossible=i.isExportPossible;a.reqExportDoc=a.exportModel.getExportModel();a.requirementExportView=new e(this.setTreeListViewOtions());a.requirementExportView.options.columns[0].text=b.translate("Requirement")},setTreeListViewOtions:function(){var i=this;var j=[{labelItem:b.translate("Target Value"),valueItem:"target"},{labelItem:b.translate("minimal_value"),valueItem:"minimal_value"},{labelItem:b.translate("maximal_value"),valueItem:"maximal_value"}];return{height:"auto",width:"100%",enableDragAndDrop:false,isEditable:true,isSortable:true,infiniteScrolling:true,enableKeyboardNavigation:true,resize:{columns:true,rows:false},columns:[{text:b.translate("Type"),dataIndex:"displayedDataType",isEditable:false,isSortable:true,width:"10%"},{text:b.translate("ANALYTICS_PARAMETER"),dataIndex:"analyticsParamTitle",isEditable:false,isSortable:false,width:"30%",onCellRequest:function(q){if(!q.isHeader){var n=q.nodeModel;var o=q.manager;var r=q.nodeModel.options.grid.type;if(r&&r==="parameter"){q.valueData=i.valueData;var t=q.nodeModel.options.grid.analyticsParamID;var k=0;var l=q.nodeModel.options.grid.analyticsParamOptions;for(var p=0;p<l.length;p++){if(l[p].valueItem===t){k=p;break}}var m=new c({elementsList:l,currentValue:l[k].valueItem,currentLabel:l[k].labelItem,enableSearchFlag:true,autocompleteFlag:true});var s=m.elements.container.getElementsByClassName("wux-ui-state-undefined");if(s.length>0){s[0].addClassName("wux-controls-lineeditor");s[0].removeClassName("wux-ui-state-undefined")}m.addEventListener("change",function(y,v){v.preventDefault();v.stopPropagation();var u=this.nodeModel.options.grid.analyticsParamID;var A=v.dsModel.currentValue;this.nodeModel.options.grid.analyticsParamID=A;this.nodeModel.options.grid.analyticsParamValue=this.valueData[v.dsModel.currentValue];y.exportModel.updateParamOptions(this.nodeModel.options.grid.requirementId,u,A,this.nodeModel.options.grid.dataType);this.manager.updateRowView(this.virtualRowID);var w=this.nodeModel.options.grid;var x=w.physicalId;if(w.analyticsParamID!=="not_mapped"){sessionInfo.exportView.exportModel.checkExportPossible(w)}else{if(w.analyticsParamID==="not_mapped"){if(sessionInfo.exportView.isExportPossible[x]){delete sessionInfo.exportView.isExportPossible[x]}if(Object.keys(sessionInfo.exportView.isExportPossible).length===0){var z=document.querySelector(".sim-ui-popover-footerButton");z.disabled=false;z.style.opacity="1"}}}}.bind(q,i));q.cellView.getContent().setHTML(m)}}}},{text:b.translate("PARAMETER_EXPORT"),dataIndex:"exportReqParam",isEditable:false,isSortable:false,width:"20%",onCellRequest:function(n){if(!n.isHeader){var m=n.nodeModel.options.grid.type;if(m&&m==="parameter"){var p=0;var o=n.nodeModel.options.grid.exportReqParam;for(var l=0;l<j.length;l++){if(j[l].valueItem===o){p=l;break}}var k=new c({elementsList:j,currentValue:j[p].valueItem,currentLabel:j[p].labelItem,enableSearchFlag:true,autocompleteFlag:true});k.addEventListener("change",function(q){q.preventDefault();q.stopPropagation();this.nodeModel.options.grid.exportReqParam=q.dsModel.currentValue;if(q.dsModel.currentValue==="minimal_value"){this.nodeModel.options.grid.currReqParamValue=this.nodeModel.options.grid.minimum}else{if(q.dsModel.currentValue==="maximal_value"){this.nodeModel.options.grid.currReqParamValue=this.nodeModel.options.grid.maximum}else{this.nodeModel.options.grid.currReqParamValue=this.nodeModel.options.grid.parameterValue}}this.manager.updateRowView(this.virtualRowID);var r=this.nodeModel.options.grid;if(r.analyticsParamID!=="not_mapped"){sessionInfo.exportView.exportModel.checkExportPossible(r)}}.bind(n));n.cellView.getContent().setHTML(k)}}}},{text:b.translate("PARAMETER_VALUE"),dataIndex:"analyticsParamValue",isEditable:false,isSortable:true,width:"15%",onCellRequest:function(o){if(!o.isHeader){var m=o.nodeModel.options.grid;var n=m.type;if(n&&n==="parameter"){var l=m.analyticsParamID;if(l!=="not_mapped"){if(m.analyticsParamValue!==null){var k="<span id=analyticsParamValue"+m.physicalId+"><b>"+m.analyticsParamValue+"</b>&nbsp;&nbsp;<s>"+m.currReqParamValue+"</s></span>";o.cellView.getContent().setHTML(k)}else{var k="<span id=analyticsParamValue"+m.physicalId+'><i class= "wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attention ra-exportview-row-warning" title="'+b.translate("RA_EXPORT_WARN_NO_VALUE")+'"></i></span>';o.cellView.getContent().setHTML(k)}}}}}}],selection:{cells:false,rowHeaders:false,columnHeaders:false,canMultiSelect:false,useUnselectAllOnEmptyArea:true},showLoaderIndicator:true,treeDocument:this.reqExportDoc}},getExportView:function(){return this.requirementExportView},getExportModel:function(){return this.exportModel},updateParamValues:function(i){this.valueData=i;this.exportModel.updateParamValues(this.valueData)},searchModel:function(j){var i=this.getExportModel().getExportModel();i.prepareUpdate();if(this.matchedNodesList){this.matchedNodesList.forEach(function(l,k){l.unmatchSearch()})}this.matchedNodesList=i.search({match:function(k){if(j&&k.nodeModel.options.label.toLowerCase().indexOf(j.toLowerCase())!==-1){return true}}});this.matchedNodesList.forEach(function(l,k){l.matchSearch();l.reverseExpand()});i.pushUpdate()}});return g});define("DS/SMAAnalyticsUI/SMAAnalyticsClientSideProxy",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","ZipJS/zip-fs","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,e,a){var d=null;function c(){}c.prototype={fileMap:{},getRowInfo:function(h,g,f){proxy.worker.evaluate("getRowInfo",[h],function(i){g.content=i.data.data;f.resolve()})},getScoresForRow:function(g,h,f){proxy.worker.evaluate("getScoresForRow",[g],function(i){h.content=i.data.data;f.resolve()})},getCasePreviewInfo:function(h){var f=new b.Deferred();var g={};g.CaseData={};b.ajax({type:"GET",url:"../../resources/slmservices/advise/caseInfo?oid="+sessionInfo.caseID}).done(function(j){var k=[],i={};c.prototype.getFile("WorkflowImage.jpg",i).done(function(){for(var l=0;l<Object.keys(proxy.caseData.dataSourceInfoMap).length;l++){proxy.caseData.dataSourceInfoMap[Object.keys(proxy.caseData.dataSourceInfoMap)[l]].workflowImageURL=i.content;k.push(proxy.caseData.dataSourceInfoMap[Object.keys(proxy.caseData.dataSourceInfoMap)[l]]);g.DataSets=k;var m=j.getElementsByTagName("CaseInfo")[0];g.CaseData.Project=m.getAttribute("project");g.CaseData.Group="";g.CaseData.RevisionNumber="";g.CaseData.Owner=m.getAttribute("owner");g.CaseData.LastModified=m.getAttribute("modified");g.CaseData.Status=m.getAttribute("currentState");g.CaseData.Definition=m.getElementsByTagName("Definition")[0].innerHTML===""?{}:JSON.parse(m.getElementsByTagName("Definition")[0].innerHTML);if(typeof g.CaseData.Definition.workflow!=="undefined"){g.CaseData.Definition.workflow.forEach(function(o,n){if(o.id==="shopdesignspage"){o.hidden=true;g.CaseData.Definition.workflow.splice(n,1)}});g.CaseData.Definition.workflow.forEach(function(o,n){if(o.id==="predictpage"){o.hidden=true;g.CaseData.Definition.workflow.splice(n,1)}})}g.CaseData.Originated=m.getAttribute("originator");g.CaseData.DueDate=proxy.caseData.dueDate==null?"":proxy.caseData.dueDate;g.CaseName=proxy.caseData.caseName;g.ImageFunction=c.prototype.getWorkFlowImage;g.background=proxy.caseData.caseBackgroundInfo==null?a.translate("enter_background"):proxy.caseData.caseBackgroundInfo;proxy.Methods=proxy.caseData.caseMethodsInfo==null?a.translate("enter_methods"):proxy.caseData.caseMethodsInfo;g.CurrentUser={};g.CurrentUser.userName=proxy.caseData.currentUser.name;g.CurrentUser.userID=proxy.caseData.currentUser.userID;h.content=g;f.resolve()}})});return f},getFormulationData:function(){var l={};l.objectives={};l.constraints={};var f=proxy.caseData.formulation.objectivesByVariableId;l.objectives=[];for(var k=0;k<Object.keys(f).length;k++){l.objectives[k]={};l.objectives[k].parameterID=Object.keys(f)[k];l.objectives[k].type=f[Object.keys(f)[k]].type;l.objectives[k].value=f[Object.keys(f)[k]].value;l.objectives[k].rank=f[Object.keys(f)[k]].rank}var m=proxy.caseData.formulation.constraintsByVariableId;l.constraints=[];var h;for(var k=0;k<Object.keys(m).length;k++){h=m[Object.keys(m)[k]];for(var g=0;g<h.length;g++){l.constraints[g]={};l.constraints[g].parameterID=Object.keys(m)[k];l.constraints[g].type=h[g].conditions[0].type;l.constraints[g].boundValue=h[g].conditions[0].boundValue}}return l},getExcludedRowIdListData:function(g,f){proxy.worker.evaluate("getExcludedRowIdListData",[],function(h){g.content=h.data.data;f.resolve()})},getFormulationLockStatus:function(){return proxy.caseData.formulationLocked},getFileNameList:function(){return[]},getImageFileNameList:function(){return[]},getRecommendedRowID:function(){return proxy.caseData.recommendedRowId},getExplorationFilter:function(g){var f=new b.Deferred();proxy.worker.evaluate("getExplorationFilter",[],function(h){g.content=h.data.data;f.resolve()});return f},getRankListForRowID:function(g,h){var f=new b.Deferred();proxy.worker.evaluate("getRankListForRowID",[g],function(i){h.content=i.data.data;f.resolve()});return f},getBestOverallDesigns:function(g){var f=b.Deferred();proxy.worker.evaluate("getBestOverallDesigns",[],function(h){g.content=h.data.data;f.resolve()});return f},getBestDesignsForEachObjective:function(g){var f=b.Deferred();proxy.worker.evaluate("getBestDesignsForEachObjective",[],function(h){g.content=h.data.data;f.resolve()});return f},getGradingMethod:function(){return proxy.caseData.gradingMethod},getBasketRowIDList:function(){return proxy.caseData.basketRowGroup.conditions[0].rowIdList},getFileList:function(f){var g=new b.Deferred();proxy.worker.evaluate("getFileList",[],function(h){f.content=h.data.data;g.resolve()});return g},getPageOptions:function(f){if(proxy.caseData.clientStateInfo.pageConfigurations[f]){return proxy.caseData.clientStateInfo.pageConfigurations[f].pageOptions}else{return{}}},getParameterHierarchy:function(g){var f=new b.Deferred();proxy.worker.evaluate("getParameterHierarchy",[],function(h){g.content=h.data.data;f.resolve()});return f},getFilesForRowIDList:function(i,f){var h=[],g=b.Deferred();proxy.worker.evaluate("getFilesForRowIDList",[i],function(l){var m=l.data.data;for(var k in m){var j=m[k];j.forEach(function(q){if(q.isImage||q.isVideo){var s=b.Deferred();h.push(s);var u=b.Deferred(),r=b.Deferred();var t=decodeURIComponent(q.url).substring(decodeURIComponent(q.url).lastIndexOf("/")+1);var o=decodeURIComponent(q.thumbnail).substring(decodeURIComponent(q.thumbnail).lastIndexOf("/")+1);if(c.prototype.fileMap[t]){q.url=c.prototype.fileMap[t];u.resolve()}else{var p={};if(Object.keys(c.prototype.fileMap).length<m[i[0]].length){c.prototype.getFile(q.url,p).done(function(){q.url=c.prototype.fileMap[t];u.resolve()})}}if(c.prototype.fileMap[o]){q.thumbnail=c.prototype.fileMap[o];r.resolve()}else{var n={};if(Object.keys(c.prototype.fileMap).length<m[i[0]].length){c.prototype.getFile(q.thumbnail,n).done(function(){q.thumbnail=c.prototype.fileMap[t];r.resolve()})}}b.when(u,r).done(function(){s.resolve()})}})}b.when.apply(b,h).done(function(){f.content=m;g.resolve()})});return g},getDataColumns:function(i,h,g){var f=new b.Deferred();proxy.worker.evaluate("getDataColumns",[i,h],function(j){g.content=j.data.data;f.resolve()});return f},setBasketRowIDList:function(h,g,f){proxy.worker.evaluate("setBasketRowIDList",[h],function(i){g.content=i.data.data;f.resolve()})},createPage:function(f,g){proxy.worker.evaluate("createPage",[f],function(h){g.resolve()})},setRecommendedRowID:function(g,f){proxy.worker.evaluate("setRecommendedRowID",[g],function(h){f.resolve()})},setParameterHierarchy:function(h,g,f){proxy.worker.evaluate("setParameterHierarchy",[h],function(i){g.content=i.data.data;f.resolve()})},setConstraints:function(h,g){var f=new b.Deferred();proxy.worker.evaluate("setConstraints",[h],function(i){g.content=i.data.data;f.resolve()});return f},setObjectives:function(h,g){var f=new b.Deferred();proxy.worker.evaluate("setObjectives",[h],function(i){g.content=i.data.data;f.resolve()});return f},setFormulationLockStatus:function(g){var f=new b.Deferred();proxy.worker.evaluate("setFormulationLockStatus",[g],function(){f.resolve()});return f},setBasketWeight:function(h,i,g){var f=new b.Deferred();proxy.worker.evaluate("setBasketWeight",[h,i],function(j){g.content=j.data.data;f.resolve()});return f},getCommentsForDataRow:function(h,g){var f=new b.Deferred();proxy.worker.evaluate("getCommentsForDataRow",[h],function(i){g.content=i.data.data;f.resolve()});return f},getLikesForDataRow:function(h,g){var f=new b.Deferred();proxy.worker.evaluate("getLikesForDataRow",[h],function(i){g.content=i.data.data;f.resolve()});return f},setCommentsForDataRow:function(h,f){var g=new b.Deferred();proxy.worker.evaluate("setCommentsForDataRow",[h,f],function(){g.resolve()});return g},setLikesForDataRow:function(g,h){var f=new b.Deferred();proxy.worker.evaluate("setLikesForDataRow",[g,h],function(){f.resolve()});return f},getNotesForRowID:function(h,g){var f=new b.Deferred();proxy.worker.evaluate("getNotesForRowID",[h],function(i){g.content=i.data.data;f.resolve()});return f},setNotesForRowID:function(h,g){var f=new b.Deferred();proxy.worker.evaluate("setNotesForRowID",[h,g],function(i){f.resolve()});return f},setAdviseCaseInfo:function(m,l,i,g,k,j,f){var h=new b.Deferred();proxy.worker.evaluate("setAdviseCaseInfo",[m,l,i,g,k,j,f],function(n){h.resolve()});return h},setGradingMethod:function(g){var f=new b.Deferred();proxy.worker.evaluate("setGradingMethod",[g],function(h){f.resolve()});return f},downloadFiles:function(){var f=b.Deferred();var g=new XMLHttpRequest();g.open("GET","../../resources/slmservices/advise/caseTicket?action=download&fname=file_data.zip&oid="+sessionInfo.caseID);g.send();g.onload=function(){if(this.response){var j=encodeURIComponent(this.response.split("<Ticket>")[1].split("</Ticket>")[0]);var i=new XMLHttpRequest();i.onload=function(n){if(g.readyState==4&&g.status==200){var k=new Blob([this.response],{type:"application/zip"});var m=typeof URL.createObjectURL==="function"?URL:window.top.URL;proxy.filesURL=m.createObjectURL(k);var l=new e.fs.FS();e.workerScriptsPath="scripts/ThreeDS/Visualization/zip-js/";l.importHttpContent({serverurl:"",filename:proxy.filesURL,proxyurl:"none"},false,function(){c.prototype.zipEntries=l.entries;f.resolve()})}};i.open("POST","../../servlet/fcs/checkout",true);i.setRequestHeader("Cache-Control","no-cache");i.setRequestHeader("Content-type","application/x-www-form-urlencoded");i.responseType="arraybuffer";var h="__fcs__jobTicket="+j+"&__fcs__attachment=false";i.send(h)}else{f.resolve()}};return f},getFile:function(h,j){var f=b.Deferred();if(!c.prototype.zipEntries){f.resolve()}else{var k;var m=false;for(var g=0;g<c.prototype.zipEntries.length;g++){k=c.prototype.zipEntries[g];var l="image/PNG";h=decodeURIComponent(h);if(h.indexOf("/")>0){h=decodeURIComponent(h).substring(decodeURIComponent(h).lastIndexOf("/")+1)}if(k.name===h){m=true;k.getBlob(l,function(i){if(typeof c.prototype.fileMap[h]==="undefined"){c.prototype.fileMap[h]=URL.createObjectURL(i)}f.resolve()})}}if(!m){f.resolve()}}return f},storeAdviseCase:function(){var f=b.Deferred();b.when(c.prototype.saveCase(),c.prototype.saveChangeLog()).done(function(){f.resolve()});return f},saveCase:function(){var f=b.Deferred();proxy.worker.evaluate("saveCase",[],function(g){f.resolve()});return f},saveChangeLog:function(){var f=b.Deferred();proxy.worker.evaluate("saveChangeLog",[proxy.changeLog],function(g){f.resolve()});f}};return new c()});define("DS/SMAAnalyticsUI/SMAAnalyticsProxy",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils","DS/SMAAnalyticsUI/SMAAnalyticsDataTableProxy","DS/SMAAnalyticsUI/SMAAnalyticsClientSideProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/ExperienceKernel/ExperienceKernel"],function(j,c,f,i,b,e,d,h){c=JSON.parse(c);var g=null;function a(){this.dataTableProxy=new i(this)}a.prototype={connectTo:function(l,m,n,k){if(a.prototype.isConnected||l===""){if(l===""){console.log("Connection ERROR: caseID is blank")}else{console.log("Connection ERROR: Already connected")}return}if(m){a.prototype.caseState=m}a.prototype._caseID=l;if(n){a.prototype._baseURL=n}if(!k){console.log("Connection ERROR: intialize set to FALSE");return}a.prototype.caseLoaded=true;a.prototype.isConnected=true},isConnected:false,_APP_ID_:"SIMREII_AP",_baseURL:"",_commandExt:"",_lastSyncTime:-1,_lastUpdateTime:-1,_helpHandler:j.noop,_transaction:null,_appLandingPage:"../../common/emxNavigator.jsp?appName="+a.prototype._APP_ID_+"&suiteKey=SimulationCentral&StringResourceFileId=smaSimulationCentralStringResource&SuiteDirectory=simulationcentral",caseState:"In Process",_caseID:"",_formulationLocked:null,_userLockAccess:null,_userUnLockAccess:null,caseInfo:{},varGroup:{},formulation:{},excludedRowIdList:[],rowNameMap:{},basket:[],page:[],priorityValues:{MH:0,1:1,2:2,3:3,4:4,5:5},__rollbackList:["caseInfo","varGroup","formulation","basket"],popupDim:{},timeoutTimer:null,resetTimeoutPopupFunction:j.noop,eventListeners:{maxIndex:0},spinnerObj:null,spinnerForced:false,veil:null,arrayPlots:[],approximations:{},permissionsAndLicenses:null,currentUser:{},selectedTemplateOptions:[],selectedTemplateHierarchy:{},odtFunctionSequences:[],odt:null,_widgetID:"",_dashboardURL:"",_eedJobID:"",_eedServerID:"",_platformId:"",CATIASessionID:"",CATIASessionInitID:"",CATIAHVUrl:"",CATIAHVPort:"",CATIAPartID:"",_availableOptimizationSettings:{},_constantInputsForOptimization:[],serializedSessionInfo:{},_switchesFromWidget:{},setSwitchesFromWidget:function(k){if(typeof k!=="undefined"&&k!==null){Object.keys(k).forEach(function(l){if(k.hasOwnProperty(l)){a.prototype._switchesFromWidget[l]=k[l]}},this)}},getSwitch:function(k){if(typeof k==="undefined"||k===null||k.length===0){return undefined}if(window.localStorage&&window.localStorage.getItem&&window.localStorage.getItem(k)){return window.localStorage.getItem(k)}else{return a.prototype._switchesFromWidget[k]}},isLockedOptInput:function(k){return(Array.isArray(a.prototype._constantInputsForOptimization)&&a.prototype._constantInputsForOptimization.indexOf(k)>-1)},updateConstantOptimizationInputs:function(l,m){if(l.role!=="INPUT"){return}a.prototype._constantInputsForOptimization=Array.isArray(a.prototype._constantInputsForOptimization)?a.prototype._constantInputsForOptimization:[];var k=a.prototype._constantInputsForOptimization.indexOf(l.name);if(m){if(k===-1){a.prototype._constantInputsForOptimization.push(l.name)}d.alertMessage(e.translate("OPT_IP_LOCK_ON",l.displayName))}else{if(k>-1){a.prototype._constantInputsForOptimization.splice(k,1)}d.alertMessage(e.translate("OPT_IP_LOCK_OFF",l.displayName))}},approximationSDKLibrary:null,setPlatFormId:function(k){if(typeof k!=="undefined"&&k!==null&&k.length>0){a.prototype._platformId=k}else{console.warn("No Platform Id received from widget.Defaulting to OnPremise");a.prototype._platformId="OnPremise"}},getPlatformId:function(){return a.prototype._platformId},getAppID:function(){return a.prototype._APP_ID_||""},getEEDServerId:function(){return a.prototype._eedServerID||""},setEEDServerId:function(k){a.prototype._eedServerID=k||""},getEEDJobId:function(){return a.prototype._eedJobID||""},setEEDJobId:function(k){a.prototype._eedJobID=k||""},isAWidget:function(){return a.prototype._widgetID.length>0},setWidgetID:function(k){a.prototype._widgetID=k||""},setDashboardURL:function(k){a.prototype._dashboardURL=k||""},getDashboardURL:function(){if(a.prototype.isAWidget()){return a.prototype._dashboardURL}return""},getWidgetID:function(){return a.prototype._widgetID},getRunningServant:function(k){if(typeof Storage!=="undefined"){var l=Date.now();var o=localStorage["smaAnalyticsCase"+k];if(o&&o.length>5){var p=JSON.parse(o);var m=p.lastUpdateTime;var n=p.servantURL;if(l-m<1800000){return n}else{delete localStorage["smaAnalyticsCase"+k]}}}return null},getCSRFTokenFor3DSpace:function(){var k=a.prototype.getNewTransactionDeferred();j.ajax({type:"GET",dataType:"text",url:"../../resources/slmservices/token/CSRF"}).done(function(l){k.resolve(l)}).fail(function(){k.reject()});return k},getConnectedRequirementsList:function(l){var k=a.prototype.getNewTransactionDeferred();if(!l){l="false"}a.prototype.getCSRFTokenFor3DSpace().done(function(m){j.ajax({type:"GET",url:"../../resources/slmservices/advise/listAnalyticsRequirements",data:{caseid:a.prototype._caseID,exported:l},beforeSend:function(n){n.setRequestHeader("ENO_CSRF_TOKEN",m)}}).done(function(o){var n=o.requirementsList||o["analytics-requirement"];var p="";if(typeof n!=="undefined"){n.forEach(function(r){var q=r.id||"";if(p.length>0){p+=";"}if(q.length>0){p+=q}},this)}k.resolve(p)}).fail(function(){k.resolve("")})}).fail(function(){k.resolve("")});return k},getParametersList:function(k){var l=a.prototype.getNewTransactionDeferred();if(!k){k="false"}a.prototype.getCSRFTokenFor3DSpace().done(function(m){j.ajax({type:"GET",url:"../../resources/slmservices/advise/getAllParametersForRequirement",data:{requirements:k},beforeSend:function(n){n.setRequestHeader("ENO_CSRF_TOKEN",m)}}).done(function(p){var o=p.requirementsList;var q="";var n="";if(typeof o!=="undefined"){o.forEach(function(s){if(UWA.is(n.parameterList)&&(n.parameterList.length>0)){if(s.parametersList.parameterList.length>0){for(var r=0;r<s.parametersList.parameterList.length;r++){n.parameterList.push(s.parametersList.parameterList[r])}}}else{n=s.parametersList||""}},this)}l.resolve(n)}).fail(function(){l.resolve("")})}).fail(function(){l.resolve("")});return l},getThumbnail:function(k){var l=a.prototype.getNewTransactionDeferred();a.prototype.getCSRFTokenFor3DSpace().done(function(m){j.ajax({type:"GET",url:"../../resources/lifecycle/revision/family",data:{physicalid:k},beforeSend:function(n){n.setRequestHeader("ENO_CSRF_TOKEN",m);n.setRequestHeader("SecurityContext",sessionInfo.secCtx)}}).done(function(p){var o=q=JSON.parse(p).data,n={},q="";if(o instanceof Array){n=o[0]}if(n.thumbnail){q=n.thumbnail}l.resolve(q)}).fail(function(n){l.reject(n)})}).fail(function(){l.resolve("")});return l},resetRunningServant:function(k){delete localStorage["smaAnalyticsCase"+k]},setHelpHandler:function(k){if(typeof k==="function"){a.prototype._helpHandler=k}},getCompleteURL:function(k){return a.prototype._baseURL+k},callback:function(k){console.log(k)},makeID:function(m){var n="";var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var l=0;l<m;l++){n+=k.charAt(Math.floor(Math.random()*k.length))}return n},spinnerControlShow:function(k){if(a.prototype.spinnerObj===null){a.prototype.spinnerObj=j("#sim-ui-global-spinner")}if(a.prototype.spinnerObj.hasClass("sim-spinnerHidden")){a.prototype.spinnerObj.removeClass("sim-spinnerHidden");a.prototype.spinnerObj.show()}if(typeof k!=="undefined"){a.prototype.spinnerForced=k}},spinnerControlHide:function(k){if(typeof k==="undefined"){k=false}if(a.prototype.spinnerForced&&!k){return}a.prototype.spinnerForced=false;if(a.prototype.spinnerObj===null){a.prototype.spinnerObj=j("#sim-ui-global-spinner")}if(!a.prototype.spinnerObj.hasClass("sim-spinnerHidden")){a.prototype.spinnerObj.addClass("sim-spinnerHidden");a.prototype.spinnerObj.hide()}},executeCommand:function(l){var k="executeCommand?commandName="+l.commandName;if(l.commandGroup&&l.commandGroup!==""){k+="&commandGroup="+l.commandGroup}return a.prototype.ajax(k,l.data,l.method)},ajax:function(l,q,k){var m=a.prototype._baseURL+l;var n=q;var s=null;if(m==="stop"){try{delete localStorage["smaAnalyticsCase"+a.prototype._caseID]}catch(p){}if(!n){n={}}n.t=Date.now()}var o;if(k){o=k}else{o="GET";if(m.indexOf("executeCommand")>-1){if(m.indexOf("commandName=set")>-1||(n&&n.commandName&&n.commandName.indexOf("set")>-1)){o="POST"}}else{if(m.indexOf("stop")>-1){o="POST"}}}var r=true;if(a.prototype.whichBrowser().contains("IE ")){r=false}s=j.ajax({url:m,data:n,method:o,crossDomain:true,cache:r,beforeSend:function(t){t.setRequestHeader("ra-from-user",a.prototype.currentUser.userID);if(o==="POST"||o==="PUT"){t.setRequestHeader("X-CSRFToken",adviseLaunchInfo.token||"notoken")}}});s.done(function(u){if(typeof Storage!=="undefined"&&m!=="stop"){var v=Date.now();localStorage["smaAnalyticsCase"+a.prototype._caseID]=JSON.stringify({lastUpdateTime:v,servantURL:a.prototype._baseURL,stationName:adviseLaunchInfo.stationName,stationIP:adviseLaunchInfo.stationIP});a.prototype.resetTimeout()}if(localStorage.RecordRAODT&&(typeof response!=="undefined"||u===[]||u==={})){var A="";if(typeof n!=="undefined"){A=n}if(typeof u==="object"){u=JSON.stringify(u)}var w=a.prototype._baseURL+"executeCommand?";var x=m.replace(w,"");var B,y="";var z=x.split("&");for(var t=0;t<z.length;t++){if(z[t].indexOf("commandName")>-1){B=z[t].replace("commandName=","")}else{if(z[t].indexOf("commandGroup")>-1){y=z[t].replace("commandGroup=","")}}}a.prototype.odt={};a.prototype.odt.commandName=B;a.prototype.odt.arguments=A;a.prototype.odt.response=u;a.prototype.odt.commandGroup=y;a.prototype.odtFunctionSequences.push(a.prototype.odt);localStorage.ODTFunctions=null;localStorage.ODTFunctions=JSON.stringify(a.prototype.odtFunctionSequences)}if(!this.url||this.url.indexOf("commandName=monitor")===-1){proxy.spinnerControlHide()}});s.fail(function(t){if(t.responseText){d.alertMessage(d.ERROR,e.translate(t.responseText.trim()))}console.error("Ajax failed :\n url"+m+"\n arguments: "+JSON.stringify(n)+"\n response: "+JSON.stringify(t));proxy.spinnerControlHide()});if(l==="stop"){if(adviseLaunchInfo.isJoiningSession){getTopWindow().location.href=adviseLaunchInfo._appLandingPage}}return s},whichBrowser:function(){var l=navigator.userAgent,k,m=l.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(m[1])){k=/\brv[ :]+(\d+)/g.exec(l)||[];return"IE "+(k[1]||"")}if(m[1]==="Chrome"){k=l.match(/\b(OPR|Edge)\/(\d+)/);if(k!==null){return k.slice(1).join(" ").replace("OPR","Opera")}}m=m[2]?[m[1],m[2]]:[navigator.appName,navigator.appVersion,"-?"];if((k=l.match(/version\/(\d+)/i))!==null){m.splice(1,1,k[1])}return m.join(" ")},getPlainTextFromResponse:function(k){if(k instanceof String||typeof k==="string"){return k}if(k instanceof Array&&k.length===3&&(k[0] instanceof Document||k[2].responseText)){var l=k[2];if(l.responseText){k[0]=l.responseText}else{if(l.responseXML){k[0]=l.responseXML}}return k[0]}return k},resetTimeout:function(){a.prototype.lastTimeoutReset=Date.now();if(a.prototype.timeoutWarningTimer){clearInterval(a.prototype.timeoutWarningTimer)}var l=c.TIMEOUT_MINS;var m=window.adviseLaunchInfo.timeout;if(m&&m!=="30"&&window.adviseLaunchInfo&&window.adviseLaunchInfo.timeout){try{l=Number.parseInt(window.adviseLaunchInfo.timeout)}catch(k){}}a.prototype.timeoutWarningTimer=setInterval(function(){clearInterval(a.prototype.timeoutWarningTimer);a.prototype.resetTimeoutPopupFunction()},(l-c.TIMEOUT_WARN_MINS)*60*1000);if(a.prototype.timeoutTimer){clearInterval(a.prototype.timeoutTimer)}a.prototype.timeoutTimer=setInterval(function(){j('<div class="sim-ui-popover-rootDiv">').remove();clearInterval(a.prototype.timeoutTimer);a.prototype.ajax("stop");d.alertMessage(d.ERROR,e.translate("SESSION_TIMEOUT"),function(){a.prototype.stopServant();proxy.spinnerControlHide()})},l*60*1000)},stopServant:function(l){delete localStorage["smaAnalyticsCase"+a.prototype._caseID];var k=function(){if(window.parent&&window.parent.adviseLaunchInfo){if(window.parent.adviseClosing){window.parent.adviseClosing()}try{if(window.parent.adviseLaunchInfo.closeRAFrameInWidget){window.parent.adviseLaunchInfo.closeRAFrameInWidget()}}catch(m){}}d.alertMessage(l)};a.prototype.ajax("stop").then(k,k)},_namedCallbacks:{},registerNamedCallback:function(l,k){a.prototype._namedCallbacks[l]=k},fireNamedCallback:function(l,m){var k=a.prototype._namedCallbacks[l];if(k&&k instanceof Function){k(m)}},doTransaction:function(n,p,m){var l=j.Deferred();console.log("Starting transaction...");if(a.prototype._transaction!==null&&!p){console.error("A previous incomplete transaction already exists. Either set nestTransactions to true or make sure there is at most one transaction.");a.prototype._transaction.nestingLevel=a.prototype._transaction.nestingLevel+1;l=a.prototype._transaction.__globalDeferred}else{a.prototype._transaction={accumulatedEvents:[],rollBackData:[],nestingLevel:0,promises:[],localDeferreds:[],__globalDeferred:l,complete:false};for(var o=0;o<a.prototype.__rollbackList.length;o++){var k=a.prototype.__rollbackList[o];console.log("    Backing up: "+k);a.prototype._transaction.rollBackData.push(JSON.stringify(a.prototype[k]))}}console.log("Calling the non atomic function...");var r=false;try{if(typeof n==="function"){n()}else{console.error("Argument "+n+" is not a function.")}}catch(q){r=true;console.log("Error during non atomic function call: "+q);if(m){console.log("Rolling back the transaction");for(var o=0;o<a.prototype.__rollbackList.length;o++){var k=a.prototype.__rollbackList[o];console.log("    Restoring: "+k);a.prototype[k]=JSON.parse(a.prototype._transaction.rollBackData[o])}a.prototype._transaction=null;console.log("Transaction rolled back.")}l.reject()}if(!r){if(a.prototype._transaction.nestingLevel>0){a.prototype._transaction.nestingLevel=a.prototype._transaction.nestingLevel-1;console.log("Nested transaction complete. Nesting level : "+a.prototype._transaction.nestingLevel)}else{a.prototype._transaction.complete=true;console.log("Waiting for all events to resolve.");j.when.apply(j,a.prototype._transaction.promises).always(function(){console.log("Firing all events together...");a.prototype.fireAllEvents(a.prototype._transaction.accumulatedEvents);var u=a.prototype._transaction.promises,s=0;for(var t=0;t<u.length;t++){if(u[t].state()==="rejected"){s++}}if(s>0){l.reject()}else{l.resolve()}console.log("Cleaning up transaction...");a.prototype._transaction=null;console.log("Transaction complete")})}}return l.promise()},getNewTransactionDeferred:function(k){k=k||{};var m=new j.Deferred();var l=m.promise();if(a.prototype._transaction!==null&&!a.prototype._transaction.complete){a.prototype._transaction.promises.push(l);a.prototype._transaction.localDeferreds.push(m)}if(k.noSpinner!==true){proxy.spinnerControlShow()}m.done(proxy.spinnerControlHide);return m},propagateEvent:function(k,l){var m=k.eventID;if(m==="save"){proxy.spinnerControlShow();try{a.prototype.storeAdviseCase(k,l)}catch(o){proxy.spinnerControlHide()}return}else{if(m==="restore"){proxy.spinnerControlShow();var q=confirm(e.translate("CONFIRM_MSG_HEAD")+"\n"+e.translate("CONFIRM_MSG_TAIL"));if(q===true){a.prototype.executeCommand({commandName:"restoreAdviseCase"}).done(function(){proxy.createPage("moreInfo");proxy.createPage("shopPage");a.prototype.initialize(function(){var t=[];for(var u=0;u<c.EVENT_TYPES_ARRAY.length;u++){var v={};v.iaEventType=c.EVENT_TYPES_ARRAY[u];t.push(v)}a.prototype.fireAllEvents(t);proxy.spinnerControlHide()})})}else{proxy.spinnerControlHide()}return}else{if(m==="exit"){var r=new Date();var n=confirm(e.translate("EXIT_CONFIRM")+"\n"+e.translate("CONFIRM_MSG_TAIL"));var p=new Date();if(p-r<10){n=true}if(n===true){a.prototype.stopServant()}return}else{if(m==="help"){a.prototype._helpHandler(k);return}}}}var s=false;if(a.prototype._transaction!==null){j(a.prototype._transaction.localDeferreds).each(function(t,u){if(u===l){a.prototype._transaction.accumulatedEvents.push(k);s=true;return false}})}if(!s){a.prototype.fireAllEvents([k])}},addEventListener:function(l){var k=a.prototype.eventListeners.maxIndex;if(j.isFunction(l)){l={triggerEvent:l}}if(!l.triggerEvent&&!j.isFunction(l.triggerEvent)){throw'The listener does not have the "triggerEvent" method'}a.prototype.eventListeners.maxIndex=a.prototype.eventListeners.maxIndex+1;a.prototype.eventListeners["_ID_"+k]=l;return a.prototype.eventListeners.maxIndex},removeEventListener:function(k){delete a.prototype.eventListeners["_ID_"+k]},removeAllEventListeners:function(){var k=a.prototype.eventListeners.maxIndex;a.prototype.eventListeners={maxIndex:k}},fireAllEvents:function(q){function m(){j(a.prototype.page).each(function(u,v){j(v.element).advisePage("triggerEvent",q)});var t=[];for(var s in a.prototype.eventListeners){if(s.toString().indexOf("_ID_")>-1){t.push(a.prototype.eventListeners[s])}}j(t).each(function(u,v){v.triggerEvent(q)})}function p(){if(a.prototype._dashboardURL&&a.prototype._dashboardURL.length>0){var s={EVENTS:q};window.parent.postMessage(JSON.stringify(s),"*")}}if(j.isArray(q)){var l=false;for(var n=0;n<q.length;n++){var o=q[n];if((typeof o.iaEventType!=="undefined"&&o.iaEventType===c.EVENT_TYPE_FORMULATION_CHANGED)||o.iaEventType===c.EVENT_TYPE_GRADING_CHANGED||o.iaEventType===c.EVENT_TYPE_PARAMETER_CHANGED){l=true;break}}if(l){a.prototype.syncBasketRank().done(function(){proxy.updateBasketUI()}).always(function(){m()})}else{m()}}else{var k=[];for(var n=0;n<c.EVENT_TYPES_ARRAY.length;n++){var r={};r.iaEventType=c.EVENT_TYPES_ARRAY[n];k.push(r)}a.prototype.fireAllEvents(k)}},registerPage:function(k){a.prototype.page.push(k)},updateBasketUI:function(){j(".sim-ui-basket").adviseBasket();j(".sim-ui-basket").adviseBasket("refresh")},getConstraintBounds:function(k){var m=null;var l=null;j(a.prototype.formulation.constraints).each(function(n,o){if(o.parameterID===k){if(o.type==="LESS_THAN"){l=o.boundValue}if(o.type==="GREATER_THAN"){m=o.boundValue}if(m!==null&&l!==null){return false}}});return[m,l]},getObjective:function(k,l){var m=null;j(a.prototype.formulation.objectives).each(function(o,n){if(n.parameterID===k){if(n.type==="MINIMIZE"||n.type==="MAXIMIZE"||n.type==="TARGET"){m={type:n.type,value:n.value||null};return false}}});if(m!==null){if(typeof l!=="undefined"&&l===true){return m}else{return m.type}}else{return m}},getPreviewData:function(k){var l=null;if(k==="OutputParameters"){l=[];a.prototype.getOutputParametersList(a.prototype.varGroup,l)}else{if(k==="TableData"){l={tableColumns:["Variable","Units","Alias","Min","Max","Distribution","Comments"],types:["simple","editable","simple","simple","simple","simple","editable"]};var m=[];a.prototype.getInputsAsTableData(a.prototype.varGroup,m);l.variables=m}else{if(k==="ImageSource"){l=a.prototype._baseURL+a.prototype.caseInfo[k]+a.prototype._commandExt}else{l=a.prototype.caseInfo[k]}}}return l},addAllParameterObjectsToFlatList:function(m,n,k,l){if(!n){n=a.prototype.varGroup}if(!m){m=""}j(n.parameters).each(function(p,q){if(!l||(l&&q.dataType!=="STRING")){var o=JSON.parse(JSON.stringify(q));o.otherNames=o.otherNames||"";o.otherNames+=m+"."+(o.displayName||o.name);k.push(o)}});j(n.groups).each(function(o,q){var p=m+(q.displayName||q.name);a.prototype.addAllParameterObjectsToFlatList(p,q,k,l)})},getAllParameterObjectsAsFlatList:function(m,k){if(!m){m=a.prototype.varGroup}var l=[];a.prototype.addAllParameterObjectsToFlatList("",m,l,k);return l},addAllParametersToFlatList:function(m,k,l){if(!m){m=a.prototype.varGroup}j(m.parameters).each(function(n,o){if(!l||(l&&o.dataType!=="STRING")){k.push(o.ID)}});j(m.groups).each(function(n,o){a.prototype.addAllParametersToFlatList(o,k,l)})},getAllParametersAsFlatList:function(m,k){if(!m){m=a.prototype.varGroup}var l=[];a.prototype.addAllParametersToFlatList(m,l,k);return l},getOutputParametersList:function(l,k){j(l.parameters).each(function(m,n){if(n.role==="OUTPUT"||(n.role==="UNKNOWN"&&n.dataType!=="STRING")){k.push(n.ID)}});j(l.groups).each(function(m,n){a.prototype.getOutputParametersList(n,k)})},getOutputParametersList2:function(k){k=k||a.prototype.varGroup;var l=[];if(typeof k.groups!=="undefined"){k.groups.forEach(function(m){l=l.concat(a.prototype.getOutputParametersList2(m))})}if(typeof k.parameters!=="undefined"){l=l.concat(k.parameters.filter(function(m){return m.role==="OUTPUT"}))}return l.sort(function(n,m){if(typeof n.displayOrder!=="undefined"&&typeof m.displayOrder!=="undefined"){return n.displayOrder-m.displayOrder}return 0})},getInputParametersList:function(l,k){j(l.parameters).each(function(m,n){if(n.role==="INPUT"&&n.dataType!=="STRING"&&n.structure==="SCALAR"){k.push(n.ID)}});j(l.groups).each(function(m,n){a.prototype.getInputParametersList(n,k)})},getInputParametersList2:function(k){k=k||a.prototype.varGroup;var l=[];if(typeof k.groups!=="undefined"){k.groups.forEach(function(m){l=l.concat(a.prototype.getInputParametersList2(m))})}if(typeof k.parameters!=="undefined"){l=l.concat(k.parameters.filter(function(m){return m.role==="INPUT"}))}return l.sort(function(n,m){if(typeof n.displayOrder!=="undefined"&&typeof m.displayOrder!=="undefined"){return n.displayOrder-m.displayOrder}return 0})},getOtherParametersList:function(k){k=k||a.prototype.varGroup;var l=[];if(typeof k.groups!=="undefined"){k.groups.forEach(function(m){l=l.concat(a.prototype.getOtherParametersList(m))})}if(typeof k.parameters!=="undefined"){l=l.concat(k.parameters.filter(function(m){return m.role==="UNKNOWN"}))}return l.sort(function(n,m){if(typeof n.displayOrder!=="undefined"&&typeof m.displayOrder!=="undefined"){return n.displayOrder-m.displayOrder}return 0})},getInputsAsTableData:function(k,l){j(k.parameters).each(function(n,o){if(o.role==="INPUT"||o.role==="UNKNOWN"){var m=[o.displayName,o.unit?o.unit:"",o.alias?o.alias:"",o.min?o.min:"",o.max?o.max:"",o.distribution?o.distribution:"",o.comments?o.comments:""];l.push(m)}});j(k.groups).each(function(m,n){a.prototype.getInputsAsTableData(n,l)})},findGroup:function(k,m){if(!k||k===a.prototype.varGroup.ID||k===a.prototype.varGroup.displayName){return a.prototype.varGroup}else{if(!m){m=a.prototype.varGroup}var l=null;if(m.ID===k||m.displayName===k){l=m}if(l===null){j(m.groups).each(function(n,o){l=a.prototype.findGroup(k,o);return l===null})}return l}},findParametersByPlmId:function(m,p,l,k){if(!p){p=a.prototype.varGroup}var o={};o.depth=0;o.parentString="-root-,";o.parentList=[];if(l){o.parents=l;o.parentString=l.parentString+p.displayName;l.parentList=l.parentList||[];o.parentList=l.parentList.slice();o.parentList.push(p.displayName);o.groupName=p.displayName;o.groupID=p.ID;o.depth=l.depth+1}if(!k){k=[]}var n=null;j(p.parameters).each(function(q,r){if(r.plmParameterId){if(r.plmParameterId.indexOf(m)>-1){n=r;n.parents=o;k.push(n)}}});j(p.groups).each(function(r,q){a.prototype.findParametersByPlmId(m,q,o,k)});return true},findParameter:function(k,o,l){if(!o){o=a.prototype.varGroup}var n={};n.depth=0;n.parentString="-root-,";n.parentList=[];if(l){n.parents=l;n.parentString=l.parentString+o.displayName;l.parentList=l.parentList||[];n.parentList=l.parentList.slice();n.parentList.push(o.displayName);n.groupName=o.displayName;n.groupID=o.ID;n.depth=l.depth+1}var p=null;if(k==="overallscore"){p=a.prototype.varGroup.score;return p}if(o.score&&o.score.ID&&o.score.ID===k){p=o.score;return p}var m=null;j(o.parameters).each(function(q,r){if(r.ID===k){m=r;m.parents=n;return false}});if(m===null){j(o.groups).each(function(r,q){m=a.prototype.findParameter(k,q,n);return m===null})}return m},findParameterByName:function(p,l){var k={group:a.prototype.varGroup,parentGroups:null,matchDisplayNameAlso:false,ignoreCase:false};l=j.extend(l,k||{});if(l.ignoreCase){p=p.toLowerCase()}var o={};o.depth=0;o.parentString="-root-,";o.parentList=[];if(l.parentGroups){o.parents=l.parentGroups;o.parentString=l.parentGroups.parentString+l.group.displayName;l.parentGroups.parentList=l.parentGroups.parentList||[];o.parentList=l.parentGroup.parentList.slice();o.parentList.push(l.group.displayName);o.groupName=l.group.displayName;o.groupID=l.group.ID;o.depth=l.parentGroups.depth+1}var m=null;var n=l.group;j(n.parameters).each(function(s,u){var r=u.name,t=u.displayName;if(l.ignoreCase){r=r.toLowerCase();t=t.toLowerCase()}var q=p.indexOf(" ")>-1?encodeURIComponent(p):p;if(u.name===q||(l.matchDisplayNameAlso&&u.displayName===q)){m=u;m.parents=o;return false}});if(m===null){j(n.groups).each(function(s,r){var q=j.extend({},l);q.group=r;q.parentGroups=o;m=a.prototype.findParameterByName(p,q);return m===null})}return m},getFilteredParameters:function(m){var k=a.prototype.getAllParametersAsFlatList();var n=[];for(var l=0;l<k.length;l++){if(a.prototype._doesParameterSatisfyConditions(k[l],m)){n.push(k[l])}}return n},_doesParameterSatisfyConditions:function(s,t){var u=t.split("||");var m=false;for(var n=0;n<u.length;n++){var p=true;if(u[n]==="*"){m=true;break}var q=u[n].split("&&");for(var l=0;l<q.length;l++){var o=false;var k=u[l].split("==");if(k.length<2){k=u[l].split("!=");o=true}if(k.length!==2){console.error(k+"is malformed");return true}var r=a.prototype._doesParameterSatisfyCondition(s,k[0],k[1]);if((o||!r)&&(!o||r)){p=false;break}}if(p){m=true;break}}return m},_doesParameterSatisfyCondition:function(l,k,r){var q=false,m=false;var p=a.prototype.findParameter(l);if(typeof p!=="undefined"&&typeof p[k]!=="undefined"){var o=p[k];var n=typeof o;if(n==="string"){q=o===r;m=true}else{if(n==="number"&&o%1===0){q=o===parseInt(r,10);m=true}else{if(n==="number"){q=o===parseFloat(r,10);m=true}}}if(n==="boolean"){q=o===(r.toLowerCase()==="true");m=true}}if(!m){console.log("This condition is different and has not been checked: "+k+" on the parameter :");console.log(p);q=true}return q},getOutputParameterInformation:function(k,l){if(k!==null){k.mean=new Number(k.mean).toFixed(5);k.stdDev=new Number(k.stdDev).toFixed(5);k.percentiles=["100%","75%","50%","25%","0%"];k.percentileNames=[e.translate("Maximum"),e.translate("Upper Quartile"),e.translate("Median"),e.translate("Lower Quartile"),e.translate("Minimum")];k.quantiles=[new Number(k.max).toFixed(5),new Number(k.upperQuartile).toFixed(5),new Number(k.mean).toFixed(5),new Number(k.lowerQuartile).toFixed(5),new Number(k.min).toFixed(5)];k.numValues=0;j(k.histogramValues).each(function(m,n){k.numValues+=n})}if(l){l(k)}},getInitialNBestParameter:function(m){var l=[];a.prototype.getAllParametersAsFlatList(a.prototype.varGroup,true).forEach(function(o){var n=proxy.findParameter(o);if(n.structure!=="ARRAY"){l.push({ID:o,displayName:n.displayName,min:n.min,max:n.max,role:n.role})}});var k=function(o){var n=0;if(o.min!==o.max){n+=3}if(o.role==="OUTPUT"){n+=2}else{if(o.role==="INPUT"){n+=1}}return n};l.sort(function(o,n){return k(n)-k(o)});return l.splice(0,m)},__copyNonArrayAttributes:function(l,m){m=m||{};for(var k in l){if(l.hasOwnProperty(k)){var n=l[k];if(!(n instanceof Array)&&!(typeof n==="object")){m[k]=l[k]}}}return m},_partialCopyParameterHierarchy:function(o){var m=0;o=o||a.prototype.varGroup;var n=a.prototype.__copyNonArrayAttributes(o);if(o.parameters!==null){n.parameters=[];var k=(o.parameters&&o.parameters.length)||0;for(m=0;m<k;m++){var l=a.prototype.__copyNonArrayAttributes(o.parameters[m]);n.parameters.push(l)}}if(o.groups!==null){n.groups=[];var q=(o.groups&&o.groups.length)||0;for(m=0;m<q;m++){var p=a.prototype._partialCopyParameterHierarchy(o.groups[m]);n.groups.push(p)}}return n},getMatchedParameters:function(k,n){var m=a.prototype.getAllParameterObjectsAsFlatList();var l=[];m.forEach(function(s){var q=JSON.parse(JSON.stringify(s));var o=s.otherNames||[];var r="";o=!Array.isArray(o)?[o]:o;o.forEach(function(p){r+=p+"|"});q={name:s.displayName,otherNames:r,plmParameterId:s.plmParameterId,ID:s.ID,dataType:s.dataType};l.push(q)});a.prototype.executeCommand({commandName:"getMatchingParameters",method:"POST",data:{listFrom:JSON.stringify(l),listTo:JSON.stringify(k),idFieldName:"physicalId",nameFieldName:"displayName"}}).done(function(q,r,p){var o=f.getJSONFromResponse([q,r,p]);if(typeof n==="function"){n(l,o)}}).fail(function(){n(l,{})})},setBasketWeight:function(k,m,l){var n=null;if(k){n=a.prototype.findParameter(k)}if(n===null){n=a.prototype.findGroup(k)}if(n===null){console.error("Could not find a group or parameter with ID = "+k)}if(n&&n!==null){var o=a.prototype.getNewTransactionDeferred();l=l||{};l=j.extend({},l);l.iaEventType=c.EVENT_TYPE_GRADING_CHANGED;l.iaEventSource=k;n.basketWeight=parseFloat(m);a.prototype.setBasketWeights(k,m).done(function(){a.prototype.propagateEvent(l,o);o.resolve()}).fail(function(){o.resolve()})}},setParameterInfo:function(o,m){var p=a.prototype.getNewTransactionDeferred();var n=j.Deferred();if(!j.isArray(o)){o=[o]}j(o).each(function(r,s){var q=s.ID;var t=a.prototype.findParameter(q);if(t!==null){j.extend(true,t,s)}});m=m||{};m=j.extend({},m);m.iaEventType=c.EVENT_TYPE_PARAMETER_CHANGED;var l=a.prototype._partialCopyParameterHierarchy();var k={};a.prototype.setParameterHierarchy(l,k).done(function(){a.prototype.varGroup=k.content;a.prototype.decodeVarGroupFields();a.prototype.propagateEvent(m,p);var q={eventType:"CASE_MODIFIED",eventSubType:"parameterChanged",modifiedGroup:l};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(q)}p.resolve();n.resolve()}).fail(function(){p.resolve();n.reject()});return n},uploadFiles:function(p,o,l,r,n){if(!p){return}var q=a.prototype.getNewTransactionDeferred(),m=a.prototype._baseURL+"uploadFile",k="";n=n||{};n=j.extend({},n);n.iaEventType=c.EVENT_TYPE_FILE_UPLOADED_FOR_DESIGN;if(r){k+="parameterID="+r+"&";n.iaEventSource=r}if(l){k+="parameterName="+l+"&"}if(o){k+="rowID="+o}m+=k.length>0?"?"+k:"";j.ajax({type:"POST",url:m,data:p,processData:false,contentType:false,beforeSend:function(s){s.setRequestHeader("ra-from-user",a.prototype.currentUser.userID);s.setRequestHeader("X-CSRFToken",adviseLaunchInfo.token||"notoken")}}).done(function(){var s=a.prototype.syncFileList();j.when(s).always(function(){a.prototype.propagateEvent(n,q);q.resolve();d.alertMessage(d.SUCCESS,e.translate("SUCCESS_MSG_HEAD")+" "+e.translate("SUCCESS_MSG_TAIL"," #"+o))})}).fail(function(){q.resolve();d.alertMessage(d.ERROR,e.translate("UPLOAD_FAIL"))});return q},decodeVarGroupFields:function(){var l=function(n){try{n.displayName=decodeURIComponent(n.displayName);if(n.unit){n.unit=decodeURIComponent(n.unit)}if(n.notes){n.notes=decodeURIComponent(n.notes)}}catch(m){}};var k=function(o){var n;try{o.displayName=decodeURIComponent(o.displayName)}catch(m){}for(n=0;n<((o.groups&&o.groups.length)||0);n++){k(o.groups[n])}for(n=0;n<((o.parameters&&o.parameters.length)||0);n++){l(o.parameters[n])}};k(a.prototype.varGroup)},setVarGroup:function(k){a.prototype.varGroup=k},setGroupInfo:function(o,n){var p=new j.Deferred();var q=a.prototype.getNewTransactionDeferred();var l=o.ID;n=n||{};n=j.extend({},n);n.iaEventSource=l;n.iaEventType=c.EVENT_TYPE_PARAMETER_CHANGED;var m=a.prototype._partialCopyParameterHierarchy(o);var k={};a.prototype.setParameterHierarchy(m,k).done(function(){a.prototype.varGroup=k.content;a.prototype.decodeVarGroupFields();a.prototype.propagateEvent(n,q);if(n.iaEventUISource===undefined||n.iaEventUISource!=="dataHandler-saveOrder"){var r={eventType:"CASE_MODIFIED",eventSubType:"parameterChanged",modifiedGroup:m};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(r)}}a.prototype.syncBestDesignsForObjectives().done(function(){q.resolve();p.resolve()}).fail(function(){q.resolve();p.resolve()})}).fail(function(){q.resolve();p.reject()});return p},setConstraint:function(o,r,s,k,n,l){if(a.prototype.isFormulationLocked()){return}var p=a.prototype.getNewTransactionDeferred();if(o==="overallscore"){a.prototype.setParametricFilter(o,r,s,k);return}k=k||{};k=j.extend({},k);k.iaEventSource=o;k.iaEventType=c.EVENT_TYPE_FORMULATION_CHANGED;var m={parameterID:o,type:r,boundValue:s,sourceName:n,sourceParameterName:l};a.prototype.setConstraints(m).done(function(){proxy.getParameterHierarchy().done(function(){a.prototype.propagateEvent(k,p);p.resolve()}).fail(function(){p.resolve()})}).fail(function(){p.resolve()});var q={eventType:"CASE_MODIFIED",eventSubType:"constraintChanged",modifiedConstraint:m};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(q)}},setPlmParameterId:function(k,l,m){var o=a.prototype.getNewTransactionDeferred();if(k===undefined||k===null){return}m=m||{};m=j.extend({},m);m.iaEventSource=k;m.iaEventType=c.EVENT_TYPE_PARAMETER_CHANGED;var n={};n[k]=l;a.prototype.executeCommand({commandName:"setPlmParameterIDs",data:{values:JSON.stringify(n)}}).done(function(){proxy.getParameterHierarchy().done(function(){a.prototype.propagateEvent(m,o);o.resolve()})}).fail(function(){o.resolve()})},setPriorityForParameters:function(m,n){if(typeof m==="undefined"||m===null||m.length===0){return false}for(var l=0;l<m.length;l++){var o=m[l].ID;if(o){var k=parseInt(m[l].priority);if(k>=0&&k<=5){a.prototype.findParameter(o).priority=k}}}n=n||proxy.getGroupCopy(proxy.varGroup);a.prototype.setParameterHierarchy(n,{})},selectPoint:function(l,k){l=l||{};l=j.extend({},l);l.iaEventType="selectionChanged";l.selectedIndices=a.prototype.selectedIndices=[];l.lastSelected=a.prototype.lastSelected=-1;if(k instanceof Array&&k.length>0){l.selectedIndices=a.prototype.selectedIndices=k;l.lastSelected=a.prototype.lastSelected=k[k.length-1]}else{if(k!==null&&k!=="undefined"&&typeof k!=="undefined"&&!isNaN(k)){l.selectedIndices=a.prototype.selectedIndices=[k];l.lastSelected=a.prototype.lastSelected=k}}a.prototype.propagateEvent(l)},getSelectedIndices:function(){if(!a.prototype.selectedIndices){a.prototype.selectedIndices=[]}return a.prototype.selectedIndices},getLastSelected:function(){if(!a.prototype.lastSelected){a.prototype.lastSelected=-1}return a.prototype.lastSelected},getFormulation:function(){return a.prototype.formulation},setObjective:function(k,o,n,m){if(a.prototype.isFormulationLocked()){return}var p=a.prototype.getNewTransactionDeferred();m=m||{};m=j.extend({},m);m.iaEventSource=k;m.iaEventType=c.EVENT_TYPE_FORMULATION_CHANGED;var l={parameterID:k,type:o,value:n,rank:1};a.prototype.setObjectives(l).done(function(){var q=a.prototype.syncBestDesignsForObjectives();var s=a.prototype.syncBestDesignsOverall();var r=a.prototype.getParameterHierarchy();j.when(r,s,q).done(function(){a.prototype.propagateEvent(m,p);p.resolve()}).fail(function(){p.resolve()})}).fail(function(){p.resolve()})},getExcludedRowIdList:function(){return a.prototype.excludedRowIdList},excludePoints:function(m){var l=a.prototype.excludedRowIdList.slice();for(var k=0;k<m.length;k++){if(l.indexOf(m[k])<0){l.push(m[k])}}a.prototype.executeCommand({commandName:"setExcludedRowIdListFromJson",data:{rowIdList:JSON.stringify(l)}}).done(function(p,n,o){a.prototype.excludedRowIdList=f.getJSONFromResponse([p,n,o]);proxy.getParameterHierarchy().done(function(){var r={};r.iaEventSource="exclude";r.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(r);var q={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(q)}})});a.prototype.updateApproximationStatus()},isIncluded:function(k){return(j.inArray(k,a.prototype.excludedRowIdList)===-1)},includePoints:function(n){var m=a.prototype.excludedRowIdList.slice();for(var l=0;l<n.length;l++){var k=m.indexOf(n[l]);if(k>=0){m.remove(k)}}a.prototype.executeCommand({commandName:"setExcludedRowIdListFromJson",data:{rowIdList:JSON.stringify(m)}}).done(function(q,o,p){a.prototype.excludedRowIdList=f.getJSONFromResponse([q,o,p]);proxy.getParameterHierarchy().done(function(){var s={};s.iaEventSource="exclude";s.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(s);var r={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(r)}})});a.prototype.updateApproximationStatus()},getFileNames:function(){return a.prototype.fileNames},getImageNames:function(){return a.prototype.imageNames||[]},getIntelligentFilter:function(){var k=a.prototype.getPreviewData("OutputParameters");var q=k.length;var l=-1;var o=-1;var p=-1;if(q>0){for(var n=0;n<q;n++){var m=k[n];var r=a.prototype.findParameter(m);if(typeof r.min!=="undefined"&&typeof r.max!=="undefined"){if(r.min<r.max){p=r.histogramValues.sum();o=r.infeasibleHistogramValues.sum();l=r.paretoHistogramValues.sum();break}}}}a.prototype.filters={display:{paretoSeen:true,dominatedSeen:false,infeasibleSeen:false,excludedSeen:false}};if(l>0){if(l<10){a.prototype.filters.display.dominatedSeen=true}}else{if(p-o>0){a.prototype.filters.display.dominatedSeen=true}else{a.prototype.filters.display.dominatedSeen=true;a.prototype.filters.display.infeasibleSeen=true}}a.prototype.createDefaultDataSetFilters();return a.prototype.filters},createDefaultDataSetFilters:function(){a.prototype.filters.dataSetFilters=[];if(a.prototype.caseInfo.DataSets.length>1){for(var k=0;k<a.prototype.caseInfo.DataSets.length;k++){var l=a.prototype.caseInfo.DataSets[k].title;if(typeof l==="undefined"||l===null||l.length===0){l=a.prototype.caseInfo.DataSets[k].name}a.prototype.filters.dataSetFilters.push({alias:a.prototype.caseInfo.DataSets[k].alias,fileName:a.prototype.caseInfo.DataSets[k].fileName,name:l,rowCount:a.prototype.caseInfo.DataSets[k].rowCount,checked:true,deleted:Boolean(a.prototype.caseInfo.DataSets[k].deleted)})}}return a.prototype.filters.dataSetFilters},doFiltering:function(l){a.prototype.filters={display:{paretoSeen:true,dominatedSeen:true,infeasibleSeen:true,excludedSeen:true}};var k=a.prototype.createDefaultDataSetFilters();a.prototype.filters.paramFilters=[];a.prototype.filters.rowTagFilters=[];j(l).each(function(o,p){if(p.parameterID){a.prototype.filters.paramFilters.push(p)}else{if(p.rowGrade){switch(p.rowGrade){case"GRADE_EXCLUDED":a.prototype.filters.display.excludedSeen=false;break;case"GRADE_INFEASIBLE":a.prototype.filters.display.infeasibleSeen=false;break;case"GRADE_DOMINATED":a.prototype.filters.display.dominatedSeen=false;break;case"GRADE_PARETO":a.prototype.filters.display.paretoSeen=false;break}}else{if(p.tagName){if(p.tagName==="DATA_SET"){var n=p.tagValue;for(var m=0;m<k.length;m++){if(k[m].alias===n){k[m].checked=false;break}}}else{a.prototype.filters.rowTagFilters.push(p)}}else{if(typeof p.totalDesigns!=="undefined"&&typeof p.displayedDesigns!=="undefined"){a.prototype.filters.designCounter=p}}}}})},setFiltersAndSync:function(m){var o=a.prototype.getNewTransactionDeferred(),n=new j.Deferred();var l=[];if(!a.prototype.filters.display.paretoSeen){l.push({"@class":"LogicalCondition",type:"ROW_GRADE_EQUALS",rowGrade:"GRADE_PARETO"})}if(!a.prototype.filters.display.dominatedSeen){l.push({"@class":"LogicalCondition",type:"ROW_GRADE_EQUALS",rowGrade:"GRADE_DOMINATED"})}if(!a.prototype.filters.display.infeasibleSeen){l.push({"@class":"LogicalCondition",type:"ROW_GRADE_EQUALS",rowGrade:"GRADE_INFEASIBLE"})}if(!a.prototype.filters.display.excludedSeen){l.push({"@class":"LogicalCondition",type:"ROW_GRADE_EQUALS",rowGrade:"GRADE_EXCLUDED"})}j(a.prototype.filters.paramFilters).each(function(p,q){l.push(q)});j(a.prototype.filters.rowTagFilters).each(function(p,q){l.push(q)});j(a.prototype.filters.dataSetFilters).each(function(p,q){if(!q.checked){l.push({"@class":"LogicalCondition",type:"ROW_TAG_VALUE_EQUALS",tagName:"DATA_SET",tagValue:q.alias})}});m=m||{};m.iaEventSource="filter";m.iaEventType=c.EVENT_TYPE_FILTER_CHANGED;var k=a.prototype.isHost()?"setExplorationFilterFromJson":"getExplorationFilterAsJson";a.prototype.executeCommand({commandName:k,data:{filter:JSON.stringify(l)}}).done(function(s,p,q){s=f.getJSONFromResponse([s,p,q]);s.forEach(function(t){if(t.priorityWeight){a.prototype.varGroup=t;a.prototype.decodeVarGroupFields()}});a.prototype.doFiltering(s);a.prototype.propagateEvent(m,o);if(m.iaEventUISource===undefined){var r={eventType:"CASE_MODIFIED",eventSubType:"filtersChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(r)}}o.resolve();n.resolve()}).fail(function(){o.resolve();n.reject()});return n},getParametricFilterBounds:function(k){a.prototype.filters.paramFilters=a.prototype.filters.paramFilters||[];var m=null;var l=null;if(k==="overallscore"){k=a.prototype.varGroup.score.ID}j(a.prototype.filters.paramFilters).each(function(n,o){if(o.parameterID===k){if(o.type==="GREATER_THAN"){l=o.boundValue}if(o.type==="LESS_THAN"){m=o.boundValue}if(o.type==="IN_RANGE"){m=o.boundValue}if(o.type==="ONE_OF"){m=o.valueList}if(m!==null&&l!==null){return false}}});return[m,l]},setMultipleFilters:function(n,m){var l;for(var k=0;k<n.length;k++){l=n[k];a.prototype.setFilterOnProxy(l.paramID,l.type,l.firstFilterValue,m,l.secondFilterValue,l.filterName)}return a.prototype.setFiltersAndSync(m)},setFilterOnProxy:function(p,r,n,l,q,m){a.prototype.filters.paramFilters=a.prototype.filters.paramFilters||[];var o=-1;if(p==="overallscore"){p=a.prototype.varGroup.score.ID}j(a.prototype.filters.paramFilters).each(function(t,u){if(u.parameterID===p&&u.type===r){o=t;return false}});if(o>-1){a.prototype.filters.paramFilters.remove(o)}var s=false;if(r==="GREATER_THAN"&&n===a.prototype.findParameter(p).max){s=true}else{if(r==="LESS_THAN"&&n===a.prototype.findParameter(p).min){s=true}else{if(r==="IN_RANGE"&&n===q){s=true}else{if(r==="ONE_OF"&&n===null){s=true}}}}var k=null;if(!s){if(r==="IN_RANGE"){k={"@class":"ParametricCondition",type:r,parameterID:p,range:[n,q],filterName:m}}else{if(r==="ONE_OF"){k={"@class":"ParametricCondition",type:r,parameterID:p,valueList:n,filterName:m}}else{k={"@class":"ParametricCondition",type:r,parameterID:p,boundValue:n,filterName:m}}}a.prototype.filters.paramFilters.push(k)}},setParametricFilter:function(m,n,l,o,k){if(proxy.caseInfo.userList[proxy.caseInfo.CurrentUser.userID].isInControl){a.prototype.setFilterOnProxy(m,n,l,o,k);return a.prototype.setFiltersAndSync(o)}else{return j.Deferred().resolve()}},toggleFilter:function(){a.prototype.filters.display.excludedSeen=j("input#excludedFilterCheckBox").prop("checked");a.prototype.filters.display.dominatedSeen=j("input#dominatedFilterCheckBox").prop("checked");a.prototype.filters.display.infeasibleSeen=j("input#infeasibleFilterCheckBox").prop("checked");a.prototype.filters.display.paretoSeen=j("input#bestFilterCheckBox").prop("checked");a.prototype.setFiltersAndSync()},dataSetFilterChanged:function(k,l){a.prototype.filters.dataSetFilters[k].checked=l;a.prototype.setFiltersAndSync()},getDataSets:function(){return a.prototype.caseInfo.DataSets},initializeFilters:function(){var m=a.prototype.getNewTransactionDeferred();var k={};k.iaEventSource="filter";k.iaEventType=c.EVENT_TYPE_FILTER_CHANGED;var l={};a.prototype.getExplorationFilter(l).done(function(){var q=l.content||[];if(q.length===0){var p=a.prototype.getIntelligentFilter();j("input#excludedFilterCheckBox").prop("checked",p.display.excludedSeen);j("input#dominatedFilterCheckBox").prop("checked",p.display.dominatedSeen);j("input#infeasibleFilterCheckBox").prop("checked",p.display.infeasibleSeen);j("input#bestFilterCheckBox").prop("checked",p.display.paretoSeen);m.resolve();a.prototype.setFiltersAndSync()}else{var r={},o=[];q.forEach(function(s){if(s.type==="ROW_GRADE_EQUALS"){r[s.rowGrade]=true}else{if(s.parameterID===proxy.varGroup.score.ID){o.push(s)}}});a.prototype.filters={display:{paretoSeen:typeof r.GRADE_PARETO!=="undefined"?false:true,dominatedSeen:typeof r.GRADE_DOMINATED!=="undefined"?false:true,infeasibleSeen:typeof r.GRADE_INFEASIBLE!=="undefined"?false:true,excludedSeen:typeof r.GRADE_PARETO!=="undefined"?false:true}};var n=a.prototype.createDefaultDataSetFilters();a.prototype.filters.scoreFilters=o;a.prototype.filters.paramFilters=[];a.prototype.filters.rowTagFilters=[];j(q).each(function(u,v){if(v.parameterID){a.prototype.filters.paramFilters.push(v)}else{if(v.rowGrade){switch(v.rowGrade){case"GRADE_EXCLUDED":a.prototype.filters.display.excludedSeen=false;break;case"GRADE_INFEASIBLE":a.prototype.filters.display.infeasibleSeen=false;break;case"GRADE_DOMINATED":a.prototype.filters.display.dominatedSeen=false;break;case"GRADE_PARETO":a.prototype.filters.display.paretoSeen=false;break}}else{if(v.tagName){if(v.tagName==="DATA_SET"){var t=v.tagValue;for(var s=0;s<n.length;s++){if(n[s].alias===t){n[s].checked=false;break}}}else{a.prototype.filters.rowTagFilters.push(v)}}else{if(typeof v.totalDesigns!=="undefined"&&typeof v.displayedDesigns!=="undefined"){a.prototype.filters.designCounter=v}}}}});j("input#excludedFilterCheckBox").prop("checked",a.prototype.filters.display.excludedSeen);j("input#dominatedFilterCheckBox").prop("checked",a.prototype.filters.display.dominatedSeen);j("input#infeasibleFilterCheckBox").prop("checked",a.prototype.filters.display.infeasibleSeen);j("input#bestFilterCheckBox").prop("checked",a.prototype.filters.display.paretoSeen);a.prototype.propagateEvent(k,m);m.resolve()}}).fail(function(){m.resolve()});return m},addToBasket:function(l){a.prototype.basket=a.prototype.basket||[];console.debug("adding point/points to basket...");var k,m=false;if(l instanceof Array){for(k=0;k<l.length;k++){if(a.prototype.isInBasket(Number(l[k]))===-1){a.prototype.basket.push(Number(l[k]));m=true}}}else{if(a.prototype.isInBasket(Number(l))===-1){a.prototype.basket.push(parseInt(l,10));m=true}}if(m===true){a.prototype.syncBasketWithServer(a.prototype.basket)}},removeFromBasket:function(m){a.prototype.basket=a.prototype.basket||[];console.debug("removing point from basket...");var l,k,n=false;if(m instanceof Array){for(l=0;l<m.length;l++){k=a.prototype.isInBasket(Number(m[l]));if(k>-1){a.prototype.basket.remove(k);n=true}}}else{k=a.prototype.isInBasket(parseInt(m,10));if(k>-1){a.prototype.basket.remove(k);n=true}}if(n===true){a.prototype.syncBasketWithServer(a.prototype.basket)}},syncBasketWithServer:function(l){var k={};if(l){return proxy.setBasketRowIDList(l,k).done(a.prototype.setBasket)}else{return proxy.getBasketRowIDList(k).done(a.prototype.setBasket)}},setBasket:function(){var n=a.prototype.getNewTransactionDeferred();var m=a.prototype.syncBasketRank();var l=a.prototype.syncRecommendedDesign(null);var k=a.prototype.syncBasketFiles();j.when(m,l,k).done(function(){proxy.updateBasketUI();var o={iaEventSource:"basket",iaEventType:c.EVENT_TYPE_BASKET_CHANGED};a.prototype.propagateEvent(o,n);n.resolve()}).fail(function(){n.resolve()});return n},setRecommendedDesign:function(k){var m=a.prototype.getNewTransactionDeferred();var l=a.prototype.basketRecommended.indexOf(k);if(l>-1){a.prototype.basketRecommended=a.prototype.basketRecommended.splice(l,1)}a.prototype.syncRecommendedDesign(k).done(function(){proxy.updateBasketUI();var n={iaEventSource:"basket",iaEventType:c.EVENT_TYPE_BASKET_CHANGED};a.prototype.propagateEvent(n,m);m.resolve()}).fail(function(){m.resolve()})},getRecommendedDesign:function(){if(a.prototype.basketRecommended===null||typeof a.prototype.basketRecommended==="undefined"){a.prototype.basketRecommended=[]}return a.prototype.basketRecommended},getBasketFiles:function(){if(!a.prototype.basketFiles){a.prototype.basketFiles={}}return a.prototype.basketFiles},syncBasketFiles:function(){return proxy.getFilesForRowIDList(a.prototype.basket)},syncBasketRank:function(){return proxy.getRankListForRowID()},syncRecommendedDesign:function(k){if(k===null){return a.prototype.getRecommendedRowID()}else{return a.prototype.setRecommendedRowID(k)}},syncBestDesignsForObjectives:function(){return a.prototype.getBestDesignsForEachObjective()},syncBestDesignsOverall:function(){return a.prototype.getBestOverallDesigns()},isInBasket:function(k){a.prototype.basket=a.prototype.basket||[];var l=-1;j(a.prototype.basket).each(function(m,n){if(n===k){l=m;return true}});return l},getBasketCount:function(){a.prototype.basket=a.prototype.basket||[];return a.prototype.basket.length},getBasketList:function(){a.prototype.basket=a.prototype.basket||[];return a.prototype.basket},getBasketRankList:function(){a.prototype.basketRank=a.prototype.basketRank||[];return a.prototype.basketRank},getBestDesignsForObjectives:function(){a.prototype.bestDesignsForObjectives=a.prototype.bestDesignsForObjectives||[];return a.prototype.bestDesignsForObjectives},getBestDesignsOverall:function(){a.prototype.bestDesignsOverall=a.prototype.bestDesignsOverall||[];return a.prototype.bestDesignsOverall},getFileList:function(){a.prototype.fileList=a.prototype.fileList||[];return a.prototype.fileList},getBasketColorMap:function(){var m=a.prototype.getBasketList();var k="";for(var l=0;l<m.length;l++){k+=m[l]}a.prototype.prevBasket=a.prototype.prevBasket||"";if(!a.prototype.prevBasketMap||a.prototype.prevBasket!==k){a.prototype.prevBasket=k;if(d3&&d3.scale&&d3.scalecategory20){a.prototype.prevBasketMap=new d3.scale.category20().domain(m)}else{a.prototype.prevBasketMap=function(o){var n=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var p=a.prototype.isInBasket(o);return n[1+p%(n.length-1)]}}}return a.prototype.prevBasketMap},addOptPointsToDataSet:function(q,k,n,l,o){var r=a.prototype.getNewTransactionDeferred();o=o||{};if((typeof q==="undefined"||q===null||q.length===0)){r.reject()}else{if(!Array.isArray(k)){k=[k]}var p="";k.forEach(function(s){if(typeof s!=="undefined"&&s!==null&&s>-1){p+=s+","}});if(p.length>0){p=p.substring(0,p.length-1);var m=(n===true)?"addOptPointsToBasket":"addOptPointsToDataSet";a.prototype.executeCommand({commandGroup:"approximation",commandName:m,data:{rowIds:p,approximationId:q}}).done(function(w,y,v){var u=f.getJSONFromResponse([w,y,v]);var s=Object.keys(u);if(s.length>0){var x={};s.forEach(function(z){x[z]={DATA_SET:(u[z]["dataset_alias"]||"USER_CREATED_OPTIMIZATION"),DATA_SET_NAME:(u[z]["dataset_name"]||"Optimization"),DATA_SET_TYPE:(u[z]["data_type"]||"Optimization Data")}});a.prototype.updateCaseInfo({addedRows:x,deletedRows:{}});o.isOptimizationData=true;o.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(o);if(window.parent&&window.parent.postMessageToWidget){var t={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};window.parent.postMessageToWidget(t)}if(!n===true){d.alertMessage(e.translate("OPT_ADD_TO_DS"));r.resolve()}else{a.prototype.basket=a.prototype.basket||[];s.forEach(function(z){a.prototype.basket.push(z)},this);a.prototype.syncBasketWithServer(a.prototype.basket).done(function(){d.alertMessage(e.translate("OPT_ADD_TO_BKT"));r.resolve()})}}else{r.resolve()}})}else{r.reject()}}return r},createDataRow:function(k,o,l){l=l||{};var m=new j.Deferred();var n=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"createDataRowAtIndex",data:{rowIndex:o}}).done(function(t,v,s){var r=f.getJSONFromResponse([t,v,s]);a.prototype.varGroup.score.histogramValues[0]+=1;var u={},q;for(q=0;q<r.length;q++){u[r[q]]={DATA_SET:"USER_CREATED"}}a.prototype.updateCaseInfo({addedRows:u,deletedRows:{}});a.prototype.updateApproximationStatus();k.content=r;l.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(l,n);var p={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(p)}m.resolve();n.resolve()}).fail(function(){m.reject();n.resolve()});return m},createDataRows:function(k,n,l){l=l||{};n=n||1;var m=new j.Deferred();var o=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"createNewDataRows",data:{numRows:n}}).done(function(t,v,s){var r=f.getJSONFromResponse([t,v,s]);a.prototype.varGroup.score.histogramValues[0]+=n;var u={},q;for(q=0;q<r.length;q++){u[r[q]]={DATA_SET:"USER_CREATED"}}a.prototype.updateCaseInfo({addedRows:u,deletedRows:{}});a.prototype.updateApproximationStatus();k.content=r;l.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(l,o);var p={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(p)}m.resolve();o.resolve()}).fail(function(){m.reject();o.resolve()});return m},createMeasureColumn:function(p,m,q,l){l=l||{};l.lastColumnID=p;var o=l.event||{};o.lastColumnID=p;var n=new j.Deferred();var r=a.prototype.getNewTransactionDeferred();var k={commandName:"createArrayMeasureColumn",data:{arrayId:p,measure:m,arrayIndices:encodeURIComponent(JSON.stringify(q))}};a.prototype.executeCommand(k).done(function(u,v,t){var s=f.getJSONFromResponse([u,v,t]);o.moveNode=true;o.newColumnID=s.newParameterId;a.prototype.varGroup=s.fullParameterHierarchy;a.prototype.decodeVarGroupFields();n.resolve();o.iaEventType=c.EVENT_TYPE_HIERARCHY_CHANGED;a.prototype.propagateEvent(o,r);r.resolve()}).fail(function(){n.reject();r.resolve()});return n},createDataColumn:function(n,m){var o=m.event||{};var l=new j.Deferred();var p=a.prototype.getNewTransactionDeferred();var k={commandName:"createNewDataColumn",data:{}};if(typeof m.name!=="undefined"){k.data.name=m.name}if(typeof m.values!=="undefined"){k.data.values=dataValuesString}a.prototype.executeCommand(k).done(function(s,t,r){var q=f.getJSONFromResponse([s,t,r]);n.content=q;o.moveNode=true;o.newColumnID=n.content.newParameterId;a.prototype.varGroup=q.fullParameterHierarchy;a.prototype.decodeVarGroupFields();l.resolve();o.iaEventType=c.EVENT_TYPE_HIERARCHY_CHANGED;a.prototype.propagateEvent(o,p);p.resolve()}).fail(function(){l.reject();p.resolve()});return l},createDataColumns:function(m,l,n){n=n||{};var k=new j.Deferred();var o=a.prototype.getNewTransactionDeferred();l=l||1;a.prototype.executeCommand({commandName:"createNewDataColumns",data:{numColumns:l}}).done(function(r,s,q){var p=f.getJSONFromResponse([r,s,q]);m.content=p;a.prototype.varGroup=p.fullParameterHierarchy;a.prototype.decodeVarGroupFields();k.resolve();n.iaEventType=c.EVENT_TYPE_HIERARCHY_CHANGED;a.prototype.propagateEvent(n,o);o.resolve()}).fail(function(){k.reject();o.resolve()});return k},deleteDataRows:function(o,n){n=n||{};if(!Array.isArray(o)){o=[o]}var k=o.some(function(q){return(q.metaData.tags&&q.metaData.tags.DATA_SET&&q.metaData.tags.DATA_SET!=="PREDICTED"&&!q.metaData.tags.DATA_SET.startsWith("USER_CREATED_OPTIMIZATION"))});var l=o.map(function(q){return q.metaData.id});var p=a.prototype.getNewTransactionDeferred();var m=new j.Deferred();a.prototype.executeCommand({commandName:"deleteDataRows",data:{rowIdList:JSON.stringify(l)}}).done(function(t,v,s){a.prototype.varGroup=f.getJSONFromResponse([t,v,s]);a.prototype.decodeVarGroupFields();var u={},r;for(r=0;r<o.length;r++){u[o[r]]=o[r]}a.prototype.updateCaseInfo({addedRows:{},deletedRows:u});if(true===k){a.prototype.updateApproximationStatus()}n.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(n,p);var q={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(q)}a.prototype.syncBasketWithServer();p.resolve();m.resolve()}).fail(function(){p.resolve();m.reject()});return m},deleteParameters:function(k,l){var n=new j.Deferred();l=l||{};var o=a.prototype.getNewTransactionDeferred();l.deletedPArams=k;var m=encodeURIComponent(JSON.stringify(k));a.prototype.executeCommand({commandName:"deleteDataColumns",data:{parameterIdList:m}}).done(function(r,s,q){a.prototype.varGroup=f.getJSONFromResponse([r,s,q]);a.prototype.decodeVarGroupFields();a.prototype.updateApproximationStatus("NOT_AVAILABLE");l.iaEventType=c.EVENT_TYPE_HIERARCHY_CHANGED;a.prototype.propagateEvent(l,o);var p={eventType:"CASE_MODIFIED",eventSubType:"parametersDeleted",deletedParams:l.deletedPArams};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(p)}n.resolve();o.resolve()}).fail(function(){n.reject();o.resolve()});return n},updateCaseInfo:function(o){o.addedRows=o.addedRows||{};o.deletedRows=o.deletedRows||{};var p=a.prototype.caseInfo;var n=function(q){return q.alias===o.addedRows[m].DATA_SET};var k=function(q){return(q.alias===o.deletedRows[m].metaData.tags.DATA_SET)};var m=null,l=null;for(m in o.addedRows){if(o.addedRows.hasOwnProperty(m)){a.prototype.filters.designCounter.displayedDesigns++;a.prototype.filters.designCounter.totalDesigns++;l=p.DataSets.filter(n);if(l.length>0){l=l[0];l.rowCount++}else{if(o.addedRows[m].DATA_SET==="USER_CREATED"){l={alias:"USER_CREATED",name:e.translate("User Created"),rowCount:1,typeName:e.translate("User created data")}}else{if(o.addedRows[m].DATA_SET==="PREDICTED"){l={alias:"PREDICTED",name:e.translate("Predicted"),rowCount:1,typeName:e.translate("Predicted Designs")}}else{if(o.addedRows[m].DATA_SET.startsWith("USER_CREATED_OPTIMIZATION")){l={alias:o.addedRows[m].DATA_SET,name:o.addedRows[m].DATA_SET_NAME,rowCount:1,typeName:o.addedRows[m].DATA_SET_TYPE}}}}p.DataSets.push(l)}}}for(m in o.deletedRows){if(o.deletedRows.hasOwnProperty(m)){a.prototype.filters.designCounter.displayedDesigns--;a.prototype.filters.designCounter.totalDesigns--;l=p.DataSets.filter(k);if(l.length>0){l=l[0];l.rowCount--}else{throw e.translate("Case not found")+"!"}}}},updateDataRows:function(l,m){var n=JSON.stringify(l);var k=new j.Deferred();m=m||{};var o=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"setDataValues",data:{values:n}}).done(function(r,s,q){a.prototype.varGroup=f.getJSONFromResponse([r,s,q]);a.prototype.decodeVarGroupFields();m.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent([m],o);var p={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(p)}a.prototype.updateApproximationStatus();k.resolve();o.resolve()}).fail(function(){k.reject();o.resolve()});return k},getUserLockUnlockAccess:function(k){if(k){return a.prototype._userLockAccess}else{return a.prototype._userUnLockAccess}},setFormulationLock:function(k,l){var m=a.prototype.getNewTransactionDeferred();l=l||{};l=j.extend({},l);l.iaEventSource="formulationLock";l.iaEventType=c.EVENT_TYPE_FORMULATION_LOCK_CHANGED;a.prototype.setFormulationLockStatus().done(function(){console.log("Formulation has been successfully "+k+"ed.");a.prototype._formulationLocked=k.toString();a.prototype.propagateEvent(l,m);m.resolve()}).fail(function(){m.resolve()})},getUserLockUnlockAccessFromEnovia:function(){return j.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getLockPrivileges",data:{oid:a.prototype._caseID}})},savePageData:function(k,l){console.log("saving page "+k);a.prototype.serializedSessionInfo[k]=l},checkPermissionsAndLicenses:function(){return j.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getRAClientPermissions",data:{caseid:a.prototype._caseID}})},readBlobAsJson:function(l){var m=a.prototype.getNewTransactionDeferred();var k=new FileReader();k.addEventListener("loadend",function(){try{var n=this.result.split("NaN").join("null");m.resolve(JSON.parse(n))}catch(o){console.warn("Unable to read the session info retrieved from the server.",[o]);m.reject()}});k.readAsText(l);return m},restoreSessionInfo:function(){var l=a.prototype.getNewTransactionDeferred();var k=a.prototype.getSwitch("RA_INTERACTIVE_DESIGN");if(k){l.resolve()}a.prototype.downloadFileFrom3DSpace(a.prototype._caseID,"SessionInfo.json",".json").done(function(m){a.prototype.readBlobAsJson(m).done(function(n){if(typeof n==="undefined"||n===null){l.resolve()}else{a.prototype.extendObject(n,sessionInfo);l.resolve()}}).fail(l.resolve)}).fail(l.resolve);return l},isHost:function(){var l=a.prototype.caseInfo.CurrentUser;var k=adviseLaunchInfo.userList;if(l&&k&&k[l.userID]){return k[currentUSer.userID].isHost}return true},initialize:function(k){if(!a.prototype.caseLoaded){console.error("initialize called with caseLoaded not defined");return}a.prototype.spinnerControlShow(true);var n=j.Deferred();var l=a.prototype.getSwitch("RA_INTERACTIVE_DESIGN");j.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/currentUser",data:{}}).done(function(t,u,r){var s=f.getJSONFromResponse([t,u,r]),v=new DOMParser(),q=v.parseFromString(s.xml,"application/xml");a.prototype.currentUser={};a.prototype.currentUser.userID=s.id;a.prototype.currentUser.userName=q.getElementsByTagName("Person")[0].getAttribute("fullname");if(sessionInfo.noServant===true){b.downloadFiles().done(function(){n.resolve()})}else{a.prototype.monitor();if(adviseLaunchInfo.isJoiningSession){n.resolve()}else{a.prototype.replayChangeLog().done(function(){n.resolve()})}}}).fail(function(){d.alertMessage(d.ERROR,e.translate("USER_RET_ERROR"))});var o=a.prototype.getUserLockUnlockAccessFromEnovia(),m=a.prototype.checkPermissionsAndLicenses(),p=a.prototype.loadRecommendedDefinition();j.when(a.prototype.caseLoaded,o,m,a.prototype.restoreSessionInfo(),n,p).done(function(v,A,t){var r=f.getJSONFromResponse(A);a.prototype.permissionsAndLicenses=f.getJSONFromResponse(t)||{};if(!adviseLaunchInfo.isJoiningSession){proxy.setAdviseCaseInfo(null,null,null,null,null,r.lock,r.unlock)}a.prototype._userLockAccess=r.lock;a.prototype._userUnLockAccess=r.unlock;var z={},w={},F={},E={},y={},I={};var q=a.prototype.getCasePreviewInfo(z);var B=a.prototype.getFormulationData(w);var C=a.prototype.getExcludedRowIdListData(F);var D=a.prototype.getFormulationLockStatus(I);var u=a.prototype.getFileNameList(E);var G=a.prototype.getImageFileNameList(y);var J=proxy.getParameterHierarchy();var x=a.prototype.syncFileList();var H=a.prototype.syncRowNameMap();var s=a.prototype.syncArrayPlots();j.when(x,J,B,C,u,G,D,q,H,s).done(function(){a.prototype.caseInfo=z.content;if(adviseLaunchInfo.isJoiningSession){a.prototype.caseInfo.CurrentUser=adviseLaunchInfo.collaborationUser;a.prototype.caseInfo.userList=adviseLaunchInfo.userList}a.prototype.formulation=w.content;a.prototype._formulationLocked=I.content;a.prototype.fileNames=E.content;a.prototype.imageNames=y.content;if(F.content instanceof Array){a.prototype.excludedRowIdList=F.content}else{a.prototype.excludedRowIdList=[]}var M=a.prototype.syncBasketWithServer();var L;if(!sessionInfo.noServant){L=a.prototype.initializeFilters()}else{L=j.Deferred().resolve()}if(!a.prototype.caseInfo.userList){a.prototype.caseInfo.userList={};a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID]={};a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].userName=a.prototype.caseInfo.CurrentUser.userName;a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isHost=true;a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl=true}var N=a.prototype.syncBestDesignsForObjectives();var Q=a.prototype.syncBestDesignsOverall();try{a.prototype.initializeEK()}catch(P){}var O=a.prototype.initializeUnitsAndDimensions();var K=a.prototype.fetchApproxLibraryJSON();if(typeof k==="function"){j.when(M,L,N,Q,O,K).done(function(R){a.prototype.spinnerControlHide(true);k(R)})}}).fail(function(){d.alertMessage(d.ERROR,e.translate("LOAD_FAILURE"))})})},isFormulationLocked:function(){var k=a.prototype._formulationLocked;if(k==="true"||k===true){return true}else{return false}},parameterFilterController:{modelFilters:{},typeFilters:{},filteredData:{},rebuildFilteredData:function(){var l=this;function k(s){var r=0;var n={parameters:[],groups:[]};for(var q in s){if(q!=="groups"&&q!=="parameters"){n[q]=s[q]}}var p=(s.parameters&&s.parameters.length)||0;for(r=0;r<p;r++){var t=s.parameters[r];if(!l.typeFilters[t.priority]){n.parameters.push(a.prototype.getParameterCopy(t))}}var m=(s.groups&&s.groups.length)||0;for(r=0;r<m;r++){var o=s.groups[r];if(!l.modelFilters[o.ID]){n.groups.push(a.prototype.getGroupCopy(o))}}return n}l.filteredData=k(a.prototype.varGroup)||{}},setFilter:function(k){var l=this;if(k.type==="model"){l.modelFilters[k.value]=true}else{if(k.type==="type"){l.typeFilters[k.value]=true}else{throw"Error: Unknown parameter filter type in IAProxy"}}},clearFilter:function(k){var l=this;if(k.type==="model"){l.modelFilters[k.value]=false}else{if(k.type==="type"){l.typeFilters[k.value]=false}else{throw"Error: Unknown parameter filter type in IAProxy"}}},getFilteredData:function(){return a.prototype.getGroupCopy(this.filteredData)}},setPopupDim:function(l,m,k,o,n){if(!a.prototype.popupDim[l]){a.prototype.popupDim[l]={}}a.prototype.popupDim[l].width=m;a.prototype.popupDim[l].height=k;a.prototype.popupDim[l].left=o;a.prototype.popupDim[l].top=n},getPopupDim:function(k){if(a.prototype.popupDim[k]){return a.prototype.popupDim[k]}else{return null}},generateUUIDListAsJson:function(l){var k={commandName:"generateUUIDListAsJson"};k.numValues=typeof l==="undefined"?1:l;return a.prototype.executeCommand(k)},encodeParameterFields:function(k){k.displayName=encodeURIComponent(k.displayName);if(k.unit){k.unit=encodeURIComponent(k.unit)}if(k.notes){k.notes=encodeURIComponent(k.notes)}return k},encodeVarGroupFields:function(l){var k;l.displayName=encodeURIComponent(l.displayName);for(k=0;k<((l.groups&&l.groups.length)||0);k++){a.prototype.encodeVarGroupFields(l.groups[k])}for(k=0;k<((l.parameters&&l.parameters.length)||0);k++){a.prototype.encodeParameterFields(l.parameters[k])}return l},getGroupCopy:function(m){var n={};n.groups=[];n.parameters=[];for(var l in m){if(l!=="parameters"&&l!=="groups"){n[l]=m[l]}}var k=0;if(typeof m.parameters!=="undefined"){for(k=0;k<m.parameters.length;k++){n.parameters.push(a.prototype.getParameterCopy(m.parameters[k]))}}if(typeof m.groups!=="undefined"){for(k=0;k<m.groups.length;k++){n.groups.push(a.prototype.getGroupCopy(m.groups[k]))}}return n},getParameterCopy:function(m){var l={};for(var k in m){l[k]=m[k]}return l},getWorkflowDefinition:function(){if(a.prototype.caseInfo&&a.prototype.caseInfo.CaseData){if(!a.prototype.caseInfo.CaseData.Definition){a.prototype.caseInfo.CaseData.Definition={workflow:[]}}if(typeof a.prototype.caseInfo.CaseData.Definition==="string"||a.prototype.caseInfo.CaseData.Definition instanceof String){a.prototype.caseInfo.CaseData.Definition=JSON.parse(a.prototype.caseInfo.CaseData.Definition)}if(!a.prototype.caseInfo.CaseData.Definition.workflow||a.prototype.caseInfo.CaseData.Definition.workflow.length<5){a.prototype.caseInfo.CaseData.Definition.workflow=c.DEFAULT_WORKFLOW}else{try{var u=null;var t=function(m){return m.id===u.id};for(var r=0;r<a.prototype.caseInfo.CaseData.Definition.workflow.length;r++){u=a.prototype.caseInfo.CaseData.Definition.workflow[r];if(typeof u.views==="undefined"||u.views===null){var q=c.DEFAULT_WORKFLOW.findIndex(t);if(q>-1){u.views=c.DEFAULT_WORKFLOW[q].views}}}}catch(v){console.error("Error merging the views object to the workflow")}}var l=0,w=0;var o=function(m){return(m.name===a.prototype.caseInfo.CaseData.Definition.workflow[l].views[w].id)};var p=JSON.parse(JSON.stringify(a.prototype.permissionsAndLicenses));if(p.pages&&typeof p.pages!==undefined&&p.pages!==null){for(l=0;l<a.prototype.caseInfo.CaseData.Definition.workflow.length;l++){for(var k=0;k<p.pages.length;k++){if(a.prototype.caseInfo.CaseData.Definition.workflow[l].id===p.pages[k].name){w=a.prototype.caseInfo.CaseData.Definition.workflow[l].views.length;while(w--){var s=p.pages[k].views.findIndex(o);if(s>-1){a.prototype.caseInfo.CaseData.Definition.workflow[l].views[w].hidden=!p.pages[k].views[s].show}}p.pages.splice(k,1);if(p.pages.length===0){break}}}}}if(a.prototype.caseInfo.CaseData.Definition){if(typeof a.prototype.caseInfo.CaseData.Definition.downselected==="undefined"){a.prototype.caseInfo.CaseData.Definition.downselected=0}if(typeof a.prototype.caseInfo.CaseData.Definition.basketrowid==="undefined"){a.prototype.caseInfo.CaseData.Definition.basketrowid=""}}if(a.prototype.getSwitch("RA_INTERACTIVE_DESIGN")){a.prototype.caseInfo.CaseData.Definition.workflow=[{id:"previewpage",nameNLSKey:"Preview",hidden:true,views:[]},{id:"definepage",nameNLSKey:"Define",hidden:false,views:[{id:"parameterhierarchyview",hidden:true},{id:"parametermappingview",hidden:true},{id:"parameterdefinitionview",hidden:false},{id:"interactiveviewermapview",hidden:false}]},{id:"shopdesignspage",nameNLSKey:"Explore",hidden:true,views:[{id:"tableView",hidden:true},{id:"scatterViewMVP",hidden:true},{id:"mapView",hidden:true}]},{id:"predictpage",nameNLSKey:"Predict",hidden:false,views:[{id:"profilerview",hidden:false},{id:"measureview",hidden:true},{id:"optimizeview",hidden:true}]},{id:"comparedesignspage",nameNLSKey:"Compare",hidden:false,views:[{id:"comparedesignsthumbnailview2",hidden:true},{id:"comparedesignsecomview",hidden:false}]},{id:"elicitpreferencespage",nameNLSKey:"Collaborate",hidden:true,views:[{id:"elicitpreferencespageview",hidden:true}]},{id:"recommenddesignpage",nameNLSKey:"Recommend",hidden:true,views:[]}]}return a.prototype.caseInfo.CaseData.Definition.workflow}throw"Premature call to getWorkflowDefinition without caseInfo being set"},setWorkflowDefinition:function(k){if(a.prototype.caseInfo&&a.prototype.caseInfo.CaseData&&a.prototype.caseInfo.CaseData.Definition){a.prototype.caseInfo.CaseData.Definition.workflow=k}else{if(a.prototype.caseInfo&&a.prototype.caseInfo.CaseData){a.prototype.caseInfo.CaseData.Definition={};a.prototype.caseInfo.CaseData.Definition.workflow=k}else{throw"caseInfo not defined yet"}}},setCurrentPage:function(k){if(a.prototype.caseInfo&&a.prototype.caseInfo.CaseData&&a.prototype.caseInfo.CaseData.Definition){a.prototype.caseInfo.CaseData.Definition.currentPageID=k}else{throw"caseInfo not defined yet"}},isApproxNameUsed:function(k){var m=Object.keys(proxy.approximations);for(var l=0;l<m.length;l++){if(proxy.approximations[m[l]].displayName===k){return true}}return false},createApproximationFromCaseData:function(){a.prototype.executeCommand({commandName:"createApproximationFromCaseData",commandGroup:"approximation"}).done(function(){a.prototype.pollApproximationStatus()})},getApproximationStatus:function(q,l){l=l||{};var m={iaEventType:c.EVENT_TYPE_APPROX_STATUS_CHANGED},r;if(l.noSpinner===true){r=a.prototype.getNewTransactionDeferred({noSpinner:true})}else{r=a.prototype.getNewTransactionDeferred()}var p={commandName:"getApproximationStatus",commandGroup:"approximation",data:{approxId:q}};var k;if(a.prototype.approximations[q]){k=String(a.prototype.approximations[q].status)}var o=new j.Deferred();var n=a.prototype.executeCommand(p);j.when(n).done(function(w,t,v){var s=a.prototype.approximations[q].status;var u=f.getJSONFromResponse([w,t,v]);a.prototype.approximations[q].status=u.status;a.prototype.approximations[q].errorDetails=u.errorDetails.substring(u.errorDetails.indexOf(":")+1,u.errorDetails.indexOf("\n"));if(u.status==="READY"||u.status==="VALIDATION"){a.prototype.getApproximationParameters(q,function(){if(u.status==="READY"){var x=a.prototype.approximations[q].inputs;var B=a.prototype.approximations[q].skippedInputs||[];var A=(a.prototype.approximations[q].settings&&a.prototype.approximations[q].settings.excludedInputs)||[];A=A.map(function(E){return a.prototype.findParameter(E)});B=B.filter(function(E){if(E.reasonSkipped&&E.reasonSkipped==="Data type <PLMOBJECT> not allowed"){return false}return true});var D=x.concat(B,A);var z=a.prototype.getInputParametersList2();var C={};for(var y=0;y<D.length;y++){C[D[y].ID]=true}for(var y=0;y<A.length;y++){C[A[y].ID]=true}for(var y=0;y<z.length;y++){if(C[z[y].ID]){delete C[z[y].ID]}else{C[z[y].ID]=true;break}}if(Object.keys(C).length>0){a.prototype.approximations[q].status="OUT_OF_DATE"}}if(a.prototype.approximations[q].status!==s){console.log(a.prototype.approximations[q].status);a.prototype.propagateEvent(m,r);r.resolve()}else{r.resolve()}o.resolve()})}else{if(a.prototype.approximations[q].status!==s){console.log(a.prototype.approximations[q].status);a.prototype.propagateEvent(m,r);r.resolve()}else{r.resolve()}o.resolve()}});return o},pollApproximationStatus:function(l){if(typeof l===undefined||l===null||l===""){return}var k=a.prototype.approximations[l].status;var m=a.prototype.getApproximationStatus(l,{noSpinner:true});m.done(function(){var n=a.prototype.approximations[l].status;if(k!==n){console.log("Current approx. status: "+n);var q={};q.iaEventType=c.EVENT_TYPE_APPROX_STATUS_CHANGED;a.prototype.propagateEvent(q)}if(n==="VALIDATION"||n==="READY"){if(!proxy.approximations[l].globalEffects){proxy.getGlobalEffects(l)}}if(n==="INITIALIZATION"||n==="VALIDATION"){window.setTimeout(function(){a.prototype.pollApproximationStatus(l)},1000)}else{if(n==="READY"&&a.prototype.approximations[l].displayName.toLowerCase()!=="best"){var p=false,r;for(var o in proxy.approximations){if(proxy.approximations[o].displayName.toLowerCase()==="best"){p=true;r=o;break}}if(p){a.prototype.createBestApproximation()}}}})},getApproximationParameters:function(l,m){var k=new j.Deferred();j.when(a.prototype.executeCommand({commandName:"getApproximationParameters",commandGroup:"approximation",data:{approxId:l}})).done(function(r,n,p){var o=f.getJSONFromResponse([r,n,p]);var q=a.prototype.approximations[l];q.inputs=o.inputs||[];q.outputs=o.outputs||[];q.settings=o.settings||{};if(m){m(o)}k.resolve()}).fail(function(){k.reject()});return k},getSkippedApproximationParameters:function(l){var k=new j.Deferred();j.when(a.prototype.executeCommand({commandName:"getSkippedApproximationParameters",commandGroup:"approximation",data:{approxId:l}})).done(function(p,m,o){var n=f.getJSONFromResponse([p,m,o]);a.prototype.approximations[l].skippedInputs=n.skippedInputs||[];a.prototype.approximations[l].skippedOutputs=n.skippedOutputs||[];k.resolve()}).fail(function(){k.reject()});return k},setApproximationParameters:function(q,m){var l=null,p=null,n=null;if(typeof m!=="undefined"){if(typeof m.inputIdList!=="undefined"){if(m.settings&&m.settings.excludedInputs){var k=m.inputIdList.filter(function(r){return(m.settings.excludedInputs.indexOf(r)===-1)});l=JSON.stringify(k)}else{l=JSON.stringify(m.inputIdList)}}if(typeof m.settings!=="undefined"){n=JSON.stringify(m.settings)}if(typeof m.outputIdList!=="undefined"){p=JSON.stringify(m.outputIdList)}}var o={approxId:q,inputIdList:l,outputIdList:p};if(n){o.settings=n}a.prototype.executeCommand({commandName:"setApproximationParameters",commandGroup:"approximation",data:o}).done(function(){a.prototype.pollApproximationStatus([q])})},cancelApproximationInitialization:function(k){a.prototype.executeCommand({commandName:"cancelApproximationInitialization",commandGroup:"approximation",approxId:k})},getCreatedApproximations:function(l){var k=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"getCreatedApproximations",commandGroup:"approximation"}).done(function(p,q,o){var m=f.getJSONFromResponse([p,q,o]);for(var n in m){if(!a.prototype.approximations[n]){a.prototype.approximations[n]=m[n];a.prototype.getSkippedApproximationParameters(n).always(a.prototype.pollApproximationStatus.bind(this,n))}else{if(a.prototype.approximations[n].status==="OUT_OF_DATE"){m[n].status=a.prototype.approximations[n].status}}}l(m);k.resolve()}).fail(function(){k.resolve()})},getApproximationType:function(l){var m="";if(typeof a.prototype.approximations!=="undefined"&&a.prototype.approximations!==null){var k=a.prototype.approximations[l];m=k.type||"";if("rsm"===m.toLowerCase()){if(k.settings&&(k.settings.enablekrig===true||k.settings.enablekrig==="true")){m="kriging"}}}return m},getApproximationTypes:function(l){var k=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"getApproximationTypes",commandGroup:"approximation"}).done(function(o,p,n){var m=f.getJSONFromResponse([o,p,n]);l(m);k.resolve()}).fail(function(){k.resolve()})},createNewApproximation:function(l,n){var k=document.getElementById("approxSettings");k.classList.add("disabled-control");j("#approxSettings").prop("disabled",true);var m=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"createNewApproximation",commandGroup:"approximation",data:{displayName:l.displayName,type:l.type,settings:JSON.stringify(l.settings)}}).done(function(q,r,p){var o=f.getJSONFromResponse([q,r,p]);a.prototype.approximations[o.id]=o.desc;a.prototype.getSkippedApproximationParameters(o.id).always(function(){if("READY"===a.prototype.approximations[o.id].status){var s={};s.iaEventType=c.EVENT_TYPE_APPROX_STATUS_CHANGED;a.prototype.propagateEvent(s)}n(o);a.prototype.pollApproximationStatus(o.id)}.bind(this));m.resolve()}).fail(function(){j("#approxSettings").prop("disabled",false);m.resolve()})},deleteApproximations:function(l){var k=new j.Deferred();proxy.spinnerControlShow(true);a.prototype.clearOptimizationData(l);a.prototype.executeCommand({commandName:"deleteApproximations",commandGroup:"approximation",data:{approxIds:JSON.stringify(l)}}).done(function(o,m,n){for(var p in proxy.approximations){if(l.indexOf(p)>-1){delete proxy.approximations[p]}}proxy.spinnerControlHide(true);k.resolve()});return k},createBestApproximation:function(){var n=j.Deferred();var k;var m=Object.keys(a.prototype.approximations);for(var l=0;l<m.length;l++){if(a.prototype.approximations[m[l]].displayName.toLowerCase()==="best"){k=a.prototype.approximations[m[l]].status;break}}a.prototype.executeCommand({commandName:"createBestApproximation",commandGroup:"approximation",data:{}}).done(function(r,s,q){var o=f.getJSONFromResponse([r,s,q]);var t=Object.keys(o)[0];if(Array.isArray(a.prototype.approximations[t].skippedInputs)&&a.prototype.approximations[t].skippedInputs.length>0){o[t].skippedInputs=a.prototype.approximations[t].skippedInputs}if(Array.isArray(a.prototype.approximations[t].skippedOutputs)&&a.prototype.approximations[t].skippedOutputs.length>0){o[t].skippedOutputs=a.prototype.approximations[t].skippedOutputs}a.prototype.approximations[t]=o[t];if(o[t].status&&o[t].status!==k){var p={};p.iaEventType=c.EVENT_TYPE_APPROX_STATUS_CHANGED;a.prototype.propagateEvent(p)}a.prototype.pollApproximationStatus(t);n.resolve()}).fail(function(){j("#approxSettings").prop("disabled",false);n.resolve()});return n},setCurrentApproximations:function(k,m){var l=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"setCurrentApproximations",commandGroup:"approximation",data:{approxId:JSON.stringify(k)}}).done(function(p,q,o){var n=f.getJSONFromResponse([p,q,o]);proxy.updateApproximationStatus(n);l.resolve();m()}).fail(function(){l.resolve()})},getMultipleApproxParameters:function(l,n){var k=new j.Deferred(),m=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"getMultipleApproximationParameters",commandGroup:"approximation",data:{approxIds:JSON.stringify(l)}}).done(function(q,r,p){var o=f.getJSONFromResponse([q,r,p]);if(typeof n==="function"){n(o)}k.resolve();m.resolve()});return k},evaluateApproximations:function(m,n,o){var l={commandName:"evaluateApproximations",commandGroup:"approximation",data:{approxIds:JSON.stringify(m)},method:"POST"};var k=new j.Deferred();if(typeof n.point!=="undefined"){l.data.point=JSON.stringify(n.point)}else{if(typeof n.points!=="undefined"){l.data.points=JSON.stringify(n.points)}else{if(typeof n.baselinePoint!=="undefined"&&typeof n.sweepValues!=="undefined"){l.data.baselinePoint=JSON.stringify(n.baselinePoint);l.data.sweepValues=JSON.stringify(n.sweepValues)}}}a.prototype.executeCommand(l).done(function(r,s,q){var p=f.getJSONFromResponse([r,s,q]);if(typeof o==="function"){o(p)}else{o.content=p}k.resolve()}).fail(function(){k.reject()});return k},testEvaluate:function(){console.log("Beginning unit test for prediction evaluation...\n");var k={},n,q;for(n=0;n<a.prototype.approximations.inputs.length;n++){q=a.prototype.approximations.inputs[n];k[q.ID]=(q.max+q.min)/2}var m={};a.prototype.evaluateApproximation({point:k},m).done(function(){console.log("Case 1: single point\n\n");console.log("Input object: "+JSON.stringify(k));console.log("Output object: "+JSON.stringify(m))});var p=[],l,o;for(n=1;n<=5;n++){o={};for(l=0;l<a.prototype.approximations.inputs.length;l++){q=a.prototype.approximations.inputs[l];o[q.ID]=q.min+n*((q.max-q.min)/5)}p.push(o)}a.prototype.evaluateApproximation({points:p},m).done(function(){console.log("\n\nCase 2: point array\n\n");console.log("Input object: "+JSON.stringify(p));console.log("Output object: "+JSON.stringify(m))});var r={baselinePoint:k,sweepValues:{}};for(n=0;n<a.prototype.approximations.inputs.length;n++){q=a.prototype.approximations.inputs[n];r.sweepValues[q.ID]=[q.min,(q.max+q.min)/2,q.max]}a.prototype.evaluateApproximation(r,m).done(function(){console.log("\n\nCase 3: point sweep\n\n");console.log("Input object: "+JSON.stringify(r));console.log("Output object: "+JSON.stringify(m))})},getApproximationErrorMeasures:function(m,k){var l=new j.Deferred();a.prototype.executeCommand({commandName:"getApproximationErrorMeasures",commandGroup:"approximation",data:{approxIds:JSON.stringify(m)}}).done(function(r,n,p){for(var o=0;o<m.length;o++){a.prototype.approximations[m[o]].measures={}}var q=f.getJSONFromResponse([r,n,p]);var s;if(typeof q==="object"){for(s in q){a.prototype.approximations[s].measures=q[s]}}l.resolve()});return l},updateParameterValues:function(n,m){var l="none";if(typeof m==="string"||m instanceof String){l=m}if(n===null){n={};var k=a.prototype._interactiveSessionParams,o=a.prototype.getInteractiveParameterMapping();if(!k){return}Object.keys(o).forEach(function(s){var t=o[s],r=t.id,q=k[r];n[s]=q.value})}var p={values:n,iaEventType:c.EVENT_TYPE_VALUES_CHANGED,iaEventPageSource:l};a.prototype.propagateEvent(p)},updateApproximationStatus:function(l){if(l){for(var m in a.prototype.approximations){a.prototype.approximations[m].status=l}return}for(var m in a.prototype.approximations){if(a.prototype.approximations[m].status==="READY"||a.prototype.approximations[m].status==="OUT_OF_DATE"){a.prototype.approximations[m].status="OUT_OF_DATE"}else{a.prototype.approximations[m].status="NOT_AVAILABLE"}}var k={};k.iaEventType=c.EVENT_TYPE_APPROX_STATUS_CHANGED;a.prototype.propagateEvent(k)},downloadApproximationFmu:function(k){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadApproximationFmu&commandGroup=approximation&approxId="+k),null,"approximation.fmu")},downloadApproximationCoefficients:function(k){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadApproximationCoefficients&commandGroup=approximation&approxId="+k),null,"approximationCoeffData.txt")},downloadFileFromServant:function(k,m,n){if(!Date.now){Date.now=function(){return new Date().getTime()}}if(k.indexOf("&_t=")<0&&k.indexOf("&")>0){if(k.indexOf("&")!==k.length-1){k=k+"&"}k=k+"_t="+Date.now()}var l=new XMLHttpRequest();n=n||"Results Analytics File";l.onload=function(t){if(l.readyState===4){if(l.status===200){var r=l.getResponseHeader("Content-Type");var q=new Blob([this.response],{type:r});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(q,n)}else{var p=window.URL||window.webkitURL;var s=p.createObjectURL(q);var o=document.createElement("a");document.body.appendChild(o);o.setAttribute("style","display: none");o.href=s;o.download=n;o.click()}}}};l.open("POST",k,true);l.setRequestHeader("Content-type","application/x-www-form-urlencoded");l.setRequestHeader("ra-from-user",a.prototype.currentUser.userID);l.setRequestHeader("X-CSRFToken",adviseLaunchInfo.token||"notoken");l.responseType="arraybuffer";l.send(m)},downloadFile:function(m,p){if(!Date.now){Date.now=function(){return new Date().getTime()}}if(m.indexOf("&_t=")<0&&m.indexOf("&")>0){if(m.indexOf("&")!==m.length-1){m=m+"&"}m=m+"_t="+Date.now()}var l=document.getElementById("fileDownloadForm")||document.createElement("form");l.id="fileDownloadForm";l.action=m;l.style.display="none";l.method="post";var n={payload:p||"","ra-from-user":a.prototype.currentUser.userID,"X-CSRFToken":adviseLaunchInfo.token||"notoken"};var o=document.createElement("input");o.setAttribute("type","hidden");o.setAttribute("name","payload");o.value=JSON.stringify(n);l.appendChild(o);var k=document.createElement("input");k.setAttribute("type","hidden");k.setAttribute("name","t");k.value=Date.now();l.appendChild(k);document.getElementById("footer").appendChild(l);window.isDownloadLink=true;l.submit();l.remove()},addDesignRow:function(n,l,p,m,o,k){if(l){var q=new j.Deferred();a.prototype.executeCommand({commandName:"createDataRow",data:{values:JSON.stringify(l),dataSetName:m?m:"",dataSetType:o?o:"",dataSetAlias:k?k:""}}).done(function(s,t,r){p.content=f.getJSONFromResponse([s,t,r]);proxy.getParameterHierarchy().done(function(){var v={};v[p.content]={DATA_SET:k||"PREDICTED"};a.prototype.updateCaseInfo({addedRows:v,deletedRows:{}});if(v[p.content].DATA_SET==="PREDICTED"){n.isPredicted=true}n.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(n);var u={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(u)}q.resolve()})}).fail(function(){q.resolve()});return q}},calculateSomResults:function(s,r,q,k,m,n,p,v,u,l,o,t){a.prototype.executeCommand({commandName:"calculateSomResults",data:{sizex:JSON.stringify(s),sizey:JSON.stringify(r),maxIters:JSON.stringify(q),alphaA:JSON.stringify(k),sigmaA:JSON.stringify(m),initPCA:JSON.stringify(n),maxThreads:JSON.stringify(p),parameterIdList:JSON.stringify(v),randomSeed:JSON.stringify(u),usedParams:JSON.stringify(l),preserveTopology:JSON.stringify(o),maxPoints:JSON.stringify(t)}})},getSomStatus:function(k,n){k=k||{};var o;if(k.noSpinner===true){o=a.prototype.getNewTransactionDeferred({noSpinner:true})}else{o=a.prototype.getNewTransactionDeferred()}var m={commandName:"getSomStatus"};var l=a.prototype.executeCommand(m);j.when(l).done(function(r,p,q){if(typeof r==="string"){n=r}else{n=f.getJSONFromResponse([r,p,q])}o.resolve()});return l},getSomResults:function(k){var l=new j.Deferred();a.prototype.executeCommand({commandName:"getSomResultsAsJson"}).done(function(o,m,n){if(o!==""){k.content=f.getJSONFromResponse([o,m,n]);l.resolve()}else{l.reject()}});return l},createExportedApproximation:function(p,m,o,k){proxy.spinnerControlShow(true);k=k||j.noop;var l=encodeURIComponent(p||"");var n=encodeURIComponent(m||"");j.ajax({type:"GET",url:"../../resources/slmservices/advise/createApproximationObject?caseId="+a.prototype._caseID+"&title="+l+"&description="+n}).done(function(q){var r=q.id;if(!q.id||!q.physicalId){r=j(q).find("[id]").attr("id")}a.prototype.executeCommand({commandName:"saveApproximation",commandGroup:"approximation",data:{approxId:o,approxOid:r}}).done(function(){proxy.spinnerControlHide(true);k(r,p)}).fail(function(){proxy.spinnerControlHide(true)})}).fail(function(){proxy.spinnerControlHide(true)})},syncArrayPlots:function(){var l=new j.Deferred();var k={};proxy.getPageOptions("moreInfo",k).done(function(){var m=k.content;if(!j.isEmptyObject(m)){a.prototype.arrayPlots=m.arrayData}else{a.prototype.arrayPlots=[]}l.resolve()});return l},getArrayPlots:function(){a.prototype.arrayPlots=a.prototype.arrayPlots||[];return a.prototype.arrayPlots},setArrayPlots:function(m){var l=window.event||{};for(var k=0;k<m.length;k++){if(m[k]==="empty"){m.splice(k,1)}}var n=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"setPageOptionsFromJson",data:{pageName:"moreInfo",pageOptions:JSON.stringify({arrayData:m})}}).done(function(){a.prototype.arrayPlots=m;l.iaEventType=c.EVENT_TYPE_FILE_UPLOADED_FOR_DESIGN;a.prototype.propagateEvent(l,n);n.resolve()}).fail(function(){n.resolve()})},getRowInfo:function(o,n,m){var k=new j.Deferred();var l={rowId:o};n=n||{};m=m||{};Object.keys(m).forEach(function(p){l[p]=m[p]});if(sessionInfo.noServant){b.getRowInfo(o,n,k)}else{a.prototype.executeCommand({commandName:"getRowInfoAsJson",data:l}).done(function(r,p,q){n.content=f.getJSONFromResponse([r,p,q]);k.resolve()})}return k},getRowListInfo:function(o,n,m){n=n||{};m=m||"";var k=new j.Deferred();if(sessionInfo.noServant){}else{var l;if(Array.isArray(m)){l={rowIdList:JSON.stringify(o),parmIdList:JSON.stringify(m)}}else{l={rowIdList:JSON.stringify(o)}}a.prototype.executeCommand({commandName:"getRowListInfoAsJson",data:l}).done(function(r,p,q){n.content=f.getJSONFromResponse([r,p,q]);k.resolve()})}return k},getScoresForRow:function(m,l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){b.getScoresForRow(m,l,k)}else{a.prototype.executeCommand({commandName:"getScoresForRowAsJson",data:{rowId:m}}).done(function(p,n,o){l.content=f.getJSONFromResponse([p,n,o]);k.resolve()})}return k},getScoresForRowIdList:function(m,l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){}else{a.prototype.executeCommand({commandName:"getScoresForRowIdListAsJson",data:{rowIdList:JSON.stringify(m)}}).done(function(p,n,o){l.content=f.getJSONFromResponse([p,n,o]);k.resolve(l.content)})}return k},getCasePreviewInfo:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){var m={};b.getCasePreviewInfo(m).done(function(){l.content=m.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"getCasePreviewInfoAsJson"}).done(function(p,n,o){l.content=f.getJSONFromResponse([p,n,o]);k.resolve()})}return k},getFormulationData:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){l.content=b.getFormulationData();k.resolve()}else{a.prototype.executeCommand({commandName:"getFormulationAsJson"}).done(function(o,m,n){l.content=f.getJSONFromResponse([o,m,n]);k.resolve()})}return k},getExcludedRowIdListData:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){b.getExcludedRowIdListData(l,k)}else{a.prototype.executeCommand({commandName:"getExcludedRowIdListAsJson"}).done(function(o,m,n){l.content=f.getJSONFromResponse([o,m,n]);k.resolve()})}return k},getFormulationLockStatus:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){l.content=b.getFormulationLockStatus();k.resolve()}else{a.prototype.executeCommand({commandName:"getFormulationLockStatus"}).done(function(o,m,n){l.content=f.getJSONFromResponse([o,m,n]);k.resolve()})}return k},getFileNameList:function(k){k=k||{};var l=new j.Deferred();if(sessionInfo.noServant){k.content=b.getFileNameList();l.resolve()}else{a.prototype.executeCommand({commandName:"getFileNameListAsJson"}).done(function(o,m,n){k.content=f.getJSONFromResponse([o,m,n]);l.resolve()})}return l},getImageFileNameList:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){l.content=b.getImageFileNameList();k.resolve()}else{a.prototype.executeCommand({commandName:"getImageFileNameListAsJson"}).done(function(o,m,n){l.content=f.getJSONFromResponse([o,m,n]);k.resolve()})}return k},getRecommendedRowID:function(){var k=new j.Deferred();if(sessionInfo.noServant){a.prototype.basketRecommended=b.getRecommendedRowID();k.resolve()}else{a.prototype.executeCommand({commandName:"getRecommendedRowIdList"}).done(function(l){var m=f.getJSONFromResponse(l);if(l instanceof Array){m=l}a.prototype.basketRecommended=m;k.resolve()})}return k},getExplorationFilter:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){b.getExplorationFilter(l).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"getExplorationFilterAsJson"}).done(function(o,m,n){l.content=f.getJSONFromResponse([o,m,n]);k.resolve()})}return k},getRankListForRowID:function(l){l=l||a.prototype.basket;var k=new j.Deferred();if(sessionInfo.noServant){var m={};b.getRankListForRowID(l,m).done(function(){a.prototype.basketRank=m.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"getRankListForRowIdListAsJson",data:{rowIdList:JSON.stringify(l)}}).done(function(n,o,p){a.prototype.basketRank=f.getJSONFromResponse([n,o,p]);k.resolve()})}return k},getBestDesignsForEachObjective:function(){var l=new j.Deferred();a.prototype.bestDesignsForObjectives=[];if(sessionInfo.noServant){var k={};b.getBestDesignsForEachObjective(k).done(function(){for(var m in k.content){if(k.content.hasOwnProperty(m)){a.prototype.bestDesignsForObjectives=a.prototype.bestDesignsForObjectives.concat(k.content[m])}}l.resolve()})}else{a.prototype.executeCommand({commandName:"getBestDesignsForEachObjective"}).done(function(n,m,o){var q=f.getJSONFromResponse([n,m,o]);for(var p in q){if(q.hasOwnProperty(p)){a.prototype.bestDesignsForObjectives=a.prototype.bestDesignsForObjectives.concat(q[p])}}l.resolve()})}return l},getBestOverallDesigns:function(){var l=new j.Deferred();if(sessionInfo.noServant){var k={};b.getBestOverallDesigns(k).done(function(){a.prototype.bestDesignsOverall=k.content;l.resolve()})}else{a.prototype.executeCommand({commandName:"getBestOverallDesigns"}).done(function(n,m,o){a.prototype.bestDesignsOverall=f.getJSONFromResponse([n,m,o]);l.resolve()})}return l},getGradingMethod:function(l){l=l||{};var k=new j.Deferred();if(sessionInfo.noServant){l.content=b.getGradingMethod();k.resolve()}else{a.prototype.executeCommand({commandName:"getGradingMethod"}).done(function(m){l.content=m;k.resolve()})}return k},getBasketRowIDList:function(){var k=new j.Deferred();if(sessionInfo.noServant){a.prototype.basket=b.getBasketRowIDList();k.resolve()}else{a.prototype.executeCommand({commandName:"getBasketRowIdListAsJson"}).done(function(m,l,n){a.prototype.basket=f.getJSONFromResponse([m,l,n]);k.resolve()})}return k},syncFileList:function(){var k=new j.Deferred();if(sessionInfo.noServant){var l={};b.getFileList(l).done(function(){a.prototype.fileList=l.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"getFileListAsJson"}).done(function(n,m,o){a.prototype.fileList=f.getJSONFromResponse([n,m,o]);k.resolve()})}return k},setFileName:function(n,k){var l=new j.Deferred();var m=a.prototype.getNewTransactionDeferred();a.prototype.executeCommand({commandName:"setFileName",data:{id:n,fileName:k}}).done(function(p,o,r){if(Array.isArray(a.prototype.fileList)){a.prototype.fileList.some(function(s){if(s.id===n){s.displayName=k;return true}})}var q=q||{};q.iaEventType=c.EVENT_TYPE_FILE_PARAMETER_CHANGE;a.prototype.propagateEvent(q,m);m.resolve();l.resolve()});return l},getPageOptions:function(k,m){var l=new j.Deferred();m=m||{};if(sessionInfo.noServant){m.content=b.getPageOptions(k);l.resolve()}else{a.prototype.executeCommand({commandName:"getPageOptionsAsJson",data:{pageName:k}}).done(function(o,n,p){m.content=f.getJSONFromResponse([o,n,p]);l.resolve()})}return l},getParameterHierarchy:function(){var k=new j.Deferred();if(sessionInfo.noServant){var l={};b.getParameterHierarchy(l).done(function(){a.prototype.varGroup=l.content;a.prototype.decodeVarGroupFields();k.resolve()})}else{a.prototype.executeCommand({commandName:"getParameterHierarchyAsJson"}).done(function(n,o,m){a.prototype.varGroup=f.getJSONFromResponse([n,o,m]);a.prototype.decodeVarGroupFields();k.resolve()})}return k},getFilesForRowIDList:function(m,l){var k=new j.Deferred();if(sessionInfo.noServant){var n={};if(typeof l==="undefined"){b.getFilesForRowIDList(m,n).done(function(){a.prototype.basketFiles=n.content;k.resolve()})}else{b.getFilesForRowIDList(m,n).done(function(){l.content=n.content;k.resolve()})}}else{a.prototype.executeCommand({commandName:"getFilesForRowIdListAsJson",data:{rowIdList:JSON.stringify(m)}}).done(function(p,o,q){if(typeof l==="undefined"){a.prototype.basketFiles=f.getJSONFromResponse([p,o,q])}else{l.content=f.getJSONFromResponse([p,o,q])}k.resolve()})}return k},getDataColumns:function(o,n,l){var k=new j.Deferred();if(sessionInfo.noServant){var m={};b.getDataColumns(o,n,m).done(function(){l.content=m.content;k.resolve(m.content)})}else{a.prototype.executeCommand({commandName:"getDataColumnsAsJson",data:{idList:JSON.stringify(o),rowIdList:JSON.stringify(n)}}).done(function(s,p,r){var q=f.getJSONFromResponse([s,p,r]);if(l){l.content=q}k.resolve(q)})}return k},getGradingDataColumn:function(l){if(sessionInfo.noServant){return b.getGradingDataColumn(columnIds,rowIds).done(function(){if(typeof l==="function"){l(columnObj.content)}})}else{var k={};return a.prototype.executeCommand({commandName:"getGradingFlagColumnsAsJson",data:k}).done(function(p,m,o){var n=f.getJSONFromResponse([p,m,o]);if(typeof l==="function"){l(n)}})}},getHistoryData:function(p,q,o,s,k,r){var n,l;if(typeof p.columns!=="undefined"){n=p.columns}else{if(p instanceof Array){n=p}}if(sessionInfo.noServant){return b.getDataColumns(n,l).done(function(){if(typeof r==="function"){r(columnObj.content)}})}else{var m={idList:JSON.stringify(n),onlyImprovements:q,honorFilters:o,isOptimization:s,approxId:k};if(typeof l!=="undefined"){m.rowIdList=JSON.stringify(l)}return a.prototype.executeCommand({commandName:"getDataColumnsAsJson",data:m}).done(function(w,t,v){var u=f.getJSONFromResponse([w,t,v]);if(typeof r==="function"){r(u)}})}},getOptimizationSettings:function(){var k=new j.Deferred();a.prototype.executeCommand({commandGroup:"approximation",commandName:"getOptimizationSettings"}).done(function(m,l,o){var n=f.getJSONFromResponse([m,l,o]);a.prototype._availableOptimizationSettings=n;k.resolve(n)});return k},startOptimization:function(p,o,n,l,q){var k="";if(Array.isArray(a.prototype._constantInputsForOptimization)&&a.prototype._constantInputsForOptimization.length>0){a.prototype._constantInputsForOptimization.forEach(function(r){k+=r+","});k=k.substring(0,k.length-1)}var m={approxId:p,inputVals:JSON.stringify(o),constantInputs:k,techniqueName:n,settings:JSON.stringify(l)};return a.prototype.executeCommand({commandGroup:"approximation",commandName:"initiateOptimization",data:m}).done(function(s,r,u){var t=f.getJSONFromResponse([s,r,u]);if(typeof q==="function"){q(t)}})},getOptimizationStatus:function(l){var k={approxId:l};return a.prototype.executeCommand({commandGroup:"approximation",commandName:"getOptimizationStatus",data:k}).then(function(o,m,n){return f.getJSONFromResponse([o,m,n])})},clearOptimizationData:function(k){if(typeof k==="undefined"||k==null||k.length===0){return}var l={approxIds:JSON.stringify(k)};return a.prototype.executeCommand({commandGroup:"approximation",commandName:"clearOptimizationData",data:l})},setOptimizationStatusOutOfDate:function(k,m){if(typeof k==="undefined"||k==null||k.length===0){return}var l={approxIds:JSON.stringify(k)};return a.prototype.executeCommand({commandGroup:"approximation",commandName:"setOptimizationResutsOutOfDate",data:l}).done(function(p,q,o){var n=f.getJSONFromResponse([p,q,o]);if(typeof m==="function"){m(n)}}).fail(function(n){console.warn("Error updating the optimization status in the server.",n)})},stopOptimization:function(){return a.prototype.executeCommand({commandGroup:"approximation",commandName:"stopOptimization"})},setBasketRowIDList:function(m,l){var k=new j.Deferred();if(sessionInfo.noServant){b.setBasketRowIDList(m,l,k)}else{a.prototype.executeCommand({commandName:"setBasketRowIdListFromJson",data:{rowIdList:JSON.stringify(m)}}).done(a.prototype.setBasket).done(function(o,n,p){a.prototype.basket=f.getJSONFromResponse([o,n,p]);k.resolve()})}return k},setDefinitionToServant:function(){var l=new j.Deferred();if(a.prototype.caseInfo.CaseData&&a.prototype.caseInfo.CaseData.Definition){a.prototype.caseInfo.CaseData.Definition.downselected=a.prototype.getRecommendedDesign().length;if(typeof a.prototype.basket!=="undefined"){a.prototype.caseInfo.CaseData.Definition.basketpoint=a.prototype.basket.length}else{a.prototype.caseInfo.CaseData.Definition.basketpoint=0}var k=JSON.stringify(a.prototype.caseInfo.CaseData.Definition);console.log("Definition: "+k);a.prototype.executeCommand({commandName:"setAdviseCaseInfo",data:{definition:k}}).done(function(){console.log("Definition sent to the servant");l.resolve()})}else{l.resolve()}return l},widgetSavePreProcess:function(){var l={};var m=window.parent||{};m.savePreProcessComplete=m.savePreProcessComplete||function(){};try{a.prototype.serializedSessionInfo={};$simjq(a.prototype.page).each(function(n,q){var o={};o.iaEventSource="proxy";o.iaEventType="save";$simjq(q.element).advisePage("triggerEvent",o,true)});l.sessionInfo=JSON.stringify(a.prototype.serializedSessionInfo);if(a.prototype.caseInfo.CaseData&&a.prototype.caseInfo.CaseData.Definition){a.prototype.caseInfo.CaseData.Definition.downselected=a.prototype.getRecommendedDesign().length;if(typeof a.prototype.basket!=="undefined"){a.prototype.caseInfo.CaseData.Definition.basketpoint=a.prototype.basket.length}else{a.prototype.caseInfo.CaseData.Definition.basketpoint=0}l.definition=JSON.stringify(a.prototype.caseInfo.CaseData.Definition)}l=JSON.stringify(l)}catch(k){l=""}m.savePreProcessComplete(l)},storeAdviseCase:function(n,l){a.prototype.serializedSessionInfo={};j(a.prototype.page).each(function(o,r){var q={};q.iaEventSource="proxy";q.iaEventType="save";j(r.element).advisePage("triggerEvent",q,true)});if(sessionInfo.noServant){proxy.spinnerControlShow();b.storeAdviseCase(a.prototype.caseInfo.CaseData.Definition).done(function(){proxy.spinnerControlHide();d.alertMessage(d.SUCCESS,e.translate("Case saved")+".")})}else{if(!a.prototype.isAWidget()){a.prototype.spinnerControlShow(true)}var m=a.prototype.executeCommand({commandName:"setAdviseSessionInfo",data:{sessionInfo:JSON.stringify(a.prototype.serializedSessionInfo)}});var k=a.prototype.updateRecommendedDefinition();j.when(a.prototype.setDefinitionToServant(),m,k).done(function(){if(!a.prototype.isAWidget()){a.prototype.executeCommand({commandName:"storeAdviseCase"}).done(function(){a.prototype.spinnerControlHide(true);d.alertMessage(d.SUCCESS,e.translate("Case saved")+".")}).fail(function(){a.prototype.spinnerControlHide(true);console.warn("Error saving the analytics case.")})}else{a.prototype.spinnerControlHide(true)}}).fail(function(){a.prototype.spinnerControlHide(true);console.warn("Error saving the case definition and the session information.")})}},createPage:function(k){var l=j.Deferred();if(sessionInfo.noServant){b.createPage(k,l)}else{a.prototype.executeCommand({commandName:"createPage",data:{pageName:k}}).done(function(){l.resolve()})}return l},setRecommendedRowID:function(l){var k=new j.Deferred();a.prototype.caseInfo.CaseData.Definition.basketrowid=l;if(sessionInfo.noServant){b.setRecommendedRowID(l,k)}else{a.prototype.executeCommand({commandName:"setToggleRecommendedRowId",data:{rowId:l}}).done(function(m){var n=JSON.parse(m);if(m instanceof Array){n=m}a.prototype.basketRecommended=n;k.resolve()})}return k},setParameterHierarchy:function(m,l){l=l||{};var k=j.Deferred();if(sessionInfo.noServant){b.setParameterHierarchy(m,l,k)}else{a.prototype.executeCommand({commandName:"setParameterHierarchyFromJson",data:{groups:JSON.stringify(a.prototype.encodeVarGroupFields(m))}}).done(function(p,n,o){l.content=f.getJSONFromResponse([p,n,o]);k.resolve()})}return k},setConstraints:function(m){var l=new j.Deferred();if(sessionInfo.noServant){var k={};b.setConstraints(m,k).done(function(){a.prototype.formulation=k.content;l.resolve()})}else{a.prototype.executeCommand({commandName:"setConstraintFromJson",data:{constraint:JSON.stringify(m)}}).done(function(p,n,o){a.prototype.formulation=f.getJSONFromResponse([p,n,o]);l.resolve()})}return l},setObjectives:function(m){var l=new j.Deferred();if(sessionInfo.noServant){var k={};b.setObjectives(m,k).done(function(){a.prototype.formulation=k.content;l.resolve()})}else{a.prototype.executeCommand({commandName:"setObjectiveFromJson",data:{objective:JSON.stringify(m)}}).done(function(p,n,o){a.prototype.formulation=f.getJSONFromResponse([p,n,o]);l.resolve()})}return l},getCommentsForDataRow:function(n,l){var k=new j.Deferred();if(sessionInfo.noServant){var m={};b.getCommentsForDataRow(n,m).done(function(){l.content=m.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"getCommentsForDataRow",data:{rowID:n}}).done(function(p,o,q){l.content=f.getJSONFromResponse([p,o,q]);k.resolve()})}return k},getLikesForDataRow:function(n,l){var k=new j.Deferred();if(sessionInfo.noServant){var m={};b.getLikesForDataRow(n,m).done(function(){l.content=m.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"getLikesForDataRow",data:{rowID:n}}).done(function(p,o,q){l.content=[];if(p!==""){l.content=f.getJSONFromResponse([p,o,q])}k.resolve()})}return k},setFormulationLockStatus:function(l){var k=new j.Deferred();if(sessionInfo.noServant){b.setFormulationLockStatus(l).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"setFormulationLockStatus",data:{formulationLocked:l}}).done(function(){k.resolve()})}return k},setBasketWeights:function(m,n){var l=new j.Deferred();if(sessionInfo.noServant){var k={};b.setBasketWeight(m,n,k).done(function(){a.prototype.varGroup=k.content;a.prototype.decodeVarGroupFields();l.resolve()})}else{a.prototype.executeCommand({commandName:"setBasketWeight",data:{ID:m,basketWeight:n}}).done(function(p,q,o){a.prototype.varGroup=f.getJSONFromResponse([p,q,o]);a.prototype.decodeVarGroupFields();l.resolve()})}return l},setCommentsForDataRow:function(m,k){var l=new j.Deferred();if(sessionInfo.noServant){b.setCommentsForDataRow(m,k).done(function(){l.resolve()})}else{a.prototype.executeCommand({commandName:"setCommentsForDataRow",data:{rowID:m,comments:JSON.stringify(k)}}).done(function(){l.resolve()})}return l},setLikesForDataRow:function(l,m){var k=new j.Deferred();if(sessionInfo.noServant){b.setLikesForDataRow(l,m).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"setLikesForDataRow",data:{rowID:l,likes:JSON.stringify(m)}}).done(function(){k.resolve()})}return k},setNotesForRowID:function(m,l){var k=new j.Deferred();if(sessionInfo.noServant){b.setNotesForRowID(m,l).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"setNotesForRowId",data:{rowId:m,notes:encodeURIComponent('"'+l+'"')}}).done(function(){k.resolve()})}return k},getNotesForRowID:function(m,l){var k=new j.Deferred();if(sessionInfo.noServant){b.getNotesForRowID(m,l).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"getNotesForRowId",data:{rowId:m}}).done(function(n){l.content=n;k.resolve()})}return k},setNotesForParameter:function(m,l){var k=new j.Deferred();if(sessionInfo.noServant){b.setNotesForParameter(m,l).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"setNotesForParameter",data:{rowId:m,notes:encodeURIComponent('"'+l+'"')}}).done(function(){k.resolve()})}return k},getNotesForParameter:function(m,l){var k=new j.Deferred();if(sessionInfo.noServant){b.getNotesForParameter(m,l).done(function(){k.resolve()})}else{a.prototype.executeCommand({commandName:"getNotesForParameter",data:{rowId:m}}).done(function(o,p,n){l.content=f.getJSONFromResponse([o,p,n]);k.resolve()})}return k},setAdviseCaseInfo:function(q,p,m,l,o,n,k){if(sessionInfo.noServant){return b.setAdviseCaseInfo(q,p,m,l,o,n,k)}else{return a.prototype.executeCommand({commandName:"setAdviseCaseInfo",data:{formulationLockAccess:n,formulationUnLockAccess:k}})}},setRankingMethod:function(l,m){var n=a.prototype.getNewTransactionDeferred();var k;m=m||{};m=j.extend({},m);m.iaEventSource="rankingMethod";m.iaEventType=c.EVENT_TYPE_GRADING_CHANGED;if(sessionInfo.noServant){k=b.setGradingMethod(l)}else{k=a.prototype.executeCommand({commandName:"setGradingMethod",data:{gradingMethod:l}})}k.done(function(){proxy.getParameterHierarchy().done(function(){a.prototype.propagateEvent(m,n);n.resolve()}).fail(function(){n.resolve()})}).fail(function(){n.resolve()})},replayChangeLog:function(){var k=j.Deferred();var l=[];if(proxy.changeLog){proxy.changeLog.forEach(function(n){var m=j.Deferred();l.push(m);a.prototype[n.command].apply(null,n.args).done(function(){m.resolve()})});j.when.apply(j,l).done(function(){proxy.changeLog=[];j.when(a.prototype.executeCommand({commandName:"storeAdviseCase"})).done(function(){a.prototype.executeCommand({commandName:"clearChangeLog"}).done(function(){k.resolve()})})})}else{k.resolve()}return k},downloadReportFile:function(l,m,k){j.ajax({type:"POST",url:l,data:m}).done(function(){if(typeof k==="function"){k()}})},downloadReportPDF:function(){a.prototype.getReportSVGObjects(function(k){a.prototype.executeCommand({commandName:"createPDFForDownload",data:{svgList:JSON.stringify(k),reportInfo:JSON.stringify(a.prototype.reportInfoJSON)},method:"POST"}).done(function(){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadReportPDF"),null,"adviseReport.pdf")})})},downloadReportPPT:function(){a.prototype.getReportSVGObjects(function(k){a.prototype.executeCommand({commandName:"createPPTForDownload",data:{svgList:JSON.stringify(k),reportInfo:JSON.stringify(a.prototype.reportInfoJSON)},method:"POST"}).done(function(){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadReportPPT"),null,"adviseReport.ppt")})})},reportInfoJSON:{preview:{overview:{tableName:e.translate("Analytics Case Summary"),caseName:e.translate("Case Name"),caseOwner:e.translate("Case Owner"),lastModified:e.translate("Last Modified"),datasets:e.translate("Datasets"),objectiveCount:e.translate("Number of Objectives"),altsInBasket:e.translate("Alternatives in Basket"),recommended:e.translate("Recommended")},paramSummary:{tableName:e.translate("Parameter Summary"),paramName:e.translate("Parameter Name"),units:e.translate("Units"),mode:e.translate("Mode"),max:e.translate("Max"),min:e.translate("Min")},paramStats:{tableName:e.translate("Parameter Statistics"),quantilesTitle:e.translate("Quantiles"),max:e.translate("Maximum"),upperQuartile:e.translate("Upper Quantile"),min:e.translate("Minimum"),lowerQuartile:e.translate("Lower Quantile"),momentsTitle:e.translate("Moments"),sum:e.translate("Sum"),mean:e.translate("Mean"),median:e.translate("Median"),stdDev:e.translate("Standard Deviation")}},define:{paramDefinition:{tableName:e.translate("Parameter Definitions"),name:e.translate("Name"),priority:e.translate("Priorty"),lowerthreshold:e.translate("Lower Threshold"),upperThreshold:e.translate("Upper Threshold"),objective:e.translate("Objective"),target:e.translate("Target")}}},monitor:function(){a.prototype.prevMonitor=a.prototype.prevMonitor||Date.now();a.prototype.monitorCount=a.prototype.monitorCount||0;a.prototype.monitorCount++;a.prototype.executeCommand({commandName:"monitor"}).done(function(n,o,m){a.prototype.monitorCount--;a.prototype.updateClient(f.getJSONFromResponse([n,o,m]));if(a.prototype.monitorCount===0){var l=Date.now();var k=l-a.prototype.prevMonitor;if(k>1000){a.prototype.monitor()}else{setTimeout(a.prototype.monitor,1000-k)}}}).fail(function(){a.prototype.monitorCount--;if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isHost){d.alertMessage(d.ERROR,"The session has ended!");getTopWindow().location.href=adviseLaunchInfo._appLandingPage}})},assignCollaborationControl:function(k){var l=j.Deferred();a.prototype.executeCommand({commandGroup:"collaboration",commandName:"assignCollaborationControl",data:{userID:k}}).done(function(o,p,n){a.prototype.caseInfo.userList=f.getJSONFromResponse([o,p,n]);var m={iaEventType:c.EVENT_TYPE_COLLAB_STATUS_CHANGED};a.prototype.propagateEvent(m,l);l.resolve()});return l},updateClient:function(s){switch(s.commandName){case"executeScript":if(s&&s.response){var l=JSON.parse(s.response);if(l&&Array.isArray(l.events)){var q=l.events.map(function(A){var r={};if(typeof A.eventType!=="undefined"&&A.eventType!==null&&A.eventType.length>0){r.viewSource="RA_NOTEBOOK";Object.keys(A).forEach(function(B){r[B]=A[B]},this)}return r},this);if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(q[0])}}}break;case"setExplorationFilterFromJson":if(!a.prototype.caseInfo.userList[proxy.caseInfo.CurrentUser.userID].isInControl){var y=a.prototype.getNewTransactionDeferred();m=m||{};m.iaEventSource="filter";m.iaEventType=c.EVENT_TYPE_FILTER_CHANGED;a.prototype.doFiltering(JSON.parse(s.response));a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("MDF_FILTRS"))}break;case"setBasketRowIdListFromJson":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){a.prototype.basket=JSON.parse(s.response);var y=a.prototype.getNewTransactionDeferred();var v=a.prototype.syncBasketRank();var p=a.prototype.syncRecommendedDesign(null);var z=a.prototype.syncBasketFiles();j.when(v,p,z).done(function(){proxy.updateBasketUI();var r={iaEventSource:"basket",iaEventType:c.EVENT_TYPE_BASKET_CHANGED};a.prototype.propagateEvent(r,y);y.resolve()});d.alertMessage(e.translate("MDF_BSKT"))}break;case"setObjectiveFromJson":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){a.prototype.formulation=JSON.parse(s.response);var m={iaEventType:c.EVENT_TYPE_FORMULATION_CHANGED};var y=new j.Deferred();var o=a.prototype.syncBestDesignsForObjectives();var x=a.prototype.syncBestDesignsOverall();var u=a.prototype.getParameterHierarchy();j.when(u,x,o).done(function(){a.prototype.propagateEvent(m,y);y.resolve()}).fail(function(){y.resolve()});d.alertMessage(e.translate("MDF_OBJTV"))}break;case"setConstraintFromJson":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){a.prototype.formulation=JSON.parse(s.response);var m={iaEventType:c.EVENT_TYPE_FORMULATION_CHANGED};var y=new j.Deferred();a.prototype.getParameterHierarchy().done(function(){a.prototype.propagateEvent(m,y);y.resolve()}).fail(function(){y.resolve()});d.alertMessage(e.translate("MDF_CNSTRNT"))}break;case"setBasketWeight":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){a.prototype.varGroup=JSON.parse(s.response);a.prototype.decodeVarGroupFields();var m={iaEventType:c.EVENT_TYPE_GRADING_CHANGED};var y=new j.Deferred();a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("MDF_WGHTS"))}break;case"setParameterHierarchyFromJson":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){a.prototype.varGroup=JSON.parse(s.response);a.prototype.decodeVarGroupFields();var m={iaEventType:c.EVENT_TYPE_HIERARCHY_CHANGED};var y=new j.Deferred();a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("MDF_PRMS"))}break;case"setToggleRecommendedRowId":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){a.prototype.basketRecommended=JSON.parse(s.response);proxy.updateBasketUI();var y=j.Deferred();var m={iaEventSource:"basket",iaEventType:c.EVENT_TYPE_BASKET_CHANGED};a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("MDF_RCMND"))}break;case"setGradingMethod":if(!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){var y=new j.Deferred();m=m||{};m=j.extend({},m);m.iaEventSource="rankingMethod";m.iaEventType=c.EVENT_TYPE_GRADING_CHANGED;var t=j(".rankingMethodSelection");var k={},s;a.prototype.getGradingMethod(k).done(function(){s=k.content;if(s){var r=s.replace("'","").replace("'","");t.each(function(A,B){j(B).val(r)})}});a.prototype.getParameterHierarchy().done(function(){a.prototype.propagateEvent(m,y);y.resolve()}).fail(function(){y.resolve()});d.alertMessage(e.translate("MDF_RNK_MTHD"))}break;case"setAdviseCaseInfo":if(adviseLaunchInfo.isJoiningSession&&!a.prototype.caseInfo.userList[a.prototype.caseInfo.CurrentUser.userID].isInControl){var n=JSON.parse(s.response);for(var w in n){if(w!=="CurrentUser"&&w!=="userList"){a.prototype.caseInfo[w]=n[w]}}var y=j.Deferred();var m={iaEventSource:"monitor",iaEventType:c.EVENT_TYPE_CASE_METADATA_CHANGED};a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("MDF_CASE_INFO"))}break;case"assignCollaborationControl":a.prototype.caseInfo.userList=JSON.parse(s.response);var m={iaEventType:c.EVENT_TYPE_COLLAB_STATUS_CHANGED};var y=new j.Deferred();a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("MDF_SION_CTRL"));break;case"handshake":a.prototype.caseInfo.userList=JSON.parse(s.response);var m={iaEventType:c.EVENT_TYPE_COLLAB_STATUS_CHANGED};var y=new j.Deferred();a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("NW_USR_SSN"));break;case"stop":a.prototype.caseInfo.userList=JSON.parse(s.response);var m={iaEventType:c.EVENT_TYPE_COLLAB_STATUS_CHANGED};var y=new j.Deferred();a.prototype.propagateEvent(m,y);y.resolve();d.alertMessage(e.translate("USR_LFT"));break}},getLocalEffects:function(o,n){var m={};var l=new j.Deferred();for(var k=0;k<Object.keys(n).length;k++){m[Object.keys(n)[k]]=n[Object.keys(n)[k]].value}return a.prototype.executeCommand({commandName:"getLocalEffects",commandGroup:"approximation",data:{inputVals:JSON.stringify(m),approxIds:JSON.stringify(o)}}).done(function(s,t,r){var p=f.getJSONFromResponse([s,t,r]);for(var q in p){proxy.approximations[q].localEffects=p[q]}l.resolve()})},getGlobalEffects:function(l){var k=new j.Deferred();a.prototype.executeCommand({commandName:"getGlobalEffects",commandGroup:"approximation",data:{approxId:l}}).done(function(n,o,m){proxy.approximations[l].globalEffects=f.getJSONFromResponse([n,o,m]);k.resolve()});return k},getOutputVariance:function(o,n){var k={},p={};var m=new j.Deferred();var l=Object.keys(n);l.forEach(function(t,s){var r=n[t],u=r.value,v=r.stddev,q=r.name;k[t]=u;if(typeof v!=="undefined"){p[q]=v*v}});return a.prototype.executeCommand({commandName:"getOutputVariance",commandGroup:"approximation",data:{inputVals:JSON.stringify(k),inputVariances:JSON.stringify(p),approxId:o}}).done(function(s,t,r){var q=f.getJSONFromResponse([s,t,r]);proxy.approximations[o].outputVariance=q;m.resolve()})},downloadBasketAsTSV:function(){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadBasketAsTSV"),null,"basket.tsv")},downloadRecommendedDesignsAsTSV:function(){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadRecommendedDesignsAsTSV"),null,"recommended_designs.tsv")},downloadExploreData:function(){a.prototype.downloadFileFromServant(a.prototype.getCompleteURL("executeCommand?commandName=downloadExploreData"),null,proxy.getPreviewData("CaseName")+"_data.tsv")},downloadOptimizationResults:function(l){if(UWA.is(l)&&l.length>0){var k={approxId:l};a.prototype.executeCommand({commandGroup:"approximation",commandName:"getOptimizationResultsName",data:k}).then(function(r,n,p){var o=f.getJSONFromResponse([r,n,p]);var q=o?o.filename:undefined;var m="executeCommand?";m+="commandGroup=approximation";m+="&commandName=downloadOptimizationResults";m+="&approxId="+l;m+="&fileName="+q;a.prototype.downloadFileFromServant(a.prototype.getCompleteURL(m),null,q)}.bind(this))}else{d.alertMessage(d.INFO,NLS.translate("OPT_DWNLD_ERR"))}},syncRowNameMap:function(){var k=new j.Deferred();if(sessionInfo.noServant){var l={};b.getFileList(l).done(function(){a.prototype.rowNameMap=l.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"getRowsWithNames"}).done(function(n,m,o){a.prototype.rowNameMap=f.getJSONFromResponse([n,m,o]);k.resolve()})}return k},setNameForRow:function(n,l){if(!n){return}if(l===null){l=""}var k=new j.Deferred();if(sessionInfo.noServant){var m={};b.getFileList(m).done(function(){a.prototype.rowNameMap=m.content;k.resolve()})}else{a.prototype.executeCommand({commandName:"setRowName",data:{rowId:n,rowName:l}}).done(function(q,o,s){a.prototype.rowNameMap=f.getJSONFromResponse([q,o,s]);if(a.prototype.basket.indexOf(n)!==-1){proxy.updateBasketUI()}var r={};r.iaEventSource="setNameForRow";r.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(r);var p={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(p)}k.resolve()})}return k},getNameForAlternative:function(m,k){var n=e.translate("Alternative")+" ";if(k){n=e.translate("Alt."," ")}if(a.prototype.rowNameMap){var l=a.prototype.rowNameMap[m];if(l&&l.length&&l.length>1){return n+" "+l}}return n+m},prepareImageRefForReporting:function(l,m,k,o,p,r,q){if(typeof l==="undefined"||l===null||l.length===0){return null}var n={name:m||"",caption:k||"",fileKey:l,alternative:o||"",svgType:p||"",parameter:r||"",timestamp:""+q||""};return n},setNavigatorObject:function(k){a.prototype.navigatorObject=k||null},getReportSVGObjects:function(k){var m=[];var l=a.prototype.caseInfo.CaseData.Definition.workflow;j(".sim-ui-page").each(function(n){try{var r=j(this);var o={id:l[n].id,svgObjectList:[]};if(r.advisePage){var p=r.advisePage("reportSetup");console.log(p)}o.svgObjectList=r[0].svgObjectList||[];m.push(o)}catch(q){console.error("Error reading page")}});if(typeof k==="function"){k(m)}},sendManySVGsToServant:function(l,m){var k={svgList:JSON.stringify(l),t:new Date().getTime()};a.prototype.executeCommand({commandName:"parseSVGListForReport",data:k,method:"POST"}).done(function(o){var n=o;m(n)})},cancelReportSVGSingle:function(k){a.prototype.executeCommand({commandName:"cancelSVGForReport",method:"POST"}).done(function(){k()})},cancelReportSVGList:function(l,m){var k={svgList:JSON.stringify(l),t:new Date().getTime()};a.prototype.executeCommand({commandName:"cancelSVGListForReport",data:k,method:"POST"}).done(function(){if(typeof m==="function"){m()}})},getCustomQuantileValue:function(m,l){l=l||{};var k=j.Deferred();proxy.executeCommand({commandName:"getCustomQuantileValue",data:m}).done(function(p,n,o){l.content=f.getJSONFromResponse([p,n,o]);k.resolve()});return k},overrideMethod:function(l,k){a.prototype[l]=k},getBinnedDataForScatter:function(k){k.data.visualCommand="getBinnedData";k.data.pageName="shopDesignsPage";k.data.visualName="scatterGridMVP";k.commandName="executeVisualCommand";return a.prototype.executeCommand(k)},getRowDataFromSomSelection:function(k){var l={};l.commandName="getRowDataFromSomSelection";l.data=k;return a.prototype.executeCommand(l)},setBasketRowsFromSomSelection:function(l){var m={};m.commandName="setBasketRowsFromSomSelection";m.data=l;var k=j.Deferred();a.prototype.executeCommand(m).done(function(p,q,o){var n=f.getJSONFromResponse([p,q,o]);a.prototype.basket=n;a.prototype.setBasket({content:n});k.resolve()});return k},setExcludedRowsFromSomSelection:function(l){var m={};var k=j.Deferred();m.commandName="setExcludedRowsFromSomSelection";m.data=l;a.prototype.executeCommand(m).done(function(q,r,p){a.prototype.excludedRowIdList=f.getJSONFromResponse([q,r,p]);var o={};o.iaEventSource="exclude";o.iaEventType=c.EVENT_TYPE_DATASET_CHANGED;a.prototype.propagateEvent(o);var n={eventType:"CASE_MODIFIED",eventSubType:"datasetChanged"};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(n)}k.resolve()});a.prototype.updateApproximationStatus();return k},getExecuteCommandURL:function(o){var n=a.prototype._baseURL+"executeCommand?commandName="+o.commandName;if(o.commandGroup&&o.commandGroup!==""){n+="&commandGroup="+o.commandGroup}var m=Object.keys(o.data);var l=m.map(function(p){return p+"="+o.data[p]});for(var k=0;k<l.length;k++){n=n+"&"+l[k]}return n},getScatterGridTile:function(n,r,o){var q={};var l=j.Deferred();n.r=0;n.c=2;n.width=n.imgWidth;n.height=n.imgHeight;q.data=n;q.data.visualCommand="getSingleScatter";q.data.pageName="shopDesignsPage";q.data.visualName="scatterGridMVP";q.commandName="executeVisualCommand";var p=document.createElementNS("http://www.w3.org/2000/svg","image");var m=this.getExecuteCommandURL(q);var k=d3.select(p).attr("x",0).attr("y",0).attr("height",n.imgHeight).attr("width",n.imgWidth);if(typeof o==="function"){o()}k.attr("xlink:href",m).style({fill:"none"});r(p);l.resolve();return l},getContourPlotTile:function(m,q,n){var p={};var k=j.Deferred();m.r=0;m.c=2;m.width=m.imgWidth;m.height=m.imgHeight;p.data=m;p.data.visualCommand="getContourPlot";p.data.pageName="shopDesignsPage";p.data.visualName="scatterGridMVP";p.commandName="executeVisualCommand";var o=document.createElementNS("http://www.w3.org/2000/svg","image");var l=this.getExecuteCommandURL(p);d3.select(o).attr("x",0).attr("y",0).attr("height",m.imgHeight).attr("width",m.imgWidth).attr("onload",function(){console.log("loaded!")}).on("SVGload",function(r){}).attr("onSVGload",function(){console.log("Fired SVGload from attr");if(typeof n==="function"){n()}}).attr("xlink:href",l).style({fill:"none"});q(o);k.resolve();return k},getNearestPlotPoint:function(l,n){var m={};var k=j.Deferred();m.data=l;m.data.visualCommand="getClosesPoint";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";a.prototype.executeCommand(m).done(function(p,r,o){var q=f.getJSONFromResponse([p,r,o]);n(q);k.resolve()});return k},setScatterGridSelection:function(l,n){var m={data:{}};var k=j.Deferred();m.data=l;m.data.visualCommand="setSelection";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";a.prototype.executeCommand(m).done(function(p,r,o){var q=f.getJSONFromResponse([p,r,o]);n(q,true);k.resolve()});return k},setupScatterPlots:function(l,n){var m={data:{payloads:JSON.stringify(l)}};var k=j.Deferred();m.data.visualCommand="setupScatterPlots";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";m.method="POST";a.prototype.executeCommand(m).done(function(p,r,o){var q=f.getJSONFromResponse([p,r,o]);if(typeof n==="function"){n(q,true)}k.resolve()});return k},setupContourPlots:function(l,n){var m={data:{payloads:JSON.stringify(l)}};var k=j.Deferred();m.data.visualCommand="setupContourPlots";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";m.method="POST";a.prototype.executeCommand(m).done(function(p,r,o){var q=f.getJSONFromResponse([p,r,o]);if(typeof n==="function"){n(q,true)}k.resolve()});return k},excludeSelectedGridPoints:function(o){var n=a.prototype.getNewTransactionDeferred();var m={data:{}};var k=j.Deferred();m.data.visualCommand="excludeSelection";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";var l={};l=j.extend({},l);l.iaEventSource="excludeSelectedGridPoints";l.iaEventType=c.EVENT_TYPE_GRADING_CHANGED;a.prototype.executeCommand(m).done(function(q,s,p){var r=f.getJSONFromResponse([q,s,p]);o(r);k.resolve();a.prototype.propagateEvent(l,n);n.resolve()});return k},includeSelectedGridPoints:function(o){var n=a.prototype.getNewTransactionDeferred();var m={};var k=j.Deferred();m.data.visualCommand="includeSelection";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";var l={};l=j.extend({},l);l.iaEventSource="includeSelectedGridPoints";l.iaEventType=c.EVENT_TYPE_GRADING_CHANGED;a.prototype.executeCommand(m).done(function(q,s,p){var r=f.getJSONFromResponse([q,s,p]);o(r);k.resolve();a.prototype.propagateEvent(l,n);n.resolve()});return k},getFilteredParameterStatistics:function(l,o){var n=a.prototype.getNewTransactionDeferred();var m={data:{paramIDs:l}};var k=j.Deferred();m.data.visualCommand="getFilteredColumnStats";m.data.pageName="shopDesignsPage";m.data.visualName="scatterGridMVP";m.commandName="executeVisualCommand";a.prototype.executeCommand(m).done(function(q,s,p){var r=f.getJSONFromResponse([q,s,p]);o(r);k.resolve();n.resolve()});return k},createFileFromJSON:function(m,l){var k=new Blob([JSON.stringify(l)],{type:"application/json"});return new File([k],m)},getFCSTicket:function(l){var n=a.prototype.getNewTransactionDeferred(),k="../../resources/slmservices/fcs/ticket",m="?";if(l.oId){m+="oid="+l.oId}else{n.reject();return n.promise()}if(l.action){m+="&action="+l.action}else{n.reject();return n.promise()}if(l.format){m+="&fformat="+l.format}if(l.store){m+="&store="+l.store}if(l.title){m+="&fname="+l.title}j.ajax({method:"GET",url:k+m,dataType:"text"}).done(function(p){if(typeof p==="undefined"||p===null||p.length===0){n.reject();return n.promise()}var o={};o.ticket=p.split("<Ticket>")[1].split("</Ticket>")[0];o.fcsUrl=p.split("<FcsUrl>")[1].split("</FcsUrl>")[0];n.resolve(o)}).fail(function(){n.reject()});return n.promise()},fcsCommit:function(k){var l=a.prototype.getNewTransactionDeferred();j.ajax({url:"../../resources/slmservices/fcs/commit",method:"PUT",data:k}).done(l.resolve).fail(l.reject);return l.promise()},fcsCheckin:function(l,o){var p=new FormData(),q=a.prototype.getNewTransactionDeferred(),k={csrfTokenName:"ENO_CSRF_TOKEN",noOfFiles:1,parentId:l.oId,objectId:l.oId,__fcs__jobTicket:o.ticket,fileName0:l.filename,bfile0:l.file,"file-title":l.filename,"file-description":l.filename,format0:l.format};for(var m in k){if(k.hasOwnProperty(m)){p.append(m,k[m])}}var n=new XMLHttpRequest();n.open("POST",o.fcsUrl);n.onreadystatechange=function(){if(n.readyState===4){if(n.status===200){q.resolve(n.responseText)}else{console.error("Error checking in the file to FCS.");q.reject(n.responseText)}}};n.send(p);return q.promise()},fcsDownload:function(l){var n=a.prototype.getNewTransactionDeferred();if(typeof l.ticket==="undefined"||typeof l.fileExtension==="undefined"||l.fileExtension===null){n.reject();return n.promise()}var k=new XMLHttpRequest(),m="__fcs__jobTicket="+l.ticket+"&__fcs__attachment=false";k.onload=function(q){if(k.readyState===4){if(k.status===200){var p=new Blob([this.response],{type:"application/"+l.fileExtension}),o=window.URL||window.webkitURL;n.resolve(p)}else{n.reject()}}};k.open("POST",l.url,true);k.setRequestHeader("Cache-Control","no-cache");k.setRequestHeader("Content-type","application/x-www-form-urlencoded");k.responseType="arraybuffer";k.send(m);return n.promise()},uploadFileTo3DSpace:function(l,k,o,m){var n=a.prototype.getNewTransactionDeferred();if(typeof k==="undefined"||k===null||(typeof o==="undefined"||o===null||o.length===0)){n.reject();return n.promise()}a.prototype.getFCSTicket({oId:l,title:o,action:"checkin",format:m}).done(function(p){a.prototype.fcsCheckin({oId:a.prototype._caseID,filename:o,file:k,format:m},p).done(function(q){a.prototype.fcsCommit(q).done(n.resolve).fail(n.reject)}).fail(n.reject)}).fail(n.reject);return n.promise()},downloadFileFrom3DSpace:function(k,n,l){var m=a.prototype.getNewTransactionDeferred();if(typeof k==="undefined"||k===null||k.length===0||(typeof n==="undefined"||n===null||n.length===0)){m.reject();return m.promise()}a.prototype.getFCSTicket({oId:k,title:n,action:"download"}).done(function(o){a.prototype.fcsDownload({ticket:encodeURIComponent(o.ticket),fileExtension:l,url:o.fcsUrl}).done(function(p){m.resolve(p)}).fail(m.reject)}).fail(m.reject);return m.promise()},isArrayLikeObject:function(k){if(Array.isArray(k)){return true}if(typeof k!=="undefined"&&k!==null&&typeof k==="object"&&k.hasOwnProperty("length")&&typeof k.length==="number"&&k.length>-1){return true}return false},extendObject:function(l,m){for(var k in l){if(l.hasOwnProperty(k)){if(typeof l[k]!=="undefined"&&l[k]!==null){if(typeof l[k]==="object"&&a.prototype.isArrayLikeObject(l[k])===false){if(Object.keys(l[k]).length>0){m[k]=m[k]||{};a.prototype.extendObject(l[k],m[k])}}else{m[k]=m[k]||{};m[k]=l[k]}}}}return m},serializePageObject:function(l){var k=function(n,o){if(a.prototype.isArrayLikeObject(o)){var m=[].some.call(o,function(p){return p instanceof HTMLElement});if(m===true){return undefined}else{if(o.length&&o.length>0){return o}else{return undefined}}}else{if(o instanceof HTMLElement){return undefined}else{return o}}};return JSON.parse(JSON.stringify(l,k))},fetchApproxLibraryJSON:function(l){var k=new j.Deferred();a.prototype.executeCommand({commandName:"getApproxLibraryJSON",commandGroup:"approximation"}).done(function(p,n,o){var m=f.getJSONFromResponse([p,n,o]);a.prototype.approximationSDKLibrary=m;try{l(m)}catch(q){}k.resolve(m)});return k},_NLSUnitsToDimensionMap:null,initializeUnitsAndDimensions:function(){var k=j.Deferred();var l=j.ajax({url:"../../resources/dictionary/dimensions",method:"GET",crossDomain:true,cache:false});l.done(function(m){if(m&&m.results){a.prototype.createUnitsNLSMap(m.results);k.resolve()}});l.fail(function(){k.resolve()});return k.promise()},createUnitsNLSMap:function(k){a.prototype._NLSUnitsToDimensionMap={};k.forEach(function(m){var l={Name:m.Name,NLS:m.NLS,MKSUnit:m.MKSUnit};m.Units.forEach(function(n){var o=n.NLSName;n.Dimension=l;var p=a.prototype._NLSUnitsToDimensionMap[o];if(!(p instanceof Array)){p=[]}p.push(n);a.prototype._NLSUnitsToDimensionMap[o]=p})})},getMatchingUnits:function(l,m){var k=Object.keys(a.prototype._NLSUnitsToDimensionMap);if(k.length>0){k=[].slice.call(k)}else{k=[]}return a.prototype.getSortedListByDistance(k,l,m,true,false)},getUnitInfo:function(k){return a.prototype._NLSUnitsToDimensionMap[k]},convertValues:function(r,p,o,n){var m="";if(n.constructor===Array){n.forEach(function(s){m=m+s+";"})}else{m=m+n}var l={Data:[{UnitFrom:r,UnitTo:p,Dimension:o,Values:m}]};var k=j.Deferred();var q=j.ajax({url:"../../resources/dictionary/dimensions/convertValues",method:"POST",crossDomain:true,data:JSON.stringify(l),cache:false,headers:{Accept:"application/json","Content-Type":"application/json"}});q.done(function(s){console.log(s);k.resolve(s.ConvertedValues)});return k.promise()},_EKMessageHandler:[],_interactiveSessionParams:{},_interactiveParameterMapping:{},_interactiveMappingRestored:false,getACParamId:function(n,l){if(!l){l=a.prototype.getAllParameterObjectsAsFlatList().map(function(o){return o.ID})}if(!a.prototype._interactiveSessionParams){return null}var m=null;var k=a.prototype._interactiveSessionParams[n];if(k&&k.acParamID&&l.indexOf(k.acParamID)>=0){m=k.acParamID}return m},getInteractiveParam:function(n){if(!a.prototype._interactiveSessionParams){return null}var k=null;var l=a.prototype.getInteractiveParameterMapping();if(typeof l[n]!=="undefined"){var o=l[n],m=o.id;k=a.prototype._interactiveSessionParams[m]}return k},_automapInteractiveParam:function(k,q){if(!q){q=a.prototype.getAllParameterObjectsAsFlatList()}var p=null,n=k.id,m=k.displayName,o=k.dataValueType,l=a.prototype.getInteractiveParameterMapping();q.some(function(r){if(l[r.ID]&&l[r.ID].id===n){if(a.prototype._interactiveMappingRestored){a.prototype.mapInteractiveParam(n,r.ID,m)}p=r.ID;return true}if(m&&(m===r.name||m===r.displayName)&&(!o||(o&&o.toLowerCase()===r.dataType.toLowerCase()))&&typeof l[r.ID]==="undefined"){if(!a.prototype._interactiveMappingRestored){a.prototype.mapInteractiveParam(n,r.ID,m);p=r.ID}return true}});return p},getInteractiveParameterMapping:function(){a.prototype._interactiveParameterMapping=a.prototype._interactiveParameterMapping||{};return a.prototype._interactiveParameterMapping},mapInteractiveParam:function(m,n,l){var k=a.prototype.getInteractiveParameterMapping(),o=a.prototype._interactiveSessionParams[m];k[n]={id:m,name:l};if(o){o.acParamID=n}},unmapInteractiveParam:function(l,m){var k=a.prototype.getInteractiveParameterMapping(),n=a.prototype._interactiveSessionParams[l];if(typeof k[m]!=="undefined"){delete k[m]}if(n){delete n.acParamID}},addEKMessageHandler:function(k){a.prototype._EKMessageHandler.push(k)},removeEKMessageHandler:function(l){var k=a.prototype._EKMessageHandler.indexOf(l);if(k>-1){a.prototype._EKMessageHandler.splice(k,1)}},_EKSessionInfo:{connected:false,node:null,nodeId:null,tryIngToReconnect:true},initializeEK:function(){var k=a.prototype.getSwitch("RA_INTERACTIVE_DESIGN");if(!k||a.prototype._EKSessionInfo.connected||typeof h==="undefined"||!a.prototype._EKSessionInfo.tryIngToReconnect){return}a.prototype._EKSessionInfo.node=new h.Node({hypervisorIp:a.prototype.CATIAHVUrl,webSocketPort:a.prototype.CATIAHVPort,ssl:true,onText:a.prototype.onText,onBinary:a.prototype.onBinary,onHypervisorConnect:function(){console.log("Connected to hypervisor");a.prototype._EKSessionInfo.connected=true;a.prototype._EKSessionInfo.nodeId=a.prototype._EKSessionInfo.node.connect("CATComOpeServerPool").select();var l=a.prototype.generateUUID();a.prototype.CATIASessionInitID=l;a.prototype.sendJson({action:"InitRASession",CATIASessionInitID:l});a.prototype._EKSessionInfo.node.subscribe(a.prototype._EKSessionInfo.nodeId,"OnParameterHasChanged");a.prototype._EKSessionInfo.node.subscribe(a.prototype._EKSessionInfo.nodeId,"OnGetImage");if(a.prototype._EKSessionInfo.timer){clearInterval(a.prototype._EKSessionInfo.timer)}a.prototype._EKSessionInfo.tryIngToReconnect=false},onHypervisorDisconnect:function(){a.prototype._EKSessionInfo.connected=false;console.log("Could not connect to Catia session. Ignore this message if Catia is not running.");a.prototype._EKSessionInfo.tryIngToReconnect=true;if(!a.prototype._EKSessionInfo.timer){a.prototype._EKSessionInfo.timer=setInterval(a.prototype.initializeEK,60000)}},pool:"CATComOpeServerPool"})},isEKActive:function(){return(a.prototype._EKSessionInfo.connected&&a.prototype._EKSessionInfo.sessionInitialized)},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var l=Math.random()*16|0,k=m=="x"?l:(l&3|8);return k.toString(16)})},endInteractiveSession:function(){if(!a.prototype._EKSessionInfo.connected){if(window.dscef&&window.dscef.sendString){dscef.sendString("endRASession","{'message':'RA Session ended'}")}}else{a.prototype.sendJson({action:"EndRASession",SessionID:a.prototype.CATIASessionID})}},setCATIAHVUrl:function(k){a.prototype.CATIAHVUrl=k},setCATIAHVPort:function(k){a.prototype.CATIAHVPort=k},setCATIAPartID:function(k){a.prototype.CATIAPartID=k},onText:function(m,l){console.log(" IAProxy::onText: "+m);if(m.length<2){return}try{var r=JSON.parse(m);if(r.action&&r.action==="InitRASession"&&a.prototype.CATIASessionID===""){if(r.Received){a.prototype._EKSessionInfo.sessionInitialized=true;a.prototype.CATIASessionID=r.SessionID;if(j(".sim-ui-footer-station-icon")){j(".sim-ui-footer-station-icon").off("click")}j("#footerStation").append(j("<span id='EKIcon' class='sim-ui-footer-EK-icon'></span>").tooltip({content:e.translate("CONNECTED_CATIA")}));if(j(".sim-ui-footer-station-text").text()&&j(".sim-ui-footer-station-text").text()!==""){j(".sim-ui-footer-station-text").text(j(".sim-ui-footer-station-text").text()+"& Part Design")}else{j(".sim-ui-footer-station-text").text("Part Design")}}setTimeout(function(){if(r.ParameterSetSelected){a.prototype.sendJson({action:"GetAllParams",SessionID:r.SessionID})}},10)}else{var q={};if(r.action==="GetAllParams"&&r.parameters instanceof Array&&(a.prototype.CATIASessionID===r.SessionID||r.SessionID===undefined)){a.prototype._interactiveSessionParams={};var s=a.prototype.getAllParameterObjectsAsFlatList();r.parameters.forEach(function(t){if(typeof t==="string"){t=JSON.parse(t)}a.prototype._interactiveSessionParams[t.id]=t;var o=a.prototype._automapInteractiveParam(t,s);if(o!==null){q[o]=t.value}})}else{if(r.action==="ParmHasChanged"){var n=a.prototype.getACParamId(+r.id),k=a.prototype.getInteractiveParam(n);if(k!==null){Object.keys(k).forEach(function(o){if(r.hasOwnProperty(o)){k[o]=r[o];if(o==="value"){q[n]=r.value}}},this)}}else{if(r.action==="EndRASession"){if(a.prototype._EKSessionInfo.node!=null){a.prototype._EKSessionInfo.node.stop()}if(a.prototype.getSwitch("RA_INTERACTIVE_DESIGN")){dscef.sendString("endRASession","{'message':'RA Session ended'}")}}}}if(Object.keys(q).length>0){a.prototype.updateParameterValues(q)}a.prototype._EKMessageHandler.forEach(function(o){try{if(o.onText){o.onText(m,l)}}catch(t){}})}}catch(p){console.log(p)}return true},onBinary:function(l,k){a.prototype._EKMessageHandler.forEach(function(m){try{if(m.onBinary){m.onBinary(l,k)}}catch(n){}})},sendJson:function(k){if(!a.prototype._EKSessionInfo.connected){return}if(a.prototype._EKSessionInfo.node!=null){a.prototype._EKSessionInfo.node.sendText(a.prototype._EKSessionInfo.nodeId,JSON.stringify(k))}},updateRecommendedDefinition:function(){var l=a.prototype.getNewTransactionDeferred();var k=a.prototype.getSwitch("RA_INTERACTIVE_DESIGN");if(!k){l.resolve()}else{a.prototype.getCSRFTokenFor3DSpace().done(function(m){var n={caseid:a.prototype._caseID,objectid:a.prototype.CATIAPartID,definition:{parameterMapping:a.prototype.getInteractiveParameterMapping()}},o=JSON.stringify(n),p=false;j.ajax({url:"../../resources/slmservices/advise/recommended/definition",method:"POST",data:o,contentType:p,beforeSend:function(q){q.setRequestHeader("ENO_CSRF_TOKEN",m);q.setRequestHeader("SecurityContext",sessionInfo.secCtx)}}).done(l.resolve).fail(l.resolve)}).fail(l.resolve)}return l.promise()},loadRecommendedDefinition:function(){var l=a.prototype.getNewTransactionDeferred();var k=a.prototype.getSwitch("RA_INTERACTIVE_DESIGN");if(!k){l.resolve()}else{a.prototype.getCSRFTokenFor3DSpace().done(function(m){j.ajax({url:"../../resources/slmservices/advise/recommended/definition",method:"GET",data:{caseid:a.prototype._caseID,objectid:a.prototype.CATIAPartID,},beforeSend:function(n){n.setRequestHeader("ENO_CSRF_TOKEN",m)}}).done(function(n){var o=n&&n.definition?n.definition:{};if(o&&o.parameterMapping){a.prototype._interactiveParameterMapping=o.parameterMapping;a.prototype._interactiveMappingRestored=true;console.info("parameter mapping");console.info(a.prototype._interactiveParameterMapping)}else{console.info("No Parameter Mapping found")}l.resolve()}).fail(l.resolve)}).fail(l.resolve)}return l.promise()},levenshteinDistance:function(y,x,v,w){if(v){return a.prototype.levenshteinDistance(y.toLowerCase(),x.toLowerCase(),false,w)}if(w){return a.prototype.levenshteinDistance(y.replace(/\W/g,""),x.replace(/\W/g,""),v,false)}if(!y||!x){return -1}var k=[];var l=y.length,p=x.length;var u=0;for(u=0;u<=l;u++){k[u]=[u]}var r=0,o=1;for(r=0;r<=p;r++){k[0][r]=r}for(u=1;u<=l;u++){var q=y.charAt(u-1);for(r=1;r<=p;r++){if(q===x.charAt(r-1)){o=0}else{o=1}k[u][r]=Math.min(k[u-1][r-1]+o,k[u][r-1]+1,k[u-1][r]+1)}}return k[l][p]},getBestMatchingString:function(t,u,p,r){if(!t||!t.length||!t.sort||!u){return null}t.sort(function(s,l){return -1*(l.length-s.length||l.localeCompare(s))});var k=t.length,n=0;var m=u.length+1000;var o=null;for(n=0;n<k;n++){var q=a.prototype.levenshteinDistance(t[n],u,p,r);if(q<m){m=q;o=t[n]}}return o},getSortedListByDistance:function(v,w,r,p,u){if(!v||!v.length||!v.sort||!w){return v}var k=v.length,n=0;var m=w.length+1000;var o=null;var t=[];for(n=0;n<k;n++){var q=a.prototype.levenshteinDistance(v[n],w,p,u);if(q<0){continue}t.push({dist:q,s:v[n]})}t.sort(function(s,l){return -1*(l.dist-s.dist)});return t.slice(0,r)},setImmersiveFrame:function(k){a.prototype._immersiveFrame=k},getImmersiveFrame:function(){if(typeof a.prototype._immersiveFrame!=="undefined"){return a.prototype._immersiveFrame}return null}};if(!g){g=new a()}return g});define("DS/SMAAnalyticsUI/SMAAnalyticsTopBarMenu",["TopBarProxy","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,c,a){var d=function(f){var e={},g;e.topBarProxy=new b({id:f.id});g=e.callback=function(h){alert("Received an event on command {0} execution.".format(h.get("label")));var i={eventType:h.get("label")};c.propagateEvent(i)};e.topBarProxy.setContent({add:[{label:a.translate("Analytics Case"),onExecute:g},{label:a.translate("Add Dataset"),onExecute:g}],share:[{label:a.translate("Share ..."),onExecute:g},{label:a.translate("Save Analytics Case"),onExecute:g}],help:[{label:a.translate("CASE_START_MSG"),onExecute:g}]})};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsApproxSelector",["DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(c,a){function b(d){this.selectionCallback=function(){};this.elements={};this.selectedApproximationsMap={};this.ctrlClickEnabled=true;if(typeof d!=="undefined"){this.createApproxSelector(d)}}b.prototype.createApproxSelector=function(d){this.selectorTable=d3.select(d);this.elements.tbody=this.selectorTable.select("tbody");this.elements.thead=this.selectorTable.select("thead")};b.prototype.defineApproxColors=function(d){this.approxColors=d};b.prototype.createLegendCell=function(f){var d=document.createElement("td");var e=d3.select(d).append("svg").classed("approximationTable-legendSVG",true);e.append("rect").attr("x","2").attr("y","5").attr("height","2").attr("width","15").style({stroke:"none",fill:this.approxColors[f.id]});return d};b.prototype.createApproxCell=function(f){var d=document.createElement("td");var e=f.displayName;if(e.length>15){d.setAttribute("title",e);e=e.substring(0,12)+"..."}d.textContent=e;return d};b.prototype.updateApproxSelector=function(d){if(typeof this.selectorTable==="undefined"){throw"Selector table is not defined!"}var g=this;var j=document.getElementById("approximationTable");j=d3.select(j).select("tbody");var j=g.elements.tbody;j.selectAll("tr").remove();var f,e=0;for(f=0;f<d.length;f++){if(d[f].status==="3"){e+=1}}var h=j.selectAll("tr").data(d,function(i){return i.id}).enter().append("tr").classed("approximationTable-row",true).each(function(i){this.appendChild(g.createLegendCell(i));this.appendChild(g.createApproxCell(i));this.appendChild(g.createStatusCell(i))});h.on("click",function(k){if(g.ctrlClickEnabled&&d3.event.ctrlKey){g.toggleApproxSelection(k.id)}else{for(var i in g.selectedApproximationsMap){if(i!==k.id){delete g.selectedApproximationsMap[i]}}g.selectApproximations([k.id])}})};b.prototype.setMultiSelect=function(d){if(d){this.ctrlClickEnabled=true}else{this.ctrlClickEnabled=false}};b.prototype.toggleApproxSelection=function(e){if(this.selectedApproximationsMap[e]===true){if(Object.keys(this.selectedApproximationsMap).length>1){delete this.selectedApproximationsMap[e]}else{return}}else{this.selectedApproximationsMap[e]=true}this.selectApproximations(Object.keys(this.selectedApproximationsMap))};b.prototype.setSelection=function(e){this.selectedApproximationsMap={};var d=this;e.forEach(function(f){d.selectedApproximationsMap[f]=true});this.setSelectionStyling(e)};b.prototype.setSelectionStyling=function(d){this.elements.tbody.selectAll("tr").each(function(f){var e=d3.select(this);if(d.indexOf(f.id)!==-1){e.classed("selectedRow",true)}else{e.classed("selectedRow",false)}})};b.prototype.createStatusCell=function(e){var d=document.createElement("td");this.updateStatusCell(d,e);return d};b.prototype.updateStatusCell=function(d,e){var f={INITIALIZATION:a.translate("Initializing")+"...",VALIDATION:a.translate("Validating")+"...",CREATION_FAILED:a.translate("Creation Failed"),ERROR_NO_INPUTS:a.translate("ERROR_NO_INPUTS"),ERROR_NO_OUTPUTS:a.translate("ERROR_NO_OUTPUTS"),ERROR_NO_PARAMETERS:a.translate("ERROR_NO_PARAMETERS"),ERROR_NO_DATA:a.translate("ERROR_NO_DATA"),ERROR_MULTIPLE:a.translate("ERROR_MULTIPLE"),OUT_OF_DATE:a.translate("OUT_OF_DATE"),MULTIPLE_OUT_OF_DATE:a.translate("MULTIPLE_OUT_OF_DATE")+".",NOT_AVAILABLE:a.translate("NOT_AVAILABLE"),READY:a.translate("Ready")};d.textContent=f[e.status]};b.prototype.setSelectionCallback=function(d){this.selectionCallback=d};b.prototype.selectApproximations=function(d){this.setSelection(d);this.setSelectionStyling(d);this.selectionCallback(d)};return b});define("DS/SMAAnalyticsUI/SMAAnalyticsUtils",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/Controls/TooltipModel","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,e,f,c,a){(function(){var g=console.debug;console.debug=function(i){var h=window.debug||false;if(h){g(i)}}})();Array.prototype.contains=function(h){var g=this.length;while(g--){if(this[g]===h){return true}}return false};Array.prototype.remove=function(i,h){var g=this.slice((h||i)+1||this.length);if(!isNaN(i)){this.length=i<0?this.length+i:i}this.push.apply(this,g);return this};Array.prototype.sum=function(m,l){var k=m||0;var g=l||this.length;var j=this[k];for(var h=k+1;h<g;h++){j+=this[h]}return j};var d=function(){};d.prototype={debounce:function(j,g,h){var k=null;return function i(){var n=this,m=arguments;function l(){if(!h){j.apply(n,m)}k=null}if(k){clearTimeout(k)}else{if(h){j.apply(n,m)}}k=setTimeout(l,g||100)}},makeFormattedNumber:function(i){if(typeof i==="undefined"){i=3}var k=this,j=this.text(),g=parseFloat(j);var h=g.toPrecision(i).toString();if(h.length<this.text().toString().length){this.text(h);this.parent().hover(function(){var l=k.parent().append('<div class="sim-ui-global-temporaryTextDiv">'+j+"</div>").children(".sim-ui-global-temporaryTextDiv");l.css({position:"absolute","z-index":5}).offset(k.offset())},function(){var l=k.parent().children(".sim-ui-global-temporaryTextDiv");if(l.remove){l.remove()}else{l.parentNode.removeChild(l)}})}return this},is3DXMLPlayerInstalled:function(){var h=null;if(navigator.mimeTypes&&navigator.mimeTypes.length){h=navigator}else{if(window.parent.navigator.mimeTypes&&window.parent.navigator.mimeTypes.length){h=window.parent.navigator}}if(h!==null){var g=h.mimeTypes["application/x-3dxmlplugin"];if(g&&g.enabledPlugin){return true}}return false},getMimeType:function(h){if(h&&navigator.mimeTypes&&navigator.mimeTypes.length){for(var g=0;g<navigator.mimeTypes.length;g++){var j=navigator.mimeTypes[g];if(j&&j.suffixes&&(j.suffixes.indexOf(h.toLowerCase())>-1||j.suffixes.indexOf(h.toUpperCase())>-1)){return j}}}return null},makeD3ParameterCopy:function(j,h){var i={parentID:h};for(var g in j){i[g]=j[g]}return i},makeD3GroupCopy:function(j,l){var k={};k.children=[];k.groupIDs=[];k.paramIDs=[];k.parentID=typeof l!=="undefined"?l:undefined;for(var h in j){if(h!=="parameters"&&h!=="groups"){k[h]=j[h]}}var g=0;if(typeof j.parameters!=="undefined"){for(g=0;g<j.parameters.length;g++){k.children.push(d.prototype.makeD3ParameterCopy(j.parameters[g],j.ID));k.paramIDs.push(j.parameters[g].ID)}}if(typeof j.groups!=="undefined"){for(g=0;g<j.groups.length;g++){k.children.push(d.prototype.makeD3GroupCopy(j.groups[g],j.ID));k.groupIDs.push(j.groups[g].ID)}}return k},getFormulationMap:function(o){var k={values:{}};function n(){var i={objectives:[],constraints:[]};return i}k.updateParameter=function(y,v,u,w){if(typeof k.values[y]==="undefined"){k.values[y]=n(y)}var t=k.values[y][v];var x=null;if(v==="objectives"){while(t.length>0){t.pop()}x={type:u,parameterID:y,value:typeof w!=="undefined"?w:0};t.push(x)}else{if(v==="constraints"){for(var s=0;s<t.length;s++){if(t[s].type===u){t.splice(s,1);break}}x={boundValue:w,type:u,parameterID:y};t.push(x)}}};k.saveChanges=function(){function z(E,I,J){var H=typeof u.constraints==="undefined"?0:u.constraints.length;for(var G=0;G<H;G++){var F=u.constraints[G];if(F.parameterID===E&&F.type===I){if(F.boundValue!==J){return 0}else{return 1}}}return 0}function y(E,I,J){var H=typeof u.objectives==="undefined"?0:u.objectives.length;for(var F=0;F<H;F++){var G=u.objectives[F];if(G.parameterID===E&&G.type===I){if(I==="TARGET"&&G.value!==J){return 0}else{return 1}}}return 0}var u=e.getFormulation(),s=[],v=[];var x=0;for(var D in k.values){var C=k.values[D];for(x=0;x<C.objectives.length;x++){var w=C.objectives[x];if(!y(w.parameterID,w.type,w.value)){v.push(w)}}for(x=0;x<C.constraints.length;x++){var t=C.constraints[x];if(!z(t.parameterID,t.type,t.boundValue)){s.push(t)}}}for(x=0;x<v.length;x++){if(v[x].type==="NONE"||(v[x].type==="TARGET"&&isNaN(parseInt(v[x].value,10)))){e.setObjective(v[x].parameterID,"","",window.event)}else{if(v[x].type!=="TARGET"){e.setObjective(v[x].parameterID,v[x].type,0,window.event)}else{e.setObjective(v[x].parameterID,v[x].type,parseFloat(v[x].value,10),window.event)}}}for(x=0;x<s.length;x++){var B=s[x].sourceParameterName;if(typeof B==="undefined"){var A=e.findParameter(s[x].parameterID);if(A!=null||typeof A!=="undefined"){B=A.displayName}}e.setConstraint(s[x].parameterID,s[x].type,s[x].boundValue,window.event,s[x].sourceName||e.varGroup.displayName,B)}};var g=null,m=null;var l=0;if(o){for(var q in o.values){var j=o.values[q];for(l=0;l<j.objectives.length;l++){m=j.objectives[l];k.updateParameter(m.parameterID,"objectives",m.type,m.value)}for(l=0;l<j.constraints.length;l++){g=j.constraints[l];k.updateParameter(g.parameterID,"constraints",g.type,g.boundValue)}}}else{var r=e.getFormulation(),p=typeof r.objectives!=="undefined"?r.objectives.length:0,h=typeof r.constraints!=="undefined"?r.constraints.length:0;for(l=0;l<p;l++){m=r.objectives[l];if(typeof k.values[m.parameterID]==="undefined"){k.values[m.parameterID]=n(m.parameterID)}k.values[m.parameterID].objectives.push(m)}for(l=0;l<h;l++){g=r.constraints[l];if(typeof k.values[g.parameterID]==="undefined"){k.values[g.parameterID]=n(g.parameterID)}k.values[g.parameterID].constraints.push(g)}}return k},getValidationTracker:function(){var g={parameters:{}};g.addParameter=function(h){g.parameters[h]={}};g.addError=function(h){if(typeof g.parameters[h.parameterID]==="undefined"){g.addParameter(h.parameterID)}g.parameters[h.parameterID][h.type]=h;return 0};g.removeError=function(h){if(typeof g.parameters[h.parameterID]==="undefined"){return 0}delete g.parameters[h.parameterID][h.type];if(Object.keys(g.parameters[h.parameterID]).length===0){delete g.parameters[h.parameterID]}return 0};g.checkFieldError=function(j,i){for(var h in g.parameters[j]){if(g.parameters[j][h].field===i){return true}}return false};g.isEmpty=function(){for(var h in g.parameters){var i=g.parameters[h];if(!b.isEmptyObject(i)){return false}}return true};return g},createIndexCounter:function(h,g){var i={counter:0};i.deferred=new b.Deferred();i.index=function(){this.counter+=1;if(this.counter===h){this.deferred.resolve(g)}};i.getDeferred=function(){return this.deferred};return i},convertGroupToD3:function(l,k){var g={score:k&&typeof k[l.ID]!=="undefined"?k[l.ID]:-1,children:[],nodeType:"group"};for(var j in l){if(j==="weightFactor"){g.weight=l[j]}else{if(j!=="groups"&&j!=="parameters"){g[j]=l[j]}}}var h=0;if(typeof l.groups!=="undefined"){for(h=0;h<l.groups.length;h++){g.children.push(d.prototype.convertGroupToD3(l.groups[h],k))}}if(typeof l.parameters!=="undefined"){for(h=0;h<l.parameters.length;h++){g.children.push(d.prototype.convertParameterToD3(l.parameters[h],k))}}if(g.children.length===0){delete g.children}return g},convertParameterToD3:function(i,h){var g={weight:i.weightFactor,priority:i.priority?i.priority:0,score:h&&typeof h[i.ID]!=="undefined"?h[i.ID]:-1,name:i.displayName,displayName:i.displayName,ID:i.ID,nodeType:"parameter"};if(i.min!==undefined){g.min=i.min}if(i.max!==undefined){g.max=i.max}if(i.dataType){g.dataType=i.dataType}return g},getScrollWidth:function(){if(window._RA_SCROLL_WIDTH){return window._RA_SCROLL_WIDTH}var h=document.createElement("div");document.body.appendChild(h);h.style.position="absolute";h.style.width="100px";h.style.height="100px";h.style.overflow="scroll";h.style.top="-9999px";var g=h.offsetWidth-h.clientWidth;document.body.removeChild(h);window._RA_SCROLL_WIDTH=g;return g},makeRenderTracker:function(h){var g={renderState:false};g.render=function(){var j=this;if(j.renderState===false){j.renderState=true;var i=h();b.when(i).always(function(){j.renderState=false})}else{return false}};return g},limitStackSize:function(g,l,u){g.groups=g.groups||[];g.parameters=g.parameters||[];u=u||{};var q=[],n=u.minStackSize||1;var h=(g.groups&&g.groups.length)||0;var p=0;for(p=0;p<h;p++){q.push({value:g.groups[p].weight,ID:g.groups[p].ID,type:"group"});d.prototype.limitStackSize(g.groups[p],l,u)}var t=(g.parameters&&g.parameters.length)||0;for(p=0;p<t;p++){q.push({value:g.parameters[p].weight,ID:g.parameters[p].ID,type:"parameter"})}if(q.length>=l+n){var j={};j.ID=g.ID+"OTHER";j.displayName="Other";j.groups=[];j.parameters=[];j.dataType="group";j.weight=0;if(u.rowIDs){j.scores={};for(p=0;p<u.rowIDs.length;p++){j.scores[u.rowIDs[p]]=0}if(g.relativeScores){j.relativeScores={};for(p=0;p<u.rowIDs.length;p++){j.relativeScores[u.rowIDs[p]]=0}}}q.sort(function(v,i){return i.value-v.value});for(p=l-1;p<q.length;p++){var s=null;if(q[p].type==="group"){var o=-1;g.groups.some(function(v,i){if(v.ID===q[p].ID){o=i;return true}else{return false}});var m=g.groups[o];for(s in m.scores){j.scores[s]+=m.scores[s]}if(m.relativeScores){for(s in m.relativeScores){j.relativeScores[s]+=m.relativeScores[s]}}j.groups.push(g.groups.splice(o,1)[0])}else{var k=-1;g.parameters.some(function(v,i){if(v.ID===q[p].ID){k=i;return true}else{return false}});var r=g.parameters[k];if(u.rowIDs){for(s in r.scores){j.scores[s]+=r.scores[s]}}if(r.relativeScores){for(s in r.relativeScores){j.relativeScores[s]+=r.relativeScores[s]}}j.parameters.push(g.parameters.splice(k,1)[0])}}d.prototype.limitStackSize(j,l,u);g.groups.push(j)}g.parameters.sort(function(v,i){return i.weight-v.weight});g.groups.sort(function(v,i){return i.weight-v.weight})},eliminateNonObjectivesFromHierarchy:function(n,g){var o=g;var m=0;if(!o){var k=(e.getFormulation()&&e.getFormulation().objectives)||{};o=[];for(m=0;m<k.length;m++){o.push(k[m].parameterID)}}var l=[];var j=(n.groups&&n.groups.length)||0;for(m=0;m<j;m++){d.prototype.eliminateNonObjectivesFromHierarchy(n.groups[m],o);if((n.groups[m].groups&&n.groups[m].groups.length>0)||(n.groups[m].parameters&&n.groups[m].parameters.length>0)){l.push(n.groups[m])}}n.groups=l;var h=[];var q=(n.parameters&&n.parameters.length)||0;for(m=0;m<q;m++){var p=n.parameters[m].ID;if(o.indexOf(p)>=0){h.push(n.parameters[m])}}n.parameters=h;return n},formatExp:function(j,h){h=h||4;var k=d3.format("."+(h-1)+"e");var g;var i;if(String(j).length<=h+4){return String(j).replace(/\+/g,"")}if(String(j)[0]==="-"){h--}g=d3.format("."+(h+1)+"g");i=g(j).replace(/\+/g,"");if(i.length<=h+4){return i}return k(j).replace(/\+/g,"")},makeTruncatedText:function(n,l){if(typeof n==="undefined"){n=200}if(typeof l==="undefined"){l=n-20}var j=this.text().trim(),m=this,g=this.text().trim().length,h="";while(m.width()>n&&g>0){g-=1;h=b.trim(this.text()).substring(0,g);this.text(h)}if(typeof j[this.text().length]==="string"&&j[this.text().length]!==" "){var k=this.text();var i=this.width();if(i<l){this.text(k)}h=this.text()}if(this.text().length!==j.length){m.parent().hover(function(){var o=m.parent().append('<div class="sim-ui-global-temporaryTextDiv">'+j+"</div>").children(".sim-ui-global-temporaryTextDiv");o.css({position:"absolute","z-index":5}).offset(m.offset())},function(){var o=m.parent().children(".sim-ui-global-temporaryTextDiv");if(o.remove){o.remove()}else{o.parentNode.removeChild(o)}});this.text((h+="..."))}this.data("fullText",j);return m},encapsulateImg:function(g,i){var l=this;if(l.css("top")==="auto"){l.css("top","0px")}if(l.css("left")==="auto"){l.css("left","0px")}if(typeof g==="undefined"){g=200}if(typeof i==="undefined"){i=400}var h=l.parent().append('<div class="sim-ui-global-imageHolderDiv"></div>').children(".sim-ui-global-imageHolderDiv").last();var k=b("#sim-ui-preview-sliderbar").width();var j=b(".sim-ui-carousel").width();if(b(".sim-ui-carousel").length>0){h.append(l).css({height:g,width:"85%"})}else{h.append(l).css({height:g,width:"96%"})}h.css({left:k+j+10});return h},zoomMaxWidth:function(){var g=this,i=g.children("img"),h=Math.min(i.width(),g.parent().width());i.attr("width",h);if(b(".sim-ui-carousel").length>0){g.css({height:"280px",width:"85%"})}else{g.css({height:"280px",width:"96%"})}g.run(d.prototype.updateWidthOnRefresh);return g},makeDraggable:function(){var h=this,k=h.children("img");var n=k.width(),q=k.height(),r=h.width(),j=h.height(),o=h.offset().top+(h.outerWidth()-r)/2,l=h.offset().left+(h.outerHeight()-j)/2,i=null,g=null,p=null,m=null;if(n>r){i=l-(n-r);g=l}else{i=l;g=l+r-n}if(q>j){p=o-(q-j);m=o}else{p=o;m=o+j-q}k.draggable({containment:[i,p,g,m]});h.mousedown(function(){var w=k.width(),x=k.height(),u=h.width(),t=h.height(),v=h.offset().top+(h.outerWidth()-u)/2,s=h.offset().left+(h.outerHeight()-t)/2;if(w>u){i=s-(w-u);g=s}else{i=s;g=s+u-w}if(x>t){p=v-(x-t);m=v}else{p=v;m=v+t-x}k.draggable({containment:[i,p,g,m]})});return h},setIStateToHide:function(){var h=this.children().children(".sim-ui-preview-contentDiv"),g=this.children().children(".sim-ui-preview-buttons-showHide");g.toggleClass("ui-icon-triangle-1-n ui-icon-triangle-1-s");h.css({height:0,overflow:"hidden"});g.data("showHide","hide")},sliderZoom:function(y,x,u){if(u===1){return x}var w=y.offset().left,q=y.offset().top,t=x.offset().left,p=x.offset().top,m=t+x.outerWidth()/2,F=p+x.outerHeight()/2;var i=0,E=0;if(y.height()>x.height()){i=m;E=F}else{i=y.offset().left+y.width()/2;E=y.offset().top+y.height()/2}var g=F-(E-q)*u,n=m-(i-w)*u;if(g>p){g=p+(x.outerHeight()-x.height())/2}else{if(g+y.outerHeight()*u<=p+x.outerHeight()){g=p+x.height()/2+x.outerHeight()/2-y.height()*u}}if(n>t+(x.outerWidth()-x.width())/2){n=t+(x.outerWidth()-x.width())/2}else{if(n+y.width()*u<=t+x.outerWidth()){n=t+x.width()/2+x.outerWidth()/2-y.width()*u}}var s=g-(p+(x.outerHeight()-x.height())/2),v=n-(t+(x.outerWidth()-x.width())/2);y.css({top:s+"px",left:v+"px",width:y.width()*u+"px",height:y.height()*u+"px"});var h=y.width(),o=y.height(),A=x.width(),l=x.height(),B=x.offset().top+(x.outerWidth()-A)/2,r=x.offset().left+(x.outerHeight()-l)/2;var D,C,k,j;if(h>A){D=r-(h-A);C=r}else{D=r;C=r+A-h}if(o>l){k=B-(o-l);j=B}else{k=B;j=B+l-o}y.draggable({containment:[D,k,C,j]});return x},createPreviewCarousel:function(r,p){if(r==="undefined"||r.length===0){return null}var m=typeof p!=="undefined"?d3.select(p):d3.select("#Simulation");var v=r.length,i=160,t=180,s=100,k=100,q=20;var w=s*v+(v-1)*q;var u=m.append("div").attr("class","sim-ui-carousel");var g=u.append("div").attr("class","sim-ui-carousel-scrollbutton").attr("id","sim-ui-carousel-up");g.append("a").append("span").attr("class","sim-ui-carousel-top");var n=u.append("div").attr("class","sim-ui-carousel-base");var x=u.append("div").attr("class","sim-ui-carousel-scrollbutton").attr("id","sim-ui-carousel-down");x.append("a").append("span").attr("class","sim-ui-carousel-bottom");var y=d3.range(v),j=d3.scale.linear().domain(d3.extent(y)).range([0,w-s]);var l=n.append("div").attr("class","sim-ui-carousel-wrapper").style("margin","auto").style("width",i+"px").style("height",t+"px").style("overflow","hidden");var h=l.selectAll("div").data(y).enter().append("div").attr("class","sim-ui-carousel-group");h.append("div").attr("class","sim-ui-carousel-slide").style("left","30px").style("top",function(z){return j(z)+"px"}).style("width",k+"px").style("height",s+"px").append("a").attr("class","sim-ui-carousel-overlay").attr("wflwurl",function(z){return r[z].workflowImageURL}).attr("img-title",function(z){return r[z].name}).attr("file-name",function(z){return r[z].fileName}).attr("deleted",function(z){return r[z].deleted||false}).attr("obj-id",function(z){return r[z].plmOID}).attr("obj-type",function(z){return r[z].typeName.toUpperCase()}).attr("dwnldurl",function(z){return r[z].downloadURL}).text(function(A){var z=r[A].name;if(z.length>20){return(z.substring(0,15)+"..."+z.substring(z.lastIndexOf(".")+1))}else{return z}});d3.selectAll(".sim-ui-carousel-slide").each(function(C){var A=d3.select(this);var B=A.select(".sim-ui-carousel-overlay");var z=B.attr("obj-type");this.tooltipInfos=new f({shortHelp:r[C].name});A.append("img").attr("src",function(){if(z.toUpperCase().indexOf("SIMULATION JOB")>-1){return"./assets/icons/simProcess.png"}else{if(z.toUpperCase().indexOf("SIMULATION DOCUMENT")>-1){return"./assets/icons/simDoc.png"}}}).style("position","relative").style("top","16px").style("z-index","20")});var o=function(){h.selectAll(".sim-ui-carousel-slide").transition().style("top",function(z){return j(z)+"px"})};g.on("click",function(){if(j.domain()[0]>0){j.domain([j.domain()[0]-1,j.domain()[1]-1]);o()}});x.on("click",function(){if(j.domain()[0]+1<v){j.domain([j.domain()[0]+1,j.domain()[1]+1]);o()}});return u},smaSliderObject:null,resetSlider:function(){b(".sim-ui-preview-sim-slider-button").css("top",b(".sim-ui-preview-sim-slider-scale").height()/2-b(".sim-ui-preview-sim-slider-button").height()/2)},createSlider:function(){var j=b("#sim-ui-preview-zoom");var l=false;var n=false;var i=0,v=b("#sim-ui-preview-sliderbar").height()*0.75,p=0,t=0,w=0.5;var s=function(y){var x=0;var z=0;if(!y){y=window.event}if(y.pageX||y.pageY){x=y.pageX;z=y.pageY}else{if(y.clientX||y.clientY){x=y.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;z=y.clientY+document.body.scrollTop+document.documentElement.scrollTop}}return{x:x,y:z}};var q=function(D){if(p===0||p===undefined){p=b("#sim-slider-button").offset().top}if(t===0||t===undefined){t=b("#sim-slider-button").offset().top-b(".sim-ui-preview-sim-slider-scale").offset().top}try{if(parseFloat(b(".sim-ui-preview-sim-slider-button").css("top"))===parseFloat(b(".sim-ui-preview-sim-slider-scale").height()/2)-b(".sim-ui-preview-sim-slider-button").height()/2){console.log("midpoint");w=0.5}}catch(A){}var F=D.y-p;var C=t+F;var y=b(".sim-ui-preview-sim-slider-scale").height()-b(".sim-ui-preview-sim-slider-button").height();C=Math.max(0,C);C=Math.min(C,y);b(".sim-ui-preview-sim-slider-button").css("top",C);var G=b(".sim-ui-preview-sim-slider-scale").height();var x=(G-C)/G;var E=x-w;w=x;var B=Math.pow(25,E);d.prototype.sliderZoom(b(".sim-ui-preview-sim-image"),b(".sim-ui-global-imageHolderDiv"),B);return F};var u=function(x){l=true;var y=s(x);p=y.y;t=b(this).offset().top-b(this).parent().offset().top;return false};var h=function(x){if(l&&!n){var y=s(x);q(y);return false}};var r=function(){l=false;j.val(i)};var g=function(y){if(!y){y=window.event}if(!l){return}p=0;t=0;var z=b("#sim-slider-button").offset().top;var x=y.srcElement?y.srcElement.id:y.target.id;if(x==="sim-slider-max"){z=z-10}else{if(x==="sim-slider-min"){z=z+10}}q({x:b("#sim-slider-button").offset().left,y:z})};j.wrap("<div/>");var o=j.parent();o.addClass("sim-ui-preview-sim-slider clearfix");o.append('<div class="sim-ui-preview-sim-slider-max" id="sim-slider-max">+</div><div class="sim-ui-preview-sim-slider-scale"><div id="sim-slider-button" class="sim-ui-preview-sim-slider-button"></div><div class="sim-ui-preview-sim-slider-tooltip"></div></div><div class="sim-ui-preview-sim-slider-min" id="sim-slider-min">-</div>');o.css("height",v);b(".sim-ui-preview-sim-slider-scale").css("height",o.height()-30+"px");var m=b("#sim-slider-button");m.css("top",(o.height()-30-m.height())*w);m.bind("mousedown",u);var k;b("#sim-slider-max, #sim-slider-min").mousedown(function(x){l=true;n=true;k=window.setInterval(function(){g(x)},25)});b("#sim-slider-max, #sim-slider-min").mouseup(function(){l=false;n=false;window.clearInterval(k)});b(document).mousemove(function(x){h(x)});b(document).mouseup(function(){r()});d.prototype.smaSliderObject=b("#sim-ui-preview-sliderbar")},updateWidthOnRefresh:function(){var g=this;b(window).resize(function(){if(b(".sim-ui-carousel").length>0){g.css("width","85%")}else{g.css("width","96%")}})},isLink:function(g){if(g.startsWith("http://")||g.startsWith("https://")){return true}return false},searchInputFormatter:function(i,g){var h=i.val().toLowerCase();if(g.which===27){h="";i.val(h)}else{if(g.which===13){g.preventDefault()}}return h},checkExportFormulationPossible:function(h,g){var k=(h.constructor===Object)?h.parameterList:h;var m=[];for(var n=0;n<g.length;n++){var o=g[n].physicalId;for(var l=0;l<k.length;l++){if(o===k[l].physicalId){var q={};q.objective=(g[n].objective!=="")?g[n].objective:k[l].objective;q.minimum=(g[n].minimum!=="")?g[n].minimum:k[l].minimum;q.maximum=(g[n].maximum!=="")?g[n].maximum:k[l].maximum;if(g[n].objective.toLowerCase()==="target"){q.parameterValue=g[n].parameterValue}else{q.parameterValue=k[l].parameterValue}if(k[l].minRangeProperty!==""){q.minincluded=k[l].minRangeProperty}if(k[l].maxRangeProperty!==""){q.maxincluded=k[l].maxRangeProperty}var p=true;if(q.minimum!==""&&q.maximum!==""){p=(Number(q.minimum)<Number(q.maximum))}if(p&&(q.objective.toLowerCase()==="target"||q.objective==="")&&q.parameterValue!==""){if(q.minimum!==""){p=(q.minincluded==="1"||q.minincluded==="3")?(Number(q.minimum)<=Number(q.parameterValue)):(Number(q.minimum)<Number(q.parameterValue))}if(p&&q.maximum!==""){p=(q.maxincluded==="1"||q.maxincluded==="3")?(Number(q.parameterValue)<=Number(q.maximum)):(Number(q.parameterValue)<Number(q.maximum))}}if(!p){m[n]=l;if(q.objective.toLowerCase()==="target"){c.alertMessage(c.ERROR,a.translate("FORMULATION_EXPORT_TARGET_ERROR",k[l].title,g[n].name,q.parameterValue,q.minimum,q.maximum))}else{c.alertMessage(c.ERROR,a.translate("FORMULATION_EXPORT_RANGE_ERROR",k[l].title,g[n].name,q.minimum,q.maximum))}}break}}}return m}};window.formatExp=d.prototype.formatExp;return d.prototype});define("DS/SMAAnalyticsUI/SMAAnalyticsPageWidget",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsControlPanel","DS/SMAAnalyticsUI/SMAAnalyticsViewButton"],function(b,c,a){function d(g,e,h){if(!h||!b.isArray(h)){return}for(var f=0;f<h.length;f++){g.element.advisePage("triggerEvent",h[f],true)}}b.widget("sim.advisePage",{options:{controlPanelId:"",contentPanelId:"",controlPanelWidth:300,collapsedWidth:10,collapsed:false,controlPanelHidden:false,scrollWidth:400,entering:b.noop,viewchange:b.noop,resize:b.noop,formulationChanged:b.noop,parameterChanged:b.noop,fileParameterChanged:b.noop,filterChanged:b.noop,selectionChanged:b.noop,basketChanged:b.noop,gradingChanged:b.noop,formulationLockChanged:b.noop,fileUploadedForDesign:b.noop,collabStatusChanged:b.noop,valuesChanged:b.noop,save:b.noop,postRender:b.noop,reportSetup:b.noop,eventListHandler:null},_create:function(){var g=this;if(g.option("eventListHandler")===null){g.option("eventListHandler",d)}var e=g.option("controlPanelId");var j=g.option("contentPanelId");if(e!==""){var i=document.createElement("div");i.setAttribute("class","sim-ui-panel-control-toggler pinned");var f=document.createElement("div");f.setAttribute("style","clear:both");i.onclick=function(k){g._toggleControlPanel(g,e,j);k.stopPropagation()};var h=document.getElementById(e);if(h!=null){h.insertBefore(f,h.childNodes[0]);h.insertBefore(i,h.childNodes[0])}b("#"+e).adviseControlPanel();b("#"+e).find("[data-helpTopic]").click(function(k){k.eventID="help";k.helpTopic=b(this).attr("data-helpTopic");c.propagateEvent(k)});b("#"+j).find(".sim-ui-panel-content-toolbarbutton").adviseToolbarButton();b("#"+j).find(".sim-ui-panel-content-viewbutton").adviseViewButton();b("#"+j).find(".sim-ui-panel-content-view").hide();b("#"+j).find('.sim-ui-panel-content-view[data-primary="true"]').show()}else{b("#"+j).css("left",5+"px")}b(window).resize(a.debounce(function(){g._resize(g,e,j)},200,false));g._resize(g,e,j);c.registerPage(g)},_init:function(){},enter:function(){if(this.eventsWhileHidden&&this.eventsWhileHidden.length>0){this.triggerEvent(this.eventsWhileHidden,true);delete this.eventsWhileHidden}var g=this.element.attr("data-showbasket");if(g=="false"){b("#basket").hide()}else{b("#basket").show()}try{var e=this.element[0].getAttribute("data-name");if(e.length>0){if(typeof window.parent.adviseLaunchInfo!=="undefined"){if(typeof window.parent.adviseLaunchInfo.changeFacetName==="function"){window.parent.adviseLaunchInfo.changeFacetName(e)}}}}catch(f){}this.option("entering")()},postRender:function(){this.option("postRender")()},reportSetup:function(){var e=this.option("reportSetup")();if(typeof e!=="undefined"){return e}return null},_resize:function(k,f,l){if(typeof f!=="undefined"&&f!="undefined"&&f!==""){var e=k.option("controlPanelWidth");var g=k.option("controlPanelWidth");var h=b(window).width();if(h<g){k.element.parent().css("overflow","scroll")}else{k.element.parent().css("overflow","")}if(h>=2*e){var i=k.option("ctrlPanelState");if(i==null){k._pinControlPanel(k,f,l)}}else{if(h<2*e){var i=k.option("ctrlPanelState");if(i=="pinned"){k._floatingControlPanel(k,f,l)}}}}else{b("#"+l).css("left","2px")}var j=function(){};j.iaEventType="resize";k.triggerEvent(j)},_toggleControlPanel:function(g,e,h){if(typeof e==="undefined"||e=="undefined"||e==""){return}var f=g.option("ctrlPanelState");if(f==null||f=="pinned"){g._floatingControlPanel(g,e,h)}else{if(f=="float"){g._pinControlPanel(g,e,h)}else{if(f=="minimized"){g._floatingControlPanel(g,e,h)}}}},_resizeContentPanel:function(g,f,h,e){h=g.option("contentPanelId");if(typeof h!=="undefined"&&h!="undefined"){b("#"+h).css("left",e+5+"px")}g._resize(g,f,h)},_minimizeControlPanel:function(i,f,k){b("#"+f).parent().find(".expand-collapsed-control-panel").remove();var l=i.option("collapsed");var e=i.option("controlPanelWidth");var g=i.option("controlPanelWidth");var h=b(window).width();if(h<g){i.element.parent().css("overflow","scroll")}else{i.element.parent().css("overflow","")}i.option("collapsed",true);b("#"+f).css("width",i.option("collapsedWidth")+"px");b("#"+f).addClass("sim-ui-panel-control-collapsed-state-float");b("#"+f+">div").hide();i._changePanelTogglerToUnpinned(i,f,k);var j="minimized";i.option("ctrlPanelState",j);i._resizeContentPanel(i,f,k,i.option("collapsedWidth"))},_pinControlPanel:function(f,e,i){b("#"+e).parent().find(".expand-collapsed-control-panel").remove();b("#"+e).css("width",f.option("controlPanelWidth")+"px");b("#"+e+">div").show();b("#"+e+">div.sim-ui-panel-control-collapsed").hide();f.option("collapsed",false);var g=b("#"+e+">div.sim-ui-panel-control-toggler");g.removeClass("sim-ui-panel-control-toggler unpinned");g.addClass("sim-ui-panel-control-toggler pinned");b("#"+e).removeClass("sim-ui-panel-control-collapsed-state-float").removeClass("sim-ui-panel-control-collapsed-state");f._removeOverlayDiv(e);var h="pinned";f.option("ctrlPanelState",h);f._resizeContentPanel(f,e,i,f.option("controlPanelWidth"))},_floatingControlPanel:function(j,e,l){j.option("collapsed",true);b("#"+e).parent().find(".expand-collapsed-control-panel").remove();var h=j.option("collapsed");var m=j.option("controlPanelWidth");var i=j.option("controlPanelWidth");var f=b(window).width();if(f<i){j.element.parent().css("overflow","scroll")}else{j.element.parent().css("overflow","")}b("#"+e).css("width",j.option("collapsedWidth")+"px");b("#"+e+">div").hide();b("#"+e).addClass("sim-ui-panel-control-collapsed-state-float").removeClass("sim-ui-panel-control-collapsed-state").css("width",j.option("controlPanelWidth"));b("#"+e).css("width",j.option("controlPanelWidth")+"px");b("#"+e+">div").show();b("#"+e+">div.sim-ui-panel-control-collapsed").hide();j._changePanelTogglerToUnpinned(j,e,l);var k=b("#"+e).parent()[0];var g="float";j.option("ctrlPanelState",g);j._resizeContentPanel(j,e,l,j.option("collapsedWidth"));if(typeof k!=="undefined"){j._addOverlayDiv(j,e,l,b("#"+e).parent()[0].id)}},_changePanelTogglerToUnpinned:function(f,e,h){var g=b("#"+e+">div.sim-ui-panel-control-toggler");g.removeClass("sim-ui-panel-control-toggler pinned");g.addClass("sim-ui-panel-control-toggler unpinned");f._removeOverlayDiv(e);b("#"+e).click(function(){var i=f.option("ctrlPanelState");if(i=="minimized"){var j="float";f._floatingControlPanel(f,e,h);f.option("ctrlPanelState",j)}})},_addOverlayDiv:function(i,f,j,e){var k=i.option("controlPanelWidth");var g=document.createElement("div");g.setAttribute("class","sim-ui-panel-control-collapsed-state-float-overlay");g.style.left=k+"px";g.onclick=function(){var l=i.option("ctrlPanelState");if(l=="float"){var m="minimized";i._minimizeControlPanel(i,f,j);i.option("ctrlPanelState",m)}event.stopPropagation()};var h=document.getElementById(e);if(h!=null){h.insertBefore(g,h.childNodes[0])}},_removeOverlayDiv:function(e){b("#"+e).parent().find(".sim-ui-panel-control-collapsed-state-float-overlay").remove()},_addControlVeil:function(f){var e=this},_removeControlVeil:function(f){var e=this},triggerEvent:function(k,l){var j=j||k||null;if(!j.stopPropagation){j.stopPropagation=function(){}}if(b(this.element).is(":hidden")&&!l){this.eventsWhileHidden=this.eventsWhileHidden||[];var i=this;if(b.isArray(k)){b(k).each(function(m,n){i.eventsWhileHidden.push(n)})}else{this.eventsWhileHidden.push(j)}return}if(this.eventsWhileHidden&&!b(this.element).is(":hidden")){console.error("There are events hidden that have not been handled by the page "+b(this.element).attr("id"))}var e=[];if(b.isArray(k)){var h=this.option("eventListHandler");if(typeof h==="function"){e=h(this,j,k)}else{e=k}d(this,j,e);return}try{var f=this.option(k.iaEventType);if(typeof f==="function"){f(j,k,this)}}catch(g){return false}}});return b});define("DS/SMAAnalyticsUI/SMAAnalyticsNavigator",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon"],function(c,f,h,a,d){function b(i){this.options=i}b.prototype.callback=null;b.prototype.pageDefinition=[];b.prototype.currentPageIndex=0;var g=null,e=null;b.prototype.createNavigationBar=function(q,k){b.prototype.pageDefinition=k;var l=0;var j=null;for(var m=0;m<k.length;m++){var v=k[m];if(v.hidden===null||v.hidden==="undefined"||v.hidden==="false"||v.hidden===false){l=l+1;v.hidden=false;if(j===null){j=v.id}}else{v.hidden=true}}var r=0;var o=(100-2*r)/l;var t='<div class="sim-ui-navigator-marker">',p="</div>";var n='<div class="sim-ui-navigator">';var u='<div class="sim-ui-navigator-line"></div>';c.each(k,function(w,x){var z=x.id,i="",y=x.hidden;if(x.nameNLSKey&&x.nameNLSKey.length>1){i=a.translate(x.nameNLSKey)}else{i=x.name}c("#"+z+".sim-ui-page").attr("data-name",i);n+='<div class="sim-ui-navigator-block';if(y){n+=" sim-ui-navigator-block-hidden"}n+='"';n+=' style="width:'+o+'%;"';n+=' page-name="'+i+'"';n+=' page-id="'+z+'"';n+=">";n+=t;n+=w+1;n+=p;n+='<div class="sim-ui-navigator-text" page-id="'+z+'">'+decodeURIComponent(i)+"</div>";n+="</div>"});n+="</div>";c(q).html(u+n);g=c("<div/>",{"class":"sim-ui-navigator-editor",style:"display:none;"}).appendTo(c(q));e=c("<input/>",{type:"text",style:"width:100%;height:100%"}).appendTo(g);var s=function(y){if(g.cancelled){g.cancelled=false;return}var w=e.val().trim();var i=e.attr("page-id");var z=encodeURIComponent(w);if(w.length>0){for(m=0;m<k.length;m++){var x=k[m];if(x.id===i){x.name=z;break}}c("#"+i+".sim-ui-page").attr("data-name",z);if(b.prototype.currPageID===i){c("#titleText").text(w)}c('.sim-ui-navigator-text[page-id="'+i+'"]').text(w);c('.sim-ui-navigator-block[page-id="'+i+'"]').attr("page-name",z)}g.hide();b.prototype.syncDefinition();b.prototype.syncContextPopup()};if(!f.getSwitch("RA_INTERACTIVE_DESIGN")){e.change(s).focusout(s);e.keyup(function(x){if(x.keyCode==27){var i=e.attr("page-id");for(m=0;m<k.length;m++){var w=k[m];if(w.id===i){e.val(w.name);break}}g.cancelled=true;g.hide()}});c(".sim-ui-navigator").sortable({delay:300,start:function(i,w){},stop:function(i,w){b.prototype.refresh();b.prototype.syncDefinition()}});c(".sim-ui-navigator-block").dblclick(function(w){var i=c(this).attr("page-id");b.prototype.renamePage(i)})}c(".sim-ui-navigator-block").click(function(w){var x=c(this).find(".sim-ui-navigator-text").text(),i=c(this).attr("page-id");b.prototype.navigateTo(w,i,x)});b.prototype.hideIrrelevantViews();b.prototype.refresh();return j};b.prototype.navigateTo=function(k,i,m){b.prototype.currPageID=i;try{if(document&&document.activeElement&&typeof document.activeElement.blur==="function"){document.activeElement.blur()}}catch(n){}c(".sim-ui-navigator-marker-current").removeClass("sim-ui-navigator-marker-current");c(".sim-ui-navigator-text-current").removeClass("sim-ui-navigator-text-current");var j=null;if(k!==null){if(c(k.target).hasClass("sim-ui-navigator-block")){c(k.target).find(".sim-ui-navigator-marker").addClass("sim-ui-navigator-marker-current");c(k.target).find(".sim-ui-navigator-text").addClass("sim-ui-navigator-text-current")}else{j=c(k.target).parent();j.find(".sim-ui-navigator-marker").addClass("sim-ui-navigator-marker-current");j.find(".sim-ui-navigator-text").addClass("sim-ui-navigator-text-current")}}else{j=c('div.sim-ui-navigator-block[page-id="'+i+'"]');j.find(".sim-ui-navigator-marker").addClass("sim-ui-navigator-marker-current");j.find(".sim-ui-navigator-text").addClass("sim-ui-navigator-text-current")}c(".sim-ui-page").hide();var l=null;try{l=c("#"+i+".sim-ui-page");l.advisePage("enter");l.show();l.advisePage("postRender");d.hideAlert()}catch(n){if(n.stack){console.error(n.stack);d.alertMessage(d.ERROR,n.message)}else{console.error(n)}}if(l!==null&&l.length>0){m=decodeURIComponent(l.attr("data-name"))}c("#titleText").text(m)};b.prototype.refresh=function(){var m=b.prototype.pageDefinition;var k=0;c(".sim-ui-navigator-block-hidden").removeClass("sim-ui-navigator-block-hidden");for(var l=0;l<m.length;l++){var o=m[l];if(o.hidden===null||o.hidden==="undefined"||o.hidden==="false"||o.hidden===false){k=k+1;o.hidden=false}else{o.hidden=true;c('.sim-ui-navigator-block[page-id="'+o.id+'"]').addClass("sim-ui-navigator-block-hidden")}}var j=2.5;var n=(100-2*j)/k;var q=c(".sim-ui-navigator-block").css("width",n+"%");var p=0;for(l=0;l<q.length;l++){if(!c(q[l]).hasClass("sim-ui-navigator-block-hidden")){p++;c(q[l]).find(".sim-ui-navigator-marker").text(p)}}b.prototype.syncContextPopup()};b.prototype.syncDefinition=function(){var q=c(".sim-ui-navigator-block");var p=0;b.prototype.pageDefinition=[];for(var n=0;n<q.length;n++){var o={id:c(q[n]).attr("page-id"),name:c(q[n]).attr("page-name"),hidden:false,views:[]};if(c(q[n]).hasClass("sim-ui-navigator-block-hidden")){o.hidden=true}var l=document.querySelector("#"+c(q[n]).attr("page-id")).querySelectorAll(".sim-ui-panel-content-view");if(l.length>0){for(var m=0;m<l.length;m++){var k={id:l[m].id,hidden:l[m].classList.contains("sim-ui-hidden-view")};o.views.push(k)}}b.prototype.pageDefinition.push(o)}f.setWorkflowDefinition(b.prototype.pageDefinition)};b.prototype.getDefinitionString=function(){JSON.stringify(b.prototype.pageDefinition)};b.prototype.hidePage=function(j){var l=b.prototype.pageDefinition;for(var k=0;k<l.length;k++){var m=l[k];if(m.id==j){m.hidden=true;break}}b.prototype.refresh();b.prototype.syncDefinition()};b.prototype.hideIrrelevantViews=function(){var k=b.prototype.pageDefinition,l=false,o="";try{for(var n=0;n<k.length;n++){if(typeof k[n].views!=="undefined"&&k[n].views!==null){for(var m=0;m<k[n].views.length;m++){var s=k[n].views[m];if(s.hidden===true){var t=document.querySelector("#"+s.id);t.classList.add("sim-ui-hidden-view");var r=document.querySelector("[data-view="+s.id+"]");r.classList.add("sim-ui-hidden-view");if(t.getAttribute("data-primary")==="true"){t.setAttribute("data-primary",false);r.classList.remove("sim-ui-panel-content-viewbutton-current");var q=t.parentNode.querySelectorAll(".sim-ui-panel-content-view:not(.sim-ui-hidden-view)");if(typeof q!=="undefined"&&q!==null){if(q.length>0){o=q[0].id;q[0].setAttribute("data-primary","true");document.querySelector("[data-view="+q[0].id+"]").classList.add("sim-ui-panel-content-viewbutton-current")}else{k[n].hidden=true;l=true}}}}}}}if(l){b.prototype.refresh();b.prototype.syncDefinition()}else{if(o!==""){c("#"+o).show()}}}catch(p){console.error("Error executing view permissions.")}};b.prototype.renamePage=function(k){var m=c('.sim-ui-navigator-block[page-id="'+k+'"]').find(".sim-ui-navigator-text");var n=m.text();var j=m.width(),i=m.position().left;if(parseInt(j,10)<175){j=175}e.attr("page-id",k);g.css("left",i+50).css("width",j-25).show();e.val(n);e.focus()};b.prototype.showPage=function(k,p){console.log("pageid = "+k);console.log("hiddenID = "+p);var n=b.prototype.pageDefinition;for(var m=0;m<n.length;m++){var o=n[m];if(o.id==p){o.hidden=false;break}}var j=c('.sim-ui-navigator-block[page-id="'+p+'"]');var l=c('.sim-ui-navigator-block[page-id="'+k+'"]');j.insertBefore(l);b.prototype.refresh();b.prototype.syncDefinition()};b.prototype.syncContextPopup=function(){if(f.getSwitch("RA_INTERACTIVE_DESIGN")){return}var k=c(".sim-ui-navigator-block");var l=0;var s=[];for(var o=0;o<k.length;o++){var t={id:c(k[o]).attr("page-id"),name:c(k[o]).attr("page-name"),hidden:false};if(c(k[o]).hasClass("sim-ui-navigator-block-hidden")){t.hidden=true;s.push(t)}}for(o=0;o<k.length;o++){if(!c(k[o]).hasClass("sim-ui-navigator-block-hidden")){var r=c(k[o]).attr("page-id");var p=o;var q=[{label:a.translate("Rename val",decodeURIComponent(c(k[o]).attr("page-name"))),icon:"./assets/icons/renamePage.png",pageID:r,action:function(i){b.prototype.renamePage(this.pageID)}}];if(b.prototype.currPageID!==r){q.push({label:a.translate("Hide val",decodeURIComponent(c(k[o]).attr("page-name"))),pageID:r,action:function(i){b.prototype.hidePage(this.pageID)}})}for(var n=0;n<s.length;n++){var u={label:a.translate("Show val",decodeURIComponent(s[n].name)),hiddenID:s[n].id,pageID:r,index:p,action:function(i){b.prototype.showPage(this.pageID,this.hiddenID)}};q.push(u)}var m={title:"",items:q};c(k[o]).refreshContextPopup(m)}}};return b.prototype});define("DS/SMAAnalyticsUI/SMAAnalyticsToolbarButton",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget"],function(a,b,c){c=JSON.parse(c);a.widget("sim.adviseToolbarButton",{options:{eventID:""},_create:function(){var f=this;var g=f.element.attr("data-event");if(!(typeof g==="undefined"||g==="undefined"||g==="")){f.option("eventID",g)}var e=f.element.attr("data-icon");if(!(typeof e==="undefined"||e==="undefined"||e==="")){f.element.css("background","url('"+c.ICON_LOCATION+e+c.ICON_EXTENSION+"') no-repeat center center transparent");f.element.tooltip()}var d=f.element.attr("data-scope");f.element.click(function(h){h.eventID=f.option("eventID");if(typeof h.eventID==="undefined"||h.eventID==="undefined"||h.eventID===""){h.eventID=f.element.attr("data-icon")}if(!(typeof h.eventID==="undefined"||h.eventID==="undefined"||h.eventID==="")){h.iaEventType="toolbarButtonClicked";var i=f.element.parent().parent().parent();if(typeof i==="undefined"||i=="undefined"||i.length<1||i[0]==null||i[0].nodeName=="html"||i[0].nodeName=="HTML"||typeof d==="undefined"||d=="undefined"||d=="app"){b.propagateEvent(h)}else{i.advisePage("triggerEvent",h)}}})},_init:function(){},_hoverin:function(){},_hoverout:function(){}});return a});define("DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper",["DS/SMAAnalyticsUI/SMAAnalyticsProxy","UWA/Class/Promise","DS/Windows/Dialog","DS/Controls/Button","UWA/Core"],function(b,a,d,c){function e(f){this.page=f;this.scrapeUI=document.createElement("div");this.scrapeUI.classList.add("smaAdvise-svgScrapeUI");this.scrapeFinderUI=null;this.scrapeRecordingUI=document.createElement("div");this.scrapeRecordingUI.classList.add("smaAdvise-svgScrapeRecordingUI")}e.prototype={openScrapeUI:function(){this.buildScrapeFinder()},highlightSVGContainer:function(j){var l=document.createElement("div");l.classList.add("smaAdvise-svgScrapeHighlight");var k=3;var i=this.scrapeFinderUI.getBoundingClientRect();var g=j.getBoundingClientRect();var f=g.top-i.top-k;var h=g.left-i.left-k;l.style.top=f+"px";l.style.left=h+"px";l.style.width=j.offsetWidth+"px";l.style.height=j.offsetHeight+"px";l.style.border=k+"px solid #00d3ff";l.svgContainerReference=j;l.scraperRef=this;l.onclick=e.prototype.buildScrapeEditorOnClick;j.classList.add("highlightedSVGContainer");this.scrapeFinderUI.appendChild(l)},buildScrapeFinder:function(){this.scrapeFinderUI=document.createElement("div");this.scrapeFinderUI.classList.add("smaAdvise-svgScrapeScreen");this.scrapeUI.appendChild(this.scrapeFinderUI);if(this.scrapeUI.parentNode===null){this.page[0].insertBefore(this.scrapeUI,null)}var f=this.page[0].querySelectorAll('[data-reportable="svg"]');[].forEach.call(f,this.highlightSVGContainer,this);this.scrapeFinderUI.onclick=function(){this.innerHTML="";[].forEach.call(f,function(g){g.classList.remove("highlightedSVGContainer")},this);this.parentNode.removeChild(this)};if(this.scrapeFinderUI.classList.contains("hidden")){this.scrapeFinderUI.classList.remove("hidden")}},findParamID:function(g,h){if(h===g||h===null){return""}var f=h,i=f.getAttribute("data-paramID");if(i===null||typeof i==="undefined"||i===""){return this.findParamID(g,f.parentNode)}else{return i}},prepSVGListForServant:function(l,g){var j=[];var k=new Date().getTime();var i=g.getAttribute("data-svgType");var h=g.getAttribute("data-svgname");var f=g.getAttribute("data-svgalt");[].forEach.call(l,function(m){var n={svg:encodeURIComponent(m.svgText),filename:encodeURIComponent(h),timestamp:k};if(typeof i!=="undefined"&&i!==null&&i.length>0){n.svgType=i}if(typeof f!=="undefined"&&f!==null&&f.length>0){n.svgAltID=f}var o=this.findParamID(g,m.parent);if(typeof o!=="undefined"&&o!==null&&o.length>0){n.svgParamID=o}j.push(n)},this);return j},autoScrape:function(f){var i=this.page[0].querySelectorAll('[data-reportable="svg"]');var h=0;var g=function(){h+=1;if(h===i.length&&typeof f==="function"){f()}};[].forEach.call(i,function(j){this.autoScrapeContainer(j,g)},this)},autoScrapeContainer:function(g,k){var j=this;var h=g.querySelectorAll("svg:not(.svgscrape-ignore)");if(h.length===0){return}if(g.getAttribute("data-svgAttemptToCombine")==="true"){h=this.mergeSVGs(h,g)}else{h=h[0].cloneNode(true)}var i=h.outerHTML;if(typeof i==="undefined"){i=g.innerHTML}var f=this.prepSVGListForServant([{svgText:i,parent:g}],g);b.sendManySVGsToServant(f,function(l){l=JSON.parse(l);if(l.length>0){var m=l[0];var o=b.getCompleteURL(m);var n=f[0];j.saveSVGToPage(name,o,undefined,undefined,undefined,n.timestamp)}k()})},mergeSVGs:function(m,f){try{var i=document.createElementNS("http://www.w3.org/2000/svg","svg"),h=Object.keys(m),j=1;if(f.combineInstructions&&f.combineInstructions.order instanceof Array){h=f.combineInstructions.order}if(f.combineInstructions&&f.combineInstructions.columns){j=f.combineInstructions.columns}var g=0,n=0,k=[],o=false;h.forEach(function(v,x){var t=m[v];var r=parseInt(x%j,10);if(r===0){o=true}if(!t){return}var p=parseInt(i.getAttribute("width"),10)||0;var u=parseInt(i.getAttribute("height"),10)||0;var w=parseInt(t.getAttribute("width"),10)||0;var y=parseInt(t.getAttribute("height"),10)||0;w=w||t.getClientRects()[0].width;y=y||t.getClientRects()[0].height;if(o){g=0;n=u;o=false}g=k[r]||g;if(k&&typeof k[r]==="undefined"){k[r]=g}var q=document.createElementNS("http://www.w3.org/2000/svg","g");q.setAttribute("transform","translate("+g+","+n+")");q.appendChild(t.cloneNode(true));i.appendChild(q);g+=w;if(g>p){i.setAttribute("width",g+"px")}var s=n+y;if(s>u){i.setAttribute("height",s+"px")}},this);m=i}catch(l){m=m[0].cloneNode(true)}return m},buildScrapeEditorOnClick:function(f){f.cancelBubble=true;if(f.stopPropagation){f.stopPropagation()}var h=this.scraperRef;var g=this.svgContainerReference;h.buildScrapeEditor.call(h,g);h.scrapeFinderUI.click()},buildPreviewPopover:function(f,j){var i=b.getImmersiveFrame();if(i!==null){var g=function(){b.cancelReportSVGList(j)};var h={Cancel:new c({onClick:function(m){g();var k=m.dsModel;var l=k.dialog;l.close()}.bind(this)}),Ok:new c({onClick:function(q){var m="";var l="";if(typeof f.noComment==="undefined"||f.noComment){m=this.scrapeEditorTitle.value;l=this.scrapeEditorCaption.value}var k=this.scrapeEditorImageContainer.querySelectorAll("img");var o,r;[].forEach.call(k,function(t,s){var u=t.getAttribute("src");var v=j[s];this.saveSVGToPage(m,u,l,v.svgAltID,v.svgParamID,v.timestamp)},this);var n=q.dsModel;var p=n.dialog;p.close()}.bind(this)})};this.dialog=new d({title:"Copy to Report",content:this.scrapeEditor||document.createElement("div"),immersiveFrame:i,resizableFlag:true,width:500,height:400,closeButtonFlag:true,buttons:h});this.dialog.addEventListener(function(k){})}},buildScrapeEditor:function(f){var k=this;this.scrapeEditor=document.createElement("div");this.scrapeEditor.classList.add("smaAdvise-svgScrapeUIModal");this.scrapeEditor.classList.add("smaAdvise-svgScrapeUIEdit");if(typeof f.noComment==="undefined"||f.noComment){this.scrapeEditorTitle=document.createElement("input");this.scrapeEditorTitle.value="Image Title"}this.scrapeEditorImageContainerOuter=document.createElement("div");this.scrapeEditorImageContainerOuter.classList.add("smaAdvise-svgImageContainerOuter");this.scrapeEditorImageContainer=document.createElement("div");this.scrapeEditorImageContainer.classList.add("smaAdvise-svgScrapeImageContainer");if(typeof f.renderFunction!=="function"){this.scrapeEditorImageContainer.textContent="Rasterizing Chart ..."}else{this.scrapeEditorImageContainer.textContent="Completing rendering of chart"}this.scrapeEditorImage=document.createElement("img");this.scrapeEditorImage.onerror=function(){console.error("Error loading image converted from svg")};this.scrapeEditorImage.onload=function(){};this.scrapeEditorCaption=document.createElement("textarea");if(typeof f.noComment==="undefined"||f.noComment){this.scrapeEditor.appendChild(this.scrapeEditorTitle)}this.scrapeEditorImageContainerOuter.appendChild(this.scrapeEditorImageContainer);this.scrapeEditor.appendChild(this.scrapeEditorImageContainerOuter);if(typeof f.noComment==="undefined"||f.noComment){this.scrapeEditor.appendChild(this.scrapeEditorCaption)}if(typeof f.renderFunction==="function"){f.renderFunction();this.scrapeEditorImageContainer.textContent="Rasterizing Chart ..."}if(f.getAttribute("data-svgCollectAll")==="true"){var g=[];if(typeof f.getSVGFunction==="function"){g=f.getSVGFunction()}else{g=f.querySelectorAll("svg:not(.svgscrape-ignore)")}var i=[];[].forEach.call(g,function(o){if(o.parentNode.tagName.toLowerCase()!=="svg"){var l=o.querySelectorAll("span");if(l.length>0){console.log("many spans found")}[].forEach.call(l,function(t){t.parentNode.removeChild(t);console.log(o.parentNode.innerHTML)});var r=o.outerHTML;if(typeof r==="undefined"){var q=o.parentNode.cloneNode(true);var m=q.children?q.children.length:0;if(m>1){for(var p=m-1;p>-1;p--){var s=q.children[p];var n=s.getAttribute("class");if(s.nodeName!=="svg"||(typeof n.contains==="function"&&n.contains("svgscrape-ignore"))){q.removeChild(s)}}}r=q.innerHTML}i.push({svgText:r,parent:o.parentNode})}});i=this.prepSVGListForServant(i,f);b.sendManySVGsToServant(i,function(m){m=JSON.parse(m);this.scrapeEditorImageContainer.innerHTML="";var n=false;m.forEach(function(p){var o=document.createElement("div");o.classList.add("pagedImageContainer");var r=b.getCompleteURL(p);var q;if(!n){q=this.scrapeEditorImage;n=true}else{q=this.scrapeEditorImage.cloneNode(true)}q.src=r;o.insertBefore(q,null);this.scrapeEditorImageContainer.appendChild(o)}.bind(this));var l=document.createElement("div");l.classList.add("smaAdvise-svgScrapePager");this.leftPager=document.createElement("div");this.leftPager.classList.add("leftPager");this.leftPager.classList.add("disabled");this.leftPager.onclick=function(p){p.cancelBubble=true;if(p.stopPropagation){p.stopPropagation()}if(this.classList.contains("disabled")){return}var o=parseInt(k.scrapeEditorImageContainer.clientWidth,10);k.scrapeEditorImageContainer.scrollLeft-=o;if(k.scrapeEditorImageContainer.scrollLeft<=0){this.classList.add("disabled");k.scrapeEditorImageContainer.scrollLeft=0}if(parseInt(k.scrapeEditorImageContainer.scrollWidth,10)-parseInt(k.scrapeEditorImageContainer.scrollLeft,10)-o>0){k.rightPager.classList.remove("disabled")}};this.rightPager=document.createElement("div");this.rightPager.classList.add("rightPager");if(m.length<2){this.rightPager.classList.add("disabled")}else{this.rightPager.onclick=function(p){p.cancelBubble=true;if(p.stopPropagation){p.stopPropagation()}if(this.classList.contains("disabled")){return}var o=parseInt(k.scrapeEditorImageContainer.children[0].clientWidth,10);if(parseInt(k.scrapeEditorImageContainer.scrollWidth,10)-parseInt(k.scrapeEditorImageContainer.scrollLeft,10)-o<5){this.classList.add("disabled")}k.scrapeEditorImageContainer.scrollLeft+=o;if(k.scrapeEditorImageContainer.scrollLeft>0){k.leftPager.classList.remove("disabled")}}}l.appendChild(this.leftPager);l.appendChild(this.rightPager);this.scrapeEditorImageContainerOuter.appendChild(l);this.buildPreviewPopover(f,i)}.bind(this))}else{var g=f.querySelectorAll("svg");if(g.length===0){return}if(f.getAttribute("data-svgAttemptToCombine")==="true"){g=this.mergeSVGs(g,f)}else{g=g[0].cloneNode(true)}var h=[];var j=g.querySelectorAll("image");[].forEach.call(j,function(m){var l=m.getAttribute("href");if(l.indexOf("base64")!==-1){return}var n=new a(function(p,o){this.convertImageToBase64(l,function(q){if(q.indexOf("data:text/xml")===0){q="data:image/png"+q.slice(13)}m.setAttribute("href",q);if(m.outerHTML&&m.outerHTML.indexOf("xmlns:xlink")===-1){m.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink")}p()})}.bind(this));h.push(n)},this);a.all(h).then(function(){var n=g.outerHTML;if(typeof n==="undefined"){if(XMLSerializer){n=new XMLSerializer().serializeToString(g)}else{try{n=g.parentNode.innerHTML}catch(m){console.log("Error getting SVG from page")}}}var l=this.prepSVGListForServant([{svgText:n,parent:g.parentNode}],f);b.sendManySVGsToServant(l,function(o){o=JSON.parse(o);if(o.length<1){return}var p=o[0];var q=b.getCompleteURL(p);this.scrapeEditorImage.src=q;this.scrapeEditorImageContainer.innerHTML="";this.scrapeEditorImageContainer.insertBefore(this.scrapeEditorImage,null);this.buildPreviewPopover(f,l)}.bind(this))}.bind(this))}},prepContainer:function(f,g,h){f.setAttribute("data-reportable","svg");f.setAttribute("data-svgname",g);var i=h||{};if(typeof i.alternative!=="undefined"){f.setAttribute("data-svgalt",i.alternative)}if(typeof i.combine!=="undefined"&&i.combine===true){f.setAttribute("data-svgAttemptToCombine","true");if(typeof i.combineInstructions!=="undefined"){f.combineInstructions=i.combineInstructions}}if(typeof i.collectAll!=="undefined"&&i.collectAll===true){f.setAttribute("data-svgCollectAll","true")}if(typeof i.svgtype!=="undefined"){f.setAttribute("data-svgType",i.svgtype)}if(typeof i.renderFunction==="function"){f.renderFunction=i.renderFunction}if(typeof i.noComment!=="undefined"){f.noComment=i.noComment}if(typeof i.getSVGFunction==="function"){f.getSVGFunction=i.getSVGFunction}},saveSVGToPage:function(h,j,g,i,m,l){if(typeof this.page[0].svgObjectList==="undefined"){this.page[0].svgObjectList=[]}var k=j.split("&fileKey=")[1];var f=b.prepareImageRefForReporting(k,h,g,i,undefined,m,l);if(f!==null){this.page[0].svgObjectList.push(f)}},getPageSVGList:function(){if(typeof this.page[0].svgObjectList==="undefined"){return null}else{return this.page[0].svgObjectList}},clearStorage:function(){this.page[0].svgObjectList=[]},convertImageToBase64:function(h,g){var f=new XMLHttpRequest();f.onload=function(){var i=new FileReader();i.onloadend=function(){g(i.result)};i.readAsDataURL(f.response)};if(h.indexOf("?")>-1){h+="&"+new Date().getTime()}else{h+="?"+new Date().getTime()}f.open("GET",h);f.responseType="blob";f.send()}};return e});define("DS/SMAAnalyticsUI/SMAAnalyticsArrayPlot",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsDataPlot","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,d,e,a){function c(){this.savedArrayGraphData=["empty"];this.arrayPlotOptions={margin:50,width:850,height:600,plot:{},dropzone:{},paramBox:{},axis:{}};this.arrayPlotOptions.plot.height=450;this.arrayPlotOptions.plot.width=500;this.arrayPlotOptions.plot.x=75;this.arrayPlotOptions.plot.y=100;this.arrayPlotOptions.dropzone.thickness=25;this.arrayPlotOptions.paramBox.width=200;this.arrayPlotOptions.paramBox.height=650;this.arrayPlotOptions.paramBox.header={};this.arrayPlotOptions.paramBox.header.height=50;this.arrayPlotOptions.paramBox.header.text=a.translate("Array List");this.arrayPlotOptions.paramBox.header.width=200;this.arrayPlotOptions.axis.thickness=30;this.arrayPlotOptions.axis.x1={};this.arrayPlotOptions.axis.y1={};this.arrayPlotOptions.hasActions=true;this.arrayPlotOptions.axis.y2={};this.arrayPlotOptions.axis.x2={};this.arrayPlotOptions.axis.x1.orient="bottom";this.arrayPlotOptions.axis.x2.orient="top";this.arrayPlotOptions.axis.y1.orient="left";this.arrayPlotOptions.axis.y2.orient="right";this.arrayPlotOptions.hasTitle=true;this.arrayPlotOptions.hasAxes=true;this.arrayPlotOptions.hasLabels=true;this.arrayPlotOptions.hasLegends=true;this.arrayPlotOptions.hasCanvasRect=true;this.arrayPlotOptions.numTicks=5;this.arrayPlotOptions.plot.stroke=2;this.arrayPlotOptions.paramBox.content={};this.arrayPlotOptions.paramBox.content.margin=20}c.prototype.populateData=function(j){var h={};var k=function(o,q,l){var n=[];var r;if(q.length===1){var i=o+"[:]";h[i]=l;n.push({name:i,children:[]})}else{var p=q[0];q=q.slice(1,q[length-1]);for(var m=0;m<p;m++){n.push({name:o+"["+m+"]",children:k(o+"["+m+"]",q,l[m])})}}r=n;return r};this.arrayNames=[];this.arrayValues={};var g={};for(var f=0;f<j.length;f++){g=k(j[f].param.name,j[f].param.dimensions,j[f].values);this.arrayNames.push({name:j[f].param.name,children:g,unit:j[f].param.unit||""});b.extend(this.arrayValues,h)}};c.prototype.plots=function(j){this.parentDiv=b("#sim-ui-popover-arrayPlotTab");var k=this;this.populateData(j);var i=this.savedArrayGraphData.length;var h=b('<button id="addButton">New Plot</button>').appendTo(this.parentDiv).on("click",function(){i=k.savedArrayGraphData.length+1;k.savedArrayGraphData.push("empty");f(i-1)});h.css({top:50,left:this.arrayPlotOptions.paramBox.width/2-25});var g=function(m){if(m.length===0){m.push("empty")}for(var l=0;l<m.length;l++){f(l)}};var f=function(p){k.arrayPlotOptions.graphID=p;var l=b('<div id="arrayGraphDiv_'+p+'" class="sim-ui-data-plot-graph-div"></div>');var n=k.parentDiv.find(".sim-ui-data-plot-graph-div");if(n.length>0){l.insertBefore(n[0])}else{l.appendTo(k.parentDiv)}l.css({position:"relative","margin-left":k.arrayPlotOptions.paramBox.width});k.newArrayPlot=new e("arrayGraphDiv_"+p,k.arrayPlotOptions,k.savedArrayGraphData,k.arrayValues,k.arrayNames);k.newArrayPlot.addPlot();if(p===0){b('<div id="listDiv" class="sim-ui-data-plot-list-div"></div>').appendTo(k.parentDiv);var o='<li draggable="true"><span class="sim-ui-data-plot-list-handles ui-icon ui-icon-radio-on"></span><a style="cursor:pointer">Indices</a></li>';k.newArrayPlot.makeParamBox("listDiv",k.arrayNames,o);k.newArrayPlot.eventHandler()}else{var m=b('<button id="removeButton_'+p+'" class="remove-button ui-icon ui-icon-close"></button>').appendTo(l).on("click",function(){var q=this.parentElement.id.split("_");k.savedArrayGraphData.splice(parseInt(q[1],10)-1,1);i--;b(".sim-ui-data-plot-graph-div").remove();b(".sim-ui-data-plot-list-div").remove();g(k.savedArrayGraphData)});m.css({top:k.arrayPlotOptions.plot.x+-k.arrayPlotOptions.paramBox.header.height-k.arrayPlotOptions.margin/2,left:k.arrayPlotOptions.plot.width+k.arrayPlotOptions.margin*2})}};d.syncArrayPlots().done(function(){k.savedArrayGraphData=d.arrayPlots;g(k.savedArrayGraphData)})};c.prototype.retrieveSaveData=function(){if(typeof this.newArrayPlot==="undefined"){return this.savedArrayGraphData}else{return this.newArrayPlot.getSaveData()}};c.prototype.createSinglePlot=function(m,i,h,k,f){this.arrayPlotOptions.margin=0;this.arrayPlotOptions.width=h.width;this.arrayPlotOptions.height=h.height;this.arrayPlotOptions.plot.x=typeof h.plot.x!=="undefined"?h.plot.x:25;this.arrayPlotOptions.plot.y=typeof h.plot.y!=="undefined"?h.plot.y:25;this.arrayPlotOptions.plot.stroke=typeof h.plot.stroke!=="undefined"?h.plot.stroke:this.arrayPlotOptions.plot.stroke;this.arrayPlotOptions.plot.width=h.plot.width;this.arrayPlotOptions.plot.height=h.plot.height;this.arrayPlotOptions.hasTitle=false;this.arrayPlotOptions.hasActions=false;this.arrayPlotOptions.hasCanvasRect=false;this.arrayPlotOptions.hasAxes=typeof h.hasAxes==="undefined"?true:h.hasAxes;this.arrayPlotOptions.hasLabels=typeof h.hasLabels==="undefined"?true:h.hasLabels;this.arrayPlotOptions.numTicks=typeof h.numTicks!=="undefined"?h.numTicks:5;this.arrayPlotOptions.graphID=0;this.arrayPlotOptions.dropzone.thickness=0;this.arrayPlotOptions.needScale=h.needScale;if(this.arrayPlotOptions.hasAxes&&this.arrayPlotOptions.hasAxes===false){this.arrayPlotOptions.axis.thickness=this.arrayPlotOptions.axis.thickness}var l=this;var g={},j;d.getRowInfo(k,g).done(function(){j=g.content;var r=j.parmValues;var o=[];var q=d.getAllParametersAsFlatList();for(var p=0;p<q.length;p++){if(r[q[p]]){var s=d.findParameter(q[p]);if(s.structure==="ARRAY"){o.push({param:s,values:r[q[p]]})}}}if(i.title===""||typeof i.title==="undefined"){i.title="Untitled Array Plot"}var n=b('<div id="arrayGraphDiv_'+f+'" class="sim-ui-data-plot-graph-div"></div>').appendTo(m);n.css({width:"100%",position:"relative"});l.populateData(o);l.arrayPlot=new e("arrayGraphDiv_"+f,l.arrayPlotOptions,[i],l.arrayValues,l.arrayNames);l.arrayPlot.makeSVG();l.arrayPlot.makeCanvas();l.arrayPlot.loadData();if(l.arrayPlotOptions.needScale){l.arrayPlot.chart.attr("viewBox","0 0 "+h.width+" "+h.width).attr("preserveAspectRatio","none");n.find(".sim-ui-data-plot").css({width:"90%",height:"90%","font-size":"15pt"})}n.find(".sim-ui-data-plot").css({"margin-top":"0px","margin-left":"0px"});n.find(".sim-ui-data-plot-line-group").unbind()})};return c});define("DS/SMAAnalyticsUI/SMAAnalyticsParameterMap",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsUI/SMAAnalyticsUtils"],function(c,f,g,h,b,d,e){h=JSON.parse(h);function a(){this.raMapDivTop=0;this.plmMapDivTop=0;this.svgDivTop=0;this.svgDivWidth=0}a.prototype.setVarGrpData=function(i){this.raData=i};a.prototype.setPlmParameters=function(i){this.plmData=i};a.prototype.setContainerDiv=function(i){this.container=i};a.prototype.rcHierarchyData=null;a.prototype.anchorID=1;a.prototype.svg=null;a.prototype.relationIdArray=[];a.prototype.reqDrag=false;a.prototype.isTemplateMap=false;a.prototype.templateConnections={};a.prototype.templateParameters=[];a.prototype.parsePlmParameterId=function(i){if(i===undefined||i===null){return""}if(i.indexOf("#")>-1){return i.substring(0,i.lastIndexOf("#"))}else{return i}};a.prototype.addAllParametersToFlatList=function(j,i){if(!j){j=f.varGroup}c(j.parameters).each(function(k,l){i.push(l)});c(j.groups).each(function(k,l){a.prototype.addAllParametersToFlatList(l,i)})};a.prototype.getAllParametersAsFlatList=function(j){if(!j){j=f.varGroup}var i=[];a.prototype.addAllParametersToFlatList(j,i);return i};a.prototype.createContextMenu=function(){var l=function(o){if(a.prototype.isTemplateMap){d3.selectAll(".sim-ui-pm-line").filter(function(){if(o.classed("ra-element")){return(d3.select(this).attr("ra")===o.attr("id"))}else{return(d3.select(this).attr("plm")===o.attr("id"))}}).each(function(){var q=d3.select(this);c("#"+q.attr("ra")+",#"+q.attr("plm")).unbind("contextmenu");d3.select(this).remove()});return}var n,p;if(o.data()[0].plmParameterId!==undefined&&o.data()[0].plmParameterId!==null){n=o;p=d3.select("#sim-ui-pm-"+a.prototype.parsePlmParameterId(o.data()[0].plmParameterId))}else{if(o.data()[0].mappedAnalyticsParameter!==undefined&&o.data()[0].mappedAnalyticsParameter!==null){n=d3.select("#sim-ui-pm-"+o.data()[0].mappedAnalyticsParameter);p=o}}var m="#sim-ui-pm-line-"+a.prototype.parsePlmParameterId(n.data()[0].plmParameterId);f.setPlmParameterId(n.data()[0].ID,"");n.data()[0].plmParameterId="";p.data()[0].mappedAnalyticsParameter="";d3.select(m).remove();c("#"+n.attr("id")+", #"+p.attr("id")).unbind("contextmenu");n.attr("draggable",true)};var k=this,j=null,i=false;if(a.prototype.isTemplateMap){i=true}else{if(k.data()[0].plmParameterId||k.data()[0].mappedAnalyticsParameter){i=true}}if(i){j={title:"",items:[{label:b.translate("Remove mapping"),icon:h.ICON_LOCATION+"iconActionDelete.gif",action:function(){l(k)}}]};c(k[0][0]).unbind("contextmenu");c(k[0][0]).contextPopup(j)}};a.prototype.createContextMenuGroup=function(){var i=function(m){var l=c(m);var k=l.data().relation;if(k===null||k===undefined){return}c.ajax({type:"POST",cache:false,url:"../../resources/slmservices/advise/disconnectRelation",data:{relationshipid:k.trim()}}).done(function(){l.parent().remove();c(".sim-ui-pm-param.ra-element").unbind("contextmenu");c(".sim-ui-pm-param.plm-element").unbind("contextmenu");a.prototype.matchExistingElements(d3.select("#sim-ui-pm-svg"),d3.selectAll(".sim-ui-pm-param.ra-element"),d3.selectAll(".sim-ui-pm-param.plm-element"),false)}).fail(function(){console.log("Remove requirement failed.")})};var j=this;j.each(function(){var l=this;var k={title:"",items:[{label:b.translate("remove_requirement_msg"),icon:h.ICON_LOCATION+"iconActionDelete.gif",action:function(){i(l)}}]};c(this).contextPopup(k)})};a.prototype.createToggleButton=function(k){var j=function(n){var o=d3.select(n.parentNode).select("input"),m=d3.select(n.parentNode.parentNode);if(!o[0][0].checked){m.selectAll("ul, li").classed("sim-ui-pm-hide-element",true);m.selectAll("input").each(function(){if(d3.select(this).attr("id")!==o.attr("id")){this.checked=true}})}else{m.selectAll("ul, li").classed("sim-ui-pm-hide-element",false);m.selectAll("input").each(function(){if(d3.select(this).attr("id")!==o.attr("id")){this.checked=false}})}m.selectAll("li").each(function(){c(this).unbind("contextmenu")});a.prototype.matchExistingElements(d3.select("#sim-ui-pm-svg"),d3.selectAll(".sim-ui-pm-param.ra-element"),d3.selectAll(".sim-ui-pm-param.plm-element"),false)};var i=k.append("span").attr("class","sim-ui-pm-tree-toggle"),l="toggle"+Math.random().toString();i.insert("input").attr("type","checkbox").attr("id",l);i.insert("label").attr("for",l).on("click",function(){j(this)})};a.prototype.addAnchorPoints=function(i,j){var k=(j?"sim-ui-pm-anchor-ra":"sim-ui-pm-anchor-plm")+a.prototype.anchorID.toString();i.insert("span").attr("class",function(){return j?"sim-ui-pm-anchor ra":"sim-ui-pm-anchor plm"}).attr("id",k)};a.prototype.fillParameterDetails=function(j,l){var i=l?"#sim-ui-ra":"#sim-ui-plm",k=j.data()[0];if(k!==undefined&&k!==null){d3.select(i+"-definition-title").text(l?j.data()[0].displayName:j.data()[0].title);d3.select(i+"-definition-unit").attr("value",j.data()[0].unit===undefined?"":j.data()[0].unit);if(l){d3.select(i+"-definition-mode").attr("value",b.translate(j.data()[0].role.toLowerCase()));d3.select(i+"-definition-type").attr("value",b.translate(j.data()[0].dataType.toLowerCase()));d3.selectAll(".sim-ui-pm-param.ra-element").classed("selected-zone",false)}else{d3.selectAll(".sim-ui-pm-param.plm-element").classed("selected-zone",false);d3.select(i+"-definition-type").attr("value",typeof j.data()[0].type==="undefined"?b.translate(j.data()[0].datatype.toLowerCase()):b.translate(j.data()[0].type.toLowerCase()))}j.classed("selected-zone",true)}};a.prototype.validateParamMatch=function(j,m,i,l){var k=false;if(j){if(m){if(m.objective.toLowerCase()==="target"&&i){if(typeof m.parameterValue!=="undefined"&&m.parameterValue!==null&&m.parameterValue.length>0){k=true}else{if(!l){d.alertMessage(d.ERROR,b.translate("INVALID_FORMULATION"))}}}else{k=true}}}return k};a.prototype.importDefinitionFromPLM=function(s,j,m){if(m){if(c("#sim-ui-pm-line-"+a.prototype.parsePlmParameterId(s.data()[0].plmParameterId)).length>0){return false}}if(j.paramdata.physicalId){var t=s.data()[0].ID,u=s.data()[0].dataType.toLowerCase()==="integer"?true:false,n=j.paramdata.type.toLowerCase()==="integer"?true:false,o=this;f.setParameterInfo({ID:t,unit:j.paramdata.unit});if(!isNaN(parseFloat(j.paramdata.maximum))){var l=parseFloat(j.paramdata.maximum);if(u&&!n){l=Math.floor(l)}f.setConstraint(t,"LESS_THAN",l)}else{f.setConstraint(t,"LESS_THAN",s.data()[0].max)}if(!isNaN(parseFloat(j.paramdata.minimum))){var l=parseFloat(j.paramdata.minimum);if(u&&!n){l=Math.ceil(l)}f.setConstraint(t,"GREATER_THAN",l)}else{f.setConstraint(t,"GREATER_THAN",s.data()[0].min)}if(j.paramdata.objective){var q=j.paramdata.objective.toUpperCase(),r="";if(q==="TARGET"){if(!isNaN(parseFloat(j.paramdata.parameterValue))){r=parseFloat(j.paramdata.parameterValue);if(u&&!n){r=Math.round(r)}}}f.setObjective(t,q,r,null)}else{f.setObjective(t,"",0,null)}f.setPlmParameterId(t,j.paramdata.physicalId+"#RA");var p=parseInt(j.paramdata.priority);if(p!==s.data()[0].priority&&p>=0&&p<6){var i=[];i[0]={ID:t,priority:p};f.setPriorityForParameters(i)}var k=d3.select("#sim-ui-pm-"+j.paramdata.physicalId);s.data()[0].plmParameterId=j.paramdata.physicalId+"#RA";k.data()[0].mappedAnalyticsParameter=s.data()[0].ID;s.attr("draggable",null);o.drawConnectorLines(o.svg,s,d3.select("#sim-ui-pm-"+j.paramdata.physicalId));c(s[0][0]).unbind("contextmenu");c(k[0][0]).unbind("contextmenu");s.call(o.createContextMenu);k.call(o.createContextMenu);return true}};a.prototype.getParamObjective=function(i){var j;c(f.formulation.objectives).each(function(l,k){if(k.parameterID===i){j={type:k.type,value:k.value}}});return j||{}};a.prototype.exportDefinitionToPLM=function(m,n){if(m.data()[0].physicalId&&n.paramdata.ID){var q=this,j=[],i,o=f.getConstraintBounds(n.paramdata.ID)||{},p=q.getParamObjective(n.paramdata.ID)||{},l={physicalId:m.data()[0].physicalId||"",name:n.paramdata.name,minimum:o[0]||"",maximum:o[1]||"",unit:n.paramdata.unit||"",objective:p.type||"",parameterValue:p.type==="TARGET"?p.value:""};j.push(l);i={parametersList:j};var k=e.checkExportFormulationPossible(m.data(),j);if(k.length===0){f.spinnerControlShow();f.getCSRFTokenFor3DSpace().done(function(r){c.ajax({type:"POST",cache:false,url:"../../resources/slmservices/advise/exportToPLMParameters",beforeSend:function(s){s.setRequestHeader("ENO_CSRF_TOKEN",r)},data:{parameterData:JSON.stringify(i),oid:f._caseID},success:function(){var s=d3.select("#sim-ui-pm-"+n.paramdata.ID);f.setPlmParameterId(n.paramdata.ID,m.data()[0].physicalId+"#PLM");s.data()[0].plmParameterId=m.data()[0].physicalId+"#PLM";m.data()[0].mappedAnalyticsParameter=s.data()[0].ID;q.drawConnectorLines(q.svg,s,m);s.attr("draggable",null);c(s[0][0],m[0][0]).unbind("contextmenu");s.call(q.createContextMenu);m.call(q.createContextMenu);f.spinnerControlHide();d.alertMessage(d.SUCCESS,b.translate("success_export_requirement"));console.log("success - posting updated parameters")},error:function(s,u,t){f.spinnerControlHide();console.log("Failed to export parameters"+s+"\n\nText Status:\n"+u+"\n\nError Thrown:\n"+t)}})}).fail(function(r){f.spinnerControlHide();console.log("CSRF token retrieval failed",r)})}}};a.prototype.hideVertScrlBar=function(){d3.selectAll(".sim-ui-pm-map").each(function(){var i=this;if(i.offsetWidth>i.scrollWidth){if(a.prototype.isTemplateMap){i.style.left=i.offsetWidth-i.scrollWidth+2+"px"}else{i.style.left=i.offsetWidth-i.scrollWidth+"px"}}})};a.prototype.setHeights=function(){var o=d3.selectAll(".sim-ui-pm-param.ra-element")[0].length,l=d3.selectAll(".sim-ui-pm-param.plm-element")[0].length,j=0,m=50;if(c(".sim-ui-pm-param").size>0){m=c(".sim-ui-pm-param")[0].clientHeight+12}if(o>l){j=(d3.selectAll(".sim-ui-pm-param.ra-element,.sim-ui-pm-group.ra-element")[0].length+1)*m}else{j=(d3.selectAll(".sim-ui-pm-param.plm-element,.sim-ui-pm-group.plm-element")[0].length+1)*m}var p=document.querySelector("#sim-ui-ul-ra"),i=document.querySelector("#sim-ui-ul-plm"),k=p?p.offsetHeight:0,n=i?i.offsetHeight:0;c("#sim-ui-ul-ra, #sim-ui-ul-plm, #sim-ui-pm-svg").height(k>n?k:n)};a.prototype.setScroll=function(){c(".sim-ui-pm-map-wrapper").scroll(function(i){i.stopPropagation();[].forEach.call(this.container[0].querySelectorAll(".sim-ui-pm-map-wrapper:not(#"+i.currentTarget.id+")"),function(j){j.scrollTop=this.currentTarget.scrollTop}.bind(i))}.bind(this))};a.prototype.getMousePosition=function(j){var i=0;var k=0;if(!j){j=window.event}if(j.pageX||j.pageY){i=j.pageX;k=j.pageY}else{if(j.clientX||j.clientY){i=j.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;k=j.clientY+document.body.scrollTop+document.documentElement.scrollTop}}return{x:i,y:k}};a.prototype.addDragNDropBehaviourForParent=function(l){var o=function(q){if(!q){q=window.event}a.prototype.reqDrag=true;console.log("start-req");c(this).parent().children().addClass("selected-zone");q.dataTransfer.effectAllowed="copy";q.dataTransfer.setData("text",JSON.stringify({relid:c(this).data().relation}))};var k=function(q){if(!q){q=window.event}q.preventDefault();console.log("end-req");c(this).parent().children().removeClass("selected-zone");c(".ra-element").removeClass("drop-zone")};var n=function(q){if(!q){q=window.event}q.preventDefault();if(this.classList.contains("ra-element")){c(".ra-element").addClass("drop-zone")}};var i=function(q){if(!q){q=window.event}q.preventDefault();c(".ra-element").removeClass("drop-zone")};var p=function(s){if(!s){s=window.event}var t=a.prototype.getMousePosition(s),r=c("#sim-ui-ra-map-wrapper"),q=c("#sim-ui-ra-map");if(t.y>r.offset().top+r.height()-20){q.animate({scrollTop:q.offset().top+q.height()},"slow")}else{if(t.y<r.offset().top){q.animate({scrollTop:0},"slow")}}if(s.preventDefault){s.preventDefault()}s.dataTransfer.dropEffect="copy"};var j=function(q){if(!q){q=window.event}q.preventDefault();if(f.isFormulationLocked()){d.alertMessage(d.WARN,b.translate("formulation_locked_msg"))}};var m=l;m.addEventListener("dragstart",o,false);m.addEventListener("dragend",k,false);m.addEventListener("dragover",p,false);m.addEventListener("dragenter",n,false);m.addEventListener("dragleave",i,false);m.addEventListener("drop",j,false)};a.prototype.addDragNDropBehaviour=function(k){var n=this;var o=function(r){if(!r){r=window.event}d3.select(this).classed("selected-zone",true);if(this.classList.contains("ra-element")){n.elementType="1"}else{if(this.classList.contains("plm-element")){n.elementType="2"}}r.dataTransfer.effectAllowed="copy";r.dataTransfer.setData("text",JSON.stringify({type:n.elementType,paramdata:d3.select(this).data()[0]}))};var q=function(r){if(!r){r=window.event}r.preventDefault();d3.select(this).classed("drop-zone",false);d3.select(this).classed("selected-zone",false)};var j=function(r){if(!r){r=window.event}r.preventDefault();if(a.prototype.reqDrag){if(this.classList.contains("ra-element")){c(".ra-element").addClass("drop-zone")}return}if((this.classList.contains("ra-element")&&n.elementType==="2")||(this.classList.contains("plm-element")&&n.elementType==="1")){d3.select(this).classed("drop-zone",true)}};var l=function(r){if(!r){r=window.event}r.preventDefault();if(a.prototype.reqDrag){c(".ra-element").removeClass("drop-zone");return}d3.select(this).classed("drop-zone",false)};var i=function(u){var r,t;if(!u){u=window.event}u.preventDefault();if(!a.prototype.isTemplateMap){if(f.isFormulationLocked()){d.alertMessage(d.WARN,b.translate("formulation_locked_msg"));return}}r=d3.select(this);t=JSON.parse(u.dataTransfer.getData("text"));if(a.prototype.isTemplateMap){if(a.prototype.persistTemplateConnections(d3.select(this),d3.select("#sim-ui-pm-"+(t.paramdata.id||t.paramdata.ID)))){if(r.classed("ra-element")){a.prototype.drawConnectorLines(a.prototype.svg,r,d3.select("#sim-ui-pm-"+t.paramdata.id))}else{a.prototype.drawConnectorLines(a.prototype.svg,d3.select("#sim-ui-pm-"+t.paramdata.ID),r)}r.call(n.createContextMenu);d3.select("#sim-ui-pm-"+(t.paramdata.id||t.paramdata.ID)).call(n.createContextMenu)}return}if(a.prototype.reqDrag){a.prototype.reqDrag=false;if(r.classed("ra-element")){c(".ra-element").removeClass("drop-zone");var s=c(".sim-ui-plm-requirement");s.each(function(){if(c(this).data().relation===t.relid){var v=d3.select(c(this).parent()[0]).selectAll(".plm-element");a.prototype.matchExistingElements(d3.select("#sim-ui-pm-svg"),d3.selectAll(".sim-ui-pm-param.ra-element"),v,true)}})}}else{r=d3.select(this);if(r.classed("drop-zone")){t=JSON.parse(u.dataTransfer.getData("text"));r.classed("drop-zone",false);if(r.classed("ra-element")){if(a.prototype.validateParamMatch(r.data()[0],t.paramdata,true)){if(a.prototype.overWriteMap(r,t,true)){a.prototype.importDefinitionFromPLM(r,t)}}}else{if(r.classed("plm-element")){if(a.prototype.validateParamMatch(t.paramdata,r.data()[0],false)){if(a.prototype.overWriteMap(r,t,false)){a.prototype.exportDefinitionToPLM(r,t)}}}}}}};var m=function(t){if(!t){t=window.event}var u=a.prototype.getMousePosition(t),s=c("#sim-ui-ra-map-wrapper"),r=c("#sim-ui-ra-map");if(u.y>s.offset().top+s.height()-20){r.animate({scrollTop:r.offset().top+r.height()},"slow")}else{if(u.y<s.offset().top){r.animate({scrollTop:0},"slow")}}if(t.preventDefault){t.preventDefault()}t.dataTransfer.dropEffect="copy"};var p=k[0][0];p.addEventListener("dragstart",o,false);p.addEventListener("dragend",q,false);p.addEventListener("dragover",m,false);p.addEventListener("dragenter",j,false);p.addEventListener("dragleave",l,false);p.addEventListener("drop",i,false)};a.prototype.overWriteMap=function(n,q,u){var p=null,m="",v=null,w={},j={},k={},r={},l="",x="",y="",i=null;if(u){i=d3.select(".sim-ui-pm-line[ra="+n.attr("id")+"]");if(i[0][0]===null){return true}m=n.data()[0].ID;p=q.paramdata;v=String(n.data()[0].priority);l=n.data()[0].displayName}else{i=d3.select(".sim-ui-pm-line[plm="+n.attr("id")+"]");if(i[0][0]===null){return true}m=q.paramdata.ID;p=n.data()[0];v=String(q.paramdata.priority);l=p.title}var s=f.getObjective(m,true),t=f.getConstraintBounds(m);k[b.translate("Parameter Priority")]=v==="0"?b.translate("Must Have"):v;k[b.translate("Objective")]=s?s.type.toUpperCase():"";k[b.translate("Target Value")]=s!==null&&s.value!==null?String(s.value):"";k[b.translate("Lower Threshold")]=t[0]!==null?String(Number(t[0])):"";k[b.translate("Upper Threshold")]=t[1]!==null?String(Number(t[1])):"";r[b.translate("Parameter Priority")]=p.priority===0?b.translate("Must Have"):String(p.priority);r[b.translate("Objective")]=p.objective?p.objective.toUpperCase():"";r[b.translate("Target Value")]=p.parameterValue?String(p.parameterValue):"";r[b.translate("Lower Threshold")]=p.minimum?String(p.minimum):"";r[b.translate("Upper Threshold")]=p.maximum?String(p.maximum):"";if(u){w=k;j=r}else{w=r;j=k}for(var A in w){if(w.hasOwnProperty(A)){if(typeof w[A]!=="undefined"&&w[A]!==null&&w[A]!=="null"&&w[A].length>0){x+=A+": "+w[A]+"\n"}if(typeof j[A]!=="undefined"&&j[A]!==null&&j[A]!=="null"&&j[A].length>0){y+=A+": "+j[A]+"\n"}}}var z=window.confirm(b.translate("PARAM_MAP_OVERRITE1",l)+"\n"+x+"\n"+b.translate("PARAM_MAP_OVERRITE2")+"\n"+y);if(!z){return false}else{var o=d3.select("#"+i[0][0].getAttribute("ra")).data()[0];o.plmParameterId="";f.setPlmParameterId(o.ID,"");d3.select("#"+i[0][0].getAttribute("plm")).data()[0].mappedAnalyticsParameter="";i.remove();return true}};a.prototype.persistTemplateConnections=function(i,l){var k="",m="";try{if(i.classed("ra-element")&&l.classed("plm-element")){if(i.data()[0].dataType.toUpperCase()!==l.data()[0].datatype.toUpperCase()){d.alertMessage(d.WARN,b.translate("param_datatype_mismatch"));return false}else{k=l.data()[0].id;m=i.data()[0].ID;a.prototype.templateConnections[k]=m;return true}}else{if(i.classed("plm-element")&&l.classed("ra-element")){if(i.data()[0].datatype.toUpperCase()!==l.data()[0].dataType.toUpperCase()){d.alertMessage(d.WARN,b.translate("param_datatype_mismatch"));return false}else{k=i.data()[0].id;m=l.data()[0].ID;a.prototype.templateConnections[k]=m;return true}}else{return false}}}catch(j){console.error("Error validating datatypes of parameters.");return false}};a.prototype.resizeTemplatePO=function(){var i=function(l,r){var m=d3.select(l).select(".sim-ui-pm-anchor.ra"),o=d3.select(r).select(".sim-ui-pm-anchor.plm");var k=0,p,j,n,q=[];p=c("#sim-ui-ul-plm").offset().top-(c(o[0][0]).offset().top+5);n=c("#sim-ui-ul-ra").offset().top-(c(m[0][0]).offset().top+5);j=c(m[0][0]).offset().left-c(a.prototype.svg[0][0]).offset().left;q.push([Math.abs(k),Math.abs(p)]);q.push([Math.abs(k+j/4),Math.abs(p)]);q.push([Math.abs(j-j/4),Math.abs(n)]);q.push([Math.abs(j),Math.abs(n)]);return q};d3.selectAll(".sim-ui-pm-line").each(function(){d3.select(this).datum(i("#"+d3.select(this).attr("ra"),"#"+d3.select(this).attr("plm"))).attr("d",d3.svg.line().interpolate("basis"))})};a.prototype.drawConnectorLines=function(l,q,k){var j=0,p,i,n,r=[],m=q.select(".sim-ui-pm-anchor.ra"),o=k.select(".sim-ui-pm-anchor.plm");p=c("#sim-ui-ul-plm").offset().top-(c(o[0][0]).offset().top+5);n=c("#sim-ui-ul-ra").offset().top-(c(m[0][0]).offset().top+5);i=c(m[0][0]).offset().left-c(a.prototype.svg[0][0]).offset().left;r.push([Math.abs(j),Math.abs(p)]);r.push([Math.abs(j+i/4),Math.abs(p)]);r.push([Math.abs(i-i/4),Math.abs(n)]);r.push([Math.abs(i),Math.abs(n)]);var t=d3.svg.line();t.interpolate("basis");var s=k.attr("id");l.append("path").datum(r).attr("class","sim-ui-pm-line").attr("d",t).attr("id","sim-ui-pm-line-"+s.substr(s.lastIndexOf("-")+1)).attr("ra",q.attr("id")).attr("plm",k.attr("id")).on("mouseover",function(){var u=d3.select(this);u.classed("sim-ui-radial-selectedConnection",true);d3.select("#"+u.attr("ra")).classed("drop-zone",true);d3.select("#"+u.attr("plm")).classed("drop-zone",true)}).on("mouseout",function(){var u=d3.select(this);u.classed("sim-ui-radial-selectedConnection",false);d3.select("#"+u.attr("ra")).classed("drop-zone",false);d3.select("#"+u.attr("plm")).classed("drop-zone",false)})};a.prototype.matchExistingElements=function(j,n,p,m){if(!n||!p){return}var k=this;if(!m){d3.selectAll(".sim-ui-pm-line").remove()}if(a.prototype.isTemplateMap){if(typeof a.prototype.templateConnections!=="undefined"&&a.prototype.templateConnections!==null){for(var o in a.prototype.templateConnections){var l=d3.select("#sim-ui-pm-"+o),i=d3.select("#sim-ui-pm-"+a.prototype.templateConnections[o]);if(!i.classed("sim-ui-pm-hide-element")&&!i.classed("sim-ui-pm-hide-element-search")&&!i.classed("sim-ui-pm-hide-element-mode")&&!i.classed("sim-ui-pm-hide-element-type")&&(!l.classed("sim-ui-pm-hide-element")&&!l.classed("sim-ui-pm-hide-element-search")&&!l.classed("sim-ui-pm-hide-element-mode")&&!l.classed("sim-ui-pm-hide-element-type"))){k.drawConnectorLines(j,i,l)}}}return}n.each(function(w){w.plmParameterId=w.plmParameterId||"";if(w.plmParameterId.length>0&&m){}else{if(w.plmParameterId.length>0||m){var s=d3.select(this);if(s.classed("sim-ui-pm-hide-element")||s.classed("sim-ui-pm-hide-element-search")||s.classed("sim-ui-pm-hide-element-mode")||s.classed("sim-ui-pm-hide-element-type")){return}var r=k.parsePlmParameterId(w.plmParameterId),q=w.ID,t=w.displayName,u=false,v=w;p.each(function(z){if(z.physicalId===r||z.id===r||(m&&z.title===t)){if(a.prototype.validateParamMatch(v,z,true,true)){u=true;if(m){var y={paramdata:z};a.prototype.importDefinitionFromPLM(s,y,m);return}z.mappedAnalyticsParameter=q;var x=d3.select(this);if(!x.classed("sim-ui-pm-hide-element")&&!x.classed("sim-ui-pm-hide-element-search")&&!x.classed("sim-ui-pm-hide-element-mode")&&!x.classed("sim-ui-pm-hide-element-type")){s.call(k.createContextMenu);x.call(k.createContextMenu);k.drawConnectorLines(j,s,x);s.attr("draggable",null)}}}});if(!u){f.setPlmParameterId(q,"");w.plmParameterId=""}}}})};a.prototype.launchResizeEvents=function(i,l){var j=d3.select("#sim-ui-pm-svg"),m=d3.selectAll(".sim-ui-pm-param.plm-element"),k=d3.selectAll(".sim-ui-pm-param.ra-element");a.prototype.raMapDivTop=c("#sim-ui-ra-map").offset().top;a.prototype.plmMapDivTop=c("#sim-ui-plm-map").offset().top;a.prototype.svgDivTop=c("#sim-ui-pm-svg").offset().top;a.prototype.svgDivWidth=c("#sim-ui-pm-svg").width();a.prototype.hideVertScrlBar();if(l){c("#sim-ui-pm-svg-wrapper").css({width:"108%"});c("#sim-ui-pm-svg,#sim-ui-pm-svg-wrapper").css({width:"111%"})}else{c("#sim-ui-pm-svg-wrapper").css({width:"111%"});c("#sim-ui-pm-svg,#sim-ui-pm-svg-wrapper").css({width:"115%"})}a.prototype.setHeights();a.prototype.matchExistingElements(j,k,m,false);return true};a.prototype.createPLMParameterTreeView=function(k,y){if(y===null||y===undefined){return}var t=this;var u=function(D,E,C,A){if(!E){E=[]}if(!A){A=["","array","integer","real"]}var z=D,F=[],B;if(z.parametersList){F=z.parametersList.parameterList||[]}if(F.length>0){for(B=0;B<F.length;B++){E.push(F[B]);if(F[B].type!==undefined&&F[B].type!=="Boolean"&&F[B].type!=="String"&&c.inArray(F[B].type.toLowerCase(),A)===-1){A.push(F[B].type.toLowerCase())}}}if(z.requirementsList){if(z.requirementsList.requirementsList.length>0){for(B=0;B<z.requirementsList.requirementsList.length;B++){u(z.requirementsList.requirementsList[B],E,B)}}}return E};var m=[],s=["","array","integer","real"];if(y.requirementsList){if(y.requirementsList.length>0){for(var r=0;r<y.requirementsList.length;r++){var l=u(y.requirementsList[r],l,r,s),o="";for(var x=0;x<t.relationIdArray.length;x++){if(t.relationIdArray[x].requirement===y.requirementsList[r].id){o=t.relationIdArray[x].relation;break}}m.push({displayName:y.requirementsList[r].title||y.requirementsList[r].name,id:y.requirementsList[r].id,relationshipId:o,children:l});l=[]}}}if(m.length===0){return}var n=k.select("#sim-ui-plm-map").append("ul").attr("id","sim-ui-ul-plm");var v;for(var p=0;p<m.length;p++){v=n.insert("li").attr("class","no-border");t.createToggleButton(v);var q=v.insert("span").text(m[p].displayName).attr("class","sim-ui-pm-group no-border sim-ui-plm-requirement");c(q[0][0]).data("relation",m[p].relationshipId);t.addChildNodesInTreeView(m[p].children,v,false)}if(s!==undefined&&s!==null){d3.select("#sim-ui-plm-details-type").selectAll("option").data(s).enter().append("option").attr("value",function(i){return i}).text(function(i){return i})}t.fillParameterDetails(v.select(".sim-ui-pm-param.plm-element"),false);var w=d3.selectAll(".sim-ui-plm-requirement");c(".sim-ui-plm-requirement").unbind("contextmenu");w.call(this.createContextMenuGroup);w.attr("draggable",true).each(function(){a.prototype.addDragNDropBehaviourForParent(this)});return d3.selectAll(".sim-ui-pm-param.plm-element")};a.prototype.createAnalyticsParameterTreeView=function(l,i){if(i===null||i===undefined){return}var k=this,j=l.select("#sim-ui-ra-map").append("ul").attr("id","sim-ui-ul-ra").append("li").attr("class","no-border");k.createToggleButton(j);j.insert("span").text(i.displayName).attr("class","sim-ui-pm-group no-border");k.addChildNodesInTreeView(i.children,j,true);k.fillParameterDetails(j.select(".sim-ui-pm-param.ra-element"),true);return j.selectAll(".sim-ui-pm-param.ra-element")};a.prototype.addChildNodesInTreeView=function(l,k,m){var j="sim-ui-pm-group no-border "+(m?"ra-element":"plm-element"),i="sim-ui-pm-param "+(m?"ra-element":"plm-element");k.selectAll("li").data(l.filter(function(n){if(n){if(n.structure&&n.structure==="ARRAY"){return false}var o=n.dataType?n.dataType:n.type;if(o&&(o.toLowerCase()==="string"||o.toLowerCase()==="boolean")){return false}}return true})).enter().append("li").attr("draggable",true).each(function(o){var n=d3.select(this);if(o.children!==undefined){n.attr("class",j);n.attr("draggable",null);a.prototype.createToggleButton(n);n.insert("span").text(o.displayName===undefined?o.title:o.displayName);a.prototype.addChildNodesInTreeView(o.children,n.insert("ul"),m)}else{n.text(o.displayName===undefined?o.title:o.displayName).attr("class",i).attr("id","sim-ui-pm-"+(o.physicalId===undefined?typeof o.ID==="undefined"?o.id:o.ID:o.physicalId)).on("click",function(){a.prototype.fillParameterDetails(d3.select(this),m)});a.prototype.addAnchorPoints(n,m);a.prototype.addDragNDropBehaviour(n);n.on("contextmenu",function(){d3.event.preventDefault()})}})};a.prototype.makeDefinitionDiv=function(j,k){var i=j.append("div").attr("class","sim-ui-pm-definition flex-box-column").attr("id",k+"-definition");i.append("h3").attr("id",k+"-definition-title");i.append("div").attr("class","sim-ui-pm-definition-units flex-box-row flex-start").each(function(){var l=d3.select(this);l.append("label").attr("class","sim-ui-pm-definition-label").attr("for",k+"-definition-unit").text(b.translate("Units"));l.append("input").attr("type","text").attr("readonly",true).attr("id",k+"-definition-unit");l.append("label").attr("class","sim-ui-pm-definition-label").attr("for",k+"-definition-mode").text(b.translate("Mode"));l.append("input").attr("type","text").attr("readonly",true).attr("id",k+"-definition-mode");l.append("label").attr("class","sim-ui-pm-definition-label").attr("for",k+"-definition-type").text(b.translate("Type"));l.append("input").attr("type","text").attr("readonly",true).attr("id",k+"-definition-type")})};a.prototype.makeMapDiv=function(j,k){var i=j;if(k!=="sim-ui-ra"){i=j.append("div").attr("class",k+"-hide")}i.append("div").attr("class","sim-ui-pm-map-wrapper").attr("id",k+"-map-wrapper").append("div").attr("class","sim-ui-pm-map").attr("id",k+"-map")};a.prototype.makeDetailsDiv=function(j,k){var i=j.append("div").attr("class","sim-ui-pm-details flex-box-column").attr("id",k+"-details");i.append("h3").attr("id",k+"-details-title").text(function(){return k==="sim-ui-ra"?b.translate("CASE_PARAMS"):a.prototype.isTemplateMap?b.translate("Simulation Template Parameters"):b.translate("Referenced Parameters")});i.append("div").attr("class","sim-ui-pm-details-container flex-box-row flex-start sim-ui-pm-dd-row").each(function(){var l=d3.select(this);l.append("input").attr("type","text").attr("class","sim-ui-pm-details-search").attr("id",k+"-details-name");l.append("label").attr("class","sim-ui-pm-details-label").attr("for",k+"-details-mode").text("Mode");var n=l.append("select").attr("id",k+"-details-mode").selectAll("option").data([{All:b.translate("All")},{Input:b.translate("Input")},{Output:b.translate("Output")},{Unknown:b.translate("Unknown")}]).enter().append("option").attr("value",function(o){return Object.keys(o)[0]}).text(function(o){return o[Object.keys(o)[0]]});n.each(function(o){if(o==="Mode"){d3.select(this).attr("selected","selected").attr("disabled","disabled")}});l.insert("label").attr("class","sim-ui-pm-details-label").attr("for",k+"-details-type").text("Type");var m=l.append("select").attr("id",k+"-details-type").selectAll("option").data([{All:b.translate("All")},{Array:b.translate("Array")},{Integer:b.translate("Integer")},{Real:b.translate("Real")}]).enter().append("option").attr("value",function(o){return Object.keys(o)[0]}).text(function(o){return o[Object.keys(o)[0]]});m.each(function(o){if(o==="Type"){d3.select(this).attr("selected","selected").attr("disabled","disabled")}})})};a.prototype.setUpFilterEvents=function(){d3.selectAll(".sim-ui-pm-details-search").each(function(){var i=d3.select(this);i.on("keyup",function(){var k=d3.select(this),l=k.attr("id").indexOf("-ra-")>-1,m=l?".sim-ui-pm-param.ra-element":".sim-ui-pm-param.plm-element",j=k[0][0].value;if(d3.event.which===27){j="";k[0][0].value=j}else{if(d3.event.which===13){d3.event.preventDefault()}}var n=d3.selectAll(m);n.each(function(p){var o=l?p.displayName:p.title,q=o.toLowerCase().indexOf(j.toLowerCase());if(q<0&&j!=="*"&&j!==""){d3.select(this).classed("sim-ui-pm-hide-element-search",true)}else{d3.select(this).classed("sim-ui-pm-hide-element-search",false)}a.prototype.matchExistingElements(d3.select("#sim-ui-pm-svg"),d3.selectAll(".sim-ui-pm-param.ra-element"),d3.selectAll(".sim-ui-pm-param.plm-element"),false)})})});d3.selectAll(".sim-ui-pm-details-container select").each(function(){var i=d3.select(this);i.on("change",function(){var k=d3.select(this),j=k.attr("id"),l=j.indexOf("-ra-")>-1,n=l?".sim-ui-pm-param.ra-element":".sim-ui-pm-param.plm-element",m=this.value;if(j.indexOf("-details-mode")>-1){if(m.toLowerCase()==="all"){d3.selectAll(n).classed("sim-ui-pm-hide-element-mode",false)}else{d3.selectAll(n).classed("sim-ui-pm-hide-element-mode",false).filter(function(o){if(l){return(o.role.toLowerCase()!==m.toLowerCase())}else{if(a.prototype.isTemplateMap){return(o.ioMode.toLowerCase()!==m.toLowerCase())}return false}}).classed("sim-ui-pm-hide-element-mode",true)}}else{if(j.indexOf("-details-type")>-1){if(m.toLowerCase()==="all"){d3.selectAll(n).classed("sim-ui-pm-hide-element-type",false)}else{d3.selectAll(n).classed("sim-ui-pm-hide-element-type",false).filter(function(o){if(l){if(m.toLowerCase()==="array"){return(o.structure.toLowerCase()!=="array")}else{return(o.dataType.toLowerCase()!==m.toLowerCase())}}else{if(a.prototype.isTemplateMap){return(o.datatype.toLowerCase()!==m.toLowerCase())}return(o.type.toLowerCase()!==m.toLowerCase())}}).classed("sim-ui-pm-hide-element-type",true)}}}a.prototype.matchExistingElements(d3.select("#sim-ui-pm-svg"),d3.selectAll(".sim-ui-pm-param.ra-element"),d3.selectAll(".sim-ui-pm-param.plm-element"),false)})})};a.prototype.buildMapNMatch=function(i,n){var l=this,k=g.makeD3GroupCopy(f.getGroupCopy(i.varGroupCopy));if(k.children.length===0){return}this.raParamHierarchy=k.children;var m=l.createAnalyticsParameterTreeView(n,k),o=l.createPLMParameterTreeView(n,a.prototype.rcHierarchyData),j=d3.select("#sim-ui-pm-svg");d3.selectAll(".sim-ui-pm-tree-toggle input").each(function(){this.checked=false});c("#sim-ui-pm-svg,#sim-ui-pm-svg-wrapper").css({width:"115%"});l.hideVertScrlBar();l.setScroll();l.setHeights();l.matchExistingElements(j,m,o,false)};a.prototype.buildForm=function(k){var j=this;k.append("div").attr("class","sim-ui-pm-container").attr("id","sim-ui-plmcontainer");var i=k.append("div").attr("class","sim-ui-pm-svgcontainer").attr("id","sim-ui-svgcontainer");k.append("div").attr("class","sim-ui-pm-container").attr("id","sim-ui-racontainer");k.selectAll(".sim-ui-pm-container").each(function(){var m=this.id==="sim-ui-racontainer"?"sim-ui-ra":"sim-ui-plm",l=d3.select(this);j.makeDetailsDiv(l,m);j.makeMapDiv(l,m);j.makeDefinitionDiv(l,m)});j.setUpFilterEvents();i.append("div").attr("class","sim-ui-pm-details flex-box-column");i.append("div").attr("class","sim-ui-svg-hide").append("div").attr("class","sim-ui-pm-map-wrapper").attr("id","sim-ui-pm-svg-wrapper").append("div").attr("class","sim-ui-pm-map").attr("id","sim-ui-pm-svgcont").append("svg").attr("class","sim-ui-pm-svg").attr("id","sim-ui-pm-svg");i.append("div").attr("class","sim-ui-pm-definition flex-box-column");a.prototype.raMapDivTop=c("#sim-ui-ra-map").offset().top;a.prototype.plmMapDivTop=c("#sim-ui-plm-map").offset().top;a.prototype.svgDivTop=c("#sim-ui-pm-svg").offset().top;a.prototype.svgDivWidth=c("#sim-ui-pm-svg").width();a.prototype.svg=d3.select("#sim-ui-pm-svg")};a.prototype.processReqServiceOutput=function(k){var l=k.split(";");var j="";var i=function(n){var m=n.split("|");if(m.length<2){return}a.prototype.relationIdArray.push({requirement:m[0],relation:m[1]});j+=m[0]+";"};l.forEach(i);return j};a.prototype.getHierarchyFromRequirementCentral=function(i){var j=c.Deferred();c.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getAllRequirementsForCase",data:{caseid:i}}).done(function(l){j.resolve(l)}).fail(function(){j.resolve()});var k=c.Deferred();j.done(function(l){if(l===null){k.resolve();return}if(l.length<=0){a.prototype.rcHierarchyData=null;k.resolve();return false}var m=a.prototype.processReqServiceOutput(l);c.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getAllParametersForRequirement",data:{requirements:m}}).done(function(n){a.prototype.rcHierarchyData=n;k.resolve(n)}).fail(function(){k.resolve()})});return k};a.prototype.createTemplateParameterTree=function(l,i){var j=this;if(i===null||i===undefined){return}var k=l.select("#sim-ui-plm-map").append("ul").attr("id","sim-ui-ul-plm").append("li").attr("class","no-border");j.createToggleButton(k);k.insert("span").text(i.title).attr("class","sim-ui-pm-group no-border");j.addChildNodesInTreeView(i.children,k,false);j.fillParameterDetails(k.select(".sim-ui-pm-param.plm-element"),false);return k.selectAll(".sim-ui-pm-param.plm-element")};a.prototype.getParameterCopy=function(k){var j={};for(var i in k){j[i]=k[i]}return j};a.prototype.getTemplateCopy=function(l){var n={},m=this;n.activities=[];n.parameters=[];for(var k in l){if(k!=="activities"&&k!=="parameters"){n[k]=l[k]}}var j=0;if(typeof l.parameters!=="undefined"){for(j=0;j<l.parameters.length;j++){n.parameters.push(m.getParameterCopy(l.parameters[j]))}}if(typeof l.activities!=="undefined"){for(j=0;j<l.activities.length;j++){n.activities.push(m.getTemplateCopy(l.activities[j]))}}return n};(a.prototype.makeTemplateD3ParameterCopy=function(l,j){var k={parentID:j};for(var i in l){k[i]=l[i]}return k}),(a.prototype.makeTemplateD3Copy=function(j,o){var n={},m=this;n.children=[];n.actIDs=[];n.paramIDs=[];n.parentID=typeof o!=="undefined"?o:undefined;for(var l in j){if(l!=="activities"&&l!=="parameters"){n[l]=j[l]}}var k=0;if(typeof j.parameters!=="undefined"){for(k=0;k<j.parameters.length;k++){n.children.push(m.makeTemplateD3ParameterCopy(j.parameters[k],j.id));n.paramIDs.push(j.parameters[k].id);a.prototype.templateParameters.push(j.parameters[k].id)}}if(typeof j.activities!=="undefined"){for(k=0;k<j.activities.length;k++){n.children.push(m.makeTemplateD3Copy(j.activities[k],j.ID));n.actIDs.push(j.activities[k].id)}}return n});a.prototype.buildTemplateMapNMatch=function(l,o){var m=this,k=g.makeD3GroupCopy(f.getGroupCopy(f.varGroup)),p=m.makeTemplateD3Copy(m.getTemplateCopy(l));if(k.children.length===0){return}m.raParamHierarchy=k.children;var n=m.createAnalyticsParameterTreeView(o,k),j=m.createTemplateParameterTree(o,p),i=d3.select("#sim-ui-pm-svg");d3.selectAll(".sim-ui-pm-tree-toggle input").each(function(){this.checked=false});c("#sim-ui-pm-svg,#sim-ui-pm-svg-wrapper").css({width:"115%"});m.hideVertScrlBar();m.setScroll();m.setHeights()};a.prototype.createMapForMatchingTemplates=function(j){var k=this,i=f.varGroup;f.spinnerControlShow();a.prototype.templateConnections={};a.prototype.templateParameters=[];var l=d3.select(this.container[0]).append("div").attr("class","sim-ui-pm-parent flex-box-row").attr("id","sim-pm-parent");a.prototype.isTemplateMap=true;k.buildForm(l);k.buildTemplateMapNMatch(j,l);return l[0]};a.prototype.makeParameterMap=function(k,j){var m=this;f.spinnerControlShow();var n=null;if(j){n=d3.select(".sim-ui-pm-parent")}else{n=d3.select(this.container[0]).append("div").attr("class","sim-ui-pm-parent flex-box-row").attr("id","sim-pm-parent")}var i=this.raData;a.prototype.relationIdArray=[];a.prototype.isTemplateMap=false;var l=m.getHierarchyFromRequirementCentral(k);l.done(function(){if(!j){m.buildForm(n)}m.buildMapNMatch(i,n);f.spinnerControlHide();return n[0]})};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsFileUpload",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,d,c,a){function e(){}e.prototype={_uploadParent:null,_designID:"",_isDragNDrop:false,_files:null,_thisParameterId:null,_successCallBack:null,setUploadWrapperElement:function(f){e.prototype._uploadParent=f},setDesignToAssociateFileWith:function(f){e.prototype._designID=f},setIfAllowDragDrop:function(f){e.prototype._isDragNDrop=f},setSelectedFileParameterId:function(f){e.prototype._thisParameterId=f},setSuccessCallBack:function(f){if(f&&f instanceof Function){e.prototype._successCallBack=f}},submitUploadForm:function(i,f,g,h,k){var j=new FormData();if(!k){k=b.Deferred()}if(typeof h.length==="undefined"||h.length===null){j.append("file",h)}else{b.each(h,function(l,m){j.append("file",m)})}d.uploadFiles(j,g,f,i).done(function(){if(e.prototype._successCallBack){e.prototype._successCallBack({parent:e.prototype._uploadParent,rowId:e.prototype._designID,parameterId:e.prototype._thisParameterId})}k.resolve()});return k},closePopoverMimic:function(){b("#sim-ui-parameter-chooser").remove();b(".sim-ui-popover-rootDiv").removeClass("sim-ui-popover-hidden")},fileParameterChooser:function(l,t){var f=b(".sim-ui-popover-rootDiv"),q=false;q=l[e.prototype._designID].some(function(u){if(u.url===null||u.url===""){return true}});if(!q){return null}if(f.length>0){f.addClass("sim-ui-popover-hidden")}var j=b('<div class="sim-ui-popover-rootDiv" id="sim-ui-parameter-chooser">').appendTo(document.body),r=b(window).height(),k=b(window).width();var o=b('<div class="sim-ui-popover-mainDiv">').appendTo(j),p=b('<div class="sim-ui-popover-headerDiv">').appendTo(o),i=b('<div class="sim-ui-popover-contentDiv" id="sim-ui-parameter-chooser-content">').appendTo(o),n=b('<div class="sim-ui-popover-footerDiv">').appendTo(o);var m=l[e.prototype._designID].splice(0);m.push({displayName:a.translate("add_new_file_param"),id:"",isImage:false,name:"",thumbnail:"",type:"",url:""});var h=d3.select(i[0]).selectAll("span").data(m.filter(function(u){return u.url===""})).enter().append("span").attr("id","sim-ui-popovermimic-content");h.append("input").attr({type:"radio","class":"sim-ui-popovermimic-radio",name:"sim-ui-fileparams",value:function(v,u){return u}}).property("checked",function(v,u){return u===0});h.append("label").attr("class","sim-ui-popovermimic-radio-label").text(function(u){return decodeURIComponent(u.displayName)});var s=b('<button style="margin:4px;">OK</button>');n.append(s);b('<h3 class="sim-ui-popovermimic-title">').text(a.translate("choose_file_param_val",t)).appendTo(p);o.css("width",350);o.css("height",350);o.css({left:k/2-o.width()/2+"px",top:r/2-o.height()/2+"px"});i.css("bottom",n.height()+"px");b('<div class="sim-ui-popover-backDiv">').appendTo(j).bind("click",function(){e.prototype.closePopoverMimic()});o.draggable({scroll:false,handle:".sim-ui-popover-headerDiv",containment:"parent"});var g=b('<div class="ui-icon ui-icon-closethick" style="cursor:pointer; position:absolute; top: 5px; right:5px;"></div>').appendTo(p);g.bind("click",function(){e.prototype.closePopoverMimic();c.alertMessage(c.WARN,a.translate("FILE_UPLOAD_CANCELLED"))});return s},secure:function(g){var f=new RegExp(/(\.|\/)(bat|exe|cmd|sh|php|pl|cgi|386|dll|com|torrent|js|app|jar|pif|vb|vbscript|wsf|asp|cer|csr|jsp|drv|sys|ade|adp|bas|chm|cpl|crt|csh|fxp|hlp|hta|inf|ins|isp|jse|htaccess|htpasswd|ksh|lnk|mdb|mde|mdt|mdw|msc|msi|msp|mst|ops|pcd|prg|reg|scr|sct|shb|shs|url|vbe|vbs|wsc|wsf|wsh)$/i);if(f.test(g.name)){return false}return true},preprocessAndUpload:function(m,k,i){var j=null,l=null,h=null,g=false;if(typeof k==="undefined"||k===null){k=m.target.files}if(typeof i==="undefined"||i===null){i=0}if(i>k.length){return}if(!e.prototype.secure(k[i])){i++;c.alertMessage(c.ERROR,a.translate("unsupported_file_msg"));return}var f={};d.getFilesForRowIDList(e.prototype._designID,f).done(function(p,r,o){var n=b.Deferred();j=f.content;if(j[e.prototype._designID].length>0){var q=e.prototype.fileParameterChooser(j,k[i].name);if(typeof q!=="undefined"&&q!==null){q.on("click",function(){l=document.querySelector('input[name="sim-ui-fileparams"]:checked').__data__.id;e.prototype.closePopoverMimic();g=e.prototype.submitUploadForm(l,h,e.prototype._designID,k[i],n)})}else{g=e.prototype.submitUploadForm(l,h,e.prototype._designID,k[i],n)}}else{g=e.prototype.submitUploadForm(l,h,e.prototype._designID,k[i],n)}n.done(function(){i++;if(i<k.length){e.prototype.preprocessAndUpload(m,k,i)}})}).fail(function(){c.alertMessage(c.ERROR,a.translate("error_uploading_file_msg"));j=null});return true},getUploadForm:function(){var g=b("#sim-ui-popover-fileuploadform"),f=null;if(g.length===0){g=b('<form id="sim-ui-popover-fileuploadform" action="javascript:;" name="uploadform" method="post" enctype="multipart/form-data"></form>');f=b('<input type="file" id="sim-ui-popover-fileupload" name="files"/>').appendTo(g)}else{f=g.find('input[type="file"]');if(f.length>0){f.wrap("<form>").parent("form").trigger("reset");f.unwrap()}else{f=b('<input type="file" id="sim-ui-popover-fileupload" multiple="multiple" name="files"/>').appendTo(g)}}e.prototype._uploadParent[0].addEventListener("click",function(){});g.on("submit",function(h){e.prototype.submitUploadForm(h)});g.appendTo(b(e.prototype._uploadParent));return f},fileDragEnter:function(f){if(!f){f=window.event}f.preventDefault();if(this.tagName==="DATA-HEAD"){b(this).addClass("sim-compare-header-hover")}else{if(b(this).find(".sim-compare-dropbox").length>0){b(this).addClass("sim-compare-dropbox-hover")}}},fileDragLeave:function(f){if(!f){f=window.event}f.preventDefault();if(this.tagName==="DATA-HEAD"){b(this).removeClass("sim-compare-header-hover")}else{if(b(this).find(".sim-compare-dropbox").length>0){b(this).removeClass("sim-compare-dropbox-hover")}}},fileDragHover:function(f){if(!f){f=window.event}f.stopPropagation();f.preventDefault()},fileDropHandler:function(h){if(!h){h=window.event}h.stopPropagation();h.preventDefault();if(typeof this.dataObj==="undefined"||this.dataObj==="null"){return}var f=h.target.files||h.dataTransfer.files,g=this.tagName==="DATA-HEAD";if(typeof f==="undefined"||f===null){return}if(f.length===0){return}e.prototype._designID=this.dataObj.dataId;if(!g){b(this).removeClass("sim-compare-dropbox-hover");if(b(this).find(".sim-compare-dropbox").length<=0){c.alertMessage(c.ERROR,a.translate("files_must_dropped_empty_msg"));return}if(f.length===1){if(!e.prototype.secure(f[0])){c.alertMessage(c.ERROR,a.translate("unsupported_file_msg"));return}e.prototype.submitUploadForm(this.parentNode.hLink.rawJSON.id,"",this.dataObj.dataId,f);this.dataset.nofile=false;return}}else{b(this).removeClass("sim-compare-header-hover")}e.prototype.preprocessAndUpload(h,f,0)},uploadFiles:function(){if(!e.prototype._uploadParent||!e.prototype._designID){return}var f=e.prototype.getUploadForm();f.change(function(g){if(e.prototype.preprocessAndUpload(g)){return true}else{return false}})},uploadFilesWithDragDrop:function(){e.prototype._uploadParent.addEventListener("dragenter",e.prototype.fileDragEnter,false);e.prototype._uploadParent.addEventListener("dragleave",e.prototype.fileDragLeave,false);e.prototype._uploadParent.addEventListener("dragover",e.prototype.fileDragHover,false);e.prototype._uploadParent.addEventListener("drop",e.prototype.fileDropHandler,false)}};return e});define("DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsCell",["UWA/Core","DS/Controls/TileView","DS/Layouts/GridEngineCellAbstract","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsModel"],function(g,c,e,a,b,d){var f=e.extend({defaultOptions:{},init:function(h){h=h||{};this._CtxMenuByRightClick=false;this._parent(h);this.elements.container.dsView=this;this._view=this._getParamStatsContainer(h).inject(this.elements.container)},_getParamStatsContainer:function(){this.elements.statscontainer=new g.Element("div",{"class":"ra-param-stats-cell sim-ui-stat-parameterDiv"});this.elements.titleDiv=new g.Element("div",{"class":"sim-ui-stat-parameterTitle"});this.elements.titleSpan=new g.Element("span").inject(this.elements.titleDiv);this.elements.arraySelect=new g.Element("span").inject(this.elements.titleDiv);this.elements.titleDiv.inject(this.elements.statscontainer);this.elements.imgDiv=new g.Element("div",{"class":"sim-ui-stat-imgDiv"}).inject(this.elements.statscontainer);return this.elements.statscontainer},_getQuantileTable:function(h){if(!this.elements.quantileTable){var m=new g.Element("div",{"class":"sim-ui-stat-parameterTable-borderDiv"});this.elements.quantileTable=new g.Element("table",{"class":"sim-ui-stat-parameterTable"}).inject(m);m.inject(this.elements.statscontainer)}else{this.elements.quantileTable.empty()}var l,k;l=new g.Element("tr").inject(this.elements.quantileTable);k=new g.Element("th").inject(l);k.setAttribute("colspan","3");k.setText(a.translate("Quantiles"));if(h){for(var i=0;i<h.percentiles.length;i++){l=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.quantileTable);k=new g.Element("td").inject(l);k.setText(h.percentiles[i]);k=new g.Element("td").inject(l);this._setupFormatting(k,h.quantiles[i]);k=new g.Element("td").inject(l);k.setText(h.percentileNames[i])}}},_getUncertaintyTable:function(h){if(!this.elements.uncertaintyTable){var j=new g.Element("div",{"class":"sim-ui-stat-parameterTable-borderDiv"});this.elements.uncertaintyTable=new g.Element("table",{"class":"sim-ui-stat-parameterTable"}).inject(j);j.inject(this.elements.statscontainer)}else{this.elements.uncertaintyTable.empty()}var k,i;k=new g.Element("tr").inject(this.elements.uncertaintyTable);i=new g.Element("th").inject(k);i.setAttribute("colspan","2");i.setText(a.translate("Uncertainty"));k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.uncertaintyTable);i=new g.Element("td").inject(k);i.setText(a.translate("Distribution"));i=new g.Element("td").inject(k);i.setText(a.translate(h.distributionType));k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.uncertaintyTable);i=new g.Element("td").inject(k);i.setText(a.translate("Mean"));i=new g.Element("td").inject(k);this._setupFormatting(i,h.distributionMean);k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.uncertaintyTable);i=new g.Element("td").inject(k);i.setText(a.translate("Variance"));i=new g.Element("td").inject(k);this._setupFormatting(i,h.distributionVariance)},_getMomentsTable:function(i){if(!this.elements.momentsTable){var h=new g.Element("div",{"class":"sim-ui-stat-parameterTable-borderDiv"});this.elements.momentsTable=new g.Element("table",{"class":"sim-ui-stat-parameterTable"}).inject(h);h.inject(this.elements.statscontainer)}else{this.elements.momentsTable.empty()}var k,j;k=new g.Element("tr").inject(this.elements.momentsTable);j=new g.Element("th").inject(k);j.setAttribute("colspan","2");j.setText(a.translate("Moments"));k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.momentsTable);j=new g.Element("td").inject(k);j.setText(a.translate("Sum"));j=new g.Element("td").inject(k);this._setupFormatting(j,i.sum);k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.momentsTable);j=new g.Element("td").inject(k);j.setText(a.translate("Mean"));j=new g.Element("td").inject(k);this._setupFormatting(j,i.mean);k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.momentsTable);j=new g.Element("td").inject(k);j.setText(a.translate("Variance"));j=new g.Element("td").inject(k);this._setupFormatting(j,i.variance);k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.momentsTable);j=new g.Element("td").inject(k);j.setText(a.translate("Standard Deviation"));j=new g.Element("td").inject(k);this._setupFormatting(j,i.stdDev);k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.momentsTable);j=new g.Element("td").inject(k);j.setText(a.translate("Skewness"));j=new g.Element("td").inject(k);this._setupFormatting(j,i.skewness);k=new g.Element("tr",{"class":"ra-param-stats-row"}).inject(this.elements.momentsTable);j=new g.Element("td").inject(k);j.setText(a.translate("Kurtosis"));j=new g.Element("td").inject(k);this._setupFormatting(j,i.kurtosis)},getCellInfos:function(){var h=this._parent();var i=this.getVirtualCoordinates();h.nodeModel=this.getGridEngine().getCellModel(i.virtualRowID,i.virtualColumnID);return h},setTitle:function(o,h){if(this.elements.titleSpan){this.elements.titleSpan.textContent=o}this.elements.arraySelect.empty();if(h.structure==="ARRAY"){this.elements.arraySelect.style.display="";for(var m=0;m<h.dimensions.length;m++){var l=new g.Element("select");for(var k=0;k<h.dimensions[m];k++){var n=new g.Element("option");n.setText(k);n.setAttribute("value",k);if(h.currentIndex[m]===k){n.setAttribute("selected","selected")}n.inject(l)}l.inject(this.elements.arraySelect);l.addEventListener("change",this._arraySelectionChanged.bind(this))}}else{this.elements.arraySelect.style.display="none"}},_arraySelectionChanged:function(){var i=this.elements.arraySelect.querySelectorAll("select"),h=this.getCellInfos(),k=h.nodeModel,j=[];[].forEach.call(i,function(l){j.push(+l.options[l.selectedIndex].value)},this);d.prototype.setSelectedArray(k,j);console.log(d)},setDataType:function(){},setStructure:function(h,i){if(h==="ARRAY"&&i instanceof Array){}else{}},setTableData:function(h){if(h.dataType==="INTEGER"||h.dataType==="REAL"){this._getQuantileTable(h);this._getMomentsTable(h);if(h.distributionType){this._getUncertaintyTable(h)}}else{if(h.dataType==="STRING"){if(this.elements.quantileTable){this.elements.quantileTable.getParent().remove();this.elements.quantileTable.remove();delete this.elements.quantileTable}if(this.elements.momentsTable){this.elements.momentsTable.getParent().remove();this.elements.momentsTable.remove();delete this.elements.momentsTable}}}},_setupFormatting:function(l,n,i){if(typeof i==="undefined"){i=3}var h=parseFloat(n),k=h.toPrecision(i).toString();try{if(k.length<n.toString().length){var j=new g.Element("div",{"class":"ra-param-stats-unformatted"}).inject(l);j.setText(n);var m=new g.Element("div",{"class":"ra-param-stats-formatted"}).inject(l);m.setText(k)}else{l.setText(n)}}catch(o){l.setText(n)}},setupChart:function(h){this.elements.imgDiv.empty();this.elements.imgDiv.style.height="";if(h.dataType==="STRING"){this._setupStringChart(h)}else{if(h.dataType==="INTEGER"||h.dataType==="REAL"){this._setupNumericChart(h)}}},_drawStringChart:function(m,j,N,n,z){var s=this;if(typeof j==="undefined"){j=0}if(typeof N==="undefined"){N=0}if(!n&&this.elements&&this.elements.imgDiv){n=this.elements.imgDiv}if(typeof z!=="boolean"){z=false}var A=[];for(var F=0;F<m.stringSortedByFreqs.length;F++){A.push({words:m.stringSortedByFreqs[F],freqs:m.stringFreqsDominated[F]+m.stringFreqsPareto[F]+m.stringFreqsInfeasible[F]+m.stringFreqsExcluded[F]})}var r=26;var J=r>A.length?A.length:r;var C=10;var o=0;if(A.length<r){C=r*(C+5)/J-5}else{C=10}var h=0;var y;for(var F=0;F<A.length;F++){o=o+A[F].freqs;if(A[F].words===""){y=7}else{y=A[F].words.length}h=h<y?y:h}h=h>15?15:h;var D=15;var t=460;var H=A[0].freqs;var M=[];var k=30;for(F=j;F<(j+r*2>A.length?A.length:j+r*2);F++){M.push(A[F])}var G=d3.behavior.drag().on("drag",function(i){i.x+=d3.event.dx;i.y+=d3.event.dy;d3.select(this).attr("transform",function(O){if(O.y>=0){if(O.startNum>0){s._drawStringChart(m,O.startNum-r>0?O.startNum-r:0,-1*O.dragHeight)}if(O.startNum===0){w.style.visibility="hidden"}return"translate("+[0,0]+")"}if(O.y<=-1*O.dragHeight){if(O.startNum>=0&&O.startNum+J*2<=A.length){s._drawStringChart(m,O.startNum+r,0);return"translate("+[0,-1*O.dragHeight]+")"}else{B.style.visibility="hidden";return"translate("+[0,-1*q]+")"}}else{w.style.visibility="visible";B.style.visibility="visible";return"translate("+[0,O.y]+")"}})});var q=(20+(C+5)*M.length-t+k*2&&A.length>J)>0?20+(C+5)*M.length-t+k*2:0;var w,B;if(!z){w=n.getElement(".sim-ui-stat-up-arrow");if(w){w.remove()}w=g.createElement("span",{"class":"sim-ui-stat-up-arrow  ui-icon ui-icon-triangle-1-n"});w.addEvent("click",function(){w.style.visibility="visible";s._drawStringChart(m,j-r*5<0?0:j-r*5,0)});n.appendChild(w);if(j>0||N<0){w.style.visibility="visible"}else{w.style.visibility="hidden"}}var I;I=n.getElement(".sim-ui-param-stats-freq-chart");if(I){I.remove()}I=d3.select(n).append("svg").attr("id","all").attr("class","sim-ui-param-stats-freq-chart").call(G);I.selectAll("rect").remove();I.selectAll("g").remove();function L(i){v.attr("class","sim-ui-stat-bar-deselect");x.text(a.translate("Samples",String(": "+i.freqs)));l.text(a.translate("Value",String(": "+i.words)));d3.select(this).attr("class","sim-ui-stat-bar-select")}function E(){x.text(a.translate("Samples",String(": "+o)));l.text(a.translate("Value",":"));v.attr("class","sim-ui-stat-bar")}var K=I.append("g").data([{x:0,y:N,dragHeight:q,startNum:j,freqInfo:A}]).attr("transform","translate(0,"+N+")").call(G);K.append("rect").attr("width","100%").attr("height",2*t).attr("x",0).attr("y",D).style("fill-opacity",0).style("stroke","none");var p=K.selectAll(".sim-ui-stat-freqs-bars").data(M).enter().append("g");var v=p.append("rect").attr("x",function(){return 10+h*3+"%"}).attr("y",function(P,O){return 5+(C+5)*O}).attr("width",function(i){return(85-h*3-(H-i.freqs)*(85-h*3)/H+"%")}).attr("height",function(){return C}).attr("class","sim-ui-stat-bar").on("mouseover",L).on("mouseout",E);p.append("line").attr("x1",function(){return 9+h*3+"%"}).attr("x2",function(){return 9+h*3+"%"}).attr("y1",function(P,O){return 2.5+(C+5)*O}).attr("y2",function(P,O){return 7.5+(C+5)*O+C});p.append("line").attr("x1",function(){return 7+h*3+"%"}).attr("x2",function(){return 9+h*3+"%"}).attr("y1",function(P,O){return 2.5+(C+5)*O}).attr("y2",function(P,O){return 2.5+(C+5)*O});p.append("line").attr("x1",function(){return 7+h*3+"%"}).attr("x2",function(){return 9+h*3+"%"}).attr("y1",function(P,O){return 7.5+(C+5)*O+C}).attr("y2",function(P,O){return 7.5+(C+5)*O+C});p.append("text").attr("x",function(i){if(i.words.length<15){if(i.words===""){return 5+h*3-7*3+"%"}else{return(5+h*3-i.words.length*3+"%")}}else{return 8+h*3-15*3+"%"}}).attr("y",function(P,O){return 10+C/2+(C+5)*O}).text(function(i){if(i.words.length<15){if(i.words===""){return"<empty>"}else{return i.words}}else{return i.words.substring(0,12)+"..."}});p.append("title").text(function(i){return i.words});if(!z){B=n.getElement(".sim-ui-stat-down-arrow");if(B){B.remove()}B=g.createElement("span",{"class":"sim-ui-stat-down-arrow ui-icon ui-icon-triangle-1-s"});B.addEvent("click",function(){w.style.visibility="visible";if(j+r*5>A.length-r-1){s._drawStringChart(m,A.length-2*(r-1)>0?A.length-2*(r-1):0,-1*q+30)}else{s._drawStringChart(m,j+r*5,0)}});var u=n.getElement(".sim-ui-stat-footer");if(u){u.remove()}u=d3.select(n).append("svg").attr("id","all").attr("class","sim-ui-stat-footer svgscrape-ignore").attr("width","94%").attr("height",k).attr("x",0).attr("y",t-k).style("position","absolute").style("top","92%").style("left","3%");u.append("rect").attr("width","100%").attr("height",k);var l=u.append("text").attr("class","sim-ui-stat-text").text(function(){return a.translate("Value",":")}).attr("x",5).attr("y",k/2-3);var x=u.append("text").attr("class","sim-ui-stat-text").text(function(){return a.translate("Samples",": "+o)}).attr("x",5).attr("y",k/2+10);if(j+r>A.length){B.style.visibility="hidden"}n.appendChild(B);if(j===A.length-J-1||A.length<r||(A.length<r*2&&N===-1*q)){B.style.visibility="hidden"}else{B.style.visibility="visible"}}return I},_setupStringChart:function(i){var h=15;var k=d3.select(this.elements.imgDiv).append("svg").attr("height",h).attr("width","100%").attr("class","svgscrape-ignore");var j=k.append("g").attr("class","sim-ui-stat-header");j.append("rect").attr("width","100%").attr("height",h);j.append("text").text("Frequency Chart").attr("y",12).attr("text-anchor","middle").attr("x","50%");this.elements.imgDiv.style.height="460px";this._drawStringChart(i)},_setupNumericChart:function(p,r){var D=p.histogramValues,B=p.min,H=p.max,L=200-1,q=300;if(this.options&&this.options.width){L=this.options.width-10}if(!r&&this.elements&&this.elements.imgDiv){r=this.elements.imgDiv}var O=D,A=0;for(var I=0;I<D.length;I++){A+=D[I]}var M=30,u=M+1,j=M,E=15,s=E+5,k=27,v=5,h=5,o=L-u-h,K=q-s-v-k;d3.select(r).selectAll(".sim-ui-out-histogram").remove();var w=d3.select(r).append("svg").attr("class","sim-ui-out-histogram").attr("width",L).attr("height",q);var y=w.append("svg").attr("class","sim-ui-stat-footer").attr("width",L).attr("height",k).attr("x",0).attr("y",q-k);y.append("rect").attr("width",L).attr("height",k);var G=w.append("svg").attr("class","sim-ui-stat-header");G.append("rect").attr("width",L).attr("height",E);G.append("text").text("Quantile Histogram").attr("y",12).attr("text-anchor","middle").attr("x",L/2);var m=d3.scale.linear().domain([0,d3.max(O)]).range([0,o]);var l=d3.scale.linear().domain([B,H]).range([K,0]);var C=d3.format("s");var J=d3.svg.axis().scale(l).orient("left").tickFormat(C);function N(P,n){x.attr("class","sim-ui-stat-bar-deselect");d3.select(this).attr("class","sim-ui-stat-bar-select");t.text(a.translate("Range",String(": "+b.formatExp(n*(H-B)/O.length+B)+" - "+b.formatExp((n+1)*(H-B)/O.length+B))));z.text(a.translate("Samples",String(": "+P)))}function F(){t.text(a.translate("Range",String(": "+b.formatExp(B)+" - "+b.formatExp(H))));z.text(a.translate("Samples",String(": "+A)));x.attr("class","sim-ui-stat-bar")}var x=w.selectAll("rect.sim-ui-stat-bar").data(D).enter().append("rect").attr("class","sim-ui-stat-bar").attr("x",u).attr("y",function(P,n){return(l(n*(H-B)/O.length+B)+s-K/O.length)}).attr("width",function(i){return m(i)}).attr("height",K/O.length).on("mouseover",N).on("mouseout",F);w.append("g").attr("class","sim-ui-stat-axis").attr("width",30).attr("transform","translate("+j+","+s+")").call(J);var t=y.append("text").attr("class","sim-ui-stat-text").text(a.translate("Range",String(": "+b.formatExp(B)+" - "+b.formatExp(H)))).attr("x",5).attr("y",12);var z=y.append("text").attr("class","sim-ui-stat-text").text(a.translate("Samples",String(": "+A))).attr("x",5).attr("y",24);return w},setSubtitle:function(){},setPicture:function(){},setColor:function(){},setDescription:function(){},setIcon:function(){},activate:function(){},highlight:function(){},unhighlight:function(){}});return f});define("DS/SMAAnalyticsUI/SMAAnalyticsParamDefinitionEditor",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(c,e,d,b){function a(){}a.prototype.setPopoverData=function(f){this.popoverData=f};a.prototype.setParentContainerDiv=function(f){this.parentContainerDiv=f};a.prototype.persistImmediately=function(f){this.ifPersistImmediately=f};a.prototype.makeParamDefinitionEditor=function(){var k=this.parentContainerDiv,h=this.popoverData;k.children().remove();var l=c('<div id="sim-ui-paramEdit-container">').appendTo(k);var f=c('<div class="sim-ui-paramEdit-filterDiv">').appendTo(l);var i=c('<input class="sim-ui-pm-details-search sim-ui-paramEdit-filterInput">').attr("placeholder",b.translate("Filter Parameters")).appendTo(f);i.on("keyup",function(m){var n=d.searchInputFormatter(c(this),m);if(n.length===0){c(".sim-ui-paramEditor-titleDiv").parent().show()}else{c(".sim-ui-paramEditor-titleDiv").parent().hide();c('.sim-ui-paramEditor-titleDiv[param*="'+n+'"]').parent().show();c(".sim-ui-paramEditor-groupDiv").show()}});var j=c('<div class="sim-ui-paramEdit-buttonDiv">').appendTo(l);var g=c('<div class="sim-ui-paramEdit-mainContentDiv">').appendTo(l);g.data({formulationMap:d.getFormulationMap(h.formulationMap),validationTracker:d.getValidationTracker()});a.prototype.appendGroupDivParmEditor(e.getGroupCopy(h.varGroupCopy),g);j.append(a.prototype.getExpandButtonParmEditor(g));j.append(a.prototype.getCollapseButtonParmEditor(g));j.append(a.prototype.getHelpButton(g));a.prototype.handleFormulationLock()};a.prototype.appendGroupDivParmEditor=function(f,l){var k=c('<div class="sim-ui-paramEditor-groupDiv">').appendTo(l),j=c('<div class="sim-ui-paramEditor-titleDiv">').appendTo(k),h=c('<div class="sim-ui-paramEditor-childrenDiv">').appendTo(k);j.text(f.displayName);k.data({contentData:f,prevHeight:h.height(),expanded:true,childErrors:[]});var g=0;if(typeof f.groups!=="undefined"){for(g=0;g<f.groups.length;g++){a.prototype.appendGroupDivParmEditor(f.groups[g],h)}}if(typeof f.parameters!=="undefined"){for(g=0;g<f.parameters.length;g++){if((f.parameters[g].dataType==="REAL"||f.parameters[g].dataType==="INTEGER")&&f.parameters[g].structure==="SCALAR"){a.prototype.appendParameterDivParmEditor(f.parameters[g],h)}}}j.on("click",a.prototype.expandGroupDiv);return k};a.prototype.expandGroupDiv=function(f){var j=c(this),i=j.parent();var g=i.children(".sim-ui-paramEditor-childrenDiv"),h=f===true?0:500;if(!i.data("expanded")){i.data("expanded",true);g.animate({height:i.data("prevHeight")},{duration:h,complete:function(){c(this).css({height:"auto"})}})}else{i.data("prevHeight",g.height());i.data("expanded",false);g.animate({height:"0px"},{duration:h,complete:function(){}})}};a.prototype.appendParameterDivParmEditor=function(A,q){var v=A.min.toString();var f=A.max.toString();if(v.length>7){v=A.min.toPrecision(6).toString()}if(f.length>7){f=A.max.toPrecision(6).toString()}var C=[];var w=A.displayName;if(A.unit){C=" "+A.unit}var p="["+v+" ... "+f+"]";var x=c('<div class="sim-ui-paramEditor-parameterDiv">').appendTo(q),D=c('<div class="sim-ui-paramEditor-titleDiv" param="'+w.toLowerCase()+'">').appendTo(x),s=c('<div class="sim-ui-paramEditor-optionsDiv">').appendTo(x),h=x.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap"),g=A.ID;var u=document.createElement("div");u.classList.add("sim-ui-paramEditor-paramTitleText");u.textContent=w;var t=document.createElement("div");t.classList.add("sim-ui-paramEditor-paramUnitsText");t.textContent=C;var n=document.createElement("div");n.classList.add("sim-ui-paramEditor-paramRangeText");n.textContent=p;D[0].appendChild(u);D[0].appendChild(t);D[0].appendChild(n);x.data({contentData:A,prevHeight:s.height(),expanded:true,errors:[]});var k=c('<div class="sim-ui-paramEditor-row" />').appendTo(s);var m=c("<label>"+b.translate("Priority")+": </label>").addClass("sim-ui-paramEditor-option").appendTo(k);a.prototype.makeDropdownParmEditor.call(x,["MH","1","2","3","4","5"],A.priority===0?"MH":A.priority,a.prototype.priorityParmEditorDropDownCallback).addClass("sim-ui-paramEditor-option sim-ui-paramEditor-option-priority").appendTo(m);var l=c("<label>"+b.translate("Lower Threshold")+": </label>").addClass("sim-ui-paramEditor-option").appendTo(k);a.prototype.makeConstraintField.call(x,"GREATER_THAN",a.prototype.lowerThreshParmEditorEntryCallback).addClass("sim-ui-paramEditor-option sim-ui-paramEditor-option-lowerThresh").appendTo(l);var j=c("<label>"+b.translate("Upper Threshold")+": </label>").addClass("sim-ui-paramEditor-option").appendTo(k);a.prototype.makeConstraintField.call(x,"LESS_THAN",a.prototype.upperThreshParmEditorEntryCallback).addClass("sim-ui-paramEditor-option sim-ui-paramEditor-option-upperThresh").appendTo(j);var o=c("<label>"+b.translate("Objective")+": </label>").addClass("sim-ui-paramEditor-option").appendTo(k);var y=typeof h.values[g]!=="undefined"&&h.values[g].objectives.length!==0?h.values[g].objectives[0].type:"";a.prototype.makeDropdownParmEditor.call(x,{"":"",Minimize:b.translate("Minimize"),Maximize:b.translate("Maximize"),Target:b.translate("Target")},y,a.prototype.objectiveParmEditorDropDownCallback).addClass("sim-ui-paramEditor-option sim-ui-paramEditor-option-objective").appendTo(o);var E=c("<label />").appendTo(k);a.prototype.makeTargetField.call(x,a.prototype.targetParmEditorEntryCallback).addClass("sim-ui-paramEditor-option sim-ui-paramEditor-option-target").css("visibility",typeof h.values[g]!=="undefined"&&typeof h.values[g].objectives!=="undefined"&&h.values[g].objectives.length!==0&&h.values[g].objectives[0].type.toUpperCase()==="TARGET"?"visible":"hidden").appendTo(E);var i=c("<label />").appendTo(k);var r=c("<div/>",{"class":"sim-ui-paramEditor-commentsPreview"}).appendTo(i);var z=c("<div/>",{"class":"sim-ui-paramEditor-commentsContainerDiv"}).appendTo(s);var B=c("<div/>",{"class":"sim-ui-paramEditor-commentsDiv",contenteditable:"true"}).appendTo(z).text(b.translate("Enter a description")+": ");a.prototype.makeCommentDivAndPreview.call(x,z,B,r);D.on("click",a.prototype.expandParameterDivParmEditor);return x};a.prototype.expandParameterDivParmEditor=function(g){var j=c(this),f=j.parent(),h=f.children(".sim-ui-paramEditor-optionsDiv"),i=g===true?0:500;if(!f.data("expanded")){f.data("expanded",true);h.animate({height:f.data("prevHeight")},{duration:i,complete:function(){c(this).css({height:"auto"})}})}else{f.data("prevHeight",h.height());f.data("expanded",false);h.animate({height:"0px"},{duration:i,complete:function(){}})}};a.prototype.priorityParmEditorDropDownCallback=function(f){var g=c(this),i=g.find(".sim-ui-paramEditor-option-priority");if(i.val()==="MH"){g.data("contentData").priority=0}else{g.data("contentData").priority=parseInt(i.val(),10)}a.prototype.propagateDataChangeParmEditor.call(g,true);if(c(".sim-ui-popover-contentDiv").length>0){c(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data().saved=false}else{var h=c("#definecontentpanel").data();h.saved=false;if(a.prototype.saveFromDefinePage(g,f)){h.saved=true}}};a.prototype.objectiveParmEditorDropDownCallback=function(g){var k=c(this),h=k,j=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("validationTracker"),f=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap"),l={parameterID:h.data("contentData").ID,type:h.find(".sim-ui-paramEditor-option-objective").val().toUpperCase(),value:0};if(l.type.toUpperCase()==="TARGET"){l.value=h.find(".sim-ui-paramEditor-option-target").val();if(l.value===""){l.value=prompt("Enter a target value for the objective:")}h.find(".sim-ui-paramEditor-option-target").val(l.value).css("visibility","visible")}else{h.find(".sim-ui-paramEditor-option-target").css("visibility","hidden")}f.updateParameter(l.parameterID,"objectives",l.type,parseFloat(l.value));a.prototype.validateIsTarget(l.parameterID,f,j);a.prototype.validateTarget(l.parameterID,f,j);if(j.checkFieldError(l.parameterID,"TARGET")){h.find(".sim-ui-paramEditor-option-target").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-target").removeClass("sim-ui-paramEditor-invalidOption")}if(c(".sim-ui-popover-contentDiv").length>0){c(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data().saved=false}else{var i=c("#definecontentpanel").data();i.saved=false;if(a.prototype.saveFromDefinePage(h,g)){i.saved=true}}};a.prototype.targetParmEditorEntryCallback=function(g){var k=c(this),h=k,j=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("validationTracker"),f=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap"),l={parameterID:h.data("contentData").ID,type:"TARGET",value:h.find(".sim-ui-paramEditor-option-target").val()};if(l.value!==""){f.updateParameter(l.parameterID,"objectives",l.type,parseFloat(l.value))}else{f.updateParameter(l.parameterID,"objectives",l.type,l.value)}a.prototype.validateTarget(l.parameterID,f,j);a.prototype.validateIsTarget(l.parameterID,f,j);if(j.checkFieldError(l.parameterID,"TARGET")){h.find(".sim-ui-paramEditor-option-target").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-target").removeClass("sim-ui-paramEditor-invalidOption")}if(c(".sim-ui-popover-contentDiv").length>0){c(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data().saved=false}else{var i=c("#definecontentpanel").data();i.saved=false;if(a.prototype.saveFromDefinePage(h,g)){i.saved=true}}};a.prototype.lowerThreshParmEditorEntryCallback=function(g){var m=c(this),h=m,l=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("validationTracker"),f=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap"),j={parameterID:h.data("contentData").ID,type:"GREATER_THAN",boundValue:h.find(".sim-ui-paramEditor-option-lowerThresh").val()};if(j.boundValue!==""){f.updateParameter(j.parameterID,"constraints",j.type,parseFloat(j.boundValue))}else{var k=h.data("contentData").min;f.updateParameter(j.parameterID,"constraints",j.type,Number.NEGATIVE_INFINITY)}a.prototype.validateLowerBound(j.parameterID,f,l);a.prototype.validateUpperBound(j.parameterID,f,l);a.prototype.validateTarget(j.parameterID,f,l);if(l.checkFieldError(j.parameterID,"TARGET")){h.find(".sim-ui-paramEditor-option-target").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-target").removeClass("sim-ui-paramEditor-invalidOption")}if(l.checkFieldError(j.parameterID,"UPPERTHRESH")){h.find(".sim-ui-paramEditor-option-upperThresh").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-upperThresh").removeClass("sim-ui-paramEditor-invalidOption")}if(l.checkFieldError(j.parameterID,"LOWERTHRESH")){h.find(".sim-ui-paramEditor-option-lowerThresh").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-lowerThresh").removeClass("sim-ui-paramEditor-invalidOption")}if(c(".sim-ui-popover-contentDiv").length>0){c(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data().saved=false}else{var i=c("#definecontentpanel").data();i.saved=false;if(a.prototype.saveFromDefinePage(h,g)){i.saved=true}}};a.prototype.upperThreshParmEditorEntryCallback=function(g){var m=c(this),h=m,k=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("validationTracker"),f=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap"),j={parameterID:h.data("contentData").ID,type:"LESS_THAN",boundValue:h.find(".sim-ui-paramEditor-option-upperThresh").val()};if(j.boundValue!==""){f.updateParameter(j.parameterID,"constraints",j.type,parseFloat(j.boundValue))}else{var l=h.data("contentData").max;f.updateParameter(j.parameterID,"constraints",j.type,Number.POSITIVE_INFINITY)}a.prototype.validateUpperBound(j.parameterID,f,k);a.prototype.validateTarget(j.parameterID,f,k);if(k.checkFieldError(j.parameterID,"TARGET")){h.find(".sim-ui-paramEditor-option-target").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-target").removeClass("sim-ui-paramEditor-invalidOption")}if(k.checkFieldError(j.parameterID,"UPPERTHRESH")){h.find(".sim-ui-paramEditor-option-upperThresh").addClass("sim-ui-paramEditor-invalidOption")}else{h.find(".sim-ui-paramEditor-option-upperThresh").removeClass("sim-ui-paramEditor-invalidOption")}if(c(".sim-ui-popover-contentDiv").length>0){c(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data().saved=false}else{var i=c("#definecontentpanel").data();i.saved=false;if(a.prototype.saveFromDefinePage(h,g)){i.saved=true}}};a.prototype.makeDropdownParmEditor=function(o,h,g){var f=this;var j=c('<select class="sim-ui-paramEditor-priority">'),l=null;var n=null;var m=null;if(o instanceof Array){n=o;m=o}else{n=Object.keys(o);m=n.map(function(i){return o[i]})}for(var k=0;k<n.length;k++){l=c("<option>"+m[k]+"</option>").val(n[k]).appendTo(j);if(typeof h!=="undefined"&&n[k].toString().toUpperCase()===h.toString().toUpperCase()){l.attr("selected",true)}}j.on("change",function(i){g.call(f,i)});return j};a.prototype.makeConstraintField=function(o,h){var f=this,g="",n=f.data("contentData").ID,k=f.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap");var l=c('<input class="sim-ui-paramEditor-constraintField">');var j=typeof k.values[n]!=="undefined"?k.values[n].constraints.length:0;for(var m=0;m<j;m++){if(k.values[n].constraints[m].type.toUpperCase()===o.toUpperCase()){g=k.values[n].constraints[m].boundValue}}l.val(g);l.on("change",function(i){h.call(f,i)});return l};a.prototype.makeTargetField=function(k){var h=this,n="",g=h.data("contentData").ID,f=h.parents(".sim-ui-paramEdit-mainContentDiv:first").data("formulationMap");var m=c('<input class="sim-ui-paramEditor-targetField">');var l=typeof f.values[g]!=="undefined"?f.values[g].objectives.length:0;for(var j=0;j<l;j++){if(f.values[g].objectives[j].type.toUpperCase()==="TARGET"){n=f.values[g].objectives[j].value}}m.val(n);m.on("change",function(i){k.call(h,i)});return m};a.prototype.truncateText=function(g){var h=c(this);var f=0;while(h.width()>g&&f<1000){h.text(h.text().substr(0,h.text().length-1));f++}if(f>0){h.text(h.text()+"...")}return 0};a.prototype.makeCommentDivAndPreview=function(m,h,i){var g=this,l=typeof g.data("contentData").notes!=="undefined"&&g.data("contentData").notes!==null?decodeURIComponent(g.data("contentData").notes):"";h.text(l);m.data({expanded:true,prevHeight:"50px"});h.attr("contentediable",true);i.text(h.text());h.css({"margin-right":"20px"});function f(n){var p=n===true?0:500;if(!c(this).data("isClicked")){var o=c(this);if(m.data("expanded")===true){m.data("prevHeight",h.height());m.data("expanded",false);h.css({resize:"none"});i.text(h.text()===""?b.translate("Write a comment")+":":h.text());m.animate({height:"0px"},{duration:p,complete:function(){m.css("display","none");if(typeof h.data("ra-parameditor-init")!=="undefined"){c(h).trigger("blur")}else{h.data("ra-parameditor-init",true)}}})}else{m.data("expanded",true);m.css({display:"block"});m.animate({height:m.data("prevHeight")},{duration:p,complete:function(){c(h).css({height:"auto",resize:"vertical"});c(m).css({height:"auto"})}})}o.data("isClicked",true);setTimeout(function(){o.removeData("isClicked")},p)}}i.on("click",f);c("<div class='ui-icon ui-icon-closethick' style='cursor:pointer; position: relative; float: right; display: block; height: 16px; resize:none;'></div>").prependTo(m).on("click",function(){i.click()});h.keypress(k);h.on("blur",function(n){j(n)});function k(s){var r,q,u,t,p,o,n;r=window.getSelection();q=r.anchorNode;if(s.keyCode===13){s.preventDefault();u=r.anchorOffset;t=q.textContent;p=t.slice(0,u);o=t.slice(u)||" ";q.textContent=p+"\n"+o;n=document.createRange();n.setStart(q,u+1);n.setEnd(q,u+1);r.removeAllRanges();r.addRange(n)}}function j(n){g.data("contentData").notes=encodeURIComponent(h.text());a.prototype.propagateDataChangeParmEditor.call(g,true);if(c(".sim-ui-popover-contentDiv").length>0){c(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data().saved=false}else{var o=c("#definecontentpanel").data();o.saved=false;if(a.prototype.saveFromDefinePage(g,n)){o.saved=true}}}f.call(h,true)};a.prototype.validateIsTarget=function(j,f,i){var h=f.values[j].objectives[0].value,g={parameterID:j,type:"t-isNumber",field:"TARGET",errorMessage:b.translate("target_no_value_error_msg")};if(!(isNaN(h)||isNaN(parseFloat(h)))||f.values[j].objectives[0].type.toUpperCase()!=="TARGET"){i.removeError(g)}else{i.addError(g)}};a.prototype.validateTarget=function(l,g,o){var h=g.values[l].constraints,m="",n="",p={parameterID:l,type:"t-isNaN",field:"TARGET",errorMessage:b.translate("target_non_numeric_error_msg")},f={parameterID:l,type:"t-isLess",field:"TARGET",errorMessage:b.translate("target_lt_threshold_error")},q={parameterID:l,type:"t-isGrtr",field:"TARGET",errorMessage:b.translate("target_gt_threshold_error")};var k=null;if(g.values[l].objectives.length===0||g.values[l].objectives[0].type.toUpperCase()!=="TARGET"){o.removeError(f);o.removeError(q);o.removeError(p);return 0}else{k=g.values[l].objectives[0].value}if(isNaN(k)){o.addError(p);o.removeError(f);o.removeError(q);return 0}else{o.removeError(p)}if(isNaN(parseFloat(k))){o.removeError(f);o.removeError(q);return 0}if(typeof h!=="undefined"){for(var j=0;j<h.length;j++){if(h[j].type==="GREATER_THAN"){n=h[j].boundValue}else{if(h[j].type==="LESS_THAN"){m=h[j].boundValue}}}}if(!(isNaN(m)||isNaN(parseFloat(m)))&&parseFloat(k)>parseFloat(m)){o.addError(q)}else{o.removeError(q)}if(!(isNaN(n)||isNaN(parseFloat(n)))&&parseFloat(k)<parseFloat(n)){o.addError(f)}else{o.removeError(f)}return 0};a.prototype.validateUpperBound=function(l,g,o){var h=g.values[l].constraints,m="",n="",p={parameterID:l,type:"ub-isNaN",field:"UPPERTHRESH",errorMessage:b.translate("upper_bound_non_numeric_error_msg")},f={parameterID:l,type:"ub-isLess",field:"UPPERTHRESH",errorMessage:b.translate("upper_bound_lt_lower_bound_error_msg")};for(var j=0;j<h.length;j++){if(h[j].type==="GREATER_THAN"){n=h[j].boundValue}else{if(h[j].type==="LESS_THAN"){m=h[j].boundValue}}}if(isNaN(m)){o.removeError(f);o.addError(p);return 0}else{o.removeError(p)}if(isNaN(parseFloat(m))){o.removeError(f);o.removeError(p);return 0}if(!(isNaN(n)||isNaN(parseFloat(n)))&&parseFloat(n)>=parseFloat(m)){o.addError(f)}else{o.removeError(f)}var k=e.findParameter(l);return 0};a.prototype.validateLowerBound=function(n,f,k){var m=f.values[n].constraints,j="",h={parameterID:n,type:"lb-isNaN",field:"LOWERTHRESH",errorMessage:b.translate("lower_bound_nan_error_msg")};for(var g=0;g<m.length;g++){if(m[g].type==="GREATER_THAN"){j=m[g].boundValue}}if(!isNaN(j)||j==="none"){k.removeError(h)}else{k.addError(h)}var l=e.findParameter(n)};a.prototype.propagateDataChangeParmEditor=function(f){var k=c(this),j=k.data("contentData");if(k.hasClass("sim-ui-paramEditor-parameterDiv")===true){f=true}if(k.parents(".sim-ui-paramEditor-groupDiv:first").length!==0){var l=k.parents(".sim-ui-paramEditor-groupDiv:first");var h=null;if(f){h=l.data("contentData").parameters}else{h=l.data("contentData").groups}for(var g=0;g<h.length;g++){if(h[g].ID===j.ID){h[g]=j;break}}a.prototype.propagateDataChangeParmEditor.call(l)}};a.prototype.getExpandButtonParmEditor=function(g){var f=c('<button class="sim-ui-paramEdit-button">'+b.translate("Expand All")+"</button>").on("click",function(){a.prototype.expandAllParmEditor(g)});return f};a.prototype.getCollapseButtonParmEditor=function(g){var f=c('<button class="sim-ui-paramEdit-button">'+b.translate("Collapse All")+"</button>").on("click",function(){a.prototype.collapseAllParmEditor(g)});return f};a.prototype.getHelpButton=function(){var f=c("<div />").attr("class","sim-ui-panel-controlgroup-toolbarbutton ui-icon ui-icon-help").attr("data-helpTopic","PriorityWeightCalculations").attr("title",b.translate("Help")).on("click",function(){var g={};g.eventID="help";g.helpTopic="PriorityWeightCalculations";e.propagateEvent(g)});return f};a.prototype.makePriorityLegend=function(){var i=d3.select(this.parentContainerDiv.find(".sim-ui-paramEdit-buttonDiv")[0]).append("svg").classed("sim-ui-priorityLegendSvg",true).style("margin-left","20px");var g=[{circText:"MH",legendText:b.translate("Must Have"),color:"white",dist:15},{circText:"1",legendText:b.translate("p1_to"),color:"white",dist:90},{circText:"5",legendText:b.translate("to_p5"),color:"black",dist:250}];var h=["white","red","maroon","white"];var f=i.selectAll(".sim-ui-mindMap-legend").data(g).enter().append("g").classed("sim-ui-mindMap-legend",true);f.append("circle").attr("class","priorityCircle").attr("r",7).attr("cx",function(j){return j.dist}).attr("cy",15).style("fill",function(k,j){return h[j+1]}).style("stroke","black");f.append("text").text(function(j){return j.circText}).attr("y",19).attr("x",function(k,j){return k.dist}).style("fill",function(j){return j.color}).attr("text-anchor","middle");f.append("text").text(function(j){return j.legendText}).attr("x",function(k,j){return k.dist+10}).attr("y",19)};a.prototype.expandAllParmEditor=function(f){f.find(".sim-ui-paramEditor-groupDiv").each(function(){var h=c(this),g=h.children(".sim-ui-paramEditor-titleDiv");if(h.data("expanded")===false){a.prototype.expandGroupDiv.call(g,false)}});f.find(".sim-ui-paramEditor-parameterDiv").each(function(){var g=c(this),h=g.children(".sim-ui-paramEditor-titleDiv");if(g.data("expanded")===false){a.prototype.expandParameterDivParmEditor.call(h,false)}})};a.prototype.collapseAllParmEditor=function(f){f.find(".sim-ui-paramEditor-groupDiv").each(function(){var h=c(this),g=h.children(".sim-ui-paramEditor-titleDiv");if(h.data("expanded")===true){a.prototype.expandGroupDiv.call(g,false)}});f.find(".sim-ui-paramEditor-parameterDiv").each(function(){var g=c(this),h=g.children(".sim-ui-paramEditor-titleDiv");if(g.data("expanded")===true){a.prototype.expandParameterDivParmEditor.call(h,false)}})};a.prototype.PDEParamChangeCheck=function(m){var j=this.parentContainerDiv.find(".sim-ui-paramEdit-mainContentDiv"),f=j.children(".sim-ui-paramEditor-groupDiv"),k=j.data("validationTracker"),g=j.parents(".sim-ui-popover-mainDiv:last");if(k.isEmpty()){if(g!=="undefined"||g!=="null"){g.data({formulationMap:d.getFormulationMap(j.data("formulationMap")),varGroupCopy:e.getGroupCopy(f.data("contentData"))})}c("#definecontentpanel").data({formulationMap:d.getFormulationMap(j.data("formulationMap")),varGroupCopy:e.getGroupCopy(f.data("contentData"))});return true}else{var l=b.translate("Validation Errors")+"\n\n";for(var h in k.parameters){l+=e.findParameter(h).displayName+":\n";for(var i in k.parameters[h]){l+="- "+k.parameters[h][i].errorMessage+"\n"}l+="\n\n"}l+=b.translate("changed_params_cannot_be_saved_msg");if(!m){l+="\n\n"+b.translate("discard_changes_confirm_msg");return confirm(l)}else{alert(l);return false}}};a.prototype.handleFormulationLock=function(){var f=c(".sim-ui-paramEditor-option > input, .sim-ui-paramEditor-targetField, .sim-ui-paramEditor-option > select");if(e.isFormulationLocked()){f.attr("disabled","disabled");f.addClass("sim-ui-paramEditor-disabled")}else{f.removeClass("sim-ui-paramEditor-disabled");f.removeAttr("disabled")}};a.prototype.saveFromDefinePage=function(f,m){var k=f.parents(".sim-ui-paramEdit-mainContentDiv"),g=k.children(".sim-ui-paramEditor-groupDiv"),o=k.data("validationTracker"),n=k.parents("#definecontentpanel");m=window.event||m||{};m.iaEventPageSource="definePage";try{window.event=m}catch(j){}if(o.isEmpty()){n.data({formulationMap:d.getFormulationMap(k.data("formulationMap")),varGroupCopy:e.getGroupCopy(g.data("contentData"))});n.data().formulationMap.saveChanges();e.setGroupInfo(n.data().varGroupCopy);return true}else{var l=b.translate("Validation Errors")+"\n\n";for(var i in o.parameters){l+=e.findParameter(i).displayName+":\n";for(var h in o.parameters[i]){l+="- "+o.parameters[i][h].errorMessage+"\n"}l+="\n\n"}alert(l);return false}};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsMindMap",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils"],function(b,d,a,c){function e(){}e.prototype.setPopoverData=function(f){this.popoverData=f};e.prototype.setContainerDiv=function(f){this.containerDiv=f};e.prototype.persistImmediately=function(f){this.ifPersistImmediately=f};e.prototype.makeMindmap=function(){var x=this.containerDiv,w=this.popoverData,L=this.ifPersistImmediately;x.css("display","block");x.addClass("unselectable-element");x.empty();var t=d.getGroupCopy(w.varGroupCopy);x.css("overflow","scroll");x.append('<div id="sim-ui-hierarchy-viewbars" style="position:fixed"/>');x.addClass("sim-ui-mindMap-containerDiv");var m=function(P,S){function R(T){if(T==="I"||T==="i"||T==="l"){return 4}else{if(T==="m"||T==="w"||T==="@"||T==="%"){return 10}else{if(T>="a"&&T<="z"){return 6}else{if(T>="A"&&T<="Z"){return 10}else{return 8}}}}}var Q=0,O=0;if(S){O=0;for(Q=0;Q<P.length;Q++){O+=R(P[Q])}O+=5;return O}else{b("body").append('<div id="measure">'+P+"</div>");var N=b("#measure").width();b("#measure").remove();return N+5}};var E=true;var f=d.getAllParametersAsFlatList().length;var D=f*30;if(D<350){D=350}var F=1000;var z=100;var J=2;var M=["white","red","maroon","green","blue","orange","white"];var l=0;var B=d3.layout.tree().size([D,F]);var C=d3.select(this.containerDiv[0]).append("svg").attr("width",F).attr("height",D).style("position","absolute").style("left","0px").append("g").attr("transform","translate("+z+","+J+")");var p=t;function i(O){var P=O;P.parent=[];if(!P.dataType){P.dataType="group"}if(!P.children){P.children=[]}var N=0;if(P.parameters!==undefined){for(N=0;N<P.parameters.length;N++){P.children.push(P.parameters[N])}}if(P.groups!==undefined){for(N=0;N<P.groups.length;N++){P.children.push(P.groups[N])}}if(P.children!==undefined){for(N=0;N<P.children.length;N++){i(P.children[N])}}}i(p);if(p.children===undefined){p.children=p.parameters.slice(0)}p.y0=0;p.x0=D/2;function K(V){var P=B.nodes(p);var Q=d3.svg.diagonal().projection(function(X){return[X.y,X.x]});function N(Z){for(var Y=0;Y<Z.length;Y++){var X=0;if(Z[Y].parent&&Z[Y].parent.length===0){Z[Y].uID=0;if(Z[Y].children!==undefined&&Z[Y].children!==null){for(X=0;X<Z[Y].children.length;X++){Z[Y].children[X].uID=X+1}}}else{if(Z[Y].children!==undefined&&Z[Y].children!==null){for(X=0;X<Z[Y].children.length;X++){Z[Y].children[X].uID=Z[Y].uID+"."+(X+1)}}}}}N(P);var U=[];for(var T=0;T<P.length;T++){if(U[P[T].depth]===undefined){U[P[T].depth]=150+m(P[T].displayName,E)+m(P[T].uID.toString(),E)}if(150+m(P[T].displayName,E)+m(P[T].uID.toString(),E)>U[P[T].depth]){U[P[T].depth]=150+m(P[T].displayName,E)+m(P[T].uID.toString(),E)}}P.forEach(function(Z){if(Z.depth===0){Z.y=Z.depth*150}else{var X=0;for(var Y=Z.depth-1;Y>-1;Y--){X=X+U[Y]}Z.y=X}});var O=C.selectAll("g").data(P,function(X){return X.ID});var R=C.selectAll("path").data(B.links(P),function(X){return X.target.ID});R.enter().insert("path","g").attr("class","line").attr("d",Q({source:{x:V.x0,y:V.y0},target:{x:V.x0,y:V.y}}));R.transition().duration(500).attr("d",Q);R.exit().transition().duration(500).attr("d",Q({source:{x:V.x,y:V.y},target:{x:V.x,y:V.y}})).remove();var S=O.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+V.y0+","+V.x0+")"}).style("opacity",0);S.append("rect").attr("height",20).attr("width",function(X){if(X.dataType==="group"){return(m(X.displayName,E)+m(X.uID.toString(),E)+10)}else{return(m(X.displayName,E)+m(X.uID.toString(),E)+5)}}).attr("x",-20).attr("y",-10).style("stroke","black").style("fill",function(X){if(X.dataType==="group"){return"#D4D4D4"}return"white"}).attr("rx",function(X){if(X.dataType==="group"){return 10}else{return 2}}).attr("ry",function(X){if(X.dataType==="group"){return 10}else{return 2}}).on("click",function(X){v(X)});S.append("text").attr("class","name").attr("x",-15).attr("dy",4).text(function(X){if(X.uID!==0){return X.uID+" "+X.displayName}else{return X.displayName}}).on("click",function(X){v(X)});S.append("circle").attr("class","collapse").attr("cx",function(X){return(m(X.uID.toString(),E)+m(X.displayName,E)-15)}).attr("cy",8).attr("r",6).style("stroke","black").style("visibility",function(X){if(X.dataType==="group"){return"visible"}return"hidden"}).style("fill","white").on("click",function(X){if(X.dataType==="group"){h(X);K(X)}});S.append("text").attr("class","collapse-symbol").attr("x",function(X){return(m(X.uID.toString(),E)+m(X.displayName,E)-15)}).attr("y",11).attr("text-anchor","middle").style("visibility",function(X){if(X.dataType==="group"){return"visible"}return"hidden"}).text(function(X){if(X.storedChildren){return"+"}else{return"-"}}).on("click",function(X){if(X.dataType==="group"){h(X);K(X)}});S.append("circle").attr("class","priorityCircle").style("visibility",function(X){if(X.depth===0||String(X.priority)==="-1"||(!X.priority&&String(X.priority)!=="0")||X.structure==="ARRAY"||X.dataType==="STRING"){return"hidden"}else{return"visible"}}).attr("r","10").attr("cx",-31).attr("cy",0).style("stroke","black").style("fill",function(X){return M[parseInt(X.priority,10)+1]});S.append("text").attr("class","priority").style("visibility",function(X){if(X.depth===0||String(X.priority)==="-1"||X.structure==="ARRAY"||X.dataType==="STRING"){return"hidden"}else{return"visible"}}).text(function(X){if(String(X.priority)==="0"){return"MH"}return X.priority}).style("fill",function(X){if(String(X.priority)==="5"){return"black"}else{return"white"}}).style("font-size",12).attr("text-anchor","middle").attr("transform","translate(-31,4)");O.transition().duration(500).style("opacity",1).attr("transform",function(X){return"translate("+X.y+","+X.x+")"}).selectAll(".collapse-symbol").text(function(X){if(X.storedChildren){return"+"}else{return"-"}}).selectAll(".collapse").style("fill","white").selectAll("rect").style("fill",function(X){if(X.dataType==="group"){return"#D4D4D4"}return"white"});O.exit().transition().duration(500).style("opacity",0).attr("transform",function(){return"translate("+V.y+","+V.x+")"}).remove();var W=0;P.forEach(function(X){X.x0=X.x;X.y0=X.y});for(T=0;T<U.length;T++){W+=U[T]}if(W>F){x.find("svg").width(W+500)}G()}K(p);function h(N){if(N.children&&N.children.length!==0){N.storedChildren=N.children;N.children=null}else{if(N.storedChildren&&N.storedChildren.length!==0){N.children=N.storedChildren;N.storedChildren=null}}}function G(){var Q=null;var N=null;var P=null;var O=0;b(".node").unbind("mousedown");x.unbind("mouseup");b(".node").bind("mousedown",function(S){if(d.isFormulationLocked()){return}var R=b(this).context.__data__;if(R.dataType==="group"&&R.depth===0){return}O=setTimeout(function(){N=R;b("#dragNode").remove();if(R.uID!==0){x.append('<div id="dragNode" style="position:absolute;";>'+R.uID+" "+R.displayName+"</div>")}else{x.append('<div id="dragNode" style="position:absolute;";>'+R.displayName+"</div>")}var T=x.offset();b("#dragNode").css("top",S.pageY+5-T.top+x.scrollTop());b("#dragNode").css("left",S.pageX+5-T.left+x.scrollLeft());if(R.dataType==="group"){b("#dragNode").css("border-radius",10);b("#dragNode").css("width",m(R.uID.toString(),E)+m(R.displayName,E)+10);if(R.storedChildren&&R.storedChildren.length!==0){b("#dragNode").css("background-color","#b0c4de")}else{b("#dragNode").css("background-color","#D4D4D4")}}else{b("#dragNode").css("border-radius",2);b("#dragNode").css("width",m(R.uID.toString(),E)+m(R.displayName,E)+5)}Q=true;x.mousemove(function(U){b("#dragNode").css("top",U.pageY+5-T.top+x.scrollTop());b("#dragNode").css("left",U.pageX+5-T.left+x.scrollLeft())})},0)});b("body").bind("mouseup",function(){clearTimeout(O);b("#dragNode").remove();if(Q===true){if(N&&P){if(N.dataType==="group"){A(N,P)}else{H(N,P)}}x.find("rect").css("stroke","black");Q=false}});b(".node").hover(function(){var R=b(this).context.__data__;if(Q===true&&R.dataType==="group"){b(this).find("rect").css("stroke","orange");P=R}},function(){if(Q===true){b(this).find("rect").css("stroke","black")}P=null})}function v(Q){if(d.isFormulationLocked()){return}b(".sim-ui-mindMap-editPopup").remove();b(".bgDiv").remove();x.css("position","absolute");x.append('<div class="bgDiv" style="position:absolute; top:0px; left:0px;"></div>');var T=x.find("svg").width();var S=x.width();if(T<S){T=S}b(".bgDiv").width(T);var R=x.find("svg").height();var U=x.height();if(R<U){R=U}b(".bgDiv").height(R);b(".bgDiv").on("contextmenu",function(){b(".sim-ui-mindMap-editPopup").remove();b(".bgDiv").remove()});if(Q.depth!==0){var O=0;var W=40;x.append('<div class="sim-ui-mindMap-editPopup" style="position:absolute; top:'+(Q.x+O)+"px; left:"+(Q.y+W)+'px; font-size: 10px; padding: 2px;"></div>');var N='<select class="sim-ui-mindMap-prioritySelector" style="font-size:10px;"><option>MH</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select> '+Q.uID+'  <input class="editName" style="font-size:10px;width:200px;" value="'+Q.displayName+'"></input>\u00A0';b(".sim-ui-mindMap-editPopup").append(N);if(Q.structure==="ARRAY"||Q.dataType==="STRING"){x.find(".sim-ui-mindMap-prioritySelector").css("visibility","hidden")}var V=false;if(L){x.find(".sim-ui-mindMap-prioritySelector").change(function(){V=true})}if(String(Q.priority)==="0"){b('.sim-ui-mindMap-prioritySelector option:contains("MH")').prop("selected",true)}else{b(".sim-ui-mindMap-prioritySelector option:contains("+Q.priority+")").prop("selected",true)}if(Q.dataType==="group"){b(".sim-ui-mindMap-editPopup").append('<span class="sim-ui-mindMap-button" id="addGroupButton">'+a.translate("Add Child Group")+"</span>\u00A0")}if(Q.dataType==="group"&&typeof Q.children==="undefined"&&(Q.storedChildren===null||Q.storedChildren===undefined)){b(".sim-ui-mindMap-editPopup").append('<span class="sim-ui-mindMap-button" id="removeGroupButton">'+a.translate("Delete Group")+" </span>\u00A0")}}else{x.append('<div class="sim-ui-mindMap-editPopup" style="position:absolute; padding: 2px;  top:'+(Q.x-5)+"px; left:"+(Q.y+80)+'px;"></div>');b(".sim-ui-mindMap-editPopup").append('<span class="sim-ui-mindMap-button" id="addGroupButton" style="border: none !important;"> '+a.translate("Add Child Group")+" </span>")}b("#addGroupButton").on("click",function(){r(Q,a.translate("New Group"));b(".bgDiv").remove();b(".sim-ui-mindMap-editPopup").remove()});b("#removeGroupButton").on("click",function(){u(Q);b(".bgDiv").remove();b(".sim-ui-mindMap-editPopup").remove()});var P=false;b(".editName").on("change",function(){if(b(".editName").val()!==Q.displayName){w.saved=false;P=true}});b(".editName").on("keypress",function(Y){var X=Y.keyCode?Y.keyCode:Y.which;if(X===13){w.saved=false;P=true;b(".bgDiv").click()}});b(".bgDiv").on("click",function(){var X=false;if(L&&(P||V)){X=true}if(Q.depth===0){b(".bgDiv").remove();b(".sim-ui-mindMap-editPopup").remove();return}if(Q.dataType==="group"){if(P===true){Q.displayName=b(".editName").val()}if(b(".sim-ui-mindMap-prioritySelector").val()==="MH"){Q.priority=0}else{Q.priority=parseInt(b(".sim-ui-mindMap-prioritySelector").val(),10)}b(".node").each(function(){var Z=b(this);if(Z.context.__data__.uID===Q.uID){if(String(Q.priority)==="-1"||Q.structure==="ARRAY"||Q.dataType==="STRING"){Z.find(".priority").css("visibility","hidden");Z.find(".priorityCircle").css("visibility","hidden")}else{Z.find(".priorityCircle").css("fill",M[parseInt(Q.priority,10)+1]);Z.find(".priorityCircle").css("visibility","visible");Z.find(".priority").text(b(".sim-ui-mindMap-prioritySelector").val());Z.find(".priority").css("visibility","visible");Z.find(".priority").css("fill",function(){if(String(b(this).text())==="5"){return"black"}else{return"white"}})}if(P===true){Z.find(".name").text(Q.uID+" "+Q.displayName);var Y=m(Q.uID.toString(),E)+m(Q.displayName,E);Z.find("rect").attr("width",Y+5);Z.find(".collapse").attr("cx",Y-15);Z.find(".collapse-symbol").attr("x",Y-15);P=false}}})}else{if(b(".sim-ui-mindMap-prioritySelector").val()==="MH"){Q.priority=0}else{Q.priority=parseInt(b(".sim-ui-mindMap-prioritySelector").val(),10)}if(P===true){Q.displayName=b(".editName").val()}b(".node").each(function(){var Y=b(this);if(Y.context.__data__.ID===Q.ID){if(String(Q.priority)==="-1"||Q.structure==="ARRAY"||Q.dataType==="STRING"){Y.find(".priority").css("visibility","hidden");Y.find(".priorityCircle").css("visibility","hidden")}else{Y.find(".priorityCircle").css("fill",M[parseInt(Q.priority,10)+1]);Y.find(".priorityCircle").css("visibility","visible");Y.find(".priority").text(b(".sim-ui-mindMap-prioritySelector").val());Y.find(".priority").css("fill",function(){if(String(b(this).text())==="5"){return"black"}else{return"white"}});Y.find(".priority").css("visibility","visible")}if(P===true){Y.find(".name").text(Q.uID+" "+Q.displayName);Y.find("rect").attr("width",m(Q.uID.toString(),E)+m(Q.displayName,E)+5);P=false}}})}b(".bgDiv").remove();b(".sim-ui-mindMap-editPopup").remove();if(X){s();w.saved=true}})}function u(P){w.saved=false;var O=0;for(var N=0;N<P.parent.children.length;N++){if(P.parent.children[N].uID===P.uID){O=N}}P.parent.children.splice(O,1);K(p);k()}function r(P,N){w.saved=false;var O=d.generateUUIDListAsJson();O.done(function(R,Q,S){console.log(R);B.nodes(p);var T={weightFactor:1,depth:P.depth+1,displayName:N,dataType:"group",parent:P,ID:c.getJSONFromResponse([R,Q,S])[0],children:[],priority:5,priorityWeight:1,basketWeight:-1};if(P.children){P.children.push(T)}else{if(P.storedChildren===undefined){if(typeof P.children==="undefined"){P.children=[]}P.children.push(T)}else{P.storedChildren.push(T)}}l+=1;K(p);k()})}function A(O,Q){w.saved=false;if(O.parent.uID!==Q.uID){if(Q.storedChildren===undefined){if(typeof Q.children==="undefined"){Q.children=[]}Q.children.push(O)}else{Q.storedChildren.push(O)}var P=null;for(var N=0;N<O.parent.children.length;N++){if(O.displayName===O.parent.children[N].displayName){P=N}}O.parent.children.splice(P,1);K(p);k()}}function H(O,S){w.saved=false;if(O.uID!==0&&O.parent.uID!==S.uID&&S.uID!==O.uID){var R=S;var Q=true;while(R.parent){if(R.uID===O.uID){Q=false}R=R.parent}if(Q){if(S.storedChildren===undefined||S.storedChildren===null){if(typeof S.children==="undefined"){S.children=[]}S.children.push(O)}else{S.storedChildren.push(O)}var P=null;for(var N=0;N<O.parent.children.length;N++){if(O.uID===O.parent.children[N].uID){P=N}}O.parent.children.splice(P,1);K(p);k()}}}function k(){b(".node").each(function(){var O=b(this).context.__data__;if(O.uID===0){b(this).find(".name").text(O.displayName);b(this).find("rect").attr("width",m(O.uID.toString(),E)+m(O.displayName,E)+10)}else{b(this).find(".name").text(O.uID+" "+O.displayName);if(O.dataType==="group"){b(this).find("rect").attr("width",m(O.uID.toString(),E)+m(O.displayName,E)+10);b(this).find(".collapse").attr("cx",m(O.uID.toString(),E)+m(O.displayName,E)-15);b(this).find(".collapse-symbol").attr("x",m(O.uID.toString(),E)+m(O.displayName,E)-15)}else{b(this).find("rect").attr("width",m(O.uID.toString(),E)+m(O.displayName,E)+5);var N=m(O.uID.toString(),E)+m(O.displayName,E)-12;b(this).find(".commentIcon").attr("points",String(0+N)+",-9 "+(18+N)+",-9 "+(18+N)+",5 "+(10+N)+",5 "+(4+N)+",10 "+(2+N)+",5 "+(0+N)+",5");b(this).find(".commentNumber").attr("x",function(){if(O.comments<10){return(m(O.uID.toString(),E)+m(O.displayName,E)-6)}else{return(m(O.uID.toString(),E)+m(O.displayName,E)-8)}})}}});if(L){s()}}function s(){q();b("#definecontentpanel").data().formulationMap.saveChanges();d.setGroupInfo(b("#definecontentpanel").data().varGroupCopy);return true}function q(){function P(R){var S=R;delete S.parent;S.groups=[];S.parameters=[];if(S.storedChildren!==undefined&&S.storedChildren!==null){S.children=S.storedChildren;S.storedChildren=undefined}if(S.children!==undefined&&S.children!==null){var Q=0;for(Q=0;Q<S.children.length;Q++){if(S.children[Q].dataType!=="group"){S.parameters.push(S.children[Q])}else{S.groups.push(S.children[Q])}}for(Q=0;Q<S.children.length;Q++){P(S.children[Q])}delete S.children}}P(p);console.log(p);function O(Q){w.saved=false;var V=["weightFactor","ID","score","displayName","basketWeight","priorityWeight","priority"],W={parameters:[],groups:[]};for(var S=0;S<V.length;S++){W[V[S]]=Q[V[S]]}if(!isNaN(parseInt(W.priority,10))){W.priority=parseInt(W.priority,10)}else{if(W.priority==="MH"){W.priority=0}else{W.priority=5}}for(S=0;S<Q.groups.length;S++){W.groups.push(O(Q.groups[S]))}for(S=0;S<Q.parameters.length;S++){var U={},T=d.findParameter(Q.children[S].ID);for(var R in T){U[R]=Q.children[S][R]}if(Q.children[S].priority){if(!isNaN(parseInt(Q.children[S].priority,10))){U.priority=parseInt(Q.children[S].priority,10)}else{if(Q.children[S].priority==="MH"){U.priority=0}else{U.priority=5}}}W.parameters.push(U)}if(W.groups.length===0){delete W.groups}if(W.parameters.length===0){delete W.parameters}if(typeof W.score==="undefined"){delete W.score}return W}i(p);K(p);var N=x.parents(".sim-ui-popover-mainDiv:last");N.data({varGroupCopy:d.getGroupCopy(O(p))});b("#definecontentpanel").data({varGroupCopy:d.getGroupCopy(O(p))})}x.data("saveFunction",q);if(d3.select(x.parent()[0]).selectAll(".sim-ui-mindMap-legend")[0]&&d3.select(x.parent()[0]).selectAll(".sim-ui-mindMap-legend")[0].length===0){var n=document.createElement("div");n.classList.add("sim-ui-mindMap-legend");var I=b("<div />").attr("class","sim-ui-panel-controlgroup-toolbarbutton ui-icon ui-icon-help").attr("data-helpTopic","PriorityWeightCalculations").attr("title",a.translate("Help")).on("click",function(){var N={};N.eventID="help";N.helpTopic="PriorityWeightCalculations";d.propagateEvent(N)});b(n).append(I);var o=d3.select(n).append("svg").classed("sim-ui-priorityLegendSvg",true);var j=[{circText:"MH",legendText:a.translate("Must Have"),color:"white",dist:15},{circText:"1",legendText:a.translate("p1_to"),color:"white",dist:90},{circText:"5",legendText:a.translate("to_p5"),color:"black",dist:250}];var g=["white","red","maroon","white"];var y=o.selectAll(".sim-ui-mindMap-legend").data(j).enter().append("g");y.append("circle").attr("class","priorityCircle").attr("r",7).attr("cx",function(N){return N.dist}).attr("cy",15).style("fill",function(O,N){return g[N+1]}).style("stroke","black");y.append("text").text(function(N){return N.circText}).attr("y",19).attr("x",function(O,N){return O.dist}).style("fill",function(N){return N.color}).attr("text-anchor","middle");y.append("text").text(function(N){return N.legendText}).attr("x",function(O,N){return O.dist+10}).attr("y",19);x.parent().append(b(n))}};e.prototype.mindMapChangeFunction=function(){this.containerDiv.data().saveFunction();return true};return e});define("DS/SMAAnalyticsUI/SMAAnalyticsComments",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,c,a){function d(e){this.commentCounter=0;this.likeCounter=0;this.lastComment=null;this.rowID=e.rowID||-1;this.container=e.container||null;this.type=e.type||"data";this.build=e.build||"comments";this.refreshUI()}d.prototype={buildUI:function(){this.container.setAttribute("data-commentconstuction","underConstruction");this.container.innerHTML="";if(this.type==="data"&&this.build==="comments"){this.commentCounter=0;this.buildCommentUIForData()}else{if(this.type==="data"&&this.build==="likes"){this.buildLikesUIForData()}}},refreshUI:function(){var e=this;if(this.container.getAttribute("data-commentconstuction")==="underConstruction"){if(typeof this.container.observer!=="undefined"){this.container.observer.disconnect();delete this.container.observer}this.container.observer=new MutationObserver(function(f){f.forEach(function(g){if(g.type==="attributes"){if(g.attributeName==="data-commentconstuction"&&g.target.getAttribute("data-commentconstuction")==="constructionComplete"){g.target.observer.disconnect();g.target.removeAttribute("data-commentconstuction");e.buildUI()}}})});this.container.observer.observe(this.container,{attributes:true,attributeFilter:["data-commentconstuction"]})}else{this.buildUI()}},refreshOtherContainers:function(){var f=this;var e=document.querySelectorAll('.ra-commentsui[data-rowID="'+f.rowID+'"]');[].forEach.call(e,function(g){if(g.parentNode!==f.container){g.commentController.refreshUI()}})},buildCommentUIForData:function(){var g=this;var e=function(i){if(g.container!==null){var h=null;if(g.container.children.length>0){h=g.container.children[0]}g.likeCounter=i.length;g.container.insertBefore(g.makeCommentStatsUI(),h);g.container.setAttribute("data-commentconstuction","constructionComplete")}};var f=function(i){if(g.container!==null){var h=g.makeCommentUI(i);h.commentController=g;g.container.appendChild(h);g.getDataLikes(e)}};this.getDataComments(f)},buildLikesUIForData:function(){var f=this;var e=function(h){if(f.container!==null){var g=f.makeLikesUI(h);g.commentController=f;f.container.appendChild(g);f.container.insertBefore(f.makeLikesStatsUI(),g);f.container.setAttribute("data-commentconstuction","constructionComplete")}};this.getDataLikes(e)},makeLikeDesignButton:function(){var e=this},makeLikesUI:function(f){var g=this;var e=document.createElement("div");e.classList.add("ra-like-container");e.classList.add("ra-commentsui");e.setAttribute("data-rowID",g.rowID);g.container.likes=[];if(typeof f!=="undefined"&&f!==null&&f.length>0){f.forEach(function(i){var h=g.makeSingleLikeUI(i);g.likeCounter+=1;g.container.likes.push(h);e.appendChild(h)})}else{e.appendChild(g.makeNoLikesMessage())}return e},makeSingleLikeUI:function(i){var h=this;var g=document.createElement("div");g.classList.add("ra-like");var f=document.createElement("h1");f.textContent=i.userName;g.appendChild(f);var e=document.createElement("div");e.textContent=h.parseDate(i);g.likesData=d.prototype.cloneLikeJSON(i);return g},makeLikesStatsUI:function(){var f=this;f.stats=document.createElement("div");f.stats.classList.add("ra-comment-statscontainer");var e=document.createElement("span");e.textContent=a.translate("people_who_like_this");f.stats.appendChild(e);f.stats.likeButton=document.createElement("button");f.stats.likeButton.classList.add("ra-comment-like");f.stats.likeButton.commentController=f;f.stats.likeButton.onclick=f.performLikeDesign;f.stats.appendChild(f.stats.likeButton);f.refreshLikeStatsUI();return f.stats},refreshLikeStatsUI:function(){var f=this;var e="";if(f.likeCounter>0){e+=String(f.likeCounter);if(d.prototype.checkIfLiked(f.container.likes)>-1){f.container.classList.add("ra-comment-liked")}else{f.container.classList.remove("ra-comment-liked")}}else{f.container.classList.remove("ra-comment-liked")}f.stats.likeButton.value=e;f.stats.likeButton.textContent=e},makeCommentStatsUI:function(){var e=this;e.stats=document.createElement("div");e.stats.classList.add("ra-comment-statscontainer");e.stats.comments=document.createElement("span");e.stats.appendChild(e.stats.comments);e.stats.likes=document.createElement("span");e.stats.appendChild(e.stats.likes);e.stats.lastComment=document.createElement("span");e.stats.appendChild(e.stats.lastComment);e.refreshCommentStats();return e.stats},refreshCommentStats:function(){var e=this;e.stats.comments.textContent=e.commentCounter+" "+(e.commentCounter>1||e.commentCounter===0?a.translate("Comments"):a.translate("Comment"));e.stats.likes.textContent=e.likeCounter+" "+(e.likeCounter>1||e.likeCounter===0?a.translate("Likes"):a.translate("Like"));if(e.lastComment!==null){e.stats.lastComment.textContent=a.translate("Last Comment by val",e.lastComment.userName)}else{e.stats.lastComment.textContent=""}},makeCommentUI:function(g){var f=this;var e=document.createElement("div");e.classList.add("ra-comment-container");e.classList.add("ra-commentsui");e.setAttribute("data-rowID",f.rowID);e.comments=[];if(typeof g!=="undefined"&&g!==null&&g.length>0){g.forEach(function(h){var i=f.makeSingleCommentUI(h);f.commentCounter+=1;e.comments.push(i);e.appendChild(i)})}else{e.appendChild(f.makeNoCommentsMessage())}e.appendChild(f.makeRespondUI());return e},makeRespondUI:function(){var i=this;var f=document.createElement("div");f.classList.add("ra-comment-form");var e=document.createElement("div");e.classList.add("ra-comment-form-label");e.textContent=a.translate("Write a comment");f.appendChild(e);var g=document.createElement("button");g.value=a.translate("Submit");g.textContent=a.translate("Submit");g.commentController=i;g.onclick=i.performComment;f.appendChild(g);var h=document.createElement("div");h.classList.add("ra-comment-textarea");h.setAttribute("contenteditable","true");f.commentText=h;f.appendChild(h);return f},performComment:function(){var k=this;var i=k.parentNode;var j=i.commentText.textContent.trim();if(j.length>0){var e=k.commentController.makeNewCommentJSON(j);var h=k.commentController.makeSingleCommentUI(e);var f=i.parentNode;h.style.display="none";var g=[];if(typeof f.comments!=="undefined"){g=f.comments.slice();f.comments.push(h)}else{f.comments=[h]}f.insertBefore(h,i);k.commentController.updateServantWithComment(k.commentController.container.children[1],function(){if(f.comments.length>0){var l=f.querySelector(".ra-comment-none");if(l!==null){l.parentNode.removeChild(l)}}k.commentController.commentCounter+=1;k.commentController.refreshCommentStats();i.commentText.innerHTML="";h.style.display="block";k.commentController.refreshOtherContainers()},function(){if(g.length>0){f.comments=g}else{delete f.comments}f.removeChild(h)})}},performLikeComment:function(){var j=this;var e=j.parentNode;var h=j.parentNode.parentNode;var f=[];var g;if(typeof h.likes==="undefined"){g=d.prototype.makeNewLikeJSON();h.likes=[g]}else{f=h.likes.slice();var i=d.prototype.checkIfLiked(h.likes);if(i>-1){h.likes.splice(i,1);if(h.likes.length===0){delete h.likes}}else{g=d.prototype.makeNewLikeJSON();h.likes.push(g)}}j.commentController.updateServantWithComment(j.commentController.container.children[1],function(){var k="";if(typeof h.likes!=="undefined"){k+=String(h.likes.length);if(d.prototype.checkIfLiked(h.likes)>-1){e.classList.add("ra-comment-liked")}else{e.classList.remove("ra-comment-liked")}}else{e.classList.remove("ra-comment-liked")}j.value=k;j.textContent=k;j.commentController.refreshOtherContainers()},function(){if(f.length===0){delete h.likes}else{h.likes=f}})},performLikeDesign:function(){var l=this;var k=l.parentNode.parentNode;var f=[];var g=null;try{if(l.commentController.container.likes.length>0){f=l.commentController.container.likes.slice()}}catch(i){console.log("Likes parameter was not an Array")}if(f.length===0||l.commentController.container.likes===null||typeof l.commentController.container.likes==="undefined"){var h=d.prototype.makeNewLikeJSON();g=l.commentController.makeSingleLikeUI(h);g.style.display="none";k.appendChild(g);l.commentController.container.likes=[g]}else{f=l.commentController.container.likes.slice();var j=d.prototype.checkIfLiked(l.commentController.container.likes);if(j>-1){if(l.commentController.container.likes[j].parentNode!==null){l.commentController.container.likes[j].parentNode.removeChild(l.commentController.container.likes[j])}l.commentController.container.likes.splice(j,1);if(typeof l.commentController.container.likes!=="undefined"&&l.commentController.container.likes.length>0){delete l.commentController.container.likes}}else{var h=d.prototype.makeNewLikeJSON();g=l.commentController.makeSingleLikeUI(h);g.style.display="none";l.commentController.container.likes.push(g);k.appendChild(g)}}l.commentController.updateServantWithLike(l.commentController.container,function(){if(l.commentController.container.likes.length>0){var e=l.commentController.container.querySelector(".ra-comment-none");if(e!==null){e.parentNode.removeChild(e)}}else{var e=l.commentController.container.querySelector(".ra-comment-none");if(e===null){l.commentController.container.appendChild(l.commentController.makeNoLikesMessage())}}if(g!==null){g.style.display="block"}var m="";l.commentController.refreshLikeStatsUI();l.value=m;l.textContent=m;l.commentController.refreshOtherContainers()},function(){l.commentController.container.removeChild(g);if(f.length===0){delete l.commentController.container.likes}else{l.commentController.container.likes=f}})},updateServantWithLike:function(f,e,g){var i=this;if(typeof i.rowID!=="undefined"){if(i.type==="data"){var h=i.rebuildLikesArray(f);i.setDataLikes(h,e,g)}else{if(typeof g==="function"){g()}}return true}},updateServantWithComment:function(g,e,h){var i=this;if(typeof i.rowID!=="undefined"){var f=i.rebuildCommentsArray(g);if(i.type==="data"){i.setDataComments(f,e,h)}else{if(typeof h==="function"){h()}}return true}},makeNoCommentsMessage:function(){var e=document.createElement("div");e.classList.add("ra-comment-none");e.textContent=a.translate("no_comments");return e},makeNoLikesMessage:function(){var e=document.createElement("div");e.classList.add("ra-comment-none");e.textContent=a.translate("no_likes");return e},makeSingleCommentUI:function(f){var j=this;var e=document.createElement("div");e.classList.add("ra-comment");var h=document.createElement("h1");h.textContent=f.userName;e.appendChild(h);var i=document.createElement("div");i.classList.add("ra-comment-contents");i.textContent=decodeURIComponent(f.text);e.appendChild(i);var g=j.makeCommentMETADataUI(f);e.appendChild(g);if(typeof f.comments!=="undefined"){e.comments=[];f.comments.forEach(function(l){j.commentCounter+=1;var k=j.makeSingleCommentUI(l);e.comments.push(k);e.appendChild(k)})}if(typeof f.likes!=="undefined"){e.likes=f.likes}e.commentData={userID:f.userID,userName:f.userName,date:f.date,text:f.text};return e},makeCommentMETADataUI:function(j){var i=this;var k=document.createElement("div");k.classList.add("ra-comment-meta");var f=0;var g=false;if(typeof j.likes!=="undefined"){f=j.likes.length;g=d.prototype.checkIfLiked(j.likes)>-1}if(g){k.classList.add("ra-comment-liked")}if(typeof j.comments!=="undefined"){console.log("COMMENTS: This comment had comments ....")}var e=document.createElement("button");e.classList.add("ra-comment-like");var h="";if(f>0){h+=String(f)}e.value=h;e.textContent=h;e.commentController=this;e.onclick=i.performLikeComment;k.appendChild(e);var l=document.createElement("button");l.classList.add("ra-comment-make");l.commentController=this;l.value=a.translate("Add Comment");l.textContent=a.translate("Add Comment");l.onclick=i.makeRespondToCommentUI;k.appendChild(l);var m=document.createElement("span");m.classList.add("ra-comment-date");m.textContent=i.parseDate(j);k.appendChild(m);return k},makeRespondToCommentUI:function(){var g=this;var e=this.parentNode.parentNode;var f=g.commentController.makeRespondUI();e.insertBefore(f,null)},checkIfLiked:function(e){var f=c.caseInfo.CurrentUser.userID;var g=e.length-1;while(g>-1){var h=e[g];if(h.userID===f||h.likesData.userID===f){return g}g-=1}return g},makeNewCommentJSON:function(e){return{userID:c.caseInfo.CurrentUser.userID?c.caseInfo.CurrentUser.userID:c.currentUser.userID,userName:c.caseInfo.CurrentUser.userName?c.caseInfo.CurrentUser.userName:c.currentUser.userName,date:d.prototype.setDate(),text:e}},makeNewLikeJSON:function(){return{userID:c.caseInfo.CurrentUser.userID?c.caseInfo.CurrentUser.userID:c.currentUser.userID,isPositive:true,userName:c.caseInfo.CurrentUser.userName?c.caseInfo.CurrentUser.userName:c.currentUser.userName,date:d.prototype.setDate()}},cloneCommentJSON:function(e){return{userID:e.userID,userName:e.userName,date:e.date,text:e.text}},cloneLikeJSON:function(e){return{userID:e.userID,isPositive:typeof e.isPostitive!=="undefined"?e.isPostitive:true,userName:e.userName,date:e.date}},rebuildLikesArray:function(e){var f=[];if(typeof e.likes!=="undefined"&&e.likes!==null){[].forEach.call(e.likes,function(g){f.push(d.prototype.cloneLikeJSON(g))})}return f},rebuildCommentsArray:function(f){var g=this;f=f||g;var e=[];if(typeof f.comments!=="undefined"){[].forEach.call(f.comments,function(i){var h=d.prototype.cloneCommentJSON(i.commentData);if(typeof i.comments!=="undefined"){h.comments=d.prototype.rebuildCommentsArray(i)}if(typeof i.likes!=="undefined"){h.likes=d.prototype.rebuildLikesArray(i)}e.push(h)})}return e},parseDate:function(e){var i=this;var h=Number(e.date);if(i.build==="comments"){if(i.lastComment===null||h>Number(i.lastComment.date)){i.lastComment=e}}var f=new Date(h);var g=f.toString();return g},setDate:function(){return String(Date.now())},getDataComments:function(g){var f=this;if(f.rowID>-1){var e={};c.getCommentsForDataRow(f.rowID,e).done(function(){if(typeof g==="function"){g(e.content)}})}else{g([])}},getDataLikes:function(g){var f=this;if(f.rowID>-1){var e={};c.getLikesForDataRow(f.rowID,e).done(function(){if(typeof g==="function"){g(e.content)}})}else{g([])}},setDataComments:function(f,e,g){var h=this;if(h.rowID>-1){c.setCommentsForDataRow(h.rowID,f).done(function(){if(typeof e==="function"){e()}}).fail(function(){if(typeof g==="function"){g()}})}else{g()}},setDataLikes:function(h,e,f){var g=this;if(g.rowID>-1){c.setLikesForDataRow(g.rowID,h).done(function(){if(typeof e==="function"){e()}}).fail(function(){if(typeof f==="function"){f()}})}else{f()}}};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsIconView",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsUI/SMAAnalyticsFileUpload","DS/SMAAnalyticsUI/SMAAnalyticsArrayPlot","DS/SMAAnalyticsCompareTable/SMAAnalyticsHierarchicalTable","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/TooltipModel","DS/Windows/Dialog","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils"],function(h,k,e,b,p,m,a,d,c,n,g,q,f){b=JSON.parse(b);var l={playInFrame:function(t,v,s,r){var w=document.createElement("iframe");w.onload=function(){w.onload="";s(null,w.contentWindow)};w.src=v;w.style.width="100%";if(typeof r!=="undefined"){w.style.height="calc(100% - 1em)";var x=document.createElement("p");x.style.lineHeight="2em";var u=document.createElement("a");u.href=r+"&asAttachment=true";u.textContent=d.translate("click_to_download");x.appendChild(u);t.appendChild(w);t.appendChild(x)}else{w.style.height="100%";t.appendChild(w)}},setUpPlayOptions:function(s){var r={title:k.getNameForAlternative(s.dataObj.data.rowID,true),fileName:decodeURIComponent(s.file.displayName),fileId:s.file.id,winName:"alt"+s.dataObj.data.rowID+"file"+s.file.id,type:s.file.type,proxURL:k.getCompleteURL(s.file.url),thumbnailURL:s.file.thumbnail,isImage:s.file.isImage,isVideo:s.file.isVideo,altID:s.dataObj.data.rowID,platformId:k.getPlatformId()};return r},playFileGroup:function(u,x){var y=this;var t=5;while(y.nodeName.toLowerCase()!=="data-row"&&t>0){y=y.parentNode;t-=1}var C=["File Viewer"];var v=h("<div/>",{id:"filePlayerContainerDiv"});v[0].classList.add("ra-file-container");var w=[v];var s=[];var B={popOut:false,noTabs:true,maximized:true};B.tabResizeFunctions={};B.tabResizeFunctions["File Viewer"]=function(){var J=h(this)[0];var D=J.querySelectorAll(".ra-file-instance");var L=D.length;console.log("Instance Count: "+L);if(L<=0){}else{var F=Number(J.clientWidth)-30;var G=Number(J.clientHeight)-30;var K=G/F;var H=Math.floor(Math.sqrt(L));if(K<1){H+=1}var E=Math.floor(F/H);var I=E+"px";[].forEach.call(D,function(M){var R=I;var Q=M.scrollHeight;if(M.classList.contains("ra-3dplay-instance")&&E<360){R="360px"}else{if(M.classList.contains("ra-image-instance")){var S=M.querySelector("img");var P=S.naturalHeight;var O=S.naturalHeight/S.naturalWidth;var N=O*E;if(N>P){N=P}M.style.minHeight=N+"px"}}M.style.minWidth=R;M.style.maxWidth=R})}};B.customCloseBehavior=function(){var D=v[0].querySelectorAll("iframe");[].forEach.call(D,function(E){E.src="";E.parentNode.removeChild(E)});return true};var A=y.querySelectorAll("data-val");if(A.length<1){return}var r=l.setUpPlayOptions(A[0]);var z=null;if(typeof u==="function"){z=u(C,w,r.fileName,"sim-ui-compare-popover-play",B)}if(v[0].parentNode!==null){v[0].parentNode.classList.add("ra-yoverflow")}[].forEach.call(A,function(P){var Q=l.setUpPlayOptions(P);var D=document.createElement("div");D.classList.add("ra-file-instance");var M=document.createElement("div");M.classList.add("ra-file-instance-title");M.textContent=Q.title;var I=document.createElement("div");I.classList.add("ra-file-instance-content");D.appendChild(M);D.appendChild(I);var N=Q.type.toLowerCase();var E=typeof Q.thumbnailURL!=="undefined"&&Q.thumbnailURL!==null?Q.thumbnailURL.toLowerCase():"";var L=false;if(N.indexOf("3dxml")>-1||E.indexOf("3dxml")>-1||N.indexOf("cgr")>-1||E.indexOf("cgr")>-1){L=true}if(L||N.indexOf("sim")>-1||N.indexOf("vpmobject")>-1){B.src="./SMAAnalytics3DPlayInstance.html";B.keepContents=false;B.windowCallback=function(R,T){try{T.cell=P;T.file=P.file;T.simNavSyncServerID=x;if(L){T.proxUrl=Q.proxURL}T.platformServices=sessionInfo.platformServices;T.platformId=Q.platformId;T.initialize3DPlay()}catch(S){}};s.push(D);D.classList.add("ra-3dplay-instance");v[0].appendChild(D);l.playInFrame(I,B.src,B.windowCallback,Q.proxUrl)}else{if(Q.isImage===true){var J=h("<img/>",{src:Q.proxURL}).appendTo(h(I));J[0].style.maxWidth="100%";J[0].style.maxHeight="calc(100% - 1em)";H=h("<p />").appendTo(h(I));var G=h("<a/>",{href:Q.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(H);G.click(function(){window.isDownloadLink=true});D.classList.add("ra-image-instance");v[0].appendChild(D)}else{if(Q.isVideo===true&&(Q.type.toLowerCase()==="mp4"||Q.type.toLowerCase()==="ogg"||Q.type.toLowerCase()==="webm")){var O=h("<video />",{type:"video/"+Q.type.toLowerCase(),src:Q.proxURL});O.attr("controls","true");O[0].style.maxWidth="100%";O[0].style.maxHeight="100%";O.appendTo(D);H=h("<p />").appendTo(D);var G=h("<a/>",{href:Q.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(H);G.click(function(){window.isDownloadLink=true});v[0].appendChild(D)}else{try{var F=e.getMimeType(Q.type);if(F!==null&&F.type){h("<object/>",{type:F.type,style:"height:calc(100% - 1em);width:100%"}).attr("data",Q.proxURL).appendTo(D)}else{if(!P.file||!P.file.url||P.file.url===""){h("<div/>",{style:"height:calc(100% - 1em);width:100%;line-height:100%"}).text(d.translate("FILE_DOES_NOT_EXIST")).appendTo(D)}else{h("<iframe/>",{src:Q.proxURL,style:"height:calc(100% - 1em);width:100%"}).appendTo(D)}}H=h("<p />").appendTo(D);var G=h("<a/>",{href:Q.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(H);G.click(function(){window.isDownloadLink=true})}catch(K){var H=h("<p />").appendTo(D);h("<a/>",{href:Q.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(H)}v[0].appendChild(D)}}}});z[0].mazimizeMe();z.resize()},playFile:function(y){var E=this.parentNode;if(typeof E.dataObj==="undefined"||E.dataObj===null){E=this}var F=l.setUpPlayOptions(E);var H=[F.fileName],A=h("<div/>",{id:"filePlayerContainerDiv"}),C=[A];var G={popOut:true,windowName:F.winName,windowTitle:decodeURIComponent(F.fileName),newWinTitle:F.title,noTabs:true};G.customCloseBehavior=function(){var I=A[0].querySelectorAll("iframe");[].forEach.call(I,function(J){J.src="";J.parentNode.removeChild(J)});return true};var u;var B=F.type.toLowerCase();var r=typeof F.thumbnailURL!=="undefined"&&F.thumbnailURL!==null?F.thumbnailURL.toLowerCase():"";var z=false;if(B.indexOf("3dxml")>-1||r.indexOf("3dxml")>-1||B.indexOf("cgr")>-1||r.indexOf("cgr")>-1){z=true}if(z||B.indexOf("sim")>-1||B.indexOf("vpmobject")>-1){G.src="./SMAAnalytics3DPlayInstance.html";G.keepContents=false;G.windowCallback=function(I,K){try{K.cell=E;K.file=E.file;if(z){K.proxUrl=F.proxURL}K.platformServices=sessionInfo.platformServices;K.platformId=F.platformId;K.initialize3DPlay()}catch(J){}};G.tabResizeFunctions={};G.tabResizeFunctions[F.fileName]=function(){var I=document.querySelector("#_3dplayerdiv");if(I===null){return}if(typeof I.parentElement.currentStyle!=="undefined"){I.style.height=I.parentElement.currentStyle.height}else{if(typeof window.getComputedStyle==="function"){I.style.height=window.getComputedStyle(I.parentElement,null).getPropertyValue("height")}}};if(typeof y==="function"){y(H,C,F.title,"sim-ui-compare-popover-play",G)}if(A[0].parentNode!==null){A[0].parentNode.classList.add("ra-yoverflow")}l.playInFrame(A[0],G.src,G.windowCallback,F.proxUrl)}else{if(F.isImage===true){var w=h("<img/>",{src:F.proxURL}).appendTo(A);w[0].style.maxWidth="100%";w[0].style.maxHeight="calc(100% - 1em)";u=h("<p />").appendTo(A);var t=h("<a/>",{href:F.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(u);t.click(function(){window.isDownloadLink=true});var v=new Image();v.onload=function(){var J=v.width,N=v.height;if(J!==0&&N!==0){var L=J/N;var O=h(window).width(),I=h(window).height(),P=O/I;var K=50,M=50;if(J>O-M||N>I-K){if(L>P){J=O-M;N=J/L}else{N=I-K;J=N*L}}}if(typeof y==="function"){y(H,C,F.title,"sim-ui-compare-popover-play",{width:J,height:N,popOut:true,windowName:F.winName,windowTitle:decodeURIComponent(F.fileName)})}};v.src=F.proxURL}else{if(F.isVideo===true&&(F.type.toLowerCase()==="mp4"||F.type.toLowerCase()==="ogg"||F.type.toLowerCase()==="webm")){var D=h("<video />",{type:"video/"+F.type.toLowerCase(),src:F.proxURL});D.attr("controls","true");D[0].style.maxWidth="100%";D[0].style.maxHeight="100%";D.appendTo(A);u=h("<p />").appendTo(A);var t=h("<a/>",{href:F.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(u);t.click(function(){window.isDownloadLink=true});if(typeof y==="function"){y(H,C,F.title,"sim-ui-compare-popover-play",{popOut:true,windowName:F.winName,windowTitle:decodeURIComponent(F.fileName)})}}else{try{var s=e.getMimeType(F.type);if(s!==null&&s.type){h("<object/>",{type:s.type,style:"height:calc(100% - 1em);width:100%"}).attr("data",F.proxURL).appendTo(A)}else{h("<iframe/>",{src:F.proxURL,style:"height:calc(100% - 1em);width:100%"}).appendTo(A)}u=h("<p />").appendTo(A);var t=h("<a/>",{href:F.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(u);t.click(function(){window.isDownloadLink=true})}catch(x){var u=h("<p />").appendTo(A);h("<a/>",{href:F.proxURL+"&asAttachment=true"}).text(d.translate("click_to_download")).appendTo(u)}if(typeof y==="function"){y(H,C,F.title,"sim-ui-compare-popover-play",{popOut:true,windowName:F.winName,windowTitle:decodeURIComponent(F.fileName)})}}}}}};var j=function(){var r=document.createElement("iframe");r.style.width="1px";r.style.height="1px";r.style.position="fixed";r.style.left="-100px";r.style.top="0";r.src="./SMAAnalytics3DPlayInstance.html";document.body.appendChild(r);setTimeout(function(){document.body.removeChild(r)},2000)};var o=function(v,u){var t=null;k.fileList.some(function(w){if(w.id===v){t=w;return true}},this);if(t!==null){var r=t.displayName,s=u.trim();if(s===""){s=t.name}if(r!==s){t.displayName=s;k.setFileName(v,s)}}};var i=function(K){var G=this;j();G.hierarchyLoading=new h.Deferred();G.rendering=new h.Deferred();G.s=K;var P=null;if(typeof G.s.target!=="undefined"&&G.s.target!==null){P=document.querySelector(G.s.target)}else{if(typeof G.s.targetElement!=="undefined"&&G.s.targetElement!==null){P=G.s.targetElement}}G.s.dataHeaderDisplayFunc=G.s.dataHeaderDisplayFunc||function(){var Q=document.createElement("div");Q.setAttribute("data-handle","true");this.appendChild(Q)};G.s.jsonParser=function(R,Q,S){return f.getJSONFromResponse([R,Q,S])};G.s.fixedWidth=40;var A=G.s.getDesign||function(){var S=[];var R=k.getBasketList();for(var Q=0;Q<R.length;Q++){S.push(R[Q])}return S};var r=function(){var S=[];if(!(typeof k.formulation.objectives==="undefined"||k.formulation.objectives.length===0)){var Q=k.getBestDesignsForObjectives();for(var R=0;R<Q.length;R++){S.push(Q[R])}}return S};var D=function(){var S=[];if(!(typeof k.formulation.objectives==="undefined"||k.formulation.objectives.length===0)){var Q=k.getBestDesignsOverall();for(var R=0;R<Q.length;R++){S.push(Q[R])}}return S};var s={getRecommendedDesign:function(){return k.getRecommendedDesign()}};var F=function(R,S){var Q={};k.getFilesForRowIDList(R,Q).done(function(){S(Q.content)})};var u=function(Q,S){var R={};k.getRowListInfo(Q,R).done(function(){S(R.content.elements)})};G.s.params=k.varGroup;G.s.jsonParser=function(R,Q,S){return f.getJSONFromResponse([R,Q,S])};var B=[{name:"basket",label:d.translate("In Basket"),emptyMessage:d.translate("no_alternatives_in_basket"),updateFunction:A,getFilesFunction:F,getDataFunction:u},{name:"bestForObjectives",label:d.translate("Best Per Objective"),emptyMessage:d.translate("no_objectives_set"),updateFunction:r,getFilesFunction:F,getDataFunction:u},{name:"bestOverall",label:d.translate("Best by Score"),emptyMessage:d.translate("no_objectives_set"),updateFunction:D,getFilesFunction:F,getDataFunction:u}];G.s.footerRows=[{name:"Rank",getFunction:function(Q){if(typeof Q!=="undefined"){this.textContent=Q.autoRank}else{console.error("Rank Function: Data Object was not defined")}},changeOn:["grading"]},{name:"Score",getFunction:function(Q){if(typeof Q!=="undefined"){this.textContent=Math.round(Q.totalScore*10000)/10000}else{console.error("Score Function: Data Object was not defined")}},changeOn:["grading"]}];var t=[{name:"displayName",displayHeaderFunction:function(Q){Q.textContent=""},width:"200px",displayFunction:function(Q,R){Q.classList.add("raHTableStringColumn");var T=document.createElement("span");T.classList.add("ra-compare-filename");T.textContent=R;var U=document.createElement("span");U.classList.add("ra-compare-rename");var S=new n({icon:{iconName:"pencil"},displayStyle:"lite"});S.tooltipInfos=new g({shortHelp:d.translate("EDIT_NAME")});S.inject(U);S.addEventListener("click",function(ab){var V=null;try{V=Q.parentElement.parentElement.parentElement.hLink}catch(ab){return}var W=V.dataId;var aa=k.getImmersiveFrame();var Z=document.createElement("div");var Y=new c({value:R}).inject(Z);var X=new q({title:d.translate("Rename File Parameter"),content:Z,immersiveFrame:aa,resizableFlag:true,buttons:{Ok:new n({onClick:function(ac){var ae=Y.value;o(W,ae);var ad=ac.dsModel,af=ad.dialog;af.close()}}),Cancel:new n({onClick:function(ac){var ad=ac.dsModel,ae=ad.dialog;ae.close()}})}})});Q.appendChild(T);Q.appendChild(U);return true},sortFunction:function(R,Q){if(R.rawJSON.displayName.toLowerCase()<Q.rawJSON.displayName.toLowerCase()){return -1}else{if(R.rawJSON.displayName.toLowerCase()>Q.rawJSON.displayName.toLowerCase()){return 1}else{return 0}}},textDirection:"vertical",isHandle:true,displayType:"all"}];if(G.s.playAll3DPlay===true){t.push({name:"playButton",displayHeaderFunction:function(Q){Q.textContent=""},width:"30px",displayFunction:function(Q){var S=document.createElement("span");S.classList.add("play_button");S.textContent="";var R=function(U,T){l.playFileGroup.call(U,G.s.makePopover,T)};S.onclick=function(){var T=this;require(["UWA/Utils/InterCom"],function(U){var V="com.ds.spysync";if(typeof window._3dplaysyncserver==="undefined"){window._3dplaysyncserver=new U.Server(V,{isPublic:true})}R(T,V)},function(){console.error("Failed to load intercom. Opening 3dplay without intercom");R(T)})};Q.classList.add("play-column");Q.appendChild(S)},displayType:"all"});G.s.fixedWidth=80}var L=[{name:"rank",initial:true,sortFunction:function(R,Q){return(parseInt(R.data.autoRank,10)-parseInt(Q.data.autoRank,10))}}];G.s.rowSortFunctions=[{name:"alphaAsc",initial:false,sortFunction:function(S,R){var Q=S.rawJSON.displayName.toLowerCase();var T=R.rawJSON.displayName.toLowerCase();if(Q<T){return -1}else{if(Q>T){return 1}}return 0}},{name:"alphaDsc",initial:false,sortFunction:function(S,R){var Q=S.rawJSON.displayName.toLowerCase();var T=R.rawJSON.displayName.toLowerCase();if(Q<T){return -1}else{if(Q>T){return 1}}return 0}}];var w=function(Q){var T=document.createElement("div");T.setAttribute("class","sim-compare-dropbox");var R=d.translate("DRP_FILES");T.innerHTML='<p class="sim-compare-dropbox-text">'+R+"</p>";var S=new p();S.setUploadWrapperElement(Q);S.uploadFilesWithDragDrop();S.setSuccessCallBack(function(U){k.syncBasketFiles()});return T};var I=function(S,T){var Q=G;var R=document.createElement("ra-hlink");R.dataId=S.id||S.title||"";R.setAttribute("data-id",S.id||S.title||"");R.rawJSON=S;R.rawJSON.ID=S.id||S.title||"";R.rawJSON.displayName=decodeURIComponent(R.rawJSON.displayName||S.title);if(S.hasOwnProperty("pairs")){R.displayValue=function(U){var Y=this;this.file=null;this.rowID=this.dataObj.data.rowID;this.plotID=String(this.rowID)+"_"+U.hLink.rawJSON.ID;this.plotID=this.plotID.replace(/\s+/g,"");var V=new m();var W={height:500,width:500,plot:{width:475,height:475,x:25,y:0,stroke:2},hasAxes:true,hasLabels:true,numTicks:2,needScale:true,hasLegends:false};var X="thumbnail"+this.plotID;if(typeof U.tableRoot.tablePostfix!=="undefined"){X+=U.tableRoot.tablePostfix}V.createSinglePlot(Y,U.hLink.rawJSON,W,this.rowID,X);Y.onclick=function(){var aa=h("<div />",{id:"sim-ui-popover-arrayPlotTab"});var Z;if(this.parentNode.hLink.rawJSON.pairs.length===1){Z={width:550,height:550,plot:{width:500,height:500,x:50,y:25}}}else{Z={plot:{width:550,height:500,x:50,y:25},width:500+0.75*500,height:500+0.1*500}}aa.css("overflow","auto");V.createSinglePlot(aa,this.parentNode.hLink.rawJSON,Z,this.rowID,"popup_0");if(typeof Q.s.makePopover==="function"){Q.s.makePopover([this.parentNode.hLink.rawJSON.title],[h(aa)],k.getNameForAlternative(h(this).attr("rowId"),true),"sim-ui-popover",Z)}h(".sim-ui-popover-mainDiv").css({width:Z.width+100,height:Z.height+100})}}}else{R.displayValue=function(Z){var aa=this;this.setAttribute("data-clickable","true");this.file=null;if(typeof this.dataObj.fileList!=="undefined"){this.dataObj.fileList.forEach(function(af){if(af.id===Z.hLink.dataId){aa.file=af}})}var ad=false;if(typeof this.file!=="undefined"&&this.file!==null){if((typeof this.file.url==="undefined"||this.file.url===null||this.file.url==="")&&this.file.type!=="SIMOBJECT"&&this.file.type!=="VPMOBJECT"){ad=true}}var Y=function(){this.onerror="";if(this.parentNode.file.type===""&&this.parentNode.file.url===""){this.parentNode.insertBefore(w(this),this.nextElementSibling)}else{this.src=b.ICON_LOCATION+"smaAdvieGenericFile.png";var af=document.createElement("span");af.classList.add("fileThumbnailLabel");this.parentNode.insertBefore(af,this.nextElementSibling)}this.parentNode.resize()};var X=function(){this.onload="";this.parentNode.resize();var ag=this.parentNode.parentNode.children;for(var af=1;af<ag.length;af++){if(ag[af].dataset.nofile){ag[af].dataset.height=String(ag[af].parentNode.dataset.height-10)+"px";ag[af].children[0].style.height=ag[af].dataset.height}}};var V=function(af,ag){ag.addEventListener("dragstart",function(ai){if(!ai){ai=window.event}var ah=af.type;if(ah.toLowerCase().indexOf("sim")>-1){ah="DesignSight"}else{if(ah.toLowerCase().indexOf("vpmobject")>-1){ah="VPMReference"}}ai.dataTransfer.effectAllowed="all";ai.dataTransfer.setData("text",JSON.stringify({data:{items:[{contextId:sessionInfo.secCtx,displayName:af.displayName,objectId:af.plmID,serviceId:"3DSpace",objectType:ah,envId:k.getPlatformId()}],protocol:"3DXContent",source:"X3DCSMA_AP",version:"1.0"}}))},false)};if(!ad){var U=document.createElement("img");var ab=null;ab=this.file?this.file.thumbnail:null;if(typeof ab!=="undefined"&&ab!==null&&ab.indexOf("SMAAnalytics")>-1&&!(this.file.type.toLowerCase()==="txt"||this.file.type.toLowerCase()==="pdf")){U.onerror=Y;U.onload=X;U.classList.add("sim-compare-tile-thumbnail-image");U.src=b.ICON_LOCATION+ab+".gif";if(this.file.plmID){U.plmID=this.file.plmID;U.setAttribute("draggable",true);k.getThumbnail(U.plmID).done(function(ag){this.parentNode.resize();U.onload=function(){this.onload="";this.parentNode.resize()};U.onerror=Y;U.setAttribute("src",ag);this.file.thumbnail=ag;try{V(this.file,U)}catch(af){}}.bind(this)).fail(function(af){}.bind(this))}}else{if(typeof ab!=="undefined"&&ab!==null&&!(this.file.type.toLowerCase()==="txt"||this.file.type.toLowerCase()==="pdf")){U.onerror=Y;U.onload=X;if(ab&&ab.indexOf("SMAAnalytics")>-1){U.src=b.ICON_LOCATION+ab+".gif"}else{U.src=k.getCompleteURL(ab)}}else{U.onerror=X;U.onload=X;U.src=b.ICON_LOCATION+"smaAdvieGenericFile.png";this.noThumb=true}}var W="";if(this.file){if(this.file.isVideo){this.classList.add("video-thumbnail")}if(this.file.type.toLowerCase().indexOf("3dxml")>-1||this.file.thumbnail.toLowerCase().indexOf("3dxml")>-1||this.file.type.toLowerCase().indexOf("cgr")>-1||this.file.thumbnail.toLowerCase().indexOf("cgr")>-1||this.file.type.toLowerCase().indexOf("sim")>-1||this.file.type.toLowerCase().indexOf("vpmobject")>-1||this.file.isVideo){this.classList.add("playable-file")}W=this.file.type||""}if(typeof Q.s.makePopover==="function"){this.onclick=function(){l.playFile.call(aa,Q.s.makePopover)}}this.appendChild(U);if(typeof this.noThumb!=="undefined"&&this.noThumb===true){var ae=document.createElement("span");ae.classList.add("fileThumbnailLabel");ae.textContent=W;this.appendChild(ae);this.resize()}}else{var ac=w(this);this.appendChild(ac);this.dataset.nofile=true;this.resize();ac.style.height=String(this.dataset.height-10)+"px"}}}T.appendChild(R)};var y="raIconViewColumns";var E=document.querySelector("#"+y);var z="raIconHierarchy";var x=document.querySelector("#"+z);if(typeof P!=="undefined"&&P!==null){G.element=document.createElement("ra-comparetable");if(E===null){E=document.createElement("ra-fixedcolumns");E.jsonParser=G.s.jsonParser;E.setAttribute("id",y);E.setup(t);document.querySelector("body").appendChild(E)}G.element.setAttribute("data-fixedcolumnsource",y);if(x===null){x=document.createElement("ra-hierarchy");x.jsonParser=G.s.jsonParser;x.setAttribute("id",z);var O=document.createElement("ra-hlink");O.dataId="iconViewTableBase";O.setAttribute("data-id","");O.rawJSON={ID:"iconViewTableBase"};O.linkType="group";var H=function(Q){Q.preventDefault();Q.stopPropagation()};document.getElementById("comparedesignspage").addEventListener("dragover",H,false);document.getElementById("comparedesignspage").addEventListener("drop",H,false);var J=k.getFileList();var M=k.getArrayPlots();var N=J.concat(M);[].forEach.call(N,function(Q){I(Q,O)});x.appendChild(O);document.querySelector("body").appendChild(x)}G.updateHierarchy=G.updateHierarchy||function(){var U=null;if(x===null){return}if(typeof x.children!=="undefined"&&x.children.length===1){U=x.children[0]}var ac=function(ae,ad){if(ad.id===undefined||ae.id<ad.id){return -1}if(ae.id===undefined||ae.id>ad.id){return 1}return 0};var ab=k.getFileList();var R=k.getArrayPlots();var W=ab.concat(R);var T=W.map(function(ad){return{id:ad.id,file:ad}}).sort(ac);var aa=[];if(U!==null){if(typeof U.children!=="undefined"&&U.children.length>0){aa=[].map.call(U.children,function(ad){return{id:ad.rawJSON.id,hlink:ad}}).sort(ac)}}var V=0;var S=T.length;var Y=0;var X=aa.length;while(Y+V<X+S){var Q=!(V<S)?-1:!(Y<X)?1:ac(aa[Y],T[V]);if(Q<0){var Z=aa[Y].hlink;Z.parentNode.removeChild(Z);Y+=1}else{if(Q>0){if(T[V].file!=="empty"){I(T[V].file,U)}V+=1}else{Y+=1;V+=1}}}};G.updateHierarchy();G.forceUpdate=function(){var R=function(X,W){if(W.id===undefined||X.id<W.id){return -1}if(X.id===undefined||X.id>W.id){return 1}return 0};var S=k.getFileList();var U=k.getArrayPlots();var T=S.concat(U);var Q=T.map(function(W){return{id:W.id,file:W}}).sort(R);var V={parameters:Q.map(function(W){return W.file})};G.element.hierarchyChanged(V)};G.element.setAttribute("data-hierarchysource",z);var C=G.s.collectionSource||"raDataCollections";var v=document.querySelector("#"+C);if(v===null){v=document.createElement("ra-datacollections");v.jsonParser=G.s.jsonParser;v.setAttribute("id",C);v.otherFunctions=s;v.sortFunctions=L;v.addCollections(B);document.querySelector("body").appendChild(v)}G.element.setAttribute("data-collectionsource",C);G.element.setAttribute("data-iscomparable","false");P.appendChild(G.element);G.element.initialize(G.s);G.rendering.resolve()}else{G.rendering.resolve()}return G};return{constr:i}});define("DS/SMAAnalyticsUI/SMAAnalyticsPopover",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsTextArea","DS/SMAAnalyticsUI/SMAAnalyticsParamDefinitionEditor","DS/SMAAnalyticsUI/SMAAnalyticsMindMap","DS/SMAAnalyticsUI/SMAAnalyticsArrayPlot","DS/SMAAnalyticsCompareTable/SMAAnalyticsDetailsTable","DS/SMAAnalyticsUI/SMAAnalyticsParameterMap","DS/SMAAnalyticsUI/SMAAnalyticsFileUpload","DS/SMAAnalyticsUI/SMAAnalyticsComments","DS/SMAAnalyticsUI/SMAAnalyticsIconView","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon"],function(j,m,g,a,l,k,n,b,i,o,h,c,e,d){function f(){}f.prototype.makeParamPopover=function(t,K,L){var r=parseInt(t,10);var Z=null;var X=false;var ac="";if(L){if(L.paramID){Z=L.paramID}if(L.isOptimization){X=L.isOptimization}if(L.approximationId&&L.approximationId.length>0){ac=L.approximationId}}var s,Y,A,W,P;var R=[e.translate("Parameters"),e.translate("Comments"),e.translate("Likes"),e.translate("Notes")];s=j('<div id="sim-ui-popover-paramTab"></div>');A=j('<div id="sim-ui-popover-commentTab"></div>');W=j("<div/>",{id:"sim-ui-popover-likeTab"});P=j("<div />",{id:"sim-ui-popover-notesTab"});if(!X){R.push(e.translate("Files"));Y=j('<div id="sim-ui-popover-imageTab"/>');var N=false;var H=null;var C=m.getAllParametersAsFlatList();for(var ab=0;ab<C.length;ab++){if(m.findParameter(C[ab]).structure==="ARRAY"&&(m.findParameter(C[ab]).dataType==="INTEGER"||m.findParameter(C[ab]).dataType==="REAL")){N=true;H=new n();R.push(e.translate("Array Plot"));break}}}var w=null;var z=null;var v={};var ad;var G={isOptimization:X,approximation:ac};m.getRowInfo(r,v,G).done(function(){ad=v.content;if(typeof ad.rowName!="undefined"&&ad.rowName!==null&&ad.rowName.length>0){f.prototype.setTitle(ad.rowName)}var al=ad.parmValues;s[0].setAttribute("data-moreInfoDesignId",r);var ar=j('<div id="sim-ui-popover-parameter-container" class="sim-ui-popover-container"/>').appendTo(s);var an=function(){return s[0]};var ay=j('<div id="sim-ui-popover-interactiveToolbar" class="sim-ui-popover-interactiveToolbar"/>').appendTo(s);var ao=j('<div id="sim-ui-popover-interactiveUpdate-button" class="sim-ui-panel-content-toolbarbutton"/>').appendTo(ay);ao.tooltip({content:"Push to Geometry"});ao.click(function(aB){console.log("Interactive session active");var aC={action:"UpdateParams",parameters:[]};if(ad.parmValues){for(var aA in ad.parmValues){if(ad.parmValues.hasOwnProperty(aA)){var az=m.getInteractiveParamId(aA);if(az){aC.parameters.push({id:az,displayName:az,value:ad.parmValues[aA]})}}}m.sendJson(aC)}});if(!m.isEKActive()){ao.hide()}var aq=document.querySelector("#raMoreInfoDesign");if(aq!==null){aq.updatePrimary()}w=new b.constr({targetElement:ar[0],params:m.varGroup,getDesign:function(){return[parseInt(an().getAttribute("data-moreInfoDesignId"),10)]},collectionSource:"raMoreInfoDesign",fixedWidth:200},new j.Deferred(),m);if(typeof Z!=="undefined"&&Z!==null){var ap=null;ap=new MutationObserver(function(){b.scrollTo(w.element,Z,true);ap.disconnect()});ap.observe(w.element,{attributes:true,attributeFilter:["data-hierarchyloaded"]})}var am=[];var ah=m.getAllParametersAsFlatList();for(var at=0;at<ah.length;at++){if(al[ah[at]]){var ai=m.findParameter(ah[at]);if(ai.structure==="ARRAY"){am.push({param:ai,values:al[ah[at]]})}}}if(N){H.plots(am)}s.css("overflow-y","scroll");s.css("overflow-y","hidden");var ax=j('<div class="comments-area"></div>').appendTo(A);new h({rowID:r,container:ax[0],type:"data",showStats:true,build:"comments"});var ag=j("<div />",{"class":"likes-area"}).appendTo(W);new h({rowID:r,container:ag[0],type:"data",showStats:true,build:"likes"});var aw=j('<div contenteditable="true" class="comments-area"></div>').appendTo(P);var au=j('<div class="comments-area-buttons"></div>').appendTo(P);var ak=j("<button>"+e.translate("Apply Changes")+"</button>").appendTo(au);var aj=j("<button>"+e.translate("Revert Changes")+"</button>").appendTo(au);var av=new a({target:aw,saveButton:ak,revertButton:aj,getFunction:function(az){return m.getNotesForRowID(r,az)},saveFunction:function(az){m.setNotesForRowID(r,az)}});av.update()});if(!X){var B=j('<div id="sim-ui-popover-interactiveToolbar" class="sim-ui-popover-interactiveToolbar"/>').appendTo(Y);var S=j('<div id="sim-ui-popover-interactiveGetImage-button" class="sim-ui-panel-content-toolbarbutton"/>').appendTo(B);S.tooltip({content:"Add thumbnail from Geometry"});S.click(function(ag){if(m.isEKActive()){m.spinnerControlShow(true);f.prototype.ekListener={uploaded:false,onText:function(){},onBinary:function(al){var ak=parseInt(p().getAttribute("data-moreInfoDesignId"),10);if(this.uploaded){m.removeEKMessageHandler(this)}try{var ai=new File([al],"InteractiveImage.png",{type:"image/png"});var ah=o.prototype.submitUploadForm("","__"+e.translate("Thumbnail"),ak,ai);ah.done(function(){m.removeEKMessageHandler(f.prototype.ekListener);m.syncBasketFiles().done(function(){var am=document.querySelector("#raMoreInfoDesign");if(am!==null){am.parentNode.removeChild(am)}f.prototype.closePopover();L.selectedItem=1;f.prototype.makeParamPopover(t,K,L)});m.spinnerControlHide(true)})}catch(aj){console.log(aj)}this.uploaded=true;f.prototype.ekListener=null}};m.addEKMessageHandler(f.prototype.ekListener);m.sendJson({action:"GetImage"})}});if(!m.isEKActive()){S.hide()}var T=j('<div id="sim-ui-popover-images-container" class="sim-ui-popover-container"/>').appendTo(Y);Y[0].setAttribute("data-moreInfoDesignId",r);var p=function(){return Y[0]};var I=document.querySelector("#raMoreInfoDesign");if(I!==null){I.updatePrimary()}function u(){if(z!==null){T[0].innerHTML="";z=null}z=new c.constr({targetElement:T[0],params:m.varGroup,getDesign:function(){return[parseInt(p().getAttribute("data-moreInfoDesignId"),10)]},collectionSource:"raMoreInfoDesign",fixedWidth:40,tablePostfix:"_moreInfo",makePopover:f.prototype.makePopover})}u()}var x=[s,A,W,P];if(!X){x.push(Y)}if(N){var E=j('<div id="sim-ui-popover-arrayPlotTab"></div>');E.css("overflow","scroll");x.push(E)}var M=r;var J,U;if(m.isInBasket(Number(r))===-1){J="sim-ui-popover-basketButton-add";U=e.translate("Add to Basket")}else{J="sim-ui-popover-basketButton-remove";U=e.translate("Remove from Basket")}var Q=j('<div class="sim-ui-popover-footerButton" id="basketButton">');j("<div>",{id:"basketButtonIcon","class":J}).appendTo(Q);j('<div class="sim-ui-popover-buttonText">').appendTo(Q).text(U).click(function(ag){ag.stopPropagation();j("#basketButtonIcon").toggleClass("sim-ui-popover-basketButton-remove sim-ui-popover-basketButton-add");if(m.isInBasket(Number(r))>-1){m.removeFromBasket(Number(r));j("#basketButton .sim-ui-popover-buttonText").text(e.translate("Add to Basket"))}else{m.addToBasket(Number(r));j("#basketButton .sim-ui-popover-buttonText").text(e.translate("Remove from Basket"))}});var af,D;if(m.isIncluded(r)){af="sim-ui-popover-excludeButton-exc";D=e.translate("Exclude Alt")}else{af="ui-icon ui-icon-plusthick sim-ui-popover-excludeButton-inc";D=e.translate("Include Alt")}var ae=function(ag){ag.stopPropagation();j("#excludeButtonIcon").toggleClass("sim-ui-popover-excludeButton-exc sim-ui-popover-excludeButton-inc ui-icon ui-icon-plusthick");if(m.isIncluded(r)){m.excludePoints([r]);j("#excludeButton .sim-ui-popover-buttonText").text(e.translate("Include Alt"))}else{m.includePoints([r]);j("#excludeButton .sim-ui-popover-buttonText").text(e.translate("Exclude Alt"))}};var aa=j('<div class="sim-ui-popover-footerButton" id="excludeButton">');j("<div>",{id:"excludeButtonIcon","class":af}).appendTo(aa);j('<div class="sim-ui-popover-buttonText">').appendTo(aa).text(D).click(ae);if(!X){var F=j('<div class="sim-ui-popover-footerButton" id="uploadButton">');j("<div>",{id:"sim-ui-popover-uploadButton","class":"ui-icon ui-icon-plusthick sim-ui-popover-excludeButton-inc"}).appendTo(F);j('<div class="sim-ui-popover-buttonText">').appendTo(F).text(e.translate("Upload Files"));var O=new o();O.setUploadWrapperElement(F);O.setDesignToAssociateFileWith(r);O.setIfAllowDragDrop(false);O.setSuccessCallBack(function(ag){if(z!==null){z.element.updateFiles(function(){z.updateHierarchy();z.element.updateContent();z.element.resize()})}m.syncBasketFiles();return true});O.uploadFiles()}var V=(typeof L!=="undefined"&&typeof L.selectedItem!=="undefined")?L.selectedItem:0;var y={type:"buttons",content:[Q,aa,F]};if(N){var q=function(){var ag=H.retrieveSaveData();m.setArrayPlots(ag);return true};L={footerOptions:y,selectedItem:V,width:1000,height:750};L.customCloseBehavior=q}else{L={footerOptions:y,selectedItem:V,width:650,height:400}}L.tabResizeFunctions={};L.tabPostFunctions={};L.tabResizeFunctions[R[0]]=function(){if(w!==null){w.element.resize()}};if(!X){L.tabPostFunctions[R[4]]=function(){if(z!==null){z.updateHierarchy();z.element.resize()}return true};L.tabResizeFunctions[R[4]]=function(){if(z!==null){z.element.resize()}}}L.titleEditCallback=function(ai){var ah=j(ai.target);var ag=ah.val();m.setNameForRow(r,ag).done(function(){f.prototype.setTitle(m.rowNameMap[r]||M)})};f.prototype.makePopover(R,x,M,"sim-ui-popover-paramPopover",L)};f.prototype.makeEditPopover=function(){function B(){var I=j(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data();if(f.prototype.ifFormulationLocked()){return true}if(I.saved===true||confirm(e.translate("not_saved_confiirm_msg"))){return true}else{return false}}var u=new k();var E=new l();var r={varGroupCopy:m.getGroupCopy(m.varGroup),formulationMap:g.getFormulationMap(),saved:true};var F=[e.translate("Parameter Hierarchy"),e.translate("Parameter Definitions"),e.translate("Parameter Comment Log")],D=j("<div>"),x=j("<div>"),G=j("<div>"),A=[D,x,G],H=e.translate("Edit Parameters");var y={type:"button",content:f.prototype.getParameterDialogSaveButton()};var q={tabChangeFunctions:{},tabPostFunctions:{},footerOptions:y};q.tabChangeFunctions[F[0]]=function(){return u.mindMapChangeFunction()};q.tabChangeFunctions[F[1]]=function(){return E.PDEParamChangeCheck()};function p(J,I){u.setContainerDiv(J);u.setPopoverData(I);u.makeMindmap()}function w(J,I){E.setParentContainerDiv(J);E.setPopoverData(I);E.makeParamDefinitionEditor()}q.tabPostFunctions[F[0]]=p;q.tabPostFunctions[F[1]]=w;q.customCloseBehavior=B;var v=j('<div contenteditable="true" class="comments-area"></div>').appendTo(G),C=j('<div class="comments-area-buttons"></div>').appendTo(G),t=j("<button>"+e.translate("Apply Changes")+"</button>").appendTo(C),s=j("<button>"+e.translate("Revert Changes")+"</button>").appendTo(C);var z=new a({target:v,saveButton:t,revertButton:s,getFunction:function(){return m.ajax({url:"executeCommand",data:{commandName:"getAdviseCaseInfo",info:"parameterNotes"}})},saveFunction:function(I){m.ajax({url:"executeCommand",data:{commandName:"setAdviseCaseInfo",parameterNotes:encodeURIComponent(I)}})}});z.update();f.prototype.makePopover(F,A,H,"sim-ui-popover-editPopover",q,r)};f.prototype.saveParameterDialogChanges=function(){var q=j("#sim-ui-popover-editPopover");if(q.find(".sim-ui-popover-tabTitles").data().runBeforeChange(true)){var p=q.data().formulationMap;var r=q.data().varGroupCopy;p.saveChanges();m.setGroupInfo(r);return true}else{return false}};f.prototype.ifFormulationLocked=function(){var q=j(".sim-ui-popover-contentDiv").find(".sim-ui-mindMap-containerDiv");try{if(q.length>0){if(m.isFormulationLocked()){return true}}}catch(p){return false}};f.prototype.getParameterDialogSaveButton=function(){var p=null;p=j('<button style="margin:4px;">Apply</button>').on("click",function(){var q=j(".sim-ui-popover-contentDiv").parents(".sim-ui-popover-mainDiv:first").data();if(f.prototype.ifFormulationLocked()){d.alertMessage(d.ERROR,e.translate("formulation_locked_msg"));return}j(p).attr("disabled","disabled");m.doTransaction(function(){f.prototype.saveParameterDialogChanges()}).done(function(){j(p).removeAttr("disabled");q.saved=true}).fail(function(r){d.ERROR,d.alertMessage(e.translate("Saving changes failed"));console.log(r);j(p).removeAttr("disabled")})});return p};f.prototype.closePopover=function(){var q=j(".sim-ui-popover-rootDiv");var p=q.children(".sim-ui-popover-mainDiv");if(p.height()!==j(window).height()||p.width()!==j(window).width()){m.setPopupDim(p.attr("id"),p.css("width"),p.css("height"),p.css("left"),p.css("top"))}q.remove()};f.prototype.makeArrayMeasurePopover=function(q,x,z){var y=this;var H=null,r=[];if(q.dimensions.length>1){H=j("<div>",{"class":"arraySliceDiv"}).append("<span>Array Slice: </span>");var G,F,E;var s=function(L){console.log(j(this).val());r[L.data.dropIndex]=Number(j(this).val())};var C=function(L){r.push(0);G=j("<select>").appendTo(H);for(E=0;E<q.dimensions[L];E++){G.append("<option>"+E+"</option>")}G.change({dropIndex:L},s)};for(F=0;F<q.dimensions.length-1;F++){C(F)}}var v="Mean";var J=function(){v=j(this).val()};var t=j("<select>").append('<option value = "Mean">'+e.translate("Mean")+"</option>").append('<option value = "Median">'+e.translate("Median")+"</option>").append('<option value = "Mode">'+e.translate("Mode")+"</option>").append('<option value = "Min">'+e.translate("Min")+"</option>").append('<option value = "Max">'+e.translate("Max")+"</option>").change(J);var w=j("<div>",{"class":"measureDiv"}).append("<span>"+e.translate("Measure noun")+" </span>").append(t);var A=j("<div>").append(H).append(w);var I=[e.translate("Create derived parameter")],D=[A],K=e.translate("Create measure on array"),p="sim-ui-popover-arrayMeasurePopover";var B=function(){var L=j('<button style="margin:4px;">Create</button>').on("click",function(){y.closePopover();m.createMeasureColumn(q.ID,v.toLowerCase(),r)});return L};var u={noTabs:true,footerOptions:{type:"button",content:B},customCloseBehavior:function(){return confirm(e.translate("exit_param_creation_msg"))}};f.prototype.makePopover(I,D,K,p,u)};f.prototype.setTitle=function(s){var r=j(".sim-ui-popover-rootDiv");var q=r.find("h3#popover-title").first();var p=r.find("input#popover-title-input").first();if(p.length>0){p.val(m.rowNameMap[s]||s)}else{q.text(m.rowNameMap[s]||s)}};f.prototype.makePopover=function(S,N,T,p,z,B){var J={};if(typeof z==="undefined"){z={}}var x=j('<div class="sim-ui-popover-rootDiv">').appendTo(document.body);var F=j(window).height(),H=j(window).width();var u=typeof z.maximized==="boolean"?z.maximized:false;var L=j('<div class="sim-ui-popover-mainDiv">').appendTo(x),t=j('<div class="sim-ui-popover-headerDiv">').appendTo(L),M=j('<div class="sim-ui-popover-contentDiv">').appendTo(L),A=j('<div class="sim-ui-popover-footerDiv">').appendTo(L);if(B){L.data(B)}if(typeof z.footerOptions!=="undefined"){if(z.footerOptions.type==="button"){A.append(z.footerOptions.content)}else{if(z.footerOptions.type==="buttons"){for(var Q=0;Q<z.footerOptions.content.length;Q++){A.append(z.footerOptions.content[Q])}}}}if(z&&typeof p!=="undefined"){L.attr("id",p)}var I;if(z&&z.titleEditCallback&&typeof z.titleEditCallback==="function"){I=j('<h3 id="popover-title" class="sma-popover-title">').css("padding","1px").appendTo(t);I.text(e.translate("Alternative")+" ");var w=j('<input id="popover-title-input" class="sma-popover-title-input">').val(T).appendTo(I);w.change(z.titleEditCallback)}else{I=j('<h3 id="popover-title" class="sma-popover-title">').text(T).appendTo(t);I.attr("title",T)}if(z.noTabs===true){f.prototype.makeTablessDiv(M,N,z)}else{f.prototype.makeTabbedDiv(M,S,N,z)}if(m.getPopupDim(L.attr("id"))!==null){var K=m.getPopupDim(L.attr("id"));L.css("height",K.height);L.css("width",K.width);L.css("left",K.left);if(typeof K.top==="string"){var v=K.top.indexOf("px");var C=K.top;if(v>0){C=C.substring(0,v)}var R=parseInt(C);K.top=Math.max(0,R)+"px"}L.css("top",K.top)}else{if(z.width){L.css("width",Math.min(H,z.width))}if(z.height){L.css("height",Math.min(F,z.height))}L.css({left:Math.max(0,H/2-L.width()/2)+"px",top:Math.max(0,F/2-L.height()/2)+"px"})}if(A.height()>0){M.css("bottom",A.height()+"px")}j('<div class="sim-ui-popover-backDiv">').appendTo(x).bind("click",function(){O()});function E(U,Y){var V=Y.element.find(".sim-ui-popover-tabTitles");if(V.length>0){var X=V.data("currentTabName");var W=this.querySelector('[data-contentTitle="'+X+'"]');if(typeof z.tabResizeFunctions!=="undefined"&&typeof z.tabResizeFunctions[X]==="function"){z.tabResizeFunctions[X].call(W)}}else{if(typeof S!=="undefined"&&S.length===1&&z.tabResizeFunctions!=="undefined"&&typeof z.tabResizeFunctions[S[0]]){z.tabResizeFunctions[S[0]].call(Y.element.find(".sim-ui-popover-contentDiv"))}}}L.resizable({minHeight:200,minWidth:525,stop:E});L.draggable({scroll:false,handle:".sim-ui-popover-headerDiv",containment:"parent"});var G=j('<div title="'+e.translate("Maximize")+'" class="ui-icon ui-icon-newwin" style="cursor:pointer; position:absolute; top: 5px; right:20px;"></div>').appendTo(t);var y=null;if(typeof z.popOut!=="undefined"&&z.popOut===true){y=j('<div title="'+e.translate("Open in New Window")+'" class="ui-icon ui-icon-extlink" style="cursor:pointer; position:absolute; top: 5px; right:35px;"></div>').appendTo(t)}var s=j('<div class="ui-icon ui-icon-closethick" style="cursor:pointer; position:absolute; top: 5px; right:5px;"></div>').appendTo(t);s.bind("click",function(){O()});if(y!==null){y.bind("click",function(){var X=M[0].querySelector(".sim-ui-popover-tabsBody")||M[0];var U=X.clientWidth;var W=X.clientHeight;var Z="";if(typeof z.src!=="undefined"&&z.src!==null){Z=z.src}var V="";if(typeof z.windowName!=="undefined"&&z.windowName!==null){V=z.windowName}var Y=window.open(Z,V,"modal=yes,width="+U+",height="+W);if(Z===""&&(typeof z.keepContents==="undefined"||z.keepContents)){Y.document.body.appendChild(X.firstChild)}Y.onload=function(){if(z.windowCallback){var ab="";if(typeof z.newWinTitle!=="undefined"&&z.newWinTitle!==null){ab+=z.newWinTitle}if(typeof z.windowTitle!=="undefined"&&z.windowTitle!==null){if(ab!==""){ab+=" - "}ab+=z.windowTitle}if(ab!==""){Y.document.title=ab}var aa=null;if(Z===""&&(typeof z.keepContents==="undefined"||z.keepContents)){aa=j(Y.document.querySelector("#filePlayerContainerDiv"))}else{aa=j(Y.document.body)}z.windowCallback(aa,Y)}};s.click()})}var D=null;D=function(){var X=G;X.unbind("click",D);X.bind("click",P);X.removeClass("ui-icon-newwin");X.addClass("ui-icon-minus");G.attr("title","Minimize");if(L.height()!==x.height()||L.width()!==x.width()){m.setPopupDim(L.attr("id"),L.css("width"),L.css("height"),L.css("left"),L.css("top"))}L.css("height","100%");L.css("width","100%");L.css("top",0);L.css("left",0);u=true;L.draggable("disable");L.resizable("disable");L.css({border:"none",opacity:"1","border-radius":"0px","-moz-border-radius":"0px"});if(z&&z.customResizeBehaviour){z.customResizeBehaviour(B,true)}var U=L.find(".sim-ui-popover-tabTitles");if(U.length>0){var W=U.data("currentTabName");var V=L[0].queryselector('[data-contentTitle="'+W+'"]');if(typeof z.tabResizeFunctions!=="undefined"&&typeof z.tabResizeFunctions[W]==="function"){z.tabResizeFunctions[W].call(V)}}else{if(typeof S!=="undefined"&&S.length===1&&z.tabResizeFunctions!=="undefined"&&typeof z.tabResizeFunctions[S[0]]){z.tabResizeFunctions[S[0]].call(L[0].querySelector(".sim-ui-popover-contentDiv"))}}};var P=null;P=function(){var X=G;X.unbind("click",P);X.bind("click",D);X.removeClass("ui-icon-minus");X.addClass("ui-icon-newwin");G.attr("title","Maximize");var Y=m.getPopupDim(L.attr("id"));if(Y!==null){L.css("height",Y.height);L.css("width",Y.width);L.css("left",Y.left);L.css("top",Y.top)}u=false;L.draggable("enable");L.resizable("enable");L.css({border:"",opacity:"","border-radius":"","-moz-border-radius":""});if(J.resize){J.resize()}if(z&&z.customResizeBehaviour){z.customResizeBehaviour(B,false)}var U=L.find(".sim-ui-popover-tabTitles");if(U.length>0){var W=U.data("currentTabName");var V=this.querySelector('[data-contentTitle="'+W+'"]');if(typeof z.tabResizeFunctions!=="undefined"&&typeof z.tabResizeFunctions[W]==="function"){z.tabResizeFunctions[W].call(V)}}else{if(typeof S!=="undefined"&&S.length===1&&z.tabResizeFunctions!=="undefined"&&typeof z.tabResizeFunctions[S[0]]){z.tabResizeFunctions[S[0]].call(L[0].querySelector(".sim-ui-popover-contentDiv"))}}};G.bind("click",D);function r(){if(L.height()!==j(window).height()||L.width()!==j(window).width()){m.setPopupDim(L.attr("id"),L.css("width"),L.css("height"),L.css("left"),L.css("top"))}var U=document.querySelector("#raMoreInfoDesign");if(U!==null){U.parentNode.removeChild(U)}x.remove()}function O(){if(z&&z.customCloseBehavior){if(z.customCloseBehavior(B)){r()}}else{r()}}function q(){}J.resize=function(){if(!u){if(L.width()>x.width()-4){L.width(x.width()-4)}if(L.height()>x.height()){L.height(x.height()-4)}if(L.offset().left+L.outerWidth()>x.outerWidth()){L.css("left",x.outerWidth()-L.outerWidth()+"px")}if(L.offset().top+L.outerHeight()>x.outerHeight()){L.css("top",x.outerHeight()-L.outerHeight()+"px")}}};J.resize();x.data("eventHandlers",J);L[0].mazimizeMe=function(){G.click()};return L};f.prototype.makeTablessDiv=function(r,p,q){if(p.length>1){throw"Use tabbed divs in popover for contentList.length > 1"}p[0].appendTo(r)};f.prototype.makeTabbedDiv=function(r,s,v,A){if(s.length!==v.length){throw new Error("ERROR: contentList length must equal titleList length","case.jsp")}if(A&&A.noScroll){j(r).css("overflow","hidden")}var y=j('<div class="sim-ui-popover-tabsHead">').appendTo(r),u=j('<div class="sim-ui-popover-tabsBody">').appendTo(r),q=j('<ul class="sim-ui-popover-tabTitles">').appendTo(y);q.data("runBeforeChange",function(){return true});function p(D,C,B){return function(){if(q.data().currentTabName&&q.data().currentTabName===B){return}if(q.data().runBeforeChange()){if(A&&A.tabChangeFunctions&&A.tabChangeFunctions[B]){q.data("runBeforeChange",A.tabChangeFunctions[B])}else{q.data("runBeforeChange",function(){return true})}if(A&&A.tabPostFunctions&&A.tabPostFunctions[B]){A.tabPostFunctions[B](D,r.parents(".sim-ui-popover-mainDiv:first").data())}u.children("div").removeClass("show-tab").addClass("hidden").css("display","");D.addClass("show-tab").removeClass("hidden");y.find("li").removeClass("sim-ui-popover-activeHead");C.addClass("sim-ui-popover-activeHead");if(A&&A.tabResizeFunctions&&A.tabResizeFunctions[B]){A.tabResizeFunctions[B].call(u[0])}q.data("currentTabName",B)}}}for(var t=0;t<s.length;t++){var x=(A&&A.titles&&A.titles[s[t]])||s[t];var w=v[t].get(0).tagName==="DIV"?v[t]:j("<div>").append(v[t]);w.attr("data-contentTitle",x);w.appendTo(u).addClass("sim-ui-popover-tabDiv");var z=j("<li>").append(j('<a class="unselectable-element">').text(x)).appendTo(q);z.click(p(w,z,s[t]))}r.find(".sim-ui-popover-tabDiv:first").removeClass("hidden");y.find("li:first").addClass("sim-ui-popover-activeHead");if(A.selectedItem){q.find("li:eq("+A.selectedItem+")").trigger("click")}else{q.find("li:eq(0)").trigger("click")}return r};return f.prototype});define("DS/SMAAnalyticsUI/SMAAnalyticsBasket",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,c,d,a){b.widget("sim.adviseBasket",{options:{option2:b.noop},_create:function(){this.basketIcon=this.element.find("#basket-icon");this.basketCountDiv=this.element.find(".sim-ui-basket-count");this.basketCountDiv.hide();this.basketListDiv=this.element.find(".sim-ui-basket-popover");this.basketListDiv.hide();this.basketIcon.tooltip();this.blankDiv=b('<div id="sim-ui-blank-div" class="sim-ui-blank-div" />').insertBefore(this.basketListDiv).click(this.closeBasketAction).hide();var e=this;this.closeBasketAction=function(){e.blankDiv.hide();e.basketListDiv.hide();b(e.basketIcon).tooltip()};this.openBasketAction=function(){if(e.basketListDiv.is(":visible")){b(e.basketIcon).tooltip();e.basketListDiv.hide();if(e.blankDiv){b(e.blankDiv).hide()}return}b(e.blankDiv).show();e.basketListDiv.show();b(".sim-ui-basket-list-remove-cell, .sim-ui-basket-list-recommend-cell").tooltip();b(e).find("#basket-icon").tooltip("option","disabled",true)};this.basketListDiv.click(function(f){f.preventDefault();f.stopPropagation();return false});this.element.click(this.openBasketAction);this.refresh()},_init:function(){},refresh:function(){var m=c.getBasketCount();this.basketCountDiv.text(m);if(m==0){this.basketCountDiv.hide()}else{this.basketCountDiv.show()}this.basketListDiv.html("");var l=b('<div class="sim-ui-basket-header"/>').append('<img src="./assets/icons/basket_small.png" />').append(a.translate("Basket"));b('<span class="sim-ui-basket-close" />').appendTo(l).click(this.closeBasketAction);l.appendTo(this.basketListDiv);var n=28;var g=b('<div class="sim-ui-basket-list"/>');var p=c.getBasketList();var k=c.getBasketRankList();var v=c.getRecommendedDesign();if(!(v instanceof Array)){v=[v]}var o=[];for(var j=0,s=p.length;j<s;j++){o[j]={};o[j].rowId=parseInt(p[j],10);if(k.length>0){o[j].rank=parseInt(k[j],10)}var r=parseInt(p[j],10);if(v.contains(r)){o[j].isRecommended=true}else{o[j].isRecommended=false}o[j].designName=c.getNameForAlternative(o[j].rowId,true)}if(k.length>0){o.sort(function(w,i){return w.rank-i.rank})}var q=this;var f=31;var e=p.length>10?10:p.length;var t=f*e+8+n+10;this.basketListDiv.css("height",t);if(o.length===0){this.basketListDiv.text(a.translate("no_alternatives_in_basket"))}else{var h=c.getBasketColorMap();var u=b('<table class="sim-ui-basket-list-table"/>').appendTo(g);o.forEach(function(i){var x=i.rowId;var z=i.rank;var B=i.designName||a.translate("Alt_val",x);var A=i.isRecommended;var y=b('<tr class="sim-ui-basket-list-row" />').appendTo(u);b('<td class="sim-ui-basket-list-entry" />').append(b('<span class="sim-ui-basket-design-color" />').css("background-color",h(x))).append(b('<span class="sim-ui-basket-design-name" />').text(B)).attr("title",B).appendTo(y);b('<td class="sim-ui-basket-list-rank"/>').attr("title",a.translate("Rank_val",parseInt(z,10))).text(parseInt(z,10)).appendTo(y);b('<td class="sim-ui-basket-list-more-info"/>').attr("title",a.translate("More Info")).click(function(C){if(d.makeParamPopover){d.makeParamPopover(x)}C.preventDefault();C.stopPropagation();return false}).appendTo(y);b('<td class="sim-ui-basket-list-remove-cell"/>').attr("title",a.translate("Remove from Basket")).click(function(C){c.removeFromBasket(x);q.refresh();C.preventDefault();C.stopPropagation();return false}).appendTo(y);var w=b('<td class="sim-ui-basket-list-recommend-cell" />').data("rowId",x).appendTo(y).click(function(){b(".sim-ui-basket-list-recommend-cell.recommended").removeClass("recommended");b(this).addClass("recommended");c.setRecommendedDesign(parseInt(b(this).data("rowId"),10));q.refresh()});if(A){w.addClass("recommended");w.attr("title",a.translate("Currently Recommended Alternative"))}else{w.attr("title",a.translate("Recommend This Alternative"))}})}g.appendTo(this.basketListDiv)}});return b});define("DS/SMAAnalyticsUI/SMAAnalyticsECommerceTable",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsCompareTable/SMAAnalyticsHierarchicalTable","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils"],function(b,f,g,e,h,a,c){var d=function(B){var A=this;A.rendering=new b.Deferred();A.s=B;var E=document.querySelector(A.s.target);A.s.fixedWidth=300;var r=A.s.getDesign||function(){var H=[];var G=f.getBasketList();for(var F=0;F<G.length;F++){H.push(G[F])}return H};var i=function(){var H=[];if(typeof f.formulation.objectives!=="undefined"&&f.formulation.objectives.length>0){var F=f.getBestDesignsForObjectives();for(var G=0;G<F.length;G++){H.push(F[G])}}return H};var v=function(){var H=[];if(typeof f.formulation.objectives!=="undefined"&&f.formulation.objectives.length>0){var F=f.getBestDesignsOverall();for(var G=0;G<F.length;G++){H.push(F[G])}}return H};var j={getRecommendedDesign:function(){return f.getRecommendedDesign()}};var x=function(G,H){var F={};f.getFilesForRowIDList(G,F).done(function(){H(F.content)})};var m=function(F,H){var G={};f.getRowListInfo(F,G).done(function(){H(G.content.elements)})};var y=function(G){var F=typeof event!=="undefined"?event:G;if(F!==null){F.preventDefault?F.preventDefault():(F.returnValue=false);F.stopPropagation?F.stopPropagation():(F.cancelBubble=true)}f.setRecommendedDesign(parseInt(this.dataObj.dataId,10))};var s=function(H){var G=typeof event!=="undefined"?event:H;if(typeof G!=="undefined"&&G!==null){G.preventDefault?G.preventDefault():(G.returnValue=false);G.stopPropagation?G.stopPropagation():(G.cancelBubble=true)}var F=this.dataObj.isInPrimary();if(F){f.removeFromBasket(this.dataObj.dataId)}else{f.addToBasket(this.dataObj.dataId)}};var l=function(H){var F=typeof event!=="undefined"?event:H;if(typeof F!=="undefined"&&F!==null){F.preventDefault?F.preventDefault():(F.returnValue=false);F.stopPropagation?F.stopPropagation():(F.cancelBubble=true)}var G=this.dataObj.dataId;g.makeParamPopover(G,null,{selectedItem:1})};var z=function(H){var F=typeof event!=="undefined"?event:H;if(typeof F!=="undefined"&&F!==null){F.preventDefault?F.preventDefault():(F.returnValue=false);F.stopPropagation?F.stopPropagation():(F.cancelBubble=true)}var G=this.dataObj.dataId;g.makeParamPopover(G,null,{selectedItem:2})};A.s.dataHeaderDisplayFunc=function(G,L){var I=document.createElement("div");I.setAttribute("data-handle","true");var K=document.createElement("div");K.classList.add("datahead-hasbuttons");var P=document.createElement("h1");K.appendChild(P);var O=document.createElement("button");O.classList.add("ra-comment-make");O.setAttribute("title",a.translate("Comments"));O.dataObj=G;O.onclick=l;K.appendChild(O);var H=document.createElement("button");H.classList.add("ra-comment-like");H.setAttribute("title",a.translate("Likes"));H.dataObj=G;H.onclick=z;K.appendChild(H);var J=document.createElement("button");J.classList.add("basketButton");J.setAttribute("title",a.translate("Remove from Basket"));J.dataObj=G;J.onclick=s;K.appendChild(J);var M=document.createElement("button");M.classList.add("recommendButton");M.setAttribute("title",a.translate("Recommend This Alternative"));M.dataObj=G;M.onclick=y;K.appendChild(M);I.appendChild(K);var N=document.createElement("div");N.classList.add("smaAdviseHeaderImgContainer");var Q=document.createElement("div");Q.classList.add("missing-image");N.appendChild(Q);var F=document.createElement("img");N.appendChild(F);I.appendChild(N);F.rowheader=L;if(L){F.onload=function(){this.startCollectionReset();this.rowheader.resize()};F.onerror=function(){this.startCollectionReset();this.rowheader.resize()}}this.appendChild(I)};A.s.params=f.varGroup;A.s.jsonParser=function(G,F,H){return c.getJSONFromResponse([G,F,H])};var t=[{name:"basket",label:a.translate("In Basket"),updateFunction:r,getFilesFunction:x,getDataFunction:m},{name:"bestForObjectives",label:a.translate("Best Per Objective"),updateFunction:i,getFilesFunction:x,getDataFunction:m},{name:"bestOverall",label:a.translate("Best by Score"),updateFunction:v,getFilesFunction:x,getDataFunction:m}];A.s.footerRows=[{name:a.translate("Rank"),getFunction:function(F){if(typeof F!=="undefined"){this.textContent=F.autoRank}else{console.error("Rank Function: Data Object was not defined")}},changeOn:["grading"]},{name:a.translate("Score"),getFunction:function(F){if(typeof F!=="undefined"){this.textContent=Math.round(F.totalScore*10000)/10000}else{console.error("Score Function: Data Object was not defined")}},changeOn:["grading"]}];var k=[{name:"displayName",displayHeaderFunction:function(F){F.textContent=a.translate("Parameter Name");F.setAttribute("title",a.translate("Parameter Name"))},colWidthShrinkToFit:true,width:A.s.fixedWidth+"px",displayFunction:function(F,H){if(!F.classList.contains("ra-indented")){F.classList.add("ra-indented")}F.innerHTML="";var G=document.createElement("div");if(typeof H==="string"){G.textContent=H;G.title=H}F.appendChild(G);return true},sortFunction:function(G,F){if(G.rawJSON.displayName.toLowerCase()<F.rawJSON.displayName.toLowerCase()){return -1}else{if(G.rawJSON.displayName.toLowerCase()>F.rawJSON.displayName.toLowerCase()){return 1}else{return 0}}},isHandle:true,displayType:"all",resizableColumn:true},{name:"unit",displayHeaderFunction:function(F){F.textContent=a.translate("Units");F.setAttribute("title",a.translate("Units"))},width:"50px",displayFunction:function(F,G){if(typeof G==="string"){F.textContent=G;F.title=G}return true},sortable:false,displayType:"general",resizableColumn:true},{name:"priority",displayHeaderFunction:function(F){F.classList.add("imageReplacement");F.classList.add("smaAdvise-Compare-PriorityHeader");F.textContent=a.translate("Priority");F.setAttribute("title",a.translate("Priority"))},width:"35px",displayFunction:function(F,G){if(typeof G==="string"||typeof G==="number"){if(0===parseInt(G,10)){F.textContent="MH"}else{F.textContent=G}F.classList.add("smaAdvise-compare-prioritycol")}return true},sortFunction:function(G,F){return(parseInt(G.rawJSON.priorityWeight,10)-parseInt(F.rawJSON.priorityWeight,10))},displayType:"general",resizableColumn:true},{name:"objective",displayHeaderFunction:function(F){F.classList.add("imageReplacement");F.classList.add("smaAdvise-Compare-ObjectiveHeader");F.textContent=a.translate("Objective");F.setAttribute("title",a.translate("Objective"))},width:"35px",getValue:function(){return true},displayFunction:function(F){F.classList.add("ecom-objective");return true},sortFunction:function(G,F){if(typeof G.objective==="undefined"&&typeof F.objective==="undefined"){return 0}else{if(typeof G.objective==="undefined"){return -1}else{if(typeof F.objective==="undefined"){return 1}}}return(parseInt(G.objective,10)-parseInt(F.objective,10))},displayType:"general",resizableColumn:true}];var C=[{name:"rank",initial:true,sortFunction:function(G,F){return(parseInt(G.data.autoRank,10)-parseInt(F.data.autoRank,10))}}];A.s.rowSortFunctions=[{name:"priorityAsc",initial:false,sortFunction:function(G,F){return(parseInt(G.rawJSON.priorityWeight,10)-parseInt(F.rawJSON.priorityWeight,10))}},{name:"priorityDesc",initial:true,sortFunction:function(G,F){return(parseInt(F.rawJSON.priorityWeight,10)-parseInt(G.rawJSON.priorityWeight,10))}},{name:"alphaAsc",initial:false,sortFunction:function(H,G){var F=H.rawJSON.displayName.toLowerCase();var I=G.rawJSON.displayName.toLowerCase();if(F<I){return -1}else{if(F>I){return 1}}return 0}},{name:"alphaDsc",initial:false,sortFunction:function(H,G){var F=H.rawJSON.displayName.toLowerCase();var I=G.rawJSON.displayName.toLowerCase();if(F<I){return -1}else{if(F>I){return 1}}return 0}}];if(typeof E!=="undefined"&&E!==null){A.element=document.createElement("ra-comparetable");var p="raCompareColumns";var w=document.querySelector("#"+p);if(w===null){w=document.createElement("ra-fixedcolumns");w.jsonParser=A.s.jsonParser;w.setAttribute("id",p);w.setup(k);document.querySelector("body").appendChild(w)}A.element.setAttribute("data-fixedcolumnsource",p);var q="raParameterHierarchy";var o=document.querySelector("#"+q);if(o===null){o=document.createElement("ra-hierarchy");o.jsonParser=A.s.jsonParser;o.setAttribute("id",q);var D=o.buildHierarchyFromJSON(f.varGroup||[]);o.appendChild(D);document.querySelector("body").appendChild(o)}else{o.checkForHierarchyChanges(f.varGroup,o.children[0])}A.element.setAttribute("data-hierarchysource",q);var u="raDataCollections";var n=document.querySelector("#"+u);if(n===null){n=document.createElement("ra-datacollections");n.jsonParser=A.s.jsonParser;n.setAttribute("id",u);n.otherFunctions=j;n.sortFunctions=C;n.addCollections(t);document.querySelector("body").appendChild(n)}A.element.setAttribute("data-collectionsource",u);A.element.setAttribute("data-iscomparable","true");E.appendChild(A.element);A.element.initialize(A.s);A.rendering.resolve()}else{A.rendering.resolve()}return A};return{constr:d}});define("DS/SMAAnalyticsUI/SMAAnalyticsCategoricalScoreFilter",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon"],function(c,e,a,d){function b(h){var g={bottom:"BOTTOM_75",middle:"MIDDLE_20",top:"TOP_5"};h.shopPage=h.shopPage||{};if(typeof h.shopPage.categoricalFilterStatus==="undefined"){if(typeof h.shopPage.quantileData==="undefined"){h.shopPage.categoricalFilterStatus={quantile0:false,quantile1:false,qualtile2:false}}else{var f=h.shopPage.quantileData;h.shopPage.categoricalFilterStatus={quantile0:f[0].filtered,quantile1:f[1].filtered,qualtile2:f[2].filtered}}}h.shopPage.categoricalFilterStatus=h.shopPage.categoricalFilterStatus||{quantile0:false,quantile1:false,qualtile2:false};h.shopPage.filterCategorical=function(l){l=l||{};var p=h.shopPage.customQuantile||0;var o=0.0001;var j=5;var v=[];var t=[];h.shopPage.customQuantile={quantileValue:0,quantileLevel:j};h.shopPage.quantileDeferred=h.shopPage.quantileDeferred||c.Deferred().resolve();var m=new c.Deferred();var n=document.querySelector("#overallscorefilter");var s=n.querySelector(".ra-csf-skewed");if(e.varGroup.score.upperQuartile!==0){var i={};e.getCustomQuantileValue({paramID:e.varGroup.score.ID,quantileLevel:j},i).done(function(){var y=i.content;h.shopPage.customQuantile.quantileValue=y.quantileValue;h.shopPage.quantileDeferred=m;var w=e.varGroup.score;var z=w.max;var x=w.min;if(y.isSkewed===1){if(s){s.style.display="block"}c.when(e.setParametricFilter("overallscore","IN_RANGE",w.min,l,w.min)).done(function(){h.shopPage.quantileDeferred.resolve()});d.alertMessage(1,a.translate("SKEWED_MESSAGE"))}else{if(s){s.style.display="none"}if(p!==h.shopPage.customQuantile.quantileValue||l.type==="click"){v[0]=w.min;t[0]=w.upperQuartile-o;v[1]=w.upperQuartile;t[1]=h.shopPage.customQuantile.quantileValue-o;v[2]=h.shopPage.customQuantile.quantileValue-o;t[2]=w.max;for(var k=0;k<3;k++){if(z>v[k]&&h.shopPage.quantileData[k].filtered){z=v[k]}if(x<t[k]&&h.shopPage.quantileData[k].filtered){x=t[k]}}if(h.shopPage.quantileData[0].filtered&&!h.shopPage.quantileData[1].filtered&&h.shopPage.quantileData[2].filtered){c.when(e.setMultipleFilters([{paramID:"overallscore",type:"LESS_THAN",firstFilterValue:v[1]-o},{paramID:"overallscore",type:"GREATER_THAN",tags:"",firstFilterValue:t[1]},{paramID:"overallscore",type:"IN_RANGE",firstFilterValue:w.min,secondFilterValue:w.min}],l)).done(function(){h.shopPage.quantileDeferred.resolve()})}else{if(!h.shopPage.quantileData[0].filtered&&!h.shopPage.quantileData[1].filtered&&!h.shopPage.quantileData[2].filtered){c.when(e.setParametricFilter("overallscore","IN_RANGE",w.min,l,w.min)).done(function(){h.shopPage.quantileDeferred.resolve()})}else{c.when(e.setMultipleFilters([{paramID:"overallscore",type:"LESS_THAN",firstFilterValue:w.min},{paramID:"overallscore",type:"GREATER_THAN",firstFilterValue:w.max},{paramID:"overallscore",type:"IN_RANGE",firstFilterValue:z,secondFilterValue:x}],l)).done(function(){h.shopPage.quantileDeferred.resolve()})}}}h.shopPage.quantileData[0].text=a.translate("Bottom 75 percent val",y.numBottomDesigns);h.shopPage.quantileData[1].text=a.translate("Next 20 percent val",y.numMidDesigns);h.shopPage.quantileData[2].text=a.translate("Top 5 percent val",y.numTopDesigns);d3.selectAll(".sim-ui-param-overallscore-filter text").text(function(B,A){return h.shopPage.quantileData[A].text})}})}else{if(s){s.style.display="none"}var r=e.varGroup.score,u=0;for(var q=0;q<e.varGroup.score.histogramValues.length;q++){u=u+e.varGroup.score.histogramValues[q]}h.shopPage.quantileData[0].text=a.translate("Bottom 75 percent val",u);h.shopPage.quantileData[1].text=a.translate("Next 20 percent val",0);h.shopPage.quantileData[2].text=a.translate("Top 5 percent val",0);if(h.shopPage.quantileData[0].filtered){e.setParametricFilter("overallscore","LESS_THAN",r.min+o,l,null,g.bottom)}else{if(adviseLaunchInfo.isJoiningSession){m.resolve()}else{c.when(e.setMultipleFilters([{paramID:"overallscore",type:"LESS_THAN",firstFilterValue:r.min},{paramID:"overallscore",type:"GREATER_THAN",firstFilterValue:r.max},{paramID:"overallscore",type:"IN_RANGE",firstFilterValue:r.min,secondFilterValue:r.min}],l)).done(function(){m.resolve()})}}d3.selectAll(".sim-ui-param-overallscore-filter text").text(function(w,k){return h.shopPage.quantileData[k].text})}return m};h.shopPage.buildOverallScoreCategorical=function(l){var i=60;var x=290;c("#overallscorefilter .sim-ui-panel-controlgroup-contentpanel").css({height:i+10});var r=Number(i);var t=Number(x);var o=0.2*x;var u=null;for(var n=0;n<e.varGroup.score.histogramValues.length;n++){u=u+e.varGroup.score.histogramValues[n]}if(typeof h.shopPage.quantileData==="undefined"||h.shopPage.quantileData.length===0){h.shopPage.quantileData=[];h.shopPage.quantileData[0]={color:"#4C84A4",lightColor:"#A8D5EF",text:a.translate("Bottom 75 percent val",u),filterName:"BOTTOM_75",filtered:false};h.shopPage.quantileData[1]={color:"#365E75",lightColor:"#A8D5EF",text:a.translate("Next 20 percent val",0),filterName:"NEXT_20",filtered:false};h.shopPage.quantileData[2]={color:"#1F3745",lightColor:"#A8D5EF",text:a.translate("Top 5 percent val",0),filterName:"TOP_5",filtered:false}}var v=d3.select("#overallscorefilter .sim-ui-panel-controlgroup-contentpanel").append("svg").attr("id","overallScoreCategorical").attr("width",t).attr("height",r);var s=v.selectAll(".sim-ui-param-overallscore-filter").data(h.shopPage.quantileData).enter().append("g").attr("class","sim-ui-param-overallscore-filter").on("mouseover",function(w){var k=d3.select(this);if(!w.filtered){k.selectAll("circle").style("fill",w.lightColor)}else{k.selectAll("text").classed("sim-ui-categorical-text-hidden",false).classed("sim-ui-categorical-text-font-shown",false)}}).on("mouseout",function(w){var k=d3.select(this);if(!w.filtered){k.selectAll("text").classed("sim-ui-categorical-text-font-shown",true);k.selectAll("circle").style("fill",w.color)}else{k.selectAll("text").classed("sim-ui-categorical-text-hidden",true).classed("sim-ui-categorical-text-font-shown",true)}}).on("click",function(w){var k=d3.select(this);if(w.filtered){k.selectAll("circle").style("fill",w.lightColor);k.selectAll("text").style("fill","black");w.filtered=false}else{k.selectAll("circle").style("fill","#CECFDC");k.selectAll("text").style("fill","#CECFDC");w.filtered=true}h.shopPage.filterCategorical(l)});s.append("circle").attr("r",function(w,k){return 10*(3-k)}).style("fill",function(k){if(k.filtered){return"#CECFDC"}else{return k.color}}).style("stroke","white").attr("cx",o).attr("cy",function(w,k){return i-10*(3-k)});s.append("text").text(function(k){return k.text}).attr("x",0.45*x).attr("y",function(w,k){return(75-28*(2-k))*i/100}).classed("sim-ui-categorical-text-font-shown",true);var p=document.createElement("div");p.classList.add("ra-csf-skewed");var m=document.createElement("span");m.classList.add("wux-ui-3ds");m.classList.add("wux-ui-3ds-alert");p.appendChild(m);var q=document.createElement("div");q.textContent=a.translate("SKEWED_MESSAGE");p.appendChild(q);var j=document.querySelector("#overallscorefilter .sim-ui-panel-controlgroup-contentpanel");j.appendChild(p)}}return b});define("DS/SMAAnalyticsUI/SMAAnalyticsVarGroupTable",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsCompareTable/SMAAnalyticsHierarchicalTable"],function(b,f,e,a,c,g){var d=function(i){var m=this;m.rendering=new b.Deferred();m.s=i;var p=document.querySelector(m.s.target);m.s.scrollFixed=true;m.s.jsonParser=function(u,t,v){return c.getJSONFromResponse([u,t,v])};var r=function(x,v,z){var y=f.findParameter(x);var t=y[v]||"";var u=this.textContent.trim();if(u===""&&typeof z!=="undefined"){u=z}if(t!==u){y[v]=u;var w=w||{};w.iaEventUISource="parameterTableInPreviewPage";f.setParameterInfo(y,w)}return u};var n=function(A,D,z){var C=function(J,G){var F=document.createElement("div");F.id="sim-ra-unit-ctr";var H=document.createElement("div");H.style.width="100%";H.style.height="100%";H.style["overflow-y"]="auto";var L=null;var K=[];J.forEach(function(Q,O){var P=document.createElement("label");L=document.createElement("input");P.style.width="100%";P.style.display="block";P.style["line-height"]="1.8rem";L.setAttribute("type","radio");L.setAttribute("name","unitDim");L.setAttribute("value",O);L.style["float"]="left";P.textContent=Q.Dimension.NLS+" ("+Q.NLSName+")";P.appendChild(L);L.value=O;if(O===0){L.checked=true}K.push(L);H.appendChild(P)});F.appendChild(H);var N=function(){var O=b('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+a.translate("OK")+"</button>").on("click",function(){console.log(K);K.forEach(function(Q,P){if(Q.checked){G(P)}});g.closePopover()});return O};var I=function(){var O=b('<button class="sim-ui-popover-footerButton" style="min-width:75px;">'+a.translate("Cancel")+"</button>").on("click",g.closePopover);return O};var M={width:500,height:300,footerOptions:{type:"buttons",content:[N,I]},customCloseBehavior:g.closePopover};g.makePopover([a.translate("Select")],[b(F)],"Units and Dimensions","sim-ui-units-popover",M)};var B=function(F){x.unit=F.NLSName;x.unitDimension=F.Dimension.NLS;var G=G||{};G.iaEventUISource="parameterTableInPreviewPageForceRefresh";f.setParameterInfo(x,G)};var x=f.findParameter(A);var E=x[D]||"";var v=this.textContent.trim();if(v===""&&typeof z!=="undefined"){v=z}if(E!==v){var w=f.getMatchingUnits(v,50);if(w&&w.length>0){var t=w[0];if(t.s.toLowerCase().localeCompare(v.toLowerCase())===0){v=t.s;var y=f.getUnitInfo(t.s);console.log(y);if(y.length>1){C(y,function(F){B(y[F])})}}else{console.log("there is no perfect match; here are the top 20");console.log(w);var u=[];w.forEach(function(G){var F=f.getUnitInfo(G.s);u=u.concat(F)});C(u,function(F){B(u[F])})}}}return v};var s=function(u,t){var v=f.findParameter(u);return r.call(this,u,t,v.name)};var h=[{name:"name",displayHeaderFunction:function(t){t.textContent=a.translate("Parameter Name")},getValue:function(t){if(typeof t.rawJSON.name!=="undefined"){return t.rawJSON.name}else{if(typeof t.rawJSON.displayName!=="undefined"){return t.rawJSON.displayName}}return""},width:"200px",displayFunction:function(t,v){if(!t.classList.contains("ra-indented")){t.classList.add("ra-indented")}t.innerHTML="";var u=document.createElement("div");if(typeof v!=="undefined"&&typeof v!=="object"){u.textContent=decodeURIComponent(v)}t.classList.add("raHTableStringColumn");t.appendChild(u);return true},sortFunction:function(u,t){if(u.rawJSON.displayName.toLowerCase()<t.rawJSON.displayName.toLowerCase()){return -1}else{if(u.rawJSON.displayName.toLowerCase()>t.rawJSON.displayName.toLowerCase()){return 1}else{return 0}}},isHandle:true,displayType:"all"},{name:"unit",displayHeaderFunction:function(t){t.textContent=a.translate("Units")},width:"50px",displayFunction:function(t,u){if(typeof u!=="undefined"&&typeof u!=="object"){t.textContent=u;t.classList.add("raHTableStringColumn")}return true},sortable:false,isEditable:true,saveFunction:n,displayType:"general"},{name:"role",displayHeaderFunction:function(t){t.textContent=a.translate("Mode")},width:"60px",displayFunction:function(t,w){if(typeof w!=="undefined"&&typeof w!=="object"){var v=document.createElement("select");var x=null;var u=null;u=document.createElement("option");u.text=a.translate("UNKNOWN");u.value="UNKNOWN";if(w==="UNKNOWN"){u.selected="selected"}v.appendChild(u);u=document.createElement("option");u.text=a.translate("INPUT");u.value="INPUT";if(w==="INPUT"){u.selected="selected"}v.appendChild(u);u=document.createElement("option");u.text=a.translate("OUTPUT");u.value="OUTPUT";if(w==="OUTPUT"){u.selected="selected"}v.appendChild(u);v.onchange=function(){var A=v.options[v.selectedIndex].value;var z=f.findParameter(t.parentNode.parentNode.parameterID);z.role=A;var y=y||{};y.iaEventUISource="parameterTableInPreviewPage";f.setParameterInfo(z,y);f.updateApproximationStatus()};t.appendChild(v)}return true},sortable:false,displayType:"general"},{name:"displayName",displayHeaderFunction:function(t){t.textContent=a.translate("Alias")},width:"180px",displayFunction:function(t,u){if(typeof u!=="undefined"&&typeof u!=="object"){t.textContent=decodeURIComponent(u);t.classList.add("raHTableStringColumn")}return true},sortable:false,isEditable:true,saveFunction:s,displayType:"general"},{name:"min",width:"60px",displayHeaderFunction:function(t){t.textContent=a.translate("Min")},displayFunction:function(t,u){if(typeof u!=="undefined"&&typeof u!=="object"){t.textContent=e.formatExp(u)}else{t.textContent="n/a"}t.classList.add("raHTableNumberColumn");return true},sortable:false,getArrayValue:function(){var u="";var t=this.parentNode.hLink.rawJSON.elementData;if(typeof this.parentNode.arrLocString!=="undefined"&&t!=="undefined"){if(typeof t[this.parentNode.arrLocString]!=="undefined"){u=t[this.parentNode.arrLocString].min}}return u},displayType:"detail"},{name:"max",displayHeaderFunction:function(t){t.textContent=a.translate("Max")},width:"60px",displayFunction:function(t,u){if(typeof u!=="undefined"&&typeof u!=="object"){t.textContent=e.formatExp(u)}else{t.textContent="n/a"}t.classList.add("raHTableNumberColumn");return true},sortable:false,getArrayValue:function(){var u="";var t=this.parentNode.hLink.rawJSON.elementData;if(typeof this.parentNode.arrLocString!=="undefined"&&t!=="undefined"){if(typeof t[this.parentNode.arrLocString]!=="undefined"){u=t[this.parentNode.arrLocString].max}}return u},displayType:"detail"},{name:"notes",displayHeaderFunction:function(t){t.textContent=a.translate("Comments")},width:"200px",displayFunction:function(t,u){if(typeof u!=="undefined"&&typeof u!=="object"){t.textContent=decodeURIComponent(u);t.classList.add("raHTableStringColumn")}return true},sortable:false,isEditable:true,saveFunction:r,displayType:"general"}];m.s.rowSortFunctions=[{name:"priorityAsc",initial:false,sortFunction:function(u,t){return(parseInt(u.rawJSON.priorityWeight,10)-parseInt(t.rawJSON.priorityWeight,10))}},{name:"priorityDesc",initial:true,sortFunction:function(u,t){return(parseInt(t.rawJSON.priorityWeight,10)-parseInt(u.rawJSON.priorityWeight,10))}},{name:"alphaAsc",initial:false,sortFunction:function(v,u){var t=v.rawJSON.displayName.toLowerCase();var w=u.rawJSON.displayName.toLowerCase();if(t<w){return -1}else{if(t>w){return 1}}return 0}},{name:"alphaDsc",initial:false,sortFunction:function(v,u){var t=v.rawJSON.displayName.toLowerCase();var w=u.rawJSON.displayName.toLowerCase();if(t<w){return -1}else{if(t>w){return 1}}return 0}}];if(typeof p!=="undefined"&&p!==null){m.element=document.createElement("ra-comparetable");p.appendChild(m.element);m.element.setAttribute("data-iscomparable","false");m.element.initialize(m.s);var j="raPreviewColumns";var o=document.querySelector("#"+j);if(o===null){o=document.createElement("ra-fixedcolumns");o.jsonParser=m.s.jsonParser;o.setAttribute("id",j);o.setup(h);document.querySelector("body").appendChild(o)}m.element.setAttribute("data-fixedcolumnsource",j);var l="raParameterHierarchy";var q=document.querySelector("#"+l);if(q===null){q=document.createElement("ra-hierarchy");q.jsonParser=m.s.jsonParser;q.setAttribute("id",l);var k=q.buildHierarchyFromJSON(f.varGroup||[]);q.appendChild(k);document.querySelector("body").appendChild(q)}m.element.setAttribute("data-hierarchysource",l);m.rendering.resolve()}else{m.rendering.resolve()}return m};return{constr:d}});define("DS/SMAAnalyticsUI/SMAAnalyticsDataTableSupportFns",["DS/SMAAnalyticsUtils/SMAAnalyticsInterface","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsUI/SMAAnalyticsMarkers","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(e,d,b,a){function c(){}c.prototype.proxy=null;c.prototype.setProxy=function(f){c.prototype.proxy=f};c.prototype.basketFunction=function(g){var i={};var h=c.prototype.proxy.isInBasket(Number(g.metaData.id));var f=document.createElement("img");if(h>-1){f.setAttribute("src","./assets/icons/SMAAnalyticsIconCartTransparent.png")}i.value=h;i.content=f;i.columnClass="iconCell";return i};c.prototype.getBasketColumnObject=function(){return{displayName:"",id:"basketColumn",headerClass:"dataTable-basketHeader"}};c.prototype.arrayFunction=function(g){var h={};var f=document.createElement("button");f.textContent="...";f.addEventListener("click",function(){var i=d3.select(this.parentElement).datum().column;d.makeParamPopover(g.metaData.id,null,{paramID:i})});f.className="sim-ui-dataTable-array-values";h.value="";h.content=f;h.columnClass="sim-ui-dataTable-array-column";return h};c.prototype.dataSourceCompare=function(g,f){return g.DATA_SET>f.DATA_SET?1:g.DATA_SET<f.DATA_SET?-1:0};c.prototype.dataSourceFunction=function(f){var g={};g.value=0;g.content=b.getDataMark(f.metaData.tags.DATA_SET);g.columnClass="dataSourceCell iconCell";return g};c.prototype.getDataSourceColumnObject=function(){return{displayName:"",id:"dataSourceColumn",headerClass:"dataTable-dataSourceHeader",compareFn:c.prototype.dataSourceCompare}};c.prototype.derivedArrayParameterSetup=function(){};c.prototype.meanFn=function(f){return(f.reduce(function(h,g){return Number(h)+Number(g)},0)/f.length)};c.prototype.modeFn=function(l){l.sort();var f=l[0],k=l[0],h=1,j=1;var g;for(g=1;g<l.length;g++){if(l[g]===f){j++;if(f===k){h++}else{if(j>h){k=f;h=j}}}else{f=l[g];j=1}}return k};c.prototype.medianFn=function(f){f.sort();if(f.length%2===0){return((f[f.length/2]+f[f.length/2-1])/2)}else{return f[(f.length-1)/2]}};c.prototype.maxFn=function(f){return Math.max.apply(null,f)};c.prototype.minFn=function(f){return Math.min.apply(null,f)};c.prototype.validateString=function(){return 1};c.prototype.validateNumber=function(f){return !isNaN(Number(f))?1:0};c.prototype.validateInteger=function(f){return this.validateNumber(f)&&Number(f)===(Number(f)|0)?1:0};c.prototype.createTableAdviseInterface=function(j,h,g,i){i=i||function(){};var k=function(o,n){var w=function(){var z=Number(o.rows[0].metaData.id);var y=o.columns[0];if(o.columns.length===1){u.title=c.prototype.proxy.getNameForAlternative(q,true)+" ("+decodeURIComponent(n)+")"}else{u.title=c.prototype.proxy.getNameForAlternative(q,true)+" ("+a.translate("Multiple Columns")+")"}u.items.push({category:"row",label:a.translate("More Info"),icon:"./assets/icons/moreinfo_small.png",action:function(){d.makeParamPopover(q,r,{paramID:y})}});u.items.push({category:"row",label:function(){return c.prototype.proxy.isInBasket(z)===-1?a.translate("Add to Basket"):a.translate("Remove from Basket")},icon:function(){return c.prototype.proxy.isInBasket(z)===-1?"./assets/icons/basket_small.png":"./assets/icons/basket_remove.png"},action:function(){if(c.prototype.proxy.isInBasket(z)===-1){c.prototype.proxy.addToBasket(z)}else{c.prototype.proxy.removeFromBasket(z)}}});if(c.prototype.proxy.isEKActive()){u.items.push({category:"row",label:a.translate("Push to Geometry"),iconType:"image",icon:"./assets/icons/update.png",action:function(){var A={},B;c.prototype.proxy.getRowInfo(o.currentCell.rowID,A).done(function(){B=A.content;var E={action:"UpdateParams",parameters:[]};if(B.parmValues){for(var D in B.parmValues){if(B.parmValues.hasOwnProperty(D)){var C=proxy.getInteractiveParamId(D);if(C){E.parameters.push({id:C,displayName:C,value:B.parmValues[D]})}}}proxy.sendJson(E)}})}})}var x=c.prototype.proxy.isIncluded(z);u.items.push({category:"row",label:function(){return x?a.translate("Exclude Row"):a.translate("Include Row")},iconType:function(){return x?"image":"jquery"},icon:function(){return x?"./assets/icons/exclude.png":"ui-icon-plusthick"},action:function(){if(x){c.prototype.proxy.excludePoints([z])}else{c.prototype.proxy.includePoints([z])}}});u.items.push({category:"row",label:a.translate("Delete Row"),iconType:"jquery",icon:"ui-icon-minusthick",action:function(){var A={iaEventSource:"dataTable"};c.prototype.proxy.deleteDataRows(o.rows,A).done(function(){t.bridge.updateBody()})}});if(!c.prototype.proxy.isFormulationLocked()){u.items.push({category:"column",label:a.translate("Delete Column"),iconType:"jquery",icon:"ui-icon-minusthick",action:function(){var A={iaEventSource:"dataTable",deleteNode:true};i();c.prototype.proxy.deleteParameters([y],A)}})}};var l=function(){if(o.columns.length===1){u.title=a.translate("Multiple Rows")+" ("+decodeURIComponent(n)+")"}else{u.title=a.translate("Multiple Rows")+" ("+a.translate("Multiple Columns")+")"}var z={category:"row"};var x=[],C=[];for(s=0;s<o.rows.length;s++){if(c.prototype.proxy.isInBasket(Number(o.rows[s].metaData.id))>-1){x.push(Number(o.rows[s].metaData.id))}else{C.push(Number(o.rows[s].metaData.id))}}if(C.length>0){z.label=a.translate("Add Rows To Basket");z.icon="./assets/icons/basket_small.png";z.action=function(){c.prototype.proxy.addToBasket(C)}}else{z.label=a.translate("Remove Rows From Basket");z.icon="./assets/icons/basket_remove.png";z.action=function(){c.prototype.proxy.removeFromBasket(x)}}u.items.push(z);var y=[];var B=[];var A={category:"row"};for(s=0;s<o.rows.length;s++){if(c.prototype.proxy.isIncluded(Number(o.rows[s].metaData.id))){B.push(Number(o.rows[s].metaData.id))}else{y.push(Number(o.rows[s].metaData.id))}}if(B.length>0){A.label=a.translate("Exclude Rows");A.iconType="image";A.icon="./assets/icons/exclude.png";A.action=function(){c.prototype.proxy.excludePoints(B)}}else{A.label=a.translate("Include Rows");A.iconType="jquery";A.icon="ui-icon-plusthick";A.action=function(){c.prototype.proxy.includePoints(y)}}u.items.push(A);u.items.push({category:"row",label:a.translate("Delete Rows"),iconType:"jquery",icon:"ui-icon-minusthick",action:function(){var D={iaEventSource:"dataTable"};c.prototype.proxy.deleteDataRows(o.rows,D).done(function(){t.bridge.updateBody()})}})};d3.event.preventDefault();if(o.rows.length===0||o.columns.length===0){return}var t=this;var q=Number(o.currentCell.rowID);var u={items:[]};var s;var r;if(o.rows.length===1){w.call(this)}else{l.call(this)}if(!c.prototype.proxy.isFormulationLocked()){u.items.push({category:"column",label:a.translate("Add Column"),iconType:"jquery",icon:"ui-icon-plusthick",action:function(){var y={},x={moveNode:true,lastColumnID:o.currentCell.columnID};i();c.prototype.proxy.createDataColumn(y,{event:x}).done(function(){var A,z})}})}u.items.push({category:"row",label:a.translate("Add Row"),iconType:"jquery",icon:"ui-icon-plusthick",action:function(){var x={};var y={iaEventUISource:"dataTable-ContextMenu",tags:{startEditMode:true}};i();c.prototype.proxy.createDataRow(x,o.currentCell.rowIndex,y).done(function(A){var z=x.content.map(function(B){return{ID:String(B),fixedData:{basketColumn:"",run_number:String(B),auto_rank:"0",total_score:"0.0"},DATA_SET:"USER_CREATED",editable:"true"}});t.bridge.eventController("addRowsFromInterface",[z,o.currentCell.rowID])})}});var m=c.prototype.proxy.findParameter(o.currentCell.columnID);if(m!==null&&m.structure==="ARRAY"){u.items.push({category:"column",label:a.translate("Add Derived Column"),iconType:"jquery",icon:"ui-icon-plusthick",action:function(){d.makeArrayMeasurePopover(m,t)}})}var v=u.items.filter(function(x){return x.category==="row"}),p=u.items.filter(function(x){return x.category==="column"});if(v.length>0&&p.length>0){u.items=v.concat(["separator"]).concat(p)}else{u.items=v.concat(p)}j.defineContextOptions(u);j.renderContext(d3.event);return false};var f=new e([{name:"getHierarchy",fn:function(){return c.prototype.proxy.getGroupCopy(c.prototype.proxy.varGroup)}},{name:"validateContents",fn:function(m){var l=m.validationType.toLowerCase(),n=m.content;if(l==="real"||l==="double(6)"){return c.prototype.validateNumber(n)}else{if(l==="integer"){return c.prototype.validateInteger(n)}else{return c.prototype.validateString(n)}}}},{name:"saveChanges",fn:function(l){var m={tags:{startEditMode:true}};c.prototype.proxy.updateDataRows(l,m)}},{name:"getDataAsXML",fn:function(){}},{name:"addRows",fn:function(n){var l={};var m=this;c.prototype.proxy.createDataRows(l,n).done(function(){var o=JSON.parse(l.content),p;p=o.map(function(q){return{ID:String(q),editable:"true",fixedData:{basketColumn:"",run_number:String(q),auto_rank:"0",total_score:"0.0"}}});m.bridge.eventController("addRowsFromInterface",p)})}},{name:"updateParameter",fn:function(m,l){l=l||{};var n=l.event||{};i();return c.prototype.proxy.setGroupInfo(m,n)}},{name:"contextMenu",fn:k},{name:"refreshData",fn:g},{name:"createDerivedColumn",fn:function(t,r){var o={iaEventSource:"createDerivedColumn-updateData",lastColumnID:t.ID},q=1,u={};var s=this.bridge.dataHandler.data.rows,p=this.bridge.dataHandler.data.rowKeys;var y={},n;var w,v;var m;if(r.measure.toLowerCase()==="mean"){m=c.prototype.meanFn}else{if(r.measure.toLowerCase()==="median"){m=c.prototype.medianFn}else{if(r.measure.toLowerCase()==="mode"){m=c.prototype.modeFn}else{if(r.measure.toLowerCase()==="max"){m=c.prototype.maxFn}else{if(r.measure.toLowerCase()==="min"){m=c.prototype.minFn}}}}}for(w=0;w<p.length;w++){var l=s[p[w]].mainData[t.ID];if(typeof l!=="undefined"){n=JSON.parse(l);for(v=0;v<r.indices.length;v++){n=n[r.indices[v]]}y[p[w]]=m(n)}else{y[p[w]]=undefined}}var x={event:o,name:"",values:y};x.name+=r.measure+"("+t.name;if(r.indices&&r.indices.length>0){x.name+="["+r.indices.toString()+"]"}x.name+=")";sessionInfo.restartTimerFn.timers.dataTable.restartTimer();c.prototype.proxy.createDataColumn(u,x)}},{name:"getTableData",fn:h.getTableData},{name:"getNewRows",fn:h.getNewRows},{name:"getNewColumns",fn:h.getNewColumns}]);return f};return c.prototype});define("DS/SMAAnalyticsUI/SMAAnalyticsRadarChart",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","UWA/Class/Promise","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/Controls/TooltipModel"],function(b,g,f,e,a,c){var d={g:null,draw:function(v,u,m,h){function p(D,E,C){return new e(function(L,N){var J={},G,I=C.length,H={};var M=new e(function(O,P){g.getScoresForRowIdList(C,H).done(function(){J=H.content;O()})});function F(Q,R){R.scores={};R.groups=[];R.parameters=[];R.dataType="group";R.weight=Q.weightFactor;var O=Object.keys(Q);O.forEach(function(S){if(S==="groups"||S==="parameters"){return}R[S]=Q[S]},this);var P=Object.keys(J);P.forEach(function(S){var T=0;if(J[S]&&J[S][Q.ID]){T=J[S][Q.ID]}R.scores[S]=T},this);if(Q.groups instanceof Array){Q.groups.forEach(function(S){var T={};if(F(S,T)){R.groups.push(T)}},this)}if(Q.parameters instanceof Array){Q.parameters.forEach(function(S){var T={};if(K(S,T)){R.parameters.push(T)}},this)}return R}function K(Q,R){R.scores={};R.dataType="parameter";R.weight=Q.weightFactor;var O=Object.keys(Q);O.forEach(function(S){R[S]=Q[S]},this);var P=Object.keys(J);P.forEach(function(S){var T=0;if(J[S]&&J[S][Q.ID]){T=J[S][Q.ID]}R.scores[S]=T},this);return R}M.then(function(){F(D,E);L()},function(){})})}var l=g._partialCopyParameterHierarchy(),o={};var t=JSON.parse(JSON.stringify(u));var w="none";var i=[];var z=[],n=[],B={},x;var s=d3.layout.tree().size([10,10]);var k=document.querySelector(v),A=null,y=null,q=null;p(l,o,g.getBasketList()).done(function(){f.eliminateNonObjectivesFromHierarchy(o);k=k||document.querySelector(v);while(k.hasChildNodes()){k.removeChild(k.lastChild)}if((!o.groups||!o.groups.length)&&(!o.parameters||!o.parameters.length)){var F=document.createElement("div");F.classList.add("ra-radar-no-objectives");F.textContent=a.translate("NO_SELECTED_OBJ")+"!";k.appendChild(F);return}f.limitStackSize(o,10,{rowIDs:g.getBasketList(),minStackSize:3});var C=f.convertGroupToD3(o);x=s.nodes(C);for(var D=0;D<x.length;D++){if(x[D].nodeType=="parameter"&&(x[D].dataType=="REAL"||x[D].dataType=="INTEGER")){if(x[D].min<=x[D].max){n.push(x[D].ID)}}else{if(x[D].nodeType=="group"){if(x[D].ID.substr(x[D].ID.length-5)!="OTHER"){n.push(x[D].ID)}else{B[x[D].ID]=x[D]}}}}var E={};g.getDataColumns(n,g.getBasketList(),E).done(function(){var H=E.content;var G=g.getBasketList();z=z||[];if(G instanceof Array){G.forEach(function(J,I){z[I]=z[I]||[];if(!(x instanceof Array)){return}x.forEach(function(K){var L=0;if(H[K.ID]){L=H[K.ID][I]}else{if(B[K.ID]){L=B[K.ID].scores[J]}}z[I].push({axis:K.displayName,value:L,ID:K.ID})},this)},this)}t=z;if(t[0] instanceof Array){t[0].forEach(function(I){if(x instanceof Array){x.forEach(function(J){if(J.depth===1){if(I.ID&&I.ID===J.ID){i.push(J)}else{if(J.nodeType!=="group"&&J.displayName===I.axis){i.push(J)}}}},this)}},this)}r();A=k.querySelector(".ra-radar-chart");if(A){A.parentElement.removeChild(A)}A=document.createElement("div");A.classList.add("ra-radar-chart");k.appendChild(A);j(i)})});var r=function(){var C=k.querySelector("svg");if(C&&C.parentElement){C.parentElement.removeChild(C)}};function j(ag){r();q=ag;var I=JSON.parse(JSON.stringify(t));var R=g.getBasketList();var ao=0,an=0;if(I instanceof Array){I.forEach(function(av,aw){I[aw]={name:"design"+aw,designnum:R[aw],points:av}},this)}var ae=1,ad=1,au=[-20,20],ar=[5,15],F=m.w-10,N=m.h-10,C=Math.min(F,N);if(ag.length>2){ar=[0,15]}else{if(ag.length==2){au=[-5,15];ar=[5,15]}}var ak=d3.select(v).select(".ra-radar-chart").insert("svg",".sim-ui-radarChart-legend").attr("width",F).attr("height",N).attr("viewBox","0 0 "+F+" "+N).append("g");if(F<=C){N=(F/(au[1]-au[0]))*(ar[1]-ar[0])}else{F=(N/(ar[1]-ar[0]))*(au[1]-au[0])/2;N=N/2}ae=d3.scale.linear().domain(au).range([0,F]);ad=d3.scale.linear().domain(ar).range([N,0]);var H=ag;var af=H.length;var L=ae(0),aa=((m.w-10)/2)-L;if(af===2){aa-=(F/4)}ak[0][0].setAttribute("transform","translate("+aa+" 0)");console.log(F+", "+N+" : "+aa+" : "+m.w+", "+m.h);var Z=g.getBasketColorMap();function at(aE,aD){var aC=aE;var aw={x:0,y:0};var ax=[{x:0,y:aD}];var ay=aC===2?270:360/aC;var aB=0;for(aB=0;aB<aC-1;aB++){var aA=ax[0].x-aw.x;var az=ax[0].y-aw.y;var av=aA*Math.cos(ay*(aB+1)*Math.PI/180)-az*Math.sin(ay*(aB+1)*Math.PI/180);var aF=aA*Math.sin(ay*(aB+1)*Math.PI/180)+az*Math.cos(ay*(aB+1)*Math.PI/180);if(av<0.0001&&av>0.0001){av=0}if(aF<0.0001&&aF>0.0001){aF=0}ax.push({x:av,y:aF})}return ax}var G=10;var O=[];for(ao=0;ao<I.length;ao++){O[ao]=[];for(an=0;an<H.length;an++){for(var al=0;al<I[ao].points.length;al++){if(I[ao].points[al].axis==H[an].displayName){O[ao][an]=I[ao].points[al]}}}I[ao].points=O[ao]}var D=[];for(ao=0;ao<3;ao++){D.push({name:"bgpoly",points:at(af,G-G/3*ao)})}var J=[];for(ao=0;ao<H.length;ao++){var aq=0,W=0;if(H[ao].nodeType!="group"){aq=g.findParameter(H[ao].ID).max;W=g.findParameter(H[ao].ID).min}else{if(g.findGroup(H[ao].ID)){aq=g.findGroup(H[ao].ID).score.max;W=g.findGroup(H[ao].ID).score.min}else{aq=Infinity;W=-Infinity;for(var P in H[0].scores){if(H[0].scores[P]<aq){aq=H[0].scores[P]}if(H[0].scores[P]>W){W=H[0].scores[P]}}}}I.forEach(function(av){var aw=av.points[ao].value;if(aw>W){W=aw}if(aw<aq){aq=aw}},this);var K=W-aq;if(K==0){K=1}aq-=0.3*K;W+=0.3*K;J.push({name:H[ao],min:aq,max:W})}var T=[];for(an=0;an<I.length;an++){var U=at(af,G);T.push(U);for(ao=0;ao<U.length;ao++){var ah=1;if(g.getObjective(H[ao].ID)==="MINIMIZE"){ah=(J[ao].max-I[an].points[ao].value)/(J[ao].max-J[ao].min)}else{ah=(I[an].points[ao].value-J[ao].min)/(J[ao].max-J[ao].min)}I[an].points[ao].x=U[ao].x*ah;I[an].points[ao].y=U[ao].y*ah}}for(var ao=0;ao<I[0].points.length;ao++){var aj=I[0].points[ao].ID;var X=true;for(an=0;an<I.length;an++){if(an!==0){if(I[an].points[ao].value!==I[an-1].points[ao].value){X=false;break}}}if(X){for(an=0;an<I.length;an++){I[an].points[ao].x=T[an][ao].x*0.8;I[an].points[ao].y=T[an][ao].y*0.8}}}for(ao=0;ao<I.length;ao++){if(I[ao].name!="bgpoly"){var ac=0;var Q=0;var ai=0;for(an=0;an<I[ao].points.length-1;an++){Q=Q+I[ao].points[an].x*I[ao].points[an+1].y;ai=ai+I[ao].points[an].y*I[ao].points[an+1].x}ac=(Q-ai)/2;I[ao].area=ac}}I.sort(function(aw,av){return av.area-aw.area});for(ao=0;ao<I.length;ao++){D.push(I[ao])}var E=function(){};var ab=ak.selectAll(".line").data(D[0].points).enter().append("g").attr("class","line");ab.append("line").each(function(av){this.setAttribute("x1",ae(0));this.setAttribute("x2",ae(av.x));this.setAttribute("y1",ad(0));this.setAttribute("y2",ad(av.y));this.setAttribute("class","line")});ak.selectAll("polygon").data(D).enter().append("polygon").each(function(av){if(av.name=="bgpoly"){this.setAttribute("visibility","visible");this.setAttribute("class",av.name);this.setAttribute("fill","none");this.setAttribute("stroke","#D4D4D4");this.setAttribute("fill-opacity",0);this.setAttribute("stroke-width",1)}else{if(h[av.designnum]){this.setAttribute("visibility","hidden")}else{this.setAttribute("visibility","visible")}this.setAttribute("class","designpoly"+av.name.match(/\d$/));this.setAttribute("fill",Z(av.designnum));this.setAttribute("stroke",Z(av.designnum));this.setAttribute("fill-opacity",0.1);this.setAttribute("stroke-width",2);this.tooltipInfos=new c({shortHelp:g.getNameForAlternative(av.designnum,true)});this.container=k}this.setAttribute("points",av.points.map(function(aw){return[ae(aw.x),ad(aw.y)].join(",")}).join(" "))}).on("mouseover",function(av){if(av.name!="bgpoly"){d3.select(this).style("fill-opacity",0.6)}}).on("mouseout",function(av){if(av.name!="bgpoly"){d3.select(this).style("fill-opacity",0.1)}});var M=ak.selectAll(".labels").data(D[0].points).enter().append("g").attr("class","labels");M.append("text").each(function(aA,ax){var aw=H[ax],az=aw.displayName;this.setAttribute("class","labels rowid-"+ax);this.setAttribute("dx","100");this.style.fontSize="13px";this.style.fontFamily="Arial";this.style.fill="black";this.style.cursor="defaults";var ay="normal";if(aw.nodeType==="group"){ay="bold"}this.style.fontWeight=ay;var av=8;if(m.w>500){av=16}if(az.length>av){az=az.substring(0,av-1)+"..."}this.textContent=az;if(aw.nodeType==="group"){this.tooltipInfos=new c({shortHelp:aw.displayName,longHelp:a.translate("Click to see group")})}else{this.tooltipInfos=new c({shortHelp:aw.displayName,})}this.container=k}).on("click",function(az,ay){var ax=H[ay];if(ax.nodeType=="group"){var av=[];for(var aw=0;aw<x.length;aw++){if(x[aw].ID==ax.ID){av=x[aw].children;break}}w="down";ap();setTimeout(function(){j(av)},300)}});for(ao=0;ao<I.length;ao++){ak.selectAll(".nodes"+I[ao].name.match(/\d+$/)).data(I[ao].points).enter().append("g").attr("class","nodes"+I[ao].name.match(/\d+$/)).append("circle").each(function(az,ax){var av=I[ao];this.setAttribute("class","rowid-"+ao+" param-"+ax);this.setAttribute("name","design"+av.name.match(/\d+$/));this.style.fill=Z(av.designnum);var aB="visible";if(h[av.designnum]){aB="hidden"}this.setAttribute("visibility",aB);this.setAttribute("cy",ad(az.y));this.setAttribute("cx",ad(az.x));this.setAttribute("r",4);var aA=g.getNameForAlternative(av.designnum,true);var aw=av.points[ax];if(aw.value){var ay=aA+"</br>"+aw.axis+": "+aw.value.toFixed(3);this.tooltipInfos=new c({shortHelp:ay,allowUnsafeHTMLShortHelp:true})}this.container=k}).on("mouseover",function(){}).on("mouseout",function(){})}function Y(){var av=[];ak.selectAll("circle").attr("r",0).attr("cx",function(ay,ax){av[ax]={x:ay.x,y:ay.y};return ae(0)}).attr("cy",ad(0)).style("opacity",0).transition().duration(500).attr("cx",function(ay,ax){return ae(av[ax].x)}).attr("cy",function(ay,ax){return ad(av[ax].y)}).attr("r",4).style("opacity",1);av=[];ak.selectAll(".labels").attr("dx",function(ay,ax){av[ax]={x:ay.x,y:ay.y};if(ay.x==0){av[ax].y=av[ax].y+1}if(ay.x!=0&&Math.ceil(ay.x)==0){av[ax].y=av[ax].y-1.5}return ae(0)}).attr("dy",function(){return ad(0)}).attr("text-anchor",function(ay,ax){if(av[ax].x==0){return"middle"}if(av[ax].x<0){return"end"}else{return"start"}}).style("opacity",0).transition().duration(500).style("opacity",1).attr("dx",function(ay,ax){if(av[ax].x==0){return ae(av[ax].x)}if(av[ax].x<0){return ae(av[ax].x)-10}else{return ae(av[ax].x)+10}}).attr("dy",function(ay,ax){return ad(av[ax].y)});var aw=[];ak.selectAll("polygon").style("opacity",0).attr("points",function(az,ay){var ax="";aw[ay]=az;for(ay=0;ay<az.points.length;ay++){ax=String(ax)+ae(0)+","+ad(0)+" "}return ax}).transition().duration(500).attr("points",function(aA,az){var ax="";for(var ay=0;ay<aA.points.length;ay++){ax=String(ax)+ae(aw[az].points[ay].x)+","+ad(aw[az].points[ay].y)+" "}return ax}).style("opacity",1);aw=[];ak.selectAll(".line").attr("x2",function(ay,ax){aw[ax]={x:ay.x,y:ay.y};return ae(0)}).attr("y2",ad(0)).style("opacity",0).transition().duration(500).style("opacity",1).attr("x2",function(ay,ax){return ae(aw[ax].x)}).attr("y2",function(ay,ax){return ad(aw[ax].y)})}function S(){ak.selectAll("circle").transition().duration(500).attr("cx",ae(0)).attr("cy",ad(0)).attr("r",0).style("opacity",0);ak.selectAll(".labels").transition().duration(500).style("opacity",0).attr("dx",ae(0)).attr("dy",ad(0));ak.selectAll("polygon").transition().duration(500).attr("points",function(ax){var av="";for(var aw=0;aw<ax.points.length;aw++){av=String(av)+ae(0)+","+ad(0)+" "}return av}).style("opacity",0);ak.selectAll(".line").transition().duration(500).style("opacity",0).attr("x2",ae(0)).attr("y2",ad(0))}function ap(){ak.selectAll(".line").transition().duration(500).attr("x1",function(aw){return ae(aw.x*10)}).attr("x2",function(aw){return ae(aw.x*10)}).attr("y1",function(aw){return ad(aw.y*10)}).attr("y2",function(aw){return ad(aw.y*10)}).remove();ak.selectAll("polygon").transition().duration(500).attr("points",function(ay){var aw="";for(var ax=0;ax<ay.points.length;ax++){aw=String(aw)+ae(ay.points[ax].x*10)+","+ad(ay.points[ax].y*10)+" "}return aw}).style("opacity",0).remove();ak.selectAll(".labels").transition().duration(500).attr("dx",function(aw){return ae(aw.x*10)}).attr("dy",function(aw){return ad(aw.y*10)}).remove();var av=0;for(av=0;av<I[0].points.length;av++){ak.selectAll("circle").transition().duration(500).attr("cx",function(aw){return ae(aw.x*10)}).attr("cy",function(aw){return ad(aw.y*10)}).attr("r",10).style("opacity",0).remove()}for(av=0;av<I.length;av++){ak.selectAll(".nodes"+av).transition().duration(501).remove()}}function V(){var av=[];ak.selectAll("circle").attr("cx",function(ay,ax){av[ax]={x:ay.x,y:ay.y};return ae(ay.x*10)}).attr("cy",function(ax){return ad(ax.y*10)}).attr("r",10).transition().duration(500).attr("r",4).attr("cx",function(ay,ax){return ae(av[ax].x)}).attr("cy",function(ay,ax){return ad(av[ax].y)});av=[];ak.selectAll(".labels").attr("dx",function(ay,ax){av[ax]={x:ay.x,y:ay.y};return ae(ay.x*10)}).attr("dy",function(ax){return ad(ax.y*10)}).style("opacity",0).transition().duration(500).style("opacity",1).attr("dx",function(ay,ax){if(av[ax].x==0){return ae(av[ax].x)-25}if(av[ax].x<0){return ae(av[ax].x)-65}else{return ae(av[ax].x)+5}}).attr("dy",function(ay,ax){if(ay.x==0){return ad(av[ax].y+1)}if(ay.x!=0&&Math.ceil(ay.x)==0){return ad(av[ax].y-1.5)}return ad(av[ax].y)});var aw=[];ak.selectAll("polygon").attr("points",function(aA,az){var ax="";aw[az]=aA;for(var ay=0;ay<aA.points.length;ay++){ax=String(ax)+ae(aA.points[ay].x*10)+","+ad(aA.points[ay].y*10)+" "}return ax}).transition().duration(500).attr("points",function(aA,az){var ax="";for(var ay=0;ay<aA.points.length;ay++){ax=String(ax)+ae(aw[az].points[ay].x)+","+ad(aw[az].points[ay].y)+" "}return ax});aw=[];ak.selectAll(".line").attr("x2",function(ay,ax){aw[ax]={x:ay.x,y:ay.y};return ae(ay.x*10)}).attr("y2",function(ax){return ad(ax.y*10)}).transition().duration(500).ease(".line").attr("x2",function(ay,ax){return ae(aw[ax].x)}).attr("y2",function(ay,ax){return ad(aw[ax].y)})}if(w=="none"||w=="down"){Y()}else{V()}if(y){k.removeChild(y);y=null}if(H[0].parent&&H[0].parent.parent){y=document.createElement("div");y.classList.add("ra-radar-zoom");y.textContent="Zoom Out";k.appendChild(y);y.onclick=function(){w="up";if(y){k.removeChild(y);y=null}S();var av=[];for(var ax=0;ax<H[0].parent.parent.children.length;ax++){for(var aw=0;aw<t[0].length;aw++){if(H[0].parent.parent.children[ax].displayName==t[0][aw].axis){if(H[0].parent.parent.children[ax].nodeType=="group"){if(H[0].parent.parent.children[ax].ID==t[0][aw].ID){av.push(H[0].parent.parent.children[ax])}}else{av.push(H[0].parent.parent.children[ax])}}}}setTimeout(function(){j(av)},300)}}if(A){var am=A.querySelector(".sim-ui-radarChart-legend");if(am===null){am=document.createElement("div");am.classList.add("sim-ui-radarChart-legend");am.textContent=a.translate("Outer points better meet objective");A.appendChild(am)}}else{console.warn("Failed to add legend")}}return{radarChart:A,resize:function(C,D){m.w=C;m.h=D;if(q!==null){j(q)}}}}};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsComparePage",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget","DS/SMAAnalyticsUI/SMAAnalyticsECommerceTable","DS/SMAAnalyticsUI/SMAAnalyticsRadarChart","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsUI/SMAAnalyticsArrayPlot","DS/SMAAnalyticsUI/SMAAnalyticsIconView","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/Windows/Dialog","DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper"],function(g,i,d,l,e,j,c,k,f,b,m,a){function h(o,q){var n=i.getSwitch("RA_INTERACTIVE_DESIGN");if(n){var p=document.querySelector('#comparedesignstoolbar .sim-ui-panel-content-toolbarbutton[title="Save"]');p.addEventListener("click",function(){i.storeAdviseCase()})}o.comparePage=o.comparePage||{};o.comparePage.create=h;o.comparePage.refreshEvents={};o.comparePage.currentView="comparedesignsthumbnailviewbutton";o.comparePage.basketContents={recommendedDesign:[],basketList:[]};o.comparePage.entering=function(){o.comparePage.basketChanged();if(typeof o.comparePage.svgScraper==="undefined"){o.comparePage.svgScraper=new a(o.comparePage.element)}if(typeof o.comparePage.views==="undefined"){o.comparePage.views=o.comparePage.element.find(".sim-ui-panel-content-view")}if(typeof o.comparePage.viewButtons==="undefined"){o.comparePage.viewButtons=o.comparePage.element.find(".sim-ui-panel-content-viewbutton")}var w=document.querySelector("#radarplotcontrolcontentpanel");if(w!==null){o.comparePage.svgScraper.prepContainer(w,"radarplot",{svgtype:"radarplot"})}var v=i.getFileNames();if(v===null||v.length===0||n){var s=null;var u=null;o.comparePage.views.each(function(z,y){var x=g(y).attr("id");var A=g(y).attr("data-needs-images");if("true"!==A){u=this;s=x;return false}});if(s!==null){o.comparePage.views.hide();g(u).show();o.comparePage.viewButtons.removeClass("sim-ui-panel-content-viewbutton-current");var r=o.comparePage.viewButtons.filter('[data-view="'+s+'"]');r.addClass("sim-ui-panel-content-viewbutton-current");o.comparePage.currentView=r[0].id}}o.comparePage.refreshIconViewTable();o.comparePage.refreshRadarPlot();o.comparePage.refreshECommTable();var t=document.querySelector("#"+q+' [data-icon="copyto"]');if(t!==null){t.onclick=o.comparePage.openScrapeUI}};o.comparePage.openScrapeUI=function(){o.comparePage.svgScraper.openScrapeUI()};o.comparePage.getIconsForView=function(s){o.comparePage.arrayPlots=[];var r={};i.getPageOptions("moreInfo",r).done(function(){var t=r.content;if(!g.isEmptyObject(t)){if(t.arrayData.length===1&&t.arrayData[0]==="empty"){o.comparePage.arrayPlots=[]}else{o.comparePage.arrayPlots=t.arrayData}}o.comparePage.refreshFileFilters();if(typeof s==="function"){s()}})};o.comparePage.getParamTypeShownOption=function(){var s=o.comparePage.paramTypeShown||"";var r=function(){if(typeof i.formulation.constraints!=="undefined"){return"thresholds"}else{if(typeof i.formulation.objectives!=="undefined"){return"objectives"}else{return"all"}}};if(s!==null&&s.length>0){switch(s.toLowerCase()){case"objectives":if(typeof i.formulation.objectives!=="undefined"){return"objectives"}break;case"thresholds":if(i.formulation.constraints!=="undefined"){return"thresholds"}break;default:return"all"}}return r()};o.comparePage.refreshParameterFilters=function(){o.comparePage.paramsHidden=o.comparePage.paramsHidden||[];o.comparePage.paramTypeShown=o.comparePage.getParamTypeShownOption();var t=g("#compareparamfiltercontrol").find(".sim-ui-panel-controlgroup-contentpanel").first();t.html("");var v=g("<table/>",{style:"margin-top: 5px; width:100%"}).appendTo(t);var x=null;o.comparePage.paramsHidden.checkBoxFunction=function(){if(typeof o.comparePage.eCommTableInstance!=="undefined"){if(!o.comparePage.paramsHidden.checkBoxFunction.firstRun){o.comparePage.paramTypeShown=g(this).val()}else{o.comparePage.paramsHidden.checkBoxFunction.firstRun=false}var y=o.comparePage.eCommTableInstance.element.querySelectorAll("[data-id]:not(data-group)");if(o.comparePage.paramTypeShown==="thresholds"){o.comparePage.eCommTableInstance.element.applyRowFilter("thresholds",function(z){var A=i.getConstraintBounds(z.hLink.dataId);if(A[0]===null&&A[1]===null){return false}else{return true}})}else{if(o.comparePage.paramTypeShown==="objectives"){o.comparePage.eCommTableInstance.element.applyRowFilter("objectives",function(A){var z=i.getObjective(A.hLink.dataId);if(z===null){return false}else{return true}})}else{o.comparePage.eCommTableInstance.element.applyRowFilter("all",function(){return true})}}o.comparePage.eCommTableInstance.element.resize()}};o.comparePage.paramsHidden.checkBoxFunction.firstRun=o.comparePage.paramsHidden.checkBoxFunction.firstRun||true;o.comparePage.paramsHidden.checkBoxFunction();x=g("<tr/>").appendTo(v);var s=g("<td/>",{style:"width: 100%"}).appendTo(x);var r=g("<input>",{type:"radio",name:"raRefreshCompareTableRowFilters",value:"objectives"});if(o.comparePage.paramTypeShown==="objectives"){r.attr("checked","checked")}if(typeof i.formulation.objectives==="undefined"){r.attr("disabled","disabled");s.css("opacity",".6")}r.click(o.comparePage.paramsHidden.checkBoxFunction);r.appendTo(s);g("<span/>",{"class":"sim-ui-comparepage-param-filter",style:"margin-left:5px"}).text(b.translate("Objectives")).appendTo(s);x=g("<tr/>").appendTo(v);s=g("<td/>",{style:"width: 100%"}).appendTo(x);var w=g("<input>",{type:"radio",name:"raRefreshCompareTableRowFilters",value:"thresholds"});if(o.comparePage.paramTypeShown==="thresholds"){w.attr("checked","checked")}if(typeof i.formulation.constraints==="undefined"){w.attr("disabled","disabled");s.css("opacity",".6")}w.click(o.comparePage.paramsHidden.checkBoxFunction);w.appendTo(s);g("<span/>",{"class":"sim-ui-comparepage-param-filter",style:"margin-left:5px"}).text(b.translate("Thresholds")).appendTo(s);var u=g("<input>",{type:"radio",name:"raRefreshCompareTableRowFilters",value:"all"});if(o.comparePage.paramTypeShown==="all"){u.attr("checked","checked")}u.click(o.comparePage.paramsHidden.checkBoxFunction);x=g("<tr/>").appendTo(v);s=g("<td/>",{style:"width: 100%"}).appendTo(x);u.appendTo(s);g("<span/>",{"class":"sim-ui-comparepage-param-filter",style:"margin-left:5px"}).text("All").appendTo(s);t.css("height","70px")};o.comparePage.refreshFileFilters=function(){o.comparePage.basketFilesHidden=o.comparePage.basketFilesHidden||[];var u=g("#modelviewcontrol").find(".sim-ui-panel-controlgroup-contentpanel").first();u.html("");var v=i.getFileNames();var B=i.getFileList();var s=o.comparePage.arrayPlots;var t=s.length+B.length;if(t.length<=0){g("<div/>",{style:"margin-top:5px;text-align:center"}).text(b.translate("no_images")).appendTo(u);return}var C=g("<table/>",{style:"margin-top: 5px; width:100%"}).appendTo(u);var D=null;o.comparePage.basketFilesHidden.checkBoxFunction=function(){var H=g(this).attr("fileName");var E=g(this).attr("tileId");var F=o.comparePage.basketFilesHidden.indexOf(H);var G;if(F>-1){o.comparePage.basketFilesHidden.remove(F);F=-1;if(typeof o.comparePage.iconViewInstance!=="undefined"&&o.comparePage.iconViewInstance!==null){G=o.comparePage.iconViewInstance.element.querySelector('data-row[data-id="'+E+'"]');G.classList.remove("ra-row-hidden");o.comparePage.iconViewInstance.element.resize()}}else{o.comparePage.basketFilesHidden.push(H);F=o.comparePage.basketFilesHidden.length-1;if(typeof o.comparePage.iconViewInstance!=="undefined"&&o.comparePage.iconViewInstance!==null){G=o.comparePage.iconViewInstance.element.querySelector('data-row[data-id="'+E+'"]');G.classList.add("ra-row-hidden");o.comparePage.iconViewInstance.element.resize()}}g(this).attr("checked",F>-1?null:"checked")};for(var w=0;w<t;w++){D=g("<tr/>").appendTo(C);var A=g("<td/>",{style:"width: 100%"}).appendTo(D);var r;var x;if(w<B.length){r=B[w].displayName;x=B[w].id}else{r=s[w-B.length].title;x=s[w-B.length].title}var z=g("<input/>",{type:"checkbox",fileName:r,tileId:x});var y=o.comparePage.basketFilesHidden.indexOf(r);if(y<0){z.attr("checked","checked")}z.click(o.comparePage.basketFilesHidden.checkBoxFunction);z.appendTo(A);g("<span/>",{"class":"sim-ui-comparepage-file-filter",style:"margin-left:5px"}).text(decodeURIComponent(r)).appendTo(A).attr("title",decodeURIComponent(r))}u.css("height",10+20*t);u.css("max-height","130px");o.comparePage.showAppropriateFiles()};o.comparePage.showAppropriateFiles=function(){if(typeof o.comparePage.iconViewInstance!=="undefined"&&o.comparePage.iconViewInstance!==null){o.comparePage.basketFilesHidden=o.comparePage.basketFilesHidden||[];o.comparePage.iconViewInstance.element.applyRowFilter("fileFilter",function(r){if(o.comparePage.basketFilesHidden.indexOf(r.hLink.rawJSON.name)>-1){return false}else{return true}})}};o.comparePage.refreshBasketDesignFilters=function(){o.comparePage.basketDesignsHidden=o.comparePage.basketDesignsHidden||[];var v=i.getBasketList();var u=g("#designalternativescontrol").find(".sim-ui-panel-controlgroup-contentpanel").first();u.html("");if(v.length<=0){g("<div/>",{style:"margin-top:5px;text-align:center"}).text(b.translate("no_alternatives_in_basket")).appendTo(u);return}o.comparePage.refreshBasketDesignFilters.checkBoxFunction=function(){var C=parseInt(g(this).attr("rowId"),10);var B=o.comparePage.basketDesignsHidden.indexOf(C);if(B>-1){o.comparePage.basketDesignsHidden.remove(B);B=-1}else{o.comparePage.basketDesignsHidden.push(C);B=o.comparePage.basketDesignsHidden.length-1}g(this).attr("checked",B>-1?null:"checked");if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){o.comparePage.eCommTableInstance.element.applyColumnFilter("altsHidden",o.comparePage.filterBasketList);o.comparePage.iconViewInstance.element.applyColumnFilter("altsHidden",o.comparePage.filterBasketList)}o.comparePage.refreshRadarPlot()};var z=g("<table/>",{style:"margin-top: 5px; width:100%"}).appendTo(u);var s=i.getBasketColorMap();for(var t=0;t<v.length;t++){var r=parseInt(v[t],10),y=i.getNameForAlternative(r,true),A=g("<tr/>").appendTo(z);A.attr("title",y);var x=g("<td/>",{style:"width: 50%","class":"sim-ui-comparepage-designfilter-td"}).appendTo(A);var w=o.comparePage.basketDesignsHidden.indexOf(r);g("<input/>",{type:"checkbox",rowId:r}).attr("checked",w>-1?null:"checked").click(o.comparePage.refreshBasketDesignFilters.checkBoxFunction).appendTo(x);g("<span/>",{"class":"sim-ui-comparepage-design-filter"}).text(y).css("color",s(r)).appendTo(x)}u.css("height",10+20*(v.length+1)/2)};o.comparePage.filterBasketList=function(s){if(o.comparePage.basketDesignsHidden){var r=o.comparePage.basketDesignsHidden.indexOf(s);if(r>-1){return false}return true}};o.comparePage.refreshRadarPlot=function(){var w=[];var v=i.getBasketList();var x=0;for(var u=0;u<v.length;u++){w.push(v[u])}if(o.comparePage.basketDesignsHidden){for(u=0;u<o.comparePage.basketDesignsHidden.length;u++){x=w.indexOf(o.comparePage.basketDesignsHidden[u]);if(x>-1){w.splice(x,1)}}}var y={};if(o.comparePage.basketDesignsHidden){for(var r=0;r<o.comparePage.basketDesignsHidden.length;r++){y[o.comparePage.basketDesignsHidden[r]]=true}}var t=function(D,B,z){var E=g(D);if(!E){return}if(w.length<1){g(D).html('<div style="margin-top:5px;text-align:center;">'+b.translate("no_alternatives_in_basket")+"!</div>")}else{var A={radius:1,w:B||290,h:z||290,factor:1,factorLegend:0.9,total:4,levels:7,maxValue:1000,radians:2*Math.PI,minDistance:150,opacityArea:0.15};try{return j.draw(D,[],A,y)}catch(C){if(C.stack){console.error(C.stack)}}}};t("#radarplotcontrolcontentpanel");var s=document.querySelector("#radarplotcontrol .ra-popout");if(s){s.onclick=function(){var A=document.createElement("div");A.id="ra-radarplot-popover";var D=new m({title:"",content:A,immersiveFrame:i.getImmersiveFrame(),resizableFlag:true,width:500,height:400,closeButtonFlag:true,modalFlag:true});var z=A.clientWidth,B=A.clientHeight;var C=t("#ra-radarplot-popover",z,B);D.addEventListener("stopResize",function(E){z=A.clientWidth;B=A.clientHeight;C.resize(z,B)});D.addEventListener("close",function(){A=undefined});D.fire("stopResize")}}};o.comparePage.basketChanged=function(){o.comparePage.refreshBasketDesignFilters();if(i.getBasketList()!==o.comparePage.basketContents.basketList){o.comparePage.basketContents.recommendedDesign=i.getRecommendedDesign();if(Array.isArray(o.comparePage.basketDesignsHidden)){o.comparePage.basketContents.basketList=i.getBasketList().slice().filter(function(r){return(o.comparePage.basketDesignsHidden.indexOf(r)===-1)})}else{o.comparePage.basketContents.basketList=i.getBasketList().slice()}if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){o.comparePage.eCommTableInstance.element.setRecommended(o.comparePage.basketContents.recommendedDesign);o.comparePage.eCommTableInstance.element.primaryCollectionChanged()}o.comparePage.refreshRadarPlot()}else{o.comparePage.basketContents.recommendedDesign=i.getRecommendedDesign();if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){o.comparePage.eCommTableInstance.element.setRecommended(o.comparePage.basketContents.recommendedDesign)}}};o.comparePage.gradingChanged=function(){o.comparePage.eCommTableInstance.element.updateCollections()};o.comparePage.parameterChanged=function(){o.comparePage.refreshBasketDesignFilters();o.comparePage.refreshRadarPlot();if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){var r=i.getAllParametersAsFlatList();o.comparePage.eCommTableInstance.element.parameterChange(r)}};o.comparePage.fileParameterChanged=function(){if(o.comparePage.iconViewInstance!==null&&typeof o.comparePage.iconViewInstance!=="undefined"){o.comparePage.iconViewInstance.forceUpdate()}o.comparePage.refreshFileFilters()};o.comparePage.hierarchyChanged=function(){if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){o.comparePage.eCommTableInstance.element.hierarchyChanged(i.varGroup)}if(o.comparePage.iconViewInstance!==null&&typeof o.comparePage.iconViewInstance!=="undefined"){o.comparePage.iconViewInstance.forceUpdate()}};o.comparePage.onCollectionControllerChange=function(r){o.comparePage.designSetSelection=r};o.comparePage.getDesignSetSelector=function(v){var x=document.querySelector("#comparedesignset .sim-ui-panel-controlgroup-contentpanel");if(x!==null){var w=function(){return(typeof o.comparePage.designSetSelector!=="undefined"&&o.comparePage.designSetSelector!==null)};if(typeof v!=="undefined"&&v!==null&&!w()){var u=null;var t=new MutationObserver(function(y){y.forEach(function(A){if(w()){t.disconnect()}var z=A.target.getAttribute("data-collectionsource");if(z!==null&&z!==""){u=document.querySelector(z)}if(u!==null){t.disconnect();o.comparePage.designSetSelector=u.getCollectionsController(o.comparePage.onCollectionControllerChange);o.comparePage.designSetSelector.style.fontSize="10pt";o.comparePage.designSetSelector.style.marginTop="15px";o.comparePage.designSetSelector.style.width="50%";x.appendChild(o.comparePage.designSetSelector)}})});var s=v.element.getAttribute("data-collectionsource");if(s!==null&&s!==""){u=document.querySelector("#"+s)}if(u===null){t.observe(v.element,{attributes:true,attributeFilter:["data-collectionsource"]})}else{o.comparePage.designSetSelector=u.getCollectionsController(o.comparePage.onCollectionControllerChange);x.appendChild(o.comparePage.designSetSelector);if(typeof o.comparePage.designSetSelection==="undefined"||o.comparePage.designSetSelection===null||o.comparePage.designSetSelection.length===0){o.comparePage.designSetSelection=o.comparePage.designSetSelector.options[o.comparePage.designSetSelector.selectedIndex].text}else{var r=0;[].forEach.call(o.comparePage.designSetSelector.options,function(y){if(o.comparePage.designSetSelection===y.text){r=y.value}});o.comparePage.designSetSelector.selectedIndex=r;o.comparePage.designSetSelector.onchange()}}}}else{console.error("Left hand content panel is null")}};o.comparePage.refreshIconViewTable=function(){function r(){if(typeof o.comparePage.iconViewInstance==="undefined"){var u=function(x){var w=typeof event!=="undefined"?event:x;if(w!==null){w.preventDefault();w.stopPropagation()}i.setRecommendedDesign(parseInt(this.dataObj.dataId,10))};var v=function(y){var x=typeof event!=="undefined"?event:y;if(typeof x!=="undefined"&&x!==null){x.preventDefault();x.stopPropagation()}var w=this.dataObj.isInPrimary();if(w){i.removeFromBasket(this.dataObj.dataId)}else{i.addToBasket(this.dataObj.dataId)}};var s=function(y){var w=typeof event!=="undefined"?event:y;if(typeof w!=="undefined"&&w!==null){w.preventDefault();w.stopPropagation()}var x=this.dataObj.dataId;c.makeParamPopover(x,null,{selectedItem:1})};var t=function(y){var w=typeof event!=="undefined"?event:y;if(typeof w!=="undefined"&&w!==null){w.preventDefault();w.stopPropagation()}var x=this.dataObj.dataId;c.makeParamPopover(x,null,{selectedItem:2})};o.comparePage.iconViewInstance=new f.constr({target:"#comparedesignsthumbnailview2",params:i.varGroup,makePopover:c.makePopover,dataHeaderDisplayFunc:function(x){var A=document.createElement("div");A.setAttribute("data-handle","true");var D=document.createElement("div");D.classList.add("datahead-hasbuttons");var C=document.createElement("h1");D.appendChild(C);var B=document.createElement("button");B.classList.add("ra-comment-make");B.setAttribute("title",b.translate("Comments"));B.dataObj=x;B.onclick=s;D.appendChild(B);var w=document.createElement("button");w.classList.add("ra-comment-like");w.setAttribute("title",b.translate("Likes"));w.dataObj=x;w.onclick=t;D.appendChild(w);var z=document.createElement("button");z.classList.add("basketButton");z.setAttribute("title",b.translate("Remove from Basket"));z.dataObj=x;z.onclick=v;D.appendChild(z);var y=document.createElement("button");y.classList.add("recommendButton");y.setAttribute("title",b.translate("Recommend This Alternative"));y.dataObj=x;y.onclick=u;D.appendChild(y);A.appendChild(D);this.appendChild(A)},playAll3DPlay:true});if(typeof o.comparePage.iconViewInstance!=="undefined"&&o.comparePage.iconViewInstance!==null){o.comparePage.getDesignSetSelector(o.comparePage.iconViewInstance);o.comparePage.iconViewInstance.element.applyColumnFilter("altsHidden",o.comparePage.filterBasketList);o.comparePage.iconViewInstance.rendering.done(function(){o.comparePage.refreshFileFilters()})}}return o.comparePage.iconViewInstance.rendering}if(typeof o.comparePage.refreshEvents.iconViewDraw==="undefined"){o.comparePage.refreshEvents.iconViewDraw={refresh:d.makeRenderTracker(r)}}o.comparePage.getIconsForView(function(){o.comparePage.iconTable=o.comparePage.refreshEvents.iconViewDraw.refresh.render()})};o.comparePage.refreshECommTable=function(){function r(){if(typeof o.comparePage.eCommTableInstance==="undefined"){o.comparePage.eCommTableInstance=new e.constr({target:"#comparedesignsecomview",params:i.varGroup})}if(typeof o.comparePage.eCommTableInstance!=="undefined"&&o.comparePage.eCommTableInstance!==null){o.comparePage.getDesignSetSelector(o.comparePage.eCommTableInstance);o.comparePage.eCommTableInstance.element.applyColumnFilter("altsHidden",o.comparePage.filterBasketList);o.comparePage.eCommTableInstance.rendering.done(function(){o.comparePage.refreshParameterFilters()})}return o.comparePage.eCommTableInstance.rendering}if(typeof o.comparePage.refreshEvents.eCommTableDraw==="undefined"){o.comparePage.refreshEvents.eCommTableDraw={refresh:d.makeRenderTracker(r)}}o.comparePage.eCommTable=o.comparePage.refreshEvents.eCommTableDraw.refresh.render()};o.comparePage.resizeCompareTable=function(){if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){o.comparePage.eCommTableInstance.element.resize()}if(o.comparePage.iconViewInstance!==null&&typeof o.comparePage.iconViewInstance!=="undefined"){o.comparePage.iconViewInstance.element.resize()}};o.comparePage.viewChange=function(r){if(o.comparePage.currentView!==r.currentTarget.id){o.comparePage.refreshIconViewTable();o.comparePage.currentView=(r.srcElement||r.target).id;o.comparePage.swapFilterPanels();o.comparePage.resizeCompareTable();o.comparePage.checkIconViewEmpty()}};o.comparePage.checkIconViewEmpty=function(){var y=document.getElementsByClassName("smaAdviseEcommerceContentInner")[1].children[0];if(y.children.length==1){var z=i.getBasketCount();var t=document.createElement("data-row");t.dataset.id="info";t.dataset.objective="info";t.dataset.datatype="info";t.dataset.draggable=true;t.dataset.height=170;var u={displayName:"",name:"infoDiv",isImage:false,isVideo:false,type:"text",id:"infoDiv",ID:"infoDiv"};var r={rawJSON:u};t.hLink=r;for(var v=2;v<z+2;v++){var x=document.createElement("data-val");x.dataset.col=v;x.dataset.height=170;x.dataObj={dataId:2,infoCell:true};var s=document.createElement("div");s.textContent=b.translate("Drag to header");x.appendChild(s);t.appendChild(x)}y.appendChild(t)}else{var w=y.children[1];if(w.dataset.id=="info"){y.removeChild(y.childNodes[1])}}};o.comparePage.postRender=function(){o.comparePage.resizeCompareTable();o.comparePage.swapFilterPanels()};o.comparePage.formulationChanged=function(){if(o.comparePage.eCommTableInstance!==null&&typeof o.comparePage.eCommTableInstance!=="undefined"){o.comparePage.eCommTableInstance.element.resetObjectives();o.comparePage.eCommTableInstance.element.gradingChanged();o.comparePage.eCommTableInstance.element.updateCollections()}o.comparePage.refreshRadarPlot()};o.comparePage.fileUploaded=function(){var r=function(){o.comparePage.iconViewInstance.element.updateContent();o.comparePage.iconViewInstance.updateHierarchy()};o.comparePage.iconViewInstance.element.updateFiles(r);o.comparePage.checkIconViewEmpty()};o.comparePage.swapFilterPanels=function(){g("#modelviewcontrol, #compareparamfiltercontrol").hide();if(g("#comparedesignsthumbnailview2").is(":visible")){g("#modelviewcontrol").show()}else{if(g("#comparedesignsecomview").is(":visible")){g("#compareparamfiltercontrol").show()}}};o.comparePage.reportSetup=function(){if(typeof o.comparePage.svgScraper!=="undefined"){return o.comparePage.svgScraper.getPageSVGList()}else{return null}};o.comparePage.save=function(){var r={currentView:o.comparePage.currentView,basketContents:o.comparePage.basketContents,basketDesignsHidden:o.comparePage.basketDesignsHidden,paramsHidden:o.comparePage.paramsHidden,paramTypeShown:o.comparePage.paramTypeShown,basketFilesHidden:o.comparePage.basketFilesHidden,designSetSelection:o.comparePage.designSetSelection};try{i.savePageData("comparePage",i.serializePageObject(r))}catch(s){console.warn("Error trying to persist compare page session info",[s])}};o.comparePage.element=g("#"+q);o.comparePage.element.advisePage({controlPanelId:"comparedesignscontrolpanel",contentPanelId:"comparedesignscontentpanel",viewchange:o.comparePage.viewChange,resize:o.comparePage.resizeCompareTable,entering:o.comparePage.entering,basketChanged:o.comparePage.basketChanged,dataSetChanged:o.comparePage.basketChanged,gradingChanged:o.comparePage.gradingChanged,parameterChanged:o.comparePage.hierarchyChanged,fileParameterChanged:o.comparePage.fileParameterChanged,hierarchyChanged:o.comparePage.hierarchyChanged,postRender:o.comparePage.postRender,formulationChanged:o.comparePage.formulationChanged,fileUploadedForDesign:o.comparePage.fileUploaded,save:o.comparePage.save,reportSetup:o.comparePage.reportSetup})}return h});define("DS/SMAAnalyticsUI/SMAAnalyticsApproxSettings",["UWA/Core","UWA/Class/Promise","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsTweakerUI/SMAAnalyticsTweakerUI","DS/SMAAnalyticsUI/SMAAnalyticsPopover",],function(i,n,l,j,c,d,o,q,g){var h=undefined;var f;var e;var a,b;var p=Date.now();var m={kfolds:{title:"K-Fold Cross Validation",parameters:{randseed:{label:"Random Seed",description:"Random Seed",defaultValue:p,optional:true,semantics:{valueType:"number",}},kfolds:{label:"Number of Folds",description:"The number of folds",optional:true,defaultValue:10,semantics:{valueType:"integer",minValue:1,maxValue:10}}}},loo:{title:"Leave One Out Cross Validation",parameters:{randseed:{label:"Random Seed",description:"Random Seed",defaultValue:p,optional:true,semantics:{valueType:"number",}},loosize:{label:"Validation Set Size",description:"Validation Size",optional:true,defaultValue:20,semantics:{valueType:"integer",minValue:0}},valunit:{label:"Unit for Validation Set Size",description:"Validation Size unit",defaultValue:"perc",optional:true,semantics:{typeRep:"enum","enum":{perc:"%",points:"Points",}}}}},setaside:{title:"Set Aside Cross Validation",parameters:{randseed:{label:"Random Seed",description:"Random Seed",defaultValue:p,optional:true,semantics:{valueType:"number",}},setasidesize:{label:"Set aside size",description:"Set aside size",optional:true,defaultValue:1,semantics:{valueType:"integer",minValue:1}},valunit:{label:"Unit for Set aside size",description:"Validation Size unit",defaultValue:"points",optional:true,semantics:{typeRep:"enum","enum":{points:"Points",perc:"%"}}}}},"No Validation":{title:"No Validation",parameters:{}}};var k={_typeRepFactory:undefined,_content:undefined,_entries:undefined,_treeModel:undefined,_escapeHTML:false,_optThetaTree:undefined,_ctWrapper:undefined,createSettingsForm:function(s,r,u,t){function v(){t=t||function(){return true};function x(E){if(typeof u==="function"){u()}}var y,D,C;if(!D){D=i.createElement("div",{id:"my-approxsettings-wrapper",styles:{top:"4rem",bottom:"0px",left:"0px",right:"0px",overflow:"visible",position:"absolute"}});C=i.createElement("div",{id:"my-validationsettings-wrapper",styles:{height:"100%",width:"100%",overflow:"visible"}})}var A=parseInt(Object.keys(o.approximations).length)+1;y=i.createElement("div",{id:"main-container",});var w=$simjq('<b>Model Name</b><input id="approxName" value="Model'+A+'" style="margin-left: 1rem; position: relative; left: 3rem; width: calc(100% - 15rem);"> <br>').appendTo(y);D.inject(y);var B=function(){var E=$simjq('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">Create</button>').on("click",function(){if(a[0]._options.grid.key==d.translate("AP_TYPE_BEST")){h.createBest(x)}else{var J={};var I={};if(a){var F=a[0];I.type=a[0]._options.grid.key;var K;var H=F.getAllDescendants();for(var G in H){K=H[G];if(typeof(K)=="object"){if(K._options.isGroup!=true&&typeof K._options.grid.data!=="undefined"&&K._options.grid.data!==null){var L=K.options.grid.data;var M=K.options.key||K.options.label;I[M]=""+L}}}}if(b){var F=b[0];if(b[0]._options.grid.key=="No Validation"){I.ifvalidate="false"}else{I.valtype=b[0]._options.grid.key;var K;var H=F.getAllDescendants();for(var G in H){K=H[G];if(typeof(K)=="object"){if(K._options.isGroup!=true&&typeof K._options.grid.data!=="undefined"&&K._options.grid.data!==null){var L=K.options.grid.data;var M=K.options.key||K.options.label;I[M]=""+L}}}}}for(var N in I){console.log(N+" "+I[N])}if(!I||I===null||Object.keys(I).length===0){return}if(o.isApproxNameUsed(I.name)){alert('Approximation name "'+I.name+" is in use. Please choose a unique name.")}else{J.displayName=document.getElementById("approxName").value;J.type=I.type;delete I.type;I.excludedInputs=[];J.settings=I;o.createNewApproximation(J,x);g.closePopover()}}});g.closePopover();return E};var z={width:600,height:500,footerOptions:{type:"button",content:[B()]},noScroll:true,customCloseBehavior:t};var A=parseInt(Object.keys(o.approximations).length)+1;g.makePopover([d.translate("Approximation"),d.translate("ASTAT_VALIDATION")],[$simjq(y),$simjq(C)],d.translate("Create New Approximation"),"sim-ui-popover",z);if(h._ctWrapper&&h._optThetaTree){h._ctWrapper.inject(D.parentElement);h._optThetaTree.inject(h._ctWrapper)}if(D.children.length===0){a=f.buildTweakerUI(D,o.approximationSDKLibrary,d.translate("APPROX_TYPE"),h._typeRepFactory,o);b=e.buildTweakerUI(C,m,d.translate("APPROX_VAL_TYPE"),h._typeRepFactory,o)}}if(!h._typeRepFactory){h._typeRepFactory=new c();h._typeRepFactory.onReady=v}else{v()}},fetch:function(){var u={};if(f._getTreeModel()){var v=f._getTreeModel();u.type=f._getTreeModel()._options.grid.data;var t=v.getAllDescendants();t.forEach(function(z){if(z._options.isGroup!=true&&typeof z._options.grid.data!=="undefined"&&z._options.grid.data!==null){var w=z.options.grid.data;var r=z.options.key||z.options.label;u[r]=""+w}});for(var s in u){console.log(s+" "+u[s])}}return u},createBest:function(r){var s={displayName:"Best",type:"multiMethod",settings:{}};o.createNewApproximation(s,r);g.closePopover()},init:function(){h=this;f=new q();e=new q();return new Promise(function(r){h._typeRepFactory=new c();h._typeRepFactory.onReady=r.bind(this,h)})}};return k});define("DS/SMAAnalyticsUI/SMAAnalyticsSessionView",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils"],function(b,e,f,a,c){function d(g){this.view=document.getElementById("sessionview");this.managerDiv=document.getElementById("sessionManager");this.managerDiv.innerHTML="";this.tableContainer=document.createElement("div");this.tableContainer.setAttribute("id","ra-session-tableContainer");this.tableContainer.style.height="100%";this.managerDiv.appendChild(this.tableContainer);this.discussionDiv=document.getElementById("sessionDiscusssion")}d.prototype.initialize=function(){var g=this;this.tableContainer.innerHTML="";if(!this.table){this.makeManager({targetElement:this.tableContainer,params:Object.keys(e.caseInfo.userList),hierarchySource:"raSessionHierarchy"});this.tableContainer.children[0].resize()}if(!this.inviteButton){this.inviteButton=document.createElement("button");this.inviteButton.setAttribute("id","inviteButton");this.inviteButton.classList.add("ra-session-button");this.inviteButton.textContent=a.translate("Invite People");this.inviteButton.onclick=function(){g.makeInvitePopover.call(g)};this.managerDiv.appendChild(this.inviteButton)}};d.prototype.makeInvitePopover=function(){var l=this;var g="";var m=e.getDashboardURL();if(m.length>0){var o={sesscaseid:sessionInfo.caseID,sesseed:e.getEEDServerId(),sessjobid:e.getEEDJobId(),sesstoken:adviseLaunchInfo.token};var t=adviseLaunchInfo.stationDisplayName||"";if(t.length>0){o.sessstation=t}var r=Object.keys(o).map(function(w){return encodeURIComponent(w)+"="+encodeURIComponent(o[w])}).join("&");m+=(m.substring(m.length-1)!=="/")?"/":"";g=m+"#app:"+e.getAppID()+"/";if(r.length>0){g+="content:"+r}}else{var j="../simulationcentral/smaJoinAdviseSession.html?caseID="+sessionInfo.caseID+"&jobID="+e.getEEDJobId()+"&token="+adviseLaunchInfo.token;if(typeof adviseLaunchInfo.stationDisplayName!=="undefined"){j+="&station="+adviseLaunchInfo.stationDisplayName}g=location.href.split("/webapps/")[0]+"/common/emxNavigator.jsp?appName="+e.getAppID()+"&ContentPage="+encodeURIComponent(j)}var p=encodeURIComponent(a.translate("RA_SESSION_INVITE"));var u=encodeURIComponent(a.translate("RA_INVITE_MSG_1",' "'+e.caseInfo.CaseName+'" ')+a.translate("by",e.caseInfo.CurrentUser.userName)+". "+a.translate("RA_INVITE_MSG_2",": \n"+g));var i=document.createElement("div");i.setAttribute("id","invitePopover");var s=document.createElement("input");s.setAttribute("id","emailField");s.setAttribute("placeholder",a.translate("INVITE_ENTER_EMAIL"));var h=document.createElement("a");var n=h.appendChild(document.createElement("button"));n.textContent=a.translate("Create Email");n.classList.add("ra-session-button");h.onclick=function(){h.setAttribute("href","mailto:"+s.value+"?subject="+p+"&body="+u)};i.appendChild(s);i.appendChild(h);var k=document.createElement("text");k.classList.add("ra-session-popover-text");k.textContent=a.translate("LINK_SEND")+": ";i.appendChild(k);var q=document.createElement("text");q.textContent=g;q.classList.add("ra-session-popover-text");i.appendChild(q);var v={width:600,height:250,noTabs:true,footerOptions:{type:"button",content:function(){}}};f.makePopover([],[b(i)],a.translate("Invite People"),"ra-session-invite-popover",v)};d.prototype.makeManager=function(h){var k=this.table||{};var l=this;k.s=h;k.rendering=new b.Deferred();var n=k.s.targetElement;k.s.scrollFixed=true;k.s.jsonParser=function(r,q,s){return c.getJSONFromResponse([r,q,s])};k.s.fixedWidth=0;k.s.forceFooter=true;k.s.footerRows=[{name:"",getFunction:function(q){this.textContent=""}}];var g=[{name:"userID",displayHeaderFunction:function(q){q.textContent=a.translate("User ID")},getValue:function(q){if(typeof q.rawJSON.id!=="undefined"){return q.rawJSON.id}},displayFunction:function(q,r){q.textContent=r;q.classList.add("ra-session-idColumn");return true},isHandle:false,displayType:"all",stretchFactor:3},{name:"userName",displayHeaderFunction:function(q){q.textContent=a.translate("User Name")},getValue:function(q){if(typeof q.rawJSON.id!=="undefined"){return q.rawJSON.id}},displayFunction:function(q,r){q.textContent=e.caseInfo.userList[r].userName;q.classList.add("ra-session-nameColumn");return true},isHandle:false,displayType:"all",stretchFactor:3,width:"300px"},{name:"userActions",displayHeaderFunction:function(q){q.textContent="Actions"},width:"200px",getValue:function(q){if(typeof q.rawJSON.id!=="undefined"){return q.rawJSON.id}},displayFunction:function(q,r){var s=function(v){var u=document.createElement("button");u.classList.add("ra-session-button");var t=e.caseInfo.CurrentUser;u.onclick=function(){e.assignCollaborationControl(v)};var w=t.userID===v;if(e.caseInfo.userList[t.userID].isInControl){if(t.userID===v){u.textContent=a.translate("In Control");u.disabled=true}else{u.textContent=a.translate("Pass Control")}}else{if(e.caseInfo.userList[t.userID].isHost){if(e.caseInfo.userList[v].isInControl){u.textContent=a.translate("In Control");u.disabled=true}else{if(t.userID===v){u.textContent=a.translate("Take Back Control")}else{u.textContent=a.translate("Pass Control")}}}else{if(e.caseInfo.userList[v].isInControl){u.textContent=a.translate("In Control");u.disabled=true}else{u.textContent=a.translate("Not In Control");u.disabled=true}}}return u};q.appendChild(s(r));q.classList.add("ra-session-nameColumn");return true},isHandle:false,displayType:"all",stretchFactor:3}];if(typeof n!=="undefined"&&n!==null){k.element=document.createElement("ra-comparetable");var i="ra-session-table";var o=document.querySelector("#"+i);if(o===null){o=document.createElement("ra-fixedcolumns");o.setAttribute("id",i);o.setup(g);document.querySelector("body").appendChild(o)}k.element.setAttribute("data-fixedcolumnsource",i);var m="raSessionHierarchy";var p=document.querySelector("#"+m);if(p!==null){p.parentNode.removeChild(p);p=null}if(p===null){p=document.createElement("ra-hierarchy");p.jsonParser=k.s.jsonParser;p.setAttribute("id",m);var j=document.createElement("ra-hlink");j.dataId="sessionViewTableBase";j.setAttribute("data-id","");j.rawJSON={ID:"sessionViewTableBase"};j.linkType="group";[].forEach.call(Object.keys(e.caseInfo.userList),function(r){var q=document.createElement("ra-hlink");q.dataId=r;q.setAttribute("data-id",r);q.rawJSON={id:r,ID:r};j.appendChild(q)});p.appendChild(j);document.querySelector("body").appendChild(p)}k.element.setAttribute("data-hierarchysource",m);k.element.setAttribute("data-iscomparable","false");n.appendChild(k.element);k.element.initialize(k.s);k.rendering.resolve()}else{k.rendering.resolve()}return this.table};d.prototype.updateView=function(){this.tableContainer.innerHTML="";this.makeManager({targetElement:this.tableContainer,params:Object.keys(e.caseInfo.userList),hierarchySource:"raSessionHierarchy"})};d.prototype.getUsersAfterSearch=function(i){var h=document.getElementById("emailField");var g=false;i.forEach(function(j){if(j.userEmail&&typeof j.userEmail==="string"&&j.userEmail.length>0){h.value+=j.userEmail+"; "}else{g=true}if(g){alert(a.translate("INVALID_EMAIL_ALERT"))}})};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsPCPlot",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsPopover","text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils"],function(b,d,e,f,a,c){f=JSON.parse(f);function g(j,i){this.usedColumnKeys=j.usedColumnKeys;this.position={};this.position.axes={};this.scale={};this.options=i.pcPlot;this.options.height=b("#mapView").height()/2-this.options.utilSclWidth;this.div=document.getElementById("pcPlotDiv");this.position.top=i.som.height;this.position.bottom=this.position.top+this.options.height;this.position.axes.top=this.options.margin;this.position.axes.bottom=this.position.bottom-this.position.top-2*this.options.margin;this.data=j;this.colors=i.colors;this.position.axes.margin=100;this.position.axes.gap=(this.div.scrollWidth-2*this.position.axes.margin)/(this.data.usedColumnKeys.length-1)<this.options.minGap?this.options.minGap:(this.div.scrollWidth-2*this.position.axes.margin)/(this.data.usedColumnKeys.length-1);this.maxLetters=Math.floor(this.position.axes.gap/7);this.position.SVGWidth=this.position.axes.gap===this.options.minGap?2*this.position.axes.margin+this.position.axes.gap*(this.data.usedColumnKeys.length-1):this.div.clientWidth-2;this.maxPoints=this.options.maxPoints;var h=function(m){var l=d.getParametricFilterBounds(m)[0];var n=d.findParameter(m);if(!l){l=n.min}return l};var k=function(m){var l=d.getParametricFilterBounds(m)[1];var n=d.findParameter(m);if(!l){l=n.max}return l};this.setMinFn(h);this.setMaxFn(k)}g.prototype.makeSVG=function(){this.chart=d3.select(this.div).append("svg").attr("class","sim-ui-pcplot").attr("x",0).attr("y",0).attr("width",this.position.SVGWidth).attr("height",this.options.height);this.plotGroup=this.chart.append("g").attr("class","sim-ui-pcplot");this.makeBackgroundRect()};g.prototype.makeBackgroundRect=function(){this.backgroundRect=this.plotGroup.append("rect").attr("class","sim-ui-pcplot-background").attr("x",0).attr("y",0).attr("width",this.position.SVGWidth).attr("height",this.options.height);this.backgroundRect.on("click",function(){d3.selectAll(".sim-ui-pcplot-values-click").remove();d3.selectAll(".sim-ui-pcplot-selected-click").classed("sim-ui-pcplot-selected-click",false);d3.selectAll(".hex").classed("selected-hex",false);d3.selectAll(".hex").classed("highlighted-hex-click",false);d3.selectAll(".hex").classed("highlighted-hex-hover",false)})};g.prototype.makeScales=function(){var l=[];for(var k=0;k<this.data.usedColumnKeys.length;k++){var j=this.data.usedColumnKeys[k];var h=this.data.columns[j];var m=this.points;if(d.getObjective(this.data.usedColumnKeys[k])==="MINIMIZE"){l=[this.max(j),this.min(j)]}else{l=[this.min(j),this.max(j)]}this.scale[j]=d3.scale.linear().domain(l).range([this.position.axes.bottom,this.position.axes.top])}this.scale.horizontal=d3.scale.ordinal().rangePoints([this.position.axes.margin,this.position.axes.margin+(this.data.usedColumnKeys.length-1)*this.position.axes.gap]).domain(this.data.usedColumnKeys)};g.prototype.updateScales=function(){var k=[];for(var j=0;j<this.data.usedColumnKeys.length;j++){var h=this.data.usedColumnKeys[j];if(d.getObjective(this.data.usedColumnKeys[j])==="MINIMIZE"){k=[this.max(h),this.min(h)]}else{k=[this.min(h),this.max(h)]}this.scale[h].domain(k)}};g.prototype.makeGradients=function(){var h=this.chart.append("svg:defs").append("svg:linearGradient").attr("id","objGradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad");h.append("svg:stop").attr("offset","0%").attr("stop-color",this.colors.obj[0]).attr("stop-opacity",1);h.append("svg:stop").attr("offset","100%").attr("stop-color",this.colors.obj[1]).attr("stop-opacity",1);var i=this.chart.append("svg:defs").append("svg:linearGradient").attr("id","defaultGradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad");i.append("svg:stop").attr("offset","0%").attr("stop-color",this.colors.def[0]).attr("stop-opacity",1);i.append("svg:stop").attr("offset","50%").attr("stop-color",this.colors.def[1]).attr("stop-opacity",1);i.append("svg:stop").attr("offset","100%").attr("stop-color",this.colors.def[2]).attr("stop-opacity",1)};g.prototype.makeAxes=function(){var i=this;this.axesContainerGroup=d3.select("#pcplot-axesContainer");if(!this.axesContainerGroup.node()){this.axesContainerGroup=this.plotGroup.append("g").attr("id","pcplot-axesContainer")}var h=this.axesContainerGroup.selectAll(".sim-ui-pcplot-axes").data(this.data.usedColumnKeys);this.axesGroup=h.enter().append("g").attr("class","sim-ui-pcplot-axes");this.axesGroup.append("rect").attr("x",function(j){return i.scale.horizontal(j)}).attr("y",i.position.axes.top).attr("width",this.options.thickness).attr("height",this.position.axes.bottom-this.position.axes.top>0?this.position.axes.bottom-this.position.axes.top:0).style("fill",function(p){var n=i.data.columns[p];if(d.getObjective(p)!==null&&d.getObjective(p)!=="TARGET"){if(n.min===n.max){return i.colors.obj[0]}else{return"url(#objGradient)"}}else{if(d.getObjective(p)==="TARGET"){if(n.min===n.max){return i.colors.obj[0]}else{var o;var m=d.formulation.objectives;for(var l=0;l<m.length;l++){if(m[l].parameterID===p){o=m[l].value}}var k=i.chart.append("svg:defs").append("svg:linearGradient").attr("id","targetGradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad");k.append("svg:stop").attr("offset","0%").attr("stop-color",i.colors.obj[1]).attr("stop-opacity",1);k.append("svg:stop").attr("offset",100-(o-i.min(p))*100/(i.max(p)-n.min)+"%").attr("stop-color",i.colors.obj[0]).attr("stop-opacity",1);k.append("svg:stop").attr("offset","100%").attr("stop-color",i.colors.obj[1]).attr("stop-opacity",1);return"url(#targetGradient)"}}else{if(i.data.columns[p].min===n.max){return i.colors.def[1]}else{return"url(#defaultGradient)"}}}});h.exit();this.makeAxisLabels()};g.prototype._min=function(h){return h.min};g.prototype.min=function(h){return this._min(h)};g.prototype.setMinFn=function(h){this._min=h};g.prototype._max=function(h){return h.max};g.prototype.max=function(h){return this._max(h)};g.prototype.setMaxFn=function(h){this._max=h};g.prototype.updateAxisLabels=function(){var h=this;this.axesGroup.select(".bottomValueLabel").text(function(j){var i=h.data.columns[j];if(d.getObjective(j)==="MINIMIZE"){return h.parseValue(h.max(j))}else{return h.parseValue(h.min(j))}});this.axesGroup.select(".topValueLabel").text(function(j){var i=h.data.columns[j];if(d.getObjective(j)==="MINIMIZE"){return h.parseValue(h.min(j))}else{return h.parseValue(h.max(j))}});this.axesGroup.select(".paramName").text(function(i){if(h.data.columns[i].displayName.length<h.maxLetters){return h.data.columns[i].displayName}else{return h.data.columns[i].displayName.substring(0,h.maxLetters-3)+"..."}})};g.prototype.makeAxisLabels=function(){var h=this;this.axesGroup.append("text").attr("x",function(i){return h.scale.horizontal(i)+h.options.thickness/2}).attr("y",function(){return h.position.axes.bottom+20}).classed("bottomValueLabel",true);this.axesGroup.append("text").attr("x",function(i){return h.scale.horizontal(i)+h.options.thickness/2}).attr("y",function(){return h.position.axes.top-20}).classed("topValueLabel",true);this.axesGroup.append("text").attr("x",function(i){return h.scale.horizontal(i)+h.options.thickness/2}).attr("y",function(i){if(d.getObjective(i)==="MINIMIZE"){return h.scale[i](h.max(i))+40}else{return h.scale[i](h.min(i))+40}}).classed("paramName",true);this.updateAxisLabels();this.applyThresholds()};g.prototype.applyThresholds=function(){var i;var h=this;this.axesGroup.each(function(m){i=d.getConstraintBounds(m);var l=h.axesGroup.selectAll(".sim-ui-pcplot-threshold").data(i);l.exit().remove();var j=l.enter().append("g").classed("sim-ui-pcplot-threshold",true);j.append("line");l.select("g").select("line").attr("x1",function(){return h.scale.horizontal(m)-h.options.thickness-2}).attr("x2",function(n){if(n===null){return h.scale.horizontal(m)-h.options.thickness-2}else{return h.scale.horizontal(m)+h.options.thickness+2}}).attr("y1",function(n){return h.scale[m](n)}).attr("y2",function(n){return h.scale[m](n)}).classed("sim-ui-pcplot-threshold-line",true);j.append("rect");var k=l.select("rect");j.append("text");l.select("text").text(function(n){if(n!==null){return h.parseValue(n)}}).attr("x",function(n){if(n!==null){return h.scale.horizontal(m)+h.options.thickness+this.getComputedTextLength()/2+5}}).attr("y",function(n){if(n!==null){return h.scale[m](n)-3}}).classed("sim-ui-pcplot-threshold-text",true);k.attr("x",function(n){if(n!==null){return h.scale.horizontal(m)+h.options.thickness/2+7}}).attr("y",function(n){if(n!==null){return h.scale[m](n)-(15)/2-5}}).attr("height",function(n){if(n===null){return 0}else{return 15+5}}).attr("width",function(n){if(n===null){return 0}else{return d3.select(this.parentNode).selectAll("text")[0][0].getComputedTextLength()+5}}).classed("sim-ui-pcplot-threshold-rect",true)})};g.prototype.populatePoints=function(l){this.points={};for(var k=0;k<l.length;k++){this.points[l[k]]=[];for(var h=0;h<this.data.usedColumnKeys.length;h++){if(this.data.rowData[l[k]]!==undefined){this.points[l[k]].push({x:this.data.usedColumnKeys[h],y:this.parseValue(this.data.rowData[l[k]].mainData[this.data.usedColumnKeys[h]]),type:this.data.rowData[l[k]].metaData.grade})}}}};g.prototype.makeLines=function(k){var l=this;this.lineContainerGroup=d3.select("#pcplot-lineContainer");if(!this.lineContainerGroup.node()){this.lineContainerGroup=this.plotGroup.append("g").attr("id","pcplot-lineContainer")}var h=d3.svg.line().defined(function(m){return m.y!==null&&!isNaN(m.y)}).x(function(m){return(l.scale.horizontal(m.x)+l.options.thickness/2)}).y(function(m){return l.scale[m.x](parseFloat(m.y))}).interpolate("linear");var j=this.lineContainerGroup.selectAll(".sim-ui-pcplot-line-group").data(k,function(m){return m});j.exit().remove();var i=j.enter().append("g").attr("class","sim-ui-pcplot-line-group");i.append("path").attr("class","sim-ui-pcplot-line");j.select("path").attr("class","sim-ui-pcplot-line").datum(function(m){if(l.points[m]){return l.points[m]}}).attr("d",function(m){return h(m)}).style("fill","none").attr("class",function(m){return"sim-ui-pcplot-"+m[0].type}).on("mouseover",function(m){d3.select(this).classed("sim-ui-pcplot-selected-hover",true);l.showParamValues(m,"hover");if(l.som){l.som.udmHandler.toggleHighlight("highlighted-hex-hover",""+(Number(d3.select(this.parentNode).data()[0])-1))}}).on("mouseout",function(){d3.select(this).classed("sim-ui-pcplot-selected-hover",false);d3.selectAll(".sim-ui-pcplot-values-hover").remove();if(l.som){l.som.udmHandler.toggleHighlight("highlighted-hex-hover",""+(Number(d3.select(this.parentNode).data()[0])-1))}}).on("click",function(m){if(d3.select(this).classed("sim-ui-pcplot-selected-click")){d3.select(this).classed("sim-ui-pcplot-selected-click",false);d3.selectAll(".sim-ui-pcplot-values-click").remove();if(l.som){l.som.udmHandler.toggleHighlight("highlighted-hex-click",""+(Number(d3.select(this.parentNode).data()[0])-1))}}else{d3.selectAll(".sim-ui-pcplot-values-click").remove();d3.selectAll(".sim-ui-pcplot-selected-click").classed("sim-ui-pcplot-selected-click",false);d3.select(this).classed("sim-ui-pcplot-selected-click",true);l.showParamValues(m,"click",""+(Number(d3.select(this.parentNode).data()[0])-1));if(l.som){l.som.udmHandler.toggleHighlight("highlighted-hex-click",""+(Number(d3.select(this.parentNode).data()[0])-1))}}});j.exit().remove();i.call(this.makeContextMenu)};g.prototype.showParamValues=function(m,i,j){var l=this;var h=this.axesGroup.selectAll(".sim-ui-pcplot-values-"+i).data(function(o,n){return[m[n]]}).enter().append("g").attr("class","sim-ui-pcplot-values-"+i);h.append("rect");var k=h.append("text").text(function(n){if(!isNaN(n.y)){return n.y}}).attr("x",function(n){if(!isNaN(n.y)){return(l.scale.horizontal(n.x)+l.options.thickness/2)}}).attr("y",function(n){if(!isNaN(n.y)){return l.scale[n.x](n.y)-3}});this.axesGroup.select(".sim-ui-pcplot-values-"+i).select("rect").attr("x",function(o,n){if(!isNaN(l.parseValue(d3.select(k[n][0]).text()))){return(l.scale.horizontal(o)+l.options.thickness/2-k[n][0].getComputedTextLength()/2-5)}}).attr("y",function(o,n){if(!isNaN(l.parseValue(d3.select(k[n][0]).text()))){return(l.scale[o](d3.select(k[n][0]).text())-15/2-5)}}).attr("height",function(o,n){if(!isNaN(l.parseValue(d3.select(k[n][0]).text()))){return 15+5}}).attr("width",function(o,n){if(!isNaN(l.parseValue(d3.select(k[n][0]).text()))){return k[n][0].getComputedTextLength()+10}});h.on("click",function(){d3.selectAll(".sim-ui-pcplot-values-click").remove();d3.selectAll(".sim-ui-pcplot-selected-click").classed("sim-ui-pcplot-selected-click",false);if(l.som){l.som.udmHandler.toggleHighlight("highlighted-hex-click",j)}})};g.prototype.makeContextMenu=function(){this.each(function(i){var h={title:"Alternative "+parseInt(i,10),items:[{label:a.translate("More Info"),icon:f.ICON_LOCATION+"moreinfo_small"+f.ICON_EXTENSION,action:function(){e.makeParamPopover(parseInt(i,10))}},{label:function(){return d.isInBasket(parseInt(i,10))==-1?a.translate("Add to Basket"):a.translate("Remove from Basket")},icon:function(){return d.isInBasket(parseInt(i,10))==-1?f.ICON_LOCATION+"basket_small"+f.ICON_EXTENSION:f.ICON_LOCATION+"basket_remove"+f.ICON_EXTENSION},action:function(){if(d.isInBasket(parseInt(i,10))==-1){d.addToBasket(parseInt(i,10))}else{d.removeFromBasket(parseInt(i,10))}}},{label:function(){return d.isIncluded(parseInt(i,10))?a.translate("Exclude Alt"):a.translate("Include Alt")},iconType:function(){return d.isIncluded(parseInt(i,10))?"Exclude Alt.":"jquery"},icon:function(){return d.isIncluded(parseInt(i,10))?f.ICON_LOCATION+"exclude"+f.ICON_EXTENSION:"ui-icon-plusthick"},action:function(){if(d.isIncluded(parseInt(i,10))){d.excludePoints([parseInt(i,10)])}else{d.includePoints([parseInt(i,10)])}}}]};b(this).contextPopup(h)})};g.prototype.parseValue=function(i){var h=i;if(typeof h==="string"){h=parseFloat(h)}if(h!==null&&typeof h!=="undefined"&&!isNaN(h)){if(parseInt(h,10)===h){return parseInt(h,10)}else{return parseFloat(h).toPrecision(4)}}else{}};g.prototype.makePlot=function(h){this.div.textContent="";var l=this;var k=d.filters.designCounter.totalDesigns;b("#pcPlotDiv").height(this.options.height);if((h===null||(h!==null&&h.length===0))&&k>this.maxPoints){this.div.classList.add("sim-ui-pcplot-hidden");document.querySelector("#somDiv").classList.add("sim-ui-som-hiddenpcp");return}if(this.usedColumnKeys&&this.usedColumnKeys.length>0){var j=this.usedColumnKeys;var i={};this.getData(h,j,i).done(function(n,m,o){l.data=i.content;if(l.data){if(document.querySelector("#somDiv").classList.contains("sim-ui-som-hiddenpcp")){l.div.classList.remove("sim-ui-pcplot-hidden");document.querySelector("#somDiv").classList.remove("sim-ui-som-hiddenpcp")}l.data.columns={};j.forEach(function(p){l.data.columns[p]=d.findParameter(p)});l.data.rowKeys=Object.keys(l.data.rowData);l.data.usedColumnKeys=Object.keys(l.data.columnData.mainData);l.makeSVG();l.populatePoints(l.data.rowKeys);l.makeGradients();l.makeScales();if(l.data.rowKeys.length>0){l.makeLines(l.data.rowKeys)}l.makeAxes()}else{if(!document.querySelector("#somDiv").classList.contains("sim-ui-som-hiddenpcp")){if(l.chart){l.chart.remove()}document.querySelector("#somDiv").classList.add("sim-ui-som-hiddenpcp")}}})}else{this.div.textContent=a.translate("no_param_msg")}};g.prototype.updatePlot=function(h){if(document.getElementsByClassName("sim-ui-pcplot").length===0){document.querySelector("#somDiv").classList.remove("sim-ui-som-hiddenpcp");this.makePlot(h);return}var j=d.filters.designCounter.totalDesigns;var k=this;var i={};if((h===null||(h!==null&&h.length===0))&&j>this.maxPoints){d3.select(".sim-ui-pcplot").remove();document.querySelector("#somDiv").classList.add("sim-ui-som-hiddenpcp");return}this.getData(h,this.data.usedColumnKeys,i).done(function(m,l,n){k.data=i.content;if(k.data){k.data.columns={};k.data.usedColumnKeys=Object.keys(k.data.columnData.mainData);k.data.usedColumnKeys.forEach(function(o){k.data.columns[o]=d.findParameter(o)});k.updateScales();k.updateAxisLabels();k.applyThresholds();k.data.rowKeys=Object.keys(k.data.rowData);k.populatePoints(k.data.rowKeys);k.makeLines(k.data.rowKeys);k.updateAxesColors()}else{if(!document.querySelector("#somDiv").classList.contains("sim-ui-som-hiddenpcp")){if(k.chart){k.chart.remove()}document.querySelector("#somDiv").classList.add("sim-ui-som-hiddenpcp")}}})};g.prototype.updateAxesColors=function(){var h=this;this.axesContainerGroup=d3.select("#pcplot-axesContainer");if(!this.axesContainerGroup.node()){this.axesContainerGroup=this.plotGroup.append("g").attr("id","pcplot-axesContainer")}this.axesGroup=this.axesContainerGroup.selectAll(".sim-ui-pcplot-axes").data(this.data.usedColumnKeys);this.axesGroup.append("rect").attr("x",function(i){return h.scale.horizontal(i)}).attr("y",h.position.axes.top).attr("width",this.options.thickness).attr("height",this.position.axes.bottom-this.position.axes.top>0?this.position.axes.bottom-this.position.axes.top:0).style("fill",function(o){var m=h.data.columns[o];if(d.getObjective(o)!==null&&d.getObjective(o)!=="TARGET"){if(m.min===m.max){return h.colors.obj[0]}else{return"url(#objGradient)"}}else{if(d.getObjective(o)==="TARGET"){if(m.min===m.max){return h.colors.obj[0]}else{var n;var l=d.formulation.objectives;for(var k=0;k<l.length;k++){if(l[k].parameterID===o){n=l[k].value}}var i=h.chart.append("svg:defs").append("svg:linearGradient").attr("id","targetGradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad");i.append("svg:stop").attr("offset","0%").attr("stop-color",h.colors.obj[1]).attr("stop-opacity",1);i.append("svg:stop").attr("offset",100-(n-m.min)*100/(h.max(o)-m.min)+"%").attr("stop-color",h.colors.obj[0]).attr("stop-opacity",1);i.append("svg:stop").attr("offset","100%").attr("stop-color",h.colors.obj[1]).attr("stop-opacity",1);return"url(#targetGradient)"}}else{if(h.min(o)===m.max){return h.colors.def[1]}else{return"url(#defaultGradient)"}}}})};g.prototype.getData=function(h,k,j){if(h&&h.length===0){h=null}var i=b.Deferred();d.getRowDataFromSomSelection({selectedCells:JSON.stringify(h),parameterIdList:JSON.stringify(k)}).done(function(m,l,n){j.content=c.getJSONFromResponse([m,l,n]);i.resolve()});return i};return g});define("DS/SMAAnalyticsUI/SMAAnalyticsOptSettings",["UWA/Core","UWA/Class/Promise","DS/SMAAnalyticsTweakerUI/SMAAnalyticsTweakerUI","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/Tweakers/TypeRepresentationFactory","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/Controls/Toggle",],function(f,k,o,h,a,n,d,m){var e=undefined;var i=undefined;var b="valueType";var l="semantics";var g="defaultValue";var j="com.dassault_systemes.sma.plugin.optimization.Asa";var c={_typeRepFactory:undefined,_optSettingsTree:undefined,_availableTechniques:undefined,_showOnlyImprovements:false,_getDataFromDescendants:function(q,r,p){q.getAllDescendants().forEach(function(s){if(s.getAllDescendants().length===0){p[s.options.key]={};p[s.options.key][b]=r[s.options.key][l][b];p[s.options.key][g]=s.options.grid.data}else{e._getDataFromDescendants(s,r,p)}},this)},_fetch:function(){var t=e._optSettingsTree[0];var q=t.getRoot().options.grid.key;var p=e._availableTechniques[q].parameters;var s={};e._getDataFromDescendants(t,p,s);var r={};r[q]=s;return r},getDefault:function(){var s=j;if(e._availableTechniques&&null!==e._availableTechniques){if(!e._availableTechniques[s]||e._availableTechniques[s]===null){s=Object.keys(e._availableTechniques)[0]}}else{console.error("No optimization techniques were identified in the client. Check the installation.");return undefined}var v=e._availableTechniques[s].parameters;var r={};for(var q in v){var u=v[q];var t={};t[b]=u[l][b];t[g]=u[g];r[q]=t}var p={};p[s]=r;return p},_processSettingsData:function(p){if(p&&null!==p){Object.keys(p).forEach(function(r){var s=p[r].title;if(s&&s!==null&&s.length>0){var q=n.translate(s);if(q&&q!==null&&q.length>0){p[r].label=q}else{p[r].label=s}}})}return p},createSettingsForm:function(q,r,p,t){q=q||{showImprovements:false};e._showOnlyImprovements=q.showImprovements;if(typeof r==="undefined"||r===null){r={}}function s(){return new k(function(v,u){h.getOptimizationSettings().then(function(B){Object.keys(r).forEach(function(C){if(typeof B[C]!==undefined&&B[C]!==null){B[C].parameters=f.extend(B[C].parameters,r[C],true)}});e._availableTechniques=B;var y=f.createElement("div",{id:"main-container"});var x=f.createElement("div",{id:"plot-settings-container"});var w=new m({type:"switch",label:n.translate("SHOW_SCORE_IMPROV"),checkFlag:e._showOnlyImprovements});w.inject(x);w.addEventListener("change",function(C){C.preventDefault();C.stopPropagation();e._showOnlyImprovements=C.dsModel.checkFlag});var A=$simjq('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+n.translate("START_OPT")+"</button>").on("click",function(){var C=e._fetch();d.closePopover();if(typeof p==="function"){p(C,e._showOnlyImprovements)}});var z={width:700,height:400,noTabs:false,footerOptions:{type:"buttons",content:A}};e._optSettingsTree=i.buildTweakerUI(y,B,n.translate("OPT_TECH"),e._typeRepFactory,h,true);d.makePopover(["Optimization","Plot"],[$simjq(y),$simjq(x)],n.translate("OPT_SETT"),"optimizationSettingsPopover",z)},u)})}if(!e._typeRepFactory){e._typeRepFactory=new a();e._typeRepFactory.onReady=s}else{s()}},init:function(){e=this;i=new o();return new Promise(function(r,q){var p=[];p.push(new Promise(function(s){e._typeRepFactory=new a();e._typeRepFactory.onReady=s}));p.push(new Promise(function(t,s){h.getOptimizationSettings().then(function(u){e._availableTechniques=u;t()},s)}));Promise.all(p).then(r.bind(this,e),q.bind(this,e))})},};return c});define("DS/SMAAnalyticsUI/SMAAnalyticsSelfOrganizingMap",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,c,a){function d(h,g,f,e){this.div="#somDiv";this.options=f.som;this.data=h;this.rawResults=g.map;if(this.rawResults){this.options.numRows=this.rawResults.length;this.options.numColumns=this.rawResults[0].length}else{this.options.numRows=0;this.options.numColumns=0}this.clusterCentroids=g.clusterCentroids;this.unifiedDistance=g.unifiedDistance;this.colors=f.colors;this.pointsToCellMap={};this.selectedCells=[];this.mapViewHandler=e;this.maxPoints=this.options.maxPoints}d.prototype.populateResults=function(){var t=[];var n=2*this.options.hexRadius;var s=this.options.hexRadius*Math.sqrt(3);this.maxPoints=0;var p=this;var k,f;this.results=[];f=this.options.margin.top+n/2;for(var m=0;m<this.options.numRows;m++){this.results.push([]);k=this.options.margin.left+s/2*((m+1)%2);for(var l=0;l<this.options.numColumns;l++){var q=this.rawResults[m][l];t=[];t.push({x:k,y:f-0.5*n});t.push({x:k+0.5*s,y:f-0.25*n});t.push({x:k+0.5*s,y:f+0.25*n});t.push({x:k,y:f+0.5*n});t.push({x:k-0.5*s,y:f+0.25*n});t.push({x:k-0.5*s,y:f-0.25*n});t.push({x:k,y:f-0.5*n});this.results[m].push({});this.results[m][l].points=t;this.results[m][l].cx=k;this.results[m][l].cy=f;this.results[m][l].data=q;this.results[m][l].clusterCentroids=this.clusterCentroids[m][l];k=k+s;var r=0;var g=0;var o=0;if(this.rawResults[m][l]!==null){var e=q.numPareto+q.numInfeasible+q.numDominated;if(this.maxPoints<e){this.maxPoints=e;this.maxPointsCell=[m,l]}r=q.numPareto;g=q.numDominated;o=q.numInfeasible;if(q.rowIdList){q.rowIdList.forEach(function(h){p.pointsToCellMap[h]=[m,l]})}}this.results[m][l].numPareto=r;this.results[m][l].numDominated=g;this.results[m][l].numInfeasible=o}f=f+n-n/4*((m+1)%2)-n/4*(m%2)}this.points=t};d.prototype.makeSVG=function(){this.chartDiv=d3.select(this.div).data([this.param]).append("div").attr("class","sim-ui-som-div").attr("draggable","true").style("width",this.options.width).attr("data-paramID",this.param);this.chart=this.chartDiv.append("svg").attr("class","sim-ui-som").attr("x",0).attr("y",0).attr("width",this.options.width).attr("height",this.options.height).attr("id","som_"+this.param);this.plotGroup=this.chart.append("g").attr("class","sim-ui-som-group")};d.prototype.makeBackgroundRect=function(){var e=this;this.backgroundRect=this.plotGroup.data([this.param]).append("rect").attr("x",0).attr("y",0).attr("width",this.options.width).attr("height",this.options.height).style("fill","white");this.titleText=this.plotGroup.data([this.param]).append("text").text(function(){if(e.paramData.displayName.length>30){return(e.paramData.displayName.substring(0,27)+"...")}else{return e.paramData.displayName}}).attr("x",function(){return((e.options.width-e.options.hexRadius*Math.sqrt(3)/2)/2)}).attr("y",25).style("font-size","11pt").style("cursor","move")};d.prototype.eventHandler=function(){var l=this;var i=0;this.backgroundRect.on("click",function(m){if(i!==0){i=0;setTimeout(function(){l.makeFullPageSOM(m)},100)}else{i++;setTimeout(function(){i=0;d3.selectAll(".hex").classed("highlighted-hex-click",false);d3.selectAll(".hex").classed("highlighted-hex-hover",false);if(l.selectedCells.length>0){d3.selectAll(".hex").classed("selected-hex",false);l.selectedCells=[];l.mapViewHandler.sessionObject.pcPlot.updatePlot(l.selectedCells)}},300)}});if(this.titleText){var f=function(m){if(d3.select(this).data()[0].length!==0){this.style.opacity="0.4";m.dataTransfer.effectAllowed="copy";m.dataTransfer.setData("param",d3.select(this).data()[0])}};var e=function(){this.style.opacity="1";return false};var l=this;var j=function j(m){if(m.preventDefault){m.preventDefault();d3.select(this).select("rect").style("stroke","black").style("stroke-width","2px")}};var k=function(m){if(m.preventDefault){m.preventDefault()}d3.select(this).select("rect").style("stroke","black").style("stroke-width","2px")};var h=function(m){if(m.preventDefault){m.preventDefault()}d3.select(this).select("rect").style("stroke-width","0px")};var g=function(n){var q=n.dataTransfer.getData("param");if(q.length>0){var p,o;for(var m=0;m<l.data.usedColumnKeys.length;m++){if(d3.select(this).data()[0]===l.data.usedColumnKeys[m]){p=m}if(q===l.data.usedColumnKeys[m]){o=m}}l.data.usedColumnKeys[p]=q;l.data.usedColumnKeys[o]=d3.select(this).data()[0];l.mapViewHandler.createAllSOMs()}return false};this.chartDiv.node().addEventListener("dragover",j,false);this.chartDiv.node().addEventListener("dragenter",k,false);this.chartDiv.node().addEventListener("dragleave",h,false);this.chartDiv.node().addEventListener("drop",g,false);this.chartDiv.node().addEventListener("dragstart",f,false);this.chartDiv.node().addEventListener("dragend",e,false)}};d.prototype.makeHex=function(f){var h=this;var g=f.selectAll(".sim-ui-som-hex-group").data(function(i){return i},function(j){var i=0;j.clusterCentroids.forEach(function(k){i+=k});return i}).enter().append("g").attr("class","sim-ui-som-hex-group").attr("class",function(k,j){return"column_"+j});var e=d3.svg.line().x(function(i){return i.x}).y(function(i){return i.y}).interpolate("linear");g.append("path").attr("class","hex").attr("d",function(i){return e(i.points)}).attr("title",function(i){return i.clusterCentroids[h.paramNumber]});return g};d.prototype.makeParetoDots=function(f){var e=this;f.append("circle").attr("class","dot").attr("cx",function(g){return g.cx}).attr("cy",function(g){return g.cy}).attr("r",function(h){var g;if(h.data===null){g=0}else{return(h.numPareto*e.options.maxDotRadius/e.maxPoints)}return g}).style("fill","#499F3F")};d.prototype.makeDots=function(f){var e=this;f.append("circle").attr("class","dot").attr("cx",function(g){return g.cx}).attr("cy",function(g){return g.cy}).attr("r",function(g){return((g.numDominated+g.numInfeasible)*e.options.maxDotRadius/e.maxPoints)}).style("fill","black")};d.prototype.makeHoverValues=function(f){var e=this;f.append("title").text(function(g){return g.clusterCentroids[e.paramNumber]})};d.prototype.makeColorScale=function(){var g;var i=[];if(c.getObjective(this.param)===null){i=this.colors.def;g=[this.data.columns[this.param].max,(this.data.columns[this.param].max+this.data.columns[this.param].min)/2,this.data.columns[this.param].min]}else{if(c.getObjective(this.param)==="TARGET"){var h;var f=c.formulation.objectives;for(var e=0;e<f.length;e++){if(f[e].parameterID===this.param){h=f[e].value}}i=[this.colors.obj[1],this.colors.obj[0],this.colors.obj[1]];g=[this.data.columns[this.param].max,h,this.data.columns[this.param].min]}if(c.getObjective(this.param)==="MAXIMIZE"){i=this.colors.obj}else{if(c.getObjective(this.param)==="MINIMIZE"){i=this.colors.obj.slice().reverse()}}g=[this.data.columns[this.param].max,this.data.columns[this.param].min]}this.colorScale=d3.scale.linear().domain(g).range(i).interpolate(d3.interpolateRgb)};d.prototype.clickActions=function(h,g){var j=this;var f=parseInt(g.split("_")[1],10);var m=parseInt(h.split("_")[1],10);var k="."+h.replace(" ",".");var l=d3.selectAll(document.querySelectorAll(k)).selectAll("."+g).selectAll(".hex");var e=[m,f];if(l.classed("selected-hex")){l.classed("selected-hex",false);if(j.results[m][f].data!==null){for(var i=0;i<j.selectedCells.length;i++){if(j.selectedCells[i].equals(e)){break}}j.selectedCells.splice(i,1);this.mapViewHandler.sessionObject.pcPlot.updatePlot(j.selectedCells)}}else{if(j.results[m][f].data!==null){l.classed("selected-hex",true);j.selectedCells.push(e);this.mapViewHandler.sessionObject.pcPlot.updatePlot(j.selectedCells)}}};d.prototype.addColors=function(e){var f=this;this.hexGroup.style("fill",function(h){var g=h.clusterCentroids[e];if(g>f.paramData.max){g=f.paramData.max}else{if(g<f.paramData.min){if(g===Number.MIN_VALUE){return"white"}else{g=f.paramData.min}}}return f.colorScale(g)})};d.prototype.makeNewSOM=function(g){for(var e=0;e<this.data.columnKeys.length;e++){if(this.data.columnKeys[e]===g){this.paramNumber=e;break}}this.populateResults();this.param=g;this.paramData=c.findParameter(this.param);this.makeSVG();this.makeBackgroundRect();this.eventHandler();this.makeColorScale();var f=this.plotGroup.selectAll(".sim-ui-som-hex-row").data(this.results,function(j,h){return h});this.hexRowGroup=f.enter().append("g").attr("class",function(j,h){return"row_"+h+" sim-ui-som-hex-row"});f.exit().remove();this.hexGroup=this.makeHex(this.hexRowGroup);this.makeDots(this.hexGroup);this.makeParetoDots(this.hexGroup);this.addColors(this.paramNumber);this.makeThresholdLayer(this.paramNumber)};d.prototype.updateSOM=function(){this.makeColorScale();var e=this.plotGroup.selectAll(".sim-ui-som-hex-row").data(this.results,function(g,f){return f});e.exit().remove();this.hexGroup=this.makeHex(this.hexRowGroup);this.makeDots(this.hexGroup);this.makeParetoDots(this.hexGroup);this.addColors(this.paramNumber);this.makeThresholdLayer(this.paramNumber)};d.prototype.updateUDM=function(){var f=this;var e=this.plotGroup.selectAll(".sim-ui-som-hex-row").data(this.results,function(h,g){return g});e.exit().remove();this.hexGroup=this.makeHex(this.hexRowGroup);this.makeDots(this.hexGroup);this.makeParetoDots(this.hexGroup);this.hexGroup.style("fill",function(j,g){var h=f.results.indexOf(d3.select(this.parentNode).data()[0]);return f.colorScale(f.unifiedDistance[h][g])});this.makeThresholdLayer();this.thresholdGroup.selectAll(".hex").style("fill-opacity",0)};d.prototype.makeUDM=function(){var l=this;this.param="udm";this.options.hexRadius=1.35*(this.options.height-2*this.options.margin.left)/(2*this.options.numRows)>100?100:1.35*(this.options.height-2*this.options.margin.left)/(2*this.options.numRows);this.options.maxDotRadius=this.options.hexRadius/2.5;this.makeSVG();this.chartDiv.attr("draggable","false");this.backgroundRect=this.plotGroup.data(["udm"]).append("rect").attr("x",0).attr("y",0).attr("width",this.options.width).attr("height",this.options.height).style("fill","white");this.eventHandler();this.plotGroup.append("text").text(a.translate("Unified Distance Matrix")).attr("x",function(){return((l.options.width-l.options.hexRadius*Math.sqrt(3)/2)/2)}).attr("y",25).style("font-size","11pt");this.populateResults();var k=Number.MAX_VALUE;var h=Number.MIN_VALUE;for(var f=0;f<this.unifiedDistance.length;f++){for(var e=0;e<this.unifiedDistance[f].length;e++){if(k>this.unifiedDistance[f][e]){k=this.unifiedDistance[f][e]}if(h<this.unifiedDistance[f][e]){h=this.unifiedDistance[f][e]}}}this.colorScale=d3.scale.linear().domain([k,h]).range(this.colors.udm).interpolate(d3.interpolateRgb);var g=this.plotGroup.selectAll(".sim-ui-som-hex-row").data(this.results,function(m,j){return j});this.hexRowGroup=g.enter().append("g").attr("class",function(m,j){return"row_"+j+" sim-ui-som-hex-row"});g.exit().remove();this.hexGroup=this.makeHex(this.hexRowGroup);this.makeDots(this.hexGroup);this.makeParetoDots(this.hexGroup);this.hexGroup.style("fill",function(n,j){var m=l.results.indexOf(d3.select(this.parentNode).data()[0]);return l.colorScale(l.unifiedDistance[m][j])});this.makeThresholdLayer();this.thresholdGroup.selectAll(".hex").style("fill-opacity",0)};d.prototype.initializeSelected=function(){for(var f=0;f<this.mapViewHandler.selectedPoints.length;f++){var e=this.pointsToCellMap[this.mapViewHandler.selectedPoints[f]];d3.selectAll(".row_"+e[0]).selectAll(".column_"+e[1]).selectAll(".hex").classed("selected-hex",true)}};d.prototype.toggleHighlight=function(g,h){var f=this.pointsToCellMap[h];if(f){var e=d3.selectAll(".row_"+f[0]).selectAll(".column_"+f[1]).selectAll(".hex");if(e.classed(g)){e.classed(g,false)}else{e.classed(g,true)}}};d.prototype.updateThresholdLayer=function(){var f=this;var e=this.plotGroup.selectAll(".sim-ui-som-hex-threshold-row").data(this.results,function(h,g){return g});e.exit().remove();this.thresholdGroup=this.makeHex(this.thresholdRowGroup);this.thresholdGroup.style("stroke","black").style("stroke-width",0).style("fill","black").style("fill-opacity",function(j){var k,g;for(var h=0;h<f.data.columnKeys.length;h++){g=0;k=c.getConstraintBounds(f.data.columnKeys[h]);if((k[0]!==null&&j.clusterCentroids[h]<k[0])||(k[1]!==null&&j.clusterCentroids[h]>k[1])){g=0.5;break}}return g})};d.prototype.makeThresholdLayer=function(e){var g=this;this.thresholdBounds={};var f=this.plotGroup.selectAll(".sim-ui-som-hex-threshold-row").data(this.results,function(j,h){return h});this.thresholdRowGroup=f.enter().append("g").attr("class",function(j,h){return"row_"+h+" sim-ui-som-hex-threshold-row"});f.exit().remove();this.thresholdGroup=this.makeHex(this.thresholdRowGroup);this.thresholdGroup.style("stroke","black").style("stroke-width",0).style("fill","black").style("fill-opacity",function(k){var l,h;for(var j=0;j<g.data.columnKeys.length;j++){h=0;l=c.getConstraintBounds(g.data.columnKeys[j]);if((l[0]!==null&&k.clusterCentroids[j]<l[0])||(l[1]!==null&&k.clusterCentroids[j]>l[1])){h=0.5;break}}return h});this.thresholdGroup.selectAll("path").on("click",function(){g.clickActions(d3.select(this.parentNode.parentNode).attr("class"),d3.select(this.parentNode).attr("class"))});if((typeof e!=="undefined")){this.thresholdGroup.append("title").text(function(h){return h.clusterCentroids[e]})}this.thresholdGroup.call(this.makeContextMenu,g)};d.prototype.makeContextMenu=function(e,f){this.each(function(l){var h={},g={},j={},k={};h.label=function(){return a.translate("Add All To Basket")};h.iconType="image";h.icon=function(){return"./assets/icons/basket_small.png"};h.action=function(){if(f.selectedCells===null||(f.selectedCells!==null&&f.selectedCells.length===0)){alert("No cells have been selected!")}c.setBasketRowsFromSomSelection({selectedCells:JSON.stringify(f.selectedCells),add:true})};g.label=function(){return a.translate("Remove All From Basket")};g.iconType="image";g.icon=function(){return"./assets/icons/basket_remove.png"};g.action=function(){if(f.selectedCells===null||(f.selectedCells!==null&&f.selectedCells.length===0)){alert(a.translate("No cells have been selected"))}c.setBasketRowsFromSomSelection({selectedCells:JSON.stringify(f.selectedCells),add:false})};k.label=function(){return a.translate("Exclude All")};k.icon=function(){return"./assets/icons/exclude.png"};k.action=function(){if(f.selectedCells===null||(f.selectedCells!==null&&f.selectedCells.length===0)){alert(a.translate("No cells have been selected"));return}c.setExcludedRowsFromSomSelection({selectedCells:JSON.stringify(f.selectedCells),exclude:true})};var i={title:a.translate("Selected Cell Options"),items:[{label:h.label,icon:h.icon,action:h.action},{label:g.label,icon:g.icon,action:g.action},{label:k.label,icon:k.icon,action:k.action}]};b(this).contextPopup(i)})};d.prototype.makeFullPageSOM=function(f){var e=b("<div></div>",{"class":"sim-ui-som-single"}).appendTo(b("#mapView"));var g=d3.select(b("#som_"+f).clone().appendTo(e)[0]).attr("class","sim-ui-som-single-svg");g.attr("viewBox","0 0 "+this.options.height+" "+this.options.height);g.style("height",b("#mapView").height()<700?700:b("#mapView").height()).style("width",b("#mapView").width()<1400?1400:b("#mapView").width());b("<div></div>",{"class":"sim-ui-som-single-close ui-icon ui-icon-closethick"}).appendTo(e).bind("click",function(){e.remove();return false})};d.prototype.setResults=function(e){this.rawResults=e.map;this.options.numRows=this.rawResults.length;this.options.numColumns=this.rawResults[0].length;this.clusterCentroids=e.clusterCentroids;this.unifiedDistance=e.unifiedDistance;this.populateResults()};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsRadialClusterChart",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,d,c,a){function e(u){var o=d.getGroupCopy(d.parameterFilterController.filteredData);c.eliminateNonObjectivesFromHierarchy(o);var t=c.makeD3GroupCopy(o);if(t.children.length===0){b(u).empty();b(u).append("<div class='sim-ui-elicit-emptyRadialCluster'>"+a.translate("NO_SCRD_PARAMS")+".</div>");return}var G=d3.format(".1%");var k=b(u).width(),K=b(u).height(),D=k*0.9,B=K*0.9;var p=Math.min(D,B)/2-120;var A=d3.select(u).append("svg").attr("width",D).attr("height",B).append("g").attr("transform","translate("+D/2+","+B/2+")");var z=d3.layout.tree().size([360,p]).separation(function(w,h){if(w.depth===0){return 1}else{if(h.parentID===w.parentID){return 3/w.depth}else{return 5/w.depth}}});var E=z.nodes(t);var i=z.links(E);var F=d3.svg.diagonal.radial().projection(function(h){return[h.y,h.x*Math.PI/180]});var f=A.selectAll("path").data(i).enter().append("path").classed("sim-ui-radial-connection",true).attr("d",F);var v=A.selectAll("g").data(E).enter().append("g").attr("transform",function(h){return"rotate("+(h.x-90)+")translate("+h.y+")"});var J=v.filter(function(h){if(h.children&&h.children.length!==0){return h}});var q=v.filter(function(h){if(!h.children||h.children.length===0){return h}});J.append("circle").classed("sim-ui-radial-groupCircle",true).attr("r",8);q.append("text").classed("sim-ui-radial-parameterText",true).attr("dy",6).attr("dx",function(h){if(h.x<180){return 0}else{return 0}}).attr("transform",function(h){if(h.x<180){return"translate(10)"}else{return"rotate(180)translate(-10)"}}).attr("text-anchor",function(h){return h.x<180?"start":"end"}).append("tspan").attr("value",function(h){return h.displayName}).text(function(h){return h.displayName});function n(O){var w=d3.select(this);var h;var M="";if(typeof O.groupIDs!=="undefined"){M+="rotate("+(90-O.x)+")";h=w.append("text").attr("dy",-15).attr("text-anchor","middle")}else{var N=w.select("text");if(O.x<180){M+="translate(0,15)";h=N.insert("tspan",":first-child").attr("dx",-4)}else{h=N.append("tspan").attr("text-anchor","start").attr("dx",4);M+="rotate(180)translate(0,15)"}}h.classed("sim-ui-radial-weightText",true).text(function(Q){if(Q.ID&&d){var P=d.findParameter(Q.ID)||d.findGroup(Q.ID);if(P===null){console.log("Parameter not found for ID: "+Q.ID);P=d.findGroup(Q.ID)}if(P!==null){return G(P.weightFactor)}console.log("Group not found for ID: "+Q.ID)}return G(Q.weightFactor)}).attr("transform",M)}function m(M,R,P,S){var N,w,h,U,O,Q,T;N=Math.atan(M/R);w=Math.atan(R/M)+Math.PI/2;h=Math.PI+N;U=Math.PI+w;T=P*Math.PI/180;if(T>N&&T<w){O=T-Math.PI/2;Q=M/2/Math.cos(O)-S}else{if(T>w&&T<h){O=T-Math.PI;Q=R/2/Math.cos(O)-S}else{if(T>h&&T<U){O=T-3*Math.PI/2;Q=M/2/Math.cos(O)-S}else{if((T>0&&T<N)||(T>U&&T<2*Math.PI)){O=T;Q=R/2/Math.cos(O)-S}}}}return Q}function C(P,w){if(w<=0||P===null){return null}var O=d3.select(P).selectAll("tspan").filter(function(){return d3.select(this).classed("sim-ui-radial-weightText")?0:1});var N=O.text();var R=0,h,Q=N.length,M;while(M>0){h=R+M;O.text(N.substr(0,h));if(P.getBBox().width>w){Q=h}else{R=h}M=Math.floor(M/2)}O.text(N.substr(0,R)+"...");return O}function s(){d3.select(this).each(g).each(y).each(r)}function g(){v.selectAll(".sim-ui-radial-parameterText, .sim-ui-radial-connection, .sim-ui-radial-weightText").classed("sim-ui-radial-deselected",true)}function y(w){var h=v.filter(function(M){return M.parentID===w.ID?1:0});h.selectAll(".sim-ui-radial-parameterText, .sim-ui-radial-connection, .sim-ui-radial-weightText").classed("sim-ui-radial-deselected",false);h.selectAll(".sim-ui-radial-parameterText").each(L);h.selectAll(".sim-ui-radial-groupCircle").each(I);f.filter(function(M){return M.source.ID===w.ID?1:0}).each(j);h.each(y)}function r(w){var h=d3.select(this);h.selectAll(".sim-ui-radial-parameterText, .sim-ui-radial-connection, .sim-ui-radial-weightText").classed("sim-ui-radial-deselected",false);h.selectAll(".sim-ui-radial-parameterText").each(L);h.selectAll(".sim-ui-radial-groupCircle").each(I);f.filter(function(M){return M.target.ID===w.ID?1:0}).each(j);v.filter(function(M){return M.ID===w.parentID?1:0}).each(r)}function L(){d3.select(this).classed("sim-ui-radial-selectedParameter",true)}function I(){d3.select(this).classed("sim-ui-radial-selectedGroup",true).attr("r",10)}function j(){d3.select(this).classed("sim-ui-radial-selectedConnection",true)}function l(){v.selectAll(".sim-ui-radial-parameterText, .sim-ui-radial-connection, .sim-ui-radial-weightText").classed("sim-ui-radial-deselected",false);v.selectAll(".sim-ui-radial-selectedGroup").classed("sim-ui-radial-selectedGroup",false).attr("r",8);v.selectAll(".sim-ui-radial-selectedParameter").classed("sim-ui-radial-selectedParameter",false);d3.selectAll(".sim-ui-radial-selectedConnection").classed("sim-ui-radial-selectedConnection",false)}v.each(n);var H=K;var x=k;q.each(function(N){var h=m(x,H,N.x,N.y);var w=this.getBBox().width;if(w>0&&w>h){h=Math.floor(h/2)<0?h:Math.floor(h/2);var M=C(this,h);M.on("mouseover",function(){var O=d3.select(this).attr("value");d3.select("body").append("div").classed("sim-ui-radial-tooltip",true).text(O).style("top",event.pageY+10+"px").style("left",event.pageX+20+"px").style("width",h+"px").style("word-wrap","break-word")}).on("mouseout",function(){d3.selectAll(".sim-ui-radial-tooltip").remove()})}});v.on("mouseover",s).on("mouseout",l)}return e});define("DS/SMAAnalyticsUI/SMAAnalyticsPredictionMeasures",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsUtils/SMAAnalyticsParseUtils","DS/SMAAnalyticsCompareTable/SMAAnalyticsHierarchicalTable"],function(d,f,c,g,e){function b(){this.table={};this.view=document.getElementById("measureview");this.view.classList.add("ra-measureview-page");this.data={};this.options={};this.data.residual={};this.options.avp={width:340,height:300,r:1.5,nLabels:6};this.options.avp.origin={};this.options.avp.max={};this.options.avp.origin.x=70;this.options.avp.origin.y=this.options.avp.height-50;this.options.avp.max.x=this.options.avp.width-30;this.options.avp.max.y=10;this.options.avp.lineColor="#499F3F";this.options.rvp={};this.options.rvp={width:340,height:300,r:1.5,nLabels:6};this.options.rvp.origin={};this.options.rvp.max={};this.options.rvp.origin.x=70;this.options.rvp.origin.y=this.options.rvp.height-50;this.options.rvp.max.x=this.options.rvp.width-30;this.options.rvp.max.y=10;this.options.rvp.lineColor="#499F3F";this.options.hist={};this.options.hist={width:300,height:300,r:0.5,nBars:20,barWidth:150,barHeight:10,xBox:275,boxWidth:10};this.options.hist.origin={};this.options.hist.max={};this.options.hist.origin.x=100;this.options.hist.origin.y=this.options.hist.height-50;this.options.hist.max.x=this.options.hist.width*0.9;this.options.hist.max.y=50;this.options.assessment={width:70,height:300};this.selectedPoints=[];this.measuresData={};this.outputParams=[];this.measureType="VALIDATION";this._TRAINING_PREFIX_="fit_",this._TESTING_PREFIX_="cv_",this.measuresPrefix=this._TESTING_PREFIX_;this.validationDisabled=false}function a(j,h){function i(m,l){l=l||3;if(Math.abs(m)>Math.pow(10,l)||Math.abs(m)<Math.pow(10,-1*l)){return m.toExponential(l)}else{return m.toPrecision(l)}}h=h||3;try{if(j&&j.toPrecision){return i(j,h)}}catch(k){if(j){return j}}return"N/A"}b.prototype.makeTitle=function(h){h.font="10pt sans-serif";h.fillText(c.translate("Actual By Predicted"),this.options.avp.width*0.3,20,this.options.avp.width)};b.prototype.makeAxes=function(h,i){h.strokeStyle="none";h.beginPath();h.moveTo(this.options[i].origin.x,this.options[i].origin.y);h.lineTo(this.options[i].origin.x,this.options[i].max.y);h.moveTo(this.options[i].origin.x,this.options[i].origin.y);h.lineTo(this.options[i].max.x,this.options[i].origin.y);h.stroke()};b.prototype.makeDots=function(t,s,r,h,p,k,m){k=k||"black";t.strokeStyle="none";var o=s.length;if(typeof m!=="undefined"){o=m.length}var q=0;for(var l=0;l<o;l++){if(o!=s.length){if(typeof s[q]==="undefined"){continue}var n=s[q][1];if(p=="rvp"){n=n+s[q][0]}if(a(n)!=a(m[l])){continue}}t.fillStyle=k;var j=l+1;if(s[q].length>2){j=s[q][2]+1}if(f.excludedRowIdList.indexOf(j)>-1){t.fillStyle="#d6d6d6"}if(this.selectedPoints.indexOf(j)>-1){t.fillStyle="red"}t.moveTo(r(s[q][0]),h(s[q][1]));t.beginPath();t.arc(r(s[q][0]),h(s[q][1]),this.options[p].r,0,2*Math.PI,false);t.fill();q++}};b.prototype.makeAxisTicks=function(j,o,m,l){j.font="8pt sans-serif";var h;j.strokeStyle="black";j.fillStyle="black";var p=(o.domain()[1]-o.domain()[0])/(this.options[l].nLabels-1);var n=(m.domain()[1]-m.domain()[0])/(this.options[l].nLabels-1);for(var k=0;k<this.options[l].nLabels;k++){j.textAlign="center";h=o.domain()[0]+k*p;j.fillText(a(h),o(h),this.options[l].origin.y+20);j.beginPath();j.moveTo(o(h),this.options[l].origin.y);j.lineTo(o(h),this.options[l].origin.y+5);j.stroke();j.textAlign="right";h=m.domain()[0]+k*n;j.fillText(a(h),this.options[l].origin.x-10,m(h)+5);j.beginPath();j.moveTo(this.options[l].origin.x,m(h));j.lineTo(this.options[l].origin.x-5,m(h));j.stroke()}};b.prototype.makeBoxPlot=function(i,k){var j=d3.scale.linear().range([this.options.hist.origin.y+this.options.hist.barHeight,this.options.hist.origin.y+this.options.hist.barHeight-k.histogram.length*(this.options.hist.barHeight+1)]).domain([k.min,k.max]);var h=i.getContext("2d");h.moveTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.lowerQuartile));h.lineTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.lowerQuartile));h.moveTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.median));h.lineTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.median));h.moveTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.upperQuartile));h.lineTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.upperQuartile));h.moveTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.lowerQuartile));h.lineTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.upperQuartile));h.moveTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.lowerQuartile));h.lineTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.upperQuartile));h.moveTo(this.options.hist.xBox,j(k.lowerQuartile));h.lineTo(this.options.hist.xBox,j(k.min));h.moveTo(this.options.hist.xBox,j(k.upperQuartile));h.lineTo(this.options.hist.xBox,j(k.max));h.moveTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.min));h.lineTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.min));h.moveTo(this.options.hist.xBox-this.options.hist.boxWidth/2,j(k.max));h.lineTo(this.options.hist.xBox+this.options.hist.boxWidth/2,j(k.max));h.stroke()};b.prototype.makeHoverText=function(n,m){var k=document.createElement("div");var l;for(var j=0;j<m.length;j++){l=document.createElement("text");l.textContent=m[j];k.appendChild(l);k.appendChild(document.createElement("br"))}k.classList.add("sim-ui-fit-hover-div");var h=function(){k.classList.toggle("show-fit-hover-text")};n.appendChild(k);n.addEventListener("mouseover",h,true);n.addEventListener("mouseout",h,true)};b.prototype.generateDataForMeasuresTable=function(i){var h=[];sessionInfo.predictPage.selectedApproxIds.forEach(function(j){h.push({name:f.approximations[j].displayName,measures:f.approximations[j].measures[i]})});return h};b.prototype.makeErrorMeasuresTable=function(l,k){var m=document.createElement("table");var o=function(q,s){var r=document.createElement("tr");s.forEach(function(u){var t=u;var v=null;if(Array.isArray(u)){t=u[0];if(u[1]){v="#fbb"}}var w=document.createElement(q);if(v){w.style.backgroundColor=v}w.textContent=t;r.appendChild(w)});return r};var j=["Error Measures"];l.forEach(function(q){j.push(q.name)});m.appendChild(o("th",j));var n=this.measuresPrefix;var h=function(q){if(typeof q==="number"){return a(q)}else{return"Not Available"}};var p=[c.translate("R-Squared")];l.forEach(function(r){var q=r.measures[n+"R2"];p.push([h(q)+" (>0.80) ",q<0.8])});m.appendChild(o("td",p));p=[c.translate("R-Squared Adjusted")];l.forEach(function(q){var r=q.measures[n+"R2Adjusted"];p.push([h(r)+" (>0.80) ",r<0.8])});m.appendChild(o("td",p));p=[c.translate("RMSE")];l.forEach(function(q){var r=q.measures[n+"RMSE"];p.push([h(r)+" (<0.005) ",r>0.005])});m.appendChild(o("td",p));p=[c.translate("Residual")+"/"+c.translate("Predicted")];l.forEach(function(q){var r=(q.measures[n+"ResidualMax"]-q.measures[n+"ResidualMin"])/(q.measures[n+"PredictedMax"]-q.measures[n+"PredictedMin"]);p.push([h(r)+" (<0.05) ",r>0.05])});m.appendChild(o("td",p));if(this.measureType==="VALIDATION"){p=[c.translate("CVErrorMean")]}else{p=[c.translate("FitErrorMean")]}l.forEach(function(s){var q=s.measures[n+"PercentError"],r;r=q?q.mean:undefined;p.push(h(r))});m.appendChild(o("td",p));if(this.measureType==="VALIDATION"){p=[c.translate("CVErrorMax")]}else{p=[c.translate("FitErrorMax")]}l.forEach(function(s){var q=s.measures[n+"PercentError"],r;r=q?q.max:undefined;p.push(h(r))});m.appendChild(o("td",p));var i=document.createElement("div");i.style.overflow="auto";i.appendChild(m);return i};b.prototype.getMatchingRowIDs=function(j,k){var h=[];var i=0;j.forEach(function(l){if(typeof l==="number"){if(l===k){h.push(i)}}else{if(l[1]===k){h.push(Math.floor(l[2]))}}i++});h.map(function(m,l){h[l]=m+1});return h};b.prototype.makeActualByPredicted=function(C,u,w){u=u||"black";var t=this;var B=document.createElement("canvas");var v=this.measuresPrefix;var r=C[v+"ActualvPredicted"];B.width=this.options.avp.width;B.height=this.options.avp.height;B.style.minWidth=this.options.avp.width+"px";B.style.minHeight=this.options.avp.height+"px";var s=B.getContext("2d");var z=C[v+"PredictedMin"];var A=C[v+"PredictedMax"];var h=C.actualMin;var i=C.actualMax;var D=d3.scale.linear().range([this.options.avp.origin.x,this.options.avp.max.x]).domain([z<h?z:h,A>i?A:i]);var k=d3.scale.linear().range([this.options.avp.origin.y,this.options.avp.max.y]).domain([z<h?z:h,A>i?A:i]);this.makeAxes(s,"avp");this.makeDots(s,r,D,k,"avp",u,C.allActualValues);s.strokeStyle=this.options.avp.lineColor;s.beginPath();s.moveTo(this.options.avp.origin.x,this.options.avp.origin.y);s.lineTo(this.options.avp.max.x,this.options.avp.max.y);s.stroke();s.font="8pt sans-serif";s.strokeStyle="black";this.makeAxisTicks(s,D,k,"avp");s.font="10pt sans-serif";s.fillStyle="black";s.textAlign="center";s.fillText(c.translate("Predicted"),this.options.avp.origin.x+(this.options.avp.max.x-this.options.avp.origin.x)/2,this.options.avp.origin.y+40,this.options.avp.width);s.textAlign="left";s.save();s.fillStyle="black";s.rotate(-Math.PI/2);s.translate(-this.options.avp.height,0);s.fillText(c.translate("Actual"),this.options.avp.origin.y-(this.options.avp.origin.y-this.options.avp.max.y)/2,this.options.avp.origin.x-60);s.restore();var l=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",this.options.avp.width).attr("height",this.options.avp.height+2).style("margin-left",-1*this.options.avp.width+"px");if(w){var m=function(){t.selectedPoints=[];t.selectedPointsWCoincidents=[];var E=j.extent();n.visit(function(N,J,M,H,K){if(N.point){var L=N.point[0]>=E[0][0]&&N.point[0]<=E[1][0]&&N.point[1]>=E[0][1]&&N.point[1]<=E[1][1];if(L){var I=typeof C.allActualValues==="undefined"?r:C.allActualValues;var G=t.getMatchingRowIDs(I,N.point[1]);if(t.selectedPointsWCoincidents.indexOf(G[0])===-1){t.selectedPointsWCoincidents=t.selectedPointsWCoincidents.concat(G)}t.selectedPoints.push(G[0])}}});t.remakeActualByPredicted(s,C);var F=d3.select(s.canvas.parentElement.parentElement.parentElement.getElementsByClassName("raRvPColumn")[0]).selectAll("canvas");t.remakeResidualByPredicted(F.node().getContext("2d"),C)};var n=d3.geom.quadtree()(r);var j=d3.svg.brush().x(D).y(k).on("brush",m);this.makeContextMenu(l.node());l.append("g").attr("class","brush").call(j)}var p=document.createElement("div");p.classList.add("sim-ui-fit-graphs");var y=a(C[v+"R2"]);var x=a(C[v+"R2Adjusted"]);var q=a(C[v+"RMSE"]);var o=["R-Squared: "+y+" (>0.80)","R-Squared Adjusted: "+x+" (>0.80)","Root Mean Square Error: "+q+" (<0.005)"];this.makeHoverText(p,o);p.appendChild(B);p.appendChild(l.node());return p};b.prototype.makeResidualByPredicted=function(p){var o=document.createElement("canvas");var s=this;o.width=this.options.rvp.width;o.height=this.options.rvp.height;o.style.minWidth=this.options.rvp.width+"px";o.style.minHeight=this.options.rvp.height+"px";var w=o.getContext("2d");var r=this.measuresPrefix;var j=p[r+"PredictedMin"];var q=p[r+"PredictedMax"];var v=p[r+"ResidualMin"];var m=p[r+"ResidualMax"];var u=d3.scale.linear().range([this.options.rvp.origin.x,this.options.rvp.max.x]).domain([j,q]);var k=d3.scale.linear().range([this.options.rvp.max.y,this.options.rvp.origin.y]).domain([m,v]);this.makeAxes(w,"rvp");w.fillStyle="black";this.makeAxisTicks(w,u,k,"rvp");this.makeDots(w,p[r+"ResidualvPredicted"],u,k,"rvp",null,p.allActualValues);w.strokeStyle=this.options.rvp.lineColor;w.beginPath();if(0>v&&0<m){w.moveTo(u(j),k(0));w.lineTo(u(q),k(0))}w.stroke();w.font="10pt sans-serif";w.fillStyle="black";w.textAlign="center";w.fillText(c.translate("Predicted"),this.options.rvp.origin.x+(this.options.rvp.max.x-this.options.rvp.origin.x)/2,this.options.rvp.origin.y+40,this.options.rvp.width);w.textAlign="left";w.strokeStyle="black";w.save();w.rotate(-Math.PI/2);w.translate(-this.options.rvp.height,0);w.fillText(c.translate("Residual"),this.options.rvp.origin.y-(this.options.rvp.origin.y-this.options.rvp.max.y)/2,this.options.rvp.origin.x-60);w.restore();var x=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",this.options.rvp.width).attr("height",this.options.rvp.height).style("margin-left",-1*this.options.rvp.width+"px");var i=0;var l=function(){s.selectedPoints=[];s.selectedPointsWCoincidents=[];var y=t.extent();n.visit(function(D,C,I,B,H){if(D.point){var F=D.point[0]>=y[0][0]+i&&D.point[0]<=y[1][0]+i&&D.point[1]>=y[0][1]&&D.point[1]<=y[1][1];if(F){var A=p[r+"ResidualvPredicted"];var G=D.point[1];if(typeof p.allActualValues!=="undefined"){A=p.allActualValues;G=D.point[1]+D.point[0]}var E=s.getMatchingRowIDs(A,G);if(s.selectedPointsWCoincidents.indexOf(E[0])===-1){s.selectedPointsWCoincidents=s.selectedPointsWCoincidents.concat(E)}s.selectedPoints.push(E[0])}}});s.remakeResidualByPredicted(w,p);var z=d3.select(w.canvas.parentElement.parentElement.parentElement.getElementsByClassName("raAvPColumn")[0]).selectAll("canvas");s.remakeActualByPredicted(z.node().getContext("2d"),p)};var n=d3.geom.quadtree()(p[r+"ResidualvPredicted"]);var t=d3.svg.brush().x(u).y(k).on("brush",l);this.makeContextMenu(x.node());x.append("g").attr("class","brush").call(t);var h=document.createElement("div");h.classList.add("sim-ui-fit-graphs");this.makeHoverText(h,["Residual/Predicted: "+a((m-v)/(q-j),3)+" (<0.05)"]);h.appendChild(o);h.appendChild(x.node());return h};b.prototype.remakeActualByPredicted=function(q,l){var n=this.measuresPrefix;var h=l[n+"PredictedMin"];var m=l[n+"PredictedMax"];var p=l.actualMin;var j=l.actualMax;var o=d3.scale.linear().range([this.options.avp.origin.x,this.options.avp.max.x]).domain([h<p?h:p,m>j?m:j]);var i=d3.scale.linear().range([this.options.avp.origin.y,this.options.avp.max.y]).domain([h<p?h:p,m>j?m:j]);q.clearRect(o(o.domain()[0])+1,i(i.domain()[0])-1,o(o.domain()[1])-o(o.domain()[0]),i(i.domain()[1])-i(i.domain()[0]));var k=l[n+"ActualvPredicted"];this.makeDots(q,k,o,i,"avp",null,l.allActualValues);q.strokeStyle=this.options.avp.lineColor;q.beginPath();q.moveTo(this.options.avp.origin.x,this.options.avp.origin.y);q.lineTo(this.options.avp.max.x,this.options.avp.max.y);q.stroke()};b.prototype.remakeResidualByPredicted=function(p,k){var m=this.measuresPrefix;var h=k[m+"PredictedMin"];var l=k[m+"PredictedMax"];var o=k[m+"ResidualMin"];var j=k[m+"ResidualMax"];var n=d3.scale.linear().range([this.options.rvp.origin.x,this.options.rvp.max.x]).domain([h,l]);var i=d3.scale.linear().range([this.options.rvp.max.y,this.options.rvp.origin.y]).domain([j,o]);p.clearRect(n(n.domain()[0])+1,i(i.domain()[0])-1,n(n.domain()[1])-n(n.domain()[0]),i(i.domain()[1])-i(i.domain()[0]));this.makeDots(p,k[m+"ResidualvPredicted"],n,i,"rvp",null,k.allActualValues);p.strokeStyle=this.options.rvp.lineColor;p.beginPath();if(0>o&&0<j){p.moveTo(n(h),i(0));p.lineTo(n(l),i(0))}p.stroke()};b.prototype.makeErrorHistograms=function(n){var k=document.createElement("canvas");k.width=this.options.hist.width;k.height=this.options.hist.height;k.style.minWidth=this.options.hist.width+"px";k.style.minHeight=this.options.hist.height+"px";var h=k.getContext("2d");var m=d3.scale.linear().range([0,this.options.hist.barWidth]).domain([Math.min.apply(null,n.histogram),Math.max.apply(null,n.histogram)]);h.strokeStyle="black";h.beginPath();h.moveTo(this.options.hist.origin.x,this.options.hist.origin.y+(this.options.hist.barHeight+1));h.lineTo(this.options.hist.origin.x-5,this.options.hist.origin.y+(this.options.hist.barHeight+1));h.stroke();for(var j=0;j<n.histogram.length;j++){h.strokeRect(this.options.hist.origin.x,this.options.hist.origin.y-j*(this.options.hist.barHeight+1),m(n.histogram[j]),this.options.hist.barHeight);h.fillStyle="#368ec4";h.fillRect(this.options.hist.origin.x,this.options.hist.origin.y-j*(this.options.hist.barHeight+1),m(n.histogram[j]),this.options.hist.barHeight);h.fillStyle="black";h.textAlign="right";h.fillText(a(n.min+(n.max-n.min)/n.histogram.length*j),this.options.hist.origin.x-10,this.options.hist.origin.y-(j-1)*(this.options.hist.barHeight+1));h.beginPath();h.moveTo(this.options.hist.origin.x,this.options.hist.origin.y-j*(this.options.hist.barHeight+1));h.lineTo(this.options.hist.origin.x-5,this.options.hist.origin.y-j*(this.options.hist.barHeight+1));h.stroke()}h.fillText(a(n),this.options.hist.origin.x-10,this.options.hist.origin.y-(n.histogram.length-1)*(this.options.hist.barHeight+1));h.font="10pt sans-serif";h.textAlign="left";h.save();h.rotate(-Math.PI/2);h.translate(-this.options.hist.height,0);h.fillText("% "+c.translate("Error"),this.options.hist.origin.y-this.options.hist.barHeight-n.histogram.length/2*(this.options.hist.barHeight+1),this.options.hist.origin.x-70);h.restore();this.makeBoxPlot(k,n);var o=document.createElement("div");o.classList.add("sim-ui-fit-graphs");var l=["Maximum: "+a(n.max),"Minimum: "+a(n.min),"Mean: "+a(n.mean),"Standard Deviation: "+a(n.stdDev)+" (<1)"];this.makeHoverText(o,l);o.appendChild(k);return o};b.prototype.makeFitAssessmentDiv=function(o,u,r){var D=document.createElement("div");D.classList.add("sim-ui-fit-assessment");D.style.width=u+"px";D.style.height=r-1+"px";D.style.borderBottom="2px solid #bbb";var s=[];var y=this.measuresPrefix;var n=a(this.measuresData[o][y+"R2Adjusted"]);s[0]={};s[0].type="Actual By Predicted";s[0].title=c.translate("Actual By Predicted")+" \n"+c.translate("R-Squared",": "+a(this.measuresData[o][y+"R2"]))+" (>0.80) \n"+c.translate("R-Squared Adjusted",": "+n)+" (>0.80)\n"+c.translate("RMSE",": "+a(this.measuresData[o][y+"RMSE"]))+" (<0.005)";s[0].assessment=this.measuresData[o][y+"R2"]>0.8&&this.measuresData[o][y+"R2Adjusted"]>0.8;s[1]={};s[1].type="Residual By Predicted";var B=(this.measuresData[o][y+"ResidualMax"]-this.measuresData[o][y+"ResidualMin"])/(this.measuresData[o][y+"PredictedMax"]-this.measuresData[o][y+"PredictedMin"]);s[1].title=c.translate("Residual By Predicted")+": \n "+c.translate("Residual")+"/"+c.translate("Predicted",":"+a(B))+" (<0.05)";s[1].assessment=B<0.05;var q=(this.measureType==="VALIDATION")?"Cross Validation Error":"Fit Error";s[2]={};s[2].type=q;s[2].title=c.translate(q)+":\n"+c.translate("Maximum",": "+a(this.measuresData[o][y+"PercentError"].max))+"\n"+c.translate("Minimum",": "+a(this.measuresData[o][y+"PercentError"].min))+"\n"+c.translate("Mean",": "+a(this.measuresData[o][y+"PercentError"].mean))+"\n"+c.translate("Standard Deviation",": "+a(this.measuresData[o][y+"PercentError"].stdDev))+" (<1)";s[2].assessment=this.measuresData[o][y+"PercentError"].stdDev<1;var l=161,m=50,p=10;var j=0,k=0,A=0;if(u<l+m+p){k=Math.max(5,(u-l-p-14)/2);j=Math.max(20,u-l-p)}var h=17,w=45,v=20;if(r<s.length*(h+w)+v){A=Math.max(10,(r-v)/s.length-h)}for(var z=0;z<s.length;z++){var C=document.createElement("div");C.classList.add("ui-icon");var x=document.createElement("text");x.title=s[z].title;x.setAttribute("type",s[z].type);x.classList.add("sim-ui-fit-assessment-text");if(s[z].assessment){C.classList.add("ui-icon-check");x.classList.add("good-fit")}else{C.classList.add("ui-icon-close");x.classList.add("bad-fit")}C.classList.add("sim-ui-fit-assessment-icon");D.appendChild(C);D.appendChild(x)}return D};b.prototype.refresh=function(j){d3.select(this.view).selectAll("ra-comparetable").remove();var h={};j.orderedParameters.outputs.forEach(function(k,l){h[k.ID]=l});var i=Object.keys(f.approximations[j.selectedApproxIds[0]].measures).sort(function(l,k){return h[l]-h[k]});if(j.selectedApproxIds.length===1){this.tableHandler=this.makeTable({targetElement:this.view,params:i,styles:this.myStyleSetOne||null,hierarchySource:"raMeasuresHierarchy"},j);if(typeof this.tableHandler.getMyStyles==="function"){this.myStyleSetOne=this.tableHandler.getMyStyles()}}else{this.tableHandler=this.makeOverlay(j);if(typeof this.tableHandler.getMyStyles==="function"){this.myStyleSetTwo=this.tableHandler.getMyStyles()}}};b.prototype.makeOverlay=function(r){var k=this.table;var l=this;k.s={};k.rendering=new d.Deferred();var n=this.view;k.s.params=r.selectedApproxIds;k.s.jsonParser=function(t,s,u){return e.getJSONFromResponse([t,s,u])};k.s.styles=this.myStyleSetTwo||null;k.s.forceFooter=true;k.s.footerRows=[{name:"",getFunction:function(s){this.textContent=""}}];k.s.scrollFixed=true;var h=[{displayHeaderFunction:function(s){s.textContent=""},forceWidth:true,width:"2em",getValue:function(s){if(typeof s.rawJSON.id!=="undefined"){return s.rawJSON.id}},displayFunction:function(s,t){s.textContent=f.findParameter(t).displayName;s.classList.add("raMeasuresParamsColumn");return true},textDirection:"vertical",isHandle:true,displayType:"all"},{name:"errormeasurestable",displayHeaderFunction:function(s){var t=document.createElement("select");t.id="MEASURESVIEWSELECT";var v=document.createElement("option");v.value="TRAINING";v.text=c.translate("Training Measures");t.appendChild(v);var u=document.createElement("option");u.value="VALIDATION";u.text=c.translate("Validation Measures");t.appendChild(u);t.addEventListener("change",function(){console.log(t.value);l.measureType=t.value;l.refresh(r)});l.updateMeasuresViewSelect(l.measuresData,t);s.appendChild(t)},forceWidth:true,width:l.options.avp.width+"px",getValue:function(s){if(typeof s.rawJSON.id!=="undefined"){return s.rawJSON.id}},displayFunction:function(s,t){s.appendChild(l.makeErrorMeasuresTable(l.generateDataForMeasuresTable(t)));s.classList.add("raAvPColumn");s.resize();return true},isHandle:true,displayType:"all"}];r.selectedApproxIds.forEach(function(s){h.push({name:s,displayHeaderFunction:function(t){t.textContent=c.translate("Actual vs Predicted")+" - "+f.approximations[s].displayName},forceWidth:true,width:l.options.avp.width+"px",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.appendChild(l.makeActualByPredicted(f.approximations[s].measures[u],r.approxColors[s],false));t.classList.add("raAvPColumn");t.resize();return true},isHandle:false,displayType:"all"})});if(typeof n!=="undefined"&&n!==null){k.element=document.createElement("ra-comparetable");var i="ra-measuresColumns";var o=document.querySelector("#"+i);if(o!==null){o.parentNode.removeChild(o);o=null}o=document.createElement("ra-fixedcolumns");o.setAttribute("id",i);o.setup(h);document.querySelector("body").appendChild(o);k.element.setAttribute("data-fixedcolumnsource",i);var m="raMeasuresHierarchy";var q=document.querySelector("#"+m);if(q!==null){q.parentNode.removeChild(q);q=null}q=document.createElement("ra-hierarchy");q.jsonParser=k.s.jsonParser;q.setAttribute("id",m);var j=document.createElement("ra-hlink");j.dataId="measuresViewTableBase";j.setAttribute("data-id","");j.rawJSON={ID:"measuresViewTableBase"};j.linkType="group";[].forEach.call(Object.keys(f.approximations[k.s.params[0]].measures),function(t){var s=document.createElement("ra-hlink");s.dataId=t;s.setAttribute("data-id",t);s.rawJSON={id:t,ID:t};j.appendChild(s)});q.appendChild(j);document.querySelector("body").appendChild(q);k.element.setAttribute("data-hierarchysource",m);k.element.setAttribute("data-iscomparable","false");n.appendChild(k.element);k.element.initialize(k.s);var p=new MutationObserver(function(s){s.forEach(function(t){if(t.type==="childList"){[].forEach.call(t.addedNodes,function(u){if(u.tagName&&u.tagName.toLowerCase()==="data-row"){u.nodeHead.resize()}})}})});p.observe(n,{childList:true,subtree:true});k.rendering.resolve()}else{k.rendering.resolve()}return this.table};b.prototype.makeContextMenu=function(l){var i={},k=this,j={};j.label=function(){return c.translate("Exclude")};j.iconType="image";j.icon=function(){return"./assets/icons/exclude.png"};j.action=function(){if(k.selectedPoints.length>0){f.excludePoints(k.selectedPointsWCoincidents)}k.selectedPoints=[];k.selectedPointsWCoincidents=[]};i.label=function(){return c.translate("Include")};i.iconType="jquery";i.icon=function(){return"ui-icon-plusthick"};i.action=function(){if(k.selectedPoints.length>0){f.includePoints(k.selectedPointsWCoincidents)}k.selectedPoints=[];k.selectedPointsWCoincidents=[]};var h={items:[{label:i.label,icon:i.icon,action:i.action,iconType:i.iconType},{label:j.label,icon:j.icon,action:j.action,iconType:j.iconType}]};h.items.push({label:c.translate("More Info"),icon:"./assets/icons/moreinfo_small.png",action:function(){if(k.selectedPoints.length===1){g.makeParamPopover(k.selectedPoints[0])}else{alert(c.translate("PLS_SELECT_ONE_ALT"))}}});d(l).contextPopup(h)};b.prototype.makeTable=function(i,s){var m=this.table;var n=this;m.s=i;m.rendering=new d.Deferred();var o=this.view;m.s.jsonParser=function(u,t,v){return e.getJSONFromResponse([u,t,v])};m.s.forceFooter=true;m.s.footerRows=[{name:"",getFunction:function(t){this.textContent=""}}];m.s.scrollFixed=true;var h=[{displayHeaderFunction:function(t){t.textContent=""},forceWidth:true,width:"2em",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.textContent=f.findParameter(u).displayName;t.classList.add("raMeasuresParamsColumn");return true},textDirection:"vertical",isHandle:true,displayType:"all"},{name:"errormeasurestable",displayHeaderFunction:function(t){var u=document.createElement("select");u.id="MEASURESVIEWSELECT";var w=document.createElement("option");w.value="TRAINING";w.text=c.translate("Training Measures");u.appendChild(w);var v=document.createElement("option");v.value="VALIDATION";v.text=c.translate("Validation Measures");u.appendChild(v);u.addEventListener("change",function(){console.log(u.value);n.measureType=u.value;n.measuresPrefix=n.measureType==="VALIDATION"?n._TESTING_PREFIX_:n._TRAINING_PREFIX_;n.refresh(s)});n.updateMeasuresViewSelect(n.measuresData,u);t.appendChild(u)},forceWidth:true,width:n.options.avp.width+"px",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.appendChild(n.makeErrorMeasuresTable(n.generateDataForMeasuresTable(u)));t.classList.add("raAvPColumn");t.resize();return true},isHandle:true,displayType:"all"},{name:"actualByPredicted",displayHeaderFunction:function(t){t.textContent=c.translate("Actual By Predicted")},forceWidth:true,width:n.options.avp.width+"px",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.appendChild(n.makeActualByPredicted(n.measuresData[u],"black",true));t.classList.add("raAvPColumn");t.resize();return true},isHandle:false,displayType:"all"},{name:"residualByPredicted",displayHeaderFunction:function(t){t.textContent=c.translate("Residual By Predicted")},forceWidth:true,width:n.options.rvp.width+"px",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.appendChild(n.makeResidualByPredicted(n.measuresData[u]));t.classList.add("raRvPColumn");t.resize();return true},isHandle:false,displayType:"all"},{name:"crossValidationPercentError",displayHeaderFunction:function(t){if(n.measureType==="VALIDATION"){t.textContent=c.translate("CV PE")}else{t.textContent=c.translate("FPE")}},forceWidth:true,width:n.options.hist.width+"px",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.appendChild(n.makeErrorHistograms(n.measuresData[u][n.measuresPrefix+"PercentError"]));t.classList.add("raValidationErrorColumn");t.resize();return true},isHandle:false,displayType:"all"},{name:"fitAssessment",displayHeaderFunction:function(t){t.textContent=c.translate("Fit")},forceWidth:true,width:n.options.assessment.width+"px",getValue:function(t){if(typeof t.rawJSON.id!=="undefined"){return t.rawJSON.id}},displayFunction:function(t,u){t.appendChild(n.makeFitAssessmentDiv(u,n.options.assessment.width,n.options.assessment.height));t.classList.add("raFitAssessmentColumn");return true},isHandle:false,displayType:"all",sortable:false,stretchFactor:0}];if(typeof o!=="undefined"&&o!==null){m.element=document.createElement("ra-comparetable");var j="ra-measuresColumns";var p=document.querySelector("#"+j);if(p!==null){p.parentNode.removeChild(p);p=null}p=document.createElement("ra-fixedcolumns");p.setAttribute("id",j);p.setup(h);document.querySelector("body").appendChild(p);m.element.setAttribute("data-fixedcolumnsource",j);var l="raMeasuresHierarchy";var r=document.querySelector("#"+l);if(r!==null){r.parentNode.removeChild(r);r=null}r=document.createElement("ra-hierarchy");r.jsonParser=m.s.jsonParser;r.setAttribute("id",l);var k=document.createElement("ra-hlink");k.dataId="measuresViewTableBase";k.setAttribute("data-id","");k.rawJSON={ID:"measuresViewTableBase"};k.linkType="group";[].forEach.call(m.s.params,function(u){var t=document.createElement("ra-hlink");t.dataId=u;t.setAttribute("data-id",u);t.rawJSON={id:u,ID:u};k.appendChild(t)});r.appendChild(k);document.querySelector("body").appendChild(r);m.element.setAttribute("data-hierarchysource",l);m.element.setAttribute("data-iscomparable","false");o.appendChild(m.element);m.element.initialize(m.s);var q=new MutationObserver(function(t){t.forEach(function(u){if(u.type==="childList"){[].forEach.call(u.addedNodes,function(v){if(v.tagName!==undefined){if(v.tagName.toLowerCase()==="data-row"){v.nodeHead.resize()}}})}})});q.observe(o,{childList:true,subtree:true});m.rendering.resolve()}else{m.rendering.resolve()}return this.table};b.prototype.setCurrentApproximation=function(h){this.measuresData=f.approximations[h].measures};b.prototype.updateMeasuresViewSelect=function(i,h){var j=function(l,m){return[].filter.call(l.options,function(n){return m===n.value})[0]};if(i&&h){var k=Object.keys(this.measuresData).some(function(l){var m=this.measuresData[l][this._TESTING_PREFIX_+"ActualvPredicted"];return(typeof m!=="undefined"&&m!==null)},this);if(!k){j(h,"VALIDATION").disabled="disabled";j(h,"TRAINING").selected=true;this.measureType="TRAINING"}else{j(h,this.measureType).selected=true}this.measuresPrefix=this.measureType==="VALIDATION"?this._TESTING_PREFIX_:this._TRAINING_PREFIX_}};return b});define("DS/SMAAnalyticsUI/SMAAnalyticsParameterTree",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,d,c,a){function e(){}e.prototype.renderParameterTree=function(){var g=new b.Deferred();return g};function f(g,m){var l=new b.Deferred();var k,i;var n=new b.Deferred();var o={deferred:n,count:0,trackedItems:2,increment:function(){this.count++;if(this.count==this.trackedItems){this.deferred.resolve()}}};var j={},h={};d.getScoresForRow(m,j).done(function(){k=j.content;o.increment()});d.getRowInfo(m,h).done(function(){i=h.content;o.increment()});o.deferred.done(function(){function C(ai){if(!ai.children){return ai.weight}else{var ag=ai.children;var ah=0;for(var w=0;w<ag.length;w++){ah+=C(ag[w])}return ah}}function r(aj,w){if(aj.children){var ag=[],ai=[];for(var ah=0;ah<aj.children.length;ah++){ag.push(aj.children[ah].ID)}for(ah=0;ah<w.length;ah++){if(b.inArray(w[ah].ID,ag)>=0){ai.push(w[ah])}}return ai}return null}function t(w,aq){var am=[];var ah=null;for(var al=0;al<aq.length;al++){ah=b.extend({},aq[al]);if(ah.dx>w){am.push(ah)}}for(al=0;al<am.length;al++){ah=am[al];var ag=r(ah,am),ao=r(ah,W.nodes(N)),ak;if(ag!==null&&ag.length!==ah.children.length){ak=[];var ai=0;for(ai=0;ai<ao.length;ai++){if(ao[ai].dx<=w){ak.push(ao[ai])}}var ar={},an=0;for(ai=0;ai<ag.length;ai++){an+=ag[ai].dx}var aj=0;var ap=0;for(ai=0;ai<ak.length;ai++){if(typeof ak[ai].weight==="number"&&typeof ak[ai].score==="number"){if(ak[ai].score!=-1){ap+=ak[ai].weight}}}for(ai=0;ai<ak.length;ai++){if(typeof ak[ai].weight==="number"&&typeof ak[ai].score==="number"){if(ak[ai].score!==-1&&ak[ai].score!==0){aj+=ak[ai].score}else{if(ak[ai].score===0&&ak[ai].priority===6){aj=0;break}}}}ar.dx=ah.dx-an;ar.x=ah.x+an;ar.dy=ah.dy;ar.y=ah.y+ah.dy;ar.displayName=a.translate("Other Parameters");ar.ID=ah.ID+"OTHERCHILDREN";ar.depth=ah.depth+1;ar.score=aj;ar.weight=ap;ar.nodeType="OTHERS";if(ar.dx!==0){am.push(ar)}}}return am}function J(ag,ah){var aj=ah.ID,ai={};ag.forEach(function(ak){ai[ak.ID]=true});var w=function(al){var am=al.depth;if(typeof al.children==="undefined"){return am}for(var ak=0;ak<al.children.length;ak++){if(ai[al.children[ak].ID]===true){am=Math.max(am,w(al.children[ak]))}else{am=Math.max(am,al.depth+1)}}return am};return w(ah)}function af(ak){d3.select(this);var w=ak.x,aj=ak.x+ak.dx;ac.domain([w,aj]).range([10,ab-10]);P.domain([0,aj-w]).range([0,ab-20]);var ai=500;var ap=t(P.invert(M*1.5+Y),W.nodes(N));var ao=J(ap,ak);var ah=ak.y,am=(ao+1)/(Q+1);S.domain([ah,am]).range([10,U-10]);F.domain([0,am-ah]).range([0,U-20]);var an=I.selectAll("g").data(ap,function(aq){return aq.ID});an.exit().transition().duration(ai).style("opacity",0).remove().attr("transform",function(aq){return("translate("+S(aq.y)+","+ac(aq.x)+")")}).selectAll("rect").attr("width",function(aq){return F(aq.dy)}).attr("height",function(aq){return P(aq.dx)});function al(aq){d3.select(this).append("rect").attr("width",D(aq.dy)).attr("height",v(aq.dx)).style("fill",aq.score===0?T:aq.score===-1?y:q(aq.score)).on("click",af)}an.enter().append("g").style("opacity",0).attr("transform",function(aq){return("translate("+H(aq.y)+","+x(aq.x)+")")}).each(al).each(aa);function ag(au){var av=18;var ar=d3.select(this),at=ar.select("text"),aq=P(au.dx);at.selectAll("tspan").each(function(ay,ax){var aw=1;if(aq<av*1.5+Y){aw=0}else{if(aq<av*2.5+Y){if(ax>0){aw=0}}else{if(aq<av*3.5+Y){if(ax>1){aw=0}}}}d3.select(this).transition().duration(ai).style("opacity",aw)})}an.transition().duration(ai).attr("transform",function(aq){return("translate("+S(aq.y)+","+ac(aq.x)+")")}).style("opacity",1).each(ag).selectAll("rect").attr("width",function(aq){return F(aq.dy)}).attr("height",function(aq){return P(aq.dx)}).style("opacity",1);H.domain([ah,am]).range([10,U-10]);D.domain([0,am-ah]).range([0,U-20]);x.domain([w,aj]).range([10,ab-10]);v.domain([0,aj-w]).range([0,ab-20])}function aa(aj){var ah=d3.select(this),ai=ah.append("text").attr("y",M*1.5).attr("x",4),ag=ah.select("rect").attr("height");var w=z(C(aj));ai.append("tspan").text(function(ak){if(ak.depth===0){return d.getNameForAlternative(m)}else{return ak.displayName}}).classed("sim-ui-parameterTree-rectTitle",true);if(aj.nodeType=="OTHER"){ai.append("tspan").text(a.translate("Average Score val ",aj.score!=-1?z(aj.score):a.translate("None"))).attr("x",4).attr("y",M*2.5);ai.append("tspan").text(a.translate("Total Weight val",w)).attr("x",4).attr("y",M*3.5)}else{ai.append("tspan").text(a.translate("Score val",aj.score!=-1?z(aj.score):a.translate("None"))).attr("x",4).attr("y",M*2.5);ai.append("tspan").text(a.translate("Aggregated Weight val",w)).attr("x",4).attr("y",M*3.5)}ai.selectAll("tspan").each(function(al,ak){if(ag<M*1.5+Y){d3.select(this).attr("opacity",0)}else{if(ag<M*2.5+Y){if(ak>0){d3.select(this).attr("opacity",0)}}else{if(ag<M*3.5+Y){if(ak>1){d3.select(this).attr("opacity",0)}}}}})}var N=c.convertGroupToD3(d._partialCopyParameterHierarchy(),k);var Z=d3.select(g[0]).append("div").attr("class","sim-ui-parameterTree-legend");var ab=b(g).height(),U=b(g).width(),M=18,Y=4,I=d3.select(g instanceof b?g[0]:g).append("svg").attr("id","sim-ui-parameterTree-svg").attr("height",ab).attr("width",U);var W=d3.layout.partition().value(function(w){return w.weight});var z=c.formatExp;var y="#ccc",T="#cc5100",X="steelblue",p="#89cf7f";var q=d3.scale.linear().domain([0,100]).range([X,p]);var s=Z.append("svg").attr("height","30px").attr("width","1500px");var B=s.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");B.append("svg:stop").attr("offset","0%").attr("stop-color",p).attr("stop-opacity",1);B.append("svg:stop").attr("offset","100%").attr("stop-color",X).attr("stop-opacity",1);var ae=[{color:"url(#gradient)",text:a.translate("Meets Objectives")},{color:T,text:a.translate("Does Not Meet Objectives")}];s.append("text").text(a.translate("Legend")+": ").attr("x","10px").attr("y","25px").style("font-weight","bold");s.append("text").text(function(w){return a.translate("Best Meets Objectives")}).attr("x","80px").attr("y","25px");var ad=s.selectAll(".sim-ui-parameterTree-legend").data(ae).enter().append("g").attr("class","sim-ui-parameterTree-legend");ad.append("rect").attr("width","100px").attr("height","20px").attr("x",function(ag,w){return 225+270*w}).attr("y","10px").style("fill",function(w){return w.color});ad.append("text").text(function(w){return w.text}).attr("x",function(ag,w){return 340+270*w}).attr("y","25px");s.append("text").text(function(w){return a.translate("BIG_TXT_IMPL")}).attr("x",340+500).attr("y","25px");var u=d3.scale.linear().domain([0,1]).range([10,ab-10]);var A=d3.scale.linear().domain([0,1]).range([0,ab-20]);var x=d3.scale.linear().domain([0,1]).range([10,ab-10]);var v=d3.scale.linear().domain([0,1]).range([0,ab-20]);var ac=d3.scale.linear().domain([0,1]).range([10,ab-10]);var P=d3.scale.linear().domain([0,1]).range([0,ab-20]);var R=W.nodes(N);var O=t(A.invert(M*1.5+Y),R);var Q=J(R,N);var L=J(O,N);var G=(L+1)/(Q+1);var K=d3.scale.linear().domain([0,G]).range([10,U-10]);var V=d3.scale.linear().domain([0,G]).range([0,U-20]);var H=d3.scale.linear().domain([0,G]).range([10,U-10]);var D=d3.scale.linear().domain([0,G]).range([0,U-20]);var S=d3.scale.linear().domain([0,G]).range([10,U-10]);var F=d3.scale.linear().domain([0,G]).range([0,U-20]);var E=I.selectAll("g").data(O,function(w){return w.ID}).enter().append("g").attr("transform",function(w){return("translate("+K(w.y)+","+u(w.x)+")")});E.append("rect").attr("width",function(w){return V(w.dy)>0?V(w.dy):0}).attr("height",function(w){return A(w.dx)>0?A(w.dx):0}).style("fill",function(w){return q(w.score)}).each(function(w){if(w.score===0){d3.select(this).style("fill",T)}else{if(w.score===-1){d3.select(this).style("fill",y)}}});E.each(aa);E.on("click",af);l.resolve()});return l}return f});define("DS/SMAAnalyticsUI/SMAAnalyticsRecommendPage",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget","DS/SMAAnalyticsUI/SMAAnalyticsTextArea","DS/SMAAnalyticsUI/SMAAnalyticsParameterTree","DS/SMAAnalyticsCompareTable/SMAAnalyticsDetailsTable","DS/SMAAnalyticsUI/SMAAnalyticsComments","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsUI/SMAAnalyticsParameterMap","DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsUI/exportview/SMAAnalyticsExportView","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Usage/TrackerAPI","UWA/Core"],function(c,p,a,b,f,k,m,o,r,l,n,h,e,u,d,s,q,g){var j="";function i(v){if(g.is(v)&&v.length>0){var x=true;var w=undefined;v.forEach(function(y){if((y.type!=="Simulation Job")||(w&&w!==y.fromSimulation)){x=false;return}if(!w){w=y.fromSimulation}});return x}return false}function t(w,v){w.exportView=null;w.recommendPage=w.recommendPage||{};w.recommendPage.create=t;w.recommendPage.designShown=-1;w.recommendPage.refreshEvents={};w.recommendPage.buildRadioOption=function(z,A,x,C,E,D){var B=document.createElement("input");B.setAttribute("type","radio");B.setAttribute("id",A);B.setAttribute("value",A);B.setAttribute("name",x);B.container=z;if(typeof E==="function"){B.onchange=E}else{B.classList.add("raShareAsOption");if(!x==="raShareAs"){B.setAttribute("disabled","disabled")}}B.sharePopup=z;var y=document.createElement("label");y.setAttribute("for",A);y.textContent=h.translate(C);if(D===true){B.setAttribute("checked","checked")}z.appendChild(B);z.appendChild(y);return B};w.recommendPage.createReqExportTable=function(y,x,B,C){var A={allParamsFlat:x,paramMap:B,requirementList:C.requirementsList,isExportPossible:{}};w.exportView=new u(A);var z=w.exportView.getExportView().getContent();z.getElementsByClassName("wux-datagrid")[0].addClassName("ra-exportview-theme");return z};w.recommendPage.adviseCallbackFunction=function(x){if(x.length<=0){e.alertMessage(e.ERROR,h.translate("NO_REQ_FOR_EXPORT"));return}p.spinnerControlShow();c.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getAllParametersForRequirement",data:{requirements:x},success:function(y){p.spinnerControlHide();console.log(y);y.reqIdList=x;w.recommendPage.createShareAsReqPopup(y)},error:function(y,A,z){console.log("Failed to retrieve parameters"+y+"\n\nText Status:\n"+A+"\n\nError Thrown:\n"+z);p.spinnerControlHide()}})};w.recommendPage.importRequirements=function(){var A=w.recommendPage;var y="../common/emxFullSearch.jsp?table=AEFGeneralSearchResults&showInitialResults=true&selection=multiple&formName=emxCreateForm&field=TYPES=type_Requirement:LATESTREVISION=true&suiteKey=SimulationCentral&submitURL=../simulationcentral/smaAdviseRequirementsUtil.jsp?refreshFrame=null&fromPage=null&openedBy=addexisting&inclusionList=Requirement&slmmode=addexisting&refreshFrame=null&srcDestRelName=null";var E=window.screenLeft!==undefined?window.screenLeft:screen.left;var B=window.screenTop!==undefined?window.screenTop:screen.top;var z=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var x=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var D=z/2-800/2+E;var C=x/2-600/2+B;A.rcWindow=getTopWindow().showModalDialog(y,"Requirements","scrollbars=yes, width=800, height=600, top="+C+", left="+D);p.registerNamedCallback("setRequirementsFromPLM",A.adviseCallbackFunction)};w.recommendPage.flattenRequirementParameters=function(x,y){y=y||"";var z=[];x.forEach(function(A){if(A.parametersList&&A.parametersList.parameterList&&A.parametersList.parameterList.length>0){A.parametersList.parameterList.forEach(function(C){var D={paramId:C.id,reqId:A.id};D.displayName=y+A.title+"."+C.title;D.physicalId=C.physicalId;D.title=C.title;D.dataType=C.type;z.push(D)})}if(A.requirementsList&&A.requirementsList.requirementsList&&A.requirementsList.requirementsList>0){var B=w.recommendPage.flattenRequirementParameters(A.requirementsList.requirementsList,y+A.title+".");B.forEach(function(C){z.push(C)})}});return z};w.recommendPage.createReqList=function(y){var x=document.createElement("div");x.classList.add("sim-ui-req-box-list");y.forEach(function(A){var z=document.createElement("div");z.classList.add("sim-ui-req-box-list-item");z.textContent=A.title;x.appendChild(z)});return x};w.recommendPage.exportRequirement=function(B,I,F,D){p.spinnerControlShow();var A=[];var G=[];var H=[];var y=w.exportView.getExportModel();var C=y.getExportModel().getChildren();C.forEach(function(K){var J=K.getChildren();if(J){J.forEach(function(P){if(P._options.grid.analyticsParamID!=="not_mapped"&&P._options.grid.analyticsParamValue!==null){var L=P._options.grid.physicalId;if(H.indexOf(L)===-1){H.push(L);G.push({physicalId:L});var O={physicalId:L};var M=P._options.grid.exportReqParam;var N=P._options.grid.analyticsParamValue;if(M==="target"){O.parameterValue=N;O.objective="TARGET"}else{if(M==="minimal_value"){O.minimum=N}else{if(M==="maximal_value"){O.maximum=N}}}A.push(O)}}})}});var x={parametersList:A};var E=p.setParameterHierarchy(p.getGroupCopy(p.varGroup));var z=function(J,L){var K=c.Deferred();p.getCSRFTokenFor3DSpace().done(function(M){c.ajax({type:"POST",cache:false,url:"../../resources/slmservices/advise/exportToPLMParameters",beforeSend:function(N){N.setRequestHeader("ENO_CSRF_TOKEN",M)},data:{parameterData:JSON.stringify(x),oid:J}}).done(K.resolve).fail(K.reject)}.bind(this)).fail(function(){K.reject()}.bind(this));return K}.call(this,p._caseID,JSON.stringify(x));c.when(E,z).then(function(){p.spinnerControlHide();F()}.bind(this),function(){p.spinnerControlHide();D()})};w.recommendPage.createShareAsReqPopup=function(A){var x=[];if(A&&A.requirementsList&&A.requirementsList.length>0){x=w.recommendPage.flattenRequirementParameters(A.requirementsList);var z=w.recommendPage.createReqList(A.requirementsList);var y=document.createElement("div");y.classList.add("sim-ui-predict-export-popover");y.classList.add("sim-ui-share-popover");if(typeof z!=="undefined"){y.appendChild(z)}}p.getMatchedParameters(x,function(H,M){var K=document.createElement("div");K.classList.add("sim-ui-predict-export-popover");K.classList.add("sim-ui-predict-export-req-popover");K.classList.add("sim-ui-share-popover");var O=p.getRecommendedDesign();if(!(O instanceof Array)){O=[O]}function I(){var R=document.createElement("select");O.forEach(function(S){var T=document.createElement("option");T.text=p.getNameForAlternative(S);T.setAttribute("value",S);R.appendChild(T)});return R}var L=I();K.appendChild(L);function F(S){var W=document.createElement("div");W.classList.add("sim-ui-export-top-menu");var V=document.createElement("div");V.classList.add("sim-ui-automapping-switch");var R=new d({type:"switch",label:h.translate("Automapping")});R.addEventListener("change",function(Y){Y.preventDefault();Y.stopPropagation();var X=this.exportView.getExportModel();if(Y.dsModel.checkFlag){X.updateModelAutomap(true)}else{X.updateModelAutomap(false)}}.bind(S));var T=document.createElement("div");T.classList.add("sim-ui-export-search");var U=new s({placeholder:h.translate("Search Requirements..."),selectAllOnFocus:true,});U.addEventListener("change",function(X){X.preventDefault();X.stopPropagation();S.exportView.searchModel(X.dsModel.value)}.bind(S));U.inject(T);R.inject(V);W.appendChild(T);W.appendChild(V);return W}var C=F(w);K.appendChild(C);var E=w.recommendPage.createReqExportTable(x,H,M,A);K.appendChild(E);var D={};var J=function(R){var S=E.querySelectorAll("tr");S.forEach(function(V){var U=V.getAttribute("pid");var T=V.querySelectorAll("td");if(R[U]&&R[U].toPrecision){T[2].textContent=R[U].toPrecision(3);T[2].setAttribute("value",R[U])}})};var B=function(R){if(w.exportView!==null){w.exportView.updateParamValues(R)}};var N=function(){var R={};var V=L.val;try{V=parseInt(L.value)}catch(U){}if(D[V]){try{var T=D[V];B(T)}catch(S){}}else{p.getRowInfo(V,R).done(function(){try{var X=R.content.parmValues;D[V]=X;B(X)}catch(W){}})}};L.addEventListener("change",N);L.val=O[0];N();var Q=function(){var R=c('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+h.translate("OK")+"</button>").on("click",function(){w.recommendPage.exportRequirement(A.reqIdList,E,function(){r.closePopover();e.alertMessage(h.translate("REQ_EXPORT_SUCCESS"))},function(){r.closePopover();e.alertMessage(e.ERROR,h.translate("REQ_EXPORT_ERROR"))})});return R};var G=function(){var R=c('<button class="sim-ui-popover-footerButton" style="min-width:75px;">'+h.translate("Cancel")+"</button>").on("click",r.closePopover);return R};var P={width:600,height:600,footerOptions:{type:"buttons",content:[Q,G]},customCloseBehavior:r.closePopover};r.makePopover([h.translate("Parameters")],[c(K)],h.translate("Export as Requirements"),"sim-ui-predict-export-asreq-popover",P)})};w.recommendPage.createSharePopup=function(){var A=document.createElement("div");A.classList.add("sim-ui-predict-export-popover");A.classList.add("sim-ui-share-popover");var B=function(){var D=this.getAttribute("value");var E;E=this.container.querySelectorAll('[name="raShareRecAs"]');if(D==="raShareRec"&&typeof this.sharePopup!=="undefined"){[].forEach.call(E,function(G){G.removeAttribute("disabled");var F=G.nextElementSibling;F.classList.remove("raShareLabel-disabled")})}else{if(D==="raShareBasket"&&typeof this.sharePopup!=="undefined"){[].forEach.call(E,function(G){if(G.id!=="raShareAsCSV"){G.setAttribute("disabled","disabled");G.removeAttribute("checked");var F=G.nextElementSibling;F.classList.add("raShareLabel-disabled")}else{G.removeAttribute("disabled");var F=G.nextElementSibling;F.classList.remove("raShareLabel-disabled")}})}}this.container.querySelector("#raShareAsCSV").setAttribute("checked","checked")};w.recommendPage.buildRadioOption(A,"raShareRec","raShareType","Recommended Alternatives",B,true);A.appendChild(document.createElement("br"));w.recommendPage.buildRadioOption(A,"raShareBasket","raShareType","Basket",B);A.appendChild(document.createElement("hr"));var x=document.createElement("h3");x.textContent=h.translate("Share As")+":";A.appendChild(x);w.recommendPage.buildRadioOption(A,"raShareAsPDF","raShareRecAs","PDF");A.appendChild(document.createElement("br"));w.recommendPage.buildRadioOption(A,"raShareAsPPT","raShareRecAs","PPT");A.appendChild(document.createElement("br"));w.recommendPage.buildRadioOption(A,"raShareAsCSV","raShareRecAs","TSV").setAttribute("checked","checked");A.appendChild(document.createElement("br"));w.recommendPage.buildRadioOption(A,"raShareAsReq","raShareRecAs","Requirements");var z=function(){var D=c('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+h.translate("OK")+"</button>").on("click",function(){var F=document.querySelector(".raShareAsOption:checked"),H=document.querySelector('input[name="raShareType"]:checked').id;var E=null;var G="";if(F!==null){G=F.getAttribute("value");if(G==="raShareAsPDF"){E=p.downloadReportPDF}else{if(G==="raShareAsPPT"){E=p.downloadReportPPT}else{if(G==="raShareAsCSV"){if(H==="raShareBasket"){E=p.downloadBasketAsTSV}else{E=p.downloadRecommendedDesignsAsTSV}}else{if(G==="raShareAsReq"){if(p.isAWidget()){E=function(){p.getConnectedRequirementsList("true").done(function(I){w.recommendPage.adviseCallbackFunction(I)}.bind(this)).fail(function(){})}.bind(this)}else{E=w.recommendPage.importRequirements}}}}}}r.closePopover();if(G==="raShareAsCSV"){E()}else{if(typeof w.recommendPage.svgScraper!=="undefined"&&typeof E==="function"){w.recommendPage.svgScraper.clearStorage();w.recommendPage.svgScraper.autoScrape(E)}}});return D};var C=function(){var D=c('<button class="sim-ui-popover-footerButton" style="min-width:75px;">'+h.translate("Cancel")+"</button>").on("click",r.closePopover);return D};var y={width:300,height:250,noTabs:true,footerOptions:{type:"buttons",content:[z,C]},customCloseBehavior:r.closePopover};r.makePopover([],[c(A)],h.translate("Share ..."),"sim-ui-predict-export-popover",y)};w.recommendPage.getRecommendedData=function(){return new Promise(function(A,z){var x=p.varGroup;var y={};p.getRowInfo(w.recommendPage.designShown,y).done(function(){var D=y.content.parmValues;var C=x.parameters;var B={objectId:null,parameters:[]};y.content.tags.forEach(function(E){if(E.name==="PLMOID"){B.objectId=E.value;return}});C.forEach(function(E){B.parameters.push({name:E.name,displayName:E.displayName,role:E.role,dataType:E.dataType,value:D[E.ID]})});A(B)})})};w.recommendPage.togglePSButton=function(x){var y=document.querySelector("#openPS");y.style.display="none";y.onclick=null;if(i(w.datasetsList)&&x.length>0&&localStorage.getItem("_RA_PS_COMMAND_")==="true"){y.style.display="";y.onclick=w.recommendPage.openPS}};w.recommendPage.openPS=function(){w.recommendPage.getRecommendedData().then(function(z){var y={objectId:w.datasetsList[0].fromSimulation,objectType:"Simulation",displayType:"Simulation Process",job:{objectId:z.objectId,type:"Simulation Job",displayType:"Simulation Job"},analytics:{objectId:w.caseID,title:p.caseInfo.CaseName,type:"Analytics Case",parameters:z.parameters}};var x={eventType:"OPEN_PS",data:y};if(window.parent&&window.parent.postMessageToWidget){window.parent.postMessageToWidget(x)}})};w.recommendPage.reportSetup=function(){if(typeof w.recommendPage.svgScraper!=="undefined"){return w.recommendPage.svgScraper.getPageSVGList()}else{return null}};w.recommendPage.refreshDesignSelectDropdown=function(x){var B=document.querySelector("select.sim-ui-page-recommend-label");B.options.length=0;if(j===""){j="*"}var z="";for(var y=0;y<x.length;y++){var A=document.createElement("option");A.value=x[y];A.text=p.getNameForAlternative(x[y]);B.appendChild(A)}B.value=String(w.recommendPage.designShown);B.onchange=function(){w.recommendPage.designShown=parseInt(B.options[this.selectedIndex].value,10);w.recommendPage.refreshImages();w.recommendPage.refreshParameters(true);w.recommendPage.notes.update();w.recommendPage.refreshCommentsLikes();w.recommendPage.buildParameterTree(c("#recommenddesignpage div.sim-ui-page-recommend-requirementstreemap"))}};w.recommendPage.notes=new f({target:c("#sim-ui-page-recommend-notes"),saveButton:c("#save-recommended-notes"),revertButton:c("#undo-recommended-notes"),getFunction:function(x){var y=w.recommendPage.designShown;return y>-1?p.getNotesForRowID(y,x):false},saveFunction:function(x){var y=w.recommendPage.designShown;if(y>-1){p.setNotesForRowID(y,x)}}});w.recommendPage.entering=function(){var y=q.getCounter("RARecommendPageEntered");y.inc();if(typeof w.recommendPage.svgScraper==="undefined"){w.recommendPage.svgScraper=new n(w.recommendPage.element)}var x=p.getRecommendedDesign();if(!(x instanceof Array)){x=[x]}w.recommendPage.togglePSButton(x);document.querySelector("#recommendedSharePDF").onclick=w.recommendPage.createSharePopup;w.recommendPage.toggleCommentBox();if(!x.contains(w.recommendPage.designShown)||w.recommendPage.designShown<0){if(x.length>0){w.recommendPage.designShown=x[x.length-1]}else{w.recommendPage.designShown=-1}w.recommendPage.refreshDesignSelectDropdown(x);w.recommendPage.refreshImages();j="*";w.recommendPage.refreshParameters(true);w.recommendPage.notes.update();w.recommendPage.refreshCommentsLikes()}else{if(x.length>0&&c(".sim-ui-page-recommend-parameters-table table").length<=0){w.recommendPage.designShown=x[x.length-1];w.recommendPage.refreshImages();w.recommendPage.refreshParameters(true);w.recommendPage.notes.update();w.recommendPage.refreshCommentsLikes()}}if(c(".sim-ui-page-recommend-parameters-selector").val()==null){w.recommendPage.refreshParameters(true)}w.recommendPage.buildParameterTree(c("#recommenddesignpage div.sim-ui-page-recommend-requirementstreemap"))};w.recommendPage.commentsToggle=document.querySelector("#sim-ui-page-recommend-notes-container select");w.recommendPage.toggleCommentBox=function(){var z=w.recommendPage.commentsToggle.selectedIndex;var x=w.recommendPage.commentsToggle.options[z].value;w.recommendPage.toggleCommentBox.element=document.querySelector(x);if(w.recommendPage.toggleCommentBox.element!==null){var y=document.querySelectorAll(".sim-ui-page-recommend-notes-container .sim-ui-recommend-commentBox");[].forEach.call(y,function(A){if(A!==w.recommendPage.toggleCommentBox.element){A.style.display="none"}else{A.style.display="block"}})}};w.recommendPage.commentsToggle.onchange=w.recommendPage.toggleCommentBox;w.recommendPage.basketChanged=function(){var x=p.getRecommendedDesign();if(!(x instanceof Array)){x=[x]}w.recommendPage.togglePSButton(x);if(!x.contains(w.recommendPage.designShown)||w.recommendPage.designShown<0){if(x.length>0){w.recommendPage.designShown=x[x.length-1]}else{w.recommendPage.designShown=-1}w.recommendPage.refreshImages();w.recommendPage.refreshParametersTable();w.recommendPage.refreshCommentsLikes();w.recommendPage.notes.update(w.recommendPage.designShown)}w.recommendPage.refreshDesignSelectDropdown(x);if(j===""){j="*"}w.recommendPage.buildParameterTree(c("#recommenddesignpage div.sim-ui-page-recommend-requirementstreemap"))};w.recommendPage.refreshCommentsLikes=function(){var z=document.querySelector("#sim-ui-recommend-comments-outer");z.innerHTML="";var A=new o({rowID:w.recommendPage.designShown,container:z,type:"data",showStats:true,build:"comments"});var x=document.querySelector("#sim-ui-recommend-likes-outer");x.innerHTML="";var y=new o({rowID:w.recommendPage.designShown,container:x,type:"data",showStats:true,build:"likes"})};w.recommendPage.gradingChanged=function(){w.recommendPage.refreshParametersTable();w.recommendPage.buildParameterTree(c("#recommenddesignpage div.sim-ui-page-recommend-requirementstreemap"))};w.recommendPage.parameterChanged=function(){w.recommendPage.refreshParametersTable()};w.recommendPage.refreshParameters=function(z){var A=c(".sim-ui-page-recommend-parameters-selector");var x=A.val();if(z){x=null;A.html("")}if(x==null){var y=h.translate("Priority");c("<option/>",{value:"*"}).text(h.translate("ALL")).appendTo(A);c("<option/>",{value:"priority==0"}).text(h.translate("Must Haves")).appendTo(A);c("<option/>",{value:"priority==1"}).text(y+" - P1").appendTo(A);c("<option/>",{value:"priority==2"}).text(y+" - P2").appendTo(A);c("<option/>",{value:"priority==3"}).text(y+" - P3").appendTo(A);c("<option/>",{value:"priority==4"}).text(y+" - P4").appendTo(A);c("<option/>",{value:"priority==5"}).text(y+" - P5").appendTo(A);A.val("*");A.change(function(){var B=A.val();var D=p.getFilteredParameters(B);w.recommendPage.paramTable.element.applyRowFilter("priorityfilter",function(F){try{if(D.indexOf(F.parameterID)!=-1){return true}else{return false}}catch(E){return false}});var C=document.querySelector(".sim-ui-page-recommend-parameters-selector");if(C!==null){j=C.value}w.recommendPage.refreshParametersTable()})}if(z){w.recommendPage.refreshParametersTable()}};w.recommendPage.refreshParametersTable=function(){if(w.recommendPage.designShown>0){if(typeof w.recommendPage.paramTable==="undefined"||w.recommendPage.paramTable===null){w.recommendPage.paramTable=new m.constr({targetElement:document.querySelector(".sim-ui-page-recommend-parameters-table"),params:p.varGroup,getDesign:function(){if(w.recommendPage.designShown===-1){return[]}else{return[w.recommendPage.designShown]}},collectionSource:"raRecommendedDesign",fixedWidth:150},new c.Deferred(),p)}else{var x=document.querySelector(".sim-ui-page-recommend-parameters-selector");if(x!==null){x.value=j}w.recommendPage.paramTable.element.updateCollections()}}};w.recommendPage.refreshImages=function(){var z=p.getBasketList();if(z.length==0){c(".sim-ui-page-recommend-error-message").text(h.translate("no_alternatives_in_basket")).show();return}c(".sim-ui-page-recommend-error-message").hide();var B=p.getBasketFiles();if(w.recommendPage.designShown<0){c(".sim-ui-page-recommend-error-message").text(h.translate("NO_CRNT_ALT")).show();return}var E=c("select.sim-ui-page-recommend-imageselector");E.html("");var A=B[w.recommendPage.designShown];var D=A!==null&&typeof A!=="undefined"?A.length:0;if(p.getImageNames().length>0&&D>0){if(c("#sim-ui-page-recommend-container").hasClass("no-images")){c("#sim-ui-page-recommend-container").removeClass("no-images")}for(var y=0;y<D;y++){if(typeof A[y].isImage!=="undefined"&&!A[y].isImage){continue}var x=p.fileList[y].displayName;c("<option/>",{value:A[y].url}).text(decodeURIComponent(x)).appendTo(E)}E.change(function(){var F=p.getCompleteURL(E.val());c(".sim-ui-page-recommend-image").first().attr("src",F);w.recommendPage.resizeRDPColumns({image:F})});if(A[0]&&A[0].url){E.val(A[0].url);var C=p.getCompleteURL(E.val());c(".sim-ui-page-recommend-image").first().attr("src",C);w.recommendPage.resizeRDPColumns({image:C})}}else{c(".sim-ui-page-recommend-container").addClass("no-images");c("#sim-ui-page-recommend-images-container").css("display","none")}};w.recommendPage.buildParameterTree=function(y){y.empty();w.recommendPage.containerDivObjectList=[];if(y.length>0&&w.recommendPage.designShown>-1){if(typeof w.recommendPage.svgScraper!=="undefined"){var x=document.createElement("div");x.classList.add("sim-ui-recommend-requirementstree-visible");y[0].insertBefore(x,null);w.recommendPage.svgScraper.prepContainer(x,"parametertree_"+w.recommendPage.designShown,{svgtype:"paramtree",alternative:w.recommendPage.designShown,combine:true});w.recommendPage.containerDivObjectList.push(c(x));var z=p.getRecommendedDesign();z.forEach(function(C){if(C!==w.recommendPage.designShown){var B=document.createElement("div");B.classList.add("sim-ui-recommend-requirementstree-hidden");y[0].insertBefore(B,x);w.recommendPage.svgScraper.prepContainer(B,"parametertree_"+C,{svgtype:"paramtree",alternative:C,combine:true});w.recommendPage.containerDivObjectList.push(c(B))}})}}function A(){var C=new c.Deferred();var B=[];if(w.recommendPage.designShown!=-1){w.recommendPage.containerDivObjectList.forEach(function(D){B.push(k(D,D.attr("data-svgalt")))});c.when(B).done(function(){C.resolve()});return C}else{return false}}if(typeof w.recommendPage.refreshEvents.parameterTree==="undefined"){w.recommendPage.refreshEvents.parameterTree={refresh:a.makeRenderTracker(A)}}w.recommendPage.refreshEvents.parameterTree.refresh.render()};w.recommendPage.resizeRDPColumns=function(){var y=c("select.sim-ui-page-recommend-imageselector");if(y.val()!==null){var x=p.getCompleteURL(y.val());c("<img/>").attr("src",x).load(function(){var D=this.width;var z=this.height;var C=c(".sim-ui-page-recommend-container").width();var E=300;if(parseFloat(C)*0.3>E){E=parseFloat(C)*0.3}var A=parseFloat(E/D);var B=parseInt(z*A,10);c(".sim-ui-page-recommend-image").first().height(B);if(B<300){B=300}c("#sim-ui-page-recommend-parameters-container .sim-ui-table-cell-inner").height(B+30);c(".sim-ui-page-recommend-notes-container .sim-ui-table-cell-inner").height(B+28)})}};w.recommendPage.fileParameterChanged=function(){w.recommendPage.refreshImages()};w.recommendPage.postRender=function(){if(c("#recommenddesignpage").css("display")==="block"){w.recommendPage.resizeRDPColumns()}if(typeof w.recommendPage.paramTable!=="undefined"&&w.recommendPage.paramTable!==null){w.recommendPage.paramTable.element.resize()}};w.recommendPage.resize=function(){if(c("#recommenddesignpage").css("display")==="block"){w.recommendPage.resizeRDPColumns()}if(typeof w.recommendPage.paramTable!=="undefined"&&w.recommendPage.paramTable!==null){w.recommendPage.paramTable.element.resize()}w.recommendPage.buildParameterTree(c("#recommenddesignpage div.sim-ui-page-recommend-requirementstreemap"))};w.recommendPage.save=function(){var x={designShown:w.recommendPage.designShown};try{p.savePageData("recommendPage",p.serializePageObject(x))}catch(y){console.warn("Error trying to persist recommend page session info",[y])}};w.recommendPage.element=c("#"+v);w.recommendPage.element.advisePage({contentPanelId:"recommenddesigncontentpanel",entering:w.recommendPage.entering,resize:w.recommendPage.resize,parameterChanged:w.recommendPage.parameterChanged,fileParameterChanged:w.recommendPage.fileParameterChanged,gradingChanged:w.recommendPage.gradingChanged,basketChanged:w.recommendPage.basketChanged,postRender:w.recommendPage.postRender,save:w.recommendPage.save,reportSetup:w.recommendPage.reportSetup})}return t});define("DS/SMAAnalyticsUI/SMAAnalyticsBarChart",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,d,c,a){function e(h,g,f){this.containerDivs={rootDiv:h};this.data={rowIDs:g,rankList:f,navData:[{paramID:"",displayName:""}]};this.SVGs={};this.refreshObject={navData:[],resize:null,gradingChanged:null};this.dimensions={};this.scales={};this.axes={};this.navData=[{paramID:"",displayName:""}];this.state={}}e.prototype.setupData=function(){this.data.rowIDs=d.getBasketList();this.data.varGroupCopy=d.parameterFilterController.getFilteredData();this.data.filteredDataTree={}};e.prototype.buildDataMap=function(){function j(s){var r={};d.getScoresForRow(s,r).done(function(){var u=r.content;for(var t in u){h[s][t]=u[t]}indexCounter.index()})}function k(u,r,x){if(b.inArray(u.ID,r)>-1){x.ID=u.ID;x.scores={};x.displayName=u.displayName;x.groups=[];x.parameters=[];x.dataType="group";x.weight=u.weightFactor;for(var w in h){x.scores[w]=h[w][u.ID]}for(var t=0;t<u.groups.length;t++){var s={};if(k(u.groups[t],r,s)){x.groups.push(s)}}for(t=0;t<u.parameters.length;t++){var v={};if(q(u.parameters[t],r,v)){x.parameters.push(v)}}if(x.groups.length==0&&x.parameters.length==0){return false}return x}else{return false}}function q(t,r,u){if(b.inArray(t.ID,r)>-1){u.ID=t.ID;u.scores={};u.displayName=t.displayName;u.dataType="parameter";u.weight=t.weightFactor;for(var s in h){u.scores[s]=h[s][t.ID]}return u}else{return false}}function n(v,u){var w,r,t,s;v.relativeScores={};v.sumChildren={};v.sumChildren={};if(typeof u==="undefined"){for(s in v.scores){v.relativeScores[s]=v.scores[s];v.sumChildren[s]=0}}else{for(s in v.scores){v.relativeScores[s]=v.scores[s]*u.relativeScores[s]/u.sumChildren[s];v.sumChildren[s]=0}}w=v.parameters?v.parameters.length:0;r=v.groups?v.groups.length:0;for(t=0;t<w;t++){for(s in v.parameters[t].scores){v.sumChildren[s]+=v.parameters[t].scores[s]}}for(t=0;t<r;t++){for(s in v.groups[t].scores){v.sumChildren[s]+=v.groups[t].scores[s]}}for(s in v.parameters){n(v.parameters[s],v)}for(s in v.groups){n(v.groups[s],v)}}var p=this.data.varGroupCopy,l=this.data.filteredDataTree;var m=new b.Deferred(),o=new b.Deferred(),h={},g=this.data.rowIDs.length,f={};var i=this;d.getScoresForRowIdList(this.data.rowIDs,f).done(function(){h=f.content;m.resolve()});m.done(function(){var r=Object.keys(h[i.data.rowIDs[0]]);k(p,r,l);n(l);o.resolve()});return o};e.prototype.addStackedBar=function(){var f=this;this.dimensions.totalHeight=b(this.containerDivs.rootDiv).height();this.dimensions.totalWidth=b(this.containerDivs.rootDiv).width();this.dimensions.navHeight=20;this.dimensions.legendHeight=40;this.dimensions.graphMargin={left:100,top:50,bottom:50,right:50};this.dimensions.xLabelOffset=30;this.dimensions.mainHeight=this.dimensions.totalHeight-this.dimensions.navHeight-this.dimensions.legendHeight;this.dimensions.navWidth=this.dimensions.totalWidth;this.dimensions.legendWidth=this.dimensions.totalWidth;this.dimensions.mainWidth=this.dimensions.totalWidth;this.dimensions.graphWidth=this.dimensions.mainWidth-this.dimensions.graphMargin.left-this.dimensions.graphMargin.right;this.scales.color=d3.scale.category20c();c.limitStackSize(f.data.filteredDataTree,5,{rowIDs:this.data.rowIDs});this.buildGraph()};e.prototype.getChildDataArray=function(f,j){function i(k){var l=k.pop();if(l.ID==j){return l}k=k.concat(l.groups);return k.length>0?i(k):[]}if(j){var g=[f],h=i(g);return h.parameters.concat(h.groups)}else{return[f]}};e.prototype.getAncestorsArray=function(f,g){if(f.ID==g){return[f]}f.groups.forEach(function(h){var i=e.prototype.getAncestorsArray(h,g);if(i.length>0){return[f].concat(i)}});return[]};e.prototype.getDataMax=function(h){var f=h[h.length-1];this.data.dataMax=0;for(var g=0;g<f.values.length;g++){if(f.values[g].y+f.values[g].y0>this.data.dataMax){this.data.dataMax=f.values[g].y+f.values[g].y0}}return this.data.dataMax};e.prototype.mappingFunction=function(k){var j=this;var f={},h=0;f.values=[];f.paramID=k.ID;for(var g in k.relativeScores){f.values.push({paramID:k.ID,rowID:g,displayName:k.displayName,dataType:k.dataType,score:k.relativeScores[g],x:h,y:k.relativeScores[g],y0:0});h++}f.values=f.values.sort(function(l,i){return(j.data.filteredDataTree.relativeScores[l.rowID]-j.data.filteredDataTree.relativeScores[i.rowID])});return f};e.prototype.stack=d3.layout.stack().values(function(f){return f.values});e.prototype.groupEnter=function(g){var i=d3.select(g);var h=this;var f=i.selectAll("rect").data(function(j){return j.values},function(j){return j.rowID}).enter().append("rect");f.attr("y",function(j){return h.scales.yScale(j.rowID)}).attr("class","stackedBar").attr("x",h.scales.xScale(0)).attr("height",h.scales.yScale.rangeBand()).attr("width",0).style("fill",function(j){return h.scales.color(j.paramID)});f.on("click",function(j){h.barClick(j)});f.transition().duration(h.state.duration).attr("width",function(j){return h.scales.xScaleAbsolute(j.y)||0}).attr("x",function(j){return h.scales.xScale(j.y0)||0})};e.prototype.buildGraph=function(){var n=this.data.filteredDataTree;var m=this;this.state.duration=600;var j=this.getChildDataArray(n,n.ID);this.data.data=this.stack(j.map(function(p,i){return m.mappingFunction(p,i)}));var g=[];for(var k=0;k<j.length;k++){g.push(j[k].paramID)}var l=Object.keys(this.data.filteredDataTree.relativeScores);l.sort(function(p,i){return(m.data.filteredDataTree.relativeScores[p]-m.data.filteredDataTree.relativeScores[i])});d3.select(this.containerDivs.rootDiv).selectAll("svg").remove();this.SVGs.vis=d3.select(this.containerDivs.rootDiv).append("svg").classed("sim-ui-barChart-vis",true).attr("width",m.dimensions.mainWidth).attr("height",m.dimensions.mainHeight);this.SVGs.nav=d3.select(m.containerDivs.rootDiv).append("svg").classed("sim-ui-barChart-nav",true).attr("width",m.dimensions.navWidth).attr("height",m.dimensions.navHeight).style({left:"0px",position:"absolute",bottom:m.dimensions.legendHeight+"px"});this.SVGs.legend=d3.select(m.containerDivs.rootDiv).append("svg").classed("sim-ui-barChart-legend",true).attr("width",m.dimensions.legendWidth).attr("height",m.dimensions.legendHeight).style({left:"0px",position:"absolute",bottom:"0px"});this.getDataMax(this.data.data);this.scales.xScale=d3.scale.linear().domain([0,this.data.dataMax]).range([this.dimensions.graphMargin.left,this.dimensions.mainWidth-this.dimensions.graphMargin.right-100]);this.scales.xScaleAbsolute=d3.scale.linear().domain([0,this.data.dataMax]).range([0,this.dimensions.graphWidth-100]);this.scales.yScale=d3.scale.ordinal().domain(l).rangeRoundBands([this.dimensions.mainHeight-this.dimensions.graphMargin.bottom,this.dimensions.graphMargin.top],0.05);this.SVGs.vis.selectAll(".sim-ui-barChart-paramGroup").data(this.data.data,function(i){return i.paramID}).enter().append("g").attr("class","sim-ui-barChart-paramGroup").each(function(){m.groupEnter(this,m)});this.axes.xAxis=d3.svg.axis().scale(this.scales.xScale).tickSize(0).tickPadding(5).orient("bottom");this.axes.yAxis=d3.svg.axis().scale(this.scales.yScale).tickFormat(function(i){return d.getNameForAlternative(i,true)}).tickSize(0).tickPadding(10).orient("left");this.SVGs.xaxis=this.SVGs.vis.append("g").classed("sim-ui-barChart-xAxis",true).attr("transform","translate(0,"+(m.dimensions.mainHeight-m.dimensions.graphMargin.bottom)+")").call(m.axes.xAxis);this.SVGs.yaxis=this.SVGs.vis.append("g").classed("sim-ui-barChart-yAxis",true).attr("transform","translate("+(m.dimensions.graphMargin.left-1)+",0)").call(m.axes.yAxis);this.SVGs.xaxis.append("text").classed("sim-ui-barChart-axisLabel",true).attr("text-anchor","middle").attr("transform","translate("+this.dimensions.graphWidth/2+","+this.dimensions.xLabelOffset+")").text(a.translate("Score"));this.addRanks(this.data.data);this.dimensions.groupWidth=150;this.dimensions.groupHeight=20;this.dimensions.groupPerRow=Math.floor(this.dimensions.navWidth/this.dimensions.groupWidth);var o=this.getAncestorsArray(n,n.ID);this.data.navData=[this.data.navData[0]].concat(o.map(function(i){return{paramID:i.ID,displayName:i.displayName}}));this.SVGs.nav.selectAll("g").data(this.data.navData,function(i){return i.paramID||"00000000-0000-0000-0000-000000000000"}).enter().append("g").each(function(q,p){m.makeNavGroup(this,q,p,n)});var h=this.SVGs.nav.selectAll("g")[0];d3.select(h[h.length-1]).classed("sim-ui-barChart-lastNav",true);var f=j;this.SVGs.legend.selectAll("g").data(f,function(i){return i.ID}).enter().append("g").each(function(q,p){m.makeLegendGroup(this,q,p)})};e.prototype.resize=function(){var f=this;this.dimensions.totalHeight=b(this.containerDivs.rootDiv).height();this.dimensions.totalWidth=b(this.containerDivs.rootDiv).width();this.dimensions.navWidth=this.dimensions.totalWidth;this.dimensions.legendWidth=this.dimensions.totalWidth;this.dimensions.mainHeight=this.dimensions.totalHeight-this.dimensions.navHeight-this.dimensions.legendHeight;this.dimensions.mainWidth=this.dimensions.totalWidth;this.dimensions.graphWidth=this.dimensions.mainWidth-this.dimensions.graphMargin.left-this.dimensions.graphMargin.right;this.SVGs.vis.attr("width",this.dimensions.mainWidth).attr("height",this.dimensions.mainHeight);this.SVGs.nav.attr("width",this.dimensions.navWidth).attr("height",this.dimensions.navHeight).style({position:"absolute"});this.SVGs.legend.attr("width",this.dimensions.legendWidth).attr("height",this.dimensions.legendHeight);this.scales.xScale.range([this.dimensions.graphMargin.left,this.dimensions.mainWidth-this.dimensions.graphMargin.right]);this.scales.xScaleAbsolute.range([0,this.dimensions.graphWidth]);this.scales.yScale.rangeRoundBands([this.dimensions.mainHeight-this.dimensions.graphMargin.bottom,this.dimensions.graphMargin.top],0.05);this.axes.xAxis.scale(this.scales.xScale);this.axes.yAxis.scale(this.scales.yScale);this.SVGs.xaxis.attr("transform","translate(0,"+(this.dimensions.mainHeight-this.dimensions.graphMargin.bottom)+")").call(this.axes.xAxis);this.SVGs.yaxis.attr("transform","translate("+(this.dimensions.graphMargin.left-1)+",0)").call(this.axes.yAxis);this.SVGs.xaxis.select(".sim-ui-barChar-axisLabel").attr("transform","translate("+this.dimensions.graphWidth/2+","+this.dimensions.xLabelOffset+")");this.SVGs.vis.selectAll(".sim-ui-barChart-paramGroup").each(function(h,g){f.groupResize(this,h,g)});this.dimensions.groupPerRow=Math.floor(this.dimensions.navWidth/this.dimensions.groupWidth);this.SVGs.legend.selectAll("g").each(function(h,g){f.resizeLegendGroup(this,h,g)});this.SVGs.nav.selectAll("g").each(function(h,g){f.resizeNavGroup(this,h,g)})};e.prototype.gradingChanged=function(){var h=this;var f=d.parameterFilterController.getFilteredData(),g={};this.buildDataMap(f,g).done(function(){c.limitStackSize(h.data.filteredDataTree,5,{rowIDs:h.data.rowIDs});h.refreshGraphData(h.data.filteredDataTree)})};e.prototype.addRanks=function(f){this.updateRanks(f,{})};e.prototype.updateRanks=function(i,g){var h=this;h.data.rankList=d.basketRank;this.rankGroups=this.SVGs.vis.selectAll(".sim-ui-barChart-rankGroup").data(this.data.rowIDs);this.rankGroups.enter().append("g").attr("class","sim-ui-barChart-rankGroup").append("text").classed("sim-ui-barChart-rankText",true);this.rankGroups.exit().remove();g=g||{};var f;if(g.transition===true){f=this.rankGroups.transition().duration(this.state.duration*2)}else{f=this.rankGroups}f.select(".sim-ui-barChart-rankText").text(function(k,j){return a.translate("Rank_val",h.data.rankList[j])}).attr("x",function(k){for(var j=0;j<i[0].values.length;j++){if(String(k)===i[0].values[j].rowID){return(h.scales.xScale(i[i.length-1].values[j].y0)+h.scales.xScaleAbsolute(i[i.length-1].values[j].y)+10)}}}).attr("y",function(j){return(h.scales.yScale(j)+h.scales.yScale.rangeBand()/2+5)})};e.prototype.updateScales=function(){this.scales.xScale.domain([0,this.data.dataMax]);this.scales.xScaleAbsolute.domain([0,this.data.dataMax]);this.SVGs.xaxis.call(this.axes.xAxis.scale(this.scales.xScale))};e.prototype.refreshGraphData=function(){var i=this;var g=this.getChildDataArray(this.data.filteredDataTree,this.data.navData[this.data.navData.length-1].paramID);this.data.data=this.stack(g.map(function(n,m){return i.mappingFunction(n,m)}));this.data.dataMax=this.getDataMax(this.data.data);this.updateScales();var j=this.SVGs.vis.selectAll(".sim-ui-barChart-paramGroup").data(this.data.data,function(m){return m.paramID});j.each(function(){i.groupUpdate(this)});j.enter().append("g").attr("class","sim-ui-barChart-paramGroup").each(function(){i.groupEnter(this,i)});j.exit().each(function(){i.groupExit(this)});this.updateRanks(this.data.data,{transition:true});var l=this.SVGs.legend.selectAll("g").data(g,function(m){return m.ID});l.exit().remove();l.each(function(n,m){i.updateLegendGroup(this,n,m)});l.enter().append("g").each(function(n,m){i.makeLegendGroup(this,n,m)});var h=this.getAncestorsArray(this.data.filteredDataTree,i.data.navData[i.data.navData.length-1].paramID);i.data.navData=[i.data.navData[0]].concat(h.map(function(m){return{paramID:m.ID,displayName:m.displayName}}));var k=this.SVGs.nav.selectAll("g").classed("sim-ui-barChart-lastNav",false).data(i.data.navData,function(m){return m.paramID||"00000000-0000-0000-0000-000000000000"});k.exit().remove();k.each(function(n,m){i.updateNavGroup(this,n,m)});k.enter().append("g").each(function(n,m){i.makeNavGroup(this,n,m)});var f=this.SVGs.nav.selectAll("g")[0];d3.select(f[f.length-1]).classed("sim-ui-barChart-lastNav",true)};e.prototype.truncateTextWidth=function(i,h){var g=d3.select(i),j=g.text(),f=0;h-=10;while(i.getComputedTextLength()>h&&f<500){j=j.substr(0,j.length-1);g.text(j);f++}if(f>0){j+="..";g.text(j)}};e.prototype.makeLegendGroup=function(g,l,h){var j=this;var k=Math.floor(h/j.dimensions.groupPerRow),f=h%j.dimensions.groupPerRow,m=d3.select(g);m.attr("transform","translate("+f*j.dimensions.groupWidth+","+k*j.dimensions.groupHeight+")").classed("sim-ui-barChart-groupLegend",function(i){return i.dataType=="group"}).on("click",function(i){if(i.dataType=="group"){j.changeToParent(i.ID,i.displayName)}});m.append("rect").attr("x",5).attr("width",10).attr("y",4).attr("height",10).style("fill",function(i){return j.scales.color(i.ID)});m.append("text").attr("transform","translate(19,"+(j.dimensions.groupHeight-6)+")").text(l.displayName).each(function(){j.truncateTextWidth(this,j.dimensions.groupWidth-24)})};e.prototype.updateLegendGroup=function(g,l,h){var j=this;var k=Math.floor(h/j.dimensions.groupPerRow),f=h%j.dimensions.groupPerRow,m=d3.select(g);m.attr("transform","translate("+f*this.dimensions.groupWidth+","+k*this.dimensions.groupHeight+")").on("click",null).on("click",function(i){if(i.dataType=="group"){j.changeToParent(i.ID,i.displayName)}})};e.prototype.resizeLegendGroup=function(g,k,h){var j=Math.floor(h/this.dimensions.groupPerRow),f=h%this.dimensions.groupPerRow,l=d3.select(g);l.attr("transform","translate("+f*this.dimensions.groupWidth+","+j*this.dimensions.groupHeight+")")};e.prototype.makeNavGroup=function(g,m,h){var k=Math.floor(h/this.dimensions.groupPerRow),f=h%this.dimensions.groupPerRow,l=d3.select(g);var j=this;l.classed("sim-ui-barChart-navGroup",true);l.attr("transform","translate("+f*j.dimensions.groupWidth+","+k*j.dimensions.groupHeight+")").on("click",function(){j.changeToParent(m.paramID,m.displayName)});l.append("path").attr("d","M 0 0 L 20 5 L 0 10 z").attr("transform","translate(5,4)");l.append("text").attr("transform","translate(35,"+(this.dimensions.groupHeight-6)+")").text(m.displayName).each(function(){j.truncateTextWidth(this,j.dimensions.groupWidth-40)})};e.prototype.updateNavGroup=function(g,m,h){var k=Math.floor(h/this.dimensions.groupPerRow),f=h%this.dimensions.groupPerRow,l=d3.select(g);var j=this;l.attr("transform","translate("+f*this.dimensions.groupWidth+","+k*this.dimensions.groupHeight+")").on("click",function(){j.changeToParent(m.paramID,m.displayName)})};e.prototype.resizeNavGroup=function(g,l,h){var j=Math.floor(h/this.dimensions.groupPerRow),f=h%this.dimensions.groupPerRow,k=d3.select(g);k.attr("transform","translate("+f*this.dimensions.groupWidth+","+j*this.dimensions.groupHeight+")")};e.prototype.groupUpdate=function(g){var i=d3.select(g),h=this;var f=i.selectAll("rect").data(function(j){return j.values},function(j){return j.rowID});f.on("click",null);f.on("click",function(j){h.barClick(j)});f.transition().duration(this.state.duration).attr("x",function(j){return h.scales.xScale(j.y0)||0}).attr("width",function(j){return h.scales.xScaleAbsolute(j.y)||0})};e.prototype.barClick=function(f){if(f.dataType=="group"){this.changeToParent(f.paramID,f.displayName)}};e.prototype.groupExit=function(f){var g=d3.select(f);g.transition().duration(this.state.duration).remove();g.selectAll("rect").transition().duration(this.state.duration).attr("width",0).attr("x",this.dimensions.graphMargin.left)};e.prototype.groupResize=function(g){var i=d3.select(g);var h=this;var f=i.selectAll("rect");f.attr("y",function(j){return h.scales.yScale(j.rowID)}).attr("x",function(j){return h.scales.xScale(j.y0)||0}).attr("height",h.scales.yScale.rangeBand()).attr("width",function(j){return h.scales.xScaleAbsolute(j.y)||0})};e.prototype.changeToParent=function(n,g){var m=this.data.filteredDataTree;var l=this;var k=n?this.getChildDataArray(m,n):this.getChildDataArray(m);var p=this.stack(k.map(function(r,q){return l.mappingFunction(r,q)}));this.data.dataMax=this.getDataMax(p);this.updateScales();var o=this.SVGs.vis.selectAll(".sim-ui-barChart-paramGroup").data(p,function(q){return q.paramID});o.enter().append("g").attr("class","sim-ui-barChart-paramGroup").each(function(r,q){l.groupEnter(this,r,q)});o.exit().each(function(r,q){l.groupExit(this,r,q)});this.updateRanks(p,{transition:true});if(n){var i=-1;l.data.navData.some(function(r,q){if(r.paramID==n){i=q;return true}else{return false}});if(i==-1){l.data.navData.push({paramID:n,displayName:g})}else{l.data.navData.splice(i+1)}}else{l.data.navData=[l.data.navData[0]]}var j=l.SVGs.nav.selectAll("g").classed("sim-ui-barChart-lastNav",false).data(l.data.navData,function(q){return q.paramID||"00000000-0000-0000-0000-000000000000"});j.enter().append("g").each(function(r,q){l.makeNavGroup(this,r,q)});j.exit().remove();var h=l.SVGs.nav.selectAll("g")[0];d3.select(h[h.length-1]).classed("sim-ui-barChart-lastNav",true);var f=l.SVGs.legend.selectAll("g").data(k,function(q){return q.ID});f.enter().append("g").each(function(r,q){l.makeLegendGroup(this,r,q)});f.exit().remove()};return e});define("DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsView",["UWA/Core","DS/Tree/GridView","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsCell"],function(f,e,b,c,d){var a=e.extend({defaultOptions:{width:"100%",height:580,infiniteScrolling:true,cellClass:d,defaultCellHeight:580,cellSpacing:{vertical:10,horizontal:10},defaultCellWidth:200,useSwipableMenu:false},init:function(g){if(g.hasUncertainties){g.height=650;g.defaultCellHeight=650}this._parent(g);this._initSpecializedView(g)},loadGridViewModel:function(g){this.options.model=g;this.options.numberOfColumns=g.getChildren().length;this._parent(g)},_initSpecializedView:function(g){this.onCellRequest(function(i){var h=i.nodeModel;i.cellView.setStructure(h.options.grid.structure,h.options.grid.demensions);i.cellView.setTitle(h.options.label,h.options.grid);i.cellView.setTableData(h.options.grid);i.cellView.setupChart(h.options.grid)})}});return a});define("DS/SMAAnalyticsUI/SMAAnalyticsPreviewPage",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsVarGroupTable","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper","DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsView","DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsCell","DS/SMAAnalyticsUI/paramstats/SMAAnalyticsParamStatsModel","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget"],function(h,w,a,d,i,v,j,y,D){var b=function(){var G=this,F=G.parents(".sim-ui-preview-outerDiv");F.children(".sim-ui-preview-titleDiv").click(function(H){H.preventDefault();F.find(".sim-ui-preview-buttons-showHide").trigger("click")})};var x=function(){var G=this,H=G.parent().find(".sim-ui-preview-contentDiv").css("overflow");var F=G.append('<span class="ui-icon ui-icon-triangle-1-n sim-ui-preview-buttons-showHide"></span>').children(".sim-ui-preview-buttons-showHide");G.each(function(){F.data({showHide:"show",fullHeight:h(this).siblings().children(".sim-ui-preview-contentDiv").height()})});F.click(function(){if(h(this).data("showHide")==="show"){h(this).data("fullHeight",h(this).parent().siblings().children(".sim-ui-preview-contentDiv").height()).parent().siblings().children(".sim-ui-preview-contentDiv").css({overflow:"hidden"}).animate({height:"0px"},function(){F.toggleClass("ui-icon-triangle-1-n ui-icon-triangle-1-s")});h(this).data("showHide","hide")}else{var I=this;h(this).parent().siblings().children(".sim-ui-preview-contentDiv").animate({height:h(this).data("fullHeight")},function(){h(I).parent().siblings().children(".sim-ui-preview-contentDiv").css({height:"auto",overflow:H});F.toggleClass("ui-icon-triangle-1-n ui-icon-triangle-1-s")});h(this).data("showHide","show")}});h(G).run(b);return G};var m=function(L,N){var M;N=typeof N!=="undefined"?N:50;M=5;var J=this.addClass("sim-ui-preview-outerDiv"),F=[];var G=h('<div class="sim-ui-preview-titleDiv"></div>').appendTo(J);G.append('<h3 class="sim-ui-preview-paneTitle">'+L+"</h3>");var I=G.outerHeight();var K=h('<div class="sim-ui-preview-paneDiv"></div>').css({top:I/2-1.5+"px","margin-bottom":I/2}).appendTo(J);var H=h('<div class="sim-ui-preview-contentDiv"></div>').appendTo(K);H.css({"margin-top":I/2+M+"px"});h('<div class="sim-ui-preview-iconsDiv"></div>').appendTo(J).run(x);return H};var E=function(F){var H={},G={};this.getPanNames=function(){var J=[];var I;for(I in G){if(G.hasOwnProperty(I)){J.push(I)}}return J};this.getTitle=function(I){return G[I].title};this.addIndexedPanel=function(K,J,I,M,L){if(typeof M==="undefined"){M=i.translate(K)}if(typeof H[J]!=="undefined"){throw i.translate("INDEX_ERROR",": "+K+i.translate("INDEX_ERROR_TAIL"))+"."}else{if(G.hasOwnProperty(K)){throw i.translate("NAME_RED_ERR",": "+i.translate("NAME_RED_ERR_TAIL",K)+".")}}G[K]={title:M,index:J,generator:I,pointer:null,sessionObject:L};this.panels=G;return this};this.renderPanel=function(J){var K=arguments;if(G[J].pointer===null){var I=function(P){if(P===0){return"none"}else{P-=1;if(typeof H[P]!=="undefined"){return G[H[P]].pointer}else{return I(P)}}};var M=I(G[J].index),O=Array.prototype.slice.call(K,1),L=null;if(M==="none"){L=F.prepend("<div id="+J+"></div>").children("#"+J)}else{L=M.after("<div id="+J+"></div>").next()}var N=m.call(L,G[J].title);N.sessionObject=G[J].sessionObject;G[J].generator.apply(N,O);G[J].pointer=L;H[G[J].index]=J}return this};this.rerenderPanel=function(I){if(G[I].pointer!==null){G[I].pointer.remove();G[I].pointer=null;this.renderPanel(I)}this.renderPanel(I);return this}};var r=function(){var V=function(aa){aa.addClass("sim-ui-previewPage-con-editableListItem").attr("contenteditable",true).css("min-width","80px").css("min-height","15px").css("padding-left","5px").css("padding-right","5px").on("focus",S).on("blur",I).on("keydown",N).css("background","#eee")};var S=function(){var aa=h(this);aa.bind("keydown",N);aa.css("background","yellow")};var W=function(ab,ad){if(ad.length>0){try{if(isNaN(new Date(ad).valueOf())){var ai="",aj=true;ai=ad.indexOf("/")>-1?"/":ad.indexOf("-")>-1?"-":ad.indexOf("|")>-1?"|":ad.indexOf(":")>-1?":":"";aj=ai!=="";if(aj){var ac=ad.split(ai);if(ac.length===3){var ag=0,af=0;for(var ah=0;ah<3;ah++){if(parseInt(ac[ah],10)<=12){ag++}if(parseInt(ac[ah],10)<=31){af++}if(ac[ah].length>4){aj=false;break}}if(ag<1||af<1){aj=false}}else{aj=false}}if(!aj){alert(i.translate("INVALID_DUE_DATE"));ab.text(decodeURIComponent(X.DueDate));return}}}catch(ae){ab.text(decodeURIComponent(X.DueDate));return}}else{ad=" "}var aa=encodeURIComponent(ad);if(aa===X.DueDate){return}X.DueDate=aa;w.executeCommand({commandName:"setAdviseCaseInfo",data:{dueDate:aa}})};var N=function(ac){var aa=h(this).text();if((ac.keyCode===13||ac.charCode===13)&&!ac.shiftKey){ac.stopPropagation();ac.preventDefault();W(h(this),aa)}if(aa.length>=30){ac.stopPropagation();ac.preventDefault();var ab=aa.length;aa=aa.substring(0,ab-1);h(this).text(aa)}};var I=function(){var ab=h(this);ab.css("background","#eee");var aa=ab.text();W(ab,aa)};var K=this,X=w.getPreviewData("CaseData"),P=[{name:i.translate("Project")+": ",value:X.Project,type:"text"},{name:i.translate("Group")+": ",value:X.Group,type:"text"},{name:i.translate("Originated")+": ",value:X.Originated,type:"text"},{name:i.translate("Due Date")+": ",value:decodeURIComponent(X.DueDate)===" "?"":X.DueDate,type:"text",editable:true,makeEditableCallback:V},{name:i.translate("Revision Number")+": ",value:X.RevisionNumber,type:"text"},{name:i.translate("Owner")+": ",value:X.Owner,type:"text"},{name:i.translate("Last Modified")+": ",value:X.LastModified,type:"text"},{name:i.translate("Status")+": ",value:i.translate(decodeURIComponent(X.Status)),type:"text"}],H=[];console.log(X);K.css("z-index",5);var M=K.append('<div class = "sim-ui-preview-con-listLine">').children(".sim-ui-preview-con-listLine");var L=K.append('<div class = "sim-ui-preview-con-listLine">').children(".sim-ui-preview-con-listLine:last");M.css({"padding-top":"5px"});L.css({"margin-top":"10px"});var G=M;for(var T=0;T<P.length;T++){if(T<4){G=M}else{G=L}if(P[T].type==="text"){var Z=P[T].value;if(P[T].editable){Z=decodeURIComponent(Z)}H[T]=h('<div class = "sim-ui-preview-con-previewListItem">').appendTo(G);var Y=h('<div style="display:inline-block; float:left;">').append("<p><b>"+P[T].name+"</b></p>").appendTo(H[T]);var Q=h('<div style="display:inline-block; float:left; margin-left:5px;">').append("<p>"+Z+"</p>").appendTo(H[T]);var O=200-Y.width();Q.run(a.makeTruncatedText,O);if(P[T].editable){P[T].makeEditableCallback(Q)}}else{if(P[T].type==="dropdown"){var F=h('<div class="sim-ui-preview-con-previewListItem" style="display:inline-block">').appendTo(G).append('<p style="display:inline-block"><b>'+P[T].name+"</b></p>");var U=h("<select>").appendTo(F),J=P[T].options;if(P[T].changeCallback!==undefined){U.on("change",P[T].changeCallback)}h("<option>").text(P[T].value).css("display","none").attr("selected","true").appendTo(U);for(var R=0;R<J.length;R++){h("<option>").appendTo(U).text(J[R])}H[T]=F}}}for(T=0;T<H.length;T++){H[T].css("width","20%")}return K};var s=function(){var G=this,I=G.append('<div class="sim-ui-preview-previewTextArea" contenteditable="false">Enter some background text:</div>').children(".sim-ui-preview-previewTextArea");var F=decodeURIComponent(w.getPreviewData("Background"));if(F===""||F===" "){F=i.translate("enter_background")}I.data("filled",false);if(typeof F==="undefined"){I.data("filled",false)}else{(function(){I.data("filled",true);I[0].textContent=F}.call())}if(I.data("filled")===false){I.addClass("sim-ui-preview-bac-inactiveTextArea")}I.click(function(){if(I.data("filled")===false&&I.attr("contenteditable")==="true"){I.data("filled",true);I.text("");I.removeClass("sim-ui-preview-bac-inactiveTextArea")}});var H=G.append('<input type="button" value="'+i.translate("Edit")+'" class="sim-ui-preview-previewEditButton">').children(".sim-ui-preview-previewEditButton");H.click(function(){if(I.attr("contenteditable")==="true"){if(I[0].textContent===""){I[0].textContent=" "}var J=encodeURIComponent(I[0].textContent);w.executeCommand({commandName:"setAdviseCaseInfo",data:{background:J}});I.attr("contenteditable","false");H.attr("value",i.translate("Edit"))}else{I.attr("contenteditable","true");H.attr("value",i.translate("Apply"))}});return G};var c=function(){var K=w.getPreviewData("DataSets");var O=[];for(var M=0;M<K.length;M++){if(K[M].alias.startsWith("USER_CREATED")||K[M].alias==="PREDICTED"){continue}O.push(K[M])}var N=this;var P=h('<div class="sim-ui-preview-simulationContent"></div>').appendTo(N);function I(T,S,R,V,Q){var U=h("#sim-ui-preview-image-title");if(Q&&Q!=="false"){U.text(R+" (removed)");U.css("text-decoration","line-through")}else{U.text(R);U.css("text-decoration","")}U.unbind("click");U.removeAttr("href");if(T.toUpperCase().indexOf("SIMULATION JOB")>-1){h.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getSimulationProcessId",data:{jobOID:S},success:function(X){var W=X.getElementsByTagName("simulationprocess")[0].textContent;U.attr("href","../../common/emxNavigator.jsp?ContentPage=../simulationcentral/smaHomeUtil.jsp?objectAction=openInDiscover%26HelpMarker=SMA_OpenInDiscover%26suiteKey=SimulationCentral%26StringResourceFileId=smaSimulationCentralStringResource%26SuiteDirectory=simulationcentral%26objectId="+W);U.attr("target","_blank")},error:function(W,Y,X){console.log("Failed to retrieve prcess id"+W+"\n\nText Status:\n"+Y+"\n\nError Thrown:\n"+X);U.attr("href","../../simulationcentral/smaHomeUtil.jsp?objectAction=openInDiscover&HelpMarker=SMA_OpenInDiscover&suiteKey=SimulationCentral&StringResourceFileId=smaSimulationCentralStringResource&SuiteDirectory=simulationcentral&objectId="+S+"&widgetId=null&");U.attr("target","_blank")}})}else{if(T.toUpperCase().indexOf("SIMULATION DOCUMENT")>-1){U.click(function(){w.spinnerControlShow();h.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/dataFileCheckoutTicket",data:{datasetOID:S,fileName:V},success:function(Y){var Z=Y.getElementsByTagName("Ticket")[0].textContent;var X=Y.getElementsByTagName("FcsUrl")[0].textContent;var W=h('<form id="slm_fcs_file_download_form" style="width:0.5px; height:0.5px" method="POST" action="'+X+"/"+name+'">');W.append('<input type="hidden" name="jobTicket" value="__fcs__jobTicket">');W.append('<input type="hidden" name="__fcs__jobTicket" value="'+Z+'">');W.append('<input type="hidden" name="noCache" value="'+Date.now()+'">');W.append('<input type="hidden" name="__fcs__attachment" value=true>');U.parent()[0].appendChild(W[0]);window.isDownloadLink=true;W.submit();console.log("downloading file");W.remove();w.spinnerControlHide()},error:function(W,Y,X){w.spinnerControlHide();console.log("Failed to get a download ticket.\n\nRequest Header:\n"+W+"\n\nText Status:\n"+Y+"\n\nError Thrown:\n"+X)}})})}}return U}if(O.length>1){a.createPreviewCarousel(O,P[0]);P.append('<div class="sim-ui-preview-wall"><div class="sim-ui-preview-sim-slider-container" id="sim-ui-preview-sliderbar"><input type="hidden" value="10" id="sim-ui-preview-zoom" /></div><img class="sim-ui-preview-sim-image"></img></div>');h(".sim-ui-preview-wall").append('<a id="sim-ui-preview-image-title" style="left:140px"></a>');h(".sim-ui-carousel-slide").click(function(){var S=h(this).children(".sim-ui-carousel-overlay");var R=S.attr("wflwurl");var T=S.attr("img-title");var Q=S.attr("deleted");var V=S.attr("file-name");var U=h(".sim-ui-preview-sim-image");U.removeAttr("width").removeAttr("height");U.css({height:"",width:"",top:"",left:"0px",position:"relative"});if(R===undefined){U[0].src="./assets/icons/simDoc.png";h("#sim-ui-preview-sliderbar").css({visibility:"hidden"});U.css({top:"130px"})}else{U[0].src=w._baseURL+R;h("#sim-ui-preview-sliderbar").css({visibility:"visible"});U.css({top:"0px"})}I(S.attr("obj-type"),S.attr("obj-id"),T,V,Q)})}else{P.append('<div class="sim-ui-preview-sim-slider-container" id="sim-ui-preview-sliderbar"><input type="hidden" value="10" id="sim-ui-preview-zoom" /></div><img class="sim-ui-preview-sim-image"></img>');h(".sim-ui-preview-contentDiv").css({overflow:"hidden !important","text-align":"center"})}var L=false;var J=h(".sim-ui-preview-sim-image");var F=J.run(a.encapsulateImg);if(O.length>1){F.css({position:"absolute",top:"10px"});h("#sim-ui-preview-sliderbar").css({left:"220px",top:"20px"})}else{F.css({position:"relative",left:"80px",top:"0px",width:"96%",height:"280px"});P.append('<a id="sim-ui-preview-image-title" style="left:40px"></a>')}var G=h("#sim-ui-preview-image-title");var H=function(){L=true};J.bind("error",H);if(O&&O.length>0){J.textContent="";if(O[0].workflowImageURL===undefined){J[0].src="./assets/icons/simDoc.png"}else{J[0].src=w._baseURL+O[0].workflowImageURL}G.text(O[0].fileName);I(O[0].typeName,O[0].plmOID,O[0].title,O[0].fileName,O[0].deleted)}else{J[0].src="";L=true}if(!L){J.load(function(){if(h(this).width()>F.width()){h(this).css("left","-140px")}F.run(a.zoomMaxWidth).run(a.makeDraggable);if(O.length===1){h(".sim-ui-global-imageHolderDiv").css({width:"96% !important"})}if(!a.smaSliderObject){h("#sim-ui-preview-sliderbar").css({height:F.height()});h("#sim-ui-preview-sliderbar").run(a.createSlider)}else{console.log("slider was already created !!!");a.resetSlider()}})}else{if(O.length===0){F.html('<p class="sim-ui-preview-image-errorText">'+i.translate("no_datasets")+"</p>")}else{F.html('<p class="sim-ui-preview-image-errorText">No image available.</p>')}}return N};var q=function(){var L=this,F=L.append('<div class="sim-ui-preview-previewTextArea" contenteditable="false"></div>').children(".sim-ui-preview-previewTextArea"),H=L.append('<div class="sim-ui-preview-met-editPanel"></div>').children(".sim-ui-preview-met-editPanel");var G=decodeURIComponent(w.getPreviewData("Methods"));if(G==""){G=i.translate("enter_methods")}if(typeof G==="undefined"){F.data("filled",false)}else{(function(){F.data("filled",true);F[0].textContent=G}.call())}H.css("display","none");if(F.data("filled")===false){F.addClass("sim-ui-preview-met-inactiveTextArea").append(i.translate("enter_bkg_text")+": ")}F.click(function(){if(F.data("filled")===false&&F.attr("contenteditable")==="true"){F.data("filled",true);F.text("");F.removeClass("sim-ui-preview-met-inactiveTextArea")}});var N=i.translate("Bold");var P=i.translate("Italic");var K=i.translate("Underline");var J=L.append('<input type="button" value="'+i.translate("Edit")+'" class="sim-ui-preview-previewEditButton">').children(".sim-ui-preview-previewEditButton"),O=H.append('<input type="button" value="'+N+'" class="sim-ui-preview-previewBoldButton">').children(".sim-ui-preview-previewBoldButton"),M=H.append('<input type="button" value="'+P+'" class="sim-ui-preview-previewItalicButton">').children(".sim-ui-preview-previewItalicButton"),I=H.append('<input type="button" value="'+K+'" class="sim-ui-preview-previewUnderlineButton">').children(".sim-ui-preview-previewUnderlineButton");J.click(function(){if(F.attr("contenteditable")==="true"){var Q=encodeURIComponent(F[0].textContent);w.executeCommand({commandName:"setAdviseCaseInfo",data:{methods:Q}});F.attr("contenteditable","false");J.attr("value",i.translate("Edit"));H.css("display","none")}else{F.attr("contenteditable","true");J.attr("value",i.translate("Apply"));H.css("display","block")}});O.click(function(){document.execCommand("bold",null,false)});M.click(function(){document.execCommand("italic",null,false)});I.click(function(){document.execCommand("underline",null,false)});return L};var l=function(){var G=this;var F=false;if(typeof G.sessionObject!=="undefined"&&typeof G.sessionObject.previewPage!=="undefined"){F=true}if(F&&G.sessionObject.previewPage.paramTable){G.append(G.sessionObject.previewPage.paramTable)}else{if(F&&typeof G.sessionObject.previewPage.paramTable==="undefined"){G.sessionObject.previewPage.paramTable=h("<div>",{id:"sim-ui-preview-paramTable"});G.append(G.sessionObject.previewPage.paramTable);G.sessionObject.previewPage.paramTableObject=new d.constr({target:"#sim-ui-preview-paramTable"})}}return G};var B=function(U,F,H,ag){var N=26;var ad=N>U.length?U.length:N;var W=10;var K=0;if(U.length<N){W=N*(W+5)/ad-5}else{W=10}var G=0;var T;for(var Z=0;Z<U.length;Z++){K=K+U[Z].freqs;if(U[Z].words===""){T=7}else{T=U[Z].words.length}G=G<T?T:G}G=G>15?15:G;var X=15;var O=460;var ab=U[0].freqs;var ah=[];var I=30;for(Z=H;Z<(H+N*2>U.length?U.length:H+N*2);Z++){ah.push(U[Z])}var aa=d3.behavior.drag().on("drag",function(ai){ai.x+=d3.event.dx;ai.y+=d3.event.dy;d3.select(this).attr("transform",function(aj){if(aj.y>=0){if(aj.startNum>0){B(aj.freqInfo,F,aj.startNum-N>0?aj.startNum-N:0,-1*aj.dragHeight)}if(aj.startNum===0){h(F).find(".sim-ui-stat-up-arrow").css("visibility","hidden")}return"translate("+[0,0]+")"}if(aj.y<=-1*aj.dragHeight){if(aj.startNum>=0&&aj.startNum+ad*2<=U.length){B(aj.freqInfo,F,aj.startNum+N,0);return"translate("+[0,-1*aj.dragHeight]+")"}else{h(F).find(".sim-ui-stat-down-arrow").css("visibility","hidden");return"translate("+[0,-1*M]+")"}}else{h(F).find(".sim-ui-stat-up-arrow").css("visibility","visible");h(F).find(".sim-ui-stat-down-arrow").css("visibility","visible");return"translate("+[0,aj.y]+")"}})});var M=(20+(W+5)*ah.length-O+I*2&&U.length>ad)>0?20+(W+5)*ah.length-O+I*2:0;if(h(F).find(".sim-ui-stat-up-arrow").length!==0){h(F).find(".sim-ui-stat-up-arrow").remove()}var R,V;R=h('<span class="sim-ui-stat-up-arrow  ui-icon ui-icon-triangle-1-n"></span>').click(function(){h(F).find(".sim-ui-stat-up-arrow").css("visibility","visible");B(U,F,H-N*5<0?0:H-N*5,0)});h(F).append(R);if(H>0||ag<0){h(F).find(".sim-ui-stat-up-arrow").css("visibility","visible")}else{h(F).find(".sim-ui-stat-up-arrow").css("visibility","hidden")}h(F).find(".sim-ui-param-stats-freq-chart").remove();var ac;ac=d3.select(F[0]).append("svg").attr("id","all").attr("class","sim-ui-param-stats-freq-chart").call(aa);ac.selectAll("rect").remove();ac.selectAll("g").remove();function af(ai){Q.attr("class","sim-ui-stat-bar-deselect");S.text(i.translate("Samples",String(": "+ai.freqs)));J.text(i.translate("Value",String(": "+ai.words)));d3.select(this).attr("class","sim-ui-stat-bar-select")}function Y(){S.text(i.translate("Samples",String(": "+K)));J.text(i.translate("Value",":"));Q.attr("class","sim-ui-stat-bar")}var ae=ac.append("g").data([{x:0,y:ag,dragHeight:M,startNum:H,freqInfo:U}]).attr("transform","translate(0,"+ag+")").call(aa);ae.append("rect").attr("width",100+"%").attr("height",2*O).attr("x",0).attr("y",X).style("fill-opacity",0).style("stroke","none");var L=ae.selectAll(".sim-ui-stat-freqs-bars").data(ah).enter().append("g");var Q=L.append("rect").attr("x",function(){return 10+G*3+"%"}).attr("y",function(aj,ai){return 5+(W+5)*ai}).attr("width",function(ai){return(85-G*3-(ab-ai.freqs)*(85-G*3)/ab+"%")}).attr("height",function(){return W}).attr("class","sim-ui-stat-bar").on("mouseover",af).on("mouseout",Y);L.append("line").attr("x1",function(){return 9+G*3+"%"}).attr("x2",function(){return 9+G*3+"%"}).attr("y1",function(aj,ai){return 2.5+(W+5)*ai}).attr("y2",function(aj,ai){return 7.5+(W+5)*ai+W});L.append("line").attr("x1",function(){return 7+G*3+"%"}).attr("x2",function(){return 9+G*3+"%"}).attr("y1",function(aj,ai){return 2.5+(W+5)*ai}).attr("y2",function(aj,ai){return 2.5+(W+5)*ai});L.append("line").attr("x1",function(){return 7+G*3+"%"}).attr("x2",function(){return 9+G*3+"%"}).attr("y1",function(aj,ai){return 7.5+(W+5)*ai+W}).attr("y2",function(aj,ai){return 7.5+(W+5)*ai+W});L.append("text").attr("x",function(ai){if(ai.words.length<15){if(ai.words===""){return 5+G*3-7*3+"%"}else{return(5+G*3-ai.words.length*3+"%")}}else{return 8+G*3-15*3+"%"}}).attr("y",function(aj,ai){return 10+W/2+(W+5)*ai}).text(function(ai){if(ai.words.length<15){if(ai.words===""){return"<empty>"}else{return ai.words}}else{return ai.words.substring(0,12)+"..."}});L.append("title").text(function(ai){return ai.words});if(h(F).find(".sim-ui-stat-down-arrow").length!==0){h(F).find(".sim-ui-stat-down-arrow").remove()}V=h('<span class="sim-ui-stat-down-arrow ui-icon ui-icon-triangle-1-s"></span>').click(function(){R.css({visibility:"visible"});if(H+N*5>U.length-N-1){B(U,F,U.length-2*(N-1)>0?U.length-2*(N-1):0,-1*M+30)}else{B(U,F,H+N*5,0)}});h(F).find(".sim-ui-stat-footer").remove();var P=d3.select(F[0]).append("svg").attr("id","all").attr("class","sim-ui-stat-footer svgscrape-ignore").attr("width","94%").attr("height",I).attr("x",0).attr("y",O-I).style("position","absolute").style("top","92%").style("left","3%");P.append("rect").attr("width","100%").attr("height",I);var J=P.append("text").attr("class","sim-ui-stat-text").text(function(){return i.translate("Value",":")}).attr("x",5).attr("y",I/2-3);var S=P.append("text").attr("class","sim-ui-stat-text").text(function(){return i.translate("Samples",": "+K)}).attr("x",5).attr("y",I/2+10);if(H+N>U.length){V.css({visibility:"hidden"})}h(F).append(V);if(H===U.length-ad-1||U.length<N||(U.length<N*2&&ag===-1*M)){h(F).find(".sim-ui-stat-down-arrow").css("visibility","hidden")}else{h(F).find(".sim-ui-stat-down-arrow").css("visibility","visible")}};var g=function(Q,Y,W,ac,ag,L){var aj=Y,V=0;for(var ad=0;ad<Y.length;ad++){V+=Y[ad]}var ah=30,O=ah+1,F=ah,Z=15,M=Z+5,H=27,P=5,G=5,K=ag-O-G,af=L-M-P-H;d3.select(Q[0]).selectAll(".sim-ui-out-histogram").remove();var R=d3.select(Q[0]).append("svg").attr("class","sim-ui-out-histogram").attr("width",ag).attr("height",L);var T=R.append("svg").attr("class","sim-ui-stat-footer").attr("width",ag).attr("height",H).attr("x",0).attr("y",L-H);T.append("rect").attr("width",ag).attr("height",H);var ab=R.append("svg").attr("class","sim-ui-stat-header");ab.append("rect").attr("width",ag).attr("height",Z);ab.append("text").text("Quantile Histogram").attr("y",12).attr("text-anchor","middle").attr("x",ag/2);var J=d3.scale.linear().domain([0,d3.max(aj)]).range([0,K]);var I=d3.scale.linear().domain([W,ac]).range([af,0]);var X=d3.format("s");var ae=d3.svg.axis().scale(I).orient("left").tickFormat(X);function ai(al,ak){S.attr("class","sim-ui-stat-bar-deselect");d3.select(this).attr("class","sim-ui-stat-bar-select");N.text(i.translate("Range",String(": "+a.formatExp(ak*(ac-W)/aj.length+W)+" - "+a.formatExp((ak+1)*(ac-W)/aj.length+W))));U.text(i.translate("Samples",String(": "+al)))}function aa(){N.text(i.translate("Range",String(": "+a.formatExp(W)+" - "+a.formatExp(ac))));U.text(i.translate("Samples",String(": "+V)));S.attr("class","sim-ui-stat-bar")}var S=R.selectAll("rect.sim-ui-stat-bar").data(Y).enter().append("rect").attr("class","sim-ui-stat-bar").attr("x",O).attr("y",function(al,ak){return(I(ak*(ac-W)/aj.length+W)+M-af/aj.length)}).attr("width",function(ak){return J(ak)}).attr("height",af/aj.length).on("mouseover",ai).on("mouseout",aa);R.append("g").attr("class","sim-ui-stat-axis").attr("width",30).attr("transform","translate("+F+","+M+")").call(ae);var N=T.append("text").attr("class","sim-ui-stat-text").text(i.translate("Range",String(": "+a.formatExp(W)+" - "+a.formatExp(ac)))).attr("x",5).attr("y",12);var U=T.append("text").attr("class","sim-ui-stat-text").text(i.translate("Samples",String(": "+V))).attr("x",5).attr("y",24)};var C=function(M){var K="";var I=M.target.id;var H=I.split("_")[0];h(M.currentTarget).find("select").each(function(){K=K+"["+this.selectedIndex+"]"});var L=h(M.currentTarget).find(".sim-ui-stat-imgDiv");var J=w.findParameter(H);var G=J.elementData[J.name+K];var F=h(M.currentTarget);if(J.dataType==="INTEGER"||J.dataType==="REAL"){h(F).find(".sim-ui-stat-parameterTable-borderDiv").remove();A(F,G,L.width(),L.height(),L)}else{if(J.dataType==="STRING"){f(G,L)}}};var f=function(F,H){var I=[];for(var G=0;G<F.stringSortedByFreqs.length;G++){I.push({words:F.stringSortedByFreqs[G],freqs:F.stringFreqsDominated[G]+F.stringFreqsPareto[G]+F.stringFreqsInfeasible[G]+F.stringFreqsExcluded[G]})}B(I,H,0,0)};var A=function(M,L,K,I,O){var J=h('<div class = "sim-ui-stat-parameterTable-borderDiv"><table class = "sim-ui-stat-parameterTable"></div>'),N=J.children("table").append('<tr> <th colspan="3"> '+i.translate("Quantiles")+" </th></tr>"),H=h('<div class = "sim-ui-stat-parameterTable-borderDiv"><table class = "sim-ui-stat-parameterTable"></div>'),G=H.children("table").append('<tr> <th colspan= "2"> '+i.translate("Moments")+" </th> </tr>"),F;M.append(J).append(H);w.getOutputParameterInformation(L,function(S){var W=S.histogramValues,U=S.min,Z=S.max,aa=S.mean,Y=S.stdDev,P=S.percentiles,R=S.percentileNames,X=S.sum,Q=[L.max,L.upperQuartile,L.median,L.lowerQuartile,L.min];for(var T=0;T<P.length;T++){F=h("<tr></tr>").appendTo(N);F.append("<td>"+P[T]+"</td>").append("<td><div>"+Q[T]+"</div></td>").find("div").run(a.makeFormattedNumber);F.append("<td>"+R[T]+"</td>")}G.append("<tr><td>"+i.translate("Sum")+"</td><td><div>"+X+"</div></td></tr>").find("div:last").run(a.makeFormattedNumber);G.append("<tr><td>"+i.translate("Mean")+"</td><td><div>"+aa+"</div></td></tr>").find("div:last").run(a.makeFormattedNumber);G.append("<tr><td>"+i.translate("Standard Deviation")+"</td><td><div>"+Y+"</div></td></tr>").find("div:last").run(a.makeFormattedNumber);var V=Math.max(N.width(),G.width(),M.find(".sim-ui-stat-parameterTitle").width()-10,K);g(O,W,U,Z,V,I);M.find(".sim-ui-stat-parameterTitle").after(O)})};var e=function(){var F=h(this);F.find(".sim-ui-stat-parameterDiv").each(function(G,H){k(h(H),false)})};var k=function(W,F){var N=true;if(typeof F==="boolean"){N=F}var J=W[0].paramRef,S=W[0].chartWidth,H=W[0].chartHeight;var M=w.findParameter(J);W.removeClass("role_UNKNOWN");W.removeClass("role_INPUT");W.removeClass("role_OUTPUT");W.addClass("role_"+M.role);if(W[0]._rendered||(N&&!o(W[0]))){return false}W[0]._rendered=true;var I=h('<div class = "sim-ui-stat-imgDiv">');var V=h('<div class="sim-ui-stat-parameterTitle"></div>');h("<span>"+decodeURIComponent(M.name)+"</span>").appendTo(V);var G=M;var R;if(M.structure==="ARRAY"){I.css("margin-top","1px");var U=M.name;for(R=0;R<M.dimensions.length;R++){U=U+"[0]";var L=J+"_index"+R;var K="<select id="+L+">";for(var P=0;P<M.dimensions[R];P++){K=K+'<option value="'+P+'">'+P+"</option>"}K=K+"</select>";V.append(K);W.on("change",C)}G=M.elementData[U]}W.append(V);if(M.dataType==="INTEGER"||M.dataType==="REAL"){A(W,G,S,H,I)}else{if(M.dataType==="STRING"){I.css({width:S,height:H});W.append(I);var O=15;var T=d3.select(I[0]).append("svg").attr("height",O).attr("width","100%").attr("class","svgscrape-ignore");var Q=T.append("g").attr("class","sim-ui-stat-header");Q.append("rect").attr("width","100%").attr("height",O);Q.append("text").text("Frequency Chart").attr("y",12).attr("text-anchor","middle").attr("x","50%");h(I).css({height:"460px"});f(G,I)}}return true};var n=function(F,G,I,H){var J=F[0];J.paramRef=G;J.chartWidth=I;J.chartHeight=H;J.setAttribute("data-paramID",G);k(F)};var o=function(G){var I=G.getBoundingClientRect().left,H,G=G.parentNode;if(G===null){console.warn("visiblity check for dangling node");return true}if(G.clientWidth<=0){return false}var F=wrap(document.body);do{H=G.getBoundingClientRect();if(I<=H.right===false){return false}G=G.parentNode}while(G!==F&&G!==null);return I<=document.documentElement.clientWidth};var p=function(I){var H=w.formulation.uncertainties;if(typeof H==="undefined"){return false}var F={};for(var G=0;G<H.length;G++){F[H[G].parameterID]=H[G]}for(var G=0;G<I.length;G++){if(typeof F[I[G].ID]!=="undefined"){I[G].uncertainty=F[I[G].ID]}}};var u=function(){var W=this.parent().parent().find(".sim-ui-preview-titleDiv");var P=document.createElement("div");P.classList.add("sim-ui-stat-parameter-filter-container");W[0].appendChild(P);var J=document.createElement("select");var N=document.createElement("option");N.text=i.translate("Show All");N.setAttribute("value","all");J.appendChild(N);var T=document.createElement("option");T.text=i.translate("Only Outputs");T.setAttribute("value","OUTPUT");J.appendChild(T);var I=document.createElement("option");I.text=i.translate("Only Inputs");I.setAttribute("value","INPUT");J.appendChild(I);P.appendChild(J);h(P).click(function(X){X.stopImmediatePropagation()});var G=w.getAllParameterObjectsAsFlatList();p(G);var R=G.length;var V="200",M=V-10,S=M,K=300;var Q=h('<div class="sim-ui-stat-innerContentDiv"></div>');Q.appendTo(this);Q.data("outputParamsCount",R);this.sessionObject.previewPage.paramStatsModel;var L=this;var O=false;if(w.formulation.uncertainties&&w.formulation.uncertainties.length>0){O=true}var F=new j({cellClass:y,hasUncertainties:O});var U=new D({});U.setParamData(G);F.loadGridViewModel(U);var H=F.getContent();Q.append(H);this.sessionObject.previewPage.paramStatsModel=U;if(typeof this.sessionObject!=="undefined"&&typeof this.sessionObject.previewPage!=="undefined"){this.sessionObject.previewPage.paramStatsInnerContentDiv=Q;this.sessionObject.previewPage.paramStatsShown="all";J.value=this.sessionObject.previewPage.paramStatsShown}J.addEventListener("change",function(){this.sessionObject.previewPage.paramStatsShown=J.value;this.sessionObject.previewPage.paramStatsModel.filterParameterData("role",J.value)}.bind(this));return this};var z=function(F){var G=[];if(F.vargroups){for(var I=0;I<F.vargroups.length;I++){G=G.concat(z(F.vargroups[I]))}}for(var H=0;H<F.parameters.length;H++){if(F.parameters[H].role==="INPUT"){G.push(F.parameters[H])}}return G};var t=function(F,G){F.previewPage=F.previewPage||{};F.previewPage.create=t;F.previewPage.createAllPanels=function(){var I=h("#sim-ui-preview-containerDiv");var H=new E(I);H.addIndexedPanel("Simulation_Case",1,r,w.getPreviewData("CaseName"),F).addIndexedPanel("Background",2,s,undefined,F).addIndexedPanel("Simulation",3,c,i.translate("Data Sources"),F).addIndexedPanel("ParameterTable",5,l,i.translate("Parameter Summary"),F).addIndexedPanel("Methods",4,q,undefined,F).addIndexedPanel("ParameterStatistics",6,u,i.translate("Parameter Statistics"),F).renderPanel("ParameterTable").renderPanel("Simulation").renderPanel("Simulation_Case").renderPanel("Background").renderPanel("Methods").renderPanel("ParameterStatistics");F.previewPage.stateTracker=H;I.children("#Background").run(a.setIStateToHide);I.children("#Methods").run(a.setIStateToHide);I.children("#ParameterStatistics");F.previewPage.refreshEvents.parameterStatistics={parameterChanged:function(){if(F.previewPage.paramStatsModel){var J=w.getAllParameterObjectsAsFlatList();F.previewPage.paramStatsModel.updateRAParamTree(J);return}},dataSetChanged:function(){F.previewPage.stateTracker.rerenderPanel("ParameterStatistics")}};F.previewPage.refreshEvents.parameterSummary={parameterChanged:function(M,L){var N=M||L||{};if(N&&N.iaEventUISource&&N.iaEventUISource==="parameterTableInPreviewPage"){return}if(typeof F.previewPage.paramTable!=="undefined"){var K=F.previewPage.paramTable[0];if(K.children[0]!=="undefined"){var J=K.children[0];J.parameterChange(w.varGroup);J.hierarchyChanged(w.varGroup)}}F.previewPage.stateTracker.rerenderPanel("ParameterTable")},dataSetChanged:function(){if(typeof F.previewPage.paramTable!=="undefined"){var K=F.previewPage.paramTable[0];if(K.children[0]!=="undefined"){var J=K.children[0];J.hierarchyChanged(w.varGroup)}}F.previewPage.stateTracker.rerenderPanel("ParameterTable")}};F.previewPage.refreshEvents.parameterSummary.dataSetChanged=F.previewPage.refreshEvents.parameterSummary.parameterChanged;F.previewPage.refreshEvents.metaData={caseMetaDataChanged:function(){H.rerenderPanel("Simulation_Case");H.rerenderPanel("Background");H.rerenderPanel("Methods");var J=h("#sim-ui-preview-containerDiv");J.children("#Simulation").run(a.setIStateToHide);J.children("#Background").run(a.setIStateToHide);J.children("#Methods").run(a.setIStateToHide)}}};F.previewPage.refreshEvents=F.previewPage.refreshEvents||{};F.previewPage.fireRefreshEvents=function(K,J,I){var H;for(H in F.previewPage.refreshEvents){if(F.previewPage.refreshEvents.hasOwnProperty(H)){if(F.previewPage.refreshEvents[H][K]){F.previewPage.refreshEvents[H][K](J,I)}}}};F.previewPage.verify;F.previewPage.openScrapeUI=function(){var I=document.querySelector("#ParameterStatistics");if(I!==null){var H=function(){var J=F.previewPage.paramStatsModel.getChildren();var K=[];if(J instanceof Array){J.forEach(function(M){var N=new UWA.Element("div"),L=null;N.setAttribute("data-paramID",M.options.grid.id);if(M.options.grid.dataType==="STRING"){L=y.prototype._drawStringChart.call(y.prototype,M.options.grid,undefined,undefined,N,true)}else{L=y.prototype._setupNumericChart.call(y.prototype,M.options.grid,N)}if(L){K.push(L[0][0])}},this)}return K};F.previewPage.svgScraper.prepContainer(I,"paramstats",{svgtype:"paramstats",collectAll:true,getSVGFunction:H,noComment:false})}F.previewPage.svgScraper.openScrapeUI()};F.previewPage.entering=function(){var I=F.previewPage.element.attr("data-loaded");if(!I){F.previewPage.createAllPanels();h("#"+G).attr("data-loaded",true)}if(typeof F.previewPage.svgScraper==="undefined"){F.previewPage.svgScraper=new v(F.previewPage.element)}var H=F.previewPage.element[0].querySelector('[data-icon="copyto"]');if(H!==null){H.onclick=F.previewPage.openScrapeUI}};F.previewPage.formulationChanged=function(){};F.previewPage.parameterChanged=function(I,H){if(typeof H!=="undefined"){F.previewPage.fireRefreshEvents("parameterChanged",I,H)}else{F.previewPage.fireRefreshEvents("parameterChanged",I)}};F.previewPage.caseMetaDataChanged=function(I,H){if(I&&I.iaEventUISource&&I.iaEventUISource==="parameterTableInPreviewPage"){return}if(H&&H.iaEventUISource&&H.iaEventUISource==="parameterTableInPreviewPage"){return}if(typeof H!=="undefined"){F.previewPage.fireRefreshEvents("caseMetaDataChanged",I,H)}else{F.previewPage.fireRefreshEvents("caseMetaDataChanged",I)}};F.previewPage.resizePage=function(){var H=F.previewPage.paramTable[0].children[0];if(H!==null){H.resize()}};F.previewPage.dataSetChanged=function(I,H){if(typeof H!=="undefined"){F.previewPage.fireRefreshEvents("dataSetChanged",I,H)}else{F.previewPage.fireRefreshEvents("dataSetChanged",I)}};F.previewPage.postRender=function(){var I=w.getAllParameterObjectsAsFlatList().length;if(I>50){I=50}h("#sim-ui-preview-paramTable").css("min-height",I*25+80);var H=F.previewPage.paramTable[0].children[0];if(H!==null){H.resize()}};F.previewPage.formulationLockChanged=function(){};F.previewPage.element=h("#"+G);F.previewPage.element.advisePage({controlPanelId:"",contentPanelId:"previewpageContentPanel",entering:F.previewPage.entering,postRender:F.previewPage.postRender,formulationChanged:F.previewPage.formulationChanged,parameterChanged:F.previewPage.parameterChanged,resize:F.previewPage.resizePage,caseMetaDataChanged:F.previewPage.caseMetaDataChanged,dataSetChanged:F.previewPage.dataSetChanged,hierarchyChanged:F.previewPage.dataSetChanged,formulationLockChanged:F.previewPage.formulationLockChanged}).hide()};return t});define("DS/SMAAnalyticsUI/SMAAnalyticsComponentScatterGrid",["DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsPopover"],function(a,b,c){var d=0.05;function e(){var p=Object.create(HTMLElement.prototype);p.createdCallback=function(){this.scale=d3.scale.linear();this.dimensions={}};p.setParameter=function(q){this.parameter=q;this.scale.domain([q.min,q.max])};var i=Object.create(p);var f=Object.create(p);f.createdCallback=function(){p.createdCallback.call(this);this.svgs={};this.divs={};this.dimensions.width=60};i.createdCallback=function(){p.createdCallback.call(this);this.svgs={};this.divs={};this.dimensions={height:20,width:100}};i.setWidth=function(q){this.dimensions.width=q;d3.select(this).style({width:q+"px"})};i.render=function(){this.scale.range([0,this.dimensions.width]);var q=40;Math.log10=Math.log10||function(w){return Math.log(w)*Math.LOG10E};var s=function(w){return b.formatExp(w,2)};var t=Math.log10(this.parameter.max-this.parameter.min);var u=this.parameter.min===0?0:Math.log10(this.parameter.min);var r=this.parameter.max===0?0:Math.log10(this.parameter.max);if(t<0){var v=8*(Math.ceil(Math.abs(t))+3);if(v>q){q=v}}else{if(u>3){var v=8*(Math.ceil(Math.abs(u))+2);if(v>q){q=v}}else{if(r>3){var v=8*(Math.ceil(Math.abs(r))+2);if(v>q){q=v}}}}this.svgs.root=d3.select(this).append("svg").attr("width",this.dimensions.width+"px").attr("height",this.dimensions.height+"px");this.axis=d3.svg.axis().scale(this.scale).orient("bottom").tickFormat(s).ticks(Math.floor(this.dimensions.width/q));this.svgs.axis=this.svgs.root.append("g").attr("class","ra-scatter-axis ra-scatter-xAxis").call(this.axis)};f.render=function(){this.scale.range([this.dimensions.height,0]);var q=function(s){return b.formatExp(s,2)};var r=this.dimensions.width+11;this.svgs.root=d3.select(this).append("svg").attr("width",r+"px").attr("height",this.dimensions.height+"px");this.axis=d3.svg.axis().scale(this.scale).orient("left").tickFormat(q).ticks(Math.floor(this.dimensions.height/20));this.svgs.axis=this.svgs.root.append("g").attr("class","ra-scatter-axis ra-scatter-xAxis").attr("transform","translate("+r+",0)").call(this.axis);this.svgs.text=this.svgs.root.append("text").attr("text-anchor","middle").attr("x",-this.dimensions.height/2).attr("y",11).attr("transform","rotate(-90)").text(this.parameter.displayName)};f.setHeight=function(q){this.dimensions.height=q;d3.select(this).style({height:q})};var g=Object.create(HTMLElement.prototype);g.createdCallback=function(){this.paramName=function(q){return q.name};this.divs={plots:document.createElement("div"),xAxisPeripherals:document.createElement("div"),yAxisPeripherals:document.createElement("div")};this.appendChild(this.divs.xAxisPeripherals);this.appendChild(this.divs.yAxisPeripherals);this.appendChild(this.divs.plots);this.dimensions={xAxisPeripheralsHeight:50,yAxisPeripheralsWidth:100,totalWidth:this.offsetWidth,totalHeight:this.offsetHeight,rightPad:5};d3.select(this.divs.plots).style({position:"absolute",top:"0px",bottom:this.dimensions.xAxisPeripheralsHeight+"px",right:"0px",left:this.dimensions.yAxisPeripheralsWidth+"px"});d3.select(this.divs.xAxisPeripherals).style({position:"absolute",height:this.dimensions.xAxisPeripheralsHeight+"px",bottom:"0px",right:"0px",left:this.dimensions.yAxisPeripheralsWidth+"px"});d3.select(this.divs.yAxisPeripherals).style({position:"absolute",top:"0px",bottom:this.dimensions.xAxisPeripheralsHeight+"px",left:"0px",width:this.dimensions.yAxisPeripheralsWidth+"px"})};g.setParamName=function(q){this.paramName=q};g.updateDimensions=function(){};g.testCreate=function(){var q=[{name:"param1",id:"p1",min:0,max:10},{name:"param2",id:"p2",min:0,max:20},{name:"blarg",id:"b",min:-100,max:300}];this.setParameters(q);this.buildPeripherals();this.buildPlots()};g.setParameters=function(q){this.params=q;this.nParams=this.params.length};g.setActiveParameters=function(s){var q,r;this.activeParams=s.map(function(v){var w={};for(var u in v){if(v.hasOwnProperty(u)){w[u]=v[u]}}var t=v.max-v.min;if(t!==0){w.min=v.min-t*d;w.max=v.max+t*d}else{if(v.min!==0){q=v.min;r=Math.abs(q*d);w.min=q-r;w.max=q+r}else{w.min=-1;w.max=1}}return w});this.nActiveParams=s.length};g.setDropdownCallback=function(q){this.dropdownCallback=q};g.buildPeripherals=function(){var x=this;var q,w;var r=Math.floor((this.divs.xAxisPeripherals.offsetWidth-this.dimensions.rightPad-20)/this.nActiveParams);this.dimensions.divWidth=r;var s=Math.floor(this.divs.yAxisPeripherals.offsetHeight/this.nActiveParams);this.dimensions.divHeight=s;d3.select(this.divs.xAxisPeripherals).selectAll(".scatterGridPeripheralDiv").remove();this.divs.xAxisPeripheralDivs=d3.select(this.divs.xAxisPeripherals).selectAll(".scatterGridPeripheralDiv").data(this.activeParams).enter().append("div").classed("scatterGridPeripheralDiv",true).style({display:"inline-block",width:r+"px"});var u;var t={};for(u=0;u<this.activeParams.length;u++){t[this.activeParams[u].ID]=true}var v=this.params.filter(function(y){if(t[y.ID]===true){return false}return true});this.divs.xAxisPeripheralDivs.each(function(F,E){var A=document.createElement("ra-xAxis");this.appendChild(A);A.setParameter(F);A.setWidth(r);A.render();var B=document.createElement("select");var C,z,G;var D=[F].concat(v);for(C=0;C<D.length;C++){G=D[C];z=document.createElement("option");z.value=G.ID;if(G.ID===F.ID){z.selected=true}z.textContent=G.displayName;B.appendChild(z)}var y=document.createElement("div");y.classList.add("scatterGrid-selectDiv");y.setAttribute("style","text-align : center");y.appendChild(B);this.appendChild(y);B.addEventListener("change",function(H){if(typeof x.dropdownCallback==="function"){x.dropdownCallback(E,B.value)}})});d3.select(this.divs.yAxisPeripherals).selectAll(".scatterGridPeripheralDiv").remove();this.divs.yAxisPeripheralDivs=d3.select(this.divs.yAxisPeripherals).selectAll(".scatterGridPeripheralDiv").data(this.activeParams).enter().append("div").classed("scatterGridPeripheralDiv",true).style({height:s+"px"});this.divs.yAxisPeripheralDivs.each(function(z){var y=document.createElement("ra-yAxis");d3.select(y).style({position:"absolute",right:"0px"});this.appendChild(y);y.setParameter(z);y.setHeight(s);y.render()})};g.setupPlots=function(q,r){r()};g.refreshPlots=function(r,q){Array.prototype.forEach.call(this.divs.plots.children,function(s){if(s.tagName==="RA-SCATTERTILE"){if(q){s.selectionRequest=true}s.refresh()}})};g.addRectangleContextHandler=function(q){this.rectangleContextHandler=q};g.getPlotRequests=function(){var q=Array.prototype.map.call(this.getElementsByTagName("ra-scatterTile"),function(r){return r.getRequestData()});return q};g.setSetupPlots=function(q){this.setupPlots=q};g.buildPlots=function(){var t=this;d3.select(this.divs.plots).selectAll("ra-histogramTile").remove();d3.select(this.divs.plots).selectAll("ra-scatterTile").remove();var u=[];var w=[];var r,q,v,s;for(r=0;r<this.nActiveParams;r++){for(q=0;q<this.nActiveParams;q++){if(r===q){v={param:this.activeParams[r]};s=document.createElement("ra-histogramTile")}else{v={xParam:this.activeParams[r],yParam:this.activeParams[q]};s=document.createElement("ra-scatterTile");if(typeof this.getScatterGridTile!=="undefined"){s.setGetExternalImage(this.getScatterGridTile)}if(typeof this.getContourPlotTile==="function"){s.setGetContourPlotTile(this.getContourPlotTile)}if(typeof this.rectangleContextHandler==="function"){s.addRectangleContextHandler(this.rectangleContextHandler)}if(typeof this.clickCallback==="function"){s.addClickCallback(this.clickCallback)}if(typeof this.rectangleSelectCallback==="function"){s.addRectangleSelectCallback(this.rectangleSelectCallback)}s.initializeInfoBalloon()}s.setData(v);s.setWidth(this.dimensions.divWidth);s.setHeight(this.dimensions.divHeight);d3.select(s).style({position:"absolute",left:r*this.dimensions.divWidth+"px",top:q*this.dimensions.divHeight+"px"});this.divs.plots.appendChild(s)}}this.renderHistograms();if(typeof this.setupPlots==="function"){this.setupPlots(this.getPlotRequests(),function(x){t.renderPlots()})}else{this.renderPlots()}if(this.zoomed){this.singleScatter.refreshSingleScatter()}};g.renderPlots=function(){Array.prototype.forEach.call(this.getElementsByTagName("ra-scattertile"),function(q){q.render()})};g.renderHistograms=function(){Array.prototype.forEach.call(this.getElementsByTagName("ra-histogramtile"),function(q){q.render()})};g.setGetScatterGridTile=function(q){this.getScatterGridTile=q};g.setGetContourPlotTile=function(q){this.getContourPlotTile=q};g.getTileCallback=function(q){if(typeof q==="undefined"){return this.tileCallback()}this.tileCallback=q};g.addRectangleSelectCallback=function(q){Array.prototype.forEach.call(this.divs.plots.children,function(r){if(r.tagName==="RA-SCATTERTILE"){r.addRectangleSelectCallback(q)}});this.rectangleSelectCallback=q};g.addClickCallback=function(q){Array.prototype.forEach.call(this.divs.plots.children,function(r){if(r.tagName==="RA-SCATTERTILE"){r.addClickCallback(q)}});this.clickCallback=q};g.addCrosshairs=function(q){Array.prototype.forEach.call(this.divs.plots.children,function(r){if(r.tagName==="RA-SCATTERTILE"){r.addSelectionCrosshairs(q[r.xParam.ID],q[r.yParam.ID])}})};g.zoomSingleScatter=function(B,r){try{document.getElementById("scatterViewMVP").style.overflow="hidden"}catch(t){}var y=this;this.zoomed=true;var A=25;var v=document.createElement("div");d3.select(v).style({position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"});var u=document.createElement("div");d3.select(u).style({position:"absolute",top:"0px",height:A+"px",left:"0px",right:"0px",background:"#555"});var w=$simjq('<div class="sim-ui-singleScatter-close ui-icon ui-icon-closethick">').appendTo(u);u.addEventListener("click",function(){y.exitSingleScatter()});var D=document.createElement("div");d3.select(D).style({position:"absolute",bottom:"0px",top:A+"px",left:"0px",right:"0px",background:"#fff"});var q=function(E){if(E.keyCode==27){y.exitSingleScatter();window.removeEventListener("keyup",q)}};window.addEventListener("keyup",q);var x=document.createElement("div");x.classList.add("ra-scatterXAxisTitle");d3.select(x).style({height:A+"px",});var C=document.createElement("div");C.classList.add("ra-scatterYAxisTitle");d3.select(C).style({width:A+"px",});var s=document.createElement("div");s.classList.add("ra-scatterYAxisTitleText");d3.select(s).style({width:this.offsetHeight+"px",transform:"rotate(-90deg) translate(-"+((this.offsetHeight-A)/2)+"px, -"+((this.offsetHeight-A)/2)+"px)"});C.appendChild(s);x.innerHTML=B.displayName||B.name;s.innerHTML=r.displayName||r.name;var z=document.createElement("ra-singleScatterPlot");z.style.position="absolute";z.style.left=A+"px";this.singleScatter=z;z.setHeight(this.offsetHeight-2*A);z.setWidth(this.offsetWidth-A);z.setTileGenerator(this.getScatterGridTile);z.setSetupPlots(this.setupPlots);if(typeof this.getContourPlotTile==="function"){z.setGetContourPlotTile(this.getContourPlotTile)}z.setXParameter(B);z.setYParameter(r);z.initialize({x:false,y:false});z.setClickCallback(function(E,F){proxy.getNearestPlotPoint(E,F)});this.divs.singleScatterContainer=v;v.appendChild(u);v.appendChild(D);D.appendChild(x);D.appendChild(C);D.appendChild(z);this.appendChild(v)};g.clearSelections=function(q){Array.prototype.forEach.call(this.divs.plots.children,function(r){if(r.tagName==="RA-SCATTERTILE"){r.clearSelections(q)}})};g.addInfoBalloon=function(s,r,q){Array.prototype.forEach.call(this.divs.plots.children,function(t){if(t.tagName==="RA-SCATTERTILE"&&t.xParam.ID===s&&t.yParam.ID===r){t.addInfoBalloon(q)}})};g.exitSingleScatter=function(){this.zoomed=false;if(typeof this.divs.singleScatterContainer!=="undefined"){this.removeChild(this.divs.singleScatterContainer);delete this.divs.singleScatterContainer}try{document.getElementById("scatterViewMVP").style.overflow="auto"}catch(q){}};var l=Object.create(HTMLElement.prototype);l.createdCallback=function(){this.dimensions={};this.scales={x:d3.scale.linear(),y:d3.scale.linear()};this.rootSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");this.appendChild(this.rootSvg);this.tileId="tile"+Math.random();this.tileId=this.tileId.replace(",","")};l.setHeight=function(q){this.dimensions.height=q;d3.select(this.rootSvg).style("height",q+"px")};l.setWidth=function(q){this.dimensions.width=q;d3.select(this.rootSvg).style("width",q+"px")};l.setTileSource=function(q){};l.getScatterGridParent=function(){var q=this.parentNode;while(typeof q==="object"&&q.tagName!=="BODY"){if(q.tagName==="RA-SCATTERGRID"){return q}else{q=q.parentNode}}};l.addSpinner=function(){var q=document.createElement("div");var r=document.createElement("div");r.classList.add("loading");q.appendChild(r);d3.select(q).style({background:"black",opacity:0.3,position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"});this.appendChild(q);this.spinnerDiv=q};l.removeSpinner=function(){if(typeof this.spinnerDiv==="object"){this.removeChild(this.spinnerDiv);delete this.spinnerDiv}};var j=Object.create(l);j.createdCallback=function(){l.createdCallback.call(this);this.xParam={};this.yParam={};this.addEventListeners()};j.setData=function(q){this.xParam=q.xParam;this.yParam=q.yParam;this.scales.x.domain([this.xParam.min,this.xParam.max]);this.scales.y.domain([this.yParam.min,this.yParam.max])};j.setGetContourPlotTile=function(q){if(sessionInfo.shopPage.contoursChecked){this.contours=true}this.getContourPlotTile=q};j.addEventListeners=function(){this.doubleClickHandler=this.zoomToSingle;this.addRectangleSelect()};j.zoomToSingle=function(){this.parentNode.parentNode.zoomSingleScatter(this.xParam,this.yParam)};var m=function(q,s){var r=document.createElementNS("http://www.w3.org/2000/svg","rect");d3.select(r).attr("x",0).attr("y",0).attr("height",q.imgHeight).attr("width",q.imgWidth).style({stroke:"forestgreen","stroke-width":"2px",fill:"none"});s(r)};var k=function(q,s){var r=document.createElementNS("http://www.w3.org/2000/svg","rect");d3.select(r).attr("x",0).attr("y",0).attr("height",q.imgHeight).attr("width",q.imgWidth).style({stroke:"red","stroke-width":"2px",fill:"none"});s(r)};j.setGetExternalImage=function(q){this.getExternalImage=q};j.getRequestData=function(){var s={xParam:this.xParam.ID,yParam:this.yParam.ID,xMin:this.xParam.min,xMax:this.xParam.max,yMin:this.yParam.min,yMax:this.yParam.max,imgHeight:Math.abs(this.dimensions.height),imgWidth:Math.abs(this.dimensions.width),randomNum:Math.random()};var t=proxy.findParameter(this.xParam.ID);var r=proxy.findParameter(this.yParam.ID);if(t&&r){if(t.visibleDataMin&&typeof t.visibleDataMin==="number"){s.xMin=t.visibleDataMin}if(r.visibleDataMin&&typeof r.visibleDataMin==="number"){s.yMin=r.visibleDataMin}if(t.visibleDataMax&&typeof t.visibleDataMax==="number"){s.xMax=t.visibleDataMax}if(r.visibleDataMax&&typeof r.visibleDataMax==="number"){s.yMax=r.visibleDataMax}var q=s.xMax-s.xMin;if(q>0){s.xMin=s.xMin-d*q;s.xMax=s.xMax+d*q}var u=s.yMax-s.yMin;if(u>0){s.yMin=s.yMin-d*u;s.yMax=s.yMax+d*u}}return s};j.getScatterImage=function(t,s){var q;var r=this.getRequestData();this.getExternalImage(r,t,s)};j.getContours=function(s,r){var q=this.getRequestData();this.getContourPlotTile(q,s,r)};j.refresh=function(q){d3.select(this.rootSvg).selectAll(".scatterTileContentGroup").remove();d3.select(this.rootSvg).selectAll(".scatterTileBorder").remove();this.render()};j.render=function(){this.scales.x.range([0,this.dimensions.width]);this.scales.y.range([this.dimensions.height,0]);var u=this;var x=false;var A;var t=d3.select(u.rootSvg).append("line").classed("scatterTileBorder right",true);t.attr("x1",this.dimensions.width);t.attr("x2",this.dimensions.width);t.attr("y1",0);t.attr("y2",this.dimensions.height);var r=d3.select(u.rootSvg).append("line").classed("scatterTileBorder bottom",true);r.attr("x1",0);r.attr("x2",this.dimensions.width);r.attr("y1",this.dimensions.height);r.attr("y2",this.dimensions.height);var y=d3.select(u.rootSvg).append("g").classed("scatterTileContentGroup",true);var s=1,B=0;var v=function(){B+=1;if(s===B){u.removeSpinner()}};var w=function(C){if(C.complete){v()}else{C.addEventListener("load",v);C.addEventListener("error",v)}};var q=function(C){y.node().appendChild(C);A=C;x=true;y.call(u.selector)};var z=function(C){y.node().appendChild(C);if(x){y.node().appendChild(A)}};this.addSpinner();if(this.contours){s+=1;this.getContours(z,v)}this.getScatterImage(q,v);this.selectionRequest=false};j.brushStart=function(q){};j.brushEnd=function(q){};j.initializeInfoBalloon=function(w){var r=d3.select(this.rootSvg).append("defs");var v="#DDDDDD",t="#BBBBBB";r.append("pattern").attr("id","basketPattern").attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/basket_small.png");r.append("pattern").attr("id","basketRemovePattern").attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/basket_remove.png");r.append("pattern").attr("id","infoPattern").attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/moreinfo.png");var q=d3.select(this.rootSvg).append("svg:defs"),s=q.append("svg:linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%").attr("id","moreInfoGradient");s.append("svg:stop").attr("offset","0%").attr("stop-color",t).attr("stop-opacity",1);s.append("svg:stop").attr("offset","100%").attr("stop-color",v).attr("stop-opacity",1);var u=q.append("filter").attr("height","130%").attr("id","moreInfoShadow");u.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1);u.append("feOffset").attr("dx",2).attr("dy",2).attr("result","offsetblur");u.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope","0.4");var x=u.append("feMerge");x.append("feMergeNode");x.append("feMergeNode").attr("in","SourceGraphic");this.defs=r};j.removeInfoBalloon=function(){d3.select(this).selectAll(".sim-ui-scatterMVP-moreInfo").remove()};j.addInfoBalloon=function(z){var F=z[this.xParam.ID],D=z[this.yParam.ID];this.removeInfoBalloon();var Q=d3.select(this.rootSvg).append("g").classed("sim-ui-scatterMVP-moreInfo",true);var q=160,O=36,H=10,u=10,N=16,T="up",v="#BBBBBB",U=3;var P=this.scales.y(D)+u+U+1,R=this.scales.x(F)-q/2,B=[{x:this.scales.x(F),y:this.scales.y(D)+U+1},{x:this.scales.x(F)-8,y:this.scales.y(D)+u+U+2},{x:this.scales.x(F)+8,y:this.scales.y(D)+u+U+2}];var G=d3.svg.line().x(function(x){return x.x}).y(function(x){return x.y}).interpolate("linear");if(O+P>d3.max(this.scales.y.range())){B[0].y-=2*(U+1);B[1].y-=2*(u+U+2);B[2].y-=2*(u+U+2);P=this.scales.y(D)-1-u-U-O;v="#DDDDDD"}if(R<d3.min(this.scales.x.range())){R=d3.min(this.scales.x.range());if(B[1].x<R+10){B[1].x=R+10;B[2].x=R+10+N}}else{if(R+q>d3.max(this.scales.x.range())){R=d3.max(this.scales.x.range())-q;if(B[2].x>R+q-10){B[1].x=R+q-10-N;B[2].x=R+q-10}}}Q.append("rect").classed("sim-ui-scatterMVP-moreInfo-backRect",true).attr("x",R).attr("y",P).attr("width",q).attr("height",O).attr("rx",H).attr("ry",H).style("fill","url(#moreInfoGradient)").style("filter","url(#moreInfoShadow)");var r=G(B);Q.append("path").attr("d",r+"Z").classed("sim-ui-scatterMVP-moreInfo-backTri",true).style("fill",v);Q.append("text").text(a.translate("Alt."," ")+z.rowid).classed("sim-ui-scatterMVP-moreInfo-text",true).attr("text-anchor","left").attr("x",R+5).attr("y",P+24);var E=24,S=24,M=R+q-S-5,K=P+5,t=10;var C=24,J=24,A=R+q-J-S-10,w=P+5,s=10;var L=Q.append("g").classed("sim-ui-scatterMVP-moreInfo-infoButton",true).on("click",function(){c.makeParamPopover(z.rowid);d3.event.stopPropagation()});L.append("rect").classed("sim-ui-scatterMVP-moreInfo-infoButton-back",true).attr("x",M).attr("y",K).attr("width",S).attr("height",E).attr("rx",t).attr("ry",t).attr("fill","url(#infoPattern)");var I=Q.append("g").classed("sim-ui-scatterMVP-moreInfo-basketButton",true).on("click",function(){if(proxy.isInBasket(Number(z.rowid))===-1){proxy.addToBasket(z.rowid);d3.select(this).select(".sim-ui-scatterMVP-moreInfo-basketButton-back").attr("fill","url(#basketRemovePattern)")}else{proxy.removeFromBasket(z.rowid);d3.select(this).select(".sim-ui-scatterMVP-moreInfo-basketButton-back").attr("fill","url(#basketPattern)")}});I.append("rect").classed("sim-ui-scatterMVP-moreInfo-basketButton-back",true).attr("x",A).attr("y",w).attr("width",J).attr("height",C).attr("rx",s).attr("ry",s).attr("fill",function(){if(proxy.isInBasket(Number(z.rowid))===-1){return"url(#basketPattern)"}else{return"url(#basketRemovePattern)"}})};j.addRectangleSelectCallback=function(q){this.rectangleSelectCallback=q};j.clearSelections=function(q){if(q.source===this.tileId&&d3.event.sourceEvent.button===2){return}this.clearBrushSelection();this.clearSelectionLines();this.removeInfoBalloon()};j.clearBrushSelection=function(){this.selector.clear();d3.select(this.rootSvg).selectAll(".brush").call(this.selector)};j.clearSelectionLines=function(){d3.select(this.rootSvg).selectAll(".crosshairLine").remove()};j.addRectangleSelect=function(){var s=this;var q=d3.svg.brush().x(this.scales.x).y(this.scales.y);if(typeof this.lastClickTime==="undefined"){this.lastClickTime=0}var r=false;q.on("brushstart",function(v){var t=s.getScatterGridParent();t.clearSelections({source:s.tileId,clearSelf:false});s.brushStart(v);var u=Date.now();if(u-this.lastClickTime<500&&typeof s.doubleClickHandler==="function"){s.doubleClickHandler()}this.lastClickTime=u}).on("brush",function(t){}).on("brushend",function(x){var v=q.extent();var y,u;y=s.scales.x(v[0][0])-s.scales.x(v[1][0]);u=s.scales.y(v[0][1])-s.scales.y(v[1][1]);var t=y*y+u*u;var w={xParam:s.xParam.ID,yParam:s.yParam.ID,xMin:Math.min(v[0][0],v[1][0]),xMax:Math.max(v[0][0],v[1][0]),yMin:Math.min(v[0][1],v[1][1]),yMax:Math.max(v[0][1],v[1][1])};if(t<100&&typeof s.clickCallback==="function"){s.xParam.value=v[0][0];s.yParam.value=v[0][1];s.clickCallback(x)}else{if(typeof s.rectangleSelectCallback==="function"){s.rectangleSelectCallback(w)}}d3.select(this).selectAll(".extent").on("contextmenu",function(){if(typeof s.rectangleContextHandler==="function"){s.rectangleContextHandler(w);d3.event.stopPropagation();d3.event.preventDefault()}});s.brushEnd(x)});this.selector=q};j.setRectangleSelectCallback=function(){};j.addSingleSelect=function(){};j.addSingleSelectCallback=function(){};j.addClickCallback=function(q){var r=this;this.clickCallback=function(t){var s={xParam:r.xParam.ID,yParam:r.yParam.ID,xVal:r.xParam.value,yVal:r.yParam.value};q(s)}};j.addSelectionCrosshairs=function(q,t){this.clearSelectionLines();var r=d3.select(this.rootSvg).append("line").attr("x1",0).attr("x2",this.dimensions.width).attr("y1",this.scales.y(t)).attr("y2",this.scales.y(t)).classed("crosshairLine",true).style({stroke:"#555",fill:"none"});var s=d3.select(this.rootSvg).append("line").attr("x1",this.scales.x(q)).attr("x2",this.scales.x(q)).attr("y1",0).attr("y2",this.dimensions.height).classed("crosshairLine",true).style({stroke:"#555",fill:"none"})};j.addRectangleContextHandler=function(q){this.rectangleContextHandler=q};j.addContextHandler=function(q){this.contextHandler=q};var n=Object.create(l);n.setData=function(q){this.param=q.param};n.render=function(){var q=this;var r=function(s){q.rootSvg.appendChild(s)};this.buildSVGHistogram()};n.buildSVGHistogram=function(){var w=this;var z=18;var v=d3.select(w.rootSvg).append("line").classed("scatterTileBorder right",true);v.attr("x1",this.dimensions.width);v.attr("x2",this.dimensions.width);v.attr("y1",0);v.attr("y2",this.dimensions.height);this.scales.x.range([0,this.dimensions.width]);this.scales.x.domain([this.param.min,this.param.max]);this.scales.y.range([0,this.dimensions.height-z]);d3.select(this.rootSvg).append("rect").attr("x",0).attr("y",this.dimensions.height-z).attr("width",this.dimensions.width).attr("height",z).attr("text-anchor","middle").style({fill:"steelblue",stroke:"none"});d3.select(this.rootSvg).append("text").attr("x",this.dimensions.width/2).attr("y",this.dimensions.height-z+13).text(this.param.displayName).attr("text-anchor","middle").style({fill:"aliceblue"});var A=this.param.filteredHistogramValues||this.param.histogramValues,q=this.param.filteredInfeasibleHistogramValues||this.param.infeasibleHistogramValues,B=this.param.filteredParetoHistogramValues||this.param.paretoHistogramValues,y=this.param.excludedHistogramValues||[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var t=A.map(function(H,G){var F={dominated:A[G]-(q[G]+B[G]+y[G]),infeasible:q[G],pareto:B[G],excluded:y[G]||0};return F});var u=Math.max.apply(null,A);this.scales.y.domain([0,u]);var C=this.dimensions.width/1.1;var E=(this.dimensions.width-C)/2;var x=A.length,D=C/x,r=C/x;var s=w.dimensions.height-z;d3.select(this.rootSvg).selectAll(".histogramBars").data(t).enter().append("g").attr("transform",function(G,F){return("translate("+(F*r+E)+",0)")}).each(function(F){d3.select(this).append("rect").attr("width",D).attr("height",w.scales.y(F.infeasible)).attr("y",s-w.scales.y(F.infeasible)).attr("x",0).style({fill:"red",stroke:"#b20000"});d3.select(this).append("rect").attr("width",D).attr("height",w.scales.y(F.dominated)).attr("y",s-w.scales.y(F.infeasible+F.dominated)).attr("x",0).style({fill:"skyblue",stroke:"#5e90a4"});d3.select(this).append("rect").attr("width",D).attr("height",w.scales.y(F.pareto)).attr("y",s-w.scales.y(F.infeasible+F.dominated+F.pareto)).attr("x",0).style({fill:"#499F3F",stroke:"#336f2c"});d3.select(this).append("rect").attr("width",D).attr("height",w.scales.y(F.excluded)).attr("y",s-w.scales.y(F.infeasible+F.dominated+F.pareto+F.excluded)).attr("x",0).style({fill:"#CCC",stroke:"#AAA"})})};function h(q){this.rootDiv=q;this.svgs={};this.maxCalls=8;this.data={x:null,y:null};this.viewData={startBottom:null,startLeft:null};this.scales={};this.axes={};this.dimensions={totalHeight:400,totalWidth:600,graphPadding:10,xAxisHeight:20,yAxisWidth:40};this.dimensions.plotHeight=this.dimensions.totalHeight-(2*this.dimensions.graphPadding+this.dimensions.xAxisHeight);this.dimensions.plotWidth=this.dimensions.totalWidth-(2*this.dimensions.graphPadding+this.dimensions.yAxisWidth)}h.prototype.setWidth=function(q){this.dimensions.totalWidth=q;this.dimensions.plotWidth=this.dimensions.totalWidth-(2*this.dimensions.graphPadding+this.dimensions.yAxisWidth)};h.prototype.setHeight=function(q){this.dimensions.totalHeight=q;this.dimensions.plotHeight=this.dimensions.totalHeight-(2*this.dimensions.graphPadding+this.dimensions.xAxisHeight)};h.prototype.getTile=function(q,r){this.tileGenerator(q,r)};h.prototype.initialize=function(q){this.svgs.root=d3.select(this.rootDiv).append("svg").style({width:this.dimensions.totalWidth+"px",height:this.dimensions.totalHeight+"px"});this.svgs.clipPath=this.svgs.root.append("svg:clipPath").attr("id","clip").append("svg:rect").attr("x",this.dimensions.graphPadding+this.dimensions.yAxisWidth).attr("y",this.dimensions.graphPadding).attr("width",this.dimensions.plotWidth).attr("height",this.dimensions.plotHeight);this.svgs.imageGroup=this.svgs.root.append("g").attr("clip-path",function(){return"url(#clip)"});this.svgs.selectGroup=this.svgs.root.append("g").attr("transform","translate("+(this.dimensions.graphPadding+this.dimensions.yAxisWidth)+","+this.dimensions.graphPadding+")");this.initializeScales(q);this.buildAxes();this.initializeZooming();this.updatePlot()};h.testSingleClick=function(){return false};h.prototype.zoom=function(){if(this.testSingleClick){return}this.updateAbsScales();this.updateViewData();this.updateAxes();this.updatePlot();if(this.selectedPoint){this.singleSelect(this.selectedPoint)}};h.prototype.initializeZooming=function(){var t=Date.now();var u=this;var s=d3.behavior.zoom().x(this.scales.x).y(this.scales.y).scaleExtent([1,16]).on("zoom",function(){var v=Date.now()-t;if(v>500){u.zoom()}});var r,q;this.svgs.imageGroup.attr("pointer-events","all").on("mousedown",function(v){r=d3.event.clientX;q=d3.event.clientY}).on("mouseup",function(y){var D=d3.event.clientX,C=d3.event.clientY;var A=Math.pow(u.scales.x(D)-u.scales.x(r),2),x=Math.pow(u.scales.y(C)-u.scales.y(q),2);if(A+x<100){if(typeof u.clickCallback==="function"){var E=u.dimensions.yAxisWidth+u.dimensions.graphPadding,z=u.dimensions.graphPadding;var B=d3.mouse(u.svgs.root.node());var w=B[0],v=B[1];u.clickCallback({xParam:u.xParam.ID,yParam:u.yParam.ID,xVal:u.scales.x.invert(w-E),yVal:u.scales.y.invert(v-z)},function(F){u.singleSelect(F)})}}});this.svgs.root.call(s)};h.prototype.setXParameter=function(q){this.xParam=q;this.data.x=q;this.viewData.totalXRange=Math.abs(this.data.x.max-this.data.x.min);this.viewData.visibleXRange=Math.abs(this.data.x.max-this.data.x.min);this.viewData.startLeft=this.data.x.min};h.prototype.setYParameter=function(q){this.yParam=q;this.data.y=q;this.viewData.totalYRange=Math.abs(this.data.y.max-this.data.y.min);this.viewData.visibleYRange=Math.abs(this.data.y.max-this.data.y.min);this.viewData.startBottom=this.data.y.min};h.prototype.initializeScales=function(s){var q=this.data.x,r=this.data.y;if(s&&s.x&&!(q.min<=0&&0<=q.max)){this.scales.x=d3.scale.log().domain([q.min,q.max]).range([0,this.dimensions.plotWidth]);this.scales.xAbs=d3.scale.log().domain([0,q.max-q.min]).range(this.scales.x.range())}else{this.scales.x=d3.scale.linear().domain([q.min,q.max]).range([0,this.dimensions.plotWidth]);this.scales.xAbs=d3.scale.linear().domain([0,q.max-q.min]).range(this.scales.x.range())}if(s&&s.y&&!(r.min<=0&&0<=r.max)){this.scales.y=d3.scale.log().domain([r.min,r.max]).range([this.dimensions.plotHeight,0]);this.scales.yAbs=d3.scale.log().domain([0,r.max-r.min]).range([0,this.dimensions.plotHeight])}else{this.scales.y=d3.scale.linear().domain([r.min,r.max]).range([this.dimensions.plotHeight,0]);this.scales.yAbs=d3.scale.linear().domain([0,r.max-r.min]).range([0,this.dimensions.plotHeight])}this.initializeInfoBalloon()};h.prototype.updateAbsScales=function(){var q=this.scales.x.domain(),r=this.scales.y.domain();this.scales.xAbs.domain([0,q[1]-q[0]]);this.scales.yAbs.domain([0,r[1]-r[0]])};h.prototype.updateViewData=function(){this.viewData.visibleXRange=this.scales.xAbs.domain()[1];this.viewData.visibleYRange=this.scales.yAbs.domain()[1];this.viewData.startBottom=this.scales.y.domain()[0];this.viewData.startLeft=this.scales.x.domain()[0]};h.prototype.buildAxes=function(){this.axes.x=d3.svg.axis().scale(this.scales.x).orient("bottom").ticks(10);this.axes.y=d3.svg.axis().scale(this.scales.y).orient("left").ticks(10);this.svgs.xAxis=this.svgs.root.append("g").attr("class","ra-singleScatter-axis ra-singleScatter-xAxis").attr("transform","translate("+(this.dimensions.yAxisWidth+this.dimensions.graphPadding)+","+(this.dimensions.graphPadding+this.dimensions.plotHeight)+")");this.svgs.yAxis=this.svgs.root.append("g").attr("class","ra-singleScatter-axis ra-singleScatter-yAxis").attr("transform","translate("+(this.dimensions.yAxisWidth+this.dimensions.graphPadding)+","+this.dimensions.graphPadding+")");this.updateAxes()};h.prototype.updateAxes=function(){this.axes.x.ticks(Math.floor(this.dimensions.totalWidth/50));this.axes.y.ticks(Math.floor(this.dimensions.totalHeight/20));this.svgs.xAxis.call(this.axes.x);this.svgs.yAxis.call(this.axes.y)};h.prototype.setTileGenerator=function(q){this.tileGenerator=q};h.prototype.setGetContourPlotTile=function(q){if(sessionInfo.shopPage.contoursChecked){this.contours=true}this.getContourPlotTile=q};h.prototype.setClickCallback=function(q){this.clickCallback=q};h.prototype.refreshSingleScatter=function(){this.updatePlot({updateAllTiles:true})};h.prototype.updatePlot=function(s){var u=this;var E=Math.floor(Math.log(this.viewData.totalXRange/this.viewData.visibleXRange)/Math.log(2));E=Math.max(0,E);var x=[],t=[];var z=function(J){return J>=0&&J<=Math.pow(2,E+1)-1};var G=this.data.x.min;var q=this.data.y.min;var r=this.viewData.totalYRange*Math.pow(2,-(E+1));var C=Math.ceil((this.viewData.startBottom-q)/r);var x=[C-1,C,C+1];x=x.filter(z);x=x.map(function(J){return{rowNumber:J,key:"zf"+E+"d"+J}});var H=this.viewData.totalXRange*Math.pow(2,-(E+1));var A=Math.floor((this.viewData.startLeft-G)/H)+1;var D=[A-1,A,A+1];D=D.filter(z);var y=this.svgs.imageGroup.selectAll(".ra-singleScatter-imageRow").data(x,function(J){return J.key});y.exit().remove();var F=y.enter().append("g").classed("ra-singleScatter-imageRow",true).attr("transform","translate("+(u.dimensions.yAxisWidth+u.dimensions.graphPadding)+","+u.dimensions.graphPadding+")");var v=10;var B=[],w=[];y.each(function(L){var J=L.rowNumber;var M=D.map(function(W){var T=r*(J+1)+q,Q=r*J+q,S=H*W+G,V=H*(W+1)+G;var P=V-S,R=T-Q;var X=v*P/u.dimensions.plotWidth,U=v*R/u.dimensions.plotHeight;return{index:W,xParam:u.data.x.ID,yParam:u.data.y.ID,yMin:Q-U,yMax:T+U,xMin:S-X,xMax:V+X,imgHeight:u.dimensions.plotHeight+v*2,imgWidth:u.dimensions.plotWidth+v*2,randomNum:Math.random()}});var K=d3.select(this).selectAll(".ra-singleScatter-tile").data(M,function(P){return P.index});var O=K.enter().append("g").classed("ra-singleScatter-tile",true);O.each(function(S){var P=this;var R="clip"+Math.random();R=R.replace(".","");S.clipId=R;var Q=d3.select(P).append("svg:clipPath").attr("id",R).append("svg:rect").attr("x",0).attr("y",0).attr("width",u.dimensions.plotWidth).attr("height",u.dimensions.plotHeight)});var N=function(Q){var P=this;if(u.contours){u.getContourPlotTile(Q,function(R){d3.select(P).selectAll(".singleScatterGrid-contourTile").remove();d3.select(R).attr("pointer-events","all").attr("x",-v).attr("y",-v).attr("height",u.dimensions.plotHeight+v*2).attr("width",u.dimensions.plotWidth+v*2).attr("clip-path","url(#"+Q.clipId+")").classed("singleScatterGrid-contourTile",true);P.appendChild(R)})}u.getTile(Q,function(R){d3.select(P).selectAll(".singleScatterGrid-scatterTile").remove();d3.select(R).attr("x",-v).attr("y",-v).attr("height",u.dimensions.plotHeight+v*2).attr("width",u.dimensions.plotWidth+v*2).attr("clip-path","url(#"+Q.clipId+")").classed("singleScatterGrid-scatterTile",true);P.appendChild(R)})};if(s&&s.updateAllTiles===true){K.each(function(Q){var P=this;B.push(Q);w.push(function(){N.call(P,Q)})})}else{O.each(function(Q){var P=this;B.push(Q);w.push(function(){N.call(P,Q)})})}K.attr("transform",function(S){var P=u.scales.yAbs(r),T=u.scales.xAbs(H),R=u.scales.x(H*S.index+u.data.x.min),Q=u.scales.y(r*J+u.data.y.min)-P;return("translate("+R+","+Q+") scale("+T/u.dimensions.plotWidth+","+P/u.dimensions.plotHeight+")")});K.exit().remove()});var I=function(){w.forEach(function(J){J()})};this.setupPlots(B,I)};h.prototype.singleSelect=function(r){this.selectedPoint=r;var q=r[this.xParam.ID],s=r[this.yParam.ID];this.addSelectionCrosshairs(q,s);this.addInfoBalloon(r)};h.prototype.addSelectionCrosshairs=function(q,t){this.svgs.selectGroup.selectAll(".crosshairLine").remove();var r=this.svgs.selectGroup.append("line").attr("x1",0).attr("x2",this.dimensions.plotWidth).attr("y1",this.scales.y(t)).attr("y2",this.scales.y(t)).classed("crosshairLine",true).style({stroke:"#555",fill:"none"});var s=this.svgs.selectGroup.append("line").attr("x1",this.scales.x(q)).attr("x2",this.scales.x(q)).attr("y1",0).attr("y2",this.dimensions.plotHeight).classed("crosshairLine",true).style({stroke:"#555",fill:"none"})};h.prototype.initializeInfoBalloon=function(){};h.prototype.addInfoBalloon=function(z){var F=z[this.xParam.ID],D=z[this.yParam.ID];this.svgs.selectGroup.selectAll(".sim-ui-scatterMVP-moreInfo").remove();var R=this.svgs.selectGroup.append("g").classed("sim-ui-scatterMVP-moreInfo",true);var q=160,P=36,H=10,u=10,O=16,U="up",v="#BBBBBB",V=3;var Q=this.scales.y(D)+u+V+1,S=this.scales.x(F)-q/2,B=[{x:this.scales.x(F),y:this.scales.y(D)+V+1},{x:this.scales.x(F)-8,y:this.scales.y(D)+u+V+2},{x:this.scales.x(F)+8,y:this.scales.y(D)+u+V+2}];var G=d3.svg.line().x(function(x){return x.x}).y(function(x){return x.y}).interpolate("linear");if(P+Q>d3.max(this.scales.y.range())){B[0].y-=2*(V+1);B[1].y-=2*(u+V+2);B[2].y-=2*(u+V+2);Q=this.scales.y(D)-1-u-V-P;v="#DDDDDD"}if(S<d3.min(this.scales.x.range())){S=d3.min(this.scales.x.range());if(B[1].x<S+10){B[1].x=S+10;B[2].x=S+10+O}}else{if(S+q>d3.max(this.scales.x.range())){S=d3.max(this.scales.x.range())-q;if(B[2].x>S+q-10){B[1].x=S+q-10-O;B[2].x=S+q-10}}}R.append("rect").classed("sim-ui-scatterMVP-moreInfo-backRect",true).attr("x",S).attr("y",Q).attr("width",q).attr("height",P).attr("rx",H).attr("ry",H).style("fill","url(#moreInfoGradient)").style("filter","url(#moreInfoShadow)");var r=G(B);R.append("path").attr("d",r+"Z").classed("sim-ui-scatterMVP-moreInfo-backTri",true).style("fill",v);R.append("text").text(a.translate("Alt."," ")+z.rowid).classed("sim-ui-scatterMVP-moreInfo-text",true).attr("text-anchor","left").attr("x",S+5).attr("y",Q+24);var E=24,T=24,N=S+q-T-5,K=Q+5,t=10;var C=24,J=24,A=S+q-J-T-10,w=Q+5,s=10;var M=R.append("g").classed("sim-ui-scatterMVP-moreInfo-infoButton",true).on("mousedown",function(){d3.event.stopPropagation()}).on("mouseup",function(){c.makeParamPopover(z.rowid)});M.append("rect").classed("sim-ui-scatterMVP-moreInfo-infoButton-back",true).attr("x",N).attr("y",K).attr("width",T).attr("height",E).attr("rx",t).attr("ry",t).attr("fill","url(#infoPattern)");var L=this;var I=R.append("g").classed("sim-ui-scatterMVP-moreInfo-basketButton",true).on("mousedown",function(){d3.event.stopPropagation()}).on("mouseup",function(){d3.event.stopPropagation();if(proxy.isInBasket(Number(z.rowid))===-1){proxy.addToBasket(z.rowid);L.svgs.selectGroup.select(".sim-ui-scatterMVP-moreInfo-basketButton-back").attr("fill","url(#basketRemovePattern)")}else{proxy.removeFromBasket(z.rowid);L.svgs.selectGroup.select(".sim-ui-scatterMVP-moreInfo-basketButton-back").attr("fill","url(#basketPattern)")}});I.append("rect").classed("sim-ui-scatterMVP-moreInfo-basketButton-back",true).attr("x",A).attr("y",w).attr("width",J).attr("height",C).attr("rx",s).attr("ry",s).attr("fill",function(){if(proxy.isInBasket(Number(z.rowid))===-1){return"url(#basketPattern)"}else{return"url(#basketRemovePattern)"}})};h.prototype.setSetupPlots=function(q){this.setupPlots=q};h.prototype.setupPlots=function(q,r){r()};var o=Object.create(HTMLElement.prototype);o.setHeight=function(q){this.scatterController.setHeight(q)};o.setSetupPlots=function(q){this.scatterController.setSetupPlots(q)};o.setWidth=function(q){this.scatterController.setWidth(q)};o.createdCallback=function(){this.scatterController=new h(this)};o.setTileGenerator=function(q){this.scatterController.setTileGenerator(q)};o.initialize=function(q){this.scatterController.initialize(q)};o.setXParameter=function(q){this.scatterController.setXParameter(q)};o.setYParameter=function(q){this.scatterController.setYParameter(q)};o.setGetContourPlotTile=function(q){this.scatterController.setGetContourPlotTile(q)};o.setClickCallback=function(q){this.scatterController.setClickCallback(q)};o.refreshSingleScatter=function(){this.scatterController.refreshSingleScatter()};document.register("ra-xAxis",{prototype:i});document.register("ra-yAxis",{prototype:f});document.register("ra-histogramTile",{prototype:n});document.register("ra-scatterTile",{prototype:j});document.register("ra-scatterGrid",{prototype:g});document.register("ra-singleScatterPlot",{prototype:o})}return e});define("DS/SMAAnalyticsUI/SMAAnalyticsParamSlider",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,c,a){b.widget("sim.adviseParamslider",{options:{paramID:"",minimize:"",maximize:"",titleDivID:"",option2:b.noop},_rendered:false,_isVisible:function(e){var g=e.getBoundingClientRect().top,f,e=e.parentNode;if(e==null){console.warn("visiblity check for dangling node");return true}var d=wrap(document.body);do{f=e.getBoundingClientRect();if(g<=f.bottom===false){return false}e=e.parentNode}while(e!=d&&e!=null);return g<=document.documentElement.clientHeight},scroll:function(){if(!this._rendered){this._create()}},_create:function(){var j=this;if(!j._isVisible(j.element[0])){return}var n=j.option("paramID");var m=0;var h=100;var i=[m,h];this.objective=null;var e=c.findParameter(n);if(e!==null&&typeof e!=="undefined"&&((e.dataType==="INTEGER"||e.dataType==="REAL")&&e.structure==="SCALAR")){m=e.min||0;h=e.max||0}if((n==="overallscore"||e.dataType==="INTEGER"||e.dataType==="REAL")&&e.structure==="SCALAR"){i=c.getParametricFilterBounds(n);this.objective=c.getObjective(n);if(i[0]===null){i[0]=m}if(i[1]===null){i[1]=h}this.minValue=m;this.maxValue=h;var l=b("<div/>",{"class":"ui-slider-handle sim-ui-paramslider-handle sim-ui-paramslider-handle-left"});var g=b("<div/>",{"class":"ui-slider-handle sim-ui-paramslider-handle sim-ui-paramslider-handle-right"});this.leftMarker=b("<div/>",{"class":"sim-ui-paramslider-left-marker"}).text(parseFloat(m.toPrecision(5)).toString()).appendTo(j.element);this.rightMarker=b("<div/>",{"class":"sim-ui-paramslider-right-marker"}).text(parseFloat(h.toPrecision(5)).toString()).appendTo(j.element);this.leftMarkThreshold=b("<div/>",{"class":"sim-ui-paramslider-left-marker-threshold"}).text("T:"+i[0]).appendTo(j.element);this.rightMarkThreshold=b("<div/>",{"class":"sim-ui-paramslider-right-marker-threshold"}).text("T:"+i[1]).appendTo(j.element);this.rangeThreshold=b("<div/>",{"class":"sim-ui-paramslider-range-threshold"}).appendTo(j.element);l.appendTo(j.element);g.appendTo(j.element);var d=j.element.slider({range:true,max:h,min:m,values:i,stop:function(o,p){j._stop(o,p,n)},slide:function(o,p){j._slide(o,p,n)}});this.leftMarkerThresh=b("<div/>",{"class":"sim-ui-paramslider-left-marker-slider-threshold"}).appendTo(j.element);this.rightMarkerThresh=b("<div/>",{"class":"sim-ui-paramslider-right-marker-slider-threshold"}).appendTo(j.element);this.range=b(d).find(".ui-slider-range").addClass("sim-ui-paramslider-range");this.rightThresholdLine=b("<div/>",{"class":"sim-ui-paramslider-left-marker-threshold-line"}).appendTo(b(d));this.leftThresholdLine=b("<div/>",{"class":"sim-ui-paramslider-right-marker-threshold-line"}).appendTo(b(d));this._updateThresholdValues(i,n);b(j.element).hover(function(){j._hoverIn(n,j)},function(){b(j.element).find(".sim-ui-paramslider-handle-hover").remove()});if(n!=="overallscore"&&e.dataType==="REAL"){b(d).slider("option","step",(h-m)/100)}else{if(n==="overallscore"||e.dataType==="INTEGER"){b(d).slider("option","step",1)}}var k=this.option("minimize"),f=this.option("maximize");if(k!==""){if(this.objective==="MINIMIZE"){b("#"+k).addClass("sim-ui-control-min-active");b(this.range).addClass("sim-ui-param-control-range-min")}b("#"+f).unbind("click");b("#"+k).click(function(o){o.preventDefault();j._minimizeClicked(o,n,j)})}if(f!==""){if(this.objective==="MAXIMIZE"){b("#"+f).addClass("sim-ui-control-max-active");b(this.range).addClass("sim-ui-param-control-range-max")}b("#"+f).unbind("click");b("#"+f).click(function(o){o.preventDefault();j._maximizeClicked(o,n,j)})}this.refresh()}else{if(e.dataType==="STRING"&&e.structure==="SCALAR"){b(this.element).css("display","none");b("#_"+n+"maximize").css("display","none");b("#_"+n+"minimize").css("display","none");this.refresh()}}j._rendered=true},_hoverIn:function(e,h){this.sliderLeftMarker=this.sliderLeftMarker||b("<div>",{"class":"sim-ui-paramslider-handle-hover sim-ui-paramslider-handle-hover-left"});this.sliderRightMarker=this.sliderRightMarker||b("<div>",{"class":"sim-ui-paramslider-handle-hover sim-ui-paramslider-handle-hover-right"});this.sliderLeftMarker.appendTo(h.element);this.sliderRightMarker.appendTo(h.element);var d=c.getParametricFilterBounds(e);var g=100*(d[0]-this.minValue)/(this.maxValue-this.minValue)+"%";if(d[0]>this.minValue&&d[0]!==null){this.sliderLeftMarker.css("left",g).text(String(d[0]))}else{this.sliderLeftMarker.css("left","-100%")}var f=100*(d[1]-this.minValue)/(this.maxValue-this.minValue)+"%";if(d[1]<this.maxValue&&d[1]!==null){this.sliderRightMarker.css("left",f).text(String(d[1]))}else{this.sliderRightMarker.css("left","-100%")}},_hoverOut:function(){this.sliderLeftMarker.remove();this.sliderRightMarker.remove()},_minimizeClicked:function(f,d,e){f.iaEventUISource="shopPage-paramSlider";if(c.isFormulationLocked()){alert(a.translate("formulation_locked_msg"));return}var g=e.option("minimize"),h=e.option("maximize");if(e.objective==="MINIMIZE"){e.objective="";b("#"+g).removeClass("sim-ui-control-min-active");this.rangeThreshold.removeClass("sim-ui-param-control-range-min");this.rangeThreshold.removeClass("sim-ui-param-control-range-max")}else{if(e.objective==="MAXIMIZE"){c.setObjective(d,"",0,f);e.objective="MINIMIZE";b("#"+g).addClass("sim-ui-control-min-active");b("#"+h).removeClass("sim-ui-control-max-active");this.rangeThreshold.addClass("sim-ui-param-control-range-min");this.rangeThreshold.removeClass("sim-ui-param-control-range-max")}else{e.objective="MINIMIZE";b("#"+g).addClass("sim-ui-control-min-active");b("#"+h).removeClass("sim-ui-control-max-active");this.rangeThreshold.addClass("sim-ui-param-control-range-min");this.rangeThreshold.removeClass("sim-ui-param-control-range-max")}}sessionInfo.shopPage.timers.dataTable.restartTimer();c.setObjective(d,e.objective,0,f)},_maximizeClicked:function(f,d,e){if(c.isFormulationLocked()){alert(a.translate("formulation_locked_msg"));return}var g=e.option("minimize"),h=e.option("maximize");if(e.objective==="MAXIMIZE"){e.objective=" ";b("#"+h).removeClass("sim-ui-control-max-active");this.rangeThreshold.removeClass("sim-ui-param-control-range-min");this.rangeThreshold.removeClass("sim-ui-param-control-range-max")}else{if(e.objective==="MINIMIZE"){c.setObjective(d," ",0,f);e.objective="MAXIMIZE";b("#"+h).addClass("sim-ui-control-max-active");b("#"+g).removeClass("sim-ui-control-min-active");this.rangeThreshold.removeClass("sim-ui-param-control-range-min");this.rangeThreshold.addClass("sim-ui-param-control-range-max")}else{e.objective="MAXIMIZE";b("#"+h).addClass("sim-ui-control-max-active");b("#"+g).removeClass("sim-ui-control-min-active");this.rangeThreshold.removeClass("sim-ui-param-control-range-min");this.rangeThreshold.addClass("sim-ui-param-control-range-max")}}sessionInfo.shopPage.timers.dataTable.restartTimer();c.setObjective(d,e.objective,0,f)},_init:function(){},_updateThresholdValues:function(r,l){var k=c.getConstraintBounds(l);if(r===null){r=c.getParametricFilterBounds(l)}var q=100*(r[0]-this.minValue)/(this.maxValue-this.minValue)+"%";if(typeof this.sliderLeftMarker!=="undefined"){if(r[0]>this.minValue&&r[0]!==null){this.sliderLeftMarker.css("left",q).text(String(r[0]))}else{this.sliderLeftMarker.css("left","-100%")}}var d=100*(r[1]-this.minValue)/(this.maxValue-this.minValue)+"%";if(typeof this.sliderRightMarker!=="undefined"){if(r[1]<this.maxValue&&r[1]!==null){this.sliderRightMarker.css("left",d).text(String(r[1]))}else{this.sliderRightMarker.css("left","-100%")}}if(k[0]===null){k[0]=this.minValue||0}if(k[1]===null){k[1]=this.maxValue||0}var p=100*(k[0]-this.minValue)/(this.maxValue-this.minValue);var f=false;if(p>100){p=100;f=true}p=p+"%";this.leftThresholdLine.css("left",p);this.leftMarkerThresh.css("width",p);this.leftMarkThreshold.text("T:"+parseFloat(k[0].toPrecision(5)).toString()).css("left",p);this.leftMarkThreshold.css({width:p,left:b(this.element).position("left")});var m=100*(k[1]-this.minValue)/(this.maxValue-this.minValue);var j=false;if(m<0){m=0;j=true}this.rightMarkerThresh.css({left:m+"%",width:100-m+"%"});m=m+"%";this.rightMarkThreshold.text("T:"+parseFloat(k[1].toPrecision(5)).toString());this.rightMarkThreshold.css({left:m,right:b(this.element).position("right")});this.rightThresholdLine.css("left",m);var i=100*(r[1]-this.minValue)/(this.maxValue-this.minValue)>=0?100*(r[1]-this.minValue)/(this.maxValue-this.minValue):100;var h=100*(r[0]-this.minValue)/(this.maxValue-this.minValue)>=0?100*(r[0]-this.minValue)/(this.maxValue-this.minValue):0;var g=100*(k[1]-this.minValue)/(this.maxValue-this.minValue);var e=100*(k[0]-this.minValue)/(this.maxValue-this.minValue);var n=i<g?i:g;var o=h>e?h:e;this.rangeThreshold.css({left:o+"%",width:n-o+"%"});if(k[0]===this.minValue||f){this.leftThresholdLine.hide();this.leftMarkThreshold.hide()}else{this.leftThresholdLine.show();this.leftMarkThreshold.show()}if(k[1]===this.maxValue||j){this.rightThresholdLine.hide();this.rightMarkThreshold.hide()}else{this.rightThresholdLine.show();this.rightMarkThreshold.show()}},_slide:function(e,f,d){this._updateThresholdValues(f.values,d)},_stop:function(e,f,d){this._updateThresholdValues(f.values,d);if(f.values[0]!==f.values[1]){if(f.value===f.values[0]){sessionInfo.shopPage.timers.dataTable.restartTimer();c.setParametricFilter(d,"LESS_THAN",f.value,e)}else{sessionInfo.shopPage.timers.dataTable.restartTimer();c.setParametricFilter(d,"GREATER_THAN",f.value,e)}}else{console.error("Both values are same for parameter "+d)}},refresh:function(){var o=this.option("paramID");if(o===""&&!this.element.attr("id")){o=this.element.attr("id").substring(1)}var m=c.findParameter(o);var f="_"+o;var C;if(o==="overallscore"||m.dataType==="INTEGER"||m.dataType==="REAL"){var e=this.option("titleDivID");var v=0;var G=100;var F=[],H=[],u=[],z=[];v=m.min;G=m.max;F=m.histogramValues;H=m.filteredHistogramValues||m.histogramValues;u=m.filteredParetoHistogramValues||m.paretoHistogramValues;for(C=0;C<m.histogramValues.length;C++){z.push(m.filteredInfeasibleHistogramValues[C]+u[C])}var g=this.option("minimize"),p=this.option("maximize");var D=c.getObjective(o);b("#"+g).removeClass("sim-ui-control-min-active");b("#"+p).removeClass("sim-ui-control-max-active");this.rangeThreshold.removeClass("sim-ui-param-control-range-min");this.rangeThreshold.removeClass("sim-ui-param-control-range-max");if(D==="MINIMIZE"){b("#"+g).addClass("sim-ui-control-min-active");this.rangeThreshold.addClass("sim-ui-param-control-range-min")}else{if(D==="MAXIMIZE"){b("#"+p).addClass("sim-ui-control-max-active");this.rangeThreshold.addClass("sim-ui-param-control-range-max")}}if(typeof e!=="undefined"&&e!==null&&e!=="undefined"&&e!==""&&e!==" "){b(this.element).parent().parent().find("#"+e).text(m.displayName)}this.leftMarker.text(parseFloat(v.toPrecision(5)).toString());this.rightMarker.text(parseFloat(G.toPrecision(5)).toString());var t=100;var E=25;var s=d3.scale.linear().domain([0,H.length]).range([0,t]);var q=d3.scale.linear().domain([0,d3.max(F)]).rangeRound([0,100]);var r=d3.select("#"+f);r.selectAll(".sim-ui-param-control-containerSvg").remove();var d=r.append("svg").each(function(){this.setAttribute("class","sim-ui-param-control-containerSvg");this.style.width="100%"});this.allChart=this.allChart||d.append("svg").attr("id","unfiltered").attr("class","sim-ui-param-control-histogram sim-ui-param-control-histogram-unfiltered").attr("width",t+"%").attr("height",E);this.allChart.selectAll("rect").remove();this.allChart.selectAll("rect").data(F).enter().append("rect").each(function(j,h){this.setAttribute("x",(s(h)-0.5)+"%");this.setAttribute("y",(100-q(j)-0.5)+"%");this.setAttribute("width",t/(F.length)+"%");this.setAttribute("height",q(j)+"%")});this.chart=this.chart||d.append("svg").attr("id","all").attr("class","sim-ui-param-control-histogram").attr("width",t+"%").attr("height",E);if(o==="overallscore"){d.style("margin-top","-35px")}this.chart.selectAll("rect").remove();this.chart.selectAll("rect").data(H).enter().append("rect").each(function(j,h){this.setAttribute("x",s(h)-0.5+"%");this.setAttribute("y",100-q(j)-0.5+"%");this.setAttribute("width",t/H.length+"%");this.setAttribute("height",q(j)+"%")});if(z.length>0){this.infeasiblePlusParetochart=this.infeasiblePlusParetochart||d.append("svg").each(function(){this.id="infPp";this.style.top=-1*E+"px";this.style.marginTop="0px";try{this.classList.add("sim-ui-param-control-histogram-infeasible")}catch(h){this.setAttribute("class","sim-ui-param-control-histogram-infeasible")}this.setAttribute("width",t+"%");this.setAttribute("height",E)});this.infeasiblePlusParetochart.selectAll("rect").remove();this.infeasiblePlusParetochart.selectAll("rect").data(z).enter().append("rect").each(function(j,h){this.setAttribute("x",s(h)-0.5+"%");this.setAttribute("y",100-q(j)-0.5+"%");this.setAttribute("width",t/H.length+"%");this.setAttribute("height",q(j)+"%")})}if(u.length>0){this.paretochart=this.paretochart||d.append("svg").each(function(){this.id="pareto";this.style.top=-2*E+"px";this.style.marginTop="0px";try{this.classList.add("sim-ui-param-control-histogram-pareto")}catch(h){this.setAttribute("class","sim-ui-param-control-histogram-pareto")}this.setAttribute("width",t+"%");this.setAttribute("height",E)});this.paretochart.selectAll("rect").remove();this.paretochart.selectAll("rect").data(u).enter().append("rect").each(function(j,h){this.setAttribute("x",s(h)-0.5+"%");this.setAttribute("y",100-q(j)-0.5+"%");this.setAttribute("width",t/H.length+"%");this.setAttribute("height",q(j)+"%")})}this._updateThresholdValues(null,o)}else{if(m.dataType==="STRING"){var l=null;l=function(Q,h,i,W){var M;var T=20;var P=80;var N=75;var x=227;var S=Q[0].dominated+Q[0].pareto+Q[0].infeasible;var O=[];u=m.paretoHistogramValues;for(C=0;C<Q.length;C++){O.push(Q[C].pareto+Q[C].infeasible)}var V=[];for(C=i;C<(i+40>Q.length?Q.length:i+40);C++){V.push(Q[C])}var R=d3.behavior.drag().on("drag",function(X){X.x+=d3.event.dx;X.y+=d3.event.dy;d3.select(this).attr("transform",function(Y){if(Y.x>=0){if(Y.startNum>0){l.call(this,Y.freqInfo,h,Y.startNum-T>0?Y.startNum-T:0,-1*Y.dragWidth+24)}if(Y.startNum===0){b(h).find(".sim-ui-param-control-left-arrow").css("visibility","hidden")}return"translate("+[0,0]+")"}if(Y.x<=-1*Y.dragWidth){if(Y.startNum>=0&&Y.startNum+T*2<=Q.length){l.call(this,Y.freqInfo,h,Y.startNum+T,0);return("translate("+[-1*Y.dragWidth,0]+")")}else{b(h).find(".sim-ui-param-control-right-arrow").css("visibility","hidden");return("translate("+[-1*y,0]+")")}}else{b(h).find(".sim-ui-param-control-left-arrow").css("visibility","visible");b(h).find(".sim-ui-param-control-right-arrow").css("visibility","visible");return"translate("+[Y.x,0]+")"}})});d3.select(h).selectAll("svg").remove();this.chartSVG=d3.select(h).append("svg").attr("id",m.ID).attr("class","sim-ui-param-control-freq-chart").attr("width",P+"%").attr("height",N);if(Q.length<20){M=(x-(Q.length-1))/Q.length>10?(x-(Q.length-1))/Q.length:10}else{M=10}var y=((M+1)*V.length-x&&Q.length>T)>0?(M+1)*V.length-x:0;var K,L;if(b(h).find(".sim-ui-param-control-left-arrow").length!==0){b(h).find(".sim-ui-param-control-left-arrow").remove()}K=b('<span class="sim-ui-param-control-left-arrow  ui-icon ui-icon-triangle-1-w"></span>').click(function(){b(h).find(".sim-ui-param-control-right-arrow").css("visibility","visible");l.call(this,Q,h,i-T*5<0?0:i-T*5,0)});b(h).append(K);if(i>0||W<0){b(h).find(".sim-ui-param-control-left-arrow").css("visibility","visible")}else{b(h).find(".sim-ui-param-control-left-arrow").css("visibility","hidden")}this.chartSVG.selectAll("rect").remove();this.chartSVG.selectAll("g").remove();var U=this.chartSVG.append("g").data([{x:W,y:0,dragWidth:y,startNum:i,freqInfo:Q}]).call(R).attr("transform","translate("+W+",0)");U.append("rect").attr("width",P+"%").attr("height",N).attr("x",0).attr("y",0).style("fill-opacity",0).style("stroke","none");var J=U.selectAll(".sim-ui-param-freqs-bars").data(V).enter().append("g").on("click",function(Y){var X=d3.select(this);if(!k){k=[]}if(!Y.filtered){Y.filtered=true;k.push(Y.words);X.selectAll("text").classed("sim-ui-categorical-text-hidden",true).classed("sim-ui-categorical-text-font-shown",false);X.selectAll("rect").style("opacity",0.5);c.setParametricFilter(b(this).parent().parent()[0].id,"ONE_OF",k)}else{X.selectAll("text").classed("sim-ui-categorical-text-hidden",false).classed("sim-ui-categorical-text-font-shown",true);X.selectAll("rect").style("opacity",1);Y.filtered=false;for(C=0;C<k.length;C++){if(k[C]===Y.words){k.splice(C,1)}}if(k.length===0){k=null}c.setParametricFilter(b(this).parent().parent()[0].id,"ONE_OF",k)}});var I=I||J.append("g");var j=J.append("g");var w=this.subGroupInfeasible||J.append("g");if(O.length>0){j.append("rect").attr("class","sim-ui-param-control-freq-histogram-pareto").attr("x",function(Y,X){return(M+1)*X}).attr("y",function(Z){var Y=Z.pareto||0;var X=S||1;var aa=5+(X-Y)*35/X;return(aa+"%")}).attr("width",M).attr("height",function(aa){var Z=aa.pareto||0;var Y=S||1;var X=35-(Y-Z)*35/Y;return(X+"%")});w.append("rect").attr("class","sim-ui-param-control-freq-histogram-infeasible").attr("x",function(Y,X){return(M+1)*X}).attr("y",function(aa){var Z=aa.pareto||0;var Y=S||1;var X=aa.infeasible||0;var ab=-1*(35-(Y-Z)*35/Y)+5+(Y-X)*35/Y;return(ab+"%")}).attr("width",M).attr("height",function(ab){var aa=ab.pareto||0;var Z=S||1;var X=ab.infeasible||0;var Y=35-(Z-X)*35/Z;return(Y+"%")})}I.append("rect").attr("class","sim-ui-param-control-freq-histogram-dominated").attr("x",function(Y,X){return(M+1)*X}).attr("y",function(ab){var aa=ab.pareto||0;var Z=S||1;var Y=ab.infeasible||0;var X=ab.dominated||0;var ac=-1*(35-(Z-Y)*35/Z)-(35-(Z-aa)*35/Z)+5+(Z-X)*35/Z;return(ac+"%")}).attr("width",M).attr("height",function(ac){var ab=ac.pareto||0;var aa=S||1;var Y=ac.infeasible||0;var X=ac.dominated||0;var Z=35-(aa-X)*35/aa;return(Z+"%")});J.append("text").attr("x",function(Y,X){return(M+1)*X+M/2}).attr("y",function(){return 52+"%"}).text(function(X){if(X.dominated+X.infeasible+X.pareto-X.excluded>0){if(X.words.length<8){if(X.words===""){return"<empty>"}else{return X.words}}else{return X.words.substring(0,6)+"..."}}else{}}).attr("transform",function(Y,X){return("rotate(90,"+((M+1)*X+M/2)+","+35+")")});J.append("title").text(function(X){return X.words});J.each(function(Y){var X=d3.select(this);if(Y.filtered){X.selectAll("rect").style("opacity",0.5)}else{X.selectAll("rect").style("opacity",1)}});J.selectAll("text").classed("sim-ui-param-control-text-filtered",function(X){return X.filtered}).classed("sim-ui-param-control-text-shown",function(X){return !X.filtered});if(b(h).find(".sim-ui-param-control-right-arrow").length!==0){b(h).find(".sim-ui-param-control-right-arrow").remove()}L=b('<span class="sim-ui-param-control-right-arrow  ui-icon ui-icon-triangle-1-e"></span>').click(function(){K.css({visibility:"visible"});if(i+T*5>Q.length-T-1){l.call(this,Q,h,Q.length-2*(T-1)>0?Q.length-2*(T-1):0,-1*y+24)}else{l.call(this,Q,h,i+T*5,0)}});if(i+T>Q.length){L.css({visibility:"hidden"})}b(h).append(L);if(i===Q.length-T-1||Q.length<T||(Q.length<T*2&&W===-1*y)){b(h).find(".sim-ui-param-control-right-arrow").css("visibility","hidden")}else{b(h).find(".sim-ui-param-control-right-arrow").css("visibility","visible")}};var A=[];var n=false;var k=c.getParametricFilterBounds(o)[0]||[];for(C=0;C<m.stringSortedByFreqs.length;C++){n=false;if(k.length!==0){for(var B=0;B<k.length;B++){if(m.stringSortedByFreqs[C]===k[B]){n=true}}}A.push({words:m.stringSortedByFreqs[C],dominated:m.stringFreqsDominated[C],pareto:m.stringFreqsPareto[C]||0,infeasible:m.stringFreqsInfeasible[C]||0,excluded:m.stringFreqsExcluded[C]||0,filtered:n})}l.call(this,A,"#"+f,0,0,k)}}}});return b});define("DS/SMAAnalyticsUI/SMAAnalyticsParameterControlList",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/Controls/Toggle"],function(g,h,d,b,i){function f(l,m,k){this.data=l;this.divs={root:d3.select(m)};this.dragData={id:this.data.ID,source:"sidebar-other"};this.divs.titleDiv=this.divs.root.append("div").text(l.displayName).classed("parameterControlTitle",true).attr("title",l.displayName);this.divs.contentDiv=this.divs.root.append("div").classed("parameterControlContent",true);this.sliderUpdateMethods={};this.slider={};this.makeDataSlider();this.hideSliderHandles();this.createSliderThreshold();this.parameterControlList=k;this.disabled=false;this.makeDraggable()}f.prototype.format=function(k){return d.formatExp(k,3)};f.prototype.makeDataSlider=function(){this.slider.mainBar=this.divs.contentDiv.append("div").classed("parameterControls-mainSliderBar",true).style("opacity",1);var l=this.data.min,m=this.data.max,k=this;this.jqslider=g(this.slider.mainBar[0][0]).slider({range:true,max:m,min:l,values:[this.data.min,this.data.max],stop:function(n,o){k.stopDataSlider(n,o)},slide:function(n,o){k.slideDataSlider(n,o)},step:(m-l)/100,disabled:true});this.sliderScale=d3.scale.linear().domain([this.data.min,this.data.max]).range([0,100]);this.sliderScalePx=d3.scale.linear().domain([this.data.min,this.data.max]).range([0,this.jqslider[0].offsetWidth]);this.slider.minVal=this.divs.contentDiv.append("div").classed("parameterControls-minVal",true).text(this.format(this.data.min));this.slider.maxVal=this.divs.contentDiv.append("div").classed("parameterControls-maxVal",true).text(this.format(this.data.max));this.slider.currentUpperVal=this.slider.mainBar.append("div").classed("parameterControls-currentUpper",true);this.slider.currentUpperVal.style("left",this.getUpperPosition(this.data.max)+"px");this.slider.currentLowerVal=this.slider.mainBar.append("div").classed("parameterControls-currentLower",true);this.slider.currentLowerVal.style("right",this.getLowerPosition(this.data.min)+"px");this.slider.mainBar.select(".ui-slider-range").classed("sim-ui-paramslider-range",true);this.slider.lowerHandle=d3.select(this.slider.mainBar.selectAll("a")[0][0]);this.slider.lowerHandle.classed("sim-ui-paramslider-handle sim-ui-paramslider-handle-left",true);this.slider.upperHandle=d3.select(this.slider.mainBar.selectAll("a")[0][1]);this.slider.upperHandle.classed("sim-ui-paramslider-handle sim-ui-paramslider-handle-right",true)};f.prototype.hideSliderHandles=function(){this.jqslider.children("a").hide()};f.prototype.showSliderHandles=function(){this.jqslider.children("a").show()};f.prototype.getLowerPosition=function(l){var m=this.jqslider[0].offsetWidth-this.slider.currentLowerVal[0][0].offsetWidth+10,k=this.jqslider[0].offsetWidth-this.sliderScalePx(l);return Math.min(m,k)};f.prototype.getUpperPosition=function(k){var m=this.jqslider[0].offsetWidth-this.slider.currentUpperVal[0][0].offsetWidth+10,l=this.sliderScalePx(k);return Math.min(m,l)};f.prototype.updateDataSlider=function(){this.jqslider.slider("option",{max:this.data.max,min:this.data.min});this.slider.minVal=this.divs.contentDiv.select(".parameterControls-minVal").text(this.format(this.data.min));this.slider.maxVal=this.divs.contentDiv.select(".parameterControls-maxVal").text(this.format(this.data.max))};f.prototype.updateControl=function(k){if(typeof k!=="undefined"){this.data=k}this.sliderScalePx.range([0,this.jqslider[0].offsetWidth]);this.updateDataSlider();this.updateObjectiveControls();this.updateThreshold()};f.prototype.slideDataSlider=function(k,l){this.sliderScalePx.range([0,this.jqslider[0].offsetWidth]);if(l.values[0]===this.data.min){this.slider.currentLowerVal.text("")}else{this.slider.currentLowerVal.text(this.format(l.values[0]))}if(l.values[1]===this.data.max){this.slider.currentUpperVal.text("")}else{this.slider.currentUpperVal.text(this.format(l.values[1]))}this.slider.currentUpperVal.style("left",this.getUpperPosition(l.values[1])+"px");this.slider.currentLowerVal.style("right",this.getLowerPosition(l.values[0])+"px");this.parameterControlList.page.zoomSlide(this.data.ID,l.values)};f.prototype.stopDataSlider=function(l,m){var k=this.data.max-this.data.min;if(m.values[0]<this.data.min+0.001*k){this.slider.currentLowerVal.text("")}else{this.slider.currentLowerVal.text(this.format(m.values[0]))}if(m.values[1]>this.data.max-0.001*k){this.slider.currentUpperVal.text("")}else{this.slider.currentUpperVal.text(this.format(m.values[1]))}this.parameterControlList.page.zoomStop(this.data.ID,m.values)};f.prototype.makeSliderFilter=function(){};f.prototype.updateFilter=function(k,l){};f.prototype.createObjectiveControls=function(){var k=this;this.divs.minControl=this.divs.contentDiv.append("div").classed("sim-ui-control-min",true).on("click",function(){k.minimizeClicked()});this.divs.maxControl=this.divs.contentDiv.append("div").classed("sim-ui-control-max",true).on("click",function(){k.maximizeClicked()});this.updateObjectiveControls()};f.prototype.updateObjectiveControls=function(){};f.prototype.maximizeClicked=function(){if(h.isFormulationLocked()){alert(b.translate("formulation_locked_msg"));return}if(this.data.formulation&&this.data.formulation.objectives&&this.data.formulation.objectives.length>0&&this.data.formulation.objectives[0].type==="MAXIMIZE"){h.setObjective(this.data.ID,"",0)}else{h.setObjective(this.data.ID,"MAXIMIZE",0)}};f.prototype.minimizeClicked=function(){if(h.isFormulationLocked()){alert(b.translate("formulation_locked_msg"));return}if(this.data.formulation&&this.data.formulation.objectives&&this.data.formulation.objectives.length>0&&this.data.formulation.objectives[0].type==="MINIMIZE"){h.setObjective(this.data.ID,"",0)}else{h.setObjective(this.data.ID,"MINIMIZE",0)}};f.prototype.updateObjective=function(){};f.prototype.createSliderThreshold=function(){this.slider.lowerThresholdShading=this.slider.mainBar.append("div").classed("sim-ui-paramslider-left-marker-slider-threshold",true).style({left:"0%",width:"0%"});this.slider.upperThresholdShading=this.slider.mainBar.append("div").classed("sim-ui-paramslider-right-marker-slider-threshold",true).style({right:"0%",width:"0%"});this.slider.lowerThresholdValue=this.slider.mainBar.append("div").classed("sim-ui-paramslider-left-marker-threshold",true).style("visibility","hidden").style({"min-width":"0px","margin-left":"0px","text-align":"left"});this.slider.upperThresholdValue=this.slider.mainBar.append("div").classed("sim-ui-paramslider-right-marker-threshold",true).style("visibility","hidden").style({"min-width":"0px","margin-left":"0px","text-align":"left"});this.slider.lowerThresholdLine=this.slider.mainBar.append("div").classed("sim-ui-paramslider-left-marker-threshold-line",true).style("margin-left","-2px").style("visibility","hidden");this.slider.upperThresholdLine=this.slider.mainBar.append("div").classed("sim-ui-paramslider-right-marker-threshold-line",true).style("margin-right","-2px").style("visibility","hidden");this.updateThreshold()};f.prototype.updateThreshold=function(){var l,n;if(this.data.formulation&&this.data.formulation.constraints&&this.data.formulation.constraints.length>0){var k=this.data.formulation.constraints.filter(function(o){return o.type==="GREATER_THAN"}),m=this.data.formulation.constraints.filter(function(o){return o.type==="LESS_THAN"});if(k.length>0){l=this.sliderScale(k[0].boundValue);n=false;if(l>100){l=100;n=true}this.slider.lowerThresholdShading.style("width",l+"%");if(n){this.slider.lowerThresholdValue.style("visibility","hidden");this.slider.lowerThresholdLine.style("visibility","hidden")}else{this.slider.lowerThresholdValue.style({visibility:"",right:this.getLowerPosition(k[0].boundValue)+"px"}).text(this.format(k[0].boundValue));this.slider.lowerThresholdLine.style({visibility:"",left:this.sliderScale(k[0].boundValue)+"%"})}}else{this.slider.lowerThresholdShading.style("width","0%");this.slider.lowerThresholdValue.style("visibility","hidden");this.slider.lowerThresholdLine.style("visibility","hidden")}if(m.length>0){l=100-this.sliderScale(m[0].boundValue);n=false;if(l>100){l=100;n=true}this.slider.upperThresholdShading.style("width",l+"%");if(n){this.slider.upperThresholdValue.style("visibility","hidden");this.slider.upperThresholdLine.style("visibility","hidden")}else{this.slider.upperThresholdValue.style({visibility:"",left:this.getUpperPosition(m[0].boundValue)+"px"}).text(this.format(m[0].boundValue));this.slider.upperThresholdLine.style({visibility:"",right:100-this.sliderScale(m[0].boundValue)+"%"})}}else{this.slider.upperThresholdShading.style("width","0%");this.slider.upperThresholdValue.style("visibility","hidden");this.slider.upperThresholdLine.style("visibility","hidden")}}else{this.slider.upperThresholdShading.style("width","0%");this.slider.upperThresholdValue.style("visibility","hidden");this.slider.upperThresholdLine.style("visibility","hidden");this.slider.lowerThresholdShading.style("width","0%");this.slider.lowerThresholdValue.style("visibility","hidden");this.slider.lowerThresholdLine.style("visibility","hidden")}};f.prototype.makeDraggable=function(){var k=this;if(h.getSwitch("RA_INTERACTIVE_DESIGN")){return}this.divs.root.attr("draggable",true).on("dragstart",function(n){var m={};for(var l in k.dragData){if(k.dragData.hasOwnProperty(l)){m[l]=k.dragData[l]}}d3.event.dataTransfer.setData("text",JSON.stringify(m));d3.select(this).classed("parameterControls-highlightDrag",true);k.parameterControlList.page.startDrag(k.dragData)}).on("dragend",function(l){d3.select(this).classed("parameterControls-highlightDrag",false);k.parameterControlList.page.endDrag(k.dragData)})};f.prototype.getDragData=function(){return this.dragData};f.prototype.disableControl=function(l){var k=this;if(this.disabled===false){this.divs.root.append("div").classed("disabledControlDiv",true);this.getDragData=function(){return{id:k.dragData.id,source:"disabled-"+k.dragData.source}};this.disabled=true}this.divs.root.select(".disabledControlDiv").text(l)};f.prototype.disableControlWithWarning=function(l){var k=this;if(this.disabled===false){this.divs.root.append("div").classed("disabledControlDivWithWarning",true);this.getDragData=function(){return{id:k.dragData.id,source:"disabled-"+k.dragData.source}};this.disabled=true}this.divs.root.select(".disabledControlDivWithWarning").text(l)};f.prototype.enableControl=function(){this.divs.root.selectAll(".disabledControlDiv").remove();this.divs.root.selectAll(".disabledControlDivWithWarning").remove();this.disabled=false;delete this.getDragData};var e=function(k){h.updateConstantOptimizationInputs(this,k.dsModel.checkFlag)};function j(n,p,l){f.call(this,n,p,l);this.showSliderHandles();this.jqslider.slider("option","disabled",false);this.dragData={id:this.data.ID,source:"sidebar-input"};this.makeDraggable();var k=(this.divs.root.insert("div",".parameterControlContent").attr("class","ra-opt-inputparamlock").attr("title",b.translate("OPT_LOCK_TOOLTIP")))[0][0];var o=new i({type:"checkbox"});o.inject(k);o.addEventListener("buttonclick",e.bind(this.data));o.checkFlag=h.isLockedOptInput(this.data.name);var m=UWA.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock"});m.inject(k)}j.prototype=Object.create(f.prototype);j.constructor=j;j.updateFilter=function(k,l){f.prototype.updateFilter.call(this,k,l)};function c(l,m,k){f.call(this,l,m,k);this.createObjectiveControls();this.jqslider.slider("option","values",[]);this.dragData={id:this.data.ID,source:"sidebar-output"};this.makeDraggable()}c.prototype=Object.create(f.prototype);c.constructor=c;c.updateFilter=function(k,l){f.prototype.updateFilter.call(this,k,l)};c.prototype.updateObjectiveControls=function(){if(this.data.formulation&&this.data.formulation.objectives&&this.data.formulation.objectives.length>0){if(this.data.formulation.objectives[0].type==="MINIMIZE"){this.divs.maxControl.classed("sim-ui-control-max-active",false);this.divs.minControl.classed("sim-ui-control-min-active",true)}else{if(this.data.formulation.objectives[0].type==="MAXIMIZE"){this.divs.maxControl.classed("sim-ui-control-max-active",true);this.divs.minControl.classed("sim-ui-control-min-active",false)}else{this.divs.maxControl.classed("sim-ui-control-max-active",false);this.divs.minControl.classed("sim-ui-control-min-active",false)}}}else{if(typeof this.divs.maxControl!=="undefined"){this.divs.maxControl.classed("sim-ui-control-max-active",false);this.divs.minControl.classed("sim-ui-control-min-active",false)}}};function a(o,n,m,k){this.divs={rootDiv:d3.select(o)};this.listType=k;this.controls={};this.dataKeys={};if(typeof this.data!=="undefined"){this.update(m)}this.page=n;var l=this;this.divs.rootDiv.on("dragover",function(p){d3.event.stopPropagation();d3.event.preventDefault()}).on("drop",function(s){d3.event.preventDefault();var t=JSON.parse(d3.event.dataTransfer.getData("text"));var r=t.id,q=t.source,p=t.resolved;if(q.indexOf("sidebar-")===0&&q!==l.listType){l.page.updateParameterRole(r,l.listType,l.divs.rootDiv)}})}a.prototype.update=function(l){var m=this;l.sort(function(p,o){return p.displayName>o.displayName});this.dataKeys={};this.dataByKey={};l.forEach(function(o){m.dataKeys[o.ID]=true;m.dataByKey[o.ID]=o});var k;for(k in this.controls){if(!this.dataKeys[k]){delete this.controls[k]}else{try{this.controls[k].divs.titleDiv.text(this.dataByKey[k].displayName)}catch(n){}}}this.PCDs=this.divs.rootDiv.selectAll(".parameterControlDiv").data(l,function(o){return o.ID});this.PCDs.exit().remove();this.PCDs.each(function(o){if(m.controls[o.ID]){m.controls[o.ID].updateControl(o)}});this.PCDs.enter().append("div").classed("parameterControlDiv",true).each(function(o){m.createParameterControl(o,this)})};a.prototype.refresh=function(){var k;for(k in this.controls){if(this.controls[k]){this.controls[k].updateControl()}}};a.prototype.setDisabledControls=function(m){var k={},l=this;m.forEach(function(n){k[n.ID]=n});this.PCDs.each(function(n){if(l.controls[n.ID]){if(k[n.ID]){if(typeof k[n.ID].reasonSkipped!=="undefined"){l.controls[n.ID].disableControl(k[n.ID].reasonSkipped)}else{if(typeof k[n.ID].skipWarning!=="undefined"){l.controls[n.ID].disableControlWithWarning(k[n.ID].skipWarning)}}}else{l.controls[n.ID].enableControl()}}})};a.prototype.filterDisplayName=function(k){};a.prototype.createParameterControl=function(m,k){k.innerHTML="";var l;if(m.role==="OUTPUT"){l=new c(m,k,this)}else{if(m.role==="INPUT"){l=new j(m,k,this)}else{l=new f(m,k,this)}}this.controls[m.ID]=l};a.prototype.dragOut=function(){};a.prototype.startDrag=function(l){var k;this.divs.rootDiv[0][0].classList.add("profiler-dragTarget")};a.prototype.endDrag=function(k){this.divs.rootDiv[0][0].classList.remove("profiler-dragTarget")};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsMapView",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsPCPlot","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsSelfOrganizingMap","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(c,e,h,d,g,f,a){function b(i){this.totalHeight=726;this.somHeight=0.5*this.totalHeight;this.pcpHeight=this.totalHeight-this.somHeight;this.sessionObject=i;this.data={};this.defaultNumParams=3;this.mapViewOptions={som:{somInRow:3,minHeight:350,minWidth:350,margin:{left:50,top:50},settings:{gridSize:25,learning:0.8,neighborhood:0.8,iterations:10,initPCA:"Random",threads:10,preserveTopology:true,batchMode:false,maxPointsForCalc:2000}},pcPlot:{height:this.pcpHeight-d.getScrollWidth(),margin:50,thickness:10,minGap:150,maxPoints:1000,utilSclWidth:d.getScrollWidth()},colors:{def:["#e87b00","#ffe64f","#368ec4"],obj:["#499F3F","#EFEFEF"],udm:["white","#5b5d5e"]},buttonWidth:25};this.selectedParamsForCalc=[];this.GRADE_UNKNOWN=-3;this.GRADE_PARETO=2;this.GRADE_DOMINATED=0;this.GRADE_INFEASIBLE=1;this.GRADE_EXCLUDED=-2}b.prototype.refresh=function(j){var k=this;d3.selectAll(".sim-ui-som-single").remove();if(typeof k.data.usedColumnKeys==="undefined"||k.data.usedColumnKeys.length===0){this.getSelectedParameters()}j=j||{iaEventType:null};if(j.iaEventType==="formulationChanged"||j.iaEventType==="reloadView"||j.iaEventType==="viewchange"||j.iaEventType==="filterChanged"){var i={};if(k.somStatus==="READY"){e.getSomResults(i).done(function(){k.somResults=i.content;k.sessionObject.som.udmHandler.setResults(k.somResults);k.sessionObject.som.udmHandler.updateUDM();k.data.usedColumnKeys.forEach(function(n,l){var m=k.sessionObject.som.somHandlers[l];m.setResults(k.somResults);m.updateSOM()})})}k.sessionObject.pcPlot.updatePlot(null)}else{d3.selectAll(".sim-ui-som").remove();d3.selectAll(".sim-ui-som-single").remove();d3.selectAll(".sim-ui-pcplot").remove();this.somContainerDiv=c("#somContainerDiv").length===0?c("<div></div>",{id:"somContainerDiv"}).appendTo(c("#mapView")):c("#somContainerDiv");this.somDiv=c("#somDiv").length===0?c("<div></div>",{id:"somDiv"}).appendTo(this.somContainerDiv):c("#somDiv");this.pcPlotDiv=c("#pcPlotDiv").length===0?c("<div></div>",{id:"pcPlotDiv"}).appendTo(c("#mapView")):c("#pcPlotDiv");this.somDiv.css("height",this.somHeight);this.pcPlotDiv.css("height",this.mapViewOptions.pcPlot.height);if(this.mapViewOptions.som.minHeight>document.getElementById("mapView").clientHeight){document.querySelector("#pcPlotDiv").style.display="none"}else{document.querySelector("#pcPlotDiv").style.display="block"}if(this.somDiv.height()>this.mapViewOptions.som.minWidth){this.mapViewOptions.som.width=this.somDiv.height()+this.mapViewOptions.som.margin.left;this.mapViewOptions.som.height=this.somDiv.height()}k.sessionObject.pcPlot=new h(k.data,k.mapViewOptions);k.sessionObject.pcPlot.makePlot(null);var i={};if(k.somStatus==="READY"){e.getSomResults(i).done(function(){k.somResults=i.content;k.createAllSOMs()})}}};b.prototype.createAllSOMs=function(){d3.selectAll(".sim-ui-som").remove();d3.selectAll(".sim-ui-som-div").remove();var l=this;this.totalHeight=c("#mapView").height();this.somHeight=0.5*this.totalHeight>this.mapViewOptions.som.minHeight+this.mapViewOptions.som.margin.top?0.5*this.totalHeight:this.mapViewOptions.som.minHeight+this.mapViewOptions.som.margin.top;this.pcpHeight=this.totalHeight-this.somHeight;l.sessionObject.som={};l.sessionObject.som.udmHandler=new g(l.data,l.somResults,l.mapViewOptions,l);l.sessionObject.som.udmHandler.makeUDM();l.sessionObject.som.somHandlers=[];for(var k=0;k<l.data.usedColumnKeys.length;k++){var j=new g(l.data,l.somResults,l.mapViewOptions,l);j.makeNewSOM(l.data.usedColumnKeys[k]);l.sessionObject.som.somHandlers.push(j)}l.sessionObject.som.pcPlot=l.sessionObject.pcPlot;l.sessionObject.pcPlot.som=l.sessionObject.som;e.spinnerControlHide()};b.prototype.processData=function(){this.rawData=this.sessionObject.shopPage.dataHandler.data;this.data.columnKeys=[];this.data.columns={};this.data.rows={};this.data.rows=[];for(var j=0;j<this.rawData.columnKeys.length;j++){var k=this.rawData.columnKeys[j];if(k==="run_number"||k==="auto_rank"||k==="total_score"){continue}if(e.findParameter(this.rawData.columnKeys[j]).structure!=="ARRAY"&&this.rawData.columns[this.rawData.columnKeys[j]].dataType.toLowerCase()!=="string"){this.data.columnKeys.push(this.rawData.columnKeys[j]);this.data.columns[this.rawData.columnKeys[j]]=this.rawData.columns[this.rawData.columnKeys[j]]}}this.data.rows=this.rawData.rows;this.data.rowKeys=this.rawData.rowKeys};b.prototype.getSelectedParameters=function(){var l=[];if(l.length===0){for(var k=0;k<this.data.columnKeys.length;k++){if(e.getObjective(this.data.columnKeys[k])!==null){l.push(this.data.columnKeys[k])}}if(l.length<this.defaultNumParams){var j=l.length;for(var k=0;k<this.data.columnKeys.length;k++){if(e.getObjective(this.data.columnKeys[k])===null&&j<this.defaultNumParams){l.push(this.data.columnKeys[k]);j++}}}}this.data.usedColumnKeys=l};b.prototype.getSOMResults=function(){this.processData();var q=this;var p=[];for(var n=0;n<this.data.rowKeys.length;n++){p.push(n)}this.data.rawPoints=[];for(var n=0;n<this.data.rowKeys.length;n++){this.data.rawPoints.push([]);for(var m=0;m<this.data.columnKeys.length;m++){this.data.rawPoints[n].push(parseFloat(this.data.rows[this.data.rowKeys[n]].mainData[this.data.columnKeys[m]]))}}if(this.selectedParamsForCalc.length===0){for(var n=0;n<this.data.columnKeys.length;n++){this.selectedParamsForCalc[n]=true}}var o=q.mapViewOptions.som.settings.initPCA!=="Random";var t=123457891011;if(q.mapViewOptions.som.settings.batchMode){q.mapViewOptions.som.settings.iterations=100}else{q.mapViewOptions.som.settings.iterations=10}if(this.selectedParamsForCalc.length>0){document.getElementById("mapView").textContent="";e.spinnerControlShow();e.calculateSomResults(q.mapViewOptions.som.settings.gridSize,q.mapViewOptions.som.settings.gridSize,q.mapViewOptions.som.settings.iterations,q.mapViewOptions.som.settings.learning,q.mapViewOptions.som.settings.neighborhood,o,q.mapViewOptions.som.settings.threads,q.data.columnKeys,t,q.selectedParamsForCalc,q.mapViewOptions.som.settings.preserveTopology,q.mapViewOptions.som.settings.maxPointsForCalc);q.refresh({iaEventSource:"getSomResults"});if(this.data.rowKeys.length<q.mapViewOptions.pcPlot.maxPoints){}var k=document.getElementById("somLoadingBarContainer");var r=document.getElementById("somLoadingBar");if(!k&&!r){var k=document.createElement("div");k.id="somLoadingBarContainer";var l=document.createElement("div");l.id="somLoadingText";l.textContent=a.translate("SOM_CALC_MSG")+"...";var r=document.createElement("div");r.id="somLoadingBar";k.appendChild(r);var s=document.getElementById("somContainerDiv");s.appendChild(l);s.appendChild(k)}q.pollSomStatus()}else{document.getElementById("mapView").textContent=a.translate("no_available_params_msg")}};b.prototype.pollSomStatus=function(){var m=this;var l;var k=e.getSomStatus({noSpinner:true},l);var j=document.getElementById("somContainerDiv");var i=document.getElementById("somLoadingBar");k.done(function(o){var p=["NOT_AVAILABLE","READY","ERROR_NO_POINTS","ERROR_NO_DATA"];if(parseInt(o)===parseFloat(o)){l=p[parseInt(o)]}else{l=parseFloat(o)}m.somStatus=l;console.log("Current som. status: "+l);if((l!=="READY"&&l!=="ERROR_NO_POINTS"&&l!=="ERROR_NO_DATA")||l===1){window.setTimeout(function(){m.pollSomStatus()},1000)}if(l==="READY"){j.classList.remove("sim-ui-som-loading");if(document.getElementById("somLoadingBarContainer")){d3.select("#somLoadingBarContainer").remove();d3.select("#somLoadingText").remove()}var n={};e.spinnerControlShow();e.getSomResults(n).done(function(){m.somResults=n.content;m.createAllSOMs()})}else{if(l==="ERROR_NO_POINTS"){if(document.getElementById("somLoadingBarContainer")){d3.select("#somLoadingBarContainer").remove();d3.select("#somLoadingText").remove()}document.getElementById("somDiv").textContent=a.translate("no_usable_data_som_msg")}else{if(l==="ERROR_NO_DATA"){if(document.getElementById("somLoadingBarContainer")){d3.select("#somLoadingBarContainer").remove();d3.select("#somLoadingText").remove()}document.getElementById("somDiv").textContent=a.translate("not_enough_data_som")}else{if(typeof l!=="string"){j.classList.add("sim-ui-som-loading");i.style.width=l*100+"%"}}}}})};b.prototype.makeSelectParamPopover=function(){var n=this;var k=c("<div></div>",{id:"paramsPopover"});var s;var p;var q;for(var m=0;m<this.data.columnKeys.length;m++){for(var l=0;l<this.data.usedColumnKeys.length;l++){if(this.data.columnKeys[m]===this.data.usedColumnKeys[l]){q=true;break}else{q=false}}s=c("<div></div>",{id:"#_"+this.data.columnKeys[m],"class":"sim-ui-map-view-params"}).appendTo(k);p=c("<input />",{type:"checkbox",id:"cb_"+this.data.columnKeys[m],value:this.data.columnKeys[m]}).appendTo(s);p.prop("checked",q);c("<label />",{"for":"cb_"+this.data.columnKeys[m],text:this.data.columns[this.data.columnKeys[m]].displayName}).appendTo(s)}var o=c("<div></div>",{id:"calcParamsPopover"});var s;var p;var q;for(var m=0;m<this.data.columnKeys.length;m++){if(this.selectedParamsForCalc[m]){q=true}else{q=false}s=c("<div></div>",{id:"#calc_"+this.data.columnKeys[m],"class":"sim-ui-map-view-params"}).appendTo(o);p=c("<input />",{type:"checkbox",id:"calc_cb_"+this.data.columnKeys[m],value:this.data.columnKeys[m]}).appendTo(s);p.prop("checked",q);c("<label />",{"for":"calc_cb_"+this.data.columnKeys[m],text:this.data.columns[this.data.columnKeys[m]].displayName}).appendTo(s)}var r=function(){var i=c('<button style="margin:4px;">OK</button>').on("click",function(){n.data.usedColumnKeys=[];k.children(".sim-ui-map-view-params").children("input").each(function(){if(this.checked){n.data.usedColumnKeys.push(this.value)}else{for(var v=0;v<n.data.columnKeys.length;v++){if(n.data.usedColumnKeys[v]===this.value){n.data.usedColumnKeys.splice(v,1)}}}});var u=0;var j=false;o.children(".sim-ui-map-view-params").children("input").each(function(){if(n.selectedParamsForCalc[u]!==this.checked){j=true}n.selectedParamsForCalc[u]=this.checked;u++});f.closePopover();if(j){n.getSOMResults()}else{n.refresh();n.createAllSOMs()}});return i};var t={width:550,height:550,footerOptions:{type:"button",content:r}};f.makePopover([a.translate("Shown In Map"),a.translate("Used For SOM Calculations")],[k,o],a.translate("Select Parameters"),"sim-ui-som-params-popover",t)};b.prototype.makeOptionsPopover=function(){var j=this;var i={};e.getPageOptions("shopDesignsPage",i).done(function(){var n=i.content;if(!c.isEmptyObject(n)&&n.somSettings){if(typeof n.somSettings.threads!=="undefined"){j.mapViewOptions.som.settings.threads=n.somSettings.threads}if(typeof n.somSettings.preserveTopology!=="undefined"){j.mapViewOptions.som.settings.preserveTopology=n.somSettings.preserveTopology}}var m=null;var q=c("<div></div>",{id:"optionsPopover"});var o=Object.create(j.mapViewOptions.som.settings);var v=c("<div>",{id:"topologyDiv","class":"sim-ui-som-option"}).append("<span>"+a.translate("Best SOM Type")+":</span>",{"class":"sim-ui-som-options-name"}).appendTo(q);var p=o.preserveTopology;var l=function(){o.preserveTopology=JSON.parse(c(this).val())};c("<select>",{id:"topologyField","class":"sim-ui-som-options-select"}).append("<option value=true>"+a.translate("Preserve topology of sample space")+"</option>").append("<option value=false>"+a.translate("Maximize resolution of fit")+"</option>").val(String(p)).change(l).appendTo(v);var k=c("<div>",{id:"threadsDiv","class":"sim-ui-som-option"}).append("<span>"+a.translate("num_parallel_calc_som")+"</span>",{"class":"sim-ui-som-options-name"}).appendTo(q);var r=c("<input></input>",{id:"threadsField","class":"sim-ui-som-options-input"}).appendTo(k);r.val(o.threads);r.on("change",function(){var x=parseInt(c(this).val(),10);if(isNaN(x)){m="Number of runs"}else{o.threads=x;m=null}});var u=c("<div>",{id:"maxPointsDiv","class":"sim-ui-som-option"}).append("<span>"+a.translate("max_samples_for_calc")+" </span>",{"class":"sim-ui-som-options-name"}).appendTo(q);var t=c("<input></input>",{id:"maxPointsField","class":"sim-ui-som-options-input"}).appendTo(u);t.val(o.maxPointsForCalc);t.on("change",function(){var x=parseInt(c(this).val(),10);if(isNaN(x)){m="Max Points"}else{o.maxPointsForCalc=x;m=null}});var s=function(){var x=c('<button style="margin:4px;">OK</button>').on("click",function(){if(m===null){var z=true;for(var y=0;y<Object.keys(o).length;y++){if(j.mapViewOptions.som.settings[Object.keys(o)[y]]!==o[Object.keys(o)[y]]){z=false;break}}if(!z){e.executeCommand({commandName:"setPageOptionsFromJson",data:{pageName:"shopDesignsPage",pageOptions:JSON.stringify({somSettings:{preserveTopology:o.preserveTopology,threads:o.threads,maxPointsForCalc:o.maxPointsForCalc}})}});j.mapViewOptions.som.settings=o;j.getSOMResults()}f.closePopover()}else{alert(a.translate("Invalid value val",m))}});return x};var w={width:600,height:200,noTabs:true,footerOptions:{type:"button",content:s}};f.makePopover([],[q],a.translate("SOM Options"),"sim-ui-som-options-popover",w)})};return b});define("DS/SMAAnalyticsUI/SMAAnalyticsProfiler",["DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/WebappsUtils/WebappsUtils","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(g,l,f,d,n,p,i,e){if(!Array.prototype.findIndex){Object.defineProperty(Array.prototype,"findIndex",{enumerable:false,configurable:true,writable:true,value:function(q){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof q!=="function"){throw new TypeError("predicate must be a function")}var v=Object(this);var t=v.length>>>0;var r=arguments[1];var u;for(var s=0;s<t;s++){if(s in v){u=v[s];if(q.call(r,u,s,v)){return s}}}return -1}})}var k=[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,0.18577770618460315],c=[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],j=[0.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],b=[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],h=[0.30532663496123236,0.36034489994980445,0.12578172611122926,0.016083785148742275,0.0006587491615298378,0.016315387137302097],a=[2.568520192289822,1.8729528499234604,0.5279051029514285,0.06051834131244132,0.0023352049762686918];var o=function(A){var t=0,s=Math.abs(A),x=null,w=null,v=null,u=null,r=null,C=null,B=null;if(s<=0.46875){x=k;w=c;u=s*s;r=x[4]*u;C=u;for(var q=0;q<3;q++){r=(r+x[q])*u;C=(C+w[q])*u}t=A*(r+x[3])/(C+w[3])}else{if(s<=4){x=j;w=b;u=s;r=x[8]*u;C=u;for(q=0;q<7;q++){r=(r+x[q])*u;C=(C+w[q])*u}t=(r+x[7])/(C+w[7]);v=(u*16)/16;B=(u-v)*(u+v);t=Math.exp(-v*v)*Math.exp(-B)*t}else{x=h;w=a;v=s;u=1/(v*v);r=x[5]*u;C=u;for(q=0;q<4;q++){r=(r+x[q])*u;C=(C+w[q])*u}t=u*(r+x[4])/(C+w[4]);t=(1/Math.sqrt(4*Math.atan(1))-t)/v;u=(v*16)/16;B=(v-u)*(v+u);t=Math.exp(-u*u)*Math.exp(-B)*t}}if(A>0.46875){t=(0.5-t)+0.5}if(A<-0.46875){t=(-0.5+t)-0.5}return t};function m(q){this.dimensions={minCellHeight:200,minCellWidth:200,xAxisHeight:26,stdDevCtrlHeight:0,yAxisWidth:100,bottomHeight:130,leftWidth:100,rightWidth:260,scrollWidth:g.getScrollWidth(),utilsWidth:200-g.getScrollWidth()/2,measuresWidth:70,rightWidthClosed:g.getScrollWidth(),utilsToggleWidth:20,svgPadding:0,xAxisPad:0.05,yAxisPad:0.05,cellWidth:100,cellHeight:100,inputs:{},outputs:{}};this.zoomResolution=5;this.showUtils=true;this.selectedUtilsView="Utility Plot";this.currentApproximation=null;this.approxColors={};this.containerDivs={leftContent:document.createElement("div"),leftFooter:document.createElement("div"),mainSVGFooter:document.createElement("div"),mainSVGContent:document.createElement("div"),mainSVGOverlayX:document.createElement("div"),mainSVGOverlayY:document.createElement("div"),rightSVGContent:document.createElement("div"),rightSVGFooter:document.createElement("div")};this.containerDivs.leftContent.classList.add("profiler-leftContentDiv");this.containerDivs.leftFooter.classList.add("profiler-leftFooterDiv");this.containerDivs.mainSVGFooter.classList.add("profiler-mainSVGFooter");this.containerDivs.mainSVGContent.classList.add("profiler-mainSVGContent");this.containerDivs.mainSVGOverlayX.classList.add("profiler-mainSVGOverlay");this.containerDivs.mainSVGOverlayY.classList.add("profiler-mainSVGOverlay");this.containerDivs.rightSVGFooter.classList.add("profiler-rightSVGFooter");this.containerDivs.rightSVGContent.classList.add("profiler-rightSVGContent");this.shadowDivs={rightShadow:document.createElement("div"),leftShadow:document.createElement("div"),topShadow:document.createElement("div"),bottomShadow:document.createElement("div")};this.shadowDivs.rightShadow.classList.add("profiler-rightShadow");this.shadowDivs.leftShadow.classList.add("profiler-leftShadow");this.shadowDivs.topShadow.classList.add("profiler-topShadow");this.shadowDivs.bottomShadow.classList.add("profiler-bottomShadow");var r=this;this.utilsToggle=document.createElement("div");this.utilsToggle.classList.add("toggle-utilPanel");this.utilsToggle.onclick=function(){r.toggleUtilitiesPanel()};d3.select(this.containerDivs.rightSVGContent).on("scroll",function(){r.syncScroll()});d3.select(this.containerDivs.mainSVGFooter).on("scroll",function(){r.syncScroll()});this.svgs={left:document.createElementNS("http://www.w3.org/2000/svg","svg"),main:document.createElementNS("http://www.w3.org/2000/svg","svg"),mainFooter:document.createElementNS("http://www.w3.org/2000/svg","svg"),right:document.createElementNS("http://www.w3.org/2000/svg","svg"),rightFooter:document.createElementNS("http://www.w3.org/2000/svg","svg")};this.svgs.left.setAttribute("class","svg-leftSVG");this.svgs.main.setAttribute("class","svg-mainSVG");this.svgs.mainFooter.setAttribute("class","svg-mainSVGFooter");this.svgs.right.setAttribute("class","svg-rightSVG");this.svgs.rightFooter.setAttribute("class","svg-rightSVGFooter");this.divs={leftBackgroundDiv:document.createElement("div"),footerLeftScrollDiv:document.createElement("div"),footerRightScrollDiv:document.createElement("div"),leftTopScrollDiv:document.createElement("div"),leftBottomScrollDiv:document.createElement("div")};this.divs.leftBackgroundDiv.classList.add("profiler-leftBackgroundDiv");this.divs.footerLeftScrollDiv.classList.add("profiler-footerLeftScrollDiv");this.divs.footerRightScrollDiv.classList.add("profiler-footerRightScrollDiv");this.divs.leftTopScrollDiv.classList.add("profiler-leftTopScrollDiv");this.divs.leftBottomScrollDiv.classList.add("profiler-leftBottomScrollDiv");this.containerDivs.leftContent.appendChild(this.svgs.left);this.containerDivs.mainSVGContent.appendChild(this.svgs.main);this.containerDivs.mainSVGFooter.appendChild(this.svgs.mainFooter);this.containerDivs.rightSVGContent.appendChild(this.svgs.right);this.containerDivs.rightSVGFooter.appendChild(this.svgs.rightFooter);this.state={initialized:false,rootDiv:false,dataSource:false,scales:false,measuresDisabled:false};this.constants={numInputs:0,numOutputs:0};if(typeof q!=="undefined"){if(typeof q.rootDiv!=="undefined"){this.setRootDiv(q.rootDiv)}if(q.showVariance){this.dimensions.stdDevCtrlHeight=50;this.dimensions.bottomHeight+=this.dimensions.stdDevCtrlHeight}this.options=q}this.data={};this.scales={x:{},y:{}};this.axes={x:{},y:{}};this.dragContext=null}m.prototype.toggleUtilitiesPanel=function(){var s=this;this.containerDivs.rightSVGContent.closedWidth=s.dimensions.rightWidthClosed;this.containerDivs.rightSVGContent.openedWidth=s.dimensions.rightWidth-4;this.containerDivs.rightSVGFooter.closedWidth=0;this.containerDivs.rightSVGFooter.openedWidth=s.dimensions.rightWidth-4;this.containerDivs.mainSVGContent.closedRightOffset=s.dimensions.rightWidthClosed+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGContent.openedRightOffset=s.dimensions.rightWidth+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGOverlayX.closedRightOffset=s.dimensions.rightWidthClosed+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGOverlayX.openedRightOffset=s.dimensions.rightWidth+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGOverlayY.closedRightOffset=s.dimensions.rightWidthClosed+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGOverlayY.openedRightOffset=s.dimensions.rightWidth+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGFooter.closedRightOffset=s.dimensions.rightWidthClosed+s.dimensions.utilsToggleWidth;this.containerDivs.mainSVGFooter.openedRightOffset=s.dimensions.rightWidth+s.dimensions.utilsToggleWidth;this.shadowDivs.rightShadow.closedRightOffset=s.dimensions.rightWidthClosed+s.dimensions.utilsToggleWidth;this.shadowDivs.rightShadow.openedRightOffset=s.dimensions.rightWidth+s.dimensions.utilsToggleWidth;this.shadowDivs.bottomShadow.closedRightOffset=s.dimensions.rightWidthClosed+s.dimensions.utilsToggleWidth;this.shadowDivs.bottomShadow.openedRightOffset=s.dimensions.rightWidth+s.dimensions.utilsToggleWidth;this.utilsToggle.closedRightOffset=(this.dimensions.svgHeight>this.containerDivs.rightSVGContent.clientHeight)?s.dimensions.rightWidthClosed:0;this.utilsToggle.openedRightOffset=s.dimensions.rightWidth;var r=function(){return this.closedWidth+"px"};var u=function(){return this.openedWidth+"px"};var t=function(){return this.closedRightOffset+"px"};var q=function(){return this.openedRightOffset+"px"};if(this.showUtils){d3.selectAll([this.containerDivs.rightSVGContent,this.containerDivs.rightSVGFooter]).transition().duration(300).ease("quad").style("width",r);d3.selectAll([this.containerDivs.mainSVGContent,this.containerDivs.mainSVGOverlayX,this.containerDivs.mainSVGOverlayY,this.containerDivs.mainSVGFooter,this.shadowDivs.rightShadow,this.shadowDivs.bottomShadow,this.utilsToggle]).transition().duration(300).ease("quad").style("right",t);this.showUtils=false;this.utilsToggle.classList.add("closed")}else{d3.selectAll([this.containerDivs.rightSVGContent,this.containerDivs.rightSVGFooter]).transition().duration(300).ease("quad").style("width",u);d3.selectAll([this.containerDivs.mainSVGContent,this.containerDivs.mainSVGOverlayX,this.containerDivs.mainSVGOverlayY,this.containerDivs.mainSVGFooter,this.shadowDivs.rightShadow,this.shadowDivs.bottomShadow,this.utilsToggle]).transition().duration(300).ease("quad").style("right",q);this.showUtils=true;this.utilsToggle.classList.remove("closed")}this.syncScroll()};m.prototype.setClosedRightOffset=function(){var r=this;this.utilsToggle.closedRightOffset=(this.dimensions.svgHeight>this.containerDivs.rightSVGContent.clientHeight)?r.dimensions.rightWidthClosed:0;if(!(this.showUtils)){var s=function(){return this.closedRightOffset+"px"};var q=function(){return this.closedWidth+"px"};d3.selectAll([this.containerDivs.rightSVGContent,this.containerDivs.rightSVGFooter]).style("width",q);d3.selectAll([this.containerDivs.mainSVGContent,this.containerDivs.mainSVGOverlayX,this.containerDivs.mainSVGOverlayY,this.containerDivs.mainSVGFooter,this.shadowDivs.rightShadow,this.shadowDivs.bottomShadow,this.utilsToggle]).style("right",s);this.syncScroll()}};m.prototype.syncScroll=function(){var q=this.containerDivs.mainSVGFooter.scrollLeft,r=this.containerDivs.rightSVGContent.scrollTop;this.containerDivs.leftContent.scrollTop=r;this.containerDivs.mainSVGContent.scrollTop=r;this.containerDivs.mainSVGContent.scrollLeft=q;this.containerDivs.mainSVGOverlayX.scrollLeft=q;this.containerDivs.mainSVGOverlayY.scrollTop=r;if(r<2){this.shadowDivs.topShadow.classList.add("profiler-hiddenShadow")}else{}if(this.containerDivs.rightSVGContent.scrollHeight-this.containerDivs.rightSVGContent.clientHeight-r<2){this.shadowDivs.bottomShadow.classList.add("profiler-hiddenShadow")}else{}if(q<2){this.shadowDivs.leftShadow.classList.add("profiler-hiddenShadow")}else{this.shadowDivs.leftShadow.classList.remove("profiler-hiddenShadow")}if(this.containerDivs.mainSVGFooter.scrollWidth-this.containerDivs.mainSVGFooter.clientWidth-q<2){this.shadowDivs.rightShadow.classList.add("profiler-hiddenShadow")}else{this.shadowDivs.rightShadow.classList.remove("profiler-hiddenShadow")}};m.prototype.setRootDiv=function(r){this.containerDivs.rootDiv=r;if(r&&typeof r.empty==="function"){this.containerDivs.rootDiv.empty()}this.dimensions.rootHeight=r.offsetHeight;this.dimensions.rootWidth=r.offsetWidth;this.containerDivs.rootDiv.appendChild(this.divs.leftBackgroundDiv);this.containerDivs.rootDiv.appendChild(this.containerDivs.leftContent);this.containerDivs.rootDiv.appendChild(this.containerDivs.mainSVGContent);this.containerDivs.rootDiv.appendChild(this.containerDivs.mainSVGOverlayY);this.containerDivs.rootDiv.appendChild(this.containerDivs.mainSVGOverlayX);this.containerDivs.rootDiv.appendChild(this.containerDivs.mainSVGFooter);this.containerDivs.rootDiv.appendChild(this.containerDivs.rightSVGContent);this.containerDivs.rootDiv.appendChild(this.containerDivs.rightSVGFooter);this.containerDivs.rootDiv.appendChild(this.utilsToggle);var q;for(q in this.shadowDivs){this.containerDivs.rootDiv.appendChild(this.shadowDivs[q])}this.state.rootDiv=true;this.dataSource=null};m.prototype.initializeProfiler=function(q,t,r){if(this.state.rootDiv===false){console.log("define root div prior to initialization!");return}var s=this;this.initializeData(q,t).done(function(){s.buildProfilerComponents(s)});if(r&&r.interactiveUpdate){this.interactiveUpdate=r.interactiveUpdate}};m.prototype.resize=function(){this.dimensions.rootHeight=this.containerDivs.rootDiv.offsetHeight;this.dimensions.rootWidth=this.containerDivs.rootDiv.offsetWidth;this.updateProfilerComponents()};m.prototype.updateProfilerMeasures=function(){if(l.approximations[sessionInfo.predictPage.selectedApproxIds[0]].status==="READY"){this.buildMeasuresColumn();this.updateMeasuresColumn()}};m.prototype.updateProfiler=function(r,t,q){var s=this;this.initializeData(r,t,q).done(function(){s.updateProfilerComponents(s)})};m.prototype.updateProfilerData=function(q,s){if(this.state.rootDiv===false){console.log("define root div prior to update!");return}var r=this;return this.updateData(q,s)};m.prototype.buildProfilerComponents=function(q){q.initializeDataDimensions();q.buildScales();q.buildPlots();q.buildAxes();q.buildPeripherals();q.buildUtilityColumnDisplayOptions();q.buildUtilityColumn();if(l.approximations[sessionInfo.predictPage.selectedApproxIds[0]].status==="READY"){q.buildMeasuresColumn();q.updateMeasuresColumn()}};m.prototype.updateProfilerComponents=function(){this.updateInputDimensions();this.updateOutputDimensions();this.updateScaleData();this.updateRows();this.updatePlots({updateColumnData:true});this.updateAxes({updateData:true});this.updatePeripherals();this.updateValueText({disableCallback:true});this.updateUtilityColumn();if(l.approximations[sessionInfo.predictPage.selectedApproxIds[0]].status==="READY"){this.buildMeasuresColumn();this.updateMeasuresColumn()}};m.prototype.initializeDataDimensions=function(){this.updateInputDimensions();this.updateOutputDimensions();this.syncScroll()};m.prototype.updateInputDimensions=function(){this.constants.numInputs=this.data.inputKeys.length;var r=this.dimensions.rootWidth-this.dimensions.leftWidth-this.dimensions.rightWidth-12;this.dimensions.cellWidth=Math.floor(Math.max(r/this.constants.numInputs,this.dimensions.minCellWidth));this.dimensions.mainWidth=Math.floor(this.dimensions.cellWidth*this.constants.numInputs);this.dimensions.svgWidth=Math.floor(this.dimensions.mainWidth+this.dimensions.svgPadding);if(this.containerDivs.mainSVGFooter.offsetWidth===this.dimensions.svgWidth){d3.select(this.containerDivs.mainSVGFooter).style("overflow","hidden")}d3.select(this.svgs.main).style({width:this.dimensions.svgWidth+"px","min-width":this.containerDivs.mainSVGFooter.offsetWidth+"px"});d3.select(this.svgs.mainFooter).style({width:this.dimensions.svgWidth-1+"px","min-width":this.containerDivs.mainSVGFooter.offsetWidth-2+"px"});for(var q=0;q<this.data.inputKeys.length;q++){this.dimensions.inputs[this.data.inputKeys[q]]={x:this.dimensions.cellWidth*q}}};m.prototype.updateOutputDimensions=function(){this.constants.numOutputs=this.data.outputKeys.length;var r=this.dimensions.rootHeight-this.dimensions.bottomHeight-this.dimensions.svgPadding-4;this.dimensions.cellHeight=Math.max(r/this.constants.numOutputs,this.dimensions.minCellHeight);this.dimensions.mainHeight=this.dimensions.cellHeight*this.constants.numOutputs;this.dimensions.svgHeight=this.dimensions.mainHeight+this.dimensions.svgPadding;d3.select(this.svgs.main).style("height",this.dimensions.svgHeight+"px");d3.select(this.svgs.right).style("height",this.dimensions.svgHeight+"px");d3.select(this.svgs.left).style("height",this.dimensions.svgHeight+"px");var q=0;for(q=0;q<this.data.outputKeys.length;q++){this.dimensions.outputs[this.data.outputKeys[q]]={y:this.dimensions.cellHeight*q}}this.setClosedRightOffset()};m.prototype.buildScales=function(){this.scales.x={};this.scales.y={};this.scales.x.utility={};this.scales.x.utility.full=d3.scale.linear();this.scales.x.utility.limited=d3.scale.linear();this.state.scales=true;this.updateScaleData()};m.prototype.updateScaleData=function(){var s,r,q;for(s in this.scales.x){if(typeof this.data.inputs[s]==="undefined"&&s!=="utility"){delete this.scales.x[s]}}for(s in this.data.inputs){if(typeof this.scales.x[s]==="undefined"){this.scales.x[s]={};this.scales.x[s].full=d3.scale.linear();this.scales.x[s].limited=d3.scale.linear()}}for(s in this.scales.y){if(this.data.outputKeys.indexOf(s)===-1){delete this.scales.y[s]}}for(r=0;r<this.data.outputKeys.length;r++){s=this.data.outputKeys[r];if(typeof this.scales.y[s]==="undefined"){this.scales.y[s]={full:d3.scale.linear().range([this.dimensions.cellHeight,0]),limited:d3.scale.linear().range([this.dimensions.cellHeight*0.9,this.dimensions.cellHeight*0.1])}}}this.updateScales()};m.prototype.updateScales=function(){if(this.state.scales===false){this.buildScales();return}var s,r,t,u,q;for(s in this.data.inputs){t=this.data.inputs[s].zoomMax-this.data.inputs[s].zoomMin;u=this.data.inputs[s].zoomMin-t*0.05;q=this.data.inputs[s].zoomMax+t*0.05;this.scales.x[s].full.domain([u,q]).range([0,this.dimensions.cellWidth]);this.scales.x[s].limited.domain([u+t*this.dimensions.xAxisPad,q-t*this.dimensions.xAxisPad]).range([this.dimensions.cellWidth*this.dimensions.xAxisPad,this.dimensions.cellWidth*(1-this.dimensions.xAxisPad)])}this.scales.x.utility.full.domain([-0.05,1.05]).range([0,this.dimensions.utilsWidth]);this.scales.x.utility.limited.domain([0,1]).range([this.dimensions.utilsWidth*(0.05/1.1),this.dimensions.utilsWidth*(1.05/1.1)]);this.zoomOutputScales()};m.prototype.zoomOutputScales=function(){var u,s,r,E,z,y,x,C;var w,q;var A={};var D=function(G){return G>=q.zoomMin},t=function(G){return G>=q.zoomMax};var v,B;for(u=0;u<this.data.inputKeys.length;u++){z=this.data.inputKeys[u];q=this.data.inputs[z];A[z]=[q.points.findIndex(D),q.points.findIndex(t)]}for(r=0;r<this.data.outputKeys.length;r++){E=this.data.outputKeys[r];C=-Infinity;x=Infinity;for(y in this.data.approximations){w=this.data.approximations[y].outputs[E];for(s=0;s<this.data.inputKeys.length;s++){z=this.data.inputKeys[s];for(u=A[z][0];u<=A[z][1];u++){if(w.values[z][u]<x){x=w.values[z][u]}if(w.values[z][u]>C){C=w.values[z][u]}}}w.valueZoomMin=x;w.valueZoomMax=C}var F=C-x;this.scales.y[E].full.range([this.dimensions.cellHeight,0]).domain([x-F*0.125,C+F*0.125]);this.scales.y[E].limited.range([this.dimensions.cellHeight*0.9,this.dimensions.cellHeight*0.1]).domain([x,C])}};m.prototype.buildAxes=function(){var q=this;if(!this.svgs.xAxisGroup){this.svgs.xAxisGroup=d3.select(this.svgs.mainFooter).append("g").classed(".profiler-xAxisGroup",true).attr("transform","translate(0,1)")}this.updateXAxes({updateData:true});if(!this.svgs.yAxisGroup){this.svgs.yAxisGroup=d3.select(this.svgs.left).append("g").classed("profiler-yAxisGroup",true).attr("transform","translate(-2,0)")}this.updateYAxes({updateData:true})};m.prototype.updateAxes=function(q){var r=this;this.updateXAxes(q);this.updateYAxes(q)};m.prototype.updateXAxes=function(r){r=r||{};var v=this;var w=this.data.inputKeys.map(function(x){return v.data.inputs[x]});var t=function(x){return g.formatExp(x,2)};Math.log10=Math.log10||function(y){return Math.log(y)*Math.LOG10E};var u=function(A,y){var x=40;var B=Math.log10(y-A);var C=A===0?0:Math.log10(A);var z=y===0?0:Math.log10(y);if(B<0){var D=8*(Math.ceil(Math.abs(B))+3);if(D>x){x=D}}else{if(C>3){var D=8*(Math.ceil(Math.abs(C))+2);if(D>x){x=D}}else{if(z>3){var D=8*(Math.ceil(Math.abs(z))+2);if(D>x){x=D}}}}return x};var s;for(s=0;s<w.length;s++){var q=u(w[s].min,w[s].max);this.axes.x[w[s].ID]=d3.svg.axis().scale(this.scales.x[w[s].ID].limited).tickSize(2,0).orient("bottom").tickFormat(t).ticks(Math.floor(this.dimensions.cellWidth/q))}if(r.updateData===true){this.svgs.xAxes=this.svgs.xAxisGroup.selectAll(".profiler-xAxisGroup").data(this.data.inputKeys.map(function(x){return v.data.inputs[x]}),function(x){return x.ID});this.svgs.xAxes.exit().remove();this.svgs.xAxes.enter().append("g").classed("profiler-xAxisGroup",true)}this.svgs.xAxes.each(function(x){if(r.animateUpdate===true){d3.select(this).transition().attr("transform",function(y){return("translate("+v.dimensions.inputs[y.ID].x+",0)")}).call(v.axes.x[x.ID])}else{d3.select(this).attr("transform",function(y){return("translate("+v.dimensions.inputs[y.ID].x+",0)")}).call(v.axes.x[x.ID])}})};m.prototype.updateYAxes=function(y){y=y||{};var u=this;if(y.updateData===true){var v=this.data.outputKeys.map(function(z){return u.data.outputs[z]});var q=function(z){return g.formatExp(z,2)};for(var s=0;s<v.length;s++){this.axes.y[v[s].ID]=d3.svg.axis().scale(this.scales.y[v[s].ID].limited).tickSize(2,0).tickPadding(10).tickFormat(q).orient("left")}var t=this.svgs.yAxisGroup.selectAll(".profiler-yAxis").data(this.data.outputKeys.map(function(z){return u.data.outputs[z]}),function(z){return z.ID});t.exit().remove();t.enter().append("g").classed("profiler-yAxis",true);var w=this.svgs.yAxisGroup.selectAll(".profiler-axisTextGroup").data(this.data.outputKeys.map(function(z){return u.data.outputs[z]}),function(z){return z.ID});w.exit().remove();var x=w.enter().append("g").classed("profiler-axisTextGroup",true);x.append("g").classed("profiler-yAxisValueTextGroup",true);this.svgs.yAxisValGroups=w.select(".profiler-yAxisValueTextGroup");this.svgs.yAxisValGroups.each(function(z){var A=function(C){return{output:z,approxId:C,approximation:u.data.approximations[C]}};var B=d3.select(this).selectAll(".profiler-axisText").data(Object.keys(u.data.approximations).map(A));B.exit().remove();B.enter().append("text").classed("profiler-axisText",true).attr("y",34).attr("text-anchor","middle");B.style("fill",function(C){return u.approxColors[C.approxId]}).attr("x",function(F,D){var H=75,E=10,G=Object.keys(u.data.approximations).length;var C=G*H+(G-1)*E;return(D*(H+E)+H/2-C/2)}).each(function(E){var C=u.parseMeanStdDev(E.output,E.approxId);if(sessionInfo.predictPage.selectedApproxIds.length!==1){this.textContent="μ("+C.mean+")"}else{var D="μ("+C.mean+")";if(typeof C.stddev!=="undefined"){D+=" σ("+C.stddev+")"}this.textContent=D}})});x.append("text").classed("profiler-axisLabelText",true).attr("y",18).attr("text-anchor","middle");this.svgs.yAxes=this.svgs.yAxisGroup.selectAll(".profiler-yAxis");this.svgs.yAxisTextGroups=this.svgs.yAxisGroup.selectAll(".profiler-axisTextGroup")}this.svgs.yAxisTextGroups.attr("transform",function(z){return("translate(0,"+(u.dimensions.outputs[z.ID].y+u.dimensions.cellHeight/2)+") rotate(-90)")});this.svgs.yAxes.attr("transform",function(z){return("translate("+u.dimensions.yAxisWidth+","+u.dimensions.outputs[z.ID].y+")")}).each(function(z){d3.select(this).call(u.axes.y[z.ID])});var r=Math.floor((this.dimensions.cellHeight-10)/7);this.svgs.yAxisLabels=this.svgs.yAxisTextGroups.select(".profiler-axisLabelText").each(function(A){var z=decodeURIComponent(A.displayName);if(z.length>=r){z=z.substring(0,r-3)+"..."}this.textContent=z});if(y.textOnly===true){return}this.svgs.yAxes.each(function(z){if(y.animateUpdate===true){d3.select(this).transition().call(u.axes.y[z.ID])}else{d3.select(this).call(u.axes.y[z.ID])}})};m.prototype.buildPeripherals=function(){var q=this;d3.select(this.svgs.left).on("dragover",function(r){d3.event.stopPropagation();d3.event.preventDefault()}).on("drop",function(){var u=JSON.parse(d3.event.dataTransfer.getData("text"));var t=u.id,s=u.source,r=u.resolved;if((r!==true&&s==="profiler-output")||s==="sidebar-output"){q.insertParameter("output",null,t)}});d3.select(this.svgs.mainFooter).on("dragover",function(r){d3.event.stopPropagation();d3.event.preventDefault()}).on("drop",function(v){d3.select(this).classed("profiler-selectedDagHandler",false);var u=JSON.parse(d3.event.dataTransfer.getData("text"));var t=u.id,s=u.source,r=u.resolved;if(r!==true&&s==="profiler-input"||s==="sidebar-input"){q.insertParameter("input",null,t)}u.resolved=true;d3.event.dataTransfer.setData("text",JSON.stringify(u))});this.updatePeripherals()};m.prototype.updatePeripherals=function(){this.updateInputDistributions();this.updateInputPeripherals();this.updateOutputDistributions();this.updateOutputPeripherals()};m.prototype.updateInputDistributions=function(r){if(sessionInfo.predictPage.selectedApproxIds.length===1){var s=this,q=d3.select(this.containerDivs.mainSVGOverlayX).selectAll("ra-normal-distrib").data(this.data.inputKeys.map(function(u){return s.data.inputs[u]}),function(u){return u.ID});q.exit().remove();this.containerDivs.mainSVGOverlayX.style.display="";var t=q.enter().append("ra-normal-distrib");this.divs.xAxisDistribCurves=d3.select(this.containerDivs.mainSVGOverlayX).selectAll("ra-normal-distrib").each(function(x){this.style.position="absolute";this.style.bottom=0;this.style.left=s.dimensions.inputs[x.ID].x+"px";this.style.width=s.dimensions.cellWidth+"px";this.style.height="30px";var w=parseInt(s.dimensions.cellWidth*s.dimensions.xAxisPad,10);this.style.paddingLeft=w+"px";this.style.paddingRight=w+"px";this.set("orientation","horizontal");var v=typeof x.zoomMin==="undefined"?x.min:x.zoomMin;var u=typeof x.zoomMax==="undefined"?x.max:x.zoomMax;this.set("minval",v);this.set("maxval",u);this.set("mean",x.value);if(typeof x.stddev!=="undefined"&&x.stddev>0){this.set("stddev",x.stddev)}else{this.set("stddev")}this._adjustWidth()})}else{this.containerDivs.mainSVGOverlayX.style.display="none"}};m.prototype.updateInputPeripherals=function(r){var t=this;var q=d3.select(this.containerDivs.mainSVGFooter).selectAll(".profiler-xAxisLabelDiv").data(this.data.inputKeys.map(function(u){return t.data.inputs[u]}),function(u){return u.ID});q.exit().remove();var s=q.enter().append("div").classed("profiler-xAxisLabelDiv",true).attr("draggable",true).on("dragstart",function(x){var w={source:"profiler-input",id:x.ID};t.startDrag(w);var v={};for(var u in w){if(w.hasOwnProperty(u)){v[u]=w[u]}}d3.event.dataTransfer.setData("text",JSON.stringify(v))}).on("dragend",function(u){t.endDrag({source:"profiler-input",id:u.ID})}).on("dragenter",function(u){d3.select(this).classed("profiler-selectedDagHandler",true)}).on("dragleave",function(w){var u=this.getBoundingClientRect(),v=d3.event;if(v.x>u.left+u.width||v.x<u.left||v.y>u.top+u.height||v.y<u.top){d3.select(this).classed("profiler-selectedDagHandler",false)}}).on("dragover",function(u){d3.event.stopPropagation();d3.event.preventDefault()}).on("drop",function(x){d3.select(this).classed("profiler-selectedDagHandler",false);var w=JSON.parse(d3.event.dataTransfer.getData("text"));var v=w.id,u=w.source;if(u==="profiler-input"||u==="sidebar-input"){t.insertParameter("input",x.ID,v)}w.resolved=true;d3.event.dataTransfer.setData("text",JSON.stringify(w))}).each(function(A){var C=document.createElement("div");C.classList.add("profiler-xAxisLabel");C.textContent=decodeURIComponent(A.displayName);var D="μ: "+A.value;if(sessionInfo.predictPage.selectedApproxIds.length===1&&typeof A.stddev!=="undefined"){D+="<br />σ: "+A.stddev+"<br />CoV: "+t.calculateCOVFromStdDev(A.stddev,A.value)}C.tooltipInfos=new i({title:A.displayName,shortHelp:D,allowUnsafeHTMLShortHelp:true});var B=document.createElement("label");B.classList.add("profiler-inputMeanLabel");this.appendChild(B);var E=document.createElement("span");E.textContent="μ";E.classList.add("profiler-inputLabel");E.tooltipInfos=new i({shortHelp:e.translate("MEAN")});B.appendChild(E);B.addEventListener("mousedown",function(){this.setAttribute("draggable",false)}.bind(this));B.addEventListener("mouseup",function(){this.setAttribute("draggable",true)}.bind(this));var w=new d({value:A.value,pattern:"[+-]?[0-9]*([.][0-9]+)?([eE][-+]?[0-9]+)?"}).inject(B);w.addEventListener("change",function(H){var I="μ: "+A.value;if(sessionInfo.predictPage.selectedApproxIds.length===1&&typeof A.stddev!=="undefined"){I+="<br />σ: "+A.stddev+"<br />CoV: "+t.calculateCOVFromStdDev(A.stddev,A.value)}C.tooltipInfos.shortHelp=I;if(t.disableCallback){return}var J=Number(w.value);if(!isNaN(J)&&A.min<=J&&J<=A.max){I="μ: "+J;if(sessionInfo.predictPage.selectedApproxIds.length===1&&typeof A.stddev!=="undefined"){I+="<br />σ: "+A.stddev+"<br />CoV: "+t.calculateCOVFromStdDev(A.stddev,A.value)}C.tooltipInfos.shortHelp=I;t.initializeDrag();t.dragInputValue(A.ID,J);var G=A.ID;t.getData().done(function(){t.updateScales();t.updatePlots({updateRowData:true,updateColumnData:true,positionsOnly:true});t.updatePlotLines({inputID:"none",updateAxes:true,animateUpdate:true});t.updateOutputDistributions({outOfDate:false});t.updateUtilityColumn();t.updateValueText();if(typeof t.interactiveUpdate!=="undefined"){t.interactiveUpdate(A.ID,J)}})}else{w.value=A.value}});t.meanEditors=t.meanEditors||{};t.meanEditors[A.ID]=w;var v=new n({displayStyle:"lite",emphasize:"secondary",icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this);v.elements.button.classList.add("profiler-removeButton");v.addEventListener("click",function(){t.removeInput(A.ID)});this.appendChild(C);if(sessionInfo.predictPage.selectedApproxIds.length!==1){this.classList.add("ra-hide-fast-uq")}var z=document.createElement("label");z.classList.add("ra-fast-uq-input");this.appendChild(z);z.addEventListener("mousedown",function(){this.setAttribute("draggable",false)}.bind(this));z.addEventListener("mouseup",function(){this.setAttribute("draggable",true)}.bind(this));var u=null,F=true;var y=new p({elementsList:[{labelItem:"σ",valueItem:"stddev"},{labelItem:"CoV",valueItem:"cov"}],enableSearchFlag:false,displayStyle:"lite",preferredWidth:30}).inject(z);y.tooltipInfos=new i({shortHelp:"σ: "+e.translate("STD_DEV")+"<br />CoV: "+e.translate("COEFFICIENT_OF_VARIATION"),allowUnsafeHTMLShortHelp:true});var x=new d({value:A.stddev,pattern:"[+]?[0-9]*([.][0-9]+)?([eE][-+]?[0-9]+)?"}).inject(z);y.addEventListener("change",function(G){F=false;var H=Number(x.value);if(y.value==="stddev"){u=null;if(!isNaN(H)){x.value=t.calculateStdDevFromCOV(H,w.value)}}else{if(y.value==="cov"){u=t.calculateStdDevFromCOV;if(!isNaN(H)){x.value=t.calculateCOVFromStdDev(H,w.value)}}}F=true});x.addEventListener("change",function(H){if(!F){return}var K=Number(x.value);if(!isNaN(K)){var G=A.ID;var I=t.data.inputs[A.ID];if(u===null){I.stddev=K}else{I.stddev=u(K,w.value)}var J="μ: "+A.value;if(typeof I.stddev!=="undefined"){J+="<br />σ: "+I.stddev+"<br />CoV: "+t.calculateCOVFromStdDev(I.stddev,A.value)}C.tooltipInfos.shortHelp=J;t.stdDevChangedCallback(G,K);t.updateInputDistributions();t.getData().done(function(){t.updateScales();t.updatePlots({updateRowData:true,updateColumnData:true});t.updatePlotLines({inputID:"none",updateAxes:true,animateUpdate:true});t.updateOutputDistributions({outOfDate:false});t.updateUtilityColumn();t.updateValueText()})}else{w.value=A.value}})});this.divs.xAxisLabelDivs=d3.select(this.containerDivs.mainSVGFooter).selectAll(".profiler-xAxisLabelDiv");this.divs.xAxisLabelDivs.each(function(u){this.style.left=t.dimensions.inputs[u.ID].x+"px";this.style.width=t.dimensions.cellWidth+"px";if(sessionInfo.predictPage.selectedApproxIds.length!==1){this.classList.add("ra-hide-fast-uq")}else{this.classList.remove("ra-hide-fast-uq")}})};m.prototype.updateOutputDistributions=function(r){if(sessionInfo.predictPage.selectedApproxIds.length===1){var u=sessionInfo.predictPage.selectedApproxIds[0];var s=this,q=d3.select(this.containerDivs.mainSVGOverlayY).selectAll("ra-normal-distrib").data(this.data.outputKeys.map(function(v){return s.data.outputs[v]}),function(v){return v.ID});q.exit().remove();this.containerDivs.mainSVGOverlayY.style.display="";var t=q.enter().append("ra-normal-distrib");this.divs.yAxisDistribCurves=d3.select(this.containerDivs.mainSVGOverlayY).selectAll("ra-normal-distrib").each(function(D){var C=l.approximations[u].outputVariance,v=C?C[D.name]:undefined,B;if(typeof v!=="undefined"){B=Math.sqrt(v)}var w=s.data.approximations[u],x=w&&w.outputs?w.outputs[D.ID]:null,F=x?x.value:D.value,A=x?x.valueMin:D.min,E=x?x.valueMax:D.max;if(x&&typeof x.valueZoomMin!=="undefined"){A=x.valueZoomMin}if(x&&typeof x.valueZoomMax!=="undefined"){E=x.valueZoomMax}this.style.position="absolute";this.style.left=0;this.style.top=s.dimensions.outputs[D.ID].y+"px";this.style.height=s.dimensions.cellHeight+"px";this.style.width="30px";var y=parseInt(s.dimensions.cellHeight*s.dimensions.yAxisPad,10)*2;this.style.paddingTop=y+"px";this.style.paddingBottom=y+"px";if(r&&r.outOfDate){this.set("outofdate",true)}else{this.set("outofdate",false)}this.set("orientation","vertical");this.set("minval",A);this.set("maxval",E);this.set("mean",F);if(typeof B!=="undefined"&&B>0){this.set("stddev",B)}else{this.set("stddev")}this._adjustWidth();var z=s.calculateFailure(D,u,B);this.set("precision",6);if(typeof z.lower!=="undefined"){this.set("lowerfailvalue",z.lower)}if(typeof z.upper!=="undefined"){this.set("upperfailvalue",z.upper)}})}else{this.containerDivs.mainSVGOverlayY.style.display="none"}};m.prototype.updateOutputPeripherals=function(r){var t=this;var q=d3.select(this.containerDivs.leftContent).selectAll(".profiler-yAxisDragHandler").data(this.data.outputKeys.map(function(u){return t.data.outputs[u]}),function(u){return u.ID});q.exit().remove();var s=q.enter().append("div").classed("profiler-yAxisDragHandler",true).style({width:t.dimensions.yAxisWidth+"px"}).attr("draggable",true).on("dragstart",function(x){var w={source:"profiler-output",id:x.ID};t.startDrag(w);var v={};for(var u in w){if(w.hasOwnProperty(u)){v[u]=w[u]}}d3.event.dataTransfer.setData("text",JSON.stringify(v))}).on("dragend",function(u){t.endDrag({source:"profiler-output",id:u.ID})}).on("dragenter",function(u){d3.select(this).classed("profiler-selectedDagHandler",true)}).on("dragleave",function(w){var u=this.getBoundingClientRect(),v=d3.event;if(v.x>u.left+u.width||v.x<u.left||v.y>u.top+u.height||v.y<u.top){d3.select(this).classed("profiler-selectedDagHandler",false)}}).on("dragover",function(u){d3.event.stopPropagation();d3.event.preventDefault()}).on("drop",function(x){d3.select(this).classed("profiler-selectedDagHandler",false);var w=JSON.parse(d3.event.dataTransfer.getData("text"));var v=w.id,u=w.source;if(u==="profiler-output"||u==="sidebar-output"){t.insertParameter("output",x.ID,v)}w.resolved=true;d3.event.dataTransfer.setData("text",JSON.stringify(w))});s.each(function(v){var u=new n({displayStyle:"lite",emphasize:"secondary",icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this);u.elements.button.classList.add("profiler-removeButton");u.addEventListener("click",function(){t.removeOutput(v.ID)})});this.divs.yAxisDragHandlers=d3.select(this.containerDivs.leftContent).selectAll(".profiler-yAxisDragHandler").each(function(x){var u=t.buildOutputTooltipStrings(x);var v=u.displayText,w=u.longText;if(this.tooltipInfos){this.tooltipInfos.title=v;this.tooltipInfos.shortHelp=w}else{this.tooltipInfos=new i({title:v,shortHelp:w,allowUnsafeHTMLShortHelp:true})}this.style.top=t.dimensions.outputs[x.ID].y+"px";this.style.height=t.dimensions.cellHeight+"px"})};m.prototype.updateValueText=function(q){var s=this;var r=q||{};if(r.disableCallback){this.disableCallback=true}this.divs.xAxisLabelDivs.each(function(u){var t=s.meanEditors[u.ID];if(t){t.value=s.longLabelFormat(u.value)}});this.disableCallback=false;this.svgs.yAxisTextGroups.select(".profiler-yAxisValueTextGroup").each(function(t){d3.select(this).selectAll(".profiler-axisText").each(function(A){var z=s.data.approximations[A.approxId],v=z.outputs[A.output.ID].value,u=s.labelFormat(v);if(sessionInfo.predictPage.selectedApproxIds.length!==1){this.textContent="μ("+u+")"}else{var y=l.approximations[A.approxId].outputVariance,w=y?y[A.output.name]:undefined,B;var x="μ("+u+")";if(typeof w!=="undefined"){B=Math.sqrt(w);B=s.labelFormat(B);x+=" σ("+B+")"}this.textContent=x}})});this.divs.yAxisDragHandlers.each(function(u){var t=s.buildOutputTooltipStrings(u);if(this.tooltipInfos){this.tooltipInfos.title=t.displayText;this.tooltipInfos.shortHelp=t.longText}else{this.tooltipInfos=new i({title:t.displayText,shortHelp:t.longText,allowUnsafeHTMLShortHelp:true})}})};m.prototype.onRemoveOutput=function(q){this._onRemoveOutput=q};m.prototype.removeOutput=function(q){var r=this;this.data.outputKeys.splice(this.data.outputKeys.indexOf(q),1);this.updateOutputDimensions();this.updateOutputDistributions();this.updateOutputPeripherals();this.removeOutputFromApproximation(q);this.buildProfilerComponents(r);if(typeof this._onRemoveOutput==="function"){this._onRemoveOutput(q)}};m.prototype.removeOutputFromApproximation=function(q){var r=this.data.outputs[q];var t=l.approximations[this.currentApproximation];for(var s=0;s<t.outputs.length;s++){if(t.outputs[s].ID==q){t.outputs.splice(s,1);break}}if(t.measures.hasOwnProperty(q)){delete t.measures[q]}for(var s=0;s<t.localEffects.length;s++){if(t.localEffects[s].param==r.name){t.localEffects.splice(s,1);break}}for(var s=0;s<t.globalEffects.length;s++){if(t.globalEffects[s].param==r.name){t.globalEffects.splice(s,1);break}}};m.prototype.onRemoveInput=function(q){this._onRemoveInput=q};m.prototype.removeInput=function(q){var u=this;var t;var s=function(v){return{rowData:t,columnData:u.data.inputs[v]}},r=function(v){return v.columnData.ID};this.data.inputKeys.splice(this.data.inputKeys.indexOf(q),1);this.updateInputDimensions();this.updateScales();this.updateInputDistributions();this.updateXAxes({updateData:true});this.updateInputPeripherals();this.svgs.rows.each(function(w){t=w;var v=d3.select(this).selectAll("g.profiler-plotGroup").data(u.data.inputKeys.map(s),r);v.exit().remove()});this.svgs.plotGroups=this.svgs.rows.selectAll("g.profiler-plotGroup");this.svgs.plots=this.svgs.plotGroups.select(".profiler-plotSVG");this.updatePlots({updateColumnData:true});this.updateOutputDistributions();if(typeof this._onRemoveInput==="function"){this._onRemoveInput(q)}};m.prototype.onAddParameter=function(q){this._onAddParameter=q};m.prototype.insertParameter=function(t,r,q){var s=this;sessionInfo.predictPage.getApproximationErrorMeasures(function(){var w;if(t==="input"){w=s.data.inputKeys}else{if(t==="output"){w=s.data.outputKeys}}var v=w.indexOf(r),u=w.indexOf(q);if(u!==-1){w.splice(v,0,w.splice(u,1)[0]);if(t==="input"){s.updateInputDimensions();s.updateInputDistributions();s.updateInputPeripherals();s.updateXAxes()}else{if(t==="output"){s.updateOutputDimensions();s.updateOutputDistributions();s.updateOutputPeripherals();s.buildMeasuresColumn();s.updateMeasuresColumn();s.updateUtilityColumn();s.updateYAxes()}}s.updatePlots({positionsOnly:true})}else{w.splice(v,0,q);if(t==="input"){s.updateInputDimensions();s.buildScales();s.updateInputDistributions();s.updateXAxes({updateData:true});s.updateInputPeripherals();s.updatePlots({updateColumnData:true});s.updateOutputDistributions()}else{if(t==="output"){s.updateOutputDimensions();s.buildScales();s.updateOutputDistributions();s.updateOutputPeripherals();s.buildMeasuresColumn();s.updateMeasuresColumn();s.updateUtilityColumn();s.updateYAxes({updateData:true});s.updatePlots({updateColumnData:true,updateRowData:true})}}}if(typeof s._onAddParameter==="function"){s._onAddParameter(q,r)}})};m.prototype.line=d3.svg.line().x(function(q){return q[0]}).y(function(q){return q[1]});m.prototype.labelFormat=function(q){return g.formatExp(q,10)};m.prototype.longLabelFormat=function(q){return g.formatExp(q,6)};m.prototype.updateRows=function(){var s=this;var q=function(u){var t={output:s.data.outputs[u],approximations:{}};var v;for(v in s.data.approximations){t.approximations[v]=s.data.approximations[v].outputs[u]}return t};var r=function(t){return t.output.ID};this.svgs.rows=d3.select(this.svgs.main).selectAll("g.profiler-row").data(s.data.outputKeys.map(q),r);this.svgs.rows.exit().remove();this.svgs.rows.enter().append("g").classed("profiler-row",true);this.svgs.rows.attr("transform",function(t){return("translate(0,"+(s.dimensions.outputs[t.output.ID].y+s.dimensions.svgPadding)+")")})};m.prototype.buildPlots=function(){this.updatePlots({updateRowData:true,updateColumnData:true})};m.prototype.updatePlots=function(s){s=s||{};var u=this;var t;if(s.updateRowData===true){this.updateRows()}var r=function(v){return{rowData:t,columnData:u.data.inputs[v]}},q=function(v){return v.columnData.ID};this.svgs.rows.each(function(w){t=w;var v;if(s.updateColumnData===true){v=d3.select(this).selectAll("g.profiler-plotGroup").data(u.data.inputKeys.map(r),q);v.exit().remove();var y=v.enter().append("g").classed("profiler-plotGroup",true);var x=y.append("svg").classed("profiler-plotSVG",true);x.append("rect").classed("profiler-backgroundRect",true);x.append("rect").classed("svg-constraintRect lowerInput",true).attr("x",0).attr("y",0);x.append("rect").classed("svg-constraintRect upperInput",true).attr("y",0);x.append("rect").classed("svg-constraintRect lowerOutput",true).attr("x",0);x.append("rect").classed("svg-constraintRect upperOutput",true).attr("x",0).attr("y",0);x.append("line").attr("y1",0).attr("y2",u.dimensions.cellHeight).classed("profiler-inputLine",true);x.append("g").classed("profiler-outputLineGroup",true);x.append("rect").attr("width",4).attr("y",1).classed("profiler-inputDragRect",true).attr("id",function(z){return"x-"+z.columnData.ID+"y-"+z.rowData.output.ID});x.each(function(B){var z=d3.behavior.drag().on("dragstart",function(){u.initializeDrag()}).on("drag",function(){var C=u.scales.x[B.columnData.ID].full.invert(d3.event.x);if(C>B.columnData.zoomMin&&C<B.columnData.zoomMax){u.dragInputValue(B.columnData.ID,C,true)}}).on("dragend",function(C){u.dragEnd(C.columnData.ID,true)});var A=d3.select(this);A.selectAll(".profiler-inputDragRect, .profiler-inputLine").on("mouseover",function(C){A.selectAll("rect, line").classed("hovered",true)}).on("mouseout",function(C){A.selectAll("rect, line").classed("hovered",false)}).call(z)});x.append("g").classed("profiler-plotPathGroup",true)}else{v=d3.select(this).selectAll("g.profiler-plotGroup")}v.attr("transform",function(z){return("translate("+u.dimensions.inputs[z.columnData.ID].x+",0)")})});this.svgs.plotGroups=this.svgs.rows.selectAll("g.profiler-plotGroup");this.svgs.plots=this.svgs.plotGroups.select(".profiler-plotSVG").attr("height",this.dimensions.cellHeight).attr("width",this.dimensions.cellWidth);this.svgs.plots.select(".profiler-backgroundRect").attr("height",u.dimensions.cellHeight).attr("width",u.dimensions.cellWidth);if(s.positionsOnly===true){return}this.updatePlotLines(s)};m.prototype.updatePlotLines=function(y){var v=this;y=y||{};var s;var q=function(A){var z={output:s.rowData.output,input:s.columnData,plotData:{values:s.rowData.approximations[A].values},approxId:A};return z};var t=function(z){return z.approxId};var u=function(z){var A={output:s.rowData.output,input:s.columnData,lineData:{value:s.rowData.approximations[z].value},approxId:z};return A};var w=function(z){return z.approxId};this.svgs.plots.select(".profiler-plotPathGroup").each(function(z){s=z;var A=d3.select(this).selectAll(".profiler-plotPath").data(Object.keys(v.data.approximations).map(q),t);A.exit().remove();A.enter().append("path").classed("profiler-plotPath",true).style("stroke",function(B){return v.approxColors[B.approxId]})});this.svgs.plots.select(".profiler-outputLineGroup").each(function(A){s=A;var z=d3.select(this).selectAll(".profiler-outputLine").data(Object.keys(v.data.approximations).map(u),w);z.exit().remove();z.enter().append("line").classed("profiler-outputLine",true);z.attr("x1",0).attr("x2",v.dimensions.cellWidth).attr("y1",function(B){return v.scales.y[A.rowData.output.ID].full(B.lineData.value)}).attr("y2",function(B){return v.scales.y[A.rowData.output.ID].full(B.lineData.value)}).each(function(B){})});var x;if(y.animateUpdate===true){x=this.svgs.plots.transition()}else{x=this.svgs.plots}x.select(".profiler-plotPathGroup").selectAll(".profiler-plotPath").attr("d",function(z){return v.line(v.data.approximations[z.approxId].outputs[z.output.ID].values[z.input.ID].map(function(A,B){return[v.scales.x[z.input.ID].full(v.data.inputs[z.input.ID].points[B]),v.scales.y[z.output.ID].full(A)]}))});x.select(".profiler-outputLineGroup").selectAll("profiler-outputLine").attr("x2",v.dimensions.cellWidth).attr("y1",function(z){return v.scales.y[z.output.ID].full(z.lineData.value)}).attr("y2",function(z){return v.scales.y[z.output.ID].full(z.lineData.value)});var r;if(y.inputID){r=x.filter(function(z){return z.columnData.ID===y.inputID})}else{r=x}r.select(".profiler-inputLine").attr("y2",v.dimensions.cellHeight).attr("x1",function(z){return v.scales.x[z.columnData.ID].full(z.columnData.value)}).attr("x2",function(z){return v.scales.x[z.columnData.ID].full(z.columnData.value)});r.select(".profiler-inputDragRect").attr("height",this.dimensions.cellHeight-2).attr("x",function(z){return(v.scales.x[z.columnData.ID].full(z.columnData.value)-2)});this.svgs.plots.each(function(F){var C=0,A=0,D=0,E=0;var B;var z=F.rowData.output;if(typeof F.columnData.formulation!=="undefined"){for(B=0;B<F.columnData.formulation.constraints.length;B++){if(F.columnData.formulation.constraints[B].type==="GREATER_THAN"){C=Math.max(0,v.scales.x[F.columnData.ID].full(F.columnData.formulation.constraints[B].boundValue))}else{if(F.columnData.formulation.constraints[B].type==="LESS_THAN"){A=Math.max(0,v.scales.x[F.columnData.ID].full.range()[1]-v.scales.x[F.columnData.ID].full(F.columnData.formulation.constraints[B].boundValue))}}}}if(typeof z.formulation!=="undefined"){for(B=0;B<z.formulation.constraints.length;B++){if(z.formulation.constraints[B].type==="GREATER_THAN"){E=v.scales.y[z.ID].full.domain()[0]<z.formulation.constraints[B].boundValue?v.scales.y[z.ID].full.range()[0]-v.scales.y[z.ID].full(z.formulation.constraints[B].boundValue):0}else{if(z.formulation.constraints[B].type==="LESS_THAN"){D=z.formulation.constraints[B].boundValue<v.scales.y[z.ID].full.domain()[1]?v.scales.y[z.ID].full(z.formulation.constraints[B].boundValue)-v.scales.y[z.ID].full.range()[1]:0}}}}d3.select(this).select(".lowerInput").attr("height",v.dimensions.cellHeight).attr("width",C);d3.select(this).select(".upperInput").attr("x",v.dimensions.cellWidth-A).attr("height",v.dimensions.cellHeight).attr("width",A);d3.select(this).select(".lowerOutput").attr("y",v.dimensions.cellHeight-E).attr("height",E).attr("width",v.dimensions.cellWidth);d3.select(this).select(".upperOutput").attr("height",D).attr("width",v.dimensions.cellWidth)});if(y.updateAxes===true){this.updateAxes(y)}};m.prototype.initializeDrag=function(){var v,r,u,t,s;var q;for(s=0;s<this.data.outputKeys.length;s++){r=this.data.outputKeys[s];for(u in this.data.approximations){q=this.data.approximations[u].outputs[r];q.lastValue=Number(q.value);q.lastValues={};for(v in q.values){q.lastValues[v]=[];for(t=0;t<q.values[v].length;t++){q.lastValues[v].push(Number(q.values[v][t]))}}}}};m.prototype.setInputChangedCallback=function(q){this.inputChangedCallback=q};m.prototype.setInputStdDevChangedCallback=function(q){this.stdDevChangedCallback=q};m.prototype.dragInputValue=function(s,J,D){var v=this.data.inputs[s].value,q=this.data.inputs[s].points,u,F;var C,B;for(C=1;C<q.length;C++){if(J<=q[C]){F=C-1;u=C;break}}var I=J-q[F];var z,w;var E,G,x,r,A,t,y;for(B=0;B<this.data.outputKeys.length;B++){E=this.data.outputKeys[B];for(x in this.data.approximations){r=this.data.approximations[x].outputs[E];z=r.value;A=r.values[s];y=A[F]+I*((A[u]-A[F])/(q[u]-q[F]));r.value=y;t=y-r.lastValue;for(G in r.values){if(G!==s){for(C=0;C<r.values[G].length;C++){try{r.values[G][C]=r.lastValues[G][C]+t}catch(H){}}}}}}this.data.inputs[s].value=J;if(this.inputChangedCallback){this.inputChangedCallback(s,J)}this.updatePlotLines({inputID:s});this.updateOutputDistributions({outOfDate:true});this.updateUtilityColumn();this.updateValueText({disableCallback:true});this.updateInputDistributions();this.updateInputPeripherals()};m.prototype.dragEnd=function(r,q){var w=this;var u;var t,v;var s=function(x){return x>=w.data.inputs[r].value};this.svgs.rows.each(function(x){v=d3.select(this).selectAll(".profiler-plotSVG").filter(function(y){return y.columnData.ID===r});v.select(".profiler-plotPathGroup").selectAll(".profiler-plotPath").each(function(E){var D=E.approxId,z=E.output,A=E.input;var y=w.data.approximations[D].outputs[z.ID].values[A.ID];var B=A.points.map(function(G,F){return[w.scales.x[A.ID].full(G),w.scales.y[z.ID].full(y[F])]});var C=A.points.findIndex(s);d3.select(this).attr("d",w.line(B))})});this.getData().done(function(){w.updateScales();w.updatePlots({updateRowData:true,updateColumnData:true,positionsOnly:true});w.updatePlotLines({inputID:"none",updateAxes:true,animateUpdate:true});w.updateOutputDistributions({outOfDate:false});w.updateUtilityColumn();w.updateValueText();if(q){w.interactiveUpdate(r,w.data.inputs[r].value)}})};m.prototype.zoomInput=function(q,r,s){if(this.data.inputs[q].zoomMin>this.data.inputs[q].value){this.data.inputs[q].value=this.data.inputs[q].zoomMin}else{if(this.data.inputs[q].zoomMax<this.data.inputs[q].value){this.data.inputs[q].value=this.data.inputs[q].zoomMax}}this.data.inputs[q].zoomMin=r;this.data.inputs[q].zoomMax=s;this.updateScales(q);this.updateInputDistributions();this.updatePlotLines({inputID:q,updateAxes:true});this.updateUtilityPlotColumn()};m.prototype.zoomInputEnd=function(q,r,t){var s=this;this.data.inputs[q].zoomMin=r;this.data.inputs[q].zoomMax=t;this.updateScales(q);this.updateInputDistributions();this.updatePlotLines({inputID:q,updateAxes:true});this.updateInputPoints();this.getData().done(function(u){s.zoomOutputScales();s.updatePlotLines();s.updateUtilityPlotColumn()})};m.prototype.setCurrentApproximation=function(q){this.currentApproximation=q};m.prototype.setDataSource=function(q){if(q==="debug"){this.dataSource=this.debugDataSource}else{this.dataSource=q}this.state.dataSource=true};m.prototype.setLocalEffectsSource=function(q){this.effectsSource=q};m.prototype.setOutputVarianceSource=function(q){this.outputVarianceSource=q};m.prototype.defineColors=function(q){this.approxColors=q};m.prototype.initializeData=function(t,B,x){var w=Math.pow(2,this.zoomResolution)+1;var s,r,q,u,A;this.data={inputs:{},outputs:{},approximations:{}};var y=sessionInfo.predictPage.selectedApproxIds;this.setCurrentApproximation(y[0]);if(typeof x==="undefined"){for(s=0;s<y.length;s++){this.data.approximations[y[s]]={}}}else{for(s=0;s<x.length;s++){this.data.approximations[x[s]]={}}}this.data.inputKeys=t.map(function(C){return C.ID});this.constants.numInputs=this.data.inputKeys.length;t.forEach(function(D){var C=D.currentValue;if(typeof C==="undefined"){C=(D.max+D.min)/2}this.data.inputs[D.ID]=D;this.data.inputs[D.ID].value=C;this.data.inputs[D.ID].zoomMin=D.zoomMin||D.min;this.data.inputs[D.ID].zoomMax=D.zoomMax||D.max},this);this.updateInputPoints();this.data.outputKeys=B.map(function(C){return C.ID});this.constants.numOutputs=this.data.outputKeys.length;var z,v;for(z in this.data.approximations){v=this.data.approximations[z];v.outputs={};B.forEach(function(C){v.outputs[C.ID]=C;v.outputs[C.ID].value=NaN;v.outputs[C.ID].values={};v.outputs[C.ID].valueMax=-Infinity;v.outputs[C.ID].valueMin=Infinity})}B.forEach(function(C){this.data.outputs[C.ID]=C;this.data.outputs[C.ID].valueMax=-Infinity;this.data.outputs[C.ID].valueMin=Infinity},this);return this.getData()};m.prototype.updateData=function(r,s,q){};m.prototype.updateInputPoints=function(r){if(!(r instanceof Array)){r=this.data.inputKeys}var x,w,t,s,z,A,u,q;var C,B;var v=function(D){return D>=t.value};var y;for(x=0;x<r.length;x++){t=this.data.inputs[r[x]];w=0;z=t.max-t.min;A=t.zoomMax-t.zoomMin;s=z/Math.pow(2,this.zoomResolution);y=s*Math.pow(2,Math.floor(Math.log(A/z)/Math.LN2));u=t.min+y*Math.ceil((t.zoomMin-t.min)/y);q=t.min+s*Math.ceil((t.zoomMax-t.min)/s);C=[];B=t.min;while(B<t.zoomMin){C.push(B);B=B+s}B=u;while(B<t.zoomMax-0.5*y){C.push(B);B=B+y}B=q;while(B<t.max-0.5*y){C.push(B);B=B+s}C.push(t.max);t.valueIndex=C.findIndex(v);if(t.valueIndex===-1){throw"Value not in range!"}if(C.indexOf(t.points)===-1){C.splice(t.valueIndex,0,t.value)}t.points=C}};m.prototype.getPointsArg=function(){var q={baselinePoint:{},sweepValues:{}};var r;var z;var t=function(B,A){return Number(B)-A};var s;var y;var x=this;var u=function(A){return A>=x.data.inputs[y].value};var v;var w=Object.keys(this.data.inputs);for(v=0;v<w.length;v++){y=w[v];r=this.data.inputs[y].points;this.data.inputs[y].valueIndex=r.findIndex(u);if(this.data.inputs[y].valueIndex===-1){throw"Value not in range!"}if(r.indexOf(this.data.inputs[y].points)===-1){r.splice(this.data.inputs[y].valueIndex,0,this.data.inputs[y].value)}q.sweepValues[y]=r;q.baselinePoint[y]=this.data.inputs[y].value}return q};m.prototype.getData=function(){var t=this;var q={};var s=this.dataSource(this.getPointsArg(),q);var u;u=this.effectsSource(this.data.inputs);var v=this.outputVarianceSource(this.data.inputs);var r=new $simjq.Deferred();$simjq.when(s,u,v).done(function(){q=q.content;var D,y,B,C,x,z;var w,A;D=t.data.inputKeys[0];for(B in q){t.data.approximations[B]={outputs:{}};C=t.data.approximations[B];for(z in t.data.outputs){x=t.data.outputs[z];C.outputs[x.ID]={};C.outputs[x.ID].value=NaN;C.outputs[x.ID].values={};C.outputs[x.ID].valueMax=-Infinity;C.outputs[x.ID].valueMin=Infinity}A=q[B];for(y in C.outputs){w=A[y][D][t.data.inputs[D].valueIndex];C.outputs[y].valueMin=w;C.outputs[y].valueMax=w;C.outputs[y].value=w}for(y in q[B]){if(typeof t.data.outputs[y]==="undefined"){continue}for(D in A[y]){if(typeof t.data.inputs[D]==="undefined"){continue}C.outputs[y].values[D]=A[y][D];C.outputs[y].valueMin=Math.min(C.outputs[y].valueMin,Math.min.apply(null,A[y][D]));C.outputs[y].valueMax=Math.max(C.outputs[y].valueMax,Math.max.apply(null,A[y][D]))}}}r.resolve()});return r};m.prototype.debugDataSource=function(v){var w={a:function(A,D,B,C){return A+D*B+C},b:function(A,D,B,C){return A*A*C+D/(1+B*B)},c:function(A,D,B,C){return 1/(0.1+Math.pow(A-D*D+B,2))},easyAs123:function(A,D,B,C){return 5+C*B*0.5-4*D*B}};var t,s,r;var q={x:v.x[0],y:v.y[0],z:v.z[0],numberOfAxles:v.numberOfAxles[0]};var u={};var x=["a","b","c","easyAs123"];for(t in v){if(v.hasOwnProperty(t)){u[t]={};for(s=0;s<x.length;s++){u[t][x[s]]=[];for(r=0;r<v[t][1].length;r++){q[t]=v[t][1][r];u[t][x[s]].push(w[x[s]](q.x,q.y,q.z,q.numberOfAxles));q[t]=v[t][0]}}}}u.values={};for(s=0;s<x.length;s++){u.values[x[s]]=w[x[s]](q.x,q.y,q.z,q.numberOfAxles)}return u};m.prototype.buildFixedSideColumns=function(){};m.prototype.buildUtilityPlotColumn=function(){if(this.svgs.right.parentNode==null){if(this.containerDivs.rightSVGContent.hasChildNodes()){var r=this.containerDivs.rightSVGContent;var q=true;while(q){var t=r.childNodes[0];if(t.className=="profiler-measureDiv"){q=false;break}r.removeChild(r.childNodes[0])}}this.containerDivs.rightSVGContent.insertBefore(this.svgs.right,this.containerDivs.rightSVGContent.childNodes[0])}this.svgs.utilityColumn=d3.select(this.svgs.right).append("g").classed("profiler-utilityColumn",true);var s=this;this.axes.x.utility=d3.svg.axis().scale(this.scales.x.utility.limited).tickSize(2,0).orient("bottom").ticks(5);this.svgs.utilityAxisGroup=d3.select(this.svgs.rightFooter).append("g").classed("profiler-utilAxisGroup",true).attr("transform","translate(0,1)");this.svgs.utilAxis=this.svgs.utilityAxisGroup.append("g").classed("profiler-utilAxis",true).call(s.axes.x.utility);this.updateUtilityPlotColumn()};m.prototype.updateUtilityPlotColumn=function(){var r=function(v){return s.data.outputs[v]};var t=function(v){return v.ID};var s=this;var u=this.svgs.utilityColumn.selectAll(".profiler-utilityPlot").data(s.data.outputKeys.map(r),t);u.exit().remove();var q=u.enter().append("svg").classed("profiler-utilityPlot",true).attr("x",0);q.append("defs").append("clipPath").attr("id",function(v){return"clipPath-"+v.ID}).append("rect").classed("profiler-defsRect",true);q.append("rect").classed("profiler-backgroundRect",true);q.append("path").attr("clip-path",function(v){return"url(#clipPath-"+v.ID+")"}).classed("profiler-utilityPath",true);q.append("g").classed("profiler-outputLineGroup",true);u.attr("height",this.dimensions.cellHeight).attr("width",this.dimensions.utilsWidth).attr("y",function(v){return(s.dimensions.outputs[v.ID].y+s.dimensions.svgPadding)});u.select(".profiler-defsRect").attr("x",this.dimensions.utilsWidth*0.04).attr("y",this.dimensions.cellHeight*0.04).attr("width",this.dimensions.utilsWidth*0.92).attr("height",this.dimensions.cellHeight*0.92);u.select(".profiler-backgroundRect").attr("height",this.dimensions.cellHeight).attr("width",this.dimensions.utilsWidth);u.select(".profiler-utilityPath").attr("d",function(v){return s.getFormulationPath(v)});u.select(".profiler-outputLineGroup").each(function(v){var y=function(z){var A={output:v,lineData:{value:s.data.approximations[z].outputs[v.ID].value},approxId:z};return A};var x=function(z){return z.approxId};var w=d3.select(this).selectAll(".profiler-outputLine").data(Object.keys(s.data.approximations).map(y),x);w.enter().append("line").classed("profiler-outputLine",true);w.exit().remove();w.attr("x2",s.dimensions.utilsWidth).attr("y1",function(z){return s.scales.y[v.ID].full(z.lineData.value)}).attr("y2",function(z){return s.scales.y[v.ID].full(z.lineData.value)})});this.svgs.utilityPlots=this.svgs.utilityColumn.selectAll(".profiler-utilityPlot")};m.prototype.updateUtilityLines=function(){};m.prototype.getFormulationPath=function(u){var s=this.scales.y[u.ID].limited.domain();var q=s[0],t=s[1];if(typeof u.formulation==="undefined"||u.formulation.objectives.length===0){return this.line([[this.scales.x.utility.full(0),this.scales.y[u.ID].full(q)],[this.scales.x.utility.full(0),this.scales.y[u.ID].full(t)]])}var r=[];if(u.formulation.objectives[0].type==="MAXIMIZE"){if(q<u.min){r.push([this.scales.x.utility.full(0),this.scales.y[u.ID].full(q)])}r=r.concat([[this.scales.x.utility.full(0),this.scales.y[u.ID].full(u.min)],[this.scales.x.utility.full(1),this.scales.y[u.ID].full(u.max)]]);if(t>u.max){r.push([this.scales.x.utility.full(1),this.scales.y[u.ID].full(t)])}return this.line(r)}else{if(u.formulation.objectives[0].type==="MINIMIZE"){if(q<u.min){r.push([this.scales.x.utility.full(1),this.scales.y[u.ID].full(q)])}r=r.concat([[this.scales.x.utility.full(1),this.scales.y[u.ID].full(u.min)],[this.scales.x.utility.full(0),this.scales.y[u.ID].full(u.max)]]);if(t>u.max){r.push([this.scales.x.utility.full(0),this.scales.y[u.ID].full(t)])}return this.line(r)}else{return this.line([[this.scales.x.utility.full(0),this.scales.y[u.ID].full(u.min)],[this.scales.x.utility.full(0),this.scales.y[u.ID].full(u.max)]])}}};m.prototype.updateFormulation=function(q){var r=this;q.forEach(function(s){r.data.outputs[s.ID].formulation=s.formulation});this.updateUtilityColumn()};m.prototype.setPredictionMeasures=function(q){this.predictionMeasures=q};m.prototype.buildMeasuresColumn=function(){this.measuresColumnInitialized=true;var q=this;this.divs.measureTitle=d3.select(this.containerDivs.rightSVGFooter).append("div").classed("profiler-measureLabelDiv",true).style({left:Number(this.dimensions.utilsWidth)+"px",width:this.dimensions.measuresWidth+"px",top:"20px"});this.divs.measureTitle.append("div").classed("profiler-measureLabel",true).text("Fit")};m.prototype.updateMeasuresColumn=function(){if(!this.measuresColumnInitialized){this.buildMeasuresColumn()}var q=this;this.predictionMeasures.setCurrentApproximation(sessionInfo.predictPage.selectedApproxIds[0]);this.divs.measureDivs=d3.select(this.containerDivs.rightSVGContent).selectAll(".profiler-measureDiv").data(this.data.outputKeys,function(r){return r});this.divs.measureDivs.exit().remove();this.divs.measureDivs.enter().append("div").style({position:"absolute",left:Number(q.dimensions.utilsWidth)+"px",width:q.dimensions.measuresWidth+"px"}).classed("profiler-measureDiv",true);this.divs.measureDivs.style({height:q.dimensions.cellHeight+"px",top:function(r){return q.dimensions.outputs[r].y+"px"}}).each(function(r){this.innerHTML="";this.appendChild(q.predictionMeasures.makeFitAssessmentDiv(r,q.dimensions.measuresWidth,q.dimensions.cellHeight))})};m.prototype.startDrag=function(q){if(q.source==="sidebar-input"||q.source==="profiler-input"){this.containerDivs.mainSVGFooter.classList.add("profiler-dragTarget")}else{if(q.source==="sidebar-output"||q.source==="profiler-output"){this.containerDivs.leftContent.classList.add("profiler-dragTarget")}}};m.prototype.endDrag=function(q){if(q.source==="sidebar-input"||q.source==="profiler-input"){this.containerDivs.mainSVGFooter.classList.remove("profiler-dragTarget")}else{if(q.source==="sidebar-output"||q.source==="profiler-output"){this.containerDivs.leftContent.classList.remove("profiler-dragTarget")}}d3.selectAll(".profiler-selectedDagHandler").classed("profiler-selectedDagHandler",false)};m.prototype.buildEffectsColumn=function(){var x=[];if(this.selectedUtilsView==="Local Effects"){sessionInfo.predictPage.selectedApproxIds.forEach(function(Y){x.push(l.approximations[Y].localEffects)})}else{if(this.selectedUtilsView==="Global Effects"){sessionInfo.predictPage.selectedApproxIds.forEach(function(Y){x.push(l.approximations[Y].globalEffects)})}}var w=sessionInfo.predictPage.selectedApproxIds;var z=this;var U=170,s=U+20;var E=this.dimensions.svgHeight/x[0].length;var V=95;var O=5;var P=15;var J=x[0];var y=[];var v=(P+O)*w.length*x[0][0].coeffs.length;var D=(P+O)*w.length*(x[0][0].coeffs.length+1.5);v=v>E?v:E;D=D>E?D:E;J.forEach(function(Y){Y.coeffs.sort(function(aa,Z){if(Math.abs(aa.value)>Math.abs(Z.value)){return -1}else{if(Math.abs(aa.value)<Math.abs(Z.value)){return 1}}return 0})});y.push(J);for(var T=1;T<x.length;T++){y.push([]);x[T].forEach(function(ab,ad){var ac=J[ad].coeffs;var Y=[];for(var aa=0;aa<ac.length;aa++){for(var Z=0;Z<ab.coeffs.length;Z++){Y.push({param:ac[aa].param,value:ab.coeffs[Z].value})}}y[T].push({coeffs:Y,param:ab.param})})}var W=[];var q=[];y[0].forEach(function(Y){q.push(Y.param)});for(var T=0;T<q.length;T++){W.push([]);for(var Q=0;Q<w.length;Q++){W[T].push([]);for(var N=0;N<y[0][T].coeffs.length;N++){W[T][Q].push(y[Q][T].coeffs[N]);W[T][Q].param=q[T];W[T][Q].fromApprox=Q}}}var I=[];W.forEach(function(Z,Y){I.push([Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]);Z.forEach(function(aa,ab){aa.forEach(function(ad,ac){if(ad.value<I[Y][0]){I[Y][0]=ad.value}if(ad.value>I[Y][1]){I[Y][1]=ad.value}})})});var X={},u={};x[0].forEach(function(Z,Y){if(Z.coeffs.length===1){X[Z.param]=d3.scale.linear().domain([I[Y][0],I[Y][1]]).range([U-V-20,U-V-20])}else{X[Z.param]=d3.scale.linear().domain([I[Y][0],I[Y][1]]).range([0,U-V-20])}u[Z.param]=d3.scale.linear().domain([0,Z.coeffs.length]).range([10,v-P*2])});if(this.containerDivs.rightSVGContent.hasChildNodes()){var C=this.containerDivs.rightSVGContent;var M=true;while(M){var r=C.childNodes[0];if(r.className=="profiler-measureDiv"){M=false;break}C.removeChild(C.childNodes[0])}}var S=this.containerDivs.rightSVGContent.firstChild;if(S!=null){var R=d3.select(this.containerDivs.rightSVGContent).selectAll("effects-fos").data(W).enter().insert("div",":first-child").attr("class","effects-fos").attr("y",function(Z,Y){return E*Y}).attr("height",E).attr("width",s)}else{var R=d3.select(this.containerDivs.rightSVGContent).selectAll("effects-fos").data(W).enter().append("div").attr("class","effects-fos").attr("y",function(Z,Y){return E*Y}).attr("height",E).attr("width",s)}var G=R.append("xhtml:div").attr("class","effects-div").style("height",E+"px").style("width",s+"px");var H=G.append("svg").attr("class","effects-svg").attr("height",D).attr("width",U);H.append("rect").attr("class","effects-background-rect").attr("height",D).attr("width",U).style("stroke","#bbb").style("fill","none");var B=H.append("g").attr("class","effects-group");var L=B.selectAll("effects-approx-group").data(function(Y){return Y}).enter().append("g").attr("class","effects-approx-group");function F(Y){if(typeof Y.parentElement==="undefined"){return Y.parentNode.parentNode}else{return Y.parentElement.parentElement}}function K(Y){if(typeof Y.parentElement==="undefined"){return Y.parentNode}else{return Y.parentElement}}L.append("line").attr("class","effects-line").attr("x1",function(aa,Y){var Z=V+t(X[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param]);return Z}).attr("x2",function(aa,Z){var Y=V+t(X[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param]);return Y}).attr("y1",function(aa,Z){var Y=D*Z;return Y}).attr("y2",function(aa,Y){var Z=D*(Y+1);return Z}).style("stroke","black").style("opacity",0.2);function t(Z){var Y=Z.domain();if(Y[0]<0&&Y[1]>0){return Z(0)}else{return Z(Y[0])}}function A(Z,Y){Y=Y||3;if(Math.abs(Z)>Math.pow(10,Y)||Math.abs(Z)<Math.pow(10,-1*Y)){return Z.toExponential(Y)}else{return Z.toPrecision(Y)}}L.selectAll("effects-rect").data(function(Y){return Y}).enter().append("rect").attr("class","effects-rect").attr("x",function(aa,Y){var Z=aa.value>0?t(X[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param]):X[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param](aa.value);return V+Z+"px"}).attr("y",function(Z,Y){return(u[d3.select(K(this)).data()[0].param](Y)+d3.select(K(this)).datum().fromApprox*P+O*Y)}).attr("height",P).attr("width",function(Z,Y){return(Math.abs(X[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param](Z.value)-t(X[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param]))+"px")}).style("fill",function(Z,Y){return sessionInfo.predictPage.approxColors[w[d3.select(K(this)).datum().fromApprox]]}).append("title").text(function(Y){return decodeURIComponent(Y.param)});L.selectAll("effects-coeff-value").data(function(Y){return Y}).enter().append("text").attr("class","effects-coeff-value").attr("text-anchor","end").text(function(Z){try{return A(Z.value)}catch(Y){if(Z.value){return Z.value}else{return"N/A"}}}).attr("x",U-5).attr("y",function(Z,Y){return(u[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param](Y)+P*w.length/2+O*Y+3+"px")}).style("alignment-baseline","right").append("title").text(function(Z){try{return Z.value}catch(Y){return"N/A"}});L.selectAll("effects-coeff-text").data(function(Y){return Y}).enter().append("text").attr("class","effects-coeff-text").text(function(ab){try{var Y=decodeURIComponent(ab.param);if(d3.select(K(this)).datum().fromApprox===0){var aa=l.findParameterByName(Y);if(aa.displayName&&aa.displayName.length&&aa.displayName.length>1){Y=aa.displayName}if(Y.length>12){return Y.substring(0,9)+"..."}}return Y}catch(Z){}}).attr("x",5).attr("y",function(Z,Y){return(u[d3.select(F(this)).datum()[d3.select(K(this)).datum().fromApprox].param](Y)+P*w.length/2+O*Y+"px")}).style("alignment-baseline","middle").append("title").text(function(Y){return decodeURIComponent(Y.param)})};m.prototype.buildUtilityColumn=function(){this.svgs.right.innerHTML="";this.svgs.rightFooter.innerHTML="";if(this.selectedUtilsView==="Utility Plot"){this.buildUtilityPlotColumn()}else{this.buildEffectsColumn()}};m.prototype.enableMeasures=function(){this.state.measuresDisabled=false};m.prototype.disableMeasures=function(){this.state.measuresDisabled=true};m.prototype.updateUtilityColumn=function(){if(this.state.measuresDisabled){this.updateUtilityPlotColumn()}else{if(this.selectedUtilsView==="Utility Plot"){this.updateUtilityPlotColumn()}else{if(this.selectedUtilsView==="Local Effects"){this.svgs.right.innerHTML="";this.svgs.rightFooter.innerHTML="";this.buildUtilityColumn()}else{if(this.selectedUtilsView==="Global Effects"){this.svgs.right.innerHTML="";this.svgs.rightFooter.innerHTML="";this.buildUtilityColumn()}}}}};m.prototype.buildUtilityColumnDisplayOptions=function(){if(this.utilityColumnOptionsBuilt===true){return}this.utilityColumnOptionsBuilt=true;var q=this;var r=function(){if(typeof this.selectedOptions==="undefined"){q.selectedUtilsView=this.options[this.selectedIndex].value}else{q.selectedUtilsView=this.selectedOptions[0].value}q.buildUtilityColumn()};this.divs.utilColumnOptionsDiv=d3.select(this.containerDivs.rightSVGFooter).append("div").classed("profiler-utilColumnOptionsDiv",true).style("width",this.dimensions.utilsWidth-this.dimensions.utilsToggleWidth+"px");this.divs.utilLabel=this.divs.utilColumnOptionsDiv.append("select").classed("profiler-utilLabel",true).on("change",r).selectAll("option").data(["Utility Plot","Local Effects","Global Effects"]).enter().append("option").text(function(s){return s})};m.prototype.parseMeanStdDev=function(v,r){var s={},r=r||this.currentApproximation,w=this.data.approximations[r],y=w.outputs[v.ID].value,x=this.labelFormat(y);s.mean=x;if(sessionInfo.predictPage.selectedApproxIds.length===1){var u=l.approximations[r].outputVariance,q=u?u[v.name]:undefined,t;if(typeof q!=="undefined"){t=Math.sqrt(q);t=this.labelFormat(t);s.stddev=t}}return s};m.prototype.buildOutputTooltipStrings=function(t){var s="",r=decodeURIComponent(t.displayName),q={};if(sessionInfo.predictPage.selectedApproxIds.length!==1){sessionInfo.predictPage.selectedApproxIds.forEach(function(w,v){var u=this.parseMeanStdDev(t,w);s+='<div style="color:'+this.approxColors[w]+'">';s+=l.approximations[w].displayName;s+=" μ: "+u.mean;if(typeof u.stddev!=="undefined"){s+="<br />σ: "+u.stddev}s+="</div>"},this)}else{q=this.parseMeanStdDev(t);s="μ: "+q.mean;if(typeof q.stddev!=="undefined"){s+="<br />σ: "+q.stddev}}q.displayText=r;q.longText=s;return q};m.prototype.calculateStdDevFromCOV=function(r,q){return r*q};m.prototype.calculateCOVFromStdDev=function(r,q){if(q!==0){return r/q}return 0};m.prototype.calculateFailure=function(v,s,x){var w=v.ID,z=this.data.approximations[s],t=z.outputs[w],r=l.approximations[s],y=r[w],q=r.outputVariance[v.name],B=v.formulation,u=null,C=t.value,A={};if(B){u=B.constraints}if(Array.isArray(u)){u.forEach(function(D){var E;if(D.type==="GREATER_THAN"){E=D.boundValue-C;A.lower=0.5*(1+o(E/(Math.sqrt(2)*x)))}else{if(D.type==="LESS_THAN"){E=C-D.boundValue;A.upper=0.5*(1+o(E/(Math.sqrt(2)*x)))}}},this)}return A};return m});define("DS/SMAAnalyticsUI/SMAAnalyticsOptimizeParamSelect",["DS/Windows/Dialog","DS/Controls/Button","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(j,h,e,c,f,i){var g;var a=function(l){if(g._diagCallBacks&&typeof g._diagCallBacks.ok==="function"){g._paramData=g._paramData||{};if(g.tree&&typeof g.tree.getDocument==="function"){var k=Object.keys(g._paramData);g.tree.getDocument().getAllDescendants().forEach(function(o){if(!o.isRoot()){for(var m=0;m<k.length;m++){if(o.options.label===g._paramData[k[m]].name){g._paramData[k[m]].displayed=o.isSelected();break}}}},this)}g._diagCallBacks.ok(g._paramData,l)}l.dsModel.dialog.close()};var d=function(k){if(g._diagCallBacks&&typeof g._diagCallBacks.cancel==="function"){g._diagCallBacks.cancel(k)}k.dsModel.dialog.close()};function b(){this._diagCallBacks={ok:function(){},cancel:function(){}};this._diagOptions={domId:"opt-param-select-dialg",immersiveFrame:undefined,title:i.translate("OPT_PARAMS_LABEL"),resizableFlag:false,closeButtonFlag:false,allowMaximizeFlag:false,maximizeButtonFlag:false,allowedDockAreas:WUXDockAreaEnum.NoneDockArea,ensureHeightDefinition:true,modalFlag:true,position:{my:"center",at:"center"},width:300,minHeight:250,buttons:{Ok:new h({label:i.translate("OK"),onClick:a}),Cancel:new h({label:i.translate("Cancel"),onClick:d})}};this._objParams=[];g=this}b.prototype.getParamsWithObjective=function(){if(Array.isArray(g._objParams)&&g._objParams.length>0){return g._objParams}else{g._objParams=[];var k=f.formulation.objectives.map(function(l){return l.parameterID});Object.keys(g._paramData).forEach(function(l){if(k.indexOf(l)>-1){g._objParams.push(l)}});return g._objParams}};b.prototype.setParamsWithObjective=function(k){if(!Array.isArray(k)){return}g._objParams=k};b.prototype._createDialogContent=function(w){var v=e.SETTINGS.STANDARD_CHECKBOXES;v.width="auto";v.height="auto";v.expanderStyle="none";v.readOnly=true;v.escapeHTML=true;v.shouldAcceptDrag=function(){return false};v.resize={columns:false,rows:false};v.selection.preSelection=true;v.selection.canMultiSelect=true;v.selection.unselectAllOnEmptyArea=false;v.performances.renderingMode="standard";v.show.rowHeaders=false;v.show.columnHeaders=false;v.defaultCellHeight=25;var k=v.columns.filter(function(B){return B.dataIndex==="tree"})[0];k.width="85%";k.text=i.translate("All");k.isEditable=false;g.tree=new e(v);var z=g.tree.getDocument();var s=g;var o=new c({label:i.translate("OPT_PARAMS_WITH_OBJ"),grid:{rtype:"objective"}});var A=new c({label:i.translate("INPUTS"),icons:[{iconName:"login"}],grid:{rtype:"input"}});var r=new c({label:i.translate("OUTPUTS"),icons:[{iconName:"logout"}],grid:{rtype:"output"}});var u=function(){return s.getParamsWithObjective().map(function(B){return(this._paramData[B]?this._paramData[B].name:"")},s)};var q=function(B){return this.indexOf(B.nodeModel.options.label)>-1};var m=function(B){B.select()};var p=function(B){B.unselect()};var l=function(B){z.getRoots().filter(function(C){return C.options.grid.rtype!=="objective"}).forEach(function(C){C.unselect()},this);z.search({match:q.bind(u())}).forEach(m)};var n=true;var x=function(B){if(!n){n=true;return}try{switch(B.data.nodeModel.options.grid.rtype){case"objective":l.call(this,B);break;default:o.unselect();this.getAllDescendants().forEach(m);break}this.expand()}catch(C){console.warn("Error identifying the type of root node in the parameters select dialog.",C)}};var y=function(B){if(!n){n=true;return}try{switch(B.data.nodeModel.options.grid.rtype){default:this.getAllDescendants().forEach(p)}this.expand()}catch(C){console.warn("Error identifying the type of root node in the parameters select dialog.",C)}};var t=function(B){var C=f.findParameter(B);var D=new c({label:w[B].name||C.displayName});if(C.role==="INPUT"){A.addChild(D)}else{if(C.role==="OUTPUT"){r.addChild(D)}}if(w[B].displayed){D.select()}D.onUnselect(function(){n=false;this.getRoot().unselect()})};o.onSelect(x);o.onUnselect(y);z.addRoot(o);if(g._diagOptions.checkObjectivesRoot){o.select()}else{o.unselect()}A.onSelect(x);A.onUnselect(y);z.addRoot(A);r.onSelect(x);r.onUnselect(y);z.addRoot(r);Object.keys(w).forEach(t,this);if(g._diagOptions.checkInputsRoot){A.select()}else{A.unselect()}if(g._diagOptions.checkOutputsRoot){r.select()}else{r.unselect()}z.expandAll();return g.tree.getContent()};b.prototype.getDialog=function(k,l,o,n,m){if(!o||null===o){o=new WUXImmersiveFrame();o.inject(document.body)}g._diagOptions.immersiveFrame=o;if(typeof n==="function"){g._diagCallBacks.ok=n}if(typeof m==="function"){g._diagCallBacks.cancel=m}if(l&&null!==l){g._diagOptions=UWA.extend(g._diagOptions,l)}if(k&&null!==k){g._diagOptions.height=(Object.keys(k).length+6)*25;if(g._diagOptions.height>400){g._diagOptions.height=400}g._paramData=k;g._diagOptions.content=this._createDialogContent(k)}new j(g._diagOptions)};return b});define("DS/SMAAnalyticsUI/SMAAnalyticsElicitFilters",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy"],function(a,b){function c(){}c.prototype={createTypeFilter:function(h,e,i,g){var d=e,f=b.priorityValues[e];c.prototype.createFilter(h,d,f,"type",i,g)},createModelFilter:function(g,e,i,f){var h=e,d=b.findGroup(e).displayName;c.prototype.createFilter(g,d,h,"model",i,f)},createFilter:function(f,i,k,d,m,l){var e=a('<div class="sim-ui-elicitFilter-Div">').appendTo(f),n=a('<input type="checkbox" class="sim-ui-elicitFilter-input">').appendTo(e),h=a('<span class="sim-ui-elicitFilter-text">').appendTo(e);h.text(i);var j=function(){b.parameterFilterController.setFilter({type:d,value:k});n.unbind("click",j);n.bind("click",g);if(l){l()}};var g=function(){b.parameterFilterController.clearFilter({type:d,value:k});n.bind("click",j);n.unbind("click",g);if(l){l()}};if(m==true){n.prop("checked",false);n.bind("click",g)}else{n.prop("checked",true);n.bind("click",j)}}};return c.prototype});define("DS/SMAAnalyticsUI/SMAAnalyticsPageCommon",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsSvgShapes","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,e,d,a){var f=function(g){g.each(function(h,j){b(j).change(function(){var i=b(j).val();g.each(function(k,l){b(l).val(i)});e.setRankingMethod(i)})})};var c={setupRankingSelections:function(){var h=b(".rankingMethodSelection");var g={},i;e.getGradingMethod(g).done(function(){i=g.content;if(i){var j=i.replace("'","").replace("'","");h.each(function(k,l){b(l).val(j)})}f(h)}).fail(function(){f(h)})},errorInCaseFunction:function(){b("body").html("");alert(a.translate("no_valid_dataset_msg"));window.history.back()},initializeMoreInfoPage:function(){e.createPage("moreInfo");e.createPage("shopPage")},initializeCommon:function(){try{this.initializeMoreInfoPage()}catch(g){console.log("WARNING! Page commons did not initialize correctly.");console.log("Error:");console.log(g)}}};return c});define("DS/SMAAnalyticsUI/SMAAnalyticsOptimizeView",["UWA/Core","UWA/Class/Promise","DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsOptSettings","DS/SMAAnalyticsUI/SMAAnalyticsMGridBase","DS/SMAAnalyticsUI/SMAAnalyticsHLineChart","DS/SMAAnalyticsUI/SMAAnalyticsResizableMTile","DS/SMAAnalyticsUI/SMAAnalyticsParametersGrid","DS/SMAAnalyticsUI/SMAAnalyticsOptimizeParamSelect","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(i,j,f,c,k,n,g,a,e,l,b,h,m){function d(q,o){this._pageState={_approxId:"",_approxStatus:"",_approxParams:{inputs:[],outputs:[]},_hasQualifyingObjectives:false,_optimizationStatus:{},_optimizationStatusChanged:true,_viewOptions:(i.is(q)?i.extend(q,{}):{}),_SO_Predict:(i.is(o)?o:{}),_viewInitialized:false,_viewBuilt:false,_currentOptSettings:{},_showScoreImprovements:true,_settingsBuilderInitialized:false,_tileMetaData:{},_tilesRefByByParamId:{},_chartsRefByParamId:{},_optimizationStatusMonitorTimer:undefined,_paramsFlatList:{},_paramsUnitList:{},_paramsWithObjectives:undefined,_sidePanel:undefined,_sidePanelContainer:undefined,_sidePanelToggle:undefined,_allowInterrupt:true};this._toolBarButtons={_run:f("#runOptimize"),_settings:f("#settingsOptimize"),_parameters:f("#viewParametersOptimize"),_clearResults:f("#clearOptimize"),_downloadResults:f("#optimizeResDownload"),_toggleScoreImprovements:f("#showimprov"),_stop:f("#stopOptimize")};this._constants={_tileIdPrefix:"tile_",_metaCols:["GLYPH","ID","GRADING"],_events:{_tileReOrderedEventType:"__tile_reordered__",_cPClick:"_hchart_point_l_click",_cPRClick:"_hchart_point_r_click",_cPAddToBasket:"_hchart_add_basket",_cPAddToData:"_hchart_add_data",},_elements:{_viewId:"optimize-mgrid-view",_bannerId:"optimize-no-opt-banner",_viewBtnId:"optimize-mgrid-view-button",_chartBaseClass:"item-content",_viewContainerId:"optimize-main",_gridContainerid:"optimize-mg-container",_optToolBarClass:"opt-settings",_globalToolBarClass:"sim-ui-panel-content-toolbarbutton",_approxStatusLblClass:"sim-ui-panel-content-predictStatus-text",_approxStatusClassReady:"prediction-status-ready",_approxStatusClassOutdated:"prediction-status-outdated",_approxStatusClassError:"prediction-status-error",_sidePanelContainerId:"optimize-paramgrid-inner",_sidePanelToggleClass:"optimize-sidepanel-toggle",},_switches:{_toggleOpt:"RA_OPTIMIZATION",_statusCheckWait:"RAOPT_REFRESH_INTERVAL_S"},_markers:{color:[{type:"excluded",index:-1,color:"#CCC"},{type:"dominated",index:0,color:"#4cdcde"},{type:"infeasible",index:1,color:"#a11923"},{type:"pareto",index:2,color:"#499f3f"}],lineColor:"#ccc",radius:4,lineWidth:1},optStatus:{RUNNING:"OPTIMIZATION_RUNNING",DONE:"OPTIMIZATION_DONE",NONE:"OPTIMIZATION_NONE",ABORTED:"OPTIMIZATION_ABORTED",FAILED:"OPTIMIZATION_FAILED",OUT_OF_DATE:"OPTIMIZATION_OUT_OF_DATE"},optStatusLabel:{RUNNING:m.translate("OPTIMIZATION_RUNNING"),DONE:m.translate("Ready"),NONE:m.translate("OPTIMIZATION_NONE"),ABORTED:m.translate("OPTIMIZATION_ABORTED"),FAILED:m.translate("Failed"),OUT_OF_DATE:m.translate("OPTIMIZATION_OUT_OF_DATE"),},approxStatus:{READY:"READY",OOD:"OUT_OF_DATE"},defaultTileSize:{width:610,height:305},chartClearance:10,icon_showimprov:"show_improvements_line",icon_showall:"show_all_line",};this._htmlElems={_view:undefined,_viewBtn:f("#"+this._constants._elements._viewBtnId),_viewContainer:f("#"+this._constants._elements._viewContainerId),_gridContainer:f("#"+this._constants._elements._gridContainerid),_banner:f("#"+this._constants._elements._bannerId),_toolBar:f("."+this._constants._elements._globalToolBarClass+"."+this._constants._elements._optToolBarClass),_approxStatLbl:document.getElementsByClassName(this._constants._elements._approxStatusLblClass)[0]};var p=Number(k.getSwitch(this._constants._switches._statusCheckWait));this._statusRetrievalWaitMS=(!isNaN(p)&&p>0)?p:1000;this._gridView=undefined;this._settingsBuilder=undefined;this._inputStartValues=undefined;this._showImprovTitle=m.translate("SHOW_SCORE_IMPROV");this._showAllDesTitle=m.translate("SHOW_ALL_DES")}d.prototype={_drawHChart:function(r,p){if(typeof r==="undefined"||r===null){return}var v=[];var o=r.GRADING||[];var u=r.GLYPH||[];var t=r.ID||[];var s=function(w){try{return this._constants._markers.color.filter(function(y){return y.index===w},this)[0].color}catch(x){return"#4cdcde"}};var q=function(w){return{fillColor:s.call(this,o[w]),lineColor:this._constants._markers.lineColor,radius:this._constants._markers.radius,lineWidth:this._constants._markers.lineWidth,}};p.forEach(function(A){var D=[];if(Array.isArray(r[A])){D=r[A].map(function(G,E){var F=Number(t[E]);return{rowID:F,x:F,y:G,marker:q.call(this,E)}},this)}var z=this._pageState._tileMetaData[A].name;v[z]=D;var x=this._pageState._tilesRefByByParamId[A].getTile();var y=n.getFormulationMap();var C=undefined;if(i.is(y)&&i.is(y.values)){C={};if(i.is(y.values[A])){y.values[A].constraints.forEach(function(E){if(E.type==="GREATER_THAN"){C.lowerBound=E.boundValue}else{if(E.type==="LESS_THAN"){C.upperBound=E.boundValue}}})}}if(i.is(this._pageState._chartsRefByParamId[A])){this._pageState._chartsRefByParamId[A].setSeriesData(v[z],0);this._pageState._chartsRefByParamId[A].updateConstraintLines(C)}else{var w,B;if(!i.is(this._pageState._tileMetaData[A])){w=this._constants.defaultTileSize.width;B=this._constants.defaultTileSize.height}else{w=this._pageState._tileMetaData[A].width;B=this._pageState._tileMetaData[A].height}this._pageState._chartsRefByParamId[A]=new e(x.querySelector("."+this._constants._elements._chartBaseClass),z,v[z],{disableDefaultCrossHairBehavior:true,constraintLines:C,label_x:m.translate("ITERATIONS"),label_y:z+((i.is(this._pageState._paramsUnitList[A],"string")&&this._pageState._paramsUnitList[A].length>0)?" ("+this._pageState._paramsUnitList[A]+")":"")},w-this._constants.chartClearance,B-this._constants.chartClearance,this._htmlElems._view)}},this);this._pointClick({detail:{rowIndex:0,rowID:1}},false);return v},_getDataForHChart:function(p,o){return new j(function(s,r){if(!Array.isArray(o)||!(o.length>0)){r();return}var q=function(u){var t=this._drawHChart(u,o);s.call(this)};k.getHistoryData(o.concat(this._constants._metaCols),this._pageState._showScoreImprovements,true,true,p,q.bind(this))}.bind(this))},_initSettingsBuilder:function(o){return new Promise(function(q,p){if(this._pageState._settingsBuilderInitialized){q(o)}else{g.init.call(g).then(function(r){if(i.is(r)){this._settingsBuilder=r;this._pageState._currentOptSettings=this._settingsBuilder.getDefault()}this._pageState._settingsBuilderInitialized=true;q(o)}.bind(this))["catch"](p.bind(this))}}.bind(this))},_getOptimizationStatus:function(o){return new j(function(q,p){var r=function(s){console.warn("Error retrieving the status for optimization over the approximation with id "+o,s);this._pageState._optimizationStatus[o]=this._constants.optStatus.NONE;p()};k.getOptimizationStatus(o).done(function(s){if(i.is(s)&&i.is(s.status,"string")){this._pageState._optimizationStatusChanged=(this._pageState._optimizationStatus[o]!==s.status);this._pageState._optimizationStatus[o]=s.status;q(s.status)}else{r("No optimization status was found.")}}.bind(this)).fail(r.bind(this))}.bind(this))},_performPreBuildChecks:function(){return new j(function(q,p){if(this._pageState._SO_Predict.selectedApproxIds.length>1){p(m.translate("OPT_ERR_APPROXIMATION_MULTISEL"))}var o=k.approximations[this._pageState._approxId];if(!k){p(m.translate("OPT_ERR_NO_SUPPORT_FOR_OPTIMIZATION"))}else{if(this._constants.approxStatus.READY!==this._pageState._approxStatus&&this._constants.approxStatus.OOD!==this._pageState._approxStatus){p(m.translate("OPT_ERR_APPROXIMATION_NOT_READY"))}else{if(!Array.isArray(o.inputs)||o.inputs.length===0){p(m.translate("OPT_START_ERR2"))}else{if(!Array.isArray(o.outputs)||o.outputs.length===0){p(m.translate("OPT_START_ERR3"))}else{q()}}}}}.bind(this))},_checkForQualObjectives:function(){return new j(function(r){var q=k.approximations[this._pageState._approxId];this._pageState._approxParams.inputs=q.inputs.map(function(t){return t.ID});this._pageState._approxParams.outputs=q.outputs.map(function(t){return t.ID});var p=false;if(i.is(k.getFormulation())&&Array.isArray(k.getFormulation().objectives)&&k.getFormulation().objectives.length>0){var s=k.formulation.objectives.map(function(t){return t.parameterID});var o=this._pageState._approxParams.inputs.concat(this._pageState._approxParams.outputs);this._pageState._paramsWithObjectives=o.filter(function(t){return s.indexOf(t)>-1});p=this._pageState._paramsWithObjectives.length>0}this._pageState._hasQualifyingObjectives=p;if(!p){c.alertMessage(c.WARN,m.translate("OPT_NO_OBJ"))}r(p)}.bind(this))},_hideNoOptBanner:function(){if(i.is(this._htmlElems._banner)){if(!this._htmlElems._banner.is(":hidden")){this._htmlElems._banner.hide()}}if(i.is(this._htmlElems._viewContainer)){this._htmlElems._viewContainer.removeClass("hide-opt")}if(i.is(this._gridView)&&typeof this._gridView.refreshGrid==="function"){this._gridView.refreshGrid()}},_showNoOptBanner:function(o,p){if(i.is(o,"string")&&o.length>0){c.alertMessage(c.WARN,o)}if(!i.is(p)||p.length===0){p=m.translate("NO_OPT")}if(i.is(this._htmlElems._banner)){this._htmlElems._banner.text(p);if(!this._htmlElems._banner.is(":visible")){this._htmlElems._banner.show()}}if(i.is(this._htmlElems._viewContainer)){this._htmlElems._viewContainer.addClass("hide-opt")}},_statusMonitorCallBack:function(u,r){var p=this._pageState._optimizationStatus[this._pageState._approxId]||this._constants.optStatus.NONE;var s=this._refreshToolbar(p,this._pageState._hasQualifyingObjectives);if(p===this._constants.optStatus.NONE){this._showNoOptBanner();if(typeof u==="function"){u.call(this)}return}else{this._hideNoOptBanner()}this._htmlElems._approxStatLbl.classList.remove(this._constants._elements._approxStatusClassOutdated,this._constants._elements._approxStatusClassError,this._constants._elements._approxStatusClassReady);var q=this._constants.optStatusLabel.NONE,o=this._constants._elements._approxStatusClassOutdated;if(s.isAborted){q=this._constants.optStatusLabel.ABORTED;o=this._constants._elements._approxStatusClassError}else{if(s.isDone){q=this._constants.optStatusLabel.DONE;o=this._constants._elements._approxStatusClassReady}else{if(s.isFailed){q=this._constants.optStatusLabel.FAILED;o=this._constants._elements._approxStatusClassError}else{if(s.isRunning){q=this._constants.optStatusLabel.RUNNING;o=this._constants._elements._approxStatusClassOutdated}else{if(s.isOOD){q=this._constants.optStatusLabel.OUT_OF_DATE;o=this._constants._elements._approxStatusClassOutdated}}}}}this._htmlElems._approxStatLbl.textContent=q;this._htmlElems._approxStatLbl.classList.add(o);if(this._pageState._optimizationStatusChanged){if(s.isDone){c.alertMessage(c.SUCCESS,m.translate("OPT_DONE"))}else{if(s.isAborted){c.alertMessage(c.WARN,m.translate("OPT_ABORT"))}else{if(s.isFailed){c.alertMessage(c.ERROR,m.translate("OPT_FAIL"))}}}}if(s.thereAreResults){this._getDataForHChart(this._pageState._approxId,Object.keys(this._pageState._tileMetaData).filter(function(t){return this._pageState._tileMetaData[t].displayed},this))["catch"](r)}if(s.isRunning){this._pageState._optimizationStatusMonitorTimer=setTimeout(this._statusMonitor.bind(this,u,r),this._statusRetrievalWaitMS)}if(s.isDone&&typeof u==="function"){u()}if((s.isFailed||s.isAborted)&&typeof r==="function"){r()}},_statusMonitor:function(p,o){if(i.is(this._pageState._optimizationStatusMonitorTimer)){window.clearInterval(this._pageState._optimizationStatusMonitorTimer)}this._getOptimizationStatus(this._pageState._approxId).done(this._statusMonitorCallBack.bind(this,p,o)).fail(function(q){console.warn("Failed to retrive the status of the current optimization run.",q);c.alertMessage(c.ERROR,m.translate("OPT_STATUS_RETRIVAL_FAIL"));if(typeof o==="function"){o(q)}}.bind(this))},_submitSettings:function(p,o){if(i.is(p)){this._pageState._currentOptSettings=p}if(i.is(o,"boolean")){this._pageState._showScoreImprovements=o}this._runOptimization()},_getCurrentRunIds:function(){var o=function(p){return(this._pageState._optimizationStatus[p]===this._constants.optStatus.RUNNING)};return Object.keys(this._pageState._optimizationStatus).filter(o,this)},_verifyTilesinDOM:function(){var p=[];if(i.is(this._pageState._tileMetaData)&&i.is(this._pageState._tilesRefByByParamId)){var o=Object.keys(this._pageState._tileMetaData);o.forEach(function(q){var s=this._pageState._tileMetaData[q];if(s.displayed){var r=this._pageState._tilesRefByByParamId[q];if(i.is(r)){if(null===document.querySelector("#"+r.getTileId())){r.setSize(s.width,s.height);p.push(r.getTile())}}}},this)}if(i.is(this._gridView)&&p.length>0){this._gridView.addTilesToGrid(p);this._gridView.refreshGrid()}},_runOptimization:function(v,r){if(typeof v!=="function"){v=function(){}}if(typeof r!=="function"){r=function(){}}this._pageState._allowInterrupt=true;if(this._getCurrentRunIds().length>0){c.alertMessage(c.WARN,m.translate("OPT_START_ERR5"));r();return}var q=k.approximations[this._pageState._approxId];if(q.status!==this._constants.approxStatus.READY){c.alertMessage(c.WARN,m.translate("OPT_ERR_APPROXIMATION_NOT_READY"));r();return}if(!i.is(this._pageState._currentOptSettings)||this._pageState._currentOptSettings===null||Object.keys(this._pageState._currentOptSettings).length===0){c.alertMessage(c.WARN,m.translate("OPT_START_ERR6"));r();return}var o=(q.displayName)||"";var t=Object.keys(this._pageState._currentOptSettings)[0];var p=k._availableOptimizationSettings[t]||{displayName:"",title:""};var s=p.displayName||(p.title||"");var u=this._getInputStartValues();if(Object.keys(u).length!==this._pageState._approxParams.inputs.length){c.alertMessage(c.ERROR,m.translate("OPT_START_ERR4"));return}c.alertMessage(c.INFO,m.translate("OPT_START",s,o));this._verifyTilesinDOM();k.startOptimization(this._pageState._approxId,u,t,this._pageState._currentOptSettings).done(function(){this._htmlElems._approxStatLbl.textContent=this._constants.optStatusLabel.RUNNING;this._htmlElems._approxStatLbl.classList.add(this._constants._elements._approxStatusClassOutdated);setTimeout(this._statusMonitor.bind(this,v,r),this._statusRetrievalWaitMS)}.bind(this)).fail(function(w){console.warn("Optimization run failed",w);c.alertMessage(c.ERROR,m.translate("OPT_FAIL"));this._showNoOptBanner()}.bind(this))},_getInputStartValues:function(){var r={};var p=this._pageState._SO_Predict.currentValues||{};var o=this._pageState._SO_Predict.analyticsProfiler||{};var q=function(s){var t=parseFloat(p[s]);if(isNaN(t)){t=parseFloat(o.data.inputs[s]?o.data.inputs[s].value:undefined);if(isNaN(t)){t=parseFloat(k.findParameter(s)?k.findParameter(s).median:undefined)}}if(!isNaN(t)){r[k.findParameter(s).name]=t}};this._pageState._approxParams.inputs.forEach(q,this);return r},_stopOptimization:function(p){if(!i.is(p,"string")){p=this._pageState._approxId}var o=this._pageState._optimizationStatus[p]||this._constants.optStatus.NONE;if(this._constants.optStatus.RUNNING===o){c.alertMessage(c.WARN,m.translate("OPT_ABORT_START"));k.stopOptimization().done(this._statusMonitor.bind(this))}else{c.alertMessage(c.WARN,m.translate("OPT_NO_ABORT"))}},_clearOptimizationDataAndPlots:function(){k.clearOptimizationData([this._pageState._approxId]);Object.keys(this._pageState._chartsRefByParamId).forEach(function(o){this._pageState._chartsRefByParamId[o].destroyChart();delete this._pageState._chartsRefByParamId[o]},this);this._gridView.removeTilesFromGrid();this._pageState._optimizationStatusChanged=true;this._htmlElems._approxStatLbl.textContent=this._constants.optStatusLabel.NONE;this._htmlElems._approxStatLbl.classList.add(this._constants._elements._approxStatusClassOutdated);this._refreshToolbar(this._constants.optStatus.NONE,this._pageState._hasQualifyingObjectives)},_clearOptimizationResults:function(){var o=this._pageState._optimizationStatus[this._pageState._approxId]||this._constants.optStatus.NONE;this._showNoOptBanner();if(this._constants.optStatus.NONE!==o){c.alertMessage(c.INFO,m.translate("OPT_CLEAN"));var p=this._constants.optStatus.RUNNING===o;if(p){k.stopOptimization().done(this._clearOptimizationDataAndPlots.bind(this))}else{this._clearOptimizationDataAndPlots.call(this)}}},_downloadOptimizationResults:function(o){if(i.is(o)&&o.length>0){k.downloadOptimizationResults(this._pageState._approxId)}else{c.alertMessage(c.INFO,m.translate("OPT_DWNLD_ERR"))}},_showSettings:function(){var o={showImprovements:Boolean(this._pageState._showScoreImprovements)};if(i.is(this._settingsBuilder)&&typeof this._settingsBuilder.createSettingsForm==="function"){this._settingsBuilder.createSettingsForm(o,this._pageState._currentOptSettings,this._submitSettings.bind(this))}},_createParametersPopOvr:function(){var s=new h();var r=this;var p=function(t){if(i.is(t)){r._pageState._tileMetaData=t;r._buildView(true).then(r._statusMonitor.bind(r))}};var q={checkObjectivesRoot:true,checkInputsRoot:true,checkOutputsRoot:true,};if(Array.isArray(this._pageState._paramsWithObjectives)&&this._pageState._paramsWithObjectives.length>0){for(var o in this._pageState._tileMetaData){if(this._pageState._tileMetaData.hasOwnProperty(o)){if((this._pageState._tileMetaData[o].displayed&&this._pageState._paramsWithObjectives.indexOf(o)===-1)||(!this._pageState._tileMetaData[o].displayed&&this._pageState._paramsWithObjectives.indexOf(o)>-1)){q.checkObjectivesRoot=false;break}}}}else{q.checkObjectivesRoot=false}Object.keys(this._pageState._tileMetaData).forEach(function(t){var u=k.findParameter(t);if(u.role==="INPUT"&&!this._pageState._tileMetaData[t].displayed){q.checkInputsRoot=false}else{if(u.role==="OUTPUT"&&!this._pageState._tileMetaData[t].displayed){q.checkOutputsRoot=false}}},this);s.setParamsWithObjective(this._pageState._paramsWithObjectives);s.getDialog(this._pageState._tileMetaData,q,k.getImmersiveFrame(),p)},_toggleShowScoreImprovements:function(){var o=this._toolBarButtons._toggleScoreImprovements;var q,p,r=o.css("background");this._pageState._showScoreImprovements=!(Boolean(this._pageState._showScoreImprovements));if(!this._pageState._showScoreImprovements){q=this._constants.icon_showimprov;p=this._showImprovTitle;r=r.replace(this._constants.icon_showall,this._constants.icon_showimprov)}else{q=this._constants.icon_showall,p=this._showAllDesTitle;r=r.replace(this._constants.icon_showimprov,this._constants.icon_showall)}o.attr("data-icon",q);o.attr("title",p);o.tooltip({content:o.attr("title")});o.css("background",r);this._statusMonitor()},_setupToolbar:function(){this._toolBarButtons._run.attr("title",m.translate("START_OPT"));this._toolBarButtons._run.on("click",this._runOptimization.bind(this));this._toolBarButtons._stop.attr("title",m.translate("STOP_OPT"));this._toolBarButtons._stop.on("click",this._stopOptimization.bind(this));this._toolBarButtons._clearResults.attr("title",m.translate("CLEAR_OPT_RES"));this._toolBarButtons._clearResults.on("click",this._clearOptimizationResults.bind(this));this._toolBarButtons._settings.attr("title",m.translate("OPT_SETT"));this._toolBarButtons._settings.on("click",this._showSettings.bind(this));this._toolBarButtons._parameters.attr("title",m.translate("OPT_PARAMS"));this._toolBarButtons._parameters.on("click",this._createParametersPopOvr.bind(this));this._toolBarButtons._toggleScoreImprovements.attr("title",this._showAllDesTitle);this._toolBarButtons._toggleScoreImprovements.on("click",this._toggleShowScoreImprovements.bind(this));this._toolBarButtons._downloadResults.attr("title",m.translate("DWNLD_OPT_RES"));this._toolBarButtons._downloadResults.on("click",function(){this._downloadOptimizationResults(this._pageState._approxId)}.bind(this))},_saveTileOrder:function(p){var o=p.detail||[];o.forEach(function(s,r){var q=s.substring(this._constants._tileIdPrefix.length);if(q.length>0){this._pageState._tileMetaData[q].index=r}},this)},_setupEvents:function(){var o=this._constants._events._tileReOrderedEventType;this._htmlElems._view.addEventListener(o,this._saveTileOrder.bind(this));this._htmlElems._view.addEventListener(this._constants._events._cPClick,this._pointClick.bind(this));this._htmlElems._view.addEventListener(this._constants._events._cPRClick,this._pointClick.bind(this));this._htmlElems._view.addEventListener(this._constants._events._cPAddToBasket,this._addPointToBasket.bind(this));this._htmlElems._view.addEventListener(this._constants._events._cPAddToData,this._addPointToDataSet.bind(this))},_pointClick:function(s,q){var r=this;var o=s.detail||{};var t=o.rowID||0;q=i.is(q)?Boolean(q):true;if(t>0){var u={isOptimization:true,approximation:r._pageState._approxId},p={};k.getRowInfo(t,p,u).done(function(){var v=[];if(p&&p.content&&p.content.parmValues){r._pageState._approxParams.inputs.forEach(function(w){var x=p.content.parmValues[w];if(q){r._pageState._SO_Predict.currentValues[w]=x}v.push({pid:w,value:x,title:decodeURIComponent(this._pageState._paramsFlatList[w]),type:"input"})},r);r._pageState._approxParams.outputs.forEach(function(w){var x=p.content.parmValues[w];v.push({pid:w,value:x,title:decodeURIComponent(this._pageState._paramsFlatList[w]),type:"output"})},r);r._pageState._sidePanel.refresh(t,v)}})}},_addPointToBasket:function(o){var p;if(i.is(o)&&i.is(o.detail)){p=Number(o.detail)}if(isNaN(p)||p===0){console.warn("Optimization HChart tooltip returned invalid row id to be added to the dataset");return}k.addOptPointsToDataSet(this._pageState._approxId,[p],true)},_addPointToDataSet:function(o){var p;if(i.is(o)&&i.is(o.detail)){p=Number(o.detail)}if(isNaN(p)||p===0){console.warn("Optimization HChart tooltip returned invalid row id to be added to the dataset");return}k.addOptPointsToDataSet(this._pageState._approxId,[p],false)},_toggleSidePanel:function(){if(this._pageState._sidePanelToggle.classList.contains("closed")){this._pageState._sidePanelToggle.classList.remove("closed");this._pageState._sidePanel.gridBox.classList.remove("hidden")}else{this._pageState._sidePanelToggle.classList.add("closed");this._pageState._sidePanel.gridBox.classList.add("hidden")}if(this._gridView&&typeof this._gridView.refreshGrid==="funtion"){this._gridView.refreshGrid()}},_setUpSidePanel:function(){var p=document.querySelector("#"+this._constants._elements._viewContainerId);var o=document.createElement("div");o.classList.add("optimize-sidepanel");o.classList.add("ra-filegrid-container");p.appendChild(o);this._pageState._sidePanelToggle=document.createElement("div");this._pageState._sidePanelToggle.classList.add(this._constants._elements._sidePanelToggleClass);this._pageState._sidePanelToggle.onclick=this._toggleSidePanel.bind(this);o.appendChild(this._pageState._sidePanelToggle);this._pageState._sidePanelContainer=document.createElement("div");this._pageState._sidePanelContainer.id=this._constants._elements._sidePanelContainerId;o.appendChild(this._pageState._sidePanelContainer);this._pageState._sidePanel=new b(this._pageState._sidePanelContainer)},_buildView:function(o){return new Promise(function(v,u){if(this._viewBuilt&&!o){v();return}this._gridView.removeTilesFromGrid();var s=function(A,z){var y=this._pageState._paramsFlatList[A];var x=this._pageState._paramsFlatList[z];return((y>x)?1:-1)};var p=function(A,z){var y=this._pageState._tileMetaData[A].index;var x=this._pageState._tileMetaData[z].index;return((y>x)?1:-1)};var r=this._pageState._approxParams.outputs.sort(s.bind(this)).concat(this._pageState._approxParams.inputs.sort(s.bind(this)));var w=[];if(Array.isArray(k.formulation.objectives)){w=k.formulation.objectives.map(function(x){return x.parameterID})}r.forEach(function(x){if(!this._pageState._tileMetaData[x]){this._pageState._tileMetaData[x]={name:this._pageState._paramsFlatList[x],index:Object.keys(this._pageState._tileMetaData).length,width:this._constants.defaultTileSize.width,height:this._constants.defaultTileSize.height,displayed:(function(y){return r.length<=10||w.length===0||w.indexOf(y)>-1})(x),}}},this);r.sort(p.bind(this));var t=[];var q=function(y,z){if(!this._pageState._tilesRefByByParamId[y]&&this._pageState._tileMetaData[y].displayed){var x=new l(this._htmlElems._view);x.setTileId(this._constants._tileIdPrefix+y);this._pageState._tilesRefByByParamId[y]=x;x.setResizePreProcessor(this._gridView.disableTileDrag.bind(this._gridView));x.setTileContentResizeHandler(function(B,A){this._pageState._tileMetaData[y].width=B;this._pageState._tileMetaData[y].height=A;if(i.is(this._pageState._chartsRefByParamId)&&i.is(this._pageState._chartsRefByParamId[y])){if(!isNaN(B)&&!isNaN(A)){this._pageState._chartsRefByParamId[y].setSize(B-this._constants.chartClearance,A-this._constants.chartClearance)}}this._gridView.enableTileDrag()}.bind(this))}if(this._pageState._tileMetaData[y].displayed){this._pageState._tilesRefByByParamId[y].setSize(this._pageState._tileMetaData[y]["width"],this._pageState._tileMetaData[y]["height"]);t.push(this._pageState._tilesRefByByParamId[y].getTile())}};r.forEach(q,this);this._gridView.addTilesToGrid(t);this._gridView.refreshGrid();this._pageState._sidePanel.purgeTreeNodes();v()}.bind(this))},_refreshToolbar:function(o,p){var q={};q.isRunning=o===this._constants.optStatus.RUNNING;q.isDone=o===this._constants.optStatus.DONE;q.isAborted=o===this._constants.optStatus.ABORTED;q.isFailed=o===this._constants.optStatus.FAILED;q.isOOD=o===this._constants.optStatus.OUT_OF_DATE;q.thereAreResults=(q.isRunning||q.isDone||q.isAborted||q.isOOD);if(!q.isRunning&&p){this._toolBarButtons._run.show();this._toolBarButtons._settings.show()}else{this._toolBarButtons._run.hide();this._toolBarButtons._settings.hide()}if(q.isRunning){this._toolBarButtons._stop.show()}else{this._toolBarButtons._stop.hide()}if(q.isDone||q.isAborted||q.isOOD){this._toolBarButtons._clearResults.show();this._toolBarButtons._downloadResults.show()}else{this._toolBarButtons._clearResults.hide();this._toolBarButtons._downloadResults.hide()}if(q.thereAreResults){this._toolBarButtons._toggleScoreImprovements.show();this._toolBarButtons._parameters.show()}else{this._toolBarButtons._toggleScoreImprovements.hide();this._toolBarButtons._parameters.hide()}return q},_setStatusToOOD:function(p){var o=this;if(Array.isArray(p)&&p.length>0){k.setOptimizationStatusOutOfDate(p,function(q){if(q){Object.keys(q).forEach(function(r){this._pageState._optimizationStatus[r]=q[r]},o);if(o._pageState._optimizationStatus[o._pageState._approxId]===o._constants.optStatus.OUT_OF_DATE&&o._htmlElems._approxStatLbl.textContent!==o._constants.optStatusLabel.OUT_OF_DATE){o._htmlElems._approxStatLbl.textContent=o._constants.optStatusLabel.OUT_OF_DATE;o._htmlElems._approxStatLbl.classList.add(o._constants._elements._approxStatusClassOutdated)}}})}}};d.prototype.viewEnterHandler=function(q,p,o){return new j(function(w,v){this._showNoOptBanner();var u=this;var t=function(y,z){u._refreshToolbar("",false);u._showNoOptBanner(y,z);v()};if(!i.is(q,"string")||q.length===0){q=(Array.isArray(this._pageState._SO_Predict.selectedApproxIds)?this._pageState._SO_Predict.selectedApproxIds[0]:undefined)}if(!i.is(q,"string")||!i.is(k.approximations[q])){t("",m.translate("OPT_ERR_NO_APPROXIMATION_FOR_OPTIMIZATION"));return}if(this._pageState._SO_Predict.selectedApproxIds.length>1){t("",m.translate("OPT_ERR_APPROXIMATION_MULTISEL"));return}this._pageState._approxId=q;this._pageState._approxStatus=k.approximations[q].status;this._htmlElems._approxStatLbl.textContent=this._constants.optStatusLabel.NONE;this._htmlElems._approxStatLbl.classList.add(this._constants._elements._approxStatusClassOutdated);this._pageState._sidePanel.settings.getApproxId=function(){return u._pageState._approxId};this._pageState._paramsFlatList={};this._pageState._paramsUnitList={};var r=k.getAllParameterObjectsAsFlatList(false,true);var s=function(z,y){z[y.ID]=y.displayName;this._pageState._paramsUnitList[y.ID]=i.is(y.unit,"string")?y.unit:"";return z};r.reduce(s.bind(this),this._pageState._paramsFlatList);if(!o){var x="#"+this._constants._elements._viewId;this._pageState._SO_Predict.lastView=this._pageState._SO_Predict.currentView||x;this._pageState._SO_Predict.currentView=x}this._getOptimizationStatus(this._pageState._approxId).then(this._performPreBuildChecks.bind(this)).then(this._checkForQualObjectives.bind(this)).then(this._initSettingsBuilder.bind(this)).then(function(y){this._buildView(p).then(this._statusMonitor.bind(this,(y?w:v),v))}.bind(this))["catch"](function(z){var y=this._refreshToolbar(this._pageState._optimizationStatus[this._pageState._approxId],true);if(!y.thereAreResults){this._showNoOptBanner(z);v()}else{this._buildView(p).then(this._statusMonitor.bind(this,w,v))}}.bind(this))}.bind(this))};d.prototype.selectedApproximationChange=function(q,p,o){this.viewEnterHandler(q,true,true).then(p.bind(this),o.bind(this))};d.prototype.startOptimization=function(p,o){this._runOptimization(p,o)};d.prototype.formulationChange=function(){if(this._pageState._allowInterrupt){this._pageState._allowInterrupt=!this._pageState._allowInterrupt;var q=this;var p=q._getCurrentRunIds();var o=function(){var r=Object.keys(q._pageState._optimizationStatus).filter(function(s){return(q._constants.optStatus.RUNNING===q._pageState._optimizationStatus[s]||q._constants.optStatus.DONE===q._pageState._optimizationStatus[s])});if(r.length>0){c.alertMessage(c.WARN,m.translate("OPT_FORMULATION_CHANGE_OOD"));q._setStatusToOOD(r)}};if(p.length>0){c.alertMessage(c.WARN,m.translate("OPT_FORMULATION_CHANGE_ABORT"));k.stopOptimization().done(function(){if(q._pageState._SO_Predict.currentView==="#"+q._constants._elements._viewId){q._statusMonitor(o,o)}})}else{o()}}};d.prototype.approximationStatusChanged=function(r){if(i.is(r)&&this._pageState._allowInterrupt){this._pageState._allowInterrupt=!this._pageState._allowInterrupt;var p=this;var o=p._getCurrentRunIds();var q=function(){if(!i.is(p._pageState._optimizationStatus)){p._pageState._optimizationStatus={}}var s=[];Object.keys(r).forEach(function(t){if(p._constants.optStatus.DONE===p._pageState._optimizationStatus[t]||p._constants.optStatus.RUNNING===p._pageState._optimizationStatus[t]){if(p._constants.approxStatus.READY!==r[t].status){s.push(t)}}});p._setStatusToOOD(s)};if(o.length>0){c.alertMessage(c.WARN,m.translate("OPT_APPROX_CHANGE_ABORT"));k.stopOptimization().done(function(){if(p._pageState._SO_Predict.currentView==="#"+p._constants._elements._viewId){p._statusMonitor(q,q)}})}else{q()}}};d.prototype.setUpViewLayout=function(o){if(this._pageState._viewInitialized&&!o){return}this._htmlElems._viewBtn.show();this._htmlElems._view=document.getElementById(this._constants._elements._viewId);this._setupToolbar();Object.keys(this._toolBarButtons).forEach(function(p){this._toolBarButtons[p].hide()},this);this._setupEvents();this._setUpSidePanel();this._gridView=new a(this._constants._elements._viewId,this._constants._elements._gridContainerid);this._gridView.initializeGridView();this._pageState._viewInitialized=true};return d});define("DS/SMAAnalyticsUI/SMAAnalyticsWeightSlider",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(b,c,a){b.widget("sim.adviseWeightSlider",{options:{paramID:"",groupID:"",titleDivID:"",setWeightCallback:function(e,d){}},_create:function(){var h=this;var l=h.option("paramID");var j=h.option("groupID");var i=1;var g=5;var k=i;var f=c.findParameter(l);if(l=="overallscore"||f.dataType=="INTEGER"||f.dataType=="REAL"){if(f.basketWeight&&f.basketWeight>0){k=f.basketWeight}else{if(f.priorityWeight){k=f.priorityWeight}}this.minValue=i;this.maxValue=g;b("<div/>",{"class":"ui-slider-handle sim-ui-paramslider-handle sim-ui-paramslider-handle-square"}).appendTo(h.element);b("<div/>",{"class":"sim-ui-weightslider-marker sim-ui-paramslider-left-marker-threshold sim-ui-weightslider-weight-marker-text"}).text("Threshold:"+k).appendTo(h.element);var e=a.translate("Priority"," "+f.priority);if(f.priority===0){e=a.translate("Must Have")}b("<div/>",{"class":"sim-ui-weightslider-marker sim-ui-paramslider-left-marker-threshold sim-ui-weightslider-priority-marker-text"}).text(e).appendTo(b(this.element).find(".sim-weight-control-priority-div"));var d=h.element.slider({range:false,max:g,min:i,value:k,stop:function(m,n){h._stop(m,n,l,j)},slide:function(m,n){h._slide(m,n,l,j)}});b(d).append(b("<div/>",{"class":"sim-ui-weightslider-marker-line sim-ui-paramslider-left-marker-threshold-line"}));b(this.element).find(".sim-weight-control-priority-div").append(b("<div/>",{"class":"sim-ui-weightslider-priority-marker-line sim-ui-paramslider-left-marker-threshold-line"}));this._updateWeightMarkerValue(k,l,j);b(d).slider("option","step",(g-i)/100)}},init:function(){},_updateWeightMarkerValue:function(f,h,k){var g;if(k!==undefined&&k!==""&&k.length>0){g=c.findGroup(k)}else{g=c.findParameter(h)}var m=0;if(g.priorityWeight){m=g.priorityWeight}if(g.basketWeight&&g.basketWeight>0){m=g.basketWeight}if(!f){f=m;this.element.slider("value",f)}var l=b(this.element).find(".sim-ui-weightslider-marker-line");var i=100*(f-this.minValue)/(this.maxValue-this.minValue)+"%";l.css("left",i);b(this.element).find(".sim-ui-weightslider-weight-marker-text").text(a.translate("Weight",parseFloat(f.toPrecision(5)).toString())).css("left",i);var d=100*(g.priorityWeight-this.minValue)/(this.maxValue-this.minValue)+"%";var j=b(this.element).find(".sim-ui-weightslider-priority-marker-line");j.css("left",d);var e=a.translate("Priority"," "+g.priority);if(g.priority===0){e=a.translate("Must Have")}b(this.element).find(".sim-ui-weightslider-priority-marker-text").text(e).css("left",d)},_slide:function(f,g,d,e){this._updateWeightMarkerValue(g.value,d,e)},_stop:function(g,h,d,f){var e=d;if(f!==undefined&&f!==""&&f.length>0){e=f}this.options.setWeightCallback(g,e,h.value);this._updateWeightMarkerValue(h.value,d,f)},refresh:function(){var e=this.option("paramID");var d=this.option("groupID");if(e===""){e=b(this.element).attr("id").substring(1)}this._updateWeightMarkerValue(null,e,d)}});return b});define("DS/SMAAnalyticsUI/SMAAnalyticsElicitPage",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsElicitFilters","DS/SMAAnalyticsUI/SMAAnalyticsPageSetupUtil","DS/SMAAnalyticsUI/SMAAnalyticsRadialClusterChart","DS/SMAAnalyticsUI/SMAAnalyticsBarChart","DS/SMAAnalyticsUI/SMAAnalyticsECommerceTable","DS/SMAAnalyticsUI/SMAAnalyticsSessionView","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget","DS/SMAAnalyticsUI/SMAAnalyticsWeightSlider","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper"],function(h,l,e,n,j,b,c,g,f,k,m,d,a){function i(p,q){p.elicitPage={create:i,pageLoaded:false,refreshEvents:{},expanded:{state:false},basketContents:{recommendedDesign:[],basketList:[]},expansionTrackers:{},sessionView:new f()};p.elicitPage.buildParameterSliders=function(x,z,r){var y=false;if(!z){z=l.findGroup();y=true}if(!r){r=0}z=l.getGroupCopy(z);e.eliminateNonObjectivesFromHierarchy(z);var s=null;if((!z.groups||!z.groups.length)&&(!z.parameters||!z.parameters.length)){s=h("<div/>").appendTo(x);s.text(d.translate("no_objectives_msg")).css({"margin-top":"5px","text-align":"center"});return}else{if(!y){var t=z.score;if(t){r++;var u=h("<div/>",{id:"w_"+t.ID,"class":"sim-weight-control sim-param-control sim-weight-control-group"+(r%2==1?" sim-param-control-odd":"")}).appendTo(x).append(h("<div/>",{id:"w_"+t.ID+"title","class":"sim-param-title sim-param-title-group"}).text(z.displayName));s=h("<div/>",{"class":"sim-weight-slider-control"});s.append(h("<div/>",{"class":"sim-weight-control-priority-div"}));s.adviseWeightSlider({paramID:t.ID,groupID:z.ID,titleDivID:"_"+t.ID+"title",setWeightCallback:p.elicitPage.basketWeightCallback});u.append(s)}}h(z.parameters).each(function(B,D){r++;var C=h("<div/>",{id:"w_"+D.ID,"class":"sim-weight-control sim-param-control"+(r%2==1?" sim-param-control-odd":"")}).appendTo(x).append(h("<div/>",{id:"w_"+D.ID+"title","class":"sim-param-title"}).text(D.displayName));if(D.dataType=="REAL"||D.dataType=="INTEGER"){var A=h("<div/>",{"class":"sim-weight-slider-control"});A.append(h("<div/>",{"class":"sim-weight-control-priority-div"}));A.adviseWeightSlider({paramID:D.ID,titleDivID:"w_"+D.ID+"title",setWeightCallback:p.elicitPage.basketWeightCallback});C.append(A)}});if(z.groups){for(var w=0;w<z.groups.length;w++){var v=z.groups[w];r=p.elicitPage.buildParameterSliders(x,v,r)}}}p.elicitPage.pageLoaded=true;return r};p.elicitPage.refreshParametersSliderPanel=function(){var r=h("#ellicitweightscontrol>.sim-ui-panel-controlgroup-contentpanel");if(!p.elicitPage.sliderCount){p.elicitPage.sliderCount=0}if(p.elicitPage.pageLoaded==false){h(r).empty();p.elicitPage.sliderCount=p.elicitPage.buildParameterSliders(r)}else{h(".sim-weight-slider-control").adviseWeightSlider("refresh")}if(p.elicitPage.sliderCount*95>h(window).height()-380){h(r).css("height",h(window).height()-380)}else{h(r).css("height",p.elicitPage.sliderCount*95)}h(r).css("overflow-y","auto");h("#ellicitweightscontrol").find(".sim-ui-panel-controlgroup-search-input").on("keyup",function(s){var t=e.searchInputFormatter(h(this),s);h(r).find(".sim-param-title").each(function(){var u=h(this).text().toLowerCase();var v=u.indexOf(t.toLowerCase());if(v<0&&t!=="*"&&t!==""){h(this).parent().hide()}else{h(this).parent().show()}});p.elicitPage.searchParameterString=t})};p.elicitPage.openScrapeUI=function(){p.elicitPage.svgScraper.openScrapeUI()};p.elicitPage.entering=function(){o();if(typeof p.elicitPage.svgScraper==="undefined"){p.elicitPage.svgScraper=new a(p.elicitPage.element)}var s=document.querySelector("#sim-ui-elicit-alternateDesignRankingDiv");if(s!==null){p.elicitPage.svgScraper.prepContainer(s,"ranking",{svgtype:"barchart"})}var r=document.querySelector(".sim-ui-radialClusterContainer");if(r!==null){p.elicitPage.svgScraper.prepContainer(r,"radialcluster",{svgtype:"radialCluster"})}var t=p.elicitPage.element[0].querySelector('[data-icon="copyto"]');if(t!==null){t.onclick=p.elicitPage.openScrapeUI}l.parameterFilterController.rebuildFilteredData();p.elicitPage.refreshParametersSliderPanel();p.elicitPage.setupFilters()};p.elicitPage.collabStatusChanged=function(){p.elicitPage.sessionView.updateView()};p.elicitPage.postRender=function(){if(p.elicitPage.expanded.state){p.elicitPage.expanded.collapse()}if(h("#sessionview").is(":visible")){p.elicitPage.sessionView.initialize()}p.elicitPage.setupAlternateDesignRankingDiv();p.elicitPage.setupParameterPreferencesDiv();p.elicitPage.setupDesignParameterSummaryDiv();if(p.elicitPage.eCommTableInstance!==null&&typeof p.elicitPage.eCommTableInstance!=="undefined"){p.elicitPage.eCommTableInstance.element.resize()}};p.elicitPage.basketWeightCallback=function(s,r,t){l.setBasketWeight(r,t,s)};function o(){if(adviseLaunchInfo.secureStation){h("#sessionViewButton").hide();if(h("div[data-text='Session']").length>0){h(h("div[data-text='Session']")[0]).hide()}}}p.elicitPage.refreshView=function(){o();var r=l.getBasketList();var s=h(".sim-ui-page-elicit-error-message");if(r.length==0){s.text(d.translate("no_alternatives_in_basket")).show();return}s.hide();l.parameterFilterController.rebuildFilteredData();h(".sim-weight-slider-control").adviseWeightSlider("refresh");if(h("#"+q).is(":visible")){p.elicitPage.setupAlternateDesignRankingDiv();p.elicitPage.setupParameterPreferencesDiv();if(p.elicitPage.eCommTableInstance!==null&&typeof p.elicitPage.eCommTableInstance!=="undefined"){p.elicitPage.eCommTableInstance.element.resetObjectives();p.elicitPage.eCommTableInstance.element.gradingChanged()}}};p.elicitPage.resize=function(){var t=h("#ellicitweightscontrol>.sim-ui-panel-controlgroup-contentpanel");h(t).css("max-height",h(window).height()-380);var r=h(t).height();if(r>25){h(t).css("height",h(window).height()-380)}h(t).css("overflow-y","auto");if(p.elicitPage.sessionView.tableContainer.children[0]){p.elicitPage.sessionView.tableContainer.children[0].resize()}for(var s in p.elicitPage.refreshEvents){if(p.elicitPage.refreshEvents[s].resize){p.elicitPage.refreshEvents[s].resize()}}};p.elicitPage.gradingChanged=function(){l.parameterFilterController.rebuildFilteredData();h(".sim-weight-slider-control").adviseWeightSlider("refresh");if(h("#"+q).is(":visible")){for(var r in p.elicitPage.refreshEvents){if(p.elicitPage.refreshEvents[r].gradingChanged){p.elicitPage.refreshEvents[r].gradingChanged()}}}};p.elicitPage.basketChanged=function(){if(l.getBasketList()!=p.elicitPage.basketContents.basketList){p.elicitPage.basketContents.recommendedDesign=l.getRecommendedDesign();p.elicitPage.basketContents.basketList=l.getBasketList().slice();p.elicitPage.refreshView();if(typeof p.elicitPage.eCommTableInstance!=="undefined"){p.elicitPage.eCommTableInstance.element.setRecommended(p.elicitPage.basketContents.recommendedDesign);p.elicitPage.eCommTableInstance.element.primaryCollectionChanged()}}else{p.elicitPage.basketContents.recommendedDesign=l.getRecommendedDesign();p.elicitPage.eCommTableInstance.element.setRecommended(p.elicitPage.basketContents.recommendedDesign)}};p.elicitPage.hierarchyChanged=function(r){l.parameterFilterController.rebuildFilteredData();p.elicitPage.fullRefresh(r);if(p.elicitPage.eCommTableInstance!==null&&typeof p.elicitPage.eCommTableInstance!=="undefined"){p.elicitPage.eCommTableInstance.element.hierarchyChanged(l.varGroup)}};p.elicitPage.fullRefresh=function(){l.parameterFilterController.rebuildFilteredData();p.elicitPage.pageLoaded=false;p.elicitPage.refreshParametersSliderPanel();p.elicitPage.refreshView()};p.elicitPage.eventListHandler=function(y,x,s){var u=[];var t=false,r=false;for(var v=0;v<s.length;v++){var w=s[v];if(w.iaEventType=="parameterChanged"){t=true}else{if(w.iaEventType=="formulationChanged"||w.iaEventType=="filterChanged"||w.iaEventType=="gradingChanged"){r=true}else{u.push(w)}}}if(t){p.elicitPage.fullRefresh(x)}else{if(r){p.elicitPage.refreshView()}}return u};p.elicitPage.setupElicitTracker=function(s){if(p.elicitPage.expansionTrackers[s]){return p.elicitPage.expansionTrackers[s]}else{var r=j.getExpansionTracker();p.elicitPage.expansionTrackers[s]=r;return r}};p.elicitPage.setupExpansionRootDiv=function(s,r){if(r.expanded.state){return r.rootDiv}else{return h(s).empty()}};p.elicitPage.setupChartRootDiv=function(t){var s=h('<div class="sim-ui-elicit-chartRoot" id="'+t+'">');if(s.length<0){s=h('<div class="sim-ui-elicit-chartRoot" id="'+t+'">')}if(s.children().length<1){for(var u=1,r=arguments.length;u<r;u++){s.append(arguments[u])}}return s};p.elicitPage.setupAlternateDesignRankingDiv=function(){var v="alternateDesignRanking";var r="#sim-ui-elicit-alternateDesignRankingDiv";var t=p.elicitPage.setupElicitTracker(v);var y=p.elicitPage.setupExpansionRootDiv(r,t);var u=h('<div class="sim-ui-elicit-chartContentDiv">');var x=h('<div class="sim-ui-elicit-chartHeaderDiv">'+d.translate("RNSB")+"</div>");u.append(x);var s=p.elicitPage.setupChartRootDiv("sim-ui-elicit-alternateDesignChartRoot",u);s.appendTo(y);p.elicitPage.barChart=new c(u[0],l.getBasketList(),l.getBasketRankList());p.elicitPage.barChart.setupData();p.elicitPage.barChart.buildDataMap().done(function(){p.elicitPage.barChart.addStackedBar()});var w={resize:function(){p.elicitPage.barChart.resize()},gradingChanged:function(){p.elicitPage.barChart.gradingChanged()}};p.elicitPage.refreshEvents.alternateDesignRanking=w;if(!t.expanded.state){j.addExpandControl(s,y,t,h("#elicitpreferencespageview"),p.elicitPage.refreshEvents,v)}};p.elicitPage.setupParameterPreferencesDiv=function(){var v="parameterPreferences";var r="#sim-ui-elicit-parameterPreferencesDiv";var t=p.elicitPage.setupElicitTracker(v);var x=p.elicitPage.setupExpansionRootDiv(r,t);var w=h('<div class="sim-ui-elicit-chartHeaderDiv">'+d.translate("Aggregated Weight")+"</div>");w.width(h(x).width()*0.9);var u=h('<div class="sim-ui-elicit-chartContentDiv" id="sim-ui-elicit-parameterPreferencesContent">');var s=p.elicitPage.setupChartRootDiv("sim-ui-elicit-parameterPreferencesChartRoot",u);s.append(w);s.appendTo(x);b(u[0]);x.data("refreshChart",function(){u.empty();b(u[0])});p.elicitPage.refreshEvents.parameterPreferences={resize:function(){u.empty();b(u[0])},gradingChanged:p.elicitPage.setupParameterPreferencesDiv};if(!t.expanded.state){j.addExpandControl(s,x,t,h("#elicitpreferencespageview"),p.elicitPage.refreshEvents,v)}};p.elicitPage.setupDesignParameterSummaryDiv=function(){function r(){var w="parameterSummary";var s="#sim-ui-elicit-designParameterSummaryDiv";var u=p.elicitPage.setupElicitTracker(w);if(typeof p.elicitPage.eCommTableInstance==="undefined"){var y=p.elicitPage.setupExpansionRootDiv(s,u);var x=h('<div class="sim-ui-elicit-chartHeaderDiv" id="sim-ui-elicit-parameterSummaryContent"><h></h></div>');var v=h('<div class="sim-ui-elicit-chartContentDiv">');var t=p.elicitPage.setupChartRootDiv("sim-ui-elicit-parameterSummaryContainer",x,v);t.appendTo(y);p.elicitPage.setupDesignParameterSummaryDiv.parts={};p.elicitPage.setupDesignParameterSummaryDiv.parts.rootDiv=y;p.elicitPage.setupDesignParameterSummaryDiv.parts.chartHeaderDiv=x;p.elicitPage.setupDesignParameterSummaryDiv.parts.chartContentDiv=v;p.elicitPage.setupDesignParameterSummaryDiv.parts.chartRoot=t;p.elicitPage.eCommTableInstance=new g.constr({target:"#sim-ui-elicit-parameterSummaryContainer .sim-ui-elicit-chartContentDiv",params:l.varGroup})}p.elicitPage.refreshEvents.parameterSummary={gradingChanged:function(){if(p.elicitPage.eCommTableInstance!==null&&typeof p.elicitPage.eCommTableInstance!=="undefined"){p.elicitPage.eCommTableInstance.element.updateCollections()}},resize:function(){if(p.elicitPage.eCommTableInstance!==null&&typeof p.elicitPage.eCommTableInstance!=="undefined"){p.elicitPage.eCommTableInstance.element.resize()}}};if(!u.expanded.state){j.addExpandControl(p.elicitPage.setupDesignParameterSummaryDiv.parts.chartRoot,p.elicitPage.setupDesignParameterSummaryDiv.parts.rootDiv,u,h("#elicitpreferencespageview"),p.elicitPage.refreshEvents,w)}}p.elicitPage.refreshEvents.compareTableDraw=p.elicitPage.refreshEvents.compareTableDraw||{refresh:e.makeRenderTracker(r)};p.elicitPage.refreshEvents.compareTableDraw.refresh.render()};p.elicitPage.parseBasketForTable=function(){var t=[];var s=l.getBasketList();for(var r=0;r<s.length;r++){t.push(s[r])}return t};p.elicitPage.setupFilters=function(){var w=h("#parametertypecontrol .sim-ui-panel-controlgroup-contentpanel"),t=h("#parametermodelcontrol .sim-ui-panel-controlgroup-contentpanel");var v=l.varGroup.groups||[],s=Object.keys(l.priorityValues)||[],u=p.elicitPage.fullRefresh;var r;w.empty();t.empty();for(r=0;r<v.length;r++){n.createModelFilter(t,v[r].ID,l.parameterFilterController.typeFilters[v[r].ID],u)}for(r=0;r<s.length;r++){n.createTypeFilter(w,s[r],l.parameterFilterController.typeFilters[l.priorityValues[s[r]]],u)}};p.elicitPage.viewChanged=function(){if(h("#sessionview").is(":visible")){p.elicitPage.sessionView.initialize()}else{p.elicitPage.postRender()}};p.elicitPage.save=function(){var r={expanded:p.elicitPage.expanded,basketContents:p.elicitPage.basketContents,expansionTrackers:p.elicitPage.expansionTrackers};try{l.savePageData("elicitPage",l.serializePageObject(r))}catch(s){console.warn("Error trying to persist elicit page session info",[s])}};p.elicitPage.element=h("#"+q);p.elicitPage.element.advisePage({controlPanelId:"elicitpreferencescontrolpanel",contentPanelId:"elicitpreferencescontentpanel",resize:p.elicitPage.resize,entering:p.elicitPage.entering,basketChanged:p.elicitPage.basketChanged,parameterChanged:p.elicitPage.hierarchyChanged,hierarchyChanged:p.elicitPage.hierarchyChanged,formulationChanged:p.elicitPage.fullRefresh,gradingChanged:p.elicitPage.gradingChanged,postRender:p.elicitPage.postRender,save:p.elicitPage.save,collabStatusChanged:p.elicitPage.collabStatusChanged,viewchange:p.elicitPage.viewChanged})}return i});define("DS/SMAAnalyticsUI/SMAAnalyticsLinePlot",["DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsUI/SMAAnalyticsPageCommon","DS/SMAAnalyticsUI/SMAAnalyticsMarkers"],function(a,d,e,c){function b(i,g,f,h){this.isOptimization=f||false;this.approximationId=h||"";this.randId=Math.floor(Math.random()*1000000000000);this.containerDiv=i;this.eventHandler=g;this.svgs={rootSvg:document.createElementNS("http://www.w3.org/2000/svg","svg")};this.containerDiv.appendChild(this.svgs.rootSvg);this.dimensions={leftPad:70,topPad:5,titleHeight:0,xLabelHeight:0,yLabelWidth:0,bottomPad:32,rightPad:15,glyphSize:8};this.internalData={title:"",xLabel:"",yLabel:"",points:[],markerClassArray:[],xMin:Infinity,xMax:-Infinity,yMin:Infinity,yMax:-Infinity,xBounds:false,yBounds:false,glyphMap:[]};this.scales={x:d3.scale.linear(),y:d3.scale.linear()};this.axes={x:d3.svg.axis(),y:d3.svg.axis()};this.axes.x.scale(this.scales.x).orient("bottom").ticks(10);this.axes.y.scale(this.scales.y).orient("left").ticks(10);this.setupContextGroup()}b.prototype.totalWidth=function(f){if(typeof f==="undefined"){return this.dimensions.totalWidth}this.dimensions.totalWidth=f;this.computeWidthDimensions();d3.select(this.svgs.rootSvg).style({width:this.dimensions.totalWidth+"px"});return this.dimensions.totalWidth};b.prototype.computeWidthDimensions=function(){this.dimensions.plotWidth=this.dimensions.totalWidth-this.dimensions.leftPad-this.dimensions.rightPad-this.dimensions.yLabelWidth;this.scales.x.range([0,this.dimensions.plotWidth])};b.prototype.totalHeight=function(f){if(typeof f==="undefined"){return this.dimensions.totalHeight}this.dimensions.totalHeight=f;this.computeHeightDimensions();d3.select(this.svgs.rootSvg).style({height:this.dimensions.totalHeight+"px"});return this.dimensions.totalHeight};b.prototype.computeHeightDimensions=function(){this.dimensions.plotHeight=this.dimensions.totalHeight-this.dimensions.topPad-this.dimensions.titleHeight-this.dimensions.bottomPad;this.scales.y.range([this.dimensions.plotHeight,0])};b.prototype.title=function(f){if(typeof f==="undefined"){return this.internalData.title}if(f===""){this.internalData.title="";this.dimensions.titleHeight=0}else{this.internalData.title=f;this.dimensions.titleHeight=30}this.computeHeightDimensions();return this.internalData.title};b.prototype.xLabel=function(f){if(typeof f==="undefined"){return this.internalData.xLabel}if(f===""){this.internalData.xLabel="";this.dimensions.xLabel=0}else{this.internalData.xLabel=f;this.dimensions.xLabel=30}return this.internalData.xLabel};b.prototype.yLabel=function(f){if(typeof f==="undefined"){return this.internalData.yLabel}if(f===""){this.internalData.yLabel="";this.dimensions.yLabel=0}else{this.internalData.yLabel=f;this.dimensions.yLabel=30}return this.internalData.yLabel};b.prototype.x=function(f){if(typeof f==="undefined"){return this.xFn}this.xFn=f};b.prototype.y=function(f){if(typeof f==="undefined"){return this.yFn}this.yFn=f};b.prototype.xFn=function(f){return f[0]};b.prototype.yFn=function(f){return f[1]};b.prototype.data=function(v,j,k,p,l){if(typeof v==="undefined"){return{points:this.internalData.points,markerClassArray:this.internalData.markerClassArray,xBounds:this.internalData.xBounds,yBounds:this.internalData.yBounds,glyphMap:this.internalData.glyphMap}}if(typeof v==="string"){if(v==="markerClassArray"){return this.internalData.markerClassArray}else{if(v==="xBounds"){return this.internalData.xBounds}else{if(v==="yBounds"){return this.internalData.yBounds}}}}this.internalData.points=v;this.internalData.markerClassArray=j;this.internalData.xBounds=k;this.internalData.yBounds=p;this.internalData.glyphMap=l;if(this.internalData.points.length===0){this.scales.x.domain([0,1]);this.scales.y.domain([0,1]);return this.internalData.points}var f=Infinity,t=Infinity,n=-Infinity,h=-Infinity;var s,r;for(var m=0;m<v.length;m++){s=this.xFn(v[m]);r=this.yFn(v[m]);f=Math.min(s,f);n=Math.max(s,n);if(typeof r!=="string"){t=Math.min(r,t);h=Math.max(r,h)}}if(k&&k[0]!=null){f=Math.min(f,k[0])}if(k&&k[1]!=null){n=Math.max(n,k[1])}if(p&&p[0]!=null){t=Math.min(t,p[0])}if(p&&p[1]!=null){h=Math.max(h,p[1])}this.internalData.xMin=f;this.internalData.yMin=t;this.internalData.xMax=n;this.internalData.yMax=h;this.internalData.xBounds=[f,n];this.internalData.yBounds=[t,h];var u=0.03*(n-f),q=0.03*(h-t);this.scales.x.domain([f-u,n]);this.scales.y.domain([t-q,h]);Math.log10=Math.log10||function(i){return Math.log(i)*Math.LOG10E};var g=function(y,w){var i=40;var z=Math.log10(w-y);var A=y===0?0:Math.log10(y);var x=w===0?0:Math.log10(w);if(z<0){var B=8*(Math.ceil(Math.abs(z))+3);if(B>i){i=B}}else{if(A>3){var B=8*(Math.ceil(Math.abs(A))+2);if(B>i){i=B}}else{if(x>3){var B=8*(Math.ceil(Math.abs(x))+2);if(B>i){i=B}}}}return i};var o=g(this.internalData.xMin,this.internalData.xMax);this.axes.x.ticks(Math.floor(this.dimensions.totalWidth/o));return this.internalData.points};b.prototype.doubleClickBehavior=function(){};b.prototype.setDoubleClickBehavior=function(f){this.doubleClickBehavior=f};b.prototype.getMarker=function(h,g){var f=h.contains("_SEL")?h.replace("_SEL",""):h;return c.getDataMark(f,{imgHeight:g,imgWidth:g})};b.prototype.drawPlot=function(){var q=this;var o=this.svgs.rootSvg;var n=d3.select(o);var p=0;n.on("click",function(w){if(q.hasMoreInfo===true){q.removeMoreInfo()}if(Date.now()-p<300){q.doubleClickBehavior()}p=Date.now()});if(this.internalData.title!==""){d3.select(o).selectAll(".linePlot-title").remove();this.svgs.title=d3.select(o).append("text").classed("linePlot-title",true).text(this.internalData.title).attr("font-size",20).style({"text-anchor":"middle"}).attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth+this.dimensions.plotWidth/2)+","+(this.dimensions.topPad+this.dimensions.titleHeight-7)+")")}n.selectAll(".linePlot-axis").remove();this.svgs.xAxis=n.append("g").classed("xAxis linePlot-axis",true).attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.plotHeight+this.dimensions.titleHeight)+")").call(this.axes.x);this.svgs.yAxis=d3.select(o).append("g").classed("yAxis linePlot-axis",true).attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.titleHeight)+")").call(this.axes.y);n.selectAll(".lineGroup").remove();this.svgs.lineGroup=d3.select(o).append("g").attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.titleHeight)+")").classed("lineGroup",true);var v=this.data().points;var m=[];var f=[],i,u;for(u=0;u<v.length;u++){i=q.yFn(v[u]);if(typeof i==="string"){if(m.length>0){f.push(m);m=[]}}else{m.push(v[u])}}if(m.length>0){f.push(m)}this.svgs.lineGroup.selectAll("path").data(f).enter().append("path").attr("class",function(x,w){return"linePlot-plotLine plotLine"+w});var q=this;var g=d3.svg.line().x(function(w){return q.scales.x(q.xFn(w))}).y(function(w){return q.scales.y(q.yFn(w))});this.svgs.lineGroup.selectAll("path").attr("d",function(w){return g(w)});var h=this.data("markerClassArray");n.selectAll(".markerGroup").remove();this.svgs.markerGroup=d3.select(o).append("g").attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.titleHeight)+")").classed("markerGroup",true);var l=[],i;var k=[];for(var u=0;u<v.length;u++){i=this.yFn(v[u]);if(typeof i!=="string"){l.push(v[u]);k.push(this.internalData.glyphMap[u])}}var r=this.svgs.markerGroup.selectAll(".lineMarker");this.svgs.markerGroup.selectAll(".lineMarker").data(l).enter().append(function(x,w){return q.getMarker(k[w],q.dimensions.glyphSize)}).attr("class",function(x,w){if(h&&h.length>Number(x.index)+1){return("lineMarker "+h[Number(x.index)+1])}return"lineMarker"}).attr("x",function(w){return q.scales.x(q.xFn(w))-q.dimensions.glyphSize/2-1}).attr("y",function(w){return q.scales.y(q.yFn(w))-q.dimensions.glyphSize/2-1}).on("click",function(w){if(q.eventHandler&&q.eventHandler.clickHandler){q.eventHandler.clickHandler(w)}}).on("contextmenu",function(w){if(typeof q.contextFn==="function"){q.contextFn(w)}});var t=this.svgs.markerGroup.selectAll(".lineMarker");var j=this.data("xBounds");if(j){}var s=this.data("yBounds");if(s){d3.select(this.svgs.rootSvg).selectAll(".linePlot-yboundGroup").remove();this.svgs.yBoundGroup=d3.select(this.svgs.rootSvg).append("g").classed("linePlot-yboundGroup",true).attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.titleHeight)+")").node();if(typeof s[0]!=="undefined"&&s[0]!==null){this.svgs.y1CrossLine=d3.select(this.svgs.yBoundGroup).append("line").style({fill:"none",stroke:"#a11923"});this.svgs.y1CrossLine.attr("x1",this.scales.x(this.internalData.xMin)).attr("x2",this.scales.x(this.internalData.xMax)).attr("y1",this.scales.y(s[0])).attr("y2",this.scales.y(s[0]))}if(typeof s[1]!=="undefined"&&s[1]!==null){this.svgs.y1CrossLine=d3.select(this.svgs.yBoundGroup).append("line").style({fill:"none",stroke:"#a11923"});this.svgs.y1CrossLine.attr("x1",this.scales.x(this.internalData.xMin)).attr("x2",this.scales.x(this.internalData.xMax)).attr("y1",this.scales.y(s[1])).attr("y2",this.scales.y(s[1]))}}};b.prototype.addCrosshair=function(f){d3.select(this.svgs.rootSvg).selectAll(".linePlot-crosshairGroup").remove();this.svgs.crosshairGroup=d3.select(this.svgs.rootSvg).append("g").classed("linePlot-crosshairGroup",true).attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.titleHeight)+")").node();this.svgs.hozCrossLine=d3.select(this.svgs.crosshairGroup).append("line").style({fill:"none",stroke:"#333333"});this.svgs.vertCrossLine=d3.select(this.svgs.crosshairGroup).append("line").style({fill:"none",stroke:"#333333"});if(typeof f!=="undefined"&&f<this.data().points.length){this.updateCrosshair(f)}};b.prototype.updateCrosshair=function(h){if(this.hasMoreInfo){this.removeMoreInfo()}var j=this.data().points;for(var g=0;g<j.length;g++){if(j[g].index==h){break}}if(g==j.length){g=g-1}var k=this.yFn(j[g]);var f=this.xFn(j[g]);if(typeof k==="string"){k=this.internalData.yMin-0.1*this.internalData.yMax}this.svgs.hozCrossLine.attr("x1",this.scales.x(this.internalData.xMin)).attr("x2",this.scales.x(this.internalData.xMax)).attr("y1",this.scales.y(k)).attr("y2",this.scales.y(k));this.svgs.vertCrossLine.attr("x1",this.scales.x(f)).attr("x2",this.scales.x(f)).attr("y1",this.scales.y(this.internalData.yMin)).attr("y2",this.scales.y(this.internalData.yMax));return j[g]};b.prototype.contextCallback=function(f){if(typeof f==="undefined"){return this.contextFn}this.contextFn=f};b.prototype.setupContextGroup=function(){try{var f=d3.select(this.svgs.rootSvg).append("defs");var j="#DDDDDD",h="#BBBBBB";f.append("pattern").attr("id","basketPattern"+this.randId).attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/basket_small.png");f.append("pattern").attr("id","basketRemovePattern"+this.randId).attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/basket_remove.png");f.append("pattern").attr("id","infoPattern"+this.randId).attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/moreinfo.png");f.append("pattern").attr("id","addtodatasetPattern"+this.randId).attr("patternUnits","objectBoundingBox").attr("patternContentUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("width",1).attr("height",1).attr("xlink:href","./assets/icons/add_design.png");var g=f.append("svg:linearGradient").attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%").attr("id","moreInfoGradient"+this.randId);g.append("svg:stop").attr("offset","0%").attr("stop-color",h).attr("stop-opacity",1);g.append("svg:stop").attr("offset","100%").attr("stop-color",j).attr("stop-opacity",1);var i=f.append("filter").attr("height","130%").attr("id","moreInfoShadow"+this.randId);i.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1);i.append("feOffset").attr("dx",2).attr("dy",2).attr("result","offsetblur");i.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope","0.4");var l=i.append("feMerge");l.append("feMergeNode");l.append("feMergeNode").attr("in","SourceGraphic");this.defs=f}catch(k){console.log(k);throw k}};b.prototype.addMoreInfo=function(p){var r=this;if(this.hasMoreInfo===true){this.removeMoreInfo()}this.svgs.contextGroup=d3.select(this.svgs.rootSvg).append("g").classed("sim-ui-scatterMVP-moreInfo",true).attr("transform","translate("+(this.dimensions.leftPad+this.dimensions.yLabelWidth)+","+(this.dimensions.topPad+this.dimensions.titleHeight)+")");var O=this.data().points;for(var K=0;K<O.length;K++){if(O[K].index==p){break}}var o=O[K];var u=this.yFn(o);var w=this.xFn(o);var J=this.svgs.contextGroup;var g=160,G=36,A=10,l=10,F=16,N="up",m="#BBBBBB",P=3;var H=this.scales.y(u)+l+P+1,I=this.scales.x(w)-g/2,s=[{x:this.scales.x(w),y:this.scales.y(u)+P+1},{x:this.scales.x(w)-8,y:this.scales.y(u)+l+P+2},{x:this.scales.x(w)+8,y:this.scales.y(u)+l+P+2}];var z=d3.svg.line().x(function(i){return i.x}).y(function(i){return i.y}).interpolate("linear");if(G+H>d3.max(this.scales.y.range())){s[0].y-=2*(P+1);s[1].y-=2*(l+P+2);s[2].y-=2*(l+P+2);H=this.scales.y(u)-1-l-P-G;m="#DDDDDD"}if(I<d3.min(this.scales.x.range())){I=d3.min(this.scales.x.range());if(s[1].x<I+10){s[1].x=I+10;s[2].x=I+10+F}}else{if(I+g>d3.max(this.scales.x.range())){I=d3.max(this.scales.x.range())-g;if(s[2].x>I+g-10){s[1].x=I+g-10-F;s[2].x=I+g-10}}}J.append("rect").classed("sim-ui-scatterMVP-moreInfo-backRect",true).attr("x",I).attr("y",H).attr("width",g).attr("height",G).attr("rx",A).attr("ry",A).style("fill","url(#moreInfoGradient"+this.randId+")").style("filter","url(#moreInfoShadow"+this.randId+")");var h=z(s);J.append("path").attr("d",h+"Z").classed("sim-ui-scatterMVP-moreInfo-backTri",true).style("fill",m);J.append("text").text(a.translate("Alt."," ")+o.id).classed("sim-ui-scatterMVP-moreInfo-text",true).attr("text-anchor","left").attr("x",I+5).attr("y",H+24);var v=24,M=24,E=I+g-M-5,D=H+5,k=10;var t=24,C=24,q=I+g-C-M-10,n=H+5,j=10;var f,L;if(this.isOptimization&&this.approximationId&&this.approximationId.length>0){f=J.append("g").classed("sim-ui-scatterMVP-moreInfo-infoButton",true).on("click",function(){proxy.addOptPointsToDataSet(this.approximationId,[o.id],false)}.bind(r));L="url(#addtodatasetPattern"+this.randId+")"}else{f=J.append("g").classed("sim-ui-scatterMVP-moreInfo-infoButton",true).on("click",function(){d.makeParamPopover(o.id)}.bind(r));L="url(#infoPattern"+this.randId+")"}f.append("rect").classed("sim-ui-scatterMVP-moreInfo-infoButton-back",true).attr("x",E).attr("y",D).attr("width",M).attr("height",v).attr("rx",k).attr("ry",k).attr("fill",L);var B=J.append("g").classed("sim-ui-scatterMVP-moreInfo-basketButton",true).on("click",function(){if(r.isOptimization&&r.approximationId&&r.approximationId.length>0){proxy.addOptPointsToDataSet(r.approximationId,[o.id],true);return}if(proxy.isInBasket(Number(o.id))===-1){proxy.addToBasket(o.id);d3.select(this).select(".sim-ui-scatterMVP-moreInfo-basketButton-back").attr("fill","url(#basketRemovePattern"+r.randId+")")}else{proxy.removeFromBasket(o.id);d3.select(this).select(".sim-ui-scatterMVP-moreInfo-basketButton-back").attr("fill","url(#basketPattern"+r.randId+")")}});B.append("rect").classed("sim-ui-scatterMVP-moreInfo-basketButton-back",true).attr("x",q).attr("y",n).attr("width",C).attr("height",t).attr("rx",j).attr("ry",j).attr("fill",function(){if(proxy.isInBasket(Number(o.id))===-1){return"url(#basketPattern"+r.randId+")"}else{return"url(#basketRemovePattern"+r.randId+")"}});this.hasMoreInfo=true};b.prototype.removeMoreInfo=function(){this.svgs.contextGroup.remove();this.hasMoreInfo=false};return b});define("DS/SMAAnalyticsUI/merge/SMAAnalyticsMergeModel",["UWA/Core","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsProxy"],function(g,c,f,b,d){var a;var e=g.Class.extend({init:function(h){a=this;this.update(h)},_getMappedAnalyticsParam:function(j){for(var h=0;h<this.autoMappingData.length;h++){if(this.autoMappingData[h].reqParamId===j){return this.autoMappingData[h]}}},_getParamOptions:function(){var h=new Map();this._acParams.forEach(function(i){h.set(i.ID,{name:i.displayName,dataType:i.dataType})});return h},_setModel:function(){var i=[];var j=this;var h=true;Object.keys(this._externParamMap).forEach(function(l){var o=this._externParamMap[l],k="not_mapped",n=b.translate("not_mapped");Object.keys(this._map).some(function(r){var q=this._map[r];if(o.id===q.id){var p=this.analyticsParamOptionsMap.get(r);k=r;n=p.name;return true}},this);var m=new f({label:o.displayName,grid:{type:"parameter",externParamId:o.id,analyticsParamTitle:n,analyticsParamID:k,dataType:o.dataValueType,parameterValue:o.value,analyticsParamOptions:this._updateParamOptionsForDropDown(o.id,k,o.valueType)}});i.push(m)},this);this._document.addChild(i)},updateParamOptions:function(l,h,j){if(h!=="not_mapped"){d.unmapInteractiveParam(l,h)}if(j!=="not_mapped"){var i="";if(this._externParamMap[l]){i=this._externParamMap[l].displayName}d.mapInteractiveParam(l,j,i)}d.updateParameterValues(null,"definePage");this._document.prepareUpdate();var k=this._document.getChildren();if(k instanceof Array){k.forEach(function(m){m.options.grid.analyticsParamOptions=this._updateParamOptionsForDropDown(m.options.grid.id,m.options.grid.analyticsParamID,m.options.grid.dataType)},this)}this._document.pushUpdate()},_updateParamOptionsForDropDown:function(l,j,h){var k=this;var i=[{labelItem:b.translate("not_mapped"),valueItem:"not_mapped"}];this.analyticsParamOptionsMap.forEach(function(n,o){if(this._isValidOption(o,n.dataType,j,h)||(this._map[o]&&l===this._map[o].id)){var m=n.name;if(m){try{m=decodeURI(m);m=decodeURI(m)}catch(p){}}i.push({labelItem:m,valueItem:o})}},this);return i},_isValidOption:function(l,i,h,j){var k=this._map[l];if(typeof k==="undefined"||l===h){i=i||"";j=i||"";if(i.toUpperCase()==="STRING"||j.toUpperCase()==="STRING"){return i.toUpperCase()===j.toUpperCase()}else{return true}}else{return false}},getModel:function(){return this._document},update:function(h){var i=false;this._externParamMap=h.params;this._acParams=h.acParams;this._map=h.paramMap;this.analyticsParamOptionsMap=this._getParamOptions();if(!this._document){this._document=new c({useAsyncPreExpand:true})}else{i=true;this._document.prepareUpdate()}if(this._document.getChildren().length===0){this._setModel()}if(i){this._document.pushUpdate()}},});return e});define("DS/SMAAnalyticsUI/SMAAnalyticsDefinePageModel",["UWA/Core","DS/Logger/Logger","module","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(f,c,b,a,g,h,k,d){var i=null,j=c.getLogger(b),e=f.Class.singleton({init:function(){i=this;j.log("SMAAnalyticsDefinePageModel: init")},initialize:function(l){i.varGroupCopy=h.getGroupCopy(h.varGroup);i.formulationMap=k.getFormulationMap();i.treeDocument=new a({useAsyncPreExpand:true});i._setup()},clear:function(){},_setup:function(){i._createNodes(i.varGroupCopy,null)},_createNodes:function(o,m){var n=[],l=[];if(f.is(o.groups)&&o.groups.length>0){o.groups.forEach(function(q){var p=new g({label:q.displayName,priority:q.priority,type:"group"});o.groups.forEach(function(r){i._createNodes(r,p)});n.push(p)})}if(f.is(o.parameters)&&o.parameters.length>0){o.parameters.forEach(function(t){var q="NONE",p="",r="",s=i.formulationMap.values[t.ID];if(f.is(s)){s.objectives.forEach(function(u){q=u.type});s.constraints.forEach(function(u){if(u.type==="LESS_THAN"){p=u.boundValue}else{r=u.boundValue}})}l.push(new g({id:t.ID,label:t.displayName,grid:{name:t.name,role:t.role,dimensions:dimensions,structure:t.structure,dataType:t.dataType,priority:t.priority,priorityWeight:t.priorityWeight,notes:t.notes,objective:q,lowerThreshold:r,upperThreshold:p,type:"parameter",unit:t.unit,min:f.is(t.min)?t.min:"",max:f.is(t.max)?t.max:"",visibleDataMin:f.is(t.visibleDataMin)?t.visibleDataMin:"",visibleDataMax:f.is(t.visibleDataMax)?t.visibleDataMax:"",}}))})}if(m===null){m=i.treeDocument}m.addChild(n);m.addChild(l)},getDocument:function(){return i.treeDocument}});return e});define("DS/SMAAnalyticsUI/SMAAnalyticsDefinePageView",["UWA/Core","DS/Logger/Logger","module","DS/Tree/TreeListView","DS/Controls/ComboBox","DS/SMAAnalyticsUI/SMAAnalyticsDefinePageModel","DS/Tweakers/TypeRepresentationFactory","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(f,c,b,g,k,e,a,d){var i=null,j=c.getLogger(b),h=f.Class.singleton({init:function(){i=this},initialize:function(l){e.initialize();i.definePageView=new g(i._setupView())},clear:function(){},_setupView:function(){return{height:"auto",enableDragAndDrop:true,isEditable:true,isSortable:true,infiniteScrolling:true,enableKeyboardNavigation:true,resize:{columns:true,rows:false},columns:[{text:d.translate("PRIORITY"),dataIndex:"priority",isEditable:false,isSortable:true,onCellRequest:function(o){if(!o.isHeader){var n=o.nodeModel.options.grid.type;if(n&&n==="parameter"){i._generateCellView();var m=new k({elementsList:i._getPriorityOptions(),enableSearchFlag:false,autocompleteFlag:false});var l=m.elements.container.getElementsByClassName("wux-ui-state-undefined");if(l.length>0){l[0].addClassName("wux-controls-lineeditor");l[0].removeClassName("wux-ui-state-undefined")}o.cellView.getContent().setHTML(m)}}}},{text:d.translate("LOWER_THRESHOLD"),dataIndex:"lowerThreshold",isEditable:true,isSortable:false},{text:d.translate("UPPER_THRESHOLD"),dataIndex:"upperThreshold",isEditable:true,isSortable:false},{text:d.translate("OBJECTIVE"),dataIndex:"objective",isEditable:false,isSortable:false,onCellRequest:function(o){if(!o.isHeader){var n=o.nodeModel.options.grid.type;if(n&&n==="parameter"){var m=new k({elementsList:i._getObjective(),enableSearchFlag:false,autocompleteFlag:false});var l=m.elements.container.getElementsByClassName("wux-ui-state-undefined");if(l.length>0){l[0].addClassName("wux-controls-lineeditor");l[0].removeClassName("wux-ui-state-undefined")}o.cellView.getContent().setHTML(m)}}}},{text:d.translate("COMMENTS"),dataIndex:"notes",isEditable:true,isSortable:false}],selection:{cells:false,rowHeaders:false,columnHeaders:false,canMultiSelect:false,useUnselectAllOnEmptyArea:true},showLoaderIndicator:true,treeDocument:e.getDocument()}},_generateCellView:function(){j.log("gebnerate cell view")},_getPriorityOptions:function(){var l=[];for(var m=1;m<7;m++){l.push({labelItem:m===0?d.translate("MUST_HAVE"):m,valueItem:m})}return l},_getObjective:function(){var l=[{labelItem:"",valueItem:"NONE"},{labelItem:d.translate("MINIMIZE"),valueItem:"MINIMIZE"},{labelItem:d.translate("MAXIMIZE"),valueItem:"MAXIMIZE"},{labelItem:d.translate("TARGET"),valueItem:"TARGET"}];return l},getView:function(){return i.definePageView}});return h});define("DS/SMAAnalyticsUI/SMAAnalyticsFileGrid",["DS/SMAAnalyticsUI/SMAAnalyticsProxy"],function(b){function a(c){c.classList.add("ra-filegrid-container");this.gridBox=document.createElement("div");this.gridBox.classList.add("ra-filegrid-inner");c.appendChild(this.gridBox)}a.prototype={fileList:{},fileObjResponse:{},refresh:function(e){var d=this;var c=b.getFilesForRowIDList([e],this.fileObjResponse);c.done(function(){d.updateGrid()})},updateGrid:function(){this.gridBox.innerHTML="";this.fileList={};if(typeof this.fileObjResponse.content==="undefined"){return}var c=this.fileObjResponse.content;for(var d in c){if(c.hasOwnProperty(d)){var e=c[d];e.forEach(this.addFile,this)}}},addFile:function(d){var c={};if(d.isImage===true){c.element=document.createElement("div");c.element.classList.add("ra-filegrid-cell");c.imgElem=document.createElement("img");c.imgElem.src=b.getCompleteURL(d.url);c.element.appendChild(c.imgElem);this.gridBox.appendChild(c.element);this.fileList[d.id]=c}}};return a});define("DS/SMAAnalyticsUI/SMAAnalyticsHistoryView",["DS/SMAAnalyticsUI/SMAAnalyticsLinePlot","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsFileGrid","DS/SMAAnalyticsUI/SMAAnalyticsParametersGrid","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/Controls/Button","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils"],function(c,d,b,f,e,h,a){function g(l,j,n,k){g.SIDE_PANEL={FILES:"FILES",VALUES:"VALUES"};if(!j){j=g.SIDE_PANEL.FILES}else{if(!(g.SIDE_PANEL.hasOwnProperty(j))){throw new Error("Side "+j+" not recognized.")}}if(typeof k!=="function"){k=function(){return""}}this.settings={showImprovements:false,isOptimization:n||false,getApproxId:k};this.rootDiv=l;this.linePlots={};this.dimensions={plotWidth:350,sliderBarHeight:36,sliderHeight:22,sliderWidth:22};var i=this.dimensions.sliderBarHeight;this.contentMainDiv=d3.select(this.rootDiv).append("div").classed("ra-historyview-main",true).node();this.sliderDiv=d3.select(this.rootDiv).append("div").classed("ra-historyview-footer",true).node();this.contentDiv=document.createElement("div");this.contentDiv.classList.add("ra-historyview-content");this.contentMainDiv.appendChild(this.contentDiv);this.sidePanelContainer=document.createElement("div");this.sidePanelContainer.classList.add("ra-historyview-sidepanel");this.contentMainDiv.appendChild(this.sidePanelContainer);this.sidePanelToggle=document.createElement("div");this.sidePanelToggle.classList.add("ra-historyview-sidepanel-toggle");var m=this;this.sidePanelToggle.onclick=function(){m.toggleSidePanel()};this.sidePanelContainer.appendChild(this.sidePanelToggle);switch(j){case g.SIDE_PANEL.FILES:this.sidePanel=new b(this.sidePanelContainer);break;case g.SIDE_PANEL.VALUES:this.sidePanel=new f(this.sidePanelContainer);this.sidePanel.settings.getApproxId=function(){return m.settings.getApproxId()};break}this.selectedPoint=1;this.selectedId=null;this.numDesigns=1;this.sliderScale=d3.scale.linear();this.updateParameters();this.makeSelectionBar()}g.prototype.updateParameters=function(){var k=[],i=[];if(true===this.settings.isOptimization){if(typeof this.settings.getApproxId==="function"&&this.settings.getApproxId().length>0){var j=d.approximations[this.settings.getApproxId()];if(j&&j.inputs){k=k.concat((j.inputs||[]).map(function(m){return m.ID}));k=k.concat((j.outputs||[]).map(function(m){return m.ID}));i=k}}}if(k.length===0){k=d.getAllParametersAsFlatList(false,true);i=k.filter(function(m){return d.findParameter(m).structure!=="ARRAY"})}var l=i.filter(function(o){var m=d.getConstraintBounds(o);try{return(d.getObjective(o)||(m&&(m[0]!=null||m[1]!=null)))}catch(n){return true}});if(l.length>0){this.parameters=l}else{this.parameters=i}};g.prototype.refreshView=function(){this.dimensions.rootHeight=this.rootDiv.scrollHeight;this.dimensions.contentHeight=Math.min(this.contentDiv.clientHeight,this.contentDiv.scrollHeight);var i=function(k){var j=document.getElementsByClassName("zoomedPlotContainer")[0];if(j!==undefined){var m=j.id;for(var l in k.linePlots){if(k.linePlots[l].randId==m){break}}k.rootDiv.removeChild(j);k.zoomHistoryPlot(k.linePlots[l])}};this.updatePlotContainers();this.updateHistoryPlots(i)};g.prototype.updatePlotContainers=function(){var k=this.parameters;var j=this;var i=d3.select(this.contentDiv).selectAll(".plotContainer").data(k.map(function(l){return{id:l}}),function(l){return l.id});i.exit().each(function(l){delete j.linePlots[l.id]}).remove();i.enter().append("div").classed("plotContainer",true).style({height:this.dimensions.contentHeight-12+"px","white-space":"normal",display:"inline-block",padding:"5px",margin:"4px",border:"2px solid #888",background:"#fff"}).each(function(m){var l=new c(this,j,j.settings.isOptimization,j.settings.getApproxId());j.linePlots[m.id]=l;l.x(function(n){return Number(n.index)+1});l.y(function(n){return n.value});this.setAttribute("data-paramID",m.id)})};g.prototype.zoomHistoryPlot=function(n){var m=this;var k=document.createElement("div");k.id=n.randId;this.rootDiv.appendChild(k);d3.select(k).classed("zoomedPlotContainer",true).style({position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px",background:"#fff"});var o=n.data();var l;var j={clickHandler:function(p){m.selectedPoint=Number(p.index)+1;m.selectedId=p.id;m.updateSelection("line-plot");l.addCrosshair(Number(m.selectedPoint)-1)}};l=new c(k,j,m.settings.isOptimization,m.settings.getApproxId());l.x(function(p){return p.index});l.y(function(p){return p.value});l.totalHeight(m.dimensions.contentHeight-22);l.totalWidth(m.rootDiv.offsetWidth-22);l.title(n.title());l.data(o.points,o.markerClassArray,o.xBounds,o.yBounds,o.glyphMap);l.drawPlot();l.addCrosshair(Number(m.selectedPoint)-1);l.contextCallback(function(p){m.selectedPoint=Number(p.index)+1;m.selectedId=p.id;m.updateSelection("line-plot");l.addCrosshair(Number(m.index));l.addMoreInfo(p.index)});var i=document.createElement("div");k.appendChild(i);i.classList.add("ui-icon");i.classList.add("ui-icon-closethick");d3.select(i).on("click",function(){m.rootDiv.removeChild(k)}).style({position:"absolute",top:"3px",right:"3px",width:"18px",height:"18px",cursor:"pointer"})};g.prototype.updateHistoryPlots=function(i){var l=this;var j=["GLYPH","ID","GRADING"];var k=j.length;d3.select(l.rootDiv).selectAll(".plotContainer").style({height:l.dimensions.contentHeight-22+"px"}).each(function(m){j.push(m.id)});d.getHistoryData(j,l.settings.showImprovements,true,l.settings.isOptimization,l.settings.getApproxId(),function(s){var p=s.GRADING.map(function(z,y){if(z===-1){return"HMExcluded"}else{if(z===1){return"HMInfeasible"}else{if(z===2){return"HMPareto"}else{if(z===0){return"HMDominated"}}}}});p.unshift("HMExcluded");for(var q=k;q<j.length;q++){var m=j[q];var u=[],n=false;s[m].forEach(function(z,y){if(z!=="null"){u.push({index:u.length,value:z,rowIndex:y,id:s.ID[y]});if(l.selectedId===s.ID[y]){n=true;l.selectedPoint=u.length}}});if(!n&&u.length>0){l.selectedPoint=1;l.selectedId=u[0].id}l.numDesigns=u.length;var t=l.linePlots[m];var w=d.findParameter(m);t.totalHeight(l.dimensions.contentHeight-22);t.totalWidth(l.dimensions.plotWidth);t.title(decodeURIComponent(w.alias||w.name));t.data(u,p,null,d.getConstraintBounds(m),s.GLYPH);var o=function(y){y.drawPlot();y.addCrosshair(Number(l.selectedPoint)-1);y.contextCallback(function(z){l.selectedPoint=Number(z.index)+1;l.selectedId=z.id;l.updateSelection("line-plot");y.addMoreInfo(z.index)});y.setDoubleClickBehavior(function(){l.zoomHistoryPlot(this)});if(i){i(l)}};var x=t.containerDiv.querySelector(".ra-historyplot-toolarge");if(x){t.containerDiv.removeChild(x)}if(l.numDesigns>5000){var x=document.createElement("div");x.classList.add("ra-historyplot-toolarge");var v=document.createElement("div");v.textContent=decodeURIComponent(w.displayName||w.name);x.appendChild(v);var r=new h({label:a.translate("render_chart")}).inject(x);x.paramId=m;r.addEventListener("click",function(z){r=arguments[0].currentTarget;x=r.parentElement;m=x.paramId;var y=l.linePlots[m];r.destroy();y.containerDiv.removeChild(x);o(y)});t.containerDiv.appendChild(x)}else{o(t)}}l.updateSelectionBar()})};g.prototype.makeSelectionBar=function(){var k=this;var i=function(){var q=k.sliderComponents.range.value;if(q!==k.selectedPoint){k.selectedPoint=q;k.updateSelection("slider")}};var p=function(q){k.selectedPoint=Math.min(Number(k.selectedPoint)+1,k.numDesigns);k.updateSelection("click");if(q){q.preventDefault()}};var l=function(q){k.selectedPoint=Math.max(Number(k.selectedPoint)-1,1);k.updateSelection("click");if(q){q.preventDefault()}};var o=16,m=100;this.sliderComponents={rangeContainer:document.createElement("div"),range:document.createElement("input"),sliderText:document.createElement("div"),leftArrow:document.createElement("div"),rightArrow:document.createElement("div")};var n=document.createElement("div");n.classList.add("ra-historyview-arrowDiv","ui-icon","ui-icon-triangle-1-w");this.sliderComponents.leftArrow.appendChild(n);this.sliderComponents.leftArrow.classList.add("ra-historyview-arrowcontainer");var j=document.createElement("div");j.classList.add("ra-historyview-arrowDiv","ui-icon","ui-icon-triangle-1-e");this.sliderComponents.rightArrow.appendChild(j);this.sliderComponents.rightArrow.classList.add("ra-historyview-arrowcontainer");this.sliderComponents.rangeContainer.appendChild(this.sliderComponents.range);this.sliderDiv.appendChild(this.sliderComponents.leftArrow);this.sliderDiv.appendChild(this.sliderComponents.sliderText);this.sliderDiv.appendChild(this.sliderComponents.rangeContainer);this.sliderDiv.appendChild(this.sliderComponents.rightArrow);d3.select(this.sliderComponents.leftArrow).style({left:"0px",width:o+"px",height:o+"px"}).on("click",l);d3.select(this.sliderComponents.sliderText).style({left:o+"px",width:m+"px",position:"absolute",top:"0px",bottom:"0px","padding-left":"8px","padding-top":"6px"}).text(a.translate("Alt.",": "+(this.selectedPoint)+"/"+this.numDesigns));d3.select(this.sliderComponents.rightArrow).style({width:o+"px",left:m+o+"px",height:o+"px"}).on("click",p);d3.select(this.sliderComponents.rangeContainer).style({position:"absolute",left:m+2*o+4+"px",right:"4px",top:"0px",bottom:"0px"});d3.select(this.sliderComponents.range).attr("type","range").attr("min",1).attr("max",this.numDesigns).on("mousemove",i)};g.prototype.updateSelectionBar=function(){var j=this.sliderComponents.rangeContainer.offsetWidth,i=this.sliderComponents.rangeContainer.offsetHeight;d3.select(this.sliderComponents.range).style({height:i+"px",width:j+"px"});this.updateSelection()};g.prototype.clickHandler=function(i){this.selectedPoint=Number(i.index)+1;this.selectedId=i.id;this.updateSelection("line-plot")};g.prototype.updateSelection=function(n){var l=this;if(n!=="slider"){this.sliderComponents.range.max=this.numDesigns;this.sliderComponents.range.value=this.selectedPoint}d3.select(this.sliderComponents.sliderText).text(a.translate("Alt.",": "+(this.selectedPoint)+"/"+this.numDesigns));d3.select(this.contentDiv).selectAll(".plotContainer").each(function(r){try{var q=l.linePlots[r.id].updateCrosshair(Number(l.selectedPoint)-1);l.selectedId=q.id}catch(p){}});if(l.settings.isOptimization){var o={isOptimization:true,approximation:l.settings.getApproxId()},j={};var m;try{m=l.linePlots[Object.keys(l.linePlots)[0]].internalData.points[Number(l.selectedPoint)-1].id}catch(k){m=l.selectedPoint}d.getRowInfo(m,j,o).done(function(){var p=[];if(j&&j.content&&j.content.parmValues){var r=d.approximations[l.settings.getApproxId()].inputs;r.forEach(function(t){var s=t.ID;var u=j.content.parmValues[s];sessionInfo.predictPage.currentValues[s]=u;p.push({pid:s,value:u,title:decodeURIComponent(t.displayName),type:"input"})},this);var q=d.approximations[l.settings.getApproxId()].outputs;q.forEach(function(s){p.push({pid:s.ID,value:j.content.parmValues[s.ID],title:decodeURIComponent(s.displayName),type:"output"})},this);this.sidePanel.refresh(l.selectedPoint,p)}}.bind(l))}else{var i=Object.keys(this.linePlots).map(function(p){return{pid:p,value:l.linePlots[p].internalData.points[l.selectedPoint-1].value,title:l.linePlots[p].internalData.title}});this.sidePanel.refresh(this.selectedPoint,i)}};g.prototype.makeSelectParamPopover=function(){var o=this;var l=$simjq("<div></div>",{id:"paramsPopover"});var u;var q;var s;var k;var j=d.getAllParametersAsFlatList(false,true);j=j.filter(function(i){return d.findParameter(i).structure!=="ARRAY"});var p={};for(var m=0;m<this.parameters.length;m++){p[this.parameters[m]]=true}var n=function(w,x){var i=function(){if(x.checked){p[w]=true}else{delete p[w]}};return i};for(var m=0;m<j.length;m++){k=j[m];var r=d.findParameter(k);if(p[k]===true){s=true}else{s=false}u=$simjq("<div></div>",{id:"#_"+k,"class":"sim-ui-history-view-params"}).appendTo(l);q=$simjq("<input />",{type:"checkbox",id:"cb_"+k,value:k}).appendTo(u);q.prop("checked",s);q.change(n(k,q[0]));$simjq("<label />",{"for":"cb_"+k,text:r.displayName}).appendTo(u)}var t=function(){var i=$simjq('<button style="margin:4px;">OK</button>').on("click",function(){o.parameters=Object.keys(p);o.refreshView();e.closePopover()});return i};var v={width:550,height:550,noTabs:true,footerOptions:{type:"button",content:t}};e.makePopover([a.translate("Shown In History View"),a.translate("Shown In History View")],[l],a.translate("Select Parameters"),"sim-ui-som-params-popover",v)};g.prototype.makeOptionsPopover=function(){var j=this;var i={};d.getPageOptions("shopDesignsPage",i).done(function(){var k=i.content;if(!$simjq.isEmptyObject(k)&&k.historySettings){if(typeof k.historySettings.showImprovements!=="undefined"){j.settings.showImprovements=k.historySettings.showImprovements}}var m=Object.create(j.settings);var n=document.createElement("div");n.setAttribute("id","optionsPopover");var p=document.createElement("div");var o=document.createElement("span");o.textContent=a.translate("only_show_improvements_colon")+" ";var q=function(){m.showImprovements=l.checked};var l=document.createElement("input");l.setAttribute("type","checkbox");l.checked=m.showImprovements;d3.select(l).on("change",q);p.appendChild(o);p.appendChild(l);n.appendChild(p);var r=function(){var t=$simjq('<button style="margin:4px;">'+a.translate("OK")+"</button>").on("click",function(){var v=true;for(var u=0;u<Object.keys(m).length;u++){if(j.settings[Object.keys(m)[u]]!==m[Object.keys(m)[u]]){v=false;break}}if(!v){d.executeCommand({commandName:"setPageOptionsFromJson",data:{pageName:"shopDesignsPage",pageOptions:JSON.stringify({historySettings:{showImprovements:m.showImprovements}})}});j.settings=m;j.refreshView()}e.closePopover()});return t};var s={width:600,height:200,noTabs:true,footerOptions:{type:"button",content:r}};e.makePopover([],[$simjq(n)],a.translate("History Options"),"sim-ui-som-options-popover",s)})};g.prototype.toggleSidePanel=function(){if(this.sidePanelToggle.classList.contains("closed")){this.sidePanelToggle.classList.remove("closed");this.sidePanel.gridBox.classList.remove("hidden")}else{this.sidePanelToggle.classList.add("closed");this.sidePanel.gridBox.classList.add("hidden")}};return g});define("DS/SMAAnalyticsUI/SMAAnalyticsPredictPage",["UWA/Core","UWA/Class/Promise","DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsProfiler","DS/SMAAnalyticsUI/SMAAnalyticsParameterControlList","DS/SMAAnalyticsUI/SMAAnalyticsPredictionMeasures","DS/SMAAnalyticsUI/SMAAnalyticsHistoryView","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsFileUpload","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsUI/SMAAnalyticsApproxSettings","DS/Windows/Dialog","DS/Controls/Button","DS/Usage/TrackerAPI","DS/SMAAnalyticsUI/SMAAnalyticsOptimizeView"],function(n,e,d,o,k,l,s,m,b,q,g,r,f,a,h,j,p,i){function c(t,E){var C=o.getSwitch("RA_INTERACTIVE_DESIGN");if(C){var y=document.querySelector('#predictpagetoolbar .sim-ui-panel-content-toolbarbutton[title="Save"]');y.addEventListener("click",function(){o.storeAdviseCase()})}t.predictPage=t.predictPage||{};t.predictPage.isEKHandlerSet=false;t.predictPage.pageLoaded=false;t.predictPage.create=c;t.predictPage.pageState={controls:{initialized:false},profiler:{initialized:false},contour:{initialized:false},measures:{initialized:false},approxTable:undefined,status:"main"};t.predictPage.approxSettings={};t.predictPage.formulationMap={};t.predictPage.errorOptions={CREATION_FAILED:true,ERROR_NO_INPUTS:true,ERROR_NO_OUTPUTS:true,ERROR_NO_PARAMETERS:true,ERROR_NO_DATA:true,ERROR_MULTIPLE:true,NOT_AVAILABLE:true};t.predictPage.methodsAlias={rsm:g.translate("AP_TYPE_RSM"),rbf:g.translate("AP_TYPE_RBF"),best:g.translate("AP_TYPE_BEST")};t.predictPage.subTitleMap={INITIALIZATION:g.translate("Initializing")+"...",VALIDATION:g.translate("Validating")+"...",CREATION_FAILED:g.translate("Creation Failed"),ERROR_NO_INPUTS:g.translate("ERROR_NO_INPUTS"),ERROR_NO_OUTPUTS:g.translate("ERROR_NO_OUTPUTS"),ERROR_NO_PARAMETERS:g.translate("ERROR_NO_PARAMETERS"),ERROR_NO_DATA:g.translate("ERROR_NO_DATA"),ERROR_MULTIPLE:g.translate("ERROR_MULTIPLE"),OUT_OF_DATE:g.translate("OUT_OF_DATE"),MULTIPLE_OUT_OF_DATE:g.translate("MULTIPLE_OUT_OF_DATE")+".",NOT_AVAILABLE:g.translate("NOT_AVAILABLE"),READY:g.translate("Ready"),FAILED:g.translate("Failed"),OPTIMIZING:g.translate("Optimizing")+"..."};t.predictPage.currentValues=t.predictPage.currentValues||{};t.predictPage.currentStdDevs=t.predictPage.currentStdDevs||{};t.predictPage.approxTable=document.getElementById("ra-approx-table");t.predictPage.addDesignButton=document.getElementById("addPredDesignButton");t.predictPage.currentView="#profilerview";t.predictPage.previousApproximation=false;t.predictPage.parameterControlLists={outputs:new l(document.getElementById("predictoutputscontrol").getElementsByClassName("sim-ui-panel-controlgroup-contentpanel")[0],t.predictPage,undefined,"sidebar-output"),inputs:new l(document.getElementById("predictinputscontrol").getElementsByClassName("sim-ui-panel-controlgroup-contentpanel")[0],t.predictPage,undefined,"sidebar-input"),other:new l(document.getElementById("predictotherscontrol").getElementsByClassName("sim-ui-panel-controlgroup-contentpanel")[0],t.predictPage,undefined,"sidebar-other")};t.predictPage.measuresRendered=false;t.predictPage.parametersDeferred=new d.Deferred();t.predictPage.measuresDeferred=new d.Deferred();t.predictPage.measuresDeferred.resolve();t.predictPage.updateParameters=function(){var H=t.predictPage.parametersDeferred.state();if(H==="resolved"||H==="rejected"){t.predictPage.parametersDeferred=new d.Deferred()}var I=Object.keys(o.approximations);var G=I.map(function(J){return o.getSkippedApproximationParameters(J)});d.when.apply(null,G).done(function(){t.predictPage.parametersDeferred.resolve()})};t.predictPage.zoomValues={};t.predictPage.removedParameters={};t.predictPage.orderedParameters={inputs:[],outputs:[]};t.predictPage.updateOrderedParameters=function(G){};t.predictPage.pageState.profiler={initialized:false};t.predictPage.pageState.approxSelector=document.querySelector("ra-approx-table");t.predictPage.selectedApproxIds=[];t.predictPage.approximationIds=[];t.predictPage.approxColors={};t.predictPage.updateApproxTableComponent=function(H){var G=function(){var I=o.approximations;var L=Object.keys(I);for(var J in I){if(I.hasOwnProperty(J)){var K=I[J];t.predictPage.addApproximation(K.id);if(t.predictPage.selectedApproxIds.length===0){if(K.displayName==="RSM"){t.predictPage.selectedApproxIds.push(J);t.predictPage.refreshCurrentView()}}}}if(t.predictPage.selectedApproxIds.length===0&&L[0]){t.predictPage.selectedApproxIds.push(L[0]);t.predictPage.refreshCurrentView()}if(t.predictPage.approxColors){L.forEach(function(M){I[M].approx_color=t.predictPage.approxColors[M]})}t.predictPage.approxTable.set("approximations",JSON.stringify(I));t.predictPage.approxTable.selectedApproximations=t.predictPage.selectedApproxIds;t.predictPage.approxTable.updateStatus(I);if(typeof H==="function"){H(I)}};if(Object.keys(o.approximations).length>0){t.predictPage.getApproximationErrorMeasures(G)}else{o.getCreatedApproximations(function(){t.predictPage.getApproximationErrorMeasures(G)})}};t.predictPage.addApproximation=function(I){if(t.predictPage.approximationIds.indexOf(I)===-1){t.predictPage.approximationIds.push(I);if(!t.predictPage.approxColors.hasOwnProperty(I)){var H=d3.scale.category20();H.domain(d3.range(20));var G=H(t.predictPage.approximationIds.length-1);t.predictPage.approxColors[I]=G}}};t.predictPage.setApproximations=function(H){t.predictPage.approximationIds=[];var G;for(G=0;G<H.length;G++){t.predictPage.addApproximation(H[G])}};t.predictPage.getStatus=function(L){var I=new d.Deferred();var K=function(M){L(M);I.resolve()};if(t.predictPage.selectedApproxIds.length===0){K("NOT_AVAILABLE")}else{if(t.predictPage.selectedApproxIds.length===1){K(o.approximations[t.predictPage.selectedApproxIds[0]].status)}else{var H="READY";var J,G;for(J=0;J<t.predictPage.selectedApproxIds.length;J++){G=o.approximations[t.predictPage.selectedApproxIds[J]].status;if(G==="OUT_OF_DATE"){H="MULTIPLE_OUT_OF_DATE"}else{if(G!=="READY"){H="MULTIPLE_ERROR";break}}}K(H)}}return I};t.predictPage.enter=function(){if(o.getSwitch("RA_INTERACTIVE_DESIGN")){var H=document.getElementById("approxSettings");H.classList.add("approx-control-button-hidden")}var G=p.getCounter("RAPredictPageEntered");G.inc();t.predictPage.fullRefresh({buildProfiler:false});try{o.initializeEK();if(!t.predictPage.isEKHandlerSet){t.predictPage.isEKHandlerSet=true;o.addEKMessageHandler(t.predictPage)}}catch(I){}if(!o.getSwitch("RA_INTERACTIVE_DESIGN")){if(typeof t.predictPage.analyticsOptView==="undefined"||t.predictPage.analyticsOptView===null){t.predictPage.analyticsOptView=new i(undefined,t.predictPage)}t.predictPage.analyticsOptView.setUpViewLayout()}};t.predictPage.fullRefresh=function(G){if(!t.predictPage.measuresInitialized){t.predictPage.initializeMeasures()}if(!t.predictPage.pageState.controls.initialized){t.predictPage.updateAllSliders()}t.predictPage.measures={};t.predictPage.createApproxTableComponent(function(){t.predictPage.statusChanged();t.predictPage.updateStatusView()})};t.predictPage.fullRefresh_OLD=function(){if(!t.predictPage.measuresInitialized){t.predictPage.initializeMeasures()}if(!t.predictPage.pageState.controls.initialized){t.predictPage.updateAllSliders()}t.predictPage.statusChanged();t.predictPage.updateStatusView();t.predictPage.measures={};t.predictPage.getApproximationErrorMeasures();t.predictPage.createApproxTableComponent()};t.predictPage.postRender=function(G){t.predictPage.refreshSliders()};t.predictPage.resize=function(){t.predictPage.resizeControlPanel();if(t.predictPage.predictionMeasures&&t.predictPage.predictionMeasures.tableHandler&&t.predictPage.predictionMeasures.tableHandler.element){t.predictPage.predictionMeasures.tableHandler.element.resize()}if(t.predictPage.pageState.profiler.initialized===true){t.predictPage.analyticsProfiler.resize()}};t.predictPage.resizeControlPanel=function(){var S=14;var R=document.getElementById("predictcontrolpanel");var P=R.offsetHeight;var Q=document.getElementById("predictoutputscontrol").getElementsByClassName("sim-ui-panel-controlgroup-contentpanel")[0],O=document.getElementById("predictinputscontrol").getElementsByClassName("sim-ui-panel-controlgroup-contentpanel")[0],U=document.getElementById("predictotherscontrol").getElementsByClassName("sim-ui-panel-controlgroup-contentpanel")[0],G=document.getElementById("predictcontrolmeasurediv");var T=150*(Math.min(Q.childElementCount,2)+Math.min(O.childElementCount,2)+Math.min(U.childElementCount,2));var M=Math.max(R.offsetHeight,T)-(G.offsetHeight+3);var J=[Q,O,U];var H,L;var V=function(X){var W=Math.min(L-H,M/J.length);d(X).css("max-height",X.offsetHeight+(W-12)+"px")},I=function(X){var W=Math.max(L-H,M/K.length);d(X).css("max-height",X.offsetHeight+(W-12)+"px")};var N=0,K=[];if(M>0){M-=4;J.sort(function(X,W){return X.offsetHeight-W.offsetHeight});while(M>0.1&&J.length>0){if(J[0].scrollHeight!==J[0].clientHeight){L=J[0].scrollHeight+12;H=J[0].offsetHeight;J.forEach(V);M-=Math.min((L-H)*J.length,M)}J.shift()}}else{if(M<0){M-=4;J.sort(function(X,W){return W.offsetHeight-X.offsetHeight});while(M<-0.1&&N<J.length){K.push(J[N]);H=J[N].offsetHeight;if(N<J.length-1){L=J[N+1].offsetHeight}else{L=Infinity;break}K.forEach(I);M-=Math.max((L-H)*K.length,M);N++}}}};t.predictPage.approxRowSelectionCallback=function(I){var G=Array.isArray(I.detail)?I.detail:[];var H=false;if(G.length!==t.predictPage.selectedApproxIds.length){H=true}else{H=G.some(function(J){if(t.predictPage.selectedApproxIds.indexOf(J)<0){return true}})}if(!H){return}t.predictPage.selectedApproxIds=G;t.predictPage.refreshCurrentView()};t.predictPage.onApproxEdit=function(ac){var R=ac.detail||"";var ah=function(ak){t.predictPage.approxSettings[ak.id]=args;t.predictPage.updateApproxTableComponent()};var ag=o.approximations[R];var Q=this;var X=d("<div></div>",{id:"paramsTab"});var aa=d("<div></div>",{id:"datasetsTab"});var M;var ai;var V;var P;var T;var N;var J=ag.inputs;var af=ag.outputs;var aj=ag.settings.excludedInputs||[];var ab=aj.map(function(ak){return o.findParameter(ak)});var L=J.concat(ab);var ae={};for(var ad=0;ad<ab.length;ad++){ae[ab[ad].ID]=true}var W=function(al,am){var ak=function(){if(am.checked){delete ae[al]}else{ae[al]=true}};return ak};for(var ad=0;ad<L.length;ad++){T=L[ad].ID;var K=L[ad];if(ae[T]===true){P=false}else{P=true}M=d("<div></div>",{id:"#_"+T,"class":"sim-ui-history-view-params"}).appendTo(X);ai=d("<input />",{type:"checkbox",id:"cb_"+T,value:T}).appendTo(M);ai.prop("checked",P);ai.change(W(T,ai[0]));d("<label />",{"for":"cb_"+T,text:decodeURIComponent(K.displayName)}).appendTo(M)}var O=o.getDataSets();var I=ag.settings.excludedDatasets||[];var Y=O.filter(function(ak){return I.indexOf[ak.alias]!==-1});var H={};for(var ad=0;ad<I.length;ad++){H[I[ad]]=true}var W=function(am,al){var ak=function(){if(al.checked){delete H[am]}else{H[am]=true}};return ak};for(var ad=0;ad<O.length;ad++){N=O[ad].alias;var U=O[ad];if(H[N]===true){P=false}else{P=true}V=d("<div></div>",{id:"#_"+N,"class":"sim-ui-history-view-params"}).appendTo(aa);ai=d("<input />",{type:"checkbox",id:"cb_"+N,value:N}).appendTo(V);ai.prop("checked",P);ai.change(W(N,ai[0]));var S=U.title;if(typeof S==="undefined"||S===null||S.length===0){S=U.name}d("<label />",{"for":"cb_"+N,text:S}).appendTo(V)}var Z=function(){var ak=d('<button style="margin:4px;">OK</button>').on("click",function(){var an=Object.keys(ae);var aq=Object.keys(H);var al=L.map(function(ar){return ar.ID});var ap=af.map(function(ar){return ar.ID});var ao={excludedInputs:an,excludedDatasets:aq};var am={inputIdList:al,outputIdList:ap,settings:ao};o.setApproximationParameters(R,am);t.predictPage.updateApproxTableComponent();t.predictPage.approxSettings[R]=am;t.predictPage.approxRowSelectionCallback({detail:[R]});q.closePopover()});return ak};var G={width:550,height:550,footerOptions:{type:"button",content:Z}};q.makePopover([g.translate("Parameters"),g.translate("DATA_SETS")],[X,aa],g.translate("APPROX_SETTINGS"),"sim-ui-predict-params-popover",G)};t.predictPage.onApproxClone=function(G){var J=G.detail||"";if(J.length===0){return}var O=o.approximations[J];var Q={displayName:g.translate("clone_of")+O.displayName,settings:O.settings,type:O.type};var L=function(S){t.predictPage.updateApproxTableComponent();t.predictPage.approxRowSelectionCallback({detail:[S.id]})};var K=document.createElement("input");var N=function(){if(o.isApproxNameUsed(K.value)){alert('Approximation name "'+K.value+" is in use. Please choose a unique name.")}else{Q.displayName=K.value;o.createNewApproximation(Q,L);q.closePopover()}};var H=d('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+g.translate("CREATE")+"</button>").on("click",N);var M=g.translate("clone_approx"),R={width:400,height:150,noTabs:true,footerOptions:{type:"buttons",content:H}},I=document.createElement("div");var P=document.createElement("span");P.textContent=g.translate("approx_name")+":";K.value=Q.displayName;I.appendChild(P);I.appendChild(K);q.makePopover([],[d(I)],M,"createApproximationPopover",R)};t.predictPage.onApproxDelete=function(J){var M=J.detail||"";if(M.length===0){return}var I=function(O){o.deleteApproximations(O).done(function(){O.forEach(function(Q){t.predictPage.selectedApproxIds.splice(t.predictPage.selectedApproxIds.indexOf(Q),1);if(t.predictPage.selectedApproxIds.length===0){var P=Object.keys(o.approximations)[0];if(P){t.predictPage.selectedApproxIds.push(P)}}});t.predictPage.fullRefresh()})};var N=g.translate("approx_delete_confirm");var K=[M];var L=false;var G=Object.keys(o.approximations);for(var H=0;H<G.length;H++){if(o.approximations[G[H]].settings.isBest){L=o.approximations[G[H]];break}}if(L&&L.settings.connectedApproximations&&L.settings.connectedApproximations.indexOf(M)!==-1){N+="\n\n"+g.translate("approx_delete_best");K.push(L.id)}if(confirm(N)){I(K)}};t.predictPage.changeCurrentViewTo=function(J){if(typeof J==="undefined"||J===null||J.length===0){return}var H=document.querySelector("[data-view="+t.predictPage.currentView.substr(1)+"]");H.classList.remove("sim-ui-panel-content-viewbutton-current");t.predictPage.lastView=t.predictPage.currentView;t.predictPage.currentView=J;H=document.querySelector("[data-view="+t.predictPage.currentView.substr(1)+"]");H.classList.add("sim-ui-panel-content-viewbutton-current");var I=d("#addPredDesignButton");d(".sim-ui-panel-content-toolbarbutton.opt-settings").hide();var G=document.getElementsByClassName("sim-ui-panel-content-predictStatus-fixed")[0];if("#optimize-mgrid-view"!==J){G.textContent=g.translate("Approximation Status")+": ";I.show()}else{G.textContent=g.translate("OPT_STATUS_LABEL")+": ";I.hide()}d(t.predictPage.lastView).hide();d(t.predictPage.currentView).show()};t.predictPage.onFitSelect=function(G){if(G.detail){var H="#measureview";t.predictPage.selectedApproxIds=[G.detail.approx_id];if(G.detail.status==="READY"||G.detail.status==="OUT_OF_DATE"||G.detail.status==="VALIDATION"){if(!d(H).is(":visible")){t.predictPage.changeCurrentViewTo(H);t.predictPage.measuresRendered=false;t.predictPage.updateMeasures()}else{t.predictPage.approxRowSelectionCallback({detail:[G.detail.approx_id]})}}}};t.predictPage.onApproxRetrain=function(G){if(G.detail){var I=G.detail;o.setApproximationParameters(I);t.predictPage.measuresInitialized=false;var H=t.predictPage.analyticsOptView;if(H&&typeof H==="function"){H._clearOptimizationDataAndPlots()}}};t.predictPage.onApproxOptimize=function(H){var J="#optimize-mgrid-view";var I=H.detail||sessionInfo.predictPage.approxTable.selectedApproximations[0];if(!d(J).is(":visible")){t.predictPage.changeCurrentViewTo(J)}var G=t.predictPage.analyticsOptView;if(G){G.viewEnterHandler(I,true).then(function(){G.startOptimization()})["catch"](function(K){console.warn("Failed to start optimization. ",K)})}};t.predictPage.onApproxExport=function(G){if(G.detail){t.predictPage.createExportPopup(G.detail)}};t.predictPage.createApproxTableComponent=function(I){I=I||function(){};var G=o.getNewTransactionDeferred();var H=t.predictPage.approxTable;if(typeof H!=="undefined"&&H!==null){G.resolve()}else{H=document.querySelector("ra-approx-table");if(H!==null){G.resolve()}else{H=document.createElement("ra-approx-table");document.querySelector("#predictapproxcontrol .sim-ui-panel-controlgroup-contentpanel").appendChild(H);H.addEventListener("onComponentReady",G.resolve)}}G.then(function(){H.addEventListener("onApproximationSelectionChange",t.predictPage.approxRowSelectionCallback);H.addEventListener("onEditApproximationSelect",t.predictPage.onApproxEdit);H.addEventListener("onCloneApproximationSelect",t.predictPage.onApproxClone);H.addEventListener("onDeleteApproximationSelect",t.predictPage.onApproxDelete);H.addEventListener("onRefreshApproximationSelect",t.predictPage.onApproxRetrain);H.addEventListener("onExportApproximationSelect",t.predictPage.onApproxExport);H.addEventListener("onOptimizeApproximationSelect",t.predictPage.onApproxOptimize);H.addEventListener("onFitCellClick",t.predictPage.onFitSelect);t.predictPage.approxTable=H;t.predictPage.updateApproxTableComponent(function(){t.predictPage.updateSkippedSliders();I()})}.bind(this))};t.predictPage.updateSelection=function(G){t.predictPage.refreshCurrentView()};t.predictPage.updateApproxSettingState=function(){var H=t.predictPage.approximationIds;var G=[];[].forEach.call(H,function(I){if(o.approximations.hasOwnProperty(I)){G.push(o.approximations[I].status)}});if(G.contains("INITIALIZATION")||G.contains("VALIDATION")){d("#approxSettings").css({opacity:0.6});d("#approxSettings").prop("disabled",true)}else{d("#approxSettings").css({opacity:1});d("#approxSettings").prop("disabled",false)}};t.predictPage.refreshCurrentView=function(H){var G=function(I){t.predictPage.updateApproxSettingState();if(I==="OUT_OF_DATE"||I==="READY"){if(d("#profilerview").is(":visible")){t.predictPage.updateProfiler()}else{if(d("#measureview").is(":visible")){t.predictPage.measuresRendered=false;t.predictPage.updateMeasures()}else{if(d("#optimize-mgrid-view").is(":visible")){t.predictPage.analyticsOptView.viewEnterHandler(t.predictPage.selectedApproxIds[0])["catch"](function(J){console.log("Fail on enter of optimize view.")})}else{d("#statusview").hide();if(t.predictPage.lastView==="#measureview"){t.predictPage.measuresRendered=false;d("#measureview").show();t.predictPage.updateMeasures()}else{if(t.predictPage.lastView==="#profilerview"){d("#profilerview").show();t.predictPage.updateProfiler()}else{if(t.predictPage.lastView==="#optimize-mgrid-view"){d("#optimize-mgrid-view").show();t.predictPage.analyticsOptView.viewEnterHandler(t.predictPage.selectedApproxIds[0])["catch"](function(J){console.log("Fail on enter of optimize view.")})}}}}}}}else{t.predictPage.statusChanged()}t.predictPage.updateButtons(I);t.predictPage.updateStatusControl(H)};t.predictPage.getStatus(G)};t.predictPage.createApproxPopover=function(){if(this.disabled){return}a.init().then(function(H){var I=document.createElement("div");var G=false;for(var J in o.approximations){if(o.approximations[J].displayName==="Best"){G=true;break}}t.predictPage.methodsAlias=H._types;I.classList.add("ra-create-approx-popover");o.getApproximationTypes(function(K){if(!G){K.push("best")}H.createSettingsForm(I,K,t.predictPage.updateApproxTableComponent)},function(){f.alertMessage(f.ERROR,g.translate("APPROX_TYPE_ERR")+".")})})};var v=document.getElementById("approxSettings");v.setAttribute("title",g.translate("Create New Approximation"));v.addEventListener("click",t.predictPage.createApproxPopover);t.predictPage.updateParameterRole=function(G,I,H){var K=o.findParameter(G);var J=J||{};if(I.indexOf("output")>-1){K.role="OUTPUT";J.iaEventUISource="parameterControlOutputList"}else{if(I.indexOf("input")>-1){K.role="INPUT";J.iaEventUISource="parameterControlInputList"}else{K.role="UNKNOWN";J.iaEventUISource="parameterControlOtherList"}}t.predictPage.updateAllSliders();H.node().scrollTop=H.node().scrollHeight;o.setParameterInfo(K,J);o.updateApproximationStatus();t.predictPage.postRender()};var F=document.getElementById("predictinputssearch"),A=document.getElementById("predictoutputssearch"),D=document.getElementById("predictotherssearch");var B=function(G,I){var H=d(this).val().toLowerCase();if(G.which===27){H="";d(this).val(H)}else{if(G.which===13){G.preventDefault()}}I(H);t.predictPage.updateAllSliders()};var z=function(G){if(G===""){t.predictPage.inputFilterString=undefined}else{t.predictPage.inputFilterString=G}};var u=function(G){if(G===""){t.predictPage.outputFilterString=undefined}else{t.predictPage.outputFilterString=G}};var x=function(G){if(G===""){t.predictPage.othersFilterString=undefined}else{t.predictPage.othersFilterString=G}};d(F).on("keyup",function(G){B.call(this,G,z)});d(A).on("keyup",function(G){B.call(this,G,u)});d(D).on("keyup",function(G){B.call(this,G,x)});t.predictPage.updateAllSliders=function(){t.predictPage.sliderUpdates=t.predictPage.sliderUpdates||0;t.predictPage.sliderUpdates++;var H=b.getFormulationMap();var I=t.predictPage.inputFilterString||undefined,G=t.predictPage.outputFilterString||undefined,N=t.predictPage.othersFilterString||"";var L={};var O=o.getInputParametersList2(),M=o.getOutputParametersList2(),K=o.getOtherParametersList();var J=function(Q){var P=o.getParameterCopy(Q);P.formulation=H.values[Q.ID];return P};if(I){O=O.filter(function(P){return(P.displayName.toLowerCase().indexOf(I)!==-1)})}O=O.map(J);if(G){M=M.filter(function(P){return(P.displayName.toLowerCase().indexOf(G)!==-1)})}M=M.map(J);if(N){K=K.filter(function(P){return(P.displayName.toLowerCase().indexOf(N)!==-1)})}K=K.map(J);t.predictPage.orderedParameters.outputs=M;t.predictPage.orderedParameters.inputs=O;t.predictPage.parameterControlLists.inputs.update(O);t.predictPage.parameterControlLists.outputs.update(M);t.predictPage.parameterControlLists.other.update(K)};t.predictPage.refreshSliders=function(){t.predictPage.parameterControlLists.inputs.refresh();t.predictPage.parameterControlLists.outputs.refresh();t.predictPage.parameterControlLists.other.refresh()};t.predictPage.updateSkippedSliders=function(){function G(){var L,J,M,K,I=[];for(L=0;L<t.predictPage.selectedApproxIds.length;L++){K=o.approximations[t.predictPage.selectedApproxIds[L]].skippedInputs;for(J=0;J<K.length;J++){if(I.indexOf(K[J])===-1){I.push(K[J])}}}return I}function H(){var L,J,M,K,I=[];for(L=0;L<t.predictPage.selectedApproxIds.length;L++){K=o.approximations[t.predictPage.selectedApproxIds[L]].skippedOutputs;for(J=0;J<K.length;J++){if(I.indexOf(K[J])===-1){I.push(K[J])}}}return I}t.predictPage.updateParameters();t.predictPage.parametersDeferred.done(function(){t.predictPage.parameterControlLists.inputs.setDisabledControls(G());t.predictPage.parameterControlLists.outputs.setDisabledControls(H())})};t.predictPage.statusChanged=function(J,I){if(!t.predictPage.measuresInitialized){t.predictPage.initializeMeasures()}var K=function(){if(!d("#statusview").is(":visible")){if(d("#profilerview").is(":visible")){t.predictPage.currentView="#profilerview"}else{if(d("#measureview").is(":visible")){t.predictPage.currentView="#measureview"}else{if(d("#optimize-mgrid-view").is(":visible")){t.predictPage.currentView="#optimize-mgrid-view"}}}d("#profilerview").hide();d("#measureview").hide();d("#optimize-mgrid-view").hide();d("#statusview").show()}else{t.predictPage.updateStatusView()}},H=function(){if(d("#statusview").is(":visible")){d("#statusview").hide();d(t.predictPage.currentView).show()}};t.predictPage.getStatus(G);function G(L){t.predictPage.updateApproxSettingState();if(L===t.predictPage.previousStatus){return}if(L==="VALIDATION"){t.predictPage.pageState.profiler.measuresDisabled=true;t.predictPage.updateAllSliders();t.predictPage.updateParameters();H();t.predictPage.updateView(L)}else{if(L==="READY"||(L==="OUT_OF_DATE"&&t.predictPage.pageState.profiler.initialized!==false)){if(L==="READY"){t.predictPage.updateAllSliders();t.predictPage.updateParameters();if(t.predictPage.previousStatus==="VALIDATION"){if(typeof I==="undefined"){I={}}if(typeof I.updateProfiler==="undefined"){I.updateProfiler="measuresOnly"}}t.predictPage.getApproximationErrorMeasures(t.predictPage.updateView.bind(this,L,I));t.predictPage.pageState.profiler.measuresDisabled=false;t.predictPage.updateSkippedSliders()}H()}else{if((t.predictPage.measuresDeferred.state()!=="pending")&&(L!=="MULTIPLE_OUT_OF_DATE")){t.predictPage.measuresDeferred=new d.Deferred()}K()}}t.predictPage.updateButtons(L);t.predictPage.updateApproxTableComponent();if(t.predictPage.analyticsOptView&&typeof t.predictPage.analyticsOptView.approximationStatusChanged==="function"){t.predictPage.analyticsOptView.approximationStatusChanged(o.approximations)}}t.predictPage.updateStatusControl(J);t.predictPage.updateStatusView()};t.predictPage.updateButtons=function(G){if(G==="READY"||G==="OUT_OF_DATE"||G==="VALIDATION"){if(t.predictPage.selectedApproxIds.length===1){t.predictPage.addDesignButton.addEventListener("click",t.predictPage.addPredictedDesign);t.predictPage.addDesignButton.classList.remove("toolbar-button-disabled")}else{t.predictPage.addDesignButton.removeEventListener("click",t.predictPage.addPredictedDesign);t.predictPage.addDesignButton.classList.add("toolbar-button-disabled")}}else{t.predictPage.addDesignButton.removeEventListener("click",t.predictPage.addPredictedDesign);t.predictPage.addDesignButton.classList.add("toolbar-button-disabled")}};t.predictPage.updateStatusView=function(){var Q=document.getElementsByClassName("sim-ui-statusView-statusTitle")[0],N=document.getElementsByClassName("sim-ui-statusView-statusBar")[0],I=document.getElementsByClassName("sim-ui-statusView-button")[0],O=document.getElementsByClassName("sim-ui-statusView-statusSubTitle")[0],L=document.getElementsByClassName("sim-ui-statusView-errorDetails")[0],G=document.getElementsByClassName("sim-ui-statusView-statusBarBorder")[0];if(Object.keys(o.approximations).length===0){Q.textContent=g.translate("no_created_approx");O.textContent="";I.textContent=g.translate("Create New Approximation");I.addEventListener("click",t.predictPage.createApproxPopover);if(o.getSwitch("RA_INTERACTIVE_DESIGN")){I.style.display="none"}G.style.display="none";return}else{I.removeEventListener("click",t.predictPage.createApproxPopover);G.style.display="block"}if(t.predictPage.selectedApproxIds.length===0){Q.textContent=g.translate("no_selected_approx");O.textContent="";I.style.display="none";G.style.display="none";return}else{if(t.predictPage.selectedApproxIds.length>1){Q.textContent=g.translate("MULTIPLE_OUT_OF_DATE");O.textContent="";I.style.display="none";G.style.display="none";return}else{if(t.predictPage.selectedApproxIds.length===1&&o.approximations[t.predictPage.selectedApproxIds[0]].displayName==="Best"){Q.textContent=g.translate("best_not_available");O.textContent=g.translate("best_not_available_sub");I.style.display="none";G.style.display="none";return}else{I.style.display="block";G.style.display="block";if(o.getSwitch("RA_INTERACTIVE_DESIGN")){I.style.display="none"}}}}var M={INITIALIZATION:25,VALIDATION:75,READY:100,CREATION_FAILED:100,ERROR_NO_INPUTS:100,ERROR_NO_OUTPUTS:100,ERROR_NO_PARAMETERS:100,ERROR_NO_DATA:100,ERROR_MULTIPLE:0,NOT_AVAILABLE:0,NONE_SELECTED:0,OUT_OF_DATE:0,MULTIPLE_OUT_OF_DATE:100,undefined:100};var H=["VALIDATION","INITIALIZATION"];function K(){var R,S;for(R=0;R<t.predictPage.selectedApproxIds.length;R++){S=t.predictPage.selectedApproxIds[R];if(H.indexOf(o.approximations[S].status)!==-1){o.cancelApproximationInitialization(S)}}}function P(){var R,S;for(R=0;R<t.predictPage.selectedApproxIds.length;R++){S=t.predictPage.selectedApproxIds[R];if(H.indexOf(o.approximations[S].status)!==-1){return true}}}function J(R){d(N).css("width",M[R]+"%");L.textContent="";if(R==="NOT_AVAILABLE"||R==="OUT_OF_DATE"||R==="MULTIPLE_OUT_OF_DATE"){Q.textContent=g.translate("not_available_title");O.textContent="";I.textContent=g.translate("Create New Approximation");I.addEventListener("click",t.predictPage.getNewApproximations)}else{if(R==="NONE_SELECTED"){Q.textContent=g.translate("not_available_title");O.textContent=g.translate("Select one or more approximations")+".";I.textContent=g.translate("Remove me")+"!";I.addEventListener("click",t.predictPage.getNewApproximations)}else{if(t.predictPage.errorOptions[R]){Q.textContent=g.translate("ERR")+"!";N.classList.add("sim-ui-statusBarError");I.textContent=g.translate("Create New Approximation");I.removeEventListener("click",K);I.addEventListener("click",t.predictPage.getNewApproximations);t.predictPage.selectedApproxIds.forEach(function(S){if(o.approximations[S].errorDetails&&o.approximations[S].errorDetails.length>1){L.textContent=o.approximations[S].errorDetails}})}else{if(P()){Q.textContent=g.translate("Creating Approximation");N.classList.remove("sim-ui-statusBarError");I.textContent=g.translate("Cancel");I.removeEventListener("click",t.predictPage.getNewApproximations);I.addEventListener("click",K)}}O.textContent=t.predictPage.subTitleMap[R]}}}t.predictPage.getStatus(J)};t.predictPage.getNewApproximations=function(){var H,I;for(H=0;H<t.predictPage.selectedApproxIds.length;H++){I=t.predictPage.selectedApproxIds[H];o.setApproximationParameters(I)}for(var G in o.approximations){if(t.predictPage.selectedApproxIds.indexOf(G)===-1&&o.approximations[G].status==="OUT_OF_DATE"){o.approximations[G].status="NOT_AVAILABLE"}}t.predictPage.measuresInitialized=false};t.predictPage.updateStatusLabels=function(G){var H=document.getElementsByClassName("sim-ui-panel-content-predictStatus-text")[0];H.textContent=t.predictPage.subTitleMap[G];if(t.predictPage.errorOptions[G]){H.classList.add("prediction-status-error");H.classList.remove("prediction-status-ready");H.classList.remove("prediction-status-outdated")}else{if(G==="READY"){H.classList.add("prediction-status-ready");H.classList.remove("prediction-status-error");H.classList.remove("prediction-status-outdated")}else{H.classList.add("prediction-status-outdated");H.classList.remove("prediction-status-ready");H.classList.remove("prediction-status-error")}}};t.predictPage.updateStatusControl=function(H){function G(I){if((H&&H.isPredicted!==true)||!H){if(typeof t.predictPage.approxTable.updateStatus==="function"){t.predictPage.approxTable.updateStatus(o.approximations)}if(t.predictPage.currentView!=="#optimize-mgrid-view"){var J=document.getElementsByClassName("sim-ui-panel-content-predictStatus-fixed")[0];J.textContent=g.translate("Approximation Status")+": ";t.predictPage.updateStatusLabels(I)}}}t.predictPage.getStatus(G)};function w(H,I){var G=t.predictPage.selectedApproxIds;return o.evaluateApproximations(G,H,I)}t.predictPage.sendInteractiveUpdate=function(H,I){var G=o.getInteractiveParam(H);if(G){o.sendJson({action:"UpdateParams",SessionID:o.CATIASessionID,parameters:[{id:G.id,displayName:G.id,value:I,unit:G.unit}]})}};t.predictPage.onBinary=function(G){if(t.binaryResponse){t.binaryResponse(G);t.binaryResponse=null}return true};t.predictPage.hideParam=function(G){};t.predictPage.initializeProfiler=function(){console.log("initialize profiler called!");t.predictPage.pageState.profiler.initialized=true;t.predictPage.analyticsProfiler=new k();t.predictPage.analyticsProfiler.setRootDiv(document.getElementById("profilerview"));t.predictPage.analyticsProfiler.setInputChangedCallback(function(J,I){t.predictPage.currentValues[J]=I});t.predictPage.analyticsProfiler.setInputStdDevChangedCallback(function(J,I){t.predictPage.currentStdDevs[J]=I});t.predictPage.analyticsProfiler.setDataSource(w);t.predictPage.analyticsProfiler.setLocalEffectsSource(t.predictPage.getLocalEffects);t.predictPage.analyticsProfiler.setOutputVarianceSource(t.predictPage.getOutputVariance);t.predictPage.analyticsProfiler.setCurrentApproximation(t.predictPage.selectedApproxIds[0]);if(t.predictPage.pageState.profiler.measuresDisabled===true){t.predictPage.analyticsProfiler.disableMeasures()}t.predictPage.analyticsProfiler.setPredictionMeasures(t.predictPage.predictionMeasures);t.predictPage.analyticsProfiler.defineColors(t.predictPage.approxColors);var G=function(I){console.log(I);var J;t.predictPage.selectedApproxIds.forEach(function(K){if(typeof t.predictPage.removedParameters[K]==="undefined"){t.predictPage.removedParameters[K]={}}t.predictPage.removedParameters[K][I]=true})};var H=function(L,Q){console.log(L);var J;t.predictPage.selectedApproxIds.forEach(function(R){if(typeof t.predictPage.removedParameters[R]!=="undefined"){delete t.predictPage.removedParameters[R][L]}});if(L===Q){console.log("Source and target IDs are the same. Skipping insertion...");return false}var P;var N=function(T,S){for(var R=0;R<T.length;R++){if(S(T[R])){return R}}return -1};var I=L;var O,K;var M=function(R){if(R.ID===I){return true}return false};if((O=N(t.predictPage.orderedParameters.inputs,M))!==-1){P=t.predictPage.orderedParameters.inputs}else{if((O=N(t.predictPage.orderedParameters.outputs,M))!==-1){P=t.predictPage.orderedParameters.outputs}else{console.log("WARNING! Parameter not found in put/output lists. Reordering will not persist!");return false}}I=Q;if(typeof I==="undefined"||(K=N(P,M))===-1){console.log("WARNING! Target parameter not found in order list. Exit reordering.");return false}P.splice(K,0,P.splice(O,1)[0])};t.predictPage.analyticsProfiler.onRemoveInput(G);t.predictPage.analyticsProfiler.onRemoveOutput(G);t.predictPage.analyticsProfiler.onAddParameter(H);t.predictPage.getProfilerData().then(function(I){t.predictPage.analyticsProfiler.initializeProfiler(I.inputs,I.outputs,{event:d3.event,interactiveUpdate:function(J,K){t.predictPage.sendInteractiveUpdate(J,K)}})})};t.predictPage.getProfilerData=function(){var N,P;var Q=[];var O=[];var I=b.getFormulationMap();var H=function(R){R.formulation=I.values[R.ID];return R};var L=function(R){if(typeof t.predictPage.currentValues[R.ID]!=="undefined"){R.currentValue=t.predictPage.currentValues[R.ID]}return R};var G=function(R){if(typeof t.predictPage.currentStdDevs[R.ID]!=="undefined"){R.stddev=t.predictPage.currentStdDevs[R.ID]}return R};var M=function(R){if(typeof t.predictPage.zoomValues[R.ID]!=="undefined"){R.zoomMin=t.predictPage.zoomValues[R.ID][0];R.zoomMax=t.predictPage.zoomValues[R.ID][1]}return R};var K=function(S,R){Q[R]=S.inputs;O[R]=S.outputs};var J=new Promise(function(T,S){var R=[];var U=t.predictPage.removedParameters[t.predictPage.selectedApproxIds[0]]||{};t.predictPage.selectedApproxIds.forEach(function(aa,Y){var V=function(ab){K(ab,Y)};var Z=o.getApproximationParameters(aa,V);R.push(Z);if(Y>0){var X=t.predictPage.removedParameters[aa]||[];for(var W in U){if(!X[W]){delete U[W]}}}});d.when.apply(d,R).done(function(){var ab=[];var W=[];function Z(ac,ae){var ad=false;ad=ac.some(function(af){if(af.ID===ae.ID){return true}});return ad}for(var Y=0;Y<Q.length;Y++){if(!Q[Y]){continue}for(var X=0;X<Q[Y].length;X++){if(!Z(ab,Q[Y][X])){ab.push(Q[Y][X])}}for(var X=0;X<O[Y].length;X++){if(!Z(W,O[Y][X])){W.push(O[Y][X])}}}ab=ab.filter(function(ac){return U[ac.ID]===true?false:true});W=W.filter(function(ac){return U[ac.ID]===true?false:true});N=ab.map(function(ac){return M(G(L(H(ac))))});P=W.map(function(ac){return H(ac)});var V={};var aa={};t.predictPage.orderedParameters.inputs.forEach(function(ac,ad){V[ac.ID]=ad});t.predictPage.orderedParameters.outputs.forEach(function(ac,ad){aa[ac.ID]=ad});N.sort(function(ad,ac){return V[ad.ID]-V[ac.ID]});P.sort(function(ad,ac){return aa[ad.ID]-aa[ac.ID]});T({inputs:N,outputs:P})})});return J};t.predictPage.valuesChanged=function(H){var G=H.values;t.predictPage.updateInputValues(G)};t.predictPage.updateInputValues=function(H){var G=false;for(var I in H){if(t.predictPage.isValidInputValue(I,H[I])){t.predictPage.currentValues[I]=H[I]}else{if(C){G=true}}}if(G){f.alertMessage(f.WARN,"Synced parameter value(s) are out of range. Switching to last known value.")}if(t.predictPage.pageState.profiler.initialized!==false){t.predictPage.getProfilerData().then(function(J){t.predictPage.analyticsProfiler.updateProfiler(J.inputs,J.outputs)})}};t.predictPage.isValidInputValue=function(I,K){var L=false;var H=t.predictPage.analyticsProfiler;if(H&&H.data&&H.data.inputs&&H.data.inputs[I]){var J=H.data.inputs[I].min,G=H.data.inputs[I].max;if(typeof J!=="undefined"&&K>J&&typeof G!=="undefined"&&G>K){L=true}}return L};t.predictPage.updateProfiler=function(){console.log("Called update profiler!");t.predictPage.getApproximationErrorMeasures(function(){if(t.predictPage.pageState.profiler.initialized===false){t.predictPage.initializeProfiler()}else{t.predictPage.getProfilerData().then(function(G){t.predictPage.analyticsProfiler.updateProfiler(G.inputs,G.outputs)})}})};t.predictPage.initializeMeasures=function(G){var H=t.predictPage.selectedApproxIds;t.predictPage.measuresInitialized=true;t.predictPage.predictionMeasures=new s();t.predictPage.measuresDeferred=o.getApproximationErrorMeasures(H);t.predictPage.measuresRendered=false;return t.predictPage.measuresDeferred};t.predictPage.getApproximationErrorMeasures=function(H){if(typeof H!=="function"){H=function(){}}if(t.predictPage.measuresDeferred.state()!=="pending"){t.predictPage.measuresDeferred=new d.Deferred()}var G=Object.keys(o.approximations);o.getApproximationErrorMeasures(G).done(function(){t.predictPage.measuresDeferred.resolve();H();return true}).fail(function(){t.predictPage.measuresDeferred.resolve();H()})};t.predictPage.updateMeasures=function(G){if(!t.predictPage.measuresInitialized){t.predictPage.initializeMeasures()}var H=t.predictPage.measuresDeferred;if(!t.predictPage.measuresRendered){if(H.state()==="resolved"){t.predictPage.predictionMeasures.setCurrentApproximation(t.predictPage.selectedApproxIds[0]);t.predictPage.predictionMeasures.refresh(t.predictPage)}else{d.when(H).done(function(){t.predictPage.predictionMeasures.setCurrentApproximation(t.predictPage.selectedApproxIds[0]);t.predictPage.predictionMeasures.refresh(t.predictPage);return true})}}t.predictPage.measuresRendered=true};t.predictPage.viewChanged=function(G){t.predictPage.updateView()};t.predictPage.updateView=function(H,G){var I=G||{};var N=(I.buildProfiler===false)?false:true;var L=function(O){if(typeof optimizationHandler!=="undefined"&&optimizationHandler!=null){clearTimeout(optimizationHandler)}if(d("#profilerview").is(":visible")&&N){t.predictPage.currentView="#profilerview";t.predictPage.lastView="#profilerview";if(!t.predictPage.analyticsProfiler){t.predictPage.initializeProfiler(t.predictPage.getInputs(),t.predictPage.getOutputs(),{})}else{if(I.updateProfiler==="measuresOnly"){t.predictPage.analyticsProfiler.updateProfilerMeasures()}else{t.predictPage.updateProfiler()}}}else{if(d("#measureview").is(":visible")){if(O==="VALIDATION"){d("#measureview").hide();d("#statusview").show()}else{t.predictPage.lastView="#measureview";d("#statusview").hide();d("#measureview").show();t.predictPage.currentView="#measureview";t.predictPage.measuresRendered=false;t.predictPage.updateMeasures()}}else{if(d("#optimize-mgrid-view").is(":visible")){t.predictPage.analyticsOptView.viewEnterHandler(t.predictPage.selectedApproxIds[0])["catch"](function(P){console.log("Fail on enter of optimize view.")})}}}};var M=d("#addPredDesignButton");d(".sim-ui-panel-content-toolbarbutton.opt-settings").hide();var K=document.getElementsByClassName("sim-ui-panel-content-predictStatus-fixed")[0];if(!d("#optimize-mgrid-view").is(":visible")){K.textContent=g.translate("Approximation Status")+": ";M.show()}else{K.textContent=g.translate("OPT_STATUS_LABEL")+": ";M.hide()}var J=function(O){if(O==="READY"||O==="OUT_OF_DATE"||O==="VALIDATION"){if(t.predictPage.parametersDeferred.state()==="resolved"){L(O)}else{d.when(t.predictPage.parametersDeferred).done(function(){L(O)})}}else{t.predictPage.statusChanged()}};if(!H){t.predictPage.getStatus(function(O){J(O)})}else{J(H)}};t.predictPage.getOutputs=function(){var I,L;for(I=0;I<t.predictPage.selectedApproxIds.length;I++){L=t.predictPage.selectedApproxIds[I]}var I,H,L,J,G=[],K=[];for(I=0;I<t.predictPage.selectedApproxIds.length;I++){J=o.approximations[t.predictPage.selectedApproxIds[I]].outputs||[];for(H=0;H<J.length;H++){if(G.indexOf(J[H].ID)===-1){K.push(J[H]);G.push(J[H].ID)}}}return K};t.predictPage.getInputs=function(){var J,K;for(J=0;J<t.predictPage.selectedApproxIds.length;J++){K=t.predictPage.selectedApproxIds[J]}var J,I,K,L,G=[],H=[];for(J=0;J<t.predictPage.selectedApproxIds.length;J++){L=o.approximations[t.predictPage.selectedApproxIds[J]].inputs||[];for(I=0;I<L.length;I++){if(G.indexOf(L[I].ID)===-1){H.push(L[I]);G.push(L[I].ID)}}}return H};t.predictPage.formulationChanged=function(H){H=H||{};t.predictPage.updateAllSliders();var G=b.getFormulationMap();var I=function(K){K.formulation=G.values[K.ID];return K};if(t.predictPage.pageState.profiler.initialized){var J=t.predictPage.getOutputs().map(function(K){return I(K)});t.predictPage.updateProfiler()}t.predictPage.optPropagateFormulationChange()};t.predictPage.optPropagateFormulationChange=function(){if(t.predictPage.analyticsOptView&&typeof t.predictPage.analyticsOptView.formulationChange==="function"){t.predictPage.analyticsOptView.formulationChange()}};t.predictPage.zoomSlide=function(G,H){t.predictPage.zoomValues[G]=H;if(t.predictPage.currentView==="#profilerview"){t.predictPage.analyticsProfiler.zoomInput(G,H[0],H[1])}};t.predictPage.zoomStop=function(G,H){t.predictPage.zoomValues[G]=H;if(t.predictPage.currentView==="#profilerview"){t.predictPage.analyticsProfiler.zoomInputEnd(G,H[0],H[1])}};t.predictPage.startDrag=function(G){if(o.getSwitch("RA_INTERACTIVE_DESIGN")){return false}if(t.predictPage.currentView==="#profilerview"){if(t.predictPage.analyticsProfiler){t.predictPage.analyticsProfiler.startDrag(G)}if(G.source==="sidebar-input"){t.predictPage.parameterControlLists.outputs.startDrag(G);t.predictPage.parameterControlLists.other.startDrag(G)}else{if(G.source==="sidebar-output"){t.predictPage.parameterControlLists.inputs.startDrag(G);t.predictPage.parameterControlLists.other.startDrag(G)}else{if(G.source==="sidebar-other"){t.predictPage.parameterControlLists.outputs.startDrag(G);t.predictPage.parameterControlLists.inputs.startDrag(G)}}}}};t.predictPage.endDrag=function(G){if(t.predictPage.currentView==="#profilerview"){if(typeof t.predictPage.analyticsProfiler!=="undefined"){t.predictPage.analyticsProfiler.endDrag(G)}if(G.source==="sidebar-input"){t.predictPage.parameterControlLists.outputs.endDrag(G);t.predictPage.parameterControlLists.other.endDrag(G)}else{if(G.source==="sidebar-output"){t.predictPage.parameterControlLists.inputs.endDrag(G);t.predictPage.parameterControlLists.other.endDrag(G)}else{if(G.source==="sidebar-other"){t.predictPage.parameterControlLists.outputs.endDrag(G);t.predictPage.parameterControlLists.inputs.endDrag(G)}}}}};t.predictPage.eventListHandler=function(N,G,O){var L=[],I=[],P,H;var J=[];var K,M;for(K=0;K<O.length;K++){M=O[K];if(M.iaEventType==="formulationChanged"){I.push(M.iaEventSource)}else{if(M.iaEventType==="parameterChanged"){L.push(M.iaEventSource)}else{if(M.iaEventType==="basketChanged"){P=M}else{if(M.iaEventType==="valuesChanged"){H=M}else{J.push(M)}}}}}if(L.length>0){J.push({iaEventType:"parametersChanged",iaEventSources:L})}if(I.length>0){J.push({iaEventType:"formulationChanged",iaEventSources:I})}if(typeof P!=="undefined"){J.push(P)}if(typeof H!=="undefined"){J.push(H)}return J};t.predictPage.createExportPopup=function(K){if(typeof K==="undefined"||K===null||K.length===0){K=t.predictPage.selectedApproxIds[0]}var J={};var H=document.createElement("div");H.classList.add("sim-ui-predict-export-popover");var M=function(V,U){var W=document.createElement("div");W.classList.add("sim-ui-predict-object");var R="../../common/emxNavigator.jsp?objectId="+V;d("<img>",{src:"../../common/images/smaAdviseIconApproximation.gif"}).appendTo(W);d("<div>"+U+"</div>").appendTo(W);W.addEventListener("click",function(){window.open(R)});W.style.cursor="pointer";var T=function(){var X=d('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+g.translate("OK")+"</button>").on("click",function(){q.closePopover()});return X};var S={width:350,height:125,noTabs:true,footerOptions:{type:"buttons",content:[T]},customCloseBehavior:q.closePopover};q.makePopover([],[d(W)],g.translate("New Approximation Object Created"),"sim-ui-predict-created-popover",S)};var Q=function(){var Y=document.createElement("div");Y.classList.add("sim-ui-predict-object");var U=d("<div></div>",{id:"objectTitleDiv","class":"sim-ui-predict-object-option"}).appendTo(Y);d("<label />",{"for":"text_title",text:g.translate("Title")+" : "}).appendTo(U);var R=d("<input />",{type:"text",id:"text_title",value:g.translate("My Approximation")}).appendTo(U);var W=d("<div></div>",{id:"objectDescDiv","class":"sim-ui-predict-object-option"}).appendTo(Y);d("<label  />",{"for":"text_desc",text:g.translate("Description")+" : "}).appendTo(W);var T=d("<textarea />").appendTo(W);var V=function(){var Z=d('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+g.translate("OK")+"</button>").on("click",function(){var ab=d("#objectTitleDiv").children("input").val();var aa=d("#objectDescDiv").children("input").val();q.closePopover();o.createExportedApproximation(ab,aa,K,M)});return Z};var X=function(){var Z=d('<button class="sim-ui-popover-footerButton" style="min-width:75px;">'+g.translate("Cancel")+"</button>").on("click",q.closePopover);return Z};var S={width:500,height:175,noTabs:true,footerOptions:{type:"buttons",content:[V,X]},customCloseBehavior:q.closePopover};q.makePopover([],[d(Y)],g.translate("Create Approximation Object"),"sim-ui-predict-object-popover",S)};J.object={text:"Create Approximation Object",click:Q,selected:false};if(o.approximations[K].displayName!=="Best"&&o.getApproximationType(K)!=="kriging"){J.fmu={text:g.translate("Download FMU"),click:function(){t.predictPage.downloadApproximationFmu(K)},selected:false}}if(o.approximations[K].displayName!=="Best"){J.coeff={text:g.translate("Download Coefficients File"),click:t.predictPage.downloadApproximationCoefficients,selected:true}}var G,N;for(var L in J){G=d("<div></div>",{id:"#_"+L,"class":"sim-ui-predict-export-option"}).appendTo(H);N=d("<input />",{type:"radio",id:"radio_"+L,value:L,name:"exportRadioGroup"}).appendTo(G);N.prop("checked",J[L].selected);d("<label />",{"for":"radio_"+L,text:J[L].text}).appendTo(G)}var P=function(){var R=d('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+g.translate("OK")+"</button>").on("click",function(){q.closePopover();d(H).children(".sim-ui-predict-export-option").children("input").each(function(){if(this.checked){J[this.value].click()}})});return R};var I=function(){var R=d('<button class="sim-ui-popover-footerButton" style="min-width:75px;">'+g.translate("Cancel")+"</button>").on("click",q.closePopover);return R};var O={width:300,height:125+Object.keys(J).length*25,noTabs:true,footerOptions:{type:"buttons",content:[P,I]},customCloseBehavior:q.closePopover};q.makePopover([],[d(H)],g.translate("Export Approximations"),"sim-ui-predict-export-popover",O)};t.predictPage.downloadApproximationFmu=function(){o.downloadApproximationFmu(t.predictPage.selectedApproxIds[0])};t.predictPage.downloadApproximationCoefficients=function(){o.downloadApproximationCoefficients(t.predictPage.selectedApproxIds[0])};t.predictPage.downloadApproximationCoefficients=function(){o.downloadApproximationCoefficients(t.predictPage.selectedApproxIds[0])};t.predictPage.addPredictedDesign=function(J){if(t.predictPage.selectedApproxIds.length>1){return}var K=t.predictPage.analyticsProfiler.data.approximations[t.predictPage.selectedApproxIds[0]].outputs;var H={};for(var I in t.predictPage.analyticsProfiler.data.inputs){H[I]=t.predictPage.analyticsProfiler.data.inputs[I].value}for(I in K){H[I]=K[I].value}var L={};function G(){var N=document.createElement("div");N.textContent="Add newly created alternative to basket?";var M=new h({title:g.translate("BASKET_CONFIRM_TITLE"),content:N,immersiveFrame:o.getImmersiveFrame(),buttons:{Yes:new j({onClick:function(Q){o.addToBasket(L.content);var O=Q.dsModel;var P=O.dialog;P.close()}}),No:new j({onClick:function(Q){var O=Q.dsModel;var P=O.dialog;P.close()}})}})}o.addDesignRow(J,H,L).done(function(){if(o.isEKActive()){o.spinnerControlShow(true);o.sendJson({action:"GetImage",SessionID:o.CATIASessionID});t.binaryResponse=function(O){console.log("uploading thumbnail to servant...");try{var M=new File([O],"InteractiveImage.png",{type:"image/png"});r.prototype.submitUploadForm("","__"+g.translate("Thumbnail"),L.content,M)}catch(N){console.log(N)}G();o.spinnerControlHide(true)}}else{G()}})};t.predictPage.getLocalEffects=function(G){var H;t.predictPage.selectedApproxIds.forEach(function(K){var J=o.approximations[K];var I=J.inputs;I.forEach(function(M){var L=M.ID;var N;if(typeof G[L]==="undefined"){if(typeof t.predictPage.currentValues[L]!=="undefined"){N=t.predictPage.currentValues[L]}else{if(typeof M.value!=="undefined"){N=M.value}else{N=(M.min+M.max)/2}}G[L]={ID:L,value:N}}})});return o.getLocalEffects(t.predictPage.selectedApproxIds,G)};t.predictPage.getOutputVariance=function(G){var H=t.predictPage.selectedApproxIds[0];return o.getOutputVariance(H,G)};t.predictPage.dataSetChanged=function(G){t.predictPage.updateSkippedSliders();t.predictPage.updateStatusControl()};t.predictPage.save=function(){var G={errorOptions:t.predictPage.errorOptions,methodsAlias:t.predictPage.methodsAlias,subTitleMap:t.predictPage.subTitleMap,currentView:t.predictPage.currentView,currentValues:t.predictPage.currentValues,currentStdDevs:t.predictPage.currentStdDevs,previousApproximation:t.predictPage.previousApproximation,selectedApproxIds:t.predictPage.selectedApproxIds,approximationIds:t.predictPage.approximationIds,approxColors:t.predictPage.approxColors,sliderUpdates:t.predictPage.sliderUpdates,analyticsProfiler:{selectedApproximationsMap:t.predictPage.analyticsProfiler.selectedApproximationsMap,ctrlClickEnabled:t.predictPage.analyticsProfiler.ctrlClickEnabled,approxColors:t.predictPage.analyticsProfiler.approxColors,state:t.predictPage.analyticsProfiler.state,constants:t.predictPage.analyticsProfiler.constants,data:t.predictPage.analyticsProfiler.data}};try{o.savePageData("predictPage",o.serializePageObject(G))}catch(H){console.warn("Error trying to persist predict page session info",[H])}};t.predictPage.parametersChangedEventHandler=function(G){t.predictPage.updateStatusControl(G);t.predictPage.optPropagateFormulationChange()};d("#predictpage").advisePage({controlPanelId:"predictcontrolpanel",contentPanelId:"predictcontentpanel",entering:t.predictPage.enter,viewchange:t.predictPage.viewChanged,formulationChanged:t.predictPage.formulationChanged,formulationsChanged:t.predictPage.formulationChanged,parameterChanged:t.predictPage.parametersChangedEventHandler,parametersChanged:t.predictPage.parametersChangedEventHandler,hierarchyChanged:t.predictPage.optPropagateFormulationChange,resize:t.predictPage.resize,save:t.predictPage.save,eventListHandler:t.predictPage.eventListHandler,postRender:t.predictPage.postRender,dataSetChanged:t.predictPage.dataSetChanged,approximationStatusChanged:t.predictPage.statusChanged,valuesChanged:t.predictPage.valuesChanged})}return c});define("DS/SMAAnalyticsUI/SMAAnalyticsShopPage",["text!DS/SMAAnalyticsUI/assets/ResultsAnalyticsConstants.json","DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsUICommon","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsCategoricalScoreFilter","DS/SMAAnalyticsUI/SMAAnalyticsComponentScatterGrid","DS/SMAAnalyticsUI/SMAAnalyticsScatterSupportFns","DS/SMAAnalyticsUI/SMAAnalyticsPopover","DS/SMAAnalyticsDataTable/SMAAnalyticsServantDataHandler","DS/SMAAnalyticsDataTable/SMAAnalyticsDataTable2","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsDTContextMenu","DS/SMAAnalyticsUI/SMAAnalyticsMarkers","DS/SMAAnalyticsUI/SMAAnalyticsDataTableSupportFns","DS/SMAAnalyticsUI/SMAAnalyticsCssEditor","DS/SMAAnalyticsUI/SMAAnalyticsMapView","DS/SMAAnalyticsUI/SMAAnalyticsTimer","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper","DS/SMAAnalyticsUI/SMAAnalyticsHistoryView","DS/Usage/TrackerAPI","DS/SMAAnalyticsUI/SMAAnalyticsPageWidget","DS/SMAAnalyticsUI/SMAAnalyticsParamSlider",],function(l,e,g,v,d,k,o,x,c,i,a,q,y,u,j,t,r,h,s,p,w){var b=window.localStorage.getItem("RA_EXPERIMENTAL");b=b===undefined?false:b==="1";var z=i;function f(B){require(["DS/SMAAnalyticsUtils/SMAAnalyticsFormulaUtils"],function(E){var D="ra-exp-textarea";var C=D+"_Instance";E.manageFormula(B,z,C,document.body)})}l=JSON.parse(l);k();var n=new o();u.setProxy(v);function A(){this.renderFunctions={};this.isRendering={}}A.prototype.addTracker=function(B,C){this.renderFunctions[C]=B;this.isRendering[C]=false};A.prototype.render=function(E,B){var C=this;if(this.isRendering[E]===false){this.isRendering[E]=true;var D=this.renderFunctions[E].apply(this,B);e.when(D.deferred).always(function(){C.resolveRender(E)});if(typeof D.args!=="undefined"){return D.args}else{}}else{console.log("Function "+E+" is already rendering. Execution blocked by renderTracker.")}};A.prototype.resolveRender=function(B){if(typeof this.isRendering[B]!=="undefined"){this.isRendering[B]=false}};function m(C,M){var E=106,G=95,J=73,N=0,Q=37,P=38,D=57,F=65,I=175,K=0,O=0;C.shopPage=C.shopPage||{create:m};C.shopPage.thumbnailView={chunkSize:8,scrollPos:0};C.shopPage.timers={dataTable:new r("UPDATE DATA TABLE")};C.shopPage.scatterGridMVP={contour:true,scatter:true,prevWidth:-100,prevHeight:-100,mouseDown:false,mouseMoved:false,numClicks:0,singleChartDisplayed:false,singleChart:{c:0,r:0,glyphSize:6}};C.shopPage.pageLoaded=false;C.shopPage.refreshEvents={};C.shopPage.renderTracker=new A();C.shopPage.dataHandlerState="inactive";C.shopPage.dataHandlerDeferred=new e.Deferred();C.shopPage.dataTableState="inactive";C.shopPage.dataTableContext=new q(e);C.shopPage.dataTableInterface=u.createTableAdviseInterface(C.shopPage.dataTableContext,v.dataTableProxy,C.shopPage.refreshShopTable,C.shopPage.timers.dataTable.restartTimer);C.shopPage.cssEditor=new j();for(var H=0;H<document.styleSheets.length;H++){if(typeof document.styleSheets[H].href==="string"&&document.styleSheets[H].href.indexOf("DataTable")>-1){C.shopPage.cssEditor.setStyleSheet(document.styleSheets[H]);break}}C.shopPage.editableColumns=[];var B={};v.getPageOptions("shopPage",B).done(function(){var R=B.content;if(!e.isEmptyObject(R)){C.shopPage.editableColumns=R.editableColumns}});C.shopPage.searchParameterString="";C.shopPage.editMode=false;C.shopPage.historyView=new p(document.getElementById("historyView"));e("#"+M).find(".ui-icon-pencil").click(function(R){R.stopImmediatePropagation();R.preventDefault();x.makeEditPopover()});e("#exploreDownload").click(function(){v.downloadExploreData()});C.shopPage.createFilterEditPopover=function(ad,al){console.log(ad);var Z=v.findParameter(ad);var W=document.createElement("div");W.classList.add("sim-ui-explore-filter-popover");W.classList.add("sim-ui-share-popover");var ak=document.createElement("table");var aj=document.createElement("tr");var U=document.createElement("td");U.textContent=h.translate("Range");var R=document.createElement("td");R.textContent="["+Z.min+", "+Z.max+"]";aj.appendChild(U);aj.appendChild(R);var ai=document.createElement("tr");var ag=document.createElement("td");ag.textContent=h.translate("FILTER_LT");var ae=document.createElement("td");var ac=document.createElement("input");ae.appendChild(ac);ai.appendChild(ag);ai.appendChild(ae);var ah=document.createElement("tr");var Y=document.createElement("td");Y.textContent=h.translate("FILTER_GT");var X=document.createElement("td");var V=document.createElement("input");X.appendChild(V);ah.appendChild(Y);ah.appendChild(X);var T=v.getParametricFilterBounds(ad);ac.value=T[0]===null?"":T[0];V.value=T[1]===null?"":T[1];ak.appendChild(aj);ak.appendChild(ai);ak.appendChild(ah);W.appendChild(ak);var af=af||{iaEventSource:"filter",iaEventType:"filterChanged"};var aa=function(){var am=e('<button class="sim-ui-popover-footerButton" style="min-width:75px;margin:4px;">'+h.translate("OK")+"</button>").on("click",function(){var ap=ac.value;var ao=V.value;console.log(ap);console.log(ao);var an=null;var ar=null;try{an=parseFloat(ap)}catch(aq){if(ap.trim()===""&&T[2]!==null){ap=Z.min}}try{ar=parseFloat(ao)}catch(aq){if(ao.trim()===""&&T[1]!==null){ao=Z.max}}if(an&&an>=Z.min){if(v.caseInfo.userList[v.caseInfo.CurrentUser.userID].isInControl){v.setFilterOnProxy(ad,"LESS_THAN",an,af)}}if(ar&&ar<=Z.max){if(v.caseInfo.userList[v.caseInfo.CurrentUser.userID].isInControl){v.setFilterOnProxy(ad,"GREATER_THAN",ar,af)}}v.setFiltersAndSync();x.closePopover()});return am};var ab=function(){var am=e('<button class="sim-ui-popover-footerButton" style="min-width:75px;">'+h.translate("Cancel")+"</button>").on("click",x.closePopover);return am};var S={width:300,height:250,footerOptions:{type:"buttons",content:[aa,ab]},customCloseBehavior:x.closePopover};x.makePopover([h.translate("FILTER")],[e(W)],h.translate("EDIT")+" "+Z.displayName,"sim-ui-explore-filter-popover",S)};C.shopPage.rebuildParameterSliders=function(R,W,U){if(!U){U=0}var S=[];if(C.shopPage.dataHandler){S=C.shopPage.dataHandler.data.columnKeys}if(S.length===0){return}S=S.filter(function(Y){var X=v.findParameter(Y);if(X===null||X.structure!=="SCALAR"){return 0}return 1});if(R instanceof e){R=R[0]}d3.select(R).selectAll(".sim-param-control").remove();var T=d3.select(R).selectAll(".sim-param-control").data(S,function(X){return X});U=S.length;T.enter().append("div").each(function(Z,X){var Y=e(this).attr({id:"_"+Z,"class":"sim-param-control"+(X%2===1?" sim-param-control-odd":"")})});T.each(function(ad,Z){var aa=Z;var ac=v.findParameter(ad);var ab=e(this).empty().attr({"class":"sim-param-control"+(aa%2===1?" sim-param-control-odd":"")}).append(e("<div/>",{id:"_"+ac.ID+"title","class":"sim-param-title"}).text(ac.displayName));if(ac.dataType==="REAL"||ac.dataType==="INTEGER"||ac.dataType==="STRING"){var Y=e("<div/>",{id:"_"+ac.ID+"_edit","class":"sim-param-slider-edit ui-icon ui-icon-pencil"});ab.append(Y);ab.append(e("<div/>",{id:"_"+ac.ID+"minimize","class":"sim-ui-control-min"})).append(e("<div/>",{id:"_"+ac.ID+"maximize","class":"sim-ui-control-max"}));var X=e("<div/>",{"class":"sim-param-slider-control"});ab.data("divID",ac.ID);ab.append(X);window.setTimeout(function(){X.empty();ab.children("svg").remove();X.adviseParamslider({paramID:ac.ID,titleDivID:"_"+ac.ID+"title",minimize:"_"+ac.ID+"minimize",maximize:"_"+ac.ID+"maximize"});window.setTimeout(function(){try{X.slider("value",X.slider("values"))}catch(ae){console.warn(ae)}},100)},0);Y.click(function(ae){v.doTransaction(function(){C.shopPage.createFilterEditPopover(ac.ID,X)})});if(ac.dataType==="STRING"){Y.hide()}}});var V=C.shopPage.searchParameterString;e(".sim-param-title").each(function(){var X=e(this).text().toLowerCase();var Y=X.indexOf(V.toLowerCase());if(Y<0&&V!=="*"&&V!==""){e(this).parent().hide()}else{e(this).parent().show()}});e(R).scroll(function(){var aa=R.scrollTop;var Z=R.scrollHeight;var X=1+parseInt(R.clientHeight/100);var ab=parseInt(U*aa/Z);if(ab<0){ab=0}var Y=ab+X;if(Y>U){Y=U}e(R).find(".sim-param-slider-control:gt("+ab+"):lt("+Y+")").each(function(ac,ad){e(ad).adviseParamslider("scroll")})});return U};C.shopPage.rebuildSliderPanel=function(){var R=e("#parametercontrol>.sim-ui-panel-controlgroup-contentpanel");var S=v.findGroup();C.shopPage.rebuildParameterSliders(R,S)};C.shopPage.buildParamSliderPanel=function(){var R=e("#parametercontrol>.sim-ui-panel-controlgroup-contentpanel");var T=v.findGroup();O=C.shopPage.rebuildParameterSliders(R,T);e("#parametercontrol .sim-ui-panel-controlgroup-toolbarbutton").tooltip();var S=e(window).height()-K;if(S<2*E){S=2*E}if(O*E>S){e(R).css("height",S)}else{e(R).css("height",O*E)}e("#parametercontrol").find(".sim-ui-panel-controlgroup-search-input").on("keyup",function(U){var V=a.searchInputFormatter(e(this),U);e(R).find(".sim-param-title").each(function(){var X=e(this).text().toLowerCase();var Y=X.indexOf(V.toLowerCase());if(Y<0&&V!=="*"&&V!==""){e(this).parent().hide()}else{var W=e(this).parent();W.show();W.find(".sim-param-slider-control").adviseParamslider("scroll")}});C.shopPage.searchParameterString=V})};C.shopPage.initializeFilters=function(S){var R=[];C.shopPage.updateDataSourceFilters();e("#overallScoreViewButton").click(C.shopPage.toggleOverallScoreView);d(C);C.shopPage.overallScoreView="categorical";if(C.shopPage.overallScoreView==="categorical"){if(v.caseInfo.userList[v.caseInfo.CurrentUser.userID].isInControl){R.push(C.shopPage.resetScoreFilter({iaEventUISource:"initializeFilters"}))}C.shopPage.buildOverallScoreCategorical(S);R.push(C.shopPage.filterCategorical({iaEventUISource:"initializeFilters"}));document.querySelector("#overallScoreViewButton").setAttribute("title",h.translate("HST_VIEW_SWITCH"));document.querySelector("#overallScoreViewButton").classList.add("sim-ui-param-control-histogram-icon");C.shopPage.pageLoaded=true}else{if(C.shopPage.overallScoreView==="histogram"){C.shopPage.buildOverallScoreHistogram();document.querySelector("#overallScoreViewButton").setAttribute("title",h.translate("CTGRCL_VIEW_SWITCH"));document.querySelector("#overallScoreViewButton").classList.add("sim-ui-param-control-categorical-icon")}}return e.when.apply(null,R)};var L;C.shopPage.openScrapeUI=function(){var S=document.querySelector("#somDiv");if(S!==null){C.shopPage.svgScraper.prepContainer(S,"som",{svgtype:"som",collectAll:true})}var R=document.querySelector("#pcPlotDiv");if(R!==null){C.shopPage.svgScraper.prepContainer(R,"pcplot",{svgtype:"pcplot"})}var T=document.querySelectorAll("ra-scattergrid");[].forEach.call(T,function(U){C.shopPage.svgScraper.prepContainer(U,"scatterplot",{svgtype:"scatterplot",combine:true,combineInstructions:{columns:4,order:[3,6,9,12,4,7,10,13,5,8,11,14,-1,0,1,2]}})},this);C.shopPage.svgScraper.openScrapeUI()};C.shopPage.enteringShopPage=function(T){var R=w.getCounter("RAExplorePageEntered");R.inc();C.shopPage.endEditMode({noRefresh:true});C.shopPage.timers.enter=new r("ENTERING SHOP PAGE");C.shopPage.timers.enter.startTimer();if(typeof C.shopPage.svgScraper==="undefined"){C.shopPage.svgScraper=new s(C.shopPage.element)}L=document.querySelector("#scatterPlotMatrix");if(L!==null){C.shopPage.svgScraper.prepContainer(L,"scatterplot",{svgtype:"scatterplot"})}var S=C.shopPage.element[0].querySelector('[data-icon="copyto"]');if(S!==null){S.onclick=C.shopPage.openScrapeUI}if(C.shopPage.pageLoaded===false){d3.select("#tableView").call(C.shopPage.makeEmptyTableContextMenu);C.shopPage.mapViewHandler=new t(C);C.shopPage.mapViewHandler.hasData=false;C.shopPage.initializeFilters().done(function(){C.shopPage.timers.enter.getAndResetInterval(h.translate("Filters initialized")+": ");var U;if(C.shopPage.dataHandlerState==="inactive"){C.shopPage.createDataHandler();U=C.shopPage.initializeDataHandler()}else{if(C.shopPage.dataHandlerState==="created"){U=C.shopPage.initializeDataHandler()}else{if(C.shopPage.dataHandlerState==="updating"){}else{}}}U.done(function(){C.shopPage.timers.enter.getAndResetInterval(h.translate("Data table initialized")+": ")});C.shopPage.dataHandlerDeferred.done(function(){C.shopPage.buildParamSliderPanel();C.shopPage.timers.enter.getAndResetInterval(h.translate("Param sliders built")+": ");C.shopPage.timers.enter.getTotalTime(h.translate("Total entering time")+": ")})});K=G+J+N+F+I}};C.shopPage.makeEmptyTableContextMenu=function(){this.each(function(V){var U={},S={},T={};U.label=function(){var W=h.translate("add_formula_column");return W};U.iconType="jquery";U.icon=function(){return"ui-icon-plusthick"};U.action=function(){f(C)};S.label=function(){return h.translate("add_new_columns")};S.iconType="jquery";S.icon=function(){return"ui-icon-plusthick"};S.action=function(){var W=window.prompt(h.translate("num_columns_prompt"),1);if(W!==null){v.createDataColumns({},parseInt(W)).done(function(){})}};T.label=function(){return h.translate("add_new_rows")};T.iconType="jquery";T.icon=function(){return"ui-icon-plusthick"};T.action=function(){if(v.getAllParametersAsFlatList().length===0){g.alertMessage(g.ERROR,h.translate("no_columns_error"));return}var X=window.prompt(h.translate("num_rows_prompt"),1);if(X!==null){var W={};v.createDataRows(W,parseInt(X)).done(function(){var Y=W.content,Z;Z=Y.map(function(aa){return{ID:String(aa),editable:"true",fixedData:{basketColumn:"",run_number:String(aa),auto_rank:"0",total_score:"0.0"}}});C.shopPage.dataTable.eventController("addRowsFromInterface",Z)})}};var R={title:h.translate("table_options"),items:[]};if(b){R.items.push({label:U.label,icon:U.icon,action:U.action,iconType:U.iconType})}R.items.push({label:S.label,icon:S.icon,action:S.action,iconType:S.iconType},{label:T.label,icon:T.icon,action:T.action,iconType:T.iconType});e(this).contextPopup(R)})};C.shopPage.setDataSourcePanelHeight=function(){var R=typeof v.filters!=="undefined"&&typeof v.filters.dataSetFilters!=="undefined"?v.filters.dataSetFilters:[];C.shopPage.dataSourceFilter.style.display="block";if(R.length===2){N=Q+P;e("#sim-ui-dataSourceFilter>.sim-ui-panel-controlgroup-contentpanel").css("height",P)}else{N=Q+D;e("#sim-ui-dataSourceFilter>.sim-ui-panel-controlgroup-contentpanel").css("height",D)}};C.shopPage.updateDataSourceFilters=function(){var S=typeof v.filters!=="undefined"&&typeof v.filters.dataSetFilters!=="undefined"?v.filters.dataSetFilters:[];if(typeof C.shopPage.dataSourceFilters==="undefined"){C.shopPage.dataSourceFilter=document.querySelector("#sim-ui-dataSourceFilter");C.shopPage.dataSourceFilters={}}if(S.length<2){C.shopPage.dataSourceFilter.style.display="none";return}var U=C.shopPage.dataSourceFilter.querySelector("table");U.style.width="100%";var R={};for(var W=0;W<S.length;W++){R[S[W].alias]=S[W]}var V;for(V in R){if(C.shopPage.dataSourceFilters.hasOwnProperty(V)){C.shopPage.updateDataSourceFilterOption(C.shopPage.dataSourceFilters[V],R[V])}else{U=C.shopPage.dataSourceFilter.querySelector("table");U.style.width="100%";var X=U.children.length;var Y=C.shopPage.buildDataSourceFilterOption(S[X],X);U.appendChild(Y)}}for(V in C.shopPage.dataSourceFilters){if(typeof R[V]==="undefined"){var T=C.shopPage.dataSourceFilters[V];T.parentNode.removeChild(T);delete C.shopPage.dataSourceFilters[V]}}C.shopPage.setDataSourcePanelHeight()};C.shopPage.filterDataSource=function(){var R=this.checked===""||this.checked;v.dataSetFilterChanged(this.value,R)};C.shopPage.buildDataSourceFilterOption=function(T,W){var S=document.createElement("tr");S.setAttribute("title",T.name);var R=document.createElement("td");var Y=document.createElement("input");Y.type="checkbox";var U=typeof T.checked;if(U!=="undefined"&&((U==="boolean"&&T.checked)||(U==="string"&&T.checked.toLowerCase()!=="false"))){Y.setAttribute("checked",true)}Y.value=W;Y.onclick=C.shopPage.filterDataSource;R.appendChild(Y);S.appendChild(R);R=document.createElement("td");var V=document.createElement("span");V.textContent=T.name;if(T.deleted){V.style.textDecoration="line-through"}Y.textContent=V;R.appendChild(V);S.appendChild(R);R=document.createElement("td");V=document.createElement("span");V.classList.add("dataSourceFilter-rowCountLabel");V.style.marginLeft="3px";V.style.marginRight="3px";Y.textContent=V;R.style.textAlign="right";R.appendChild(V);S.appendChild(R);R=document.createElement("td");var X=y.getDataMark(T.alias,{imgHeight:10,imgWidth:10});X.style.fill="#5b5d5e";R.style.textAlign="left";R.appendChild(X);S.appendChild(R);C.shopPage.dataSourceFilters[T.alias]=S;C.shopPage.updateDataSourceFilterOption(S,T);return S};C.shopPage.updateDataSourceFilterOption=function(T,R){var S=T.querySelector(".dataSourceFilter-rowCountLabel");S.textContent="("+R.rowCount+")"};C.shopPage.selectionChanged=function(){v.getLastSelected()};C.shopPage.refreshScatterGrid=function(){var S=v.getAllParametersAsFlatList(v.varGroup,true).map(function(U){return v.findParameter(U)}).filter(function(U){return U.structure==="SCALAR"});if(typeof C.shopPage.activeGridParameters==="undefined"){C.shopPage.activeGridParameters=v.getInitialNBestParameter(Math.min(3,v.getAllParametersAsFlatList(v.varGroup,true).length));C.shopPage.activeGridParameters=C.shopPage.activeGridParameters.map(function(U){return v.findParameter(U.ID)}).filter(function(U){return U.structure==="SCALAR"})}var T=C.shopPage.activeGridParameters.map(function(U){return U.ID});var R=function(X){var W=T.map(function(aa){var Z=v.findParameter(aa);var Y=X[aa];Y.ID=aa;Y.displayName=Z.displayName;return Y});var V=function(Z,Y){n.setSelectedPoints(Z);U.refreshPlots(Z,Y)};var U;if(typeof C.shopPage.scatterGridElement==="undefined"){U=document.createElement("ra-scatterGrid");U.setGetScatterGridTile(function(Y,aa,Z){v.getScatterGridTile(Y,aa,Z)});U.setSetupPlots(function(Z,ab){var aa=v.setupScatterPlots(Z);if(U.contours){var Y=v.setupContourPlots(Z);e.when(aa,Y).then(ab)}else{e.when(aa).then(ab)}});U.addRectangleContextHandler(function(Y){n.showRectangleContextMenu(Y)});U.addRectangleSelectCallback(function(Y){v.setScatterGridSelection(Y,V)});U.setDropdownCallback(function(Z,Y){C.shopPage.activeGridParameters[Z]=v.findParameter(Y);C.shopPage.refreshScatterGrid()});U.addClickCallback(function(Z){var Y=function(aa){U.addCrosshairs(aa);U.addInfoBalloon(Z.xParam,Z.yParam,aa)};v.getNearestPlotPoint(Z,Y)});document.getElementById("scatterViewMVP").appendChild(U);C.shopPage.scatterGridElement=U}else{U=C.shopPage.scatterGridElement}U.setParameters(S);U.setActiveParameters(W);if(C.shopPage.contoursChecked){U.contours=true;U.setGetContourPlotTile(function(Y,aa,Z){v.getContourPlotTile(Y,aa,Z)})}else{U.contours=false}U.buildPeripherals();U.buildPlots()};v.getFilteredParameterStatistics(T,R)};C.shopPage.resize=function(U){var S=e("#parametercontrol>.sim-ui-panel-controlgroup-contentpanel");var R=e(S).height();var T=e(window).height()-K;if(T<2*E){T=2*E}e(S).css("max-height",T);if(R>25){if(O*E>T){e(S).css("height",T)}else{e(S).css("height",O*E)}}e(S).css("overflow-y","auto");C.shopPage.reloadView(U);if(e(".sim-ui-popover-rootDiv").length>0){e(".sim-ui-popover-rootDiv").data("eventHandlers").resize()}};C.shopPage.reloadView=function(){e("#mapParams").css("display","none");e("#mapOptions").css("display","none");e("#historyMapParams").css("display","none");e("#historyOptions").css("display","none");e("#gridParams").css("display","none");var R,T;if(e("#scatterViewMVP").is(":visible")){C.shopPage.refreshScatterGrid(true);if(e("#gridParams").length===0){R=e("<div></div>",{id:"gridParams","class":"sim-ui-panel-content-toolbarbutton",title:h.translate("Scattergrid View Parameters"),style:"background-image: url(./assets/icons/parameters.png); background-color: transparent; background-size: 24px 24px;background-position: 50% 50%; background-repeat: no-repeat no-repeat;"}).appendTo(e("#toolbar"));R.on("click",function(){C.shopPage.makeSelectGridParamPopover()});R.tooltip()}else{R=e("#gridParams");R.css("display","inline-block")}}else{if(e("#tableView").is(":visible")){C.shopPage.refreshShopTable()}else{if(e("#mapView").is(":visible")){var S=10;if(e("#mapParams").length===0){R=e("<div></div>",{id:"mapParams","class":"sim-ui-panel-content-toolbarbutton",title:h.translate("Map View Parameters"),style:"background-image: url(./assets/icons/parameters.png); background-color: transparent; background-size: 24px 24px;background-position: 50% 50%; background-repeat: no-repeat no-repeat;"}).appendTo(e("#toolbar"));R.on("click",function(){C.shopPage.mapViewHandler.makeSelectParamPopover()});R.tooltip()}else{R=e("#mapParams");R.css("display","inline-block")}if(e("#mapOptions").length===0){T=e("<div></div>",{id:"mapOptions","class":"sim-ui-panel-content-toolbarbutton",title:h.translate("SOM Options"),style:"background-image: url(./assets/icons/options.png); background-color: transparent; background-size: 24px 24px;background-position: 50% 50%; background-repeat: no-repeat no-repeat;"}).appendTo(e("#toolbar"));T.tooltip();T.on("click",function(){C.shopPage.mapViewHandler.makeOptionsPopover()})}else{T=e("#mapOptions");T.css("display","inline-block")}setTimeout(function(){if(!C.shopPage.mapViewHandler.hasData){C.shopPage.mapViewHandler.selectedParamsForCalc=[];C.shopPage.mapViewHandler.getSOMResults();C.shopPage.mapViewHandler.hasData=true}else{C.shopPage.mapViewHandler.refresh();C.shopPage.mapViewHandler.createAllSOMs()}},S)}else{if(e("#historyView").is(":visible")){if(e("#historyMapParams").length===0){R=e("<div></div>",{id:"historyMapParams","class":"sim-ui-panel-content-toolbarbutton",title:h.translate("History View Parameters"),style:"background-image: url(./assets/icons/parameters.png); background-color: transparent; background-size: 24px 24px;background-position: 50% 50%; background-repeat: no-repeat no-repeat;"}).appendTo(e("#toolbar"));R.on("click",function(){C.shopPage.historyView.makeSelectParamPopover()});R.tooltip()}else{R=e("#historyMapParams");R.css("display","inline-block")}if(e("#historyOptions").length===0){T=e("<div></div>",{id:"historyOptions","class":"sim-ui-panel-content-toolbarbutton",title:"History View Options",style:"background-image: url(./assets/icons/options.png); background-color: transparent; background-size: 24px 24px;background-position: 50% 50%; background-repeat: no-repeat no-repeat;"}).appendTo(e("#toolbar"));T.tooltip();T.on("click",function(){C.shopPage.historyView.makeOptionsPopover()})}else{T=e("#historyOptions");T.css("display","inline-block")}C.shopPage.historyView.refreshView()}}}}};C.shopPage.prepHistoryDataForCharts=function(T){if(typeof T==="undefined"||T===null){return[]}var V=["GLYPH","ID","GRADING"];var R=T.GRADING||[];var X=T.GLYPH||[];var U=function(Y){if(Y===-1){return"#CCC"}else{if(Y===0){return"#4cdcde"}else{if(Y===1){return"#a11923"}else{if(Y===2){return"#499f3f"}}}}};var S=function(Y){return{fillColor:U(R[Y]),lineColor:"#ccc",radius:4,lineWidth:1}};var W=[];v.getAllParametersAsFlatList().forEach(function(Z){var ab=v.findParameter(Z);var Y=ab.displayName;var aa=[];if(Array.isArray(T[Z])){aa=T[Z].map(function(ad,ac){return{y:ad,marker:S(ac)}})}W[Y]=aa});return W};C.shopPage.makeSelectGridParamPopover=function(){var V=e("<div></div>",{id:"gridParamsPopover"});var R=e("<div></div>",{id:"paramsPopover-paramsDiv"});var aj=e("<div></div>",{id:"paramsPopover-contourDiv"});var T;var al;var W;var ab=false,Y=false;V.append(R);V.append(aj);V.css("padding-bottom","18px");var ak=v.getAllParametersAsFlatList().map(function(am){return v.findParameter(am)});ak=ak.filter(function(am){return((am.dataType==="REAL"||am.dataType==="INTEGER")&&am.structure==="SCALAR")}).sort(function(an,am){return an.displayName>am.displayName?1:an.displayName<am.displayName?-1:0});var ai={};var ag;for(ag=0;ag<C.shopPage.activeGridParameters.length;ag++){ai[C.shopPage.activeGridParameters[ag].ID]=true}var Z=document.createElement("span");Z.textContent="Parameters";R.append(Z);var af=e("<div></div>",{id:"paramsPopover-selectAllDiv"});R.append(af);var ac=document.createElement("span");ac.textContent=" Select All ";var ah=document.createElement("input");ah.type="checkbox";var X=false;if(C.shopPage.selectAllChecked===true){X=true}e(ah).prop("checked",X);e(ah).click(function(){if(C.shopPage.selectAllChecked===true){C.shopPage.selectAllChecked=false;e(this.parentNode.parentElement).children(".sim-ui-map-view-params").children("input").each(function(){this.checked=false})}else{C.shopPage.selectAllChecked=true;e(this.parentNode.parentElement).children(".sim-ui-map-view-params").children("input").each(function(){this.checked=true})}e(ah).prop("checked",C.shopPage.selectAllChecked);Y=true});af.append(ah);af.append(ac);for(ag=0;ag<ak.length;ag++){if(ai[ak[ag].ID]){W=true}else{W=false}T=e("<div></div>",{id:"#_"+ak[ag].ID,"class":"sim-ui-map-view-params"}).appendTo(R);al=e("<input />",{type:"checkbox",id:"cb_"+ak[ag].ID,value:ak[ag].ID}).appendTo(T);al.click(function(){if(!this.checked){C.shopPage.selectAllChecked=false;e(ah).prop("checked",C.shopPage.selectAllChecked)}Y=true});al.prop("checked",W);e("<label />",{"for":"cb_"+ak[ag].ID,text:ak[ag].displayName}).appendTo(T)}var aa=document.createElement("span");aa.textContent="Show Contours";var U=document.createElement("input");U.type="checkbox";var ae=false;if(C.shopPage.contoursChecked===true){ae=true}e(U).prop("checked",ae);e(U).click(function(){ab=true});aj.append(aa);aj.append(U);var ad=function(){var am=e('<button style="margin:4px;">OK</button>').on("click",function(){if(ab||Y){C.shopPage.activeGridParameters=[];R.children(".sim-ui-map-view-params").children("input").each(function(){if(this.checked){C.shopPage.activeGridParameters.push(this.value)}});C.shopPage.activeGridParameters=C.shopPage.activeGridParameters.map(function(an){return v.findParameter(an)});if(U.checked){C.shopPage.contoursChecked=true}else{C.shopPage.contoursChecked=false}C.shopPage.refreshScatterGrid(true)}x.closePopover()});return am};var S={width:550,height:550,footerOptions:{type:"button",content:ad}};x.makePopover([h.translate("Shown In Scattergrid")],[V],h.translate("Select Parameters"),"sim-ui-som-params-popover",S)};C.shopPage.dataSetChanged=function(R){R=R||{tags:{}};if(typeof R.tags!=="undefined"&&R.tags.startEditMode){C.shopPage.startEditMode()}C.shopPage.fullRefresh(R)};C.shopPage.refreshFilterCounts=function(){var R=v.getAllParametersAsFlatList();var Z=R.length;var U=0;var T=0;var X=(v.filters.designCounter&&v.filters.designCounter.totalDesigns)||0;if(Z>0){for(H=0;H<Z;H++){var V=R[H];var S=v.findParameter(V);if(typeof S.min!=="undefined"&&typeof S.max!=="undefined"){if(S.min<=S.max){T=S.infeasibleHistogramValues.sum();U=S.paretoHistogramValues.sum();break}}}var Y=v.getExcludedRowIdList().length;e("#bestFilterLabel").text(h.translate("Best Alternatives"," ("+U+")"));e("#infeasibleFilterLabel").text(h.translate("Infeasible"," ("+T+")"));e("#dominatedFilterLabel").text(h.translate("Dominated"," ("+(X-U-T-Y)+")"));e("#excludedFilterLabel").text(h.translate("Excluded"," ("+Y+")"))}if(typeof v.filters.designCounter!=="undefined"&&typeof v.filters.designCounter.displayedDesigns!=="undefined"&&typeof v.filters.designCounter.totalDesigns!=="undefined"){var W=String(v.filters.designCounter.displayedDesigns)+" "+h.translate("points displayed"," ("+X)+" "+h.translate("total")+")";document.querySelector("#designCountStatusPanel").textContent=W}};C.shopPage.fullRefresh=function(S){var X;if(typeof S==="undefined"){S=[{}]}if(!(S instanceof Array)){S=[S]}if(S[0].iaEventUISource==="dataHandler-saveOrder"){return}if(C.shopPage.pageLoaded===false){return false}if(C.shopPage.dataHandler){C.shopPage.dataHandler.fullData=null}var T=true;if(C.shopPage.editMode===true){T=false}var Z=S[0].iaEventType==="multipleEvents"?S[0].eventsArray:S;var R={};var Y=false;for(var X=0;X<Z.length;X++){R[Z[X].iaEventType]=true}if(R.formulationChanged||R.dataSetChanged||(R.filterChanged&&S[0].iaEventSource!=="initializeFilters")){Y=true}if(T&&Y){if(S[0].iaEventType==="dataSetChanged"){C.shopPage.dataHandler.fullData=null;C.shopPage.mapViewHandler.hasData=false}if(S[0].iaEventType!=="filterChanged"){C.shopPage.filterCategorical()}C.shopPage.dataHandlerDeferred.done(function(){var aa=e("#parametercontrol>.sim-ui-panel-controlgroup-contentpanel");var ab=v.findGroup();C.shopPage.rebuildParameterSliders(aa,ab)});C.shopPage.refreshFilterCounts()}if(S[0].iaEventUISource!=="initializeFilters"){C.shopPage.updateDataHandler({source:"fullRefresh",event:S})}var V=null;if(e("#dataTableFrame .sim-ui-mainContentDiv table")[0]&&e("#dataTableFrame .sim-ui-mainContentDiv table")[0].config&&e("#dataTableFrame .sim-ui-mainContentDiv table")[0].config.sortList){V=e("#dataTableFrame .sim-ui-mainContentDiv table")[0].config.sortList}if(T){C.shopPage.updateDataSourceFilters()}if(T){C.shopPage.refreshFilterCounts()}var U=true;if((S[0].iaEventType==="filterChanged"&&v.caseInfo.userList[v.caseInfo.CurrentUser.userID].isInControl)||(S[0].iaEventType==="basketChanged"&&S.iaEventUISource!=="shopPage-paramSlider")){U=false}if(S[0].iaEventType==="multipleEvents"){var W=Object.keys(S[0].eventTypes);for(X=W.length-1;X>=0;X--){if(W[X]==="filterChanged"||W[X]==="basketChanged"){W.splice(X,1)}}if(W.length===0){U=false}}if(U){C.shopPage.dataHandlerDeferred.done(function(){var aa=e("#parametercontrol>.sim-ui-panel-controlgroup-contentpanel");var ab=v.findGroup();C.shopPage.rebuildParameterSliders(aa,ab)})}if(e("#tableView").is(":visible")){C.shopPage.refreshShopTable(S)}if(e("#scatterViewMVP").is(":visible")){C.shopPage.refreshScatterGrid(true)}if(e("#mapView").is(":visible")){if(!C.shopPage.mapViewHandler.hasData){C.shopPage.mapViewHandler.getSOMResults();C.shopPage.mapViewHandler.hasData=true}else{C.shopPage.mapViewHandler.refresh(S[0])}}if(e("#historyView").is(":visible")){C.shopPage.historyView.refreshView()}};C.shopPage.hierarchyChanged=function(S){var R={source:"hierarchyChanged"};if(S.moveNode){R.moveNode=true;R.lastColumnID=S.lastColumnID;R.newColumnID=S.newColumnID}if(S.deleteNode===true){R.deleteNode=true}C.shopPage.updateDataHandler(R).done(function(){C.shopPage.mapViewHandler.hasData=false;C.shopPage.dataHandler.fullData=null;C.shopPage.refreshFilterCounts();v.setFiltersAndSync({iaEventUISource:"shopPage-hierarchyChanged"});C.shopPage.rebuildSliderPanel();if(e("#tableView").is(":visible")){C.shopPage.refreshShopTable(S)}if(e("#scatterViewMVP").is(":visible")){C.shopPage.refreshScatterGrid()}if(e("#mapView").is(":visible")){C.shopPage.mapViewHandler.getSOMResults()}});e(".sim-param-slider-control").adviseParamslider("refresh")};C.shopPage.postRender=function(R){if(e("#tableView").is(":visible")){C.shopPage.initializeDataTable()}else{}if(e("#mapView").is(":visible")){C.shopPage.mapViewHandler.processData();C.shopPage.mapViewHandler.refresh(R)}if(e("#scatterViewMVP").is(":visible")){C.shopPage.refreshScatterGrid()}if(e("#historyView").is(":visible")){C.shopPage.historyView.refreshView()}};C.shopPage.eventListHandlerShopPage=function(V,S,W){if(W.length===1){return W}var Z=[];var T=[];var R={};var Y=false;for(var U=0;U<W.length;U++){var X=W[U];if(X.iaEventType==="formulationChanged"||X.iaEventType==="parameterChanged"||X.iaEventType==="filterChanged"||X.iaEventType==="gradingChanged"){Y=true;T.push(X);if(!R[X.iaEventType]){R[X.iaEventType]=true}}else{Z.push(X)}}if(T.length<=1){return W}if(Y){C.shopPage.fullRefresh({iaEventType:"multipleEvents",eventsArray:T,eventTypes:R});C.shopPage.fullRefreshNeeded=true}return Z};C.shopPage.createDataHandler=function(){C.shopPage.dataHandler=new c({},C.shopPage.dataTableInterface,v.dataTableProxy,a.makeD3GroupCopy)};C.shopPage.initializeDataHandler=function(){C.shopPage.timers.initializeData=new r("INITIALIZE DATA");C.shopPage.timers.initializeData.startTimer();C.shopPage.dataHandlerState="updating";var T=C.shopPage.dataHandlerDeferred;C.shopPage.dataHandler.importVarGroup();if(v.caseInfo.userList[v.caseInfo.CurrentUser.userID].isInControl){C.shopPage.dataHandler.saveOrder()}C.shopPage.dataHandler.addFunctionColumn(u.basketFunction,u.getBasketColumnObject(),true);C.shopPage.dataHandler.addFunctionColumn(u.dataSourceFunction,u.getDataSourceColumnObject(),true);C.shopPage.dataHandler.updateFixedColumn("Rank",{compareFn:function(X,W){var V=X.fixedData.auto_rank;var U=W.fixedData.auto_rank;if(Number(U)===0&&Number(V)===0){return 0}else{if(Number(V)===0){return 1}else{if(Number(U)===0){return -1}else{return Number(V)-U}}}}});var R=v.getAllParametersAsFlatList();for(var S=0;S<R.length;S++){if(v.findParameter(R[S]).structure==="ARRAY"){C.shopPage.dataHandler.addFunctionColumn(u.arrayFunction,{ID:R[S]},false)}}C.shopPage.dataHandler.initializeTableData().done(function(){C.shopPage.dataHandler.setFixedColumns(5,true);C.shopPage.dataHandlerDeferred.resolve();C.shopPage.dataHandlerState="done"});return T};C.shopPage.updateDataHandler=function(T){T=T||{};var V;if(C.shopPage.dataHandlerState==="inactive"&&C.shopPage){}else{if(C.shopPage.dataHandlerState==="done"){C.shopPage.dataHandlerState="updating";C.shopPage.dataHandlerDeferred=new e.Deferred();V=C.shopPage.dataHandlerDeferred;if(T.deleteNode===true){C.shopPage.dataHandler.importVarGroup({garbageCollect:true})}else{C.shopPage.dataHandler.importVarGroup()}var R=v.getAllParametersAsFlatList();for(var U=0;U<R.length;U++){if(v.findParameter(R[U]).structure==="ARRAY"){C.shopPage.dataHandler.addFunctionColumn(u.arrayFunction,{ID:R[U]},false)}}var S=new e.Deferred();if(T&&T.moveNode){var X=0,W=v.findParameter(T.newColumnID);if(C.shopPage.dataHandler.data.columns[T.lastColumnID]){X=C.shopPage.dataHandler.data.columns[T.lastColumnID].order+1}C.shopPage.dataHandler.insertParameter(W,X);C.shopPage.dataHandler.saveOrder().done(function(){if(C.shopPage.dataTableState==="rendered"){C.shopPage.dataTable.updateHeader();C.shopPage.dataHandler.updateColumnPositions()}S.resolve()})}else{S.resolve()}e.when(S).done(function(){C.shopPage.dataHandlerState="done";V.resolve()})}}return V};C.shopPage.initializeDataTable=function(){if(C.shopPage.dataTableState==="inactive"){C.shopPage.dataTableState="rendering";C.shopPage.tableInitializing=true;C.shopPage.tableInitializeListener=C.shopPage.dataHandlerDeferred;C.shopPage.tableInitializeListener.done(function(){var U=new e.Deferred();var T=C.shopPage.dataHandlerDeferred;C.shopPage.dataHandler.importVarGroup({garbageCollect:true,initializing:true});var S=C.shopPage.dataHandler.initializeTableData();var R={pareto_color:l.PARETO_COLORS,feasible_color:l.DOMINATED_COLORS,infeasible_color:l.INFEASIBLE_COLORS,excluded_color:l.EXCLUDED_COLORS};C.shopPage.dataTable=new i(R,C.shopPage.dataTableInterface);C.shopPage.dataTable.setCssEditor(C.shopPage.cssEditor);C.shopPage.dataTable.setContainer(document.getElementById("tableView"));C.shopPage.dataTable.setStartEditCallback(C.shopPage.startEditMode);C.shopPage.dataTable.setEndEditCallback(C.shopPage.endEditMode);T.done(function(){C.shopPage.dataTable.setDataHandler(C.shopPage.dataHandler);C.shopPage.dataTable.initializeHeader();C.shopPage.dataHandler.updateColumnPositions();C.shopPage.dataTable.initializeBody();S.done(function(){C.shopPage.dataTable.updateBodySize()});U.resolve()});T.fail(function(){U.reject()});e.when(U).always(function(){C.shopPage.dataTableState="rendered"})});C.shopPage.tableInitializeListener.fail(function(){C.shopPage.dataTableState="rendered"})}else{if(C.shopPage.dataTableState==="rendered"){C.shopPage.refreshShopTable()}}};C.shopPage.refreshShopTable=function(V){if(typeof V==="undefined"){V={}}if(!(V instanceof Array)){V=[V]}var T={"dataHandler-moveColumn":true};if(T[V[0].iaEventUISource]===true){return}if(V[0].iaEventUISource==="dataTable-ContextMenu"){return}if(C.shopPage.dataTableState==="rendered"){C.shopPage.dataTableState="rendering";var U;C.shopPage.timers.dataTable.resetInterval();if(C.shopPage.dataHandlerState==="inactive"){C.shopPage.createDataHandler();U=C.shopPage.initializeDataHandler()}else{if(C.shopPage.dataHandlerState==="created"){U=C.shopPage.initializeDataHandler()}else{if(C.shopPage.dataHandlerState==="updating"){U=C.shopPage.dataHandlerDeferred}else{U=C.shopPage.dataHandlerDeferred}}}C.shopPage.timers.dataTable.getAndResetInterval(h.translate("Data table initializing")+": ");if(V[0].iaEventType==="hierarchyChanged"||V[0].iaEventType==="parameterChanged"){C.shopPage.dataHandler.importVarGroup({garbageCollect:true});var R=v.getAllParametersAsFlatList();for(var S=0;S<R.length;S++){if(v.findParameter(R[S]).structure==="ARRAY"){C.shopPage.dataHandler.addFunctionColumn(u.arrayFunction,{ID:R[S]},false)}}C.shopPage.timers.dataTable.getAndResetInterval(h.translate("Import vargroup")+": ")}var W=new e.Deferred();U.done(function(){C.shopPage.timers.dataTable.getAndResetInterval(h.translate("Data ready")+": ");C.shopPage.dataTable.eventController("refreshTable",true);C.shopPage.timers.dataTable.getAndResetInterval(h.translate("Table refreshed")+": ");W.resolve()});e.when(W).always(function(){C.shopPage.timers.dataTable.getTotalTime(h.translate("TT_REFRESH_TIME")+": ");C.shopPage.dataTableState="rendered"})}else{if(C.shopPage.dataTableState==="inactive"){C.shopPage.initializeDataTable()}}};C.shopPage.basketChanged=function(){if(C.shopPage.dataTableState==="rendered"){C.shopPage.dataTable.eventController("basketChanged",true)}if(e("#scatterViewMVP").is(":visible")){C.shopPage.refreshScatterGrid()}};C.shopPage.updateTableParameters=function(){};C.shopPage.updateTableRows=function(){};C.shopPage.buildOverallScoreHistogram=function(){var S=e("#overallscorefilter>.sim-ui-panel-controlgroup-contentpanel").css("overflow","hidden");var R=e("<div/>",{id:"_overallscore","class":"sim-param-control",style:"padding-top:5px;top:35px;left:25px;width:60%;height:7px"});S.data("divID","overallscore");S.append(R);window.setTimeout(function(){R.empty();S.children("svg").remove();R.adviseParamslider({paramID:"overallscore"})},0);e(S).css("height",70);C.shopPage.pageLoaded=true};C.shopPage.toggleOverallScoreView=function(U){var S;if(C.shopPage.overallScoreView==="histogram"&&confirm(String(h.translate("SHOP_CONFIRM_MSG_1")+"\n\n "+h.translate("SHOP_CONFIRM_MSG_2")))){S=document.querySelector("#_overallscore");if(S.remove){S.remove()}else{S.parentNode.removeChild(S)}C.shopPage.resetScoreFilter();C.shopPage.buildOverallScoreCategorical(U);C.shopPage.filterCategorical();C.shopPage.overallScoreView="categorical";document.querySelector("#overallScoreViewButton").setAttribute("title",h.translate("HST_VIEW_SWITCH"));document.querySelector("#overallScoreViewButton").classList.remove("sim-ui-param-control-categorical-icon");document.querySelector("#overallScoreViewButton").classList.add("sim-ui-param-control-histogram-icon")}else{if(C.shopPage.overallScoreView==="categorical"&&confirm(String(h.translate("SHOP_CONFIRM_MSG_1")+"\n\n "+h.translate("SHOP_CONFIRM_MSG_2")))){C.shopPage.quantileData[0].filtered=false;C.shopPage.quantileData[1].filtered=false;C.shopPage.quantileData[2].filtered=false;S=document.querySelector("#overallScoreCategorical");if(S.remove){S.remove()}else{S.parentNode.removeChild(S)}var R=document.querySelector("#overallscorefilter");var T=R.querySelector(".ra-csf-skewed");if(T!==null){T.parentNode.removeChild(T)}C.shopPage.resetScoreFilter();C.shopPage.buildOverallScoreHistogram();C.shopPage.overallScoreView="histogram";document.querySelector("#overallScoreViewButton").setAttribute("title",h.translate("CTGRCL_FL_VIEW_SWITCH"));document.querySelector("#overallScoreViewButton").classList.add("sim-ui-param-control-categorical-icon");document.querySelector("#overallScoreViewButton").classList.remove("sim-ui-param-control-histogram-icon")}}};C.shopPage.resetScoreFilter=function(S){var R=v.varGroup.score;return v.setMultipleFilters([{paramID:"overallscore",type:"IN_RANGE",firstFilterValue:R.min,secondFilterValue:R.min},{paramID:"overallscore",type:"LESS_THAN",firstFilterValue:R.min,secondFilterValue:null},{paramID:"overallscore",type:"GREATER_THAN",firstFilterValue:R.max,secondFilterValue:null}],S)};C.shopPage.startEditMode=function(V){if(C.shopPage.editMode===true){return}V=V||{};C.shopPage.editMode=true;var S=document.getElementById("shopdesignscontrolpanel");var Y=document.createElement("div");Y.setAttribute("id","ra-editModeBlockingDiv");var X=document.createElement("div");X.setAttribute("id","ra-editModeTextDiv");var W=document.createElement("div");W.textContent=h.translate("Edit Mode");W.setAttribute("id","ra-editMode-title");var U=document.createElement("button");U.textContent=h.translate("Done Editing");U.setAttribute("id","ra-editMode-button");var R=document.createElement("div");R.textContent=h.translate("EDIT_TABLE_MESSAGE");R.setAttribute("id","ra-editMode-text");var T=function(){C.shopPage.endEditMode()};U.addEventListener("click",T);C.shopPage.dataTable.startEditMode();X.appendChild(W);X.appendChild(R);X.appendChild(U);Y.appendChild(X);S.appendChild(Y)};C.shopPage.endEditMode=function(S){if(C.shopPage.editMode===false){return}S=S||{};C.shopPage.editMode=false;C.shopPage.dataTable.leaveEditMode();var T=document.getElementById("ra-editModeBlockingDiv");T.parentElement.removeChild(T);var R={iaEventType:"dataSetChanged"};if(typeof S.noRefresh!=="undefined"&&S.noRefresh===true){v.setFiltersAndSync({iaEventUISource:"shopPage-dataSetChanged"});return}C.shopPage.fullRefresh(R)};C.shopPage.save=function(){var R={thumbnailView:C.shopPage.thumbnailView,scatterGridMVP:C.shopPage.scatterGridMVP,editableColumns:C.shopPage.editableColumns,activeGridParameters:C.shopPage.activeGridParameters,dataSourceFilters:C.shopPage.dataSourceFilters,overallScoreView:C.shopPage.overallScoreView,quantileData:C.shopPage.quantileData,customQuantile:C.shopPage.customQuantile,categoricalFilterData:C.shopPage.categoricalFilterData};try{v.savePageData("shopPage",v.serializePageObject(R))}catch(S){console.warn("Error trying to persist shop page session info",[S])}};C.shopPage.element=e("#"+M);C.shopPage.element.advisePage({controlPanelId:"shopdesignscontrolpanel",contentPanelId:"shopdesignscontentpanel",viewchange:C.shopPage.reloadView,resize:C.shopPage.resize,entering:C.shopPage.enteringShopPage,formulationChanged:C.shopPage.fullRefresh,parameterChanged:C.shopPage.fullRefresh,filterChanged:C.shopPage.fullRefresh,gradingChanged:C.shopPage.fullRefresh,selectionChanged:C.shopPage.selectionChanged,save:C.shopPage.save,eventListHandler:C.shopPage.eventListHandlerShopPage,postRender:C.shopPage.postRender,basketChanged:C.shopPage.basketChanged,hierarchyChanged:C.shopPage.hierarchyChanged,dataSetChanged:C.shopPage.dataSetChanged})}return m});define("DS/SMAAnalyticsUI/merge/SMAAnalyticsMergeView",["UWA/Core","DS/Tree/TreeListView","DS/Controls/ComboBox","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/merge/SMAAnalyticsMergeModel"],function(h,f,d,c,g){var b;var e=function(i){console.log(i)};var a=h.Class.extend({init:function(i){b=this;this.valueData=null;this.matchedNodesList=null;this.mergeModel=new g(i);this.allParamsFlat=i.acParams;this._document=this._getModel().getModel();this.treeListView=new f(this.setTreeListViewOtions());this.treeListView.options.columns[0].text=c.translate("Parameters")},setTreeListViewOtions:function(){var i=this;return{height:"auto",width:"100%",enableDragAndDrop:false,isEditable:true,isSortable:true,infiniteScrolling:true,enableKeyboardNavigation:true,resize:{columns:true,rows:false},columns:[{text:c.translate("Type"),dataIndex:"dataType",isEditable:false,isSortable:true,width:"10%"},{text:c.translate("ANALYTICS_PARAMETER"),dataIndex:"analyticsParamTitle",isEditable:false,isSortable:false,width:"30%",onCellRequest:function(p){if(!p.isHeader){var m=p.nodeModel;var n=p.manager;var q=p.nodeModel.options.grid.type;if(q&&q==="parameter"){p.valueData=i.valueData;var s=p.nodeModel.options.grid.analyticsParamID;var j=0;var k=p.nodeModel.options.grid.analyticsParamOptions;for(var o=0;o<k.length;o++){if(k[o].valueItem===s){j=o;break}}var l=new d({elementsList:k,currentValue:k[j].valueItem,currentLabel:k[j].labelItem,enableSearchFlag:true,autocompleteFlag:true});var r=l.elements.container.getElementsByClassName("wux-ui-state-undefined");if(r.length>0){r[0].addClassName("wux-controls-lineeditor");r[0].removeClassName("wux-ui-state-undefined")}l.addEventListener("change",function(v,u){u.preventDefault();u.stopPropagation();var t=this.nodeModel.options.grid.analyticsParamID;var w=u.dsModel.currentValue;this.nodeModel.options.grid.analyticsParamID=w;v.mergeModel.updateParamOptions(this.nodeModel.options.grid.externParamId,t,w,this.nodeModel.options.grid.dataType);this.manager.updateRowView(this.virtualRowID)}.bind(p,i));p.cellView.getContent().setHTML(l)}}}}],selection:{cells:false,rowHeaders:false,columnHeaders:false,canMultiSelect:false,useUnselectAllOnEmptyArea:true},showLoaderIndicator:true,treeDocument:this._document}},refresh:function(i){this.mergeModel.update(i)},getView:function(){return this.treeListView},_getModel:function(){return this.mergeModel},searchModel:function(j){var i=this._getModel().getModel();this._showAllNodes(i);j=j.replace(/\*/g,"");if(j.length>0){this.matchedNodesList=i.search({match:function(k){if(j&&k.nodeModel.options.label.toLowerCase().indexOf(j.toLowerCase())!==-1){return true}return false}});this._hideAllNodes(i);i.prepareUpdate();this.matchedNodesList.forEach(function(l){l.show();var k=l.getParents();k.forEach(function(m){m.show()});l.show();l.reverseExpand()},this);i.pushUpdate()}},_showAllNodes:function(i){i.prepareUpdate();if(i&&i.getAllDescendants&&i.getAllDescendants()!==null){i.getAllDescendants().forEach(function(j){j.show()})}i.collapseAll();i.pushUpdate()},_hideAllNodes:function(i){i.prepareUpdate();if(i&&i.getAllDescendants&&i.getAllDescendants()!==null){i.getAllDescendants().forEach(function(j){j.hide()})}i.pushUpdate()}});return a});define("DS/SMAAnalyticsUI/SMAAnalyticsDefinePage",["DS/SMAAnalyticsUI/SMAAnalyticsJQuery","DS/SMAAnalyticsUI/SMAAnalyticsProxy","DS/SMAAnalyticsUI/SMAAnalyticsUtils","DS/SMAAnalyticsUI/SMAAnalyticsTextArea","DS/SMAAnalyticsUI/SMAAnalyticsParamDefinitionEditor","DS/SMAAnalyticsUI/SMAAnalyticsMindMap","DS/SMAAnalyticsUI/SMAAnalyticsParameterMap","DS/SMAAnalyticsNLS/SMAAnalyticsNLSUtils","DS/SMAAnalyticsUI/SMAAnalyticsSVGScraper","DS/Controls/LineEditor","DS/SMAAnalyticsUI/merge/SMAAnalyticsMergeView","DS/SMAAnalyticsUI/SMAAnalyticsUICommon"],function(h,k,f,b,j,i,g,e,a,d,m,c){function l(q,o){q.definePage={create:l,pageLoaded:false,refreshEvents:{},expanded:{state:false}};var n=k.getSwitch("RA_INTERACTIVE_DESIGN");var p=q.definePage;p.data={varGroupCopy:k.getGroupCopy(k.varGroup),formulationMap:f.getFormulationMap(),saved:true};h("#definecontentpanel").data(p.data);h(o.viewObject.hierarchyView).append(h('<div id="sim-ui-hierarchy-container"></div>'));p.mindMap=new i();p.rebuildMindMap=function(){p.mindMap.setContainerDiv(h("#sim-ui-hierarchy-container"));p.mindMap.setPopoverData(h("#definecontentpanel").data());p.mindMap.persistImmediately(true);p.mindMap.makeMindmap()};p.pde=new j();p.buildParamDefinitionEditor=function(s){if(s&&s.iaEventPageSource&&s.iaEventPageSource==="definePage"){return}p.pde.setParentContainerDiv(h(o.viewObject.definitionView));p.pde.setPopoverData({varGroupCopy:k.getGroupCopy(k.varGroup),formulationMap:f.getFormulationMap(),saved:true});p.pde.persistImmediately(true);p.pde.makeParamDefinitionEditor();p.pde.makePriorityLegend()};p.pm=new g();p.buildParameterMap=function(t){if(!t){h(o.viewObject.mappingView).empty();h(o.viewObject.mappingView).append('<div class="sim-ui-parammap-header"><h3>'+e.translate("map_plm_to_param")+"</h3></div>");h(o.viewObject.mappingView).append('<div id="sim-ui-parammap"></div>')}p.pm.setContainerDiv(h("#sim-ui-parammap"));p.pm.setVarGrpData({varGroupCopy:k.getGroupCopy(k.varGroup),formulationMap:f.getFormulationMap(),saved:true});var s=p.pm.makeParameterMap(k._caseID,t);if(!t){h(o.viewObject.mappingView).append(s)}};p.buildInteractiveViewerMapView=function(){if(!k.getSwitch("RA_INTERACTIVE_DESIGN")){return null}var s=k.getAllParameterObjectsAsFlatList(),v=k.getInteractiveParameterMapping();var u={acParams:s,paramMap:v,params:k._interactiveSessionParams};function w(){var B=document.createElement("div");B.classList.add("sim-ui-define-top-menu");var z=document.createElement("div");z.classList.add("sim-ui-export-search");var A=new d({placeholder:"Search Parameters ...",selectAllOnFocus:true,});A.addEventListener("change",function(C){C.preventDefault();C.stopPropagation();if(p.mergeView){p.mergeView.searchModel(C.dsModel.value)}});A.inject(z);B.appendChild(z);return B}if(p.mergeView){p.mergeView.refresh(u)}else{var y=w();p.mergeView=new m(u);var t=p.mergeView.getView().getContent();t.getElementsByClassName("wux-datagrid")[0].addClassName("ra-exportview-theme");var x=document.querySelector("#interactiveviewermapview");if(x!==null){x.appendChild(y);x.appendChild(t)}}return t};p.setUpProblemFormulationLockButton=function(){var u=h("#definepagetoolbar"),s=null;var t=function(v){if(!k.isFormulationLocked()){k.setFormulationLock(true);v.removeClass("def-lock");v.addClass("def-unlock");v.attr("title",e.translate("Unlock Formulation"));alert(e.translate("formulation_locked_msg"))}else{k.setFormulationLock(false);v.removeClass("def-unlock");v.addClass("def-lock");v.attr("title",e.translate("Lock Formulation"));alert(e.translate("formulation_unlocked_msg"))}};if(k.isFormulationLocked()){if(k.getUserLockUnlockAccess(false)){s=u.append('<div class="sim-ui-panel-content-toolbarbutton sim-ui-toolbar-btn def-lock" id="def-lock" title="'+e.translate("Unlock Formulation")+'"></div>').children("#def-lock");s.on("click",function(){t(h(this))})}}else{if(k.getUserLockUnlockAccess(true)){s=u.append('<div class="sim-ui-panel-content-toolbarbutton sim-ui-toolbar-btn def-lock" id="def-lock" title="'+e.translate("Lock Formulation")+'"></div>').children("#def-lock");s.on("click",function(){t(h(this))})}}return s};p.adviseCallbackFunction=function(s){if(s.length<=0){return}k.spinnerControlShow();h.ajax({type:"GET",cache:false,url:"../../resources/slmservices/advise/getAllParametersForRequirement",data:{requirements:s},success:function(t){k.spinnerControlHide();p.buildParameterMap(false)},error:function(t,v,u){console.log("Failed to retrieve parameters"+t+"\n\nText Status:\n"+v+"\n\nError Thrown:\n"+u);k.spinnerControlHide()}})};p.importRequirementParameters=function(x,s){if(k.isFormulationLocked()){alert(e.translate("cannot_import_req_msg"));return}var t="../common/emxFullSearch.jsp?table=AEFGeneralSearchResults&showInitialResults=true&selection=multiple&formName=emxCreateForm&field=TYPES=type_Requirement:LATESTREVISION=true&suiteKey=SimulationCentral&emxTableRowId="+x+"&submitURL=../simulationcentral/smaAdviseRequirementsUtil.jsp?refreshFrame=null&fromPage=null&openedBy=addexisting&inclusionList=Requirement&slmmode=addexisting&objectId="+s+"&emxTableRowId="+x+"&emxTblRowId="+x+"&refreshFrame=null&srcDestRelName=null";var z=window.screenLeft!==undefined?window.screenLeft:screen.left;var u=window.screenTop!==undefined?window.screenTop:screen.top;var v=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var A=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var w=v/2-800/2+z;var y=A/2-600/2+u;p.rcWindow=getTopWindow().showModalDialog(t,"Requirements","scrollbars=yes, width=800, height=600, top="+y+", left="+w);k.registerNamedCallback("setRequirementsFromPLM",p.adviseCallbackFunction)};p.exportRAFormulations=function(s){if(k.isFormulationLocked()){alert(e.translate("cannot_export_req_msg"));return}k.spinnerControlShow();var u=[],w,y=false;var x=function(A){var B;h(k.formulation.objectives).each(function(D,C){if(C.parameterID===A){B={type:C.type,value:C.value};return false}});return B};var t=p.pm.getAllParametersAsFlatList();h(t).each(function(B,D){if(D.plmParameterId){y=true;var E=k.getConstraintBounds(D.ID)||{};var A=x(D.ID)||{};var C={physicalId:p.pm.parsePlmParameterId(D.plmParameterId),name:D.name,priority:D.priority,minimum:E[0]||"",maximum:E[1]||"",unit:D.unit||"",objective:A.type||"",parameterValue:A.type==="TARGET"?A.value:""};u.push(C)}});var v="";if(y){var z=k.getConnectedRequirementsList(s);z.then(function(C){var B=C;var A=k.getParametersList(B);A.then(function(E){v=E;w={parametersList:u};var D=f.checkExportFormulationPossible(v,u);if(D.length<1){k.getCSRFTokenFor3DSpace().done(function(F){h.ajax({type:"POST",cache:false,url:"../../resources/slmservices/advise/exportToPLMParameters",beforeSend:function(G){G.setRequestHeader("ENO_CSRF_TOKEN",F)},data:{parameterData:JSON.stringify(w),oid:s},success:function(G){k.spinnerControlHide();c.alertMessage(c.SUCCESS,e.translate("success_export_requirement"))},error:function(G,I,H){k.spinnerControlHide();c.alertMessage(c.ERROR,e.translate("error_export_requirement"))}})})}else{k.spinnerControlHide();c.alertMessage(c.ERROR,e.translate("error_export_requirement"))}},function(D){console.log("Failure on plmparameter retrieval")})},function(A){console.error("Failure on plmparameter retrieval")})}else{k.spinnerControlHide();c.alertMessage(c.ERROR,e.translate("no_mapped_params_msg"))}};p.refreshMatches=function(x){var s=false;var w=function(C,A,D){var I=C.requirementsList[D],E=[];if(I.parametersList){E=I.parametersList.parameterList||[]}if(E.length>0){for(var B=0;B<E.length;B++){var z=E[B],J=[];z.requirementTitle=C.requirementsList[D].title||C.requirementsList[D].name;k.findParametersByPlmId(z.physicalId,null,null,J);if(J.length>0){s=true;var y=[];for(var G=0;G<J.length;G++){if(z.priority!==J[G].priority){y.push({ID:J[G].ID,priority:z.priority})}k.setParameterInfo({ID:J[G].ID,unit:z.unit});if(!isNaN(parseFloat(z.maximum))){k.setConstraint(J[G].ID,"LESS_THAN",parseFloat(z.maximum),null,z.requirementTitle,z.title||z.name)}if(!isNaN(parseFloat(z.minimum))){k.setConstraint(J[G].ID,"GREATER_THAN",parseFloat(z.minimum),null,z.requirementTitle,z.title||z.name)}if(z.objective){var F=z.objective.toUpperCase(),H="";if(F==="TARGET"&&!isNaN(parseFloat(z.parameterValue))){H=parseFloat(z.parameterValue)}k.setObjective(J[G].ID,F,H,null)}}if(y.length>0){k.setPriorityForParameters(y)}}}}if(I.requirementsList){if(I.requirementsList.requirementsList.length>0){for(var B=0;B<I.requirementsList.requirementsList.length;B++){w(I.requirementsList,A,B)}}}};try{var v=[];if(x.requirementsList.length>0){for(var t=0;t<x.requirementsList.length;t++){w(x,v,t)}}}catch(u){k.spinnerControlHide();alert(e.translate("failure_refresh_req_msg"));return false}if(!s){k.spinnerControlHide();alert(e.translate("no_mapped_params_msg"));return false}return true};p.refreshImportedFormulations=function(){if(k.isFormulationLocked()){alert(e.translate("formulation_locked_msg"));return}var s=h.Deferred();k.spinnerControlShow();s=g.prototype.getHierarchyFromRequirementCentral(q.caseID);s.done(function(t){if(t){if(p.refreshMatches(t)){alert(e.translate("mapped_param_updated_req_msg"))}else{alert(e.translate("error_refresh_mapped_param_msg"))}}else{alert(e.translate("no_referenced_params_msg"))}k.spinnerControlHide()})};p.setUpReqIconsDone=false;p.setUpReqIcons=function(){if(p.setUpReqIconsDone){return}var A=h("#definepagetoolbar"),s=q.caseID,v="|"+s+"||0,0";try{var y=k.caseInfo.CaseData.Definition.workflow.findIndex(function(E,D,C){return E.id==="definepage"}),w=k.caseInfo.CaseData.Definition.workflow[y].views.findIndex(function(E,D,C){return E.id==="parametermappingview"});if(k.caseInfo.CaseData.Definition.workflow[y].views[w].hidden){return}}catch(z){console.log("Error checking requirement mapping permissions in Define page.")}var B=A.append('<div class="sim-ui-panel-content-toolbarbutton .sim-ui-toolbar-btn" id="def-refresh" title="'+e.translate("Refresh")+'"></div>').children("#def-refresh");B.click(function(){p.refreshImportedFormulations()});if(!k.isAWidget()){var u=A.append('<div class="sim-ui-panel-content-toolbarbutton .sim-ui-toolbar-btn" id="req-import" title="'+e.translate("Import Requirements")+'"></div>').children("#req-import");u.click(function(){p.importRequirementParameters(v,s)})}var t=A.append('<div class="sim-ui-panel-content-toolbarbutton .sim-ui-toolbar-btn" id="req-export" title="'+e.translate("Export Requirements")+'"></div>').children("#req-export");t.click(function(){p.exportRAFormulations(s)});var x=p.setUpProblemFormulationLockButton();p.setUpReqIconsDone=true};p.formulationLockChanged=function(){p.pde.handleFormulationLock()};p.openScrapeUI=function(){p.svgScraper.openScrapeUI()};p.entering=function(){if(typeof p.svgScraper==="undefined"){p.svgScraper=new a(p.element)}var s=document.querySelector("#parameterhierarchyview");if(s!==null){p.svgScraper.prepContainer(s,"paramHierarchy",{svgtype:"mindmap"})}p.data.varGroupCopy=k.getGroupCopy(k.varGroup);h("#definecontentpanel").data(p.data);if(h("#parameterhierarchyview").is(":visible")){p.rebuildMindMap()}else{if(h("#parameterdefinitionview").is(":visible")){p.buildParamDefinitionEditor()}else{if(h("#parametermappingview").is(":visible")){p.buildParameterMap(false)}else{p.buildParamDefinitionEditor()}}}var t=document.querySelector('#definepage [data-icon="copyto"]');if(t!==null){t.onclick=p.openScrapeUI}};p.reloadView=function(){console.log("view changed");p.data={varGroupCopy:k.getGroupCopy(k.varGroup),formulationMap:f.getFormulationMap(),saved:true};h("#definecontentpanel").data(p.data);if(h("#parameterhierarchyview").is(":visible")){p.rebuildMindMap()}else{if(h("#parameterdefinitionview").is(":visible")){p.buildParamDefinitionEditor()}else{if(h("#parametermappingview").is(":visible")){p.buildParameterMap(false)}else{if(k.getSwitch("RA_INTERACTIVE_DESIGN")&&h("#interactiveviewermapview").is(":visible")){p.buildInteractiveViewerMapView()}}}}};p.save=function(){var s={currentView:q.definePage.currentView};try{k.savePageData("definePage",k.serializePageObject(s))}catch(t){console.warn("Error persisting the define page session information.",[t])}return true};p.fullRefresh=function(){p.data={varGroupCopy:k.getGroupCopy(k.varGroup),formulationMap:f.getFormulationMap(),saved:true};h("#definecontentpanel").data(p.data);if(h("#parameterhierarchyview").is(":visible")){p.rebuildMindMap()}else{if(h("#parameterdefinitionview").is(":visible")){p.buildParamDefinitionEditor()}else{if(h("#parametermappingview").is(":visible")){p.buildParameterMap(true)}else{if(n&&h("#interactiveviewermapview").is(":visible")){p.buildInteractiveViewerMapView()}else{console.warn("full refresh called on define page when none of the views are visible")}}}}};p.currentView="parameterdefinitionview";if(!n){p.setUpReqIcons()}else{var r=document.querySelector('#definepagetoolbar .sim-ui-panel-content-toolbarbutton[title="Save"]');r.addEventListener("click",function(){k.storeAdviseCase()})}p.element=h("#definepage");p.element.advisePage({controlPanelId:"definecontrolpanel",contentPanelId:"definecontentpanel",entering:p.entering,viewchange:p.reloadView,formulationLockChanged:p.formulationLockChanged,save:p.save,formulationChanged:p.buildParamDefinitionEditor,hierarchyChanged:p.fullRefresh,postRender:p.reloadView,valuesChanged:p.buildInteractiveViewerMapView})}return l});