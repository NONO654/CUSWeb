define("DS/SMAProcWebAsyncUtils/SMAProcWebTransaction",["DS/SMAProcWebCMMUtils/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils"],function(d,b,a){var c=function(){if(!(this instanceof c)){return new c()}this._id=d.getGUID();this._callback=null;this._callbackWS=null;this._attempt=0;this._dataReady=false;this._undo=false;this._ws=false;this._redo=false};c.prototype.begin=function(){};c.prototype.run=function(){};c.prototype.rollback=function(){};c.prototype.cancel=function(){};c.prototype.setUndo=function(e){this._undo=e};c.prototype.getUndo=function(){return this._undo};c.prototype.setRedo=function(e){this._redo=e};c.prototype.getRedo=function(){return this._redo};c.prototype.setCallback=function(e){this._callback=e};c.prototype.setCallbackWS=function(e){this._callbackWS=e};c.prototype.getId=function(){return this._id};c.prototype.process=function(e){this.setCallback(e);if(this.getUndo()===true){this.rollback();return}if(this._callback!==undefined&&this._callback!==null){if("beforeStart" in this._callback){this._callback.beforeStart(this.getId())}}this.begin()};c.prototype.processWS=function(g){this.setCallback(g);this._attempt=0;var e=localStorage.getItem("SMAPROC_TEST_ROLLBACKS");var f=localStorage.getItem("SMAPROC_TEST_RETRY");if(e!==undefined&&e!==null&&Math.random()>0.75){if(f===undefined||f===null){this._attempt=2}this.onFail("Random failure")}else{this.run()}};c.prototype.dataReady=function(e){this._dataReady=true;if(this._callback!==undefined&&this._callback!==null){if("onUpdateUI" in this._callback){this._callback.onUpdateUI(e)}}};c.prototype.onFail=function(e){if(this._dataReady===true&&this._attempt<2){this._attempt++;this.run()}else{if(this._callback!==undefined&&this._callback!==null){if("onFailure" in this._callback){this._callback.onFailure(e)}}if(this._callbackWS!==undefined&&this._callbackWS!==null){if("onFailure" in this._callbackWS){this._callbackWS.onFailure(e)}}}};c.prototype.onSuccess=function(e){this._ws=true;if(this._callback!==undefined&&this._callback!==null){if("onSuccess" in this._callback){this._callback.onSuccess(e)}}if(this._callbackWS!==undefined&&this._callbackWS!==null){if("onSuccess" in this._callbackWS){this._callbackWS.onSuccess(e)}}this.onComplete(this.getId())};c.prototype.onComplete=function(e){if(this._callback!==undefined&&this._callback!==null){if("afterComplete" in this._callback){this._callback.afterComplete(e)}}if(this._callbackWS!==undefined&&this._callbackWS!==null){if("afterComplete" in this._callbackWS){this._callbackWS.afterComplete(e)}}};c.prototype.onRollbackFailed=function(e){if(this._callback!==undefined&&this._callback!==null){if("onRollbackFailed" in this._callback){this._callback.onRollbackFailed(e)}}this.onComplete(e)};c.prototype.onRollbackComplete=function(e){if(this._callback!==undefined&&this._callback!==null){if("onRollbackComplete" in this._callback){this._callback.onRollbackComplete(e)}}this.onComplete(e)};c.prototype.get=function(g,e,f){b.get(g,e,f)};c.prototype.post=function(h,e,f,g){b.post(h,e,f,g)};c.prototype.put=function(h,e,f,g){b.put(h,e,f,g)};c.prototype.getText=function(g,e,f){b.getText(g,e,f)};return c});define("DS/SMAProcWebAsyncUtils/SMAProcWebTransactionManager",["UWA/Core","DS/SMAProcWebAsyncLib/async"],function(e,b){var a=10;var d=localStorage.getItem("SMAPROC_DEBUG");var c={transactions:[],undoStack:[],redoStack:[],WSQUEUE:b.queue(function(i,f){var h=i.item;var j=i.cb;var g=i.that;if(h===undefined||h===null){f("transaction is empty or null");return false}h.processWS({onSuccess:function(k){if("success" in j){j.success(k)}},onFailure:function(k){h.rollback();if("failed" in j){j.failed(k)}},onRollbackComplete:function(l){var k=g.undoStack.indexOf(h);if(k>-1){g.undoStack.splice(k,1)}else{g.redoStack.push(h)}if("rollbackComplete" in j){j.rollbackComplete(l)}},onRollbackFailed:function(l){var k=g.undoStack.indexOf(h);if(k>-1){g.undoStack.splice(k,1)}if("rollbackFailed" in j){j.rollbackFailed(l)}},afterComplete:function(l){if("after" in j){j.after(l)}if(h.getUndo()===true){}else{var k=g.redoStack.indexOf(h);if(k>-1){h.setRedo(false);g.redoStack.splice(k,1)}}f(null)}})},1),UIQUEUE:b.queue(function(i,f){var h=i.item;var j=i.cb;var g=i.that;if(h===undefined||h===null){f("transaction is empty or null");return false}h.process({beforeStart:function(k){if("before" in j){j.before(k)}},onUpdateUI:function(m){if("updateUI" in j){j.updateUI(m)}if(d!==undefined&&d!==null){setTimeout(function(){g.WSQUEUE.push(i)},2000+500*Math.random())}else{g.WSQUEUE.push(i)}if(h.getUndo()===false){g.undoStack.push(h);var k=g.undoStack.length-a;for(var l=0;l<k;l++){g.undoStack.shift()}}f(null)},onFailure:function(k){h.rollback();if("failed" in j){j.failed(k)}},onRollbackComplete:function(l){var k=g.undoStack.indexOf(h);if(k>-1){g.undoStack.splice(k,1)}else{g.redoStack.push(h)}if("rollbackComplete" in j){j.rollbackComplete(l)}},onRollbackFailed:function(l){var k=g.undoStack.indexOf(h);if(k>-1){g.undoStack.splice(k,1)}if("rollbackFailed" in j){j.rollbackFailed(l)}},afterComplete:function(l){if("after" in j){j.after(l)}if(h.getUndo()===true){}else{var k=g.redoStack.indexOf(h);if(k>-1){h.setRedo(false);g.redoStack.splice(k,1)}}f(null)}})},1),start:function(){this.undoStack=[];this.redoStack=[];this.WSQUEUE.kill();this.UIQUEUE.kill()},isRunning:function(){return(this.WSQUEUE.running&&this.WSQUEUE.length>0&&this.UIQUEUE.running&&this.UIQUEUE.length>0)?true:false},add:function(f,g){this.UIQUEUE.push({item:f,cb:g,that:this})},undo:function(g){if(this.undoStack.length>0){var f=this.undoStack.pop();if(f===undefined||f===null){return false}f.setUndo(true);f.setRedo(false);this.add(f,g);return true}else{return false}},redo:function(g){if(this.redoStack.length>0){var f=this.redoStack.pop();if(f===undefined||f===null){return false}f.setUndo(false);f.setRedo(true);this.add(f,g);return true}else{return false}}};return c});define("DS/SMAProcWebAsyncUtils/SequenceFlow/Create",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMSeqFlow","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils"],function(c,d,b,e){var a=function(f,h,g){if(!(this instanceof a)){return new a(f,h,g)}this._parent=f;this._from=h;this._to=g;this._seqFlowJSON=null;this._seqFlow=null;this._seqFlowDeleteJSON=null;this._fromPos=null;this._toPos=null;this._firstChild=null;this._lastChild=null;c.prototype.constructor.call(this)};a.prototype=new c();a.prototype.constructor=a;a.prototype.begin=function(){var r=this._parent,p=this._from,q=this._to;this._fromPos=(p!==undefined&&p!==null)?p.getPosition():null;this._toPos=(q!==undefined&&q!==null)?q.getPosition():null;var k=r.getSeqFlows();var o=r.getFirstChild();var g=r.getLastChild();this._firstChild=o;this._lastChild=g;for(var m=0;m<k.length;m++){var u=k[m];var n=u.getFromFlowItem();var h=u.getToFlowItem();var j=true,f=true;if(n!==undefined&&n!==null&&p!==undefined&&p!==null){if(n.getId()!==p.getId()){j=false}}if(h!==undefined&&h!==null&&q!==undefined&&q!==null){if(h.getId()!==q.getId()){f=false}}if(j===true&&f===true){this.onFail("this connection already exists");return}}var t={Outerflow:[]};if(o!==undefined&&o!==null){t.Outerflow.push({firstChildID:o.getId()})}for(var l=0;l<k.length;l++){var s=k[l];if(s===undefined||s===null){continue}t.Outerflow.push(s._getData())}this._seqFlow=new d({executionMode:"always",fromFlowItemID:p.getId(),toFlowItemID:q.getId()});r.addSeqFlow(this._seqFlow);t.Outerflow.push(this._seqFlow._getData());if(g===null&&r.getFirstChild()===null&&o!==null){g=o}if(g!==null){t.Outerflow.push({executionMode:"always",fromFlowItemID:g.getId()})}this._seqFlowJSON=JSON.parse(JSON.stringify(t));this.dataReady(r)};a.prototype.run=function(){var o=this._parent,l=this._from,m=this._to;var p={sequenceFlows:{value:[{value:JSON.stringify(this._seqFlowJSON)}]},cestamp:{value:[{value:o.getCEStamp()}]}};if(l&&l.isGateway()){var i=m&&m.isGateway()?"":"connect";p.connectionAction={value:[{value:i}]};var g=m.isGateway()?m.getId():m.getPhysicalId();p.childId={value:[{value:g}]}}var n={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:o.getPhysicalId(),dataelements:p}],name:"SMA_Process"},name:"SMA_Process"};var k="updateWidget="+encodeURIComponent(JSON.stringify(n));var h=b.get3DSpaceUrl();var f=h+"/resources/e6w/service/SMA_Process";var j=this;j.post(o.getPhysicalId(),f,k,{onComplete:function(q){o.setCEStamp(q.datarecords.datagroups[0].dataelements.cestamp.value[0].value);if(!(o.isProcess())){e.loadProcess(o.getProcess().getPhysicalId(),{onSuccess:function(r){o.getProcess().setCEStamp(r.getCEStamp());j.onSuccess(o)},onFailure:function(r){logger.log("Failed to create sequenceflow - update process"+r)}})}else{j.onSuccess(o)}},onError:function(q){j.onFail(q)}})};a.prototype.rollback=function(){var k=this;var q=this._parent,o=this._from,p=this._to;if(q===undefined||q===null){k.onRollbackFailed("parent is not defined");return}if(k._seqFlow!==undefined&&k._seqFlow!==null){q.removeSeqFlow(this._seqFlow);if(o!==undefined&&o!==null&&this._fromPos!==null){o.setPosition(this._fromPos)}if(p!==undefined&&p!==null&&this._toPos!==null){p.setPosition(this._toPos)}}if(k._ws===true){var i=q.getSeqFlows();var l=q.getFirstChild();var g=q.getLastChild();var s={Outerflow:[]};if(l!==undefined&&l!==null){s.Outerflow.push({firstChildID:l.getId()})}for(var j=0;j<i.length;j++){var r=i[j];if(r===undefined||r===null){continue}s.Outerflow.push(r._getData())}if(g===null&&q.getFirstChild()===null&&l!==null){g=l}if(g!==null){s.Outerflow.push({executionMode:"always",fromFlowItemID:g.getId()})}var n={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:q.getPhysicalId(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(s)}]},cestamp:{value:[{value:q.getCEStamp()}]}}}],name:"SMA_Process"},name:"SMA_Process"};var m="updateWidget="+encodeURIComponent(JSON.stringify(n));var h=b.get3DSpaceUrl();var f=h+"/resources/e6w/service/SMA_Process";k.post(q.getPhysicalId(),f,m,{onComplete:function(t){q.setCEStamp(t.datarecords.datagroups[0].dataelements.cestamp.value[0].value);k.onRollbackComplete(q)},onError:function(t){k.onRollbackFailed(t)}})}else{k.onRollbackComplete(q)}};a.prototype.cancel=function(){};return a});define("DS/SMAProcWebAsyncUtils/Activity/Create",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMSeqFlow","DS/JSCMM/SMAJSCMMActivity","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/Logger/Logger","module"],function(f,g,d,c,a,e){var b=a.getLogger(e);var h=function(i,k,m,l,j){if(!(this instanceof h)){return new h(i,k,m,l,j)}if(!i){b.warn("constructor is missing parent",this)}if(!k){b.warn("constructor is missing title",this)}if(!m){b.warn("constructor is missing from",this)}if(!l){b.warn("constructor is missing to",this)}this._parent=i;this._title=k;this._from=m;this._to=l;this._connected=j;this._seqFlowJSON=null;this._activity=null;this._seqFlowDeleteJSON=null;this._deletedObjs=[];f.prototype.constructor.call(this)};h.prototype=new f();h.prototype.constructor=h;h.prototype.begin=function(){var i=this._parent,o=this._from,n=this._to,m=this._title,j=this._connected;if(!i){b.error(e.id+".begin: no parent",this);throw new Error("missing parent")}if(this._activity===null){var l=new d({});l.setPosition({showChildren:false});this._activity=l;this._activity.setId("Activity"+this.getId())}this._activity.setName(m);this._activity.setWebServiceRunning(true);var k=(i.isProcess())?i:i.getProcess();this._activity.setProcess(k);this._activity.setParent(i);k.addActivity(this._activity);i.addChild(this._activity);this.createSeqFlows(i,this._activity,o,n,j);this.dataReady(this._activity)};h.prototype.run=function(){var r=this._parent,o=this._from,p=this._to;var k=this._activity;if(!r.isProcess()&&r.getProcess()===null){this.onFail("parent is not defined");return}if(o!==undefined&&o!==null){if(o.getParent()===null){this.onFail("from is not defined");return}}if(p!==undefined&&p!==null){if(p.getParent()===null){this.onFail("from is not defined");return}}var q={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:"SMA_Activity"},name:"SMA_Activity"};var m=q.datarecords.datagroups[0].dataelements;m.parentId={value:[{value:r.getPhysicalId()}]};m.title={value:[{value:k.getName()}]};m.internalId={value:[{value:k.getId()}]};m.parentCEStamp={value:[{value:r.getCEStamp()}]};if(this._seqFlowJSON!==null){m.sequenceFlows={value:[{value:JSON.stringify(this._seqFlowJSON)}]}}var n="updateWidget="+encodeURIComponent(JSON.stringify(q));var j=c.get3DSpaceUrl();var i=j+"/resources/e6w/service/SMA_Activity";var l=this;l.post(r.getPhysicalId(),i,n,{onComplete:function(s){k.setName(null);k.setId(null);k.initialize(s.datarecords.datagroups[0]);k.setWebServiceRunning(false);r.setCEStamp(s.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value);l.onSuccess(k)},onError:function(s){if(k.getWebServiceRunning()===true){l.onFail(s)}}})};h.prototype.rollback=function(){var q=this._parent;var l=this._activity;if(q===undefined||q===null||l===undefined||l===null){this.onRollbackFailed(null);return}var j=(q.isProcess())?q:q.getProcess();var m=this;if(l.getWebServiceRunning()===true){m.deleteActivity();m.onRollbackComplete(m._deletedObjs)}else{m.deleteActivity();var p={datarecords:{datagroups:[{updateAction:"DELETE",objectId:l.getPhysicalId(),dataelements:{cestamp:{value:[{value:l.getCEStamp()}]},parentCEStamp:{value:[{value:(q!==undefined&&q!==null)?q.getCEStamp():j.getCEStamp()}]}}}],name:"SMA_Activity"},name:"SMA_Activity"};var n=p.datarecords.datagroups[0].dataelements;if(this._seqFlowDeleteJSON!==null){n.sequenceFlows={value:[{value:JSON.stringify(this._seqFlowDeleteJSON)}]}}var o="updateWidget="+encodeURIComponent(JSON.stringify(p));var k=c.get3DSpaceUrl();var i=k+"/resources/e6w/service/SMA_Activity";m.post(l.getPhysicalId(),i,o,{onComplete:function(r){if(q!==undefined&&q!==null){q.setCEStamp(r.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value)}else{j.setCEStamp(r.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value)}m.onRollbackComplete(m._deletedObjs)},onError:function(r){m.onRollbackFailed(r)}})}};h.prototype.deleteActivity=function(){var j=this._parent;var l=this._activity;var k=(j.isProcess())?j:j.getProcess();if(j!==undefined&&j!==null&&l.getPosition().connected===true){this.deleteSequenceFlows(j,l)}this.recursiveRemove(l,(j!==undefined&&j!==null)?j:k,k);l.setParent(null);var i=[];i.deletedObject=l;l.fireEvent("ActivityDeleted",i)};h.prototype.cancel=function(){};h.prototype.createSeqFlows=function(u,l,s,t,p){var m=u.getSeqFlows();var r=u.getFirstChild();var k=u.getLastChild();var i=null,x=[];var w={Outerflow:[]};if(p===true){if(s===null){w.Outerflow.push({firstChildID:l.getId()});r=l;if(t!==null){var v=new g({executionMode:"always",fromFlowItemID:l.getId(),toFlowItemID:t.getId()});v.setParent(u);w.Outerflow.push(v._getData());x.push(v)}}else{if(t===null){if(r!==null){w.Outerflow.push({firstChildID:r.getId()})}if(s!==null){var v=new g({executionMode:"always",fromFlowItemID:s.getId(),toFlowItemID:l.getId()});v.setParent(u);w.Outerflow.push(v._getData());x.push(v);k=l}}else{if(r!==null){w.Outerflow.push({firstChildID:r.getId()})}}}}else{if(r!==undefined&&r!==null){w.Outerflow.push({firstChildID:r.getId()})}}for(var n=0;n<m.length;n++){var v=m[n];if(v===undefined||v===null){continue}var q=v.getFromFlowItem();var o=v.getToFlowItem();if(s!==null&&t!==null&&i===null&&p===true&&q.getId()===s.getId()&&o.getId()===t.getId()){i=v;var j=new g({executionMode:"always",fromFlowItemID:s.getId(),toFlowItemID:l.getId()});var y=new g({executionMode:"always",fromFlowItemID:l.getId(),toFlowItemID:t.getId()});w.Outerflow.push(j._getData());w.Outerflow.push(y._getData());j.setParent(u);y.setParent(u);x.push(j);x.push(y)}else{w.Outerflow.push(v._getData())}}if(k===null&&u.getFirstChild()===null&&r!==null&&r.getId()===l.getId()){k=r}if(k!==null){w.Outerflow.push({executionMode:"always",fromFlowItemID:k.getId()})}this._seqFlowJSON=JSON.parse(JSON.stringify(w));if(r!==null){u.setFirstChild(r)}if(k!==null){u.setLastChild(k)}if(i!==null){u.removeSeqFlow(i)}for(var n=0;n<x.length;n++){u.addSeqFlow(x[n])}};h.prototype.recursiveRemove=function(l,j,k){if(l===undefined||l===null){return}var i=(l.isActivity())?l.getChildren():[];while(i.length>0){this.recursiveRemove(i[0],l,k);i=(l.isActivity())?l.getChildren():[]}j.removeChildFlowItem(l);k.removeActivity(l);l.setParent(j);this._deletedObjs.push(l)};h.prototype.deleteSequenceFlows=function(o,v){var r=o.getSeqFlows();var j=o.getFirstChild();var y=o.getLastChild();var u=[],t=[];var p=v.getIncomingFlowItems(),q=v.getOutgoingFlowItems();var w=(p!==undefined&&p.length)?p[0]:null;var k=(q!==undefined&&q.length)?q[0]:null;var l=v.getToSeqFlows(),z=v.getFromSeqFlows();for(var x=0;x<l.length;x++){u.push(l[x])}for(var x=0;x<z.length;x++){u.push(z[x])}var m={Outerflow:[]};if(w===null&&k===null){j=null;y=null}else{if(w===null){if(k!==null){m.Outerflow.push({firstChildID:k.getId()});j=k}}else{if(k===null){if(j!==null){m.Outerflow.push({firstChildID:j.getId()})}if(w!==null){y=w}}else{if(j!==null){m.Outerflow.push({firstChildID:j.getId()})}var s=new g({executionMode:"always",fromFlowItemID:w.getId(),toFlowItemID:k.getId()});m.Outerflow.push(s._getData());t.push(s)}}}for(var n=0;n<r.length;n++){var s=r[n];if(s===undefined||s===null){continue}if(u.indexOf(s)>=0){continue}var A=s.getFromFlowItem();var B=s.getToFlowItem();m.Outerflow.push(s._getData())}if(y===null&&o.getFirstChild()===null&&j!==null){y=j}if(y!==null){m.Outerflow.push({executionMode:"always",fromFlowItemID:y.getId()})}this._seqFlowDeleteJSON=JSON.parse(JSON.stringify(m));o.setFirstChild(j);o.setLastChild(y);for(var n=0;n<t.length;n++){o.addSeqFlow(t[n])}for(var n=0;n<u.length;n++){o.removeSeqFlow(u[n])}};return h});define("DS/SMAProcWebAsyncUtils/Step/Delete",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMUtils"],function(b,a,d){var c=function(e){if(!(this instanceof c)){return new c(e)}this._step=e;this._parent=e.getParent();this._from=null;this._to=null;this._isMain=false;this._webServiceRunning=false;b.prototype.constructor.call(this)};c.prototype=new b();c.prototype.constructor=c;c.prototype.begin=function(){var j=this._parent,i=this._step;if(j===undefined||j===null||i===undefined||i===null){this.onFail("activity/step is not defined");return false}var g=j.getSteps();var f=j.getMainStep();if(f!==undefined&&f!==null&&f!==""){if(f.getId()===i.getId()){this._isMain=true}}var h=g.indexOf(i);if(h>0){this._from=g[h-1]}if(h<(g.length-1)){this._to=g[h+1]}j.removeStep(i);this._webServiceRunning=true;var e=[];e.deletedObject=i;i.fireEvent("StepDeleted",e);this.dataReady(i)};c.prototype.run=function(){var i=this;var k=this._parent,h=this._step;if(k===undefined||k===null||h===undefined||h===null){this.onFail("activity/step is not defined");return false}var j={datarecords:{datagroups:[{updateAction:"DELETE",objectId:k.getPhysicalId(),dataelements:{deleteStepId:{value:[{value:h.getId()}]},cestamp:{value:[{value:k.getCEStamp()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var e="updateWidget="+encodeURIComponent(JSON.stringify(j));var g=a.get3DSpaceUrl();var f=g+"/resources/e6w/service/SMA_Step";i.post(k.getPhysicalId(),f,e,{onComplete:function(l){k.setCEStamp(l.datarecords.datagroups[0].dataelements.cestamp.value[0].value);i._webServiceRunning=false;i.onSuccess(k)},onError:function(l){i._webServiceRunning=false;i.onFail(l)}})};c.prototype.rollback=function(){var j=this._parent,r=this._from,s=this._to,n=this._extType,p=this._title;var h=this._step;if(j===undefined||j===null||h===undefined||h===null){this.onRollbackFailed("activity/step is not defined");return false}var m=this;if(m._ws===false){var f=null,k="add",l=null;if(r!==null){f=r.getId();l=r;k="addBelow"}else{if(s!==null){f=s.getId();l=s;k="addAbove"}}h.setParent(j);j.addStep(h,l,k);if(m._isMain===true){j.setMainStep(h)}m.onRollbackComplete(h)}else{var f=null,k="add",l=null;if(r!==null){f=r.getId();l=r;k="addBelow"}else{if(s!==null){f=s.getId();l=s;k="addAbove"}}var q={datarecords:{datagroups:[{updateAction:"CREATE",objectId:j.getPhysicalId(),dataelements:{stepName:{value:[{value:h.getName()}]},extensionName:{value:[{value:h.getExtensionName()}]},createAction:{value:[{value:k}]},cestamp:{value:[{value:j.getCEStamp()}]},StepId:{value:[{value:h.getId()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var i=q.datarecords.datagroups[0].dataelements;if(f!==null){i.refStepId={value:[{value:f}]}}var o="updateWidget="+encodeURIComponent(JSON.stringify(q));var g=a.get3DSpaceUrl();var e=g+"/resources/e6w/service/SMA_Step";h.setWebServiceRunning(true);m.post(j.getPhysicalId(),e,o,{onComplete:function(u){j.setCEStamp(u.datarecords.datagroups[0].dataelements.cestamp.value[0].value);var t={FlowItem:d.getJSON(u.datarecords.datagroups[0].dataelements.StepFlowItem.value[0].value)};h.initialize(t);h.setWebServiceRunning(false);h.setParent(j);j.addStep(h,l,k);if(m._isMain===true){j.setMainStep(h)}m.onRollbackComplete(h)},onError:function(t){m.onRollbackFailed(t)}})}};c.prototype.cancel=function(){};return c});define("DS/SMAProcWebAsyncUtils/Activity/Connect",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMSeqFlow","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils"],function(c,d,b,e){var a=function(g,f,i,h){if(!(this instanceof a)){return new a(g,f,i,h)}this._parent=f;this._from=i;this._to=h;this._connected=true;this._seqFlowJSON=null;this._activity=g;this._seqFlowDeleteJSON=null;this._fromPos=null;this._toPos=null;this._actPos=null;this._seqFlowToDelete=null;this._seqFlowsToAdd=[];this._firstChild=null;this._lastChild=null;this._oldParent=null;c.prototype.constructor.call(this)};a.prototype=new c();a.prototype.constructor=a;a.prototype.begin=function(){var f=this._parent,k=this._from,j=this._to,i=this._activity,g=this._connected;this._fromPos=(k!==undefined&&k!==null)?JSON.parse(JSON.stringify(k.getPosition())):null;this._toPos=(j!==undefined&&j!==null)?JSON.parse(JSON.stringify(j.getPosition())):null;this._actPos=JSON.parse(JSON.stringify(i.getPosition()));i.setWebServiceRunning(true);var h=(f.isProcess())?f:f.getProcess();this._oldParent=i.getParent();if(this._oldParent!==null){this._oldParent.removeChildFlowItem(i)}i.setParent(f);f.addChild(i);this.createSeqFlows(f,this._activity,k,j,g);this.dataReady(this._activity)};a.prototype.run=function(){var q=this._parent,n=this._from,o=this._to,j=this._connected;var h=this._activity;if(!q.isProcess()&&q.getProcess()===null){this.onFail("parent is not defined");return}if(n!==undefined&&n!==null){if(n.getParent()===null){this.onFail("from is not defined");return}}if(o!==undefined&&o!==null){if(o.getParent()===null){this.onFail("to is not defined");return}}var k=this._seqFlowJSON.Outerflow.filter(function(r){if((r.fromFlowItemID==="")&&(r.toFlowItemID==="")){return false}return true});this._seqFlowJSON.Outerflow=k;var i=q.getSeqFlows();i.forEach(function(r){if(!(r.getFromFlowItem())&&!(r.getToFlowItem())){q.removeSeqFlow(r)}});(this._seqFlowJSON.Outerflow||[]).forEach(function(r){if(r){if(r.toFlowItemID===""){delete r.toFlowItemID}}});var p={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:q.getPhysicalId(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(this._seqFlowJSON)}]},cestamp:{value:[{value:q.getCEStamp()}]},connectionAction:{value:[{value:"connect"}]},childId:{value:[{value:h.getPhysicalId()}]}}}],name:"SMA_Process"},name:"SMA_Process"};var m="updateWidget="+encodeURIComponent(JSON.stringify(p));var g=b.get3DSpaceUrl();var f=g+"/resources/e6w/service/SMA_Process";var l=this;l.post(q.getPhysicalId(),f,m,{onComplete:function(r){q.setCEStamp(r.datarecords.datagroups[0].dataelements.cestamp.value[0].value);if(!(q.isProcess())){e.loadProcess(q.getProcess().getPhysicalId(),{onSuccess:function(s){h.setWebServiceRunning(false);q.getProcess().setCEStamp(s.getCEStamp());l.onSuccess(h);console.log("Process refreshed"+s)},onFailure:function(s){logger.log("Failed to Disconnect"+s)}})}else{h.setWebServiceRunning(false);l.onSuccess(h)}},onError:function(r){if(h.getWebServiceRunning()===true){l.onFail(r)}}})};a.prototype.rollback=function(){var q=this._parent,o=this._from,p=this._to,m=this._title,j=this._connected;var i=this._activity;if(q===undefined||q===null||i===undefined||i===null){this.onRollbackFailed(null);return}var g=(q.isProcess())?q:q.getProcess();var k=this;if(i.getWebServiceRunning()===true){k.rollbackSequenceFlows();k.onRollbackComplete(k._activity)}else{k.rollbackSequenceFlows();var n={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:q.getPhysicalId(),dataelements:{cestamp:{value:[{value:q.getCEStamp()}]},sequenceFlows:{value:[{value:JSON.stringify(this._seqFlowDeleteJSON)}]}}}],name:"SMA_Process"},name:"SMA_Process"};var l="updateWidget="+encodeURIComponent(JSON.stringify(n));var h=b.get3DSpaceUrl();var f=h+"/resources/e6w/service/SMA_Process";k.post(i.getPhysicalId(),f,l,{onComplete:function(r){if(q!==undefined&&q!==null){q.setCEStamp(r.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}else{g.setCEStamp(r.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}k.onRollbackComplete(k._activity)},onError:function(r){k.onRollbackFailed(r)}})}};a.prototype.rollbackSequenceFlows=function(){var o=this._parent,m=this._from,n=this._to,k=this._connected;var h=this._activity;var g=(o.isProcess())?o:o.getProcess();if(this._fromPos!==null&&m!==null){m.setPosition(this._fromPos)}if(this._toPos!==null&&n!==null){n.setPosition(this._toPos)}if(this._actPos!==null&&h!==null){h.setPosition(this._actPos)}if(o!==undefined&&o!==null){o.removeChildFlowItem(h)}if(this._oldParent!==null){h.setParent(this._oldParent);this._oldParent.addChild(h)}if(o!==undefined&&o!==null){o.setFirstChild(this._firstChild);o.setLastChild(this._lastChild);if(this._seqFlowToDelete!==null){o.addSeqFlow(this._seqFlowToDelete)}for(var j=0;this._seqFlowsToAdd!==null&&j<this._seqFlowsToAdd.length;j++){o.removeSeqFlow(this._seqFlowsToAdd[j])}var i=o.getSeqFlows();var l=o.getFirstChild();var f=o.getLastChild();var q={Outerflow:[]};if(l!==null){q.Outerflow.push({firstChildID:l.getId()})}for(var j=0;j<i.length;j++){var p=i[j];if(p===undefined||p===null){continue}q.Outerflow.push(p._getData())}if(f!==null){q.Outerflow.push({executionMode:"always",fromFlowItemID:f.getId()})}this._seqFlowDeleteJSON=JSON.parse(JSON.stringify(q))}};a.prototype.cancel=function(){};a.prototype.createSeqFlows=function(r,i,p,q,m){var j=r.getSeqFlows();var o=r.getFirstChild();var h=r.getLastChild();var f=null,u=[];this._firstChild=o;this._lastChild=h;var t={Outerflow:[]};if(m===true){if(p===null){t.Outerflow.push({firstChildID:i.getId()});o=i;if(q!==null){var s=new d({executionMode:"always",fromFlowItemID:i.getId(),toFlowItemID:q.getId()});s.setParent(r);t.Outerflow.push(s._getData());u.push(s)}}else{if(q===null){if(o!==null){t.Outerflow.push({firstChildID:o.getId()})}if(p!==null){var s=new d({executionMode:"always",fromFlowItemID:p.getId(),toFlowItemID:i.getId()});s.setParent(r);t.Outerflow.push(s._getData());u.push(s);h=i}}else{if(o!==null){t.Outerflow.push({firstChildID:o.getId()})}}}}else{if(o!==undefined&&o!==null){t.Outerflow.push({firstChildID:o.getId()})}}for(var k=0;k<j.length;k++){var s=j[k];if(s===undefined||s===null){continue}var n=s.getFromFlowItem();var l=s.getToFlowItem();if(p!==null&&q!==null&&f===null&&n.getId()===p.getId()&&l.getId()===q.getId()&&m===true){f=s;var g=new d({executionMode:"always",fromFlowItemID:p.getId(),toFlowItemID:i.getId()});var v=new d({executionMode:"always",fromFlowItemID:i.getId(),toFlowItemID:q.getId()});t.Outerflow.push(g._getData());t.Outerflow.push(v._getData());g.setParent(r);v.setParent(r);u.push(g);u.push(v)}else{if(!(s.getToFlowItem())){f=s}else{t.Outerflow.push(s._getData())}}}if(h===null&&r.getFirstChild()===null&&o!==null&&o.getId()===i.getId()){h=o}if(h!==null){t.Outerflow.push({executionMode:"always",fromFlowItemID:h.getId(),toFlowItemID:""})}this._seqFlowJSON=JSON.parse(JSON.stringify(t));if(o!==null){r.setFirstChild(o)}if(h!==null){r.setLastChild(h)}if(f!==null){r.removeSeqFlow(f)}for(var k=0;k<u.length;k++){r.addSeqFlow(u[k])}this._seqFlowToDelete=f;this._seqFlowsToAdd=u};return a});define("DS/SMAProcWebAsyncUtils/Step/MainStep",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMUtils"],function(c,b){var a=function(d){if(!(this instanceof a)){return new a(d)}this._activity=d.getParent();this._step=d;this._oldMain=null;c.prototype.constructor.call(this)};a.prototype=new c();a.prototype.constructor=a;a.prototype.begin=function(){var e=this._activity,d=this._step;if(this._oldMain===null){this._oldMain=e.getMainStep()}e.setMainStep(d);d.setWebServiceRunning(true);this.dataReady(d)};a.prototype.run=function(){var h=this._step;var j=this._activity;var i={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:j.getPhysicalId(),dataelements:{cestamp:{value:[{value:j.getCEStamp()}]},StepId:{value:[{value:h.getId()}]},mainStepId:{value:[{value:h.getId()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var d="updateWidget="+encodeURIComponent(JSON.stringify(i));var g=b.get3DSpaceUrl();var e=g+"/resources/e6w/service/SMA_Step";var f=this;f.post(j.getPhysicalId(),e,d,{onComplete:function(k){j.setCEStamp(k.datarecords.datagroups[0].dataelements.cestamp.value[0].value);h.setWebServiceRunning(false);f.onSuccess(h)},onError:function(k){h.setWebServiceRunning(false);f.onFail(k)}})};a.prototype.rollback=function(){var e=this._step,f=this._activity;if(f===undefined||f===null){this.onRollbackFailed("empty or null activity");return}var d=this;if(e!==undefined&&e!==null){f.setMainStep(this._oldMain);if(e.getWebServiceRunning()===false){e.setWebServiceRunning(true);d.rollbackMainStep(e,f,{onSuccess:function(g){e.setWebServiceRunning(false);d.onRollbackComplete(e)},onFail:function(g){d.onRollbackFailed(g)}})}else{d.onRollbackComplete(e)}}};a.prototype.cancel=function(){};a.prototype.rollbackMainStep=function(h,j,k){var h=this._step;var j=this._activity;var i={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:j.getPhysicalId(),dataelements:{cestamp:{value:[{value:j.getCEStamp()}]},StepId:{value:[{value:h.getId()}]},mainStepId:{value:[{value:(this._oldMain!==null)?this._oldMain.getId():" "}]}}}],name:"SMA_Step"},name:"SMA_Step"};var d="updateWidget="+encodeURIComponent(JSON.stringify(i));var g=b.get3DSpaceUrl();var e=g+"/resources/e6w/service/SMA_Step";var f=this;f.post(j.getPhysicalId(),e,d,{onComplete:function(l){j.setCEStamp(l.datarecords.datagroups[0].dataelements.cestamp.value[0].value);k.onSuccess(j)},onError:function(l){k.onFail(l)}})};return a});define("DS/SMAProcWebAsyncUtils/Gateway/Create",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMGateway","DS/JSCMM/SMAJSCMMSeqFlow","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/Logger/Logger","module"],function(g,e,h,d,a,f){var c=a.getLogger(f);var b=function(i,k,m,l,j){if(!(this instanceof b)){return new b(i,k,m,l,j)}if(!i){c.warn("constructor is missing parent",this)}if(!k){c.warn("constructor is missing title",this)}if(!m){c.warn("constructor is missing from",this)}if(!l){c.warn("constructor is missing to",this)}this._parent=i;this._title=k;this._from=m;this._to=l;this._connected=j;this._seqFlowJSON=null;this._gateway=null;this._seqFlowDeleteJSON=null;g.prototype.constructor.call(this)};b.prototype=new g();b.prototype.constructor=b;b.prototype.begin=function(){var p=this._parent,n=this._from,o=this._to,m=this._title,j=this._connected;if(!p){c.error(f.id+".begin: no parent",this);throw new Error("missing parent")}if(this._gateway===null){var k={};k.id="Gateway"+this.getId();k.name=m;var q=new e(k);this._gateway=q}this._gateway.setWebServiceRunning(true);var i=(p.isProcess())?p:p.getProcess();var l={connected:this._connected};this._gateway.setPosition(l);this._gateway.setProcess(i);this._gateway.setParent(p);i.addActivity(this._gateway);p.addChild(this._gateway);this.createSeqFlows(p,this._gateway,n,o,j);this.dataReady(q)};b.prototype.run=function(){var v=this._parent,t=this._from,u=this._to,r=this._title,m=this._connected;var w=this._gateway;var j=(v.isProcess())?v:v.getProcess();var n=(v!==undefined&&v!==null)?v.getPhysicalId():j.getPhysicalId();var l=(v!==undefined&&v!==null)?v.getCEStamp():j.getCEStamp();var s={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:"SMA_Gateway"},name:"SMA_Gateway"};var p=s.datarecords.datagroups[0].dataelements;p.parentId={value:[{value:n}]};p.cestamp={value:[{value:l}]};p.title={value:[{value:w.getName()}]};p.id={value:[{value:w.getId()}]};if(this._seqFlowJSON!==null){p.sequenceFlows={value:[{value:JSON.stringify(this._seqFlowJSON)}]}}var q="updateWidget="+encodeURIComponent(JSON.stringify(s));var k=d.get3DSpaceUrl();var i=k+"/resources/e6w/service/SMA_Gateway";var o=this;o.post(n,i,q,{onComplete:function(x){w.setWebServiceRunning(false);if(v!==undefined&&v!==null){v.setCEStamp(x.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}else{j.setCEStamp(x.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}o.onSuccess(w)},onError:function(x){o.onFail(x)}})};b.prototype.rollback=function(){var v=this._parent,t=this._from,u=this._to,r=this._title,m=this._connected;var w=this._gateway;if(v===undefined||v===null||w===undefined||w===null){this.onRollbackFailed(null);return}var j=(v.isProcess())?v:v.getProcess();var n=(v!==undefined&&v!==null)?v.getPhysicalId():j.getPhysicalId();var l=(v!==undefined&&v!==null)?v.getCEStamp():j.getCEStamp();var o=this;if(w.getWebServiceRunning()===true){o.deleteGateway();o.onRollbackComplete(o._gateway)}else{o.deleteGateway();var s={datarecords:{datagroups:[{updateAction:"DELETE",dataelements:{parentId:{value:[{value:n}]},cestamp:{value:[{value:l}]},id:{value:[{value:w.getId()}]}}}],name:"SMA_Gateway"},name:"SMA_Gateway"};var p=s.datarecords.datagroups[0].dataelements;if(this._seqFlowDeleteJSON!==null){p.sequenceFlows={value:[{value:JSON.stringify(this._seqFlowDeleteJSON)}]}}var q="updateWidget="+encodeURIComponent(JSON.stringify(s));var k=d.get3DSpaceUrl();var i=k+"/resources/e6w/service/SMA_Gateway";o.post(n,i,q,{onComplete:function(x){if(v!==undefined&&v!==null){v.setCEStamp(x.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}else{j.setCEStamp(x.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}o.onRollbackComplete(o._gateway)},onError:function(x){o.onRollbackFailed(x)}})}};b.prototype.deleteGateway=function(){var j=this._parent,p=this._from,o=this._to,n=this._title,k=this._connected;var m=this._gateway;var l=(j.isProcess())?j:j.getProcess();if(j!==undefined&&j!==null&&m.getPosition().connected===true){this.deleteSequenceFlows(j,m)}if(j!==undefined&&j!==null){j.removeChildFlowItem(m)}l.removeActivity(m);var i=[];i.deletedObject=m;m.fireEvent("ActivityDeleted",i)};b.prototype.cancel=function(){};b.prototype.createSeqFlows=function(u,l,s,t,p){var m=u.getSeqFlows();var r=u.getFirstChild();var k=u.getLastChild();var i=null,x=[];var w={Outerflow:[]};if(p===true){if(s===null){w.Outerflow.push({firstChildID:l.getId()});r=l;if(t!==null){var v=new h({executionMode:"always",fromFlowItemID:l.getId(),toFlowItemID:t.getId()});v.setParent(u);w.Outerflow.push(v._getData());x.push(v)}}else{if(t===null){if(r!==null){w.Outerflow.push({firstChildID:r.getId()})}if(s!==null){var v=new h({executionMode:"always",fromFlowItemID:s.getId(),toFlowItemID:l.getId()});v.setParent(u);w.Outerflow.push(v._getData());x.push(v);k=l}}else{if(r!==null){w.Outerflow.push({firstChildID:r.getId()})}}}}else{if(r!==undefined&&r!==null){w.Outerflow.push({firstChildID:r.getId()})}}for(var n=0;n<m.length;n++){var v=m[n];if(v===undefined||v===null){continue}var q=v.getFromFlowItem();var o=v.getToFlowItem();if(s!==null&&t!==null&&i===null&&q.getId()===s.getId()&&o.getId()===t.getId()&&p===true){i=v;var j=new h({executionMode:"always",fromFlowItemID:s.getId(),toFlowItemID:l.getId()});var y=new h({executionMode:"always",fromFlowItemID:l.getId(),toFlowItemID:t.getId()});w.Outerflow.push(j._getData());w.Outerflow.push(y._getData());j.setParent(u);y.setParent(u);x.push(j);x.push(y)}else{w.Outerflow.push(v._getData())}}if(k===null&&u.getFirstChild()===null&&r!==null&&r.getId()===l.getId()){k=r}if(k!==null){w.Outerflow.push({executionMode:"always",fromFlowItemID:k.getId()})}this._seqFlowJSON=JSON.parse(JSON.stringify(w));if(r!==null){u.setFirstChild(r)}if(k!==null){u.setLastChild(k)}if(i!==null){u.removeSeqFlow(i)}for(var n=0;n<x.length;n++){u.addSeqFlow(x[n])}};b.prototype.deleteSequenceFlows=function(o,v){var r=o.getSeqFlows();var j=o.getFirstChild();var y=o.getLastChild();var u=[],t=[];var p=v.getIncomingFlowItems(),q=v.getOutgoingFlowItems();var w=(p!==undefined&&p.length)?p[0]:null;var k=(q!==undefined&&q.length)?q[0]:null;var l=v.getToSeqFlows(),z=v.getFromSeqFlows();for(var x=0;x<l.length;x++){u.push(l[x])}for(var x=0;x<z.length;x++){u.push(z[x])}var m={Outerflow:[]};if(w===null&&k===null){j=null;y=null}else{if(w===null){if(k!==null){m.Outerflow.push({firstChildID:k.getId()});j=k}}else{if(k===null){if(j!==null){m.Outerflow.push({firstChildID:j.getId()})}if(w!==null){y=w}}else{if(j!==null){m.Outerflow.push({firstChildID:j.getId()})}var s=new h({executionMode:"always",fromFlowItemID:w.getId(),toFlowItemID:k.getId()});m.Outerflow.push(s._getData());t.push(s)}}}for(var n=0;n<r.length;n++){var s=r[n];if(s===undefined||s===null){continue}if(u.indexOf(s)>=0){continue}var A=s.getFromFlowItem();var B=s.getToFlowItem();m.Outerflow.push(s._getData())}if(y===null&&o.getFirstChild()===null&&j!==null){y=j}if(y!==null){m.Outerflow.push({executionMode:"always",fromFlowItemID:y.getId()})}this._seqFlowDeleteJSON=JSON.parse(JSON.stringify(m));o.setFirstChild(j);o.setLastChild(y);for(var n=0;n<t.length;n++){o.addSeqFlow(t[n])}for(var n=0;n<u.length;n++){o.removeSeqFlow(u[n])}};return b});define("DS/SMAProcWebAsyncUtils/Step/Create",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMStep","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMUtils"],function(d,c,a,f){var e=1;var b=function(h,k,j,i,g){if(!(this instanceof b)){return new b()}this._title=i;this._from=k;this._to=j;this._extType=g;this._activity=h;this._step=null;d.prototype.constructor.call(this)};b.prototype=new d();b.prototype.constructor=b;b.prototype.begin=function(){var j=this._activity,s=this._from,t=this._to,o=this._extType,r=this._title;var g=null,k="add",n=null;if(s!==null){g=s.getId();n=s;k="addBelow"}else{if(t!==null){g=t.getId();n=t;k="addAbove"}}var q=j.getSteps();var m="FunctionStep";if(o==="com.dassault_systemes.sma.adapter.Doe"||o==="com.dassault_systemes.sma.adapter.Loop"||o==="com.dassault_systemes.sma.adapter.Optimization"||o==="com.dassault_systemes.sma.adapter.MonteCarlo"){m="ProcessStep"}var l=m+this.getId();var p=(m==="ProcessStep")?"processStepType":"functionStepType";if(this._step===null){var i={id:l,extensionName:o,name:r,type:p};var h=new c(i);this._step=h}this._step.setParent(j);if(q.length===0){j.setMainStep(this._step)}j.addStep(this._step,n,k);this._step.setWebServiceRunning(true);this.dataReady(j)};b.prototype.run=function(){var k=this._step;var n=this._activity,v=this._from,w=this._to,r=this._extType,t=this._title;var i=null,o="add",p=null,m=null;if(v!==null&&v.getParent()!==null){i=v.getId();p=v;o="addBelow"}else{if(w!==null&&w.getParent()!==null){i=w.getId();p=w;o="addAbove"}else{if(v!==null||w!==null){this.onFail("failed to create step");return}}}var h=n.getMainStep();var u={datarecords:{datagroups:[{updateAction:"CREATE",objectId:n.getPhysicalId(),dataelements:{stepName:{value:[{value:t}]},extensionName:{value:[{value:r}]},createAction:{value:[{value:o}]},cestamp:{value:[{value:n.getCEStamp()}]},StepId:{value:[{value:k.getId()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var l=u.datarecords.datagroups[0].dataelements;if(i!==null){l.refStepId={value:[{value:i}]}}if(h!==undefined&&h!==null&&h!==""){l.mainStepId={value:[{value:h.getId()}]}}var s="updateWidget="+encodeURIComponent(JSON.stringify(u));var j=a.get3DSpaceUrl();var g=j+"/resources/e6w/service/SMA_Step";var q=this;q.post(n.getPhysicalId(),g,s,{onComplete:function(y){n.setCEStamp(y.datarecords.datagroups[0].dataelements.cestamp.value[0].value);var x={FlowItem:f.getJSON(y.datarecords.datagroups[0].dataelements.StepFlowItem.value[0].value)};k.initialize(x);k.setWebServiceRunning(false);q.onSuccess(k)},onError:function(x){q.onFail(x)}})};b.prototype.rollback=function(){var i=this._step,j=this._activity;if(j===undefined||j===null){this.onRollbackFailed("empty or null activity");return}var h=this;if(i!==undefined&&i!==null){if(i.getWebServiceRunning()===true){j.removeStep(i);i.setParent(null);var g=[];g.deletedObject=i;i.fireEvent("StepDeleted",g);h.onRollbackComplete(i)}else{h.deleteStep(i,j,{onSuccess:function(l){l.removeStep(i);i.setParent(null);var k=[];k.deletedObject=i;i.fireEvent("StepDeleted",k);h.onRollbackComplete(i)},onFail:function(k){h.onRollbackFailed(k)}})}}};b.prototype.cancel=function(){};b.prototype.deleteStep=function(k,m,n){var l={datarecords:{datagroups:[{updateAction:"DELETE",objectId:m.getPhysicalId(),dataelements:{deleteStepId:{value:[{value:k.getId()}]},cestamp:{value:[{value:m.getCEStamp()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var g="updateWidget="+encodeURIComponent(JSON.stringify(l));var j=a.get3DSpaceUrl();var h=j+"/resources/e6w/service/SMA_Step";var i=this;i.post(m.getPhysicalId(),h,g,{onComplete:function(o){m.setCEStamp(o.datarecords.datagroups[0].dataelements.cestamp.value[0].value);n.onSuccess(m)},onError:function(o){n.onFail(o)}})};return b});define("DS/SMAProcWebAsyncUtils/SequenceFlow/Delete",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils"],function(b,a){var c=function(d,f,e){if(!(this instanceof c)){return new c(d,f,e)}this._parent=d;this._from=f;this._to=e;this._seqFlowJSON=null;this._seqFlow=null;b.prototype.constructor.call(this)};c.prototype=new b();c.prototype.constructor=c;c.prototype.begin=function(){var n=this._parent,l=this._from,m=this._to;var h=n.getSeqFlows();var k=n.getFirstChild();var e=n.getLastChild();var o={Outerflow:[]};if(l===null&&m===null){k=null;e=null}else{if(l===null){k=null;o.Outerflow.push({firstChildID:null})}else{if(m===null){e=null}else{if(k!==null){o.Outerflow.push({firstChildID:k.getId()})}}}}for(var i=0;i<h.length;i++){var p=h[i];if(p===undefined||p===null){continue}var j=p.getFromFlowItem();var f=p.getToFlowItem();var g=true,d=true;if(j!==undefined&&j!==null&&l!==undefined&&l!==null){if(j.getId()!==l.getId()){g=false}}if(f!==undefined&&f!==null&&m!==undefined&&m!==null){if(f.getId()!==m.getId()){d=false}}if(g===true&&d===true){this._seqFlow=p;continue}o.Outerflow.push(p._getData())}if(e===null&&n.getFirstChild()===null&&k!==null){e=k}if(e!==null){o.Outerflow.push({executionMode:"always",fromFlowItemID:e.getId()})}this._seqFlowJSON=JSON.parse(JSON.stringify(o));n.setFirstChild(k);n.setLastChild(e);if(this._seqFlow!==undefined&&this._seqFlow!==null){n.removeSeqFlow(this._seqFlow)}this.dataReady(n)};c.prototype.run=function(){var f=this._parent,k=this._from,j=this._to;var i={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:f.getoid(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(this._seqFlowJSON)}]},cestamp:{value:[{value:f.getCEStamp()}]}}}],name:"SMA_Process"},name:"SMA_Process"};var d="updateWidget="+encodeURIComponent(JSON.stringify(i));var h=a.get3DSpaceUrl();var e=h+"/resources/e6w/service/SMA_Process";var g=this;g.post(f.getPhysicalId(),e,d,{onComplete:function(l){f.setCEStamp(l.datarecords.datagroups[0].dataelements.cestamp.value[0].value);g.onSuccess(f)},onError:function(l){g.onFail(l)}})};c.prototype.rollback=function(){this.onRollbackFailed(null)};c.prototype.cancel=function(){};return c});define("DS/SMAProcWebAsyncUtils/Activity/Delete",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMSeqFlow","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils"],function(c,d,b){var a=function(e){if(!(this instanceof a)){return new a(e)}this._parent=e.getParent();this._process=e.getProcess();this._seqFlowJSON=null;this._activity=e;this._deletedObjs=[];this._seqFlowsToDelete=[];this._seqFlowsToAdd=[];this._firstChild=null;this._lastChild=null;c.prototype.constructor.call(this)};a.prototype=new c();a.prototype.constructor=a;a.prototype.begin=function(){var h=this._activity,f=this._parent,g=this._process;if(h===undefined||h===null){this.onFail("activity is not defined");return false}if(g===undefined||g===null){this.onFail("activity is not part of process");return false}if(f!==undefined&&f!==null&&h.getPosition().connected===true){this.deleteSequenceFlows(f,h)}this.recursiveRemove(h,(f!==undefined&&f!==null)?f:g,g);h.setParent(null);var e=[];e.deletedObject=h;h.fireEvent("ActivityDeleted",e);this.dataReady(this._deletedObjs)};a.prototype.run=function(){var i=this;var h=this._activity,m=this._parent,f=this._process;if(h===undefined||h===null){this.onFail("activity is not defined");return false}if(f===undefined||f===null){this.onFail("activity is not part of process");return false}var l={datarecords:{datagroups:[{updateAction:"DELETE",objectId:h.getPhysicalId(),dataelements:{cestamp:{value:[{value:h.getCEStamp()}]},parentCEStamp:{value:[{value:(m!==undefined&&m!==null)?m.getCEStamp():f.getCEStamp()}]}}}],name:"SMA_Activity"},name:"SMA_Activity"};var j=l.datarecords.datagroups[0].dataelements;if(this._seqFlowJSON!==null){j.sequenceFlows={value:[{value:JSON.stringify(this._seqFlowJSON)}]}}var k="updateWidget="+encodeURIComponent(JSON.stringify(l));var g=b.get3DSpaceUrl();var e=g+"/resources/e6w/service/SMA_Activity";i.post(h.getPhysicalId(),e,k,{onComplete:function(n){if(m!==undefined&&m!==null){m.setCEStamp(n.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value)}else{f.setCEStamp(n.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value)}i.onSuccess((m!==undefined&&m!==null)?m:f)},onError:function(n){i.onFail(n)}})};a.prototype.rollback=function(){var k=this;var f=this._activity,n=this._parent,r=this._process;if(f===undefined||f===null){k.onRollbackFailed("activity is not defined");return false}if(r===undefined||r===null){k.onRollbackFailed("activity is not part of process");return false}for(var u=0;u<k._deletedObjs.length;u++){var w=k._deletedObjs[u];r.addActivity(w);var x=w.getParent();if(x!==undefined&&x!==null){x.addChild(w)}else{if(n!==undefined&&n!==null&&w.getId()===f.getId()){n.addChild(w)}}}if(n!==undefined&&n!==null&&f.getPosition().connected===true){if(k._firstChild){n.setFirstChild(k._firstChild)}for(var u=0;u<k._seqFlowsToAdd.length;u++){n.removeSeqFlow(k._seqFlowsToAdd[u])}for(var u=0;u<k._seqFlowsToDelete.length;u++){n.addSeqFlow(k._seqFlowsToDelete[u])}if(k._lastChild){n.setLastChild(k._lastChild)}}if(k._ws===false){k.onRollbackComplete(f)}else{var l=null;if(n!==undefined&&n!==null&&f.getPosition().connected===true){var o=n.getSeqFlows();var e=n.getFirstChild();var v=n.getLastChild();l={Outerflow:[]};if(e!==null){l.Outerflow.push({firstChildID:e.getId()})}for(var m=0;m<o.length;m++){var q=o[m];if(q===undefined||q===null){continue}l.Outerflow.push(q._getData())}if(v!==null){l.Outerflow.push({executionMode:"always",fromFlowItemID:v.getId()})}}var s={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:"SMA_Activity"},name:"SMA_Activity"};var p=s.datarecords.datagroups[0].dataelements;var t=(n!==undefined&&n!==null)?n.getPhysicalId():r.getPhysicalId();p.parentId={value:[{value:t}]};p.title={value:[{value:f.getName()}]};p.internalId={value:[{value:f.getId()}]};p.parentCEStamp={value:[{value:(n!==undefined&&n!==null)?n.getCEStamp():r.getCEStamp()}]};if(l!==null){p.sequenceFlows={value:[{value:JSON.stringify(l)}]}}var g="updateWidget="+encodeURIComponent(JSON.stringify(s));var j=b.get3DSpaceUrl();var h=j+"/resources/e6w/service/SMA_Activity";f.setWebServiceRunning(true);var k=this;k.post(t,h,g,{onComplete:function(i){f.setName(null);f.setId(null);f.initialize(i.datarecords.datagroups[0]);f.setWebServiceRunning(false);if(n!==undefined&&n!==null){n.setCEStamp(i.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value)}else{r.setCEStamp(i.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value)}k.onRollbackComplete(f)},onError:function(i){if(f.getWebServiceRunning()===true){k.onRollbackFailed(i)}}})}};a.prototype.cancel=function(){};a.prototype.recursiveRemove=function(h,f,g){if(h===undefined||h===null){return}var e=(h.isActivity())?h.getChildren():[];while(e.length>0){this.recursiveRemove(e[0],h,g);e=(h.isActivity())?h.getChildren():[]}f.removeChildFlowItem(h);g.removeActivity(h);h.setParent(f);this._deletedObjs.push(h)};a.prototype.deleteSequenceFlows=function(l,s){var o=l.getSeqFlows();var e=l.getFirstChild();var v=l.getLastChild();var r=[],q=[];this._firstChild=e;this._lastChild=v;var m=s.getIncomingFlowItems(),n=s.getOutgoingFlowItems();var t=(m!==undefined&&m.length)?m[0]:null;var f=(n!==undefined&&n.length)?n[0]:null;var g=s.getToSeqFlows(),x=s.getFromSeqFlows();for(var u=0;u<g.length;u++){r.push(g[u])}for(var u=0;u<x.length;u++){r.push(x[u])}var k={Outerflow:[]};if(t===null&&f===null){e=null;v=null}else{if(t===null){if(f!==null){k.Outerflow.push({firstChildID:f.getId()});e=f}}else{if(f===null){if(e!==null){k.Outerflow.push({firstChildID:e.getId()})}if(t!==null&&v===this._activity){v=t}}else{if(e!==null){k.Outerflow.push({firstChildID:e.getId()})}var h=t.getOutgoingFlowItems();var w=f.getIncomingFlowItems();if(h.length<=1||w.length<=1){var p=new d({executionMode:"always",fromFlowItemID:t.getId(),toFlowItemID:f.getId()});k.Outerflow.push(p._getData());q.push(p)}}}}for(var j=0;j<o.length;j++){var p=o[j];if(p===undefined||p===null){continue}if(r.indexOf(p)>=0){continue}var y=p.getFromFlowItem();var z=p.getToFlowItem();k.Outerflow.push(p._getData())}if(v===null&&l.getFirstChild()===null&&e!==null){v=e}if(v!==null){k.Outerflow.push({executionMode:"always",fromFlowItemID:v.getId()})}this._seqFlowJSON=JSON.parse(JSON.stringify(k));l.setFirstChild(e);l.setLastChild(v);for(var j=0;j<q.length;j++){l.addSeqFlow(q[j])}for(var j=0;j<r.length;j++){l.removeSeqFlow(r[j])}this._seqFlowsToDelete=r;this._seqFlowsToAdd=q};return a});define("DS/SMAProcWebAsyncUtils/Activity/Disconnect",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMSeqFlow","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils"],function(c,d,b,e){var a=function(f){if(!(this instanceof a)){return new a(f)}this._parent=f.getParent();this._seqFlowJSON=null;this._activity=f;this._process=null;this._connected=false;this._rollback={_seqFlowsToDelete:[],_seqFlowsToAdd:[],_firstChild:null,_lastChild:null,_actPos:null,_parent:null};c.prototype.constructor.call(this)};a.prototype=new c();a.prototype.constructor=a;a.prototype.begin=function(){this._connected=this._activity.getPosition().connected;if(this._connected===true){this._process=(this._parent.isProcess())?this._parent:this._parent.getProcess();this._rollback._parent=this._parent;this._rollback._actPos=this._activity.getPosition();this._activity.setWebServiceRunning(true);var f={firstChild:this._parent?this._parent.getFirstChild():null,lastChild:this._parent?this._parent.getLastChild():null,toSeqFlows:this._activity?this._activity.getToSeqFlows():[],fromSeqFlows:this._activity?this._activity.getFromSeqFlows():[],incomingItems:this._activity?this._activity.getIncomingFlowItems():[],outgoingItems:this._activity?this._activity.getOutgoingFlowItems():[]};this._seqFlowJSON={Outerflow:[]};if(this._parent&&this._process){this.disconnectFromParent(this._process,this._parent,this._activity,this._seqFlowJSON,f)}this.disconnectSeqFlows(this._parent,this._activity,this._seqFlowJSON,f);this.dataReady(this._process)}};a.prototype.disconnectFromParent=function(f,l,h,m,n){var k=n.firstChild,g=n.lastChild,i=n.incomingItems,j=n.outgoingItems;this._rollback._firstChild=k;this._rollback._lastChild=g;if(h===k){if(j&&j.length){l.setFirstChild(j[0]);m.Outerflow.push({firstChildID:j[0].getId()})}else{l.setFirstChild(null);m.Outerflow.push({firstChildID:""})}}if(h===g){if(i&&i.length){l.setLastChild(i[0])}else{l.setLastChild(null)}}h.setParent(f)};a.prototype.disconnectSeqFlows=function(o,g,t,u){var n=u.firstChild,f=u.lastChild,l=u.toSeqFlows,p=u.fromSeqFlows,k=u.incomingItems,i=u.outgoingItems;var h=o.getSeqFlows();this._incomingItems=k;this._outgoingItems=i;var m=this._incomingItems&&this._incomingItems.length?this._incomingItems[0]:null;var v=this._outgoingItems&&this._outgoingItems.length?this._outgoingItems[0]:null;var r=[];var s=[];l.forEach(function(w){r.push(w)});p.forEach(function(w){r.push(w)});var j=null;r.forEach(function(w){if(h.length>1){o.removeSeqFlow(w)}else{if(w.getToFlowItem()===null&&w.getFromFlowItem()===g){o.removeSeqFlow(w)}else{j=w}}});h.forEach(function(w){if(j===w){if(w.getFromFlowItem()===g){w.setFromFlowItem(w.getToFlowItem())}w.setToFlowItem(null);t.Outerflow.push(w._getData())}else{if(w&&r.indexOf(w)===-1){t.Outerflow.push(w._getData())}}});if(m&&v){var q=new d({executionMode:"always",fromFlowItemID:m.getId(),toFlowItemID:v.getId()});q.setParent(o);s.push(q);t.Outerflow.push(q._getData());o.addSeqFlow(q)}this._rollback._seqFlowsToAdd=r;this._rollback._seqFlowsToDelete=s};a.prototype.run=function(){if(this._connected){if(!this._parent.isProcess()&&this._parent.getProcess()===null){this.onFail("parent is not defined");return}var g=false;var p=false;for(var j=0;j<this._seqFlowJSON.Outerflow.length;j++){if(this._seqFlowJSON.Outerflow[j].firstChildID!==undefined){g=true}else{if(this._seqFlowJSON.Outerflow[j].toFlowItemID===""){p=true}}}if(g===false){this._seqFlowJSON.Outerflow.push({firstChildID:(this._parent.getFirstChild())?this._parent.getFirstChild().getId():""})}if((p===false)&&(this._parent.getLastChild()!==null)){var n=new d({executionMode:"always",fromFlowItemID:this._parent.getLastChild().getId(),toFlowItemID:""});this._seqFlowJSON.Outerflow.push(n._getData())}(this._seqFlowJSON.Outerflow||[]).forEach(function(i){if(i){if(i.toFlowItemID===""){delete i.toFlowItemID}}});var o="SMA_Process";var m={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:this._parent.getPhysicalId(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(this._seqFlowJSON)}]},cestamp:{value:[{value:this._parent.getCEStamp()}]},connectionAction:{value:[{value:"disconnect"}]},childId:{value:[{value:this._activity.getPhysicalId()}]}}}],name:o},name:o};var l="updateWidget="+encodeURIComponent(JSON.stringify(m));var h=b.get3DSpaceUrl();var f=h+"/resources/e6w/service/"+o;var k=this;this.post(k._parent.getPhysicalId(),f,l,{onComplete:function(i){k._parent.setCEStamp(i.datarecords.datagroups[0].dataelements.cestamp.value[0].value);if(!(k._parent.isProcess())){e.loadProcess(k._parent.getProcess().getPhysicalId(),{onSuccess:function(q){k._activity.setWebServiceRunning(false);k._parent.getProcess().setCEStamp(q.getCEStamp());k.onSuccess(k._activity);console.log("Process refreshed"+q)},onFailure:function(q){logger.log("Failed to Disconnect"+q)}})}else{k._activity.setWebServiceRunning(false);k.onSuccess(k._activity)}},onError:function(i){if(this._activity.getWebServiceRunning()===true){this.onFail(i)}}.bind(this)})}};a.prototype.rollback=function(){var m=this._parent;var i=this._activity;if(m===undefined||m===null||i===undefined||i===null){this.onRollbackFailed(null);return}var g=(m.isProcess())?m:m.getProcess();var n=m.isProcess()?"SMA_Process":"SMA_Activity";var j=this;if(i.getWebServiceRunning()===true){j.reconnectSeqFlows();j.onRollbackComplete(j._activity)}else{j.reconnectToParent();j.reconnectSeqFlows();var l={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:m.getPhysicalId(),dataelements:{cestamp:{value:[{value:m.getCEStamp()}]},sequenceFlows:{value:[{value:JSON.stringify(this._seqFlowDeleteJSON)}]}}}],name:"parentType"},name:"parentType"};var k="updateWidget="+encodeURIComponent(JSON.stringify(l));var h=b.get3DSpaceUrl();var f=h+"/resources/e6w/service/"+n;j.post(i.getPhysicalId(),f,k,{onComplete:function(o){if(m!==undefined&&m!==null){m.setCEStamp(o.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}else{g.setCEStamp(o.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}j.onRollbackComplete(j._activity)},onError:function(o){j.onRollbackFailed(o)}})}};a.prototype.reconnectToParent=function(){};a.prototype.reconnectSeqFlows=function(){};a.prototype.cancel=function(){};return a});define("DS/SMAProcWebAsyncUtils/Gateway/Delete",["DS/SMAProcWebAsyncUtils/SMAProcWebTransaction","DS/JSCMM/SMAJSCMMSeqFlow","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils"],function(b,c,a){var d=function(e){if(!(this instanceof d)){return new d(e)}this._parent=e.getParent();this._process=e.getProcess();this._seqFlowJSON=null;this._gateway=e;this._deletedObjs=[];this._seqFlowsToDelete=[];this._seqFlowsToAdd=[];this._firstChild=null;this._lastChild=null;b.prototype.constructor.call(this)};d.prototype=new b();d.prototype.constructor=d;d.prototype.begin=function(){var h=this._gateway,f=this._parent,g=this._process;if(h===undefined||h===null){this.onFail("gateway is not defined");return false}if(g===undefined||g===null){this.onFail("gateway is not part of process");return false}if(f!==undefined&&f!==null&&h.getPosition().connected===true){this.deleteSequenceFlows(f,h)}if(f!==undefined&&f!==null){f.removeChildFlowItem(h)}g.removeActivity(h);var e=[];e.deletedObject=h;h.fireEvent("ActivityDeleted",e);this.dataReady(h)};d.prototype.run=function(){var j=this;var o=this._gateway,n=this._parent,f=this._process;if(o===undefined||o===null){this.onFail("gateway is not defined");return false}if(f===undefined||f===null){this.onFail("gateway is not part of process");return false}var i=(n!==undefined&&n!==null)?n.getPhysicalId():f.getPhysicalId();var h=(n!==undefined&&n!==null)?n.getCEStamp():f.getCEStamp();var m={datarecords:{datagroups:[{updateAction:"DELETE",dataelements:{parentId:{value:[{value:i}]},cestamp:{value:[{value:h}]},id:{value:[{value:o.getId()}]}}}],name:"SMA_Gateway"},name:"SMA_Gateway"};var k=m.datarecords.datagroups[0].dataelements;if(this._seqFlowJSON!==null){k.sequenceFlows={value:[{value:JSON.stringify(this._seqFlowJSON)}]}}var l="updateWidget="+encodeURIComponent(JSON.stringify(m));var g=a.get3DSpaceUrl();var e=g+"/resources/e6w/service/SMA_Gateway";j.post(i,e,l,{onComplete:function(p){if(n!==undefined&&n!==null){n.setCEStamp(p.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}else{f.setCEStamp(p.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}j.onSuccess(n)},onError:function(p){j.onFail(p)}})};d.prototype.rollback=function(){var k=this;var f=this._gateway,o=this._parent,s=this._process;if(f===undefined||f===null){k.onRollbackFailed("gateway is not defined");return false}if(s===undefined||s===null){k.onRollbackFailed("gateway is not part of process");return false}s.addActivity(f);if(o!==undefined&&o!==null){o.addChild(f)}if(o!==undefined&&o!==null&&f.getPosition().connected===true){if(k._firstChild){o.setFirstChild(k._firstChild)}for(var v=0;v<k._seqFlowsToAdd.length;v++){o.removeSeqFlow(k._seqFlowsToAdd[v])}for(var v=0;v<k._seqFlowsToDelete.length;v++){o.addSeqFlow(k._seqFlowsToDelete[v])}if(k._lastChild){o.setLastChild(k._lastChild)}}if(k._ws===false){k.onRollbackComplete(f)}else{var l=null;if(o!==undefined&&o!==null&&f.getPosition().connected===true){var p=o.getSeqFlows();var e=o.getFirstChild();var w=o.getLastChild();l={Outerflow:[]};if(e!==null){l.Outerflow.push({firstChildID:e.getId()})}for(var m=0;m<p.length;m++){var r=p[m];if(r===undefined||r===null){continue}l.Outerflow.push(r._getData())}if(w!==null){l.Outerflow.push({executionMode:"always",fromFlowItemID:w.getId()})}}var u=(o!==undefined&&o!==null)?o.getPhysicalId():s.getPhysicalId();var n=(o!==undefined&&o!==null)?o.getCEStamp():s.getCEStamp();var t={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:"SMA_Gateway"},name:"SMA_Gateway"};var q=t.datarecords.datagroups[0].dataelements;q.parentId={value:[{value:u}]};q.cestamp={value:[{value:n}]};q.title={value:[{value:f.getName()}]};q.id={value:[{value:f.getId()}]};if(l!==null){q.sequenceFlows={value:[{value:JSON.stringify(l)}]}}var g="updateWidget="+encodeURIComponent(JSON.stringify(t));var j=a.get3DSpaceUrl();var h=j+"/resources/e6w/service/SMA_Gateway";f.setWebServiceRunning(true);k.post(u,h,g,{onComplete:function(i){f.setWebServiceRunning(false);if(o!==undefined&&o!==null){o.setCEStamp(i.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}else{s.setCEStamp(i.datarecords.datagroups[0].dataelements.cestamp.value[0].value)}k.onRollbackComplete(f)},onError:function(i){if(f.getWebServiceRunning()===true){k.onRollbackFailed(i)}}})}};d.prototype.cancel=function(){};d.prototype.deleteSequenceFlows=function(k,r){var n=k.getSeqFlows();var e=k.getFirstChild();var u=k.getLastChild();var q=[],p=[];this._firstChild=e;this._lastChild=u;var l=r.getIncomingFlowItems(),m=r.getOutgoingFlowItems();var s=(l!==undefined&&l.length)?l[0]:null;var f=(m!==undefined&&m.length)?m[0]:null;var g=r.getToSeqFlows(),v=r.getFromSeqFlows();for(var t=0;t<g.length;t++){q.push(g[t])}for(var t=0;t<v.length;t++){q.push(v[t])}var h={Outerflow:[]};if(k.getFirstChild()===r&&k.getLastChild()===r){e=null;u=null}else{if(s===null&&f===null){e=null;u=null}else{if(s===null){if(f!==null){h.Outerflow.push({firstChildID:f.getId()});e=f}}else{if(f===null||k.getLastChild()===r){if(e!==null){h.Outerflow.push({firstChildID:e.getId()})}if(s!==null){u=s}}else{if(e!==null){h.Outerflow.push({firstChildID:e.getId()})}var o=new c({executionMode:"always",fromFlowItemID:s.getId(),toFlowItemID:f.getId()});h.Outerflow.push(o._getData());p.push(o)}}}}for(var j=0;j<n.length;j++){var o=n[j];if(o===undefined||o===null){continue}if(q.indexOf(o)>=0){continue}var w=o.getFromFlowItem();var x=o.getToFlowItem();h.Outerflow.push(o._getData())}if(u===null&&k.getFirstChild()===null&&e!==null){u=e}if(u!==null){h.Outerflow.push({executionMode:"always",fromFlowItemID:u.getId()})}this._seqFlowJSON=JSON.parse(JSON.stringify(h));k.setFirstChild(e);k.setLastChild(u);for(var j=0;j<p.length;j++){k.addSeqFlow(p[j])}for(var j=0;j<q.length;j++){k.removeSeqFlow(q[j])}this._seqFlowsToDelete=q;this._seqFlowsToAdd=p};return d});