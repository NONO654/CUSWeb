define("DS/DELWebMfgAssetsDefUIGraphView/GraphLinkFilter",["UWA/Class","DS/DELWebMfgAssetsDefModelServices/Resources"],function(b,e){var d=b.singleton({name:"GraphLinkFilter",creatableTypesOfLink:"",init:function(){var l=e.getNLSValue("GraphViewLinksFilter.Implement"),k=e.getNLSValue("GraphViewLinksFilter.Output"),j=e.getNLSValue("GraphViewLinksFilter.Alternate"),m=e.getNLSValue("GraphViewLinksFilter.Origin"),i=e.getNLSValue("GraphViewLinksFilter.CapableResources"),h=e.getNLSValue("GraphViewLinksFilter.ProductFlow");this.creatableTypesOfLink=new UWA.Class.Collection([],{});this.linkTypeName=new UWA.Class.Collection([],{});this.creatableTypesOfLink.add({img:"ProductImplementLink",name:l,displayed:true,connections:["ProductImplementLink","ProcessImplementLink","SystemImplementLink_inverse","ProcessImplementLink_inverse"]});this.creatableTypesOfLink.add({img:"DELLmiProductionSystemOutputCnxToMBOM",name:k,displayed:true,connections:["HistorizationLinkRefRef","HistorizationLinkRefRef_inverse"]});this.creatableTypesOfLink.add({img:"MfgProcessAlternate",name:j,displayed:true,connections:["MfgProcessAlternate","MfgProcessAlternate_inverse"]});this.creatableTypesOfLink.add({img:"HistorizationLinkRefRef",name:m,displayed:true,connections:["DELLmiProductionSystemOutputCnxToMBOM","DELLmiProductionSystemOutputCnxToMBOM_inverse"]});this.creatableTypesOfLink.add({img:"DELAsmProcessCanUseCnx",name:i,displayed:true,connections:["DELAsmProcessCanUseCnx"]});this.creatableTypesOfLink.add({img:"DELLmiTimeConstraintCnx",name:h,displayed:true,connections:["DELLmiTimeConstraintCnx","DELLmiTimeConstraintCnx_inverse","DELLmiMaterialPathCnxCust","DELLmiMaterialPathCnxCust_inverse","DEFAULT"]});this.linkTypeName.add({name:l,typeAssociated:"ProductImplementLink"});this.linkTypeName.add({name:l,typeAssociated:"ProcessImplementLink"});this.linkTypeName.add({name:l,typeAssociated:"ProcessImplementLink_inverse"});this.linkTypeName.add({name:l,typeAssociated:"SystemImplementLink_inverse"});this.linkTypeName.add({name:m,typeAssociated:"HistorizationLinkRefRef"});this.linkTypeName.add({name:m,typeAssociated:"HistorizationLinkRefRef_inverse"});this.linkTypeName.add({name:j,typeAssociated:"MfgProcessAlternate"});this.linkTypeName.add({name:j,typeAssociated:"MfgProcessAlternate_inverse"});this.linkTypeName.add({name:k,typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM"});this.linkTypeName.add({name:k,typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM_inverse"});this.linkTypeName.add({name:i,typeAssociated:"DELAsmProcessCanUseCnx"});this.linkTypeName.add({name:h,typeAssociated:"DELLmiTimeConstraintCnx"});this.linkTypeName.add({name:h,typeAssociated:"DELLmiTimeConstraintCnx_inverse"});this.linkTypeName.add({name:h,typeAssociated:"DELLmiMaterialPathCnxCust"});this.linkTypeName.add({name:h,typeAssociated:"DELLmiMaterialPathCnxCust_inverse"});this.linkTypeName.add({name:h,typeAssociated:"DEFAULT"})},getCreatableTypesOfLink:function c(){return this.creatableTypesOfLink},getDisplayedStatusByName:function g(i){var h=this.creatableTypesOfLink.findWhere({name:i});return h._attributes.displayed},getDisplayedStatusByType:function a(i){var h=this.linkTypeName.findWhere({typeAssociated:i});return this.getDisplayedStatusByName(h._attributes.name)},setDisplayedStatus:function f(j,h){var i=this.creatableTypesOfLink.findWhere({name:j});i.set("displayed",h)}});return d});define("DS/DELWebMfgAssetsDefUIGraphView/ProductFlowView",["UWA/Core","UWA/Class/View","UWA/Class/Debug","DS/DELWebMfgAssetsDefUIGraphView/GraphLinkFilter","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefGraphModel/GraphCollection","DS/egraph/core","DS/egraph/views","DS/egraph/iact","DS/egraph/utils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/CreateLinkUtil","DS/DELWebMfgAssetsDefUIServices/TreeListUtils","DS/Controls/Button","DS/ApplicationFrame/CommandsManager","DS/DELWebMfgAssetsDefModelServices/Selection","DS/Core/Events","DS/UIBehaviors/ContextualMenuManager","DS/DELWebMfgAssetsDefUIServices/AttributeUtil","DS/DELWebMfgAssetsDefUIControls/EditAttributeUI","DS/DELWebMfgAssetsDefModelServices/Resources"],function(a,I,d,E,J,i,n,B,f,y,C,D,u,k,F,z,j,w,H,x,h,g,s){var e=I.extend(d,{_onChange:function K(){if(a.is(document.getElementsByClassName("mainContentProductFlow")[0])){new e({PID:this.options.PID,dialog:this.options.dialog})}return this},_modelEvents:{onChange:function(){},onAdd:function(){return this._onChange()},onRemove:function(){return this._onChange()}},setup:function b(){var N=this.options.PID,W=this.options.dialog,U=this,Q=this.render(),V=this.productFlowUtils(N),O=new a.Class.Collection([],{}),Y,P,Z=[],T,aa,R,S,X=new a.Class.Collection([],{}),M=new a.Class.Collection([],{});U.listenTo(J.references,U._modelEvents).stopListening(null,U._modelEvents);U.listenTo(J.instances,U._modelEvents).stopListening(null,U._modelEvents);U.listenTo(J.connections,U._modelEvents).stopListening(null,U._modelEvents);U.listenTo(J.references,U._modelEvents);U.listenTo(J.instances,U._modelEvents);U.listenTo(J.connections,U._modelEvents);Y=function(ab){return ab.get("links").length>0};P=V.filter(Y);Z=P;while(Z.length>0){T=Z[0];X.add(T);T.get("links").forEach(function(ab){V.findWhere({PID:ab[0]}).set({index:(T.get("index")+1)});S=X.findWhere({PID:ab[0]});M.add({from:T.get("PID"),to:ab[0]});R=M.where({from:T.get("PID"),to:ab[0]}).length;if(S!==undefined){Z.push(V.findWhere({PID:ab[0]}))}if(R>V.length*5){Z=[];R=true}else{R=false}});Z.shift()}if(R){u.AlertManager.add({className:"error",message:D.getNLSValue("ProductFlowView.Loop")});W.destroy()}else{aa=this.organizeTheGraph(V);this.drawTheGraph(aa,Q,O);this.drawTheLinks(V,Q,O);this.resizeTheGraph(Q);this.initChangeListener(Q)}},initChangeListener:function l(X){var ad=J.references,ab=J.instances,ac,U,W,O,Z,P,V,S,T=this,Q=true,N=document.getElementById("canvas_productFlow"),Y=this;function M(ae){T.myEvent=ae}N.addEventListener("mouseover",M,false);X.addChangeListener(function aa(ae){if(ae[0].path[0]==="edges"){if(ae[0].child.cl1.c!==null&&ae[0].child.cl2.c.node.PID!==undefined){ad.forEach(function(af){if(af._attributes.PID===ae[0].child.cl1.c.node.PID){ac=af;W=J.getInstancesFromCollection(af._attributes.PID);W=ab.findWhere({isInstanceOf:af._attributes.PID})}if(af._attributes.PID===ae[0].child.cl2.c.node.PID){U=af;S=J.getInstancesFromCollection(af._attributes.PID);S=ab.findWhere({isInstanceOf:af._attributes.PID})}});if(!a.is(ae[0].child.geometry)){k.createLinkOrInstance(ac,U,W,S);document.getElementsByClassName("btn-MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-link-Button")[0].click()}setTimeout(function(){O=[];O=document.getElementsByTagName("path");for(P=0;P<O.length;P++){if(O[P].innerHTML!=="official"){Z=window.getComputedStyle(O[P]);V=Z.getPropertyValue("marker-end");if(V==="none"){if(O[P].parentElement.id!=="arrow-edge-end-marker"){O[P].parentElement.removeChild(O[P])}}}}},500)}}if(Q){return}Q=ae.some(function(af){return af.path[0]==="selection"})});X.addListener("update",function R(){var am,al,ai,ak,ag,ao,an,aq,af,ah,ap,ae=T.myEvent,aj=new a.Class.Collection([],{});al=new F({treeList:u.getMGAElement("TreeUI")});ai=new F({treeList:u.getMGAElement("TableUI")});ak=new F({treeList:u.getMGAElement("LeftUI")});ag=new F({treeList:u.getMGAElement("RightUI")});if(Q){Q=false;ao=J.getSelectedRefs({views:J.VIEWS.ROUTINGS});an=J.getSelectedRefs({views:J.VIEWS.AUXILIARY});aq=J.getSelectedRefs({views:J.VIEWS.GENERIC});ao.forEach(function(ar){aj.add({ref:ar})});an.forEach(function(ar){aj.add({ref:ar})});aq.forEach(function(ar){aj.add({ref:ar})});if(X.selection.first===null){ap=document.getElementsByClassName("myNodeLinkEdit");ah=0;while(ah<ap.length){ap[ah].innerHTML="";ah++}}for(am=X.selection.first;am;am=am.nextSel){if(am.type===n.Type.NODE){af=ad.findWhere({PID:am.PID}).get("displayModel").get("selectedInTableView");if(!af){ap=document.getElementsByClassName("myNodeLinkEdit");ah=0;while(ah<ap.length){ap[ah].innerHTML="";ah++}new z({label:"",icon:"bars",iconSize:"1x",displayStyle:"lite",onClick:T.infoBox}).inject(document.getElementsByClassName(am.PID)[0].parentElement.childNodes[4]);ai.select(ad.findWhere({PID:am.PID}));ak.select(ad.findWhere({PID:am.PID}));ag.select(ad.findWhere({PID:am.PID}))}else{aj.forEach(function(ar){if(ar.get("ref").get("PID")===am.PID){aj.remove(ar)}})}}if(n.Type.EDGE===am.type){if(a.is(am.mark)){ae=Y.myEvent;T._onShowOptions(ae,am.mark);X.selection.first=null;X.selection.last=null}}}aj.forEach(function(ar){ai.unselect(ar.get("ref"));al.unselect(ar.get("ref"));ak.unselect(ar.get("ref"));ag.unselect(ar.get("ref"))})}})},organizeTheGraph:function m(T){var V=new a.Class.Collection([],{}),M=T.where({index:0}),R=0,Q,S,O,W,U,P,N,X;while(M.length>0){Q=M[0];S=R;O=Q.get("index");M.shift();if(V.findWhere({ref:Q})===undefined){while(V.findWhere({y:S,x:O})!==undefined){S++}V.add({y:S,x:O,ref:Q});R=S}Q.get("links").forEach(function(Y){Y=T.findWhere({PID:Y[0]});S=0;O=Y.get("index");while(V.findWhere({y:S,x:O})!==undefined){S++}W=V.findWhere({ref:Y});U=V.findWhere({ref:Q});if(W===undefined){W=V.add({y:S,x:O,ref:Y});R=S}P=false;S=U.get("y")-1;N=W.get("x")-U.get("x");if(N>1){while(P===false){P=true;S++;for(X=U.get("x")+1;X<W.get("x");X++){if(V.findWhere({x:X,y:S})!==undefined){P=false}}}for(X=U.get("x")+1;X<W.get("x");X++){V.add({y:S,x:X,ref:null})}W.set({y:S});U.set({y:S});R=S}M.unshift(Y)})}return V},resizeTheGraph:function r(M){var P,O,N;N=new y.BoundingRect();for(P=M.nodes.first;P;P=n.dftNext(M,P)){N.update(P,P.actualLeft,P.actualLeft+P.actualWidth,P.actualTop,P.actualTop+P.actualHeight)}O=y.reframeViewpoint(M.views.main.getSize(),N,{padding:15,minSize:10,horizontal:0,vertical:0,aliasing:0,defaultVpt:M.views.main.vpt,maxScale:1});M.views.main.setViewpoint(O,true)},drawTheGraph:function L(R,N,M){var Q=0,S=0,P=this,O;R.forEach(function(T){if(T.get("ref")!==null){O=P.newMixNode((T.get("x")*450),T.get("y")*150,T.get("ref").get("PID"));N.addNode(O);M.push(O);if(Q<T.get("y")*150){Q=T.get("y")*150}if(S<T.get("x")*450){S=T.get("x")*450}}});this.resizeTheGraph(N)},drawTheLinks:function G(O,N,M){var P=this,Q;O.forEach(function(R){Q=R.get("PID");R.get("links").forEach(function(S){P.addEdgeArrow(M.findWhere({PID:Q}).get("data").out,M.findWhere({PID:S[0]}).get("data").in1,N,S[1])})})},addEdgeArrow:function v(P,N,M,O){var Q;Q=new n.Edge();Q.set("geometry",new n.AutoBezierGeometry());Q.views.main=new B.SVGEdgeView("my-sec-edge-view");Q.mark=O;M.addEdge(P,N,Q);return Q},productFlowUtils:function o(M){var T=J.getCollections().referenceCollection,Q=J.getCollections().connectionCollection,P=J.getCollections().instanceCollection,U=P.where({isAggregatedBy:M}),R=new a.Class.Collection([],{}),N,S,V,O;U.forEach(function(W){var X;S={PID:"",links:[],index:0};S.PID=W.get("isInstanceOf");V=Q.where({from:W.get("PID")});V.forEach(function(Y){N=P.findWhere({PID:Y.get("to")});X=Y.get("PID");if(a.is(N)){O=T.where({PID:N.get("isInstanceOf")});O.forEach(function(Z){S.links.push([Z.get("PID"),X])})}});R.push(S)});return R},newConnector:function p(N,Q,P){var M,O;O=40;M=new n.Connector();if(P===true){M.views.main=new B.SVGConnView("egraph_views_mySVGConnView")}else{M.views.main=new B.SVGConnView()}M.multiset(["cstr","attach"],N,["cstr","offset"],O);return M},MyNodeView:function A(){B.HTMLNodeView.call(this)},infoBox:function q(){var O,M,N="Relations";O=j.getCommand(N,w.getActionBarContext());if(a.is(O)){M=O._evtID}else{M="/WUX/AFR/CMD/"+w.getActionBarContext()+"/"+N}if(a.is(M)){H.publish({event:M})}},newMixNode:function(M,P,O){var N;N=new n.Node();N.views.main=new this.MyNodeView();N.PID=O;N.data={};N.multiset("left",M,"top",P,"width",250,"height",80);this.MyNodeView.prototype.buildNodeElement=function(S){var Q=null,R;if(a.is(S)){R=document.getElementsByClassName("input-node")[0];Q=R.cloneNode(true);Q.childNodes["1"].className+=" EGraph_obj_SYSTEM "+S.PID}C.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewReferenceAttribute",function(Z){var W=Z.Config.Preferences,V=W.Primary.Info.property,X=W.Secondary.Info,aa=W.Image.value,U,Y,ab;Y=J.getCollections().referenceCollection;S=Y.findWhere({PID:O})._attributes;ab=D.getIconURLFromKey(S.type);U=new a.Element("div",{"class":"wux-control-inline-container"});U.inject(Q.childNodes["0"]);if(aa==="true"){Q.childNodes["0"].innerHTML+='<img src="'+ab+'"> '}Q.childNodes["0"].innerHTML+=S[V];if(!a.is(X,"array")){X=[X]}X.forEach(function T(ad){var ac=a.is(ad.dicoType)?ad.dicoType:null;Q.childNodes["1"].innerHTML+="</br><b>"+D.getNLSValue(ad.property,null,ac)+"</b> : "+S[ad.property]})});return Q};N.data.in1=this.newConnector(n.BorderCstr.LEFT,0,true);N.appendConnector(N.data.in1);N.data.in2=this.newConnector(n.BorderCstr.LEFT,1,true);N.appendConnector(N.data.in2);N.data.out=this.newConnector(n.BorderCstr.RIGHT,0,true);N.appendConnector(N.data.out);return N},render:function t(){var X=a.createElement("div",{"class":"canvas",id:"canvas_productFlow"}),M=a.createElement("div",{"class":"input-node my-node"}),R=a.createElement("div",{"class":"my-node-header"}),W=a.createElement("div",{"class":"my-node-container"}),P=a.createElement("div",{"class":"my-node-col left"}),Z=a.createElement("div",{"class":"my-node-col right"}),U=a.createElement("div",{"class":"my-node-text"}),ac=a.createElement("div",{"class":"myNodeLinkEdit"}),O=document.getElementsByClassName("canvas"),Y=a.createElement("div",{"class":"InputNodeData"}),Q,N,T,ab,V,S,aa;if(O.length!==0){O[0].remove(0)}Q=new n.EGraph();V=document.createElementNS("http://www.w3.org/2000/svg","svg");N=document.createElementNS("http://www.w3.org/2000/svg","defs");T=document.createElementNS("http://www.w3.org/2000/svg","marker");ab=document.createElementNS("http://www.w3.org/2000/svg","path");V.appendChild(N);N.appendChild(T);T.appendChild(ab);V.setAttribute("width","0");V.setAttribute("height","0");V.setAttribute("style","position:absolute;");T.setAttribute("id","arrow-edge-end-marker");T.setAttribute("markerWidth","10");T.setAttribute("markerHeight","8");T.setAttribute("refX","8");T.setAttribute("refY","4");T.setAttribute("orient","auto");ab.setAttribute("d","M 0 0 L 10 4 L 0 8");ab.setAttribute("fill","#777");ab.setAttribute("stroke","none");ab.setAttribute("z-index","10");X.setStyles({width:"100%",height:"97%","min-height":"40%","min-width":"50%","background-color":"white"});M.setStyles({width:"50px",height:"50px"});U.setStyles({top:"0px"});Y.setStyles({display:"none"});Z.appendChild(U);M.appendChild(R);M.appendChild(W);M.appendChild(P);M.appendChild(Z);M.appendChild(ac);X.appendChild(Y);Y.appendChild(M);X.appendChild(V);S=document.getElementsByClassName("mainContentProductFlow")[0];if(!a.is(S)){S=document.getElementsByClassName("wux-windows-window-maincontent");S=S[S.length-1];S.className+=" mainContentProductFlow"}S.appendChild(X);if(S.style.width===""){S.style.width="900px";S.style.height="500px"}aa=S.getElementsByClassName("wux-windows-window-content");if(aa.length===1){S.removeChild(aa[0])}Q.addView("main",new B.HTMLGraphView(X));new f.StateMachine(Q,null,null,Q.views.main);y.inherit(this.MyNodeView,B.HTMLNodeView);return Q},_onShowOptions:function c(S,U){var M=[],R=U,Q=S.clientX,P=S.clientY,N,T,O;T={icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:s.getNLSValue("LinksUI.DeleteLink"),sensitivity:"enabled",callback:function(){N=J.connections.get(R);N.destroy({proxy:"passport",headers:C.getHeaders(),wait:true,onFailure:function(){u.AlertManager.add({className:"error",message:s.getNLSValue("LinksUI.DeleteFailure")})},onComplete:function(){u.AlertManager.add({className:"success",message:s.getNLSValue("LinksUI.DeleteSuccess")})},logMessage:s.getNLSValue("LinksUI.LogMessage")})}};O={icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:"enabled",callback:function(){C.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIEditLinkAttributes",function V(X){var aa=J.connections.get(R),W=X.Config[aa.get("type")],Y,Z;if(a.is(W)){Y=W.Attribute;Z=h.getObjectAndAttributeInfos(Y);g.editAttributes(u.AlertManager,aa,Z)}else{u.AlertManager.add({className:"warning",message:s.getNLSValue("LinksUI.NoAttributes")})}})}};M.push(T);M.push(O);x.show({nodes:M},[Q,P])}});return e});define("DS/DELWebMfgAssetsDefUIGraphView/GraphUtils",["UWA/Core","UWA/Class/View","UWA/Class/Debug","DS/DELWebMfgAssetsDefUIGraphView/GraphLinkFilter","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefGraphModel/GraphCollection"],function(e,a,l,f,g,i){var b={addInstances:function j(p,s,m,t,v){var o=null,n=null,r=0,u=null,q=null;if(e.is(s)){o=s;n=s;r=p.findWhere({PID:s.get("PID")}).get("X")+1;if(e.is(s.id)){q=g.getInstancesFromCollection(s.id);q.forEach(function(w){w=g.getReferenceModelFromInstance(w);if(e.is(w)){m.unshift([w,r,o.id])}})}if(e.is(m[0],"array")){if(m[0].length>=3){if(e.is(m[0][0])){u=e.is(m[0][0].id)?m[0][0].id:null}p.add({PID:u,X:m[0][1],Type:this.getType(n.get("PPRTYPE")),isAggregatedBy:m[0][2],LINKS:this.getReferenceReferenceLinks(u,t,v)});n=m[0][0];m.shift();this.addInstances(p,n,m,t,v)}}}},getInstanceInstanceLink:function d(o,y,m,v){var s=[],t,u,r,w,q,n,p,x;Array.prototype.push.apply(s,y.where({type:"DELLmiTimeConstraintCnx_inverse"}));Array.prototype.push.apply(s,y.where({type:"DELLmiMaterialPathCnxCust"}));Array.prototype.push.apply(s,y.where({type:"DELLmiTimeConstraintCnx"}));Array.prototype.push.apply(s,y.where({type:"DELLmiMaterialPathCnxCust_inverse"}));Array.prototype.push.apply(s,y.where({type:"DEFAULT"}));s.forEach(function(z){q=z.get("from");if(e.is(q),e.is(q,"array")){n=q[q.length-1]}else{n=q}p=z.get("to");if(e.is(p),e.is(p,"array")){x=p[p.length-1]}else{x=p}t=m.where({PID:n});u=m.where({PID:x});if(u.length!==0&&t.length!==0){t=v.where({PID:t[0].get("isInstanceOf")});u=v.where({PID:u[0].get("isInstanceOf")});if(u.length!==0&&t.length!==0){r=o.where({PID:t[0].get("PID")});if(r.length!==0){w=new e.Class.Collection([],{});w.add({PID:z.get("PID"),from:t[0].get("PID"),to:u[0].get("PID"),type:z.get("type")});if(e.is(r[0].get("LINKS")._models)){Array.prototype.push.apply(w._models,r[0].get("LINKS")._models)}else{Array.prototype.push.apply(w._models,r[0].get("LINKS"))}if(f.getDisplayedStatusByType(w._models[0]._attributes.type)){r[0].set({LINKS:w})}}}}})},getReferenceReferenceLinks:function k(q,o,n){var p=[],m=n.where({from:q});m.forEach(function(s){var r,t;if(f.getDisplayedStatusByType(s.get("type"))){r=o.where({PID:s.get("to")});if(r.length>0){t=r[0];if(t.getDisplayModelAttr("nodesInTableView")>0||t.getDisplayModelAttr("refCountLeftBloc")>0||t.getDisplayModelAttr("refCountRightBloc")>0){p.push(s)}}}});return p},getType:function h(m){switch(m){case"PROCESS":return 0;case"SYSTEM":return 1;case"OPERATION":return 1;case"RESOURCE":return 2;case"PRODUCT":return 3;default:return -1}},findRoots:function c(n,r,m){var q=new i(),o=[],p=this;n.forEach(function(s){if(s.getDisplayModelAttr("asRootInTableView")||s.getDisplayModelAttr("refCountLeftBloc")>0||s.getDisplayModelAttr("refCountRightBloc")>0){q.add({PID:s.id,X:0,Type:p.getType(s.get("PPRTYPE")),isAggregatedBy:null,LINKS:p.getReferenceReferenceLinks(s.id,n,m)});p.addInstances(q,s,o,n,m)}});this.getInstanceInstanceLink(q,m,r,n);return q}};return b});define("DS/DELWebMfgAssetsDefUIGraphView/GraphView",["UWA/Core","DS/Logger/Logger","UWA/Class/View","UWA/Class/Debug","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","DS/DELWebMfgAssetsDefUIGraphView/GraphUtils","DS/egraph/core","DS/egraph/views","DS/egraph/iact","DS/egraph/utils","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIGraphView/GraphLinkFilter","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/Controls/LineEditor","DS/DELWebMfgAssetsDefUIServices/CreateLinkUtil","DS/DELWebMfgAssetsDefUIServices/TreeListUtils","DS/Tree/TreeListView","DS/DELWebMfgAssetsDefGraphModel/GraphCollection","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefUIServices/AbstractDragAndDropManager","DS/UIBehaviors/SwipeableMenu","DS/Controls/Button","DS/DELWebMfgAssetsDefModelServices/Selection","DS/ApplicationFrame/CommandsManager","DS/Core/Events","DS/UIBehaviors/ContextualMenuManager","DS/DELWebMfgAssetsDefUIServices/AttributeUtil","DS/DELWebMfgAssetsDefUIControls/EditAttributeUI"],function(e,b,X,l,h,B,w,Q,n,I,D,A,T,S,R,d,t,U,L,q,Y,ab,g,K,F,r,W,H,p,o){var G=X.extend(l,{name:"GraphView",_logger:null,_onChange:function Z(ae){var ah,aj,ai,ag,ac,ad,af;ah=this.gr.nodes.first;while(e.is(ah)){if(ah.idObjet===ae.get("from")){aj=ah}else{if(ah.idObjet===ae.get("to")){ai=ah}}ah=ah.next}if(e.is(aj)&&e.is(ai)){ag=Y.references.findWhere({PID:aj.idObjet}).get("type");af=Y.references.findWhere({PID:ai.idObjet}).get("type");if(ag===af){this.addEdge(aj.data.out,ai.data.out,ae,this.gr);this.addEdgeArrow(aj.data.out,ai.data.out,ae,this.gr)}else{if(aj.actualLeft<ai.actualLeft){this.addEdge(aj.data.out,ai.data.in1,ae,this.gr);this.addEdgeArrow(aj.data.out,ai.data.in1,ae,this.gr)}else{this.addEdge(ai.data.out,aj.data.in1,ae,this.gr);this.addEdgeArrow(aj.data.in1,ai.data.out,ae,this.gr)}}}else{ad=D.getMGAElement("SlidingViews");ac=e.is(ad)?ad.getCurrentViewID():-1;if(ac===1){new G({renderTo:ad.getView(1),referenceCollection:Y.references,instanceCollection:Y.instances,connectionCollection:Y.connections})}}return this},reload:function aa(){var ad=D.getMGAElement("SlidingViews"),ac=e.is(ad)?ad.getCurrentViewID():-1;if(ac===1){new G({renderTo:ad.getView(1),referenceCollection:Y.references,instanceCollection:Y.instances,connectionCollection:Y.connections})}},allowDrop:function f(ac){ac.preventDefault()},drop:function u(ac){this.dragAndDropMgr.onTreeListViewDrop(ac)},deleteRef:function c(ae){var ad=Y.instances.find({isAggregatedBy:ae}),ac=this.gr.nodes.first;while(e.is(ac)){if(ac.idObjet===ad.get("isInstanceOf")){ac.remove();ac=null}else{ac=ac.next}}},_modelEvents:{onChange:function(ad,ae,ac){if(this.linkDeleted){return this._onChange(ad,ae,ac)}return this},onAdd:function(ad,ae,ac){return this._onChange(ad,ae,ac)},onRemove:function(ad,ae,ac){if(e.is(ad.get("from"))){this.linkDeleted=true}return this._onChange(ad,ae,ac)}},setup:function j(){var ah=this,ag=[],aj,al,ae,af,ai,ak,ad,ac;this._logger=b.getLogger(G);this.listenTo(ah.options.referenceCollection,ah._modelEvents).stopListening(null,ah._modelEvents);this.listenTo(ah.options.instanceCollection,ah._modelEvents).stopListening(null,ah._modelEvents);this.listenTo(ah.options.connectionCollection,ah._modelEvents).stopListening(null,ah._modelEvents);this.listenTo(ah.options.referenceCollection,ah._modelEvents);this.listenTo(ah.options.instanceCollection,ah._modelEvents);this.listenTo(ah.options.connectionCollection,ah._modelEvents);this.render();this.dragAndDropMgr=new ab({displayModelRootAttribute:"asRootInTableView"});I.inherit(this.MyNodeView,Q.HTMLNodeView);I.inherit(this.TextEdgeView,Q.SVGEdgeView);ag=this.initTheCanvas();aj=B.findRoots(this.options.referenceCollection,this.options.instanceCollection,this.options.connectionCollection);if(aj&&aj.length>0){al=this.sortTheInformations(aj);ae=this.drawMyNode(al,ag);this.createMyLinks(aj,ae,ag)}ac=new I.BoundingRect();for(af=ag.nodes.first;af;af=w.dftNext(ag,af)){ac.update(af,af.actualLeft-300,af.actualLeft+af.actualWidth,af.actualTop,af.actualTop+af.actualHeight)}ai=I.reframeViewpoint(ag.views.main.getSize(),ac,{padding:15,minSize:50,horizontal:-1,vertical:-1,aliasing:0,defaultVpt:ag.views.main.vpt,maxScale:1});ag.views.main.setViewpoint(ai,true);this.gr=ag;this.initChangeListener(ag);ak=widget.getElements(".egraph_views_RootLayer");if(e.is(ak,"array")){if(ak.length>=1){ad=ak[0];if(e.is(ad)){ad.addEventListener("dragover",this.allowDrop);ad.addEventListener("drop",this.drop.bind(this))}}}},initChangeListener:function s(ao){var av=this.options.referenceCollection,at=this.options.instanceCollection,au,al,an,af,aq,ad,ag,am,aj,ak=this,ap=this,ac=function ac(aw){ak.myEvent=aw},ah=true;var ae=document.getElementById("canvas");ae.addEventListener("mouseover",ac,false);ao.addChangeListener(function ar(aw){if(aw[0].path[0]==="edges"){if(aw[0].child.cl1.c!==null&&e.is(aw[0].child.cl2.c.node.idObjet)){av.forEach(function(ax){if(ax._attributes.PID===aw[0].child.cl1.c.node.idObjet){au=ax;an=Y.getInstancesFromCollection(ax._attributes.PID);an=at.findWhere({isInstanceOf:ax._attributes.PID})}if(ax._attributes.PID===aw[0].child.cl2.c.node.idObjet){al=ax;aj=Y.getInstancesFromCollection(ax._attributes.PID);aj=at.findWhere({isInstanceOf:ax._attributes.PID})}});if(!e.is(aw[0].child.geometry)){t.createLinkOrInstance(au,al,an,aj)}setTimeout(function(){af=[];af=document.getElementsByTagName("path");for(ag=0;ag<af.length;ag++){if(af[ag].innerHTML!=="official"){aq=window.getComputedStyle(af[ag]);am=aq.getPropertyValue("marker-end");if(am==="none"){if(af[ag].parentElement.id!=="arrow-edge-end-marker"){af[ag].parentElement.removeChild(af[ag])}}}}},500)}}if(ah){return}ah=aw.some(function(ax){return ax.path[0]==="selection"})});ao.addListener("update",function ai(){var aD,aH,aC,az,aB,ay,aF,aE,aG,ax,aw=ak.myEvent,aA=new e.Class.Collection([],{});aC=new U({treeList:D.getMGAElement("TreeUI")});az=new U({treeList:D.getMGAElement("TableUI")});aB=new U({treeList:D.getMGAElement("LeftUI")});ay=new U({treeList:D.getMGAElement("RightUI")});if(ah){ah=false;aF=Y.getSelectedRefs({views:Y.VIEWS.ROUTINGS});aE=Y.getSelectedRefs({views:Y.VIEWS.AUXILIARY});aG=Y.getSelectedRefs({views:Y.VIEWS.GENERIC});aF.forEach(function(aI){aA.add({ref:aI})});aE.forEach(function(aI){aA.add({ref:aI})});aG.forEach(function(aI){aA.add({ref:aI})});if(ao.selection.first===null){aH=document.getElementsByClassName("myNodeLinkEdit");ad=0;while(ad<aH.length){aH[ad].innerHTML="";ad++}}for(aD=ao.selection.first;aD;aD=aD.nextSel){if(aD.type===w.Type.NODE){ax=av.findWhere({PID:aD.idObjet}).get("displayModel").get("selectedInTableView");if(!ax){aH=document.getElementsByClassName("myNodeLinkEdit");ad=0;while(ad<aH.length){aH[ad].innerHTML="";ad++}new K({label:"",icon:"bars",iconSize:"1x",displayStyle:"lite",onClick:ap.infoBox}).inject(document.getElementsByClassName(aD.idObjet)[0].parentElement.childNodes[4]);az.select(av.findWhere({PID:aD.idObjet}));aB.select(av.findWhere({PID:aD.idObjet}));ay.select(av.findWhere({PID:aD.idObjet}))}else{aA.forEach(function(aI){if(aI.get("ref").get("PID")===aD.idObjet){aA.remove(aI)}})}}if(w.Type.EDGE===aD.type){if(e.is(aD.mark.get("PID"))){aw=ap.myEvent;ap._onShowOptions(aw,aD.mark.get("PID"),aD.mark.get("from"));ao.selection.first=null;ao.selection.last=null}}}aA.forEach(function(aI){az.unselect(aI.get("ref"));aC.unselect(aI.get("ref"));aB.unselect(aI.get("ref"));ay.unselect(aI.get("ref"))})}})},initTheCanvas:function E(){var ac;ac=new w.EGraph();ac.addView("main",new Q.HTMLGraphView(this.options.renderTo.childNodes["1"]));new n.StateMachine(ac,null,null,ac.views.main);ac.updateLock();return ac},sortTheInformations:function P(ad){var ah=[],ac=[],af=[],ag=[],ae=[];ad.forEach(function(ai){switch(ai.get("Type")){case 0:ah.push(ai);break;case 1:ac.push(ai);break;case 2:af.push(ai);break;case 3:ag.push(ai);break;default:break}});ae=[ag,ah,ac,af];return ae},drawMyNode:function m(ar,af){var ai=0,ah=0,ap=0,ak,ae,ad,ao,at,ag,am,aj=this,al=this.options.referenceCollection,an,ac,aq;aq=new e.Class.Collection([],{});ar.forEach(function(av,au){av.forEach(function(aw,ax){ai=aw.get("X");am=(au*(2000/4)+(40)+(150*(ai+ah)));ak=(ax*(125)+(40));ae=aw.get("V_Name");ag=aw.get("PPRTYPE");at=aw.get("PID");ad=aj.container.childNodes["0"].childNodes["0"];ao=aw.get("TYPE");aq.add({PID:at,Node:aj.newMixNode(am,ak,ae,ag,at,ad,ao)});aj.createMyConnector(aq.last().get("Node"));if(ai>ap){ap=ai}});ah+=ap});al.forEach(function(au){an=au.get("displayModel").get("selectedInTableView");ac=au.get("displayModel").get("selectedInAuxiliaryView")});try{aq._models.forEach(function(au){af.addNode(au.get("Node"));al.forEach(function(av){if(au.get("Node").idObjet===av.get("PID")){an=av.get("displayModel").get("selectedInTableView");ac=av.get("displayModel").get("selectedInAuxiliaryView");if(ac||an){af.addToSelection(au.get("Node"))}}})})}finally{af.updateUnlock()}this.nodeCollection=aq;return aq},createMyConnector:function a(ac){ac.data.out=this.newConnector(w.BorderCstr.RIGHT,1,true);ac.appendConnector(ac.data.out);ac.data.in1=this.newConnector(w.BorderCstr.LEFT,1,true);ac.appendConnector(ac.data.in1);ac.data.outInstance=this.newConnector(w.BorderCstr.BOTTOM,1,false);ac.appendConnector(ac.data.outInstance)},newConnector:function x(ad,ag,af){var ac,ae;ae=40;ac=new w.Connector();if(af===true){ac.views.main=new Q.SVGConnView("egraph_views_mySVGConnView")}else{ac.views.main=new Q.SVGConnView("egraph_views_mySVGConnView_invisible")}ac.multiset(["cstr","attach"],ad,["cstr","offset"],ae);return ac},infoBox:function y(){var ae,ac,ad="Relations";ae=r.getCommand(ad,F.getActionBarContext());if(e.is(ae)){ac=ae._evtID}else{ac="/WUX/AFR/CMD/"+F.getActionBarContext()+"/"+ad}if(e.is(ac)){W.publish({event:ac})}},newMixNode:function i(ac,aj,ae,ad,ah,ai,af){var ag;ag=new w.Node();ag.views.main=new this.MyNodeView();ag.name=ae;ag.idObjet=ah;ag.typeDobjet=ad;ag.imgType=af;ag.data={};ag.multiset("left",ac,"top",aj,"width",250,"height",80);this.MyNodeView.prototype.buildNodeElement=function(an){var al=null,am="",ak=null;if(e.is(an)){if(e.is(an.idObjet)){al=Y.getReferenceFromCollection(an.idObjet);am=S.getIconURLFromKey(al.get("type"));ak=ai.cloneNode(true);ak.childNodes["1"].className+=" EGraph_obj_"+al.get("PPRTYPE")+" "+al.id;R.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewReferenceAttribute",function(ap){var av=ap.Config.Preferences,ar=e.is(av.Primary.Info)?av.Primary.Info.property:null,au=e.is(ar)?al.get(ar):null,aw=e.is(av.Secondary.Info,"array")?av.Secondary.Info:[av.Secondary.Info],ao=av.Image.value,aq;aq=new e.Element("div",{"class":"wux-control-inline-container"});aq.inject(ak.childNodes["0"]);if((ao==="true")&&(e.is(am,"string")&&(am.length>0))){ak.childNodes["0"].innerHTML+='<img src="'+am+'"> '}if(e.is(au,"string")&&(au.length>0)){ak.childNodes["0"].innerHTML+=au}aw.forEach(function at(ax){var az,ay,aA,aB;if(e.is(ax)&&e.is(ax.property)){az=e.is(ax.dicoType)?(ax.dicoType+"."+ax.property):ax.property;ay=A.getNLSValue(az);aA=al.get(ax.property);aB="</br><b>"+ay+"</b>: "+aA;ak.childNodes["1"].innerHTML+=aB}})})}else{ak=ai.cloneNode(true)}return ak}};return ag},MyNodeView:function O(){Q.HTMLNodeView.call(this)},createMyLinks:function v(ai,ac,ae){var ag,ad,af,aj,ak,ah=this;ai.forEach(function(al){if(al.get("isAggregatedBy")!==null){af=ac.where({PID:al.get("PID")});if(e.is(af)&&af.length>=1){ad=af[0].get("Node");ag=ac.where({PID:al.get("isAggregatedBy")})[0].get("Node");ah.addEdge(ad.data.in1,ag.data.outInstance,"Instance",ae)}else{ah._logger.warn(A.getNLSValue("GraphView.NodeWithPID")+al.get("PID")+A.getNLSValue("GraphView.NotExist"))}}al.get("LINKS").forEach(function(ar){var an=ar.get("from"),ax=ar.get("to"),av=e.is(an,"string")?ac.where({PID:an}):null,ao=e.is(ax,"string")?ac.where({PID:ax}):null,au=null,aq=null,at=null,ap=null,am=null,aw=null;if(e.is(av,"array")){if(e.is(av.length!==0)){au=av[0];if(e.is(au)){aj=au.get("Node");if(e.is(aj)){at=ah.options.referenceCollection.findWhere({PID:aj.idObjet});if(e.is(at)){am=at._attributes.PPRTYPE}}}}}if(e.is(ao,"array")){if(e.is(ao.length!==0)){aq=ao[0];if(e.is(aq)){ak=aq.get("Node");if(e.is(ak)){ap=ah.options.referenceCollection.findWhere({PID:ak.idObjet});if(e.is(ap)){aw=ap._attributes.PPRTYPE}}}}}if(e.is(ak)&&e.is(aj)){if(am===aw){ah.addEdge(aj.data.out,ak.data.out,ar,ae);ah.addEdgeArrow(aj.data.out,ak.data.out,ar,ae)}else{if(aj.actualLeft<ak.actualLeft){ah.addEdge(aj.data.out,ak.data.in1,ar,ae);ah.addEdgeArrow(aj.data.out,ak.data.in1,ar,ae)}else{ah.addEdge(ak.data.out,aj.data.in1,ar,ae);ah.addEdgeArrow(aj.data.in1,ak.data.out,ar,ae)}}}})})},addEdge:function z(ah,af,ae,ad){var ac=this,ai;this.StepGeometry.prototype.onupdate=function ag(an){var ak,ao,aj,am,al;ak=an.cl1.c.aleft;am=an.cl1.c.atop;aj=an.cl2.c.aleft;al=an.cl2.c.atop;ao=0.5*(ak+aj);an.set("path",[w.PathCmd.M,ak,am,w.PathCmd.L,ao,am,w.PathCmd.L,ao,al,w.PathCmd.L,aj,al])};this.TextEdgeView.prototype.oncreateDisplay=function(ak){var aj=this;Q.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments);this.display.elt.id=Math.random();this.display.elt.textContent="official";R.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIGraphViewLinkAttribute",function(al){var am=al.Config.Preferences.Info,an=0;if(Array.isArray(am)){am.forEach(function(ao){ac.createTextEdgeView(aj,ak,ao.name,ao.dicoType,an);an++})}else{ac.createTextEdgeView(aj,ak,am.name,am.dicoType,an)}})};ai=new w.Edge();if(ae==="Instance"){ai.set("geometry",new this.StepGeometry());ai.mark=""}else{ai.set("geometry",new w.AutoBezierGeometry());ai.mark=ae}ai.views.main=new this.TextEdgeView();ad.addEdge(ah,af,ai);return ai},addEdgeArrow:function z(af,ae,ad,ac){var ag;ag=new w.Edge();ag.set("geometry",new w.AutoBezierGeometry());ag.views.main=new Q.SVGEdgeView("my-first-edge-view");ag.mark=ad;ac.addEdge(af,ae,ag);return ag},createTextEdgeView:function N(af,ai,ah,ae,aj){var ag="http://www.w3.org/2000/svg",ad="http://www.w3.org/1999/xlink",ac;ac=document.createElementNS(ag,"textPath");ac.setAttributeNS(ad,"href","#"+af.display.elt.id);ac.setAttribute("startOffset","10%");if(ai.mark===""){ac.appendChild(document.createTextNode(""))}else{if(ah==="type"){ac.appendChild(document.createTextNode(A.getNLSValue(ai.mark.get(ah))));aj++}else{if(ai.mark.get(ah)){ac.appendChild(document.createTextNode(A.getNLSValue(ae+"."+ah)+": "+ai.mark.get(ah)));aj++}}}af.display.text=document.createElementNS(ag,"text");af.display.text.setAttribute("dy",-14*(aj-1)+12);af.display.text.grElt=ai;I.classListAdd(af.display.text,"edge-text");af.display.text.appendChild(ac);if(ac.innerHTML!==""){af.structure.root.appendChild(af.display.text)}},TextEdgeView:function J(){Q.SVGEdgeView.call(this)},StepGeometry:function V(){},render:function C(){var ax=S.getIconURLFromKey("Refresh");var an=e.createElement("div",{"class":"canvas-gv",id:"canvas",onmouseover:this.ondrop}),af=e.createElement("img",{src:ax,"class":"GraphViewBar",onmouseover:this.ondrop}),ap=e.createElement("div",{"class":"input-node my-node"}),ah=e.createElement("div",{"class":"my-node-header"}),au=e.createElement("div",{"class":"my-node-container"}),at=e.createElement("div",{"class":"my-node-col left"}),aj=e.createElement("div",{"class":"my-node-col right"}),ac=e.createElement("div",{"class":"myNodeLinkEdit"}),aw=e.createElement("div",{"class":"my-node-text"}),ae=e.createElement("div",{"class":"InputNodeData"}),ad=document.getElementById("canvas"),aq=document.createElementNS("http://www.w3.org/2000/svg","svg"),ao=document.createElementNS("http://www.w3.org/2000/svg","defs"),ai=document.createElementNS("http://www.w3.org/2000/svg","marker"),ar=document.createElementNS("http://www.w3.org/2000/svg","path"),al="",ag=document.head||document.getElementsByTagName("head")[0],av=document.createElement("style"),am;if(ad!==null){ad.remove(0)}aq.appendChild(ao);ao.appendChild(ai);ai.appendChild(ar);aq.setAttribute("width","0");aq.setAttribute("height","0");aq.setAttribute("style","position:absolute;");ai.setAttribute("id","arrow-edge-end-marker");ai.setAttribute("markerWidth","10");ai.setAttribute("markerHeight","8");ai.setAttribute("refX","8");ai.setAttribute("refY","4");ai.setAttribute("orient","auto");ar.setAttribute("d","M 0 0 L 10 4 L 0 8");ar.setAttribute("fill","#777");ar.setAttribute("stroke","none");ar.setAttribute("z-index","10");af.addEvent("click",this.reload);function ak(ay){e.Event.stop(ay)}an.addEvent("contextmenu",ak);an.setStyles({width:"100%",height:"100%","background-color":"white"});ap.setStyles({width:"50px",height:"50px"});aw.setStyles({top:"0px"});ae.setStyles({display:"none"});aj.appendChild(aw);ap.appendChild(ah);ap.appendChild(au);ap.appendChild(at);ap.appendChild(aj);ap.appendChild(ac);an.appendChild(ae);ae.appendChild(ap);an.appendChild(aq);af.inject(an);av.type="text/css";if(av.styleSheet){av.styleSheet.cssText=al}else{av.appendChild(document.createTextNode(al))}ag.appendChild(av);this.setContainer(an);am=this.container;if(e.is(this.options.renderTo)){am.inject(this.options.renderTo)}return this},destroy:function M(){this.stopListening();this._parent()},_onShowOptions:function k(ai,ak){var ac=[],ah=ak,ag=ai.clientX,af=ai.clientY,ad,aj,ae;aj={icon:"url("+A.getIconURLFromKey("GeneralDelete")+")",label:A.getNLSValue("LinksUI.DeleteLink"),sensitivity:"enabled",callback:function(){ad=Y.connections.get(ah);ad.destroy({proxy:"passport",headers:R.getHeaders(),wait:true,onFailure:function(){D.AlertManager.add({className:"error",message:A.getNLSValue("LinksUI.DeleteFailure")})},onComplete:function(){D.AlertManager.add({className:"success",message:A.getNLSValue("LinksUI.DeleteSuccess")})},logMessage:A.getNLSValue("LinksUI.LogMessage")})}};ae={icon:"url("+A.getIconURLFromKey("EditAttribute")+")",label:A.getNLSValue("LinksUI.EditAttribute"),sensitivity:"enabled",callback:function(){R.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIEditLinkAttributes",function al(an){var aq=Y.connections.get(ah),am=an.Config[aq.get("type")],ao,ap;if(e.is(am)){ao=am.Attribute;ap=p.getObjectAndAttributeInfos(ao);o.editAttributes(D.AlertManager,aq,ap)}else{D.AlertManager.add({className:"warning",message:A.getNLSValue("LinksUI.NoAttributes")})}})}};ac.push(aj);ac.push(ae);H.show({nodes:ac},[ag,af])},});return G});