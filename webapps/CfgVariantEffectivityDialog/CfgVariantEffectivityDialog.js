define("DS/CfgVariantEffectivityDialog/scripts/CfgVariantSkeletonModel",["UWA/Core","UWA/Class/Model"],function(b,a){return a.extend({defaults:function(){return{title:"",subtitle:"",content:"",image:"",icon:"",color:"",url:"",idModel:"",jsonAttr:"",evoExp:""}}})});define("DS/CfgVariantEffectivityDialog/scripts/CfgVariantSkeletonCollection",["UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgVariantEffectivityDialog/scripts/CfgVariantSkeletonModel","i18n!DS/CfgVariantEffectivityDialog/assets/nls/CfgVariantEffectivityDialog"],function(d,f,b,a,e,c){var g=function(h){this.options=h;cfgEditVarThat=this;return d.extend({model:e,url:f.getWebappsAssetUrl("CfgVariantEffectivityDialog","projects.json"),init:function(){this._parent(cfgEditVarThat.options)},setup:function(){if(cfgEditVarThat.options.hasEffectivity==false){console.log("Has No Effectivity, Models would be initilized to default values with Model Name and Empty Combinations")}else{cfgEditVarThat.options.finalJson=a.VariantXMLToJSONConverter(cfgEditVarThat.options.varEffXML);cfgEditVarThat.options.descJson=a.VariantDescXMLtoJSONConverter(cfgEditVarThat.options.varEffXML)}if(cfgEditVarThat.options.evoEffXML){cfgEditVarThat.options.evoExpJson=a.EvolutionXMLtoJSONforFilterVariant(cfgEditVarThat.options.evoEffXML)}},getEvoExpVal:function(l){if(Array.isArray(l)){l=l[0]}var k="";if(cfgEditVarThat.options.evoEffXML){for(var j=0;j<cfgEditVarThat.options.evoExpJson.contextsFilterXML.length;j++){if(cfgEditVarThat.options.evoExpJson.contextsFilterXML[j].name==l){k=cfgEditVarThat.options.evoExpJson.contextsFilterXML[j].expression;break}}}return k},getJsonAttrValue:function(n,m){if(Array.isArray(n)){n=n[0]}if(Array.isArray(m)){m=m[0]}var j={name:n,displayValue:m,Combinations:[]};if(cfgEditVarThat.options.hasEffectivity==true){for(var l=0;l<cfgEditVarThat.options.finalJson.length;l++){var k=JSON.parse(cfgEditVarThat.options.finalJson[l]);k.displayValue=m;if(k.name==n){if(k.Combinations.length>0){k=b.fillVariantDictionaryWithDisplayName(k,cfgEditVarThat.options.descJson);j=k}break}}}return j},parse:function(A){if(Array.isArray(A)){var o=cfgEditVarThat.options.contextData;var t=enoviaServerFilterWidget.baseURL;var s="";var z="";if(t!=null&&t!="undefined"&&t!=""){s=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png";z=enoviaServerFilterWidget.baseURL+"/common/images/iconSmallModel.png"}for(var v=0;v<=o.length-1;v++){var r=o[v];var w=r.physicalID;var q=s;if(r.preview_url!=null&&r.preview_url!="undefined"&&r.preview_url!=""){q=r.preview_url}var n=b.getAttributeValue(r.data,"Marketing Name");var x=b.getAttributeValue(r.basicData,"name");var u=c.Maturity+":"+b.getAttributeValue(r.basicData,"current");var y=c.Owner+":"+b.getAttributeValue(r.basicData,"owner");var k="<span style='color:#77797c'>"+u+"</span><br><span style='color:#77797c'>"+y+"</span>";var l=this.getJsonAttrValue(x,n);var m=this.getEvoExpVal(x);var j='{ "id": "'+v+'", "title": "'+n+'", "subtitle": "'+x+'", "content": "'+k+'","image": "'+q+'", "icon": "'+z+'", "color": "", "url": "", "idModel": "'+w+'" ,"jsonAttr":""}';var p=JSON.parse(j);p.jsonAttr=JSON.stringify(l);p.evoExp=m;A.push(p)}}return A}})};return g});define("DS/CfgVariantEffectivityDialog/scripts/CfgVariantDialogSkeleton",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","WebappsUtils/WebappsUtils","DS/W3DXComponents/Skeleton","DS/CfgVariantEffectivity/scripts/CfgVariantInit","DS/CfgVariantEffectivityDialog/scripts/CfgVariantSkeletonCollection"],function(g,e,h,b,f,c,a,d){var i=function(l){var k=new d(l);var j={bones:null,height:"300",unMaximizedHeight:null,onLoad:function(){if(j.bones){j.bones.destroy()}var n={useInfiniteScroll:false,usePullToRefresh:false};var o={contents:{useInfiniteScroll:false,usePullToRefresh:false,}};var m=g.Class.View;j.bones=new c({models:{collection:k,view:null,viewOptions:o,idCardOptions:{facets:function(){return[{text:"Model",icon:"plus-circled",handler:c.getRendererHandler("ModelsHandeler")}]}}},ModelsHandeler:{view:m.extend({name:"models-view",tagName:"div",className:"generic-detail",render:function(){return this},setup:function(){var p=this;setTimeout(function(){a.InitModelOnUI(p.container,p.model,j.bones.getCollectionAt(0))},100)}})}},{root:"projects",useRootChannelView:widget.getValue("view")==="channel",responsiveTrigger:function(){var p=widget.getView().type;if(widget.getValue("view")==="channel"){return p==="maximized"||p==="fullscreen"}else{return false}},startRoute:"/models/0/ModelsHandeler/",events:{onItemSelect:function(p){},onSlide:function(p,q){},onRouteChange:function(p){console.log("In route: "+p)}}});j.bones.render().inject(l.parent)},onViewChange:function(m){if((m.type!=="fullscreen")&&(m.type!=="maximized")){if(g.is(j.unMaximizedHeight)){j.bones.setHeight(j.unMaximizedHeight);j.unMaximizedHeight=null}}else{if(g.is(m.height)){j.unMaximizedHeight=j.bones.container.clientHeight;j.bones.setHeight(m.height)}}},};j.onLoad()};return i});define("DS/CfgVariantEffectivityDialog/scripts/CfgVariantInitDialog",["DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgVariantEffectivity/scripts/CfgVariantExpServices","DS/CfgVariantEffectivityDialog/scripts/CfgVariantDialogSkeleton","DS/CfgBaseUX/scripts/CfgContainerView","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgVariantEffectivityDialog/assets/nls/CfgVariantEffectivityDialog","css!DS/CfgVariantEffectivityDialog/assets/styles/CfgVariantEffectivityDialog.css"],function(d,a,g,f,b,i,h,e){var c={cancelDialog:function(){c.cfgVarDialog.closeDialog();console.log("cfgVarDialog closed")},setVariantEffectivity:function(){var j=f.GetGlobalXMLExpression();console.log("Variant XMLExpression : "+j);this.CfgUXEnvVariables=JSON.parse(h);var o=this.CfgUXEnvVariables.isVariantSplitEnabled;var k=function(r){console.log(r);for(var x in r.expressions){if(r.expressions.hasOwnProperty(x)){if(r.expressions[x].content!=undefined&&r.expressions[x].content.Variant!=undefined){var q=r.expressions[x].content.Variant;r.expressions[x].content.displayExpression=g.getDisplayExpressionUsingXSLT(q)}}}var u=" ";if(r.GlobalStatus!=undefined&&r.GlobalStatus=="SUCCESS"){var y=r.results[0];var v=y.existing;var s=y["new"];if(v!=undefined&&v.id!=undefined){u=v.id;if(v.content!=undefined&&v.content.Variant!=undefined){var w=v.content.Variant;r.results[0].existing.content.displayExpression=g.getDisplayExpressionUsingXSLT(w)}}if(s!=undefined&&s.id!=undefined){u=s.id;if(s.content!=undefined&&s.content.Variant!=undefined){var p=s.content.Variant;(r.results[0])["new"].content.displayExpression=g.getDisplayExpressionUsingXSLT(p)}}}if(c.varOptions.postOKHandler){c.varOptions.postOKHandler(r)}if(o==false){if(c.varOptions.PADContext){c.varOptions.PADContext.get().getPADTreeDocument().withTransactionUpdate(function(){g.refreshEffectvity(c.varOptions.selectedNodes,"Variant","All")})}}else{if(o==true){if(u!=" "){var t=[];t.push(u);if(c.varOptions.PADContext){c.varOptions.PADContext.get().getPADTreeDocument().withTransactionUpdate(function(){g.refreshSplitEffectivity(c.varOptions.selectedNodes,"All","All",t)})}}}}c.cfgVarDialog.closeDialog();if((o==false)&&((r.expressions!==undefined&&r.expressions[c.varOptions.instanceID].status.toUpperCase()==="SUCCESS"&&r.expressions[c.varOptions.instanceID].hasEffectivity.toUpperCase()!=="ERROR")||(r.unset!==undefined&&(r.unset.Variant.status.toUpperCase()==="SUCCESS"||r.unset.Variant.status.toUpperCase()==="WARNING")))){g.showwarning(e.Save_Successful_Var_Effectivity,"success")}else{if((o==true)&&((r.GlobalStatus!==undefined&&r.GlobalStatus=="SUCCESS")||(r.unset!==undefined&&(r.unset.Variant.status.toUpperCase()==="SUCCESS"||r.unset.Variant.status.toUpperCase()==="WARNING")))){g.showwarning(e.Save_Successful_Var_Effectivity,"success")}else{g.showwarning(e.Save_Fail_Var_Effectivity,"error")}}};var m=function(p){console.log(p);c.cfgVarDialog.closeDialog();g.showwarning(e.Save_Fail_Var_Effectivity,"error")};var n=null;if(c.varOptions.ca.headers.length>0){n={operationheader:{key:c.varOptions.ca.headers[0].key,value:c.varOptions.ca.headers[0].value}}}var l;if(j==""){l={wsOptions:n,instanceID:c.varOptions.instanceID,domain:"Variant"};g.unsetEffectivity(l).then(function(p){k(p)},function(p){m(p)})}else{if(o==false){l={version:"1.1",domain:"Variant",view:"All",expressionList:[{pid:c.varOptions.instanceID,expressions:[{domain:"Variant",content:j}]}],wsOptions:n};g.setMultipleFilterableObjectInfo(l).then(function(p){k(p)},function(p){m(p)})}else{if(o==true){l={version:"1.0",domain:"Variant",view:"All",expressionList:[{pid:c.varOptions.instanceID,VariantContent:j}],wsOptions:n};g.setVariantEffectivities(l).then(function(p){k(p)},function(p){m(p)})}}}},onSaveEffectivity:function(k){if(window.enoviaServerFilterWidget.mode=="Native"){var l={modelIdsWithEffectivity:f.GetModelswithEffExpression(),globalEffectivityExpression:f.GetGlobalXMLExpression(),propagateSessionEffectivity:k.propagateSessionEffectivity,};var j={eventName:"cfgEditVariantEffectivity",operation:(k.buttonId=="firstButton")?"OK":"Cancel",operationVersion:"1.0",content:JSON.stringify(l)};g.sendNotificationWebInWin(j)}},init:function(k){d.clear();this.varOptions=k;var m=this;if(this.varOptions.mode=="Dashboard"){this.varOptions.dialogue.buttonArray=[{label:e.Edit_Var_OK,handler:m.setVariantEffectivity,className:"primary"},{label:e.Edit_Var_Cancel,handler:m.cancelDialog,className:"default"}];this.cfgVarDialog=new a(this.varOptions);this.cfgVarDialog.render();this.varOptions.parent=this.cfgVarDialog.container;this.varOptions.parentElement=this.cfgVarDialog.container;var j=new b(this.varOptions)}else{var l={isHeader:false,isFooter:true,firstButtonText:e.Edit_Var_OK,secondButtonText:e.Edit_Var_Cancel,headerText:"",toggleSessionEffectivity:false,onButtonClickCB:m.onSaveEffectivity,};this.variantContainer=new i(l).render();this.variantContainer.inject(k.parentElement);this.varOptions.parent=this.variantContainer._body;var j=new b(this.varOptions)}}};return c});