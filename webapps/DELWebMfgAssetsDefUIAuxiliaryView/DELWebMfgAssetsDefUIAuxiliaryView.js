define("DS/DELWebMfgAssetsDefUIAuxiliaryView/AuxiliaryViewDDManager",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/DELWebMfgAssetsDefUIServices/AbstractDragAndDropManager"],function(f,c,b,e){var d=e.singleton({init:function(g){this._parent(g);if(b){this._logger=b.getLogger(d)}this._displayModelRootAttribute="asRootInAuxiliaryView"},computeAddToTreelistOptions:function a(){var g={context:this,elementUI:"TreeUI",withLinksResolved:false};return g},onDropCell:function(h,g){return d.onTreeListViewDrop(h,g)},onDropBlank:function(h,g){return d.onTreeListViewDrop(h,g)}});return d});define("DS/DELWebMfgAssetsDefUIAuxiliaryView/AuxiliaryView",["UWA/Core","UWA/Class/Debug","DS/Logger/Logger","DS/Core/Events","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefUIServices/CommandsManager","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefUIServices/AbstractView","DS/DELWebMfgAssetsDefUIControls/Preferences","DS/DELWebMfgAssetsDefUIAuxiliaryView/AuxiliaryViewDDManager"],function(g,q,t,l,i,e,c,b,s,u,w,n,d,a){var j=n.extend(q,{name:"auxiliaryView",_logger:null,_modelEvents:{"onChange:displayModel":function h(z,B){var A,y,C=function C(E,D){if(g.is(D)){if(!D.isExpanded()){D.expand()}}};if(z.isReference()){if(z.get("displayModel").hasChanged("asRootInAuxiliaryView")){if(z.get("displayModel").previous("asRootInAuxiliaryView")){if(!B.get("asRootInAuxiliaryView")){this.treeListView.utils.hide(z,true);this.removeRootToPreferences(z.id,"AUX")}}else{if(B.get("asRootInAuxiliaryView")){y=z.get("PPRTYPE");if(y==="OPERATION"){y="SYSTEM"}A=u.getMGAElement("AuxiliaryViewTypeFilter");if(!A.isSelected(y)){A.selectItem(y)}this.treeListView.utils.addToTreeList(z,{silentMode:true,withLinksResolved:false,onEndLoading:C});d.addRootToPreferences(z.id,"AUX");widget.dispatchEvent("onShowAuxView",[{PPRType:z.get("PPRTYPE")}])}}}}return this},onChange:function p(A){var D=A.changedAttributes(),z,C=false,B,y;if(D.hasOwnProperty(this.treeListView._label)&&((this.treeListView._labelIsOnRef&&A.isReference())||(!this.treeListView._labelIsOnRef&&A.isInstance()))){z=this.treeListView.getDocument();z.prepareUpdate();if(A.isInstance()){C=true}B=D[this.treeListView._label];y=this.treeListView.utils.search(A.id,"PID",C);y.forEach(function(E){E.setLabel(B);E.notifyModelUpdate()});z.pushUpdate()}return this},onAdd:function o(z,A,y){if(z.isInstance()){this.treeListView.utils.addToTreeList(z,y)}return this},onRemove:function f(y){this.treeListView.utils.hide(y);this.removeRootToPreferences(y.id,"AUX");if(y.isReference()){this.treeListView.utils.filter.onNodeRemove(y.id)}return this}},_modelDocEvents:{onAdd:function o(y,z){b.changeDocCmdAvailability(y,z,this.treeListView)},onRemove:function f(y,z){b.changeDocCmdAvailability(y,z,this.treeListView)}},setup:function k(A){var z=this,B;A=A||{};this._context=A.context;if(g.is(t)){z._logger=t.getLogger(j)}this.listenTo(this.options.referenceCollection,this._modelEvents);this.listenTo(this.options.instanceCollection,this._modelEvents);this.listenTo(this.options.documentConnectionCollection,this._modelDocEvents);B=g.extend(a.getDDBehavior(),this._getContextualMenu());B=g.extend(B,u.getEditionManager(this));this.treeListView=u.createTreelistview({treelistviewOptions:B,preferences:{createTree:true},name:this.name});this.render();u.getMGAElement("AuxiliaryViewTypeFilter").addEvent("onChange",function y(){var D=this.getSelectedItems();z.treeListView.utils.filter.filterByType(D)});this._handleEvents("selectedInAuxiliaryView",{isManageCommandAvailability:g.is(this.options.isManageCommandAvailability)?this.options.isManageCommandAvailability:true});l.subscribe({event:"DELWebMfgAssetsDefUI/prepareUpdate"},function(){z.treeListView.utils._treeDocument.prepareUpdate()});l.subscribe({event:"DELWebMfgAssetsDefUI/pushUpdate"},function(){z.treeListView.utils._treeDocument.pushUpdate()});l.subscribe({event:"updateViews"},function C(D){var E;z.treeListView.utils._treeDocument.prepareUpdate();D.forEach(function F(G){E=z.treeListView.utils._treeDocument.getNodeModel(G,{searchReferencePID:true});if(g.is(E)){if(g.is(E,"array")){E.forEach(function(H){H.updateBI()})}else{E.updateBI()}}});z.treeListView.utils._treeDocument.pushUpdate()})},destroy:function r(){this.stopListening();this._parent()},render:function x(){this.setContainer(this.treeListView.getContent());if(g.is(this.options.renderTo)){this.container.inject(this.options.renderTo)}return this},_loadStoredRoots:function m(A){var z=this,C={action:[],parameters:[]};if(g.is(A)){A.forEach(function(D,E){C.action[E]="addRoot";C.parameters[E]={rootReferencePID:D}});z.treeListView.utils.prepareUpdate();a.processDropEffect(C).then(function y(){z.treeListView.utils.pushUpdate()}).fail(function B(D){z.treeListView.utils.pushUpdate();z._logger.error("processDropEffect failed")})}},_getContextualMenu:function v(){var y=this,A={};A.onContextualMenuReady=function z(E){var F={},C=[],D=E.nodeModel,B=E.manager;if("MFN"===e.getWidgetTrigram()){y._context.setFocus("AUXILIARY")}if(!g.is(E)){return}if(g.is(this.getVirtualCoordinates,"function")){F=this.getVirtualCoordinates()}if(-1===F.virtualRowID){C=[{icon:"url("+s.getIconURLFromKey("SortAToZ")+")",label:"Sort A to Z",callback:function(){B.sortColumnContent(F.virtualColumnID,{sortOrder:"asc"})}},{icon:"url("+s.getIconURLFromKey("SortZToA")+")",label:"Sort Z to A",callback:function(){B.sortColumnContent(F.virtualColumnID,{sortOrder:"desc"})}}]}else{if(0<=F.virtualRowID){if(g.is(D)){if(!D.isSelected()){y.treeListView.getDocument().unselectAll();D.select()}}C=u.buildContextualMenuNodes(["Relations"],c.getActionBarContext());C.push({type:"separator"});C=C.concat(u.buildContextualMenuNodes(["Hide","Refresh","ExploreInWebApp"],c.getActionBarContext()))}}if("MFN"!==e.getWidgetTrigram()){C.push({type:"separator"});C=C.concat(u.buildContextualMenuNodes(u.getDefaultContextualMenu(),c.getActionBarContext()))}return C};return A}});return j});