define("DS/FolderActive/utils/FolderActiveCommunication",["DS/PlatformAPI/PlatformAPI"],function(b){var c="webinwin:win:notification";var a="webinwin:web:notification";var d={publish:function(e,g,f){b.publish(e,g);if(f!==false){b.publish(a,JSON.stringify({event:e,content:g}))}},subscribe:function(e,i,f){var g=window;var h=function(){if(g===top||!!g.parent){return i.apply(this,arguments)}throw new Exception("widget has been destroyed")};b.subscribe(e,h);if(f!==false){b.subscribe(c,function(j){if(typeof j==="string"){j=JSON.parse(j)}if(j&&j.event===e){h(j.content)}})}}};return d});define("DS/FolderActive/service/FolderActiveWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/FolderActive/assets/nls/FolderActive","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","text!DS/FolderActive/assets/FolderActive_setting.json","DS/WidgetServices/WidgetServices"],function(f,g,c,e,d,a,l){function k(m){return UWA.is(m,"array")?m.toString():m}function i(){return new Promise(function(n,m){l.get3DSpaceUrlAsync({onComplete:function(o){n(o)},onFailure:function(o){m(o)}})})}function j(){return new Promise(function(n,m){l.get3DSearchUrlAsync({onComplete:function(o){n(o)},onFailure:function(o){m(o)}})})}var h=function(){var n=["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies"];var m=["icon","thumbnail_2d"];return{with_indexing_date:true,select_predicate:n,select_file:m,order_field:"ds6w:modified",order_by:"desc",nresults:25}};var b={_orderField:"ds6w:label",_orderBy:"asc",getSetting:function(){return JSON.parse(a)},getShowContentInViewSetting:function(){return window.top.showContentInView!==undefined?window.top.showContentInView:this.getSetting().showContentInView},setOrder:function(n,m){this._orderField=n||this._orderField;this._orderBy=m||this._orderBy},getSpecific_source_parameter:function(m,n){return{"3dspace":{search_in_context:{expand:{root_physicalid:m,expand_iter:n?"-1":"1",type_filter_bo:["Workspace Vault","Workspace"]}}}}},getLabel:function(){var n="ActiveBookmark";var m=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return n+"-"+m+"-"+(new Date()).getTime()},getTenantID:function(){return window.top.tenantId||l.getTenantID()},getSecurityContext:function(){var n=e.getSetting("pad_security_ctx");if(!n&&widget.hasPreference("Current_security_credentials")){var m=widget.getPreference("Current_security_credentials");if(m.defaultValueNonNls!==undefined&&m.defaultValueNonNls!==null&&m.hasOwnProperty("defaultValueNonNls")){n="ctx::"+m.defaultValueNonNls}}return window.top.securityContext||n||this._securityContext},getSearchQuery:function(){return'type: "Workspace"'},getType_filter_bo:function(){return["Workspace","Workspace Vault"]},getSelect_bo:function(){return["ds6w:label","ds6w:what/ds6w:type","physicalid","ds6w:when/ds6w:created","ds6w:when/ds6w:modified"]},generateSearchQuery:function(n,m){return'(type: "Workspace" OR type: "Workspace Vault") AND (label: *'+n+'*) AND NOT physicalid: "'+m+'"'},_getSecurityContext:function(m){var n=this;var q=m;var p={url:"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",verb:"GET"};var o=q.tenant?q.tenant:this.getTenantID();i().then(function(t){var s=t+p.url+"&tenant="+o;var r=widget.lang?widget.lang:widget.getValue("lang");q.method=p.verb;q.headers={Accept:"application/json","Accept-Language":r,"Content-Type":"application/json"};q.cache=-1;q.withoutSC=true;return n._executeRequest(s,q,true)})},fetchInActiveBookmark:function(n){var q=this;var r={};UWA.extend(r,n);if(!UWA.is(r,"object")){throw new Error("Invalid inputs for FolderActiveWebService.fetchInActiveBookmark")}var m="";var o="";var p=null;var q=this;j().then(function(z){var y=z+"/search";var w=widget.lang?widget.lang:widget.getValue("lang");r.payload=h();r.payload.order_by=q._orderBy;r.payload.order_field=q._orderField;r.payload.locale=w;r.payload.query='NOT physicalid: "'+n.pid+'"';r.payload.tenant=q.getTenantID();var t=q.getSetting().numberOfResultsDisplay;r.payload.nresults=n.nresults||parseInt(t)||r.payload.nresults;r.payload.next_start=undefined;r.payload.start=undefined;r.payload.source=["3dspace"];r.payload.label=q.getLabel();delete r.payload.specific_source_parameter;var v=q.getShowContentInViewSetting();var t=q.getSetting().numberOfResultsDisplay;r.payload.specific_source_parameter=q.getSpecific_source_parameter(n.pid);var x=0;if(n.next_start!=null){r.payload.next_start=n.next_start}else{r.payload.start=0}r.method="POST";r.headers={Accept:"application/json","content-type":"application/json","Accept-Language":w};r.type="json";r.data=UWA.Json.encode(r.payload);r.withoutSC=true;r.timeout=120000;var u=r.onComplete;var s=r.onFailure;if(!n.isContentSearch){r.onComplete=function(B){B.results=B.results||[];var C=B.results.length;var A=t-C;if(A>0&&v&&!n.hideContent){r.payload.nresults=A;r.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:n.pid,expand_iter:"1",type_filter_bo:[],}}}};r.onComplete=function(E){E.results=E.results||[];E.results=B.results.concat(E.results);var D=B.infos.nhits+E.infos.nhits;E.isEnd=E.results.length===D;E.isContentSearch=true;u&&u(E)};r.onFailure=function(D){s&&s(D)};p=q.fetchContent(y,r)}else{B.isEnd=B.results&&B.results.length===B.infos.nhits;u&&u(B)}};r.onFailure=function(A){s&&s(A)};p=q._executeRequest(y,r,"searchInFolder")}else{r.onComplete=function(B){var A=B.infos.next_start.split(" ")[0];B.isEnd=A===B.infos.nhits+"";B.isContentSearch=true;u&&u(B)};r.onFailure=function(A){s&&s(A)};p=q.fetchContent(y,r)}})},fetchContent:function(n,m){m.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:m.pid,expand_iter:"1",no_type_filter_bo:["Workspace Vault","Workspace"]}}}};m.payload.label=this.getLabel();m.data=UWA.Json.encode(m.payload);return this._executeRequest(n,m,"searchInFolder")},initSecurityContext:function(){var m=this;return new Promise(function(o,n){m._getSecurityContext({onComplete:function(q){var p=JSON.parse(q);m._securityContext="ctx::"+p.preferredcredentials.role.name+"."+p.preferredcredentials.organization.name+"."+p.preferredcredentials.collabspace.name;o(m._securityContext)},onFailure:function(p){console.log(p);n(p)}})})},pathInActiveBookmark:function(m){var n=this;if(!this.getSecurityContext()){this.initSecurityContext().then(function(o){n._pathInActiveBookmark(m)})}else{this._pathInActiveBookmark(m)}},_pathInActiveBookmark:function(n){var r={};UWA.extend(r,n);if(!UWA.is(r,"object")){throw new Error("Invalid inputs for FolderActiveWebService.pathInActiveBookmark")}var m="";var o="";var q=null;var p=this;i().then(function(v){var u=v+"/cvservlet/navigate";var s=widget.lang?widget.lang:widget.getValue("lang");r.payload={};r.payload.locale=s;r.payload.order_by=p._orderBy;r.payload.order_field=p._orderField;r.payload.tenant=p.getTenantID();r.payload.input_physical_ids=n.ids;r.payload.attributes=["ds6w:label","ds6w:type"];r.payload.version=3;r.payload.primitives=[{navigate_from_rel:{id:1}}];r.payload.patterns={GET_PARENT:[{id:1,iter:-1}]};r.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}};r.payload.attributes=["ds6w:label","ds6w:type"];r.payload.next_start=undefined;r.payload.start=undefined;r.payload.source=["3dspace"];r.payload.label=p.getLabel();delete r.payload.specific_source_parameter;var t=0;if(n.next_start!=null){r.payload.next_start=n.next_start}else{r.payload.start=0}r.method="POST";r.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s};r.type="json";r.data=UWA.Json.encode(r.payload);r.query={SecurityContext:p.getSecurityContext()};r.timeout=120000;q=p._executeRequest(u,r,"searchInFolder")})},searchInActiveBookmark:function(n){var t={};UWA.extend(t,n);if(!UWA.is(t,"object")){throw new Error("Invalid inputs for FolderActiveWebService.searchInActiveBookmark")}var m="";var o="";var r=null;var p=n.searchKey?this.generateSearchQuery(n.searchKey,n.pid):this.getSearchQuery();var s=p;var q=this;j().then(function(y){var x=y+"/search";var v=widget.lang?widget.lang:widget.getValue("lang");t.payload=h();t.payload.locale=v;t.payload.order_by=q._orderBy;t.payload.order_field=q._orderField;t.payload.query=s;t.payload.tenant=q.getTenantID();t.payload.next_start=undefined;var u=q.getSetting().numberOfResultsDisplay;t.payload.nresults=n.nresults!==undefined?n.nresults:parseInt(u)||t.payload.nresults;t.payload.start=undefined;t.payload.source=["3dspace"];t.payload.label=q.getLabel();delete t.payload.specific_source_parameter;if(n.pid){t.payload.specific_source_parameter=q.getSpecific_source_parameter(n.pid,true)}var w=0;if(n.next_start!=null){t.payload.next_start=n.next_start}else{t.payload.start=0}t.method="POST";t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":v};t.type="json";t.data=UWA.Json.encode(t.payload);t.withoutSC=true;t.timeout=120000;r=q._executeRequest(x,t,"searchInFolder")})},expandInActiveBookmark:function(n){if(n.isRoot){n.nresults=1000;return this.searchInActiveBookmark(n)}var r={};UWA.extend(r,n);if(!UWA.is(r,"object")){throw new Error("Invalid inputs for FolderActiveWebService.expandInActiveBookmark")}var m="";var o="";var q=null;var p=this;i().then(function(v){var u=v+"/cvservlet/expand";var s=widget.lang?widget.lang:widget.getValue("lang");r.payload=h();r.payload.locale=s;r.payload.tenant=p.getTenantID();r.payload.next_start=undefined;r.payload.start=undefined;r.payload.source=["3dspace"];r.payload.label=p.getLabel();delete r.payload.specific_source_parameter;r.payload.root_physicalid=n.pid;r.payload.type_filter_bo=p.getType_filter_bo();r.payload.select_bo=p.getSelect_bo();r.payload.expand_iter=r.level==="All"?"-1":"1";var t=0;if(n.next_start!=null){r.payload.next_start=n.next_start}else{r.payload.start=0}r.method="POST";r.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s};r.type="json";r.data=UWA.Json.encode(r.payload);r.withoutSC=true;r.timeout=120000;q=p._executeRequest(u,r,"searchInFolder")})},getUserPreferences:function(m){var p=m;if(!UWA.is(p,"object")){throw new Error("Invalid inputs for FolderActiveWebService.getUserPreferences")}var o=this;var n=null;n=l.getCompassUrlAsync({onComplete:function(q){var s=q+"/resources/AppsMngt/user/getPreferences";p.query={name:p.name};p.method="GET";p.headers={Accept:"application/json",SecurityContext:undefined};p.withoutTenant=true;var r=o._executeRequest(s,p,"getUserPreferences");if(n){n.cancel=r.cancel}else{n=r}}});return n},roots:function(m){var o=m;if(!UWA.is(o,"object")){throw new Error("Invalid inputs for FolderActiveWebService.roots")}var n=this;i().then(function(q){var p=q+"/resources/v1/FolderManagement/Folder/roots";o.query={Type:o.type,CollabSpace:o.collabSpace};o.method="GET";return n._executeRequest(p,o,"roots")})},_executeRequest:function(t,p,n){var q=(Math.round(Math.random()*1000)).toString();var r=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("folderRequest_begin"+q);var s={};UWA.extend(s,p);if(!UWA.is(s.onTimeout,"function")){s.onTimeout=function(){var u={type:"timeout",toString:function(){return c.msg_InfoAction_Timeout}};s.onFailure(u)};s.onComplete=function(v){window.top.performance.mark("folderRequest_end"+q);var u=window.top.performance.getEntriesByName("folderRequest_begin"+q);if(u&&u.length===1){window.top.performance.measure(r+"_Request"+n,"folderRequest_begin"+q,"folderRequest_end"+q);window.top.performance.clearMarks("folderRequest_end"+q);window.top.performance.clearMarks("folderRequest_begin"+q)}p.onComplete(v)}}var m={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};if(!p.withoutSC){m.SecurityContext=encodeURIComponent(this.getSecurityContext())}if(p.headers){s.headers=UWA.extend(m,p.headers)}else{s.headers=m}if(!UWA.is(s.query)){s.query={}}if(!s.query.tenant&&p.withoutTenant!==true){s.query.tenant=this.getTenantID()}var o=t;o+="?"+UWA.Utils.toQueryString(s.query);return g.authenticatedRequest(o,s)}};return b});define("DS/FolderActive/service/FolderTypeService",["UWA/Controls/Abstract"],function(b){var a=b.singleton({TYPE_ROOT_FOLDER_1:"Workspace",TYPE_ROOT_FOLDER_2:"RootFolder",TYPE_FOLDER_1:"Workspace Vault",TYPE_FOLDER_2:"Folder",TYPE_FOLDER_3:"Workspace Folder",TYPE_PERSONAL_FOLDER_1:"Personal Workspace",TYPE_FOLDERS_SECTION:"FolderSection_AllFolders",TYPE_FAVORITES_SECTION:"FolderSection_favorite",init:function(){},isRootFolder:function(c){return c===this.TYPE_ROOT_FOLDER_1||c===this.TYPE_ROOT_FOLDER_2},isFolder:function(c){return(c===this.TYPE_FOLDER_1||c===this.TYPE_FOLDER_2||c===this.TYPE_FOLDER_3)},isPersonalFolder:function(c){return c===this.TYPE_PERSONAL_FOLDER_1},inFamilyFolder:function(c){return(this.isRootFolder(c)||this.isFolder(c)||this.isPersonalFolder(c))},isSection:function(c){return(c===this.TYPE_FOLDERS_SECTION||c===this.TYPE_FAVORITES_SECTION)}});return a});define("DS/FolderActive/commands/FolderCommands",["i18n!DS/FolderActive/assets/nls/FolderActive","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils"],function(c,d,b){var a={ExpandAllCmd:function(g,h){var f=g.plmType;var e=[];if(h==="TREE"&&g){e.push(g)}if(e.length){e.forEach(function(i){if(i.options.children===null){}else{if(h==="TREE"||i.plmType==="Folder"||i.plmType==="FolderSection_AllFolders"){i.expand({expandLevel:"All"})}else{i.expandAll()}}})}},CollapseAllCmd:function(g,h){var f=g.plmType;var e=[];if(h==="TREE"&&g){e.push(g)}if(e.length){e.forEach(function(i){i.collapseAll()})}},_addCtxCmd:function(g,e,i,h){var f=false;if(i.type==="separator"){f=true}else{if(i.spaceAvailability!==false){f=true}}if(f){if(d.isWebInWinEnvironment()){if(i.webInWinAvailability===false){f=false}}if(!d.isWebInWinEnvironment()&&i.dashboardAvailability===false){f=false}}if(f){if(h&&(h.type!=="separator"||e.length>0)){e.push(h)}e.push(i)}},GetContextualMenuForActiveBookmark:function(k,e){var g=this;var f=[];var h;var j=k.white_Click?k.white_Click:false;h=j===true?h=Folder_CSO.getCurrentFolder():k.nodeModel;if(h===undefined){h=k}var l={label:c.CMDExpandAll,icon:"url("+b.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",callback:function(){g.ExpandAllCmd(h,e)},searchAvailability:true};var m={label:c.CMDCollapseAll,icon:"url("+b.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",callback:function(){g.CollapseAllCmd(h,e)},searchAvailability:true};var i={type:"separator"};this._addCtxCmd(e,f,l,i);this._addCtxCmd(e,f,m);return f}};return a});define("DS/FolderActive/NestedMenu/NestedMenu",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/Tree/Tree","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Tree/TreeNodeView","DS/UIKIT/Spinner","DS/UIKIT/Mask"],function(e,f,i,j,a,d,g,b,c){var h=e.extend(f,i,{name:"NestedMenu",_historyStore:{},_historyCursor:[],_historyNodeModel:{},_searchKeys:{},_inSearchPanel:false,_sortField:"alpha",_sortBy:"desc",_parentMap:{},init:function(k){var l=this;this._master=k.master;this._onPreExpandTreeNode=k.onPreExpandTreeNode;this._onPreCollapseTreeNode=k.onPreCollapseTreeNode;this._onInfiniteScrollAsync=k.onInfiniteScrollAsync;this._firstScreenFetch=k.firstScreenFetch;this._onContextualMenuReady=k.onContextualMenuReady;this._fetchData=k.fetchData;this._getPath=k.getPath;this._sortByReload=k.sortByReload;this._searchData=k.searchData;this._sortFunction=k.sortFunction;this._shouldDisplayTooltip=k.shouldDisplayTooltip;this._couldBeSelected=k.couldBeSelected;this._msg_empty=k.showMessageWhileEmpty;this._msg_resultEmpty=k.showMessageWhileResultEmpty;this.nestedMenuContainer=k.container},render:function(){this._buildSkeleton()},initData:function(){var k=this;this._isInitializedData=true;k.initNavigator("",[]);c.mask(this.nestedMenuContainer);k.hideEmptyView();k._firstScreenFetch().then(function(l,m){k.NavigatorTo(m&&m.options.id,l);c.unmask(k.nestedMenuContainer);if(k._activeBookmarkId){k.focusToActiveView(k._activeBookmarkId)}})},updateView:function(){var k=this;setTimeout(function(){k._treeView.getManager().setScrollerPosition({})},10)},setActiveNode:function(k){this._activeBookmarkId=k;if(!k){this._manager.unselectAll()}},focusToActiveView:function(l){var k=this;if(this._getCurrentCursor()!==l){c.mask(this.nestedMenuContainer);Promise.all([this._getPath(l),this._fetchData(l)]).then(function(p){var s=p[0];k._parentMap=s;if(k._parentMap&&Object.keys(k._parentMap).length>1){var n=Object.keys(k._parentMap).slice(-2,-1)[0];n=k._parentMap[n]}for(var q in k._parentMap){var r=k._parentMap[q];k._historyNodeModel[r.parentId]={id:r.parentId,label:r.parentName,getID:function(){return this.id},getLabel:function(){return this.label}}}var m=p[1];if(!n||n.parentId!==k._getCurrentCursor()){var o=k._historyStore[n.parentId];k.clearNavigator();if(o){k.NavigatorTo(n.parentId,o)}else{k.NavigatorTo(l,m)}}else{k._manager.unselectAll()}k.getNodeModelById(l)&&k.getNodeModelById(l).select();c.unmask(k.nestedMenuContainer)})}},backWithNewRequest:function(){var l=this;c.mask(this.nestedMenuContainer);var k=this._parentMap[this._getCurrentCursor()];if(k&&k.parentId){this._fetchData(k.parentId).then(function(m){l.clearNavigator();l.NavigatorTo(k.parentId,m);c.unmask(l.nestedMenuContainer)})}else{this._firstScreenFetch().then(function(m){l.clearNavigator();l.NavigatorTo("",m);c.unmask(l.nestedMenuContainer)})}},getNodeModelById:function(k){return k&&this._treeView.getDocument().getAllDescendants().filter(function(l){return l.getID&&l.getID()===k})[0]},getDocument:function(){return this._treeView&&this._treeView.getDocument()},initNavigator:function(m,k){k=[].concat(k);if(!this._historyCursor||!this._historyStore||!this._manager){this._historyStore=this._historyStore||{};this._historyStore[m]=k;this._historyCursor=this._historyCursor||[m];var l=this._treeView&&this._treeView.getManager()}},clearNavigator:function(){this._historyCursor=[]},NavigatorBack:function(){if(this._historyCursor.length>1){var l=this._historyCursor.pop();this._previousSearch=null;if(l&&l.indexOf("search")===0){this._previousSearch={id:l,key:this._searchKeys[l]}}else{}var n=this._historyCursor[this._historyCursor.length-1];var k=this._historyStore[n];var m=this._manager.getDocument();m.prepareUpdate();m.removeRoots();this._checkViewDisplay(n,k);k.forEach(function(o){m.addRoot(o)});this._manager.updateView(true);m.pushUpdate();this.updateView();this.dispatchEvent("Navi_Back",{nodeModel:this._historyNodeModel[n],nodeId:n})}else{if(this._getCurrentCursor()&&this._getCurrentCursor().indexOf("search")===-1){this.backWithNewRequest()}}},addMoreModelInExisted:function(n,k){var l=this;var m=this._manager.getDocument();k=[].concat(k);this._historyStore[n]=this._historyStore[n].concat(k);if(n===l._getCurrentCursor()){m.prepareUpdate();k.forEach(function(o){o&&l._manager.getDocument().addRoot(o)});l._manager.updateView(true);m.pushUpdate()}},NavigatorTo:function(n,k){var l=this;if(n!==this._getCurrentCursor()){this._previousSearch=null}l._historyNodeModel[n]=this.getNodeModelById(n)||l._historyNodeModel[n];var m=this._manager.getDocument();k=k||this._historyStore[n];m.prepareUpdate();m.removeRoots();if(k){k=[].concat(k);this._checkViewDisplay(n,k);k.forEach(function(o){o&&l._manager.getDocument().addRoot(o)});l._historyStore[n]=k}l._manager.updateView(true);m.pushUpdate();this.updateView();if(!n||l._historyCursor.indexOf(n)===-1){l._historyCursor&&l._historyCursor.push(n)}l.dispatchEvent("Navi_To",{nodeModel:this._historyNodeModel[n],nodeId:n})},_checkViewDisplay:function(m,k){if(!k||k.length===0){var l=(m&&m.indexOf("search")===0)?this._msg_resultEmpty:this._msg_empty;this.showEmptyView(l)}else{this.hideEmptyView()}},applySort:function(l,p,k){this._sortField=l||this._sortField;this._sortBy=p||this._sortBy;var n=this;var o=this._getCurrentCursor();var m=this._treeView.getManager();m.sortColumnContent("tree",{sortOrder:(o&&this._sortField==="date")?"asc":this._sortBy,sortMode:this._sortField,sortFunction:function(r,q){return n._sortFunction?n._sortFunction(n._sortField,n._sortBy,r,q):k(r,q)}})},applySortByReload:function(k,n){var l=this;var m=this._getCurrentCursor();if(this._sortByReload){c.mask(this.nestedMenuContainer);this._sortByReload(m,k,n).then(function(o){o&&l.NavigatorTo(m,o);l.applySort(k,n);c.unmask(l.nestedMenuContainer)})}},_getCurrentCursor:function(){return this._historyCursor&&this._historyCursor.slice(-1)[0]},_getPidOfSearch:function(l){var k=this._historyCursor.indexOf(l);return k<1?undefined:this._historyCursor[k-1]},startSearch:function(){this._inSearchPanel=true;document.body.addEventListener("keydown",this.escKeyEvent.bind(this));var k="search"+Date.now();if(this._previousSearch){k=this._previousSearch.id}this.NavigatorTo(k)},endSearch:function(){this._inSearchPanel=false;document.body.removeEventListener("keydown",this.escKeyEvent.bind(this));var k=this._getCurrentCursor();if(k&&k.indexOf("search")===0){this.NavigatorBack()}},escKeyEvent:function(k){var l=k.keyCode||k.which;if(l=="27"){this.endSearch()}},search:function(l){var m=this;c.mask(m.nestedMenuContainer);m.hideEmptyView();var n=m._getCurrentCursor();if(!n||n.indexOf("search")!==0){n="search"+Date.now()}var k=m._getPidOfSearch(n);this._searchData(l,n,k).then(function(o){m._searchKeys[n]=l;o&&m.NavigatorTo(n,o);c.unmask(m.nestedMenuContainer)})},onInfiniteScrollAsync:function(k){var l=this;var m=l._getCurrentCursor();this._onInfiniteScrollAsync(m,k).then(function(p){var n=p.children;var o=p.sort;l.addMoreModelInExisted(m,n);if(m===l._getCurrentCursor()){o&&l.applySort(o.sortField,o.sortBy)}l._manager.infiniteScrollAsyncProcessDone()})},getSearchKeyById:function(k){return this._searchKeys[k]},showEmptyView:function(k){this.emptyView.show();this.emptyView.innerText=k||this._msg_empty},hideEmptyView:function(){this.emptyView.hide()},_onPreCollapse:function(k){var l=this._getCurrentCursor();return this._onPreCollapseTreeNode(k,l)},_onPreExpand:function(k){if(k.data.onlyUI){k.target.preExpandDone();return}else{var l=this._getCurrentCursor();return this._onPreExpandTreeNode(k,l)}},_buildSkeleton:function(){var m=this;var l={apiVersion:2,useAsyncPreExpand:true,allowUnsafeHTMLContent:true,height:"auto",defaultCellHeight:38,infiniteScrolling:true,onContextualEvent:{"this":this,callback:function(n){return this._onContextualMenuReady(n)}},columns:[{dataIndex:"tree",},{dataIndex:"access",width:38,isEditable:false,isDraggable:false,onCellRequest:function(p){var s=p.nodeModel;s.getID=s.getID||function(){return this.options.id};s.getType=s.getType||function(){return this.options.plmType};s.getLabel=s.getLabel||function(){return this.options.label};if(!p.isHeader&&(p.nodeModel.getType()!=="Content"&&p.nodeModel.getType()!=="Path")){var n=UWA.createElement("span",{"class":"fonticon fonticon-chevron-right"});var q=p.nodeModel.id||p.nodeModel.plmType;var s=p.nodeModel;var r=p.view;var o=p.nodeModel;n.addEventListener("mousedown",function(w){if(w.button!==0){return}else{w.stopPropagation();w.preventDefault()}var u=m._treeView&&m._treeView.getManager();if(u){var t=u.getDocument();var x=u._isPreparingView;var v=u._updateCounter;if(!m._historyCursor){m.initNavigator("",t.getRoots())}r.innerHTML="";new b({className:"accessSpinner"}).inject(r).show();m.hideEmptyView();m._fetchData(q).then(function(y){m.NavigatorTo(s&&s.options.id,y)})["catch"](function(y){r.innerHTML="";n.inject(r)})}});p.cellView.getContent().setContent(n)}}}],onDragStartCell:function(){},onDragEndCell:function(){},onDragLeaveCell:function(){},onDragOverCell:function(){},onDropCell:function(){},onDragEnterBlank:function(){},onDragLeaveBlank:function(){},onDragOverBlank:function(){},onDropBlank:function(){},shouldAcceptDrag:function(){return false},shouldAcceptDrop:function(){return false},sEditable:true,enableScrollOnDrag:true};l.selection={toggle:false,canMultiSelect:false,unselectAllOnEmptyArea:false,};l.shouldDisplayTooltip=function(n){return m._shouldDisplayTooltip&&m._shouldDisplayTooltip(n)};l.cellClass=g.extend({init:function(n){this._parent(n)},updateInternalParameters:function(){this._parent();var n=this.getCellInfos();if(!n.isHeader){if(n.nodeModel.options.isBeingCut){n.cellView.getContent().addClassName("folder-state-is-being-cut")}else{n.cellView.getContent().removeClassName("folder-state-is-being-cut")}}var o=n.nodeModel;o.getID=o.getID||function(){return this.options.id};o.getType=o.getType||function(){return this.options.plmType};o.getLabel=o.getLabel||function(){return this.options.label};if(["Content"].indexOf(n.nodeModel.getType())!==-1){n.cellView.getContent().addClassName("couldNotBeSelected")}else{n.cellView.getContent().removeClassName("couldNotBeSelected")}if(n.nodeModel.getType()==="Path"){n.cellView.getContent().addClassName("resultPath")}else{n.cellView.getContent().removeClassName("resultPath")}}});var k=new j(l).inject(this.nestedMenuContainer);this._treeView=k;this._manager=this._manager||k.getManager();this._manager.onInfiniteScrollAsync(function(n){if(n.reachBottom&&m._onInfiniteScrollAsync&&typeof m._onInfiniteScrollAsync==="function"){m.onInfiniteScrollAsync(n)}else{m._manager.infiniteScrollAsyncProcessDone()}});k.getDocument().getXSO().onAdd(function(n){m.dispatchEvent("select",n)});if(this._onPreExpandTreeNode&&typeof this._onPreExpandTreeNode==="function"){k.getDocument().onPreExpand(this._onPreExpand.bind(this))}if(this._onPreCollapseTreeNode&&typeof this._onPreCollapseTreeNode==="function"){k.getDocument().onPreCollapse(this._onPreCollapse.bind(this))}k.getDocument().options.shouldBeSelected=function(n){return m._couldBeSelected?m._couldBeSelected(n):true};k.onNodeDblClick(function(n){if(n.dataIndex!=="access"){if(n.nodeModel._isExpanded===true){n.nodeModel.collapse()}else{n.nodeModel.expand()}}});this.emptyView=UWA.createElement("div",{"class":"emptyView",styles:{height:"100%",position:"absolute",top:0,left:0,width:"100%","text-align":"center","padding-top":"5px"}}).inject(this.nestedMenuContainer);this.hideEmptyView()},});return h});define("DS/FolderActive/utils/FolderActiveUtil",["UWA/Utils","DS/FolderActive/service/FolderTypeService","DS/ZipJS/deflate","DS/ZipJS/inflate",],function(b,c){var a={jsonZip:function(k){if(k.length>0&&k[0]!=="{"&&k[0]!=="["){return k}var f=new ArrayBuffer(k.length);var d=new Uint8Array(f);for(var g=0;g<k.length;g++){d[g]=k.charCodeAt(g)}var j=new Deflater();j.append(d);var e=j.flush();var h=String.fromCharCode.apply(null,e);return b.base64Encode(h)},jsonUnzip:function(f){if(f.length>0&&(f[0]==="{"||f[0]==="[")){return f}if(f.length>0&&f.indexOf("root,")===0){return"{}"}var l=f;try{l=b.base64Decode(f)}catch(j){}var h=new ArrayBuffer(l.length);var d=new Uint8Array(h);for(var g=0;g<l.length;g++){d[g]=l.charCodeAt(g)}var k=new Inflater();var m=k.append(d);k.flush();return String.fromCharCode.apply(null,m)},convertToExaleadDataFormat:function(j){var i={};i.resourceid=j.id;i.label=j.label;i.type=j.type;i.isDownloadable=j.isDownloadable;if(UWA.is(j.mxid)){i.mxid=j.mxid}if(UWA.is(j.publishOnConnect)){i.publishOnConnect=j.publishOnConnect}var g=j.icon;var f=j.largeicon;var h=(j.thumbnail)?j.thumbnail:null;i.icons=[g];i.thumbnail=(h!==null)?h:(f!==null)?f:g;j.revision=c.inFamilyFolder(j.type)?"":j.revision;if(UWA.is(j.description)&&UWA.is(j.description.replace,"function")){j.description=j.description.replace(/\\n/g," ")}i.grid={};i.padgrid={};i.grid["ds6wg:revision"]=j.revision;i.grid["ds6w:identifier"]=j.name;i.grid["ds6w:description"]=j.description?j.description:"";i.grid["ds6w:modified"]=j.modified;i.grid["ds6w:created"]=j.created;i.grid["ds6w:type"]=j.displayType?j.displayType:j.type;i.grid["ds6w:policy"]=j.policy?j.policy:"";i.grid["ds6w:organizationResponsible"]=j.organizationResponsible?j.organizationResponsible:"";i.grid["ds6w:project"]=j.project?j.project:"";i.grid["ds6w:status"]=j.status?j.status:"";for(var e in j){i.grid[e]=j[e]}if(UWA.is(j.locker)){i.grid["ds6w:reservedBy"]=j.locker}if(UWA.is(j.locked)){i.grid["ds6w:reserved"]=j.locked}if(UWA.is(j.isDuplicated)){i.grid.isDuplicated=j.isDuplicated}if(UWA.is(j.isLastMinorRevision)){i.grid.isLastMinorRevision=j.isLastMinorRevision}if(UWA.is(j.isLastVersion)){i.grid["ds6wg:PLMReference.V_isLastVersion"]=j.isLastVersion}if(UWA.is(j.svg)){var d=[{id:j.svg,format:"svg",}];i.grid.derivedOutputs=d}i.padgrid["ds6w:leaf"]="False";i.padgrid["ds6w:root"]="True";i.grid["ds6w:responsible"]=j.responsible;if(UWA.is(j.logicalDeleteBy)){i.grid.logicalDeleteBy=j.logicalDeleteBy}if(UWA.is(j.logicalDeleteStamp)){i.grid.logicalDeleteStamp=j.logicalDeleteStamp}if(UWA.is(i.thumbnail)){i.grid.thumbnail="url("+i.thumbnail+")"}if(UWA.is(j.expandable)&&j.expandable==="TRUE"){i.children=[]}else{i.children=null;i.isNotManagedByPS=true}return i}};return a});define("DS/FolderActive/NestedMenu/NestedMenuInContext",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WebappsUtils/WebappsUtils","DS/WidgetServices/WidgetServices","i18n!DS/FolderActive/assets/nls/FolderActive","DS/FolderActive/NestedMenu/NestedMenu","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Popover"],function(e,h,j,b,k,d,i,f,a,c){var g=e.extend(h,j,{name:"NestedMenuInContext",_selectBookmarkId:"",_currentBookmarkId:"",_selectBookmarkNodeModel:"",_activeBookmarkId:"",_isInitializedData:false,_sortField:"alpha",_sortBy:"asc",_historySort:{},_currentCursor:"",init:function(l){var m=this;this.options=l;this.container=this.options.container;this._selectBtn=this.options.selectBtnLabel;this._selectHereBtn=this.options.selectHereBtnLabel;this._unselectBtn=this.options.unselectBtnLabel;this._cancelBtn=this.options.cancelBtnLabel;this.couldBeValid=this.options.couldBeValid;this._buildPopover()},_initNestedMenu:function(){var l=this;this.nestedMenu=new i(Object.assign(this.options,{container:this.nestedMenuContainer}));this.nestedMenu.addEvent("Navi_Back",function(m){var o=m.nodeModel;var n=m.nodeId;l._currentBookmarkId=o&&o.getID();l._currentCursor=n;l._selectBookmarkId="";l._selectBookmarkNodeModel="";l._currentBookmarkNodeModel=o;l._checkSortPanel(n);l._onSwitchLevel(o,n)});this.nestedMenu.addEvent("Navi_To",function(m){var o=m.nodeModel;var n=m.nodeId;l._currentBookmarkId=o&&o.getID();l._currentCursor=n;l._selectBookmarkId="";l._selectBookmarkNodeModel="";l._currentBookmarkNodeModel=o;l._checkSortPanel(n);l._onSwitchLevel(o,n)});this.nestedMenu.addEvent("select",function(m){l._selectBookmarkId=m&&m.getID();l._selectBookmarkNodeModel=m;l._checkValidBtn(l._selectBookmarkId)})},_onSwitchLevel:function(m,l){if(!m){this._inRootLevel()}else{this._notInRootLevel(m)}this._checkSearchPanel(l)},setActiveNode:function(l){this._activeBookmarkId=l===this._activeBookmarkId?"":l;this.nestedMenu.setActiveNode(l)},_applySort:function(l,m){this._sortField=l||(this._historySort[this._currentCursor]&&this._historySort[this._currentCursor].sortField)||this._sortField;this._sortBy=m||(this._historySort[this._currentCursor]&&this._historySort[this._currentCursor].sortBy)||this._sortBy;if(this._sortField==="alpha"){this._modalHeaderSortPanel_alpha.className="fonticon fonticon-sort-alpha-"+this._sortBy;this._modalHeaderSortPanel_alpha.addClassName("active");this._modalHeaderSortPanel_date.removeClassName("active")}else{this._modalHeaderSortPanel_date.className="fonticon fonticon-sort-num-"+this._sortBy;this._modalHeaderSortPanel_date.addClassName("active");this._modalHeaderSortPanel_alpha.removeClassName("active")}this.nestedMenu.applySort(this._sortField,this._sortBy,this._sortFun.bind(this))},_applySortByReload:function(l,m){this._sortField=l||this._sortField;this._sortBy=m||this._sortBy;this._historySort[this._currentCursor]=this._historySort[this._currentCursor]||{};this._historySort[this._currentCursor].sortBy=this._sortBy;this._historySort[this._currentCursor].sortField=this._sortField;this.nestedMenu.applySortByReload(this._sortField,this._sortBy)},getSortByCursor:function(l){l=l===undefined?this._currentCursor:l;return this._historySort[l]||{sortField:"alpha",sortBy:"asc"}},_sortFun:function(m,l){return m>l},_inRootLevel:function(){this._modalHeaderNavPanel_BackBtn.hide();this._modalHeaderNavPanel_Title.innerText="";this._checkValidBtn()},_notInRootLevel:function(l){this._modalHeaderNavPanel_BackBtn.show();this._modalHeaderNavPanel_Title.innerText=l.getLabel();this._modalHeaderNavPanel_Title.title=l.getLabel();this._checkValidBtn(this._currentBookmarkId)},_getSelectBtnLabel:function(){return this._selectBtn||d.activeBookmark_btn_add},_getSelectHereBtnLabel:function(){return this._selectHereBtn||d.activeBookmark_btn_addhere},_getUnselectBtnLabel:function(){return this._unselectBtn||d.activeBookmark_btn_remove},_getCancelBtnLabel:function(){return this._cancelBtn||d.activeBookmark_btn_cancel},_checkValidBtn:function(l){if(this._couldBeValid(l)){this._modalFooterValidBtn.enable();if(this._activeBookmarkId===l){this._modalFooterValidBtn.setValue(this._getUnselectBtnLabel())}else{if(this._couldBeSet(l)){this._modalFooterValidBtn.setValue(this._getSelectBtnLabel())}else{this._modalFooterValidBtn.setValue(this._getSelectHereBtnLabel())}}}else{this._modalFooterValidBtn.setValue(this._getSelectBtnLabel());this._modalFooterValidBtn.disable()}},_couldBeValid:function(l){if(typeof this.couldBeValid==="function"){return this.couldBeValid(l)}else{return true}},_couldBeSet:function(l){if(this._currentBookmarkId!==l){var m=this.getNodeModelById(l);return m}return false},getNodeModelById:function(l){return this.nestedMenu.getNodeModelById(l)},searchInContext:function(l){this.nestedMenu.search(l)},enterSearchPanel:function(){this.nestedMenu.startSearch()},exitSearchPanel:function(){this.nestedMenu.endSearch()},_checkSortPanel:function(n){var m=this;this._historySort[n]=this._historySort[n]||{};var o=this._historySort[this._currentCursor].sortBy||this._sortBy;var l=this._historySort[this._currentCursor].sortField||this._sortField;if(l==="alpha"){this._modalHeaderSortPanel_alpha.className="active fonticon fonticon-sort-alpha-"+o;this._modalHeaderSortPanel_date.removeClassName("active")}else{this._modalHeaderSortPanel_date.className="active fonticon fonticon-sort-num-"+o;this._modalHeaderSortPanel_alpha.removeClassName("active")}this._historySort[this._currentCursor].sortBy=o;this._historySort[this._currentCursor].sortField=l},_checkSearchPanel:function(n){var m=this;if(n&&n.indexOf("search")===0){this._modalHeaderNavPanel.hide();m._modalHeaderSearchPanel.removeClassName("InputHidden");m._modalHeaderSearchPanel_searchBtn.addClassName("active");m._modalHeaderSearchPanel_searchInput.focus()}else{this._modalHeaderNavPanel.show();m._modalHeaderSearchPanel.addClassName("InputHidden");m._modalHeaderSearchPanel_searchBtn.removeClassName("active")}var l=this.nestedMenu.getSearchKeyById(n);l=l||"";this._modalHeaderSearchPanel_searchInput.setValue(l);if(l===""){this._modalHeaderSearchPanel_clearBtn.addClassName("hidden")}else{this._modalHeaderSearchPanel_clearBtn.removeClassName("hidden")}},_adaptPopoverSize:function(){var m=document.body.clientHeight;var q=document.body.clientWidth;var p=Math.min(this._maxHeight,m-60);if(this.container){var o=this.container.getBoundingClientRect();var l=o.left+o.width/2-5;var n=Math.min(this._maxWidth,l*2);if(l*2<this._maxWidth){this.popover.options.position="top left";this.popover.elements.container.removeClassName("isTop");this.popover.elements.container.addClassName("isTopLeft");this.popover.updatePosition("top left");n=Math.min(this._maxWidth,q-o.left-5)}else{this.popover.options.position="top";this.popover.elements.container.removeClassName("isTopLeft");this.popover.elements.container.addClassName("isTop");this.popover.updatePosition("top")}this._modalContainer.style.height=p+"px";this._modalContainer.style.width=n+"px"}},initData:function(){this.nestedMenu.render();this.nestedMenu.initData();this._inRootLevel();this._isInitializedData=true},updateView:function(){if(!this._activeBookmarkId){this.nestedMenu&&this.nestedMenu.updateView()}else{if(this._currentCursor!==this._activeBookmarkId){this.nestedMenu&&this.nestedMenu.focusToActiveView(this._activeBookmarkId)}}},getContainer:function(){return this._modalContainer},_buildPopover:function(l){var m=this;this._maxHeight=350;this._maxWidth=280;widget.addEvent("onResize",function(n){if(m.__startTime&&(Date.now()-m.__startTime>1000)){m.popover&&m.popover.hide()}m._adaptPopoverSize()});this.popover=new c({target:this.container,trigger:"touch",className:"NestedMenuInContext_Popover "+this.options.className,autoHideOnClickOutside:false,position:"top",events:{onShow:function(){m.__startTime=Date.now();m._adaptPopoverSize();if(!m._isInitializedData){m.initData()}else{if(m.nestedMenu){m.updateView()}}}}});this._modalContainer=UWA.createElement("div",{"class":"modalContainer",styles:{height:this._maxHeight+"px",width:this._maxWidth+"px"}});this._modalHeader=UWA.createElement("div",{"class":"modalHeader",styles:{height:"38px",width:"100%"}}).inject(this._modalContainer);this._modalHeaderNavPanel=UWA.createElement("div",{"class":"modalHeaderNavPanel",styles:{}}).inject(this._modalHeader);this._modalHeaderNavPanel_BackBtn=UWA.createElement("i",{"class":"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-chevron-left",title:d.activeBookmark_hover_back,styles:{color:"#b4b6ba",cursor:"pointer",width:"38px","text-align":"center",},events:{click:function(){m.nestedMenu.NavigatorBack()}}}).inject(this._modalHeaderNavPanel);this._modalHeaderNavPanel_BackBtn.hide();this._modalHeaderNavPanel_Title=UWA.createElement("span",{"class":"modalHeaderNavPanel_Title",styles:{"font-weight":"bold"}}).inject(this._modalHeaderNavPanel);this._modalHeaderNavPanel_Title.innerText="";this._modalHeaderSortPanel=UWA.createElement("div",{"class":"modalHeaderSortPanel",}).inject(this._modalHeader);this._modalHeaderSortPanel_alpha=UWA.createElement("span",{"class":"fonticon fonticon-sort-alpha-asc",title:d.activeBookmark_hover_alphaOrder,events:{click:function(n){var o=this.hasClassName("fonticon-sort-alpha-desc")?"desc":"asc";if(this.hasClassName("active")){this.removeClassName("fonticon-sort-alpha-"+o);o=o==="asc"?"desc":"asc";this.addClassName("fonticon-sort-alpha-"+o)}else{this.addClassName("active");m._modalHeaderSortPanel_date.removeClassName("active")}m._applySortByReload("alpha",o)}}}).inject(this._modalHeaderSortPanel);this._modalHeaderSortPanel_date=UWA.createElement("span",{"class":"fonticon fonticon-sort-num-asc ",title:d.activeBookmark_hover_dateOrder,events:{click:function(n){var o=this.hasClassName("fonticon-sort-num-desc")?"desc":"asc";if(this.hasClassName("active")){this.removeClassName("fonticon-sort-num-"+o);o=o==="asc"?"desc":"asc";this.addClassName("fonticon-sort-num-"+o)}else{this.addClassName("active");m._modalHeaderSortPanel_date.removeClassName("active")}m._applySortByReload("date",o)}}}).inject(this._modalHeaderSortPanel);this._modalHeaderSearchPanel=UWA.createElement("div",{"class":"modalHeaderSearchPanel",}).inject(this._modalHeader);this._modalHeaderSearchPanel_searchInput=new a({className:"searchInput",placeholder:d.search_placeholder,events:{onKeyDown:function(o){var n=this;setTimeout(function(){if(n.getValue()){m._modalHeaderSearchPanel_clearBtn.removeClassName("hidden");if(o.keyCode===13){m.searchInContext(n.getValue())}}else{m._modalHeaderSearchPanel_clearBtn.addClassName("hidden")}},10)}}}).inject(this._modalHeaderSearchPanel);this._modalHeaderSearchPanel_clearBtn=UWA.createElement("span",{"class":"clearBtn fonticon fonticon-cancel-circled",events:{click:function(n){m._modalHeaderSearchPanel_searchInput.setValue("");m._modalHeaderSearchPanel_clearBtn.addClassName("hidden")}}}).inject(this._modalHeaderSearchPanel);this._modalHeaderSearchPanel_clearBtn.addClassName("hidden");this._modalHeaderSearchPanel.addClassName("InputHidden");this._modalHeaderSearchPanel_searchBtn=UWA.createElement("span",{"class":"fonticon fonticon-search",title:d.activeBookmark_hover_search,events:{click:function(n){if(m._modalHeaderSearchPanel.hasClassName("InputHidden")){m._checkSearchPanel("search");m.enterSearchPanel()}else{m._checkSearchPanel("");m.exitSearchPanel()}}}}).inject(this._modalHeaderSearchPanel);this.nestedMenuContainer=UWA.createElement("div",{"class":"nestedMenuContainer",styles:{height:"calc(100% - 90px)",width:"100%"}}).inject(this._modalContainer);this._modalFooter=UWA.createElement("div",{"class":"modalFooter",styles:{height:"52px",width:"100%"}}).inject(this._modalContainer);this._modalFooterValidBtn=new f({value:this._getSelectBtnLabel(),className:"primary"}).inject(this._modalFooter);this._modalFooterValidBtn.disable();this._modalFooterCancelBtn=new f({value:this._getCancelBtnLabel()}).inject(this._modalFooter);this._modalFooterValidBtn.addEvent("onClick",function(){var o=m._selectBookmarkId||m._currentBookmarkId;m._activeBookmarkId=o===m._activeBookmarkId?"":o;var n={};if(m._activeBookmarkId){n=m._selectBookmarkNodeModel||m._currentBookmarkNodeModel}m.dispatchEvent("setActive",n);m._checkValidBtn(m._activeBookmarkId);m.nestedMenu.setActiveNode(m._activeBookmarkId);m.popover.hide()});this._modalFooterCancelBtn.addEvent("onClick",function(){m.popover.hide();m.dispatchEvent("onCancel")});this._initNestedMenu();this.popover.setBody(this._modalContainer)},destroy:function(){this.popover.destroy()}});return g});define("DS/FolderActive/utils/PersonalFolderManager",["DS/FolderActive/service/FolderActiveWebService","DS/WebappsUtils/WebappsUtils","DS/FolderActive/service/FolderTypeService"],function(a,c,i){var f=null;var d=undefined;var b=d;var e=false;function j(k){if(k){return{id:k.id,name:k.name,type:k.type,isPersonal:k.isPersonal}}else{return undefined}}function h(k){if(undefined!==k){b=k}}var g={getPersonalFolder:function(){return b},isInitialized:function(){return e===true},resetToPreInitializedState:function(){b=d;e=false},getPersonalRootFolderInFavoriteFormat:function(){return j(b)},isPersonalFolderToBeKept:function(l){var k=false;if(l&&(i.isPersonalFolder(l.type)||(i.isRootFolder(l.type)&&l.isPersonal))){k=true}return k},setupPersonalFolder:function(){var k=this;return new UWA.Class.Promise(function(m,l){if(e===true){l()}else{a.roots({type:"Personal",collabSpace:"All",onComplete:function(t){t=JSON.parse(t);var o=t.folders;h(f);var q=o?o.length:0;for(var p=0;p<q;p++){var s=o[p];if(i.isPersonalFolder(s.type)){var r={useAsyncPreExpand:true};var n=c.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");r.label=s.label;r.icons=[n];r.children=[];r.id=s.id;r.plmType="RootFolder";r.type=s.type;r.name=r.label;r.isPersonal=true;h(r);e=true;break}}m()},onFailure:function(n){h(f);e=true;l(n)}})}})}};return g});define("DS/FolderActive/FolderActive",["UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/FolderActive/service/FolderActiveWebService","DS/FolderActive/utils/FolderActiveUtil","i18n!DS/FolderActive/assets/nls/FolderActive","DS/FolderActive/service/FolderTypeService","DS/FolderActive/commands/FolderCommands","DS/PADUtils/PADUtilsServices","DS/FolderActive/utils/PersonalFolderManager","DS/LifecycleServices/LifecycleServicesSettings","DS/FolderActive/NestedMenu/NestedMenuInContext","DS/WidgetServices/WidgetServices","text!DS/FolderActive/assets/FolderActive_setting.json","css!DS/FolderActive/FolderActive.css"],function(e,r,t,n,a,h,m,d,k,y,i,A,p,j,g,x,w,l,u,f){var s="favorites";var b="subFolders";var c=d.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var o=d.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png");var v=d.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");var q=d.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var z=r.extend(t,n,{name:"FolderActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchInfo:{},_pathInfo:{},_subBookmarkExpand:{},init:function(B){var C=this;this.options=B;this.nestedMenuInContext=this.nestedMenuInContext||new w({master:this,container:B.container,className:B.className,selectBtnLabel:B.selectBtnLabel,selectHereBtnLabel:B.selectHereBtnLabel,unselectBtnLabel:B.unselectBtnLabel,cancelBtnLabel:B.cancelBtnLabel,onPreExpandTreeNode:this._onPreExpandTreeNode.bind(this),onPreCollapseTreeNode:this._onPreCollapseTreeNode.bind(this),onInfiniteScrollAsync:this._onInfiniteScrollAsync.bind(this),onContextualMenuReady:this.__onContextualMenuReady.bind(this),firstScreenFetch:this.firstScreenFetch.bind(this),searchData:this._searchData.bind(this),fetchData:this.fetchData.bind(this),getPath:this.getPathOfActiveBookmark.bind(this),sortByReload:this.sortByReload.bind(this),sortFunction:this.sortFunction.bind(this),shouldDisplayTooltip:this.shouldDisplayTooltip.bind(this),couldBeSelected:this.couldBeSelected.bind(this),couldBeValid:this.couldBeValid.bind(this),showMessageWhileEmpty:JSON.parse(u).showContentInView?i.activeBookmark_msg_empty:i.activeBookmark_msg_noBookmark,showMessageWhileResultEmpty:i.activeBookmark_msg_noResultFound});this.nestedMenuInContext.addEvent("setActive",function(D){C.options.onSetActive&&C.options.onSetActive(D);C.dispatchEvent("onSetActive",D)});this.nestedMenuInContext.addEvent("onCancel",function(D){C.dispatchEvent("onCancel")});if(l.isReplayODT()){window.FolderActive=this}},_getWebServiceRef:function(){return k},_getPlmType:function(B){return["Workspace","Workspace Vault"].indexOf(B)!==-1?"Folder":"Content"},_getRootIcon:function(){return d.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")},_getFavoritesName:function(){return i.name_Section_FavoriteFolders},_getRootName:function(){return i.name_Section_AllFolders},_getAccessBtnName:function(){return i.activeBookmark_hover_openBookmark},showPopover:function(){this.nestedMenuInContext.popover.show()},hidePopover:function(){this.nestedMenuInContext.popover.hide()},togglePopover:function(){this.nestedMenuInContext.popover.toggle()},getModalContainer:function(){return this.nestedMenuInContext&&this.nestedMenuInContext.getContainer()},_getIcon:function(C,D){var B=D!==b&&false;var F=C.icon;F=q;var E=null;if(C.type&&A.isPersonalFolder(C.type)){E=B||!F?v:F}else{if(D===s){E=c}else{E=B||!F?o:F}}return E},_generateExpandData:function(D,E,H){E.removeChildren();var G=this;var C={"ds6w:label":"label","ds6w:type":"type",type_icon_url:"icon",physicalid:"id","ds6w:created":"created","ds6w:modified":"modified",};var F=[];var B={};D.forEach(function(K){if(K.path){F.push(K.path)}else{if(K.attributes&&K.attributes.length>1){var J=K.attributes.splice(1);var M={};J.forEach(function(N){var O=C[N.name];if(O){M[O]=N.value}});var L={useAsyncPreExpand:true};L.label=M.label;L.icons=[M.icon];L.id=M.id;L.plmType=G._getPlmType(M.type);L.created=M.created;L.modified=M.modified;L.icons=[G._getIcon(M)];if(L.plmType==="Folder"||L.plmType==="RootFolder"){L.children=[]}B[K.attributes[0].value]=L}}});F.forEach(function(K){var J=E;K.forEach(function(N,L){if(B[N]){var M=B[N];if(M&&L!==0){if(M instanceof m){J.addChild(M)}else{B[N]=G._createTreeNodeModel(M,J)}J=B[N]}}})});if(H){for(var I in B){if(B[I].id!==E.id){B[I].expand&&!B[I].isExpanded()&&B[I].expand({onlyUI:true})}}}this.nestedMenuInContext._applySort()},_generateSearchData:function(E){var D=this;var F={0:new h()};F[0].onPreExpand(function(G){if(G.data.onlyUI){G.target.preExpandDone();return}});var B={"ds6w:label":"label","ds6w:what/ds6w:type":"type",type_icon_url:"icon",resourceid:"id","ds6w:when/ds6w:created":"created","ds6w:when/ds6w:modified":"modified",};E.forEach(function(G){var H=G.attributes;var J={};H.forEach(function(L){var M=B[L.name];if(M){J[M]=L.value}if(M==="type"){J.displayType=L.dispValue}});var I={useAsyncPreExpand:true};I.label=J.label;I.icons=[J.icon];I.id=J.id;I.plmType=D._getPlmType(J.type);I.created=J.created;I.modified=J.modified;var K=(G&&G.level)?parseInt(G.level):1;I.icons=[D._getIcon(J)];if(I.plmType==="Folder"||I.plmType==="RootFolder"){I.children=[]}F[K]=D._createTreeNodeModel(I,F[K-1])});var C=F[0].getRoots();return[].concat(C)},generateData:function(D){var C=this;var E={0:new h()};E[0].onPreExpand(function(F){if(F.data.onlyUI){F.target.preExpandDone();return}});D.forEach(function(F){var G={useAsyncPreExpand:true};G.label=F.label||F["ds6w:label"];G.icons=(F.icon&&[F.icon])||[F.type_icon_url];G.id=F.id||F.resourceid;G.plmType=C._getPlmType(F["ds6w:what/ds6w:type"]);G.created=F.created||F["ds6w:when/ds6w:created"];if(UWA.is(F.publishOnConnect)){G.publishOnConnect=F.publishOnConnect}G.folderClassification=F.folderClassification;var H=(F&&F.level)?parseInt(F.level):1;if(G.plmType==="Folder"||G.plmType==="RootFolder"){G.children=[];G.icons=[C._getIcon(G)]}E[H]=C._createTreeNodeModel(G,E[H-1])});var B=E[0].getRoots();return B},_pathData:function(B,D){var C=this;return new a(function(F,E){C._getWebServiceRef().pathInActiveBookmark({ids:B.map(function(G){return G.id}),onComplete:function(I){var K=I.result;var G={};K.forEach(function(P){var N=P.outputs&&P.outputs.GET_PARENT&&P.outputs.GET_PARENT[0];var O="";var S=P.input_object.physicalid;var Q=P.input_object["ds6w:type"];var L="";var R="root";if(N){O=N["ds6w:label"];R=N.physicalid;L=N["ds6w:label"];if(N.paths){var T=N.paths.filter(function(U){return U[0]["physicalid"]===S})[0];if(T&&T.length>1){R=T[1].physicalid;L=T[1]["ds6w:label"];for(var M=T.length-1;M>1;M--){O+=" > "+T[M]["ds6w:label"]}}else{var L=""}}}if(Q!=="Workspace Vault"||N){G[S]=G[S]||{};G[S].pathName=O;G[S].parentName=L;G[S].parent=R}});var H=C._pathInfo[D];var J=[];B.forEach(function(Q){if(G[Q.id]){if(!H||H!==G[Q.id].parent){var P=C._getRootName();if(G[Q.id].pathName){P+=" > "+G[Q.id].pathName}var M=P;var N="";if(G[Q.id].parentName){M+=" > "+G[Q.id].parentName;N+=" > "+G[Q.id].parentName}var O='<div class="path" title="'+M+'"><span class="pathNoFixed">'+P+'</span><span class="pathFixed">'+N+"</span></div>";var L=new m({label:O,plmType:"Path"});J.push(L)}H=G[Q.id].parent;C._pathInfo[D]=G[Q.id].parent;J.push(Q)}});F(J)},onFailure:function(H,G,I){E(H,G,I)}})})},_searchData:function(C,F,B,E){var D=this;B=(B==="FolderSection_AllFolders"||B==="FolderSection_favorite")?undefined:B;return new a(function(H,G){D._getWebServiceRef().searchInActiveBookmark({content:"All",filterChildren:"",pid:B,searchKey:C,onComplete:function(M){var J=M.results||[];var I=D._generateSearchData(J);var L=M.infos.next_start.split(" ")[0];var K=L===M.infos.nhits+"";if(J.length===0||K){delete D._requestInfo[F]}else{D._requestInfo[F]=D._requestInfo[F]||{};D._requestInfo[F].key=C;D._requestInfo[F].pid=B;D._requestInfo[F].isSearch=true;D._requestInfo[F].next_start=M.infos.next_start}D._pathInfo[F]="";D._searchInfo[F]={key:C,pid:B};if(I.length>0){D._pathData(I,F).then(function(N){if(!E){delete D._subBookmarkExpand[F]}D.attachExpandChild(F,N);H(N)})["catch"](function(N){G(N)})}else{if(!E){delete D._subBookmarkExpand[F]}H(I)}},onFailure:function(J,I,K){console.log(J);G(J)}})})},shouldDisplayTooltip:function(B){var C=B.nodeModel;C.getID=C.getID||function(){return this.options.id};C.getType=C.getType||function(){return this.options.plmType};C.getLabel=C.getLabel||function(){return this.options.label};if(B.dataIndex==="tree"&&B.nodeModel.getType()!=="Path"){return{shortHelp:B.nodeModel._options.label}}else{if(B.nodeModel.getType()==="Path"){return{shortHelp:""}}else{return{shortHelp:this._getAccessBtnName()}}}},couldBeSelected:function(B){if(B.getType()==="Content"||B.getType()==="Path"){return false}return true},couldBeValid:function(B){return B&&B!=="FolderSection_favorite"&&B!=="FolderSection_AllFolders"},sortFunction:function(C,I,H,G){var E=I==="asc"?-1:1;var F=H.getParent().plmType==="FolderSection_favorite";if(F){return null}if(H.isRoot()||G.isRoot()){return null}if((H.plmType==="FolderSection_favorite"||H.plmType==="FolderSection_AllFolders")||(H.plmType!==G.plmType)){return null}else{if(C==="date"){var B;try{B=H.options.created>G.options.created?1:(H.options.created<G.options.created?-1:0)}catch(D){B=H.options.created<G.options.created?-1:1}finally{return B}}else{return H.options.label<G.options.label?-1:1}}},sortByReload:function(D,B,E){var C=this;B=B==="alpha"?"ds6w:label":"ds6w:created";C._getWebServiceRef().setOrder(B,E);return new a(function(H,G){if(!D){C.nestedMenuInContext._applySort();H(false)}else{if(D.indexOf("search")!==0){H(C.fetchData(D,true))}else{var F=C._searchInfo[D]||{};H(C._searchData(F.key,D,F.pid,true))}}})},getPathOfActiveBookmark:function(C){var B=this;return new a(function(E,D){B._getWebServiceRef().pathInActiveBookmark({ids:[C],onComplete:function(G){var H=G.result;var F={};H.forEach(function(K){var M=K.outputs&&K.outputs.GET_PARENT&&K.outputs.GET_PARENT[0];var J=K.input_object.physicalid;var N="";var L="root";if(M){L=M.physicalid;N=M["ds6w:label"];if(M.paths){var O=M.paths.filter(function(P){return P[0]["physicalid"]===J})[0];if(O&&O.length>1){L=O[1].physicalid;N=O[1]["ds6w:label"];for(var I=O.length-1;I>=0;I--){var L=M;if(I!==O.length-1){L=O[I+1]}F[O[I].physicalid]={parentId:L.physicalid,parentName:L["ds6w:label"]}}}else{F[J]={parentId:M.physicalid,parentName:M["ds6w:label"]}}}F[M.physicalid]={parentId:"FolderSection_AllFolders",parentName:"Bookmarks"}}else{F[J]={parentId:"FolderSection_AllFolders",parentName:"Bookmarks"}}});if(H[0]){F.current={parentId:H[0].input_object.physicalid,parentName:H[0].input_object["ds6w:label"]}}E(F)},onFailure:function(G,F,H){D(G,F,H)}})})},fetchData:function(F,E){var D=this;var C=this.nestedMenuInContext.getSortByCursor(F);var B=C.sortField==="alpha"?"ds6w:label":"ds6w:created";D._getWebServiceRef().setOrder(B,C.sortBy);return new a(function(H,G){if(F==="FolderSection_AllFolders"){D._getWebServiceRef().searchInActiveBookmark({content:"All",onComplete:function(M){var J=M.results||[];var L=M.infos.next_start.split(" ")[0];var K=L===M.infos.nhits+"";if(J.length===0||K){delete D._requestInfo[F]}else{D._requestInfo[F]=D._requestInfo[F]||{};D._requestInfo[F].isFetch=true;D._requestInfo[F].next_start=M.infos.next_start;D._requestInfo[F].isContentSearch=M.isContentSearch}var I=D._generateSearchData(J);if(!E){delete D._subBookmarkExpand[F]}D.attachExpandChild(F,I);H(I)},onFailure:function(J,I,K){console.log(J);G(J)}})}else{if(F==="FolderSection_favorite"){D.getFavorites({onComplete:function(L){var J=L;var K=d.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var M=d.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark108x144.png");var I=[];J.forEach(function(P){var S=(P.type)?P.type:"Folder";var N=(S=="RootFolder")?i.name_RootFolder_type:i.name_Folder_type;var O={id:P.id,type:S,displayType:N,label:P.name,name:P.name,description:"",created:"",modified:"",owner:"",responsible:"",organizationResponsible:"",project:"",revision:"",status:"",policy:"",icon:K,largeicon:M};var R=y.convertToExaleadDataFormat(O);R.children=[];R.id=P.id;var Q=new m(R);Q.plmType=S;Q.id=P.id;Q.isFavorite=true;Q.options.oldLabel=R.label;Q.isPersonal=P.isPersonal;I.push(Q)});H(I)},onFailure:function(I){console.log(I);G(I)}})}else{D._getWebServiceRef().fetchInActiveBookmark({pid:F,onComplete:function(K){var J=K.results||[];J=J.map(function(L){var M={};L.attributes.forEach(function(N){M[N.name]=N.value});return M});if(J.length===0||K.isEnd){delete D._requestInfo[F]}else{D._requestInfo[F]=D._requestInfo[F]||{};D._requestInfo[F].isFetch=true;D._requestInfo[F].pid=F;D._requestInfo[F].next_start=K.infos.next_start;D._requestInfo[F].isContentSearch=K.isContentSearch}var I=D.generateData(J);if(!E){delete D._subBookmarkExpand[F]}D.attachExpandChild(F,I);H(I)},onFailure:function(J,I,K){console.log(J);G(J)}})}}})},attachExpandChild:function(G,B){var F=this._subBookmarkExpand[G];var E={};for(var D in F){var H=F[D];if(H&&H.isExpanded()){E[H.id]=H}}var C=function(I){I.expand({onlyUI:true});I.getChildren()&&I.getChildren().forEach(function(J){if(J.isExpanded()){C(J)}})};B&&B.forEach(function(I){if(E[I.id]){var J=[].concat(E[I.id].getChildren());J.forEach(function(K){I.addChild(K)});F[I.id]=I;C(I)}})},firstScreenFetch:function(){var C=this;var B=new h();B.onPreExpand(function(D){if(D.data.onlyUI){D.target.preExpandDone();return}});return new a(function(G,F){var I=d.getWebappsAssetUrl("FolderEditor","icons/starBlue_v2.png");var H={useAsyncPreExpand:true};H.label=C._getFavoritesName();H.icons=[I];H.children=[];H.id="FolderSection_favorite";H.plmType="FolderSection_favorite";C._rootNodeFavorite=C._createTreeNodeModel(H,B);var E=C._getRootIcon();var D={useAsyncPreExpand:true};D.label=C._getRootName();D.icons=[E];D.children=[];D.id="FolderSection_AllFolders";D.plmType="FolderSection_AllFolders";C._rootNodeFolders=C._createTreeNodeModel(D,B);G(B.getChildren())})},_populateFavoriteSection:function(B){var C=this;if(!C._rootNodeFavorite){if(B&&B.onFailure){B.onFailure(new Error("FolderSection_favorite node does not yet exist"))}return}else{if(C._rootNodeFavorite._isPopulated){if(B&&B.onComplete){B.onComplete()}return}}C.getFavorites({onComplete:function(F){var D=F;var E={useAsyncPreExpand:false};D.forEach(function(G){E.label=G.name;E.isPersonal=G.isPersonal;var H=C._getIcon(G,s);if(A.isPersonalFolder(G.type)){E.isPersonal=true}E.icons=[H];E.children=null;E.id=G.id;E.mxid=G.mxid;if(G.type){E.plmType=G.type}else{E.plmType="Folder"}E.isFavorite=true;var I=C._createTreeNodeModel(E,C._rootNodeFavorite);I.setState({state:"noChildren"})});C._rootNodeFavorite._isPopulated=true;if(B&&B.onComplete){B.onComplete()}},onFailure:function(D){if(B&&B.onFailure){B.onFailure(D)}}})},_refreshFavoriteSection:function(B){var C=this;if(!C._rootNodeFavorite){if(B&&B.onFailure){B.onFailure(new Error("FolderSection_favorite node does not yet exist"))}}else{C._rootNodeFavorite.removeChildren();C._rootNodeFavorite._isPopulated=false;g.resetToPreInitializedState();C._populateFavoriteSection(B)}},_onInfiniteScrollAsync:function(F,B){var E=this;var D=this.nestedMenuInContext.getSortByCursor(F);var C=D.sortField==="alpha"?"ds6w:label":"ds6w:created";E._getWebServiceRef().setOrder(C,D.sortBy);return new a(function(I,H){var G=E._requestInfo[F];if(G){if(G.isSearch){E._getWebServiceRef().searchInActiveBookmark({next_start:G.next_start,searchKey:G.key,pid:G.pid,onComplete:function(N){var K=N.results||[];var J=E._generateSearchData(K);var M=N.infos.next_start.split(" ")[0];var L=M===N.infos.nhits+"";if(K.length===0||L){delete E._requestInfo[F]}else{E._requestInfo[F]=E._requestInfo[F]||{};E._requestInfo[F].key=G.key;E._requestInfo[F].pid=G.pid;E._requestInfo[F].isSearch=true;E._requestInfo[F].next_start=N.infos.next_start}if(J.length>0){E._pathData(J,F).then(function(O){E.attachExpandChild(F,O);I({children:O,sort:D})})["catch"](function(O){H(O)})}else{I({children:J,sort:D})}},onFailure:function(K,J,L){console.log(K);H(K)}})}else{if(G.isFetch&&G.pid){E._getWebServiceRef().fetchInActiveBookmark({pid:G.pid,isContentSearch:G.isContentSearch,next_start:G.next_start,onComplete:function(L){var K=L.results||[];K=K.map(function(M){var N={};M.attributes.forEach(function(O){N[O.name]=O.value});return N});if(K.length===0||L.isEnd){delete E._requestInfo[F]}else{E._requestInfo[F]=E._requestInfo[F]||{};E._requestInfo[F].isFetch=true;E._requestInfo[F].pid=G.pid;E._requestInfo[F].next_start=L.infos.next_start;E._requestInfo[F].isContentSearch=L.isContentSearch}var J=E.generateData(K);E.attachExpandChild(F,J);I({children:J,sort:D})},onFailure:function(K,J,L){console.log(K);H(K)}})}else{if(G.isFetch){E._getWebServiceRef().searchInActiveBookmark({next_start:G.next_start,onComplete:function(N){var K=N.results||[];var M=N.infos.next_start.split(" ")[0];var L=M===N.infos.nhits+"";if(K.length===0||L){delete E._requestInfo[F]}else{E._requestInfo[F]=E._requestInfo[F]||{};E._requestInfo[F].isFetch=true;E._requestInfo[F].next_start=N.infos.next_start;E._requestInfo[F].isContentSearch=N.isContentSearch}var J=E._generateSearchData(K);E.attachExpandChild(F,J);I({children:J,sort:D})},onFailure:function(K,J,L){console.log(K);H(K)}})}}}}else{I({children:[]})}})},_onPreCollapseTreeNode:function(C,E){var B=C.data.nodeModel;if(B.isRoot()){var D=B.getID();if(this._subBookmarkExpand[E]){delete this._subBookmarkExpand[E][D]}}},_onPreExpandTreeNode:function(F,G){var D=F.data.nodeModel;if(F.data.onlyUI){D.preExpandDone();return}var E=this;var H=[];if(D.plmType!=="FolderSection_favorite"){D.removeChildren();var C=D.id;if(D.plmType=="FolderSection_AllFolders"){if(this._rootServiceHandler){this._rootServiceHandler.cancel()}C=undefined}var B=D.plmType==="FolderSection_AllFolders";this._getWebServiceRef().expandInActiveBookmark({pid:C,level:F.data.expandLevel,isRoot:B,onComplete:function(K){var J=K.results||[];if(B){var I=E._generateSearchData(J);I.forEach(function(M){D.addChild(M)});E.nestedMenuInContext._applySort()}else{E._generateExpandData(J,D,F.data.expandLevel==="All")}if(D.options.children===null){D.options.children=[]}D.preExpandDone();if(D.isRoot()){var L=D.getID();E._subBookmarkExpand[G]=E._subBookmarkExpand[G]||{};E._subBookmarkExpand[G][L]=D}},onFailure:function(I){D.loadHasFailed=true;D.preExpandDone()}})}else{if(D.plmType==="FolderSection_favorite"){E._refreshFavoriteSection({onComplete:function(){D.preExpandDone()}})}else{D.preExpandDone()}}},getFavorites:function(B){var C=this;return C._getWebServiceRef().getUserPreferences({name:"FolderEditorFavoriteFolderList"+j.getPlatformId(),onComplete:function(F){var E=[];if(F.length>0){var G=e.base64Decode(F);G=JSON.parse(G);if(G.data&&G.data.data&&G.data.data.favorite_folders){E=G.data.data.favorite_folders}}if((Array.isArray(E)&&E.length===0)&&!g.isInitialized()){var D=g.setupPersonalFolder();D.then(function(){var I=g.getPersonalRootFolderInFavoriteFormat();if(I){var K=[];var J=E.length;var H=J;while(H--){K[H]=E[H]}K.push(I);C._setFavorites({favoriteFolders:K,onComplete:function(M){var L=I.name?I.name:"";if(B.onComplete){B.onComplete(K)}},onFailure:function(L){if(B.onComplete){B.onComplete(E)}}})}else{if(B.onComplete){B.onComplete(E)}}})["catch"](function(){if(B.onComplete){B.onComplete(E)}})}else{if(B.onComplete){B.onComplete(E)}}},onFailure:function(D){if(B.onFailure){B.onFailure(D)}}})},_createTreeNodeModel:function(E,J,G){var F=this;var D=J instanceof h;var H=E.publishOnConnect;var C=E.folderClassification;delete E.publishOnConnect;delete E.folderClassification;var I=new m(E);I.id=E.id;I.plmType=E.plmType;if(E.isFavorite){I.isFavorite=true}if(E.isPersonal||(!D&&J.isPersonal)){I.isPersonal=true}if(E.created){I.created=E.created}I._instanceType="FolderEditor/TreeNodeModel";I._loadingcounter=0;I.getID=function(){var K=this.id;if(!K||K===""){K=this.plmType}return K};I.options.oldLabel=E.label;I.pathId=(D?"root":J.pathId)+","+I.getID();if(H==="TRUE"){var B=d.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");I.setBadges({bottomRight:B})}if(!!widget.getValue("CandABookmark")&&C==="SHARED"){var B=d.getWebappsAssetUrl("FolderEditor","icons/approvals.png");I.setBadges({topRight:B})}if(D){J.addRoot(I)}else{J.addChild(I,G)}return I},__onContextualMenuReady:function(E){var C;var D=E.treeview;var B=D.nodeModel?D.nodeModel:D.cellModel;if(B){if(D.cellModel._isSelected===false){D.cellModel._isSelected=true;D.nodeModel.select(true)}C=p.GetContextualMenuForActiveBookmark(D,"TREE");if(["FolderSection_AllFolders","FolderSection_favorite"].indexOf(E.treeview.nodeModel.getID())!==-1){C=C.slice(-1)}if(C){C.forEach(function(F){if(F.type==="separator"||F.type==="SeparatorItem"){F.type="SeparatorItem"}else{F.title=F.label;F.action={callback:F.callback};F.type="PushItem"}})}}return C}});return z});define("DS/FolderActive/FolderActiveHTML",["DS/FolderActive/FolderActive","DS/FolderActive/utils/FolderActiveCommunication","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices"],function(f,b,i,c){window.top.performance.mark("start_EP_HTMLFolderActive");window.top.performance.mark("start_widgetLoading");if(!window.currentPropertiesOptions){window.currentPropertiesOptions={}}var a=null;var d=true;var h="600";var g=null;var e={onLoad:function(){window.top.performance.mark("end_widgetLoading");window.top.performance.mark("start_managePref");var m=this;i.setWidgetValue("x3dAppId","ENOLCMT_AP");document.body.addClassName("FolderActiveHTML");window.top.performance.mark("end_managePref");window.top.performance.mark("start_createProp");a=new f({});window.top.performance.mark("end_createProp");widget.body.setContent(a.getModalContainer());a.nestedMenuInContext.initData();a.nestedMenuInContext.updateView();b.subscribe("FolderEditor.ActiveFolderCallBack",function(o){if(o===null){b.publish("FolderEditor.ActiveFolder",e._activeBookmark,true);return}},true);a.addEvent("onCancel",function(){console.log("Active bookmark event : onCancel")});a.addEvent("onSetActive",function(p){console.log("Active bookmark event : onSetActive");var r=p.getID?p.getID():"";var o=p.getLabel?p.getLabel():"";var q={origin:widget.id,id:r,label:o,sc:widget.getPreference("pad_security_ctx")&&widget.getPreference("pad_security_ctx").value};e._activeBookmark=q;b.publish("FolderEditor.ActiveFolder",e._activeBookmark,true)});var n=widget.getView().type;if(n!="fullscreen"&&n!="maximized"){e._setBodyHeight(h)}g=i.getWidgetPreference("securityContext");if(g&&g.value){c.getInstance({context:{getSecurityContext:function(){return{SecurityContext:g.value}}}}).getSecurityContext()}var j=i.getWidgetPreference("isTransient");if(j&&j.value==="false"){i.deleteWidgetValue("SelectedItem")}i.setWidgetValue("isTransient","false");i.deleteWidgetValue("securityContext");var k=widget.body.getParent().getSize();e._setBodyHeight(k.height);var l=currentPropertiesOptions.selected?currentPropertiesOptions.selected:[];window.top.performance.mark("start_initdata");window.top.performance.mark("end_initdata")},onRefresh:function(){},onResize:function(k){var j=widget.body.getParent().getSize();e._setBodyHeight(j.height)},onDestroy:function(j){},onViewChange:function(l){var k=this;var j=l.height;if(l.type!=="fullscreen"&&l.type!=="maximized"){j=h}if(j){e._setBodyHeight(h)}},_setBodyHeight:function(j){if(j){if(j!=="auto"){j+="px"}widget.body.setStyle("height",j)}}};if(!i.isReplayedODT()){widget.addEvent("onLoad",e.onLoad)}else{setTimeout(function(){e.onLoad()})}widget.addEvent("onRefresh",e.onRefresh);widget.addEvent("onResize",e.onResize);widget.addEvent("onViewChange",e.onViewChange);window.addEventListener("unload",e.onDestroy);widget.setAutoRefresh(10000)});define("DS/FolderActive/commands/ActionBar_ActiveBookmarkCmd",["DS/ApplicationFrame/CommandCheckHeader","i18n!DS/FolderActive/assets/nls/FolderActive","DS/FolderActive/utils/FolderActiveCommunication","DS/FolderActive/utils/FolderActiveUtil","DS/FolderActive/FolderActive"],function(f,e,c,b,a){var d=f.extend({labelTopBar:e.activeBookmark_cmd,isInsert:true,datas:{},_activeBookmarkId:"",_activeBookmark:{},init:function(g){var h=this;this._parent(g,{mode:"exclusive",isAsynchronous:false});var i=widget.getValue("activeBookmark_"+widget.id);if(i){try{i=JSON.parse(i)}catch(j){i=null}}if(i&&i.id){this._activeBookmarkId=i.id;this.dispatchEvent(i.id,i.label);this.setState(true,false)}c.subscribe("FolderEditor.ActiveFolderCallBack",function(k){if(k===null){c.publish("FolderEditor.ActiveFolder",h._activeBookmark);return}});this.onStateChange(function(){if(!h.popover){h.popover=new a({container:document.body.querySelector('[data-command="ActionBar_ActiveBookmarkCmd"]')});if(i&&i.id){h.popover.nestedMenuInContext.setActiveNode(i.id)}h.popover.showPopover();h._checkAndUpdateState();h.popover.addEvent("onSetActive",function(l){h._activeBookmarkId=l.getID?l.getID():"";h.setState(l,false);var n=l.getID?l.getID():"";var k=l.getLabel?l.getLabel():"";h.dispatchEvent(n,k);var m={id:n,label:k};m=JSON.stringify(m);widget.setValue("activeBookmark_"+widget.id,m)})}h._checkAndUpdateState()})},dispatchEvent:function(h,g){this._activeBookmark={origin:widget.id,id:h,label:g,sc:widget.getPreference("pad_security_ctx")&&widget.getPreference("pad_security_ctx").value};c.publish("FolderEditor.ActiveFolder",this._activeBookmark)},_checkAndUpdateState:function(){var g=this;if(this._activeBookmarkId&&this.getState()!==true){setTimeout(function(){g.setState(true,false)},0)}else{if(!this._activeBookmarkId&&this.getState()!==false){setTimeout(function(){g.setState(false,false)},0)}}}});return d});define("DS/FolderActive/IPClassActive",["DS/FolderActive/FolderActive","DS/FolderActive/utils/FolderActiveUtil","DS/FolderActive/service/FolderActiveWebService","i18n!DS/FolderActive/assets/nls/IPClassActive","DS/WebappsUtils/WebappsUtils"],function(a,c,f,g,e){var d=e.getWebappsAssetUrl("LibraryEditor","icons/librarysectionall.png");var b=a.extend({name:"IPClassActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},init:function(h){var i=this;this._FolderActiveWebService=Object.assign({},f);this._FolderActiveWebService.getSearchQuery=function(){return'type: "General Library"'};this._FolderActiveWebService.getType_filter_bo=function(){return["General Library","General Class"]};this._FolderActiveWebService.generateSearchQuery=function(k,j){return'(type: "General Library" OR type: "General Class") AND (label: *'+k+'*) AND NOT physicalid: "'+j+'"'};this._FolderActiveWebService.getLabel=function(k){var l="IPClass";var j=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return l+"-"+j+"-"+(new Date()).getTime()};this._FolderActiveWebService.getSpecific_source_parameter=function(j,k){return{"3dspace":{search_in_context:{expand:{root_physicalid:j,expand_iter:k?"-1":"1",type_filter_bo:["General Library","General Class"]}}}}};this._parent(h)},_getWebServiceRef:function(){return this._FolderActiveWebService},onSetActive:function(h){if(h&&typeof h==="function"){this.onSetActive=h}},couldBeSelected:function(h){if(h.getType()==="Content"||h.getType()==="Path"){return false}return true},_getPlmType:function(h){return["General Library","General Class"].indexOf(h)!==-1?"Folder":"Content"},_getRootIcon:function(){return d},_getRootName:function(){return g.name_Section_AllLibraries},_getFavoritesName:function(){return g.name_Section_FavoriteLibraries},_getAccessBtnName:function(){return g.activeBookmark_hover_access},_getIcon:function(i){var h=i.type==="General Class"?{iconName:"library-class"}:(i.type==="General Library")?{iconName:"library-class"}:null;return h||(i.icon||(i.icons&&i.icons[0])||"")},couldBeValid:function(h){return h&&h!=="FolderSection_favorite"&&h!=="FolderSection_AllFolders"},getFavorites:function(h){var i=this;return i._getWebServiceRef().getUserPreferences({name:"ipcFavoriteList_v1",onComplete:function(k){var j=[];if(k.length>0){var l=JSON.parse(c.jsonUnzip(k));j=l}if(h.onComplete){h.onComplete(j)}},onFailure:function(j){if(h.onFailure){h.onFailure(j)}}})},});return b});define("DS/FolderActive/commands/ActionBar_ActiveIPClassCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PlatformAPI/PlatformAPI","i18n!DS/FolderActive/assets/nls/IPClassActive","DS/FolderActive/IPClassActive"],function(e,b,d,a){var c=e.extend({labelTopBar:d.activeIPClass_cmd,isInsert:true,datas:{},_activeIPClassId:"",_activeIPClass:{},init:function(f){var g=this;this._parent(f,{mode:"exclusive",isAsynchronous:false});this.onStateChange(function(){if(!g.popover){g.popover=new a({container:document.body.querySelector('[data-command="ActionBar_ActiveIPClassCmd"]')});g.popover.showPopover();g._checkAndUpdateState();g.popover.addEvent("onSetActive",function(h){g._activeIPClassId=h.getID?h.getID():"";g.setState(h,false);g._activeIPClass={origin:widget.id,id:h.getID?h.getID():"",label:h.getLabel?h.getLabel():"",sc:widget.getPreference("pad_security_ctx")&&widget.getPreference("pad_security_ctx").value};b.publish("LibraryEditor.ActiveIPClass",g._activeIPClass)})}g._checkAndUpdateState()})},_checkAndUpdateState:function(){var f=this;if(this._activeBookmarkId&&this.getState()!==true){setTimeout(function(){f.setState(true,false)},0)}else{if(!this._activeBookmarkId&&this.getState()!==false){setTimeout(function(){f.setState(false,false)},0)}}}});return c});