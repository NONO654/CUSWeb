/*!  COPYRIGHT DASSAULT SYSTEMES 2019   */
define("DS/PADServices/views/utils/ComboSelector",["css!DS/PADServices/PADServices.css","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/ContextualMenu","DS/Menu/Menu","DS/Core/Core",],function(d,h,g,b,c,e,f){var a=g.extend(b,{defaultOptions:{treedocument:null,disabled:false},init:function(i){this._parent(i);var j=this;this.elements.container=h.createElement("div",{"class":"comboSelector "+(i.className?i.className:"")});this.elements.inner=h.createElement("div",{"class":"comboSelector-inner"}).inject(this.elements.container);this.elements.text=h.createElement("div",{"class":"comboSelector-text"}).inject(this.elements.inner);this.elements.expander=h.createElement("span",{"class":"comboSelector-expander wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(this.elements.inner);this.elements.container.addEventListener("click",j._launchCtxMenu.bind(j));this.elements.container.addEventListener("contextmenu",j._launchCtxMenu.bind(j));if(this.options.treedocument===null){throw new Error("Invalid attribute in constructor. Missing treedocument")}this.options.treedocument.getXSO().onPostAdd(this._redrawInnerText.bind(this));this.options.treedocument.getXSO().onPostRemove(this._redrawInnerText.bind(this));this.disabled(this.options.disabled);this._redrawInnerText()},disabled:function(i){if(i){this.elements.container.setAttribute("disabled","");this.options.disabled=i}else{this.elements.container.removeAttribute("disabled","");this.options.disabled=i}},_launchCtxMenu:function(o){var p=[],n=this;if(this.options.disabled===false){var k=this.options.treedocument.getRoots();for(var j=0;j<k.length;j++){var l=k[j].options.icons&&k[j].options.icons.length&&k[j].options.icons[0].iconName?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+k[j].options.icons[0].iconName,}:undefined;p.push({title:k[j].getLabel(),type:"CheckItem",state:k[j].isSelected()?"selected":undefined,fonticon:l,action:{"this":this,context:k[j],callback:this._typeSelectedInMenu.bind(this)}})}if(p.length){var m=this.elements.container.getBoundingClientRect();e.show(p,{position:{x:m.left,y:m.bottom}})}}},_typeSelectedInMenu:function(j){var i=j.context;i.select(true);this.dispatchEvent("onSelect",i);this.dispatchEvent("onSelectionChange");this._redrawInnerText()},_redrawInnerText:function(){this.elements.text.empty();var m="",j=[];var n=this.options.treedocument.getSelectedNodes();for(var k=0;k<n.length;k++){j.push(n[k].getLabel())}if(j.length){m=j.join(", ")}else{m=this.options.nlsEmptySelection}if(n.length===1&&n[0].options.icons){var l=h.createElement("div",{"class":"iconMenu wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+n[0].options.icons[0].iconName}).inject(this.elements.text);if(n[0].options.subLabel){this.elements.text.title=n[0].options.subLabel}}h.createElement("p",{text:m}).inject(this.elements.text)}});return a});define("DS/PADServices/views/utils/Iconbar",["css!DS/PADServices/PADServices.css","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Event","UWA/Utils","UWA/Controls/Abstract","DS/UIKIT/Menu","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],function(i,m,f,p,j,g,h,l,a){function c(u,t){var q=u.length;for(var r=0;r<q;r++){var s=u[r];t(s,r)}}var e=f.Utils.Client.Features.touchEvents;function o(r,t,q){var s;return function(){var x=this,w=arguments,v,u=function(){s=null;if(!q){r.apply(x,w)}};v=q&&!s;clearTimeout(s);s=setTimeout(u,t);if(v){r.apply(x,w)}}}var n=(function(){var q=/^(divider)$/;return function(s){var t=false;var u,r;if(!s){return false}u=s.split(" ");for(r=0;r<u.length&&t===false;r++){if(q.test(u[r])){t=true}}return t}}());var d=h.extend({name:"iconbar-items",templateClassname:"iconbar-template"});var k=a.extend({show:function(){document.body.style.overflow="hidden";this._parent();document.body.style.overflow="auto"}});var b=g.extend({name:"iconbar",menu:null,overflowMenu:null,overflowMenuTrigger:null,init:function(q){if(q.renderTo===undefined){throw new Error("renderTo options is Mandatory")}var r=this;this._parent(q);this.buildSkeleton();this.handleEvents();this.show()},buildSkeleton:function(){var r=this.elements,q=this.options;if(r.container){return}this.menu=new d({multiSelect:q.multiSelect});this.addItem(q.items);r.container=this.menu.elements.container;r.container.className=this.getClassNames();r.container.addClassName("enx-iconbar");if(q.renderTo&&q.renderTo.nodeType===1){r.container.inject(q.renderTo);delete q.renderTo}},buildOverflowMenu:function(){var r=[],s,q;if(!this.overflowMenuTrigger){this.overflowMenuTrigger=f.createElement("li",{"class":this.name+"-overflow-menu-trigger item",html:{tag:"span","class":"fonticon fonticon-menu-dot"}})}this.overflowMenu&&this.overflowMenu.destroy();this.overflowMenu=null;this.menu.items.forEach(function(t){if(t.content&&t.content.type==="dropdown"){return}q=true;s={className:(t.id+" "+(t.className?t.className:"")).trim(),fonticon:t.fonticon,text:t.text,name:t.name,handler:t.handler,selectable:t.selectable,selected:t.selected,disabled:t.disabled};if(t.content&&t.content.options.items&&t.content.type!=="icondropdown"){s.items=t.content.options.items.map(function(u){u.className=(t.id+" "+(u.className?u.className:"")).trim();u.selectable=true;return u})}else{if(t.content&&t.content.type==="icondropdown"){q=false;t.content.options.items&&t.content.options.items.forEach(function(u){r.push({className:(t.id+" "+(u.className?u.className:"")).trim(),fonticon:u.fonticon,icon:u.icon,handler:u.handler,text:u.description})})}}q&&r.push(s)});this.overflowMenu=new k({multiSelect:this.options.multiSelect,items:r,target:this.overflowMenuTrigger,events:this.options.events})},getItem:function(u){var s,q,r,t=false;for(s=0,q=this.menu.items.length;s<q;s++){t=this.menu.items[s];if(u&&u.nodeType){r=u.hasClassName("item")?u:u.getParent();if(t.id===r.id){break}}else{if(s===u||t.id===u||t.name===u){break}}t=false}return t},handleEvents:function(){this.events={container:{click:function(q){var s=p.getElement(q),r=this.getItem(s);if(r.selectable){this.select(r.name,!r.selected)}if(r){if(r.content){window.requestAnimationFrame?window.requestAnimationFrame(this.displayContent.bind(this,r)):this.displayContent(r)}if(r.tooltip&&r.tooltip.isVisible&&!e){r.tooltip.hide()}this.dispatchEvent("onClick",[q,r],this);if(typeof r.handler==="function"){r.handler.call(this,q,r)}}}.bind(this)}};this.elements.container.addEvents(this.events.container);this.events.window={resize:o(this.resize,100).bind(this)};window.addEventListener("resize",this.events.window.resize)},addItem:function(q){j.splat(q).forEach(function(r){this._addItem(r)},this);this.buildOverflowMenu();return this},_addItem:function(q){var r=this.menu._addItem(q);r.content=r.innerComponent||r.content;if(!n(q.className)&&r.text){r.tooltip=new l({target:r.elements.container,body:r.text,trigger:r.tooltipTrigger||this.options.tooltipsTrigger||"hover focus"});r.tooltip.getContent().addClassName("enx-tooltip-iconbar");r.elements.container.getElement(".item-text").remove()}},isOverflowing:function(){return this.menu.items.some(function(q){return !q.elements.container.isInViewport(this.elements.container,true,true)}.bind(this))},isInjected:function(){if(!this.elements){return}if(!this.elements.container){return}return this.elements.container.isInjected()},resize:(function(){function r(){var s=this.elements.container.getBoundingClientRect();return this.menu.items.filter(function(u){var t=u.elements.container.getBoundingClientRect();return(t.top+t.height>s.bottom)||(t.left+t.width>s.right)},this)}function q(s){var t;this.overflowMenu.items.forEach(function(u){t=s.some(function(v){if(!u.className){return false}return u.className&&u.className.indexOf(v)!==-1});t?u.elements.container.removeClassName("hidden"):u.elements.container.addClassName("hidden")})}return function(){var s,t;this.overflowMenuTrigger&&this.overflowMenuTrigger.isInjected()&&this.overflowMenuTrigger.remove();if(this.overflowMenu.isVisible){this.overflowMenu.hide()}if(this.elements.container&&!this.isOverflowing()){return}s=r.call(this);t=s.map(function(u){return u.id});q.call(this,t);if(s.length){this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,s[0].elements.container);while(!this.overflowMenuTrigger.isInViewport(this.elements.container,true,true)&&this.overflowMenuTrigger.previousSibling){this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,this.overflowMenuTrigger.previousSibling);s.push(this.overflowMenuTrigger.nextSibling);this.overflowMenuTrigger.nextSibling.id&&t.push(this.overflowMenuTrigger.nextSibling.id);q.call(this,t)}}}}()),displayContent:function(r){var q=f.clone(r.content.options);q.target=r.elements.container;if(!r.content.created){if(r.content.type==="dropdown"){require(["DS/UIKIT/Dropdown"],function(s){r.content.component=new s(q).show()})}else{if(r.content.type==="icondropdown"){require(["DS/UIKIT/IconDropdown"],function(s){r.content.component=new s(q).show()})}else{if(r.content.type==="dropdownmenu"){r.content.component=new a(q).show();r.content.component.getContent().addClassName("enx-dropdown-iconbar")}else{return}}}r.content.created=true}else{r.content.component&&r.content.component.show()}},select:function(){var q=arguments,t,s,u,r;if(q[0]===undefined||q[0]===null){return}s=(q[1]===undefined)?true:q[1];if(this.options.multiSelect!==true){s&&c(this.elements.container.querySelectorAll(".selected"),function(v){v.removeClassName&&v.removeClassName("selected")});s&&this.overflowMenu.getSelectedItems().forEach(function(v){this.overflowMenu.menus[0].toggleSelection(v);v.elements.container.removeClassName("selectable")},this)}t=this.getItem(q[0]);t.selected=s;if(!t||t.elements.container.hasClassName("divider")){return}t.elements.container[s?"addClassName":"removeClassName"]("selected");u=t.elements.container.id;r=this.overflowMenu.items.filter(function(v){return v.elements.container.hasClassName(u)});if(r.length===1){this.overflowMenu.menus[0].toggleSelection(r[0]);r[0].elements.container.addClassName("selectable");r[0].selected=s}},enableItem:function(r){this.menu.enableItem(r);var q=this.getItem(r);if(q){q.disabled=false}},disableItem:function(r){this.menu.disableItem(r);var q=this.getItem(r);if(q){q.disabled=true}},show:function(){if(!this.isInjected()){return}this._injectionObserver&&this._injectionObserver.disconnect();this._injectionObserver=null;this._parent();if(!window.requestAnimationFrame){this.resize()}else{window.requestAnimationFrame(this.resize.bind(this))}},destroy:function(){window.removeEventListener("resize",this.events.window.resize);this.overflowMenu&&this.overflowMenu.destroy();this.overflowMenuTrigger&&this.overflowMenuTrigger.destroy();this.elements.container.removeEvents(this.events.container);this.menu.items.forEach(function(q){q.tooltip&&q.tooltip.destroy()});this._parent()}});return b});define("DS/PADServices/views/utils/SearchInput",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Event","DS/Controls/ButtonGroup","DS/Controls/Button"],function(e,b,f,d,i,h,a,g){var c=d.extend(i,{name:"enx-search-input",init:function(l){this._parent(l);var n=this;this.elements.container=UWA.createElement("div",{"class":this.getClassNames(l.className?l.className:"")});this.elements.inner=UWA.createElement("div",{"class":this.getClassNames("-inner")}).inject(this.elements.container);var o=UWA.createElement("div",{"class":this.getClassNames("-input-container")}).inject(this.elements.inner);this.elements.input=UWA.createElement("input",{"class":this.getClassNames("-input"),type:"text",placeholder:this.options.placeholder?this.options.placeholder:b.searchInput.placeholder}).inject(o);var k=UWA.createElement("div",{"class":this.getClassNames("-right")}).inject(this.elements.inner);var j=UWA.createElement("div",{"class":this.getClassNames("-clear")+this.getClassNames("-btn")}).inject(k);this.elements.clearBtn=UWA.createElement("div",{"class":this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear"),title:b.searchInput.clear}).inject(j);this.elements.clearBtn.hide();var m=UWA.createElement("div",{"class":this.getClassNames("-search")+this.getClassNames("-btn")}).inject(k);this.elements.searchBtn=UWA.createElement("div",{"class":this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search"),title:b.searchInput.search}).inject(m);this.elements.searchBtn.setStyle("opacity","0.1");this.elements.searchBtn.addEventListener("click",this._onSearch.bind(this));this.elements.clearBtn.addEventListener("click",this._onClearSearch.bind(this));this.elements.input.addEventListener("keyup",this._onSearchInputKeyUp.bind(this));this.elements.input.addEventListener("paste",this._onSearchInputPaste.bind(this));this.elements.input.addEventListener("keydown",this._onSearchInputKeyDown.bind(this))},clear:function(j){this._onClearSearch(null,j)},_onSearch:function(k){var j=this;this.elements.input.blur();this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onClearSearch:function(l,j){var k=this;this.elements.input.value="";this.elements.clearBtn.hide();this.elements.searchBtn.setStyle("opacity","0.1");if(j!==true){this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})}},_onSearchInputKeyUp:function(j){var k=this;if(this.elements.input.value){this.elements.searchBtn.setStyle("opacity","1");this.elements.clearBtn.setStyle("display","inline-block");this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})}else{this.elements.clearBtn.hide();this.elements.searchBtn.setStyle("opacity","0.1");this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})}},_onSearchInputPaste:function(j){var k=this;setTimeout((function(){k._onSearchInputKeyUp()}).bind(this),200)},_onSearchInputKeyDown:function(j){var k=this;if(h.whichKey(j)==="return"||j.keyIdentifier==="Enter"||j.keyIdentifier==="return"){this._onSearch()}h.stopPropagation(j)}});return c});define("DS/PADServices/ws/WSPromises",["UWA/Class/Promise","DS/PADUtils/Configuration","DS/PADUtils/utilsWS/WSAccessV2","DS/PADUtils/utilsWS/WSAccessV1"],function(f,d,e,h){function b(i){return typeof i==="string"?JSON.parse(i):i}function c(j,i){return function(k){var l=arguments;return new f(function(n,m){k.onComplete=function(p){var o=b(p);n(o)};k.onFailure=function(o){m(o)};j[i].apply(j,l)})}}function g(){this._buildPromiseWrappers()}g.prototype={_buildPromiseWrappers:function(){var l=Object.getPrototypeOf(this);var o=e;if(d.getConfig("WSAccessV2")!==true){o=h}var j=Object.getOwnPropertyNames(o);for(var n=0;n<j.length;n++){var k=j[n];if(UWA.is(o[k],"function")){if(!l.hasOwnProperty(k)){var m=c(o,k);Object.defineProperty(l,k,{value:m,writable:false})}}}}};var a;if(!a){a=new g()}return a});define("DS/PADServices/commands/HomeCmd",["DS/ApplicationFrame/Command"],function(b){var a=b.extend({execute:function(c){require(["DS/PADServices/utils/GlobalModelEvents"],function(d){d.getModelEvents().publish({event:"ENXViews/PADPager/close",data:"fromHome"});d.getModelEvents().publish({event:"ENXViews/WelcomePanel/activate",data:"fromHome"})})}});return a});define("DS/PADServices/views/utils/WelcomeAndShell",["css!DS/PADServices/PADServices.css","UWA/Controls/Abstract"],function(a,e){var b=function(i,h,k,j,f){var g={id:k,text:j};if(f){g.fonticon=f}h.actions.push(g)};var c=function(g,i,h){var f={id:i,title:h,actions:[]};g.push(f);return f};var d=e.extend({name:"enx-welcome-shell",defaultOptions:{triptych:{withtransition:true,withoverflowhidden:false,left:{resizable:false,originalState:"open",withClose:false},modelEvents:null},subscriptions:[]},init:function(f){this._parent(f)},initialize:function(){var f=this;return new Promise(function(g){require(["DS/ENOXWelcomePanel/js/ENOXWelcomePanel","DS/ENOXTriptych/js/ENOXTriptych"],function(i,m){var k=f.elements.leftPlaceHolder=UWA.createElement("div",{"class":f.getClassNames("-welcomeLeft")});f.options.triptych.modelEvents=f.options.modelEvents;f.options.triptych.container=f.options.container;var l=f.elements.triptych=new m();l.init(f.options.triptych,k,undefined);var h=[];for(var p=0;p<f.options.activities.length;p++){if(f.options.activities[p].section){var o=f.options.activities[p].section;var j=c(h,o.id,o.title);for(var n=0;n<o.actions.length;n++){b(h,j,o.actions[n].id,o.actions[n].title,o.actions[n].icon)}}else{if(f.options.activities[p].id&&f.options.activities[p].actions){h.push(UWA.clone(f.options.activities[p]))}}}var q=f.elements.welcomePanel=new i({collapsed:false,parentContainer:k,modelEvents:f.options.modelEvents,activities:h});q.render();f.options.subscriptions.push(f.options.modelEvents.subscribe({event:"ENXViews/WelcomeAndShell/setMainView"},function(r){f.options.modelEvents.publish({event:"triptych-set-content",data:{side:"middle",content:r.html}})}));if(f.options.defaultActionId){q.selectAction(f.options.defaultActionId);f.options.modelEvents.publish({event:"welcome-panel-action-selected",data:{id:f.options.defaultActionId}})}g()})})},setAction:function(f){this.elements.welcomePanel.selectAction(f);this.options.modelEvents.publish({event:"welcome-panel-action-selected",data:{id:f}})},destroy:function(){for(var f=0;f<this.options.subscriptions.length;f++){this.options.modelEvents.unsubscribe(this.options.subscriptions[f])}this.elements.triptych.destroy();delete this.elements.triptych}});return d});define("DS/PADServices/views/utils/WizardSteps",["text!DS/PADServices/assets/templates/WizardSteps.html","css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars","DS/Core/Core","css!DS/UIKIT/UIKIT.css"],function(j,f,b,c,d,a,e,g){var i=a.compile(j);a.registerHelper("getlabel",function(m){var n=require("i18n!"+this.label.file);var o=this.label.key.split(".");var l=n;for(var k=0;k<o.length;k++){l=l[o[k]]}return l});var h=d.extend({name:"enx-wizard-container",defaultOptions:{subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeStep:null},init:function(n){this._parent(n);this.elements.container=c.createElement("div",{"class":this.getClassNames()});if(this.options.steps){this.elements.container.setContent(i(this.options.steps))}if(this.options.renderTo){this.elements.container.inject(this.options.renderTo)}this.options.rope=this.elements.container.getElement("div.enx-wizard-rope");this.options.navigator=this.elements.container.getElement("nav.enx-view-navigator");var o=this.elements.container.getElement("a.nav-item.active");if(o){var m=o.id;this._render2ActiveStep(m)}var p=this;var l=this.options.navigator.getElements("a");for(var k=0;k<l.length;k++){l[k].addEventListener("click",function(r){var q=r.currentTarget.id;p.changeStep(q)})}this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/changeStep",},function(r){var q=r.stepId;p.changeStep(q)}))},changeStep:function(k){this._render2ActiveStep(k);this.options.modelEvents.publish({event:"ENXViews/WizardSteps/stepChanged",data:{stepId:k}})},destroy:function(){for(var k=0;k<this.options.subscribeTokens.length;k++){this.options.modelEvents.unsubscribe(this.options.subscribeTokens[k])}this._parent()},_render2ActiveStep:function(r){var l=this.options.navigator.getElements("a");var n=false,m;for(var k=0;k<l.length;k++){var o=l[k];if(n===false){o.removeClassName("filled").addClassName("filled")}else{o.removeClassName("filled")}if(o.id===this.options.activeView){o.removeClassName("active")}if(o.id===r){o.addClassName("active");var p=o.getElement(".view-icon.enx-icon");var q="100%";if(k<l.length-1){q=(Math.floor(100/(l.length+1)))*(k+1)+"%"}this.options.rope.setStyles({width:q,height:"2px"});m=o.id;n=true}}this.options.activeView=m}});return h});define("DS/PADServices/utils/GlobalModelEvents",["DS/CoreEvents/ModelEvents"],function(c){var b=new c();var a={getModelEvents:function(){return b},publish:function(d){return b.publish(d)},subscribe:function(d,e){return b.subscribe(d,e)},unsubscribe:function(d){return b.unsubscribe(d)},unsubscribeAll:function(d){return b.unsubscribeAll(d)}};return a});define("DS/PADServices/utils/SubscriptionHolder",[],function(){function a(b){this.modelEvents=b;this.subscriptions=[]}a.prototype={subscribe:function(b,c){this.subscriptions.push(this.modelEvents.subscribe(b,c))},destroy:function(){for(var c=0;c<this.subscriptions.length;c++){var b=this.subscriptions[c];this.modelEvents.unsubscribe(b)}}};return a});define("DS/PADServices/utils/Storage",[],function(){function a(g,f,e){if(e){return g+"."+widget.id+"."+f}else{return g+"."+f}}function b(e){this.root=e}b.prototype={set:function(e,f){this.root.setItem(e,JSON.stringify(f))},setWithExpire:function(e,g,f){g.expiresAt=Date.now()+f;this.set(e,g)},get:function(g){var f;try{f=JSON.parse(this.root.getItem(g))}catch(h){console.error(h);return null}if(f&&f.expiresAt){if(Date.now()<f.expiresAt){return f}else{this.root.removeItem(g);return null}}else{return f}},del:function(e){this.root.removeItem(e)},clear:function(){this.root.clear()}};var d={local:new b(localStorage),session:new b(sessionStorage)};var c={buildKey:a};Object.defineProperties(c,{local:{get:function(){return d.local}},sess:{get:function(){return d.session}}});return c});define("DS/PADServices/utils/GlobalUtils",["DS/PlatformAPI/PlatformAPI","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(h,i,c){var d;var a=null;var k=null;var b=null;var j=null;var e=null;function f(){var l;var m=document.createElement("fakeelement");var n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(l in n){if(m.style[l]!==undefined){return n[l]}}}var g={setExecutionContext:function(l){a=l;k=a.getComponent("AFR_NotificationManager")},getExecutionContext:function(){return a},displayError:function(m,l){if(k){k.addNotif({title:m,message:l.message,level:"error"})}console.error(m);console.groupCollapsed("Error outputs");console.error("Message:"+l.message);console.error("Stack:"+l.stack);console.groupEnd()},displayNotif:function(m){if(k===null){k=i;c.setNotificationManager(k);c.setStackingPolicy(5)}var l={level:"info",message:"default Message",sticky:false};m=UWA.extend(l,m);k.addNotif(m)},uid:function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)},getLang:function(){return typeof widget!=="undefined"?widget.lang:"en"},deserializeDroppedData:function(p){var o={data:{items:[]}};var n=UWA.is(p.dataTransfer.types.indexOf,"function")?"indexOf":"contains",q="";var t=["text/searchitems","text/plain","Text"];for(var s=0;s<t.length&&q==="";s++){var r=p.dataTransfer.types[n](t[s]);if((UWA.is(r,"number")&&r>=0)||(UWA.is(r,"boolean")&&r===true)){q=t[s]}}var l;if(q!==""){l=p.dataTransfer.getData(q);try{o=JSON.parse(l)}catch(m){}}return o},getUser:function(){if(b===null||b===undefined){b=h.getUser()}return b},getUserLogin:function(){var l=g.getUser();var m="";if(l!==undefined){m=l.login}return m},setSecurityContext:function(l){d=l},getSecurityContext:function(){return d},createCSSClass:function(m,o){var n=document.getElementById(m);if(!UWA.is(n)){var l=document.createElement("style");l.type="text/css";l.id=m;l.innerHTML="."+m+o;document.getElementsByTagName("head")[0].appendChild(l)}},getURLParameter:function(l){function m(n){return decodeURIComponent((new RegExp("[?|&]"+n+"=([^&;]+?)(&|#|;|$)").exec(j)||[null,""])[1].replace(/\+/g,"%20"))||null}if(j===null){j=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}if(j){return m(l)}else{return null}},isWebInWinContext:function(){if(e===null){e=typeof widget!=="undefined"?widget.getValue("addinmode"):""}return(e==="solidworks"||e==="catiav5")},hookTransitionEnd:function(n,p){var m=f();if(m){var o=function(q){p(q)};var l=function(){n.removeEventListener(m,o)};n.addEventListener(m,o);return l}},getPCSPrefix:function(){return typeof widget==="undefined"?"ODTFallbackPrefix":widget.id+"_"+widget.title}};return g});define("DS/PADServices/utils/ParserUtils",["DS/PADUtils/PADUtilsServices","DS/PADUtils/Configuration"],function(c,a){var b={parseAttributes:function(d){var f={};var e=a.getConfig("treeColumn")?a.getConfig("treeColumn"):"ds6w:label";d.forEach(function(g){if(UWA.is(g.value)&&UWA.is(g.value.replace,"function")){g.value=g.value.replace(/\n/g," ")}if(g.name==="physicalid"||g.name==="resourceid"){f.resourceid=g.value}else{if(g.name==="did"){f.did=g.value}else{if(g.name==="ro.plminstance.V_treeorder"){f.relationOrder=parseFloat(g.value);if(isNaN(f.relationOrder)){f.relationOrder=-1}}else{if(g.name==="matrixtxt"){if(c.checkNotIdentity(g.value)){f.instanceMatrix=g.value}}else{if(g.name==="type_icon_url"){if(!f.icons){f.icons=[]}f.icons.push(g.value)}else{if(g.name==="thumbnail_2d"||g.name==="preview_url"){f.thumbnail=g.value;if(!f.grid){f.grid={}}f.grid.thumbnail="url("+g.value+")"}else{if(e===g.name){f.label=g.value;f.display=f.label}else{if(!f.grid){f.grid={}}f.grid[g.name]=g.value}}}}}}}});if(!f.relationOrder){f.relationOrder=-1}return f},parseStructure:function(d,h,e){var g;if(e===false){}else{var f=d.structures;g=h.length;if(Math.abs(g%2)===1){h.forEach(function(j,i){if(!f.hasOwnProperty(j)){f[j]={};if(g===i+1){f[j].pathLeaf=true}if(Math.abs(i%2)===0){f[j].order=[]}}if(f.order&&f.order.indexOf(j)===-1){f.order.push(j)}f=f[j]})}}return d},buildJSONModelFromExpand:function(f){var i={did2resourceid:{},nodes:{},structures:{}};if(f.results===undefined){throw new Error("Response doesn't contains results")}for(var e=0;e<f.results.length;e++){var n=f.results[e];if(n.hasOwnProperty("attributes")){var l=this.parseAttributes(n.attributes);i.nodes[l.resourceid]=l;if(UWA.is(l.did)){i.did2resourceid[l.did]=l.resourceid}}else{if(n.hasOwnProperty("path")){i=this.parseStructure(i,n.path)}else{if(n.hasOwnProperty("icon__default_thumbnail_2d")){for(var k=0;k<n.icon__default_thumbnail_2d.length;k++){var j=n.icon__default_thumbnail_2d[k];for(var d=0;d<j.did.length;d++){var m=j.did[d];var h=i.did2resourceid[m];var g=i.nodes[h];if(!g.icons||g.icons.length===0){if(!g.icons){g.icons=[]}g.icons.push(j.icon)}if(!g.thumbnail||g.thumbnail.length===0){g.thumbnail=j.thumbnail_2d}}}}}}}return i}};return b});define("DS/PADServices/utils/AttributesMgt",["text!DS/PADServices/assets/init/AttributesMgt.json","UWA/Class/Promise","DS/WebappsUtils/WebappsUtils"],function(d,e,a){var i=[],g={initColumnMap:function(){var j;var m=Object.getOwnPropertyNames(f._columnsMgt);for(var l=0;l<m.length;l++){var k=m[l];if(k==="baseTypes"){f._baseTypes=f._columnsMgt[k]}else{if(k==="selectedTypes"){f._selectedTypes=f._columnsMgt[k]}else{if(k==="selectedExtensions"){f._selectedExtensions=f._columnsMgt[k]}else{if(k==="attributes"||k==="commandColumns"){for(j=0;j<f._columnsMgt[k].length;j++){if(UWA.is(f._columnsMgt[k][j].dataIndex)){f._colsMap[f._columnsMgt[k][j].dataIndex]=f._columnsMgt[k][j]}else{f._colsMap[f._columnsMgt[k][j].ds6w]=f._columnsMgt[k][j]}if(f._columnsMgt[k][j].defaultValue){i.push([f._columnsMgt[k][j].ds6w])}if(f._columnsMgt[k][j].tree===true){f._treeColumn=f._columnsMgt[k][j].ds6w}}}}}}}},};var f={_columnsMgt:JSON.parse(d),_colsMap:{},_baseTypes:[],_selectedTypes:[],_selectedExtensions:[],_defaultColumnsMgt:{},_treeColumn:"ds6w:label",_additionalColumns:[],_columns4BI:[],_intentActivated:false,updateAttributesList:function(l,k){var j;if(Array.isArray(l)){for(j=0;j<l.length;j++){if(l[j].isAdditionalColumn!==true){if(typeof f._colsMap[l[j].dataIndex]==="undefined"&&(k===true||f.isAttributeColumn(l[j].dataIndex))){f._columnsMgt.attributes.push(l[j])}f._colsMap[l[j].dataIndex]=l[j]}if(l[j].tree==true){f._treeColumn=l[j].ds6w?l[j].ds6w:l[j].name}}}else{if(UWA.is(l.attributes)){for(j=0;j<l.attributes.length;j++){if(UWA.is(f._colsMap[l.attributes[j].ds6w])){console.warn("Already existing attribute ["+JSON.stringify(l.attributes[j])+"]")}else{f._columnsMgt.attributes.push(l.attributes[j]);if(UWA.is(l.attributes[j].dataIndex)){f._colsMap[l.attributes[j].dataIndex]=l.attributes[j]}else{f._colsMap[l.attributes[j].ds6w]=l.attributes[j]}if(l.attributes[j].defaultValue){i.push([l.attributes[j].ds6w])}}}}if(UWA.is(l.commandColumns)){for(j=0;j<l.commandColumns.length;j++){if(UWA.is(f._colsMap[l.commandColumns[j].dataIndex])){console.warn("Already existing command ["+JSON.stringify(l.commandColumns[j])+"]")}else{f._columnsMgt.commandColumns.push(l.commandColumns[j]);f._colsMap[l.commandColumns[j].dataIndex]=l.commandColumns[j];if(l.commandColumns[j].defaultValue){i.push([l.commandColumns[j].dataIndex])}}}}if(UWA.is(l.order,"array")){f._columnsMgt.order=l.order}if(UWA.is(l.baseTypes,"array")){f._baseTypes=l.baseTypes}if(UWA.is(l.selectedTypes,"array")){f._selectedTypes=l.selectedTypes}if(UWA.is(l.selectedExtensions,"array")){f._selectedExtensions=l.selectedExtensions}f._columnsMgt.typeRepresentations=UWA.merge(f._columnsMgt.typeRepresentations,l.typeRepresentations);if(l["default"]===true){f._defaultColumnsMgt=UWA.clone(f._columnsMgt)}}},convertAttribute:function(j,k){var l=k;switch(j){case"ds6w:cadMaster":l=b(k);break}if(typeof f._colsMap[j]!=="undefined"){switch(f._colsMap[j].kind){case"boolean":l=c(k);break}}return l},completeNodeOptions:function(k){for(var l=0;l<i.length;l++){var j=f._colsMap[i[l]];if(!UWA.is(k.grid[i[l]])){k.grid[i[l]]=j.defaultValue}}return k},getAttributesToQuery:function(){var k={select_bo:["physicalid"],select_rel:["physicalid"]};for(var j=0;j<f._columnsMgt.attributes.length;j++){if(f._columnsMgt.attributes[j].ds6wFrom==="rel"&&f._columnsMgt.attributes[j].ds6w){k.select_rel.push(f._columnsMgt.attributes[j].ds6w)}else{if(f._columnsMgt.attributes[j].ds6w){k.select_bo.push(f._columnsMgt.attributes[j].ds6w)}}}if(f._columns4BI.length){k.select_bo=k.select_bo.concat(f._columns4BI)}return k},hasNLS:function(k){var j=true;if(f._colsMap[k]&&UWA.is(f._colsMap[k].hasNLS,"boolean")){j=f._colsMap[k].hasNLS}return j},getBaseTypes:function(){return f._baseTypes},getSelectedTypes:function(){return f._selectedTypes},getSelectedExtensions:function(){return f._selectedExtensions},resetSelectedParams:function(){f._colsMap={};f._columnsMgt={attributes:[],commandColumns:[]};f._baseTypes=[];f._selectedTypes=[];f._selectedExtensions=[];this.updateAttributesList(f._defaultColumnsMgt)},getDefaultTypesAndExtensions:function(){return{defaultTypes:f._defaultColumnsMgt.selectedTypes,defaultExtensions:f._defaultColumnsMgt.selectedExtensions}},updateSelectedParams:function(j){if(j.selectedTypes){f._selectedTypes=j.selectedTypes}if(j.selectedExtensions){f._selectedExtensions=j.selectedExtensions}},getAvailableColumns:function(){return Object.getOwnPropertyNames(f._colsMap)},addAvailableColumn:function(l,m,j){var k;var n=require("DS/PADServices/utils/AttributesViewMgt");if(typeof f._colsMap[l]==="undefined"){k=n.buildColumnFromSetting(m,j);f._colsMap[l]=k;if(k.ds6w){f._columnsMgt.attributes.push(k)}}else{k=n.buildColumnFromSetting(m,j)}return k},removeAvailableColumn:function(l){if(typeof f._colsMap[l]!=="undefined"){delete f._colsMap[l];var k=-1;for(var j=0;k===-1&&j<f._columnsMgt.attributes.length;j++){if(f._columnsMgt.attributes[j].dataIndex===l){k=j}}if(k!==-1){f._columnsMgt.attributes.splice(k,1)}}},addBIColumn:function(j){if(f._columns4BI.indexOf(j)==-1&&typeof f._colsMap[j]==="undefined"){f._columns4BI.push(j)}},removeBIColumn:function(j){if(f._columns4BI.indexOf(j)!==-1){f._columns4BI.splice(f._columns4BI.indexOf(j),1)}},addAsyncAttributes:function(k){for(var j=0;j<k.length;j++){if(f._additionalColumns.indexOf(k[j])===-1){f._additionalColumns.push(k[j])}else{console.warn("Async Attribute["+k[j]+"] already defined")}}},getAdditionalColumns:function(){return f._additionalColumns},getTreeColumn:function(){return f._treeColumn},retrieveTypeRepresentations:function(){return f._columnsMgt.typeRepresentations?f._columnsMgt.typeRepresentations:[]},intentActivated:function(){return this._intentActivated},useIntent:function(){this._intentActivated=true;this._columnsMgt={baseTypes:["VPMReference","VPMRepReference"],selectedTypes:["VPMReference","VPMRepReference","3DShape"],selectedExtensions:["XCADExtension","EnterpriseExtension"],order:[],attributes:[],commandColumns:[],typeRepresentations:{}};this._colsMap={};this._baseTypes=["VPMReference","VPMRepReference"];this._selectedTypes=["VPMReference","VPMRepReference","3DShape"];this._selectedExtensions=["XCADExtension","EnterpriseExtension"];this._defaultColumnsMgt={};this._treeColumn="";this._additionalColumns=[];this._columns4BI=[]},getAvailableColumnsOpts:function(){var l=[],k=Object.keys(this._colsMap);for(var j=0;j<k.length;j++){if(["hide_show","find_in_ctx"].indexOf(this._colsMap[k[j]].dataIndex)===-1){l.push(this._colsMap[k[j]])}}return l},isAttributeColumn:function(j){var l=["bi_color","selection","hide_show","find_in_ctx","instanceName","instanceMatrix","thumbnail"];var k=true;if(f._columnsMgt.commandColumns[j]){k=false}else{if(f._columnsMgt.attributes[j]&&f._columnsMgt.attributes[j].ds6wFrom==="rel"){k=false}else{if(l.indexOf(j)!==-1){k=false}}}return k}};var c=function(k){var j=false;if(UWA.is(k,"boolean")){j=k}else{if(UWA.is(k,"string")){j=k.toLowerCase()==="true"}}return j};var h=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CadenceAllegro","3DEXPERIENCE"];function b(j){for(var k=0;k<h.length;k++){if(h[k]===j){return a.getWebappsAssetUrl("ENXNav","icons/cadmasters/I_CADMaster"+j+".png")}}}g.initColumnMap();return f});define("DS/PADServices/utils/PlatformURL",["UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(d,e){var b=null;var c={};var a={retrievePlatformUrl:function(f){return new d(function(i,h){var g=[];if(b===null){g.push(new d(function(j,k){e.getPlatformServices({onComplete:function(l){b=l;j()},onFailure:function(l){k(l)}})}))}if(f&&f.initWSAcess===true){g.push(new d(function(j,k){require(["DS/PADServices/ws/WSAccess"],function(l){l.initialize({addDefaults:f.addDefaults,WSDefinitionAMDs:f.WSDefinitionAMDs}).then(j)["catch"](k)},k)}))}d.all(g).then(i)["catch"](h)})},getPlatformId:function(){return(typeof widget!=="undefined"&&widget.getValue("x3dPlatformId"))?widget.getValue("x3dPlatformId"):"OnPremise"},getTenantInfo:function(h){var g={};for(var f=0;f<b.length;f++){if(b[f].platformId===h){g=b[f];break}}return g},get3DSpaceURL:function(){return a.getPlatformURL("3DSpace")},getPlatformURL:function(g){if(!UWA.is(b,"array")){throw new Error("Platform services not initialize yet")}var f=0,i=a.getPlatformId(),h=a.getTenantInfo(i);if(h[g]===undefined){console.error("No "+g+" URL available for this tenant.");throw new Error("Unknown service "+g)}else{return h[g]}},};return a});define("DS/PADServices/views/AttributesCustomization",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/views/utils/Iconbar","DS/PADServices/views/utils/ComboSelector","DS/PADServices/utils/GlobalUtils","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","DS/Utilities/Dom"],function(j,d,b,o,c,k,g,r,n,i,l,u,f,q,a,t,s){var h=["selection","hide_show","find_in_ctx","instanceName","instanceMatrix","thumbnail"];var e={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){var v={property:"text",value:undefined};if(typeof this.options.grid.hasTitle==="undefined"||this.options.grid.hasTitle){v.value=this.options.grid.attrTitle}return v},function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"ds6w",value:h.indexOf(this.options.grid.attrName)===-1?this.options.grid.attrName:undefined}},function(){var v={property:"grid",value:this.options.grid};delete v.value.remove;return v},function(){return{property:"hasNLS",value:typeof this.options.grid.hasTitle!=="undefined"?this.options.grid.hasTitle:true}},function(){return{property:"noTitleColumn",value:typeof this.options.grid.hasTitle!=="undefined"?!this.options.grid.hasTitle:false}},function(){return{property:"kind",value:this.options.kind}},]};function p(v,y){for(var x=0;x<v.length;x++){var w=v[x];if(w.dataIndex===y){return w}if(w.xnav_options){if(w.xnav_options.name===y){return w}}}}var m=r.extend({name:"attr-customization",defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:false,applyOnlyToThisApp:false,baseTypes:[],selectedTypes:[],selectedExtensions:[],rowHeaderActivated:true,thumbnailsActivated:false,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:false,showRowBorderFlag:true,showAlternateBackgroundFlag:false,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:true,canMultiSelect:true,enableFeedbackForActiveCell:true,enableShiftSelection:true,toggle:false,unselectAllOnEmptyArea:true},columns:[{icon:{iconName:"eye",fontIconFamily:1},tooltip:d.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:true,width:30,editableFlag:true,editionPolicy:"EditionInPlace",sortableFlag:false,resizableFlag:false,getCellEditableState:function(w){var v=true;if(w.nodeModel.options.grid.layout&&typeof w.nodeModel.options.grid.layout.removableFromView!=="undefined"){v=w.nodeModel.options.grid.layout.removableFromView}else{if(w.nodeModel.options.pinColumn===true){v=false}}return v},getCellTypeRepresentation:function(v){if(v.nodeModel&&v.nodeModel.options.pinColumn===true){return"string"}else{return"boolean"}}},{text:d.attributesCustomization.attrTitle,dataIndex:"attrTitle",typeRepresentation:"string",editableFlag:false,editionPolicy:"EditionOnDoubleClick",sortableFlag:false,resizableFlag:false,getCellEditableState:function(w){var v=true;if(!w.nodeModel){v=false}else{if(h.indexOf(w.nodeModel.options.columnIndex)!==-1||w.nodeModel.options.pinColumn===true||w.nodeModel.options.grid.isAdditionalColumn===true){v=false}}return v}},{icon:{iconName:"pin",fontIconFamily:1},dataIndex:"pinContent",typeRepresentation:"pin",alignmentValue:"center",alwaysVisibleFlag:true,width:100,editableFlag:true,editionPolicy:"EditionInPlace",sortableFlag:false,resizableFlag:false,getCellEditableState:function(w){var v=true;if(w.nodeModel.options.grid.layout&&typeof w.nodeModel.options.grid.layout.pinEditable!=="undefined"){v=w.nodeModel.options.grid.layout.pinEditable}else{if(w.nodeModel.options.pinColumn===true){v=false}}return v}},{icon:{iconName:"export",fontIconFamily:1},dataIndex:"exportContent",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:true,width:30,editableFlag:true,editionPolicy:"EditionInPlace",sortableFlag:false,resizableFlag:false,getCellEditableState:function(w){var v=typeof w.nodeModel.options.grid.exportLock==="undefined"?false:!w.nodeModel.options.grid.exportLock;if(w.nodeModel.options.pinColumn===true){v=false}return v},getCellTypeRepresentation:function(v){if(v.nodeModel&&v.nodeModel.options.pinColumn===true){return"string"}else{return"boolean"}},getCellSemantics:function(w){var v=typeof w.nodeModel.options.grid.exportLock==="undefined"?false:w.nodeModel.options.grid.exportLock;if(w.nodeModel.options.pinColumn===true){v=true}return{disabled:v}}},{icon:{iconName:"palette",fontIconFamily:1},dataIndex:"columnColor",alignmentValue:"center",alwaysVisibleFlag:true,width:30,editableFlag:false,sortableFlag:false,resizableFlag:false,typeRepresentation:"colorChange",getCellSemantics:function(C){if(C.nodeModel){var w="#ffffff";var y="#000000";if(C.nodeModel.options.grid&&C.nodeModel.options.grid.columnColor){w=C.nodeModel.options.grid.columnColor["background-color"]?C.nodeModel.options.grid.columnColor["background-color"]:"#ffffff";w=w.replace(/;/g,"");y=C.nodeModel.options.grid.columnColor.color?C.nodeModel.options.grid.columnColor.color:"#0000";y=y.replace(/;/g,"");if(w!=="#ffffff"){var A="enx-background-color-"+w.replace(/\#/g,"");var x="{background-color:"+w+";}";c.createCSSClass(A,x);C.cellView.getContent().addClassName(A)}else{var B=C.cellView.getContent().classList;for(var v=0;v<B.length;v++){if(B.item(v).contains("enx-background-color-")){C.cellView.getContent().removeClassName(B.item(v))}}}if(y!=="#000000"){var z="enx-color-"+y.replace(/\#/g,"");var x="{color:"+y+";}";c.createCSSClass(z,x);C.cellView.getContent().addClassName(z)}else{var B=C.cellView.getContent().classList;for(var v=0;v<B.length;v++){if(B.item(v).contains("enx-color-")){C.cellView.getContent().removeClassName(B.item(v))}}}}}},getCellEditableState:function(w){var v=true;if(w.nodeModel.options.pinColumn===true){v=false}return v},},{icon:{iconName:"trash",fontIconFamily:1},dataIndex:"attrRemove",alignmentValue:"center",alwaysVisibleFlag:true,width:30,sortableFlag:false,resizableFlag:false,editableFlag:false,getCellTypeRepresentation:function(v){if(v.nodeModel&&v.nodeModel.options.pinColumn===true){return"string"}else{if(v.nodeModel&&(v.nodeModel.options.grid.isAdditionalColumn===true||(v.nodeModel.options.grid.layout&&v.nodeModel.options.grid.layout.removable===false))){return"actionNotRemove"}else{return"actionRemove"}}},getCellSemantics:function(v){if(v.nodeModel&&(v.nodeModel.options.grid.isAdditionalColumn===true||(v.nodeModel.options.grid.layout&&v.nodeModel.options.grid.layout.removable===false))){return{disabled:true}}}},{dataIndex:"tree",visibleFlag:false}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:true}},init:function(w){this._parent(w);var x=this;var v=c.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";x.elements.container=g.createElement("div",{"class":x.getClassNames(v)});t.retrievePlatformUrl({addDefaults:true,initWSAcess:true}).then(function(){x._buildBody();x._buildFooter();x.elements.panel2small=g.createElement("div",{"class":x.getClassNames("-panel2small"),text:d.attributesCustomization.panel2small}).inject(x.elements.container);x.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{title:d.attributesCustomization.apptitle,html:x.elements.container}})})},destroy:function(){for(var v=0;v<this.options.subscribeTokens.length;v++){this.options.modelEvents.unsubscribe(this.options.subscribeTokens[v])}this.options.toolbar.destroy();this._parent()},_buildBody:function(){this._buildIconBar();this.elements.dgv=g.createElement("div",{"class":this.getClassNames("-dgv")}).inject(this.elements.container);var x=this.options.dgvOptions;if(this.options.withDgv!==true){x.columns.splice(2,1)}var y=g.extend({identifier:"DataGridView-attrCusto-"+c.uid()},this.options.dgvOptions);y.layout=new a(this.options.dgvLayoutOptions);var v=this.options.grid=new q(y);v.onContextualEvent=function(){return[]};v.getCellTooltip=function(L){var J=this.options.grid.getColumnOrGroup(L.columnID),K=J.dataIndex;L.dataIndex=K;if(L.rowID===-1){return{shortHelp:d.attributesCustomization[K],updateModel:false}}}.bind(this);var I={colorChange:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"text",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};var w={};w[d.attributesCustomization.pinLeft]="left";w[d.attributesCustomization.pinRight]="right";w[d.attributesCustomization.unpinned]="unpinned";v.getTypeRepresentationFactory().registerEnum("pin",w);v.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(I));var C=this;v.registerReusableCellContent({id:"colorChooser",buildContent:function(){var J=s.createElement("div",{"class":"enxCommand",});var K=s.createElement("div",{"class":"enxColorLauncher",styles:{"background-color":"#ffffff",color:"#000000","font-size":"18px"},title:d.attributesCustomization.changeColor});K.innerHTML=d.attributesCustomization.colorContent;J.appendChild(K);return J}});this.options.dataModelSet=new u();this.options.attrModel=new i({dataModelSet:this.options.dataModelSet,shouldBeSelected:function(J){return J.options.pinColumn===true?false:true}});v.treeDocument=this.options.attrModel;v.getContent().addClassName("enxdatagridview");v.getContent().inject(this.elements.dgv);var C=this;v.onReady(function(){v.addEventListener("change",C._cellModified.bind(C));v.addEventListener("click",C._cellClicked.bind(C));C.options.toolbar.show()});this._addColumns();this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this));this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this));this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this));this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},function(J){if(C._isMoving!==true&&C._globalUpdate!==true){C.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[J.data.nodeModel.dump(e)]}})}}));this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},function(O){if(C._isMoving!==true&&C._globalUpdate!==true){var M=O.data.nodeModel.getReferenceValue("attrName");if(h.indexOf(M)!==-1){if(C.options.withDgv===false){var K=C.options.toolbar.getItem("specificColumns");var L=K.content.component;if(L){if(L.isSelected(M)){L.toggleSelection(L.getItem(M))}}else{var Q=K.content.options.items;var P=false,N=0,J=Q.length;do{if(Q[N].id===M){Q[N].selected=false;P=true}else{N++}}while(P===false&&N<J);C.options.toolbar.menu.updateItem(K)}}if(M==="thumbnail"){C.elements.comboCompact.disabled(false)}}C.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[O.data.nodeModel.dump(e)]}})}}));this.elements.behavior=g.createElement("div",{"class":this.getClassNames("-behavior")}).inject(this.elements.container);var A=new i();var E=new l({viewMode:"comfortable",label:d.attributesCustomization.comfortable,subLabel:d.attributesCustomization.comfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});A.addRoot(E);var D=new l({viewMode:"compact",label:d.attributesCustomization.compact,subLabel:d.attributesCustomization.compactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});A.addRoot(D);var H=this.options.attrModel.getRoots().filter(function(J){return J.getReferenceValue("attrName")==="thumbnail"}),z=H.length===1;if(this.options.viewMode==="compact"&&z===false){D.select(true)}else{E.select(true)}this.elements.comboCompact=new o({className:this.getClassNames("-compactmode-selector"),treedocument:A,disabled:z,events:{onSelectionChange:function(){var J=A.getSelectedNodes()[0].options.viewMode;C.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:J}})}}});var B=g.createElement("div",{"class":this.getClassNames("-compactmode-global")});var F=g.createElement("div",{"class":this.getClassNames("-compactmode-label"),text:d.attributesCustomization.density});F.inject(B);this.elements.comboCompact.inject(B);B.inject(this.elements.behavior);this.elements.applyToggle=new f({label:d.attributesCustomization.apply_to_this_app});var G=g.createElement("div",{"class":this.getClassNames("-applytothisapp"),content:this.elements.applyToggle});this.elements.applyToggle.addEventListener("change",function(K){var J=K.dsModel;C.options.applyOnlyToThisApp=J.checkFlag;C.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/applyOnlyToThisApp",data:{applyOnlyToThisApp:C.options.applyOnlyToThisApp}})});G.inject(this.elements.behavior)},_buildFooter:function(){var x=this;var y=g.createElement("div",{"class":x.getClassNames("-footer")}).inject(x.elements.container);var v=new n({label:d.attributesCustomization.close,emphasize:"primary",touchMode:true});v.addEventListener("click",function(){x._closePanel();x.destroy()});v.inject(y);var w=new n({label:d.attributesCustomization.reset,touchMode:true});w.addEventListener("click",function(){x.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:x.options.applyOnlyToThisApp}});x.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:true}});x.destroy()});w.inject(y)},_closePanel:function(){var v=[];this.options.attrModel.getRoots().forEach(function(w){v.push(w.dump(e))});this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:v,applyOnlyToThisApp:this.options.applyOnlyToThisApp}});this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:true}})},_addColumns:function(){var v=this;if(this.options.appColumns===undefined){console.error("AttributesCustomization## Invalid input. Missing property appColumns")}else{v.options.attrModel.withTransactionUpdate(function(){var A,D,G;if(v.options.withDgv===true){A=v.options.pinModel.left=l.createTreeNodeDataModel(v.options.dataModelSet,{columnIndex:"left",label:d.attributesCustomization.pinLeft,grid:{},icons:[{iconName:"left"},{iconName:"pin"}],pinColumn:true,children:[]});v.options.attrModel.addChild(A);D=v.options.pinModel.unpinned=l.createTreeNodeDataModel(v.options.dataModelSet,{columnIndex:"unpinned",label:d.attributesCustomization.unpinned,grid:{},icons:[{iconName:"block"},{iconName:"pin"}],pinColumn:true,children:[]});v.options.attrModel.addChild(D);G=v.options.pinModel.right=l.createTreeNodeDataModel(v.options.dataModelSet,{columnIndex:"right",label:d.attributesCustomization.pinRight,grid:{},icons:[{iconName:"pin"},{iconName:"right"}],pinColumn:true,children:[]});v.options.attrModel.addChild(G)}for(var H=0;H<v.options.appColumns.length;H++){var F=v.options.appColumns[H];if(F.dataIndex!=="bi_color"){var C=g.is(F.text,"string")&&F.text.length>0?F.text:v._retrieveColumnName(F.dataIndex);var I=F.customisation&&F.customisation.exportable?F.customisation.exportable.value:true;var E=F.customisation&&F.customisation.exportable?F.customisation.exportable.lock:false;var B=F.customisation&&F.customisation.styles?F.customisation.styles:{"background-color":"#ffffff",color:"#000000"};var y=F.customisation&&F.customisation.layout?F.customisation.layout:{};var w=F.pinned?F.pinned:"unpinned";var J=typeof F.visibleFlag!=="undefined"?F.visibleFlag:!F.isHidden;if(v.options.withDgv!==true){J=!F.isHidden}var x=F.ds6w&&F.ds6wFrom!=="rel"?F.ds6w:F.dataIndex;var z=l.createTreeNodeDataModel(v.options.dataModelSet,{columnIndex:F.dataIndex,label:C,grid:{attrTitle:C,attrVisible:J,exportContent:I,exportLock:E,columnColor:B,attrName:x,isAdditionalColumn:F.isAdditionalColumn,layout:y,pinContent:w,attrRemove:true},children:null});if(v.options.withDgv===true){v.options.pinModel[w].addChild(z)}else{v.options.attrModel.addChild(z)}}}v.options.attrModel.expandAll()})}},_cellModified:function(y,z){if(z&&z.nodeModel&&z.nodeModel.options.grid){switch(this.options.grid.layout.getDataIndexFromColumnIndex(z.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:z.nodeModel.options.columnIndex,visibilityFlag:z.nodeModel.getReferenceValue("attrVisible")}});break;case"attrTitle":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:z.nodeModel.options.columnIndex,newTitle:z.nodeModel.getReferenceValue("attrTitle")}});break;case"exportContent":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:z.nodeModel.options.columnIndex,exportFlag:z.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var x=this;var v=z.nodeModel.getReferenceValue("attrName");var w=z.nodeModel.getReferenceValue("pinContent");x.options.attrModel.withTransactionUpdate(function(){x._globalUpdate=true;var A=z.nodeModel.getParent().options.columnIndex;z.nodeModel.getParent().removeChild(z.nodeModel);if(A==="left"||(A==="unpinned"&&w==="right")&&x.options.pinModel[w].hasChildren()){x.options.pinModel[w].insertBefore(z.nodeModel,x.options.pinModel[w].getChildren()[0])}else{x.options.pinModel[w].addChild(z.nodeModel)}delete x._globalUpdate});this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:v,pin:w}});break}}},_cellClicked:function(v,x){if(x&&x.nodeModel&&x.nodeModel.options.grid){if(x.nodeModel.options.pinColumn===true){return}switch(this.options.grid.layout.getDataIndexFromColumnIndex(x.columnID)){case"columnColor":this._changeColor([x.nodeModel]);break;case"attrRemove":if(this.options.withDgv===true){this.options.pinModel[x.nodeModel.options.grid.pinContent].removeChild(x.nodeModel);if(x.nodeModel.options.columnIndex==="thumbnail"){this.options.thumbnailsActivated=false;var y=this.options.toolbar.getItem("thumbnail");var w={id:y.id,tile:d.attributesCustomization.activateThumbnails};this.options.toolbar.menu.updateItem(w);this.options.toolbar.select("thumbnail",false)}}else{if(x.nodeModel){if((x.nodeModel.options.grid.layout&&x.nodeModel.options.grid.layout.removable===false)||(x.nodeModel.options.grid.isAdditionalColumn&&x.nodeModel.options.grid.isAdditionalColumn===true)){break}else{this.options.attrModel.removeRoot(x.nodeModel)}}}break}}},_retrieveColumnName:function(v){return d.attributesCustomization[v]?d.attributesCustomization[v]:v},_buildIconBar:function(){this.elements.toolbar=g.createElement("div",{"class":this.getClassNames("-toolbar")}).inject(this.elements.container);var z=(this.options.appColumns?this.options.appColumns:[]).map(function(A){return A.dataIndex});var x=this,y={renderTo:this.elements.toolbar,multiSelect:true,items:[{fonticon:"cog",text:d.attributesCustomization.moreAttributes,name:"moreAttributes",handler:function(B,A){require(["DS/PADServices/views/utils/MoreAttributesWizard","DS/PADServices/utils/AttributesMgt"],function(J,H){var C=[];if(x.options.withDgv===true){C=x.__getAllAttrInPinModels()}else{C=x.options.attrModel.getRoots()}var E=[];for(var G=0;G<C.length;G++){if(H.isAttributeColumn(C[G].getReferenceValue("attrName"))===true){E.push(C[G].getReferenceValue("attrName"))}}var D=x.options.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/selectedAttributes"},function(P){x.options.modelEvents.unsubscribe(D);var Z=[];if(x.options.withDgv===true){Z=x.__getAllAttrInPinModels()}else{Z=x.options.attrModel.getRoots()}var V=[];for(var Q=0;Q<Z.length;Q++){if(H.isAttributeColumn(Z[Q].getReferenceValue("attrName"))===true){V.push(Z[Q].getReferenceValue("attrName"))}}x.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:x.elements.container,title:d.attributesCustomization.apptitle}});x.options.selectedExtensions=P.selectedExtensions;x.options.selectedTypes=P.selectedTypes;x._globalUpdate=true;var L=P.selectedAttributes.filter(function(aa){return V.indexOf(aa.dataIndex)!==-1}).map(function(aa){return aa.dataIndex});var S=V.filter(function(aa){return L.indexOf(aa)===-1});var T=P.selectedAttributes.filter(function(aa){return V.indexOf(aa.dataIndex)===-1});var O=[],Y=[];var X=0;for(X=0;X<S.length;X++){if(x.options.withDgv===true){var M=x.__searchInPinModels(S[X]);x.options.attrModel.withTransactionUpdate(function(){for(var aa=0;aa<M.length;aa++){if(M[aa].getReferenceValue("attrName")==="ds6w:type"||M[aa].getReferenceValue("isAdditionalColumn")===true){console.log("Don't remove attribute "+M[aa].options.dataIndex)}else{x.options.pinModel[M[aa].options.grid.pinContent].removeChild(M[aa]);O.push(M[aa].dump(e))}}})}else{var K=x.options.attrModel.search({match:function(ab){var aa=false;if(ab.nodeModel.options.columnIndex===S[X]){if(ab.nodeModel.options.grid.isAdditionalColumn!==true&&S[X]!=="ds6w:type"){aa=true}}return aa}});x.options.attrModel.withTransactionUpdate(function(){for(var aa=0;aa<K.length;aa++){x.options.attrModel.removeRoot(K[aa]);O.push(K[aa].dump(e))}})}}for(X=0;X<T.length;X++){var U=p(x.options.appColumns,T[X].dataIndex);var W=false;if(U){var R=U.xnav_options;if(!R){R=U.customisation}if(R){W=R.exportable?R.exportable.lock:false}}var N=l.createTreeNodeDataModel(x.options.dataModelSet,{label:T[X].label,text:T[X].label,columnIndex:T[X].dataIndex,grid:{attrTitle:T[X].label,attrVisible:true,exportContent:true,exportLock:W,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:T[X].dataIndex,attrRemove:true,pinContent:"unpinned"},kind:T[X].kind,children:null});if(x.options.withDgv===true){x.options.pinModel.unpinned.addChild(N)}else{x.options.attrModel.addChild(N);N.select()}Y.push(N.dump(e))}if(O.length||Y.length){x.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:x.options.selectedTypes,selectedExtensions:x.options.selectedExtensions,removedColumns:O,addedColumns:Y}})}delete x._globalUpdate});var F=x.options.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/closeWizard"},function(){x.options.modelEvents.unsubscribe(F);x.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:x.elements.container,title:d.attributesCustomization.apptitle}})});var I=H.getDefaultTypesAndExtensions();new J({modelEvents:x.options.modelEvents,baseTypes:x.options.baseTypes,selectedTypes:x.options.selectedTypes,selectedExtensions:x.options.selectedExtensions,selectedAttributes:E,defaultTypes:I.defaultTypes,defaultExtensions:I.defaultExtensions})})},},{className:"divider"},{fonticon:"up",text:d.attributesCustomization.moveUp,name:"moveUp",disabled:true,handler:function(B,A){x._moveColumn(A.name,x.options.attrModel.getSelectedNodes())}},{fonticon:"down",text:d.attributesCustomization.moveDown,name:"moveDown",disabled:true,handler:function(B,A){x._moveColumn(A.name,x.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-top",text:d.attributesCustomization.moveFirst,name:"moveFirst",disabled:true,handler:function(B,A){x._moveColumn(A.name,x.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-bottom",text:d.attributesCustomization.moveLast,name:"moveLast",disabled:true,handler:function(B,A){x._moveColumn(A.name,x.options.attrModel.getSelectedNodes())}},{className:"divider"},{fonticon:"palette",text:d.attributesCustomization.changeColor,name:"changeColor",disabled:true,handler:function(B,A){x._changeColor(x.options.attrModel.getSelectedNodes())}},{fonticon:"trash",text:d.attributesCustomization.remove,name:"remove",disabled:true,handler:function(B,A){x._removeSelectedColumn()}}]};if(this.options.withDgv===true){this.options.thumbnailsActivated=z.indexOf("thumbnail")!==-1;var w=[{fonticon:this.options.rowHeaderActivated?"checkbox-on":"checkbox-off",text:this.options.rowHeaderActivated?d.attributesCustomization.deactivateSelectionBoxes:d.attributesCustomization.activateSelectionBoxes,name:"checkBoxes",handler:function(C,B){x.options.rowHeaderActivated=!x.options.rowHeaderActivated;var A=x.options.rowHeaderActivated?"checkbox-on":"checkbox-off";var E=x.options.rowHeaderActivated?d.attributesCustomization.deactivateSelectionBoxes:d.attributesCustomization.activateSelectionBoxes;var F=x.options.toolbar.getItem("checkBoxes");var D={id:F.id,text:E,fonticon:A};x.options.toolbar.menu.updateItem(D);x.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"rowsHeaderModification",rowsHeader:x.options.rowHeaderActivated}})}},{fonticon:"list-add",text:d.attributesCustomization.instanceAtt,name:"instanceAttributes",content:{type:"dropdownmenu",options:{multiSelect:true,items:[{text:d.attributesCustomization.instanceName,name:"instanceName",selectable:true,selected:z.indexOf("instanceName")!==-1?true:false},{text:d.attributesCustomization.instanceMatrix,name:"instanceMatrix",selectable:true,selected:z.indexOf("instanceMatrix")!==-1?true:false}],events:{onClick:function(B,A){x._manageInstanceAttributes(A.name,A.selected)}}}}},{fonticon:"picture",title:this.options.thumbnailsActivated?d.attributesCustomization.deactivateThumbnails:d.attributesCustomization.activateThumbnails,name:"thumbnail",selectable:true,selected:this.options.thumbnailsActivated,handler:function(B,A){x.options.thumbnailsActivated=!x.options.thumbnailsActivated;var D=x.options.thumbnailsActivated?d.attributesCustomization.deactivateThumbnails:d.attributesCustomization.activateThumbnails;var E=x.options.toolbar.getItem("thumbnail");var C={id:E.id,title:D,selected:x.options.thumbnailsActivated};x.options.toolbar.menu.updateItem(C);x._manageThumbnailAttribute(A.name,A.selected)}},{className:"divider"}];y.items.splice.apply(y.items,[2,0].concat(w))}else{var v=[{fonticon:"list-add",text:d.attributesCustomization.specificColumn,name:"specificColumns",id:"specificColumns",content:{type:"dropdownmenu",options:{multiSelect:true,items:[{fonticon:"checkbox-on",text:d.attributesCustomization.selection,name:"selection",id:"selection",selectable:true,selected:z.indexOf("selection")!==-1?true:false},{fonticon:"eye",text:d.attributesCustomization.hide_show,name:"hide_show",id:"hide_show",selectable:true,selected:z.indexOf("hide_show")!==-1?true:false},{fonticon:"search",text:d.attributesCustomization.find_in_ctx,name:"find_in_ctx",id:"find_in_ctx",selectable:true,selected:z.indexOf("find_in_ctx")!==-1?true:false},{text:d.attributesCustomization.instanceName,name:"instanceName",id:"instanceName",selectable:true,selected:z.indexOf("instanceName")!==-1?true:false},{text:d.attributesCustomization.instanceMatrix,name:"instanceMatrix",id:"instanceMatrix",selectable:true,selected:z.indexOf("instanceMatrix")!==-1?true:false},{fonticon:"picture",text:d.attributesCustomization.thumbnail,name:"thumbnail",id:"thumbnail",selectable:true,selected:z.indexOf("thumbnail")!==-1?true:false}],events:{onClick:function(B,A){x._manageSpecificColumn(A.name,A.selected)}}}}},{className:"divider"}];y.items.splice.apply(y.items,[2,0].concat(v))}this.options.toolbar=new b(y);this.options.toolbar.elements.container.setStyle("display",undefined)},_manageAttrSelection:function(){var A=this.options.attrModel.getSelectedNodes();var y=["moveUp","moveDown","moveFirst","moveLast"];var x=["remove","changeColor"];var z=A.length;var w=false;var v=0;for(v=0;v<z;v++){if(!(A[v].options.grid.isAdditionalColumn===true||(A[v].options.grid.layout&&A[v].options.grid.layout.removable===false))){w=true}}if(z===0){for(v=0;v<y.length;v++){this.options.toolbar.disableItem(y[v])}for(v=0;v<x.length;v++){this.options.toolbar.disableItem(x[v])}}else{if(z===1){for(v=0;v<y.length;v++){this.options.toolbar.enableItem(y[v])}for(v=0;v<x.length;v++){if(x[v]==="remove"&&w===false){this.options.toolbar.disableItem(x[v])}else{this.options.toolbar.enableItem(x[v])}}}else{if(z>=1){for(v=0;v<y.length;v++){this.options.toolbar.disableItem(y[v])}for(v=0;v<x.length;v++){if(x[v]==="remove"&&w===false){this.options.toolbar.disableItem(x[v])}else{this.options.toolbar.enableItem(x[v])}}}}}},_moveColumn:function(w,v){if(this.options.withDgv===true){this.__dgvMoveColumn(w,v)}else{this.__treeMoveColumn(w,v)}},__dgvMoveColumn:function(x,v){var w=this;if(v.length===1){this.options.attrModel.withTransactionUpdate(function(){var C=v[0],B=C.getReferenceValue("pinContent"),A=C._getLocalID?C._getLocalID():C._localID,z={fromID:A,toID:-1};switch(x){case"moveFirst":z.toID=0;break;case"moveUp":z.toID=A-1;break;case"moveDown":z.toID=A+1;break;case"moveLast":z.toID=w.options.pinModel[B].getChildren().length-1;break}if(z.toID!==-1&&A!==z.toID&&z.toID<w.options.pinModel[B].getChildren().length){w._isMoving=true;w.options.pinModel[B].addChild(C,z.toID);C.select();w._isMoving=false;var y=0;if(B==="unpinned"){y=w.options.pinModel.left.getChildren().length}else{if(B==="right"){y=w.options.pinModel.left.getChildren().length+w.options.pinModel.unpinned.getChildren().length}}z.fromID=z.fromID+y;z.toID=z.toID+y;w.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:z}})}})}},__treeMoveColumn:function(x,v){var w=this;if(v.length===1){this.options.attrModel.withTransactionUpdate(function(){var A=v[0],z=A._getLocalID?A._getLocalID():A._localID,y={fromID:z,toID:-1};switch(x){case"moveFirst":y.toID=0;break;case"moveUp":y.toID=z-1;break;case"moveDown":y.toID=z+1;break;case"moveLast":y.toID=w.options.attrModel.getRoots().length-1;break}if(y.toID!==-1&&z!==y.toID&&y.toID<w.options.attrModel.getRoots().length){w._isMoving=true;w.options.attrModel.addChild(A,y.toID);A.select();w._isMoving=false;w.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:y}})}})}},_manageSpecificColumn:function(C,D){var y=this;var z=false,A=true;if(C==="instanceName"){z=true;A=false}var x=["hide_show","find_in_ctx","instanceName","instanceMatrix","thumbnail"];var B=d.attributesCustomization[C]?d.attributesCustomization[C]:C;if(D===true){if(C==="thumbnail"){var w=this.elements.comboCompact.options.treedocument.getRoots();w[0].select(true);this.elements.comboCompact.disabled(true)}this.options.attrModel.withTransactionUpdate(function(){var F=x.indexOf(C)===-1?false:true;var E=l.createTreeNodeDataModel(y.options.dataModelSet,{columnIndex:C,label:B,grid:{attrTitle:B,attrVisible:true,exportContent:z,exportLock:A,attrRemove:true,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:C,hasTitle:F},modelEvents:y.options.modelEvents});y.options.attrModel.addChild(E)})}else{if(C==="thumbnail"){this.elements.comboCompact.disabled(false)}var v=this.options.attrModel.search({match:function(E){return E.nodeModel.options.label===C||E.nodeModel.options.columnIndex===C}});this.options.attrModel.withTransactionUpdate(function(){for(var E=0;E<v.length;E++){y.options.attrModel.removeRoot(v[E])}})}},_manageInstanceAttributes:function(w,y){var x=this;if(y===true){this.options.attrModel.withTransactionUpdate(function(){var z=d.attributesCustomization[w]?d.attributesCustomization[w]:w;switch(w){case"instanceName":var B=l.createTreeNodeDataModel(x.options.dataModelSet,{columnIndex:w,label:z,grid:{attrTitle:z,attrVisible:true,exportContent:true,exportLock:false,attrRemove:true,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"left",attrName:w,hasTitle:true},modelEvents:x.options.modelEvents});x.options.pinModel.left.addChild(B);break;case"instanceMatrix":var A=l.createTreeNodeDataModel(x.options.dataModelSet,{columnIndex:w,label:z,grid:{attrTitle:z,attrVisible:true,exportContent:true,exportLock:false,attrRemove:true,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:w,hasTitle:true},modelEvents:x.options.modelEvents});x.options.pinModel.unpinned.addChild(A);break}})}else{var v=this.__searchInPinModels(w);this.options.attrModel.withTransactionUpdate(function(){for(var z=0;z<v.length;z++){v[z].getParent().removeRoot(v[z])}})}},_manageThumbnailAttribute:function(w,y){var x=this;if(y===true){this.elements.comboCompact.disabled(true);this.options.attrModel.withTransactionUpdate(function(){var A=d.attributesCustomization[w]?d.attributesCustomization[w]:w;var z=l.createTreeNodeDataModel(x.options.dataModelSet,{columnIndex:w,label:A,grid:{attrTitle:A,attrVisible:true,exportContent:false,exportLock:true,attrRemove:true,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:w,hasTitle:false},modelEvents:x.options.modelEvents});x.options.pinModel.unpinned.addChild(z)})}else{this.elements.comboCompact.disabled(false);var v=this.__searchInPinModels(w);this.options.attrModel.withTransactionUpdate(function(){for(var z=0;z<v.length;z++){v[z].getParent().removeChild(v[z])}})}},_removeSelectedColumn:function(){var w=this.options.attrModel.getSelectedNodes();var v=this;this.options.attrModel.withTransactionUpdate(function(){for(var x=0;x<w.length;x++){if(!(w[x].options.grid.isAdditionalColumn===true||(w[x].options.grid.layout&&w[x].options.grid.layout.removable===false))){v.options.attrModel.removeRoot(w[x])}else{w[x].unselect();c.displayNotif({level:"warning",message:d.replace(d.attributesCustomization.cannotRemove,{attr:w[x].getReferenceValue("attrTitle")})})}}})},_changeColor:function(w){var v=this;require(["DS/PADUtils/views/PADColorPicker"],function(x){v.elements.container.disabled=true;var z={background_color:"#ffffff",color:"#000000"};if(w.length===1&&w[0].getReferenceValue("columnColor")){var y=w[0].getReferenceValue("columnColor");z={background_color:y["background-color"],color:y.color}}new x({selected_color:z,renderTo:document.body,events:{onColorOK:function(A){v.elements.container.disabled=false;var E=[];for(var C=0;C<w.length;C++){var D=w[C];var B={};if(A.background_color==="#ffffff"){B["background-color"]=undefined}else{B["background-color"]=A.background_color}if(A.color==="#000000"){B.color=undefined}else{B.color=A.color}D.updateOptions({grid:{columnColor:B}});E.push(D.options.columnIndex)}v.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeColor",modifiedColumns:E,"background-color":B["background-color"]+";",color:B.color+";"}})},onClose:function(){v.elements.container.disabled=false}}})})},__searchInPinModels:function(w){var v=[];v=v.concat(this.options.pinModel.left.search({match:function(x){return x.nodeModel.options.columnIndex===w}})).concat(this.options.pinModel.unpinned.search({match:function(x){return x.nodeModel.options.columnIndex===w}})).concat(this.options.pinModel.right.search({match:function(x){return x.nodeModel.options.columnIndex===w}}));return v},__getAllAttrInPinModels:function(){var v=[];v=v.concat(this.options.pinModel.left.getChildren()).concat(this.options.pinModel.unpinned.getChildren()).concat(this.options.pinModel.right.getChildren());return v}});return m});define("DS/PADServices/ws/WSAdmin",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],function(a,b){function c(){}c.prototype.getTypesHierarchy=function(d){return new Promise(function(h,g){var f=a.get3DSpaceURL()+"/resources/enong/dico/gettypeshierarchy?tenant="+a.getPlatformId(),e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({types:d}),onComplete:h,onFailure:g};this.executeRequest(f,e)}.bind(this))};c.prototype.getTypeInfo=function(d){return new Promise(function(j,i){var g=a.get3DSpaceURL()+"/resources/dictionary/getTypeInfo?tenant="+a.getPlatformId(),f={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":b.getLang()},onComplete:j,onFailure:i};if(d.url_parameters){var h=Object.getOwnPropertyNames(d.url_parameters);for(var e=0;e<h.length;e++){g=g+"&"+h[e]+"="+d.url_parameters[h[e]]}delete d.url_parameters}f.data=JSON.stringify(d.body);delete f.body;this.executeRequest(g,f)}.bind(this))};c.prototype.interfaces=function(d){return new Promise(function(h,g){var f=a.get3DSpaceURL()+"/resources/dictionary/class/interfaces?tenant="+a.getPlatformId(),e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":b.getLang()},onComplete:h,onFailure:g};e.data=JSON.stringify(d.data);this.executeRequest(f,e)}.bind(this))};c.prototype.retrievePQ=function(){return new Promise(function(g,f){var e=PADUtilsServices.get3DSpaceUrl()+"/resources/SNAPI/pq_services/pqs?tenant="+a.getPlatformId(),d={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":b.getLang()},cache:-1};this.executeRequest(e,d)})};return c});define("DS/PADServices/utils/DictionaryAccess",["UWA/Promise","DS/Utilities/Utils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],function(j,g,l,n,h,a){var f={nodes2updateId:[],nodes2update:[],idx:0};function i(o,p,q){if(!o[p]){o[p]=[]}if(o[p].indexOf(q)===-1){o[p].push(q)}}function e(o){var u={};var s=require("DS/PADServices/utils/AttributesMgt");for(var r=0;r<o.length;r++){var t=o[r];var v=Object.keys(t.options.grid);for(var p=0;p<v.length;p++){var q=v[p];if(s.hasNLS(q)){i(u,q,t.options.grid[q])}}}return u}function d(p){var u={};var v=Object.keys(p);for(var t=0;t<v.length;t++){var w=p[v[t]];var o=Object.keys(w);for(var r=0;r<o.length;r++){var s=o[r];var q=w[s];if(s===q){continue}if(q.indexOf("emxFramework")===0){continue}if(!u[v[t]]){u[v[t]]={}}u[v[t]][s]=q}}return u}function c(s,t,q){var o=false;var r={grid:s.options.grid};for(var p=0;p<t.length;p++){if(r.grid[t[p]]&&q[t[p]][r.grid[t[p]]]&&q[t[p]][r.grid[t[p]]]!==r.grid[t[p]]){o=true;r.grid[t[p]]=q[t[p]][r.grid[t[p]]]}}return{updated:o,options:r}}var k="R2019x";var m=g.debounce(function(v){b.idx=0;var t=this,u={},r,o;var q=require("DS/PADServices/utils/AttributesMgt");var p=q.getAvailableColumns();for(r=0;r<v.length;r++){var s=Object.getOwnPropertyNames(v[r].options.grid);for(o=0;o<s.length;o++){if(q.hasNLS(s[o])){if(p.indexOf(s[o])!==-1){if(u[s[o]]===undefined){u[s[o]]=[]}if(u[s[o]].indexOf(v[r].options.grid[s[o]])===-1){u[s[o]].push(v[r].options.grid[s[o]])}}}}}l.getNlsOfPropertiesValues(JSON.stringify(u),{tenantId:a.getPlatformId(),lang:h.getLang(),apiVersion:k,onComplete:function(z){var A=UWA.is(z,"string")?JSON.parse(z):z;var C=Object.getOwnPropertyNames(A);function x(F){var D=false;var E={grid:F.options.grid};for(o=0;o<C.length;o++){if(E.grid[C[o]]&&A[C[o]][E.grid[C[o]]]&&A[C[o]][E.grid[C[o]]]!==E.grid[C[o]]){if(A[C[o]][E.grid[C[o]]].indexOf("emxFramework")!==0){D=true;E.grid[C[o]]=A[C[o]][E.grid[C[o]]]}}}return{updated:D,options:E}}var w=f.nodes2update[0].getTreeDocument();if(w){w.withTransactionUpdate(function(){for(r=0;r<f.nodes2update.length;r++){var E=f.nodes2update[r];var D=x(E);if(D.updated===true){E.updateOptions(D.options)}}f.nodes2updateId=[];f.nodes2update=[]})}else{for(r=0;r<f.nodes2update.length;r++){var B=f.nodes2update[r];var y=x(B);if(y.updated===true){B.updateOptions(y.options)}}f.nodes2updateId=[];f.nodes2update=[]}},onFailure:function(w){console.warn("Cannot retrieve NLS");f.nodes2updateId=[];f.nodes2update=[]}})},100);var b={retrieveNLS:function(o){return new j(function(q,p){l.getNlsOfPropertiesValues(JSON.stringify(o.nlsData),{tenantId:a.getPlatformId(),lang:h.getLang(),apiVersion:k,onComplete:function(r){var s=UWA.is(r,"string")?JSON.parse(r):r;q(s)},onFailure:function(r){console.warn("Cannot retrieve NLS");q({})}})})},updateColumnsWithNLS:function(p,v){var t=this;var s,q,w=[];var u=require("DS/PADServices/utils/AttributesMgt");t.completeResponse={};for(s=0;s<p.length;s++){var o=null;if(p[s].ds6w&&p[s].ds6wFrom!=="rel"){o=p[s].ds6w}else{if(p[s].ds6w&&p[s].ds6wFrom==="rel"){o=p[s].dataIndex}else{if(p[s].xnav_options&&p[s].xnav_options.name){o=p[s].xnav_options.name}else{o=p[s].dataIndex}}}if(p[s].customisation&&p[s].customisation.titleModified===true){o=null}if(o){if(p[s].text){t.completeResponse[o]={nlsName:p[s].text,lang:h.getLang()}}else{if(o.indexOf(":")!==-1&&p[s].ds6wFrom!=="rel"){w.push(o)}else{if(p[s].xnav_options&&p[s].xnav_options.hardcoded===true){t.completeResponse[o]={nlsName:n[o],lang:h.getLang()}}else{if(n.attributesCustomization[o]){t.completeResponse[o]={nlsName:n.attributesCustomization[o],lang:h.getLang()}}else{if(p[s].isAdditionalColumn!==true&&u.isAttributeColumn(p[s].dataIndex)){console.warn("DictionaryAccess## Unknown attribute type:"+p[s].dataIndex)}}}}}}}var r=function(){for(s=0;s<p.length;s++){var x=null;if(p[s].ds6w&&p[s].ds6wFrom!=="rel"){x=p[s].ds6w}else{if(p[s].ds6w&&p[s].ds6wFrom==="rel"){x=p[s].dataIndex}else{if(p[s].xnav_options&&p[s].xnav_options.name){x=p[s].xnav_options.name}else{x=p[s].dataIndex}}}if(x&&t.completeResponse[x]&&t.completeResponse[x].nlsName&&p[s].noTitleColumn!==true){p[s].text=t.completeResponse[x].nlsName}else{if(x&&x.indexOf("ds6w")!==-1){if(p[s].customisation.titleModified!==true){console.warn("DictionaryAccess## ds6w attribute ["+x+"] not found by FedDictionaryAccessAPI.getResourcesInfo");p[s].text=x}}}}v({status:"success",columns:p})};if(w.length>0){t.getResourcesInfo(w).then(function(y){if(UWA.is(y,"array")){for(var x=0;x<y.length;x++){t.completeResponse[y[x].curi]={nlsName:y[x].label,lang:h.getLang(),kind:y[x].dataType}}}r()})}else{r()}},updateNLS:function(p){var o=p.getOccurencePath();if(f.nodes2updateId.indexOf(o)===-1){f.nodes2updateId.push(o);f.nodes2update.push(p);m(f.nodes2update)}},updateNLSforexport:function(o){var p=o.getAllDescendants();return new j(function(s,r){var q=e(p);l.getNlsOfPropertiesValues(JSON.stringify(q),{tenantId:a.getPlatformId(),lang:h.getLang(),apiVersion:"R2019x",onComplete:function(t){var u=UWA.is(t,"string")?JSON.parse(t):t;var w=d(u);var v=Object.keys(w);o.withTransactionUpdate(function(){for(var y=0;y<p.length;y++){var z=p[y];var x=c(z,v,w);if(x.updated===true){z.updateOptions(x.options)}}});s()},onFailure:function(t){console.warn("Cannot retrieve NLS");s()}})})},getPropertiesForClass:function(o){return new j(function(q,p){l.getPropertiesForClass(o.classURIs,{tenantId:a.getPlatformId(),lang:h.getLang(),apiVersion:k,onComplete:function(r){var s=UWA.is(r,"string")?JSON.parse(r):r;q(s)},onFailure:function(r){p(r)}})})},getResourcesInfo:function(o){return new j(function(q){var p={tenantId:a.getPlatformId(),lang:h.getLang(),apiVersion:k,onComplete:function(r){q(r)},onFailure:function(){q()}};l.getResourcesInfo(o.join(","),p)})}};return b});define("DS/PADServices/utils/AttributesViewMgt",["css!DS/PADServices/PADServices.css","UWA/Class/Promise","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/DictionaryAccess"],function(d,h,b,e){var i=false;var j=null;var c=null;var l=["matrixtxt"];function f(n,o){var m=n.getTreeDocument();m.withTransactionUpdate(function(){if(o==="tree"){n.updateOptions({label:n.options.label,grid:{}})}else{var p={grid:{}};p.grid[o]=n.options.grid[modifiedDataIndexs];n.updateOptions(p)}})}function a(n,p,o){var m=n.getTreeDocument();m.withTransactionUpdate(function(){if(p==="tree"){var q={};q.label=o;q.display=o;q.oldLabel=o;n.updateOptions(q);n.getTreeDocument()._triggerTitleUpdate()}else{var r={grid:{}};r.grid[p]=o;n.updateOptions(r)}})}var k={checkColumns:function(m){if(m){return new h(function(o){var p=m.filter(function(q){return typeof q.kind==="undefined"&&q.ds6w&&l.indexOf(q.ds6w)===-1}).map(function(q){return q.ds6w});var n=p.filter(function(q,r){return p.indexOf(q)===r});if(n.length){e.getResourcesInfo(n).then(function(s){var r=s.map(function(t){return t.curi});for(var q=0;q<m.length;q++){if(m[q].ds6w&&r.indexOf(m[q].ds6w)!==-1){m[q].kind=s[r.indexOf(m[q].ds6w)].dataType}}o(m)})}else{o(m)}})}else{if(i===true){return h.resolve()}return new h(function(q){var o=require("DS/PADServices/utils/AttributesMgt");var s=o._columnsMgt;var n=o._colsMap;var r=s.attributes.filter(function(t){return typeof t.kind==="undefined"&&t.ds6w&&l.indexOf(t.ds6w)===-1}).map(function(t){return t.ds6w});var p=r.filter(function(t,u){return r.indexOf(t)===u});if(p.length){e.getResourcesInfo(p).then(function(v){for(var t=0;t<v.length;t++){var u=v[t].curi;if(u===o.getTreeColumn()){u="tree"}if(n[u]){n[u].kind=v[t].dataType}}i=true;q()})}else{i=true;q()}})}},sanitizeColumn:function(q){var o={};var p=["dataIndex","ds6w","ds6wFrom","customisation","text","width","noTitleColumn","hasNLS","kind","pinned","isHidden","visibleFlag","minWidth","maxWidth","isAdditionalColumn"];var n=Object.keys(q);for(var m=0;m<n.length;m++){if(p.indexOf(n[m])!==-1){o[n[m]]=UWA.clone(q[n[m]])}}return o},updateStyle:function(o){var n=o.cellView.collectionView.getColumnOrGroup(o.columnID);if(n&&n.customisation.styles){var m=o.cellView.getContent();if(m){m.setStyles(n.customisation.styles)}}},_reservedColumn:function(t){var o=false,n=t.nodeModel.options.grid["ds6w:reserved"]?t.nodeModel.options.grid["ds6w:reserved"]:t.nodeModel.options.padgrid["ds6w:reserved"]?t.nodeModel.options.padgrid["ds6w:reserved"]:"";var s=require("DS/PADUtils/PADUtilsServices");if(n!==undefined){var q=t.nodeModel.options.grid["ds6w:reservedBy"]?t.nodeModel.options.grid["ds6w:reservedBy"]:t.nodeModel.options.padgrid["ds6w:reservedBy"]?t.nodeModel.options.padgrid["ds6w:reservedBy"]:"";var r=t.nodeModel.options.grid["ds6w:displayName"]?t.nodeModel.options.grid["ds6w:displayName"]:t.nodeModel.options.padgrid["ds6w:displayName"]?t.nodeModel.options.padgrid["ds6w:displayName"]:"";o=(typeof n==="boolean")?(n):((n.toUpperCase()==="TRUE")?true:false);var p="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key pad_lock";if(p){if(o){if(j===null){j=s.getUserLogin()}if(c===null){c=s.getUserName()}var m=true;if(q.trim().length>0){m=(q.toUpperCase().trim()===j.toUpperCase().trim())||false;if(!m){if(q.trim().length!==j.trim().length){m=(q.toUpperCase().trim()===c.toUpperCase().trim())||false}}}else{if(r.trim().length>0){m=(c.toUpperCase().trim()===r.toUpperCase().trim())||false}}if(!m){p="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock pad_lock_other"}else{p="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key pad_lock"}}else{p="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open pad_unlock"}}return{icon:{iconClasses:p},label:r}}else{return t.cellView.getContent().empty()}}};var g={buildColumns:function(m){return new h(function(t,s){var r=[];var n=0;var q=require("DS/PADServices/utils/AttributesMgt");var p=q._columnsMgt.order;var o=q._colsMap;k.checkColumns().then(function(){for(n=0;n<p.length;n++){if(o[p[n]]&&!(m==="datagridview"&&o[p[n]].dataIndex==="bi_color")){r.push(g.buildColumnFromSetting(o[p[n]],m))}}var u=UWA.clone(r);e.updateColumnsWithNLS(u,function(w){var v={};v.columns=u;if(w.status==="success"){v.columns=w.columns}t(v)})})})},buildColumnsFromStorage:function(m,n){return new h(function(t,s){var r=[];var o=0;var q=require("DS/PADServices/utils/AttributesMgt");var p=q._colsMap;k.checkColumns(n).then(function(u){k.checkColumns().then(function(){for(o=0;o<u.length;o++){var x=u[o].dataIndex;if(!(m==="datagridview"&&x==="bi_color")){var y;if(typeof p[x]==="undefined"){y=q.addAvailableColumn(x,u[o],m)}else{var w=g.buildColumnFromSetting(p[x],m);u[o].typeRepresentation=w.typeRepresentation;y=UWA.extend(w,u[o])}r.push(y)}}var v=UWA.clone(r);t(v)})})})},buildColumnFromSetting:function(n,m){n=k.sanitizeColumn(n);var o=UWA.extend({minWidth:50,editableFlag:false,customisation:{exportable:{lock:false,value:true},styles:undefined}},n);if(!UWA.is(o.dataIndex)){if(!UWA.is(o.ds6w)){throw new Error("Wrong column definition for ["+JSON.stringify(n)+"]")}else{o.dataIndex=o.ds6w}}var p=["bi_color","selection","hide_show","find_in_ctx"];if(p.indexOf(o.dataIndex)!==-1){o.customisation=UWA.extend(o.customisation,{exportable:{lock:true,value:false}})}if(m==="datagridview"){delete o.xnav_options;switch(o.kind){case"string":o.typeRepresentation="string";break;case"dateTime":o.typeRepresentation="datetime";break;case"boolean":o.typeRepresentation="boolean";break;case"image":o.typeRepresentation="image";break;case"icon":o.typeRepresentation="icon";break;case"functionIcon":o.typeRepresentation="functionIcon";break;default:if(!o.typeRepresentation){o.typeRepresentation="string"}break}if(typeof o.getCellSemantics==="undefined"){o.getCellSemantics=function(q){k.updateStyle(q)}}switch(o.dataIndex){case"ds6w:cadMaster":o.typeRepresentation="image";o.getCellGroupingKey=function(r){var q="CatiaV5";if(r.nodeModel.options.grid["ds6w:cadMaster"].contains("I_CADMaster3DEXPERIENCE")){q="3DEXPERIENCE"}else{if(r.nodeModel.options.grid["ds6w:cadMaster"].contains("I_CADMasterSOLIDWORKS")){q="SolidWorks"}else{if(r.nodeModel.options.grid["ds6w:cadMaster"].contains("I_CADMasterSOLIDEDGE")){q="SOLIDEDGE"}else{if(r.nodeModel.options.grid["ds6w:cadMaster"].contains("I_CADMasterINVENTOR")){q="INVENTOR"}else{if(r.nodeModel.options.grid["ds6w:cadMaster"].contains("I_CADMasterAUTOCAD")){q="AUTOCAD"}}}}}return q};o.getCellSemantics=function(r){k.updateStyle(r);var q=r.cellView.getContent();q.addClassName("cadMaster")};break;case"find_in_ctx":o.typeRepresentation="functionIcon";o.getCellSemantics=function(q){k.updateStyle(q);return{icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search pad_search"},label:"search"}};break;case"thumbnail":o.ds6w=undefined;o.typeRepresentation="image";break;case"instanceMatrix":o.typeRepresentation="functionIcon";o.getCellSemantics=function(q){k.updateStyle(q);if(q.nodeModel.options&&q.nodeModel.options.grid.instanceMatrix!=="Position Matrix"){if(q.nodeModel.options.grid.instanceMatrix){return{icon:{iconPath:b.getWebappsAssetUrl("ENXNav","icons/32/I_3DPosition.png")},label:"PositionMatrix"}}else{return{icon:{iconPath:""},label:"None"}}}};break;case"hide_show":o.typeRepresentation="functionIcon";o.getCellSemantics=function(q){k.updateStyle(q);if(q.nodeModel.options.isPADHidden&&q.nodeModel.options.isPADHidden===true){return{icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-off pad_eye_off"},label:"hide"}}else{return{icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye pad_eye "},label:"show"}}};break;case"ds6w:reserved":o.typeRepresentation="functionIcon";o.editableFlag="true";o.editionPolicy="EditionOnDoubleClick";o.setCellValue=function(r,q){};o.getCellSemantics=function(q){if(!q.isHeader){k.updateStyle(q);return k._reservedColumn(q)}};break;case"tree":o.editableFlag="true";o.editionPolicy="EditionOnDoubleClick";o.getCellValue=function(q){if(q.nodeModel){return q.nodeModel.options.label}};o.setCellValue=function(r,q){if(r.nodeModel&&(q!==null||q!=="")){a(r.nodeModel,"tree",q)}else{f(r.nodeModel,"tree")}};break;case"ds6w:responsible":o.editableFlag="true";o.editionPolicy="EditionOnDoubleClick";o.getCellValue=function(q){if(q.nodeModel){return q.nodeModel.options.grid["ds6w:responsible"]}};o.setCellValue=function(r,q){if(r.nodeModel&&(q!==null||q!=="")){a(r.nodeModel,"ds6w:responsible",q)}else{f(r.nodeModel,"ds6w:responsible")}};break;case"ds6w:description":o.editableFlag="true";o.editionPolicy="EditionOnDoubleClick";o.getCellValue=function(q){if(q.nodeModel){return q.nodeModel.options.grid["ds6w:description"]}};o.setCellValue=function(r,q){if(r.nodeModel&&(q!==null||q!=="")){a(r.nodeModel,"ds6w:description",q)}else{f(r.nodeModel,"ds6w:description")}};break;case"instanceName":o.editableFlag="true";o.editionPolicy="EditionOnDoubleClick";o.getCellValue=function(q){if(q.nodeModel){return q.nodeModel.options.grid.instanceName}};o.setCellValue=function(r,q){if(r.nodeModel&&(q!==null||q!=="")){a(r.nodeModel,"instanceName",q)}else{f(r.nodeModel,"instanceName")}}}}else{if(o.dataIndex==="selection"){o={width:40,minWidth:40,maxWidth:40,dataIndex:"selection",type:"selection",isDraggable:true,isHidden:false,customisation:{name:"selection",hardcoded:true,exportable:{lock:true,value:false},layout:{removable:true,hidden:true,width:40,minWidth:40,maxWidth:40}}};delete o.visibleFlag;delete o.customisation}}return o},completeCellSemantics:function(m){return k.updateStyle(m)}};return g});define("DS/PADServices/utils/PCSTracker",["DS/PADServices/utils/GlobalUtils"],function(b){function c(e){var f=e.split("/");if(f[f.length-1].length===0){return f[f.length-2]}else{return f[f.length-1]}}function a(){if(typeof a.instance==="object"){return a.instance}a.instance=this;return this}a.prototype.createProbe=function(e){return new d(e)};a.prototype.networkprobe=function(h){var g=h.request_options;var f=c(h.url);var e=this.createProbe("query_"+f);g.onComplete=(function(j){var i=g.onComplete;return function(k){e.end();if(UWA.is(i,"function")){return i.apply(this,Array.prototype.slice.call(arguments))}}})();g.onFailure=(function(i){var j=g.onFailure;return function(k){e.end();if(UWA.is(j,"function")){return j.apply(this,Array.prototype.slice.call(arguments))}}})();return g};function d(e){this.id=b.getPCSPrefix()+"_"+e;this.inprogress=true;this.stamp=window.top.performance.now();this.beginMark=this.id+"__begin_"+this.stamp;this.endMark=this.id+"__end_"+this.stamp;window.top.performance.mark(this.beginMark)}d.prototype.end=function(){if(this.inprogress===true){this.inprogress=false;window.top.performance.mark(this.endMark);window.top.performance.measure(this.id,this.beginMark,this.endMark)}};d.prototype.dump=function(){console.log(window.top.performance.getEntriesByName(this.id))};return new a()});define("DS/PADServices/ws/WSAccess",["DS/WAFData/WAFData","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PCSTracker"],function(a,d,c){function b(){if(typeof b.instance==="object"){return b.instance}b.instance=this;return this}b.prototype.getKind=function(){return"Static"};b.prototype.initialize=function(e){return new Promise(function(j,i){var k=[],g=[];if(e.addDefaults===true){g=g.concat(["DS/PADServices/ws/WSAdmin"])}if(Array.isArray(e.WSDefinitionAMDs)){g=g.concat(e.WSDefinitionAMDs)}if(Array.isArray(g)){for(var f=0;f<g.length;f++){var h=f;k.push(new Promise(function(l,m){require([g[h]],function(n){b.prototype=Object.assign(b.prototype,n.prototype);l()},m)}.bind(this)))}}Promise.all(k).then(j)["catch"](i)}.bind(this))};b.prototype.executeRequest=function(i,h,k,g){var j=null;var e=d.getSecurityContext();if(UWA.is(e,"string")&&k!==true){h.headers.SecurityContext=e;if(g!==true){var f=d.getUser();if(f&&f.login){h.headers.SecurityToken=f.login+"|"+e+"|preferred"}}}var l=c.networkprobe({url:i,request_options:h});j=a.authenticatedRequest(i,l);return j};return new b()});define("DS/PADServices/views/ProductConfChooser",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","UWA/Class/Promise","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PlatformURL","DS/PADServices/ws/WSAccess","DS/PADServices/utils/ParserUtils","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Tree/TreeDocument"],function(g,c,d,f,m,i,e,h,b,k,n,o,a){var l="DS/ENOFloatingPanel/ENOFloatingPanel";var j=f.extend({name:"pad-prodconf",defaultOptions:{modelEvents:null,renderTo:null,pid:null,subscribeTokens:[]},init:function(p){this._parent(p);var q=this;b.retrievePlatformUrl().then(function(){var s=function(){q._retrieveModel().then(q._retrieveModelVersion.bind(q)).then(q._retrieveProdConf.bind(q)).then(q._displayProdConf.bind(q))["catch"](function(t){console.warn("Cannot retrieve Product Configuration"+t);q._exit()})};var r=h.getSetting("pad_security_ctx");if(r===false){e.updateWidgetSecPref({resolve:function(){s()}})}else{s()}})},destroy:function(){for(var p=0;p<this.options.subscribeTokens.length;p++){this.options.modelEvents.unsubscribe(this.options.subscribeTokens[p])}this._parent()},_retrieveModel:function(q){var p=this;return new i(function(s,r){k.executeWS("getConfiguredObjectInfo",{pid:p.options.pid}).then(function(t){if(t.contexts&&t.contexts.content&&t.contexts.content.results){if(t.contexts.content.results.length===1){s({model:t.contexts.content.results[0]})}else{r({error:"Too many model"})}}else{s({info:"No Model attachd"})}})["catch"](function(t){r(t)})})},_retrieveModelVersion:function(q){var p=this;return new i(function(s,r){if(q.model){k.executeWS("configurationDictionary",{modelVersion:q.model.physicalID}).then(function(t){if(t.products){s({modelid:q.model.physicalID,modelVersion:t.products.id.replace("pid:","")})}else{s({info:"No Model Version"})}})["catch"](function(t){r(t)})}else{s(q)}})},_retrieveProdConf:function(q){var p=this;return new i(function(s,r){if(q.modelVersion){k.executeWS("getProductConfigurations",{modelid:q.modelid,modelVersionPid:q.modelVersion}).then(function(t){if(t.productconfigurations){var v=[];for(var u=0;u<t.productconfigurations.length;u++){v.push(t.productconfigurations[u].id.replace("pid:",""))}k.executeWS("fetch",{pids:v,noCompletion:true}).then(function(w){var x=[];for(var y=0;y<w.results.length;y++){x.push(n.parseAttributes(w.results[y].attributes))}s({prodConf:x})})["catch"](function(w){r(w)})}else{s({info:"No Product Configuration"})}})["catch"](function(t){r(t)})}else{s(q)}})},_displayProdConf:function(q){var p=this;require([l],function(r){p.elements.body=d.createElement("div",{"class":p.getClassNames("-body")});p.elements.footer=d.createElement("div",{"class":p.getClassNames("-footer")});p._buildBody(q);p._buildFooter();p.elements.floatingpanel=new r({className:p.name,body:p.elements.body,footer:p.elements.footer,title:c.productConfChooser.apptitle,overlay:true,closable:true,animate:true,resizable:false,visible:true,events:{onClose:function(){p._exit();p.destroy()}}});p.elements.floatingpanel.inject(p.options.renderTo)})},_buildBody:function(s){var r=this;var q=this.options.grid=new o();q.selectionBehavior={unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:false,enableShiftSelection:false,enableFeedbackForActiveCell:false,canInteractiveMultiselectWithCheckboxClick:false};q.allowUnsafeHTMLContent=false;var p={shouldAcceptDrag:function(){return false}};this.options.model=new a(p);this.options.model.id="prodConfListModel";this.options.model.getXSO().onPostAdd(function(t){r.options.okButton.disabled=false});this.options.model.getXSO().onPostRemove(function(t){r.options.okButton.disabled=true});this.options.model.getXSO().onEmpty(function(t){r.options.okButton.disabled=true});q.model=this.options.model;q.getContent().inject(r.elements.body);if(s.prodConf){s.prodConf.forEach(function(t){var u=d.extend({},t);u.children=null;r.options.model.addRoot(u)})}},_buildFooter:function(){var q=this;var p=new m({label:c.productConfChooser.close,emphasize:"primary",touchMode:true});p.addEventListener("click",function(){q._exit();q.destroy()});p.inject(q.elements.footer);var r=this.options.okButton=new m({label:c.productConfChooser.ok,touchMode:true,disabled:true});r.addEventListener("click",function(){var s=q.options.model.getSelectedNodes()[0].options.resourceid;k.executeWS("fetch",{pids:[s],noCompletion:true,data:{select_file:[],select_predicate:["FILTER_COMPILED_FORM"]}}).then(function(t){var v=null;if(t.results&&t.results.length===1){for(var u=0;u<t.results[0].attributes.length&&v===null;u++){if(t.results[0].attributes[u].name==="FILTER_COMPILED_FORM"){v=t.results[0].attributes[u].value}}}q.options.modelEvents.publish({event:"ENXViews/ProductConfChooser",data:{config:v}});q.destroy()})["catch"](function(t){q._exit();q.destroy()})});r.inject(q.elements.footer)},_exit:function(){this.options.modelEvents.publish({event:"ENXViews/ProductConfChooser",data:{config:null}})},});return j});define("DS/PADServices/utils/PredefinedQueryUtils",["UWA/Promise","DS/PADServices/ws/WSAccess"],function(c,a){var e=function(h,g){for(var f in g){if(g.hasOwnProperty(f)){if(UWA.is(h[f],"object")&&UWA.is(g[f],"object")){e(h[f],g[f])}else{if(UWA.is(h[f],"array")){h[f]=h[f].concat(g[f])}}}}};var b={pqDictionary:null,abvLst:{},retrievePQDictionary:function(){return new c(function(g,f){if(b.pqDictionary===null){a.retrievePQ().then(function(k){if(!(k.pqlist&&k.pqlist.PQ)){b.pqDictionary=[]}else{if(k.custom){console.log("Custome PQ exists");for(var l=0,n=k.custom.PQ.length;l<n;l++){var m=k.custom.PQ[l];m.custom=true}e(k.pqlist,k.custom)}b.pqDictionary=k.pqlist.PQ;for(var j=0;j<k.pqlist.PQ.length;j++){var h=k.pqlist.PQ[j];var p=h.abbreviations.split(",");for(var o=0;o<p.length;o++){b.abvLst[p[o]]=j}}}g()})["catch"](function(h){console.error(h);f()})}else{g()}})}};var d={isPredefinedQry:function(f){return new c(function(i){var h=f,g=f.indexOf(":");if(g!==-1){b.retrievePQDictionary().then(function(){var l=f.substring(0,g);var k=f.substring(g+1,f.length);if(typeof b.abvLst[l]!=="undefined"){var j=UWA.clone(b.pqDictionary[b.abvLst[l]]);if(j.custom===true){j.value="3dexp"+l+":__QUERY__"}h=j.value.replace(/__QUERY__/g,k)}i(h)})["catch"](function(){console.warn("Predefined Qry retrival fails. Keep the original query String");i(h)})}else{i(h)}})},};return d});define("DS/PADServices/utils/DictionaryMgt",["UWA/Promise","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess"],function(f,c,a,d){var h={};var e=null,g=".png";var b={buildIconUrl:function(i){if(e===null){e=a.get3DSpaceURL()+"/snresources/images/icons/small/"}return i?e+i+g:""},getNLSForTypes:function(k){var j=k.replace("ds6wg:","");var i=h.typesInfo[j]?h.typesInfo[j].displayName:h.extensions[j]?h.extensions[j].nlsName:h.automaticExtensions[j]?h.automaticExtensions[j].nlsName:j;return i},getTypesInfo:function(i){return new f(function(k,j){c.getTypeInfo({url_parameters:{parentInfo:true,"$select":"IconName"},body:i.baseTypes}).then(function(n){n=typeof n==="string"?JSON.parse(n):n;var l=Object.getOwnPropertyNames(n);var m={"ds6w:type":l};d.retrieveNLS({nlsData:m}).then(function(p){for(var o=0;o<l.length;o++){if(p["ds6w:type"][l[o]]){n[l[o]].displayName=p["ds6w:type"][l[o]]}else{n[l[o]].displayName=l[o]}n[l[o]].iconUrl=b.buildIconUrl(n[l[o]].IconName)}k(n);h.typesInfo=n})})})},interfaces:function(i){return new f(function(k,j){c.interfaces({url_parameters:{},data:{classes:i.classes}}).then(function(m){m=typeof m==="string"?JSON.parse(m):m;var p={},o={};var n=m.results;for(var l=0;l<n.length;l++){var q=n[l].name;for(var r=0;r<n[l].interfaces.length;r++){if((n[l].interfaces[r].automatic&&n[l].interfaces[r].automatic.toLowerCase()==="yes")||(n[l].interfaces[r].name.startsWith("XP_")&&n[l].interfaces[r].name.endsWith("_Ext"))){if(o[n[l].interfaces[r].name]===undefined){o[n[l].interfaces[r].name]=n[l].interfaces[r];o[n[l].interfaces[r].name].declareIn=[]}o[n[l].interfaces[r].name].declareIn.push(q)}else{if(p[n[l].interfaces[r].name]===undefined){p[n[l].interfaces[r].name]=n[l].interfaces[r];p[n[l].interfaces[r].name].declareIn=[]}p[n[l].interfaces[r].name].declareIn.push(q)}}}k({extensions:p,automaticExtensions:o});h.extensions=p;h.automaticExtensions=o})})},getPropertiesForClass:function(i){return new f(function(k,j){d.getPropertiesForClass(i).then(function(n){var q={};for(var p=0;p<n.length;p++){var r=n[p];for(var o=0;o<r.properties.length;o++){var l=r.properties[o];if(q[l.curi]===undefined){q[l.curi]=l;q[l.curi].inTypes=[r.classInfo.curi]}else{q[l.curi].inTypes.push(r.classInfo.curi)}}}var m=[];if(q["ds6w:type"]===undefined){q["ds6w:type"]={curi:"ds6w:type",label:"ds6w:type"};var s=new f(function(t){d.getResourcesInfo(["ds6w:type"]).then(function(u){if(UWA.is(u,"array")&&u.length===1){q["ds6w:type"]=UWA.merge(u[0],q["ds6w:type"])}t()})});m.push(s)}f.all(m).then(function(){console.groupCollapsed("DictionaryMgt## Available attributes");console.log(JSON.stringify(q,null,2));console.groupEnd();k({availaibleAttributes:q});h.availaibleAttributes=q})})})}};return b});define("DS/PADServices/views/utils/MoreAttributesWizard",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/utils/WizardSteps","text!DS/PADServices/assets/init/MoreAttrWizardSteps.json","DS/PADServices/views/utils/SearchInput","DS/PADServices/views/utils/Iconbar","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils"],function(n,f,h,t,e,c,i,u,s,b,j,p,w,m,o,v,q,a,d){var l=JSON.parse(u);var g={properties:[function(){return{property:"dataIndex",value:this.options.label}},function(){return{property:"label",value:this.options.grid.attrTitle}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}}]};var k={"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"};var r=t.extend({name:"more-attr",defaultOptions:{baseTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},dataModelSets:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:true,alternateBackgroundFlag:false,columns:[{dataIndex:"tree",visibleFlag:false},{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:true,width:40,resizableFlag:false,editableFlag:true,editionPolicy:"EditionInPlace",getCellEditableState:function(y){var x=true;if(this.mandatorySelected&&y.nodeModel&&this.mandatorySelected.indexOf(y.nodeModel.options.label)!==-1){x=false}return x}},{text:f.moreAttributesWizard.attrTitle,dataIndex:"attrTitle",typeRepresentation:"string",editableFlag:false,width:"auto",sortableFlag:true,resizableFlag:false}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:false}},init:function(x){this._parent(x);this._realInit(x)},_realInit:function(y){var z=this;var x=c.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";z.elements.container=h.createElement("div",{"class":z.getClassNames(x)});z._buildBody().then(z._buildFooter.bind(z)).done(function(){z.switchView(l.activeStep);z.options.subscribeTokens.push(z.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/stepChanged",},function(B){var A=B.stepId;z.switchView(A)}));z.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:z.elements.container}})})},destroy:function(){for(var x=0;x<this.options.subscribeTokens.length;x++){this.options.modelEvents.unsubscribe(this.options.subscribeTokens[x])}this.options.toolbar.destroy();this._parent()},_buildBody:function(){var x=this;return new e(function(A,z){x.elements.wizard=h.createElement("div",{"class":x.getClassNames("-wizard")}).inject(x.elements.container);x.options.wizard=new i({modelEvents:x.options.modelEvents,renderTo:x.elements.wizard,steps:l});var y=h.createElement("div",{"class":x.getClassNames("-toolbar-container")}).inject(x.elements.container);x.elements.content=h.createElement("div",{"class":x.getClassNames("-content")}).inject(x.elements.container);x._generateToolbar({renderTo:y});A()})},_buildFooter:function(){var x=this;return new e(function(A,z){x.elements.footer=h.createElement("div",{"class":x.getClassNames("-footer")}).inject(x.elements.container);var B=x.elements.nextButton=new p({label:f.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:true});B.addEventListener("click",function(){if(x.options.activeView==="typesView"){x.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"extensionsView"}})}else{if(x.options.activeView==="extensionsView"){x.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"attributesView"}})}else{if(x.options.activeView==="attributesView"){var C=x.options.models.attributesView.search({match:function(E){return E.nodeModel.options.grid.attrSel===true}}).map(function(E){return E.dump(g)});var D=[].concat(x.options.selectedExtensions).concat(x.options.automaticExtensions);x.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:C,selectedTypes:x.options.selectedTypes,selectedExtensions:D}});x.destroy()}}}});B.inject(x.elements.footer);var y=x.elements.closeButton=new p({label:f.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:true});y.addEventListener("click",function(){x.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/closeWizard"});x.destroy()});y.inject(x.elements.footer);A()})},switchView:function(A){if(this.options.activeView!==A){this.elements.toolbarSearch.clear(true);this.options.previousView=this.options.activeView;this.options.activeView=A;if(this.options.views[A]===null){var D=this.elements.content.getElement("div.more-attr-chooser-view");if(D){this.elements.content.removeChild(D)}if(!h.is(this.elements.loader)){this.elements.loaderDiv=h.createElement("div",{"class":this.getClassNames("-loader")}).inject(this.elements.content);this.elements.loader=new w().inject(this.elements.loaderDiv);this.elements.loader.getContent().addClassName("enx-loader")}this.elements.loaderDiv.removeClassName("hidden");this.elements.loader.on();var C=this;var z=[];var B=null,E=0,x=l.steps.length;do{if(l.steps[E].id===A){B=l.steps[E]}E++}while(E<x||B===null);if(B.prerequisiteViews){for(var y=0;y<B.prerequisiteViews.length;y++){if(this.options.views[B.prerequisiteViews[y]]===null){z.push(this["_build"+B.prerequisiteViews[y]](true))}}}e.all(z).then(function(){this["_build"+A]().then(function(F){C.elements.loaderDiv.addClassName("hidden");C.elements.loader.off();C.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:C.options.activeView}})})}.bind(this))}else{this.elements.content.empty();this.options.views[A].inject(this.elements.content);this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})}}},_buildtypesView:function(y){var x=this;return new e(function(C,B){x.elements.nextButton.label=f.moreAttributesWizard.next;x.elements.nextButton.disabled=true;x.options.wizard.getContent().addClassName("disabled");x.options.views[x.options.activeView]=h.createElement("div",{"class":x.getClassNames("-"+x.options.activeView+" more-attr-chooser-view")});var A=h.createElement("div",{"class":x.getClassNames("-"+x.options.activeView+"Dgv more-attr-dgv-container")}).inject(x.options.views[x.options.activeView]);var D=h.extend({identifier:"MoreAttrWizard-"+c.uid()},h.clone(x.options.dgvOptions));D.columns.splice(2,0,{dataIndex:"attrIcon",typeRepresentation:"icon",editableFlag:false,width:30,sortableFlag:false,resizableFlag:false});D.layout=new a(x.options.dgvLayoutOptions);var z=x.options.grids[x.options.activeView]=new q(D);z.onContextualEvent=function(){return[]};z.getCellTooltip=function(G){var E=x.options.grids[x.options.activeView].getColumnOrGroup(G.columnID),F=E.dataIndex;G.dataIndex=F;if(G.rowID===-1){return{shortHelp:f.moreAttributesWizard[F],updateModel:false}}}.bind(this);z.mandatorySelected=x.options.defaultTypes;x.options.dataModelSets[x.options.activeView]=new v();x.options.models[x.options.activeView]=new m({dataModelSet:x.options.dataModelSets[x.options.activeView]});z.treeDocument=x.options.models[x.options.activeView];z.getContent().addClassName("enxdatagridview loading");z.getContent().inject(A);x.options.views[x.options.activeView].inject(x.elements.content);z.onReady(function(){j.getTypesInfo({baseTypes:x.options.baseTypes}).then(function(G){var H=Object.getOwnPropertyNames(G);for(var E=0;E<H.length;E++){var J=H[E],K=G[J],I=x.options.selectedTypes.indexOf(J)!==-1?true:false;var F=o.createTreeNodeDataModel(x.options.dataModelSets[x.options.activeView],{label:J,grid:{attrTitle:K.displayName,attrSel:I,attrIcon:K.iconUrl}});x.options.models[x.options.activeView].addRoot(F,I?0:undefined)}if(y!==true){z.getContent().removeClassName("loading");x.elements.nextButton.disabled=false;x.options.wizard.getContent().removeClassName("disabled")}C({})});z.addEventListener("change",x._changeType.bind(x))})})},_changeType:function(z,A){var x=this.options.grids[this.options.activeView];if(A&&A.nodeModel&&A.nodeModel.options.grid){if(x.layout.getDataIndexFromColumnIndex(A.columnID)==="attrSel"){var y=this.options.selectedTypes.indexOf(A.nodeModel.getLabel());if(A.nodeModel.options.grid.attrSel===true){if(y===-1){this.options.selectedTypes.push(A.nodeModel.getLabel())}}else{if(y!==-1){this.options.selectedTypes.splice(y)}}}}},_buildextensionsView:function(y){var x=this;return new e(function(D,C){x.elements.nextButton.label=f.moreAttributesWizard.next;x.elements.nextButton.disabled=true;x.options.wizard.getContent().addClassName("disabled");x.options.views[x.options.activeView]=h.createElement("div",{"class":x.getClassNames("-"+x.options.activeView+" more-attr-chooser-view")});var B=h.createElement("div",{"class":x.getClassNames("-"+x.options.activeView+"-Dgv more-attr-dgv-container")}).inject(x.options.views[x.options.activeView]);var E=h.extend({identifier:"MoreAttrWizard-"+c.uid()},h.clone(x.options.dgvOptions));E.columns.push({icon:{iconName:"where-used",fontIconFamily:1},dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:false,width:75,sortableFlag:false,resizableFlag:false});E.layout=new a(x.options.dgvLayoutOptions);var A=x.options.grids[x.options.activeView]=new q(E);A.onContextualEvent=function(){return[]};A.getCellTooltip=function(H){var F=x.options.grids[x.options.activeView].getColumnOrGroup(H.columnID),G=F.dataIndex;H.dataIndex=G;if(H.rowID===-1){return{shortHelp:f.moreAttributesWizard[G],updateModel:false}}}.bind(this);A.mandatorySelected=x.options.defaultExtensions;var z={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};A.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(z));x.options.dataModelSets[x.options.activeView]=new v();x.options.models[x.options.activeView]=new m({dataModelSet:x.options.dataModelSets[x.options.activeView]});A.treeDocument=x.options.models[x.options.activeView];A.getContent().addClassName("enxdatagridview loading");A.getContent().inject(B);x.options.views[x.options.activeView].inject(x.elements.content);A.onReady(function(){j.interfaces({classes:x.options.selectedTypes}).then(function(N){var J=Object.getOwnPropertyNames(N.extensions);for(var L=0;L<J.length;L++){var M=J[L],F=N.extensions[M],H=x.options.selectedExtensions.indexOf(M)!==-1?true:false;var K={menu:[]};for(var O=0;O<F.declareIn.length;O++){K.menu.push({type:"PushItem",title:j.getNLSForTypes(F.declareIn[O])})}var G=o.createTreeNodeDataModel(x.options.dataModelSets[x.options.activeView],{label:M,grid:{attrTitle:F.nlsName,attrSel:H,declaredIn:K,attrInType:F.declareIn}});x.options.models[x.options.activeView].addRoot(G,H?0:undefined)}var I=Object.getOwnPropertyNames(N.automaticExtensions);for(var L=0;L<I.length;L++){x.options.automaticExtensions.push(I[L])}if(y!==true){A.getContent().removeClassName("loading");x.elements.nextButton.disabled=false;x.options.wizard.getContent().removeClassName("disabled")}D({})});A.addEventListener("change",x._changeExtension.bind(x))})})},_changeExtension:function(z,A){var x=this.options.grids[this.options.activeView];if(A&&A.nodeModel&&A.nodeModel.options.grid){if(x.layout.getDataIndexFromColumnIndex(A.columnID)==="attrSel"){var y=this.options.selectedExtensions.indexOf(A.nodeModel.getLabel());if(A.nodeModel.options.grid.attrSel===true){if(y===-1){this.options.selectedExtensions.push(A.nodeModel.getLabel())}}else{if(y!==-1){this.options.selectedExtensions.splice(y)}}}}},_buildattributesView:function(y){var x=this;return new e(function(D,C){x.elements.nextButton.label=f.moreAttributesWizard.done;x.elements.nextButton.disabled=true;x.options.wizard.getContent().addClassName("disabled");x.options.views[x.options.activeView]=h.createElement("div",{"class":x.getClassNames("-"+x.options.activeView+" more-attr-chooser-view")});var B=h.createElement("div",{"class":x.getClassNames("-"+x.options.activeView+"-Dgv more-attr-dgv-container")}).inject(x.options.views[x.options.activeView]);var E=h.extend({identifier:"MoreAttrWizard-"+c.uid()},h.clone(x.options.dgvOptions));E.columns.push({text:f.moreAttributesWizard.declaredIn,dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:false,width:75,sortableFlag:false,resizableFlag:false});E.layout=new a(x.options.dgvLayoutOptions);var A=x.options.grids[x.options.activeView]=new q(E);A.onContextualEvent=function(){return[]};A.getCellTooltip=function(H){var F=x.options.grids[x.options.activeView].getColumnOrGroup(H.columnID),G=F.dataIndex;H.dataIndex=G;if(H.rowID===-1){return{shortHelp:f.moreAttributesWizard[G],updateModel:false}}}.bind(this);A.mandatorySelected=["ds6w:label"];x.options.dataModelSets[x.options.activeView]=new v();x.options.models[x.options.activeView]=new m({dataModelSet:x.options.dataModelSets[x.options.activeView]});var z={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};A.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(z));A.treeDocument=x.options.models[x.options.activeView];A.getContent().addClassName("enxdatagridview loading");A.getContent().inject(B);x.options.views[x.options.activeView].inject(x.elements.content);A.onReady(function(){var I=h.clone(x.options.selectedTypes.concat(x.options.automaticExtensions).concat(x.options.selectedExtensions));for(var G=0;G<I.length;G++){I[G]="ds6wg:"+I[G]}var H=[];if(typeof x.options.grids.extensionsView==="undefined"){H.push(j.interfaces({classes:x.options.selectedTypes}))}var F=I.join("\n");e.all(H).then(function(){j.getPropertiesForClass({classURIs:F}).then(function(S){var M=Object.getOwnPropertyNames(S.availaibleAttributes);for(var Q=0;Q<M.length;Q++){var K=M[Q],N=S.availaibleAttributes[K],O=k[K]?k[K]:K,L=x.options.selectedAttributes.indexOf(O)!==-1?true:false;var P={menu:[]};if(N.inTypes){for(var R=0;R<N.inTypes.length;R++){if(I.indexOf(N.inTypes[R])!==-1){P.menu.push({type:"PushItem",title:j.getNLSForTypes(N.inTypes[R])})}}}if(P.menu.length){var J=o.createTreeNodeDataModel(x.options.dataModelSets[x.options.activeView],{label:O,grid:{attrTitle:N.label,attrDesc:N.description,attrKind:N.dataType.substring(N.dataType.indexOf("#")+1),attrInType:N.attrInType,declaredIn:P,attrSel:L}});x.options.models[x.options.activeView].addRoot(J,L?0:undefined)}}if(y!==true){A.getContent().removeClassName("loading");x.elements.nextButton.disabled=false;x.options.wizard.getContent().removeClassName("disabled")}D({})})});A.addEventListener("change",x._changeAttributes.bind(x))})})},_changeAttributes:function(z,A){var x=this.options.grids[this.options.activeView];if(A&&A.nodeModel&&A.nodeModel.options.grid){if(x.layout.getDataIndexFromColumnIndex(A.columnID)==="attrSel"){var y=this.options.selectedAttributes.indexOf(A.nodeModel.getLabel());if(A.nodeModel.options.grid.attrSel===true){if(y===-1){this.options.selectedAttributes.push(A.nodeModel.getLabel())}}else{if(y!==-1){this.options.selectedAttributes.splice(y)}}}}},_generateToolbar:function(C){var B=this;this.elements.toolbar=h.createElement("div",{"class":this.getClassNames("-toolbar")}).inject(C.renderTo);var E=h.createElement("div",{"class":this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);var y=h.createElement("div",{"class":this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);var x=function(F,H){var G=false;var I=new RegExp(F,"i");if(I.test(H.nodeModel.options.grid.attrTitle)||I.test(H.nodeModel.getLabel())){G=true}return G};var A=d.debounce(function(F){B.options.models[B.options.activeView].withTransactionUpdate(function(){var H=F.searchStr;var G=true;B.options.filterInProgress=true;B.options.models[B.options.activeView].search({match:function(I){if(x(H,I)){I.nodeModel.show();if(H.length>0){if(G){I.nodeModel.select(true);I.nodeModel.matchSearch();G=false}else{I.nodeModel.unmatchSearch();I.nodeModel.unselect()}}else{I.nodeModel.unmatchSearch();I.nodeModel.unselect()}}else{I.nodeModel.unmatchSearch();I.nodeModel.unselect();I.nodeModel.hide()}}});B.options.filterInProgress=false});B.options.models[B.options.activeView].getXSO().onPostAdd(function(){});B.options.models[B.options.activeView].getXSO().onPostRemove(function(){})},500);B.elements.toolbarSearch=new s({events:{onSearch:A}}).inject(E);var z=function(F){B.options.models[B.options.activeView].withTransactionUpdate(function(){var H=B.options.models[B.options.activeView].getRoots();for(var G=0;G<H.length;G++){switch(F){case"none":H[G].show();break;case"selected":if(H[G].getReferenceValue("attrSel")===true){H[G].show()}else{H[G].hide()}break;case"unselected":if(H[G].getReferenceValue("attrSel")===false){H[G].show()}else{H[G].hide()}break}}});B.options.models[B.options.activeView].getXSO().onPostAdd(function(){});B.options.models[B.options.activeView].getXSO().onPostRemove(function(){})};var D={renderTo:y,items:[{className:"divider"},{fonticon:"filter",text:f.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:f.moreAttributesWizard.none,name:"none",selectable:true,selected:true},{fonticon:"checkbox-on",text:f.moreAttributesWizard.selected,name:"selected",selectable:true},{fonticon:"checkbox-off",text:f.moreAttributesWizard.unselected,name:"unselected",selectable:true}],events:{onClick:function(G,F){z(F.name)}}}}}]};this.options.toolbar=new b(D);this.options.toolbar.elements.container.setStyle("display",undefined)}});return r});define("DS/PADServices/views/utils/ContentChooser",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Iconbar","DS/ENOXEmptyContent/js/ENOXEmptyContent"],function(k,d,c,g,s,n,p,i,q,j,e,b,l){function r(y,C,B){var x=y.getRoots();var A=[];for(var z=0;z<x.length;z++){var w=x[z];if(B(w,C)){A.push(w)}}return A}function v(w,x){return r(w,x,function(y,z){return(y.options.resourceid===z)})}function o(w,x){return r(w,x,function(y,z){return(y.options.grid&&y.options.grid.leaves&&y.options.grid.leaves.indexOf(z)!==-1)})}function f(x,w){return r(x,w,function(y,z){return(y.options.grid&&y.options.grid.associatedProduct&&y.options.grid.associatedProduct===z)})}function a(x){var w=x.target;if(w&&!w.parentElement.classList.contains("disabled")){return true}return false}function u(x,y,w){x[y]=w}function t(B,A){var y=Object.keys(A);for(var x=0;x<y.length;x++){var z=y[x];var w=A[z];if(w){B.disableItem(z)}else{B.enableItem(z)}}}var h={largeTiles:{title:d.contentChooser.bigTiles,fonticon:"view-big-tile"},tiles:{title:d.contentChooser.smallTiles,fonticon:"view-small-tile"},thumbnails:{title:d.contentChooser.smallThb,fonticon:"view-small-thb"}};var m=s.extend({name:"enx-contentChooser",defaultOptions:{modelEvents:null,model:null,defaultView:"largeTiles",view:{largeTiles:null,tiles:null,thumbnails:null},title:"",subscribeTokens:[]},init:function(y){var A=this;this._parent(y);var x={};this.options.model=new j(x);this.elements.container=g.createElement("div",{"class":this.getClassNames()});this.__addToolbar().inject(this.elements.container);this.elements.content=g.createElement("div",{"class":this.getClassNames("-content")}).inject(this.elements.container);var z=A["__build"+A.options.defaultView]();z.getContent().inject(this.elements.content);this._addSubscribe("ENXViews/ContentChooser/model/"+y.loadKey,this._modelEvent.bind(this));var w="-withoutContent";if(g.is(c.isWebInWinContext,"function")&&c.isWebInWinContext()){w="-withoutContentWebInWin"}this.elements.withoutContent=g.createElement("div",{"class":this.getClassNames(w)}).inject(this.elements.container);this.elements.withoutContent.hide();this.__buildEmptyContent()},render:function(){return this.elements.container},destroy:function(){for(var w=0;w<this.options.subscribeTokens.length;w++){this.options.modelEvents.unsubscribe(this.options.subscribeTokens[w])}},iconBarResize:function(){this.elements.iconbar.show();this.elements.iconbar.buildOverflowMenu();this.elements.iconbar.resize()},_addSubscribe:function(w,x){this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:w},x))},_modelEvent:function(w){switch(w.op){case"populate":this.options.model.empty();this.elements.withoutContent.hide();this.elements.content.show();this._addObjectsToModel(w.objects,w.allselected);break;case"populateAppend":this.elements.withoutContent.hide();this.elements.content.show();this._addObjectsToModel(w.objects,w.allselected);break;case"update":this._updatedObjectsInModel(w);break;case"remove":this._removeObjectsInModel(w);break;case"noResult":this.options.model.empty();this.elements.content.hide();this.elements.withoutContent.show();break}},_addObjectsToModel:function(z,w){var B=[];for(var y=0;y<z.length;y++){var A=g.clone(z[y]);B.push(A)}var x=this.options.model;x.withTransactionUpdate(function(){x.addRoot(B);if(w===true){x.selectAll()}})},_updatedObjectsInModel:function(A){var w=this.options.model;var z=A.objects;var y=this;var x=true;w.withTransactionUpdate(function(){for(var H=0;H<z.length;H++){x=true;var B=v(w,z[H].resourceid);if(B.length===1){x=false;if(z[H].opened===true){z[H].statusbarIcons=["trash","broom"];z[H].statusbarIconsTooltips=[d.contentChooser.remove,d.contentChooser.removeFromView];z[H].contextualMenu=[{type:"SeparatorItem"}]}else{z[H].statusbarIcons=["trash"];z[H].statusbarIconsTooltips=[d.contentChooser.remove];z[H].contextualMenu=[{type:"SeparatorItem"}]}if(A.fromCustom){z[H].fromCustom=true}z[H].labelUpdated=false;B[0].updateOptions(z[H])}var E=o(w,z[H].resourceid);if(E.length){x=false;for(var J=0;J<E.length;J++){var C=E[J].getAttributeValue("leaves");if(C.length===1){var G="UNKNOWN";if(z[H].grid&&z[H].grid["ds6w:identifier"]){G=z[H].grid["ds6w:identifier"]}E[J].updateOptions({branchLabel:z[H].label,branchIdentifier:G})}else{E[J].updateOptions({branchLabel:C.length+d.contentChooser.branches,branchIdentifier:C.length+d.contentChooser.branches})}}}var L=f(w,z[H].resourceid);if(L.length){x=false;for(var J=0;J<L.length;J++){var I="UNKNOWN";if(z[H].grid&&z[H].grid["ds6w:identifier"]){I=z[H].grid["ds6w:identifier"]}L[J].updateOptions({rootLabel:z[H].label,rootIdentifier:I})}}if(x){if(z[H].opened){z[H].statusbarIcons=["trash","broom"];z[H].statusbarIconsTooltips=[d.contentChooser.remove,d.contentChooser.removeFromView];z[H].contextualMenu=[{type:"SeparatorItem"}]}else{z[H].statusbarIcons=["trash"];z[H].statusbarIconsTooltips=[d.contentChooser.remove];z[H].contextualMenu=[{type:"SeparatorItem"}]}if(A.fromCustom){z[H].fromCustom=true}w.addRoot(z[H])}}var D=[];var K=w.getRoots();for(var F=0;F<K.length;F++){if(K[F].options.branchLabel&&!K[F].options.labelUpdated){K[F].updateOptions({label:K[F].getLabel()+" \u25ba "+K[F].options.branchLabel,description:K[F].options.description+" \u25ba "+K[F].options.branchIdentifier,labelUpdated:true})}if(K[F].options.rootLabel&&!K[F].options.labelUpdated){K[F].updateOptions({label:K[F].getLabel()+d.contentChooser.onrootprod+K[F].options.rootLabel,description:K[F].options.description+d.contentChooser.onrootprod+K[F].options.rootIdentifier,labelUpdated:true})}if(K[F].options.loading===true){if(A.fromDB===true||A.readOnlyApp===true){w.removeRoot(K[F])}else{K[F].updateOptions({label:d.contentChooser.checkOnRecent});D.push(K[F].options.resourceid);if(K[F].options.grid.leaves){D=D.concat(K[F].options.grid.leaves)}}}}if(D.length){y.options.modelEvents.publish({event:"ENXViews/ContentChooser/searchInRecent",data:{unknownIds:D}})}})},_removeObjectsInModel:function(x){var w=this.options.model;w.withTransactionUpdate(function(){for(var z=0;z<x.removedOjects.length;z++){var y=v(w,x.removedOjects[z]);if(y.length===1){if(x.removeFromView===true){y[0].updateOptions({opened:false,statusbarIcons:["trash"],statusbarIconsTooltips:[d.contentChooser.remove],contextualMenu:[{type:"SeparatorItem"}]})}else{w.removeRoot(y[0])}}else{console.log("ID to remove ["+x.removedOjects[z]+" not found")}}if(w.getRoots().length===0&&x.cbEmptyView){x.cbEmptyView()}this.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"})}.bind(this))},__doubleClickCellHandler:function(x){var w=x.nodeModel;if(w&&!w.options.opened){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[w]}});this.options.model.unselectAll()}},__openSingle:function(w){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[w]}});this.options.model.unselectAll()},__openSingleWithFilter:function(w){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[w],withFilter:true}});this.options.model.unselectAll()},__openSelected:function(){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:this.options.model.getSelectedNodes()}});this.options.model.unselectAll()},__openSelectedWithFilter:function(){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:this.options.model.getSelectedNodes(),withFilter:true}});this.options.model.unselectAll()},__search:function(x){var w=this.options.model.search({match:function(y){if(y.nodeModel.options.resourceid===x){return true}}});return w},__searchBranch:function(x){var w=this.options.model.search({match:function(y){if(y.nodeModel.options.grid.leaves&&y.nodeModel.options.grid.leaves.indexOf(x)!==-1){return true}}});return w},__searchAssociatedProduct:function(x){var w=this.options.model.search({match:function(y){if(y.nodeModel.options.grid.associatedProduct===x){return true}}});return w},__addToolbar:function(){var D=this,x="-toolbar";if(g.is(c.isWebInWinContext,"function")&&c.isWebInWinContext()){x="-toolbarWebInWin"}var F=g.createElement("div",{"class":D.getClassNames(x)});var C=this.elements.toggleButton=new n({icon:{iconName:D.options.toggleIcon,fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite-borders",touchMode:true});C.getContent().addClassName(D.getClassNames("-toogleTriptych"));D._addSubscribe("ENXViews/ContentChooser/toggleIcon",function(H){D.elements.toggleButton.icon=H;D.iconBarResize()});C.addEventListener("click",function(){D.options.modelEvents.publish({event:"ENXViews/ContentChooser/toggleClicked"})});C.inject(F);g.createElement("div",{"class":D.getClassNames("-title"),text:D.options.title}).inject(F);var E,G;switch(D.options.defaultView){case"tiles":E="view-small-tile";G=d.contentChooser.smallTiles;break;case"thumbnails":E="view-small-thb";G=d.contentChooser.smallThb;break;case"largeTiles":default:E="view-big-tile";G=d.contentChooser.bigTiles;break}var B=g.createElement("div",{"class":D.getClassNames("-commands")}).inject(F);var A=function(H){D.__switchView(H);var J=D.elements.iconbar.getItem("viewDropDown");var I={id:J.id,title:h[H].title,fonticon:h[H].fonticon};D.elements.iconbar.menu.updateItem(I)};var y={renderTo:B,items:[{fonticon:"open",text:d.contentChooser.open,name:"openSelected",handler:function(H){if(a(H)){D.__openSelected()}}},{fonticon:"filter",text:d.contentChooser.openwithfilter,name:"filterSelected",handler:function(H){if(a(H)){D.__openSelectedWithFilter()}}},{fonticon:"broom",text:d.contentChooser.removeFromView,name:"removeFromView",handler:function(H){if(a(H)){D.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+D.options.loadKey+"/removeFromView",data:{nodes2remove:D.options.model.getSelectedNodes(),dispatch:true}})}}},{fonticon:"select-on",text:d.contentChooser.manageSelection,name:"selectDropDown",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-on",text:d.contentChooser.selectAll,name:"selectAll",handler:function(){D.options.model.selectAll()}},{fonticon:"select-off",text:d.contentChooser.selectNone,name:"selectNone",handler:function(){D.options.model.unselectAll()}}],}}},{fonticon:"trash",text:d.contentChooser.remove,name:"removeSelected",handler:function(H){if(a(H)){D.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+D.options.loadKey+"/remove",data:{nodes2remove:D.options.model.getSelectedNodes(),dispatch:true}})}}},{fonticon:E,title:G,name:"viewDropDown",content:{type:"dropdownmenu",options:{items:[{fonticon:"view-big-tile",text:d.contentChooser.bigTiles,name:"largeTiles",selectable:true,selected:D.options.defaultView==="largeTiles",handler:function(H){A("largeTiles")}},{fonticon:"view-small-tile",text:d.contentChooser.smallTiles,name:"tiles",selectable:true,selected:D.options.defaultView==="tiles",handler:function(H){A("tiles")}},{fonticon:"view-small-thb",text:d.contentChooser.smallThb,name:"thumbnails",selectable:true,selected:D.options.defaultView==="thumbnails",handler:function(H){A("thumbnails")}}],}}},{fonticon:"close",text:d.contentChooser.back2app,name:"back2app",handler:function(H){if(a(H)){D.options.modelEvents.publish({event:"ENXViews/ContentChooser/closeLandingPage"})}}}],};this.elements.iconbar=new b(y);this.elements.iconbar.menu.templateClassname="byPassABug";var z=function(O){var M=false,I=D.options.model.getRoots();for(var H=0;H<I.length&&M===false;H++){if(I[H].options.opened===true){M=true}}if(!M){D.elements.iconbar.disableItem("back2app")}else{D.elements.iconbar.enableItem("back2app")}var J=D.elements.iconbar.getItem("back2app");var K={id:J.id,disabled:M===false};D.elements.iconbar.menu.updateItem(K);u(O,"back2app",M===false);var N=D.elements.iconbar.getItem("selectDropDown");var L={id:N.id,disabled:I.length===0};D.elements.iconbar.menu.updateItem(L);u(O,"selectDropDown",I.length===0);t(D.elements.iconbar,O)};var w=function(){var W=true,V=true,R=D.options.model.getSelectedNodes(),S=true,I=true,P=false;var N={};W=R.length===0;for(var T=0;T<R.length&&(S||I);T++){if(R[T].getAttributeValue("ds6w:type")==="ENOStrRefinementSpecification"){S=false}if(R[T].options.opened!==true){I=false}else{P=true}}if(I===false){W=false}else{W=true}if(S&&R.length===1&&I===false){V=false}u(N,"openSelected",W);var M=D.elements.iconbar.getItem("openSelected");var U={id:M.id,disabled:W};D.elements.iconbar.menu.updateItem(U);var O=D.elements.iconbar.getItem("filterSelected");var H={id:O.id,disabled:V};D.elements.iconbar.menu.updateItem(H);u(N,"filterSelected",V);var J=D.elements.iconbar.getItem("removeSelected");var L={id:J.id,disabled:R.length===0};D.elements.iconbar.menu.updateItem(L);u(N,"removeSelected",R.length===0);var K=D.elements.iconbar.getItem("removeFromView");var Q={id:K.id,disabled:R.length===0||P===false};D.elements.iconbar.menu.updateItem(Q);u(N,"removeFromView",R.length===0||P===false);z(N)};D.options.model.getXSO().onPostAdd(w);D.options.model.getXSO().onPostRemove(w);D.options.model.getXSO().onEmpty(w);D.options.model.getModelEvents().subscribe({event:"removeChild"},function(){w()});w();this._addSubscribe("ENXViews/ContentChooser/refresh",function(){w();setTimeout(function(){D.iconBarResize()},500)});return F},__buildlargeTiles:function(){var w=this.options.view.largeTiles=new p({useDragAndDrop:false,allowUnsafeHTMLContent:false});w.selectionBehavior={unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true,enableShiftSelection:true,enableFeedbackForActiveCell:false,canInteractiveMultiselectWithCheckboxClick:true};w.onContextualEvent=this.__onContextualEvent();w.onCellDoubleClick(this.__doubleClickCellHandler.bind(this));w.onStatusbarIconPointerDown=this.__onStatusbarIconPointerDown.bind(this);w.loadGridViewModel(this.options.model);w.getContent().classList.add("enx-responsive-view");w.getContent().classList.add("large-tiles");return w},__buildtiles:function(){var w=this.options.view.tiles=new i({useDragAndDrop:false,allowUnsafeHTMLContent:false});w.selectionBehavior={unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true,enableShiftSelection:true,enableFeedbackForActiveCell:false,canInteractiveMultiselectWithCheckboxClick:true};w.onContextualEvent=this.__onContextualEvent();w.onCellDoubleClick(this.__doubleClickCellHandler.bind(this));w.onStatusbarIconPointerDown=this.__onStatusbarIconPointerDown.bind(this);w.loadGridViewModel(this.options.model);w.getContent().classList.add("enx-responsive-view");w.getContent().classList.add("tiles");return w},__buildthumbnails:function(){var w=this.options.view.thumbnails=new q({useDragAndDrop:false,allowUnsafeHTMLContent:false,displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"]});w.selectionBehavior={unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true,enableShiftSelection:true,enableFeedbackForActiveCell:false,canInteractiveMultiselectWithCheckboxClick:true};w.onContextualEvent=this.__onContextualEvent();w.onCellDoubleClick(this.__doubleClickCellHandler.bind(this));w.onStatusbarIconPointerDown=this.__onStatusbarIconPointerDown.bind(this);w.loadGridViewModel(this.options.model);w.getContent().classList.add("enx-responsive-view");w.getContent().classList.add("tiles");return w},__switchView:function(w){this.options.view[this.options.defaultView].unloadGridViewModel();var x=this.options.view[w];if(x===null){x=this["__build"+w]()}else{x.loadGridViewModel(this.options.model)}this.options.defaultView=w;this.elements.content.empty();x.inject(this.elements.content)},__onStatusbarIconPointerDown:function(w){var y=this;var z=w.cellInfos;var x=w.clickedIconIndex;var A=z?z.cellModel:undefined;switch(x){case 0:y.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+y.options.loadKey+"/remove",data:{nodes2remove:[A],dispatch:true}});break;case 1:y.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+y.options.loadKey+"/removeFromView",data:{nodes2remove:[A],dispatch:true}});break}},__onContextualEvent:function(){var w=this;return{"this":w,callback:function(y){var x=this;return new Promise(function(D){var F=[];if(y.cellInfos===undefined){D(F);return}var B=y.cellInfos.nodeModel,E=x.options.model.getSelectedNodes().length;var z=false,C=true;if(B.getAttributeValue("ds6w:type")!=="ENOStrRefinementSpecification"&&B.options.opened!==true&&E===1){z=true}if(B.options.opened!==true){C=false}if(B.getAttributeValue("ds6w:type")==="Person"){C=true;z=false}var G={type:"PushItem",icon:"url("+e.getWebappsAssetUrl("PADServices","icons/32/I_OpenWith.png")+")",title:d.contentChooser.open,action:{"this":B,callback:function(){x.__openSelected(this)}},state:C===true?"disabled":"enabled",};F.push(G);if(z){var A={type:"PushItem",icon:"url("+e.getWebappsAssetUrl("PADServices","icons/32/I_DefineFilter.png")+")",title:d.contentChooser.openwithfilter,action:{"this":B,callback:function(){x.__openSingleWithFilter(this)}}};F.push(A)}D(F)})}}},__buildEmptyContent:function(){var x=this;var w=new n({label:d.welcomePanel.searchContent,emphasize:"primary",touchMode:true});w.getContent().addClassName(x.getClassNames("-searchForContent"));w.addEventListener("click",function(){x.options.modelEvents.publish({event:"ENXViews/ContentChooser/searchContent"})});this.elements.emptyContent=new l({modelEvents:this.options.modelEvents,sentences:[{type:"drop",text:d.contentChooser.dropcontenthere},{type:"dom",DOMelement:w.getContent()}],fontSize:"16px",orderedListType:"none",});this.elements.emptyContent.inject(this.elements.withoutContent)}});return m});define("DS/PADServices/views/ENXWelcomePanel",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Controls/Abstract","UWA/Class/Promise","DS/Core/Core","DS/PADServices/views/utils/ContentChooser","DS/PADServices/ws/WSPromises","DS/PADServices/utils/ParserUtils","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/SubscriptionHolder","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","DS/Tree/TreeNodeModel","DS/UIKIT/Mask","DS/Menu/Menu","DS/Utilities/UUID"],function(q,h,y,g,a,t,x,i,e,r,j,B,u,E,l,d){var A={actual:null,count:0};var w={WELCOME:"ENXViews/WelcomePanel/",WELCOME_AND_SHELL:"ENXViews/WelcomeAndShell/",CONTENT:"ENXViews/ContentChooser/"};Object.freeze(w);var z='flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"';var C=3;var k="ENOStrRefinementSpecification";function p(I){var J=[];var H=Object.getOwnPropertyNames(I);if(H.length){for(var G=0;G<H.length;G++){if(H[G]!=="opened"){var F=p(I[H[G]]);if(F===null){J.push(H[G])}else{if(UWA.is(F,"string")){J.push(F)}else{J=J.concat(F)}}}}}else{return null}return J}function f(P,G){var F=[],K=[],M={};var N=N||[];var L=P.products||{};var S=Object.getOwnPropertyNames(L);var U;for(var O=0;O<S.length;O++){if(S[O]==="undefined"){continue}var J=N.indexOf(S[O])===-1?false:true;if(G&&G.indexOf(S[O])!==-1){delete L[S[O]].opened}U={resourceid:S[O],grid:{rootId:S[O],leaves:p(L[S[O]]),detached:J},opened:L[S[O]].opened,thumbnail:j.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:h.welcomePanel.loading,loading:true};if(J){U.statusbarIcons[0]="eye-off";U.statusbarIconsTooltips[0]=h.welcomePanel.detached}U.item2Load[S[O]]=L[S[O]];F.push(U);M[U.resourceid]=F.length-1;if(K.indexOf(S[O])===-1){K.push(S[O])}if(U.grid.leaves){for(var Q=0;Q<U.grid.leaves.length;Q++){if(K.indexOf(U.grid.leaves[Q])===-1){K.push(U.grid.leaves[Q])}}}}var H=P.filters||{};var T=Object.getOwnPropertyNames(H);for(var I=0;I<T.length;I++){if(T[I]==="undefined"){continue}var R=T[I];U={resourceid:R,grid:{filterId:R,associatedProduct:H[R].associatedProduct,detached:J},opened:H[R].opened,thumbnail:j.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:h.welcomePanel.loading,loading:true};if(J){U.statusbarIcons[0]="eye-off";U.statusbarIconsTooltips[0]=h.welcomePanel.detached}U.item2Load[R]=H[R];F.push(U);M[U.resourceid]=F.length-1;if(K.indexOf(R)===-1){K.push(R)}if(K.indexOf(U.grid.associatedProduct)===-1){K.push(U.grid.associatedProduct)}}return{id2retrieve:K,storedObjLst:F,mapIdStoredObjLst:M}}function n(L,O){var J={products:[],filters:[]};var K=[];var H=L.products||{};var Q=Object.getOwnPropertyNames(H);K=K.concat(Q);for(var M in Q){var I=p(H[Q[M]]);if(I){for(var N=0;N<I.length;N++){if(K.indexOf(I[N])===-1){K.push(I[N])}}}}var F=L.filters||{};var R=Object.getOwnPropertyNames(F);for(var G in R){var P=R[G];if(K.indexOf(F[P].associatedProduct)===-1){K.push(F[P].associatedProduct)}}for(var N=0;N<O.length;N++){if(K.indexOf(O[N])!==-1&&J.products.indexOf(O[N])===-1){J.products.push(O[N])}else{if(R.indexOf(O[N])!==-1&&J.filters.indexOf(O[N])===-1){J.filters.push(O[N])}}}return J}function D(F,G){if(!F.openProducts){F.openProducts={}}if(!F.openProducts[G]){F.openProducts[G]={}}F.hasUpdated=true}function c(F,G){if(!F.openProducts){F.openProducts={}}var H=false;if(F.openProducts[G]){delete F.openProducts[G];H=true}F.hasUpdated=true;return H}function m(F,G){if(F.openProducts&&F.openProducts[G]){return true}return false}function o(F,G){return(F.filters&&F.filters[G]&&F.filters[G].opened)}function s(G,H){var F=G.objectsLst;return new g(function(L){var K=n(H,G.idsNotFound);var M=[],J=[];if(K.products.length){var I={pids:K.products,data:{authored:true,intent:"explore_2D",select_file:["icon","thumbnail_2d"]},forceAuthoringCall:true,enopad_webapis:true};J.push(x.fetch(I).then(function(P){if(P.results&&P.results.length>0){for(var O=0;O<P.results.length;O++){var N=P.results[O];var R=i.parseAttributes(N.attributes);if(R.grid){var Q=new Date(R.grid["ds6w:modified"]).toLocaleString(e.getLang());R.subLabel=R.grid["ds6w:responsible"]+" | "+Q;R.description=R.grid["ds6w:identifier"]}R.loading=undefined;if(typeof F.mapIdStoredObjLst[R.resourceid]!=="undefined"&&F.storedObjLst[F.mapIdStoredObjLst[R.resourceid]].opened===true){R.opened=true}else{R.opened=false}M.push(R)}}L(M)})["catch"](function(N){console.error(N);e.displayNotif({level:"error",message:h.errors.cannotFetchAttributes,sticky:true})}))}if(K.filters.length){J.push(x.fetch({data:K.filters}).then(function(O){if(O.success){for(var N=0;N<O.success.length;N++){var Q=O.success[N];var S=Object.getOwnPropertyNames(Q);for(var P=0;P<S.length;P++){var R={resourceid:S[P],icons:[j.getWebappsAssetUrl("ENOFilterBIUX","icons/I_AdvancedFilter32.png")],thumbnail:j.getWebappsAssetUrl("ENOFilterBIUX","icons/I_AdvancedFilter144.png"),grid:{"ds6w:type":"ENOStrRefinementSpecification","ds6w:identifier":Q[S[P]].filterName},label:Q[S[P]].filterName,subLabel:h.welcomePanel.filterNotIndexYet,display:Q[S[P]].filterName,description:Q[S[P]].filterName};R.loading=undefined;if(typeof F.mapIdStoredObjLst[R.resourceid]!=="undefined"&&F.storedObjLst[F.mapIdStoredObjLst[R.resourceid]].opened===true){R.opened=true}else{parsedRes.opened=false}M.push(R)}}}}))}g.all(J).then(function(){L(M)})})}function b(I,H,K){var G=I.objectsLst;var J={idsNotFound:G.id2retrieve,objectsLst:G};var F=!H.options.readOnlyApp;return new g(function(O,N){var M=I.objectsLst;var L={pids:M.id2retrieve,data:{authored:false,select_predicate:["ds6w:label","ds6w:description","ds6w:type","ds6w:responsible","ds6w:identifier","ds6w:modified"],select_file:["icon","thumbnail_2d"]}};x.fetch(L).then(function(T){if(!(T.results&&T.results.length>0)){if(H.options.readOnlyApp===true){N({error:"No result on Index",errorCode:"resultNotFoundOnIndex"})}else{s(J,K).then(function(ac){if(ac.length===0){H.__noResult()}else{H.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+I.loadKey,data:{op:"update",objects:ac,readOnlyApp:H.options.readOnlyApp}})}})}}else{var S=[],Z=UWA.clone(M.id2retrieve);for(var aa=0;aa<T.results.length;aa++){var ab=T.results[aa];var P=i.parseAttributes(ab.attributes);var Y=false;if(P.grid){var X=new Date(P.grid["ds6w:modified"]).toLocaleString(e.getLang());P.subLabel=P.grid["ds6w:responsible"]+" | "+X;P.description=P.grid["ds6w:identifier"];var W=P.grid["ds6w:type"];if(W===k){Y=true}}P.loading=undefined;if(Y){P.opened=o(K,P.resourceid)}else{P.opened=m(K,P.resourceid)}S.push(P);var R=Z.indexOf(P.resourceid);if(R!==-1){Z.splice(R,1)}}var V=[];if(Z.length){if(F){J.idsNotFound=Z;V.push(s(J,K).then(function(ac){S=S.concat(ac)}))}else{for(var U=0;U<Z.length;U++){var Q=[];Q.push({resourceid:Z[U],label:h.welcomePanel.notLoaded,subLabel:h.welcomePanel.notLoaded,icons:["attention"],thumbnail:j.getWebappsAssetUrl("PADServices","icons/32/I_Warn.png"),loading:false});S=S.concat(Q)}}}g.all(V).then(function(){if(S.length){H.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+I.loadKey,data:{op:"update",objects:S,readOnlyApp:H.options.readOnlyApp}})}O()})}})["catch"](function(P){console.error(P);N(P)})})}var v=y.extend({name:"enx-welcome-panel",defaultOptions:{wpUUID:null,defaultActionId:null,defaultSearchTemplate:null,welcomePanelState:"opened",openStack:{openContent:null,removeContent:null,openProxy:null,removeProxy:null,launchAction:null},appReady:false,proxyReady:false,readOnlyApp:true,subscriptions:[]},init:function(F){this._parent(F);this.options.wpuuid="enwwp-"+d.v4();if(this.options.storedObjects===undefined){this.options.storedObjects={products:{},filters:{}}}this.subcriptionHolder=new r(F.modelEvents)},initialize:function(){var F=this;return new g(function(H,G){require(["DS/PADServices/views/utils/WelcomeAndShell"],function(J){F.elements.container=UWA.createElement("div",{"class":F.getClassNames()});var K=F.options.modelEvents;var I={description:F.options.description,container:F.elements.container,modelEvents:K};if(F.options.activities===undefined){I=UWA.extend(I,F._defaultWelcomePanel({}),true)}else{I.activities=F.options.activities;I.defaultActionId=F.options.defaultActionId}if(F.options.customOpenControllerClass){F._openController=new F.options.customOpenControllerClass()}F.elements.welcomePanel=new J(I);F.subcriptionHolder.subscribe({event:w.WELCOME+"appReady"},function(){F.options.appReady=true;if(F.options.openStack.openContent!==null){F.__launchOpenMdlEvts(F.options.openStack.openContent);F.options.openStack.openContent=null}if(F.options.openStack.removeContent!==null){F.__launchRemoveMdlEvts(F.options.openStack.removeContent);F.options.openStack.removeContent=null}if(F.options.openStack.launchAction!==null){F.__launchAction(F.options.openStack.launchAction);F.options.openStack.launchAction=null}E.unmask(F.elements.container)});F.subcriptionHolder.subscribe({event:"welcome-panel-action-selected"},function(L){K.publish({event:w.WELCOME+"action/"+L.id,data:{id:L.id}})});F.elements.welcomePanel.initialize().then(function(){F.elements.triptych=F.elements.container.querySelector(".triptych-container");F.elements.triptych.classList.add("enx-welcome-shell");var L=F.elements.container.querySelector(".triptych-left");F._hookCleanup=e.hookTransitionEnd(L,function(M){if(F.elements.previousContent){F.elements.previousContent.iconBarResize()}});F.subcriptionHolder.subscribe({event:w.CONTENT+"openContent"},function(Q){var O={mode:"welcome",products:{},filters:{}};var N=Q.nodes;for(var M=0;M<N.length;M++){var P=N[M];if(P.getAttributeValue("ds6w:type")==="ENOStrRefinementSpecification"){O.filters=UWA.extend(O.filters,P.options.item2Load)}else{if(P.options.fromCustom){if(F._openController){F._openController.processOpenType(O,P);return}}else{O.products=UWA.extend(O.products,N[M].options.item2Load)}}}if(Q.withFilter!==undefined){O.withFilter=Q.withFilter}F.__launchOpenMdlEvts(O)});F.subcriptionHolder.subscribe({event:w.WELCOME+"openedObject"},function(R){switch(R.kind){case"products":var S;var M=R.addedPaths.length;var V=F.options.storedObjects;var O=[];for(S=0;S<M;S++){var W=V.products;var P=0;var U=R.addedPaths[S].length;for(P=0;P<U;P++){if(!W.hasOwnProperty(R.addedPaths[S][P])){W[R.addedPaths[S][P]]={}}W=W[R.addedPaths[S][P]];if(P===0){var X=R.addedPaths[S][P];O.push({resourceid:X,opened:true});D(V,R.addedPaths[S][P])}}}F._updateStoredList({loadKey:"previousContent"});break;case"filters":if(R.addedFilters.filters){var Y=Object.getOwnPropertyNames(R.addedFilters.filters);for(var Q=0;Q<Y.length;Q++){var T=Y[Q];if(!F.options.storedObjects.filters[T]){F.options.storedObjects.filters[T]=R.addedFilters.filters[T];F.options.storedObjects.filters[T].opened=true;F.options.storedObjects.hasUpdated=true}else{F.options.storedObjects.filters[T].opened=true}}}F._updateStoredList({loadKey:"previousContent"});break;case"deleteRoots":for(var N=0;N<R.removeIds.length;N++){if(F.options.storedObjects.products[R.removeIds[N]]){delete F.options.storedObjects.products[R.removeIds[N]]}else{if(F.options.storedObjects.filters[R.removeIds[N]]){delete F.options.storedObjects.filters[R.removeIds[N]]}}F.options.storedObjects.hasUpdated=true}F._updateStoredList({loadKey:"previousContent",removedFromViewIds:R.removeIds,removeFromStore:true});break;case"removeFromView":F._removeObjectFromView({item2remove:R.removedFromViewIds,dispatch:R.dispatch});break}});F.subcriptionHolder.subscribe({event:w.WELCOME+"refreshView"},function(){F._smartUpdateList();F.options.modelEvents.publish({event:w.CONTENT+"refresh"})});F.__setDnDBehavior();F.__setupCrossWidgetCommunication().then(function(){H()})})})})},render:function(){var F=this;if(this.options.welcomePanelState==="opened"){setTimeout((function(){this.options.modelEvents.publish({event:"triptych-set-size",data:{size:300,side:"left"}});this.options.modelEvents.publish({event:"triptych-show-panel",data:"left"})}).bind(this),10)}return this.elements.container},destroy:function(){this.subcriptionHolder.destroy();this.options.cmdProxy.destroy();if(this._hookCleanup){this._hookCleanup()}try{this.elements.welcomePanel.destroy();delete this.elements.welcomePanel;this.elements.welcomePanel=null}catch(F){}if(this.elements.previousContent){this.elements.previousContent.destroy();delete this.elements.previousContent;this.elements.previousContent=null}if(this.elements.container.getParent()){this.elements.container.getParent().removeChild(this.elements.container)}delete this.elements.container;this.elements.container=null},_defaultWelcomePanel:function(K){var J=this;var M=J.options.modelEvents;var I={defaultActionId:null,activities:[]};J.options.defaultActionId=J.options.defaultActionId?J.options.defaultActionId:"previousContent";I.defaultActionId=J.options.defaultActionId;if(J.options.description){var L=J.options.description;var G={id:"appDescriptionRoot",actions:[{id:"appDescription",text:L,className:"lineBreak",}]};I.activities.push(G)}var F={section:{id:"newActivity",title:h.welcomePanel.newActivity,actions:[{id:"searchContent",title:h.welcomePanel.searchContent,icon:"search"}]}};I.activities.push(F);J.subcriptionHolder.subscribe({event:w.WELCOME+"action/searchContent"},function(){var O="";var N=z;if(J.options.customize&&J.options.customize.searchFilter){N=J.options.customize.searchFilter}J._launchSearch({title:h.welcomePanel.searchContent,showApplyButton:true,applyButton_Nls:h.welcomePanel.applyWithFilter,precondition:O,fts_value:N})});var H={section:{id:"contentSection",title:h.welcomePanel.content,actions:[{id:"previousContent",title:h.welcomePanel.previousContent,icon:"clock"},{id:"availableproducts",title:h.welcomePanel.availableproducts,icon:"product"},{id:"availablefilters",title:h.welcomePanel.availablefilters,icon:"filter"}]}};I.activities.push(H);J.subcriptionHolder.subscribe({event:w.WELCOME+"action/previousContent"},J._previousContent.bind(J));J.subcriptionHolder.subscribe({event:w.WELCOME+"action/availableproducts"},function(){var N=' (flattenedtaxonomies:"types/VPMReference" OR (flattenedtaxonomies:"types/VPMRepReference"))';J._launchSearch({title:h.welcomePanel.availableproducts,showApplyButton:true,applyButton_Nls:h.welcomePanel.applyWithFilter,precondition:N})});J.subcriptionHolder.subscribe({event:w.WELCOME+"action/availablefilters"},function(){var N=' (flattenedtaxonomies:"types/ENOStrRefinementSpecification")';J._launchSearch({precondition:N})});if(J.options.extraActivities){I.activities.push(J.options.extraActivities)}return I},_previousContent:function(){var F=this,G="previousContent";if(this.elements.loadauto){this.elements.loadauto.show()}if(this.elements.countResults){this.elements.countResults.hide()}if(this.elements.back2appDiv){this.elements.back2appDiv.show()}if(!F.elements.previousContent){F.elements.previousContent=new t({title:h.welcomePanel.previousContent,modelEvents:F.options.modelEvents,loadKey:G,toggleIcon:F.options.welcomePanelState==="opened"?"expand-left":"expand-right",defaultView:typeof F.options.defaultView==="undefined"?"largeTiles":F.options.defaultView});F.__addContentCB({loadKey:G})}F._updateStoredList({loadKey:G});F.options.modelEvents.publish({event:w.WELCOME_AND_SHELL+"setMainView",data:{html:F.elements.previousContent.render()}});if(this._previousContentSubscriptions){return}F.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/model/"+G+"/remove"},F._removeObjectFromStore.bind(F));F.subcriptionHolder.subscribe({event:w.CONTENT+"model/"+G+"/removeFromView"},F._removeObjectFromView.bind(F));this._previousContentSubscriptions=true},_removeObjectFromStore:function(O){var P=this;if(O.nodes2remove||O.item2remove){var F=[];if(O.nodes2remove){for(var S=0;S<O.nodes2remove.length;S++){var K=O.nodes2remove[S];if(K.options.item2Load){var Q=Object.getOwnPropertyNames(K.options.item2Load);for(var L=0;L<Q.length;L++){var J=Q[L];if(K.options.item2Load[Q[L]].associatedProduct){J=K.options.item2Load[Q[L]].associatedProduct}if(F.indexOf(J)===-1){F.push(J)}}}}}else{F=O.item2remove}var G=[];var R=P.options.storedObjects;var N,M,I=F.length;for(N=0;N<I;N++){if(R.products&&R.products.hasOwnProperty(F[N])){delete R.products[F[N]];G.push(F[N])}if(R.filters){var H=Object.getOwnPropertyNames(R.filters);for(M=0;M<H.length;M++){if(H[M]===F[N]||R.filters[H[M]].associatedProduct===F[N]){G.push(H[M]);delete R.filters[H[M]]}}}}if(G.length){P._updateStoredList({loadKey:"previousContent",removedFromViewIds:G,removeFromStore:true});if(O.dispatch!==false){P.__launchRemoveMdlEvts({item2remove:F,fromProxy:O.fromProxy,dispatch:O.dispatch})}}}},_removeObjectFromView:function(O){var Q=this;if(O.nodes2remove||O.item2remove){var F=[];if(O.nodes2remove){for(var T=0;T<O.nodes2remove.length;T++){var K=O.nodes2remove[T];var R=Object.getOwnPropertyNames(K.options.item2Load);for(var L=0;L<R.length;L++){var J=R[L];if(K.options.item2Load[R[L]].associatedProduct){J=K.options.item2Load[R[L]].associatedProduct}if(F.indexOf(J)===-1){F.push(J)}}}}else{F=O.item2remove}var G=[];var S=Q.options.storedObjects;var N,M,I=F.length;for(N=0;N<I;N++){var P=c(S,F[N]);if(P===true){G.push(F[N])}if(S.filters){var H=Object.getOwnPropertyNames(S.filters);for(M=0;M<H.length;M++){if(H[M]===F[N]||S.filters[H[M]].associatedProduct===F[N]){if(S.filters[H[M]].opened===true){G.push(H[M]);delete S.filters[H[M]].opened}}}}}if(G.length){Q._updateStoredList({loadKey:"previousContent",removedFromViewIds:G,removeFromView:true});if(O.dispatch!==false){Q.__launchRemoveFromViewMdlEvts({item2remove:F,fromProxy:O.fromProxy,dispatch:O.dispatch})}}}},_smartUpdateList:function(){if(this.options.storedObjects.hasUpdated){this.options.storedObjects.hasUpdated=false;this._updateStoredList({loadKey:"previousContent"})}else{var L=[];var G=this.elements.previousContent.options.model.getRoots();for(var I=0;I<G.length;I++){var F=G[I];var K=F.options.resourceid;var J=F.options.opened;var H=(F.options.grid&&F.options.grid["ds6w:type"]===k);if(H){F.options.opened=o(this.options.storedObjects,K)}else{F.options.opened=m(this.options.storedObjects,K)}if(J!==F.options.opened){L.push({resourceid:K,opened:F.options.opened})}}this.elements.previousContent._updatedObjectsInModel({objects:L})}},_updateStoredList:function(K){var J=this;if(K.removedFromViewIds&&K.removedFromViewIds.length){J.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+K.loadKey,data:{op:"remove",removedOjects:K.removedFromViewIds,removeFromView:K.removeFromView,removeFromStore:K.removeFromStore,cbEmptyView:J.__noResult.bind(J)}})}else{var L=this.options.storedObjects;delete L.hasUpdated;var G=f(L,K.removedFromViewIds);if(G.storedObjLst.length){J.options.modelEvents.publish({event:w.CONTENT+"model/"+K.loadKey,data:{op:"populate",objects:G.storedObjLst,allselected:true}});if(G.id2retrieve.length){var M={objectsLst:G,loadKey:K.loadKey};var I={success:false,retriedExceeded:false,retryCounter:0};var F=function(){var P=[];var O=UWA.clone(G.id2retrieve);for(var N=0;N<O.length;N++){P.push({resourceid:O[N],label:h.welcomePanel.notLoaded,subLabel:h.welcomePanel.notLoaded,icons:["attention"],thumbnail:j.getWebappsAssetUrl("PADServices","icons/32/I_Warn.png"),loading:false})}J.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+K.loadKey,data:{op:"update",objects:P,readOnlyApp:J.options.readOnlyApp}});e.displayNotif({level:"error",message:h.errors.cannotFetchAttributes,sticky:true})};var H=function(){b(M,J,L).then(function(N){I.success=true;J.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"})})["catch"](function(N){I.retryCounter++;if(I.retryCounter<C){H()}else{if(N&&N.errorCode==="resultNotFoundOnIndex"){e.displayNotif({level:"error",message:h.errors.objetNotFoundOnIndex,sticky:true});J.__launchRemoveMdlEvts({item2remove:G.id2retrieve});J.__noResult()}else{I.retriedExceeded=true;F()}}})};H()}}else{J.__noResult()}}},__noResult:function(){this.options.modelEvents.publish({event:w.CONTENT+"model/previousContent",data:{op:"noResult"}})},__addContentCB:function(G){var F=this;F.subcriptionHolder.subscribe({event:w.CONTENT+"toggleClicked"},function(H){if(F.options.mobileTriptych===true){if(F.options.welcomePanelState==="opened"){F.options.welcomePanelState="reduced"}else{if(F.options.welcomePanelState==="reduced"){F.options.welcomePanelState="opened"}}F.options.modelEvents.publish({event:"triptych-toggle-panel",data:"left"})}else{if(F.options.welcomePanelState==="opened"){F.options.welcomePanelState="reduced";F.options.modelEvents.publish({event:"welcome-panel-collapse"})}else{if(F.options.welcomePanelState==="reduced"){F.options.welcomePanelState="opened";F.options.modelEvents.publish({event:"welcome-panel-expand"})}}}});F.subcriptionHolder.subscribe({event:"welcome-panel-collapse"},function(){F.options.modelEvents.publish({event:"triptych-set-size",data:{size:40,side:"left"}});F.options.modelEvents.publish({event:"triptych-show-panel",data:"left"});F.options.modelEvents.publish({event:w.CONTENT+"toggleIcon",data:{iconName:"expand-right",fontIconFamily:WUXManagedFontIcons.Font3DS}})});F.subcriptionHolder.subscribe({event:"welcome-panel-expand"},function(){F.options.modelEvents.publish({event:"triptych-set-size",data:{size:300,side:"left"}});F.options.modelEvents.publish({event:"triptych-show-panel",data:"left"});F.options.modelEvents.publish({event:w.CONTENT+"toggleIcon",data:{iconName:"expand-left",fontIconFamily:WUXManagedFontIcons.Font3DS}})});F.subcriptionHolder.subscribe({event:"triptych-entering-mobile"},function(){F.options.mobileTriptych=true;F.options.modelEvents.publish({event:"welcome-panel-expand"})});F.subcriptionHolder.subscribe({event:"triptych-leaving-mobile"},function(){F.options.mobileTriptych=false;F.options.welcomePanelState="reduced";F.options.modelEvents.publish({event:"welcome-panel-collapse"})});F.subcriptionHolder.subscribe({event:"triptych-panel-hidden"},function(H){if(H==="left"&&F.options.mobileTriptych===true){F.options.modelEvents.publish({event:w.CONTENT+"toggleIcon",data:{iconName:"expand-right",fontIconFamily:WUXManagedFontIcons.Font3DS}})}});F.subcriptionHolder.subscribe({event:w.CONTENT+"closeLandingPage"},function(){F.options.modelEvents.publish({event:w.WELCOME+"closeLandingPage"})});F.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/searchContent"},function(){var I="";var H=z;if(F.options.customize&&F.options.customize.searchFilter){H=F.options.customize.searchFilter}F._launchSearch({title:h.welcomePanel.searchContent,showApplyButton:true,applyButton_Nls:h.welcomePanel.applyWithFilter,precondition:I,fts_value:H})});F.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/searchInRecent"},function(I){var H={pids:I.unknownIds,enopad_webapis:true,data:{authored:true,select_predicate:["ds6w:label","ds6w:description","ds6w:type","ds6w:responsible","ds6w:identifier","ds6w:modified"],select_file:["icon","thumbnail_2d"],intent:"explore_2D"}};x.fetch(H).then(function(L){var O=[];if(L.results){for(var K=0;K<L.results.length;K++){var J=L.results[K];var N=i.parseAttributes(J.attributes);if(N.grid){var M=new Date(N.grid["ds6w:modified"]).toLocaleString(e.getLang());N.subLabel=N.grid["ds6w:responsible"]+" | "+M;N.description=N.grid["ds6w:identifier"]+" \u25ba "+h.welcomePanel.notFoundOnIndex}N.loading=undefined;O.push(N)}}F.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+G.loadKey,data:{op:"update",objects:O,readOnlyApp:F.options.readOnlyApp,fromDB:true}})})})},__setDnDBehavior:function(){this.elements.container.addEventListener("dragenter",this.__onDragEnter.bind(this));this.elements.container.addEventListener("dragover",this.__onDragOver.bind(this));this.elements.container.addEventListener("dragleave",this.__onDragLeave.bind(this));this.elements.container.addEventListener("dragend",this.__onDragEnd.bind(this));this.elements.container.addEventListener("drop",this.__onDrop.bind(this));var G=e.isWebInWinContext()?"-dropAreaWebInWin":"-dropArea";var H=this.elements.droparea=UWA.createElement("div",{"class":this.getClassNames(G)}).inject(this.elements.container);H.hide();var J=[{id:"addInCtx",icon:"drag-drop",title:h.welcomePanel.addObjectInCtx},{id:"addObject",icon:"drag-drop",title:h.welcomePanel.addObject},{id:"filter",icon:"filter",title:h.welcomePanel.filter}];for(var F=0;F<J.length;F++){var K=UWA.createElement("div",{"class":this.getClassNames("-dropZone "+J[F].id),draggable:false});var I=UWA.createElement("div",{"class":this.getClassNames("-dropIconAndText "+J[F].id)}).inject(K);UWA.createElement("i",{"class":this.getClassNames("_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-"+J[F].icon)}).inject(I);UWA.createElement("h5",{"class":this.getClassNames("_txt "+J[F].id),text:J[F].title}).inject(I);K.inject(H)}},__onDragEnter:function(F){var G=B.firstParentWithClass(F.target,"enx-welcome-panel-dropZone");if(A.count===0){this.elements.triptych.style.opacity="0.2";this.elements.droparea.show()}else{if(G&&A.actual!==G){if(A.actual){A.actual.classList.remove("zoneHighlighted")}G.classList.add("zoneHighlighted");A.actual=G}}A.count++;F.stopPropagation();return false},__onDragOver:function(F){var G=B.firstParentWithClass(F.target,"enx-welcome-panel-dropZone");if(G){F.preventDefault()}F.stopPropagation();return false},__onDragLeave:function(F){A.count--;if(A.count===0){this.elements.droparea.hide();this.elements.triptych.style.opacity="1"}if(F.target===A.actual){A.actual.classList.remove("zoneHighlighted");A.actual=null}F.stopPropagation();return false},__onDragEnd:function(F){A.count=0;if(A.actual){A.actual.classList.remove("zoneHighlighted");A.actual=null}this.elements.droparea.hide();this.elements.triptych.style.opacity="1";F.stopPropagation();return false},__onDrop:function(F){var H="WITH_CONTEXT";if(A.actual){if(A.actual.classList.contains("addObject")){H="WITHOUT_CONTEXT"}else{if(A.actual.classList.contains("filter")){H="FILTER"}}A.actual.classList.remove("zoneHighlighted");A.actual=null}A.count=0;this.elements.droparea.hide();this.elements.triptych.style.opacity="1";F.preventDefault();F.stopPropagation();var G={mode:"drop",behavior:H,unserializedData:e.deserializeDroppedData(F)};this.__launchOpenMdlEvts(G);return false},_launchSearch:function(I){var G=this;var F=function(Q,J){var L={mode:"welcome",products:{},filters:{},unserializedData:{}};var M={items:[]};if(Q.length>0){var K=[];for(var P=0;P<Q.length;P++){var N=Q[P]["ds6w:type_value"]?Q[P]["ds6w:type_value"]:Q[P]["ds6w:type"];var O={resourceid:Q[P].resourceid,label:Q[P]["ds6w:label"],grid:{"ds6w:type":N},};O.item2Load={};O.item2Load[Q[P].resourceid]={};K.push(new u(O));var R={};R.objectId=Q[P].resourceid;R.objectType=N;R.displayName=Q[P]["ds6w:label"];R.displayType=Q[P]["ds6w:type"];R.serviceId="3DSpace";M.items.push(R)}for(var P=0;P<K.length;P++){if(K[P].getAttributeValue("ds6w:type")==="ENOStrRefinementSpecification"){L.filters=UWA.extend(L.filters,K[P].options.item2Load)}else{L.products=UWA.extend(L.products,K[P].options.item2Load)}}L.unserializedData.protocol="3DXContent";L.unserializedData.data=M;L.withFilter=J;G.__launchOpenMdlEvts(L)}return L};var H=function(J){if(J){G.options.storedObjects=UWA.merge(G.options.storedObjects,J)}G.elements.welcomePanel.setAction("previousContent")};if(typeof I.precondition!=="undefined"){require(["DS/PADUtils/PADUtilsServices"],function(J){var K={parent_window:G.options.odtSpecificParentWindow,title:I.title,precond:I.precondition,fts_value:I.fts_value,showApplyButton:I.showApplyButton,applyButton_Nls:I.applyButton_Nls,callback:function(M){var L=F(M);H(L)},apply:function(M){var L=F(M,true);H(L)},cancel:H};J.in_apps_search(K)})}},__setupCrossWidgetCommunication:function(){var F=this;return new g(function(G){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADUtilsServices"],function(H,I){F.options.cmdProxy=H.create({events:{onLoadStoredObj:function(K,J){l.hide();if(J.originWidgetId!==I.getWidgetId()){K.fromProxy=true;if(F.options.appReady===false){F.options.openStack.openContent=K;E.mask(F.elements.container,h.welcomePanel.appLoading)}else{F.options.modelEvents.publish({event:"ENXViews/WelcomePanel/openContent",data:K})}}},onRemoveStoredObj:function(K,J){l.hide();if(J.originWidgetId!==I.getWidgetId()){K.fromProxy=true;if(F.options.appReady===false){F.options.openStack.removeContent=K;E.mask(F.elements.container,h.welcomePanel.appLoading)}else{F._removeObjectFromStore(K)}}},onRemoveObjFromView:function(K,J){l.hide();if(J.originWidgetId!==I.getWidgetId()){K.fromProxy=true;F._removeObjectFromView(K)}},onAppProxyReady:function(K,J){if(J.originWidgetId!==I.getWidgetId()){F.options.proxyReady=true;if(F.options.handshakeDone!==true||K.wpUUID!==F.options.wpuuid){F.options.handshakeDone=true;F.options.cmdProxy.appProxyReady({wpUUID:F.options.wpuuid})}if(F.options.openStack.openProxy!==null){F.options.cmdProxy.loadStoredObj(F.options.openStack.openProxy);F.options.openStack.openProxy=null}if(F.options.openStack.removeProxy!==null){F.options.cmdProxy.removeStoredObj(F.options.openStack.removeProxy);F.options.openStack.removeProxy=null}}}}});F.options.cmdProxy.appProxyReady({wpUUID:F.options.wpuuid});G()})})},__launchOpenMdlEvts:function(F){l.hide();if(this.options.appReady===false){this.options.openStack.openContent=F;E.mask(this.elements.container,h.welcomePanel.appLoading)}else{this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/openContent",data:F});if(this.options.cmdProxy&&F.fromProxy!==true){if(this.options.proxyReady===false){this.options.openStack.openProxy=F}else{this.options.cmdProxy.loadStoredObj(F)}}}},__launchRemoveMdlEvts:function(F){l.hide();var G=this;if(this.options.appReady===false){this.options.openStack.removeContent=F;E.mask(this.elements.container,h.welcomePanel.appLoading)}else{G.options.modelEvents.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:F});if(this.options.cmdProxy&&F.fromProxy!==true){if(this.options.proxyReady===false){this.options.openStack.removeProxy=F}else{this.options.cmdProxy.removeStoredObj(F)}}}},__launchRemoveFromViewMdlEvts:function(F){l.hide();var G=this;G.options.modelEvents.publish({event:"ENXViews/WelcomePanel/removeFromView",data:F});if(this.options.cmdProxy&&F.fromProxy!==true){if(F.dispatch){this.options.cmdProxy.removeObjFromView(F)}}},__launchAction:function(G){l.hide();var F=this;require(["DS/ApplicationFrame/CommandsManager"],function(H){var I=H.getCommand(G.command);if(I){if(G.unselectBeforeLaunch===true){F.options.modelEvents.publish({event:"ENXViews/WelcomePanel/unselectAllInModel"})}I.begin();F.options.modelEvents.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})}})}});return v});define("DS/PADServices/views/LandingPage",["DS/PADServices/views/ENXWelcomePanel","UWA/Class/Promise","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/SubscriptionHolder","DS/PADServices/utils/GlobalUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/PADServices/assets/nls/PADServices.json"],function(h,g,i,a,f,b,c){function e(k){var j=false;if(UWA.is(k,"boolean")){j=k}else{if(UWA.is(k,"string")){j=k.toLowerCase()==="true"}}return j}function d(j){j=j||{};this.options=UWA.extend({widget:null,welcome:null,viewer:null,injectedView:null,onLandingPageReady:null,readOnlyApp:true,renderDiv:null,subscriptions:[],ready:{viewerReady:false,appReady:false}},j,true)}d.prototype={initialize:function(){var j=this;return new g(function(k){require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(m,l){l.setSetting("lang",j.options.widget.lang);m.app_initialization(function(){j._globalSubscriptionHolder=new a(i.getModelEvents());var n=j.options.widget.getValue("xsceneStoredObjects");if(f.getURLParameter("cleanSetting")==="xsceneStoredObjects"){j.options.widget.deleteValue("xsceneStoredObjects");n={products:{},filters:{}}}else{if(UWA.is(n,"string")){n=JSON.parse(n)}else{n={products:{},filters:{}}}}var o=e(j.options.widget.getValue("autoreload"));var q=undefined;var p={odtSpecificParentWindow:j.options.odtSpecificParentWindow,modelEvents:i.getModelEvents(),storedObjects:n,description:j.options.description,readOnlyApp:j.options.readOnlyApp};if(j.options.activities){p.activities=j.options.activities}if(j.options.extraActivities){p.extraActivities=j.options.extraActivities}if(j.options.customHandlerClass){j._customHandler=new j.options.customHandlerClass({loadingNls:c.welcomePanel.loading,loadingIcon:b.getWebappsAssetUrl("PADServices","icons/32/loading.gif")});j.__customizeSetup()}if(j.options.customOpenControllerClass){p.customOpenControllerClass=j.options.customOpenControllerClass}if(j.options.customize){p.customize=UWA.clone(j.options.customize)}j.options.welcome=new h(p);j.options.welcome.initialize().then(function(){if(j.options.onLandingPageReady){j.options.onLandingPageReady.call(null,n)}if(o===false){j.__switchView("welcome")}var r=i.subscribe({event:"ENXViews/WelcomePanel/appReady"},function(){i.unsubscribe(r);if(j.options.onReady){j.options.onReady()}})});if(o){q=n}k(q)})})})},setViewer:function(j){this.options.viewer=j;this.__3DCBSetUp()},render:function(){return this.options.welcome.render()},redraw:function(){this.options.welcome.render()},appReady:function(){this._setupReady("appReady")},destroy:function(){this._globalSubscriptionHolder.destroy();if(this._viewerSubscriptionHolder){this._viewerSubscriptionHolder.destroy()}if(this.options.viewer){this.options.viewer.destroy();this.options.viewer=null}if(this.options.welcome){this.options.welcome.destroy();this.options.welcome=null}},__switchView:function(j){if(j!==this.options.injectedView){if(j==="viewer"&&this.options.viewer){this.options.renderDiv.empty();this.options.viewer.render().inject(this.options.renderDiv);this.options.injectedView="viewer";if(this.options.viewer.elements.borderedLayout){this.options.viewer.elements.borderedLayout.show()}}else{if(j==="welcome"){this.options.renderDiv.empty();this.options.welcome.render().inject(this.options.renderDiv);this.options.injectedView="welcome";if(this.options.viewer&&this.options.viewer.elements.borderedLayout){this.options.viewer.elements.borderedLayout.hide()}}}}},__3DCBSetUp:function(){var j=this;var k=j.options.viewer.subscribe({event:"onReady"},function(l){j.options.viewer.unsubscribe(k);if(l.injectInView===true){j.__switchView("viewer")}j._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/openContent"},function(m){j.__switchView("viewer");switch(m.mode){case"welcome":j.options.viewer.openStoredObjects(m);break;case"drop":j.options.viewer.openDroppedObjects(m).then(function(n){if(n&&n.error){j.__switchView("welcome")}});break;default:console.error("Unknown mode ["+m.mode+"]");j.__switchView("welcome");break}});j._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/removeFromStored"},function(s){if(s.item2remove){var y=s.item2remove;var x=j.options.widget.getValue("xsceneStoredObjects");if(x==="null"){x=null}if(UWA.is(x,"string")){var u=j.options.viewer.getController();x=JSON.parse(x);var t,q,n=y.length;var p=false,r=[],v=[];for(t=0;t<n;t++){if(x.products&&x.products.hasOwnProperty(y[t])){var o=u.getNode({id:y[t]});if(o){v.push(y[t])}r.push(y[t]);delete x.products[y[t]];j.options.welcome.options.storedObjects.hasUpdated=true;p=true}if(x.filters){var m=Object.getOwnPropertyNames(x.filters);for(q=0;q<m.length;q++){if(m[q]===y[t]){r.push(m[q]);v.push(x.filters[m[q]].associatedProduct);delete x.filters[m[q]];p=true}else{if(x.filters[m[q]].associatedProduct===y[t]){var o=u.getNode({id:y[t]});if(o){v.push(y[t])}r.push(m[q]);delete x.filters[m[q]];p=true}}}}}if(v.length){u.removeRoots({pids:v},false)}if(p){j.options.widget.setValue("xsceneStoredObjects",JSON.stringify(x));i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:r}})}if(j._customHandler){var w=j._customHandler.removeFromStore(j.options.widget,s.item2remove);if(w){i.publish({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"})}}}}});j._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/activate"},function(){i.publish({event:"ENXViews/WelcomePanel/refreshView"});j.__switchView("welcome")});j._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/closeLandingPage"},function(){j.__switchView("viewer")});j._controllerSubscriptionHolder=new a(j.options.viewer.getController().getModelEvents());j._controllerSubscriptionHolder.subscribe({event:"onFilterApplied"},function(q){var s=j._getStoredStruct();for(var p=0;p<q.filter.objects.length;p++){var r=q.filter.objects[p];var o=r.filterId;var n=r.path[0];var m={filters:{}};if(!s.filters){s.filters={}}s.filters[o]={associatedProduct:n};m.filters[o]={associatedProduct:n};i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:m}})}j.options.widget.setValue("xsceneStoredObjects",JSON.stringify(s))});j._controllerSubscriptionHolder.subscribe({event:"onEmptyView"},function(m){j.__switchView("welcome")});j._setupReady("viewerReady")});j.__hookRemoveFromView();j._viewerSubscriptionHolder=new a(this.options.viewer.getModelEvents());j._viewerSubscriptionHolder.subscribe({event:"onApplyFilterBegin"},function(){j.applyFilterProcessed=true;j.currentView=j.options.injectedView});j._viewerSubscriptionHolder.subscribe({event:"onApplyFilterEnd"},function(){delete j.applyFilterProcessed;if(j.options.injectedView!==undefined&&j.currentView!==j.options.injectedView){j.__switchView(j.currentView);delete j.currentView}});j._viewerSubscriptionHolder.subscribe({event:"onRootAdded"},function(q){if(q.rootLog){var p=j.options.widget.getValue("xsceneStoredObjects");if(p==="null"){p=null}if(!UWA.is(p)){p={products:{},filters:{}}}else{p=JSON.parse(p)}if(q.filterId){var m={filters:{}};m.filters[q.filterId]={associatedProduct:q.id};p=UWA.extend(p,m,true);i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:m}})}else{var n=p.products;var l=0;var o=q.idPath.length;for(l=0;l<o;l++){if(!n.hasOwnProperty(q.idPath[l])){n[q.idPath[l]]={}}n=n[q.idPath[l]]}i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:[q.idPath]}})}j.options.widget.setValue("xsceneStoredObjects",JSON.stringify(p));if(j.options.injectedView!=="viewer"){j.__switchView("viewer")}}j.options.viewer.getContentName({callbacks:{onComplete:function(r){j.options.widget.setTitle(r.contentName)}}})});j._viewerSubscriptionHolder.subscribe({event:"onLoadingFailure"},function(){var l=j.options.viewer.getController();if(l.getNbRoots()===0){i.publish({event:"ENXViews/WelcomePanel/refreshView"});j.__switchView("welcome")}});j._viewerSubscriptionHolder.subscribe({event:"onRefreshBegin"},function(l){j._during3Drefresh=true});j._viewerSubscriptionHolder.subscribe({event:"onRefreshCompleted"},function(l){j._during3Drefresh=false});j._viewerSubscriptionHolder.subscribe({event:"onEndRootRemoved"},function(o){if(j._during3Drefresh){return}if(o.ids&&o.ids.length){var u=o.ids;var p=[];var t=j.options.widget.getValue("xsceneStoredObjects");if(t==="null"){t=null}if(UWA.is(t,"string")){t=JSON.parse(t);var q,n,l=u.length;for(q=0;q<l;q++){if(t.products&&t.products.hasOwnProperty(u[q])){delete t.products[u[q]];p.push(u[q])}if(t.filters){var m=Object.getOwnPropertyNames(t.filters);for(n=0;n<m.length;n++){var s;if(t.filters[m[n]].associatedProduct===u[q]){s=u[q]}else{if(m[n]===u[q]){s=t.filters[m[n]].associatedProduct}}if(s){delete t.filters[m[n]];p.push(m[n])}}}}if(p.length>0){i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:p,dispatch:o.dispatch}})}}var r=j.options.viewer.getController();if(r.getNbRoots()===0&&j.applyFilterProcessed!==true){i.publish({event:"ENXViews/WelcomePanel/refreshView"});j.__switchView("welcome")}j.options.viewer.getContentName({callbacks:{onComplete:function(v){j.options.widget.setTitle(v.contentName)}}})}})},__hookRemoveFromView:function(){var j=this;j._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/removeFromView"},function(q){var l=j.options.viewer.getController();var p=[];for(var m=0;m<q.item2remove.length;m++){var o=q.item2remove[m];var n=l.getNode({id:o});if(n){p.push(o)}}if(p.length){l.removeRoots({pids:p},false)}if(j._customHandler){var k=j._customHandler.removeFromStore(j.options.widget,q.item2remove);if(k){i.publish({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"})}}})},__customizeSetup:function(){var j=this;if(j._customHandler){var k=function(){var n=i.getModelEvents();var m=j._getStoredStruct();var l=j._customHandler.populate(m);l.then(function(o){if(o.length){n.publish({event:"ENXViews/ContentChooser/model/previousContent",data:{op:"populateAppend",objects:o,allselected:true}})}var p=j._customHandler.update(m);p.then(function(q){n.publish({event:"ENXViews/ContentChooser/model/previousContent",data:{op:"update",objects:q,allselected:true,fromCustom:true}})})})};j._globalSubscriptionHolder.subscribe({event:"/ENXViews/WelcomePanel/action/previousContent/"},k);j._globalSubscriptionHolder.subscribe({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"},function(){i.publish({event:"/ENXViews/WelcomePanel/action/previousContent/"})})}},_getStoredStruct:function(){var j=this.options.widget.getValue("xsceneStoredObjects");if(UWA.is(j,"string")){j=JSON.parse(j)}else{j={products:{},filters:{}}}return j},_setupReady:function(m){this.options.ready[m]=true;var l=Object.keys(this.options.ready),k=true;for(var j=0;j<l.length&&k;j++){if(this.options.ready[l[j]]===false){k=false}}if(k===true){i.publish({event:"ENXViews/WelcomePanel/appReady"})}}};return d});