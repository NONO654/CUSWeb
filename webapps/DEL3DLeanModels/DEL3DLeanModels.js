define("DS/DEL3DLeanModels/AModel.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","UWA/Core","DS/Logger/Logger","DS/DEL3DLeanHttpRequest/HttpRequest","DS/DEL3DLeanEnums/AttributeMap.enum"],function(l,j,e,c,k,d){var b=j.Model.extend({_logger:null,name:"AModel",__name__:"AModel",idAttribute:"physicalid",headerParameters:{},urlParameters:{},constructor:function a(){b.__super__.constructor.apply(this,arguments);this._logger=c.getLogger(b)},initialize:function f(){},callParent:function i(o,n,m){m=m||[];if(typeof o==="object"&&typeof n==="string"&&l.isFunction(o[n])){o[n].apply(this,m)}},save:function g(n,m){m=l.defaults(m||(m={}),{patch:true});b.__super__.save.call(this,n,m)},sync:function h(v,p,q){l.defaults(q||(q={}),{emulateHTTP:j.emulateHTTP,emulateJSON:j.emulateJSON});if(q.noRequest===true){return}var s=null;var r=null;var u=null;var n=null;var m=null;s={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};r=s[v];if(!q.url){u=l.result(p,"url")||j.urlError()}if(!q.data&&p){n=q.attrs||p.toJSON(q);var t=null;for(t in n){var o=d.getTypeAttribute(this.serverType,t);if(e.is(o)&&o!==t){n[o]=n[t];delete n[t]}}n.singleUpdate="true";n=JSON.stringify(n)}m={data:n,type:r,error:q.error,success:q.success,urlParameters:q.urlParameters,headerParameters:q.headerParameters};p.attributes.syncTimestamp=Date.now();k.request(u,m);p.trigger("request",p,undefined,q)}});return b});define("DS/DEL3DLeanModels/SketchUtils/TouchStore",["UWA/Core","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette"],function(c,b){var a=b.Object.extend({constructor:function a(){this.touches=[]},add:function(d){this.touches.push(d)},indexOf:function(f){var d=-1;for(var e=0;e<this.touches.length;e++){if(this.touches[e].id===f){d=e;break}}return d},get:function(d){return this.touches[this.indexOf(d)]},pop:function(j){var h=Array.isArray(j)?j:[j];var f=0;var d=[];var g=0;var e=null;for(g=0;g<h.length;g++){f=this.indexOf(h[g]);if(f>=0){e=this.touches.splice(f,1);d=d.concat(e)}}return d},exists:function(d){return this.touches.some(function(e){return e.id===d})},isEmpty:function(){return this.touches<=0}});return a});define("DS/DEL3DLeanModels/SketchUtils/ColorConverter",["UWA/Core","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette"],function(f,e){var d;var b={ERROR:0,HEX:1,HEXSTRING:2,RGB:3};var a=e.Object.extend({constructor:function a(){e.Object.prototype.constructor.apply(this,arguments)},toHex:function(i,k){k=k||this._getFormat(i);var h=-1;switch(k.format){case b.HEX:h=i;break;case b.HEXSTRING:h=parseInt(i.substring(1),16);break;case b.RGB:var j=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/gm;var g=j.exec(i);h=g[1]<<16+g[2]<<8+g[3];break;default:break}return h},toHexString:function(i,k){k=k||this._getFormat(i);var h="#000000";switch(k.format){case b.HEX:h="#"+i.toString(16);break;case b.HEXSTRING:h=i;break;case b.RGB:var j=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/gm;var g=j.exec(i);h="#"+Number(g[1]).toString(16)+Number(g[2]).toString(16)+Number(g[3]).toString(16);break;default:break}return h},toRGBString:function(j,m){m=m||this._getFormat(j);var l=0;var k=0;var i=0;var h="rgb(0,0,0)";switch(m.format){case b.HEX:l=j>>16;k=(j&65280)>>8;i=j&255;h="rgb("+l+", "+k+", "+i+")";break;case b.HEXSTRING:h=this.toRGBString(this.toHex(j,m),{format:b.HEX,channels:m.channels});break;case b.RGB:h=j;break;default:break}return h},readRGB:function(i,l){l=l||this._getFormat(i);var h={};switch(l.format){case b.HEX:h.r=i>>16;h.g=(i&65280)>>8;h.b=i&255;break;case b.HEXSTRING:var j=this.toHex(i,l);h=this.readRGB(j,{format:b.HEX,channels:l.channels});break;case b.RGB:var k=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/gm;var g=k.exec(i);h.r=Number(g[1]);h.g=Number(g[2]);h.b=Number(g[3]);break;default:break}return h},writeRGB:function(j){var i=null;var l=this._toHexString(j.r);var k=this._toHexString(j.g);var h=this._toHexString(j.b);i="#"+l+k+h;return i},_toHexString:function(h){var g=h.toString(16);if(g.length<2){g="0"+g}return g},_getFormat:function(h){var i=b.ERROR;var g=3;if(f.is(h,"string")){if(h[0]==="#"){i=b.HEXSTRING;g=(h.length-1)/2}else{if(h.substring(0,3)==="rgb"){i=b.RGB;if(h[3]==="a"){g=4}}}}else{if(f.is(h,"number")){i=b.HEX;g=h.toString(16).length/2}}return{format:i,channels:g}}});function c(){if(!f.is(d)){d=new a()}return d}return c()});define("DS/DEL3DLeanModels/SketchUtils/Point",["UWA/Core","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette"],function(c,b){var a=b.Object.extend({x:0,y:0,constructor:function a(d,e){this.x=Number(d)||0;this.y=Number(e)||0},distanceTo:function(d){var f=this.x-d.x;var e=this.y-d.y;return Math.sqrt((f*f)+(e*e))},getSquaredLength:function(){return this.x*this.x+this.y*this.y},getLength:function(){return Math.sqrt(this.getSquaredLength())},clone:function(){return new a(this.x,this.y)},equals:function(d){return this.x===d.x&&this.y===d.y},negate:function(){return new a(-this.x,-this.y)},right:function(){return new a(this.y,-this.x)},left:function(){return new a(-this.y,this.x)},normalize:function(e){if(e===undefined){e=1}var f=this.getLength(),g=f!==0?e/f:0,d=new a(this.x*g,this.y*g);return d},substract:function(d){return new a(this.x-d.x,this.y-d.y)},multiply:function(d){if(c.is(d,"number")){d={x:d,y:d}}return new a(this.x*d.x,this.y*d.y)},divide:function(d){if(c.is(d,"number")){d={x:d,y:d}}return new a(this.x/d.x,this.y/d.y)},modulo:function(d){return new a(this.x%d.x,this.y%d.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},add:function(d){return new a(this.x+d.x,this.y+d.y)},minus:function(d){return new a(this.x-d.x,this.y-d.y)},dot:function(d){return((this.x*d.x)+(this.y*d.y))},cross:function(d){return this.x*d.y-this.y*d.x},isZero:function(){return this.x===0&&this.y===0},project:function(d){var e=d.isZero()?0:this.dot(d)/d.dot(d);return new a(d.x*e,d.y*e)},getDistance:function(f,g){var e=f.x-this.x;var i=f.y-this.y;var h=e*e+i*i;return g?h:Math.sqrt(h)},toBytes:function(d,h){d=d||this.x;h=h||this.y;var e=this.valueToBytes(d);var f=this.valueToBytes(h);var g=new Uint16Array(2);g[0]=e;g[1]=f;return g},fromBytes:function(e,f){e=e||this.x;f=f||this.y;var d=this.bytesToValue(e);var g=this.bytesToValue(f);this.x=d;this.y=g;return this},valueToBytes:function(d){var e=d.toFixed(1).split(".");var f=Number(e[0]);f=f<<2;var g=Number(e[1]);g=~~(g/3);f+=g;return f},bytesToValue:function(f){var e=f&3;e*=3;var d=f>>2;d+=e/10;return Number(d)},toSigned:function(d,e){this.x=this.Int16(d);this.y=this.Int16(e);return this},UInt16:function(d){return(d&65535)},Int16:function(d){return(d>32767)?d-65536:d}});return a});define("DS/DEL3DLeanModels/documents/Document.model",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/AModel.model"],function(e,a,d){var c=d.extend({urlRoot:"/resources/enocsmrest/session/",name:"DocumentModel",__name__:"DocumentModel",constructor:function b(){c.__super__.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/documents/Session.model",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/AModel.model"],function(f,a,e){var d=e.extend({urlRoot:"/resources/enocsmrest/session/",name:"SessionModel",__name__:"SessionModel",_sessionManager:null,defaults:{csrftoken:"",isadmin:false,isinnovation:false,actions:[]},headerParameters:function(){return{"Content-Type":"application/json"}},urlParameters:function(){return{tenant:widget.getValue("PlatformID"),embed:"people"}},idAttribute:"csrftoken",constructor:function c(){d.__super__.constructor.apply(this,arguments)},parse:function b(n){var m=f.is(n,"string")?JSON.parse(n):n;var o=Object.keys(m);var l=0;var k=null;var j=null;var h={};for(l=0;l<o.length;l++){k=o[l];j=k.split(".");var g=a.last(j);h[g]=m[k]}return h},sync:function(h,i,g){d.__super__.sync.call(this,h,i,a.extend(g,{headerParameters:a.result(this,"headerParameters"),urlParameters:a.result(this,"urlParameters")}))}});return d});define("DS/DEL3DLeanModels/AElement.model",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","UWA/Core","DS/Logger/Logger","DS/DEL3DLeanModels/AModel.model","DS/DEL3DLeanHttpRequest/HttpRequest","DS/DEL3DLeanHttpRequest/MessageHandler","DS/DEL3DLeanResources/ResourcesManager","DS/DocumentManagement/DocumentManagement","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanEnums/AttributeMap.enum"],function(F,X,r,e,c,q,K,E,B,O,S,C){var L={MODEL:1,DATA:2,DOCUMENT:3};var w=q.extend({name:"AElementModel",serverType:null,__name__:"AElementModel",extendDefaults:{V_DEL3DL_Data:"{}"},extendDocAttributes:{},docAttributes:undefined,extendJsonAttributes:["V_DEL3DL_Data"],jsonAttributes:undefined,liveChannel:r.channel("live"),extendUrlRoot:"/resources/modeler/3dlean/models/",constructor:function i(){this._logger=c.getLogger(w);this._attributesModified={};this.enableLiveSend(true);this.onLiveUpdateDelegate=F.proxy(this.onLiveUpdate,this);this.onLiveDeleteDelegate=F.proxy(this.onLiveDelete,this);if(!e.is(this.docAttributes)){this.docAttributes=this.computeDocAttributes()}if(!e.is(this.jsonAttributes)){this.jsonAttributes=this.computeJsonAttributes()}w.__super__.constructor.apply(this,arguments)},onDestroy:function H(){this.enableLive(false)},urlRoot:function T(){var Z=null;var Y=null;Z=X.result(this.constructor.__super__,"urlRoot","");Y=X.result(this,"extendUrlRoot","");return Z+Y},defaults:function(){var Z=null;var aa=null;var Y=null;Z=X.result(this.constructor.__super__,"defaults",{V_DEL3DL_Data_Version:this.getDataMigrationVersion()});aa=X.result(this,"extendDefaults",{});Y=X.extend(Z,aa);return Y},computeDocAttributes:function(){var Z=null;var aa=null;var Y=null;Z=X.result(this.constructor.__super__,"computeDocAttributes",{});aa=X.result(this,"extendDocAttributes",{});Y=X.extend(Z,aa);return Y},computeJsonAttributes:function(){var aa=null;var Y=null;var Z=null;aa=X.result(this.constructor.__super__,"computeJsonAttributes",[]);Y=X.result(this,"extendJsonAttributes",[]);Z=X.union(aa,Y);return Z},initialize:function g(){w.__super__.initialize.apply(this);this.enableLive(true)},jsonData:function D(){var Y=w.__super__.get.call(this,"V_DEL3DL_Data")||"{}";Y=Y.replace(new RegExp("^V_DEL3DL_Data|DEL3DL_Abstract_Element.V_DEL3DL_Data"),"")||"{}";try{Y=JSON.parse(Y)}catch(Z){Y={}}Y=Y||{};return Y},computeData:function P(aa,Z){var Y=this.jsonData();Z=Z||X.extend;Z(Y,aa);return Y},setData:function v(aa,Z){var Y=JSON.stringify(this.computeData(aa));w.__super__.set.call(this,"V_DEL3DL_Data",Y,Z);this._addModifiedAttribute("V_DEL3DL_Data",Y)},getData:function u(Z){var Y=undefined;var aa=this.jsonData();if(aa.hasOwnProperty(Z)){Y=aa[Z]}return Y},setDocuments:function o(Z){if(Object.keys(Z).length>0){var ab=undefined;var ac=function(){delete this._attributesModified[ab]};for(ab in Z){this._addModifiedAttribute(ab,Z[ab]);var Y=this.docAttributes[ab];var aa={title:S.generateFileName(B.getTranslation(ab)),type:ab};S.setImage(Z[ab],Y,aa).then(ac)}}},getDocument:function V(Z){var Y=undefined;if(this.docAttributes.hasOwnProperty(Z)){Y=S.getImageFromCache(this.docAttributes[Z])}return Y},set:function y(aj,aa,al){var ac={};var ai={};var af={};var ab={};var ad=this.isNew();var ah=undefined;if(typeof aj==="object"){ac=aj;al=aa}else{ac[aj]=aa}al=al||{};var ae={};for(var Y in ac){if(Y==="V_DEL3DL_Data"&&al.unset!==true){try{ab=JSON.parse(ac[Y])}catch(ag){this._logger.error('JSON parse failed on "V_DEL3DL_Data"');this._logger.error(ag);ab={}}}else{if(this.isDocumentAttribute(Y)){ai[Y]=ac[Y]}else{if(this.isDataAttribute(Y)){af[Y]=ac[Y]}else{ae[Y]=ac[Y];this._addModifiedAttribute(Y,ac[Y],al)}}}}this.setDocuments(ai);af=X.extend(af,ab);if(!X.isEmpty(af)){var Z=this.jsonData();for(ah in Z){if(Z[ah]===af[ah]){delete af[ah]}}ab=this.computeData(af);if(al.unset===true){al.unset=false;for(ah in af){if(ab.hasOwnProperty(ah)){delete ab[ah]}}}ab=JSON.stringify(ab);ae.V_DEL3DL_Data=ab;this._addModifiedAttribute("V_DEL3DL_Data",ab)}var ak=w.__super__.set.call(this,ae,al);if(al.silent!==true){for(ah in af){this.trigger("change:"+ah,this,af[ah])}}if(ad!==this.isNew()&&!this.isNew()){this._attributesModified={};this.enableLive(true);this._migrateAndSaveData();if(this._enableLiveSend===true&&al.doNotSend!==true&&this.serverType!=="DEL3DL_Session"){E.send({eventType:"model:creation",attributes:this.attributes,serverType:this.serverType})}}return ak},get:function R(ab,Z){var aa=undefined;Z=Z||{};if(this.isInModel(ab)){aa=w.__super__.get.call(this,ab)}else{if(this.isDocumentAttribute(ab)){aa=this.getDocument(ab)}else{if(this.isInData(ab)){aa=this.getData(ab)}}}if(!e.is(aa)||aa==="null"){aa=undefined}else{if(Z.doNotParse!==true&&this.isJsonAttribute(ab)&&typeof aa==="string"){try{aa=JSON.parse(aa)}catch(Y){this._logger.error('JSON parse failed on "'+ab+'"');this._logger.error(Y);aa=undefined}}}return aa},clear:function J(Y){var Z=X.mapObject(this.attributes,function(){return undefined});w.__super__.clear.call(this,Y);Z=X.defaults(Z,X.result(this,"defaults"));var aa=w.__super__.set.call(this,Z,Y);this._attributesModified={};return aa},parse:function s(ae){var ad=e.is(ae,"string")?JSON.parse(ae):ae;var af=Object.keys(ad);var ac=0;var ab=null;var aa=null;var Z={};for(ac=0;ac<af.length;ac++){ab=af[ac];aa=ab.split(".");var Y=X.last(aa);Z[Y]=ad[ab]}return Z},save:function t(ab,Z){Z=Z||{};if(!ab){var Y=this.isNew()||this.name==="ActionLogModel"||this.name==="IssueLogModel";if(Y){ab=this.attributes}else{ab=this.changesNotSaved()}}else{this.set(ab,Z);ab=this.changesNotSaved()}var aa=Z.success;Z.success=function(ad,ac){this._attributesModified={};if(e.is(aa,"function")){aa(ad,ac)}}.bind(this);if(this._enableLiveSend===true&&!this.isNew()){E.send({pid:this.get("physicalid"),eventType:"model:update",attributes:ab})}w.__super__.save.call(this,ab,Z)},sync:function n(Z,aa,Y){w.__super__.sync.call(this,Z,aa,Y);if(this._enableLiveSend===true&&Z==="delete"){E.send({pid:this.get("physicalid"),eventType:"model:delete"})}},changesNotSaved:function p(){return this._attributesModified},hasChangesNotSaved:function m(){return(e.is(this._attributesModified)&&Object.keys(this._attributesModified).length>0)},retrieveDocuments:function I(){var Z=F.proxy(function(){},this);var Y=F.proxy(function(){},this);if(Object.keys(this.docAttributes).length>0){O.getDocumentsFromParent({relInfo:{parentId:this.get("physicalid")},onComplete:Z,onFailure:Y})}},getDataMigrationVersion:function(){var Y=0;while(e.is(this["_dataMigrationV"+(Y+1)])){Y++}return Y},getAttributeType:function z(Y){if(this.isDocumentAttribute(Y)){return L.DOCUMENT}else{if(this.isDataAttribute(Y)){return L.DATA}else{return L.MODEL}}},isInModel:function x(Y){return e.is(this.attributes)&&this.attributes.hasOwnProperty(Y)},isInData:function Q(Y){return this.jsonData().hasOwnProperty(Y)},isInMap:function b(Y){return e.is(C.getTypeAttribute(this.serverType,Y))},isModelAttribute:function A(Y){return this.isInModel(Y)||this.isInMap(Y)},isDocumentAttribute:function W(Y){return this.docAttributes.hasOwnProperty(Y)},isDataAttribute:function M(Y){return Y!=="V_DEL3DL_Data"&&Y.indexOf("V_DEL3DL_")===0&&!this.isModelAttribute(Y)||this.isInData(Y)},isJsonAttribute:function k(Y){return this.jsonAttributes.indexOf(Y)>=0},enableLive:function l(Y){if(this.has("physicalid")){if(Y){this.liveChannel.on(this.get("physicalid")+":model:update",this.onLiveUpdateDelegate);this.liveChannel.on(this.get("physicalid")+":model:delete",this.onLiveDeleteDelegate)}else{this.liveChannel.off(this.get("physicalid")+":model:update",this.onLiveUpdateDelegate);this.liveChannel.off(this.get("physicalid")+":model:delete",this.onLiveDeleteDelegate)}}},enableLiveSend:function j(Y){this._enableLiveSend=Y},onLiveUpdate:function G(Y){if(e.is(Y)&&e.is(Y.attributes)){this.set(Y.attributes)}},onLiveDelete:function a(){this.enableLive(false);this.destroy({noRequest:true})},_addModifiedAttribute:function U(aa,Y,Z){Z=Z||{};if(Z.noChange!==true&&this.get(aa,{doNotParse:true})!==Y){this._attributesModified[aa]=Y}},_dataNormalization:function N(){},_dataMigration:function f(){var aa=this;var Z=e.Promise.deferred();var Y=this.get("V_DEL3DL_Data_Version");Y=isNaN(Y)?0:Y;this._dataMigrationVersion(Y).then(function(ab){aa.set("V_DEL3DL_Data_Version",ab);Z.resolve();aa._dataNormalization()});return Z.promise},_dataMigrationVersion:function d(ab,Y){var aa=this;if(!e.is(Y)){Y=e.Promise.deferred()}if(e.is(this["_dataMigrationV"+ab])){var Z=this["_dataMigrationV"+ab]();if(e.is(Z)&&e.is(Z.then)){Z.then(function(){aa._dataMigrationVersion(ab+1,Y)})}else{aa._dataMigrationVersion(ab+1,Y)}}else{Y.resolve(ab>0?ab-1:0)}return Y.promise},_migrateAndSaveData:function h(){var aa=this;var Z=e.Promise.deferred();var Y=function(){aa._dataNormalization();if(!aa.isNew()&&aa.hasChangesNotSaved()){aa.save()}};this._dataMigration().then(function(){Y();Z.resolve()},function(){Y();Z.reject()});return Z.promise}});return w});define("DS/DEL3DLeanModels/SketchUtils/BezierPoint",["pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanModels/SketchUtils/Point"],function(c,a){var b=c.Object.extend({point:null,handleIn:null,handleOut:null,constructor:function b(d,e,f){this.point=d||new a(0,0);this.handleIn=e||new a(0,0);this.handleOut=f||new a(0,0)},clone:function(){return new b(this.point,this.handleIn,this.handleOut)},setHandleOut:function(d){this.handleOut=d},multiply:function(d){return new b(this.point.multiply(d),this.handleIn.multiply(d),this.handleOut.multiply(d))},serialize:function(e,j){var d=2;var g=3*d;if(!e){g-=d}if(!j){g-=d}var h=new Uint16Array(g);var f=0;if(e){h.set(this.handleIn.toBytes(),f);f+=d}h.set(this.point.toBytes(),f);f+=d;if(j){h.set(this.handleOut.toBytes(),f)}return h}});return b});define("DS/DEL3DLeanModels/ALinkable.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/AElement.model"],function(c,b){var a=b.extend({extendUrlRoot:"",name:"ALinkableModel",__name__:"AElementModel",constructor:function d(){b.prototype.constructor.apply(this,arguments)}});return a});define("DS/DEL3DLeanModels/statics/AStatic.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/ALinkable.model"],function(c,d){var b=d.extend({extendUrlRoot:"",name:"AStaticModel",__name__:"AStaticModel",constructor:function a(){d.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanModels/statics/Page.model",["DS/DEL3DLeanModels/statics/AStatic.model"],function(c){var b=c.extend({extendUrlRoot:"page/",name:"PageModel",serverType:"DEL3DL_Page",__name__:"PageModel",constructor:function a(){c.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanModels/statics/Session.model",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","UWA/Promise","DS/Logger/Logger","DS/DEL3DLeanModels/statics/AStatic.model","DS/DEL3DLeanHttpRequest/HttpRequest"],function(e,i,g,b,c,h){var a=c.extend({extendUrlRoot:"session/",name:"SessionModel",serverType:"DEL3DL_Session",__name__:"SessionModel",extendJsonAttributes:["V_DEL3DL_Team"],_logger:null,_actionLogPid:null,_actionLogPidPromise:null,_issueLogPid:null,_issueLogPidPromise:null,constructor:function d(){a.__super__.constructor.apply(this,arguments)},initialize:function(j,k){a.__super__.initialize.call(this,j,k);if(!e.is(this._logger)){this._logger=b.getLogger(a)}},getActionLogPid:function(){if(this._actionLogPid){return g.cast(this._actionLogPid)}else{if(this._actionLogPidPromise){return this._actionLogPidPromise}}var j=g.deferred();this._actionLogPidPromise=j.promise;h.request("/resources/modeler/3dlean/api/getsessionactionlog",{type:"POST",data:JSON.stringify({session:this.id}),context:this,success:function(k){k=k||"{}";k=JSON.parse(k);this._actionLogPid=k.actionlog;j.resolve(this._actionLogPid)},error:function(k){this._logger.error(k);j.reject(k)}});return j.promise},getIssueLogPid:function(){if(this._issueLogPid){return g.cast(this._issueLogPid)}else{if(this._issueLogPidPromise){return this._issueLogPidPromise}}var j=g.deferred();this._issueLogPidPromise=j.promise;h.request("/resources/modeler/3dlean/api/getsessionissuelog",{type:"POST",data:JSON.stringify({session:this.id}),context:this,success:function(k){k=k||"{}";k=JSON.parse(k);this._issueLogPid=k.issuelog;j.resolve(this._issueLogPid)},error:function(k){this._logger.error(k);j.reject(k)}});return j.promise},_dataMigrationV0:function(){this.callParent(a.__super__,"_dataMigrationV0");if(this.has("V_DEL3DL_Data")){var j=this.get("V_DEL3DL_Data");if(e.is(j.V_DEL3DL_Data)||typeof j==="string"){if(e.is(j.V_DEL3DL_Data)){delete j.V_DEL3DL_Data}else{j={}}this.set("V_DEL3DL_Data",JSON.stringify(j))}}if(this.has("team")){this.set("V_DEL3DL_Team",this.get("team"));this.unset("team")}},_dataMigrationV1:function f(){this.callParent(a.__super__,"_dataMigrationV1")}});return a});define("DS/DEL3DLeanModels/leangets/ALeanget.model",["DS/DEL3DLeanModels/statics/AStatic.model"],function(b){var c=b.extend({extendUrlRoot:"leangets/",name:"ALeangetModel",__name__:"ALeangetModel",constructor:function a(){b.prototype.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/leangets/EHSCross.model",["DS/DEL3DLeanModels/leangets/ALeanget.model"],function(a){var c=a.extend({extendUrlRoot:"ehscross/",name:"EHSCrossModel",serverType:"DEL3DL_EHS_Cross",__name__:"EHSCrossModel",constructor:function b(){a.prototype.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/leangets/IssueLog.model",["UWA/Core","DS/DEL3DLeanModels/leangets/ALeanget.model"],function(e,b){var a=undefined;var d=b.extend({extendUrlRoot:"issuelog/",name:"IssueLogModel",serverType:"DEL3DL_Issue_Log",__name__:"IssueLogModel",extendDefaults:{},constructor:function c(){if(e.is(a)){return a}d.__super__.constructor.apply(this,arguments);a=this}});return d});define("DS/DEL3DLeanModels/leangets/Safety.model",["DS/DEL3DLeanModels/leangets/ALeanget.model"],function(a){var c=a.extend({extendUrlRoot:"safety/",name:"SafetyModel",serverType:"DEL3DL_Safety",__name__:"SafetyModel",constructor:function b(){a.prototype.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/leangets/FollowUp.model",["DS/DEL3DLeanModels/leangets/ALeanget.model"],function(a){var b=a.extend({extendUrlRoot:"followup/",name:"FollowUpModel",serverType:"DEL3DL_5S_FollowUp",__name__:"FollowUpModel",constructor:function c(){a.prototype.constructor.apply(this,arguments)}});return b});define("DS/DEL3DLeanModels/leangets/KPI.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/leangets/ALeanget.model"],function(f,b){var h=b.extend({extendUrlRoot:"kpi/",name:"KPIModel",serverType:"DEL3DL_KPI",__name__:"KPIModel",extendDefaults:{V_DEL3DL_Y_Axis_Title:"",V_DEL3DL_X_Axis_Title:"",V_DEL3DL_Y_Axis_Min:0,V_DEL3DL_Y_Axis_Max:100,V_DEL3DL_Target:50,V_DEL3DL_Work_Week:[1,2,3,4,5,6,0],V_DEL3DL_Above_Color:"rgba(0, 0, 0, 0)",V_DEL3DL_Below_Color:"rgba(0, 0, 0, 0)",V_DEL3DL_Round_Value:0},extendJsonAttributes:["V_DEL3DL_Work_Week"],constructor:function d(){h.__super__.constructor.apply(this,arguments)},initialize:function a(){h.__super__.initialize.apply(this)},_dataMigrationV0:function e(){this.callParent(h.__super__,"_dataMigrationV0");if(this.has("snap")){this.unset("snap")}if(this.has("graphicTitle")){this.unset("graphicTitle")}if(this.has("xAxisTitle")){this.set("V_DEL3DL_X_Axis_Title",this.get("xAxisTitle"));this.unset("xAxisTitle")}if(this.has("yAxisTitle")){this.set("V_DEL3DL_Y_Axis_Title",this.get("yAxisTitle"));this.unset("yAxisTitle")}if(this.has("yAxisMin")){this.set("V_DEL3DL_Y_Axis_Min",this.get("yAxisMin"));this.unset("yAxisMin")}if(this.has("yAxisMax")){this.set("V_DEL3DL_Y_Axis_Max",this.get("yAxisMax"));this.unset("yAxisMax")}if(this.has("objective")){this.set("V_DEL3DL_Target",this.get("objective"));this.unset("objective")}if(this.has("snapprecision")){this.set("V_DEL3DL_Round_Value",this.get("snapprecision"));this.unset("snapprecision")}if(this.has("workingweek")){this.set("V_DEL3DL_Work_Week",this.get("workingweek"));this.unset("workingweek")}if(this.has("objectiveAfter")){this.set("V_DEL3DL_Above_Color",this.get("objectiveAfter"));this.unset("objectiveAfter")}if(this.has("objectiveBefore")){this.set("V_DEL3DL_Below_Color",this.get("objectiveBefore"));this.unset("objectiveBefore")}if(this.has("graphData")){this.set("V_DEL3DL_Graph_Data",this.get("graphData"));this.unset("graphData")}if(this.has("graphExtremes")){this.set("V_DEL3DL_Graph_Extremes",this.get("graphExtremes"));this.unset("graphExtremes")}},_dataMigrationV1:function c(){this.callParent(h.__super__,"_dataMigrationV1")},_dataNormalization:function g(){h.__super__._dataNormalization.call(this);var k=undefined;var l=["V_DEL3DL_Y_Axis_Min","V_DEL3DL_Y_Axis_Max","V_DEL3DL_Target","V_DEL3DL_Round_Value"];for(var j=0;j<l.length;j++){k=this.get(l[j]);if(typeof k==="string"){this.set(l[j],Number(k))}}}});return h});define("DS/DEL3DLeanModels/floatables/AFloatable.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/ALinkable.model"],function(c,d){var f=d.extend({extendUrlRoot:"",name:"AFloatableModel",__name__:"AFloatableModel",constructor:function e(){d.prototype.constructor.apply(this,arguments)},isNote:function(){return this.name==="StickyNoteModel"&&this.get("V_DEL3DL_Category")==="NOTE"},isAction:function(){return this.name==="StickyNoteModel"&&this.get("V_DEL3DL_Category")==="ACTION"},isIssue:function(){return this.name==="StickyNoteModel"&&this.get("V_DEL3DL_Category")==="ISSUE"},_dataMigrationV0:function b(){this.callParent(f.__super__,"_dataMigrationV0");if(this.has("documentId")){this.set("V_DEL3DL_Document_PID",this.get("documentId"));this.unset("documentId")}if(this.has("fileId")){this.unset("fileId")}if(this.has("peopleName")){this.set("V_DEL3DL_People_Name",this.get("peopleName"));this.unset("peopleName")}},_dataMigrationV1:function a(){this.callParent(f.__super__,"_dataMigrationV1")}});return f});define("DS/DEL3DLeanModels/floatables/StickyMember.model",["DS/DEL3DLeanModels/floatables/AFloatable.model"],function(b){var a=b.extend({extendUrlRoot:"stickymember/",name:"StickyMemberModel",serverType:"DEL3DL_Sticky_Member",__name__:"StickyMemberModel",constructor:function c(){b.prototype.constructor.apply(this,arguments)}});return a});define("DS/DEL3DLeanModels/floatables/Sticker.model",["DS/DEL3DLeanModels/floatables/AFloatable.model"],function(a){var c=a.extend({extendUrlRoot:"sticker/",name:"StickerModel",serverType:"DEL3DL_Sticker",__name__:"StickerModel",constructor:function b(){a.prototype.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/floatables/StickyNote.model",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/floatables/AFloatable.model","DS/DEL3DLeanHttpRequest/ImageService","UWA/Core"],function(k,u,q,r,l){var t=q.extend({extendUrlRoot:"stickynote/",name:"StickyNoteModel",serverType:"DEL3DL_Sticky_Note",__name__:"StickyNoteModel",extendDefaults:{V_DEL3DL_Sketch_Image:null,V_DEL3DL_Category:"NOTE",V_DEL3DL_Background_Color:"#F8F7B6"},constructor:function c(){t.__super__.constructor.apply(this,arguments)},initialize:function b(){t.__super__.initialize.apply(this)},isEditable:function m(){if(this.isAction()){return !this.isDone()&&this.isOurTeamAssigned()}else{if(this.isIssue()){return !this.isDone()}}return true},isDeletable:function d(){if(this.isAction()){return this.isDone()||this.isOurTeamAssigned()}else{if(this.isIssue()){return true}}return true},isParking:function i(){if(this.isIssue()){return this.get("V_DEL3DL_IssueLogZone")==="ilParking"}return this.get("V_DEL3DL_ActionLogZone")==="alParking"},isDone:function p(){if(this.isIssue()){return this.get("V_DEL3DL_IssueLogZone")==="ilIssueClosed"}return this.get("V_DEL3DL_ActionLogZone")==="alDone"},isOurTeamOwner:function a(){var w=this.get("owner");var v=l.getGlobal().leanSessionManager.getSessionName();return(!l.is(w)||w.length<=0||w===v)},isOurTeamAssigned:function n(){var w=this.get("V_DEL3DL_AssignedTeamName");var v=l.getGlobal().leanSessionManager.getSessionName();return(!l.is(w)||w.length<=0||w===v)},isShared:function o(){var v=this.get("V_DEL3DL_AssignedTeamName");var w=this.get("owner");return v!==w},assignSticker:function s(v){this.save({V_DEL3DL_Document_PID:v})},assignPeople:function j(A,z,w){var B=l.is(A)?z.PEOPLES.sessionInstance.getOrFetch({name:A}):null;var v=l.is(B)?B.get("name"):null;var y=this.get("V_DEL3DL_AssignedPersonName");var x=z.PEOPLES.sessionInstance.getOrFetch({name:y});if(y!==v){if(this.isAction()){w.updateAssignee(this,B,x)}else{this.save({V_DEL3DL_AssignedPersonName:v})}}},_dataMigrationV0:function h(){this.callParent(t.__super__,"_dataMigrationV0");var z=this;var F=l.Promise.deferred();var v=[];var x=this.get("V_DEL3DL_Sketch_Image");if(l.is(x)&&this._isPID(x)){v.push(r.getImage(x).then(k.proxy(function(G){this.set("V_DEL3DL_Sketch_Image",G)},this)))}var D=this.get("V_DEL3DL_Background_Color");if(l.is(D)&&!/^#?[a-f0-9]+$/i.test(D)){D=D.replace(/^(url\(){0,1}(.*)(\))*$/,"$2");v.push(r.setImage(D).then(k.proxy(function(G){this.set("V_DEL3DL_Background_Color",G)},this)))}if(this.has("assignedPeopleName")){this.set("V_DEL3DL_AssignedPersonName",this.get("assignedPeopleName"));this.unset("assignedPeopleName")}if(this.has("assignedPeoplePID")){var y=this.get("assignedPeoplePID");if(this._isPID(y)){var E=l.getGlobal();var B=E.leanSessionManager.getAllPeoples();var C=undefined;var A=l.Promise.deferred();v.push(A.promise);var w=function(){z.set("V_DEL3DL_AssignedPersonName",C.get("name"));z.unset("assignedPeoplePID");A.resolve()};C=B.getOrFetch(y,{success:w,error:function(){z._logger.warn("getOrFetch in _dataMigration of assignedPeoplePID failed");A.reject()}})}else{this.set("V_DEL3DL_AssignedPersonName",y);this.unset("assignedPeoplePID")}}Promise.all(v).then(k.proxy(function(){F.resolve()},this),F.reject);return F.promise},_dataMigrationV1:function g(){this.callParent(t.__super__,"_dataMigrationV1");if(this.has("V_DEL3DL_Description")&&this.get("V_DEL3DL_Description").length>0){this.set("V_DEL3DL_Sketch_Image","data:image/svg+xml;base64,")}},_dataMigrationV2:function f(){this.callParent(t.__super__,"_dataMigrationV2")},_isPID:function e(v){return/^[0-9a-fA-F]{32}$/i.test(v)}});return t});define("DS/DEL3DLeanModels/floatables/IssueNoteModel",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/floatables/StickyNote.model"],function(d,e){var f=e.extend({extendUrlRoot:"",extendDefaults:{V_DEL3DL_IssueLogZone:"ilParking"},constructor:function a(){f.__super__.constructor.apply(this,arguments)},_dataMigrationV0:function c(){this.callParent(f.__super__,"_dataMigrationV0");if(this.has("issueLogZone")){this.set("V_DEL3DL_IssueLogZone",this.get("issueLogZone"));this.unset("issueLogZone")}},_dataMigrationV1:function b(){this.callParent(f.__super__,"_dataMigrationV1")}});return f});define("DS/DEL3DLeanModels/floatables/NoteModel",["DS/DEL3DLeanModels/floatables/StickyNote.model"],function(a){var c=a.extend({extendUrlRoot:"",constructor:function b(){a.prototype.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/SketchUtils/BezierCurve",["UWA/Core","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanModels/SketchUtils/BezierPoint","DS/DEL3DLeanModels/SketchUtils/Point"],function(f,e,a,d,c){var b=e.Object.extend({points:[],_logger:null,constructor:function b(g){this.points=g||[];this._logger=a.getLogger(b)},encode:function(){var h=this.serialize();var g=String.fromCharCode.apply(null,h);return g},decode:function(j){var h=j.length;var k=new Uint16Array(h);var g=0;for(g=0;g<h;g++){k[g]=j.charCodeAt(g)}return this.deserialize(k)},size:function(g){g=g||this.points.length;return(g*3*2)-4},serialize:function(o,h){var l=f.is(o)&&f.is(h)?this.points.slice(o,h):this.points;var m=l.length;var n=new Uint16Array(this.size(m));var k=0;var g=3*2;n.set(l[0].serialize(false,true),k);k+=2*2;for(var j=1;j<m-1;j++,k+=g){n.set(l[j].serialize(true,true),k)}n.set(l[m-1].serialize(true,false),k);return n},deserialize:function(n){if(!f.is(n,"typedarray")&&!f.is(n,"array")){this._logger.warn("Corrupted bezier curve data, unable to deserialize");return this}var m=n.length;if(m<8){this._logger.warn("Corrupted bezier curve data, length to short : "+m);return this}this.points=[];var h=3*2;var j=null;var o=new c();var g=new c();g.fromBytes(n[0],n[1]);o.toSigned(n[2],n[3]).fromBytes();var k=new d(g,null,o);this.points.push(k);var l=4;for(l=4;l<m-4;l+=h){j=new c();g=new c();o=new c();j.toSigned(n[l],n[l+1]).fromBytes();g.fromBytes(n[l+2],n[l+3]);o.toSigned(n[l+4],n[l+5]).fromBytes();k=new d(g,j,o);this.points.push(k)}j=new c();g=new c();j.toSigned(n[l],n[l+1]).fromBytes();g.fromBytes(n[l+2],n[l+3]);k=new d(g,j,null);this.points.push(k);return this}});return b});define("DS/DEL3DLeanModels/leangets/AWebBase.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/leangets/ALeanget.model"],function(f,b){var g=b.extend({extendUrlRoot:"",name:"AWebBaseModel",__name__:"AWebBaseModel",extendDefaults:{V_DEL3DL_Url:""},constructor:function a(){g.__super__.constructor.apply(this,arguments)},hasUrl:function d(){return this.has("V_DEL3DL_Url")&&this.get("V_DEL3DL_Url").length>0},_dataMigrationV0:function e(){this.callParent(g.__super__,"_dataMigrationV0");if(this.has("url")){this.set("V_DEL3DL_Url",this.get("url"));this.unset("url")}},_dataMigrationV1:function c(){this.callParent(g.__super__,"_dataMigrationV1")}});return g});define("DS/DEL3DLeanModels/leangets/WebViewer.model",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","DS/DEL3DLeanModels/leangets/AWebBase.model"],function(i,d,c){var a=c.extend({extendUrlRoot:"webviewer/",name:"WebViewerModel",serverType:"DEL3DL_Web_Viewer",__name__:"WebViewerModel",extendDefaults:{V_DEL3DL_Zoom:1},constructor:function b(){a.__super__.constructor.apply(this,arguments)},initialize:function e(){a.__super__.initialize.call(this)},_dataMigrationV0:function g(){this.callParent(a.__super__,"_dataMigrationV0");if(this.has("isdocument")){this.unset("isdocument")}if(this.has("zoom")){this.set("V_DEL3DL_Zoom",this.get("zoom"));this.unset("zoom")}},_dataMigrationV1:function f(){this.callParent(a.__super__,"_dataMigrationV1")},_dataNormalization:function h(){a.__super__._dataNormalization.call(this);var k=undefined;var l=["V_DEL3DL_Zoom"];for(var j=0;j<l.length;j++){k=this.get(l[j]);if(typeof k==="string"){this.set(l[j],Number(k))}}}});return a});define("DS/DEL3DLeanModels/leangets/Player.model",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","DS/DEL3DLeanModels/leangets/AWebBase.model"],function(c,b){var e=b.extend({extendUrlRoot:"tipOfTheDay/",name:"PlayerModel",serverType:"DEL3DL_Tip_Of_The_Day",__name__:"PlayerModel",constructor:function d(){e.__super__.constructor.apply(this,arguments)},initialize:function a(){e.__super__.initialize.call(this)}});return e});define("DS/DEL3DLeanModels/relations/Coord.model",["DS/DEL3DLeanModels/AElement.model"],function(a){var d=a.extend({extendUrlRoot:"coord/",extendDefaults:{V_DEL3DL_X:0,V_DEL3DL_Y:0,V_DEL3DL_Size_X:1,V_DEL3DL_Size_Y:1,V_DEL3DL_Angle:0},extendJsonAttributes:[],name:"CoordModel",serverType:"DEL3DL_Coord",__name__:"CoordModel",constructor:function b(){a.prototype.constructor.apply(this,arguments)},_dataNormalization:function c(){d.__super__._dataNormalization.call(this);var f=undefined;var g=["V_DEL3DL_X","V_DEL3DL_Y","V_DEL3DL_Size_X","V_DEL3DL_Size_Y","V_DEL3DL_Angle"];for(var e=0;e<g.length;e++){f=this.get(g[e]);if(typeof f==="string"){this.set(g[e],Number.parseFloat(f))}}}});return d});define("DS/DEL3DLeanModels/leangets/ActionLog.model",["UWA/Core","DS/DEL3DLeanModels/leangets/ALeanget.model"],function(e,b){var a=undefined;var c=b.extend({extendUrlRoot:"actionlog/",name:"ActionLogModel",serverType:"DEL3DL_Action_Log",__name__:"ActionLogModel",constructor:function d(){if(e.is(a)){return a}b.prototype.constructor.apply(this,arguments);a=this}});return c});define("DS/DEL3DLeanModels/floatables/TaskNoteModel",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/floatables/StickyNote.model","UWA/Class/Promise","DS/DEL3DLeanHttpRequest/HttpRequest","DS/DEL3DLeanModels/leangets/ActionLog.model"],function(d,c,j,b,h,i,f){var a=b.extend({extendUrlRoot:"",extendDefaults:{V_DEL3DL_ActionLogZone:"alParking"},constructor:function k(){b.prototype.constructor.apply(this,arguments)},_dataMigrationV0:function g(){var n=this;var m=c.Promise.deferred();var p=[];this.callParent(a.__super__,"_dataMigrationV0");var l=c.getGlobal();if(c.is(l)&&c.is(l.leanSessionManager)){if(this.has("originSessionId")){this.unset("originSessionId")}if(!this.has("V_DEL3DL_AssignedTeamName")){var o=new f();var q=l.leanSessionManager.getAllRelations().findWhere({from:o.get("physicalid"),to:this.get("physicalid")});if(c.is(q)&&q.has("readonly")){this.set("V_DEL3DL_AssignedTeamName","DATA_MIGRATION")}else{if(this.has("currentSessionId")){if(!this._isPID(this.get("currentSessionId"))){this.set("V_DEL3DL_AssignedTeamName",this.get("currentSessionId"));this.unset("currentSessionId")}else{p.push(this.getOwnerFromSessionPID(this.get("currentSessionId")).then(function(r){n.set("V_DEL3DL_AssignedTeamName",r.owner);n.unset("currentSessionId")}))}}else{this.set("V_DEL3DL_AssignedTeamName",this.get("owner"))}}}if(this.has("actionLogZone")){this.set("V_DEL3DL_ActionLogZone",this.get("actionLogZone"));this.unset("actionLogZone")}}h.all(p).then(function(){m.resolve()},function(){m.reject()});return m.promise},_dataMigrationV1:function e(){this.callParent(a.__super__,"_dataMigrationV1")},getOwnerFromSessionPID:function(l){var m=h.deferred();i.request("/resources/modeler/3dlean/api/getsessioninfos",{type:"POST",data:JSON.stringify({sessionid:l}),context:this,success:function(n){n=n||"{}";n=JSON.parse(n);m.resolve(n)},error:function(n){this._logger.error(n);m.reject(n)}});return m.promise},hasTask:function(){var m=c.getGlobal();var l=m.leanSessionManager;var n=l.getCollectionManager();return n.getTasksRelationsFrom(this.get("physicalid")).length>0}});return a});define("DS/DEL3DLeanModels/SketchUtils/Simplifier",["pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanModels/SketchUtils/Point","DS/DEL3DLeanModels/SketchUtils/BezierPoint"],function(d,b,c){var a=d.Object.extend({points:null,constructor:function a(e){this.points=e.points},fit:function(e){var g=this.points;var h=g.length;var f=null;if(h>0){f=[new c(g[0])];if(h>1){this.fitCubic(f,e,0,h-1,g[1].substract(g[0]),g[h-2].substract(g[h-1]))}}return f},fitCubic:function(q,r,e,l,g,f){var s=this.points;if(l-e===1){var k=s[e],j=s[l],o=k.getDistance(j)/3;this.addCurve(q,[k,k.add(g.normalize(o)),j.add(f.normalize(o)),j]);return}var u=this.chordLengthParameterize(e,l),w=Math.max(r,r*r),p,h=true;for(var v=0;v<=4;v++){var n=this.generateBezier(e,l,u,g,f);var t=this.findMaxError(e,l,n,u);if(t.error<r&&h){this.addCurve(q,n);return}p=t.index;if(t.error>=w){break}h=this.reparameterize(e,l,u,n);w=t.error}var m=s[p-1].substract(s[p+1]);this.fitCubic(q,r,e,p,g,m);this.fitCubic(q,r,p,l,m.negate(),f)},chordLengthParameterize:function(j,h){var f=[0];var e,g;for(g=j+1;g<=h;g++){f[g-j]=f[g-j-1]+this.points[g].getDistance(this.points[g-1])}for(g=1,e=h-j;g<=e;g++){f[g]/=f[e]}return f},generateBezier:function(o,w,y,S,R){var K=1e-12,E=Math.abs,H=this.points,G=H[o],F=H[w],s=[[0,0],[0,0]],g=[0,0];for(var P=0,O=w-o+1;P<O;P++){var I=y[P],J=1-I,Q=3*I*J,B=J*J*J,A=Q*J,z=Q*I,x=I*I*I,N=S.normalize(A),L=R.normalize(z),M=H[o+P].substract(G.multiply(B+A)).substract(F.multiply(z+x));s[0][0]+=N.dot(N);s[0][1]+=N.dot(L);s[1][0]=s[0][1];s[1][1]+=L.dot(L);g[0]+=N.dot(M);g[1]+=L.dot(M)}var k=s[0][0]*s[1][1]-s[1][0]*s[0][1],q,p;if(E(k)>K){var n=s[0][0]*g[1]-s[1][0]*g[0],f=g[0]*s[1][1]-g[1]*s[0][1];q=f/k;p=n/k}else{var j=s[0][0]+s[0][1],h=s[1][0]+s[1][1];q=p=E(j)>K?g[0]/j:E(h)>K?g[1]/h:0}var e=F.getDistance(G),D=K*e,v,r;if(q<D||p<D){q=p=e/3}else{var m=F.substract(G);v=S.normalize(q);r=R.normalize(p);if(v.dot(m)-r.dot(m)>e*e){q=p=e/3;v=r=null}}return[G,G.add(v||S.normalize(q)),F.add(r||R.normalize(p)),F]},findMaxError:function(g,n,e,o){var k=Math.floor((n-g+1)/2),j=0;for(var f=g+1;f<n;f++){var h=this.evaluate(3,e,o[f-g]);var m=h.substract(this.points[f]);var l=m.x*m.x+m.y*m.y;if(l>=j){j=l;k=f}}return{error:j,index:k}},evaluate:function(k,l,h){var g=l.slice();for(var f=1;f<=k;f++){for(var e=0;e<=k-f;e++){g[e]=g[e].multiply(1-h).add(g[e+1].multiply(h))}}return g[0]},reparameterize:function(k,h,f,j){var g,e;for(g=k;g<=h;g++){f[g-k]=this.findRoot(j,this.points[g],f[g-k])}for(g=1,e=f.length;g<e;g++){if(f[g]<=f[g-1]){return false}}return true},findRoot:function(e,l,o){var m=[],k=[],f=0,p,n,j,h,g;for(f=0;f<=2;f++){m[f]=e[f+1].substract(e[f]).multiply(3)}for(f=0;f<=1;f++){k[f]=m[f+1].substract(m[f]).multiply(2)}p=this.evaluate(3,e,o);n=this.evaluate(2,m,o);j=this.evaluate(1,k,o);h=p.substract(l);g=n.dot(n)+h.dot(j);return g===0?o:o-h.dot(n)/g},addCurve:function(e,g){var f=e[e.length-1];f.setHandleOut(g[1].substract(g[0]));e.push(new c(g[3],g[2].substract(g[3])))}});return a});define("DS/DEL3DLeanModels/documents/CollaborativeSpace.model",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","DS/Logger/Logger","UWA/Class/Promise","DS/DEL3DLeanModels/AElement.model","DS/DocumentManagement/DocumentManagement","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanHttpRequest/HttpRequest"],function(f,d,m,l,a,h,g,j,i,b,k){var o=g.extend({urlRoot:"/resources/enocsmrest/collabspaces",name:"CollaborativeSpaceModel",__name__:"CollaborativeSpaceModel",serverType:"PnOProject",_logger:null,_contentCache:null,_membersCache:null,_contentPromise:null,_membersPromise:null,idAttribute:"title",defaults:{actions:[],contexts:[{name:"",ocdx:"",organisation:"",role:""}],created:"",description:"",family:{name:"",value:""},name:"",owner:{fname:"",lname:"",name:"",employment:"",login:"",createcs:false,picture:""},solution:"",thumbnail:"",title:"",visibility:{name:"",value:""}},headerParameters:function(){var p=d.getGlobal();return{"Content-Type":"application/json","X-DS-CSRFTOKEN":p.sessionToken}},urlParameters:function(){return{tenant:widget.getValue("PlatformID"),embed:"people"}},isNew:function(){var p=this.get("created");if(!p){return true}return p.length<=0},constructor:function c(){o.__super__.constructor.apply(this,arguments);this.enableLiveSend(false)},initialize:function e(){o.__super__.initialize.call(this);this._logger=a.getLogger(o)},listContent:function n(p){var s="/resources/enocsmrest/collabspaces/"+this.get("title")+"/contents/";var u=this;var r=h.deferred();var q=null;var t=null;if(d.is(this._contentCache)){r.resolve(this._contentCache);return r.promise}if(d.is(this._contentPromise)){return this._contentPromise}if(m.isEmpty(this.get("title"))){this._logger.warn("Empty title for collab space. Cannot get content");r.reject(b.getTranslation("ERR0x00000611"))}else{this._contentPromise=r.promise;k.request(s,{success:function(w){w=JSON.parse(w);q=w.items;t=q.map(function(y){return y.id});var v=function(){r.reject(b.getTranslation("ERR0x00000A11"))};var x={getVersions:true,onComplete:function(y){var z=[];q.map(function(B){var A=m.find(y.data,function(C){return C.id===B.id});if(d.is(A)){B.businessobj.documentId=A.id;if((A.relateddata.files||[]).length>0){B.fullFileName=A.relateddata.files[0].dataelements.title}if(p===true){z.push(u._computeFileInfo(B))}}return null});h.all(z).then(function(){if(p===true){q=q.filter(function(A){return A.businessobj.isImage===true})}u._contentCache=new l.Collection(q);r.resolve(u._contentCache)},v)},onFailure:v};j.getDocuments(t,x)},error:function(){r.reject(b.getTranslation("ERR0x00000811"))}})}return r.promise},addMembers:function(u){var q="/resources/enocsmrest/collabspaces/"+this.get("title")+"/members";var p=Array.isArray(u)?u:[u];var v=m.uniq(p);var s=this;var t=h.deferred();var r=[];this.listMembers().then(function(z){var B=z.map(function(C){return C.login});var y=m.difference(v,B);if(y.length<=0){t.resolve()}else{for(var A in y){var x=y[A];var w=h.deferred();k.request(q,{type:"POST",headerParameters:m.result(s,"headerParameters"),urlParameters:m.result(s,"urlParameters"),data:JSON.stringify({actions:[],collabspace:"",content:null,people:x,picture:"",role:{value:"Author",admin:false}}),success:w.resolve,error:w.reject});r.push(w.promise)}h.all(r).then(t.resolve,function(){t.reject(b.getTranslation("ERR0x00000B11"))})}},function(){t.reject(b.getTranslation("ERR0x00000C11"))});return t.promise},addAuthor:function(q,s,r){var p="/resources/enocsmrest/collabspaces/"+this.get("title")+"/members";var t=this;k.request(p,{type:"POST",headerParameters:m.result(t,"headerParameters"),urlParameters:m.result(t,"urlParameters"),data:JSON.stringify({actions:[],collabspace:"",content:null,people:q,picture:"",role:{value:"Author",admin:false}}),success:s,error:r})},addContributor:function(q,s,r){var p="/resources/enocsmrest/collabspaces/"+this.get("title")+"/members";var t=this;k.request(p,{type:"POST",headerParameters:m.result(t,"headerParameters"),urlParameters:m.result(t,"urlParameters"),data:JSON.stringify({actions:[],collabspace:"",content:null,people:q,picture:"",role:{value:"Contributor",admin:false}}),success:s,error:r})},removeMember:function(t,r,q){var p="/resources/enocsmrest/collabspaces/"+this.get("title")+"/members/"+t;var s=this;k.request(p,{type:"DELETE",headerParameters:m.result(s,"headerParameters"),urlParameters:m.result(s,"urlParameters"),success:r,error:q})},listMembers:function(){var r=this;if(d.is(this._membersCache)){return h.cast(this._membersCache)}if(d.is(this._membersPromise)){return this._membersPromise}var q=h.deferred();var p="/resources/enocsmrest/collabspaces/"+this.get("title")+"/members";this._membersPromise=q.promise;k.request(p,{headerParameters:m.result(this,"headerParameters"),urlParameters:m.result(this,"urlParameters"),success:function(t){var s=JSON.parse(t).map(function(u){return u.people});r._membersCache=s;q.resolve(s)},error:q.error});return q.promise},sync:function(q,r,p){if("read"===q){this.urlRoot="/resources/enocsmrest/collabspaces/"+this.get("title")}else{this.urlRoot="/resources/enocsmrest/collabspaces/"}o.__super__.sync.call(this,q,r,m.extend(p,{headerParameters:m.result(this,"headerParameters"),urlParameters:m.result(this,"urlParameters")}))},_computeFileInfo:function(q){var r=h.deferred();var s=f.proxy(function(t){if(/^data:image\/.*/i.test(t)){q.businessobj.isImage=true}else{q.businessobj.isImage=false}r.resolve()},this);var p=f.proxy(function(){q.businessobj.isImage=false;r.resolve()},this);if(q.businessobj.title==="undefined"||/^My 3DLean - .* - .*$/g.test(q.businessobj.title)){q.businessobj.isImage=false;r.resolve()}else{i.getImage(q.businessobj.documentId).then(s,p)}return r.promise}});return o});define("DS/DEL3DLeanModels/enovia_task/Task.model",["DS/DEL3DLeanModels/AElement.model"],function(b){var d=b.extend({extendUrlRoot:"enovia_task/",name:"TaskModel",serverType:"Task",__name__:"TaskModel",defaults:{},constructor:function c(){b.prototype.constructor.apply(this,arguments)},_migrateAndSaveData:function a(){}});return d});define("DS/DEL3DLeanModels/team/Person.model",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","UWA/Core","DS/Logger/Logger","UWA/Class/Promise","DS/DEL3DLeanModels/AModel.model","DS/DEL3DLeanModels/documents/CollaborativeSpace.model","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanHttpRequest/HttpRequest"],function(h,m,e,d,i,a,f,j,l){var c=a.extend({urlRoot:"/resources/modeler/pno/person/",name:"PersonModel",__name__:"PersonModel",_picturePromise:null,_pictureCache:null,idAttribute:function(){return e.is(this.get("pid"))?"pid":"name"},isNew:function(){return !this.get("pid")||!this.get("name")},defaults:{name:null,pid:null,firstname:"firstname",lastname:"lastname",email:"email",address:"address",phone:"phone",company:"company",isactive:false,availability:false,privileges:[]},constructor:function g(){a.prototype.constructor.apply(this,arguments)},initialize:function(){a.prototype.initialize.apply(this,arguments);this._logger=d.getLogger(c);this._sessionInfoPromise=null;this._sessionInfoCache=null;this.onLiveAvailabilityDelegate=h.proxy(this.onLiveAvailability,this);var o=e.getGlobal();if(e.is(o)){var p=o.leanSessionManager.get3DLeanSession();if(e.is(p)){this.updateAvailability(p);p.on("change:V_DEL3DL_Data",this.onLiveAvailabilityDelegate)}}},onDestroy:function k(){var o=e.getGlobal();if(e.is(o)){var p=o.leanSessionManager.get3DLeanSession();if(e.is(p)){p.off("change:V_DEL3DL_Data",this.onLiveAvailabilityDelegate)}}},onLiveAvailability:function n(o){this.updateAvailability(o)},updateAvailability:function b(p){if(!e.is(p)){var o=e.getGlobal();if(e.is(o)){p=o.leanSessionManager.get3DLeanSession()}}if(e.is(p)){var q=p.get("V_DEL3DL_Team");if(e.is(q)&&e.is(q[this.get("name")])){this.set("availability",q[this.get("name")].availability)}}},isInTeam:function(){var o=this.get("privileges");return m.contains(o,"VPLMProjectLeader")||m.contains(o,"VPLMCreator")},isCollaborator:function(){var o=this.get("privileges");return m.contains(o,"VPLMExperimenter")},checkPrivilege:function(){return false},initPrivileges:function(q){var r=[];var o=null;for(var p in q){o=q[p];r.push(o.role.name)}this.set("privileges",r)},getPicture:function(){if(!this.get("name")){var o=i.deferred();this.fetch({success:function(){j.getUserPicture(this.get("name")).then(o.resolve)}.bind(this),error:function(){o.reject()}});return o.promise}else{return j.getUserPicture(this.get("name"))}},getSessionInfo:function(){var o=null;if(this._sessionInfoCache){o=i.cast(this._sessionInfoCache)}else{if(this._sessionInfoPromise){o=this._sessionInfoPromise}else{var p=i.deferred();this._sessionInfoPromise=p.promise;l.request("/resources/modeler/3dlean/api/getusersessioninfos",{type:"POST",data:JSON.stringify({login:this.get("name")}),context:this,success:function(q){q=q||"{}";q=JSON.parse(q);this._sessionInfoCache=q;p.resolve(this._sessionInfoCache)},error:function(q){this._logger.error(q);p.reject(q)}});o=p.promise}}return o},parse:function(o){var p=JSON.parse(o);return p},fetch:function(q){var o=this.get("pid");var p=this.get("name");if(o){this.urlRoot="/resources/modeler/pno/person/pid:"+o}else{if(p){this.urlRoot="/resources/modeler/pno/person/"+p}else{this._logger.warn("No field to query on. Returning");return undefined}}return c.__super__.fetch.call(this,q)}});return c});define("DS/DEL3DLeanModels/leangets/Team.model",["DS/DEL3DLeanModels/leangets/ALeanget.model","DS/DEL3DLeanModels/team/Person.model"],function(a,b){var d=a.extend({extendUrlRoot:"team/",name:"TeamModel",serverType:"DEL3DL_Team",__name__:"TeamModel",constructor:function c(){a.prototype.constructor.apply(this,arguments)},getPerson:function(){return new b({pid:this.get("physicalid"),name:this.get("name")})}});return d});define("DS/DEL3DLeanModels/SketchUtils/Flattener",["pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanModels/SketchUtils/Point"],function(d,b){var a=d.Object.extend({constructor:function a(e){this.points=e.points},flatten:function(e){var f=[];f.push(this.points[0].point);for(var g=1;g<this.points.length;g++){this.recursive_flatten(f,this.points[g-1].point.x,this.points[g-1].point.y,this.points[g-1].point.add(this.points[g-1].handleOut).x,this.points[g-1].point.add(this.points[g-1].handleOut).y,this.points[g].point.add(this.points[g].handleIn).x,this.points[g].point.add(this.points[g].handleIn).y,this.points[g].point.x,this.points[g].point.y,e||100);f.push(this.points[g].point)}return f},recursive_flatten:function c(q,w,i,v,h,s,g,r,f,u){var D=(w+v)/2;var o=(i+h)/2;var l=(v+s)/2;var y=(h+g)/2;var p=(s+r)/2;var j=(g+f)/2;var z=(D+l)/2;var e=(o+y)/2;var t=(l+p)/2;var A=(y+j)/2;var k=(z+t)/2;var x=(e+A)/2;var n=r-w;var m=f-i;var C=Math.abs(((v-r)*m-(h-f)*n));var B=Math.abs(((s-r)*m-(g-f)*n));u=u||100;if((C+B)*(C+B)<u*(n*n+m*m)){q.push(new b(k,x));return}this.recursive_flatten(q,w,i,D,o,z,e,k,x,u);this.recursive_flatten(q,k,x,t,A,p,j,r,f,u)},});return a});define("DS/DEL3DLeanModels/relations/Link.model",["DS/DEL3DLeanModels/AElement.model"],function(a){var c=a.extend({extendUrlRoot:"link/",extendDefaults:{},name:"LinkModel",serverType:"DEL3DL_Link",__name__:"LinkModel",constructor:function b(){a.prototype.constructor.apply(this,arguments)}});return c});define("DS/DEL3DLeanModels/Model.manager",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanModels/AElement.model","DS/DEL3DLeanModels/floatables/AFloatable.model","DS/DEL3DLeanModels/statics/AStatic.model","DS/DEL3DLeanModels/relations/Coord.model","DS/DEL3DLeanModels/relations/Link.model","DS/DEL3DLeanModels/enovia_task/Task.model","DS/DEL3DLeanEnums/Model.enum"],function(f,n,k,b,j,d,e,i,m,h,a){var c=null;var g;g=k.Object.extend({_name:"ModelManager",_logger:null,constructor:function g(){k.Object.prototype.constructor.apply(this,arguments)},initialize:function(){this._logger=b.getLogger(g)},isStatic:function(o){return o instanceof e},isTask:function(o){return o instanceof h},isFloatable:function(o){return o instanceof d},isRelation:function(o){return o instanceof i||o instanceof m},isOfType:function(t,u){var o=false;if(f.is(t)&&f.is(u)){var s=Array.isArray(u.clientType)?u.clientType:[u.clientType];var r=Array.isArray(u.serverType)?u.serverType:[u.serverType];var p=Array.isArray(u.collectionType)?u.collectionType:[u.collectionType];var q=a.getFromConstructor(t.constructor);o=n.contains(s,q.clientType)||n.contains(r,q.serverType)||n.contains(p,q.collectionType)}return o},isModel:function(o){return o instanceof j}});function l(){if(!f.is(c)){c=new g()}return c}return l()});define("DS/DEL3DLeanModels/SketchUtils/Polyline",["UWA/Core","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanModels/SketchUtils/Point","DS/DEL3DLeanModels/SketchUtils/BezierCurve","DS/DEL3DLeanModels/SketchUtils/Simplifier","DS/DEL3DLeanModels/SketchUtils/Flattener"],function(c,g,b,f,i,h,e){var d=g.Object.extend({points:[],_logger:null,constructor:function d(j){this.points=j||[];this._logger=b.getLogger(d)},add:function(j){this.points.push(j)},length:function(){return this.points.length},get:function(j){return this.points[j]},simplify:function(k){if(!c.is(k)){k=2.5}if(this.points.length<2){this.points.push(this.points[0].add({x:1,y:0}))}var l=new h(this).fit(k);var j=null;if(l){j=new i(l)}return j},flatten:function a(k){var l=this.simplify(k||10);var j=new e(l);return new d(j.flatten())},size:function(j){j=j||this.points.length;return j*2},serialize:function(o,j){var l=c.is(o)&&c.is(j)?this.points.slice(o,j):this.points;var m=l.length;var n=new Uint16Array(this.size(m));var k=0;for(;k<m;k++){n.set(l[k].toBytes(),k*n.BYTES_PER_ELEMENT)}return n},deserialize:function(n){if(!c.is(n,"typedarray")&&!c.is(n,"array")){this._logger.warn("Corrupted polyline data, unable to deserialize");return this}this.points=[];var k=2;var j=null;var m=n.length;var l=0;for(l=0;l<m;l+=k){j=new f();j.fromBytes(n[l],n[l+1]);this.points.push(j)}return this}});return d});define("DS/DEL3DLeanModels/SketchUtils/Action",["UWA/Core","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanModels/SketchUtils/Polyline","DS/DEL3DLeanModels/SketchUtils/BezierCurve","DS/DEL3DLeanModels/SketchUtils/ColorConverter"],function(g,f,b,c,e,a){var d=f.Object.extend({_logger:null,constructor:function d(){f.Object.prototype.constructor.apply(this,arguments)},initialize:function(){this.touchId=this.getOption("touchId");this.liveId=this.getOption("liveId");this.id=this.getOption("id")||(this.liveId<<8)+(this.touchId&255);this.mode=this.getOption("mode");this.color=this.getOption("color");this.lineWidth=this.getOption("lineWidth");this.width=this.getOption("width");this.height=this.getOption("height");this.image=this.getOption("image");this.path=this.getOption("path")||this.createPath();this._logger=b.getLogger(d)},encode:function(q,j){var p=null;var n="";if(this.mode===1||this.mode===2){p=new Uint16Array(this.path.size(j-q)+6);var k=a.readRGB(this.color);k.a=k.a||255;p[0]=(this.liveId<<8)+this.mode;p[1]=(k.r<<8)+k.g;p[2]=(k.b<<8)+k.a;p[3]=this.width;p[4]=this.height;p[5]=this.lineWidth<<8+0;p.set(this.path.serialize(q,j),6)}else{if(this.mode===3){p=new Uint16Array(1);p[0]=(this.liveId<<8)+this.mode}else{if(this.mode===4){p=new Uint16Array((this.image.length+2<10000?this.image.length+2:10000));p[0]=(this.liveId<<8)+this.mode;var l=0;var o=0;var h=1;for(l=0;l<this.image.length;l++){p[l-o+h]=this.image.charCodeAt(l);if((l+2)%10000===0){n+=String.fromCharCode.apply(null,p);p=new Uint16Array((this.image.length-l<10000?this.image.length-l:10000));o=l+1;h=0}}if(l>0&&l%10000!==0){n+=String.fromCharCode.apply(null,p)}}}}return n.length>0?n:String.fromCharCode.apply(null,p)},decode:function(l){if(!g.is(l,"string")){this._logger.warn("Corrupted draw data, unable to decode");return this}var j=l.length;if(j<7){this._logger.warn("Corrupted draw data, length to short : "+j);return this}var p=new Uint16Array(j);var m=0;var h=0;var n=0;var q=0;for(m=0;m<j;m++){p[m]=l.charCodeAt(m)}this.liveId=p[0]>>8;this.mode=p[0]&255;if(this.mode===1||this.mode===2){n=p[1]&255;h=p[1]>>8;q=p[2]>>8;this.color=a.writeRGB({r:h,g:n,b:q});this.width=p[3];this.height=p[4];this.lineWidth=p[5]>>8;this.path=this.createPath();this.path.deserialize(p.subarray(6))}else{if(this.mode===4){var k="";var o=p.subarray(1);m=0;for(m=0;m<o.length;m+=10000){k+=String.fromCharCode.apply(null,o.slice(m,m+10000))}this.image=k}}return this},createPath:function(){var h=undefined;if(this.mode===1){h=new e()}else{if(this.mode===2){h=new c()}}return h},setLiveId:function(h){this.liveId=h},getLiveId:function(){return this.liveId},isPNG:function(){var h=false;if(g.is(this.image,"string")){h=/^data:image\/png;base64,/i.test(this.image)}return h}});return d});define("DS/DEL3DLeanModels/leangets/Sketch.model",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanModels/leangets/ALeanget.model","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanModels/SketchUtils/Action"],function(e,h,n,c,m,d){var a=c.extend({extendUrlRoot:"sketch/",name:"SketchModel",serverType:"DEL3DL_Sketch",__name__:"SketchModel",extendDefaults:{V_DEL3DL_Background_Image_Url:"",V_DEL3DL_Stretch:false,V_DEL3DL_Draw_Data:"{}",V_DEL3DL_ToolBarHidden:false},extendJsonAttributes:["V_DEL3DL_Draw_Data"],constructor:function b(){c.prototype.constructor.apply(this,arguments)},initialize:function g(){c.prototype.initialize.apply(this)},_dataMigrationV0:function k(){this.callParent(a.__super__,"_dataMigrationV0");var o=e.Promise.deferred();var q=[];if(this.has("backgroundImage")){this.set("V_DEL3DL_Background_Image",this.get("backgroundImage"));this.unset("backgroundImage")}if(this.has("isStretch")){this.set("V_DEL3DL_Stretch",this.get("isStretch"));this.unset("isStretch")}if(this.has("sketchImage")){this.set("V_DEL3DL_Draw_Data",this.get("sketchImage"));this.unset("sketchImage")}if(this.has("V_DEL3DL_Draw_Data")&&m.isDataUrl(this.get("V_DEL3DL_Draw_Data"))){var p=new d({mode:4,image:this.get("V_DEL3DL_Draw_Data")});this.set("V_DEL3DL_Draw_Data",[p.encode()])}if(this.has("V_DEL3DL_Draw_Data")&&/^[0-9A-F]{32}$/i.test(this.get("V_DEL3DL_Draw_Data"))){q.push(m.getImage(this.get("V_DEL3DL_Draw_Data")).then(h.proxy(function(s){var r=new d({mode:4,image:s});this.set("V_DEL3DL_Draw_Data",[r.encode()])},this)))}if(this.has("V_DEL3DL_Background_Image")&&m.isDataUrl(this.get("V_DEL3DL_Background_Image"))){q.push(m.setImage(this.get("V_DEL3DL_Background_Image")).then(h.proxy(function(r){this.set("V_DEL3DL_Background_Image",r)},this)))}else{if(this.has("V_DEL3DL_Background_Image")&&!/^[a-f0-9]+$/i.test(this.get("V_DEL3DL_Background_Image"))){this.set("V_DEL3DL_Background_Image_Url",this.get("V_DEL3DL_Background_Image"))}}Promise.all(q).then(h.proxy(function(){o.resolve()},this),o.reject);return o.promise},_dataMigrationV1:function j(){this.callParent(a.__super__,"_dataMigrationV1");if(this.has("V_DEL3DL_Draw_Data")){var q=this.get("V_DEL3DL_Draw_Data");var p=0;for(;p<q.length;p++){if(!e.is(q[p],"string")){q.splice(p--,1);continue}var s=q[p].charCodeAt(0)&255;var r=255;var o=0;switch(s){case 1:o=2;break;case 2:o=30;break;default:o=0;break}q[p]=String.fromCharCode((r<<8)+s)+q[p].slice(1,5)+String.fromCharCode(o<<8)+q[p].slice(5)}this.set("V_DEL3DL_Draw_Data",q)}},_dataMigrationV2:function i(){this.callParent(a.__super__,"_dataMigrationV2");if(this.has("V_DEL3DL_Draw_Data")){var q=this.get("V_DEL3DL_Draw_Data");var p=0;for(;p<q.length;p++){if(!e.is(q[p],"string")){q.splice(p--,1);continue}for(var o=6;o<q[p].length;o++){if(q[p].charCodeAt(5)!==q[p].charCodeAt(o)){break}}q[p]=q[p].slice(0,5)+q[p].slice(o-1)}this.set("V_DEL3DL_Draw_Data",q)}},_dataMigrationV3:function f(){this.callParent(a.__super__,"_dataMigrationV3")},_dataNormalization:function l(){a.__super__._dataNormalization.call(this);var o=this.get("V_DEL3DL_Stretch");if(typeof o==="string"){try{this.set("V_DEL3DL_Stretch",JSON.parse(o),{silent:true})}catch(p){this._logger.warn('Normalization:V_DEL3DL_Stretch - JSON.parse of "'+o+'" failed')}}}});return a});