define("DS/SMAProcWebDiagram/EndnodeView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils"],function(c,a){var b='<dom-module id="cmp-endnode-view">  <template>    <style>    :host {      display: inline-block;      position: absolute;      box-sizing: border-box;      height: 50px;      width: 30px;    }    #nodeView {      position: absolute;      height: 30px;      width: 30px;      background: #636363;      border-radius: 5px;    }    #endNodeName {      display: block;      position: relative;      top: 35px;      font: 15px Arial;      text-align: center;    }    </style>    <div id="nodeView"></div>    <label id="endNodeName">Finish</label>  </template></dom-module>';a.registerDomModule(b);return c({is:"cmp-endnode-view"})});define("DS/SMAProcWebDiagram/ProcessView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/Controls/Popup","text!DS/SMAProcWebDiagram/ProcessView.html"],function(d,a,c,b){a.registerDomModule(b);return d({is:"cmp-process-view",properties:{data:{type:Object,observer:"updateData"},processTitle:{type:String},icon:{value:require.toUrl("DS/SMAProcWebApp/assets/icons/32/I_SMAWflWorkFlow.png")},selected:{type:Boolean,reflectToAttribute:true},disabled:{type:Boolean,reflectToAttribute:true}},listeners:{contextmenu:"onProcessRightClicked",click:"onProcessClicked"},ready:function(){this.popup=new c({target:this,position:"top",visibleFlag:false,arrowBoxFlag:false});this.popup.getContent().classList.add("alert-has-icon");this.popup.getContent().classList.add("alert-warning")},attachDragListener:function(){if(this.data){var f=this.$.nodeView;var e=this.data.getPhysicalId();var g=this.data.getName();require(["DS/DataDragAndDrop/DataDragAndDrop","DS/SMAProcWebCMMUtils/SMAProcWebCMM3DXContentUtils"],function(h,j){h.clean(f);var i=j.get3DXContent({objectId:e,objectType:"Simulation",displayName:g});h.draggable(f,{data:JSON.stringify(i)})})}},notify:function(f){var g=2000;var e="<div>"+f+'<span class="icon fonticon"></span></div>';this.popup.setBody(e);this.popup.show();setTimeout(function(){this.popup.hide()}.bind(this),g)},updateData:function(){this.processTitle=this.data.getName();if(this.data){this.attachDragListener()}},onProcessClicked:function(f){if(f){f.preventDefault();f.stopPropagation()}if(this.disabled){return}this.fire("process-click",{data:this.data,originalEvent:f})},onProcessRightClicked:function(f){if(f){f.preventDefault();f.stopPropagation()}if(this.disabled){return}this.fire("process-contextmenu",{data:this.data,originalEvent:f})},highlight:function(){this.selected=true},unhighlight:function(){this.selected=false;d.dom(this.$.nodeView).classList.remove("highlighteddf")},highlightForDF:function(){d.dom(this.$.nodeView).classList.add("highlighteddf")}})});define("DS/SMAProcWebDiagram/StepView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/UIKIT/Spinner","text!DS/SMAProcWebDiagram/StepView.html"],function(d,a,c,b){a.registerDomModule(b);return d({is:"cmp-step-view",properties:{data:{observer:"dataChanged"},icon:{type:String},label:{type:String,},stepID:{type:String,reflectToAttribute:true,value:""},loading:{type:Boolean,reflectToAttribute:true},selected:{type:Boolean,reflectToAttribute:true},disabled:{type:Boolean,reflectToAttribute:true},readonly:{type:Boolean,reflectToAttribute:true},statusMessage:{type:String,value:"",}},listeners:{click:"onStepClicked",contextmenu:"onStepRightClicked"},ready:function(){this.dataChanged();var e=new c().inject(this.$.loaderIcon);e.show();var f=this;document.addEventListener("webServiceRunningChanged",function(){f.updateLoader(f.data)})},onStepClicked:function(f){if(f){f.preventDefault();f.stopPropagation()}if(this.disabled){return}this.fire("step-click",{data:this.data,originalEvent:f})},onStepRightClicked:function(f){if(f){f.preventDefault();f.stopPropagation()}if(this.disabled){return}this.fire("step-contextmenu",{data:this.data,originalEvent:f})},updateTitle:function(){this.label=this.data.getName()},dataChanged:function(){var e=this;if(e.data){e.label=e.data.getName();e.stepID=e.data.getId();e.icon=e.data.getIconUrl();e.readonly=!e.data.isEditable();e.updateLoader(e.data);e.addMainStepIcon();e.updateExeOptionsIcons()}},addMainStepIcon:function(){var e=this.data.getParent().getMainStep();if(e){if(e.getId()==this.data.getId()){this.$.showMainStep.classList.remove("hidden");this.$.showMainStep.classList.add("showMainStepIcon");this.$.stepIcon.classList.add("highlightBorder")}}},removeMainStepIcon:function(){this.$.showMainStep.classList.add("hidden");this.$.showMainStep.classList.remove("showMainStepIcon");this.$.stepIcon.classList.remove("highlightBorder")},updateExeOptionsIcons:function(){if(this.data._data.FlowItem.pauseBefore==="true"){this.$.showpauseBefore.classList.remove("hidden");this.$.showpauseBefore.classList.add("showpauseBefore")}if(this.data._data.FlowItem.pauseAfter==="true"){this.$.showpauseAfter.classList.remove("hidden");this.$.showpauseAfter.classList.add("showpauseAfter")}},updateLoader:function(f){if(f){var e=f.getWebServiceRunning();this.loading=e===true}},highlight:function(){this.selected=true},unhighlight:function(){this.selected=false},getDefaultIcon:function(e){e.srcElement.src=require.toUrl("DS/SMAProcWebApp/assets/icons/32/SMAWflCustomAdapter32.png")},_getIconUrl:function(e){return require.toUrl("DS/SMAProcWebApp/assets/icons/32/"+e)},showStatus:function(e){this.statusMessage=e}})});define("DS/SMAProcWebDiagram/ActivityView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/UIKIT/Spinner","DS/Controls/Popup","text!DS/SMAProcWebDiagram/ActivityView.html"],function(f,a,d,e,b){function c(g){if(g){g.stopPropagation();if(g.detail&&g.detail.sourceEvent){c(g.detail.sourceEvent)}}}if(!Object.getOwnPropertyDescriptor(Element.prototype,"classList")){if(HTMLElement&&Object.getOwnPropertyDescriptor(HTMLElement.prototype,"classList")){Object.defineProperty(Element.prototype,"classList",Object.getOwnPropertyDescriptor(HTMLElement.prototype,"classList"))}}a.registerDomModule(b);return f({is:"cmp-activity-view",properties:{CurrentState:{type:String,value:"collapsed",notify:true},activity:{value:null,notify:true,observer:"activityChanged"},activityTitle:{type:String,value:"",notify:true},activityId:{type:String,reflectToAttribute:true,value:""},selected:{type:Boolean,reflectToAttribute:true},disabled:{type:Boolean,reflectToAttribute:true},loading:{type:Boolean,reflectToAttribute:true},SubflowState:{type:String,computed:"_getSubflowState(activity)"},subFlowTitle:{type:String,computed:"_getSubFlowTitle(activity)"},statusMessage:{type:String,value:"",}},listeners:{contextmenu:"onActivityRightClicked",click:"onActivityClicked",mouseenter:"onActivityHover",mouseleave:"onActivityHoverOut"},ready:function(){this.$.expandCollapseControl.style.className="collapsed";var g=new d().inject(this.$.loaderIcon);g.show();var h=this;this.popup=new e({target:this,position:"top",visibleFlag:false,arrowBoxFlag:false});this.popup.getContent().classList.add("alert-has-icon");this.popup.getContent().classList.add("alert-warning");document.addEventListener("webServiceRunningChanged",function(i){h.updateLoader();i.stopPropagation();i.preventDefault()})},onActivityClicked:function(g){if(g){g.preventDefault();g.stopPropagation()}if(this.disabled){return}this.fire("activity-click",{data:this.activity,originalEvent:g})},onActivityRightClicked:function(g){if(g){g.preventDefault();g.stopPropagation()}if(this.disabled){return}this.fire("activity-contextmenu",{data:this.activity,originalEvent:g})},onActivityHover:function(h){var g=this;if(h){h.preventDefault();h.stopPropagation()}if(this.disabled){return}this._hovertimeout=setTimeout(function(){g.fire("activity-hover",{data:g.activity,originalEvent:h})},1000)},onActivityHoverOut:function(g){if(g){g.preventDefault();g.stopPropagation()}if(typeof this._hovertimeout!=="undefined"){clearTimeout(this._hovertimeout)}},activityChanged:function(){this.updateWidget()},updateWidget:function(){if(this.activity){var g=this;g.updateIcon();g.updateLoader();g.showsubflowIndicator()}},notify:function(h){var g="<div>"+h+'<span class="icon fonticon"></span></div>';this.popup.setBody(g);this.popup.show();setTimeout(function(){this.popup.hide()}.bind(this),2000)},updateIcon:function(){var g=null;var i=null;var h=f.dom(this.$.MainStepIcon);if(this.activity){this.activityId=this.activity.getId();this.activityTitle=this.activity.getName();h.classList.add("hidden");h.classList.remove("editable");var j=this.activity.getPosition();g=this.activity.getMainStep();this.CurrentState=(j.showSteps===false)?"collapsed":"expanded";if(g){if(this.CurrentState==="collapsed"){i=g.getIconUrl()}if(i){h.setAttribute("src",i);h.node.addEventListener("error",function(k){k.srcElement.src=require.toUrl("DS/SMAProcWebApp/assets/icons/32/SMAWflCustomAdapter32.png")});h.classList.remove("hidden");h.classList.add("mainStep")}if(g.isEditable()){h.classList.add("editable")}}}},showsubflowIndicator:function(){var k=function(p,o){var u=[];var q,s,n,t,i,r;var v=require("DS/SMAProcWebDiagram/graph");q=v.processDiagram.nodeMap[p.getId()];s=v.processDiagram.nodeMap[o.getId()];n=q.actualWidth/2;t=p._position.height;i=s.left+(s.actualWidth/2);r=t-s.actualHeight+10;u.push(n);u.push(t);u.push(i);u.push(r);return u};var h=f.dom(this.$.subflowIndicator);var g=false;if(this.CurrentState==="expanded"){var m=[];var j=this.activity._steps;if(j){for(var l=0;l<j.length;l++){if(!j[l].isFunctionStep()){g=true}if(g){m=k(this.activity,j[l]);h.classList.remove("hidden");h.classList.add("subflowIndicator");h.setAttribute("x1",m[0]);h.setAttribute("y1",m[1]);h.setAttribute("x2",m[2]);h.setAttribute("y2",m[3]);break}else{h.classList.add("hidden")}}}}else{if(this.CurrentState==="collapsed"){h.classList.add("hidden")}}},updateLoader:function(){var i=this;var g=i.activity;if(g){var h=g.getWebServiceRunning();this.loading=h===true}},setShowSteps:function(g){var i=require("DS/SMAProcWebDiagram/graph");this.CurrentState=g?"expanded":"collapsed";if(this.activity){this.activity.setShowSteps(g);var j=this.activity.getProcess();i.updateGraph(j,true);var h=this.activity.getId();if(g){i.showSteps(h)}else{i.hideSteps(h)}}this.updateWidget()},toggleActivityState:function(h){var g=this.CurrentState!=="collapsed";this.CurrentState=g?"collapsed":"expanded";this.activity.setShowSteps(!g);this.fire("toggleState",this.CurrentState);c(h)},_getSubflowState:function(h){if(h){var g=h.canHaveSubFlow();if(g){return h.getPosition().showChildren?"expanded":"collapsed"}}return"hidden"},_getSubFlowTitle:function(h){if(h){var g=h.canHaveSubFlow();if(g){return h.getPosition().showChildren?"Hide inner-flow":"Show inner-flow"}}return""},toggleSubflowState:function(g){if(this.activity){var h=this.activity.getPosition().showChildren;this.activity.setPosition({showChildren:!h});this.fire("toggleSubflowState",this.activity)}c(g)},highlight:function(){this.selected=true},unhighlight:function(){this.selected=false;f.dom(this.$.nodeView).classList.remove("highlighteddf")},highlightForDF:function(){f.dom(this.$.nodeView).classList.add("highlighteddf")},removeMainStepIcon:function(l){if(this.CurrentState==="expanded"){var g=this.activity.getMainStep();var k;if(g){k=g._getData().FlowItem.id}var h=this.activity._steps;for(var j=0;j<h.length;j++){var m=l[h[j].getId()].views.main.display.elt;if(k!==m.stepID){if(m.$.showMainStep.classList.contains("showMainStepIcon")){m.removeMainStepIcon()}}}}},updateExeOptionsIcons:function(){if(this.CurrentState==="expanded"){var k=require("DS/SMAProcWebDiagram/graph");var j=k.processDiagram.nodeMap;var g=this.activity._steps;for(var h=0;h<g.length;h++){var l=j[g[h].getId()].views.main.display.elt;if(l.data._data.FlowItem.pauseBefore==="true"){l.$.showpauseBefore.classList.remove("hidden");l.$.showpauseBefore.classList.add("showpauseBefore")}else{if(l.$.showpauseBefore.classList.contains("showpauseBefore")){l.$.showpauseBefore.classList.add("hidden")}}if(l.data._data.FlowItem.pauseAfter==="true"){l.$.showpauseAfter.classList.remove("hidden");l.$.showpauseAfter.classList.add("showpauseAfter")}else{if(l.$.showpauseAfter.classList.contains("showpauseAfter")){l.$.showpauseAfter.classList.add("hidden")}}}}},_getIconUrl:function(g){return require.toUrl("DS/SMAProcWebApp/assets/icons/32/"+g)},showStatus:function(g){this.statusMessage=g}})});define("DS/SMAProcWebDiagram/ELK/ELKBuilder",["UWA/Core"],function(){var b;var c={IN:{properties:{"port.side":"WEST"},width:10,height:10},OUT:{properties:{"port.side":"EAST"},width:10,height:10},SUBFLOW_IN:{properties:{"port.side":"SOUTH"},width:10,height:10},SUBFLOW_OUT:{properties:{"port.side":"SOUTH"},width:10,height:10},INOUT:{properties:{"port.side":"SOUTH"},width:20,height:10},};function a(e){this.id=e}Object.assign(a.prototype,{getId:function(){return this.id},getName:function(){return this.id}});function d(f){var h=function(k,l){++f.labelIndex;return{id:f.getUnique(k),properties:{portConstraints:"FIXED_ORDER","nodeLabels.placement":"[H_LEFT, V_TOP, OUTSIDE]"},labels:[{id:"L"+f.labelIndex,text:k.getName(),}],ports:l,children:[],edges:[],width:f.elk.outerWidth,height:f.elk.outerHeight}};var j=function(n){var m=n.getId();var p=[];for(var l=1;l<arguments.length;++l){++f.portIndex;var k=arguments[l];var o="P"+f.portIndex;p.push(Object.assign({id:o},c[k]));f.activityInfoMap[m][k]=o}return p};var e=function(){var k="SubFlow"+(++f.subFlowIndex);return new a(k)};var i=function(){var k="ChildFlow"+(++f.childFlowIndex);return new a(k)};var g={initGraph:function(){var k={id:"root",properties:{portConstraint:"FIXED_ORDER",algorithm:"layered"},children:[],edges:[]};return k},createNode:function(n){var m=false;if(n.isActivity&&n.isActivity()&&n.activity.getPosition){m=n.activity.getPosition().showSteps}var p=n.getId();f.activityInfoMap[p]={};var l;var k=p.toLowerCase();if(k.indexOf("activity")>=0){l=h(n,j(n,"IN","OUT","SUBFLOW_IN","SUBFLOW_OUT"));if(m){var o=n.getStepCount();if(o>=1){l.width=o*(f.elk.innerStepDim+f.elk.innerStepPadding)+f.elk.innerStepPadding+50}}}else{if(k.indexOf("gateway")>=0){l=h(n,j(n,"IN","OUT","INOUT"))}else{if(k.indexOf("start")>=0){l=h(n,j(n,"OUT"))}else{if(k.indexOf("end")>=0){l=h(n,j(n,"IN"))}else{if(k.indexOf("subflow")>=0||k.indexOf("childflow")>=0||k.indexOf("process")>=0){l=h(n,j(n,"IN","OUT"))}}}}}f.activityInfoMap[p].node=l;return l},createSubFlow:function(q){var p=e();var m=i();var l=this.createNode(p);var k=this.createNode(m);var n=this.createNode(q);l.children.push(n);l.children.push(k);l.edges.push(this.createEdge(p,"IN",q,"IN"));l.edges.push(this.createEdge(q,"OUT",p,"OUT"));l.edges.push(this.createEdge(q,"SUBFLOW_OUT",m,"IN"));l.edges.push(this.createEdge(m,"OUT",q,"SUBFLOW_IN"));var o=q.getId();f.activityInfoMap[o].subFlow=p;f.activityInfoMap[o].childFlow=m;f.activityInfoMap[p.getId()].activity=o;f.activityInfoMap[m.getId()].activity=o;return n},createOuterBox:function(p,n){var r="Box"+(++f.boxIndex);var o=new a(r);f.activityInfoMap[r]={};var q=[];for(var m=1;m<=p;++m){var k="P"+(++f.portIndex);q.push({id:k,properties:{"port.side":n},width:10,height:10});f.activityInfoMap[r][m]=k}var l=h(o,q);f.activityInfoMap[r].node=l;return o},createEdge:function(k,m,n,l){var p=f.activityInfoMap[k.getId()][m];var o=f.activityInfoMap[n.getId()][l];return{id:"E"+(++f.edgeIndex),sources:[p],targets:[o]}},getSubFlow:function(l){var k=f.activityInfoMap[l.getId()];if(k.subFlow){return k.subFlow}return l}};return g}b=d;return b});define("DS/SMAProcWebDiagram/GraphUtils",["UWA/Core"],function(){function c(){this.keys=[];this.values=[]}Object.assign(c.prototype,{set:function(h,j){var g=this._find(h.id);if(g>=0){this.values[g]=j}else{this.keys.push(h);this.values.push(j)}},_find:function(h){for(var g=0;g<this.keys.length;++g){if(this.keys[g].id===h){return g}}return -1},size:function(){return this.keys.length},get:function(g){return this.getId(g.id)},getId:function(h){var g=this._find(h);if(g>=0){return this.values[g]}},getKeys:function(){return this.keys},has:function(g){return this._find(g.id)>=0},hasId:function(g){return this._find(g)>=0},getKey:function(h){var g=this._find(h);if(g>=0){return this.keys[g]}},forEach:function(g){var h=this.keys.length;for(var i=0;i<h;++i){g(this.keys[i],this.values[i])}return this},print:function(){var j=[];function i(k){return k.name+"["+k.id+"]"}var g=this.keys.length;for(var h=0;h<g;++h){j.push({key:i(this.keys[h]),value:this.values[h]})}return j}});function a(g){this.transformFn=function(h){return{name:h.getName(),id:h.getId()}};this.graph=new c(this.transformFn);this.isDirected=Boolean(g);this.forestMap={}}Object.assign(a.prototype,{print:function(){var l=[];function k(m){return m.name+"["+m.id+"]"}var i=this.graph.getKeys();for(var h=0;h<i.length;++h){var g=i[h];var j=this.graph.get(g);l.push({key:k(g),value:j.map(k)})}return l},addVertex:function(h){if(h){var g=this.transformFn(h);this.graph.set(g,[])}},existEdge:function(i,h){var g=this.graph.get(i);return g.some(function(j){return j.id===h.id})},addEdge:function(h,g){if(!h||!g){return}h=this.graph.getKey(h.getId())||this.transformFn(h);g=this.graph.getKey(g.getId())||this.transformFn(g);if(!this.graph.has(h)){this.addVertex(h)}if(!this.graph.has(g)){this.addVertex(g)}if(!this.existEdge(h,g)){this.graph.get(h).push(g)}if(!this.isDirected&&!this.existEdge(g,h)){this.graph.get(g).push(h)}},computeForestData:function(){var g={};var j=0;var i={};var h=this;function k(m){if(g[m.id]){return}g[m.id]=true;i[m.id]=j;var l=h.graph.get(m);if(l){l.forEach(function(n){k(n)})}}this.graph.getKeys().forEach(function(l){if(!g[l.id]){++j;k(l)}});return i},initFromProcess:function(j){var g={};var i=this;function h(o){if(g[o.getId()]){return}g[o.getId()]=true;i.addVertex(o);if(o.isActivity()){var n=o.getFirstChild();if(n){h(n);i.addEdge(o,n)}var m=o.getLastChild();if(m){i.addEdge(m,o)}var l=o.getChildren();for(var k=0;k<l.length;++k){var p=l[k];if(!g[p.getId()]){h(p)}}}o.getOutgoingFlowItems().forEach(function(q){h(q);i.addEdge(o,q)})}h(j.getFirstChild());j.getAllActivities().forEach(function(k){if(!g[k.getId()]){h(k)}});this.forestMap=this.computeForestData()},getBridges:function(){var j=this;var h={};var i=[];var k=1;function g(o,n,l,m){h[o.id]=true;m.set(o,k);l.set(o,k);++k;j.graph.get(o).forEach(function(p){if(h[p.id]){if(n.get(o)!==p){l.set(o,Math.min(l.get(o),m.get(p)))}}else{n.set(p,o);g(p,n,l,m);l.set(o,Math.min(l.get(o),l.get(p)));if(l.get(p)>m.get(o)){i.push([o,p])}}})}this.graph.getKeys().forEach(function(l){if(!h[l.id]){g(l,new c(),new c(),new c())}});return i}});function d(g,k){var w=new a();w.initFromProcess(g);var l=w.getBridges();var s=w.forestMap;var n={};var v=[];var t=0;var p={};var r={};var h={};var j=1;function u(x,i){return l.some(function(y){return(y[0].id===x.getId()&&y[1].id===i.getId())||(y[0].id===i.getId()&&y[1].id===x.getId())})}function q(z,B){if(n[z.getId()]){return p[z.getId()].level}var i=B;if(t<B){t=B}p[z.getId()]={activity:z,level:B};r[z.getId()]=j++;var A=s[z.getId()];if(A===1){z.setPosition({connected:true})}else{z.setPosition({connected:false})}n[z.getId()]=true;if(!v[B]){v[B]=[]}v[B].push(z);if(z.isActivity()){if(z.getFirstChild()){i=q(z.getFirstChild(),B+1)}if(z.getOutgoingFlowItems().length>1){console.warn(z.getName()+" activity has more than one outgoing flow items")}}var y=B;z.getOutgoingFlowItems().forEach(function(D,C){if(C===0){if(z.isGateway()){if(z.getParent().getLastChild()===z){y=q(D,y+1)}else{if(!n[D.getId()]){y=q(D,y)}}}else{y=q(D,y)}}else{if(!n[D.getId()]){y=q(D,y+1)}}if(i<y){i=y}});h[z.getId()]=j++;if(z.getOutgoingFlowItems().length===1){var x=z.getOutgoingFlowItems()[0];if(u(z,x)){return B}}return i}var o=2;if(g.getFirstChild()){q(g.getFirstChild(),1);o=t+1}for(var m=1;m<k.length;++m){q(k[m],o)}return{maxLevel:t,levelMap:v,idToActivityMap:p,discoveryMap:r,finishMap:h,forestMap:s,bridges:l}}function f(h,n,j){function i(p){if(p==="start"||p==="end"){return p}else{if(p){return p.getId()}}}function l(p){return n[i(p)].level}var k=[];function g(u,q,t,p,r){var s={from:i(u),fromPort:q,to:i(t),toPort:p,type:r};k.push(s);return s}var m={};function o(v){if(m[v.getId()]){return}m[v.getId()]=true;if(v.isActivity()){if(v.getFirstChild()&&v.getPosition().showChildren){o(v.getFirstChild());g(v,"SUBFLOW_OUT",v.getFirstChild(),"IN","p2c");if(v.getLastChild()){g(v.getLastChild(),"OUT",v,"SUBFLOW_IN","c2p")}}}var s={};var p=l(v);v.getOutgoingFlowItems().forEach(function(w){var x=l(w);s[x]=s[x]||[];var y;if(p===x){y=g(v,"OUT",w,"IN","a2a")}else{if(p<x){y=g(v,"BOTTOM_OUT",w,"IN","g2a")}else{y=g(v,"OUT",w,"BOTTOM_IN","a2g")}}s[x].push([w,y]);o(w)});if(v.isGateway()){for(var r in s){if(s[r].length>1){for(var q=1;q<s[r].length;++q){var u=s[r][q][0];if(u.isGateway()){var t=s[r][q][1];t.type="g2g"}}}}}}j.forEach(function(p){o(p)});return k}function e(i){var g=[];var h=i.getFirstChild();if(h){g.push(h)}i.getAllActivities().forEach(function(k){if(k!==h){if(k.getIncomingFlowItems().length===0){var j=k.getParent();if(!j){g.push(k)}else{if(j.isProcess()){g.push(k)}else{if(j.isActivity()&&j.getPosition().showChildren&&j.getFirstChild()!==k&&j.getLastChild()!==k){g.push(k)}}}}}});return g}function b(g,h){this.period=g;this.data=h}Object.assign(b.prototype,{overlap:function(g){return g.period[1]>=this.period[0]&&g.period[0]<=this.period[1]},union:function(g){var j=this.period[0]<g.period[0]?this.period[0]:g.period[0];var h=this.period[1]>g.period[1]?this.period[1]:g.period[1];var i=Object.assign({},this.data,g.data);return new b([j,h],i)},gap:function(g){return g.period[0]-this.period[1]},shift:function(g){this.period[0]-=g;this.period[1]-=g}});return{Graph:a,algorithm:{analyze:d,getEdges:f,getTopologicalOrder:e},Interval:b,OrderedMap:c}});define("DS/SMAProcWebDiagram/GatewayView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/UIKIT/Spinner","text!DS/SMAProcWebDiagram/GatewayView.html"],function(d,a,c,b){a.registerDomModule(b);return d({is:"cmp-gateway-view",properties:{data:{type:Object,observer:"updateLoader"},selected:{type:Boolean,reflectToAttribute:true},disabled:{type:Boolean,reflectToAttribute:true},loading:{type:Boolean,reflectToAttribute:true}},listeners:{contextmenu:"onGatewayRightClicked",click:"onGatewayClicked"},ready:function(){var e=new c().inject(this.$.loaderIcon);e.show();var f=this;document.addEventListener("webServiceRunningChanged",function(){f.updateLoader()})},updateLoader:function(){var f=this;var g=f.data;if(g){var e=g.getWebServiceRunning();this.loading=e===true}},onGatewayClicked:function(f){if(f){f.preventDefault();f.stopPropagation()}if(this.disabled){return}this.fire("gateway-click",{data:this.data,originalEvent:f})},onGatewayRightClicked:function(f){if(f){f.preventDefault();f.stopPropagation()}if(this.disabled){return}this.fire("gateway-contextmenu",{data:this.data,originalEvent:f})},highlight:function(){this.selected=true},unhighlight:function(){this.selected=false}})});define("DS/SMAProcWebDiagram/ConnectorView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils"],function(c,a){var b='<dom-module id="cmp-connector-view"><template id="conn_temp">  <svg class="hide">    <defs id="svg_templates">      <g class="arrow" id="inArrow">        <path class="draw" d="M 0 8 Q 0 10 2 8 L 8 2 Q 10 0 8 -2 L 2 -8 Q 0 -10 0 -8 L 0 8"></path>      </g>      <g class="arrow interactive" id="interactiveInArrow">        <path class="draw" d="M 0 8 Q 0 10 2 8 L 8 2 Q 10 0 8 -2 L 2 -8 Q 0 -10 0 -8 L 0 8"></path>      </g>      <g class="inout_arrow arrow" id="outArrow">        <path class="draw" d="M 2 -2 Q 0 0 2 2 L 8 8 Q 10 10 10 8 L 10 -8 Q 10 -10 8 -8 L 2 -2"></path>      </g>      <g class="" id="none">      </g>    </defs>  </svg></template></dom-module>';a.registerDomModule(b);return c({is:"cmp-connector-view",properties:{type:{type:String}},create:function(e){if(e){var f=c.dom(this.$.svg_templates).querySelector(e);if(f){var d=f.cloneNode(true);return d}}return null}})});define("DS/SMAProcWebDiagram/StartnodeView",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils",],function(c,a){var b='<dom-module id="cmp-startnode-view">  <template>    <style>    :host {      display: inline-block;      position: absolute;      box-sizing: border-box;      height: 50px;      width: 30px;    }    #nodeView {      position: absolute;      height: 30px;      width: 30px;    }    #nodeView path {       stroke-width: 20;       stroke: #636363;       fill: #636363;       stroke-linejoin: round;       stroke-linecap:round;    }    #startNodeName {      display: block;      position: relative;      top: 35px;      font: 15px Arial;      text-align: center;    }    </style>    <div id="nodeView"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" width="30" height="30">       <path d="M 90,50 10,90 10,10 z"/>    </svg></div>    <label id="startNodeName">Start</label>  </template></dom-module>';a.registerDomModule(b);return c({is:"cmp-startnode-view"})});define("DS/SMAProcWebDiagram/EGraphUtils",["UWA/Core","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/JSCMM/SMAJSCMMActivity","DS/SMAProcWebDiagram/ActivityView","DS/SMAProcWebDiagram/ConnectorView","DS/SMAProcWebDiagram/StartnodeView","DS/SMAProcWebDiagram/EndnodeView","DS/SMAProcWebDiagram/StepView","DS/SMAProcWebDiagram/GatewayView"],function(h,t,u,k,i,m,g,y,n,j,s){function v(z){var D,B,E;B=new u.BoundingRect();for(E=z.nodes.first;E;E=t.dftNext(z,E)){var C={left:E.actualLeft,right:E.actualLeft+E.actualWidth,top:E.actualTop,bottom:E.actualTop+E.actualHeight};B.update(E,C.left,C.right,C.top,C.bottom)}var A=z.views.main;A.setSize();D=u.reframeViewpoint(A.getSize(),B,{padding:5,minSize:50,horizontal:0,vertical:0,aliasing:0,defaultVpt:A.vpt,maxScale:1});A.setViewpoint(D,true)}function r(z,A){k.HTMLNodeView.call(this);this.type=z;this.data=A}u.inherit(r,k.HTMLNodeView);r.prototype.buildNodeElement=function(){var z=document.createElement(this.type);z.style.position="absolute";if(this.data){if(this.type==="cmp-activity-view"){z.activity=this.data}else{z.data=this.data}}return z};var l=function(A,z){t.BoundsGeometry.call(this)};u.inherit(l,t.BoundsGeometry);l.prototype.onupdate=function(z){z.multiset("actualLeft",z.originLeft,"actualTop",z.originTop,"actualWidth",z.width,"actualHeight",z.height)};function o(z){k.SVGConnView.call(this);this.type=z}u.inherit(o,k.SVGConnView);o.prototype.buildConnElement=(function(){var z;return function(){if(!z){z=new g()}return z.create(this.type)}})();function q(A,D,B,C){var z=new t.Connector();if(!B){B="#inArrow"}z.data=C;z.views.main=new o(B);z.multiset(["cstr","attach"],A,["cstr","offset"],D);return z}function f(B,G,F,H,E,I,A){var z=new t.Edge();z.views.main=new k.SVGEdgeView("egraph_views_SVGEdgeView "+I);z.data={from:G,to:H,edgeType:I};var D=A.nodeMap[G].data[F];var C=A.nodeMap[H].data[E];z.multiset("geometry",new p(I));B.addEdge(D,C,z,{autoPairSelection:true});A.addEdge(G,H,z);return z}function d(A,G,F,H,E,I,z){var C=new t.Edge();C.set("geometry",new t.AutoBezierGeometry());C.views.main=new k.SVGEdgeView("egraph_views_SVGDottedEdgeView");var D=z.nodeMap[G].data[F];var B=z.nodeMap[H].data[E];A.addEdge(D,B,C);return C}function e(D,F,E,C){function M(O){O.data.subEdgeType="step-edge"}var J=C.nodeMap;var L=E.getSteps();if(L.length===0){M(f(D,E.getId(),"IN",E.getId(),"OUT","a2a",C));return}var I=C.config.stepGeom.width;var K=C.config.stepGeom.top;var H=F.width/(L.length+1);for(var G=0;G<L.length;++G){var B=L[G];var A=new t.Node();A.views.main=new r("cmp-step-view",B);A.data={id:B.getId(),activityId:E.getId(),};A.multiset("left",(G+1)*H-I/2,"top",K,"width",I,"height",I);A.data.IN=q(t.BorderCstr.LEFT,I/2,"#outArrow","IN");A.data.OUT=q(t.BorderCstr.RIGHT,I/2,"#inArrow","OUT");A.appendConnector(A.data.IN);A.appendConnector(A.data.OUT);F.addNode(A);J[B.getId()]=A}M(f(D,E.getId(),"IN",L[0].getId(),"IN","a2a",C));for(var N=L[0],G=1;G<L.length;N=L[G],++G){var z=L[G];M(f(D,N.getId(),"OUT",z.getId(),"IN","a2a",C))}M(f(D,L[L.length-1].getId(),"OUT",E.getId(),"OUT","a2a",C))}function x(C,K,A,I,B){var E;var L=B.config.activityGeom.subflowOffset;var N=B.config.gatewayGeom.connectorOffset;if(K==="activity"){var D=B.process.getActivityFromId(A);var H=D.getPosition().showSteps;if(H){E=new t.Group();E.geometry=new l()}else{E=new t.Node()}E.data={id:A};B.nodeMap[A]=E;var F=B.config.activityGeom.connectorOffset;E.multiset("left",I.x-I.width/2,"top",I.y-F,"width",I.width,"height",I.height);E.views.main=new r("cmp-activity-view",D);var z="#interactiveInArrow";var J=D.getParent();if(D.getOutgoingFlowItems().length>0||(J&&J.getLastChild()===D)||B.isFlowItemIsolated(D)){z="#none"}E.data.IN=q(t.BorderCstr.LEFT,F,"#outArrow","IN");E.data.OUT=q(t.BorderCstr.RIGHT,F,z,"OUT");E.data.PARENT=q(t.BorderCstr.TOP,I.width/2,"#none","PARENT");E.data.CHILD=q(t.BorderCstr.BOTTOM,I.width/2,"#none","CHILD");E.appendConnector(E.data.IN);E.appendConnector(E.data.OUT);E.appendConnector(E.data.PARENT);E.appendConnector(E.data.CHILD);C.addNode(E);if(D.canHaveSubFlow()&&D.getPosition().showChildren){E.data.SUBFLOW_OUT=q(t.BorderCstr.BOTTOM,I.width/2-L,"#inArrow","SUBFLOW_OUT");E.data.SUBFLOW_IN=q(t.BorderCstr.BOTTOM,I.width/2+L,"#outArrow","SUBFLOW_IN");E.appendConnector(E.data.SUBFLOW_OUT);E.appendConnector(E.data.SUBFLOW_IN);if(!D.getFirstChild()){f(C,A,"SUBFLOW_IN",A,"SUBFLOW_OUT","p2p",B)}}if(H){e(C,E,D,B)}return E}E=new t.Node();E.data={id:A};E.multiset("left",I.x-I.width/2,"top",I.y-I.height/2,"width",I.width,"height",I.height);if(K==="gateway"){var M=B.process.getActivityFromId(A);var z="#inArrow";var G=M.getParent();if(M.getOutgoingFlowItems().length>0||(G&&G.getLastChild()===M)){z="#none"}E.views.main=new r("cmp-gateway-view",M);E.data.IN=q(t.BorderCstr.LEFT,I.width/2,"#outArrow","IN");E.data.OUT=q(t.BorderCstr.RIGHT,I.width/2,z,"OUT");E.data.BOTTOM_IN=q(t.BorderCstr.BOTTOM,I.width/2-N,"#outArrow","BOTTOM_IN");E.data.BOTTOM_OUT=q(t.BorderCstr.BOTTOM,I.width/2+N,"#interactiveInArrow","BOTTOM_OUT");E.data.PARENT=q(t.BorderCstr.TOP,I.width/2,"#none","PARENT");E.appendConnector(E.data.IN);E.appendConnector(E.data.OUT);E.appendConnector(E.data.BOTTOM_IN);E.appendConnector(E.data.BOTTOM_OUT);E.appendConnector(E.data.PARENT)}else{if(K==="start"){E.views.main=new r("cmp-startnode-view");E.data.PROCESS_IN=q(t.BorderCstr.TOP,I.width/2,"#none","PROCESS_IN");E.data.OUT=q(t.BorderCstr.RIGHT,I.width/2,"#none","OUT");E.appendConnector(E.data.OUT);E.appendConnector(E.data.PROCESS_IN)}else{if(K==="end"){E.views.main=new r("cmp-endnode-view");E.data.PROCESS_IN=q(t.BorderCstr.TOP,I.width/2,"#none","PROCESS_IN");E.data.IN=q(t.BorderCstr.LEFT,I.width/2,"#none","IN");E.appendConnector(E.data.IN);E.appendConnector(E.data.PROCESS_IN)}else{if(K==="process"){E.views.main=new r("cmp-process-view",B.process);E.data.LEFT=q(t.BorderCstr.LEFT,I.width/2,"#none","LEFT");E.data.RIGHT=q(t.BorderCstr.RIGHT,I.width/2,"#none","RIGHT");E.data.CHILD=q(t.BorderCstr.BOTTOM,I.width/2,"#none","CHILD");E.appendConnector(E.data.LEFT);E.appendConnector(E.data.RIGHT);E.appendConnector(E.data.CHILD)}else{throw Error("cannot determine type")}}}}B.nodeMap[A]=E;C.addNode(E);return E}function p(z){this.rel=z}p.prototype.onupdate=function(Q){var N=20;var J=30;var H=30;var R=0;var P=20;var C=t.PathCmd.M;var E=t.PathCmd.L;var z=Q.cl1.c.aleft;var O=Q.cl1.c.atop;var K=Q.cl1.c.node.top;var A=Q.cl2.c.aleft;var G=Q.cl2.c.atop;var I=[];var B=this.rel;switch(B){case"a2a":I=[C,z,O,E,z+20,O,E,z+20,G,E,A,G];break;case"p2p":I=[C,z,O,E,z,O+N,E,(z+J),(O+N+R),E,(z+J),(O+N+P),E,(A-J),(G+N+P),E,(A-J),(G+N+R),E,(A),G+N,E,A,G];break;case"p2c":I=[C,z,O,E,z,O+N,E,(A-J),O+N+R,E,(A-J),G,E,A,G];break;case"c2p":var S=Math.max(z,A);I=[C,z,O,E,S+J,O,E,S+J,G+N+R,E,(A),G+N,E,A,G];break;case"a2g":I=z<=A?[C,z,O,E,A,O,E,A,G]:[C,z,O,E,z+10,O,E,z+10,O-50,E,A,O-50,E,A,G,];break;case"g2a":I=z<=A?[C,z,O,E,z,G,E,A,G]:[C,z,O,E,z,G-50,E,A-10,G-50,E,A-10,G,E,A,G];break;case"g2g":var F=(z+A)/2;var D=(O+G)/2;I=O===G?[C,z,O,E,z+J,O,E,z+J,O-50,E,A-J,O-50,E,A-J,G,E,A,G]:[C,z,O,E,z,O+20,E,F,O+20,E,F,D,E,A-20,D,E,A-20,G,E,A,G,];break;case"forward":I=[C,z,O,E,z+70,K+40,E,A,G+10];break;case"backward":I=[C,z,O,E,z,K+165,E,A,G];break;case"p2s":I=[C,z,O,E,A,G-H,E,A,G];break}Q.set("path",I)};function c(z){requestAnimationFrame(function(){requestAnimationFrame(z)})}function w(z){z.iterateEdges(function(F,H,G){var A=F.data.subEdgeType==="step-edge";if(A){var D=F.view.elts.elt;if(D){D.setAttribute("class","egraph_views_SVGEdgeViewSteps")}var E=H.test(/step/i);var C=G.test(/step/i);if(E){var B=z.nodeMap[H].data.OUT;B.view.elts.elt.setAttribute("class","drawStepConnector")}if(C){var B=z.nodeMap[G].data.IN;B.view.elts.elt.setAttribute("class","drawStepConnector")}}})}function a(z){k.HTMLNodeView.call(this);this.activity=z}u.inherit(a,k.HTMLNodeView);a.prototype.buildNodeElement=function(){var B="Drop here to insert over all";var z="insert-over-process";if(this.activity instanceof i){B="insert over";z="insert-over-activity"}var A=h.createElement("div",{"class":z,html:[{tag:"div","class":"caption",text:B}]});A.setAttribute("data-id",this.activity.getId());return A};function b(A){var z=new t.Node();z.views.main=new a(A);return z}return{ArrowView:o,OrthoEdge:p,createNode:x,fitAllIn:v,newConnector:q,requestRender:c,addEdge:f,addParentEdge:d,updateStepColors:w,createInsertOverNode:b}});define("DS/SMAProcWebDiagram/nTwoGraphLayout",["DS/egraph/core","DS/egraph/iact","DS/egraph/utils","DS/egraph/views","DS/SMAProcWebDiagram/ActivityView","DS/SMAProcWebDiagram/ConnectorView","DS/JSCMM/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataContainerUtils","DS/SMAProcWebDiagram/EGraphUtils","DS/Controls/TooltipModel","DS/SMAProcWebDiagram/ProcessView"],function(A,s,B,n,h,i,c,r,l,a,m){var E="rgb(71, 209, 255)";var C="#555555";var o={x:110,y:110};var b=0,D=[],v={},q=40,g=null,x=[],f=[],y=null,p=null,z,k,j="http://www.w3.org/2000/svg",u="http://www.w3.org/1999/xlink",e,t,w;v.edges=f;v.getCurrentProcess=function(){return v.CurrentProcess};v.createnTwoGraph=function(J,G,I){var H,F,K;v.CurrentProcess=J;H=c.getnTwoOrderedFIs(J);F=H.filter(function(L){return L.isActivity()||L.isProcess()});if(I){v.addnTwoPositionsToFIs(F);v.updatenTwoGraph(F)}else{K=v.filterActivityArrayHavingDataflows(F);v.addnTwoPositionsToFIs(K);v.updatenTwoGraph(K)}};v._highlightNodes=function(F,G){if(F&&F.getId()&&x[F.getId()]){x[F.getId()].views.main.elts.node.highlight()}if(G&&G.length){for(var H=0;H<G.length;H++){if(G[H].getId()){x[G[H].getId()]&&x[G[H].getId()].views.main.elts.node.highlightForDF()}}}};v.updatenTwoGraph=function(F){for(var G=0;G<F.length;G++){if(G===0){v.addNewNode(F[G],"first")}else{if(G===F.length-1){v.addNewNode(F[G],"last")}else{v.addNewNode(F[G])}}v.adddEdgesTonTwoView(F[G])}};v.addnTwoPositionsToFIs=function(G,F){var I={x:0,y:0};if(F){I=F;G[0].setnTwoPosition(I)}else{if(G.length){G[0].setnTwoPosition(I)}}for(var H=1;H<G.length;H++){I.x=G[H-1].getnTwoPosition().x+o.x;I.y=G[H-1].getnTwoPosition().y+o.y;G[H].setnTwoPosition(I)}};v.filterActivityArrayHavingDataflows=function(G){var F,H;H=G.filter(function(I){F=r.getDataFlowsForDataContainer(I.getDataContainer()).value;if(F.length){return 1}else{return 0}});return H};v.adddEdgesTonTwoView=function(G){for(var I in x){var J=v.getDataflowCount(G,I);var F;if(J.forwardCount>0){if(!x[I].data.OUT){x[I].data.OUT=v.addNewConnector(A.BorderCstr.RIGHT,q,I+"out","#inArrow");x[I].appendConnector(x[I].data.OUT)}if(!x[G.getId()].data.INP){x[G.getId()].data.INP=v.addNewConnector(A.BorderCstr.TOP,q,I+"in","#outArrow");x[G.getId()].appendConnector(x[G.getId()].data.INP)}var H=v.addNewEdge(x[I].data.OUT,x[G.getId()].data.INP,"forward",J.forwardCount);F=I+"_n2_"+G.getId();f[F]=H}if(J.backwardCount>0){if(!x[G.getId()].data.LEFT){x[G.getId()].data.LEFT=v.addNewConnector(A.BorderCstr.LEFT,q,I+"in","#inArrow");x[G.getId()].appendConnector(x[G.getId()].data.LEFT)}if(!x[I].data.BOTTOM){x[I].data.BOTTOM=v.addNewConnector(A.BorderCstr.BOTTOM,q,I+"out","#outArrow");x[I].appendConnector(x[I].data.BOTTOM)}var H=v.addNewEdge(x[G.getId()].data.LEFT,x[I].data.BOTTOM,"backward",J.backwardCount);F=G.getId()+"_n2_"+I;f[F]=H}}},v.getDataflowCount=function(I,G){if(I.getId()===G){return 0}var H=l.getDataContainer(I);if(G.indexOf("Activity")===0){var F=l.getDataContainer(v.getCurrentProcess().getActivityFromId(G))}else{if(G.indexOf("Process")===0){var F=l.getDataContainer(v.getCurrentProcess())}}var J=r.getDataFlowCountBetweenFIs(H,F,1);var K=r.getDataFlowCountBetweenFIs(F,H,1);return{backwardCount:J,forwardCount:K}};t=function(F){n.SVGConnView.call(this);this.type=F};B.inherit(t,n.SVGConnView);t.prototype.buildConnElement=function(){var G=document.createElementNS(j,"g");var F=document.createElementNS(j,"path");F.setAttribute("class","draw");if(this.type==="#inArrow"){F.setAttribute("d","M 0 9 L 9 0 L 0 -9")}else{if(this.type==="#outArrow"){F.setAttribute("d","M 0 0 L 9 9 L 9 -9")}}F.style.stroke=C;F.style.fill=C;G.appendChild(F);if(B.isIE()){G.children=[F]}return G};z=function(F,H){var G=new A.Edge(new n.SVGEdgeView(),{rel:F,text:H});G.views.main=new v.TextEdgeView(H);G.multiset("geometry",new k(F));return G};k=function(F){this.rel=F};k.prototype.onupdate=function(G){var F=[];if(G.geometry.rel==="forward"){F=[A.PathCmd.M,G.cl1.c.aleft,G.cl1.c.atop,A.PathCmd.L,G.cl2.c.aleft,G.cl1.c.atop,A.PathCmd.L,G.cl2.c.aleft,G.cl2.c.atop]}else{if(G.geometry.rel==="backward"){F=[A.PathCmd.M,G.cl2.c.aleft,G.cl2.c.atop,A.PathCmd.L,G.cl2.c.aleft,G.cl1.c.atop,A.PathCmd.L,G.cl1.c.aleft,G.cl1.c.atop,]}}G.set("path",F)};v.addNewNode=function(H){if(H===null){return false}var K=H.getnTwoPosition();var M=K.x-b;var L=K.y-b;var G=K.width;var N=K.height;var I=null;try{var F=H.getId();if(H.isActivity()){I=new A.Group();I.views.main=new e(H);I.multiset("left",M,"top",L,"width",G,"height",N);I.data={};I.data.id=F;x[H.getId()]=I;g.addNode(I)}else{if(H.isProcess()){I=new A.Node(new w("cmp-process-view",this.CurrentProcess));I.multiset("left",M,"top",L,"width",G,"height",N);I.data={};I.data.id=F;x[H.getId()]=I;g.addNode(I);return I}}}catch(J){console.log("New node creation failed for ntwo view.")}return I};v.TextEdgeView=function(F){n.SVGEdgeView.call(this)};B.inherit(v.TextEdgeView,n.SVGEdgeView);v.makeUniqueID=(function(){function G(){return"--path"+F++}var F=0;return G}());v._highlightEdges=function(F){var I=0;var F=F;var J,H,K;var G=[];if(F.length===0){for(K in f){J=f[K];if(J&&J.view.elts.elt.style.stroke===E){J.view.elts.elt.style.stroke=C;J.view.display.text.style.stroke=C;J.view.display.text.style.fill=C;J.cl1.c.views.main.display.elt.children[0].style.stroke=C;J.cl1.c.views.main.display.elt.children[0].style.fill=C;J.cl2.c.views.main.display.elt.children[0].style.stroke=C;J.cl2.c.views.main.display.elt.children[0].style.fill=C}}D=[];return}if(F.length===1&&D.length===1&&D[0]===F[0]){J=f[K];if(J&&J.view.elts.elt.style.stroke===E){J.view.elts.elt.style.stroke=C;J.view.display.text.style.stroke=C;J.view.display.text.style.fill=C;J.cl1.c.views.main.display.elt.children[0].style.stroke=C;J.cl1.c.views.main.display.elt.children[0].style.fill=C;J.cl2.c.views.main.display.elt.children[0].style.stroke=C;J.cl2.c.views.main.display.elt.children[0].style.fill=C}return}for(K in f){if(F.indexOf(K)===-1){J=f[K];if(J.view.elts.elt.style.stroke===E){J.view.elts.elt.style.stroke=C;J.view.display.text.style.stroke=C;J.view.display.text.style.fill=C;J.cl1.c.views.main.display.elt.children[0].style.stroke=C;J.cl1.c.views.main.display.elt.children[0].style.fill=C;J.cl2.c.views.main.display.elt.children[0].style.stroke=C;J.cl2.c.views.main.display.elt.children[0].style.fill=C;G.push(K)}}}for(K in f){if(F.indexOf(K)>=0){J=f[K];H=v.addNewEdge(J.cl1.c,J.cl2.c,J.data.rel,J.data.text);J.remove();f[K]=H;J=H;if(D.indexOf(K)===-1){D.push(K)}J.view.elts.elt.style.stroke=E;J.view.display.text.style.stroke=E;J.view.display.text.style.fill=E;J.cl1.c.views.main.display.elt.children[0].style.stroke=E;J.cl1.c.views.main.display.elt.children[0].style.fill=E;J.cl2.c.views.main.display.elt.children[0].style.stroke=E;J.cl2.c.views.main.display.elt.children[0].style.fill=E}}for(var I=0;I<G.length;I++){D.splice(D.indexOf(G[I]),1)}};v._unHighlightAllEdges=function(){v._highlightEdges([])};v.getGraphNode=function(F){if(F===null){return null}var G=x[F.getId()];return G};v.addNewConnector=function(G,I,J,H){var F;F=new A.Connector(new t(H),{input:{},id:J});F.multiset(["cstr","attach"],G,["cstr","offset"],I);return F};v.initialize=function(F){if(!g){if(F){y=new s.SM_HTMLGraphView(F,{rootState:new d()});g=new A.EGraph(y)}else{console.error("Graph cannot be created. Please provide a canvas to attach the graph");return false}}return true};v.addNewEdge=function(J,I,F,H){var G=z(F,H);g.addEdge(J,I,G);return G};v.fitAllIn=function(){if(g){a.fitAllIn(g)}};v.CleanUp=function(){if(y&&y.container.firstChild){y.container.removeChild(y.container.firstChild)}g=null;x=[];f=[];y=null;p=new i();v.CurrentProcess=undefined;D=[]};v.reRender=function(F,H){for(var G in x){x[G].remove()}x=[];f=[];D=[];v.createnTwoGraph(v.getCurrentProcess(),F,H);v._highlightNodes(F)};function d(F){s.DefaultRootState.call(this,F)}B.inherit(d,s.DefaultRootState);d.prototype.onmousedown=function(G,F){G.state.onmousemove=undefined;if(F===undefined||F===null){return{consume:false}}if(F.button!==s.Buttons.LEFT){return{consume:false}}this.drag=null;if(F.modifiers===0){G.graph.clearSelection()}G.startdrag(new s.ViewpointMoveDrag(G.graph.view));return{state:s.EndDragOnLeftState,consume:true};return{consume:false}};v.TextEdgeView.prototype.oncreateDisplay=function(K,I){var H,L,G,F;n.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments);this.display.elt.id=v.makeUniqueID();H=document.createElementNS(j,"textPath");H.setAttributeNS(u,"href","#"+this.display.elt.id);var J=document.createTextNode(K.data.text);H.style.font="14px Arial";H.appendChild(J);if(B.isIE()){H.children=[J]}this.display.text=document.createElementNS(j,"text");if(K.geometry.rel==="forward"){G=Math.abs(this.display.elt.grElt.path[1])-Math.abs(this.display.elt.grElt.path[4]);F=String(K.data.text).length;L=Math.abs(G+16)-7*(F-1)+"px";H.setAttribute("startOffset",L);this.display.text.setAttribute("dy","15")}else{if(K.geometry.rel==="backward"){G=Math.abs(this.display.elt.grElt.path[2])-Math.abs(this.display.elt.grElt.path[5]);L=Math.abs(G-6)+"px";H.setAttribute("startOffset",L);this.display.text.setAttribute("dy","-8")}}B.classListAdd(this.display.text,"edge-text");B.classListAdd(this.display.text,"selected");this.display.text.appendChild(H);if(B.isIE()){this.display.text.children=[H]}this.display.text.grElt=K;this.display.text.subElt="text";this.display.text.addEventListener("click",function(){var N=K.cl1.c.node.data.id;var M=K.cl2.c.node.data.id;var P=N+"_n2_"+M;var O=new CustomEvent("nTwoTextClicked",{bubbles:true,detail:{}});if(D.indexOf(P)===-1){O.detail.startNode=N;O.detail.endNode=M}this.dispatchEvent(O)},false);this.display.elt.addEventListener("click",function(){var N=K.cl1.c.node.data.id;var M=K.cl2.c.node.data.id;var P=N+"_n2_"+M;var O=new CustomEvent("nTwoTextClicked",{bubbles:true,detail:{}});if(D.indexOf(P)===-1){O.detail.startNode=N;O.detail.endNode=M}this.dispatchEvent(O)},false);this.structure.root.appendChild(this.display.text);if(B.isIE()){this.structure.root.children=[];this.structure.root.children[1]=H;this.structure.root.children[2]=this.display.text}this.display.text.style.cursor="pointer";this.display.elt.style.cursor="pointer";this.display.text.style.stroke="#555555";this.display.text.style.fill="#555555";this.display.text.tooltipInfos=new m({shortHelp:"Click to view dataflows"})};w=function(F,G){n.HTMLNodeView.call(this);this.type=F;this.data=G};B.inherit(w,n.HTMLNodeView);w.prototype.buildNodeElement=function(){var F=document.createElement(this.type);F.style.position="absolute";if(this.data){F.data=this.data}return F};e=function(F){n.HTMLNodeView.call(this);this.act=null;this.resetDisplayOnCollapse=false;if(F!==undefined&&F!==null){this.act=F}};B.inherit(e,n.HTMLNodeView);e.prototype.buildNodeElement=function(G){if(G.views.main.elts.node===null||G.views.main.elts.node===undefined){var F;F=new h();F.style.position="absolute";F.activity=this.act;F.$.expandCollapseControl.style.display="none";F.$.subflowControl.style.display="none";F.onActivityClicked=function(){this.fire("toggleselection",{activity:this.activity})};return F}return G.views.main.elts.node};return v});define("DS/SMAProcWebDiagram/DiagramHelper",["DS/egraph/core","DS/egraph/views","DS/SMAProcWebDiagram/GraphUtils","DS/SMAProcWebDiagram/EGraphUtils","DS/SMAProcWebDiagram/ActivityView","DS/SMAProcWebDiagram/ConnectorView","DS/SMAProcWebDiagram/StartnodeView","DS/SMAProcWebDiagram/EndnodeView","DS/SMAProcWebDiagram/StepView","DS/SMAProcWebDiagram/GatewayView","DS/SMAProcWebDiagram/ProcessView"],function(c,l,a,e){var g;function j(s,q){if(localStorage.getItem("SIMPRCW_AP_INSERT_OVER")!=="true"){return}var w=q.graphInfo.forestMap;q.insertOverNodes={};for(var p in q.nodeMap){if(p.test(/activity/i)&&w[p]===1){var u=q.nodeMap[p];var t=q.process.getActivityFromId(p);var r=e.createInsertOverNode(t);r.data={id:p};var n=u.left+u.width/2;var o=80;r.multiset("left",n-o/2,"top",u.top-25,"width",o,"height",20);q.insertOverNodes[p]=r;s.addNode(r)}}var v=q.nodeMap.process;if(v){var x=e.createInsertOverNode(q.process);x.data={id:"process"};x.multiset("left",v.left-50,"top",v.top+q.config.activityGeom.height+10,"width",v.width+100,"height",20);q.insertOverNodes.process=x;s.addNode(x)}}function h(y){var B=a.Interval;var q={};var A=0;for(var n in y){if(!n.test(/step/i)){var r=y[n];var v={};v[n]=r;var p=new B([r.left,r.left+r.width],v);var o=[];for(var A in q){if(q[A].overlap(p)){o.push(A)}}if(o.length===0){q[++A]=p}else{var w=o.reduce(function(E,D){return E.union(q[D])},p);o.forEach(function(D){delete q[D]});q[++A]=w}}}var x=[];for(var A in q){x.push(q[A])}x.sort(function(D,E){return D.period[0]-E.period[0]});var t=100;var C=0;while(true){var z=-1;for(var u=0;u<x.length-1;++u){var C=x[u].gap(x[u+1]);if(C>t){z=u+1;C=C-t;break}}if(z!==-1){for(var s=z;s<x.length;++s){x[s].shift(C);for(var A in x[s].data){var r=x[s].data[A];r.set("left",r.left-C)}}}else{break}}}function b(o,n,r){for(var p=0;p<n.length;++p){var q=n[p];e.addEdge(o,q.from,q.fromPort,q.to,q.toPort,q.type,r)}}function k(n,p,s){var o,q;for(var r in p){o=null;q=null;if(r.indexOf("Activity")>=0){o="activity";q=Object.assign({},s.config.activityGeom);if(p[r].width!==s.config.elk.outerWidth){q.width=p[r].width-50}}else{if(r.indexOf("Gateway")>=0){o="gateway";q=Object.assign({},s.config.gatewayGeom)}else{if(r.indexOf("start")>=0){o="start";q=Object.assign({},s.config.startGeom)}else{if(r.indexOf("end")>=0){o="end";q=Object.assign({},s.config.endGeom)}}}}if(o){q.x=p[r].x;q.y=p[r].y+s.config.pageOffsetHeight;e.createNode(n,o,r,q,s)}}}function f(r,u){var q=80;var p=u.nodeMap.start;var o=u.nodeMap.end;var n=(p.left+o.left+u.config.startGeom.width)/2;var t=(p.top-q);var s=Object.assign({x:n,y:t},u.config.activityGeom);e.createNode(r,"process","process",s,u)}function d(n,o){e.addEdge(n,"process","LEFT","start","PROCESS_IN","p2s",o).data.subEdgeType="processEdge";e.addEdge(n,"process","RIGHT","end","PROCESS_IN","p2s",o).data.subEdgeType="processEdge"}function m(o,r,t){for(var s in r){if(s.indexOf("Activity")>=0||s.indexOf("Gateway")>=0){var p=t.process.getActivityFromId(s);var q=p&&p.getParent();if(q){var n=(q.isProcess&&q.isProcess())?"process":q.getId();e.addParentEdge(o,s,"PARENT",n,"CHILD",null,t)}}}}function i(r,u,t,s){var q=this;var o=u.gr;if(!o){o=new c.EGraph();o.addView("main",new l.HTMLGraphView(u.canvas))}c.ObservableData.lock();var n=o.nodes;while(n.first){o.removeNode(n.first)}try{k(o,r.objects,u);h(u.nodeMap);f(o,u);b(o,r.edges,u);d(o,u);if(localStorage.getItem("SIMPRCW_AP_DIAGRAM_SHOW_PARENT")==="true"){m(o,r.objects,u)}j(o,u);c.ObservableData.unlock()}catch(p){console.log(p);t.onError(p)}e.requestRender(function(){if(!u.gr||(u.gr&&s)){e.fitAllIn(o)}u.canvas.focus();e.updateStepColors(u);t.onSuccess(o)});return o}g={drawGraph:i};return g});define("DS/SMAProcWebDiagram/GraphInteractions",["DS/egraph/core","DS/egraph/iact","DS/egraph/utils","DS/egraph/views","DS/SMAProcWebDiagram/ActivityView","DS/SMAProcWebDiagram/ConnectorView","DS/SMAProcWebDiagram/StartnodeView","DS/SMAProcWebDiagram/EndnodeView","DS/SMAProcWebDiagram/StepView","DS/SMAProcWebDiagram/GatewayView"],function(c,b,l,m,h,g,e,k,d,a,f){function j(n){return n!=="activity"&&n!=="gateway"}function i(p,o){function u(z,C,B){if(!B){B=w}var A=p.views.main.rectanglePick(z-w,C-w,z+w,C+w,{edges:true}).filter(function(D){return D.type===c.Type.EDGE});if(A&&A.length===1&&A[0].type===c.Type.EDGE){return A[0]}p.updateSelection([],c.SelectionMode.REPLACE)}function x(){}l.inherit(x,b.SinglePtDrag);function t(z,A,B){this.gr=z;this.node=B;this.type=A;this.left=this.node.left;this.top=this.node.top}l.inherit(t,b.SinglePtDrag);t.prototype.onmove=function(B){if(!B||!B.graphDelta){return}var D=this.left+B.graphDelta[0];var C=this.top+B.graphDelta[1];this.node.multiset("left",D,"top",C);var A=u(B.graphPos[0],B.graphPos[1]);if(A){var z=o.graphInfo.forestMap;if(z[this.node.data.id]!==z[A.data.from]&&o.isEdgeValidForDrop(this.type,A)){this.gr.updateSelection([A],c.SelectionMode.REPLACE)}}this.hasDragged=true};t.prototype.onend=function(){var z=this.gr.selection;if(z.first&&z.first===z.last&&z.first.type===c.Type.EDGE){var A=z.first;var C=A.cl1.c.node.data.id;var B=A.cl2.c.node.data.id;o.moveFlowItem(this.type,this.node.data.id,C,B)}};function s(B){b.ConnConnectDrag.call(this,p,B);if(localStorage.getItem("SIMPRCW_AP_DISABLE_DIAGRAM_CONNECTOR_DISABLE_ACTIVITY")!=="true"){var A=this;var z=o.getCanvas();o.disableByType({type:["process","step","connector"]});Array.prototype.forEach.call(z.querySelectorAll("cmp-activity-view"),function(E){var C=o.nodeMap[E.activity.getId()];var D=C.data.IN;E.disabled=!o.canAcceptConnection(B,D)});Array.prototype.forEach.call(z.querySelectorAll("cmp-gateway-view"),function(E){var C=o.nodeMap[E.data.getId()];var D=C.data.BOTTOM_IN;E.disabled=!o.canAcceptConnection(B,D)})}}l.inherit(s,b.ConnConnectDrag);s.prototype.onaccept=function(A,z){return o.canAcceptConnection(A,z)};s.prototype.clearConnectors=function(){if(localStorage.getItem("SIMPRCW_AP_DISABLE_DIAGRAM_CONNECTOR_DISABLE_ACTIVITY")!=="true"){o.enableByType({type:["process","activity","gateway","step","connector"]})}};s.prototype.onend=function(H){b.ConnConnectDrag.prototype.onend.call(this,H);this.clearConnectors();if(!H){var A=this.otherConnector;if(A&&this.c){o.addNewEdge(this.edge,this.c,A)}else{var G=o.getCanvas().querySelector("cmp-activity-view:hover");var z,F;if(G){z="IN";F="activity"}else{G=o.getCanvas().querySelector("cmp-gateway-view:hover");if(G){z="BOTTOM_IN";F="data"}}if(z&&F){var B=this.c.node.data.id;var D=o.process.getActivityFromId(B);var E=G[F];if(D===E){return}var C=o.nodeMap[E.getId()];var A=C.data[z];if(o.canAcceptConnection(this.c,A)){o.addNewEdge(null,this.c,A)}else{o.dispatchError("Invalid Edge")}}}}};var q=function(z){b.EndDragOnLeftRelease.call(this,z)};l.inherit(q,b.EndDragOnLeftRelease);q.prototype.onmousemove=function(){return{consume:true}};var y=new q();function v(){b.DefaultRootState.call(this)}l.inherit(v,b.DefaultRootState);v.prototype.newDragForElement=function(B,A,C){var z=A&&A.views&&A.views.main&&A.views.main.type;if(z==="cmp-gateway-view"){var D=A.data.id;if(o.isFlowItemDraggable("gateway",D)){return new t(B,"gateway",A)}}else{if(z==="cmp-activity-view"){var D=A.data.id;if(o.isFlowItemDraggable("activity",D)){return new t(B,"activity",A)}}else{if(z==="cmp-process-view"){return new x()}else{if(A.type===c.Type.CONNECTOR){if(o.isConnectorDraggable(A)){return new s(A)}}}}}};v.prototype.onmousedown=function(A,z){if(z.inside&&z.button===b.Buttons.LEFT){if(z.grElt){this.__startDrag=this.newDragForElement(A.graph,z.grElt,z.subElt);if(!this.__startDrag){o.clearSelection()}}else{if(z.modifiers===0){A.graph.clearSelection();o.clearSelection()}if(z.modifiers&b.Modifiers.CTRL){this.__startDrag=new b.ViewpointScaleDrag(A.graphView,z.graphPos)}else{this.__startDrag=new b.ViewpointMoveDrag(A.graphView)}}}return{consume:false}};v.prototype.onmousemove=function(A,z){if(this.__startDrag){if(this.__startDrag instanceof x){return{consume:false}}A.startdrag(this.__startDrag);this.__startDrag=null;return{consume:true,state:y}}return{consume:false}};v.prototype.onmouseup=function(A,z){if(this.__startDrag instanceof s){this.__startDrag.clearConnectors()}this.__startDrag=null;return{consume:false}};v.prototype.oncontextmenu=function(A,z){if(!z.grElt){return{consume:true}}};var n=new v();var r=new b.StateMachine(p,null,n,p.views.main);var w=12;return{rootState:n,stateMachine:r,startAddFlowItem:function(z,A){if(r.state!==n){this.cancelCurrentState()}var B;if(o.options.showGhostImage){B=o.ghostImage;B.src=A.imageUrl}z=z||"activity";r.setState({onmousemove:function(E,D){if(B){B.setStyles({left:(D.clientPos[0])+"px",top:(D.clientPos[1]-10)+"px",display:"block"})}var C=u(D.graphPos[0],D.graphPos[1]);if(C){if(o.isEdgeValidForDrop(z,C)){E.graph.updateSelection([C],c.SelectionMode.REPLACE)}}else{E.graph.updateSelection([],c.SelectionMode.REPLACE)}},onmouseup:function(E,G){try{o.dispatchEvent("onEndCommand",[z])}catch(H){console.log(H)}if(B){B.src="";B.setStyles({display:"none"})}var K=E.graph.selection;if(K.first&&K.first===K.last&&K.first.type===c.Type.EDGE){var C=K.first;var I=C.cl1.c.node.data.id;var J=C.cl2.c.node.data.id;if(j(z)){o.addStep(z,I,J,C)}else{o.addFlowItem(z,I,J)}}else{if(!K.first){if(j(z)){var F=o.getCanvas().querySelectorAll("cmp-activity-view:hover");if(F.length===1){var L=F[0];var D=L.activity;o.addStep(z,D.getId(),D.getId())}else{if(F.length===0){o.dispatchEvent("onAddIsolatedActivityStep",[z,G.graphPos[0],G.graphPos[1]])}}}else{o.dispatchEvent("onAddIsolatedFlowItem",[z,G.graphPos[0],G.graphPos[1]])}}}return{consume:true,state:n}},onuninstall:function(){if(B){B.src="";B.setStyles({display:"none"})}o.endCommand(z)}})},cancelCurrentState:function(){r.setState(n)},removeEventHandlers:function(){r.setState({});r.domRoot.removeEventListener("mousedown",r.boundMouseDownHandler);r.domRoot.removeEventListener("mouseup",r.boundMouseUpHandler);r.domRoot.removeEventListener("contextmenu",r.boundCtxMenuHandler);r.domRoot.removeEventListener("mousemove",r.boundMouseMoveHandler);r.domRoot.removeEventListener(document.body.onwheel!==undefined?"wheel":"mousewheel",r.boundMouseWheelHandler);r.domRoot.removeEventListener("touchstart",r.boundTouchStartHandler);r.domRoot.removeEventListener("dragstart",r.boundDragStartHandler);r.domRoot.removeEventListener("dragenter",r.boundDragEnterHandler);r.domRoot.removeEventListener("dragexit",r.boundDragExitHandler);r.domRoot.removeEventListener("dragleave",r.boundDragLeaveHandler);r.domRoot.removeEventListener("dragover",r.boundDragOverHandler);r.domRoot.removeEventListener("drop",r.boundDropHandler)}}}return{init_state_machine:i}});define("DS/SMAProcWebDiagram/PseudoProcess",["DS/JSCMM/SMAJSCMMActivity","DS/JSCMM/SMAJSCMMGateway","DS/SMAProcWebDiagram/GraphUtils"],function(d,c,h){var a={getId:function(){return"start"},getName:function(){return"start"}};var b={getId:function(){return"end"},getName:function(){return"end"}};function g(i){this.process=i;this.firstChild=null;this.lastChild=null;this.activities=[]}Object.assign(g.prototype,{isProcess:function(){return true},addActivity:function(i){if(this.activities.indexOf(i)<0){this.activities.push(i)}},getFirstChild:function(){return this.firstChild},getLastChild:function(){return this.lastChild},getAllActivities:function(){return this.activities}});function e(i){this.activity=i;this.name=i.getName();this.id=i.getId();this.parent=null;this.children=[];this.outgoing=[];this.incoming=[];this.firstChild=this.lastChild=null}Object.assign(e.prototype,{getParent:function(){return this.parent},getPosition:function(){return this.activity.getPosition()},setPosition:function(i){if(this.activity.setPosition){this.activity.setPosition(i)}},isProcess:function(){return false},isActivity:function(){var i=this.activity.getId();return i==="start"||i==="end"||(this.activity.isActivity&&this.activity.isActivity())},isGateway:function(){return this.activity.isGateway&&this.activity.isGateway()},addActivity:function(i){if(this.children.indexOf(i)<0){this.children.push(i)}},getLastChild:function(){return this.lastChild},getFirstChild:function(){return this.firstChild},getChildren:function(){return this.children},addOutgoing:function(i){if(this.outgoing.indexOf(i)<0){this.outgoing.push(i);i.incoming.push(this)}},getSteps:function(){if(typeof(this.activity.getSteps)==="function"){return this.activity.getSteps()}return[]},getStepCount:function(){return this.getSteps().length},getOutgoingFlowItems:function(){return this.outgoing},getIncomingFlowItems:function(){return this.incoming},getName:function(){return this.name},getId:function(){return this.id}});function f(l){var r=new g(l);var s={};function u(A,B){if(!A){return}var w=A.getId();if(s[w]){return s[w]}var E=new e(A);r.addActivity(E);E.parent=B||r;if(B instanceof e){B.addActivity(E)}s[w]=E;if(A.isActivity&&A.isActivity()){var D=A.getFirstChild();if(D){var F=u(D,E);E.firstChild=F}var x=A.getLastChild();if(x){E.lastChild=s[x.getId()]}var z=A.getChildren();for(var C=0;C<z.length;++C){var y=z[C];if(!s[y.getId()]){u(y,E)}}}A.getOutgoingFlowItems().forEach(function(i){var G=u(i,B);E.addOutgoing(G)});return E}u(l.getFirstChild(),r);var n=l.getChildren();for(var q=0;q<n.length;++q){var m=n[q];if(!s[m.getId()]){u(m,r)}}l.getAllActivities().forEach(function(i){if(!s[i.getId()]){u(i,null)}});var k=new e(a);var p=new e(b);k.parent=r;p.parent=r;r.addActivity(k);r.addActivity(p);r.firstChild=k;r.lastChild=p;var t=l.getFirstChild();if(t){var v=s[t.getId()];k.addOutgoing(v);var j=l.getLastChild();if(j){var o=s[j.getId()];o.outgoing.unshift(p);p.incoming.push(o)}}else{k.addOutgoing(p)}return r}return{init:f}});define("DS/SMAProcWebDiagram/ELK/ELKUtils",["DS/SMAProcWebDiagram/ELK/ELKBuilder","DS/SMAProcWebDiagram/GraphUtils","DS/SMAProcWebDiagram/DiagramHelper","DS/SMAProcWebDiagram/PseudoProcess","DS/ElkJS/ElkJS"],function(l,d,i,a,g){var h;var e="IN",m="OUT",f="INOUT";function j(p,q){function w(A){return p.idToActivityMap[A.getId()].level}Object.assign(p,{activityInfoMap:{},portIndex:0,subFlowIndex:0,childFlowIndex:0,edgeIndex:0,labelIndex:0,boxIndex:0,getUnique:function(A){return A.getId().replace(/-/g,"_")}});var u=l(p);var n=u.initGraph();var x=new Set();function y(H,E){if(x.has(H)){return}x.add(H);var C;if(H.isActivity()&&H.getFirstChild()&&H.getPosition().showChildren){C=u.createSubFlow(H);var B=p.activityInfoMap[H.getId()].childFlow;var G=p.activityInfoMap[H.getId()].subFlow;var D=p.activityInfoMap[B.getId()].node;var A=p.activityInfoMap[G.getId()].node;y(H.getFirstChild(),D);D.edges.push(u.createEdge(B,e,u.getSubFlow(H.getFirstChild()),e));var F=H.getLastChild();if(F){D.edges.push(u.createEdge(u.getSubFlow(F),m,B,m))}C=A}else{C=u.createNode(H)}E.children.push(C);H.getOutgoingFlowItems().forEach(function(J){y(J,E);var I=w(H);var K=w(J);if(I===K){E.edges.push(u.createEdge(u.getSubFlow(H),m,u.getSubFlow(J),e))}else{if(I<K){E.edges.push(u.createEdge(u.getSubFlow(H),f,u.getSubFlow(J),e))}else{E.edges.push(u.createEdge(u.getSubFlow(H),m,u.getSubFlow(J),f))}}})}var v=u.createOuterBox(q.length-1,"SOUTH");var z=p.activityInfoMap[v.id].node;n.children.push(z);var o=q[0];y(o,z);for(var r=1;r<q.length;++r){var s=u.createOuterBox(1,"NORTH");var t=p.activityInfoMap[s.id].node;n.children.push(t);n.edges.push(u.createEdge(v,r,s,1));y(q[r],t)}return n}function c(n,q){var r={};var o={};function p(C,E,D,u){var t=C.id.replace(/_/g,"-");var A={id:t,x:C.x+E+C.width/2,y:C.y+D+C.height/2,width:C.width,height:C.height,label:(C.labels&&C.labels[0].text)};var B=t.indexOf("SubFlow")>=0;var F=t.indexOf("ChildFlow")>=0;if(t.indexOf("Activity")>=0||t.indexOf("Gateway")>=0||t.indexOf("start")>=0||t.indexOf("end")>=0){r[t]=A}if(B){o[t]=A}var w=(q.activityInfoMap[t]||{}).subFlow;if(w){var s=o[w.getId()];A.x=s.x}if(F){C.x=u/2-C.width/2}for(var z=0;z<C.children.length;++z){var v=C.children[z];p(v,E+C.x,D+C.y,C.width)}}p(n,0,0,n.width);return r}var k=new g();function b(t,s,r){var o=a.init(t.process);var n=d.algorithm.getTopologicalOrder(o);var p=d.algorithm.analyze(o,n);t.graphInfo=p;p.elk=Object.assign({},t.config.elk);var q=j(p,n);k.layout(q).then(function(v){var x=c(v,p);var u=d.algorithm.getEdges(o,p.idToActivityMap,n);var w={objects:x,edges:u};i.drawGraph(w,t,s,r)},function(u){console.error(u);s.onError(u)})}h={render:b};return h});define("DS/SMAProcWebDiagram/ProcessDiagram",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/egraph/core","DS/egraph/iact","DS/egraph/utils","DS/egraph/views","DS/SMAProcWebDiagram/ActivityView","DS/SMAProcWebDiagram/ConnectorView","DS/SMAProcWebDiagram/StartnodeView","DS/SMAProcWebDiagram/EndnodeView","DS/SMAProcWebDiagram/StepView","DS/SMAProcWebDiagram/GatewayView","DS/SMAProcWebDiagram/ELK/ELKUtils","DS/SMAProcWebDiagram/EGraphUtils","DS/SMAProcWebDiagram/GraphInteractions","css!DS/SMAProcWebDiagram/ProcessDiagram.css"],function(l,q,g,b,o,k,p,i,e,f,h,n,d,s,m,a,r){function c(t,u){if(!t){console.warn(u)}}var j=q.extend(g,b,{init:function(t,u){this.container=t;this.canvas=null;this.gr=null;this.options=u||{};this.renderQueue=[];this.config={startGeom:{width:30,height:30},endGeom:{width:30,height:30},gatewayGeom:{width:56,height:56,connectorOffset:12},stepGeom:{width:32,height:32,top:24},activityGeom:{width:80,height:120,connectorOffset:40,subflowOffset:20},pageOffsetHeight:100,elk:{outerWidth:200,outerHeight:140,innerStepDim:100,innerStepPadding:10},stepMap:{activity:{imageUrl:require.toUrl("DS/SMAProcWebApp/assets/icons/32/I_SMAWflActivity.png")},gateway:{imageUrl:require.toUrl("DS/SMAProcWebApp/assets/icons/32/I_SMAWflUIWorkflowGateway.png")},"os command":{imageUrl:require.toUrl("DS/SMAProcWebApp/assets/icons/32/SMAWflOSCommand32.png"),extType:"com.dassault_systemes.sma.adapter.OSCommand"},calculator:{imageUrl:require.toUrl("DS/SMAProcWebApp/assets/icons/32/SMAWflCalculator32.png"),extType:"com.dassault_systemes.sma.adapter.Calculator"}},viewMap:{activity:"cmp-activity-view",gateway:"cmp-gateway-view",step:"cmp-step-view",process:"cmp-process-view","cmp-activity-view":"activity","cmp-gateway-view":"gateway","cmp-step-view":"step","cmp-process-view":"process"}};var v=this;this.container.addEventListener("toggleState",function(w){setTimeout(function(){v.refresh()},10)});this.container.addEventListener("toggleSubflowState",function(){this.refresh()}.bind(this))},registerEventListener:function(){this.container.addEventListener("activity-click",this.clickHandler.bind(this));this.container.addEventListener("gateway-click",this.clickHandler.bind(this));this.container.addEventListener("step-click",this.clickHandler.bind(this));this.container.addEventListener("process-click",this.clickHandler.bind(this));this.container.addEventListener("activity-contextmenu",this.contextMenuHandler.bind(this));this.container.addEventListener("gateway-contextmenu",this.contextMenuHandler.bind(this));this.container.addEventListener("step-contextmenu",this.contextMenuHandler.bind(this));this.container.addEventListener("process-contextmenu",this.contextMenuHandler.bind(this))},clickHandler:function(v){var u=this;var t=v.target;if(t&&u.selected!==t){if(u.selected){u.selected.unhighlight()}t.highlight();u.selected=t;u.dispatchEvent("onSelectionChange",[v])}},clearSelection:function(){var t=this;if(t.selected){t.selected.unhighlight();t.selected=null;t.dispatchEvent("onSelectionChange",[])}},contextMenuHandler:function(w){var v=this;var u=w.target;if(u){var t=v.config.viewMap[u.tagName.toLowerCase()];console.log(t+" context menu");v.dispatchEvent("oncontextmenu",[w])}},getCanvas:function(){return this.canvas},disableByType:function(t){this._doByType(function(u){u.setAttribute("disabled",true)},t)},enableByType:function(t){this._doByType(function(u){u.removeAttribute("disabled")},t)},_doByType:function(w,t){var v=this;var u=t||{};var x=u.type||[];x.forEach(function(y){var z=v.config.viewMap[y];if(y==="connector"){z="g.arrow"}if(z&&v.canvas){var A=v.canvas.querySelectorAll(z);Array.prototype.forEach.call(A,w)}})},render:function(u){var t=this;t.process=u;t.reset();t.canvas=l.createElement("div",{id:"canvas",styles:{width:"100%",height:"100%"}}).inject(t.container);if(this.options.showGhostImage){var v=window.widget?window.widget.body:document.body;t.ghostImage=l.createElement("img",{styles:{display:"none",position:"absolute",opacity:0.5,zIndex:42}}).inject(v)}t.hideChildrenSubFlow(t.process);return new Promise(function(x,w){m.render(t,{onSuccess:function(y){t.addInteractions(y);x(t)},onError:function(y){w(y)}})})},hideChildrenSubFlow:function(t){t.getAllActivities().forEach(function(u){if(u.getChildren&&u.getChildren().length===0){u.setPosition({showChildren:false})}})},queueRenderTask:function(t){this.renderQueue.push(t)},handleRenderQueue:function(){try{for(var v=0;v<this.renderQueue.length;++v){var t=this.renderQueue[v];if(t.action==="select"&&this.canvas){var w=this.canvas.querySelector('cmp-activity-view[activity-id="'+t.id+'"]');if(w){w.highlight()}}}this.renderQueue=[]}catch(u){console.error(u)}},refresh:function(u){var t=this;if(this.gr){this.resetData();return new Promise(function(w,v){m.render(t,{onSuccess:function(x){t.restoreAdapterState();t.handleRenderQueue();w(t)},onError:function(x){v(x)}},u)})}},saveActivityState:function(){this._activityStateCache={};this.iterateNodes(function(u){var t=u.getPosition();this._activityStateCache[u.getId()]=Object.assign({},t)},this);console.log("saveActivityState")},restoreActivityState:function(){if(Object.keys(this._activityStateCache||{}).length==0){return}this.iterateNodes(function(u){var v=u.getId();var t=this._activityStateCache[v];if(t){u.setPosition(t)}},this);this._activityStateCache={};console.log("restoreActivityState")},restoreAdapterState:function(){this.iterateSteps(function(t){var u=this._adapterCache[t.getId()];if(u&&u.statusMessage){this.updateStepStatus(t,u.statusMessage)}},this)},resetData:function(){this._activityStateCache={};this.nodeMap={};this.edgeMap={};this.selected=null},reset:function(){this.resetData();if(this.state){this.state.removeEventHandlers();this.state=null}if(this.canvas){this.canvas.destroy();this.gr=null}this._adapterCache={}},addEdge:function(v,u,t){this.edgeMap[v]=this.edgeMap[v]||{};this.edgeMap[v][u]=t},getEdge:function(w,v,u){var t=(this.edgeMap[w]&&this.edgeMap[w][v])||null;if(!t&&u){t=(this.edgeMap[v]&&this.edgeMap[v][w])||null}return t},addInteractions:function(t){this.gr=t;this.state=new r.init_state_machine(t,this)},iterateEdges:function(w,t){for(var v in this.edgeMap){for(var u in this.edgeMap[v]){w.call(t,this.edgeMap[v][u],v,u)}}},iterateNodes:function(w,u){var v=this.process.getAllActivities();for(var t=0;t<v.length;++t){w.call(u,v[t])}},iterateSteps:function(y,w){var x=this.process.getAllActivities();for(var v=0;v<x.length;++v){if(x[v].isActivity()){var t=x[v].getSteps();for(var u=0;u<t.length;++u){y.call(w,t[u],x[v])}}}},startCommand:function(w){this.disableByType({type:["process","gateway","step","connector"]});if(w==="activity"||w==="gateway"){this.disableByType({type:["activity"]})}if(w==="activity"&&this.canvas){var u=this.canvas.querySelectorAll(".insert-over-activity");for(var t=0;t<u.length;++t){var v=u[t];v.classList.add("insertOver")}for(var v=this.canvas.querySelector(".insert-over-process");v;){v.classList.add("insertOver");break}}this.state.startAddFlowItem(w,this.config.stepMap[w])},cancelCommand:function(){if(this.state){this.state.cancelCurrentState()}},endCommand:function(w){this.enableByType({type:["process","activity","gateway","step","connector"]});if(w==="activity"&&this.canvas){var u=this.canvas.querySelectorAll(".insert-over-activity");for(var t=0;t<u.length;++t){var v=u[t];v.classList.remove("insertOver")}for(var v=this.canvas.querySelector(".insert-over-process");v;){v.classList.remove("insertOver");break}}},resolveActivityEndPoints:function(u,t){if(u==="process"){var x=this.process.getFirstChild();var w=this.process.getLastChild();if(t==="start"){u="start";t=(x&&x.getId())||"end"}else{if(t==="end"){u=(w&&w.getId())||"start";t="end"}}}var z=u==="start"?null:this.process.getActivityFromId(u);var y=t==="end"?null:this.process.getActivityFromId(t);var v=this.process;if(z&&y){if(z===y){v=z;z=y=null}else{if(y.getParent()===z){v=z;z=null}else{if(z.getParent()===y){v=y;y=null}else{if(z.getParent()===y.getParent()){v=z.getParent()}}}}}return{parent:v,from:z,to:y}},resolveEdgeEndPoints:function(w){var x=w.data;var u=x.from;var t=x.to;var v=this.process;var A=null,z=null;var y=u.test(/step/i)?u:(t.test(/step/i)?t:null);if(y){v=this.process.getActivityFromId(this.nodeMap[y].data.activityId);A=u.test(/activity/i)?this.process.getActivityFromId(u):v.getStepFromId(u);z=t.test(/activity/i)?this.process.getActivityFromId(t):v.getStepFromId(t);return{parent:v,from:A,to:z}}else{return this.resolveActivityEndPoints(u,t)}},addFlowItem:function(v,u,t){var w=this.resolveActivityEndPoints(u,t);this.dispatchEvent("onAddFlowItem",[v,w.parent,w.from,w.to])},addStep:function(A,y,u,v){var x,D,E,t,C;if(v){if(v.data.subEdgeType==="step-edge"){var z=y.test(/step/i)?y:(u.test(/step/i)?u:null);if(z){t=this.nodeMap[z].data.activityId;x=this.process.getActivityFromId(t);D=y.test(/activity/i)?null:x.getStepFromId(y);E=u.test(/activity/i)?null:x.getStepFromId(u)}else{c(y===u,"expanded empty activity must have an edge connected to same activity");t=y||u;x=this.process.getActivityFromId(t);D=E=null}}else{var w=this.resolveActivityEndPoints(y,u);D=w.from;E=w.to;C=w.parent;this.dispatchEvent("onAddActivityStep",[A,C,D,E]);return}}else{c(y===u,"drop on highlighted activity must have same from and to activity");t=y||u;x=this.process.getActivityFromId(t);var B=x.getSteps();D=B.length===0?null:B[B.length-1];E=null;if(!x.getPosition().showSteps){x.setShowSteps(true);this.gr.update()}}this.dispatchEvent("onAddStep",[A,x,D,E])},addPositionedFlowItem:function(w,v,t,A){var u=w==="activity"?this.config.activityGeom:this.config.gatewayGeom;var z=Object.assign({},u);z.x=t;z.y=A;a.createNode(this.gr,w,v.getId(),z,this)},isFlowItemDraggable:function(u,x){if(u==="activity"||u==="gateway"){var w=this.process.getActivityFromId(x);var v=w.getIncomingFlowItems().length===0&&w.getOutgoingFlowItems().length===0;if(v){var t=w.getParent();return !t||t.getFirstChild()!==w}}},isEdgeValidForDrop:function(t,u){if(u.data.subEdgeType==="processEdge"){return false}if(t==="activity"||t==="gateway"){return u.data.subEdgeType!=="step-edge"}else{return true}},moveFlowItem:function(x,v,u,t){var y=this.resolveActivityEndPoints(u,t);var w=this.process.getActivityFromId(v);this.dispatchEvent("onMoveFlowItem",[x,y.parent,w,y.from,y.to])},isConnectorDraggable:function(t){var w=t.data;var u=t.node.data.id;var v=this.process.getActivityFromId(u);if(!v){return false}if(this.isFlowItemIsolated(v)){return false}if(v.isActivity()){return w==="OUT"&&(v.getOutgoingFlowItems().length===0&&v.getParent().getLastChild()!==v)}else{if(v.isGateway()){return(w==="BOTTOM_OUT")||(w==="OUT"&&!t.children.first)}}},canAcceptConnection:function(w,u){var x=u.data;var t=u.node.data.id;var z=this.process.getActivityFromId(t);if(!z){return false}var A=false;if(z.isActivity()){A=x==="IN"&&z.getIncomingFlowItems().length===0}else{if(z.isGateway()){A=(x==="BOTTOM_IN")||(x==="IN"&&!u.children.first)}}var B=this.process.getActivityFromId(w.node.data.id).getParent();if((z.getOutgoingFlowItems().length!==0||z.getIncomingFlowItems().length!==0)&&B!==z.getParent()){A=false}if(A){var v=w.node.data.id;var y=this.process.getActivityFromId(v);return Boolean(this.isValidEdge(y,z))}return A},addNewEdge:function(y,x,v){var u=x.node.data.id;var t=v.node.data.id;var A=this.process.getActivityFromId(u);var z=this.process.getActivityFromId(t);var w=this.isValidEdge(A,z);if(w){this.dispatchEvent("onEdgeCreated",[w,A,z])}else{if(y){this.gr.removeEdge(y);this.dispatchError("Invalid edge")}}},dispatchError:function(u,t){if(!t){t="error"}this.dispatchEvent("onError",[t,u])},isFlowItemIsolated:function(t){if(typeof t!=="string"){t=t.getId()}return this.graphInfo.forestMap[t]!==1},isValidEdge:function(y,z){if(this.isFlowItemIsolated(z)){var u=z.isActivity()?z.getIncomingFlowItems().length===0:true;if(!u){return}var B=z.getParent();if(!B||B.isProcess()){return y.getParent()}if(B.getFirstChild()==z){return}var A=this.graphInfo.forestMap;if(A[z.getId()]===A[B.getId()]){return}return y.getParent()}var E=y.getOutgoingFlowItems().some(function(F){return F===z});if(E){return}E=z.getOutgoingFlowItems().some(function(F){return F===y});if(E){return}var x=this.graphInfo.discoveryMap;var t=this.graphInfo.finishMap;var C=x[y.getId()];var w=x[z.getId()];var D=t[y.getId()];var v=t[z.getId()];if(C<w||D>v){if(y.getParent()===z.getParent()){return y.getParent()}}},traverseActivity:function(v,w){if(!v){w(v,v.getParent());if(v.isActivity()){var u=v.getChildren();for(var t=0;t<u.length;++t){this.traverseActivity(u[t],w)}}}},getEgraphUtils:function(){return a},showStepStatus:function(u,t){if(!this._adapterCache[u.getId()]){this._adapterCache[u.getId()]={}}this._adapterCache[u.getId()].statusMessage=t;this.updateStepStatus(u,t)},updateStepStatus:function(w,v){var t=this.canvas.querySelector('cmp-step-view[step-id="'+w.getId()+'"]');if(!t){var u=w.getParent().getId();t=this.canvas.querySelector('cmp-activity-view[activity-id="'+u+'"]')}if(t){t.showStatus(v)}}});return j});define("DS/SMAProcWebDiagram/graph",["DS/SMAProcWebDiagram/ProcessDiagram","DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils"],function(b,c,a){return{initialize:function(d){this.processDiagram=new b(d)},assignCallBackObject:function(d){if(this.processDiagram){this.eventRegistered=true;this.processDiagram.addEvent("onAddFlowItem",d.onAddFlowItem);this.processDiagram.addEvent("onAddIsolatedFlowItem",d.onAddIsolatedFlowItem);this.processDiagram.addEvent("onAddStep",d.onAddStep);this.processDiagram.addEvent("onAddActivityStep",d.onAddActivityStep);this.processDiagram.addEvent("onAddIsolatedActivityStep",d.onAddIsolatedActivityStep);this.processDiagram.addEvent("onMoveFlowItem",d.onMoveFlowItem);this.processDiagram.addEvent("onEdgeCreated",d.addEdge);this.processDiagram.addEvent("onError",d.onError)}},CreateGraph:function(e){var d=this;if(d.isCreating){return}d.isCreating=true;var f=function(){d.isCreating=false};return d.processDiagram.render(e).then(function(g){var h=document.createEvent("Event");h.initEvent("graphcreated",true,true);document.dispatchEvent(h)},function(g){console.error(g)}).then(f,f)},removeNode:function(){},updateGraph:function(f,d,e){if(localStorage.getItem("SIMPRCW_AP_DISABLE_RELOAD_PROCESS")!=="true"){return}if(this.processDiagram&&this.processDiagram.process&&this.processDiagram.gr){this.processDiagram.refresh(e)}},updateGraphAll:function(d){if(localStorage.getItem("SIMPRCW_AP_DISABLE_RELOAD_PROCESS")==="true"){return}this._reloadProcess(d)},doUpdateGraph:function(d){if(localStorage.getItem("SIMPRCW_AP_DISABLE_RELOAD_PROCESS")!=="true"){this._reloadProcess(d)}else{if(this.processDiagram&&this.processDiagram.process&&this.processDiagram.gr){this.processDiagram.refresh(d)}}},_reloadProcess:function(e){if(this.processDiagram&&this.processDiagram.process&&this.processDiagram.gr){this.processDiagram.saveActivityState();var d=this;c.loadProcess(this.processDiagram.process.getPhysicalId(),{onSuccess:function(f){a.currentProcess=f;d.processDiagram.process=f;d.processDiagram.restoreActivityState();d.processDiagram.refresh(e)},onFailure:function(f){console.error(f)}})}},CleanUp:function(){if(this.processDiagram){this.processDiagram.reset()}},fitAllIn:function(){if(this.processDiagram&&this.processDiagram.gr){this.processDiagram.getEgraphUtils().fitAllIn(this.processDiagram.gr)}},unhighlight:function(){if(this.processDiagram&&this.processDiagram.gr){this.processDiagram.clearSelection()}},highlight:function(){},queueRenderTask:function(d){if(this.processDiagram){this.processDiagram.queueRenderTask(d)}},addNewActivityNode:function(e){if(e){var f=e.getId();var d=document.querySelector('cmp-activity-view[activity-id="{0}"]'.format(f));if(d){d.activityChanged()}}},zoom:function(e){if(this.processDiagram&&this.processDiagram.gr){var d=this.processDiagram.gr;d.view.zoominc.call(d.view,e)}else{console.error("Could not zoom in graph")}},addPositionedFlowItem:function(f,e,d,g){if(this.processDiagram&&this.processDiagram.gr){this.processDiagram.addPositionedFlowItem(f,e,d,g)}},getGraphNode:function(d){var e;if(this.processDiagram&&this.processDiagram.nodeMap){var f=d.isProcess()?"process":d.getId();e=this.processDiagram.nodeMap[f]}return e},getCurrentProcess:function(){if(this.processDiagram){return this.processDiagram.process}}}});define("DS/SMAProcWebDiagram/Diagram",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/SMAProcWebDiagram/ProcessDiagram"],function(d,a,c){var b='<dom-module id="cmp-diagram">  <template>    <style>    :host {      display: block;      min-height: 100px;    }    :host([hidden]) {      display: none;    }    :host([disabled]) {      pointer-events: none; filter: grayscale(1);    }    :host([readonly]) {      filter: grayscale(1);    }    </style>    <div id="graph_canvas"></div>  </template></dom-module>';a.registerDomModule(b);return d({is:"cmp-diagram",properties:{layout:{value:"process",reflectToAttribute:true},showSteps:{type:Boolean,reflectToAttribute:true},disabled:{type:Boolean,reflectToAttribute:true},readonly:{type:Boolean,reflectToAttribute:true}},listeners:{},setRoot:function(e){console.log(this.is+": setRoot:",e);var f=new c(this.$.graph_canvas);f.render(e).then(function(h){var g=document.createEvent("Event");g.initEvent("graphcreated",true,true);document.dispatchEvent(g)},function(g){console.error(g)})},highlight:function(e){console.log(this.is+": highlight:",e)},unhighlight:function(e){console.log(this.is+": unhighlight:",e)},unhighlightAll:function(){}})});