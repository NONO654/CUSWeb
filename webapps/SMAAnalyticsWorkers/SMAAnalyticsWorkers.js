var FileUtils=function(a){this.context=a};FileUtils.prototype={getRowIndex:function(c){var b=this.context.caseData.rowDescriptors;for(var a=0;a<b.length;a++){if(b[a].rowID===c){return b[a].rowIndex}}},getFilesForRowIDList:function(b){var j=[],h=[],g=[],a,d={},f=[],e=this;g=this.context.parameterUtils.getParametersAsFlatList(this.context.caseData.parameterHierarchy,true,g);for(var c=0;c<g.length;c++){a=g[c];if(a.dataType==="FILE"||a.dataType==="PLMOBJECT"){j.push(a)}}b.forEach(function(k){if(k===0){return}var l=e.getRowIndex(k);j.forEach(function(m){var n={};n.displayName=m.displayName;n.name=m.name;n.id=m.id;var o=e.context.caseData.rawData[m.id][l];f.push(o)});d[k]=f},this);return f}};FileUtils.prototype.constructor=FileUtils;var Comment=function(a,c,b){this.text=c?encodeURIComponent(c):"";this.user=a||{};this.date=b?encodeURIComponent(b):"";this.comments=[];this.likes=[];this.version=self.version;this.id=self.createLiteGUID();this.likedByCurrentUser=false;this.subCommentCount=0;this.likeCount=0};Comment.prototype={thaw:function(f,a){try{for(var c in f){if(f.hasOwnProperty(c)){if(c==="comments"||c==="likes"){this[c]=[];if(Array.isArray(f[c])){f[c].forEach(function(e){var h=null;if(c==="comments"){h=new Comment();h.thaw(e,a);var g=h.getSubCommentCount();this.subCommentCount+=g+1;this[c].push(h)}else{if(c==="likes"){h=new Like();h.thaw(e);this.likeCount+=1;var j=h.getUser();if(j&&j.getUserID()===a.getUserID()){this.likedByCurrentUser=true}this[c].push(h)}}},this)}}else{if(c==="user"){var b=new AdviseUser();b.thaw(f[c]);this[c]=b}else{this[c]=f[c]}}}}}catch(d){console.error("Error while setting comment",d)}return this},freeze:function(){var a={text:this.getText(),date:this.date,version:this.version,id:this.id,comments:null,likes:null,user:this.user.freeze()};if(this.comments&&this.comments.length>0){a.comments=[];this.comments.forEach(function(b){a.comments.push(b.freeze())},this)}if(this.likes&&this.likes.length>0){a.likes=[];this.likes.forEach(function(b){a.likes.push(b.freeze())},this)}return a},getText:function(){try{return decodeURIComponent(this.text)}catch(a){return""}},setText:function(b){try{this.text=encodeURIComponent(b)}catch(a){}},getUser:function(){return this.user},setUser:function(a){if(a instanceof AdviseUser){this.user=a}},getDate:function(){try{return decodeURIComponent(this.date)}catch(a){return""}},setDate:function(a){try{this.date=encodeURIComponent(a)}catch(b){}},getComments:function(){return this.comments},setComments:function(a){this.comments=a},addSubComment:function(b,d,a){if(a===this.id){this.comments.push(new Comment(b,d,Date.now()));this.subCommentCount+=1;return true}else{var c=this.comments.some(function(e){return e.addSubComment(b,d,a)},this);if(c){this.subCommentCount+=1}return c}},getSubCommentCount:function(){return this.subCommentCount},toggleLike:function(a){var b=a.getUserID();var c=false;if(Array.isArray(this.likes)){c=this.likes.some(function(f,g){var d=f.getUser();if(d){var e=d.getUserID();if(b===e){this.likes.splice(g,1);this.likedByCurrentUser=false;return true}}},this)}else{this.likes=[]}if(!c){this.likes.push(new Like(a,Date.now()));this.likedByCurrentUser=true}},toggleLikeOnSubComment:function(a,b){if(Array.isArray(this.comments)){this.comments.some(function(c){if(c.id===b){c.toggleLike(a);return true}if(c.comments){c.toggleLikeOnSubComment(a,b)}},this)}},getLikes:function(){return this.likes},setLikes:function(a){this.likes=a},toString:function(){return(this.user.toString()+"text: "+this.text+" date: "+this.date)}};Comment.prototype.constructor=Comment;var ConditionExpression=function(){this.version=self.version;this.id=self.createLiteGUID()};ConditionExpression.prototype={isSatisfiedForRow:function(a){return true},evaluateViolationForRow:function(a){return 1}};ConditionExpression.prototype.constructor=ConditionExpression;var Constraint=function(b,a){this.id=self.createLiteGUID();this.version=self.version;this.conditions=[];this.context=a;if(b!=null&&Object.keys(b).length>0){this.conditions.push(new ParametricCondition(this.context.caseData.rawData[b.explorationVariable.getId()]));this.setExplorationVariable(b.explorationVariable)||{};this.setType(b.type)||"";this.setBoundValue(b.boundValue)||null;this.setRange(b.range)||[];this.setValueList(b.valueList)||[]}this.rawVals={};this.scaledVals={}};Constraint.prototype={thaw:function(b){for(var a in b){if(b.hasOwnProperty(a)){if(a==="explorationVariable"){this[a]=this.context.paramsById[b[a].id].reference}else{if(a==="conditions"){b[a].forEach(function(d){var c=new ParametricCondition();c.thaw(d,this.context.paramsById[b.conditions[0].explorationVariable.id].reference);this[a].push(c)},this)}else{this[a]=b[a]}}}}return this},freeze:function(){var a={id:this.id,version:this.version,conditions:[]};this.conditions.forEach(function(b){a.conditions.push(b.freeze())},this);return a},setContext:function(a){this.context=a},getType:function(){return this.conditions[0].getType()},getDataType:function(){return this.conditions[0].getExplorationVariable().getDataType()},getDisplayName:function(){return this.conditions[0].getExplorationVariable().getDisplayName()},getName:function(){return this.conditions[0].getExplorationVariable().getName()},getValueList:function(){return this.conditions[0].getValueList()},getRange:function(){return this.conditions[0].getRange()},getBoundValue:function(){return this.conditions[0].getBoundValue()},getConditions:function(){return this.conditions},getExplorationVariable:function(){return this.conditions[0].getExplorationVariable()},setConditions:function(a){this.conditions=a},setExplorationVariable:function(a){this.conditions[0].setExplorationVariable(a)},setType:function(a){this.conditions[0].setType(a)},setBoundValue:function(a){this.conditions[0].setBoundValue(a)},setRange:function(a){this.conditions[0].setRange(a)},setValueList:function(a){this.conditions[0].setValueList(a)},isViolatedForRow:function(c){var b=this;var a=false;b.conditions.forEach(function(d){if(!d.isSatisfiedForRow(b.context.caseData.rawData[b.conditions[0].getExplorationVariable().getId()][c])){a=true}});return a},getAllValues:function(b){var h=this;if(Object.keys(this.rawVals).length===0||Object.keys(this.scaledVals).length===0){var f=this.context.caseData.rawData[b].length,g=[],j=[],k=0;for(var e=0;e<f;e++){var a=this.context.caseData.rawData.rowID[e],d=this.context.caseData.rowDescriptors[a-1];if(d.isExcluded()){continue}var c=0;h.conditions.forEach(function(m){var l=m.evaluateViolationForRow(d);if(!isNaN(l)){c+=l}});g[e]=c;if(g[e]>k){k=g[e]}}if(k>0){for(var e=0;e<f;e++){if(this.context.caseData.rowDescriptors[e].isExcluded()){g[e]=NaN;j[e]=NaN}else{j[e]=g[e]/k}}}this.scaledVals[b]=j;this.rawVals[b]=g}return h.scaledVals[b]},evaluateViolationForRow:function(a,e){var d=this,c=d.getAllValues(a),b=1;return c[e]*b},clearCache:function(){this.scaledVals={};this.rawVals={}}};Constraint.prototype.constructor=Constraint;var ExplorationVariable=function(c){c=c||{};this.name=c.name||"";this.displayName=c.displayName||this.name;this.unit=c.unit||"";this.id=c.id||self.createLiteGUID();var a=c.priority||5;var d=c.role||"";var b=c.structure||"";this.attributesByName={};this.plmParameterId="";this.displayOrder=null;this.weightFactor=-1;this.basketWeight=-1;this.globalWeightFactor=1;this.notes=null;this.comments=null;this.mergedFromVars=[];this.version=self.version;this.setDataType(c.dataType||"");this.priority=a>=0&&a<=5?a:5;this.role="UNKNOWN";if(["INPUT","OUTPUT","SCORE","UNKNOWN"].indexOf(d.toUpperCase())>-1){this.role=d}this.structure=["SCALAR","ARRAY"].indexOf(b)>-1?b:"SCALAR"};ExplorationVariable.prototype={thaw:function(b){for(var a in b){if(b.hasOwnProperty(a)&&typeof b[a]!=="undefined"&&b[a]!==null){this[a]=b[a]}}return this},freeze:function(){return{name:this.name,displayName:this.displayName,unit:this.unit,id:this.id,attributesByName:this.attributesByName,plmParameterId:this.plmParameterId,displayOrder:this.displayOrder,weightFactor:this.weightFactor,basketWeight:this.basketWeight,globalWeightFactor:this.globalWeightFactor,notes:this.notes,comments:this.comments,mergedFromVars:this.mergedFromVars,version:this.version,priority:this.priority,role:this.role,dataType:this.dataType,structure:this.structure}},getId:function(){return this.id},setId:function(a){this.id=a},getDisplayName:function(){return this.displayName},setDisplayName:function(a){this.displayName=a},getPLMParameterID:function(){return this.plmParameterId},setPLMParameterID:function(a){this.plmParameterId=a},getName:function(){return this.name},setName:function(a){this.name=a},getVersion:function(){return this.version},setVersion:function(a){this.version=a},getDisplayOrder:function(){return this.displayOrder},setDisplayOrder:function(a){this.displayOrder=a},getWeightFactor:function(){return this.weightFactor},setWeightFactor:function(a){this.weightFactor=a},getBasketWeight:function(){return this.basketWeight},setBasketWeight:function(a){this.basketWeight=a},getPriority:function(){return this.priority},setPriority:function(a){this.priority=a>=0&&a<=5?a:5},getRole:function(){return this.role},setRole:function(a){this.role=["INPUT","OUTPUT","UNKNOWN"].includes(a.toUpperCase())?a:"UNKNOWN"},getUnit:function(){return this.unit},setUnit:function(a){this.unit=a},getNotes:function(){return this.notes},setNotes:function(a){this.notes=a},getComments:function(){return this.comments},setComments:function(a){this.comments=a},getDataType:function(){return this.dataType},setDataType:function(a){var b=a.toUpperCase();this.dataType=["STRING","REAL","FILE","INTEGER","BOOLEAN","PLMOBJECT"].indexOf(b)>-1?b:"STRING"},getStructure:function(){return this.structure},setStructure:function(a){var a=a.toUpperCase();this.structure=["SCALAR","ARRAY"].indexOf(a)>-1?a:"SCALAR"},getMergedFromVars:function(){return this.mergedFromVars},addMergedFromVariable:function(a){this.mergedFromVars.push(a)},setMergedFromVars:function(a){if(typeof a==="undefined"||a===null){return}this.mergedFromVars=Array.isArray(a)?a:[a]},setGlobalWeightFactor:function(a){this.globalWeightFactor=a},calculateGlobalWeightFactor:function(){return this.weightFactor*this.globalWeightFactor}};ExplorationVariable.prototype.constructor=ExplorationVariable;var FileColumnValue=function(a){this.id=a.id||self.createLiteGUID();this.name=a.name||"";this.displayName=a.displayName||this.name;this.type=a.type||"";this.isImage=true;this.isVideo=false;this.thumbnail=a.thumbnail||"";this.url=""};FileColumnValue.prototype={getId:function(){return this.id},setId:function(a){this.id=a},getDisplayName:function(){return this.displayName},setDisplayName:function(a){this.displayName=a},getName:function(){return this.name},setName:function(a){this.name=a},getType:function(){return this.type},setType:function(a){this.type=a},getIsImage:function(){return this.isImage},setIsImage:function(a){this.isImage=a;this.isVideo=!a},getIsVideo:function(){return this.isImage},setIsVideo:function(a){this.isVideo=a;this.isImage=!a},setThumbnail:function(a){this.thumbnail=a},getThumbnail:function(){return this.thumbnail},setUrl:function(a){this.url=a},getUrl:function(){return this.url},toMap:function(){return{displayName:this.displayName,name:this.name,type:this.type,id:this.id,isImage:this.isImage,isVideo:this.isVideo,url:this.url}}};FileColumnValue.prototype.constructor=FileColumnValue;this.getFileList=function(){var k=[],d,c,l=[];k=self.getParametersAsFlatList(self.caseData.parameterHierarchy,k,true);for(var f=0;f<k.length;f++){d=k[f];if(d.dataType==="FILE"){var g=self.caseData.selectedExplorationDataView.columnsByName[d.name].columnData.values;if(g[0]!=null){c=g[0]}for(var e=0;c==null&&e<nRows;e++){if(g[f]!==null){c=g[0]}}}if(!c){continue}var h="UNKNOWN";var b=false;var a=false;if(d.dataType==="FILE"){h=c.indexOf(".")>=0?c.substring(c.lastIndexOf(".")+1).toUpperCase():"FILE";b=self.isImageFileName(h);a=self.isVideoFileName(h)}else{if(c.indexOf("DesignSight")>=0){h="SIMOBJECT"}else{h="PLMOBJECT"}}l.push({displayName:d.displayName,name:d.name,id:d.id,isImage:b,isVideo:a,type:h})}self.reply(l)};this.setAdviseCaseInfo=function(g,f,c,b,e,d,a){if(g){self.caseData.caseBackgroundInfo=g}if(f){self.caseData.caseMethodsInfo=f}if(c){self.caseData.dueDate=c}if(b){self.caseData.parameterNotes=b}self.caseInfo=self.caseInfo||{};if(e){self.caseInfo.Definition=e}if(d){self.caseData.formulationLockAccess=d}if(a){self.caseData.formulationUnLockAccess=a}self.reply({},true)};this.setGradingMethod=function(a){self.caseData.gradingMethod=a;self.setGradingDirty();self.reply({},true)};this.getDataColumns=function(g,f){var b=[];b=self.getParametersAsFlatList(self.caseData.parameterHierarchy,b,true);var e={};for(var d=0;d<b.length;d++){for(var c=0;c<g.length;c++){if(b[d].id===g[c]){e[g[c]]=[];for(var a=0;a<f.length;a++){e[g[c]][a]=self.caseData.selectedExplorationDataView.columnsByName[b[d].name].columnData.values[self.getRowIndex(f[a])]}}}}self.reply(e)};this.getRowInfo=function(d){var f=self.getRowIndex(d);var c=self.caseData.selectedExplorationDataView.rowDescriptors[f];if(c.objectiveFunction===null){c.objectiveFunction=0}var a=[];a=self.getParametersAsFlatList(self.caseData.parameterHierarchy,a,true);c.parmValues={};var e={};c.violationFlags={};for(var b=0;b<a.length;b++){e=a[b];if(!e.dimensions){c.parmValues[e.id]=self.caseData.selectedExplorationDataView.columnsByName[e.name].columnData.values[f];c.violationFlags[e.id]=self.isViolatedForValue(e,c.parmValues[e.id])}else{c.parmValues[e.id]=self.populateArrayValues(e.dimensions,e,e.name,f)}}self.reply(c)};this.getScoresForRow=function(d){var g=self.getRowIndex(d);var b=[];b=self.getParametersAsFlatList(self.caseData.parameterHierarchy,b,true);var a={};a=self.getAllGroupScoreValuesForRow(self.caseData.parameterHierarchy,g);var e,f;for(var c=0;c<b.length;c++){e=self.caseData.formulation.objectivesByVariableId[b[c].id];if(e){f=evaluateScoreForRow(g,b[c],e,true);if(isNaN(f)){f=0}a[b[c].id]=f}}self.reply(a)};this.getParameterHierarchy=function(a){a=a||false;if(a){self.gradeDesignPoints()}self.reply(buildGroupMap(self.caseData.parameterHierarchy),a)};this.getLikesForDataRow=function(a){var b=self.getRowIndex(a);self.reply(self.caseData.selectedExplorationDataView.rowDescriptors[b].likes||[])};this.getCommentsForDataRow=function(a){var b=self.getRowIndex(a);self.reply(self.caseData.selectedExplorationDataView.rowDescriptors[b].comments||[])};this.getRankListForRowID=function(c){var a=[],d;for(var b=0;b<c.length;b++){d=self.getRowIndex(c[b]);a.push(self.caseData.selectedExplorationDataView.rowDescriptors[d].autoRank)}self.reply(a)};this.getExplorationFilter=function(){var d=self.caseData.selectedExplorationDataView.filter.conditions,b=self.caseData.selectedExplorationDataView.filteringFlagColumn.length,c=0;for(var a=0;a<b;a++){if(self.caseData.selectedExplorationDataView.filteringFlagColumn[a]>0){c++}}d.totalDesigns=b;d.displayedDesigns=c;d.filteredDesigns=b-c;self.reply(d)};this.getExcludedRowIdListData=function(){var b=[],c;for(var a=0;a<self.caseData.selectedExplorationDataView.rowDescriptors.length;a++){c=self.caseData.selectedExplorationDataView.rowDescriptors[a];if(c.grade==="GRADE_EXCLUDED"){b.push(c.rowID)}}self.reply(b)};this.getBestDesignsForEachObjective=function(){var c={},e;for(var g=0;g<Object.keys(self.caseData.formulation.objectivesByVariableId).length;g++){e=self.caseData.formulation.objectivesByVariableId[Object.keys(self.caseData.formulation.objectivesByVariableId)[g]];var a=0,k=[];var b=self.findParameterInGroup(Object.keys(self.caseData.formulation.objectivesByVariableId)[g]);var f=this.getAllValues(b,e);for(var d=0;d<f.length;d++){if(isNaN(f[d])){continue}if(f[d]===a){k.push(d)}else{if(f[d]>a){k=[];k.push(d);a=f[d]}}}var h=[];for(var d=0;d<k.length;d++){h.push(self.getRowID(k[d]))}c[b.id]=h}self.reply(c)};this.getBestOverallDesigns=function(d){var b=d||5;self.gradeDesignPoints();var c=self.cloneObject(self.caseData.selectedExplorationDataView.rowDescriptors);if(Object.keys(self.caseData.formulation.objectivesByVariableId).length>0){c.sort(function(g,f){return f.totalScore-g.totalScore})}else{}var e=[];for(var a=0;a<b&&a<c.length;a++){e.push(c[a].rowID)}self.reply(e)};this.setBasketRowIDList=function(a){self.caseData.basketRowGroup.conditions[0].rowIdList=a;if(a.indexOf(self.caseData.recommendedRowId)<0){self.caseData.recommendedRowId=-1}self.reply(self.caseData.basketRowGroup.conditions[0].rowIdList,true)};this.createPage=function(a){if(!self.caseData.clientStateInfo.pageConfigurations[a]){self.caseData.clientStateInfo.pageConfigurations[a]={};self.caseData.clientStateInfo.pageConfigurations[a].name=a;self.caseData.clientStateInfo.pageConfigurations[a].pageOptions={};self.caseData.clientStateInfo.pageConfigurations[a].visualsByName={};self.caseData.clientStateInfo.pageConfigurations[a].id=self.getUUID()}self.reply({},true)};this.setRecommendedRowID=function(a){self.caseData.recommendedRowID=a;self.reply({},true)};this.setParameterHierarchy=function(a){var b=a;var g=[];g=self.getParametersAsFlatList(self.caseData.parameterHierarchy,g,true);var h=g.slice();var f=self.configureVarGroup(b,null);var e=[];e=self.getParametersAsFlatList(self.caseData.parameterHierarchy,e,false);for(var d=0;d<h.length;d++){for(var c=0;c<e.length;c++){if(h[d].id===e[c].id){g=g.splice(d,1)}}}for(var d=0;d<g.length;d++){f.dataSetVariables.push(g[d])}self.caseData.parameterHierarchy=f;self.caseData.isGradingDirty=true;self.getParameterHierarchy(true)};this.setConstraints=function(c){var a={};var d=c.parameterID;a.explorationVariable=self.findParameterInGroup(d,self.caseData.parameterHierarchy);a.type=c.type;if(c.boundValue){if(a.explorationVariable.dataType==="INTEGER"){a.boundValue=parseInt(c.boundValue,10)}else{a.boundValue=parseFloat(c.boundValue)}}if(c.range){a.range=c.range}if(c.valueList){a.valueList=c.valueList}var b=self.caseData.formulation.constraintsByVariableId[d]||null;if(b!==null){b.forEach(function(f,e){if(f.conditions[0].type===a.type){self.caseData.formulation.constraintsByVariableId[d].splice(e,1)}})}else{self.caseData.formulation.constraintsByVariableId[d]=[]}self.caseData.formulation.constraintsByVariableId[d].push({conditions:[a],id:self.createLiteGUID(),version:"1.0"});self.caseData.isGradingDirty=true;self.reply(self.mapFormulation(),true)};this.setFormulationLockStatus=function(a){self.caseData.formulationLocked=a;self.reply({},true)};this.setBasketWeight=function(a,c){var b=self.findParameterInGroupByReference(a);if(b!==null){b.basketWeight=c}else{b=self.findGroupInGroupByReference(a);b.basketWeight=c}self.caseData.isGradingDirty=true;self.getParameterHierarchy()};this.setCommentsForDataRow=function(a,d){var e=self.getRowIndex(a);var c=self.caseData.selectedExplorationDataView.rowDescriptors[e];if(!c&&c==null){self.reply({});return}c.comments=null;if(!d||d.length===0){self.reply({});return}var b=[];d.forEach(function(f){b.push(self.mapComments(f))});c.comments=b;self.reply({})};this.setLikesForDataRow=function(c,b){var e=self.getRowIndex(c);var d=self.caseData.selectedExplorationDataView.rowDescriptors[e];if(!d&&d==null){self.reply({});return}d.likes=null;if(!b||b.length===0){self.reply({});return}var a=[];b.forEach(function(f){a.push(self.mapLikes(f))});d.likes=a;self.reply({})};this.getNotesForRowID=function(a){self.reply(self.caseData.selectedExplorationDataView.rowDescriptors[self.getRowIndex(a)].notes||"")};this.setNotesForRowID=function(b,a){self.caseData.selectedExplorationDataView.rowDescriptors[self.getRowIndex(b)].notes=a;self.reply({})};this.getFilesForRowIDList=function(d){var c=[],e=[];var a=[],f,h={};a=self.getParametersAsFlatList(self.caseData.parameterHierarchy,a,true);for(var b=0;b<a.length;b++){f=a[b];if(f.dataType==="FILE"||f.dataType==="PLMOBJECT"){c.push(f)}}var g=[];d.forEach(function(j){if(j==0){return}var k=self.getRowIndex(j);c.forEach(function(l){var m={};m.displayName=l.displayName;m.name=l.name;m.id=l.id;var n=self.caseData.rawData[l.id][k];g.push(n)});h[j]=g});return g};this.getParametersAsFlatList=function(d,b,c){b=b||[];if(c){if(typeof d.groups!=="undefined"&&d.groups.length!==0){for(var a=0;a<d.groups.length;a++){b=self.getParametersAsFlatList(d.groups[a],b)}}}[].push.apply(b,d.dataSetVariables);return b};this.getParametersAndScoresAsFlatList=function(c,b){b=b||[];b=self.getParametersAsFlatList(c,b,true);if(typeof c.groups!=="undefined"&&c.groups.length!==0){for(var a=0;a<c.groups.length;a++){b=self.getParametersAndScoresAsFlatList(c.groups[a],b)}}b.push(c.score);return b};this.getRowIndex=function(c){var b=self.caseData.rowDescriptors;for(var a=0;a<b.length;a++){if(b[a].rowID===c){return b[a].rowIndex}}};this.getRowID=function(c){var b=self.caseData.rowDescriptors;for(var a=0;a<b.length;a++){if(b[a].rowID===c){return b[a].rowID}}};this.isSatisfiedForCondition=function(c,b,d){var a=self.evaluateViolationForCondition(c,b,d);if(isNaN(a)){return false}else{if(a>0){return false}else{return true}}};this.isViolatedForValue=function(d,c){if(self.caseData.formulation.constraintsByVariableId[d.id]){var e=self.caseData.formulation.constraintsByVariableId[d.id];for(var b=0;b<e.length;b++){for(var a=0;a<e[b].conditions.length;a++){if(self.isSatisfiedForCondition(d,c,e[b].conditions[a])){return true}}}}return false};this.evaluateViolationForCondition=function(d,c,e){if(c===null){return NaN}if(e.type==="EQUALS_TO"||e.type==="GREATER_THAN"||e.type==="LESS_THAN"){if(e.boundValue===null){throw"Constraint bound value undefined for "+d.name}}else{if(e.type==="ONE_OF"){if(e.valueList===null||e.valueList.length===0){throw"Constraint value list empty for "+d.name}}else{if(e.type==="NOT_IN_RANGE"){if(e.range===null||e.range.length!==2){throw"Invalid constraint range for "+d.name}}else{if(e.type==="IN_RANGE"){if(e.range==null||e.range.length!=2){throw new "Constraint range undefined for "()+d.name}}else{throw"Condition type not set for "+d.name}}}}if(d.dataType==="STRING"||d.dataType==="BOOLEAN"){if(e.type==="EQUALS_TO"){return e.boundValue===c?0:1}else{if(e.type==="ONE_OF"){return e.valueList.indexOf(c)>=0?0:1}else{throw"Invalid constraint for the param "+d.name}}}else{if(d.dataType==="REAL"||d.dataType==="INTEGER"){if(e.type==="EQUALS_TO"){return Math.abs(e.boundValue-c)}else{if(e.type==="GREATER_THAN"){if(c<e.boundValue){return e.boundValue-c}else{return 0}}else{if(e.type==="LESS_THAN"){if(c>e.boundValue){return c-e.boundValue}else{return 0}}else{if(e.type==="IN_RANGE"){if(c<e.range[0]||c>e.range[1]){return 1}else{return 0}}else{if(e.type==="NOT_IN_RANGE"){if(c>e.range[0]&&c<e.range[0]){var b=c-e.range[0];var a=e.range[1]-c;return Math.min(b,a)}else{return 0}}else{if(e.type==="ONE_OF"){if(e.valueList.indexOf(c)>=0){return 0}else{return 1}}}}}}}}}return 0};this.GRADING_FLAG_UNKNOWN=-3;this.GRADING_FLAG_PARETO=2;this.GRADING_FLAG_DOMINATED=0;this.GRADING_FLAG_INFEASIBLE=1;this.GRADING_FLAG_EXCLUDED=-2;this.MAX_HISTOGRAM_BARS=20;this.convertPriorityToWeightFactor=function(a){switch(a){case 0:return 5;case 1:return 5;case 2:return 4;case 3:return 3;case 4:return 2;case 5:return 1;default:return 1}};this.buildGroupMap=function(c){var b={};b.ID=c.id;b.displayName=c.displayName;b.weightFactor=self.calculateGroupGlobalWeightFactor(c);b.priority=c.score.priority;b.priorityWeight=convertPriorityToWeightFactor(c.score.priority);b.basketWeight=c.score.basketWeight;if(typeof c.dataSetVariables!=="undefined"&&c.dataSetVariables.length){b.parameters=[]}b.parameters=[];var d;b.score=buildParameterMap(c.score,self.caseData.selectedExplorationDataView.columnsByName[c.score.id].columnData);for(var a=0;a<c.dataSetVariables.length;a++){d=c.dataSetVariables[a];if(!d.dimensions&&(d.dataType==="REAL"||d.dataType==="INTEGER"||d.dataType==="STRING")){b.parameters.push(buildParameterMap(d,self.caseData.selectedExplorationDataView.columnsByName[d.name].columnData))}else{if(d.dimensions&&(d.dataType==="REAL"||d.dataType==="INTEGER"||d.dataType==="STRING")){b.parameters.push(buildArrayParameterMap(d))}}}b.groups=[];if(c.groups.length>0){for(var a=0;a<c.groups.length;a++){b.groups.push(buildGroupMap(c.groups[a]))}}return b};this.buildArrayParameterMap=function(b){var a={};a.ID=b.id;a.displayName=b.displayName;a.name=b.name;a.dataType=b.dataType;a.role=b.role;a.unit=b.unit;a.notes=b.notes;a.structure="ARRAY";a.dimensions=b.dimensions;a.elementData=self.getArrayElementData(b);if(b.displayOrder){a.displayOrder=b.displayOrder}return a};this.getArrayElementData=function(c){var b={};var a=[];a=self.getArrayElementFlatList(c.name,c.dimensions,a);a.forEach(function(g){var f={};var e=null;var d=null;e=g.replace("][",",");if(self.caseData.selectedExplorationDataView.columnsByName[encodeURIComponent(g)]){d=g}else{if(self.caseData.selectedExplorationDataView.columnsByName[encodeURIComponent(e)]){d=e}}if(d!=null){var h=self.caseData.selectedExplorationDataView.columnsByName[encodeURIComponent(d)].columnData;f=self.getStatsFromData(c,h)}else{if(c.dataType==="INTEGER"||c.dataType==="REAL"){f.min="";f.max="";f.mean="";f.min="";f.lowerQuartile="";f.upperQuartile="";f.stdDev="";f.histogramValues="";f.paretoHistogramValues="";f.infeasibleHistogramValues=""}else{if(c.dataType==="STRING"){subMapstringFreqsDominated="";f.stringFreqsPareto="";f.stringFreqsInfeasible="";f.stringFreqsExcluded="";subMapstringSortedByFreqs=""}}}b[g]=f});return b};this.buildParameterMap=function(c,a){var b=self.getStatsFromData(c,a);b.ID=c.id;b.displayName=c.displayName;b.name=c.name;b.priority=c.priority;b.priorityWeight=convertPriorityToWeightFactor(c.priority);b.weightFactor=calculateParamGlobalWeightFactor(c,self.getParentGroup(c.id));b.basketWeight=c.basketWeight;b.dataType=c.dataType;b.role=c.role;b.unit=c.unit;b.notes=c.notes;b.structure="SCALAR";b.dimensions=c.dimensions||null;return b};this.getStatsFromData=function(d,g){var o={};var e=self.caseData.selectedExplorationDataView.gradingFlagColumn;if(d.dataType==="STRING"){o.stringValues=[];for(var j=0;j<g.values.length;j++){if(e!==null&&e[j]!=null&&e[j]==GRADING_FLAG_EXCLUDED){continue}if(g.values[j]!=null){if(o.stringValues.indexOf(g.values[j])>-1){o.stringValues.push(g.values[j])}}}self.getStringFrequencyData(g,o);return o}else{if(d.dataType==="INTEGER"||d.dataType==="REAL"){var f=Infinity;var m=-1*Infinity;var h=0;var a=[];for(var j=0;j<g.values.length;j++){if(e!==null&&e[j]!==null&&e[j]===GRADING_FLAG_EXCLUDED){continue}if(g.values[j]!==null){var c=g.values[j];h+=c;f=c<f?c:f;m=c>m?c:m;a.push(c)}}var l=a.length;if(l===0){o.min=0;o.max=0;o.mean=0;o.stdDev=0;o.histogramValues=Array.apply(null,new Array(MAX_HISTOGRAM_BARS)).map(Number.prototype.valueOf,0);o.median=0;o.lowerQuartile=0;o.upperQuartile=0;return}var n=MAX_HISTOGRAM_BARS;var p=Array.apply(null,new Array(MAX_HISTOGRAM_BARS)).map(Number.prototype.valueOf,0);if(m==f){o.min=f;o.max=f;o.mean=f;o.stdDev=0;p[0]=l;o.histogramValues=p;o.median=f;o.lowerQuartile=f;o.upperQuartile=f;return o}var r=h/l;h=0;for(var j=0;j<g.values.length;j++){if(e!==null&&e[j]!=null&&e[j]==GRADING_FLAG_EXCLUDED){continue}if(g.values[j]!=null){var c=g.values[j];h+=(c-r)*(c-r);var q=parseInt((c-f)*n/(m-f)/(1+1e-10),10);if(q>=n){q--}p[q]+=1}}var b=h/l;var k=Math.sqrt(b);o.min=f;o.max=m;o.mean=r;o.stdDev=k;o.histogramValues=p;a.sort();o.median=getMedianValue(a,0,l);o.lowerQuartile=getMedianValue(a,0,l/2);o.upperQuartile=getMedianValue(a,l/2+l%2,l/2);return o}else{}}};this.getMedianValue=function(b,a,c){if(c%2==0){return((b[a+c/2-1]+b[a+c/2])/2)}else{return b[Math.floor(a+c/2)]}};this.getStringFrequencyData=function(f,l){var d=self.caseData.selectedExplorationDataView.gradingFlagColumn;var g={};for(var e=0;e<f.values.length;e++){if(f.values[e]===null){continue}var j=f.values[e];if(!g[j]){g[j]=[0,0,0,0,0,0]}g[j][0]+=1;if(d!==null&&d[e]!==null){switch(d[e]){case GRADING_FLAG_DOMINATED:g[j][1]+=1;break;case GRADING_FLAG_PARETO:g[j][2]+=1;break;case GRADING_FLAG_INFEASIBLE:g[j][3]+=1;break;case GRADING_FLAG_EXCLUDED:g[j][4]+=1;break;case RowDescriptor.GRADING_FLAG_UNKNOWN:g[j][5]+=1;break}}else{g[j][1]+=1}}var m=self.sortStringsByFrequency(g);var k=[];var a=[];var b=[];var c=[];var h=[];for(var e=0;e<m.length;e++){h[e]=m[e].string;k[e]=g[m[e].string][1];a[e]=g[m[e].string][2];b[e]=g[m[e].string][3];c[e]=g[m[e].string][4]}l.stringSortedByFreqs=h;l.stringFreqsDominated=k;l.stringFreqsPareto=a;l.stringFreqsInfeasible=b;l.stringFreqsExcluded=c};this.sortStringsByFrequency=function(a){var b=[];var d=Object.keys(a);for(var c=0;c<d.length;c++){b.push({string:d[c],frequency:a[d[c]][0]})}b.sort(function(f,e){return f.frequency-e.frequency});return b};this.getAllGroupScoreValuesForRow=function(b,d){var c={};for(var a=0;a<b.groups.length;a++){c=extendObject(c,getAllGroupScoreValuesForRow(b.groups[a],d))}c[b.id]=self.caseData.selectedExplorationDataView.columnsByName[b.score.id].columnData.values[d];return c};this.evaluateScoreForRow=function(f,e,c,a){var d=getAllValues(e,c);if(isNaN(d[f])){return NaN}var b=1;if(a){b=calculateParamGlobalWeightFactor(e,self.getParentGroup(e.id,self.caseData.parameterHierarchy))}return d[f]*b};this.calculateParamGlobalWeightFactor=function(c,b){var a=calculateGroupGlobalWeightFactor(b);a*=c.weightFactor;return a};this.calculateGroupGlobalWeightFactor=function(c){var a=1;var b=self.getParentGroup(c.id);if(b!==null){a=calculateGroupGlobalWeightFactor(b)}else{if(c.score.weightFactor<0){self.calculateLocalObjectiveWeights(c)}}a*=c.score.weightFactor;return a};this.getAllValues=function(a,b){var e=self.caseData.selectedExplorationDataView.columnsByName[a.name].columnData.values;var c=e.length;var d=new Array(c);var f=new Array(c);var j=Infinity;var k=-1*Infinity;for(var g=0;g<c;g++){if(self.caseData.selectedExplorationDataView.rowDescriptors[g].grade==="GRADE_EXCLUDED"){continue}var h=e[g];if(h==null){continue}if(a.dataType==="STRING"){if(b.type==="TARGET"){if(h===b.value){d[g]=0}else{d[g]=1}}else{if(b.type==="AVOID"){if(h===b.value){d[g]=1}else{d[g]=0}}}}else{if(a.dataType==="INTEGER"||a.dataType==="REAL"){if(b.type==="MINIMIZE"){d[g]=-1*h}else{if(b.type==="MAXIMIZE"){d[g]=h}else{if(b.type==="TARGET"){d[g]=-1*Math.abs(b.value-h)}else{if(b.type==="AVOID"){d[g]=Math.abs(b.value-h)}}}}}}if(!isPredictedRow(self.caseData.selectedExplorationDataView.rowDescriptors[g])){if(d[g]>k){k=d[g]}if(d[g]<j){j=d[g]}}}for(var g=0;g<c;g++){if(self.caseData.selectedExplorationDataView.rowDescriptors[g].grade==="GRADE_EXCLUDED"){d[g]=NaN;f[g]=NaN}else{if(e[g]==null){d[g]=0;f[g]=NaN}else{if(j<k){f[g]=1+99*(d[g]-j)/(k-j)}else{f[g]=100}}}}return f};this.extendObject=function(c,a){for(var b in a){if(hasOwnProperty.call(a,b)){if(c[b]===undefined||c[b]===null){c[b]=a[b]}}}return c};this.cloneObject=function(a){return JSON.parse(JSON.stringify(a))};this.isPredictedRow=function(b){for(var a=0;a<b.tags.length;a++){if(b.tags[a].name==="DATA_SET"&&b.tags[a].value==="PREDICTED"){return true}}return false};this.getParentGroup=function(c,b){if(!b){b=self.caseData.parameterHierarchy}for(var a=0;a<b.dataSetVariables.length;a++){if(b.dataSetVariables[a].id===c){return b}}if(b.score.id===c){return b}if(b.groups||b.groups.length>0){for(var a=0;a<b.groups.length;a++){if(b.groups[a].id===c){return b}}for(var a=0;a<b.groups.length;a++){return self.getParentGroup(c,b.groups[a])}}return null};this.findParameterInGroup=function(c,b){if(!b){b=self.caseData.parameterHierarchy}for(var a=0;a<b.dataSetVariables.length;a++){if(b.dataSetVariables[a].id===c){return self.cloneObject(b.dataSetVariables[a])}}if(b.groups||b.groups.length>0){for(var a=0;a<b.groups.length;a++){return self.findParameterInGroup(c,b.groups[a])}}return null};this.findGroupInGroup=function(c,b){if(!b){b=self.caseData.parameterHierarchy}for(var a=0;a<b.groups.length;a++){if(b.groups[a].id===c){return self.cloneObject(b.groups[a])}}if(b.groups||b.groups.length>0){for(var a=0;a<b.groups.length;a++){return self.findGroupInGroup(c,b.groups[a])}}return null};this.findParameterInGroupByReference=function(c,b){if(!b){b=self.caseData.parameterHierarchy}for(var a=0;a<b.dataSetVariables.length;a++){if(b.dataSetVariables[a].id===c){return b.dataSetVariables[a]}}if(b.groups||b.groups.length>0){for(var a=0;a<b.groups.length;a++){return self.findParameterInGroup(c,b.groups[a])}}return null};this.findGroupInGroupByReference=function(c,b){if(!b){b=self.caseData.parameterHierarchy}for(var a=0;a<b.groups.length;a++){if(b.groups[a].id===c){return b.groups[a]}}if(b.groups||b.groups.length>0){for(var a=0;a<b.groups.length;a++){return self.findGroupInGroup(c,b.groups[a])}}return null};this.getUUID=function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())};this.configureVarGroup=function(b){var c=b.ID;var a=b.displayName;var d=self.findGroupInGroup(c);if(d==null){d=self.createNewGroup(c,a)}self.configureGroup(d,b);return d};self.createNewVariable=function(h,a,f,c,j,e,g,d){var b={};b.displayName=h;b.name=a;b.weightFactor=f;b.role=c;b.unit=j;b.notes=e;b.dataType=g;b.comments=d;b.id=self.getUUID();return b};self.createNewGroup=function(b,a){var c={};c.id=b?b:self.getUUID();c.displayName=a;c.groups=[];c.dataSetVariables=[];c.score=self.createNewVariable("","",-1,"SCORE",null,null,"REAL",null);return c};this.configureGroup=function(c,e){c.displayName=e.displayName;if(c.score==null){c.score=self.createNewVariable("","",-1,"SCORE",null,null,"REAL",null)}if(e.weightFactor){c.score.weightFactor=e.weightFactor}if(e.priority){c.score.priority=e.priority}if(e.basketWeight){c.score.basketWeight=e.basketWeight}if(e.priorityWeight){c.score.priorityWeight=e.priorityWeight}c.dataSetVariables=[];var a=e.parameters;for(var b=0;b<a.length;b++){c.dataSetVariables.push(self.configureVariable(a[b]))}c.groups=[];var d=e.groups;if(d!==null){for(var b=0;b<d.length;b++){c.groups.push(self.configureVarGroup(d[b]))}}return c};this.configureVariable=function(b){var a=self.findParameterInGroup(b.ID,self.caseData.parameterHierarchy,true);if(b.weightFactor){a.weightFactor=b.weightFactor}if(b.priorityWeight){a.priorityWeight=b.priorityWeight}if(b.basketWeight){a.basketWeight=b.basketWeight}if(b.priority){a.priority=b.priority}if(b.unit){a.unit=b.unit}if(b.notes){a.notes=b.notes}return a};this.createNewColumn=function(){var a={};a.columnData={variable:{},values:{}};a.columnStats={};return a};this.gradeDesignPoints=function(){self.gradeExplorationDataView(self.caseData.selectedExplorationDataView)};this.gradeExplorationDataView=function(c){if(!c.isGradingDirty){return}var d=self.caseData.gradingMethod;c.rowDescriptors.forEach(function(e){e.totalScore=0;e.autoRank=0});var a=[];c.rowDescriptors.forEach(function(e){if(!e.violatesMustHaveConstraints||e.grade!=="GRADE_EXCLUDED"||!isNaN(e.objectiveFunction)){a.push(e)}});var b=Array.apply(null,new Array(c.rowDescriptors.length)).map(Number.prototype.valueOf,0);if(a.length>0){if(d==="WEIGHTED_SUM"){self.gradeDesignPointsWeightedSum(a,b)}else{if(d==="TOPSIS"){self.gradeDesignPointsTopsis(a,b)}else{throw"Unknown grading method - "+d}}}if(!c.columnsByName[self.caseData.parameterHierarchy.score.id]){c.columnsByName[self.caseData.parameterHierarchy.score.id]=createNewColumn()}c.columnsByName[self.caseData.parameterHierarchy.score.id].columnData.values=b;c.columnsByName[self.caseData.parameterHierarchy.score.id].columnStats=self.getStatsFromData(self.caseData.parameterHierarchy.score,c.columnsByName[self.caseData.parameterHierarchy.score.id].columnData);self.calculateGroupScores(c);self.caseData.isGradingDirty=false;self.caseData.filteringDirty=true};this.gradeDesignPointsTopsis=function(h,e){var x=[];for(var y in self.caseData.formulation.objectivesByVariableId){x.push(self.caseData.formulation.objectivesByVariableId[y])}var d=x.length;var w=self.caseData.selectedExplorationDataView.rowDescriptors;if(d>0){var s=[];var k=[];var c=[];var f=[];var b=[],n;for(var m=0;m<d;m++){var j=x[m];var o=[];c.push(o);var u=0;w.forEach(function(A,z){if(A.grade==="GRADE_EXCLUDED"||self.isPredictedRow(A)||A.violatesMustHaveConstraints===true){}else{n=self.evaluateScoreForRow(z,j.dataSetVariable,j,true);u+=n*n}});var r=Math.sqrt(u);var q=Infinity;var g=-1*Infinity;w.forEach(function(A,z){if(A.grade!=="GRADE_EXCLUDED"||A.violatesMustHaveConstraints!==true||!self.isPredictedRow(A)){o[z]=self.evaluateScoreForRow(z,j.dataSetVariable,j,true)/r;if(o[z]<q){q=o[z]}if(o[z]>g){g=o[z]}}});s[m]=g;k[m]=q}w.forEach(function(H,D){if(H.grade!=="GRADE_EXCLUDED"||H.violatesMustHaveConstraints!==true){var E=0;var F=0;for(var C=0;C<d;C++){var G=c[C][D];var B=s[C];var A=k[C];E+=(G-B)*(G-B);F+=(G-A)*(G-A)}f[D]=Math.sqrt(E);b[D]=Math.sqrt(F);var z=b[D]/(b[D]+f[D]);H.totalScore=z}})}var t=[];w.forEach(function(z){if(!self.isPredictedRow(z)){t.push(z)}});t.sort(function(A,z){z.totalScore-A.totalScore});var l=t.length;var a=t[l-1].totalScore;var v=t[0].totalScore;t.sort(function(A,z){z.objectiveFunction-A.objectiveFunction});var p=0;h.forEach(function(A){if(v!=a){p++;A.autoRank=p;var z=1+99*(A.totalScore-a)/(v-a);A.totalScore=z;e[A.rowIndex]=z}})};this.gradeDesignPointsWeightedSum=function(a,c){var d=[];a.forEach(function(h){if(!self.isPredictedRow(h)){d.push(h)}});d.sort(function(j,h){return h.objectiveFunction-j.objectiveFunction});var b=d.length;var g=d[b-1].objectiveFunction;var f=d[0].objectiveFunction;a.sort(function(j,h){return h.objectiveFunction-j.objectiveFunction});if(f!==0){var e=0;a.forEach(function(j){if(f==g){j.autoRank=1;j.totalScore=100;c[j.rowIndex]=100}else{e++;j.autoRank=e;var h=1+99*(j.objectiveFunction-g)/(f-g);j.totalScore=h;c[j.rowIndex]=h}})}};this.calculateGroupScores=function(a,g){if(!g){self.caseData.parameterHierarchy.groups.forEach(function(k){self.calculateGroupScores(a,k)});return}else{g.groups.forEach(function(k){self.calculateGroupScores(a,k)})}var h=a.rowDescriptors.length;var b=Array.apply(null,new Array(a.rowDescriptors.length)).map(Number.prototype.valueOf,0);for(var j=0;j<h;j++){var d=a.rowDescriptors[j];if(d.grade==="GRADE_EXCLUDED"){continue}var f=0;for(var e=0;e<g.groups.length;e++){f+=a.columnsByName[g.score.id].columnData.values[j]}for(var e=0;e<g.dataSetVariables.length;e++){var c=self.caseData.formulation.objectivesByVariableId[g.dataSetVariables[e].id]||null;if(c!=null){f+=self.evaluateScoreForRow(j,g.dataSetVariables[e],c,true)}}b[j]=f}if(a.columnsByName[g.score.id]){scoreColumn=self.createNewColumn();a.columnsByName[g.score.id]=scoreColumn}a.columnsByName[g.score.id].columnData.values=b;a.columnsByName[g.score.id].columnStats=self.getStatsFromData(g.score,a.columnsByName[g.score.id].columnData)};this.calculateConstraintsAndObjectives=function(){};this.calculateLocalObjectiveWeights=function(d){d.groups.forEach(function(e){calculateLocalObjectiveWeights(e)});d.weightFactor=1;var c=0;var b=[];d.groups.forEach(function(e){if(!self.hasObjectives(e)){e.weightFactor=0}else{b.push(d);if(d.basketWeight>0){c+=d.basketWeight}else{c+=self.convertPriorityToWeightFactor(d.priority)}}});var a=[];d.dataSetVariables.forEach(function(e){if(!self.isParameterVisibleOnClient(e)||formulation.objectivesByVariableId){e.weightFactor=0}else{a.push(e)}if(e.basketWeight>0){c+=e.basketWeight}else{c+=self.convertPriorityToWeightFactor(e.priority)}});b.forEach(function(e){var f=0;if(e.basketWeight>0){f=e.basketWeight/c}else{f=self.convertPriorityToWeightFactor(e.priority)/c}e.weightFactor=f});a.forEach(function(e){var f=0;if(e.basketWeight>0){f=e.basketWeight/c}else{f=self.convertPriorityToWeightFactor(e.getPriority())/c}e.weightFactor=f})};this.hasObjectives=function(a){a.groups.forEach(function(b){if(self.hasObjectives(b)){return true}});a.dataSetVariables.forEach(function(b){if(self.caseData.formulation.objectivesByVariableId[b.name]){return true}});return false};this.isParameterVisibleOnClient=function(a){if(a.dataType==="REAL"||a.dataType==="INTEGER"||a.dataType==="STRING"){return true}return false};this.mapFormulation=function(){var d={};var a=[];for(var b in self.caseData.formulation.objectivesByVariableId){var e={};e.parameterID=b;e.type=self.caseData.formulation.objectivesByVariableId[b].type;e.rank=self.caseData.formulation.objectivesByVariableId[b].rank;if(self.caseData.formulation.objectivesByVariableId[b].value!==null){e.value=self.caseData.formulation.objectivesByVariableId[b].value}a.push(e)}if(a.length>0){d.objectives=a}var f=[];for(var b in self.caseData.formulation.constraintsByVariableId){var c=self.caseData.formulation.constraintsByVariableId[b];c.forEach(function(h){var g={};g.parameterID=b;g.type=h.conditions[0].type;if(h!==null){g.boundValue=h.conditions[0].boundValue}if(h!=null){g.range=h.conditions[0].range}if(h!=null){g.valueList=h.conditions[0].valueList}f.push(g)})}if(f.length>0){d.constraints=f}return d};this.mapComments=function(b){var a={};a.text=b.text;a.date=b.date;a.userID=b.userID;if(b.likes){a.likes=self.mapLikes(b.likes)}if(b.comments){a.comments=self.mapComments(b.comments)}return a};this.mapLikes=function(a){return a};this.setGradingDirty=function(){self.caseData.isGradingDirty=true};this.populateArrayValues=function(b,f,d,m){var a=b.slice();var g=[];if(a.length==1){for(var k=0;k<a[0];k++){var l=null;var e=null;var c=f.name+"["+k+"]";l=c.replace("][",",");if(self.caseData.selectedExplorationDataView.columnsByName[encodeURIComponent(c)]){e=c}else{if(self.caseData.selectedExplorationDataView.columnsByName[encodeURIComponent(l)]){e=l}}if(e){var o=self.caseData.selectedExplorationDataView.columnsByName[encodeURIComponent(e)].columnData.values[m];g.push(o)}else{g.push("")}}}else{var h=a[0];a.splice(0,1);for(var k=0;k<h;k++){var n=d+"["+k+"]";g.push(self.populateArrayValues(a,f,n,m))}}return g};this.getArrayElementFlatList=function(b,e,d){var f=e.slice();if(f.length==1){for(var a=0;a<f[0];a++){d.push(b+"["+a+"]")}}else{var c=f[0];f.splice(0,1);for(var a=0;a<c;a++){self.getArrayElementFlatList(b+"["+a+"]",f,d)}}return d};this.isVideoFileName=function(b){if(b==null){return false}var a=["3gp","asf","avchd","avi","flv","m1v","m2v","m4v","mpeg","mp4","mpeg4","mpg","mpe","mov","mkv","wmv","rm","swf","ogg","nsv"];if(a.indexOf(b.toLowerCase())>=0){return true}return false};this.isImageFileName=function(b){var a=["jpeg","jpg","jfif","tiff","tif","gif","png","bmp","ppm","pgm","pbm","pnm","pfm","svg"];if(a.indexOf(b.toLowerCase())>=0){return true}return false};var FileReaderUtils=function(a){this.context=a};FileReaderUtils.prototype={readCsvToObject:function(e){var g=e.split("\n"),c=g[0].split(","),d={},a={},h=this;c.forEach(function(j){d[j]=[];a[j]=h.context.parameterUtils.getParameterFromHierarchy(j)});for(var b=1;b<g.length;b++){var f=g[b].split(",");c.forEach(function(k,j){if(a[k].dataType==="INTEGER"){d[k].push(parseInt(f[j],10))}else{if(a[k].dataType==="REAL"){d[k].push(parseFloat(f[j]))}else{d[k].push(f[j])}}})}return d},readTsvToObject:function(e){var g=e.split("\n"),c=g[0].split("\t"),d={},a={},h=this;c.forEach(function(j){d[j]=[];a[j]=h.context.parameterUtils.getParameterFromHierarchy(j)});for(var b=1;b<g.length;b++){if(g[b]===""){continue}var f=g[b].split("\t");c.forEach(function(l,j){if(a[l].dataType==="INTEGER"){d[l].push(parseInt(f[j],10))}else{if(a[l].dataType==="REAL"){d[l].push(parseFloat(f[j]))}else{if(a[l].dataType==="PLMOBJECT"){try{d[l].push(JSON.parse(f[j]))}catch(k){d[l].push(f[j])}}else{if(a[l].dataType==="FILE"){try{d[l].push(JSON.parse(f[j]))}catch(k){d[l].push(f[j])}}else{if(l==="rowID"){d[l].push(parseInt(f[j]))}else{d[l].push(f[j])}}}}}})}return d}};FileReaderUtils.prototype.constructor=FileReaderUtils;var Formulation=function(a,c,b){this.id=self.createLiteGUID();this.version=self.version;(this.context=b),(this.objectivesByVariableId=a||{});this.constraintsByVariableId=c||{}};Formulation.prototype={setContext:function(a){this.context=a},getObjectives:function(c){if(c){var a={};for(var b in this.objectivesByVariableId){if(this.objectivesByVariableId.hasOwnProperty(b)){a[b]=this.objectivesByVariableId[b].freeze()}}return a}else{return this.objectivesByVariableId||{}}},getConstraints:function(b){if(b){var c={};for(var a in this.constraintsByVariableId){if(this.constraintsByVariableId.hasOwnProperty(a)){c[a]=[];this.constraintsByVariableId[a].forEach(function(d){c[a].push(d.freeze())})}}return c}else{return this.constraintsByVariableId||{}}},setObjectives:function(a){this.objectivesByVariableId=a||{}},setConstraints:function(a){this.constraintsByVariableId=a||{}},addConstraint:function(a,b){if(typeof a!=="undefined"&&a!==null&&a.length>0&&b instanceof Constraint){if(!Array.isArray(this.constraintsByVariableId[a])){this.constraintsByVariableId[a]=[]}this.constraintsByVariableId[a].push(b)}},addObjective:function(b,a){if(typeof b!=="undefined"&&b!==null&&b.length>0&&a instanceof Objective){if(!this.objectivesByVariableId){this.objectivesByVariableId={}}this.objectivesByVariableId[b]=a}},thaw:function(c){for(var b in c){if(c.hasOwnProperty(b)){switch(b){case"constraintsByVariableId":for(var a in c[b]){this[b][a]=[];if(c[b].hasOwnProperty(a)){c[b][a].forEach(function(e){var f=new Constraint({},this.context);this[b][a].push(f.thaw(e))},this)}}break;case"objectivesByVariableId":for(var a in c[b]){this[b][a]={};if(c[b].hasOwnProperty(a)){var d=new Objective({},this.context);this[b][a]=d.thaw(c[b][a])}}break;default:this[b]=c[b];break}}}},freeze:function(){var a={};for(var c in this.objectivesByVariableId){if(this.objectivesByVariableId.hasOwnProperty(c)){a[c]=this.objectivesByVariableId[c].freeze()}}var b={};for(var c in this.constraintsByVariableId){if(this.constraintsByVariableId.hasOwnProperty(c)){b[c]=this.constraintsByVariableId[c].map(function(d){return d.freeze()})}}return{id:this.id,objectivesByVariableId:a,constraintsByVariableId:b}},checkConstraintStatus:function(e){var d=false,b=true,a=[],c=Object.keys(this.constraintsByVariableId);if(c instanceof Array){c.forEach(function(f){this.checkIndividualConstraintStatus(e,f,function(h,g){if(h){b=false;if(g){d=true}a.push(f)}})},this)}return{violatesMustHaveConstraints:d,isFeasible:b,constraintsViolated:a}},checkIndividualConstraintStatus:function(d,a,c){var b=this;if(b.constraintsByVariableId&&b.constraintsByVariableId[a] instanceof Array){b.constraintsByVariableId[a].forEach(function(e){var f=e.isViolatedForRow(d);var g=f?e.getExplorationVariable().getPriority()===0:false;c(f,g)})}},clearCache:function(){Object.keys(this.constraintsByVariableId).forEach(function(a){var b=this.constraintsByVariableId[a];if(b instanceof Constraint){b.clearCache()}},this);Object.keys(this.objectivesByVariableId).forEach(function(b){var a=this.objectivesByVariableId[b];if(a instanceof Objective){a.clearCache()}},this)}};Formulation.prototype.constructor=Formulation;var Getters=function(){};Getters.prototype={findIndexForId:function(b){var c=this.caseData.rowDescriptors.length;for(var a=0;a<c;a++){if(this.caseData.rowDescriptors[a].rowID===b){return a}}return -1},getCompareTableData:function(l,q){var c={metaData:{},rowHierarchy:[],columnData:[]},m=this;c.metaData.numRows=0;c.metaData.numAlternatives=0;if(m.caseData.rawData&&m.caseData.rawData.rowID){c.metaData.numAlternatives=m.caseData.rawData.rowID.length}var k="ACTUAL";var d="none";if(q){this.setBaselineRow(q.baselineId);if(q.view){k=q.view}if(q.sortOrder){d=q.sortOrder}}if(!l||!l.columns){if(typeof this.caseData.rawData.rowID==="undefined"){m.caseData.rowDescriptors.forEach(function(r){var j=false;if(r.hasTag({name:"hidden"})&&r.getTag("hidden").value===true){j=true}if(j===false){c.columnData.push({id:r.id})}},this)}else{this.caseData.rawData.rowID.forEach(function(t,j){if(typeof t!=="undefined"){var u=this.findIndexForId(t);var s=this.caseData.rowDescriptors[u];if(typeof s!=="undefined"){var r=false;if(s.hasTag({name:"hidden"})&&s.getTag("hidden").value===true){r=true}if(r===false){c.columnData.push({id:s.id})}}}},this)}}else{var b=this.caseData.rawData.rowID||[];b.some(function(t,j){if(l.columns.length===0||typeof t==="undefined"){return true}var w=this.findIndexForId(t);var s=this.caseData.rowDescriptors[w];if(typeof s==="undefined"){return false}var v=l.columns.indexOf(s.id);if(v===-1){return false}else{l.columns.splice(v,1)}var u={id:s.id,rowID:s.getRowID(),rowIndex:s.rowIndex,name:decodeURIComponent(s.getRowName()),headerDisplay:[],values:{},score:s.getObjectiveFunction(),rank:s.getAutoRank(),isRecommended:typeof this.recommendedRows[s.getRowID()]!=="undefined",commentCount:s.commentCount,liked:s.likedByCurrentUser,likes:s.likes};if(typeof s.hasTag==="function"){if(s.hasTag({name:"PLMOID"})){u.PLMOID=s.getTag("PLMOID").value}if(s.hasTag({name:"PLMdType"})){u.dType=s.getTag("PLMdType").value}if(s.hasTag({name:"PLM_DESCRIPTION"})){u.description=s.getTag("PLM_DESCRIPTION").value}}var r=function(x){var E=this.paramsById[x];if(E){var A=this.caseData.rawData[x];if(typeof A!=="undefined"){var B=A[j];var D=E.reference.getDataType();if(D==="REAL"||D==="INTEGER"){if(s.id!==this.baselineRow.id){B=this.parameterUtils.parseParameterValue(x,B,k)}var z=false;if(this.caseData.formulation instanceof Formulation){var C=this.caseData.rawData.rowID.indexOf(s.rowID);this.caseData.formulation.checkIndividualConstraintStatus(C,x,function(G){if(G){z=G}})}var F=decodeURIComponent(E.reference.unit)||"";if(this.caseData.rowDescriptors[s.rowID-1].tags.length>2&&E.reference.mergedFromVars.length>0&&!isNaN(B)&&B!==""&&B!==null){var y=null;E.reference.mergedFromVars.forEach(function(H){var G=this.paramsById[H];if(G.datasetID===s.getTag("PLMOID").getValue()){y=G}},this);if(y!==null){F=this.parameterUtils.getUnitFromUnmerged(y.reference.id)}}u.values[x]={value:B,thresholdViolation:z,unit:F}}else{u.values[x]=B}}else{u.values[E.reference.id]=""}}};if(Array.isArray(l.rows)){l.rows.forEach(r,this)}c.columnData.push(u)},this)}var o=q.nameFilter||"";o=o.toLowerCase();var p={getFormulation:true,nameFilter:o};var n=l&&l.rows?l.rows:null;if(this.caseData.parameterHierarchy instanceof VarGroup){var a=this.parameterUtils.getParamHierarchyForRange(this.caseData.parameterHierarchy,n,p);if(a.hierarchy&&a.hierarchy.children){c.rowHierarchy=a.hierarchy.children}c.metaData.numRows+=a.parameterCount}if(d!=="none"){var f=this.getColumnIdsByScore(d);if(f&&f.length>0){var e=[];for(var h=0;h<f.length;h++){for(var g=0;g<c.columnData.length;g++){if(f[h]===c.columnData[g].id){e.push(c.columnData[g])}}}c.columnData=e}}return c},getAlternatives:function(){var a=this.caseData.rawData.rowID;var b=[];this.caseData.rowDescriptors.forEach(function(f){if(f.grade!=="GRADE_EXCLUDED"&&a.indexOf(f.getRowID())!==-1){var e=false;if(f.hasTag({name:"hidden"})&&f.getTag("hidden").value===true){e=true}var d=undefined,g=undefined,c=undefined;if(typeof f.hasTag==="function"){if(f.hasTag({name:"PLMOID"})){d=f.getTag("PLMOID").value}if(f.hasTag({name:"PLMdType"})){g=f.getTag("PLMdType").value}if(f.hasTag({name:"PLM_DESCRIPTION"})){c=f.getTag("PLM_DESCRIPTION").value}}b.push({hidden:e,mapped:true,id:f.id,rowID:f.getRowID(),PLMOID:d,dType:g,description:c,rowIndex:f.rowIndex,name:decodeURIComponent(f.getRowName()),score:f.getObjectiveFunction(),rank:f.getAutoRank(),isRecommended:typeof this.recommendedRows[f.getRowID()]!=="undefined",})}},this);return b},getParameterIdList:function(b){var c=null,d=b instanceof String?b.toLowerCase():"";var a=function(g){var f=g.getDisplayName();f=f.toLowerCase();if(f.indexOf(d)>=0){c.children.push({id:g.getId(),type:g.getDataType()})}};var e=function(h){var g=c;c={id:h.getId(),type:"GROUP",children:[]};var j=h.getDataSetVariables();if(j instanceof Array){j.forEach(a,this)}var f=h.getGroups();if(f instanceof Array){f.forEach(e,this)}c=g};e(this.caseData.parameterHierarchy);return c.children},getColumnIdsByScore:function(d){var f=this.caseData.rawData.rowID.slice()||[];var c=[];var e=0;f.forEach(function(j){var k=this.findIndexForId(j);var h=this.caseData.rowDescriptors[k];var g=false;if(h.hasTag({name:"hidden"})&&h.getTag("hidden").value===true){g=true}if(g===false){c.push({index:e++,id:h.getId(),score:h.getObjectiveFunction(),rank:h.getAutoRank()})}},this);var b=d==="ascending"?function(h,g){if(h.score>g.score){return 1}if(h.score<g.score){return -1}if(h.rank<g.rank){return 1}if(h.rank>g.rank){return -1}return 0}:d==="descending"?function(h,g){if(h.score<g.score){return 1}if(h.score>g.score){return -1}if(h.rank>g.rank){return 1}if(h.rank<g.rank){return -1}return 0}:function(){return 0};c.sort(b);var a=c.map(function(g){return g.id});return a},getParameterMergeData:function(b){var c={metaData:{},rowHierarchy:[],columnData:[]},e=this;c.metaData.numAlternatives=0;c.metaData.numRows=0;c.rowHierarchy=[];var a={getFormulation:false,getRowValueRange:true,useUnMerged:true,flatten:false,filterSet:e.parameterUtils.unmergedFilters};e.parameterUtils.setNameFilterValue("");var d=null;if(this.datasetIDList){this.datasetIDList.forEach(function(j,h){var f=e.parameterUtils.getParamHierarchyForRange(e.unmergedData.parameterHierarchy[j],d,a),k=e.datasetsList.filter(function(l){return(l.id===j||l.physicalID===j)})[0];if(e.simObjIDList.indexOf(j)>-1){if(typeof f.hierarchy.id==="undefined"){var g=e.unmergedData.KWEData[j];f.hierarchy.id=j;f.hierarchy.name=g?g.title:k.title}}if((f.hierarchy&&f.hierarchy.children.length>0)||(d&&d.indexOf(j)>-1)){c.rowHierarchy.push(f.hierarchy);c.metaData.numRows+=f.parameterCount}})}return c},getAllParametersAsArray:function(){var c=[];var a=this.parameterUtils.getAllParametersAsFlatList();for(var d=0;d<a.length;d++){var b=a[d];c.push({id:b.id,name:b.name,displayName:b.displayName,plmParameterId:b.plmParameterId,mergedFromVars:b.mergedFromVars})}return c},getAllFilesForRowIdAsArray:function(b){var a=[];a=this.fileUtils.getFilesForRowIDList([b+1]);return a},getAllParametersAsObject:function(){var a=self.utils.parameterUtils.getAllParametersAsFlatList(),c={};for(var d=0;d<a.length;d++){var b=a[d];c[b.id]={id:b.id,name:b.displayName,plmParameterId:b.plmParameterId}}return c},getKWEData:function(a){var b=null;if(this.unmergedData&&this.unmergedData.KWEData&&this.unmergedData.KWEData[a]){b=this.unmergedData.KWEData[a]}return b},getCaseData:function(){var f={};var a={};a[this.datasetIDList[0]]=this.caseData.formulation.freeze();f["formulation.json"]=JSON.stringify(a);var e={};e[this.datasetIDList[0]]=this.caseData.parameterHierarchy.freeze();f["parameterHierarchy.json"]=JSON.stringify(e);var b={};b[this.datasetIDList[0]]=this.caseData.rowDescriptors;f["rowDescriptors.json"]=JSON.stringify(b);var c=function(){var h="";var r=Object.keys(this.caseData.rawData);var t=[];var g=r.length-1;for(var n=0;n<g;++n){h+=r[n];t[n]=this.parameterUtils.getParameterFromHierarchy(r[n]).dataType;h+="\t"}h+="\n";var m=this.caseData.rowDescriptors.length;for(var n=0;n<m;++n){for(var l=0;l<g;++l){var k=r[l];var s=this.caseData.rawData[k][n];var q="";var o=t[l];if(o==="PLMOBJECT"){q=JSON.stringify(s)}else{if(o==="FILE"){try{q=JSON.stringify(s)}catch(p){q=s}}else{q=s}}h+=q;h+="\t"}h+="\n"}return h};var d=c.call(this);f["rawData.tsv"]=d;f["basket.tsv"]=d;self.reply(f)},getCommentsForRow:function(c){var a=[];var b=this.caseData.rowDescriptors[c];if(b){a=b.comments||a}return a},getCaseModified:function(){return this.isCaseModified}};var SimulationObjectCaseBuilder=function(a,b){this.context=a;this.rawData=b||{};this.adviseCase={columnData:{rowID:[]}}};SimulationObjectCaseBuilder.prototype={setRawData:function(a){this.rawData=a},buildRowDescriptor:function(d,g,h,f){var e=new RowDescriptor(h,f),b=new RowTag("DATA_SET",g.objectTitle),c=new RowTag("PLMOID",d),a=[];a.push(b);a.push(c);e.setRowName(g.objectTitle);e.setTags(a);return e},findRAParameterType:function(a,c){if(a&&["STRING","REAL","FILE","INTEGER","BOOLEAN","PLMOBJECT"].indexOf(a.toUpperCase())>-1){return a}else{try{if(c==parseInt(c,10)){return"INTEGER"}else{if(c==parseFloat(c)){return"REAL"}else{return"STRING"}}}catch(b){return"STRING"}}},buildParameterHierarchy:function(c,e,h){var g=this;if(!e){e=new VarGroup(c.objectTitle,h,"")}if(c.parameters&&c.parameters.length>0){for(var a=0;a<c.parameters.length;a++){var f=c.parameters[a],b=new ExplorationVariable({name:f.nameWithPath,unit:f.unit,priority:0,dataType:f.valueType.toUpperCase()});b.setDataType(g.findRAParameterType(f.valueType,f.value));g.populateColumnData(b.getId(),b.getDataType(),f.value,b);e.addDataSetVariable(b)}}if(c.containedObjects&&c.containedObjects.length>0){for(var a=0;a<c.containedObjects.length;a++){var d=new VarGroup(c.containedObjects[a].objectTitle,null,e.getId());e.addGroup(d);g.buildParameterHierarchy(c.containedObjects[a],d)}}return e},populateColumnData:function(a,h,j,b){var d=this;if(typeof a==="undefined"||a===null||a.length===0){return}var k=d.adviseCase.columnData[a];if(!k){d.adviseCase.columnData[a]=[]}switch(h.toUpperCase()){case"INTEGER":d.adviseCase.columnData[a].push(parseInt(j,10));break;case"REAL":d.adviseCase.columnData[a].push(parseFloat(j));break;case"PLMOBJECT":break;case"FILE":try{var c=JSON.parse(j);d.adviseCase.columnData[a].push(c)}catch(f){var g=new FileColumnValue({name:b.name,displayName:b.name,type:j.substring(j.lastIndexOf(".")+1).toUpperCase()});g.setIsImage(true);g.setIsVideo(false);j=j.split("\\").join("/");g.setUrl(j);d.adviseCase.columnData[a].push(g.toMap())}break;case"BOOLEAN":d.adviseCase.columnData[a].push(j=="true");break;default:d.adviseCase.columnData[a].push(j||"");break}},buildFormulation:function(a,b){var c=this;return new Formulation()},build:function(b){var c=this,a=b||1;if(typeof c.rawData==="undefined"||c.rawData===null){return{}}c.rawData.forEach(function(d){for(var e in d){if(d.hasOwnProperty(e)){var g=d[e],h=a-1,f=a;if(c.adviseCase[e]){continue}caseObject=c.adviseCase[e]={rowDescriptors:[],parameterHierarchy:{},formulation:{}};c.adviseCase.columnData.rowID.push(parseInt(f,10));caseObject.rowDescriptors.push(c.buildRowDescriptor(e,g,h,f));caseObject.parameterHierarchy=c.buildParameterHierarchy(g,null,e);caseObject.formulation=c.buildFormulation(e,g);a=a+1}}});return c.adviseCase}};SimulationObjectCaseBuilder.prototype.constructor=SimulationObjectCaseBuilder;var Like=function(a,b,c){this.version=self.version;this.id=self.createLiteGUID();this.user=a||{};this.date=encodeURIComponent(b)||"";this.isPositive=c||true};Like.prototype={thaw:function(c){for(var a in c){if(c.hasOwnProperty(a)){if(a==="user"){var b=new AdviseUser();b.thaw(c[a]);this[a]=b}else{this[a]=c[a]}}}return this},freeze:function(){var a=this;return{user:a.user.freeze(),date:a.date,isPositive:a.isPositive,version:a.version,id:a.id}},isPositive:function(){return this.isPositive},setPositive:function(a){this.isPositive=a},getUser:function(){return this.user},setUser:function(a){if(a instanceof AdviseUser){this.user=a}},getDate:function(){return this.date},setDate:function(a){try{this.date=encodeURIComponent(a)}catch(b){}},toString:function(){return(user.toString()+", date: "+this.date+", isPositive: "+this.isPositive)}};Like.prototype.constructor=Like;var Objective=function(b,a){this.context=a;this.id=self.createLiteGUID();this.version=self.version;this.TYPE_MINIMIZE="MINIMIZE";this.TYPE_MAXIMIZE="MAXIMIZE";this.TYPE_TARGET="TARGET";this.TYPE_AVOID="AVOID";this.type=b.type||this.TYPE_MINIMIZE;this.setValue(b.value||null);this.rank=b.rank||1;this.dataSetVariable=b.dataSetVariable||null;this.rawVals=[];this.scaledVals=[];this.bestRowIds=[];if(Object.keys(b).length>0){if(!(this.dataSetVariable instanceof ExplorationVariable)){throw new self.AdviseException("Invalid variable.",this.dataSetVariable)}if("STRING"===this.dataSetVariable.getDataType()){if(!this.TYPE_AVOID===this.type&&!this.TYPE_TARGET===this.type){throw new self.AdviseException("Invalid objective type for"+this.dataSetVariable.getDisplayName()+". Objectives for STRING parameters can be type TARGET or AVOID only.")}}if("INTEGER"!==this.dataSetVariable.getDataType()&&"REAL"!==this.dataSetVariable.getDataType()&&"STRING"!==this.dataSetVariable.getDataType()){throw new self.AdviseException("Invalid parameter data type for objective "+this.dataSetVariable.getDisplayName()+". Objectives for"+this.dataSetVariable.getDataType()+" parameters are not allowed.")}if(this.value===null){if(this.TYPE_AVOID===this.type){throw new self.AdviseException("Invalid objective definition for"+this.dataSetVariable.getDisplayName()+". Avoid value cannot be null")}if(this.TYPE_TARGET===this.type){throw new self.AdviseException("Invalid objective definition for"+this.dataSetVariable.getDisplayName()+". Target value cannot be null")}}}};Objective.prototype={setContext:function(a){this.context=a},getType:function(){return this.type},setType:function(a){this.type=a},getValue:function(){return this.value},setValue:function(a){if(!this.dataSetVariable){this.value=a}else{switch(this.dataSetVariable.dataType){case"INTEGER":this.value=parseInt(a,10);break;case"REAL":this.value=parseFloat(a);break;default:this.value=a;break}}},getRank:function(){return this.rank},setRank:function(a){this.rank=a},getDatasetVariable:function(){return this.dataSetVariable},setDatasetVariable:function(a){if(a instanceof ExplorationVariable){this.dataSetVariable=a}else{throw new self.AdviseException("Invalid dataset variable.")}},getName:function(){return this.dataSetVariable.getName()},getDisplayName:function(){return this.dataSetVariable.getDisplayName()},getDataType:function(){return this.dataSetVariable.getDataType()},isExcludedRow:function(a){if(a==null){return true}if(typeof a.isExcluded==="function"){return a.isExcluded()}else{return a.grade=="GRADE_EXCLUDED"}},isPredictedRow:function(b){if(typeof b.isPredicted==="function"){return b.isPredicted()}else{var a=b.tags.filter(function(c){return c.name==="DATA_SET"});return typeof a[0]==="undefined"?false:a[0].value==="PREDICTED"}},isRowFeasible:function(a){if(a===null){return true}if(typeof a.isFeasible==="function"){return a.isFeasible()}else{return a.isFeasible}},checkMustHaveViolation:function(a){if(!(a instanceof RowDescriptor)){return false}return a.checkMustHaveViolation()},isMustHave:function(){var a=this.getDatasetVariable();if(a instanceof ExplorationVariable){if(a.getPriority()===0){return true}}return false},isRowViolating:function(d){var b=false;if(!(d instanceof RowDescriptor)){return b}var e=this.getDatasetVariable();if(e instanceof ExplorationVariable){var c=e.getId(),a=d.constraintsViolated;if(a instanceof Array&&a.indexOf(c)>=0){b=true}}return b},getAllValues:function(){var l=this;var b=l.getDatasetVariable().getId();if(this.context.caseData.rawData.rowID.length!==l.scaledVals.length){l.scaledVals=[]}l.bestRowIds=[];if(l.dataSetVariable===null||!this.context.caseData.rawData[b]||this.context.caseData.rawData[b]===null){throw new self.AdviseException("Invalid objective object state - variable is null or has no column data.")}var j=this.context.caseData.rawData[b].length,t=[],a=[],o=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;for(var m=0;m<j;m++){var n=this.context.caseData.rawData.rowID[m];if(l.isExcludedRow(this.context.caseData.rowDescriptors[n-1])){continue}var f=this.context.caseData.rawData[b][m];if(typeof f==="undefined"||f===null){continue}if("STRING"===l.getDataType()){if(l.TYPE_TARGET===l.type){t[m]=l.value===f?0:1}else{if(l.TYPE_AVOID===l.type){t[m]=l.value===f?1:0}else{throw new self.AdviseException("Invalid objective type for"+this.dataSetVariable.getDisplayName()+". Objectives for STRING parameters can be type TARGET or AVOID only.")}}}else{if("INTEGER"===l.getDataType()||"REAL"===l.getDataType()){var s=parseFloat(f);if(l.TYPE_MINIMIZE===l.type){t[m]=-1*s}else{if(l.TYPE_MAXIMIZE===l.type){t[m]=s}else{if(l.TYPE_TARGET===l.type){var q=parseFloat(l.value);t[m]=-1*Math.abs(q-s)}else{if(l.TYPE_AVOID===l.type){var r=parseFloat(l.value);t[m]=-1*Math.abs(r-s)}else{throw new self.AdviseException("Invalid objective type for "+l.dataSetVariable.getDisplayName()+" - "+l.type)}}}}}}if(!l.isPredictedRow(this.context.caseData.rowDescriptors[n-1])){if(t[m]>e){e=t[m]}if(t[m]<o){o=t[m]}}}var c=o,p=this.context.caseData.rawData[b];for(var m=0;m<j;m++){var n=this.context.caseData.rawData.rowID[m],h=n-1,d=this.context.caseData.rowDescriptors[h];var f=p[m]||p[m]===0?p[m]:null;var g=l.isRowFeasible(d),k=false;if(!g&&this.isMustHave(d)){k=this.isRowViolating(d)}if(l.isExcludedRow(d)){t[m]=NaN;a[m]=NaN}else{if(f===null){t[m]=0;a[m]=NaN}else{if(o<e){a[m]=1+99*(t[m]-o)/(e-o);if(!k){if(t[m]>c){l.bestRowIds=[];l.bestRowIds.push(n);c=t[m]}else{if(t[m]==c){l.bestRowIds.push(n)}}}}else{a[m]=100;l.bestRowIds.push(n)}}}}l.scaledVals.push.apply(l.scaledVals,a);return l.scaledVals},getBestRowIds:function(){return this.bestRowIds},evaluateForRow:function(e,a){var d=this,c=d.getAllValues(),b=1;if(isNaN(c[e])){return NaN}if(a){b=d.dataSetVariable.calculateGlobalWeightFactor()}return c[e]*b},freeze:function(){var a;switch(this.dataSetVariable.dataType){case"INTEGER":a=parseInt(this.value,10);break;case"REAL":a=parseFloat(this.value);break;default:a=this.value;break}return{dataSetVariable:this.dataSetVariable,type:this.type,rank:this.rank,value:a,id:this.id,version:this.version}},thaw:function(a){for(var b in a){if(a.hasOwnProperty(b)){if(b==="dataSetVariable"){this[b]=this.context.paramsById[a[b].id].reference}else{this[b]=a[b]}}}return this},clearCache:function(){this.scaledVals=[];this.rawVals=[];this.bestRowIds=[]}};Objective.prototype.constructor=Objective;var ParameterUtils=function(a){this.context=a;this.context.isMerged=false;this.parameterFilters=[{name:"files",filter:this.fileFilterFunction,isActive:false},{name:"data",filter:this.dataFilterFunction,isActive:true},{name:"parameterName",filter:this.nameFilterFunction,isActive:true}];this.unmergedFilters=[{name:"parameterName",isActive:true,filter:this.nameFilterFunction}]};ParameterUtils.prototype={indexParametersByID:function(b,e){var c=this.context.paramsById||{},f,j,k=this.paramCount||0,d=this;var h=function(l,n,m){d.createParameterIndex(l,j,f,c);k+=1};var a=function(l,n,m){d.createParameterIndex(l,j,f,c);j=l.id;if(l.dataSetVariables){l.dataSetVariables.forEach(h)}if(l.groups){if(l.groups){l.groups.forEach(a)}}};if(b&&e){e.forEach(function(l){f=l;if(!(b[l] instanceof VarGroup)){return}var m=b[l];a(m)})}else{f=this.context.caseId;b=this.context.caseData.parameterHierarchy;if(!(b instanceof VarGroup)){return}var g=b;a(g)}this.context.paramsById=c;this.context.paramCount=k;return{paramsByID:c,paramCount:k}},padRowsWithNulls:function(){var b=function(c,e){if(Array.isArray(this.context.unmergedData.rawData[c])){if(this.context.unmergedData.rawData[c].length!==this.context.unmergedData.rawData.rowID.length){if(Array.isArray(this.context.caseData[c])){for(var d=0;d<this.context.unmergedData.rawData.rowID.length;d++){this.context.unmergedData.rawData[c][d]=this.context.unmergedData.rawData[c][d]||e;this.context.caseData.rawData[c][d]=this.context.caseData.rawData[c][d]||e}}else{for(var d=0;d<this.context.unmergedData.rawData.rowID.length;d++){this.context.unmergedData.rawData[c][d]=this.context.unmergedData.rawData[c][d]||e}}}}};for(var a in this.context.paramsById){if(this.context.paramsById.hasOwnProperty(a)){if(this.context.paramsById[a].reference instanceof ExplorationVariable){switch(this.context.paramsById[a].reference.getDataType()){case"INTEGER":b.call(this,a,NaN);break;case"REAL":b.call(this,a,NaN);break;case"FILE":b.call(this,a,null);break;default:b.call(this,a,"");break}}}}},createParameterIndex:function(e,d,c,a){var b={parentID:d,datasetID:c,reference:e,included:false,mappedTo:undefined};if(e){a[e.id]=b}return b},getParameterFromHierarchy:function(d){var a=this.getParametersAsFlatList(this.context.caseData.parameterHierarchy);var c={};for(var b=0;b<a.length;b++){c=a[b];if(c.id===d){break}}return c},getAllParametersAsFlatList:function(b,a){var c=this;a=a||[];b=b||(this.context.caseData?this.context.caseData.parameterHierarchy:[]);[].push.apply(a,b.dataSetVariables);if(typeof b.groups!=="undefined"&&b.groups!==null&&b.groups.length>0){b.groups.forEach(function(d){c.getAllParametersAsFlatList(d,a)})}return a},getParametersAsFlatList:function(d,c,b){b=b||[];if(!d.groups&&!d.dataSetVariables){return b}if(c){if(d.groups.length!==0){for(var a=0;a<d.groups.length;a++){b=this.getParametersAsFlatList(d.groups[a],true,b)}}}[].push.apply(b,d.dataSetVariables);return b},parseParameterValue:function(a,d,e){if(e==="ACTUAL"||!(this.context.baselineRow instanceof RowDescriptor)){return d}var b=this.context.baselineRow.getRowID(),c=this.context.caseData.rawData.rowID.indexOf(b),f=this.context.caseData.rawData[a][c];if(!f){return"-"}if(typeof f!=="undefined"&&!isNaN(d)){if(isNaN(f)){return"-"}f=parseFloat(f);d=parseFloat(d);if(e==="PERCENTAGE"){var g=100;if(f!==0){g=(d-f)/f*100}else{if(d==0){g=d}}return g}else{if(e==="MAGNITUDE"){return d-f}}}return d},getParamHierarchyForRange:function(d,b,c){var f={parameterCount:1,hierarchy:{}};if(!(d instanceof VarGroup)){return f}var h=c&&c.flatten,a=h&&c.flattenedObj?c.flattenedObj:{type:"GROUP",id:d.id,name:decodeURIComponent(d.displayName),children:[]},g=c.filterSet||this.parameterFilters;if(d.dataSetVariables&&d.dataSetVariables.length>0){d.dataSetVariables.forEach(function(l){var j=true;if(!b){j=g.some(function(p){if(!p.isActive){return false}return p.filter.call(this,l)},this)}if(!j&&c.nameFilter){var k=l.displayName.toLowerCase();j=k.indexOf(c.nameFilter)<0}if(!j||(b&&b.indexOf(l.id)>-1)){var n={id:l.id,type:l.dataType,name:decodeURIComponent(l.name),displayName:decodeURIComponent(l.displayName),priority:l.priority,unit:l.unit};if(this.context.caseData.formulation instanceof Formulation){if(c&&c.getFormulation){var m=this.context.caseData.formulation.getObjectives()[l.id]||null,o=this.context.caseData.formulation.getConstraints()[l.id]||null;if(m){n.objective={value:m.value,type:m.type,bestRowIds:m.getBestRowIds()}}if(o&&o.length>0){n.constraints=o.map(function(p){return p.freeze()})}}}if(l.dataType==="INTEGER"||l.dataType==="REAL"){n.min=l.min;n.max=l.max}else{if(l.dataType==="STRING"||l.dataType==="BOOLEAN"){n.value=l.value}}a.children.push(n)}},this);f.parameterCount+=a.children.length}var e=false;if(h&&typeof c.flattenedObj==="undefined"){c.flattenedObj=a;e=true}if(d.groups&&d.groups.length>0){d.groups.forEach(function(k){var l=false;if(b&&b.indexOf(k.id)>-1){l=true}var j=this.getParamHierarchyForRange(k,b,c);if(!h&&(l||(j.hierarchy.children&&j.hierarchy.children.length>0))){a.children.push(j.hierarchy)}f.parameterCount+=j.parameterCount},this)}f.hierarchy=a;if(e){delete c.flattenedObj}return f},findParameterInGroup:function(c,a){if(!a){a=this.context.caseData.parameterHierarchy}var b=null;if(a.dataSetVariables instanceof Array){a.dataSetVariables.some(function(d){if(d.id===c){b=d;return true}},this)}if(b===null&&a.groups instanceof Array){a.groups.some(function(d){var e=this.findParameterInGroup(c,d);if(e instanceof ExplorationVariable){b=e;return true}},this)}return b},findGroupInGroupByName:function(b,d){if(!d||!d.groups){return null}var a=null;d.groups.some(function(e){if(b===e.getDisplayName()){a=e;return true}});if(typeof a!=="undefined"&&a!==null){return a}if(d.groups&&d.groups.length>0){for(var c=0;c<d.groups.length;c++){a=this.findGroupInGroupByName(b,d.groups[c]);if(a){break}}}return a},findParameterInGroupByName:function(b,d){if(!d||!d.dataSetVariables){return null}var a=null;d.dataSetVariables.some(function(e){if(b===e.getName()){a=e;return true}});if(typeof a!=="undefined"&&a!==null){return a}if(d.groups&&d.groups.length>0){for(var c=0;c<d.groups.length;c++){a=this.findParameterInGroupByName(b,d.groups[c]);if(a){break}}}return a},findParameterInGroupByProfile:function(d,c){if(!c||!c.dataSetVariables){return null}var a=null;c.dataSetVariables.some(function(e){a=this.compareParameterProfiles(d,e);return a},this);if(typeof a!=="undefined"&&a!==null){return a}if(c.groups&&c.groups.length>0){for(var b=0;b<c.groups.length;b++){a=this.findParameterInGroupByProfile(d,c.groups[b]);if(a){break}}}return a},compareParameterProfiles:function(g,f){var e=g.getName(),b=g.getRole(),c=g.getStructure(),d=f.getName(),h=f.getRole(),a=f.getStructure();if(e===d&&c===a&&(h==="UNKNOWN"||b==="UNKNOWN"||b===h)){return f}return false},calculateStatsForParam:function(c){var d=c.id,h=c.dataType,b=[];if(this.context.unmergedData.rawData&&this.context.unmergedData.rawData[d]){b=this.context.unmergedData.rawData[d]}else{if(this.context.caseData.rawData&&this.context.caseData.rawData[d]){b=this.context.caseData.rawData[d]}}if(Array.isArray(b)){b=b.filter(function(j){return typeof j!=="undefined"});if(h==="REAL"||h==="INTEGER"){var f=0,e,a,g=0;b.some(function(j){if(typeof j==="undefined"||j===""){return true}f+=j;if(!isNaN(j)){if(typeof e==="undefined"||j<e){e=Number(j)}if(typeof a==="undefined"||j>a){a=Number(j)}g+=1}});c.sum=f;c.min=e;c.max=a;c.count=g;if(g>0){c.mean=f/g}}else{if(c.dataType==="STRING"||c.dataType==="BOOLEAN"){c.value="";if(b.length===1){c.value=b[0]}}}}},calculateStatsForParamsInGroup:function(a){if(!a){return}if(typeof a.groups!=="undefined"){a.groups.forEach(this.calculateStatsForParamsInGroup,this)}if(a.dataSetVariables){a.dataSetVariables.forEach(this.calculateStatsForParam,this)}},calculateParameterStatisticsOnUnmerged:function(){if(this.context.datasetIDList){this.context.datasetIDList.forEach(function(a){var b=this.context.unmergedData.parameterHierarchy[a];this.calculateStatsForParamsInGroup(b)},this)}},mapFormulation:function(){var d={},a=[];for(var b in this.context.caseData.formulation.objectivesByVariableId){var e={};e.parameterID=b;e.type=this.context.caseData.formulation.objectivesByVariableId[b].type;e.rank=this.context.caseData.formulation.objectivesByVariableId[b].rank;if(this.context.caseData.formulation.objectivesByVariableId[b].value!==null){e.value=this.context.caseData.formulation.objectivesByVariableId[b].value}a.push(e)}if(a.length>0){d.objectives=a}var f=[];for(var b in this.context.caseData.formulation.constraintsByVariableId){var c=this.context.caseData.formulation.constraintsByVariableId[b];c.forEach(function(h){var g={};g.parameterID=b;g.type=h.conditions[0].type;if(h!==null){g.boundValue=h.conditions[0].boundValue}if(h!==null){g.range=h.conditions[0].range}if(h!==null){g.valueList=h.conditions[0].valueList}f.push(g)})}if(f.length>0){d.constraints=f}return d},setObjectives:function(a){if(!Array.isArray(a)){a=[a]}var b=this;a.forEach(function(c){var d=c.type;if(typeof d==="undefined"||d===null||d.length===0){delete b.context.caseData.formulation.objectivesByVariableId[c.parameterID]}else{var e=new Objective({type:d,value:c.value||null,rank:c.rank,dataSetVariable:b.findParameterInGroup(c.parameterID,b.context.caseData.parameterHierarchy)},b.context);b.context.caseData.formulation.objectivesByVariableId[c.parameterID]=e}});b.context.isGradingDirty=true;return b.mapFormulation()},setConstraints:function(b){if(!Array.isArray(b)){b=[b]}var a=this;b.forEach(function(e){var f=e.parameterID,d=this.context.caseData.formulation.constraintsByVariableId[f]||[];d.forEach(function(h,g){if(h.conditions[0].type===e.type){this.context.caseData.formulation.constraintsByVariableId[f].splice(g,1)}},this);if(typeof e.boundValue!=="undefined"&&e.boundValue.length>0){var c=new Constraint({explorationVariable:this.findParameterInGroup(f,this.context.caseData.parameterHierarchy),type:e.type,boundValue:e.boundValue,range:e.range,valueList:e.valueList},this.context);if(!this.context.caseData.formulation.constraintsByVariableId[f]){this.context.caseData.formulation.constraintsByVariableId[f]=[]}this.context.caseData.formulation.constraintsByVariableId[f].push(c)}},this);a.context.isGradingDirty=true;return a.mapFormulation()},cloneObject:function(a){return JSON.parse(JSON.stringify(a))},createNewGroup:function(c,b,d){var a=new VarGroup(b,c,d);a.setScore(new ScoreVariable());return a},readAttribGroup:function(b,a){var c=this;b.attributes.forEach(function(d){var e=new ExplorationVariable({name:d.name,displayName:d.title,id:d.id,priority:d.priority,role:d.role,dataType:d.type,unit:d.unit});a.addDataSetVariable(e)});b.groups.forEach(function(d){c.readAttribGroup(d)})},setPLMDataToParameterHiererachy:function(e,b,a){var d="PLM Parameters";var c=this.findGroupInGroupByName(d,e);if(typeof c==="undefined"||c===null){c=new VarGroup(d,null,null);e.addGroup(c);this.createParameterIndex(c,e.getId(),a,this.context.paramsById)}if(c){e=c}b.plmParameters.forEach(function(n){var k="name";var f=this.context.datasetsList[this.context.datasetIDList.indexOf(a)].type;if(f==="Test Execution"){k="title"}var g=this.findParameterInGroupByName(encodeURIComponent(n[k]),this.context.unmergedData.parameterHierarchy[a]);if(typeof g==="undefined"||g===null){g=new ExplorationVariable({id:n.id,name:encodeURIComponent(n[k]),displayName:n.title,unit:n.unit,priority:n.priority,role:n.role,structure:n.structure});g.setDataType(this.findRAParameterType(n.type,n.value));e.addDataSetVariable(g);this.createParameterIndex(g,e.getId(),a,this.context.paramsById)}var j=this.getConstraintsFromPLM(g,n);this.addConstraintsToFormulationFromPLM(n.id,j,a,false);var m=null;if(typeof n.objective!=="undefined"&&n.objective!==null&&n.objective.length>0&&f!=="Test Execution"){if(n.objective.toUpperCase()==="MINIMIZE"){m=new Objective({type:"MINIMIZE",dataSetVariable:g},this.context)}else{if(n.objective.toUpperCase()==="MAXIMIZE"){m=new Objective({type:"MAXIMIZE",dataSetVariable:g},this.context)}else{if(n.objective.toUpperCase()==="TARGET"){if(n.value!=="undefined"&&n.value!==null){m=new Objective({type:"TARGET",dataSetVariable:g,value:n.value},this.context)}}else{if(n.objective.toUpperCase()==="AVOID"){m=new Objective({type:"AVOID",dataSetVariable:existingParam.reference},this.context)}}}}}this.context.unmergedData.formulation[a].addObjective(n.id,m);var o=this.context.unmergedData.rowDescriptors[a].map(function(p){return p.getRowIndex()});if(!this.context.unmergedData.rawData[g.getId()]){this.context.unmergedData.rawData[g.getId()]=[]}for(var l=0;l<o.length;l++){var h=n.value;if(this.isEmptyValue(h,g.getDataType())){h=this.createEmptyValue(g.getDataType())}this.context.unmergedData.rawData[g.getId()][o[l]]=h}},this)},setSimObjSensorsToParameterHiererachy:function(f,b,a){if(b&&!b.SOParameters){return{}}var c="Physics Simulation Sensors";var e=this.findGroupInGroupByName(c,f);if(typeof e==="undefined"||e===null){e=new VarGroup(c,null,null);f.addGroup(e);this.createParameterIndex(e,f.getId(),a,this.context.paramsById)}if(e){f=e}var d=0;b.SOParameters.forEach(function(g){d++;var j=g.name;var l=g.sensors;var h=this.findGroupInGroupByName(j,f);if(typeof h==="undefined"||h===null){h=new VarGroup(j,null,null);f.addGroup(h);var k=this.createParameterIndex(h,f.getId(),a,this.context.paramsById);k.autoMerge=true}l.forEach(function(p){var n=p.name;var m=this.findGroupInGroupByName(n,h);if(typeof m==="undefined"||m===null){m=new VarGroup(n,null,null);h.addGroup(m);var o=this.createParameterIndex(m,h.getId(),a,this.context.paramsById);o.autoMerge=true}p.parameters.forEach(function(w){var s=this.findParameterInGroupByName(encodeURIComponent(w.name),m);if(typeof s==="undefined"||s===null){var u=j+"_"+n+"_"+w.name;var q=n+"_"+w.name+"_"+a+"_"+d;s=new ExplorationVariable({id:q,name:encodeURIComponent(u),displayName:w.name,unit:w.unit,dataType:"REAL"});m.addDataSetVariable(s);this.createParameterIndex(s,f.getId(),a,this.context.paramsById);var t=this.context.unmergedData.rowDescriptors[a].map(function(x){return x.getRowIndex()});if(!this.context.unmergedData.rawData[s.getId()]){this.context.unmergedData.rawData[s.getId()]=[]}for(var r=0;r<t.length;r++){var v=w.value;if(this.isEmptyValue(v,s.getDataType())){v=this.createEmptyValue(s.getDataType())}this.context.unmergedData.rawData[s.getId()][t[r]]=v}}},this)},this)},this)},setProcessParameterToParameterHiererachy:function(e,b,a){if(!b.processParameters){return{}}var c="Parameters";var d=this.findGroupInGroupByName(c,e);if(typeof d==="undefined"||d===null){d=new VarGroup(c,null,null);e.addGroup(d);this.createParameterIndex(d,e.getId(),a,this.context.paramsById)}if(d){e=d}b.processParameters.forEach(function(f){if(!f.Expression&&f.type!=="plmobject"){var h=this.findParameterInGroupByName(encodeURIComponent(f.name),this.context.unmergedData.parameterHierarchy[a]);if(typeof h==="undefined"||h===null){h=new ExplorationVariable({id:f.id,name:encodeURIComponent(f.name),displayName:f.name,mode:f.mode,valuetype:f.valuetype});h.setDataType(this.findRAParameterType(f.type,f.Value));e.addDataSetVariable(h);this.createParameterIndex(h,e.getId(),a,this.context.paramsById)}var l=[];var j=this.context.unmergedData.rowDescriptors[a].map(function(m){return m.getRowIndex()});if(!this.context.unmergedData.rawData[h.getId()]){this.context.unmergedData.rawData[h.getId()]=[]}for(var g=0;g<j.length;g++){var k=f.Value;if(this.isEmptyValue(k,h.getDataType())){k=this.createEmptyValue(h.getDataType())}else{if(f.type&&f.type.toUpperCase()==="TIMESTAMP"){k=this.convertToDate(k)}}this.context.unmergedData.rawData[h.getId()][j[g]]=k}}},this)},convertToDate:function(c){if(c.indexOf("/")!==-1){try{c=Date.parse(c)}catch(b){return""}}var a=new Date(parseInt(c));return a.toDateString()},mergeParameterWithExisting:function(l,o,A){if(l.datasetID===o.datasetID){console.warn("Cannot merge with parameters from same dataset.");return}var r=o.reference.getId(),j=l.reference.getId(),w=o.reference.getDataType(),a=l.reference.getDataType(),q=o.reference.getRole(),B=l.reference.getRole();o.reference.mergedFromVars=o.reference.mergedFromVars||[];var n=o.reference.mergedFromVars.indexOf(j);l.mappedTo=r;if(A&&n===-1){return}var g=l.datasetID;var u=this.context.caseData.rowDescriptors.filter(function(k){if(k.getTag("PLMOID").getValue()===g){return k}},this.context);if(u.constructor===Array&&u.length>0){var C=this.context.caseData.rawData.rowID.indexOf(u[0].getRowID())}if(n===-1){if(C!==undefined&&o.reference.mergedFromVars.length>0){if((this.context.caseData.rawData.rowID.length-1)!==o.reference.mergedFromVars.length){var p=C;for(var v=0;v<p;v++){C=(isNaN(this.context.caseData.rawData[r][v])||this.context.caseData.rawData[r][v]===""||this.context.caseData.rawData[r][v]===null)?(C=C-1):C}}o.reference.mergedFromVars.splice(C,0,j)}else{o.reference.mergedFromVars.push(j)}}var d=false;if(w===a){}else{if(["FILE","PLMOBJECT"].indexOf(w)!==-1||["FILE","PLMOBJECT"].indexOf(a)!==-1){console.warn("Files should only be merged with files");return null}else{if(w==="BOOLEAN"&&["INTEGER","REAL","STRING"].indexOf(a)!==-1){o.reference.setDataType(a);d=true}else{if(w==="INTEGER"&&["REAL","STRING"].indexOf(a)!==-1){o.reference.setDataType(a);d=true}else{if(w==="REAL"&&["STRING"].indexOf(a)!==-1){o.reference.setDataType(a);d=true}else{o.reference.setDataType(a);d=true}}}}}if(q===B){}else{if(w==="UNKNOWN"){o.reference.setRole(a)}else{if(w==="INPUT"&&a==="OUTPUT"){o.reference.setRole(a)}else{}}}var h=this.context.unmergedData.rowDescriptors[l.datasetID],s=this.context.unmergedData.rawData[j],x=this.context.datasetIDList.indexOf(l.datasetID),z=this.context.datasetsList[x].physicalID,e=this.context.datasetsList[x].id;var y=false;this.context.caseData.rowDescriptors.forEach(function(H){var I=H.getRowIndex();var E=false;var F=H.getTag("PLMOID");if((F&&F.getValue()===z)||F.getValue()===e){y=E=true}var G=typeof H.getTag("INDEX_IN_ORIG_DS")!=="undefined"?H.getTag("INDEX_IN_ORIG_DS").getValue():-1;if(typeof this.context.caseData.rawData[r]==="undefined"){this.context.caseData.rawData[r]=[]}var k=this.context.caseData.rawData.rowID.indexOf(H.getRowID());if(k<0){return}if(typeof s[G]!=="undefined"){this.context.caseData.rawData[r][k]=s[G]}else{if(typeof this.context.caseData.rawData[r][k]==="undefined"){var D=o.reference.getDataType();this.context.caseData.rawData[r][k]=this.createEmptyValue(D)}}},this);if(!y){h.forEach(function(J){var I=new RowDescriptor();var E=I.getId();I.thaw(J);I.setId(E);var D=this.context.caseData.rowDescriptors.length,G=D+1;I.setRowIndex(D);I.setRowID(G);this.context.caseData.rawData.rowID.push(G);this.context.caseData.rowDescriptors.push(I);var H=typeof J.getTag("INDEX_IN_ORIG_DS")!=="undefined"?J.getTag("INDEX_IN_ORIG_DS").getValue():-1;if(typeof this.context.caseData.rawData[r]==="undefined"){this.context.caseData.rawData[r]=[]}var k=this.context.caseData.rawData.rowID.indexOf(I.getRowID());if(typeof s[H]!=="undefined"){this.context.caseData.rawData[r][k]=s[H]}else{var F=this.context.paramsById[r].reference.getDataType();this.context.caseData.rawData[r][k]=this.createEmptyValue(F)}},this)}var f=this.context.unmergedData.formulation[l.datasetID],b=f.constraintsByVariableId[j],t=f.objectivesByVariableId[j],m=o.reference.getId();if(Array.isArray(b)){b.forEach(function(k){var D=new Constraint({explorationVariable:o.reference,type:k.getType(),boundValue:k.getBoundValue()},this.context);this.context.caseData.formulation.addConstraint(o.reference.getId(),D)},this)}if(t instanceof Objective){var c=new Objective({type:t.getType(),value:t.getValue()||null,rank:t.getRank(),dataSetVariable:o.reference},this.context);this.context.caseData.formulation.addObjective(o.reference.getId(),c)}else{if(Array.isArray(t)){t.forEach(function(k){if(k instanceof Objective){this.context.caseData.formulation.addObjective(o.reference.getId(),new Objective({type:k.getType(),value:k.getValue()||null,rank:k.getRank(),dataSetVariable:o.reference},this.context))}},this)}}this.context.isBasketDataDirty=true;return o},createBaseGroup:function(b){var a=null;if(Object.keys(this.context.caseData.parameterHierarchy).length===0){a=this.createNewGroup(undefined,b);this.context.caseData.parameterHierarchy=a;this.createParameterIndex(a,undefined,undefined,this.context.paramsById);this.context.paramCount+=1}else{a=this.context.caseData.parameterHierarchy}return a},mergeParameterWithNew:function(e,c,j){var b=null,n=null;if(e.reference instanceof ExplorationVariable){n=e.reference.getId();try{if(typeof c==="undefined"||c===""){c=e.reference.getDisplayName()}var h=new ExplorationVariable({name:e.reference.getName(),displayName:c,role:e.reference.getRole(),dataType:e.reference.getDataType(),priority:e.reference.getPriority(),structure:e.reference.getStructure()});h.setWeightFactor(e.reference.getWeightFactor()||-1);h.setUnit(e.reference.getUnit());h.setNotes(e.reference.getNotes());h.setComments(e.reference.getComments());var m=j instanceof VarGroup?j:this.context.caseData.parameterHierarchy;m.addDataSetVariable(h);b=this.createParameterIndex(h,m.getId(),undefined,this.context.paramsById)}catch(k){console.error(k)}}else{throw"Not a valid parameter to merge in"}if(!(this.context.caseData.formulation instanceof Formulation)){this.context.caseData.formulation=new Formulation(null,null,this)}var l=this.context.unmergedData.formulation[e.datasetID],a=l.constraintsByVariableId[n],g=l.objectivesByVariableId[n],d=b.reference.getId();if(Array.isArray(a)){a.forEach(function(o){var p=new Constraint({explorationVariable:b.reference,type:o.getType(),boundValue:o.getBoundValue()},this.context);this.context.caseData.formulation.addConstraint(b.reference.getId(),p)},this)}if(g instanceof Objective){var f=new Objective({type:g.getType(),value:g.getValue()||null,rank:g.getRank(),dataSetVariable:b.reference},this.context);this.context.caseData.formulation.addObjective(b.reference.getId(),f)}return this.mergeParameterWithExisting(e,b)},autoMergeParameterWithExisting:function(g,c,f){var b=this.findParameterInGroupByProfile(g,this.context.caseData.parameterHierarchy),a=false;if(typeof b!=="undefined"&&b!==null&&b){var e=this.context.paramsById[b.getId()],d=this.context.paramsById[g.getId()];if(e&&e.datasetID!==c){a=this.mergeParameterWithExisting(d,e,f)}}return a},autoMergeParameterWithNew:function(f,b,e){var c=null;var a=false;var d=function(h){var g=this.context.unmergedData.parameterHierarchy[h];c=this.findParameterInGroupByProfile(f,g);if(typeof c!=="undefined"&&c!==null&&c){var l=this.context.paramsById[c.getId()],k=this.context.paramsById[f.getId()];var j=this.mergeParameterWithNew(l,e);if(j){a=this.mergeParameterWithExisting(k,j)}}return a};if(this.context.datasetIDList.length===1){d.call(this,this.context.datasetIDList[0])}else{b.some(d,this)}return a},isAutoMerged:function(){return this.context.isMerged},autoMergeParameters:function(h){this.context.datasetIDList;this.context.datasetsList;this.context.paramsById;var g="",f=[],b=this.context.datasetIDList.length>1,a=true,c=null;var e=function(j){if(!this.autoMergeParameterWithExisting(j,g)){if(a){this.autoMergeParameterWithNew(j,f,c)}}if(!this.context.isMerged){this.context.isMerged=true}};var d=function(j){var m=c;if(j){var k=j.getId();var l=this.context.paramsById[k];if(l&&typeof l.autoMerge==="boolean"&&!l.autoMerge){a=false}}j.dataSetVariables.forEach(e,this);j.groups.forEach(d,this);a=true};h.forEach(function(k){g=k;var j=this.context.unmergedData.parameterHierarchy[k];if(j){d.call(this,j)}f.push(k)},this)},setAttributesToParameterHiererachy:function(f,d,c){var a="Dataset Attributes";var e=this.findGroupInGroupByName(a,f);if(typeof plmGroup==="undefined"||e===null){e=new VarGroup(a,null,null);f.addGroup(e);var b=this.createParameterIndex(e,f.getId(),c,this.context.paramsById);b.autoMerge=false}if(e){f=e}if(Array.isArray(d.groups)){d.groups.forEach(function(j){var h=this.createNewGroup(j.id,j.name,f);this.setAttributesToParameterHiererachy(h,j,c);f.groups.push(h);this.createParameterIndex(h,f.getId(),c,this.context.paramsById)},this)}d.attributes.forEach(function(g){var j=this.findParameterInGroupByName(encodeURIComponent(g.name),this.context.unmergedData.parameterHierarchy[c]);if(typeof j==="undefined"||j===null){j=new ExplorationVariable({id:g.id,name:encodeURIComponent(g.name),displayName:g.title,unit:g.unit,priority:g.priority,role:g.role,structure:g.structure});j.setDataType(this.findRAParameterType(g.type,g.value));f.addDataSetVariable(j);this.createParameterIndex(j,f.getId(),c,this.context.paramsById)}var m=this.getConstraintsFromPLM(j,g);this.addConstraintsToFormulationFromPLM(g.id,m,c,true);var k=this.context.unmergedData.rowDescriptors[c].map(function(n){return n.getRowIndex()});if(!this.context.unmergedData.rawData[j.getId()]){this.context.unmergedData.rawData[j.getId()]=[]}for(var h=0;h<k.length;h++){var l=g.value;if(this.isEmptyValue(l,j.getDataType())){l=this.createEmptyValue(j.getDataType())}else{if(g.type&&g.type.toUpperCase()==="TIMESTAMP"){l=this.convertToDate(l)}}this.context.unmergedData.rawData[j.getId()][k[h]]=l}},this)},getConstraintsFromPLM:function(a,c){var b=[];if(c.min!==null){b.push(new Constraint({explorationVariable:a,type:"GREATER_THAN",boundValue:c.min},this.context))}if(c.max!==null){b.push(new Constraint({explorationVariable:a,type:"LESS_THAN",boundValue:c.max},this.context))}return b},addConstraintsToFormulationFromPLM:function(d,c,a,b){if(c.length>0){b=typeof b==="boolean"&&b?b:false;if(!this.context.unmergedData.formulation[a]){if(b&&this.context.datasetsList.length===1){this.context.caseData.formulation=new Formulation(null,null,this.context)}this.context.unmergedData.formulation[a]=new Formulation(null,null,this.context)}c.forEach(function(e){if(b){this.context.caseData.formulation.addConstraint(d,e)}this.context.unmergedData.formulation[a].addConstraint(d,e)},this)}},findRAParameterType:function(a,c){if(a&&["STRING","REAL","FILE","INTEGER","BOOLEAN","PLMOBJECT"].indexOf(a.toUpperCase())>-1){return a}else{if(a&&a.toUpperCase()==="TIMESTAMP"){return"STRING"}else{try{if(c==parseFloat(c)){return"REAL"}else{if(c==parseInt(c,10)){return"INTEGER"}else{return"STRING"}}}catch(b){return"STRING"}}}},getDatasetTagValue:function(a){var b=this.context.datasetIDList.indexOf(a);if(b<0){return"DATA_SET_"+(this.context.datasetIDList.length+1)}else{return"DATA_SET_"+(b+1)}},processAttributesAndPLMData:function(b){if(Array.isArray(b)){var a=1,c=0;b.forEach(function(j,k){a=this.context.getUniqueRowId();if(this.context.unmergedData.rawData&&this.context.unmergedData.rawData.rowID){c=this.context.unmergedData.rawData.rowID.length}var f=null;this.context.datasetsList.some(function(p){if(p.physicalID===j.id){f=p;return true}});var e=f.physicalID;var m=f.title;if(f.revision!==undefined&&f.revision!==""){m=m+" "+f.revision}if(!Array.isArray(this.context.unmergedData.rowDescriptors[e])||this.context.unmergedData.rowDescriptors[e].length===0){this.context.unmergedData.rowDescriptors[e]=[];var n=new RowDescriptor(c,a),o=[];n.setRowName(m);o.push(new RowTag("DATA_SET",this.getDatasetTagValue(e)));o.push(new RowTag("DATA_SET_TITLE",f.title));o.push(new RowTag("PLMOID",e));o.push(new RowTag("ROWID_IN_ORIG_DS",a));o.push(new RowTag("PLMdType",f.type));if(f.description){o.push(new RowTag("PLM_DESCRIPTION",f.description))}n.setTags(o);n.addTag(new RowTag("INDEX_IN_ORIG_DS",c));this.context.unmergedData.rowDescriptors[e].push(n);this.context.caseData.rowDescriptors.forEach(function(s){var q=s.getTag("PLMOID"),t=q?q.getValue():null;if(t&&(t===e||t===f.id)){var r=s.getTag("INDEX_IN_ORIG_DS");if(r){r.setValue(c)}else{s.addTag(new RowTag("INDEX_IN_ORIG_DS",c))}var p=s.getTag("ROWID_IN_ORIG_DS");if(p){p.setValue(a)}else{s.addTag(new RowTag("ROWID_IN_ORIG_DS",a))}return true}});c++}var d={};if(!(this.context.unmergedData.parameterHierarchy[e] instanceof VarGroup)){this.context.unmergedData.parameterHierarchy[e]=d=new VarGroup(m,e,null)}else{d=this.context.unmergedData.parameterHierarchy[e]}this.createParameterIndex(d,undefined,e,this.context.paramsById);if(!(this.context.unmergedData.formulation[e] instanceof Formulation)){this.context.unmergedData.formulation[e]=new Formulation(null,null,this.context)}if(!(this.context.caseData.formulation instanceof Formulation)){this.context.caseData.formulation=new Formulation(null,null,this.context)}this.context.caseData.rawData.rowID=this.context.caseData.rawData.rowID||[];this.context.unmergedData.rawData.rowID=this.context.unmergedData.rawData.rowID||[];var l=this.context.unmergedData.rowDescriptors[e].map(function(p){return p.getRowID()});for(var h=0;h<l.length;h++){var g=l[h];if(this.context.unmergedData.rawData.rowID.indexOf(g)===-1){g=parseInt(g,10);this.context.unmergedData.rawData.rowID.push(g)}}this.setAttributesToParameterHiererachy(d,j,e);this.setPLMDataToParameterHiererachy(d,j,e);this.setProcessParameterToParameterHiererachy(d,j,e);this.setSimObjSensorsToParameterHiererachy(d,j,e)},this)}},refreshCaseDataFromUnmerged:function(){var a=Object.keys(this.context.caseData.rawData);a.splice(a.indexOf("rowID"),1);if(this.context.caseData.rawData&&this.context.caseData.rawData.rowID instanceof Array&&this.context.caseData.rowDescriptors instanceof Array){this.context.caseData.rawData.rowID.forEach(function(b){a.forEach(function(c){this.getValueFromUnmerged(b,c)},this)},this)}},findIndexForId:function(b){var c=this.context.caseData.rowDescriptors.length;for(var a=0;a<c;a++){if(this.context.caseData.rowDescriptors[a].rowID===b){return a}}return -1},getValueFromUnmerged:function(g,b){var j=this.findIndexForId(g),e=this.context.caseData.rowDescriptors[j],f=this.context.caseData.rawData.rowID.indexOf(g),k=null,d=e.getTag("PLMOID"),h=e.getTag("INDEX_IN_ORIG_DS"),a=null,c=null;if(e.getRowID()===g&&d instanceof RowTag&&h instanceof RowTag){a=this.context.paramsById[b];if(a&&a.reference instanceof ExplorationVariable){c=a.reference;var l=c.getMergedFromVars();if(l instanceof Array){l.some(function(n){var m=this.context.paramsById[n];if(m&&(m.datasetID===d.getValue())){this.context.caseData.rawData[c.getId()][f]=this.context.unmergedData.rawData[m.reference.getId()][h.getValue()];m.mappedTo=b;return true}},this)}}}},getUnitFromUnmerged:function(a){var b="";if(this.context.paramsById.hasOwnProperty(a)){b=this.context.paramsById[a].reference.unit||""}return b},addRowDescriptorsFromDataset:function(e,b,a){if(!Array.isArray(this.context.unmergedData.rowDescriptors[b])||this.context.unmergedData.rowDescriptors[a].length===0){this.context.unmergedData.rowDescriptors[b]=[];var d=new RowDescriptor(rowIndex,rowID),c=[];d.setRowName(e.title);c.push(new RowTag("DATA_SET",this.getDatasetTagValue(a)));c.push(new RowTag("DATA_SET_TITLE",e.title));c.push(new RowTag("PLMOID",b));c.push(new RowTag("ROWID_IN_ORIG_DS",rowID));c.push(new RowTag("PLMdType",e.type));d.setTags(c);d.addTag(new RowTag("INDEX_IN_ORIG_DS",rowIndex));this.context.unmergedData.rowDescriptors[b].push(d);this.context.caseData.rowDescriptors.some(function(j){var g=j.getTag("PLMOID"),k=g?g.getValue():null;if(k&&k===a){var h=j.getTag("INDEX_IN_ORIG_DS");if(h){h.setValue(rowIndex)}var f=j.getTag("ROWID_IN_ORIG_DS");if(f){f.setValue(rowID)}return true}});rowIndex++}},convertPriorityToWeightFactor:function(a){switch(a){case 0:return 5;case 1:return 5;case 2:return 4;case 3:return 3;case 4:return 2;case 5:return 1;default:return 1}},fileFilterFunction:function(a){return a.dataType!=="FILE"},dataFilterFunction:function(a){return !this.fileFilterFunction(a)},setNameFilterValue:function(a){this.nameFilterValue=a},nameFilterFunction:function(a){if(!this.nameFilterValue||this.nameFilterValue.length===0||a.name.toLowerCase().indexOf(this.nameFilterValue.toLowerCase())>-1){return false}return true},createEmptyValue:function(a){var b="";switch(a){case"INTEGER":b=NaN;break;case"REAL":b=NaN;break;case"FILE":b=null;break;default:b="";break}return b},checkForEmptyValue:function(c,d){var a=d.getDataType(),b=d.getId();rowIndex=c.getRowIndex();value=this.context.caseData.rawData[b][rowIndex];return this.isEmptyValue(value,a)},isEmptyValue:function(b,a){var c=true;switch(a){case"INTEGER":c=isNaN(b)||b===null;break;case"REAL":c=isNaN(b)||b===null;break;case"FILE":c=b===null;break;default:c=b===""||b===null;break}return c}};ParameterUtils.prototype.constructor=ParameterUtils;var ParametricCondition=function(a){ConditionExpression.apply(this);this.TYPE_UNDEFINED="UNDEFINED";this.TYPE_LESS_THAN="LESS_THAN";this.TYPE_GREATER_THAN="GREATER_THAN";this.TYPE_EQUALS_TO="EQUALS_TO";this.TYPE_IN_RANGE="IN_RANGE";this.TYPE_NOT_IN_RANGE="NOT_IN_RANGE";this.TYPE_ONE_OF="ONE_OF";this.columnData=a;this.type=this.TYPE_UNDEFINED;this.explorationVariable={};this.boundValue={};this.range=[];this.valueList=[]};ParametricCondition.prototype=Object.create(ConditionExpression.prototype);ParametricCondition.prototype.isSatisfiedForRow=function(b){var a=this.evaluateViolationForRow(b);if(isNaN(a)){return false}else{if(a>0){return false}else{return true}}};ParametricCondition.prototype.evaluateViolationForRow=function(b){var d=this;if(b===null){return NaN}if(d.TYPE_EQUALS_TO===d.type||d.TYPE_GREATER_THAN===d.type||d.TYPE_LESS_THAN===d.type){if(d.boundValue===null){throw new self.AdviseException("Bound value undefined for condition of type "+d.type+" , parameter "+d.explorationVariable.getDisplayName())}}else{if(d.TYPE_ONE_OF===d.type){if(d.valueList.length===0){throw new self.AdviseException('Value list undefined for condition of type "ONE_OF", parameter'+d.explorationVariable.getDisplayName())}}else{if(d.TYPE_NOT_IN_RANGE===d.type){if(d.range.length!==2){throw new self.AdviseException('Range is undefined for condition of type "NOT_IN_RANGE", parameter'+d.explorationVariable.getDisplayName())}}else{if(d.TYPE_IN_RANGE===d.type){if(d.range.length!==2){throw new self.AdviseException('Range is undefined for condition of type "IN_RANGE", parameter'+d.explorationVariable.getDisplayName())}}else{throw new self.AdviseException("Condition type is not set, parameter"+d.explorationVariable.getDisplayName())}}}}if("STRING"===d.explorationVariable.getDataType()||"BOOLEAN"===d.explorationVariable.getDataType()){if(d.TYPE_EQUALS_TO===d.type){return d.boundValue===b?0:1}else{if(d.TYPE_ONE_OF===d.type){return d.valueList.indexOf(b)>-1?0:1}else{throw new self.AdviseException("Invalid condition type "+d.type+" for parameter "+d.explorationVariable.getDisplayName()+', condition type must be either "ONE_OF" or "EQUALS_TO" type')}}}else{if("REAL"===d.explorationVariable.getDataType()||"INTEGER"===d.explorationVariable.getDataType()){var c=parseFloat(b),a=parseFloat(d.boundValue);if(d.TYPE_EQUALS_TO===d.type){return Math.abs(a-c)}else{if(d.TYPE_LESS_THAN===d.type){if(c>a){return c-a}else{return 0}}else{if(d.TYPE_GREATER_THAN===d.type){if(a>c){return a-c}else{return 0}}else{if(d.TYPE_IN_RANGE===d.type){if(c<d.range[0]||c>d.range[i]){return 1}else{return 0}}else{if(d.TYPE_NOT_IN_RANGE===this.type){if(c>d.range[0]&&c<d.range[1]){return Math.min(c-d.range[0],d.range[1]-c)}else{return 1}}else{if(d.TYPE_ONE_OF===d.type){if(d.valueList.indexOf(b)){return 0}else{return 1}}}}}}}}}return 0};ParametricCondition.prototype.setExplorationVariable=function(a){if(!(a instanceof ExplorationVariable)){return}this.explorationVariable=a};ParametricCondition.prototype.getExplorationVariable=function(){return this.explorationVariable};ParametricCondition.prototype.getType=function(){return this.type};ParametricCondition.prototype.setType=function(a){this.type=a};ParametricCondition.prototype.getBoundValue=function(){return this.boundValue};(ParametricCondition.prototype.setBoundValue=function(b){var a=typeof this.explorationVariable.getDataType==="function"?this.explorationVariable.getDataType():this.explorationVariable.dataType;if(a==="INTEGER"){this.boundValue=parseInt(b,10)}else{if(a==="REAL"){this.boundValue=parseFloat(b)}else{this.boundValue=b}}}),(ParametricCondition.prototype.getRange=function(){return this.range});ParametricCondition.prototype.setRange=function(a){this.range=Array.isArray(a)?a:[]};ParametricCondition.prototype.getValueList=function(){return this.valueList};ParametricCondition.prototype.setValueList=function(a){this.valueList=Array.isArray(a)?a:[]};ParametricCondition.prototype.freeze=function(){return{type:this.type,explorationVariable:this.explorationVariable.freeze(),boundValue:this.boundValue,range:this.range,valueList:this.valueList}};ParametricCondition.prototype.thaw=function(a,d){for(var b in a){if(b==="explorationVariable"){if(d){this.explorationVariable=d}else{var c=new ExplorationVariable();this.explorationVariable=c.thaw(a[b])}}else{this[b]=a[b]}}};ParametricCondition.prototype.constructor=ParametricCondition;var RowDescriptor=function(b,a){this.version=self.version;this.id=self.createLiteGUID();this.notes="";this.rowIndex=b||0;this.rowID=a||1;this.rowName="";this.displayProperties={};this.autoRank=-1;this.userAssignedRank=-1;this.penaltyFunction=undefined;this.objectiveFunction=undefined;this.totalScore=undefined;this.grade="GRADE_UNKNOWN";this.version="1.0";this.tags=[];this.endorsements=[];this.comments=null;this.commentCount=0;this.likes=[];this.likedByCurrentUser=false;this.violatesMustHaveConstraints=false;this.isFeasible=false;this.isParetoPoint=false;this.constraintsViolated=[]};RowDescriptor.prototype={thaw:function(c,a){for(var b in c){if(c.hasOwnProperty(b)){if(b==="likes"){if(Array.isArray(c[b])){if(this[b]===null){this[b]=[]}c[b].forEach(function(e){var d=new Like().thaw(e);var f=d.getUser();if(f&&f.getUserID()===a.getUserID()){this.likedByCurrentUser=true}this[b].push(new Like().thaw(e))},this)}}else{if(b==="tags"){if(Array.isArray(c[b])){c[b].forEach(function(d){this[b].push(new RowTag().thaw(d))},this)}}else{if(b==="comments"){if(Array.isArray(c[b])){if(this[b]===null){this[b]=[]}c[b].forEach(function(e){var d=new Comment().thaw(e,a);this.commentCount+=d.getSubCommentCount()+1;this[b].push(new Comment().thaw(e,a))},this)}}else{if(b==="likedByCurrentUser"){}else{this[b]=c[b]}}}}}}return this},freeze:function(){var b={};for(var a in this){if(this.hasOwnProperty(a)){if(a==="likes"){if(Array.isArray(this[a])){b[a]=[];this[a].forEach(function(c){b[a].push(c.freeze())},this)}}else{if(a==="comments"){if(Array.isArray(this[a])){b[a]=[];this[a].forEach(function(c){b[a].push(c.freeze())},this)}}else{if(["likedByCurrentUser","constraintsViolated"].indexOf(a)>=0){}else{b[a]=this[a]}}}}}return b},getId:function(){return this.id},setId:function(a){this.id=a},getNotes:function(){return this.notes},setNotes:function(a){this.notes=a},getRowIndex:function(){return this.rowIndex},setRowIndex:function(a){this.rowIndex=a},getUserAssignedRank:function(){return this.userAssignedRank},setUserAssignedRank:function(a){this.userAssignedRank=a},getRowID:function(){return this.rowID},setRowID:function(a){this.rowID=a},getRowName:function(){return this.getRowShortName(false)},getRowShortName:function(a){if(this.rowName===null||this.rowName.trim().length===0){if(a===true){return String(this.rowID)}return"Alternative "+this.rowID}return this.rowName},hasRowName:function(){if(this.rowName===null||this.rowName.trim().length===0){return false}return true},setRowName:function(a){try{this.rowName=encodeURIComponent(a)}catch(b){}},getDisplayProperties:function(){return this.displayProperties},setDisplayProperties:function(a){this.displayProperties=a},getAutoRank:function(){return this.autoRank},setAutoRank:function(a){this.autoRank=a},getGrade:function(){return this.grade},setGrade:function(b){try{this.grade=encodeURIComponent(b)}catch(a){}},getOriginalRowIndex:function(){return this.rowIndex},setOriginalRowIndex:function(a){this.rowIndex=a},getPenaltyFunction:function(){return penaltyFunction},setPenaltyFunction:function(a){this.penaltyFunction=a},getObjectiveFunction:function(){return this.objectiveFunction},setObjectiveFunction:function(a){this.objectiveFunction=a},getTotalScore:function(){return this.totalScore},setTotalScore:function(a){this.totalScore=a},setParetoPoint:function(a){this.isParetoPoint=a},isParetoPoint:function(){return this.isParetoPoint},isFeasible:function(){return this.isFeasible},setFeasible:function(a){this.isFeasible=a;if(!a){isParetoPoint=false}},checkMustHaveViolation:function(){return this.violatesMustHaveConstraints},setMustHaveViolation:function(a){if(typeof a==="boolean"){this.violatesMustHaveConstraints=a}},isExcluded:function(){return this.grade==="GRADE_EXCLUDED"},isPredicted:function(){return"PREDICTED"===this.getTag("DATA_SET").getValue()},configureGrade:function(){if(isExcluded()){}else{if(isParetoPoint){grade="GRADE_PARETO"}else{if(isFeasible){grade="GRADE_DOMINATED"}else{grade="GRADE_INFEASIBLE"}}}},getGradingFlag:function(){if("GRADE_DOMINATED"===this.grade){return 0}if("GRADE_EXCLUDED"===this.grade){return -2}if("GRADE_PARETO"===this.grade){return 2}if("GRADE_INFEASIBLE"===this.grade){return 1}return -3},setExcluded:function(a){if(a){this.grade=-2}else{if(this.grade===-2){grade=-3}}},addComment:function(b,d,a){var c=false;if(a===this.id){if(this.comments===null){this.comments=[]}this.comments.push(new Comment(b,d,Date.now()));c=true}else{c=this.comments.some(function(e){return e.addSubComment(b,d,a)})}if(c){this.commentCount+=1}},toggleLike:function(a){var b=a.getUserID();var c=false;if(Array.isArray(this.likes)){c=this.likes.some(function(f,g){var d=f.getUser();if(d){var e=d.getUserID();if(b===e){this.likedByCurrentUser=false;this.likes.splice(g,1);return true}}},this)}else{this.likes=[]}if(!c){this.likedByCurrentUser=true;this.likes.push(new Like(a,Date.now()))}},toggleLikeOnComment:function(a,b){if(Array.isArray(this.comments)){this.comments.some(function(c){if(c.id===b){c.toggleLike(a);return true}if(c.comments){c.toggleLikeOnSubComment(a,b)}},this)}},getTags:function(){return this.tags},setTags:function(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++){if(a[b] instanceof RowTag){this.tags.push(a[b])}}}},hasTag:function(a){var b=this.tags.filter(function(c){return c.name===a.name});return b.length>0},addTag:function(a){if(a instanceof RowTag){this.tags.push(a)}},removeTag:function(a){if(a instanceof RowTag){var b=undefined,c=0;this.tags.forEach(function(d){if(d.name===a.name){b=c}c++});if(b){this.tags.splice(b,1)}}},getTag:function(a){return this.tags.filter(function(b){return b.name===a})[0]}};RowDescriptor.prototype.constructor=RowDescriptor;var RowTag=function(a,b){this.name=typeof a!=="undefined"?a:"";this.value=typeof b!=="undefined"?b:"";this.version=self.version;this.id=self.createLiteGUID()};RowTag.prototype={thaw:function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}return this},getName:function(){return this.name},setName:function(a){try{this.name=encodeURIComponent(a)}catch(b){}},getValue:function(){return this.value},setValue:function(a){try{this.value=encodeURIComponent(a)}catch(b){}},equals:function(a){return this.name===a.name},toString:function(){return"name = "+this.name+", value = "+this.value}};RowTag.prototype.constructor=RowTag;var ScoreVariable=function(a){a=a||{};ExplorationVariable.call(this,{role:"SCORE",dataType:"REAL",weightFactor:a.weightFactor||-1})};ScoreVariable.prototype=Object.create(ExplorationVariable.prototype);ScoreVariable.prototype.constructor=ScoreVariable;ScoreVariable.prototype.thaw=function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}return this};var ServantApi=function(){this.caseId="";this.currentUser={};this.autoMerge=true;this.caseLoaded=false;this.isCaseModified=false;this.caseData={rawData:{},formulation:{objectivesByVariableId:{},constraintsByVariableId:{}},rowDescriptors:[],parameterHierarchy:{}};this.unmergedData={rawData:{},rowDescriptors:{},parameterHierarchy:{},formulation:{},KWEData:{}};this.recommendedRows={};this.paramsById={};this.paramCount=0;this.parameterFilterFunctions=[];this.datasetsList=[];this.datasetIDList=[];this.simObjIDList=[];this.dataSourceInfoMap={};this.parameterUtils=new ParameterUtils(this);this.fileUtils=new FileUtils(this);this.fileReaderUtils=new FileReaderUtils(this);this.MAX_ROW_ID=0;this.isVarGroupDirty=false;this.isBasketDataDirty=false;this.isFormulationDirty=false;this.isGradingDirty=false;this.isFilteringDirty=false;this.baselineRow=null;this.comparisonType="ACTUAL";this.MERGED_DATA_NO_FILE_NAME="MERGED_DATA_NO_FILE_NAME";this.setCaseId=function(a){this.caseId=a};this.findIndexForId=function(b){var c=this.caseData.rowDescriptors.length;for(var a=0;a<c;a++){if(this.caseData.rowDescriptors[a].rowID===b){return a}}return -1};this.toggleRecommendedRowId=function(a){if(typeof this.recommendedRows[a]==="undefined"){this.recommendedRows[a]=true}else{delete this.recommendedRows[a]}this.isBasketDataDirty=true};this.getRecommendedRowIDList=function(){return Object.keys(this.recommendedRows)};this.getAlternativesCount=function(){try{return{numAlternatives:this.caseData.rawData.rowID.length,numRecommended:Object.keys(this.recommendedRows).length}}catch(a){return{numAlternatives:0,numRecommended:0}}};this.getSaveData=function(){var h={};if(this.caseData.formulation instanceof Formulation){var g={};g[this.MERGED_DATA_NO_FILE_NAME]=this.caseData.formulation.freeze();h["formulation.json"]=JSON.stringify(g)}var d={};d[this.MERGED_DATA_NO_FILE_NAME]=this.caseData.parameterHierarchy;h["parameterHierarchy.json"]=JSON.stringify(d);var c={};c[this.MERGED_DATA_NO_FILE_NAME]=[];this.caseData.rowDescriptors.forEach(function(m){c[this.MERGED_DATA_NO_FILE_NAME].push(m.freeze())},this);h["rowDescriptors.json"]=JSON.stringify(c);var a="",f="";var j=Object.keys(this.caseData.rawData).filter(function(m){return typeof m!=="undefined"&&m.length>0}),k=[],b=j.length,l=Object.keys(this.recommendedRows).length,e=this.caseData.rawData.rowID?this.caseData.rawData.rowID.filter(function(m){return typeof m!=="undefined"}):[];j.forEach(function(n,m){a+=n+"\t";f+=n+"\t"},this);e.forEach(function(o,m){a+="\n";var q=this.findIndexForId(o);var n=this.caseData.rowDescriptors[q];var p=typeof this.recommendedRows[o]!=="undefined"&&this.recommendedRows[o]===true;if(p){f+="\n"}j.forEach(function(u,t){var w=this.paramsById[u]?this.paramsById[u].reference:{},s="",r=w instanceof ExplorationVariable?w.getDataType():"",v=null;if(o==this.caseData.rawData.rowID[m]){v=this.caseData.rawData[u][m]}switch(r){case"STRING":s=typeof v!=="undefined"&&v!==null?v:"";break;case"PLMOBJECT":s=typeof v!=="undefined"&&v!==null?JSON.stringify(v):"";break;case"FILE":s=typeof v!=="undefined"&&v!==null?JSON.stringify(v):"";break;case"INTEGER":s=!isNaN(parseInt(v,10))?v:"";break;case"REAL":s=!isNaN(parseFloat(v))?v:"";break;default:s=typeof v!=="undefined"?v:null;break}a+=s+"\t";if(p){f+=s+"\t"}},this)},this);if(this.caseData.allData){h["rawData.tsv"]=this.rawDataToString()}h["basketData.tsv"]=a;h["recommendedData.tsv"]=f;h["dataSourceMap.json"]=JSON.stringify(this.dataSourceInfoMap);self.reply(h)};this.rawDataToString=function(){var e="";var d=Object.keys(this.caseData.allData).filter(function(f){return true}),c=[],b=d.length,a=this.caseData.allData.rowID;d.forEach(function(g,f){e+=g+"\t"},this);a.forEach(function(g,f){e+="\n";d.forEach(function(m,l){var o=this.paramsById[m]?this.paramsById[m].reference:{},k="",h=o instanceof ExplorationVariable?o.getDataType():"",n=this.caseData.allData[m][f];switch(h){case"STRING":k=typeof n!=="undefined"&&n!==null?n:"";break;case"PLMOBJECT":k=typeof n!=="undefined"&&n!==null?JSON.stringify(n):"";break;case"FILE":k=typeof n!=="undefined"&&n!==null?JSON.stringify(n):"";break;case"INTEGER":k=!isNaN(parseInt(n,10))?n:"";break;case"REAL":k=!isNaN(parseFloat(n))?n:"";break;default:k=typeof n!=="undefined"?n:null;break}e+=k+"\t"},this)},this);return e};this.executeCommand=function(d,b){var a=this[d].apply(this,b);if(this.isVarGroupDirty){this.isVarGroupDirty=false;if(this.caseLoaded){this.isCaseModified=true}}if(this.isBasketDataDirty){this.isBasketDataDirty=false;this.parameterUtils.calculateStatsForParamsInGroup(this.caseData.parameterHierarchy);if(this.caseLoaded){this.isCaseModified=true}}if(this.isFilteringDirty){this.isFilteringDirty=false}if(this.isFormulationDirty){if(this.caseData.formulation instanceof Formulation){this.caseData.formulation.clearCache()}this.isFormulationDirty=false;if(this.caseLoaded){this.isCaseModified=true}}if(this.isGradingDirty){try{this.calculateWtAvgScore();this.isGradingDirty=false;if(this.caseLoaded){this.isCaseModified=true}}catch(c){console.warn("Grading failed "+c)}}if(d.indexOf("set")===0){self.reply(a||{},true)}else{self.reply(a||{})}};this.getUniqueRowId=function(){if(Object.keys(this.unmergedData.rowDescriptors).length>0){var a=0;for(var b in this.unmergedData.rowDescriptors){if(this.unmergedData.rowDescriptors.hasOwnProperty(b)){a+=this.unmergedData.rowDescriptors[b].length}}return ++a}else{return ++this.MAX_ROW_ID}};this.setMaxRowId=function(a){this.MAX_ROW_ID=a}};var Setters=function(){};Setters.prototype={setDatasets:function(e,c){var d=Object.keys(this.dataSourceInfoMap).length,b={},a=Object.keys(e);if(a instanceof Array){a.forEach(function(h){var g=e[h];var f=["DesignSight","VPMReference"].indexOf(h)>=0;if(Array.isArray(g)){g.forEach(function(k){if(typeof k.physicalID==="undefined"){k.physicalID=k.physicalId}if(this.datasetIDList.indexOf(k.physicalID)<0){this.isFormulationDirty=true;this.datasetIDList.push(k.physicalID);this.datasetsList.push(k);if(this.datasetsList.length>1||e.length>1){this.unmergedData.parameterHierarchy[k.physicalID]={};this.unmergedData.rowDescriptors[k.physicalID]=[]}var j=k.name;if(b.hasOwnProperty(j)){j+="_"+b[k.name].toString();b[k.name]++}else{b[k.name]=2}if(typeof k.id==="undefined"){k.id=k.physicalID}var l={alias:"DATA_SET_"+ ++d,plmOID:k.id,physicalID:k.physicalID,name:j,title:k.title,typeName:k.type,fileName:typeof k.fileName==="undefined"?"":k.fileName,rowCount:null};this.dataSourceInfoMap[l.alias]=l}if(f){if(this.simObjIDList.indexOf(k.physicalID)<0){this.simObjIDList.push(k.physicalID)}}},this)}},this)}if(c&&Array.isArray(c)){c.forEach(function(f){if(this.simObjIDList.indexOf(f.physicalId)<0){this.simObjIDList.push(f.physicalId)}},this)}},getPhysIdForDataset:function(a){return this.datasetsList.filter(function(b){return b.id===a||b.physicalID===a}).map(function(b){return b.physicalID})[0]},setCaseFileData:function(a){this.caseFileData=a},setRowDescriptors:function(a){var b=[];a=a||[];a.forEach(function(d){var o=new RowDescriptor();o.thaw(d,this.currentUser);this.caseData.rowDescriptors.push(o);var g=o.getTag("PLMOID"),p=o.getTag("ROWID_IN_ORIG_DS"),h=o.getTag("INDEX_IN_ORIG_DS"),c=o.getTag("DATA_SET"),n=o.getTag("DATA_SET_TITLE");if(g instanceof RowTag&&this.unmergedData.rowDescriptors){var l=this.unmergedData.rowDescriptors[g.getValue()];if(l instanceof Array&&l.length===1&&l[0] instanceof RowDescriptor){var j=l[0],k=j.getTag("ROWID_IN_ORIG_DS"),f=j.getTag("INDEX_IN_ORIG_DS"),m=j.getTag("DATA_SET"),e=j.getTag("DATA_SET_TITLE");if(k instanceof RowTag){if(p instanceof RowTag){p.setValue(k.getValue())}else{o.addTag(new RowTag("ROWID_IN_ORIG_DS",k.getValue()))}}if(f instanceof RowTag){if(h instanceof RowTag){h.setValue(f.getValue())}else{o.addTag(new RowTag("INDEX_IN_ORIG_DS",f.getValue()))}}if(m instanceof RowTag){if(m instanceof RowTag){c.setValue(m.getValue())}else{o.addTag(new RowTag("DATA_SET",m.getValue()))}}if(e instanceof RowTag){if(e instanceof RowTag){n.setValue(e.getValue())}else{o.addTag(new RowTag("DATA_SET_TITLE",e.getValue()))}}o.setRowName(decodeURIComponent(j.getRowName()));if(j.hasTag({name:"PLM_DESCRIPTION"})){if(o.hasTag({name:"PLM_DESCRIPTION"})){o.getTag("PLM_DESCRIPTION").value=j.getTag("PLM_DESCRIPTION").value}else{o.addTag(j.getTag("PLM_DESCRIPTION"))}}else{if(o.hasTag({name:"PLM_DESCRIPTION"})){o.removeTag(o.getTag("PLM_DESCRIPTION"))}}}}b.push(o)},this);return b},setParameterHierarchy:function(b){if(typeof b!=="undefined"&&b!==null){var a=new VarGroup();a.thaw(b);this.caseData.parameterHierarchy=a;return a}},setFormulation:function(a){var b=new Formulation(null,null,this);b.thaw(a);if(this.datasetIDList.length===1){this.caseData.formulation=b}return b},setCaseData:function(a,b){if(a==="rawData"){this.caseData.allData=this.fileReaderUtils.readTsvToObject(b)}else{if(a==="basketData"){this.caseData.rawData=this.fileReaderUtils.readTsvToObject(b);this.parameterUtils.refreshCaseDataFromUnmerged();try{this.parameterUtils.calculateStatsForParamsInGroup(this.caseData.parameterHierarchy)}catch(c){}}else{if(a==="recommendedData"){var d=this.fileReaderUtils.readTsvToObject(b);if(d&&d.rowID){d.rowID.forEach(function(e){this.toggleRecommendedRowId(e)},this)}}else{if(a==="rowDescriptors"){this.datasetsList.every(function(e){if(typeof b[this.caseId]!=="undefined"){this.setRowDescriptors(b[this.caseId]);return false}else{if(typeof b[this.MERGED_DATA_NO_FILE_NAME]!=="undefined"){this.setRowDescriptors(b[this.MERGED_DATA_NO_FILE_NAME]);return false}else{this.unmergedData[a][e.physicalID]=this.setRowDescriptors(b[e.physicalID]||b[e.id]);return true}}},this)}else{if(a==="parameterHierarchy"){this.datasetsList.every(function(e){if(typeof b[this.caseId]!=="undefined"){this.caseData[a]=this.setParameterHierarchy(b[this.caseId]);return false}else{if(typeof b[this.MERGED_DATA_NO_FILE_NAME]!=="undefined"){this.caseData[a]=this.setParameterHierarchy(b[this.MERGED_DATA_NO_FILE_NAME]);return false}else{this.unmergedData[a][e.physicalID]=this.setParameterHierarchy(b[e.physicalID]||b[e.id]);return true}}},this);this.isVarGroupDirty=true;this.isGradingDirty=true;this.parameterUtils.indexParametersByID(this.unmergedData.parameterHierarchy,this.datasetIDList);this.parameterUtils.indexParametersByID()}else{if(a==="formulation"){this.datasetsList.every(function(e){if(typeof b[this.caseId]!=="undefined"){this.caseData[a]=this.setFormulation(b[this.caseId]);return false}else{if(typeof b[this.MERGED_DATA_NO_FILE_NAME]!=="undefined"){this.caseData[a]=this.setFormulation(b[this.MERGED_DATA_NO_FILE_NAME]);return false}else{this.unmergedData[a][e.physicalID]=this.setFormulation(b[e.physicalID]||b[e.id]);return true}}},this);this.isGradingDirty=true}else{this.unmergedData[a]=b}}}}}}return{}},setKWEData:function(){var g=this,f=Array.prototype.slice.call(arguments),l=new SimulationObjectCaseBuilder(g,f),k=0;try{k=g.caseData.rowDescriptors[g.caseData.rowDescriptors.length-1].getRowID()}catch(j){}var o=l.build(k)||{};for(var b in o){if(b!=="columnData"){var n=o[b];for(var m in n){if(m.toLowerCase()==="parameterhierarchy"){var a=n[m];if(g.unmergedData.parameterHierarchy[b] instanceof VarGroup){g.unmergedData.parameterHierarchy[b].groups=g.unmergedData.parameterHierarchy[b].groups.concat(a.groups);g.unmergedData.parameterHierarchy[b].dataSetVariables=g.unmergedData.parameterHierarchy[b].dataSetVariables.concat(a.dataSetVariables)}else{g.unmergedData.parameterHierarchy[b]=a}g.isVarGroupDirty=true}else{if(m.toLowerCase()==="formulation"){}else{if(m.toLowerCase()==="rowdescriptors"){n[m].forEach(function(q,p){if(!this.findRowInUnmergedData(q.getRowID(),b,true)){this.unmergedData.rowDescriptors[b]=this.unmergedData.rowDescriptors[b]||[];this.unmergedData.rowDescriptors[b].push(q)}},g)}}}}}else{var e=o.columnData.rowID,c=function(r,q){r.rowID=r.rowID||[];for(var p=0;p<q.length;p++){if(r.rowID.indexOf(q[p])===-1){r.rowID.push(parseInt(q[p],10))}}},d=false;if(Object.keys(g.caseData.rawData).length>0){d=true;c(g.caseData.rawData,e)}c(g.unmergedData.rawData,e);for(var h in o.columnData){if(h!=="columnData"){if(d){g.caseData.rawData[h]=o.columnData[h]}g.unmergedData.rawData[h]=o.columnData[h]}}}}return{}},setDataFromServer:function(b){if(typeof b==="undefined"||b===null){return{}}var d=b.ATTRIB_PLM_DATA||null,a=b.CSIDE_DATA||null;if(d){this.parameterUtils.processAttributesAndPLMData(d);if(!b.savedCase){this.parameterUtils.createBaseGroup("New Case");var c=[];Object.keys(d).forEach(function(e){c.push(d[e].id)});this.parameterUtils.autoMergeParameters(c);this.isMerged=this.parameterUtils.isAutoMerged()}this.parameterUtils.calculateParameterStatisticsOnUnmerged()}this.isVarGroupDirty=true;this.isGradingDirty=true;if(this.isMerged){return{autoMerge:true}}else{return{autoMerge:false}}},setFormulationForParam:function(k){var g=k.parameterId,j=k.value,a=k.objective,h=k.priority,c=k.upperThreshold,d=k.lowerThreshold,e=[];if(typeof a!=="undefined"){this.parameterUtils.setObjectives({parameterID:g,value:j,type:a});this.isGradingDirty=true}if(typeof c!=="undefined"){e.push({parameterID:g,boundValue:c,type:"LESS_THAN"})}if(typeof d!=="undefined"){e.push({parameterID:g,boundValue:d,type:"GREATER_THAN"})}if(e.length>0){this.parameterUtils.setConstraints(e);this.isGradingDirty=true}var f=this.paramsById[g];if(typeof f!=="undefined"&&typeof h!=="undefined"){var b=f.reference;if(b instanceof ExplorationVariable){b.setPriority(h)}this.isGradingDirty=true}},setObjective:function(a){var b=this.parameterUtils.setObjectives(a);this.isGradingDirty=true;return b},setConstraint:function(a){var b=this.parameterUtils.setConstraints(a);this.isGradingDirty=true;return b},mergeRequirementParameterById:function(b){var c=b.requirement,f=this.paramsById[b.id],a=f&&f.reference?f.reference:null;if(a!==null){a.plmParameterId=a.plmParameterId||"";if(a.plmParameterId.indexOf(c.physicalId)!==0){a.plmParameterId=c.physicalId+"#RA"}var e=parseInt(c.priority);if(!isNaN(e)){a.setPriority(e)}if(c.objective){var d=typeof c.parameterValue!=="undefined"?c.parameterValue:c.value;this.parameterUtils.setObjectives({parameterID:a.id,type:c.objective.toUpperCase(),value:d})}if(c.min&&c.min!==""){this.parameterUtils.setConstraints({parameterID:a.id,type:"GREATER_THAN",boundValue:c.min})}if(c.max&&c.max!==""){this.parameterUtils.setConstraints({parameterID:a.id,type:"LESS_THAN",boundValue:c.max})}}},mergeRequirements:function(a){Object.keys(a).forEach(function(b){this.mergeRequirementParameterById(a[b])},this)},autoMapRequirements:function(c){var b=this.caseData.parameterHierarchy.dataSetVariables;var a=this;if(c&&c.rowHierarchy){c.rowHierarchy.forEach(function(d){if(d.type==="GROUP"&&d.children.length>0){d.children.forEach(function(e){if(e.physicalId&&e.physicalId.length>0){b.some(function(g){if(e.name===g.name){var f={id:g.id,requirement:e};a.mergeRequirementParameterById(f);return true}},this)}})}})}},findRow:function(b,a){try{return this.caseData.rowDescriptors.filter(function(d){return b===a?d.getRowID():d.getId()})[0]}catch(c){return false}},findRowInUnmergedData:function(b,d,a){try{return this.unmergedData.rowDescriptors[d].filter(function(e){return b===a?e.getRowID():e.getId()})[0]}catch(c){return false}},mergeParameters:function(d,c,b){this.parameterUtils.createBaseGroup(b.caseName);var a={};Object.keys(d).forEach(function(f){var h=d[f];var j=this.paramsById[f];if(!a[h.id]&&(typeof h.id==="undefined"||h.id.indexOf("NEWPARAM")===0)){var e=this.parameterUtils.mergeParameterWithNew(j,h.parameterName);a[h.id]=e}else{var g=a[h.id]||this.paramsById[h.id];this.parameterUtils.mergeParameterWithExisting(j,g)}},this);Object.keys(c).forEach(function(m){var n=c[m];var f=this.paramsById[n.id];if(f&&f.reference&&Array.isArray(f.reference.mergedFromVars)){var k=f.reference.mergedFromVars.indexOf(m);if(k>=0){f.reference.mergedFromVars.splice(k,1)}}if(this.caseData&&this.caseData.rowDescriptors){var g=this.paramsById[m].datasetID;var j=this.caseData.rowDescriptors.filter(function(o){if(o.getTag("PLMOID").getValue()===g){return o}},this);var l=this.caseData.rawData.rowID.indexOf(j[0].getRowID());var h=this.caseData.rawData[n.id];var e=this.parameterUtils.createEmptyValue(f.reference.dataType);h[l]=e}},this);this.isGradingDirty=true;this.isFormulationDirty=true},mergeParameterById:function(a){var b=this.paramsById[a.id],c=this.paramsById[a.parameter.id];this.parameterUtils.mergeParameterWithExisting(c,b)},mergeParameterWithNew:function(a){var b=this.parameterUtils.createBaseGroup(a.caseName),d=this;var c=this.paramsById[a.parameter.id];this.parameterUtils.mergeParameterWithNew(c,a.parameterName)},mergeRequirementParametersByName:function(a){var c=this,b=a.requirementsList;b.forEach(function(g){var f=g.parametersList;if(typeof f!=="undefined"&&f["analytics-parameter"]){if(typeof f!=="undefined"&&f["analytics-parameter"]){var e=c.parameterUtils.getAllParametersAsFlatList(c.caseData.parameterHierarchy);var d=function(h){var k;for(var j=0;j<e.length;j++){var l=e[j];if(l.name===h){k=l}}return k};f["analytics-parameter"].forEach(function(h){var j=d(h.title);if(j){if(h.objective){c.parameterUtils.setObjectives({parameterID:j.id,type:h.objective.toUpperCase()})}if(h.min&&h.min!==""){c.parameterUtils.setConstraints({parameterID:j.id,type:"GREATER_THAN",boundValue:h.min})}if(h.max&&h.max!==""){c.parameterUtils.setConstraints({parameterID:j.id,type:"LESS_THAN",boundValue:h.max})}}})}}})},setPriority:function(b){var a=b.parameterID,c=Number(b.priorityValue),e=this.paramsById[a];if(typeof e!=="undefined"){var d=e.reference;if(d instanceof ExplorationVariable){d.setPriority(c)}else{d.priority=c>=0&&c<=5?c:5}this.isGradingDirty=true}},setCommentOnRow:function(e,d,a){var b=[];var c=this.caseData.rowDescriptors[e];if(c){a=typeof a!=="undefined"?a:c.id;c.addComment(this.currentUser,d,a);b=c.comments;this.isBasketDataDirty=true}return b},toggleLikeOnRow:function(c){var a=[];var b=this.caseData.rowDescriptors[c];if(b){b.toggleLike(this.currentUser);a=b.likes;this.isBasketDataDirty=true}return a},setCurrentUser:function(b,a){try{this.currentUser=new AdviseUser(b,a)}catch(c){return false}return true},setParameterFiltersByName:function(b){var a=Object.keys(b);this.parameterUtils.parameterFilters.forEach(function(d){var c=a.indexOf(d.name);if(c>-1){d.isActive=b[a[c]]}})},setBaselineRow:function(a){if(typeof a==="undefined"){return false}if(!this.baselineRow||this.baselineRow.id!==a){return this.caseData.rowDescriptors.some(function(b){if(b.id===a){this.baselineRow=b;return true}},this)}return false},setComparisonType:function(a){if(a==="ACTUAL"||a==="PERCENTAGE"||a==="MAGNITUDE"){this.comparisonType=a}},modifyParameter:function(a){var c=a.id;var b=this.paramsById[c];if(b&&b.reference){if(a.name&&a.name.length>0){b.reference.setName(a.name)}if(a.displayName&&a.displayName.length>0){b.reference.setDisplayName(a.displayName);this.isVarGroupDirty=true}}},setCaseLoadComplete:function(){this.caseLoaded=true},clearCaseModified:function(){this.isCaseModified=false},isParametersMerged:function(){return this.isMerged},hideUnhideAlternatives:function(a,b){try{if(!Array.isArray(a)){a=[a]}if(a.length>1){a.sort(function(e,d){return d-e})}a.forEach(function(d){if(this.caseData.rowDescriptors[d-1].hasTag({name:"hidden"})){this.caseData.rowDescriptors[d-1].getTag("hidden").value=b}else{this.caseData.rowDescriptors[d-1].setTags([new RowTag("hidden",b)])}},this)}catch(c){return false}return true},removeAlternatives2:function(a){try{if(!Array.isArray(a)){a=[a]}a.forEach(function(g){if(this.recommendedRows[g]){delete this.recommendedRows[g]}this.isGradingDirty=true;var c=this.caseData.rawData.rowID.indexOf(g);if(c!==-1){var e=Object.keys(this.caseData.rawData);e.forEach(function(h){this.caseData.rawData[h].splice(c,1)},this)}var f=this.caseData.rowDescriptors[g-1];if(f.hasTag({name:"PLMdType"})){f.grade="GRADE_EXCLUDED";var d=f.getTag("PLMOID").value;if(Object.keys(this.unmergedData.rowDescriptors).indexOf(d)!==-1){this.unmergedData.rowDescriptors[d][0].grade="GRADE_EXCLUDED"}}},this)}catch(b){return false}return true},removeAlternatives:function(a){try{if(!Array.isArray(a)){a=[a]}a.sort(function(d,c){return c-d});a.forEach(function(e){if(this.recommendedRows[e]){delete this.recommendedRows[e]}this.isGradingDirty=true;this.isVarGroupDirty=true;this.isBasketDataDirty=true;this.isFormulationDirty=true;var j=this.caseData.rawData.rowID.indexOf(e);if(j!==-1){var o=Object.keys(this.caseData.rawData);o.forEach(function(B){this.caseData.rawData[B].splice(j,1)},this)}var n=this.caseData.rowDescriptors[e-1];if(n.hasTag({name:"PLMdType"})){var k=Object.keys(this.dataSourceInfoMap);var z={};var u=0;var s=n.getTag("PLMOID").value;var f=n.getTag("PLMdType").value;var v=this.datasetIDList.indexOf(s);if(v!==-1){this.datasetIDList.splice(v,1)}if(f==="DesignSight"){var p=this.simObjIDList.indexOf(s);if(p!==-1){this.simObjIDList.splice(p,1)}}k.forEach(function(C){var B=this.dataSourceInfoMap[C];if(B.plmOID!==s&&B.physicalID!==s){z["DATA_SET_"+u++]=B}},this);this.dataSourceInfoMap=z;var q=[];var m=[];var A=0;this.caseData.rowDescriptors.forEach(function(B){if(B.getRowID()!==e){B.setRowIndex(A++);B.setRowID(A);m.push(A);q.push(B)}});var r=[];this.caseData.rawData.rowID.forEach(function(B){if(m.indexOf(B)===-1){r.push(B)}});if(r.length>0){this.caseData.rawData.rowID=m}this.caseData.rowDescriptors=q;var t=-1;for(var w=0;w<this.datasetsList.length;w++){var y=undefined;if(this.datasetsList[w].physicalID){y=this.datasetsList[w].physicalID}if(!y&&this.datasetsList[w].physicalId){y=this.datasetsList[w].physicalId}if((y&&y===s)||this.datasetsList[w].plmOID===s){t=w}}var c=undefined;if(t!==-1){c=this.datasetsList[t].plmOID;this.datasetsList.splice(t,1)}if(this.unmergedData.formulation[s]){delete this.unmergedData.formulation[s]}if(this.unmergedData.parameterHierarchy[s]){delete this.unmergedData.parameterHierarchy[s]}Object.keys(this.paramsById).forEach(function(B){if(this.paramsById[B].datasetID===s){var C=this.paramsById[B].mappedTo;if(C){var D=this.paramsById[C].reference.mergedFromVars.indexOf(B);if(D!==-1){this.paramsById[C].reference.mergedFromVars.splice(D,1)}}delete this.paramsById[B]}},this);var g=Object.keys(this.unmergedData.rawData);g.forEach(function(B){this.unmergedData.rawData[B].splice(j,1)},this);var d={};var x=[];var h=0;Object.keys(this.unmergedData.rowDescriptors).forEach(function(B){if(B!==s){this.unmergedData.rowDescriptors[B][0].setRowIndex(h++);this.unmergedData.rowDescriptors[B][0].setRowID(h);x.push(h);d[B]=this.unmergedData.rowDescriptors[B]}},this);this.unmergedData.rowDescriptors=d;this.unmergedData.rawData.rowID=x;if(this.caseData.allData){var l=this.caseData.allData.rowID.indexOf(e);if(l!==-1){var o=Object.keys(this.caseData.allData);o.forEach(function(B){this.caseData.allData[B].splice(l,1)},this)}this.caseData.allData.rowID=m}}},this)}catch(b){return false}return true}};var AdviseUser=function(a,b){this.version=self.version;this.id=self.createLiteGUID();this.name=a||"";this.userID=b||"";this.image="";this.jobTitle="";this.adoptionStatus="";this.lastUpdated=0;this.allowedAdoptionStatus=["ADOPTION_STATUS_UNKNOWN","ADOPTION_STATUS_AWARE","ADOPTION_STATUS_REVIEWED","ADOPTION_STATUS_ADOPTED"]};AdviseUser.prototype={thaw:function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}return this},freeze:function(){var a={id:this.id,version:this.version,name:this.name,userID:this.userID,image:this.image,jobTitle:this.jobTitle,adoptionStatus:this.adoptionStatus,lastUpdated:this.lastUpdated};return a},getName:function(){return this.name},setName:function(a){this.name=a},getUserID:function(){return this.userID},setUserID:function(a){this.userID=a},getImage:function(){return this.image},setImage:function(a){this.image=a},getJobTitle:function(){return this.jobTitle},setJobTitle:function(a){this.jobTitle=a},getAdoptionStatus:function(){return this.adoptionStatus},setAdoptionStatus:function(a){if(this.allowedAdoptionStatus.indexOf(a)>-1){this.adoptionStatus=a}},getLastUpdated:function(){return this.lastUpdated},setLastUpdated:function(a){this.lastUpdated=a},toString:function(){return"user name:"+this.name+", user ID:"+this.id},equals:function(a){if(a instanceof AdviseUser){if(this.userID===a.getuserID){return true}}return false}};AdviseUser.prototype.constructor=AdviseUser;var VarGroup=function(a,c,b){this.id=c||self.createLiteGUID();this.displayName=a||"";this.groups=[];this.dataSetVariables=[];this.score={};this.basketWeight=-1;this.weightFactor=1;this.parentGroup=b||{};this.version=self.version};VarGroup.prototype={thawGroup:function(b){b.groups.forEach(function(d){var c=new VarGroup();c.thaw(d);this.groups.push(c)},this);b.dataSetVariables.forEach(function(c){var d=new ExplorationVariable();d.thaw(c);this.dataSetVariables.push(d)},this);var a=new ScoreVariable();this.score=a.thaw(b.score)},thaw:function(b){for(var a in b){if(["groups","dataSetVariables","score"].indexOf(a)>-1){continue}if(b.hasOwnProperty(a)){this[a]=b[a]}}this.thawGroup(b);return this},freeze:function(){var a={};a.id=this.id;a.displayName=this.displayName;a.basketWeight=this.basketWeight;a.weightFactor=this.weightFactor;a.parentGroup=this.parentGroup;a.version=this.version;a.dataSetVariables=[];a.groups=[];a.score=this.score.freeze();this.dataSetVariables.forEach(function(b){a.dataSetVariables.push(b.freeze())});this.groups.forEach(function(b){a.groups.push(b.freeze())});return a},getId:function(){return this.id},getDisplayName:function(){return this.displayName},setDisplayName:function(a){this.displayName=a},getFullPathName:function(){if(this.parentGroup===null){return null}if(this.parentGroup.getFullPathName()===null){return this.displayName}return this.parentGroup.getFullPathName()+"."+this.displayName},getParentGroup:function(){return this.parentGroup},setParentGroup:function(a){this.parentGroup=a||""},getGroups:function(){return this.groups},setGroups:function(a){this.groups=a},addGroup:function(a){this.groups.push(a)},getDataSetVariables:function(){return this.dataSetVariables},setDataSetVariables:function(a){this.dataSetVariables=a},addDataSetVariable:function(a){this.dataSetVariables.push(a)},getScore:function(){return this.score},setScore:function(a){if(a instanceof ExplorationVariable){this.score=a}},hasObjectives:function(b){var a=b.getObjectives();if(typeof a==="object"){if(this.groups instanceof Array){this.groups.some(function(c){return c.hasObjectives(b)},this)}if(this.dataSetVariables instanceof Array){return this.dataSetVariables.some(function(c){if(a[c.getId()]){a=null;return true}},this)}}return false}};VarGroup.prototype.constructor=VarGroup;var WtAvgScorer=function(){};WtAvgScorer.prototype={calculateWtAvgScore:function(){if(!(this.caseData.formulation instanceof Formulation)){return}_this=this;_this.calculateLocalObjectiveWeights(_this.caseData.parameterHierarchy);var o=this.caseData.rowDescriptors.length;var h=[];var d=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(var m=0;m<o;m++){var l=this.caseData.rowDescriptors[m];var q=this.caseData.rawData.rowID.indexOf(l.getRowID());l.setObjectiveFunction(null);if(l.getGrade()=="GRADE_EXCLUDED"){continue}var p=true;var c=NaN;l.violatesMustHaveConstraints=false;l.isFeasible=true;var e=this.caseData.formulation.checkConstraintStatus(q);l.violatesMustHaveConstraints=e.violatesMustHaveConstraints;l.isFeasible=e.isFeasible;l.constraintsViolated=e.constraintsViolated;if(l.violatesMustHaveConstraints){c=NaN}else{c=_this.calculateWtAvgScoreForRow(q)}l.setObjectiveFunction(c);if(c!=NaN){if(c<d){d=c}if(c>r){r=c}}var n={rowIndex:m,score:c};h.push(n)}var a=h.length;for(var b=0;b<a;++b){var l=this.caseData.rowDescriptors[h[b].rowIndex];var j=h[b].score;if(isNaN(j)){j=0}else{if(d<r){j=1+99*(h[b].score-d)/(r-d)}else{j=100}}l.setObjectiveFunction(j)}h.sort(function(t,s){if(isNaN(s.score)){return 1}if(isNaN(t.score)){return -1}return t.score-s.score});var g=1;for(var k=a-1;k>=0;--k){var f=this.caseData.rowDescriptors[h[k].rowIndex];if(f.getObjectiveFunction()===0){f.setAutoRank(0)}else{f.setAutoRank(g);++g}}},calculateWtAvgScoreForRow:function(c){if(!(this.caseData.formulation instanceof Formulation)){return}var b=NaN,a=this;Object.keys(a.caseData.formulation.objectivesByVariableId).forEach(function(f){var e=a.caseData.formulation.objectivesByVariableId[f];if(e instanceof Objective){var d=e.evaluateForRow(c,true);if(!isNaN(d)){if(isNaN(b)){b=0}b+=d}}},this);return b},calculateLocalObjectiveWeights:function(e){if(!(e instanceof VarGroup)){return}var a=e.getGroups();a.forEach(function(f){this.calculateLocalObjectiveWeights(f)},this);var d=0;var c=[];a.forEach(function(f){if(!f.hasObjectives(this.caseData.formulation)){f.weightFactor=0}else{c.push(e);if(e.basketWeight>0){d+=e.basketWeight}else{d+=this.parameterUtils.convertPriorityToWeightFactor(e.priority)}}},this);var b=[];e.getDataSetVariables().forEach(function(f){if(!self.isParameterVisibleOnClient(f)||!this.dataSetVariableHasObjectives(f)){f.weightFactor=0}else{b.push(f);if(f.basketWeight>0){d+=f.basketWeight}else{d+=this.parameterUtils.convertPriorityToWeightFactor(f.priority)}}},this);c.forEach(function(f){var g=0;if(f.basketWeight>0){g=f.basketWeight/d}else{g=this.parameterUtils.convertPriorityToWeightFactor(f.priority)/d}f.weightFactor=g},this);b.forEach(function(f){var g=0;if(f.basketWeight>0){g=f.basketWeight/d}else{g=this.parameterUtils.convertPriorityToWeightFactor(f.getPriority())/d}f.weightFactor=g},this)},dataSetVariableHasObjectives:function(a){if(_this.caseData.formulation.objectivesByVariableId[a.getId()]){return true}return false},isParameterVisibleOnClient:function(a){if(a.dataType==="REAL"||a.dataType==="INTEGER"||a.dataType==="STRING"){return true}return false}};this.onmessage=function(a){self.eventData=a.data;if(a.data.command==="initializeWorker"){self.initializeWorker(a.data.args[0],a.data.args[1],a.data.args[2])}else{if(typeof self.servantAPI[a.data.command]==="function"){try{self.servantAPI.executeCommand(a.data.command,a.data.args)}catch(b){throw Error(a.data.id)}}else{throw Error(a.data.id)}}};this.augment=function(c,b,a){if(null!==a&&Array.isArray(a)){a.forEach(function(e){c.prototype[e]=b.prototype[e]})}else{for(var d in b.prototype){if(!Object.hasOwnProperty.call(c.prototype,d)){c.prototype[d]=b.prototype[d]}}}};this.reply=function(a,b){if(b){self.changeLog=self.changeLog||[];self.changeLog.push({command:self.eventData.command,args:self.eventData.args})}self.postMessage({id:self.eventData.id,data:a})};this.initializeWorker=function(b,d,a){this.augment(ServantApi,Setters);this.augment(ServantApi,Getters);this.augment(ServantApi,WtAvgScorer);this.utils={};this.servantAPI=new ServantApi();this.servantAPI.setCaseId(b);if(d){this.servantAPI.setDatasets(d)}if(a){var e=a.firstName+" "+a.lastName,c=a.login;this.servantAPI.setCurrentUser(e,c)}this.reply({})};this.initWorker=function(b,c,a){this.augment(ServantApi,Setters);this.augment(ServantApi,Getters);this.augment(ServantApi,WtAvgScorer);this.utils={};this.servantAPI=new ServantApi();this.servantAPI.setCaseId(b);this.reply({})};this.saveCase=function(){var a=new XMLHttpRequest();a.open("GET","../../resources/slmservices/fcs/ticket?action=checkin&fname=case.json&oid="+self.oid);a.send();a.onload=function(){var e=this.response.split("<Ticket>")[1].split("</Ticket>")[0];var b=new Blob([JSON.stringify(this.servantAPI.caseData)],{type:"text/plain"});var c=new XMLHttpRequest();var d=new FormData();d.append("csrfTokenName","ENO_CSRF_TOKEN");d.append("noOfFiles",1);d.append("__fcs__jobTicket",e);d.append("bfile0",b,"case.json");d.append("store","STORE");d.append("fileName0","case.json");d.append("format0","generic");c.open("POST","../../servlet/fcs/checkin");c.send(d);c.onload=function(){var f=new XMLHttpRequest();f.open("PUT","../../resources/slmservices/fcs/commit");f.send(this.response);f.onload=function(){}}};self.reply({})};self.version="1.0";self.createLiteGUID=function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())};self.inheritsFrom=function(b,a){if(typeof a==="object"){b.prototype=Object.create(a.prototype)}};self.AdviseException=function(a,b){this.message=a;this.value=b;this.toString=function(){return this.message+" "+this.value}};