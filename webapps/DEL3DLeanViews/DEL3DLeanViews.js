define("DS/DEL3DLeanViews/Components/SketchComponent",["UWA/Core","UWA/Class/Promise","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanModels/SketchUtils/Point","DS/DEL3DLeanModels/SketchUtils/Polyline","DS/DEL3DLeanModels/SketchUtils/TouchStore","DS/DEL3DLeanModels/SketchUtils/Action","DS/DEL3DLeanHttpRequest/MessageHandler","pluginDS!DS/VEN3DLeanHTML2CanvasJS/Canvas2SVG/canvas2svg"],function(b,i,c,m,h,j,g,e,l,a,k,d){var f={PEN:1,ERASE:2,CLEAR:3,IMAGE:4};var o=h.Object.extend({events:function(){if(!this._events){this._events=[];if((window.PointerEvent)||(window.navigator.pointerEnabled)||(window.navigator.msPointerEnabled)){this._events={START:"pointerdown MSPointerDown",MOVE:"pointerover pointermove MSPointerOver MSPointerMove",END:"pointerup pointercancel MSPointerUp MSPointerCancel"}}else{this._events={START:"mousedown touchstart",MOVE:"mouseover mousemove touchmove",END:"mouseup touchend touchcancel"}}}return this._events},initialize:function(){this._drawIdx=0;this._container=this.getOption("container")||null;this._width=this.getOption("width")||720;this._height=this.getOption("height")||400;this._mode=this.getOption("mode")||f.PEN;this._undoStack=this.getOption("undoStack")||[];this._redoStack=this.getOption("redoStack")||[];this._autoResize=this.getOption("autoResize")||true;this._sketchImage=this.getOption("sketchImage")||null;this._lineWidth=this.getOption("lineWidth")||1;this._buildCallback=this.getOption("buildCallback")||null;this._backgroundColor=this.getOption("backgroundColor")||null;this._color=this.getOption("color")||"#000000";this._lineCap=this.getOption("lineCap")||"round";this.enablePen();this._pid=this.getOption("pid");this._touchStore=new l();this._toBeDrawn=[];this.initSketch();if(b.is(this._buildCallback)){this._buildCallback()}if(this._autoResize){c(window).on("resize",this._container,c.proxy(this.resize,this))}},setBackgroundColor:function(p){this._backgroundColor=p},initSketch:function(){var p=c(this._container);this._width=p[0].getBoundingClientRect().width;this._height=p[0].getBoundingClientRect().height;if(!this._storedCvs){this._storedCvs=document.createElement("canvas");this._storedCvs.id="SketchComponentBackgroundLayer";this._storedCvs.width=this.getOption("width");this._storedCvs.height=this.getOption("height");this._storedCvs.setAttribute("style","position: absolute; width: 100%; height: 100%;");this._container.appendChild(this._storedCvs);this._storedCtx=this._storedCvs.getContext("2d");this._storedCtx.lineCap=this._lineCap}if(!this._transientCvs){this._transientCvs=document.createElement("canvas");this._transientCvs.id="SketchComponentDrawingLayer";this._transientCvs.width=this.getOption("width");this._transientCvs.height=this.getOption("height");this._transientCvs.setAttribute("style","position: absolute; width: 100%; height: 100%;");this.bindSketch(this.events());this._container.appendChild(this._transientCvs);this._transientCtx=this._transientCvs.getContext("2d");this._transientCtx.lineCap=this._lineCap}},bindSketch:function(p){this._debouncedTouchHandler=this.onTouchMove.bind(this);this.bindListener(p.START,this.onTouchStart.bind(this));this.bindListener(p.END,this.onTouchEnd.bind(this));this._transientCvs.addEventListener("contextmenu",function(q){q.preventDefault()},false)},bindListener:function(r,s){var q=r.split(" ");var p=0;for(p=0;p<q.length;p++){this._transientCvs.addEventListener(q[p],s,false)}},removeListener:function(r,s){var q=r.split(" ");var p=0;for(p=0;p<q.length;p++){this._transientCvs.removeEventListener(q[p],s,false)}},onTouchStart:function(s){s=this.normalizeEvent(s);if(!this._isDrawing()){this.bindListener(this._events.MOVE,this._debouncedTouchHandler)}if(s&&s.length>0){var q=0;for(q=0;q<s.length;q++){var r=s[q];if(r&&c(r.target).is("canvas")&&c(r.target)[0].parentElement===this._container){var p=this.getOrCreateAction(r.pointerId);this.triggerMethod("sketch:live","getOrCreateAction",p.touchId,p.liveId,p.mode,p.color,p.lineWidth,p.width,p.height)}this.onTouchMove(r)}this.triggerMethod("sketch:draw:start",this)}},onTouchMove:function(r){r=this.normalizeEvent(r);if(r&&r.length>0){var p=0;for(p=0;p<r.length;p++){var q=r[p];if(q.offsetX.toFixed(1)>=0&&q.offsetY.toFixed(1)>=0){var s=this._computeActionId(q.pointerId||0);this.drawTransientAction(s,q.offsetX,q.offsetY)}}}},onTouchEnd:function(r){var q=this;r=this.normalizeEvent(r);if(r&&r.length>0){var p=[];p=r.map(function(s){return q._computeActionId(s.pointerId||0)});this.drawTransientEnd(p)}this.triggerMethod("sketch:draw:end",this)},drawTransientAction:function(D,B,z){if(this._isMine(D)){this.triggerMethod("sketch:live","drawTransientAction",D,B,z)}var E=this._touchStore.get(D);var p=window.devicePixelRatio;if(E){var u=new g(Number(B.toFixed(1)),Number(z.toFixed(1)));var J=this._width/E.width;var I=this._height/E.height;var K={x:J,y:I};var q=(((E.lineWidth*J)+(E.lineWidth*I))/2);E.path.add(u);u=u.multiply(K);var v=E.path.length();switch(E.mode){case f.ERASE:var x=q;if(v>1){var C=E.path.get(v-2).multiply(K);this._clearArc(this._transientCtx,C.x,C.y,x+2)}this._transientCtx.save();this._transientCtx.fillStyle=this._transientCtx.strokeStyle="#000";this._transientCtx.lineWidth=1;this._transientCtx.beginPath();this._transientCtx.arc(u.x,u.y,x,0,2*Math.PI,false);this._transientCtx.stroke();this._transientCtx.restore();this.drawSketch(v-1,E);break;case f.PEN:if(v>3&&v%2===0){this.triggerMethod("sketch:drawTransientAction",E.encode(v-4,v));this._transientCtx.lineWidth=q;this._transientCtx.fillStyle=this._transientCtx.strokeStyle=E.color;this._transientCtx.beginPath();var H=0;var G=0;var s=0;var r=0;var F=E.path.points;var t=F[v-4].multiply(K);var w=F[v-3].multiply(K);var y=F[v-2].multiply(K);var A=u;if(v===4){H=t.x;G=t.y}else{H=(w.x-t.x)/2+t.x;G=(w.y-t.y)/2+t.y}s=(A.x-y.x)/2+y.x;r=(A.y-y.y)/2+y.y;this._transientCtx.moveTo(H,G);this._transientCtx.bezierCurveTo(w.x,w.y,y.x,y.y,s,r);this._transientCtx.stroke()}break;default:break}}},drawTransientEnd:function(B,u){if(this._isFromMe(u)){this.triggerMethod("sketch:live","drawTransientEnd",B,this._getLiveId())}var A=window.devicePixelRatio;var t=this._touchStore.pop(B);var s=undefined;var v=0;for(v in t){s=t[v];if(s.mode===f.PEN){s.path=s.path.simplify(this.getSmoothing())}else{if(s.mode===f.ERASE){var p=s.path.length();var y=this._width/s.width;var x=this._height/s.height;var r={x:y,y:x};var w=(((s.lineWidth*y)+(s.lineWidth*x))/2);if(p>0){var q=s.path.get(p-1).multiply(r);this._clearArc(this._transientCtx,q.x,q.y,w+2)}var z=s.path.flatten(10);if(z.length()<s.path.length()){s.path=z}}}this._undoStack.push(s);if(s.mode!==f.ERASE){this._toBeDrawn.push(s)}}if(!this._isDrawing()){this.removeListener(this._events.MOVE,this._debouncedTouchHandler)}if(this._touchStore.isEmpty()){this._clear(this._transientCtx);this._redoStack=[];for(v in this._toBeDrawn){s=this._toBeDrawn[v];this.drawStoredAction(s)}this._toBeDrawn=[]}},drawStoredAction:function(p){var q=this;if(p.mode===f.CLEAR){q._clear(this._storedCtx)}else{if(p.mode===f.IMAGE){if(/^data:image\/png;base64,/i.test(p.image)){this._drawImage(p.image,this._width,this._height)}else{this.drawSVG(p.image)}}else{if(p.mode===f.PEN){c.each(p.path.points,function(s){q.drawSketch(s,p)})}else{if(p.mode===f.ERASE){var r=p.path.points;c.each(r,function(s){q.drawSketch(s,p)})}}}}},noTouch:function(){return this._touchStore.isEmpty()},lastActionIsMine:function(){var p=this._undoStack.length;return p>0&&this._undoStack[p-1].liveId===this._getLiveId()},normalizeEvent:function(q){var p;if(q.type.indexOf("touch")===0){p=q.targetTouches;q.preventDefault()}else{p=[q]}return p},onBeforeDestroy:function(){},enablePen:function(){this._mode=f.PEN},isPenEnabled:function(){return this._mode===f.PEN},enableErase:function(){this._mode=f.ERASE},isEraseEnabled:function(){return this._mode===f.ERASE},setMode:function(p){this._mode=p},setColor:function(p){this._color=p},getColor:function(){return this._color},setLineWidth:function(p){this._lineWidth=p},getLineWidth:function(){return this._lineWidth},getMode:function(){return this._mode},hasUndo:function(p){var q=this;p=b.is(p)?p:q._getLiveId();return this._undoStack.some(function(r){return !b.is(r.liveId)||r.liveId===p})},hasRedo:function(p){var q=this;p=b.is(p)?p:q._getLiveId();return this._redoStack.some(function(r){return !b.is(r.liveId)||r.liveId===p})},setContainer:function(p){if(this.options._container!==p){this.options._container=p;this._rebuildSketch()}},getSmoothing:function(){var p=2.5;switch(widget.getValue("Smoothing")){case"disabled":p=0;break;case"soft":p=1.5;break;case"medium":p=2.5;break;case"hard":p=5;break;case"extrem":p=10;break;default:break}return p},clear:function(){if(this._transientCtx){this._clear(this._transientCtx);this._clear(this._storedCtx);this._undoStack.push(new a({mode:f.CLEAR}));this._updateDrawIdx();this.triggerMethod("sketch:cleared",this)}},undo:function(q){if(this.hasUndo(q)){var p=this._popUndoStack(q);this._redoStack.push(p);this._updateDrawIdx();this._clear(this._storedCtx);this.drawUndoStack()}},redo:function(q){if(this.hasRedo(q)){var p=this._popRedoStack(q);this.drawStoredAction(p);this._undoStack.push(p)}},flushUndoStack:function(){this._undoStack=[];this._redoStack=[];this._drawIdx=0},cancelDraws:function(p,q){if(b.is(p)&&p>0){if(this._isFromMe(q)){this.triggerMethod("sketch:live",{fctName:"cancelDraws",options:{force:true}},p,this._getLiveId())}while(p-->0){this._popUndoStack(q);this._updateDrawIdx()}this._clear(this._storedCtx);this.drawUndoStack()}},isBlank:function(){var p=false;return p},encode:function(){var r=0;var s=this._undoStack.length;var p=[];var q=null;for(r=s-1;r>-1;r--){q=this._undoStack[r];if(q.mode===3){break}p.push(q.encode())}return p.reverse()},decode:function(s){var p=0;var q=s.length;for(p=0;p<q;p++){var r=new a();r.decode(s[p]);r.setLiveId(-1);this._undoStack.push(r)}return""},drawSketch:function(y,t){var z=window.devicePixelRatio;var x=this._width/t.width;var u=this._height/t.height;var s={x:x,y:u};var v=(((t.lineWidth*x)+(t.lineWidth*u))/2);var C=t.path.points[y];C=C.multiply(s);var p=null;if(y-1>=0){p=t.path.points[y-1];p=p.multiply(s)}switch(t.mode){case f.ERASE:var w=v;if(p){this._storedCtx.save();this._storedCtx.beginPath();if(C instanceof g&&p instanceof g){this._storedCtx.arc(C.x,C.y,w,0*Math.PI,1.9*Math.PI);this._storedCtx.arc(p.x,p.y,w,0*Math.PI,1.9*Math.PI);var q=new g(C.x-p.x,C.y-p.y);q=q.normalize(w);var r=q.left();var A=q.right();this._storedCtx.moveTo(C.x+r.x,C.y+r.y);this._storedCtx.lineTo(p.x+r.x,p.y+r.y);this._storedCtx.lineTo(p.x+A.x,p.y+A.y);this._storedCtx.lineTo(C.x+A.x,C.y+A.y);if(this._drawEraser){this._storedCtx.fillStyle=this._backgroundColor;this._storedCtx.fill()}else{this._storedCtx.clip();var B=Math.round(this._transientCvs.width/2);this._storedCtx.clearRect(0,0,B,this._transientCvs.height);this._storedCtx.clearRect(B,0,this._transientCvs.width,this._transientCvs.height)}}this._storedCtx.restore()}break;case f.PEN:if(p){this._storedCtx.lineWidth=v;this._storedCtx.fillStyle=this._storedCtx.strokeStyle=t.color;this._storedCtx.beginPath();this._storedCtx.moveTo(p.point.x,p.point.y);this._storedCtx.bezierCurveTo(p.point.x+p.handleOut.x,p.point.y+p.handleOut.y,C.point.x+C.handleIn.x,C.point.y+C.handleIn.y,C.point.x,C.point.y);this._storedCtx.stroke()}break;default:break}},lineDistance:function(r,u,p,s){var q=Math.pow(p-r,2);var t=Math.pow(s-u,2);return Math.sqrt(q+t)},drawUndoStack:function(){var q=i.deferred();var r=this;var p=function(){for(var s=r._drawIdx;s<r._undoStack.length;s++){if(0===s&&f.IMAGE===r._undoStack[s].mode){continue}r.drawStoredAction(r._undoStack[s])}q.resolve()};if(this._undoStack[this._drawIdx]&&this._undoStack[this._drawIdx].mode===4){if(/^data:image\/png;base64,/i.test(this._undoStack[this._drawIdx].image)){this._drawImage(this._undoStack[this._drawIdx].image).then(p)}else{this.drawSVG(this._undoStack[this._drawIdx].image);p()}}else{if(this._drawIdx<=0&&this._sketchImage){if(/^data:image\/png;base64,/i.test(this._sketchImage)){this._drawImage(this._sketchImage).then(p)}else{this.drawSVG(this._sketchImage);p()}}else{p()}}return q.promise},redraw:function n(p){this._clear(this._storedCtx);this.flushUndoStack();if(m.isArray(p)){this.decode(p)}this.drawUndoStack()},setSettings:function(p){},getSettings:function(){return{mode:this.getMode(),fillStyle:this.getColor()}},resize:function(s,p){var r=i.deferred();if(this._transientCtx){if((!s>0||!p>0)&&this._container){var q=c(this._container);s=q[0].getBoundingClientRect().width;p=q[0].getBoundingClientRect().height}if(s>0&&p>0&&(this._width!==s||this._height!==p)){this._width=s;this._height=p;this._rebuildSketch().then(function(){r.resolve()});this.triggerMethod("sketch:resized",this)}else{r.resolve()}}else{r.resolve()}return r.promise},loadImage:function(q,p,r){this._drawImage(q,p,r);this._undoStack.push({mode:f.IMAGE,image:q})},toDataUrl:function(w,q,x,v){var y=i.deferred();var t=this;var r=undefined;q=b.is(q)?q:this._width;x=b.is(x)?x:this._height;w=b.is(w)?w:"image/png";var s=this._width;var u=this._height;var p=this.getOption("container");if(p){this.resize(q,x).then(c.proxy(function(){if(b.is(v)&&v.length>0){this.drawText(q,x,v)}r=c(p).find("canvas")[0].toDataURL(w);t.resize(s,u);y.resolve(r)},this))}return y.promise},toSVG:function(q,x,w){var r=null;var t=this;var y=i.deferred();var v=window.devicePixelRatio;var p=new d((q||this._width)*v,(x||this._height)*v);var u=this._storedCtx;this._storedCtx=p;this._storedCtx.scale(v,v);this._drawEraser=true;var s=this._drawIdx-1>=0?this._drawIdx-1:0;if(this._undoStack.length<=0&&w){t.drawText(q,x,w);this._drawEraser=false;r=p.getSerializedSvg(true);t._storedCtx=u;r=t._restore_base64(r);r=t._remove_precision(r);y.resolve(r)}else{if(w&&b.is(this._undoStack[s])&&this._undoStack[s].mode===3&&this._drawIdx===this._undoStack.length){t.drawText(q,x,w);this.drawUndoStack().then(function(){t._drawEraser=false;r=p.getSerializedSvg(true);t._storedCtx=u;r=t._restore_base64(r);r=t._remove_precision(r);y.resolve(r)})}else{this.drawUndoStack().then(function(){t._drawEraser=false;r=p.getSerializedSvg(true);t._storedCtx=u;r=t._restore_base64(r);r=t._remove_precision(r);y.resolve(r)})}}return y.promise},_remove_precision:function(p){return p.replace(/(\.\d)\d+/g,"$1")},_restore_base64:function(p){try{var r=c.parseXML(p);r=this.__restore_base64_recursive(r);p=new XMLSerializer().serializeToString(r)}catch(q){this._logger.error(q)}return p},__restore_base64_recursive:function(z){var s=null;var C=null;var y=null;var v=null;var r=null;var u=null;var t=null;var q=null;var x=null;var p=null;var D=null;var w=null;var E=null;var A=null;var B=null;if(z){s=z.getElementsByTagName("g");if(s){C=s[0];if(C){y=C.firstElementChild;if(y&&y.tagName==="image"){v=y.getAttribute("xlink:href");p=y.getAttribute("width");D=y.getAttribute("height");if(b.is(v,"string")&&this._check_svg64header(v)){r=atob(v.substring(26));if(b.is(r,"string")){u=c.parseXML(r);if(u){w=u.firstElementChild.getAttribute("width");E=u.firstElementChild.getAttribute("height");u=this.__restore_base64_recursive(u);t=u.getElementsByTagName("g");if(t){q=t[0];if(q){y.remove();A=document.createElementNS("http://www.w3.org/2000/svg","svg");A.setAttribute("viewBox","0 0 "+w+" "+E);for(x=q.childElementCount;x>0;x--){B=Number(q.children[x-1].getAttribute("stroke-width"));q.children[x-1].setAttribute("stroke-width",(w/p)*B);A.prepend(q.children[x-1])}C.prepend(A)}}}}}}}}}return z},_check_svg64header:function(p){var q="data:image/svg+xml;base64,";return(b.is(p,"string")&&p.substring(0,q.length)===q)},drawText:function(){},getOrCreateAction:function(w,s,t,r,u,q,x){s=b.is(s)?s:this._getLiveId();var p=this._touchStore.get(this._computeActionId(w,s));if(!b.is(p)){var v=window.devicePixelRatio;var y=window.screen.width/1920;t=t||this.getMode();r=r||this.getColor();u=u||(((t===2?30:this.getLineWidth())*y));p=new a({touchId:w,liveId:s,id:this._computeActionId(w,s),mode:t,color:r,lineWidth:u,width:q||this._width,height:x||this._height,path:new e()});this._touchStore.add(p)}return p},drawSVG:function(r){if(r){if(!b.is(r,"string")){r=new XMLSerializer().serializeToString(r)}var t="data:image/svg+xml;base64,";if(r.substring(0,t.length)===t){var q=b.createElement("img");q.src=r;this._storedCtx.drawImage(q,0,0,this._width,this._height)}else{var p=btoa(unescape(encodeURIComponent(r)));var s=t+p;var q=b.createElement("img");q.src=s;this._storedCtx.drawImage(q,0,0,this._width,this._height)}}},_rebuildSketch:function(){var p=i.deferred();var q=window.devicePixelRatio;this._clear(this._transientCtx);this._transientCvs.width=(this._container.offsetWidth||this._container.clientWidth||this._width)*q;this._transientCvs.height=(this._container.offsetHeight||this._container.clientHeight||this._height)*q;this._transientCtx.scale(q,q);this._transientCtx.lineCap=this.getOption("lineCap")||"round";this._clear(this._storedCtx);this._storedCvs.width=(this._container.offsetWidth||this._container.clientWidth||this._width)*q;this._storedCvs.height=(this._container.offsetHeight||this._container.clientHeight||this._height)*q;this._storedCtx.scale(q,q);this._storedCtx.lineCap=this.getOption("lineCap")||"round";this.drawUndoStack().then(function(){p.resolve()});return p.promise},_clear:function(p){if(p){p.clearRect(0,0,this._width,this._height)}},_clearArc:function(r,q,s,p){r.save();r.beginPath();r.arc(q,s,p,0,2*Math.PI,false);r.clip();r.clearRect(q-p,s-p,q+p,s+p);r.restore()},_drawImage:function(t,s,w){var x=i.deferred();var q=this.getOption("container");if(t&&q){var r=this._storedCtx;var v=new Image();var p=(s===undefined)?this._width:s;var u=(w===undefined)?this._height:w;v.onload=function(){r.drawImage(v,0,0,p,u);x.resolve()};v.src=t}else{x.resolve()}return x.promise},_updateDrawIdx:function(){this._drawIdx=0;for(var p=this._undoStack.length-1;p>=0;p--){if(this._undoStack[p].mode===f.CLEAR){this._drawIdx=p+1;break}}},_getLiveId:function(){return b.getGlobal().leanSessionManager.getLiveId()||0},_hasLiveId:function(q,p){p=b.is(p)?p:this._getLiveId();return p===q>>8},_isMine:function(p){return this._hasLiveId(p,this._getLiveId())},_isFromMe:function(p){return !b.is(p)||p===this._getLiveId()},_computeActionId:function(p,q){q=b.is(q)?q:this._getLiveId();return(q<<8)+(p&255)},_isDrawing:function(){var p=this;return this._touchStore.touches.some(function(q){return q.liveId===p._getLiveId()})},_popStack:function(r,s){var p=undefined;r=b.is(r)?r:this._getLiveId();for(var q=s.length-1;q>=0;q--){if(!b.is(s[q].liveId)||s[q].liveId===r){p=s[q];s.splice(q,1);break}}return p},_popUndoStack:function(p){return this._popStack(p,this._undoStack)},_popRedoStack:function(p){return this._popStack(p,this._redoStack)}});return o});define("DS/DEL3DLeanViews/Thumbnails/StickyThumbnailView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanHttpRequest/ImageService","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanEnums/Collection.enum","text!DS/DEL3DLeanViews/assets/template/Thumbnails/StickyThumbnailView.template.html","css!DS/DEL3DLeanViews/assets/css/Thumbnails/StickyThumbnailView.css"],function(e,f,i,g,b,h,c,a,d){var j=g.View.extend({className:"thumbnailView stickyThumbnailView",_logger:null,modelEvents:{"change:V_DEL3DL_Data":"dataUpdated","change:V_DEL3DL_Sketch_Image":"updateContent","change:V_DEL3DL_Background_Color":"updateBackground"},ui:{backgroundColor:"#stickyNoteViewBackground"},template:i.template(d),templateContext:function(){return i.extend(this.model.toJSON(),{get:f.proxy(this.model.get,this.model),iconPath:this.iconPath})},iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),initialize:function(){this._logger=b.getLogger(j);this.relationModel=this.getOption("relationModel")},onRender:function(){this._updatePeoplePicture(this.model.get("V_DEL3DL_AssignedPersonName"));this._updateStickerPicture(this.model.get("V_DEL3DL_Document_PID"));this._updateInformations();this.updateContent(this.model,this.model.get("V_DEL3DL_Sketch_Image"));this.updateBackground(this.model,this.model.get("V_DEL3DL_Background_Color"))},dataUpdated:function(m){var k=JSON.parse(m.attributes.V_DEL3DL_Data);var l=JSON.parse(m._previousAttributes.V_DEL3DL_Data);k=e.is(k)?k:{};l=e.is(l)?l:{};if(k.V_DEL3DL_AssignedPersonName!==l.V_DEL3DL_AssignedPersonName){this._updatePeoplePicture(this.model.get("V_DEL3DL_AssignedPersonName"))}if((k.V_DEL3DL_Document_PID!==l.V_DEL3DL_Document_PID)){this._updateStickerPicture(this.model.get("V_DEL3DL_Document_PID"))}this._dataUpdated(m,k,l)},autoResizeText:function(){var m=f(".stickyNoteDescription",this.$el).first();m.css("font-size","");var k=undefined;var l=undefined;while(m.get(0).scrollHeight>m.height()&&(k=m.css("font-size"))&&parseInt(k)>1){if(l===k){this._logger.warn("Bad font size provided by web browser, font resize stopped");break}l=k;m.css("font-size","-=.2")}},_dataUpdated:function(){var l=this.model.get("V_DEL3DL_Description");var k=f(".stickyNoteDescription",this.$el).first();k.text(l);this.autoResizeText()},_updateInformations:function(){f(".postit-info-status",this.$el).hide()},updateBackground:function(l,k){if(/^[a-f0-9]+$/i.test(k)){this.getUI("backgroundColor").css("background-image",'url("'+this.iconPath+'/Loading.svg")');h.getImage(k).then(f.proxy(function(m){this.getUI("backgroundColor").css("background",'url("'+m+'")')},this))}else{this.getUI("backgroundColor").css("background",k)}},_updatePeoplePicture:function(l){var k=f(".postit-header-peoplePicture",this.$el).first();if(!e.is(l)){k.hide()}else{k.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");k.show();var m=a.PEOPLES.sessionInstance.getOrFetch(l);if(e.is(m)){m.getPicture().then(f.proxy(function(n){k.attr("style","background-image: url("+n+")");k.show()},this))}else{k.hide()}}},_updateStickerPicture:function(l){var k=f(".postit-header-stickerPicture",this.$el).first();if(!e.is(l)){k.hide()}else{k.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");k.show();h.getImage(l).then(f.proxy(function(m){k.attr("style","background-image: url("+m+")");k.show()},this))}}});return j});define("DS/DEL3DLeanViews/ToolsSubpanels/TeamPanelView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanCollectionViews/SideCollectionViews/SideTeamCollectionView","text!DS/DEL3DLeanViews/assets/template/ToolsSubpanels/TeamPanelView.template.html","css!DS/DEL3DLeanViews/assets/css/ToolsSubpanels/TeamPanelView.css"],function(e,d,g,b,a,f){var c=g.View.extend({className:"sidePanel_teamView",regions:{sideTeamViewRegion:{selector:".sidePanel_teamView",replaceElement:true}},template:d.template(f),initialize:function(){this.sidePersonCollectionView=new a({collection:b.PEOPLES.sessionInstance})},onShow:function(){},onAttach:function(){},onRender:function(){this.showChildView("sideTeamViewRegion",this.sidePersonCollectionView)}});return c});define("DS/DEL3DLeanViews/ToolsSubpanels/FilterPanelView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","text!DS/DEL3DLeanViews/assets/template/ToolsSubpanels/FilterPanelView.template.html","css!DS/DEL3DLeanViews/assets/css/ToolsSubpanels/FilterPanelView.css"],function(a,d,c){var b=d.View.extend({className:"filterPanelView",regions:{},events:{},childViewEvents:{},template:a.template(c),initialize:function(){},onShow:function(){},onRender:function(){}});return b});define("DS/DEL3DLeanViews/Behaviors/CollisionMap",["UWA/Core","DS/Logger/Logger","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette"],function(d,a,c){var b=c.Object.extend({_mapWidth:0,_mapHeight:0,_occupationMap:null,_views:null,_logger:null,constructor:function b(){c.Object.prototype.constructor.apply(this,arguments)},initialize:function(f){f=f||{};if(!d.is(this._logger)){this._logger=a.getLogger(b)}var g=0;var e=0;this._mapWidth=f.width;this._mapHeight=f.height;if(!d.is(this._views)){this._views={}}if(!d.is(this._occupationMap)){this._occupationMap=new Array(this._mapWidth);for(g=0;g<this._mapWidth;g++){for(e=0;e<this._mapHeight;e++){if(!d.is(this._occupationMap[g])){this._occupationMap[g]=new Array(this._mapHeight)}this._occupationMap[g][e]={occupied:false,view:null}}}}},getViews:function(){return this._views},countViews:function(){return Object.keys(this._views).length},addView:function(g,f,n,l,e){l=l||1;e=e||1;var k=0;var h=0;var m={view:g,occupied:true,x:f,y:n,width:l,height:e};this._views[g.cid]=m;for(k=0;k<l;k++){for(h=0;h<e;h++){this._occupationMap[f+k][n+h]=m}}},removeView:function(e){var h=this.getViewCoordinates(e);if(!d.is(h)){return}var g=0;var f=0;this._views[e.cid]=null;var k={view:null,occupied:false};for(g=0;g<h.width;g++){for(f=0;f<h.height;f++){this._occupationMap[h.x+g][h.y+f]=k}}delete this._views[e.cid]},moveView:function(g,f,i,h,e){this.removeView(g);this.addView(g,f,i,h,e)},getViewCoordinates:function(e){if(!d.is(e)){return null}return this._views[e.cid]},isSpaceFree:function(f,n,l,e,g){l=l||1;e=e||1;if(!this._checkBounds(f,n,l,e)){return false}var k=0;var h=0;var m=null;for(k=0;k<l;k++){for(h=0;h<e;h++){m=this._occupationMap[f+k][n+h];if(m.occupied&&m.view!==g){return false}}}return true},searchFreeSpace:function(n,k,e,o,l){e=e<=0?1:e;o=o<=0?1:o;var g=this.isSpaceFree(n,k,e,o,l);if(g){return{x:n,y:k}}var m=o>e;var j=1;var h=false;var f=null;while(!h){if(!m){f=this._checkHorizontal(j,n,k,e,o,l);if(f){return f}}else{f=this._checkVertical(j,n,k,e,o,l);if(f){return f}}f=this._checkDiagonals(j,n,k,e,o,l);if(f){return f}j++;h=n-j<0&&n+j>=this._mapWidth&&k-j<0&&k+j>=this._mapHeight}return null},dump:function(){var e=0;for(e=0;e<this._mapHeight;e++){this._logger.log("+=================================================+");this._logger.log("|\t"+this._printBlock(0,e)+"|"+this._printBlock(1,e)+"|"+this._printBlock(2,e)+"|")}this._logger.log("+=================================================+")},_printBlock:function(e,f){if(this._occupationMap[e][f].view){return"\t"+this._occupationMap[e][f].view.cid+"\t"}return"\t\t\t\t"},_checkHorizontal:function(h,f,l,j,e,g){var k=false;if(f-h>=0){k=this.isSpaceFree(f-h,l,j,e,g);if(k){return{x:f-h,y:l}}}if(f+h<this._mapWidth){k=this.isSpaceFree(f+h,l,j,e,g);if(k){return{x:f+h,y:l}}}if(l-h>=0){k=this.isSpaceFree(f,l-h,j,e,g);if(k){return{x:f,y:l-h}}}if(l+h<this._mapHeight){k=this.isSpaceFree(f,l+h,j,e,g);if(k){return{x:f,y:l+h}}}return null},_checkVertical:function(h,f,l,j,e,g){var k=false;if(l-h>=0){k=this.isSpaceFree(f,l-h,j,e,g);if(k){return{x:f,y:l-h}}}if(l+h<this._mapHeight){k=this.isSpaceFree(f,l+h,j,e,g);if(k){return{x:f,y:l+h}}}if(f-h>=0){k=this.isSpaceFree(f-h,l,j,e,g);if(k){return{x:f-h,y:l}}}if(f+h<this._mapHeight){k=this.isSpaceFree(f+h,l,j,e,g);if(k){return{x:f+h,y:l}}}return null},_checkDiagonals:function(k,f,n,l,e,g){var m=false;var h=1;for(h=1;h<=k;h++){if(f-h>=0&&n-k>=0){m=this.isSpaceFree(f-h,n-k,l,e,g);if(m){return{x:f-h,y:n-k}}}if(f+h<this._mapWidth&&n-k>=0){m=this.isSpaceFree(f+h,n-k,l,e,g);if(m){return{x:f+h,y:n-k}}}if(f-h>=0&&n+k<this._mapHeight){m=this.isSpaceFree(f-h,n+k,l,e,g);if(m){return{x:f-h,y:n+k}}}if(f+h<this._mapWidth&&n+k<this._mapHeight){m=this.isSpaceFree(f+h,n+k,l,e,g);if(m){return{x:f+h,y:n+k}}}if(f-k>=0&&n-h>=0){m=this.isSpaceFree(f-k,n-h,l,e,g);if(m){return{x:f-k,y:n-h}}}if(f-k>=0&&n+h<this._mapHeight){m=this.isSpaceFree(f-k,n+h,l,e,g);if(m){return{x:f-k,y:n+h}}}if(f+k<this._mapWidth&&n-h>=0){m=this.isSpaceFree(f+k,n-h,l,e,g);if(m){return{x:f+k,y:n-h}}}if(f+k<this._mapWidth&&n+h<this._mapHeight){m=this.isSpaceFree(f+k,n+h,l,e,g);if(m){return{x:f+k,y:n+h}}}}return null},_checkBounds:function(f,m,k,e){k=k||1;e=e||1;var h=0;var g=0;var l=false;for(h=0;h<k;h++){for(g=0;g<e;g++){l=f+h<0||f+h>=this._mapWidth||m+g<0||m+g>=this._mapHeight;if(l){return false}}}return true}});return b});define("DS/DEL3DLeanViews/EmptyViews/LoadingEmptyView",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","text!DS/DEL3DLeanViews/assets/template/EmptyViews/LoadingEmptyView.template.html","css!DS/DEL3DLeanViews/assets/css/EmptyViews/LoadingEmptyView.css"],function(h,c,g,b,f,e,d){var a=g.View.extend({name:"LoadingEmptyView",className:"loadingEmptyView",template:c.template(d),emptyView:true,iconPath:f.getWebappsAssetUrl("DEL3DLeanViews","icons"),_logger:null,templateContext:function(){return{iconPath:this.iconPath,nls_empty:e.getTranslation("empty"),isEmpty:this._isEmpty}},constructor:function a(){g.View.prototype.constructor.apply(this,arguments)},initialize:function(){this._isEmpty=false;if(!h.is(this._logger)){this._logger=b.getLogger(a)}},showEmpty:function(){this._isEmpty=true;this.render()}});return a});define("DS/DEL3DLeanViews/AView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanHttpRequest/MessageHandler"],function(f,e,q,l,i,d){var p=i.View.extend({name:"AView",className:"aView",liveChannel:l.channel("live"),liveUID:"B2D6F297-8B49-494D-990A-95DAF425BF61",extendModelEvents:{},modelEvents:function(){var u=null;var t=null;var s=null;u=q.result(this.constructor.__super__,"modelEvents",{});t=q.result(this,"extendModelEvents",{});s=q.extend(u,t);return s},initialize:function b(){this.onLiveDelegate=this.onLiveDelegate||e.proxy(this.onLive,this);this.enableLive(true,{forced:true})},callParent:function k(u,t,s){s=s||[];if(typeof u==="object"&&typeof t==="string"&&q.isFunction(u[t])){u[t].apply(this,s)}},enableLive:function h(u,t){t=t||{};if(f.is(this.model)&&this.model.has("physicalid")){var s=this.getConcatenatedPID()+":"+this.name.toLowerCase()+":update";s+=t.forced===true?":forced":"";if(u){this.liveChannel.on(s,this.onLiveDelegate)}else{this.liveChannel.off(s,this.onLiveDelegate)}}},onDestroy:function g(){this.enableLive(false);this.enableLive(false,{forced:true})},onLive:function o(s){if(f.is(s)&&f.is(s.fctName)&&q.isArray(s.args)){if(typeof this[s.fctName]==="function"){this[s.fctName].apply(this,s.args)}else{if(s.fctName.substr(0,2)==="on"){s.fctName=s.fctName.charAt(2).toLowerCase()+s.fctName.substr(3)}this.triggerMethod.apply(this,[s.fctName].concat(s.args))}}},liveIt:function m(w,s,t){t=t||{};s=Object.values(s||[]);if(this.isFromSlave(s)){return false}if(f.is(t.args)){s=q.isArray(t.args)?t.args:[t.args]}else{var x=[];for(var v=0;v<s.length;v++){x[v]=s[v]}s=x}s[s.length]=this.liveUID;var u=this.name.toLowerCase()+":update";u+=t.force===true?":forced":"";delete t.args;d.send({pid:this.getConcatenatedPID(),eventType:u,fctName:w,args:s,info:t},t);return true},isFromSlave:function a(s){return s.length>0&&s[s.length-1]===this.liveUID},getLiveId:function c(){return d.getLiveId()},getPID:function n(){var s=f.is(this.model)?this.model.get("physicalid"):undefined;return s},getRelPID:function r(){var s=f.is(this.relationModel)?this.relationModel.get("physicalid"):undefined;return s},getConcatenatedPID:function j(){return this.getPID()}});return p});define("DS/DEL3DLeanViews/EmptyViews/MapEmptyView",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","text!DS/DEL3DLeanViews/assets/template/EmptyViews/MapEmptyView.template.html","css!DS/DEL3DLeanViews/assets/css/EmptyViews/MapEmptyView.css"],function(h,b,g,a,e,d,c){var f=g.View.extend({name:"MapEmptyView",className:"mapEmptyView",template:b.template(c),emptyView:true,iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),_logger:null,templateContext:function(){return{iconPath:this.iconPath,nls_coachmark_map_tools:d.getTranslation("coachmark_map_tools"),nls_coachmark_map_customize:d.getTranslation("coachmark_map_customize"),nls_coachmark_map_select:d.getTranslation("coachmark_map_select")}},constructor:function f(){g.View.prototype.constructor.apply(this,arguments)},initialize:function(){if(!h.is(this._logger)){this._logger=a.getLogger(f)}}});return f});define("DS/DEL3DLeanViews/EmptyViews/PageEmptyView",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/EmptyViews/PageEmptyView.template.html","css!DS/DEL3DLeanViews/assets/css/EmptyViews/PageEmptyView.css"],function(g,d,f,c,e,a){var b=f.View.extend({name:"PageEmptyView",className:"pageEmptyView",template:d.template(a),emptyView:true,iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),_logger:null,templateContext:function(){return{iconPath:this.iconPath}},constructor:function b(){f.View.prototype.constructor.apply(this,arguments)},initialize:function(){if(!g.is(this._logger)){this._logger=c.getLogger(b)}}});return b});define("DS/DEL3DLeanViews/ToolsSubpanels/StickerPanelView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanSession/Session.manager","DS/DEL3DLeanCollectionViews/SideCollectionViews/SideStickerCollectionView","text!DS/DEL3DLeanViews/assets/template/ToolsSubpanels/StickerPanelView.template.html","css!DS/DEL3DLeanViews/assets/css/ToolsSubpanels/StickerPanelView.css"],function(d,h,g,b,c,f,a){var e=g.View.extend({className:"stickerPanelView",template:d.template(a),_logger:null,regions:{stickersRegion:"div.stickersRegion"},_stickerCollectionView:null,initialize:function(){this._stickerCollectionView=new f({collection:new h.Collection()});this.listenTo(c,"after:loadsession",this.init.bind(this));this._logger=b.getLogger(e)},init:function(){var i=this;c.getPublicStickerSpace().listContent().then(function(j){i._stickerCollectionView.collection.reset(j.models);if(j.models.length<=0){i._stickerCollectionView.showEmpty()}},function(j){i._logger.error(j)})},onRender:function(){this.showChildView("stickersRegion",this._stickerCollectionView)}});return e});define("DS/DEL3DLeanViews/Factories/ViewsFactory",[],function(){var a={name:"ViewFactory",createView:function(c,b){var d=null;if(c){d=new c(b)}return d}};return a});define("DS/DEL3DLeanViews/Utils/UIUtils",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","UWA/Core","DS/Logger/Logger","text!DS/DEL3DLeanViews/assets/css/noAnimation.css"],function(i,g,d,k,c,b,e){var f=null;var a=g.Object.extend({name:"UIUtils",uiRadioChannel:k.channel("uiutils"),init:function j(){this._logger=b.getLogger(a)},endTransitionEvent:function(m,l){var n=widget.getValue("Animations");if(n==="true"||n===true){m.one("transitionend",l)}else{l()}},addClass:function(m,l){var n=i.isArray(l,"array")?l:[l];return m.addClass(n.join(" "))},addClassWithTransition:function(m,l,n){var o=widget.getValue("Animations");this.uiRadioChannel.trigger("before:"+n);if(o==="true"||o===true){m.one("transitionend",d.proxy(function(){this.uiRadioChannel.trigger("after:"+n)},this))}this.addClass(m,l);if(o!=="true"&&o!==true){this.uiRadioChannel.trigger("after:"+n)}return m},removeClass:function(m,l){var n=i.isArray(l,"array")?l:[l];return m.removeClass(n.join(" "))},removeClassWithTransition:function(m,l,n){var o=widget.getValue("Animations");this.uiRadioChannel.trigger("before:"+n);if(o==="true"||o===true){m.one("transitionend",d.proxy(function(){this.uiRadioChannel.trigger("after:"+n)},this))}this.removeClass(m,l);if(o!=="true"&&o!==true){this.uiRadioChannel.trigger("after:"+n)}return m},initAnimationStyle:function(){this._noAnimationStyle=document.createElement("style");this._noAnimationStyle.type="text/css";if(this._noAnimationStyle.styleSheet){this._noAnimationStyle.styleSheet.cssText=e}else{this._noAnimationStyle.appendChild(document.createTextNode(e))}},setAnimations:function(l){if(l!==this._animations){this._animations=l;var m=document.getElementsByTagName("head")[0];if(l==="false"||l===false){if(!m.contains(this._noAnimationStyle)){m.appendChild(this._noAnimationStyle)}}else{if(m.contains(this._noAnimationStyle)){m.removeChild(this._noAnimationStyle)}}}}});function h(){if(!c.is(f)){f=new a();f.init()}return f}return h()});define("DS/DEL3DLeanViews/Behaviors/HammerBehavior",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VEN3DLeanHammer/hammer.2.0.8/hammer.min"],function(e,c,d,b){var a=d.Behavior.extend({_enableTap:false,_enablePress:false,_enableSwipe:false,_enablePan:false,_enablePinch:false,_tapEnabled:false,_pressEnabled:false,_swipeEnabled:false,_panEnabled:false,_pinchEnabled:false,_hammerManager:null,_hammerTap:null,_hammerPress:null,_hammerSwipe:null,_hammerPan:null,_hammerPinch:null,_elementClassName:null,_eventDirection:null,_threshold:null,initialize:function(){this._isActiveOnRender=e.is(this.getOption("isActiveOnRender"))?this.getOption("isActiveOnRender"):true;this._enableTap=this.getOption("enableTapEvent");this._enablePress=this.getOption("enablePressEvent");this._enableSwipe=this.getOption("enableSwipeEvent");this._enablePan=this.getOption("enablePanEvent");this._enablePinch=this.getOption("enablePinchEvent");this._pinchPointers=this.getOption("pinchPointers");this._pinchThreshold=e.is(this.getOption("pinchThreshold"))?this.getOption("pinchThreshold"):0;this._threshold=e.is(this.getOption("threshold"))?this.getOption("threshold"):20;this._eventDirection=e.is(this.getOption("eventDirection"))?this.getOption("eventDirection"):b.DIRECTION_ALL;this._elementClassName=this.getOption("className");this._tapEventCallbackDelegate=c.proxy(function(f){if(this._tapEnabled&&e.is(this.view.tapEventCallback)){this.view.tapEventCallback(f)}this._hammerTap._input.pointers.splice(0,this._hammerTap._input.pointers.length)},this);this._pressEventCallbackDelegate=c.proxy(function(f){if(this._pressEnabled&&e.is(this.view.pressEventCallback)){this.view.pressEventCallback(f)}this._hammerPress._input.pointers.splice(0,this._hammerPress._input.pointers.length)},this);this._swipeEventCallbackDelegate=c.proxy(function(f){if(this._swipeEnabled&&e.is(this.view.swipeEventCallback)){this.view.swipeEventCallback(f)}},this);this._panStartEventCallbackDelegate=c.proxy(function(f){if(this._panEnabled&&e.is(this.view.panStartEventCallback)){this.view.panStartEventCallback(f)}},this);this._panEventCallbackDelegate=c.proxy(function(f){if(this._panEnabled&&e.is(this.view.panEventCallback)){this.view.panEventCallback(f)}},this);this._panEndEventCallbackDelegate=c.proxy(function(f){if(this._panEnabled&&e.is(this.view.panEndEventCallback)){this.view.panEndEventCallback(f)}},this);this._pinchStartEventCallbackDelegate=c.proxy(function(f){if(this._pinchEnabled&&e.is(this.view.pinchStartEventCallback)){this.view.pinchStartEventCallback(f)}},this);this._pinchEventCallbackDelegate=c.proxy(function(f){if(this._pinchEnabled&&e.is(this.view.pinchEventCallback)){this.view.pinchEventCallback(f)}},this);this._pinchInEventCallbackDelegate=c.proxy(function(f){if(this._pinchEnabled&&e.is(this.view.pinchInEventCallback)){this.view.pinchInEventCallback(f)}},this);this._pinchOutEventCallbackDelegate=c.proxy(function(f){if(this._pinchEnabled&&e.is(this.view.pinchOutEventCallback)){this.view.pinchOutEventCallback(f)}},this);this._pinchEndEventCallbackDelegate=c.proxy(function(f){if(this._pinchEnabled&&e.is(this.view.pinchEndEventCallback)){this.view.pinchEndEventCallback(f)}},this);this._hammerTap=new b.Tap({time:500,enable:false});this._hammerPress=new b.Press({threshold:this._threshold,time:501,enable:false});this._hammerSwipe=new b.Swipe({pointers:2,direction:this._eventDirection,threshold:c(window).width()/10,velocity:0.5,enable:false});this._hammerPan=new b.Pan({threshold:this._threshold,direction:this._eventDirection,enable:false});this._hammerPinch=new b.Pinch({pointers:this._pinchPointers,threshold:this._pinchThreshold,enable:false})},onRender:function(){if(this._isActiveOnRender){if(e.is(this._hammerManager)){this._enableTap=this._tapEnabled;this._enablePress=this._pressEnabled;this._enableSwipe=this._swipeEnabled;this._enablePan=this._panEnabled;this._enablePinch=this._pinchEnabled;this._destroyHammerManager()}this._initHammerManager()}},onDestroy:function(){this._destroyHammerManager()},onViewEnableTap:function(f){if(f){if(!this._tapEnabled){this._hammerTap.options.enable=true;this._hammerManager.input.store=[];this._hammerManager.on("tap",this._tapEventCallbackDelegate)}}else{this._hammerTap.options.enable=false;this._hammerManager.input.store=[];this._hammerManager.off("tap",this._tapEventCallbackDelegate)}this._tapEnabled=f},onViewEnablePress:function(f){if(f){if(!this._pressEnabled){this._hammerPress.options.enable=true;this._hammerManager.input.store=[];this._hammerManager.on("press",this._pressEventCallbackDelegate)}}else{this._hammerPress.options.enable=false;this._hammerManager.input.store=[];this._hammerManager.off("press",this._pressEventCallbackDelegate)}this._pressEnabled=f},onViewEnableSwipe:function(f){if(f){if(!this._swipeEnabled){this._hammerSwipe.options.enable=true;this._hammerManager.input.store=[];this._hammerManager.on("swipe",this._swipeEventCallbackDelegate)}}else{this._hammerSwipe.options.enable=false;this._hammerManager.input.store=[];this._hammerManager.off("swipe",this._swipeEventCallbackDelegate)}this._swipeEnabled=f},onViewEnablePan:function(f){if(f){if(!this._panEnabled){this._hammerPan.options.enable=true;this._hammerManager.on("panstart",this._panStartEventCallbackDelegate);this._hammerManager.on("pan",this._panEventCallbackDelegate);this._hammerManager.on("panend",this._panEndEventCallbackDelegate)}}else{this._hammerPan.options.enable=false;this._hammerManager.off("panstart",this._panStartEventCallbackDelegate);this._hammerManager.off("pan",this._panEventCallbackDelegate);this._hammerManager.off("panend",this._panEndEventCallbackDelegate)}this._panEnabled=f},onViewEnablePinch:function(f){if(f){if(!this._pinchEnabled){this._hammerPinch.options.enable=true;this._hammerManager.on("pinchstart",this._pinchStartEventCallbackDelegate);this._hammerManager.on("pinch",this._pinchEventCallbackDelegate);this._hammerManager.on("pinchin",this._pinchInEventCallbackDelegate);this._hammerManager.on("pinchout",this._pinchOutEventCallbackDelegate);this._hammerManager.on("pinchend",this._pinchEndEventCallbackDelegate)}}else{this._hammerPinch.options.enable=false;this._hammerManager.off("pinchstart",this._pinchStartEventCallbackDelegate);this._hammerManager.off("pinch",this._pinchEventCallbackDelegate);this._hammerManager.off("pinchin",this._pinchInEventCallbackDelegate);this._hammerManager.off("pinchout",this._pinchOutEventCallbackDelegate);this._hammerManager.off("pinchend",this._pinchEndEventCallbackDelegate)}this._pinchEnabled=f},onViewActiveHammer:function(h,g,f,j,i){if(h||g||f||j||i){this._enableTap=h;this._enablePress=g;this._enableSwipe=f;this._enablePan=j;this._enablePinch=i;this._initHammerManager();this._isActiveOnRender=true}else{this._destroyHammerManager();this._isActiveOnRender=false}},_initHammerManager:function(){if(!e.is(this._hammerManager)){var f=this._elementClassName?c(this._elementClassName,this.view.$el)[0]:this.view.$el[0];this._hammerManager=new b.Manager(f);if(this.getOption("useTapEvent")){this._hammerManager.add(this._hammerTap)}if(this.getOption("usePressEvent")){this._hammerManager.add(this._hammerPress)}if(this.getOption("useSwipeEvent")){this._hammerManager.add(this._hammerSwipe)}if(this.getOption("usePanEvent")){this._hammerManager.add(this._hammerPan)}if(this.getOption("usePinchEvent")){this._hammerManager.add(this._hammerPinch)}this.onViewEnableTap(this._enableTap);this.onViewEnablePress(this._enablePress);this.onViewEnableSwipe(this._enableSwipe);this.onViewEnablePan(this._enablePan);this.onViewEnablePinch(this._enablePinch)}},_destroyHammerManager:function(){if(e.is(this._hammerManager)){this.onViewEnableTap(false);this.onViewEnablePress(false);this.onViewEnableSwipe(false);this.onViewEnablePan(false);this.onViewEnablePinch(false);this._hammerManager.destroy();this._hammerManager=null}}});return a});define("DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/CoachMarkView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanResources/ResourcesManager","DS/WebappsUtils/WebappsUtils","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/assets/enums/SideBarActionEnum","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/CoachMarkView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/CoachMarkView.css"],function(d,e,i,h,b,c,j,f,a){var g=h.View.extend({className:"coachMarkView",template:i.template(a),iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),templateContext:function(){return i.extend(this.model.toJSON(),{iconPath:this.iconPath,infraCoachMarkImg:"CustomizeIcon.svg",infraCoachMarkFocusImg:"CustomizeIcon.svg",infraCoachMarkFocusRessource:b.getTranslation("coachmark_example")})},sideBarRadioChannel:j.channel("sidebar"),staticRadioChannel:j.channel("static"),initialize:function(k){h.View.prototype.initialize.apply(this,[k]);this.infraView=k.parentView;if(d.is(this._initialize)){this._initialize()}this.afterFocusViewDelegate=e.proxy(this.afterFocusView,this)},showView:function(){this.hideShowRules();if(this.coachMarkHidden===false){e(".infraCoachMarkContainer",this.infraView.$el).css("display","block");this.infraView.showChildView("coachMarkRegion",this.infraView.coachMarkView);if(this.infraView.focused){e(".infraCoachMark",this.$el).css("display","none");e(".infraCoachMarkFocus",this.$el).css("display","block")}else{e(".infraCoachMarkFocus",this.$el).css("display","none");e(".infraCoachMark",this.$el).css("display","block")}}},detachView:function(){if(d.is(this.infraView.getRegion("coachMarkRegion").currentView)){this.infraView.detachChildView("coachMarkRegion",this.infraView.coachMarkView)}e(".infraCoachMarkContainer",this.infraView.$el).css("display","none")},setFocusView:function(k){if(k){this.staticRadioChannel.once("after:focus",this.afterFocusViewDelegate);e(".infraCoachMark",this.$el).css("display","none");e(".infraCoachMarkFocus",this.$el).css("display","block")}else{e(".infraCoachMarkFocus",this.$el).css("display","none");e(".infraCoachMark",this.$el).css("display","block")}},afterFocusView:function(){if(!this.coachMarkHidden&&!d.getGlobal().inMeeting){this.sideBarRadioChannel.trigger("sideBarView:openMenu","left",f.CUSTOMIZE)}},hideShowRules:function(){this.coachMarkHidden=true}});return g});define("DS/DEL3DLeanViews/Behaviors/InteractBehavior",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","pluginDS!DS/VENInteract/interact.1.4.0/interact.min","pluginDS!DS/VENInteract/interact.1.2.8/interact.min"],function(h,c,g,d,b,a){var f=g.Behavior.extend({_droppableEnabled:false,_draggableEnabled:false,_gesturableEnabled:false,_draggableRestriction:null,_interactManager:null,_draggedElements:0,_lGlobal:h.getGlobal(),_interactRadio:d.channel("interact"),initialize:function(){this._isActiveOnRender=h.is(this.getOption("isActiveOnRender"))?this.getOption("isActiveOnRender"):true;this._isDraggable=h.is(this.getOption("isDraggable"))?this.getOption("isDraggable"):false;this._isDroppable=h.is(this.getOption("isDroppable"))?this.getOption("isDroppable"):false;this._isGesturable=h.is(this.getOption("isGesturable"))?this.getOption("isGesturable"):false;this._enableDraggable=h.is(this.getOption("enableDrag"))?this.getOption("enableDrag"):false;this._enableDroppable=h.is(this.getOption("enableDrop"))?this.getOption("enableDrop"):false;this._enableGesturable=h.is(this.getOption("enableGesturable"))?this.getOption("enableGesturable"):false;this._isManualStart=h.is(this.getOption("isManualStart"))?this.getOption("isManualStart"):false;this._elementClassName=h.is(this.getOption("className"))?this.getOption("className"):null;this._draggableRestriction=h.is(this.getOption("draggableRestriction"))?this.getOption("draggableRestriction"):"parent";this._dropAcceptClassName=h.is(this.getOption("enableDropAcceptClass"))?this.getOption("enableDropAcceptClass"):null;this._allowFrom=h.is(this.getOption("allowFrom"))?this.getOption("allowFrom"):null;this._ignoreFrom=h.is(this.getOption("ignoreFrom"))?this.getOption("ignoreFrom"):null;this._enableLive=this.getOption("enableLive");this._dropAcceptClassNameArray=h.is(this._dropAcceptClassName)?this._dropAcceptClassName.replace(/\,/g,"").replace(/\./g,"").split(" "):[];this.startDragCallbackDelegate=c.proxy(this._startDragCallback,this);this.endDragCallbackDelegate=c.proxy(this._endDragCallback,this)},onRender:function(){if(this._isActiveOnRender){this.onViewResetInteract()}},onDestroy:function(){this._destroyInteractManager()},onViewResetInteract:function(){if(h.is(this._interactManager)){this._enableDraggable=this._draggableEnabled;this._enableDroppable=this._droppableEnabled;this._enableGesturable=this._gesturableEnabled;this._destroyInteractManager()}if(h.is(this.view.interactOptions)){c.extend(this,this.view.interactOptions)}this._initInteractManager()},onViewEnableInteract:function(i){if(h.is(this._interactManager)){if(this._isDraggable){this.onViewEnableDrag(i)}if(this._isDroppable){this.bindDragEvents(i)}if(this._isGesturable){this.onViewEnableGesturable(i)}}},onViewActiveInteract:function(k,j,i){if(k||j||i){this._enableDraggable=k;this._enableDroppable=j;this._enableGesturable=i;this._initInteractManager();this._isActiveOnRender=true}else{this._destroyInteractManager();this._isActiveOnRender=false}},_hasCommonElement:function(j,i){return j.some(function(k){return i.indexOf(k)>-1})},_startDragCallback:function(j){var i=j.split(" ");if(this._hasCommonElement(this._dropAcceptClassNameArray,i)){if(this._draggedElements===0){this.onViewEnableDrop(true)}++this._draggedElements}},_endDragCallback:function(j){var i=j.split(" ");if(this._hasCommonElement(this._dropAcceptClassNameArray,i)){var k=this;--this._draggedElements;if(this._draggedElements===0){setTimeout(function(){k.onViewEnableDrop(false)},0)}}},bindDragEvents:function(i){if(i){if(this.dragBinded!==true){this.dragBinded=true;this._interactRadio.on("interact:startDrag",this.startDragCallbackDelegate);this._interactRadio.on("interact:endDrag",this.endDragCallbackDelegate)}}else{this._interactRadio.off("interact:startDrag",this.startDragCallbackDelegate);this._interactRadio.off("interact:endDrag",this.endDragCallbackDelegate);this.dragBinded=false}},onViewEnableDrag:function(i){if(!this._isDraggable){return}if(!i||(i&&!this._draggableEnabled)){if(i){this._interactElement.addClass("canDrag")}else{this._interactElement.removeClass("canDrag")}this._interactManager.draggable(i);if(this._isManualStart){if(i){this.draggable.on("move",this._manualStartCallBack)}else{this.draggable.off("move",this._manualStartCallBack)}}}this._draggableEnabled=i},onViewEnableDrop:function(i){if(!this._isDroppable||!h.is(this._interactManager)){return}if(!i||(i&&!this._droppableEnabled)){this._interactManager.dropzone(i)}this._droppableEnabled=i},onViewEnableGesturable:function(i){if(!this._isGesturable){return}if(!i||(i&&!this._gesturableEnabled)){this._interactManager.gesturable(i)}this._gesturableEnabled=i},_initInteractManager:function(){if(!h.is(this._interactManager)){var i=this._elementClassName?this._elementClassName:"#"+this.view.cid;if(this._lGlobal._IS_EDGE||this._lGlobal._IS_MS){this._interactManager=new a(i,{context:this.view.$el[0]})}else{this._interactManager=new b(i,{context:this.view.$el[0]})}this._interactElement=h.is(this._elementClassName)?c(this._elementClassName,this.$el):this.$el;if(this._isGesturable){this._initGesturable()}if(this._isDraggable){this._initDraggable()}if(this._isDroppable){this._initDroppable()}}this.onViewEnableDrag(this._enableDraggable);this.bindDragEvents(this._enableDroppable);this.onViewEnableGesturable(this._enableGesturable)},_destroyInteractManager:function(){if(h.is(this._interactManager)){this.onViewEnableDrag(false);this.bindDragEvents(false);this.onViewEnableGesturable(false);this._interactManager.unset();this._interactManager=null}},_initDraggable:function(){var i=this;this.draggable=this._interactManager.draggable({inertia:true,autoScroll:false,enabled:false,manualStart:i._isManualStart,ignoreFrom:i._ignoreFrom,allowFrom:i._allowFrom,restrict:{restriction:this._draggableRestriction,endOnly:true,elementRect:{top:0,left:0,bottom:1,right:1}},onstart:function(j){if(i._draggableEnabled){i._interactRadio.trigger("interact:startDrag",i._interactElement[0].className,i.cid);i._clientWidth=i._interactElement[0].parentElement.clientWidth;i._clientHeight=i._interactElement[0].parentElement.clientHeight;i._dataX=(parseFloat(i._interactElement[0].getAttribute("data-x"))||0);i._dataY=(parseFloat(i._interactElement[0].getAttribute("data-y"))||0);if(h.is(i.view.onDragStartCallback)){i.view.onDragStartCallback(j)}i.view.onDrag=true}},onmove:function(j){if(i._draggableEnabled){if(h.is(i.view.onDragMoveCallback)){i.view.onDragMoveCallback(j)}else{i.onDragMoveCallback(j)}}},onend:function(j){if(i._draggableEnabled){i._interactElement.attr({"data-x":i._dataX,"data-y":i._dataY});if(h.is(i.view.onDragEndCallback)){i.view.onDragEndCallback(j)}i.view.onDrag=false;i._interactRadio.trigger("interact:endDrag",i._interactElement[0].className,i.cid)}}});if(i._isManualStart){i._manualStartCallBack=function(k){var j=k.interaction;if(!j.interacting()){j.start({name:"drag"},k.interactable,k.currentTarget)}}}},_initDroppable:function(){var i=this;this._interactManager.dropzone({accept:i._dropAcceptClassName,overlap:"pointer",enabled:false,ignoreFrom:i._ignoreFrom,allowFrom:i._allowFrom,ondropactivate:function(j){if(i._droppableEnabled&&h.is(i.view.onDropActivateCallback)){if(c(j.relatedTarget).hasClass("canDrag")){i.view.onDropActivateCallback(j)}}},ondropdeactivate:function(j){if(i._droppableEnabled&&h.is(i.view.onDropDeactivateCallback)){if(c(j.relatedTarget).hasClass("canDrag")){i.view.onDropDeactivateCallback(j)}}},ondragenter:function(j){if(i._droppableEnabled&&h.is(i.view.onDragEnterCallback)){if(c(j.relatedTarget).hasClass("canDrag")){i.view.onDragEnterCallback(j)}}},ondragleave:function(j){if(i._droppableEnabled&&h.is(i.view.onDragLeaveCallback)){if(c(j.relatedTarget).hasClass("canDrag")){i.view.onDragLeaveCallback(j)}}},ondrop:function(j){if(i._droppableEnabled&&h.is(i.view.onDropCallback)){if(c(j.relatedTarget).hasClass("canDrag")){i.view.onDropCallback(j)}}}})},_initGesturable:function(){var i=this;this._interactManager.gesturable({enabled:false,ignoreFrom:i._ignoreFrom,allowFrom:i._allowFrom,onstart:function(j){if(i._gesturableEnabled&&h.is(i.view.onGesturableStartCallback)){i.view.onGesturableStartCallback(j)}},onmove:function(j){if(i._gesturableEnabled&&h.is(i.view.onGesturableMoveCallback)){i.view.onGesturableMoveCallback(j)}},onend:function(j){if(i._gesturableEnabled&&h.is(i.view.onGesturableEndCallback)){i.view.onGesturableEndCallback(j)}}})},onDragMoveCallback:function(j){var i=(this._dataX+((j.dx*100)/this._clientWidth)).toFixed(2);var k=(this._dataY+((j.dy*100)/this._clientHeight)).toFixed(2);this._dataX=Number(i);this._dataY=Number(k);this.onMove(this._dataX,this._dataY)},onMove:function e(i,j){if(this._enableLive===true&&h.is(this.view.liveIt)){this.view.liveIt("onMove",arguments)}this._interactElement.css({top:j+"%",left:i+"%"})}});return f});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanResources/ResourcesManager","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/SettingsView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/SettingsView.css"],function(d,e,i,g,j,b,c){var a=g.View.extend({className:"settingsView",template:i.template(c),sideBarRadioChannel:j.channel("sidebar"),templateContext:function(){return{get:e.proxy(this.model.get,this.model),getNLS:e.proxy(b.getTranslation,b)}},ui:{title:".title",inputs:"input"},events:{"change @ui.title":"updateTitle","change @ui.inputs":"saveModel"},initialize:function(){this.onFavoriteSelectedDelegate=e.proxy(this.onFavoriteSelected,this)},updateTitle:function f(k){this.model.set("V_DEL3DL_Title",k.target.value,{silent:true})},onAttach:function(){e("#title",this.$el).val(d.is(this.model.get("V_DEL3DL_Title"))?this.model.get("V_DEL3DL_Title"):"");this.sideBarRadioChannel.on("sideBarView:favoriteSelected",this.onFavoriteSelectedDelegate)},onDetach:function(){this.sideBarRadioChannel.off("sideBarView:favoriteSelected",this.onFavoriteSelectedDelegate)},saveModel:function h(){this.model.save()},onFavoriteSelected:function(l){var k=this;this.model.set(l.attributes);this.model._migrateAndSaveData().then(function(){k.render()})}});return a});define("DS/DEL3DLeanViews/Utils/TaskUtils",["pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanHttpRequest/HttpRequest","DS/DocumentManagement/DocumentManagement","DS/DEL3DLeanEnums/Model.enum","UWA/Class/Promise","DS/DEL3DLeanSession/Session.manager","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanFactory/ModelFactory","UWA/Core","DS/Logger/Logger"],function(j,f,o,w,s,b,r,m,d,n,t,u,g,v){var h=null;var c=j.Object.extend({name:"TaskUtils",taskRadioChannel:o.channel("taskutils"),floatableRadioChannel:o.channel("floatable"),postMessageRadioChannel:o.channel("postmessage"),init:function q(){this._logger=v.getLogger(c);this._stickyDrawUpdatedDelegate=f.proxy(this._stickyDrawUpdated,this);this._floatableModelCreatedDelegate=f.proxy(this._floatableModelCreated,this);this._setTaskPrefixDelegate=f.proxy(this.setTaskPrefix,this);this.taskRadioChannel.on("stickynote:draw:updated",this._stickyDrawUpdatedDelegate);this.floatableRadioChannel.on("floatableCollection:newStickyNoteModel",this._floatableModelCreatedDelegate);this.postMessageRadioChannel.on("postmessage:taskprefix",this._setTaskPrefixDelegate);this.listenTo(n,"after:loadsession",this.onSessionLoaded.bind(this))},createTask:function(x,B){var A=this;if(this.isTaskCreationAllowed()){var z=function(C,D){var E=x.get("V_DEL3DL_Sketch_Image");A.createDocumentForTask("note.svg",E,D);x.save({V_DEL3DL_Title:D.get("Title")})};var y=function(){A._logger.error("Failed to create task")};w.createModel(x,m.TASK,B,{success:z,error:y},m.LINK)}},isTaskCreationAllowed:function(){return true},addContextCapture:function(y,x){var A=w.getTasksRelationsFrom(x.id);if(A.length>0){var z=w.findModel(A.first().get("to"));var B=f.proxy(function(C){for(var D=0;D<C.data.length;++D){if(C.data[D].dataelements.title==="context"){s.setImage(y,C.data[D].id,{},"context.png");return}}this.createDocumentForTask("context.png",y,z)},this);r.getDocumentsFromParent({relInfo:{parentId:z.id,parentRelName:"Reference Document",parentDirection:"from"},onComplete:B,onFailure:f.proxy(function(){},this)})}else{if(!x.has("V_DEL3DL_ActionContext")){s.setImage(y).then(function(C){x.set("V_DEL3DL_ActionContext",C)})}else{s.setImage(y,x.get("V_DEL3DL_ActionContext"))}}},getContextCapture:function(x,B,A){var z=w.getTasksRelationsFrom(x.id);if(z.length>0){var y=w.findModel(z.first().get("to"));var C=f.proxy(function(D){for(var E=0;E<D.data.length;++E){if(D.data[E].dataelements.title==="context"){B(s.getImage(D.data[E].id))}}},this);r.getDocumentsFromParent({relInfo:{parentId:y.id,parentRelName:"Reference Document",parentDirection:"from"},onComplete:C,onFailure:A})}else{B(s.getImage(x.get("V_DEL3DL_ActionContext")))}},createDocumentForTask:function(x,y,z){if(s.isDataUrl(y)){this._createDocument(x,y,z.id)}else{s.getImage(y).then(f.proxy(function(A){this._createDocument(x,A,z.id)},this))}},updateTask:function(y,z){var x=w.findModel(y);x.save(z)},_getPeoplePID:function(z){var y=d.deferred();var x="/resources/modeler/pno/person/";b.request(x+z,{contentType:"application/json",error:y.reject,success:y.resolve});return y.promise},deleteTask:function(x){if(x.isShared()){if(x.isOurTeamAssigned()){if(!x.isDone()){x.set({V_DEL3DL_ActionLogZone:"alParking"})}x.save({V_DEL3DL_AssignedPersonName:x.get("owner"),V_DEL3DL_AssignedTeamName:x.get("owner")})}}else{var z=w.getTasksRelationsFrom(x.id);if(z.length>0){var y=w.findModel(z.first().get("to"));if(y.get("current")!=="Complete"){y.destroy({success:null,error:null})}}}},removeRemainingActionRelationAndModel:function(y){var z=(new m.ACTIONLOG.modelConstructor()).get("physicalid");var x=t.RELATIONS.sessionInstance.where({to:y.id});var A=true;x.forEach(function(B){if(B.get("from")!==z){var C=w.findModel(B.get("from"));if(g.is(C)&&g.is(C.name)&&C.name!=="StickyNoteModel"){B.destroy()}else{A=false}}});if(A){t.FLOATABLES.sessionInstance.remove(y)}},getFloatableModelTask:function k(x){var y=w.getTasksRelationsFrom(x.get("physicalid"));if(y.length>0){return w.findModel(y.first().get("to"))}return null},onSessionLoaded:function i(){var x=Number(widget.getValue("DaysToRemoveCompletedTasks"));var C=(new m.ACTIONLOG.modelConstructor()).get("physicalid");var A=w.getFloatablesRelationsFrom(C);for(var B=0;A.length>B;++B){var E=A.models[B];var D=w.findModel(E.get("to"));var F=this.getFloatableModelTask(D);if(g.is(F)){if(F.get("current")==="Complete"){if(D.get("V_DEL3DL_ActionLogZone")!=="alDone"){D.save({V_DEL3DL_ActionLogZone:"alDone"});this.taskRadioChannel.trigger("stickynote:zone:updated",D)}else{if(x>0){var y=new Date(F.get("Task Estimated Finish Date"));var G=new Date();var z=parseInt((G-y)/(1000*60*60*24));if(z>=x){E.destroy();this.removeRemainingActionRelationAndModel(D);--B}}}}}}},updateAssignee:function(x,F,D){var B=w.getTasksRelationsFrom(x.get("physicalid"));if(B.length>0){var C=B.first().get("to");var A=g.is(F)?F.get("pid"):null;var G=g.is(D)?D.get("pid"):null;this._updateEnoTaskAssignee(C,A,G)}if(g.is(F)){var E=function(H){return H.get("name")===F.get("name")};var z=t.PEOPLES.sessionInstance.find(E);var y=z.isCollaborator();if(y){this._assignToSession(x,z)}else{x.save({V_DEL3DL_AssignedPersonName:F.get("name")})}}else{x.save({V_DEL3DL_AssignedPersonName:null})}},setTaskPrefix:function e(x){this._taskPrefix=x},getTaskPrefix:function a(){return this._taskPrefix},_assignToSession:function(z,y){var x=this;if(z.isShared()&&z.get("owner")===y.get("name")){x.taskRadioChannel.trigger("stickynote:delete",z)}else{z.save({V_DEL3DL_ActionLogZone:"alParking",V_DEL3DL_AssignedTeamName:y.get("name"),V_DEL3DL_AssignedPersonName:y.get("name")});y.getSessionInfo().then(function(A){A=A||{};var B=A.actionlog;u.createModel(m.COORD,{from:B,to:z.id,V_DEL3DL_X:-50,V_DEL3DL_Y:-50,V_DEL3DL_Size_X:1,V_DEL3DL_Size_Y:1},{success:function(){if(z.isOurTeamOwner()){x.taskRadioChannel.trigger("stickynote:zone:updated",z)}else{x.taskRadioChannel.trigger("stickynote:delete",z)}},error:function(C){x._logger.error(C)}})},function(A){x._logger.error(A)})}},_createDocument:function(y,z,A){var x=s.dataUrlToFile(y,z);r.createDocument({fileInfo:{file:x},relInfo:{parentId:A,parentRelName:"Reference Document",parentDirection:"from"}},{onComplete:function(){},onFailure:function(){},securityContext:widget.getValue("TeamSecurityContext")})},_stickyTitleUpdated:function(x){var y=w.getTasksRelationsFrom(x.get("physicalid"));if(y.length>0){var z=y.first().get("to");this.updateTask(z,{Title:x.get("V_DEL3DL_Title")})}},_stickyDrawUpdated:function(y){var x=w.getTasksRelationsFrom(y.model.id);if(x.length>0){var C=x.first().get("to");var A=y.model.get("V_DEL3DL_Sketch_Image");this.updateTask(C,{description:y.model.get("V_DEL3DL_Description")});var B=f.proxy(function(D){for(var E=0;E<D.data.length;++E){if(D.data[E].dataelements.title==="note"){s.setImage(A,D.data[E].id,{},"note.svg")}}},this);var z=f.proxy(function(){},this);r.getDocumentsFromParent({relInfo:{parentId:C,parentRelName:"Reference Document",parentDirection:"from"},onComplete:B,onFailure:z})}},_updateEnoTaskAssignee:function(B,A,y){var z=w.findModel(B);var x={};if(g.is(y)){x.oldAssigneePID=y}if(g.is(A)){x.assigneePID=A}z.save(x)},_floatableModelCreated:function(z){var B=g.getGlobal().sessionLoaded;var y=this;if(z.isAction()&&B){var x=g.getGlobal().leanSessionManager;var A=(new m.ACTIONLOG.modelConstructor()).get("physicalid");var D=x.getSessionName();z.save({V_DEL3DL_AssignedTeamName:D,V_DEL3DL_ActionLogZone:"alParking"});w.createModel(null,m.COORD,{from:A,to:z.id,V_DEL3DL_X:-50,V_DEL3DL_Y:-50,V_DEL3DL_Size_X:1,V_DEL3DL_Size_Y:1},{success:function(){y.createModelSuccess(z)},error:function(){}});var C={Title:this._generateTitle(D),current:"Active",dueDate:"0",description:z.get("V_DEL3DL_Description"),"Task Estimated Duration":"1"};this.createTask(z,C)}},createModelSuccess:function(x){this.taskRadioChannel.trigger("stickynote:zone:updated",x)},_generateTitle:function l(y){var A=function(B){return(B<10)?"0"+B:B};y=g.is(y)?y:g.getGlobal().leanSessionManager.getSessionName();var x=new Date();var z=this.getTaskPrefix()||"";z+=z.length>0?" ":"";z+=y+" ";z+=[x.getFullYear(),A(x.getMonth()+1),A(x.getDate())].join("/")+" ";z+=[A(x.getHours()),A(x.getMinutes())].join("-");return z}});function p(){if(!g.is(h)){h=new c();h.init()}return h}return p()});define("DS/DEL3DLeanViews/Components/ButtonModel",["pluginDS!DS/VENBackbone/backbone.1.3.3/backbone"],function(b){var a=b.Model.extend({defaults:{mode:"button",parentView:undefined,actionName:undefined,checked:false,autoStyle:true,securityTap:false,icon:undefined,iconChecked:undefined,title:undefined}});return a});define("DS/DEL3DLeanViews/EditSticky/EditPropertiesView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanCollections/Collection.manager","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditPropertiesView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditPropertiesView.css"],function(g,i,m,k,b,e,c,h,d,a,l,j){var f=k.View.extend({iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"editPropertiesView",ui:{},behaviors:[],regions:{},template:m.template(j),templateContext:function(){return{get:i.proxy(this.model.get,this.model),getNLS:i.proxy(c.getTranslation,c)}},constructor:function f(){k.View.prototype.constructor.apply(this,arguments)},initialize:function(){this._logger=b.getLogger(f)},onRender:function(){this._showEditProperties()},_showEditProperties:function(){var u=this;var q=null;var y=null;var s=null;var t=null;var n=null;var o=null;var p=i(".editTaskPropertiesContainer",this.$el);var w=i(".propertiesNoEditAlert",this.$el);var r=i(".propertiesNoTaskAlert",this.$el);var z=i(".propertiesError",this.$el);var x=h.getTasksRelationsFrom(u.model.id);r.addClass("show");if(x&&x.length>0){q=x.first().get("to");if(g.is(q,"string")){r.removeClass("show");try{y=new a({metatype:"Task",objectId:q});y.set("isTransient",false);s=this;y.addEvent("onSave",function(){if(g.is(this._changed.Title)){s.model.save({V_DEL3DL_Title:this._changed.Title.value})}});t=[y];n={className:"editTaskProperties",setEditButton:true,readOnly:false,typeOfDisplay:l.ALL,selectionType:l.ALL_SELECTION,multiselection:false,collapseTabs:false,context:widget,actions:[]};o=new d(n);try{o.setReadonlyStatus(false)}catch(v){this._logger.warn(v);w.addClass("show")}o.initDatas(t);try{o.removeFacets(l.FACET_VIEWS)}catch(v){this._logger.warn(v)}o.elements.container.inject(p[0])}catch(v){this._logger.warn(v);w.removeClass("show");z.addClass("show")}}}}});return f});define("DS/DEL3DLeanViews/Utils/AutoRefreshUtils",["pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanHttpRequest/HttpRequest","UWA/Core","DS/Logger/Logger"],function(i,g,m,f,h,b,k,e,a){var d=null;var c=i.Object.extend({name:"AutoRefreshUtils",issueRadioChannel:m.channel("issueutils"),taskRadioChannel:m.channel("taskutils"),init:function l(){this._logger=a.getLogger(c);this.onPreferencesEdited();widget.addEvent("endEdit",g.proxy(this.onPreferencesEdited,this))},onPreferencesEdited:function(){var n=widget.getValue("ActionLogAutoRefresh")==="true"||widget.getValue("ActionLogAutoRefresh")===true;this.enableAutoRefresh(n,null)},enableAutoRefresh:function(n,o){if(e.is(this._timeoutFct)){clearInterval(this._timeoutFct)}if(n){if(!e.is(o)){o=300000}this._timeoutFct=setInterval(g.proxy(function(){this.refreshAILogElements()},this),o)}},refreshAILogElements:function(){var n=e.getGlobal().leanSessionManager;var q="/resources/modeler/3dlean/api/loadsessiononlyaction/"+n.get3DLeanSession().id;var p=this;p.taskRadioChannel.trigger("before:action:autorefresh");var r=function(w){var s=JSON.parse(w)||{};var v=s.relations;var x=s.floatables;var y=s.tasks;var u=(new h.ISSUELOG.modelConstructor()).get("physicalid");var t=(new h.ACTIONLOG.modelConstructor()).get("physicalid");x.forEach(function(z){var C=f.findModel(z.physicalid);if(!e.is(C)){if(z.hasOwnProperty("DEL3DL_Abstract_Element.V_DEL3DL_Data")){z.V_DEL3DL_Data=z["DEL3DL_Abstract_Element.V_DEL3DL_Data"];delete z["DEL3DL_Abstract_Element.V_DEL3DL_Data"]}if(z.hasOwnProperty("DEL3DL_Sticky_Note.V_DEL3DL_Background_Color")){z.V_DEL3DL_Background_Color=z["DEL3DL_Sticky_Note.V_DEL3DL_Background_Color"];delete z["DEL3DL_Sticky_Note.V_DEL3DL_Background_Color"]}if(z.hasOwnProperty("DEL3DL_Sticky_Note.V_DEL3DL_Category")){z.V_DEL3DL_Category=z["DEL3DL_Sticky_Note.V_DEL3DL_Category"];delete z["DEL3DL_Sticky_Note.V_DEL3DL_Category"]}if(z.hasOwnProperty("DEL3DL_Sticky_Note.V_DEL3DL_Sketch_Image")){z.V_DEL3DL_Sketch_Image=z["DEL3DL_Sticky_Note.V_DEL3DL_Sketch_Image"];delete z["DEL3DL_Sticky_Note.V_DEL3DL_Sketch_Image"]}b.FLOATABLES.sessionInstance.add(z);g.each(v,function(F,E){if((E.from===t||E.from===u)&&E.to===z.physicalid){if(e.is(E["DEL3DL_Coord.V_DEL3DL_Data"])){E.V_DEL3DL_Data=E["DEL3DL_Coord.V_DEL3DL_Data"]}if(e.is(E["DEL3DL_Coord.V_DEL3DL_Y"])){E.V_DEL3DL_Y=E["DEL3DL_Coord.V_DEL3DL_Y"]}if(e.is(E["DEL3DL_Coord.V_DEL3DL_X"])){E.V_DEL3DL_X=E["DEL3DL_Coord.V_DEL3DL_X"]}if(e.is(E["DEL3DL_Coord.V_DEL3DL_Size_Y"])){E.V_DEL3DL_Size_Y=E["DEL3DL_Coord.V_DEL3DL_Size_Y"]}if(e.is(E["DEL3DL_Coord.V_DEL3DL_Size_X"])){E.V_DEL3DL_Size_X=E["DEL3DL_Coord.V_DEL3DL_Size_X"]}b.RELATIONS.sessionInstance.add(E);return false}return null})}else{var B=C.attributes;if(z.hasOwnProperty("DEL3DL_Abstract_Element.V_DEL3DL_Data")){z.V_DEL3DL_Data=z["DEL3DL_Abstract_Element.V_DEL3DL_Data"];delete z["DEL3DL_Abstract_Element.V_DEL3DL_Data"]}if(z.hasOwnProperty("DEL3DL_Sticky_Note.V_DEL3DL_Sketch_Image")){z.V_DEL3DL_Sketch_Image=z["DEL3DL_Sticky_Note.V_DEL3DL_Sketch_Image"];delete z["DEL3DL_Sticky_Note.V_DEL3DL_Sketch_Image"]}if(!e.is(B.syncTimestamp)||B.syncTimestamp<p._requestTimestamp){if(B.V_DEL3DL_Data!==z.V_DEL3DL_Data){var D=JSON.parse(B.V_DEL3DL_Data);var A=JSON.parse(z.V_DEL3DL_Data);C.set("V_DEL3DL_Data",z.V_DEL3DL_Data);if(e.is(D.V_DEL3DL_ActionLogZone)&&D.V_DEL3DL_ActionLogZone!==A.V_DEL3DL_ActionLogZone){p.taskRadioChannel.trigger("stickynote:zone:updated",C)}else{if(e.is(D.V_DEL3DL_IssueLogZone)&&D.V_DEL3DL_IssueLogZone!==A.V_DEL3DL_IssueLogZone){p.issueRadioChannel.trigger("stickynote:zone:updated",C)}}}if(B.V_DEL3DL_Sketch_Image!==z.V_DEL3DL_Sketch_Image){C.set("V_DEL3DL_Sketch_Image",z.V_DEL3DL_Sketch_Image)}}}});y.forEach(function(z){var A=f.findModel(z.physicalid);if(!e.is(A)){b.TASKS.sessionInstance.add(z);g.each(v,function(C,B){if(B.to===z.physicalid){b.RELATIONS.sessionInstance.add(B);return false}return null})}});p.taskRadioChannel.trigger("after:action:autorefresh")};var o=function(s){p._logger.error(s);p.taskRadioChannel.trigger("after:action:autorefresh")};this._requestTimestamp=Date.now();k.request(q,{proxy:"passport",error:o,success:r})}});function j(){if(!e.is(d)){d=new c();d.init()}return d}return j()});define("DS/DEL3DLeanViews/Behaviors/ScrollableCollectionViewBehavior",["UWA/Core","DS/Logger/Logger","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Behaviors/HammerBehavior"],function(e,b,d,a){var c=a.extend({constructor:function c(){a.prototype.constructor.apply(this,arguments)},initialize:function(){if(!e.is(this._logger)){this._logger=b.getLogger(c)}this.direction=this.getOption("direction")||c.DIRECTION_HORIZONTAL;this.options={usePanEvent:true,enablePanEvent:true,eventDirection:2|4};this.onWheelDelegate=$.proxy(this.onWheel,this);a.prototype.initialize.apply(this);this.view.panEventCallback=this.panEventCallback;this.view.panEndEventCallback=this.panEndEventCallback;this.view._scrollable_offset=null;this.view._scrollable_size=null;this.view._scrollable_direction=this.direction;this.view._scrollable_css="margin-"+this.direction},onAttach:function(){this.$el[0].onwheel=this.onWheelDelegate},onDetach:function(){this.$el[0].onwheel=null},onWheel:function(){console.log("WHEEL!")},updateSize:function(){var f=this.view;f._scrollable_offset=Number(f.$el.css(f._scrollable_css).slice(0,-2));if(f._scrollable_direction===c.DIRECTION_HORIZONTAL){f._scrollable_size=f.$el.width()-f.$el.parent().width()}else{f._scrollable_size=f.$el.height()-f.$el.parent().height()}},panEventCallback:function(g){var f=0;if(!this._scrollable_offset){this._scrollable_offset=Number(this.$el.css(this._scrollable_css).slice(0,-2))}if(this._scrollable_direction===c.DIRECTION_HORIZONTAL){if(!this._scrollable_size){this._scrollable_size=this.$el.width()-this.$el.parent().width()}f=g.deltaX+this._scrollable_offset}else{if(!this._scrollable_size){this._scrollable_size=this.$el.height()-this.$el.parent().height()}f=g.deltaY+this._scrollable_offset}if(0<f){f=0}if(-this._scrollable_size>f){f=-this._scrollable_size}this.$el.css(this._scrollable_css,f+"px")},panEndEventCallback:function(){this._scrollable_offset=null}});c.DIRECTION_VERTICAL="top";c.DIRECTION_HORIZONTAL="left";return c});define("DS/DEL3DLeanViews/LoadingView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","pluginDS!DS/DEL3DLeanServices/ErrorHandler","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","DS/Logger/Logger","text!DS/DEL3DLeanViews/assets/template/LoadingView.template.html","css!DS/DEL3DLeanViews/assets/css/LoadingView.css"],function(e,f,j,i,k,b,d,c,a,g){var h=i.View.extend({name:"LoadingView",className:"loadingView",template:j.template(g),iconPath:d.getWebappsAssetUrl("DEL3DLeanViews","icons"),loadingRadioChannel:k.channel("loadging"),_percent:0,_message:"",_errorChannel:k.channel("error"),_failed:false,ui:{loadingMessage:"div.mainLoadingText",loadingButton:"div.mainLoadingButton",loadingButtonText:"p.mainLoadingButtonText",loadingReloadContainer:"div.mainLoadingReloadContainer",loadingReportContainer:"div.mainLoadingReportContainer"},events:{"click @ui.loadingReloadContainer":"reload","click @ui.loadingReportContainer":"download"},initialize:function(){this._logger=a.getLogger(h);this._errorChannel.on("loading:cancel",this.onLoadingCanceled.bind(this))},templateContext:function(){return{iconPath:this.iconPath,version:this.version}},onLoadingCanceled:function(m){var l=this;this._logger.error(m);this._failed=true;c.removeClass(this.getUI("loadingMessage"),["loading","success"]);c.addClass(this.getUI("loadingMessage"),"error");f(".loaderSpinnerContent").hide();f(".mainLoadingTitle").hide();this.getUI("loadingMessage").text(m);setTimeout(function(){c.addClass(l.getUI("loadingReloadContainer"),"show");c.addClass(l.getUI("loadingReportContainer"),"show")},1000)},reload:function(){document.location.href=document.location.href},download:function(){b.downloadErrorReport()},hasFailed:function(){return this._failed},restart:function(){this._percent=0;this._message="";this.$el.fadeIn()},setMessage:function(l){if(this._failed){return this}this._message=l;this.getUI("loadingMessage").text(l);f(".loaderSpinnerContent").show();return this},setProgressionAndMessage:function(n,m){if(this._failed){return this}this.setMessage(m);if(n===100){var l=this;setTimeout(function(){l.$el.fadeOut();setTimeout(function(){l.loadingRadioChannel.trigger("loaded",{})},400)},0)}return this},showVersion:function(){var l=e.getGlobal();if(e.is(l)){this.version=l.version;this.render()}}});return h});define("DS/DEL3DLeanViews/Meeting/MeetingLeangetView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Utils/UIUtils","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Meeting/MeetingLeangetView.template.html","css!DS/DEL3DLeanViews/assets/css/Meeting/MeetingLeangetView.css"],function(h,e,c,g,a,f,b){var d=g.View.extend({className:"meetingLeangetView",staticRadioChannel:f.channel("static"),uiRadioChannel:f.channel("uiutils"),regions:{selectedLeangetRegion:{selector:".selectedLeanget",replaceElement:true}},template:c.template(b),templateContext:function(){return c.extend(this.model.toJSON(),{})},initialize:function(){this.parent=this.getOption("parent");this.infraView=this.model.get("view");a.addClass(this.$el,"previous");a.addClass(this.$el,"meetingLeangetHidden");if(h.is(this.infraView.leangetView.resizeView)){this.infraView.leangetView.resizeView(true);this.infraView.leangetView.forceMaximizeSize=true}},onDetach:function(){this.detachChildView("selectedLeangetRegion",this.infraView);this.infraView._getParentStaticView().staticCollectionView.addChildView(this.infraView)},onDestroy:function(){this.infraView.leangetView.forceMaximizeSize=false},focus:function(){this.visited=true;a.removeClass(this.$el,"meetingLeangetHidden");a.removeClass(this.$el,"next");a.removeClass(this.$el,"previous");a.addClass(this.$el,"focus");this.staticRadioChannel.trigger("static:focusView",this.infraView)},unfocus:function(i){var j=this;j.uiRadioChannel.once("after:meetingLeangetUnfocus",function(){a.addClass(j.$el,"meetingLeangetHidden")});if(i){a.addClassWithTransition(j.$el,"previous","meetingLeangetUnfocus")}else{a.addClassWithTransition(j.$el,"next","meetingLeangetUnfocus")}a.removeClass(j.$el,"focus")},onRender:function(){this.showChildView("selectedLeangetRegion",this.infraView)}});return d});define("DS/DEL3DLeanViews/Panels/CollectionElements/LeangetStoreView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/Panels/CollectionElements/LeangetStoreView.template.html","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Behaviors/HammerBehavior","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanResources/ResourcesManager","css!DS/DEL3DLeanViews/assets/css/Panels/CollectionElements/LeangetStoreView.css"],function(c,d,i,g,b,f,j,e,k,a){var h=g.View.extend({className:"leangetStoreView",iconPath:b.getWebappsAssetUrl("DEL3DLeanViews","icons"),dragEvent:false,behaviors:[{behaviorClass:j,isDraggable:true,isManualStart:true,draggableRestriction:""},{behaviorClass:e,usePanEvent:true,eventDirection:2|4,threshold:50}],issueRadioChannel:k.channel("issueutils"),taskRadioChannel:k.channel("taskutils"),regions:{},events:{},template:i.template(f),templateContext:function(){return i.extend(this.model.toJSON(),{iconPath:this.iconPath,iconTitle:a.getTranslation(this.model.get("type"))})},initialize:function(){this.$el.attr("id",this.cid);this.$el.css("left","5%");this.$el.attr("data-x","5");this.$el.attr("data-type",this.model.get("type"));this.parent=this.getOption("parent");if(this.model.get("type")==="DEL3DL_Issue_Log"){this.hasIssueLogChangeDelegate=d.proxy(this.hasIssueLogChange,this);this.issueRadioChannel.on("hasIssueLog:change",this.hasIssueLogChangeDelegate)}else{if(this.model.get("type")==="DEL3DL_Action_Log"){this.hasActionLogChangeDelegate=d.proxy(this.hasActionLogChange,this);this.taskRadioChannel.on("hasActionLog:change",this.hasActionLogChangeDelegate)}}},onDestroy:function(){if(this.model.get("type")==="DEL3DL_Issue_Log"){this.issueRadioChannel.off("hasIssueLog:change",this.hasIssueLogChangeDelegate)}else{if(this.model.get("type")==="DEL3DL_Action_Log"){this.taskRadioChannel.off("hasActionLog:change",this.hasActionLogChangeDelegate)}}},onShow:function(){},onAttach:function(){if(this.model.get("type")==="DEL3DL_Issue_Log"){this.hasIssueLogChange()}else{if(this.model.get("type")==="DEL3DL_Action_Log"){this.hasActionLogChange()}else{this.triggerMethod("view:enablePan",true)}}},hasIssueLogChange:function(){if(!c.getGlobal().hasIssueLog){this.$el.removeClass("storeViewDisable");this.triggerMethod("view:enablePan",true)}else{this.$el.addClass("storeViewDisable");this.triggerMethod("view:enablePan",false)}},hasActionLogChange:function(){if(!c.getGlobal().hasActionLog){this.$el.removeClass("storeViewDisable");this.triggerMethod("view:enablePan",true)}else{this.$el.addClass("storeViewDisable");this.triggerMethod("view:enablePan",false)}},onDetach:function(){this.triggerMethod("view:enablePan",false)},onRender:function(){},onDragStartCallback:function(){if(this.dragEvent===false){this.updateDataTop();this.dragEvent=true;this.originX=this.$el.attr("data-x");this.originY=this.$el.attr("data-y")}},onDragEndCallback:function(){var l=this;l.dragEvent=false;setTimeout(function(){l.$el.attr({"data-y":l.originY,"data-x":l.originX});l.$el.css({top:l.originY+"%",left:l.originX+"%"});l.triggerMethod("view:enableDrag",false)},0);l.parent.children.each(function(m){m.triggerMethod("view:enablePan",true)});setTimeout(function(){l.parent.triggerMethod("view:enablePan",true)},0)},panStartEventCallback:function(){if(this.$el.hasClass("storeViewDisable")){return}this.parent.triggerMethod("view:enablePan",false);this.triggerMethod("view:enableDrag",true);this.parent.children.each(function(l){l.triggerMethod("view:enablePan",false)})},panEventCallback:function(){},panEndEventCallback:function(){},updateTop:function(l){this.actualTop=l;l=l>150?150:l;l=l<-50?-50:l;this.$el.css({top:l+"%",left:"5%"})},updateDataTop:function(){this.actualDataTop=Number(this.actualTop.toFixed(2));this.$el.attr({"data-y":this.actualDataTop,"data-x":"5"})}});return h});define("DS/DEL3DLeanViews/Team/PersonView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanSession/Session.manager","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanHttpRequest/PeopleService","DS/DEL3DLeanViews/Behaviors/HammerBehavior","text!DS/DEL3DLeanViews/assets/template/Team/PersonView.template.html","css!DS/DEL3DLeanViews/assets/css/Team/PersonView.css"],function(d,i,h,k,f,c,g,e,j){var b=h.View.extend({className:"personView",iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),picture:null,teamRadioChannel:k.channel("team"),ui:{personContainer:"div.personContainer"},behaviors:[{behaviorClass:e,useTapEvent:true,usePressEvent:true,isActiveOnRender:false}],modelEvents:{change:"render"},template:i.template(j),templateContext:function(){return i.extend(this.model.toJSON(),{picture:this.picture,trashIcon:this.iconPath+"/MinusIcon.svg"})},initialize:function(){},onRender:function(){var l=this;var m=this.$el.find("img.personThumbnail");m.attr("onerror","this.src='"+this.iconPath+"/DefaultPeople.png'");if(m.attr("src")===""){m.attr("src",this.iconPath+"/Loading.svg");this.model.getPicture().then(function(n){l.picture=n;m.attr("src",n)},function(n){l._logger.error("ERROR: %s",n)})}},tapEventCallback:function(){if(!this.isEdit){if(!this.disableToggle){this.toggleAvailability()}}else{g.removeMember(this.model);this.teamRadioChannel.trigger("teamView:editMember",true)}},pressEventCallback:function(){if(!this.isEdit){this.teamRadioChannel.trigger("teamView:editMember",true)}},editMode:function a(l){this.isEdit=l},toggleAvailability:function(){this.model.set("availability",!this.model.get("availability"));var l=f.get3DLeanSession();var m=l.get("V_DEL3DL_Team")||{};m[this.model.get("name")]=m[this.model.get("name")]||{};m[this.model.get("name")].availability=this.model.get("availability");l.save({V_DEL3DL_Team:m})},bindEvents:function(){this.triggerMethod("view:activeHammer",true,true,false,false,false)},unbindEvents:function(){this.triggerMethod("view:activeHammer",false,false,false,false,false)}});return b});define("DS/DEL3DLeanViews/Team/SearchPersonCollectionItemView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/Behaviors/HammerBehavior","text!DS/DEL3DLeanViews/assets/template/Team/SearchPersonCollectionItemView.template.html","css!DS/DEL3DLeanViews/assets/css/Team/PersonView.css"],function(e,b,g,f,a,d){var c=g.View.extend({className:"personView",searchPeopleRadioChannel:f.channel("searchPeople"),ui:{personContainer:"div.personContainer"},behaviors:[{behaviorClass:a,useTapEvent:true,usePressEvent:true,enableTapEvent:true,enablePressEvent:true}],template:b.template(d),templateContext:function(){return{firstname:this.model.get("firstname"),lastName:this.model.get("lastName"),employmenttype:this.model.get("employmenttype"),picture:this.model.get("picture")}},tapEventCallback:function(){this.searchPeopleRadioChannel.trigger("searchCollectionView:memberSelected",this.model)},pressEventCallback:function(){this.tapEventCallback()}});return c});define("DS/DEL3DLeanViews/ToolsSubpanels/CollectionElements/SideStickerView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanHttpRequest/ImageService","text!DS/DEL3DLeanViews/assets/template/ToolsSubpanels/CollectionElements/SideStickerView.template.html","css!DS/DEL3DLeanViews/assets/css/ToolsSubpanels/CollectionElements/SideStickerView.css"],function(f,b,h,g,a,d,c){var e=h.View.extend({className:"sideStickerView",dragEvent:false,behaviors:[{behaviorClass:g,isDraggable:true,isManualStart:true,draggableRestriction:""},{behaviorClass:a,usePanEvent:true,eventDirection:2|4,threshold:15}],modelEvents:{change:"render"},template:b.template(c),initialize:function(){this.actualLeft=this.getOption("actualLeft");this.parent=this.getOption("parent");this.$el.attr("id",this.cid);this.$el.css("left",this.getOption("actualLeft")+"%");this.$el.attr("data-x",this.getOption("actualLeft"))},onShow:function(){},onAttach:function(){this.triggerMethod("view:enablePan",true)},onBeforeDetach:function(){this.triggerMethod("view:enablePan",false)},onRender:function(){d.getImage(this.model.attributes.businessobj.documentId).then(f.proxy(function(i){f(".sideStickerImage",this.$el).attr("src",i)},this))},onDragStartCallback:function(){this.$el.attr("data-documentId",this.model.attributes.businessobj.documentId);if(this.dragEvent===false){this.dragEvent=true;this.originX=this.$el.attr("data-x");this.originY=this.$el.attr("data-y")}},onDragEndCallback:function(){var i=this;i.dragEvent=false;setTimeout(function(){i.$el.attr({"data-y":i.originY,"data-x":i.originX});i.$el.css({top:i.originY+"%",left:i.originX+"%"});i.triggerMethod("view:enableDrag",false);i.$el.removeAttr("data-documentId")},0);i.triggerMethod("view:enablePan",true);setTimeout(function(){i.parent.triggerMethod("view:enablePan",true)},0)},panStartEventCallback:function(){this.parent.triggerMethod("view:enablePan",false);this.triggerMethod("view:enablePan",false);this.triggerMethod("view:enableDrag",true)},panEventCallback:function(){},panEndEventCallback:function(){},updateTop:function(i){this.actualTop=i;i=i>125?125:i;i=i<-25?-25:i;this.$el.css({top:i+"%",left:this.actualLeft+"%"})},updateDataTop:function(){this.actualDataTop=Number(this.actualTop.toFixed(2));this.$el.attr({"data-y":this.actualDataTop,"data-x":this.actualLeft})}});return e});define("DS/DEL3DLeanViews/Panels/CollectionElements/FavoritesView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/Panels/CollectionElements/FavoritesView.template.html","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanResources/ResourcesManager","css!DS/DEL3DLeanViews/assets/css/Panels/CollectionElements/FavoritesView.css"],function(c,g,f,i,b,e,d,a){var h=f.View.extend({className:"favoritesView",iconPath:b.getWebappsAssetUrl("DEL3DLeanViews","icons"),dragEvent:false,behaviors:[{behaviorClass:d,useTapEvent:true,usePressEvent:true,enablePressEvent:true,enableTapEvent:true}],sideBarRadioChannel:i.channel("sidebar"),regions:{},events:{},template:g.template(e),templateContext:function(){return{get:c.proxy(this.model.get,this.model),getNLS:c.proxy(a.getTranslation,a)}},initialize:function(){this.$el.attr("id",this.cid);this.$el.css("left","5%");this.$el.attr("data-type",this.model.get("type"));this.parent=this.getOption("parent")},onShow:function(){},onAttach:function(){},onDetach:function(){},onRender:function(){},updateTop:function(j){this.actualTop=j;j=j>125?125:j;j=j<-25?-25:j;this.$el.css("top",j+"%")},updateDataTop:function(){this.actualDataTop=Number(this.actualTop.toFixed(2));this.$el.attr("data-y",this.actualDataTop)},pressEventCallback:function(j){this.tapEventCallback(j)},tapEventCallback:function(){this.sideBarRadioChannel.trigger("sideBarView:favoriteSelected",this.model)}});return h});define("DS/DEL3DLeanViews/ToolsSubpanels/CollectionElements/SidePersonView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.2.0/backbone.marionette","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/ToolsSubpanels/CollectionElements/SidePersonView.template.html","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Behaviors/HammerBehavior","css!DS/DEL3DLeanViews/assets/css/ToolsSubpanels/CollectionElements/SidePersonView.css"],function(e,b,h,d,c,g,a){var f=h.View.extend({className:"sidePersonView",iconPath:d.getWebappsAssetUrl("DEL3DLeanViews","icons"),dragEvent:false,picture:"",behaviors:[{behaviorClass:g,isDraggable:true,isManualStart:true,draggableRestriction:""},{behaviorClass:a,usePanEvent:true,eventDirection:2|4,threshold:50}],regions:{},events:{},modelEvents:{change:"render"},template:b.template(c),templateContext:function(){return b.extend(this.model.toJSON(),{picture:this.picture,isInTeam:this.model.isInTeam()})},initialize:function(){this.$el.attr("id",this.cid);this.$el.css("left","1%");this.$el.attr("data-x","1");this.parent=this.getOption("parent")},onShow:function(){},onAttach:function(){this.triggerMethod("view:enablePan",true)},onBeforeDetach:function(){this.triggerMethod("view:enablePan",false)},onRender:function(){var i=this;var j=this.$el.find("img.sidePersonThumbnail");j.attr("onerror","this.src='"+this.iconPath+"/DefaultPeople.png'");if(j.attr("src")===""){j.attr("src",this.iconPath+"/Loading.svg");this.model.getPicture().then(function(k){i.picture=k;j.attr("src",k)},function(k){i._logger.error("ERROR: %s",k)})}},onDragStartCallback:function(){this.$el.attr("data-name",this.model.get("name"));if(this.dragEvent===false){this.dragEvent=true;this.originX=this.$el.attr("data-x");this.originY=this.$el.attr("data-y")}},onDragEndCallback:function(){var i=this;i.dragEvent=false;setTimeout(function(){i.$el.attr({"data-y":i.originY,"data-x":i.originX});i.$el.css({top:i.originY+"%",left:i.originX+"%"});i.triggerMethod("view:enableDrag",false);i.$el.removeAttr("data-name")},0);i.triggerMethod("view:enablePan",true);setTimeout(function(){i.parent.triggerMethod("view:enablePan",true)},0)},panStartEventCallback:function(){this.parent.triggerMethod("view:enablePan",false);this.triggerMethod("view:enablePan",false);this.triggerMethod("view:enableDrag",true)},panEventCallback:function(){},panEndEventCallback:function(){},updateTop:function(i){this.actualTop=i;i=i>125?125:i;i=i<-25?-25:i;this.$el.css({top:i+"%",left:"1%"})},updateDataTop:function(){this.actualDataTop=Number(this.actualTop.toFixed(2));this.$el.attr({"data-y":this.actualDataTop,"data-x":"1"})}});return f});define("DS/DEL3DLeanViews/Panels/CollectionElements/SelectedLeangetView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Panels/CollectionElements/SelectedLeangetView.template.html","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanResources/ResourcesManager","css!DS/DEL3DLeanViews/assets/css/Panels/CollectionElements/SelectedLeangetView.css"],function(f,g,j,i,e,c,l,a,k,h,d){var b=i.View.extend({className:"selectedLeangetView",iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),dragEvent:false,meetingRadioChannel:l.channel("meeting"),behaviors:[{behaviorClass:k,isDraggable:true,enableDrag:true,draggableRestriction:"",className:".selectedLeangetViewContent"},{behaviorClass:k,isDroppable:true,enableDrop:true,enableDropAcceptClass:".selectedLeangetViewContent",className:".selectedLeangetViewContent, .droppableSpace"},{behaviorClass:h,usePressEvent:true,useTapEvent:true,isActiveOnRender:false}],template:j.template(a),templateContext:function(){return j.extend(this.model.toJSON(),{iconPath:this.iconPath,leangetType:d.getTranslation(this.model.get("viewmodel").get("type")),leangetTitle:this.model.get("viewmodel").get("V_DEL3DL_Title"),order:this.model.get("order")+1})},initialize:function(){this.parent=this.getOption("parent");this.$el.attr("data-order",this.model.get("order"));this.$el.attr("id",this.cid)},onRender:function(){this.draggableElement=g(".selectedLeangetViewContent",this.$el);this.draggableElement.attr("id","draggable"+this.cid);this.droppableSpaceElement=g(".droppableSpace",this.$el);this.droppableSpaceElement.attr("id","droppableSpace"+this.cid)},onDragEnterCallback:function(){c.addClass(this.$el,"leangetDroppable")},onDragLeaveCallback:function(){c.removeClass(this.$el,"leangetDroppable")},onDropCallback:function(n){var m=n.relatedTarget;c.removeClass(this.$el,"leangetDroppable");this.trigger("SelectedLeangetView:LeangetDropped",{relatedTargetOrder:Number(m.parentElement.getAttribute("data-order")),targetOrder:this.model.get("order")})},onDragStartCallback:function(m){var n=m.target;var p=0;var o=((n.offsetTop*100)/n.parentElement.parentElement.clientHeight);this.triggerMethod("view:enableDrop",false);c.addClass(this.draggableElement,"leangetDragged");this.draggableElement.css("top",o+"%");this.draggableElement.css("left",p+"%");this.draggableElement.attr("data-x",p);this.draggableElement.attr("data-y",o);this.draggableElement.css("height","7%");this.draggableElement.css("position","absolute")},onDragEndCallback:function(){this.draggableElement.css("position","");this.draggableElement.css("top","");this.draggableElement.css("left","");this.draggableElement.removeAttr("data-x");this.draggableElement.removeAttr("data-y");this.draggableElement.css("height","");c.removeClass(this.draggableElement,"leangetDragged");this.triggerMethod("view:enableDrop",true)},onDragMoveCallback:function(m){var n=m.target;if(!f.is(n)||!f.is(n.parentElement.parentElement)){return}var o=(parseFloat(n.getAttribute("data-y"))||0)+((m.dy*100)/n.parentElement.parentElement.clientHeight);if(o<0){o=0}if(o>92){o=92}this.draggableElement.attr({"data-y":o,"data-x":0});this.draggableElement.css({top:o+"%",left:"0%"})},onMeetingGuided:function(){this.triggerMethod("view:enableDrop",false);this.triggerMethod("view:enableDrag",false);this.triggerMethod("view:activeHammer",true,true,false,false,false)},tapEventCallback:function(){if(this.securityTapEnabled){return}else{this.securityTapEnabled=true;setTimeout(g.proxy(function(){this.securityTapEnabled=false},this),1000)}if(f.getGlobal().isMeetingLeader===true){this.meetingRadioChannel.trigger("meeting:selectLeanget",this.model.get("order"))}},pressEventCallback:function(){this.tapEventCallback()},visited:function(){this.isVisited=true;g(".selectedLeangetViewContent",this.$el).removeClass("focused");g(".selectedLeangetViewContent",this.$el).addClass("visited")},focused:function(){g(".selectedLeangetViewContent",this.$el).addClass("focused")}});return b});define("DS/DEL3DLeanViews/Components/ButtonView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Components/ButtonModel","text!DS/DEL3DLeanViews/assets/template/Components/ButtonView.template.html","css!DS/DEL3DLeanViews/assets/css/Components/ButtonView.css"],function(d,e,i,h,c,f,a,b,j){var g=h.View.extend({behaviors:[{behaviorClass:f,useTapEvent:true,enableTapEvent:true,usePressEvent:true,enablePressEvent:true}],name:"ButtonView",className:"buttonView",iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),securityTapEnabled:false,regions:{},ui:{text:".buttonTitle"},modelEvents:{"change:title":"render","change:icon":"render","change:iconChecked":"render","change:actionName":"render",change:"updateTemplate"},triggers:{uncheck:"uncheck"},templateContext:function(){return{buttonIconPath:this.iconPath}},template:i.template(j),initialize:function(l){if(!this.model){this.model=new b()}var k=this.model;e.each(l,function(m,n){k.set(m,n)});this.$el.attr("mode",this.model.get("mode"))},set:function(l,k){this.model.set(l,k)},get:function(k){return this.model.get(k)},updateTemplate:function(k){var l=k.changed;if(l){if(d.is(l.checked)){this._updateCheckClass()}}},onRender:function(){a.addClass(this.$el,this.get("actionName"));this._updateCheckClass()},setEnabled:function(k){if(k){a.removeClass(this.$el,"disabled")}else{a.addClass(this.$el,"disabled")}},getEnabled:function(){return !this.$el.hasClass("disabled")},setChecked:function(k){if(this.get("checked")!==k&&(this.isCheckbox()||this.isRadio())){if(this.isRadio()&&k){this._uncheckRadioBrother()}this.set("checked",k)}},getChecked:function(){return this.get("checked")},isButton:function(){return this.get("mode")==="button"},isCheckbox:function(){return this.get("mode")==="checkbox"},isRadio:function(){return this.get("mode")==="radio"},onUncheck:function(){this.setChecked(false)},pressEventCallback:function(k){this.tapEventCallback(k)},tapEventCallback:function(){var k=this;if(!k.getEnabled()){return}if(k.get("securityTap")){if(k.securityTapEnabled){return}else{k.securityTapEnabled=true;setTimeout(function(){k.securityTapEnabled=false},1000)}}k.$el.addClass("tapFeedBack");setTimeout(function(){k.$el.removeClass("tapFeedBack")},250);if(k.get("mode")==="checkbox"&&k.get("manualyCheck")!==true||(k.get("mode")==="radio"&&!k.get("checked"))){k.setChecked(!k.get("checked"))}k.triggerMethod("buttonView:clicked",k,k.get("actionName"));var l=k.get("callback");if(d.is(l)){l(k,k.get("actionName"))}},_uncheckRadioBrother:function(){var n=null;var o=null;var k=this.$el.parent();var l='.buttonView[mode="radio"]';var m=k.find(l);if(m.length<=1){n=k.parent();m=n.find(l)}if(m.length>0){o=m.filter(".checked");if(o.length>0){o.trigger("uncheck")}}},_updateCheckClass:function(){if(this.isCheckbox()||this.isRadio()){if(this.getChecked()){a.addClass(this.$el,"checked")}else{a.removeClass(this.$el,"checked")}}}});return g});define("DS/DEL3DLeanViews/Behaviors/LayoutBehavior",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanModels/relations/Coord.model","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Behaviors/CollisionMap","text!DS/DEL3DLeanViews/assets/template/Behaviors/LayoutBehavior.template.html","css!DS/DEL3DLeanViews/assets/css/Behaviors/LayoutBehavior.css"],function(j,A,i,p,y,r,o,t,z,f,v){var d=p.Behavior.extend({_logger:null,_maxBlockSizeX:2,_maxBlockSizeY:2,template:A.template(v),defaults:{sizeX:3,sizeY:3,movable:false},_createPageButtons:[],behaviors:[{behaviorClass:o,isDroppable:true,isActiveOnRender:false,enableDropAcceptClass:".pageView, .infraView, .leangetStoreView",className:".layout_DropGridBlock.droppable"}],AXIS:{X:"X",Y:"Y"},UNIT:{PERCENT:"%",PIXEL:"px"},constructor:function d(){if(!this._logger){this._logger=y.getLogger(d)}p.Behavior.prototype.constructor.apply(this,arguments)},onAttach:function g(){},initialize:function e(){this._staticViewModel=this.view.getOption("staticViewModel");this._sizeX=3;this._sizeY=3;this._movable=this.getOption("movable");this._$phantom=null;this._collisionMap=new f({width:this._sizeX,height:this._sizeY});if(0>=this._sizeX){this._logger.warn("Size X can't be 0 or less. Using 1 as size x");this._sizeX=1}if(0>=this._sizeY){this._logger.warn("Size Y can't be 0 or less. Using 1 as size y");this._sizeY=1}this.listenTo(this._staticViewModel,"change",this._onStaticViewModelChange.bind(this));this.layoutEditableDelegate=i.proxy(this.layoutEditable,this);this.onChildMoveDelegate=i.proxy(this.onChildMove,this);this.onChildCancelMoveDelegate=i.proxy(this.onChildCancelMove,this);this.onChildRelationUpdateDelegate=i.proxy(this._updatePositionWithTransition,this);this.on("view:layoutEditable",this.layoutEditableDelegate);this.on("view:onChildMove",this.onChildMoveDelegate);this.on("view:onChildCancelMove",this.onChildCancelMoveDelegate);this.on("view:onChildRelationUpdate",this.onChildRelationUpdateDelegate);var D=i.proxy(this.view.onDragEnterCallback,this.view);var E=this.onDragEnter.bind(this);var C=i.proxy(this.view.onDropCallback,this.view);this.view.onDragEnterCallback=function(F){if(j.is(D)){D(F)}E(F)};this.view.onDropCallback=i.proxy(function(H){if(!this._$phantom){this._$phantom=this.view.$el.find(".layout_Phantom").first()}var G=isNaN(this._$phantom.data("x"))?i(H.target).data("x"):this._$phantom.data("x");var F=isNaN(this._$phantom.data("y"))?i(H.target).data("y"):this._$phantom.data("y");H.target=i("> .layout_MainDropGrid .layout_DropGridBlock[data-x='"+G+"'][data-y='"+F+"']",this.view.$el)[0];if(j.is(C)){C(H)}this._$phantom.fadeOut()},this)},onDragEnter:function(C){var O=i(C.target);var L=this.view.children.filter({cid:C.relatedTarget.id})[0];var J=this._collisionMap.getViewCoordinates(L);var G=this.getBlockSizeX(this.UNIT.PERCENT,true);var F=this.getBlockSizeY(this.UNIT.PERCENT,true);var M=null;var K=null;var H=null;var D=null;var P=null;if(!j.is(L)){H=O.data();M=Number(H.x);K=Number(H.y);J={width:1,height:1};D=1;P=1}else{M=Number(O.attr("data-x"));K=Number(O.attr("data-y"));if(M<0||M>=this._sizeX){if(J){M=J.x}}if(K<0||K>=this._sizeY){if(J){K=J.y}}var N=L.$el.data("__draggingCorner__");if(J&&N){if(J.width>1){M=M-N.x}if(J.height>1){K=K-N.y}}D=J.width;P=J.height}var E=this._collisionMap.searchFreeSpace(M,K,J.width,J.height,L);if("none"===this._$phantom.css("display")){var I=this._$phantom.css("transition");this._$phantom.css("transition","");this._$phantom.css({width:(D===2?((D*G)-2.8):((D*G)-2)).toFixed(2)+"%",height:(P*F-2).toFixed(2)+"%",left:(((M*G)===0?0:(M*(G-2))+(M*1.2))+1.8).toFixed(2)+"%",top:((F*K)+1).toFixed(2)+"%"});this._$phantom.css("transition",I)}if(j.is(E)){this._$phantom.css({width:(D===2?((D*G)-2.8):((D*G)-2)).toFixed(2)+"%",height:(P*F-2).toFixed(2)+"%",left:(((E.x*G)===0?0:(E.x*(G-2))+(E.x*1.2))+1.8).toFixed(2)+"%",top:((F*E.y)+1).toFixed(2)+"%"});this._$phantom.data("x",E.x);this._$phantom.data("y",E.y);this._$phantom.fadeIn()}},onAddChild:function h(C,D){this._updatePositionWithoutTransition(D);if(j.is(this._$phantom)){this._$phantom.fadeOut()}},onRemoveChild:function(D,C){this._collisionMap.removeView(C);if(j.is(this._$phantom)){this._$phantom.fadeOut()}},onChildMove:function(C){this._updateRelationModel(C);if(j.is(this._$phantom)){this._$phantom.fadeOut()}},onChildCancelMove:function(C){this._updatePositionWithTransition(C);if(j.is(this._$phantom)){this._$phantom.fadeOut()}},_updatePositionWithoutTransition:function(G,K){var H=G.relationModel;if(!(H instanceof t)){return}var J=H.get("V_DEL3DL_X")||0;var I=H.get("V_DEL3DL_Y")||0;var D=H.get("V_DEL3DL_Size_X")||1;var C=H.get("V_DEL3DL_Size_Y")||1;var F=this.getBlockSizeX(this.UNIT.PERCENT,true);var E=this.getBlockSizeY(this.UNIT.PERCENT,true);if(K!==true){this._collisionMap.addView(G,J,I,D,C)}else{this._collisionMap.moveView(G,J,I,D,C)}G.sizeView.setSize(D,C);G.$el.css({left:(((J*F)===0?0:(J*(F-2))+(J*1.2))+1.8).toFixed(2)+"%",top:((I*E)+1).toFixed(2)+"%",width:(D===2?((D*F)-2.8):((D*F)-2)).toFixed(2)+"%",height:((C*E)-2).toFixed(2)+"%"});G.$el.attr("data-sizex",D);G.$el.attr("data-x",(J*F).toFixed(2));G.$el.attr("data-y",(I*E).toFixed(2))},_updateRelationModel:function(F){var G=F.relationModel;if(!(G instanceof t)){return}var J=G.get("V_DEL3DL_X")||0;var H=G.get("V_DEL3DL_Y")||0;var D=G.get("V_DEL3DL_Size_X")||1;var C=G.get("V_DEL3DL_Size_Y")||1;var K=this._collisionMap.getViewCoordinates(F);if(J<0||J>=this._sizeX){if(K){J=K.x}}if(H<0||H>=this._sizeY){if(K){H=K.y}}var L=F.$el.data("__draggingCorner__");if(K&&L){if(K.width>1){J=J-L.x}if(K.height>1){H=H-L.y}}var E=this._collisionMap.searchFreeSpace(J,H,D,C,F);if(!j.is(E)){var I=this._collisionMap.getViews()[F.cid];if(j.is(I)){G.set({V_DEL3DL_X:I.x,V_DEL3DL_Y:I.y,V_DEL3DL_Size_X:I.width,V_DEL3DL_Size_Y:I.height})}return}J=E.x;H=E.y;G.save({V_DEL3DL_X:J,V_DEL3DL_Y:H,V_DEL3DL_Size_X:D,V_DEL3DL_Size_Y:C})},_updatePositionWithTransition:function(C){C.$el.css("transition","width .3s ease-out, height .3s ease-out, top .3s ease-out,	left .3s ease-out");this._updatePositionWithoutTransition(C,true);setTimeout(function(){C.$el.css("transition","")},300)},getSizeX:function c(){return this._getAxisSize(this.AXIS.X)},getSizeY:function b(){return this._getAxisSize(this.AXIS.Y)},getBlockSizeX:function m(C,D){return this._getAxisBlockSize(this.AXIS.X,C,D)},getBlockSizeY:function l(C,D){return this._getAxisBlockSize(this.AXIS.Y,C,D)},setSize:function x(D,C){var E=false;if(!j.is(D)){return false}if(!j.is(C)){C=D}E=E||this.setSizeX(D);E=E||this.setSizeY(C);return E},setSizeX:function a(C){return this._setAxisSize(C,this.AXIS.X)},setSizeY:function B(C){return this._setAxisSize(C,this.AXIS.Y)},layoutEditable:function(C){if(C){this._initGrid()}else{this._removeGrid()}i.each(i(".layout_MainDropGrid:first>.layout_DropGridBlock",this.view.$el),function(D,E){if(C){z.addClass(i(E),"droppable")}else{z.removeClass(i(E),"droppable")}});if(this.view.parent.className==="mapView"){if(C){this.showCreatePageButtons()}else{this.hideCreatePageButtons()}}if(!C){this._$phantom.fadeOut()}},_getAxisSize:function u(E){var G=this;var D=null;var C=null;var F=Object.keys(G.AXIS).map(function(H){return G.AXIS[H]});if(!j.is(E)){this._logger.warn("axis parameter is mandatory");return D}if(!A.contains(F,E)){this._logger.warn("axis parameter should be one of : "+F);return D}C="_size"+E;D=Number(this[C]);return D},_getAxisBlockSize:function n(J,F,C){var G=this;var I=null;var H=null;var K=null;var D=Object.keys(G.AXIS).map(function(L){return G.AXIS[L]});var E=null;if(!j.is(J)){this._logger.warn("axis parameter is mandatory");return null}if(!A.contains(D,J)){this._logger.warn("axis parameter should be one of : "+D);return null}if(!j.is(F)){F=this.UNIT.PERCENT}D=Object.keys(G.UNIT).map(function(L){return G.UNIT[L]});if(!A.contains(D,F)){F=this.UNIT.PERCENT}I="_size"+J;H=Number(this[I]);if(this.UNIT.PERCENT===F){E=100}if(this.UNIT.PIXEL===F){E=this.view.$el.clientwidth}K=E/H;if(!C){K=K+F}return K},_setAxisSize:function w(D,E){var G=this;var H=false;var C=null;var F=Object.keys(G.AXIS).map(function(I){return G.AXIS[I]});if(!j.is(D)){this._logger.warn("size parameter is mandatory");return false}if(!j.is(E)){this._logger.warn("axis parameter is mandatory");return false}if(!A.contains(F,E)){this._logger.warn("axis parameter should be one of : "+F);return false}C="_size"+E;D=Number(D);if(isNaN(D)){this._logger.warn("size parameter should be a number");return false}if(0>=D){this._logger.warn("The grid size can't be 0 or less");return false}if(D!==this[C]){this[C]=D;H=true}return H},_onStaticViewModelChange:function s(C){this.setSize(C.get("V_DEL3DL_Grid_Size_X"),C.get("V_DEL3DL_Grid_Size_Y"));this.onAttach()},_initGrid:function k(){var D=this.view.$el.find(".layout_MainDropGrid").first();var C=this.template({sizeX:this.getSizeX(),sizeY:this.getSizeY(),blockSizeX:this.getBlockSizeX(this.UNIT.PERCENT,true),blockSizeY:this.getBlockSizeY(this.UNIT.PERCENT,true)});if(D){D.remove()}this.view.$el.prepend(C);this._$phantom=this.view.$el.find(".layout_Phantom").first()},_removeGrid:function q(){var C=this.view.$el.find(".layout_MainDropGrid").first();C.remove()},showCreatePageButtons:function(){for(var E=0;E<this._sizeX;E++){for(var D=0;D<this._sizeY;D++){var C=new r({icon:"CreatePage.svg",actionName:E+"|"+D,callback:i.proxy(this.view.onCreatePageButtonClicked,this.view),securityTap:true});this.view.$el.find(".createPageX"+E+"Y"+D).first().prepend(C.render().$el[0]);this._createPageButtons.push(C)}}},hideCreatePageButtons:function(){for(var C=0,D=this._createPageButtons.length;C<D;C++){this._createPageButtons[C].destroy()}this._createPageButtons=[]}});return d});define("DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/AView","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanEnums/Collection.enum","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/LeangetView.css"],function(g,d,q,r,v,c,i,l){var w=r.extend({className:"leangetView",_logger:null,iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),isFocus:false,staticRadioChannel:q.channel("static"),sideBarRadioChannel:q.channel("sidebar"),floatableRadioChannel:q.channel("floatable"),infraRadioChannel:q.channel("infra"),uiRadioChannel:q.channel("uiutils"),templateContext:function m(){return{get:d.proxy(this.model.get,this.model),getNLS:d.proxy(i.getTranslation,i),iconPath:this.iconPath}},initialize:function a(y){w.__super__.initialize.call(this,y);this._logger=v.getLogger(w);this.infraView=y.parentView;this.bindEvents();this.floatableCollectionView=y.parentView.floatableCollectionView;this.floatableCollection=l.FLOATABLES.sessionInstance;this.afterSwipeDelegate=d.proxy(this.afterSwipe,this)},bindEvents:function b(){},unbindEvents:function e(){},isSameOrigin:function x(z){if(!g.is(z)){return true}var y=this.origin||(this.origin=this.getOrigin(window.location.href));return this.getOrigin(z)===y},getOrigin:function t(y){var z=this._link||(this._link=window.document.createElement("a"));z.href=y;z.href=z.href;return z.protocol+z.hostname+z.port},onDestroy:function h(){this.unbindEvents()},onRender:function f(){},setFocusView:function u(y){this.enableLive(y);this.isFocus=y;if(y){this.infraRadioChannel.on("after:swipe",this.afterSwipeDelegate)}else{this.infraRadioChannel.off("after:swipe",this.afterSwipeDelegate)}},afterSwipe:function o(){},onBeforeFloatableDrop:function k(){},onAfterFloatableDrop:function j(){},onBeforeAnnotate:function n(){},onAfterAnnotate:function p(){},canCapture:function s(){return true}});return w});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/EHSCrossView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/EHSCrossView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/EHSCrossView.css"],function(b,a,d){var c=a.extend({className:"leangetView ehsCrossView",template:b.template(d),initialize:function(e){a.prototype.initialize.apply(this,[e])}});return c});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/CustomView",["DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/CustomView.css"],function(b){var a=b.extend({className:"leangetView customView",initialize:function(c){b.prototype.initialize.apply(this,[c])}});return a});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/SafetyView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/SafetyView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/SafetyView.css"],function(c,b,d){var a=b.extend({className:"leangetView safetyView",template:c.template(d),initialize:function(e){b.prototype.initialize.apply(this,[e])}});return a});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/TeamView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanCollectionViews/PersonCollectionView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanSession/Session.manager","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/TeamView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/TeamView.css"],function(f,g,l,j,k,m,a,h,d,i,e,c){var b=j.extend({className:"leangetView teamView",template:l.template(c),iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),teamRadioChannel:m.channel("team"),regions:{personRegion:"div.leangetPersonListRegion",teamRegion:"div.leangetTeamListRegion"},_personCollectionView:null,_teamCollectionView:null,templateContext:function(){var n=this.constructor.__super__.templateContext.call(this);n=l.extend(n,this.model.jsonData());return l.extend(n,{firstname:i._ConnectedUser.firstname,lastname:i._ConnectedUser.lastname,get:g.proxy(this.model.get,this.model),getNls:g.proxy(d.getTranslation,d)})},initialize:function(n){j.prototype.initialize.apply(this,[n]);this._personCollectionView=new k({collection:a.PEOPLES.sessionInstance,displayOwnTeam:true});this._teamCollectionView=new k({collection:a.PEOPLES.sessionInstance,displayOwnTeam:false});this.listenTo(i,"after:loadall",this.init.bind(this));if(i.isTeamLoaded()){this.init()}this.editMemberDelegate=g.proxy(this.editMember,this)},init:function(){},editMember:function(n){if(this._personCollectionView){this._personCollectionView.editMode(n)}if(this._teamCollectionView){this._teamCollectionView.editMode(n)}if(n){if(f.is(this._timeoutFct)){clearTimeout(this._timeoutFct)}this._timeoutFct=setTimeout(g.proxy(function(){this.editMember(false)},this),3000)}},switchToolbarSketch:function(){},onBeforeCapture:function(){},onAfterCapture:function(){},setFocusView:function(n){j.prototype.setFocusView.apply(this,[n]);if(n){this.bindEvents();if(this._personCollectionView){this._personCollectionView.bindEvents()}if(this._teamCollectionView){this._teamCollectionView.bindEvents()}}else{this.unbindEvents();this.editMember(false);if(this._personCollectionView){this._personCollectionView.unbindEvents()}if(this._teamCollectionView){this._teamCollectionView.unbindEvents()}}},bindEvents:function(){this.teamRadioChannel.on("teamView:editMember",this.editMemberDelegate)},unbindEvents:function(){this.teamRadioChannel.off("teamView:editMember",this.editMemberDelegate)},onRender:function(){this.showChildView("personRegion",this._personCollectionView);this.showChildView("teamRegion",this._teamCollectionView);var n=a.PEOPLES.sessionInstance.getOrFetch({name:i._ConnectedUser.id});n.getPicture().then(function(o){this.$el.find(".teamThumbnail").attr("onerror","this.src='"+this.iconPath+"/DefaultPeople.png'");this.$el.find(".teamThumbnail").attr("src",o)}.bind(this))}});return b});define("DS/DEL3DLeanViews/EditSticky/EditStickyNoteView",["UWA/Core","UWA/Class/Promise","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/WebappsUtils/WebappsUtils","DS/Logger/Logger","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Components/SketchComponent","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Utils/TaskUtils","DS/DEL3DLeanCollections/Collection.manager","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditStickyNoteView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditStickyNoteView.css"],function(f,c,e,s,i,p,d,r,h,g,a,l,q,m,j,o,b,t,k){var n=i.View.extend({_logger:null,iconPath:d.getWebappsAssetUrl("DEL3DLeanViews","icons"),_colors:["stickyNoteYellow","stickyNoteWhite","stickyNotePurple","stickyNotePink","stickyNoteGreen","stickyNoteBlue"],behaviors:[{behaviorClass:h,isDroppable:true,enableDropAcceptClass:".sidePersonView, .stickyMemberView, .sideStickerView, .stickerView",className:"#editStickySketchDrawArea"},{behaviorClass:o,usePressEvent:true,enablePressEvent:true,useTapEvent:true,enableTapEvent:true,className:".postit-header-stickerPicture"},{behaviorClass:o,usePressEvent:true,enablePressEvent:true,useTapEvent:true,enableTapEvent:true,className:".postit-header-peoplePicture"}],className:"editStickyNoteView showCanvas",ui:{sketch:".editStickySketchDrawArea",keyboardInput:"#insertKeyboardTextForStickyNoteID",colorButtons:".editStickyColorButtons .editStickySketchButton"},modelEvents:{"change:V_DEL3DL_Data":"dataUpdated"},events:{"keyup @ui.keyboardInput":"autoResizeText"},regions:{penButtonRegion:{selector:"#editStickySketchPenButton",replaceElement:false},keyboardButtonRegion:{selector:"#editStickySketchKeyboardButton",replaceElement:false},eraserButtonRegion:{selector:"#editStickySketchEraserButton",replaceElement:false},clearButtonRegion:{selector:"#editStickySketchClearButton",replaceElement:false},undoButtonRegion:{selector:"#editStickySketchUndoButton",replaceElement:false},redoButtonRegion:{selector:"#editStickySketchRedoButton",replaceElement:false},imageButtonRegion:{selector:"#editStickySketchImageButton",replaceElement:false},validateButtonRegion:{selector:"#editStickySketchValidateButton",replaceElement:false},stickyNoteYellowButtonRegion:{selector:".editStickySketchButton.stickyNoteYellow",replaceElement:false},stickyNoteWhiteButtonRegion:{selector:".editStickySketchButton.stickyNoteWhite",replaceElement:false},stickyNotePurpleButtonRegion:{selector:".editStickySketchButton.stickyNotePurple",replaceElement:false},stickyNotePinkButtonRegion:{selector:".editStickySketchButton.stickyNotePink",replaceElement:false},stickyNoteGreenButtonRegion:{selector:".editStickySketchButton.stickyNoteGreen",replaceElement:false},stickyNoteBlueButtonRegion:{selector:".editStickySketchButton.stickyNoteBlue",replaceElement:false},deleteButtonRegion:{selector:"#editStickySketchDeleteButton",replaceElement:false}},sideBarRadio:p.channel("sidebar"),actionLogRadio:p.channel("actionlog"),issueLogRadio:p.channel("issuelog"),taskRadioChannel:p.channel("taskutils"),floatableRadioChannel:p.channel("floatable"),template:s.template(k),templateContext:function(){return{deletable:this._deletable,colorPicker:this._colorPicker,colors:this._colors,V_DEL3DL_Description:this.model?this.model.get("V_DEL3DL_Description"):undefined}},initialize:function(u){this._deletable=f.is(u.deletable)?u.deletable:true;this._colorPicker=f.is(u.colorPicker)?u.colorPicker:true;this._colorsButtons={};this._logger=r.getLogger(n);this.NoteCategoryYellow=widget.getValue("NoteCategoryYellow");this.NoteCategoryWhite=widget.getValue("NoteCategoryWhite");this.NoteCategoryPurple=widget.getValue("NoteCategoryPurple");this.NoteCategoryPink=widget.getValue("NoteCategoryPink");this.NoteCategoryGreen=widget.getValue("NoteCategoryGreen");this.NoteCategoryBlue=widget.getValue("NoteCategoryBlue");this.onPenDelegate=e.proxy(this.onPen,this);this.onKeyboardDelegate=e.proxy(this.onKeyboard,this);this.onEraserDelegate=e.proxy(this.onEraser,this);this.onClearDelegate=e.proxy(this.onClear,this);this.onUndoDelegate=e.proxy(this.onUndo,this);this.onRedoDelegate=e.proxy(this.onRedo,this);this.onPictureDelegate=e.proxy(this.onPicture,this);this.onColorDelegate=e.proxy(this.onColor,this);this.onDeleteDelegate=e.proxy(this.onDelete,this);this.startDrawDelegate=e.proxy(this.onStartDraw,this);this.stopDrawDelegate=e.proxy(this.onStopDraw,this);this.resizeDelegate=e.proxy(this.onResize,this);this.onValidateDelegate=e.proxy(this.onValidate,this);this.penButtonView=new l({mode:"radio",checked:true,icon:"EditStickyNote/Pen.svg",callback:this.onPenDelegate,actionName:"pen"});this.keyboardButtonView=new l({mode:"radio",icon:"EditStickyNote/Keyboard.svg",callback:this.onKeyboardDelegate,actionName:"keyboard"});this.eraserButtonView=new l({mode:"radio",icon:"EditStickyNote/Eraser.svg",callback:this.onEraserDelegate,actionName:"eraser"});this.clearButtonView=new l({icon:"EditStickyNote/Clear.svg",callback:this.onClearDelegate,actionName:"clear"});this.undoButtonView=new l({icon:"Sketch/UndoWhite.svg",callback:this.onUndoDelegate,actionName:"undo"});this.redoButtonView=new l({icon:"Sketch/RedoWhite.svg",callback:this.onRedoDelegate,actionName:"redo"});this.imageButtonView=new l({icon:"EditStickyNote/Picture.svg",callback:this.onPictureDelegate,actionName:"picture"});this.validateButtonView=new l({icon:"EditStickyNote/CheckedIcon.svg",callback:this.onValidateDelegate,actionName:"validate"});if(this._colorPicker){for(var v=0;v<this._colors.length;v++){var w=this._colors[v];this._colorsButtons[w]=new l({mode:"radio",parentView:this,checked:w==="stickyNoteYellow",iconChecked:"CheckedIcon.svg",actionName:w,title:"",callback:e.proxy(this.onColorDelegate,this)})}}this.deleteButtonView=new l({icon:"EditStickyNote/Delete.svg",title:g.getTranslation("deleteLabel"),callback:this.onDeleteDelegate,actionName:"deleteFloatableElement",securityTap:true});this.$el.attr({id:this.cid});widget.addEvent("endEdit",e.proxy(this.onPreferencesEdited,this));this._initUploadInput()},dataUpdated:function(){this._updatePeoplePicture(this.model.get("V_DEL3DL_AssignedPersonName"));this._updateStickerPicture(this.model.get("V_DEL3DL_Document_PID"));if(this.model.isAction()){this._updateActionInformations()}else{if(this.model.isIssue()){this._updateIssueInformations()}}this._updateButtonAvailabilty()},bind:function(){this.showChildView("penButtonRegion",this.penButtonView);if(f.is(this.keyboardButtonView)){this.showChildView("keyboardButtonRegion",this.keyboardButtonView)}else{this.$el.find("#editStickySketchKeyboardButton").hide()}this.showChildView("eraserButtonRegion",this.eraserButtonView);this.showChildView("clearButtonRegion",this.clearButtonView);this.showChildView("undoButtonRegion",this.undoButtonView);this.showChildView("redoButtonRegion",this.redoButtonView);this.showChildView("imageButtonRegion",this.imageButtonView);this.showChildView("validateButtonRegion",this.validateButtonView);if(this._colorPicker){for(var v in this._colorsButtons){var u=this._colorsButtons[v];this.showChildView(u.model.get("actionName")+"ButtonRegion",u)}}if(this._deletable){this.showChildView("deleteButtonRegion",this.deleteButtonView)}if(f.is(this.sketch)){this.sketch.on("sketch:draw:start",this.startDrawDelegate);this.sketch.on("sketch:draw:end",this.stopDrawDelegate)}this.sideBarRadio.on("sideView:after:openPanel",this.resizeDelegate);this.sideBarRadio.on("sideView:after:closePanel",this.resizeDelegate);this.triggerMethod("view:enableInteract",true)},unbind:function(){this.detachChildView("penButtonRegion",this.penButtonView);if(f.is(this.keyboardButtonView)){this.detachChildView("keyboardButtonRegion",this.keyboardButtonView)}this.detachChildView("eraserButtonRegion",this.eraserButtonView);this.detachChildView("clearButtonRegion",this.clearButtonView);this.detachChildView("imageButtonRegion",this.imageButtonView);if(this._colorPicker){for(var v in this._colorsButtons){var u=this._colorsButtons[v];this.detachChildView(u.model.get("actionName")+"ButtonRegion",u)}}if(this._deletable){this.detachChildView("deleteButtonRegion",this.deleteButtonView)}if(f.is(this.sketch)){this.sketch.off("sketch:draw:start",this.startDrawDelegate);this.sketch.off("sketch:draw:end",this.stopDrawDelegate)}this.sideBarRadio.off("sideView:after:openPanel",this.resizeDelegate);this.sideBarRadio.off("sideView:after:closePanel",this.resizeDelegate);this.triggerMethod("view:enableInteract",false)},onBeforeDestroy:function(){if(f.is(this.model)&&!this.model.isNew()){this.saveData()}if(f.is(this.sketch)){this.sketch.destroy()}},flushUndoStack:function(){if(this.sketch){this.sketch.flushUndoStack();this._updateUndoRedo()}},onRender:function(){if(!f.is(this.model)){this.model=new m.STICKYNOTE.modelConstructor({V_DEL3DL_Sketch_Image:null,V_DEL3DL_Category:"NOTE",V_DEL3DL_Background_Color:"#f8f7b6"})}if(!f.is(this.sketch)){var u=this.model.get("V_DEL3DL_Sketch_Image");if(!f.is(u)||q.isDataUrl(u)){this._initSketch(u)}else{q.getImage(u).then(e.proxy(function(v){this._initSketch(v)},this))}}if(this.NoteCategoryYellow!==""||this.NoteCategoryWhite!==""&&this.NoteCategoryPurple!==""||this.NoteCategoryPink!==""&&this.NoteCategoryGreen!==""||this.NoteCategoryBlue!==""){this.setSelectedColorName()}if(this.model._isPID(this.model.get("V_DEL3DL_Background_Color"))){this._disableEraser()}this.dataUpdated(this.model)},onAttach:function(){this.bind();if(f.is(this.sketch)){this.sketch.resize()}this.updateBackground();this._updateUndoRedo();this.autoResizeText();var v=this.getUI("keyboardInput").val();if(f.is(v,"string")&&v.length>0){var u=this;setTimeout(function(){u.keyboardButtonView.tapEventCallback()},0)}},onDetach:function(){this.unbind()},onStartDraw:function(){},onStopDraw:function(){this._updateUndoRedo()},onPen:function(){this.showCanvas();if(f.is(this.sketch)){this.sketch.enablePen()}},onKeyboard:function(){this.showKeyboard();this.autoResizeText()},onEraser:function(){this.showCanvas();if(f.is(this.sketch)){this.sketch.enableErase()}},onClear:function(){this.clearCanvas();this._updateUndoRedo();if(this.isKeyboardShowed()){this.focusKeyboard()}},onUndo:function(){if(this.sketch){this.sketch.undo();this._updateUndoRedo()}},onRedo:function(){if(this.sketch){this.sketch.redo();this._updateUndoRedo()}},_updateUndoRedo:function(){this.undoButtonView.setEnabled(this.sketch.hasUndo());this.redoButtonView.setEnabled(this.sketch.hasRedo())},onPicture:function(){this.focusKeyboard();this.changeStickyImageInput.trigger("click")},onColor:function(w){this.focusKeyboard();var v=this._rgbToHex(w.$el.css("background-color"));if(f.is(this.sketch._sketchImage)&&this.model.get("V_DEL3DL_Background_Color")!==v){var u=atob(this.sketch._sketchImage.substring(26));u=u.replace(new RegExp(this.model.get("V_DEL3DL_Background_Color"),"g"),v);this.sketch._sketchImage="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(u)));this.model.set("V_DEL3DL_Sketch_Image",this.sketch._sketchImage)}this.model.set("V_DEL3DL_Background_Color",v);if(this.NoteCategoryYellow!==""||this.NoteCategoryWhite!==""&&this.NoteCategoryPurple!==""||this.NoteCategoryPink!==""&&this.NoteCategoryGreen!==""||this.NoteCategoryBlue!==""){this.setSelectedColorName()}this.updateBackground(v);this.eraserButtonView.setEnabled(true);this.sketch._clear(this.sketch._sketchCtx);this.sketch._clear(this.sketch._canvasCtx);this.sketch.drawUndoStack()},setSelectedColorName:function(){var u=this.model.get("V_DEL3DL_Background_Color");e(".editStickyColorButtonDetails",this.$el).css("display","block");e(".selectedColorNameArrow",this.$el).css("background",u);e(".selectedColorNameContainer",this.$el).css("background",u);if(u==="#f8f7b6"||u==="#F8F7B6"){e(".selectedColorNameArrow",this.$el).css("left","4.5%");e(".selectedColorName",this.$el).text(this.NoteCategoryYellow)}else{if(u==="#f5f5f5"){e(".selectedColorNameArrow",this.$el).css("left","21.5%");e(".selectedColorName",this.$el).text(this.NoteCategoryWhite)}else{if(u==="#d4cdf3"){e(".selectedColorNameArrow",this.$el).css("left","38.5%");e(".selectedColorName",this.$el).text(this.NoteCategoryPurple)}else{if(u==="#f1c3f1"){e(".selectedColorNameArrow",this.$el).css("left","55.5%");e(".selectedColorName",this.$el).text(this.NoteCategoryPink)}else{if(u==="#c5f7c1"){e(".selectedColorNameArrow",this.$el).css("left","72.5%");e(".selectedColorName",this.$el).text(this.NoteCategoryGreen)}else{if(u==="#c9ecf8"){e(".selectedColorNameArrow",this.$el).css("left","89.5%");e(".selectedColorName",this.$el).text(this.NoteCategoryBlue)}}}}}}},onDelete:function(v,u){this.triggerMethod("view:delete",v,u)},onResize:function(){if(f.is(this.sketch)){this.sketch.resize()}},onDropCallback:function(w){var u=w.relatedTarget;if(this.model.isEditable()){if(e(u).hasClass("sideStickerView")||e(u).hasClass("stickerView")){var v=w.relatedTarget.getAttribute("data-documentId");this.model.assignSticker(v)}else{var x=w.relatedTarget.getAttribute("data-name");this.model.assignPeople(x,j,b)}}},onPreferencesEdited:function(){if(f.is(this.sketch)){this.sketch.setLineWidth(parseInt(widget.getValue("StickyNoteThickness")))}},onValidate:function(){this.saveData()},showCanvas:function(){this.$el.removeClass("showKeyboard").addClass("showCanvas")},showKeyboard:function(){this.$el.removeClass("showCanvas").addClass("showKeyboard");this.focusKeyboard()},focusKeyboard:function(){if(this.isKeyboardShowed()){setTimeout(e.proxy(function(){var u=this.getUI("keyboardInput").val();this.getUI("keyboardInput").focus();this.getUI("keyboardInput").val("");this.getUI("keyboardInput").val(u)},this),100)}},isCanvasShowed:function(){return this.$el.hasClass("showCanvas")},isKeyboardShowed:function(){return this.$el.hasClass("showKeyboard")},autoResizeText:function(){var w=this.getUI("keyboardInput").first();w.css("font-size","");if(w.get(0).scrollHeight>w.height()){var u=undefined;var v=undefined;while(w.get(0).scrollHeight>w.height()&&(u=w.css("font-size"))&&parseInt(u)>1){if(v===u){this._logger.warn("Bad font size provided by web browser, font resize stopped");break}v=u;w.css("font-size","-=.2")}}},selectColorButton:function(u){if(this._colorPicker){var v=this._getButtonFromClass(u);if(f.is(v)){v.setChecked(true)}}},setBackgroundColor:function(u){this.getUI("sketch").removeClass(this._colors.join(" ")).addClass(u)},setBackgroundImage:function(v){var w=f.is(v)?'url("'+v+'")':"";var u=f.is(v)?"white":"";this.getUI("sketch").css("background",w);this.getUI("sketch").css("background-color",u)},updateBackground:function(v){if(!f.is(v)){v=this.model.get("V_DEL3DL_Background_Color")}if(/^[a-f0-9]+$/i.test(v)){q.getImage(v).then(e.proxy(function(w){this.setBackgroundImage(w);this.setBackgroundColor()},this))}else{if(q.isDataUrl(v)){this.setBackgroundImage(v);this.setBackgroundColor()}else{if(/^#[a-f0-9]+$/i.test(v)){this.setBackgroundImage();var u=this._getClassFromColor(v);this.setBackgroundColor(u);this.selectColorButton(u)}}}this.sketch.setBackgroundColor(v)},saveData:function(){var x=c.deferred();var v=this.getUI("keyboardInput");var u=v[0].value;this.model.set("V_DEL3DL_Description",u);var y=this.model.get("V_DEL3DL_Category");var w=m.STICKYNOTE;switch(y){case"ISSUE":w=m.ISSUENOTE;break;case"ACTION":w=m.TASKNOTE;break;case"NOTE":w=m.NOTE;break;default:w=m.STICKYNOTE;break}this.sketch.toSVG(this.sketch.width,this.sketch.height).then(e.proxy(function(A){try{var z=this.model.get("V_DEL3DL_Background_Color");if(!this.model._isPID(z)){A=A.replace(/fill="#FFFFFF"/gi,'fill="'+z+'"')}this.model.set("V_DEL3DL_Sketch_Image","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(A))));if(this.model.isNew()){t.createModel(null,w,this.model.attributes,{success:e.proxy(function(C){this.floatableRadioChannel.trigger("floatableCollection:newStickyNoteModel",C);x.resolve(C)},this)})}else{this.model.save();if(this.model.isAction()){this.taskRadioChannel.trigger("stickynote:draw:updated",{model:this.model})}x.resolve(this.model)}}catch(B){this.triggerMethod("view:editionSavedFailed")}},this));return x.promise},clearCanvas:function(){if(f.is(this.sketch)){this.sketch.clear()}},clearText:function(){this.focusKeyboard();this.getUI("keyboardInput")[0].value=""},clear:function(){this.clearCanvas();this.clearText()},_updateButtonAvailabilty:function(){if(!this.model.isEditable()){this.$el.addClass("noteNotEditable")}else{this.$el.removeClass("noteNotEditable")}if(!this.model.isDeletable()){this.$el.addClass("noteNotDeletable")}else{this.$el.removeClass("noteNotDeletable")}},_updateIssueInformations:function(){if(this.model.isDone()){e(".postit-info-status",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/padlock.svg)");e(".postit-info-status",this.$el).addClass("done");e(".postit-info-status",this.$el).show()}else{e(".postit-info-status",this.$el).hide()}},_updateActionInformations:function(){var u=undefined;if(this.model.isDone()){e(".postit-info-status-arrow",this.$el).hide();e(".postit-info-status",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/action_done.svg)");e(".postit-info-status",this.$el).addClass("action_done");e(".postit-info-status",this.$el).show()}else{if(this.model.isShared()){e(".postit-info-status",this.$el).attr("style","background-image: url("+this.iconPath+"/Loading.svg)");e(".postit-info-status",this.$el).show();if(this.model.isOurTeamAssigned()){u=this.model.get("owner");e(".postit-info-status-arrow",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/ArrowReception.png); left: -45%")}else{u=this.model.get("V_DEL3DL_AssignedTeamName");e(".postit-info-status-arrow",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/ArrowSent.png); left: 45%")}var v=j.PEOPLES.sessionInstance.getOrFetch({name:u});if(!f.is(v)){e(".postit-info-status",this.$el).hide()}else{v.getPicture().then(e.proxy(function(w){e(".postit-info-status-arrow",this.$el).show();e(".postit-info-status",this.$el).attr("style","background-image: url("+w+")");e(".postit-info-status",this.$el).show()},this))}}else{e(".postit-info-status",this.$el).hide()}}},_updatePeoplePicture:function(u){this._$peoplePic=e(".postit-header-peoplePicture",this.$el).first();if(!f.is(u)){this._$peoplePic.hide()}else{this._$peoplePic.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");this._$peoplePic.show();var v=j.PEOPLES.sessionInstance.getOrFetch(u);if(f.is(v)){v.getPicture().then(e.proxy(function(w){this._peoplePictureURL=w;this._$peoplePic.attr("style","background-image: url("+w+")");this._$peoplePic.show()},this))}else{this._$peoplePic.hide()}}},_updateStickerPicture:function(u){this._$stickerPic=e(".postit-header-stickerPicture",this.$el).first();this._stickerPictureURL="";if(!f.is(u)){this._$stickerPic.hide()}else{this._$stickerPic.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");this._$stickerPic.show();q.getImage(u).then(e.proxy(function(v){this._stickerPictureURL=v;this._$stickerPic.attr("style","background-image: url("+v+")");this._$stickerPic.show()},this))}},_initSketch:function(u){if(!f.is(this.sketch)){this.sketch=new a({container:this.getUI("sketch")[0],sketchImage:u,lineWidth:parseInt(widget.getValue("StickyNoteThickness")),backgroundColor:this.model.get("V_DEL3DL_Background_Color")})}},_initUploadInput:function(){if(e("#stickyImageUpload").length===0){this.changeStickyImageInput=e(document.createElement("input"));this.changeStickyImageInput.attr("type","file");this.changeStickyImageInput.attr("accept","image/*");this.changeStickyImageInput.attr("id","stickyImageUpload");this.changeStickyImageInput.context.onchange=e.proxy(function(){var z=this.changeStickyImageInput.context.files;var y=z.length;var u;var A=e.proxy(function(){q.setImage(u.result,null,null,z[0].name).then(e.proxy(function(B){this.model.set("V_DEL3DL_Background_Color",B);this.updateBackground(B);this._uncheckColor();this._disableEraser()},this))},this);for(var v=0;v<y;v++){var w=z[v];var x=new RegExp("^image/");if(w&&w.type.match(x)){u=new FileReader();u.addEventListener("load",A,false);u.readAsDataURL(w)}}},this);this.changeStickyImageInput.context.onchange()}},_rgbToHex:function(v){var u=v.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return(u&&u.length===4)?"#"+("0"+parseInt(u[1],10).toString(16)).slice(-2)+("0"+parseInt(u[2],10).toString(16)).slice(-2)+("0"+parseInt(u[3],10).toString(16)).slice(-2):v},_getClassFromColor:function(z){if(!/^#[a-f0-9]+$/i.test(z)){z=this._rgbToHex(z)}z=z.toLowerCase();var y="";var u=this.getUI("colorButtons");for(var w=0;w<u.length;w++){var x=u[w];var v=this._rgbToHex(e(x).css("background-color")).toLowerCase();if(z===v){var A=e(x).attr("class").match(/.*(stickyNote\w+).*/);if(A.length>1){y=A[1];break}}}return y},_getButtonFromClass:function(u){return this._colorsButtons[u]},_getButtonFromColor:function(v){var u=this._getClassFromColor(v);return this._getButtonFromClass(u)},_uncheckColor:function(){if(this._colorPicker){for(var v in this._colorsButtons){var u=this._colorsButtons[v];if(f.is(u)&&u.getChecked()){u.setChecked(false)}}}},_disableEraser:function(){if(this.eraserButtonView.getChecked()){this.penButtonView.setChecked(true);this.onPen()}this.eraserButtonView.setEnabled(false)},_onStickerClick:function(){if(this._deleteSticker){clearTimeout(this._timeoutSticker);this.model.save({V_DEL3DL_Document_PID:null});this._deleteSticker=false}},_onStickerPress:function(){if(!this._deleteSticker){this._deleteSticker=true;this._timeoutSticker=setTimeout(e.proxy(function(){this._$stickerPic.removeClass("stickerDeleteButton");this._$stickerPic.attr("style","background-image: url("+this._stickerPictureURL+");");this._$stickerPic.show();this._deleteSticker=false},this),2000);this._$stickerPic.addClass("stickerDeleteButton");this._$stickerPic.attr("style","background-image: url("+this.iconPath+"/MinusIconFull.svg);")}else{this._onStickerClick()}},_onPeopleClick:function(){if(this._deletePeople){clearTimeout(this._timeoutPeople);this.model.assignPeople(null,j,b);this._deletePeople=false}},_onPeoplePress:function(){if(!this._deletePeople){this._deletePeople=true;this._timeoutPeople=setTimeout(e.proxy(function(){this._$peoplePic.removeClass("peopleDeleteButton");this._$peoplePic.attr("style","background-image: url("+this._peoplePictureURL+");");this._$peoplePic.show();this._deletePeople=false},this),2000);this._$peoplePic.addClass("peopleDeleteButton");this._$peoplePic.attr("style","background-image: url("+this.iconPath+"/MinusIconFull.svg);")}else{this._onPeopleClick()}},tapEventCallback:function(u){if(u.target.className.contains("postit-header-stickerPicture")){this._onStickerClick()}else{this._onPeopleClick()}},pressEventCallback:function(u){if(!this.model.isEditable()){return}if(u.target.className.contains("postit-header-stickerPicture")){this._onStickerPress()}else{this._onPeoplePress()}}});return n});define("DS/DEL3DLeanViews/Utils/IssueUtils",["pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanHttpRequest/ImageService","DS/DocumentManagement/DocumentManagement","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanViews/Utils/AutoRefreshUtils","UWA/Core","DS/Logger/Logger"],function(i,g,o,f,c,j,k,h,d,e,b){var n=null;var a=i.Object.extend({name:"IssueUtils",issueRadioChannel:o.channel("issueutils"),floatableRadioChannel:o.channel("floatable"),init:function m(){this._logger=b.getLogger(a);this._floatableModelCreatedDelegate=g.proxy(this._floatableModelCreated,this);this.floatableRadioChannel.on("floatableCollection:newStickyNoteModel",this._floatableModelCreatedDelegate)},_floatableModelCreated:function(r){var t=e.getGlobal().sessionLoaded;var q=this;if(r.isIssue()&&t){var p=e.getGlobal().leanSessionManager;var s=(new h.ISSUELOG.modelConstructor()).get("physicalid");r.save({V_DEL3DL_AssignedTeamName:p.getSessionName(),V_DEL3DL_IssueLogZone:"ilParking"});f.createModel(null,h.COORD,{from:s,to:r.id,V_DEL3DL_X:-50,V_DEL3DL_Y:-50,V_DEL3DL_Size_X:1,V_DEL3DL_Size_Y:1},{success:function(){q.issueRadioChannel.trigger("stickynote:zone:updated",r)},error:function(){}})}},deleteIssue:function(){},addContextCapture:function(q,p){if(!p.has("V_DEL3DL_IssueContext")){j.setImage(q).then(function(r){p.set("V_DEL3DL_IssueContext",r)})}else{j.setImage(q,p.get("V_DEL3DL_IssueContext"))}},getContextCapture:function(p,r,q){r(j.getImage(p.get("V_DEL3DL_IssueContext")))},removeRemainingIssueRelationAndModel:function(q){var p=c.RELATIONS.sessionInstance.where({to:q.id});p.forEach(function(r){r.destroy()});c.FLOATABLES.sessionInstance.remove(q)}});function l(){if(!e.is(n)){n=new a();n.init()}return n}return l()});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/IssueLogView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanResources/ResourcesManager","DS/Logger/Logger","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Utils/IssueUtils","DS/DEL3DLeanViews/Utils/AutoRefreshUtils","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/IssueLogView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/IssueLogView.css"],function(g,h,l,i,m,e,c,n,b,a,d,f,k){var j=i.extend({name:"IssueLogView",className:"leangetView issuelogView",_logger:null,_areaInfos:{},behaviors:[{behaviorClass:m,isDroppable:true,isActiveOnRender:false,enableDropAcceptClass:".stickyNoteView",className:".issuelogSection"}],fakeKonamiCodeSequence:[38,40,37,39],issueRadioChannel:n.channel("issueutils"),issueLogWaitingIcon:f.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/issueLogWaitingIcon.png",issueLogClosedIcon:f.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/issueLogClosedIcon.png",template:l.template(k),templateContext:function(){var o=this.constructor.__super__.templateContext.call(this);o=l.extend(o,this.model.jsonData());return l.extend(o,{waiting_column:e.getTranslation("waiting_column"),responsible_assigned_column:e.getTranslation("responsible_assigned_column"),actions_identified_column:e.getTranslation("actions_identified_column"),actions_applied:e.getTranslation("actions_applied"),issue_closed_column:e.getTranslation("issue_closed_column"),issueLogWaitingIcon:this.issueLogWaitingIcon,issueLogClosedIcon:this.issueLogClosedIcon})},initialize:function(o){i.prototype.initialize.apply(this,[o]);this.updateStickyNotePositionDelegate=h.proxy(this.updateStickyNotePosition,this);this.floatableCollectionView.selectAllDelegate=h.proxy(this.selectAllFloatable,this.floatableCollectionView);this.floatableCollectionView.createViewDelegate=h.proxy(this.createFloatableView,this.floatableCollectionView);this.floatableCollectionView.updateRelation=this.updateRelation;this.floatableCollectionView.onAddChild=h.proxy(this.onAddChild,this);this.issueRadioChannel.off("stickynote:zone:updated");this.issueRadioChannel.on("stickynote:zone:updated",this.updateStickyNotePositionDelegate);if(!g.is(this._logger)){this._logger=c.getLogger(j)}g.getGlobal().hasIssueLog=true;this.issueRadioChannel.trigger("hasIssueLog:change")},onDestroy:function(){g.getGlobal().hasIssueLog=false;this.issueRadioChannel.trigger("hasIssueLog:change")},switchToolbarSketch:function(){},onBeforeCapture:function(){},onAfterCapture:function(){},onReload:function(){d.refreshAILogElements()},onReorder:function(){var o=this;this.floatableCollectionView.children.each(function(q){var r=q.model;var p=q.relationModel;if(r.isIssue()&&g.is(p.id)){q.$el.attr("data-x","-1");q.$el.attr("data-y","-1")}});this.floatableCollectionView.children.each(function(q){var r=q.model;var p=q.relationModel;if(r.isIssue()&&g.is(p.id)){var s=o._searchFreeSpace(r.get("V_DEL3DL_IssueLogZone"));if(g.is(s)&&((p.get("V_DEL3DL_X")!==s.coordX)||(p.get("V_DEL3DL_Y")!==s.coordY)||(p.get("V_DEL3DL_Angle")!==0)||(p.get("V_DEL3DL_Size_X")!==1))){p.save({V_DEL3DL_X:s.coordX,V_DEL3DL_Y:s.coordY,V_DEL3DL_Angle:0,V_DEL3DL_Size_X:1});q.pinchScale=1;q.angleScale=0}else{q.$el.attr("data-x",s.coordX);q.$el.attr("data-y",s.coordY)}}})},createFloatableView:function(){},updateRelation:function(q,p){if(!q.model.isIssue()){var o=q.relationModel;if(!g.is(o)){return}o.save(p)}},onAttach:function(){if(!g.is(this.checkChildrenOnce)){this.checkChildrenOnce=true;this.checkAndReplaceNotes()}},onAddChild:function(o,p){p.enableView(this.isFocus);if(g.is(this.checkChildrenOnce)){this.checkAndReplaceNote(p)}},classicLayout:function(){this._areaInfos.ilParking={width:15,height:100,left:0,top:0};this._areaInfos.ilResponsibleAssigned={width:30,height:100,left:15,top:0};this._areaInfos.ilActionsIdentified={width:40,height:100,left:45,top:0};this._areaInfos.ilIssueClosed={width:15,height:100,left:85,top:0}},onRender:function(){i.prototype.onRender.apply(this,[]);this.classicLayout()},setFocusView:function(o){i.prototype.setFocusView.apply(this,[o]);if(o){h(document).on("keydown",h.proxy(this.onFakeKonamiCode,this))}else{h(document).off("keydown",h.proxy(this.onFakeKonamiCode,this))}this.fakeKonamiCodeOn=false;this.fakeKonamiCodeStep=0;this.floatableCollectionView.children.each(function(p){if(p.model.isIssue()){p._updateInformations()}});this.triggerMethod("view:activeInteract",o,o,false)},onFakeKonamiCode:function(o){if(o.keyCode===this.fakeKonamiCodeSequence[this.fakeKonamiCodeStep++]){if(this.fakeKonamiCodeStep===this.fakeKonamiCodeSequence.length){this.fakeKonamiCodeOn=true;this.fakeKonamiCodeStep=0}}else{this.fakeKonamiCodeStep=0}},onDragEnterCallback:function(o){b.addClass(h(o.target),"issueLogCanDrop")},onDragLeaveCallback:function(o){b.removeClass(h(o.target),"issueLogCanDrop")},onDropCallback:function(p){b.removeClass(h(p.target),"issueLogCanDrop");var o=this.floatableCollectionView.children.filter({cid:p.relatedTarget.id})[0];var q=o.model.get("V_DEL3DL_IssueLogZone");var s=h(p.target).attr("class").split(" ").filter(function(t){return t.indexOf("il")===0})[0];if(!g.is(s)||(q==="ilIssueClosed"&&q!==s&&!this.fakeKonamiCodeOn)){o.updatePosition();return}var r={coordY:Number(p.relatedTarget.getAttribute("data-y")),coordX:Number(p.relatedTarget.getAttribute("data-x"))};o.model.save({V_DEL3DL_IssueLogZone:s});o.relationModel.save({V_DEL3DL_X:r.coordX,V_DEL3DL_Y:r.coordY})},selectAllFloatable:function(){this.forceChildPressEvent();this.children.each(h.proxy(function(o){if(o.model.isIssue()&&o.model.isDone()){o.selectFloatable()}},this));this.onFloatableSelected()},_checkFloatableIsInCorrectZone:function(o){var q=o.relationModel.get("V_DEL3DL_Y");var u=o.relationModel.get("V_DEL3DL_X");var s=this._areaInfos[o.model.get("V_DEL3DL_IssueLogZone")];var v=s.top;var t=s.left;var p=s.width;var r=s.height;if((q>=v&&q<=(v+r))&&(u>=t&&u<=(t+p))){return true}return false},_searchFreeSpace:function(v){var x=this._areaInfos[v];var u=x.top;var p=x.left;var t=x.width;var s=x.height;var r=p+2;var q=u+7;var o=p+t;var y=u+s;var w=r;for(;h('.stickyNoteView[data-x="'+r+'"][data-y="'+q+'"]',this.floatableCollectionView.$el).length>0;r+=6){if(r>(o-12)){if(q>(y-15)){break}else{r=w-6;q+=10}}}return{coordY:q,coordX:r}},updateStickyNotePosition:function(o){var p=this.floatableCollectionView.children.findByModel(o);var q=this._searchFreeSpace(o.get("V_DEL3DL_IssueLogZone"));if(g.is(q)&&g.is(p)){p.relationModel.save({V_DEL3DL_X:q.coordX,V_DEL3DL_Y:q.coordY})}this.issueRadioChannel.trigger("stickynote:zone:updated:end")},checkAndReplaceNotes:function(){var o=this;o.floatableCollectionView.children.each(function(p){o.checkAndReplaceNote(p)})},checkAndReplaceNote:function(p){var q=this;var s=p.model;var o=p.relationModel;var r=s.get("V_DEL3DL_IssueLogZone");if(g.is(o.id)&&s.isIssue()&&g.is(r)&&!q._checkFloatableIsInCorrectZone(p)){var t=q._searchFreeSpace(r);if(g.is(t)){o.save({V_DEL3DL_X:t.coordX,V_DEL3DL_Y:t.coordY})}}}});return j});define("DS/DEL3DLeanViews/Components/CircleMenuCollectionView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Components/ButtonModel","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette"],function(h,d,g,a,c,f,e){var b=e.CollectionView.extend({childView:c,collection:null,name:"CircleMenuCollectionView",className:"circleMenuView",childViewEvents:{"buttonView:clicked":"onCircleMenuButtonClick"},initialize:function(i){this.collection=new g.Collection();this._originRadius=h.is(i.originRadius)?i.originRadius:-0.5;this._originDistance=h.is(i.originDistance)?i.originDistance:90;this._circleMenuButtons=this.getOption("circleMenuButtons")},onRender:function(){a.addClass(this.$el,"circleMenuHidden")},isShowed:function(){return this.$el.hasClass("active")},showMenu:function(){if(!this.isShowed()){this.toggleShowMenu()}},hideMenu:function(){if(this.isShowed()){this.toggleShowMenu()}},toggleShowMenu:function(){if(!this.$el.hasClass("active")){for(var i=0,j=this._circleMenuButtons.length;i<j;i++){this.collection.add(new f(this._circleMenuButtons[i]))}a.removeClass(this.$el,"circleMenuHidden")}setTimeout(d.proxy(function(){this.$el.toggleClass("active");var k=this._originRadius;var l=this._originDistance;var m=d(".buttonView",this.$el);d.each(m,function(o,n){n.style.left=(35-l*Math.cos(k*Math.PI-(0.3+(m.length/10))*(1/m.length)*o*Math.PI))+"%";n.style.top=(35+l*Math.sin(k*Math.PI-(0.3+(m.length/10))*(1/m.length)*o*Math.PI))+"%"});if(!this.$el.hasClass("active")){setTimeout(d.proxy(function(){a.addClass(this.$el,"circleMenuHidden");for(var n=0,o=this.collection.models.length;n<o;n++){this.collection.remove(this.collection.models[0])}},this),300)}if(this.isShowed()){this.startHideTimeout()}else{this.clearTimeout()}},this),50)},onCircleMenuButtonClick:function(j,i){this.clearTimeout();this.startHideTimeout();this.triggerMethod("circleMenuCollectionView:buttonClick",j,i)},startHideTimeout:function(j){var i=h.is(j)?j:5000;this.timeOufFct=setTimeout(d.proxy(function(){this.hideMenu()},this),i)},clearTimeout:function(){clearTimeout(this.timeOufFct)}});return b});define("DS/DEL3DLeanViews/StaticViews/StaticView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanHttpRequest/MessageHandler","DS/DEL3DLeanSession/Session.manager","DS/DEL3DLeanViews/AView","DS/Logger/Logger"],function(f,h,m,p,e,d,n,k,g,c){var a=g.extend({collectionViewsEnum:null,staticCollectionView:null,focused:null,focusable:null,maximized:null,positionEditable:null,settingsEditable:null,rendered:false,regions:{staticRegion:{el:"> .staticCollectionView",replaceElement:true},floatableRegion:{el:"> .floatableCollectionView",replaceElement:true}},templateContext:function o(){return{get:h.proxy(this.model.get,this.model),getNLS:h.proxy(e.getTranslation,e)}},staticRadioChannel:p.channel("static"),sideBarRadioChannel:p.channel("sidebar"),uiRadioChannel:p.channel("uiutils"),socketChannel:p.channel("live"),initialize:function(q){a.__super__.initialize.call(this,q);this._logger=c.getLogger(a);this.parent=this.getOption("parent");this.relationModel=this.getOption("relationModel");this.setMeetingPreparationDelegate=h.proxy(this.setMeetingPreparation,this);this.setToolsDelegate=h.proxy(this.setTools,this);this.$el.attr("id",this.cid);this.collectionViewsEnum=this.getOption("collectionViewsEnum");if(f.is(this._initialize)){this._initialize()}this.bindEvents()},onBeforeDestroy:function(){if(this.getFocus()===true){window.location.reload()}},onDestroy:function(){this.unbindEvents()},bindEvents:function(){this.sideBarRadioChannel.on("sideBarView:meetingPreparation",this.setMeetingPreparationDelegate);this.sideBarRadioChannel.on("sideBarView:tools",this.setToolsDelegate);if(f.is(this._bindEvents)){this._bindEvents()}},unbindEvents:function(){this.sideBarRadioChannel.off("sideBarView:meetingPreparation",this.setMeetingPreparationDelegate);this.sideBarRadioChannel.off("sideBarView:tools",this.setToolsDelegate);if(f.is(this._unbindEvents)){this._unbindEvents()}},focus:function(){var q=this;if(q.focused){return}if(f.getGlobal().inMeeting&&f.getGlobal().isMeetingLeader){q.liveIt("_socketMeetingFocus",arguments,{welcomeAction:"replace",welcomeKey:"meeting:focus",force:true})}q.staticRadioChannel.once("after:maximize",function(r){var s={focusView:q,unfocusView:r.unfocusView};if(f.is(q._focus)){q._focus(s)}q._updateMapButton();q.staticRadioChannel.trigger("after:focus",s)});q.staticRadioChannel.once("after:unFocus",function(r){var s={focusView:q,unfocusView:r.unfocusView};if(f.is(q._beforeChangeView)){q._beforeChangeView(s)}q.staticRadioChannel.once("after:minimize",function(u){var t={focusView:q,unfocusView:u.unfocusView};q.staticRadioChannel.trigger("before:maximize",t);q.uiRadioChannel.once("after:maximizeTransition",function(){q.maximized=true;q.staticRadioChannel.trigger("after:maximize",t)});q._maximize(t)});q.staticRadioChannel.trigger("before:minimize",s);q.staticRadioChannel.once("before:minimize",function(u){var t={focusView:u.focusView,unfocusView:q};q.uiRadioChannel.once("after:minimizeTransition",function(){q.maximized=false;q.staticRadioChannel.trigger("after:minimize",t)});q._minimize(t)})});q.setFocus(true);q.staticRadioChannel.trigger("before:focus",{focusView:q,unfocusView:null});q.staticRadioChannel.once("before:focus",function(s){var r={focusView:s.focusView,unfocusView:q};q.staticRadioChannel.trigger("before:unFocus",r);if(f.is(q._unfocus)){q._unfocus(r)}q.setFocus(false);q.staticRadioChannel.trigger("after:unFocus",r)})},setFocus:function i(q){this.enableLive(q);this.focused=q},getFocus:function j(){return this.focused},setFocusable:function(q){if(this.focusable===q){return}this.focusable=q;if(this.focusable){if(f.is(this._focusable)){this._focusable()}}else{if(f.is(this._unfocusable)){this._unfocusable()}}},setLayoutEditable:function(q){if(this.layoutEditable===q){return}this.layoutEditable=q;if(this.layoutEditable){if(f.is(this._layoutEditable)){this._layoutEditable()}}else{if(f.is(this._layoutUneditable)){this._layoutUneditable()}}},setMeetingPreparation:function(q){if(this.meetingPreparation===q||f.getGlobal().inMeeting===true){return}this.meetingPreparation=q;if(f.is(this._meetingPreparation)){this._meetingPreparation(q)}},setTools:function(q){if(f.is(this._toolsOpen)){this._toolsOpen(q)}},setPositionEditable:function(q){if(this.positionEditable===q){return}this.positionEditable=q;if(this.positionEditable){if(f.is(this._positionEditable)){this._positionEditable()}}else{if(f.is(this._positionUneditable)){this._positionUneditable()}}},setSettingsEditable:function(q){if(this.settingsEditable===q){return}this.settingsEditable=q;if(this.settingsEditable){if(f.is(this._settingsEditable)){this._settingsEditable()}}else{if(f.is(this._settingsUneditable)){this._settingsUneditable()}}},deleteView:function(){this.staticRadioChannel.trigger("staticCollection:delete",this)},getTitle:function(){if(this.model.has("V_DEL3DL_Title")&&this.model.get("V_DEL3DL_Title").length>0){return this.model.get("V_DEL3DL_Title")}else{return e.getTranslation(this.model.get("type"))}},onRender:function(){this.rendered=true;if(f.is(this._onRender)){this._onRender()}},onBeforeRender:function b(){if(f.is(this._onBeforeRender)){this._onBeforeRender()}},_getViewElement:function(q){if(q.className&&q.className.contains){if(q.className.contains("focusable")||q.className.contains("maximize")){return q}}else{this._logger.warn("No className on element")}if(f.is(q.parentElement)){return this._getViewElement(q.parentElement)}return""},_getParentStaticView:function(){if(f.is(this.parent)){return this.parent.parent}return null},_parentIsMap:function(){if(f.is(this._getParentStaticView())&&this._getParentStaticView().className==="mapView"){return true}return false},_updateMapButton:function(){if(this._parentIsMap()===true||this.className==="mapView"){this.sideBarRadioChannel.trigger("mapButton:updateMapButton",this.relationModel)}},onSketchLive:function l(){if(f.is(this.sketch)&&!this.liveIt("onSketchLive",arguments)){this.sketch[arguments[0]].apply(this.sketch,Object.values(arguments).slice(1))}}});return a});define("DS/DEL3DLeanViews/FloatableElements/FloatableElementView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","DS/DEL3DLeanViews/AView","DS/DEL3DLeanViews/Components/CircleMenuCollectionView","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","DS/Logger/Logger","css!DS/DEL3DLeanViews/assets/css/FloatableElements/FloatableElementMenu.css"],function(h,f,d,c,e,a,b){var g=d.extend({iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),circleMenuCollectionView:null,enabled:false,selected:false,size:null,relationModel:null,logger:null,regions:{circleMenuViewRegion:{el:".circleMenuView",replaceElement:true}},initialize:function(i){g.__super__.initialize.call(this,i);if(!h.is(this.logger)){this.logger=b.getLogger(g)}this.parent=this.getOption("parent");this.relationModel=this.getOption("relationModel");this.updatePositionDelegate=f.proxy(this.updatePosition,this);this.relationDestroyedDelegate=f.proxy(this.relationDestroyed,this);this.relationModel.on("change",this.updatePositionDelegate);this.relationModel.on("destroy",this.relationDestroyedDelegate);if(h.is(this._initialize)){this._initialize()}},initDom:function(){this.pinchScale=this.relationModel.get("V_DEL3DL_Size_X");this.angleScale=this.relationModel.get("V_DEL3DL_Angle");this.updatePosition()},onRender:function(){this.initDom();this.circleMenuCollectionView=new c({circleMenuButtons:this.circleMenuButtons,originDistance:100});this.showChildView("circleMenuViewRegion",this.circleMenuCollectionView);if(h.is(this._onRender)){this._onRender()}},relationDestroyed:function(){},resizeFloatableElement:function(i,j){if(j){this.pinchScale=Number(this.pinchScale)+0.25;this.pinchScale=this.pinchScale>=2.25?2.25:this.pinchScale}else{this.pinchScale=Number(this.pinchScale)-0.25;this.pinchScale=this.pinchScale<=0.5?0.5:this.pinchScale}this._scaleElement(this.pinchScale);this.relationModel.save({V_DEL3DL_Size_X:this.pinchScale})},onGesturableStartCallback:function(){if(h.is(this._ui)&&h.is(this.getUI("scalableArea"))){this.getUI("scalableArea").css("transition","none ")}else{this.$el.css("transition","none")}},onGesturableMoveCallback:function(i){this.pinchScale=(((i.scale-1)/20)+1)*this.pinchScale;this.angleScale=this.angleScale+i.da;this.pinchScale=this.pinchScale>=2.25?2.25:this.pinchScale;this.pinchScale=this.pinchScale<=0.5?0.5:this.pinchScale;this._scaleElement(this.pinchScale,this.angleScale)},onGesturableEndCallback:function(){if(h.is(this._ui)&&h.is(this.getUI("scalableArea"))){this.getUI("scalableArea").css("transition","")}else{this.$el.css("transition","")}this.pinchScale=Math.round(this.pinchScale*25)/25;this.angleScale=Math.round(this.angleScale/30)*30;this._scaleElement(this.pinchScale,this.angleScale);this.relationModel.save({V_DEL3DL_Size_X:this.pinchScale,V_DEL3DL_Angle:this.angleScale})},updatePosition:function(){this.$el.attr({id:this.cid,"data-x":this.relationModel.get("V_DEL3DL_X"),"data-y":this.relationModel.get("V_DEL3DL_Y")});this.$el.css({top:this.relationModel.get("V_DEL3DL_Y")+"%",left:this.relationModel.get("V_DEL3DL_X")+"%"});this._scaleElement(this.relationModel.get("V_DEL3DL_Size_X"),this.relationModel.get("V_DEL3DL_Angle"))},isSelected:function(){return this.selected},selectFloatable:function(){this.selected=true;a.addClass(this.$el,"selected")},unSelectFloatable:function(){this.selected=false;a.removeClass(this.$el,"selected")},enableView:function(l){this.enableLive(l);if(this.enabled!==l){var k=h.is(this._isDraggable)?this._isDraggable():true;var j=h.is(this._isDroppable)?this._isDroppable():true;var i=h.is(this._isDraggable)?this._isDraggable():true;this.triggerMethod("view:activeInteract",l&&k,l&&j,l&&i);this.triggerMethod("view:activeHammer",l,l,false,false,false);if(l){a.addClass(this.$el,"enable")}else{a.removeClass(this.$el,"enable")}this.enabled=l}if(h.is(this._enableView)){this._enableView(l)}},tapEventCallback:function(){this.triggerMethod("FloatableElement:putViewOnTop",this);if(this.enabled){if(this.forcePressEvent===true){this.pressEventCallback()}else{this.circleMenuCollectionView.toggleShowMenu();this._updateCircleMenuActionsAvailability()}}},pressEventCallback:function(){this.triggerMethod("FloatableElement:putViewOnTop",this);this.triggerMethod("FloatableElement:forcePressEvent");this.circleMenuCollectionView.hideMenu();if(this.$el.hasClass("selected")){this.unSelectFloatable()}else{this.selectFloatable()}this.triggerMethod("FloatableElement:selected")},onDragStartCallback:function(){this.triggerMethod("FloatableElement:putViewOnTop",this)},onDragEndCallback:function(i){var j=i.target;this.parent.updateRelation(this,{V_DEL3DL_X:Number(j.getAttribute("data-x")),V_DEL3DL_Y:Number(j.getAttribute("data-y"))})},_scaleElement:function(i,j){if(!h.is(j)){j=this.relationModel.get("V_DEL3DL_Angle")}if(h.is(this._ui)&&h.is(this.getUI("scalableArea"))){if(h.is(j)&&j!==undefined){this.getUI("scalableArea").css("transform","rotate("+j+"deg) scale("+i+")")}else{this.getUI("scalableArea").css("transform","scale("+i+")")}}else{this.$el.css("transform","rotate("+j+"deg) scale("+i+")")}}});return g});define("DS/DEL3DLeanViews/FloatableElements/StickyMemberView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/Behaviors/InteractBehavior","text!DS/DEL3DLeanViews/assets/template/FloatableElements/StickyMemberView.template.html","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/FloatableElements/FloatableElementView","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanHttpRequest/ImageService","css!DS/DEL3DLeanViews/assets/css/FloatableElements/StickyMemberView.css"],function(c,d,i,j,b,e,h,a,g){var f=h.extend({picture:"",hasPicture:false,behaviors:[{behaviorClass:e,usePressEvent:true,useTapEvent:true,isActiveOnRender:false,className:".stickyMemberViewContent"},{behaviorClass:j,isActiveOnRender:false,isGesturable:true,isDraggable:true,enableLive:true,ignoreFrom:".buttonView"}],className:"stickyMemberView",ui:{scalableArea:".stickyMemberViewContent"},childViewEvents:{"circleMenuCollectionView:buttonClick":"onCircleMenuClicked"},circleMenuButtons:[{hasIcon:true,icon:"Floatable/FloatableElementSizeL.svg",actionName:"shrinkFloatableElement"},{hasIcon:true,icon:"Floatable/FloatableElementSizeS.svg",actionName:"enlargeFloatableElement"},{hasIcon:true,icon:"EditStickyNote/Delete.svg",actionName:"deleteFloatableElement"}],template:i.template(b),templateContext:function(){return{picture:this.picture,hasPicture:this.hasPicture}},onCircleMenuClicked:function(k,l){if(l==="shrinkFloatableElement"){this.resizeFloatableElement(k,false)}else{if(l==="enlargeFloatableElement"){this.resizeFloatableElement(k,true)}else{if(l==="deleteFloatableElement"){this.triggerMethod("FloatableElement:delete",this)}}}},deleteStickyMember:function(){this.triggerMethod("FloatableElement:delete",this)},_initialize:function(){var m=this.model.get("V_DEL3DL_People_Name");if(c.is(m)){var k=this;var l=a.PEOPLES.sessionInstance;var n=l.getOrFetch({name:m});if(n){n.getPicture(function(o){k.picture=o;if(k.picture){k.hasPicture=true;k.render()}})}this._peopleName=m}},_updateCircleMenuActionsAvailability:function(){},_onRender:function(){var l=this;var m=this.model.get("V_DEL3DL_People_Name");var k=this.$el.find("img.stickyMemberThumbnail");if(k.attr("src")===""){k.attr("onerror","this.src='"+this.iconPath+"/DefaultPeople.png'");k.attr("src",this.iconPath+"/Loading.svg");g.getUserPicture(m).then(function(n){l.picture=n;l.$el.find("img.stickyMemberThumbnail").attr("src",n)},function(n){l.logger.error("ERROR: %s",n)})}},onDragStartCallback:function(){h.prototype.onDragStartCallback.apply(this,[]);this.$el.attr("data-name",this._peopleName)},onDragEndCallback:function(l){h.prototype.onDragEndCallback.apply(this,[l]);var k=this;setTimeout(function(){k.$el.removeAttr("data-name")},0)}});return f});define("DS/DEL3DLeanViews/FloatableElements/StickerView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/Behaviors/InteractBehavior","text!DS/DEL3DLeanViews/assets/template/FloatableElements/StickerView.template.html","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanViews/FloatableElements/FloatableElementView","css!DS/DEL3DLeanViews/assets/css/FloatableElements/StickerView.css"],function(g,e,h,b,a,f,c){var d=c.extend({behaviors:[{behaviorClass:a,usePressEvent:true,useTapEvent:true,isActiveOnRender:false,className:".stickerViewContent"},{behaviorClass:h,isActiveOnRender:false,isGesturable:true,isDraggable:true,enableLive:true,ignoreFrom:".buttonView"}],className:"stickerView",ui:{scalableArea:".stickerViewContent"},childViewEvents:{"circleMenuCollectionView:buttonClick":"onCircleMenuClicked"},circleMenuButtons:[{hasIcon:true,icon:"Floatable/FloatableElementSizeL.svg",actionName:"shrinkFloatableElement"},{hasIcon:true,icon:"Floatable/FloatableElementSizeS.svg",actionName:"enlargeFloatableElement"},{hasIcon:true,icon:"EditStickyNote/Delete.svg",actionName:"deleteFloatableElement"}],template:e.template(b),onCircleMenuClicked:function(i,j){if(j==="shrinkFloatableElement"){this.resizeFloatableElement(i,false)}else{if(j==="enlargeFloatableElement"){this.resizeFloatableElement(i,true)}else{if(j==="deleteFloatableElement"){this.triggerMethod("FloatableElement:delete",this)}}}},_initialize:function(){},_updateCircleMenuActionsAvailability:function(){},_onRender:function(){g(".stickerViewContent",this.$el).attr("style","background-image: url("+this.iconPath+"/Loading.svg)");f.getImage(this.model.get("V_DEL3DL_Document_PID")).then(g.proxy(function(i){g(".stickerViewContent",this.$el).attr("style","background-image: url("+i+")");this._scaleElement(this.pinchScale)},this))},onDragStartCallback:function(){c.prototype.onDragStartCallback.apply(this,[]);this.$el.attr("data-documentId",this.model.get("V_DEL3DL_Document_PID"))},onDragEndCallback:function(j){c.prototype.onDragEndCallback.apply(this,[j]);var i=this;setTimeout(function(){i.$el.removeAttr("data-documentId")},0)}});return d});define("DS/DEL3DLeanViews/FloatableElements/StickyNoteView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/Logger/Logger","DS/DEL3DLeanViews/Behaviors/InteractBehavior","text!DS/DEL3DLeanViews/assets/template/FloatableElements/StickyNoteView.template.html","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/FloatableElements/FloatableElementView","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanViews/Utils/TaskUtils","css!DS/DEL3DLeanViews/assets/css/FloatableElements/StickyNoteView.css"],function(d,e,k,c,l,b,f,i,a,h,j){var g=i.extend({name:"StickyNoteView",behaviors:[{behaviorClass:f,usePressEvent:true,useTapEvent:true,isActiveOnRender:false,className:".stickyNoteViewContent"},{behaviorClass:l,isDraggable:true,isGesturable:true,isActiveOnRender:false,enableLive:true,ignoreFrom:".buttonView"},{behaviorClass:l,isDroppable:true,isActiveOnRender:false,enableDropAcceptClass:".sidePersonView, .stickyMemberView, .sideStickerView, .stickerView",className:".stickyNoteDropZone"}],regions:{circleMenuViewRegion:{el:".circleMenuView",replaceElement:true},editZoneRegion:{el:".stickyNoteEditZone",replaceElement:true}},extendModelEvents:{"change:V_DEL3DL_Data":"dataUpdated","change:V_DEL3DL_Sketch_Image":"updateContent","change:V_DEL3DL_Background_Color":"updateBackground"},className:"stickyNoteView",childViewEvents:{"circleMenuCollectionView:buttonClick":"onCircleMenuClicked","view:editionFinished":"onEditionFinished","view:editionSaved":"updateContent","view:delete":"onCircleMenuClicked"},circleMenuButtons:[{hasIcon:true,icon:"Floatable/StickyNoteEdit.svg",actionName:"editFloatableElement"},{hasIcon:true,icon:"Floatable/FloatableElementSizeL.svg",actionName:"shrinkFloatableElement"},{hasIcon:true,icon:"Floatable/FloatableElementSizeS.svg",actionName:"enlargeFloatableElement"},{hasIcon:true,icon:"EditStickyNote/Delete.svg",actionName:"deleteFloatableElement",securityTap:true}],ui:{sketch:".postit-sketch",scalableArea:".stickyNoteViewScalable",backgroundColor:"#stickyNoteViewBackground"},template:k.template(b),templateContext:function(){return{get:e.proxy(this.model.get,this.model)}},initialize:function(m){g.__super__.initialize.call(this,m);if(!this._logger){this._logger=c.getLogger(g)}},onAttach:function(){setTimeout(e.proxy(function(){this.autoResizeText(true)},this),0)},dataUpdated:function(o){var m=JSON.parse(o.attributes.V_DEL3DL_Data);var n=JSON.parse(o._previousAttributes.V_DEL3DL_Data);m=d.is(m)?m:{};n=d.is(n)?n:{};if(m.V_DEL3DL_AssignedPersonName!==n.V_DEL3DL_AssignedPersonName){this._updatePeoplePicture(this.model.get("V_DEL3DL_AssignedPersonName"))}if((m.V_DEL3DL_Document_PID!==n.V_DEL3DL_Document_PID)){this._updateStickerPicture(this.model.get("V_DEL3DL_Document_PID"))}this._dataUpdated(o,m,n)},_dataUpdated:function(){var n=this.model.get("V_DEL3DL_Description");var m=e(".stickyNoteDescription",this.$el).first();m.text(n);this.sizeDictionnary={};this.autoResizeText(true)},autoResizeText:function(o){if(!d.is(this.sizeDictionnary)){this.sizeDictionnary={}}var n=e(".stickyNoteDescription",this.$el).first();if(n.text().length===0){n.css("display","none");return}else{n.css("display","block")}if(n.get(0).scrollHeight===0&&o){return}var q=n.get(0).scrollHeight;if(d.is(this.sizeDictionnary[q])){n.css("font-size",this.sizeDictionnary[q]);return}n.css("font-size","");var m=undefined;var p=undefined;while(n.get(0).scrollHeight>n.height()&&(m=n.css("font-size"))&&parseInt(m)>1){if(p===m){this._logger.warn("Bad font size provided by web browser, font resize stopped");break}p=m;n.css("font-size","-=.2")}this.sizeDictionnary[q]=n.css("font-size")},updateContent:function(n,m){if(!d.is(m)){m=this.model.get("V_DEL3DL_Sketch_Image")}if(h.isDataUrl(m)){e(".stickyNoteViewContent",this.$el).css("background-image",'url("'+m+'")')}else{if(m){e(".stickyNoteViewContent",this.$el).css("background-image",'url("'+this.iconPath+'/Loading.svg")');h.getImage(m).then(e.proxy(function(o){e(".stickyNoteViewContent",this.$el).css("background-image",'url("'+o+'")')},this))}}},updateBackground:function(n,m){if(/^[a-f0-9]+$/i.test(m)){this.getUI("backgroundColor").css("background-image",'url("'+this.iconPath+'/Loading.svg")');h.getImage(m).then(e.proxy(function(o){this.getUI("backgroundColor").css("background",'url("'+o+'")')},this))}else{this.getUI("backgroundColor").css("background",m)}},_updatePeoplePicture:function(o){var p=e(".postit-header-peoplePicture",this.$el).first();var n=e(".postit-header-stickerPicture",this.$el).first();var m=e(".postit-header",this.$el);if(!d.is(o)){p.css("display","none")}else{p.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");p.css("display","block");var q=a.PEOPLES.sessionInstance.getOrFetch(o);if(d.is(q)){q.getPicture().then(e.proxy(function(r){p.attr("style","background-image: url("+r+")");p.css("display","block")},this))}else{p.css("display","none")}}if(p.css("display")==="none"&&n.css("display")==="none"){m.css("display","none")}else{m.css("display","block")}},_updateStickerPicture:function(p){var o=e(".postit-header-peoplePicture",this.$el).first();var n=e(".postit-header-stickerPicture",this.$el).first();var m=e(".postit-header",this.$el);if(!d.is(p)){n.css("display","none")}else{n.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");n.css("display","block");h.getImage(p).then(e.proxy(function(q){n.attr("style","background-image: url("+q+")");n.css("display","block")},this))}if(o.css("display")==="none"&&n.css("display")==="none"){m.css("display","none")}else{m.css("display","block")}},_updateInformations:function(){var n=e(".postit-info-status",this.$el).first();var m=e(".postit-info",this.$el);n.css("display","none");if(n.css("display")==="none"&&n.css("display")==="none"){m.css("display","none")}else{m.css("display","block")}},_updateCircleMenuActionsAvailability:function(){},editStickyNote:function(){if(d.is(this._editStickyNoteView)){return}if(d.is(this.circleMenuCollectionView)){this.circleMenuCollectionView.hideMenu()}this.enableView(false);this.$el.addClass("editing");this._editStickyNote()},closeStickyNoteEdit:function(){if(!d.is(this._editStickyNoteView)){return}this._editStickyNoteView.destroy();this._editStickyNoteView=null;this.$el.removeClass("editing");this._closeStickyNoteEdit()},isEditing:function(){return d.is(this._editStickyNoteView)},onCircleMenuClicked:function(m,n){if(n==="shrinkFloatableElement"){this.resizeFloatableElement(m,false)}else{if(n==="enlargeFloatableElement"){this.resizeFloatableElement(m,true)}else{if(n==="deleteFloatableElement"){this.triggerMethod("FloatableElement:delete",this)}else{if(n==="editFloatableElement"){this.editStickyNote()}}}}},onEditionFinished:function(){this.closeStickyNoteEdit();setTimeout(e.proxy(function(){this.enableView(true)},this),0)},onDragEnterCallback:function(n){var m=n.relatedTarget;e(m).stop(true,true).fadeTo(200,0.5);this._scaleElement(parseFloat(this.pinchScale)+0.1)},onDragLeaveCallback:function(n){var m=n.relatedTarget;e(m).stop(true,true).fadeTo(200,1);this._scaleElement(this.pinchScale)},onDropCallback:function(o){var m=o.relatedTarget;if(e(m).hasClass("sideStickerView")||e(m).hasClass("stickerView")){var n=o.relatedTarget.getAttribute("data-documentId");this.model.assignSticker(n)}else{var p=o.relatedTarget.getAttribute("data-name");this.model.assignPeople(p,a,j)}this._scaleElement(this.pinchScale);if(e(m).hasClass("stickyMemberView")||e(m).hasClass("stickerView")){e(m).fadeTo(200,0);this.trigger("FloatableElement:deleteId",m.id)}else{e(m).fadeTo(200,1)}},_enableView:function(m){if(!m){this.closeStickyNoteEdit()}},_onRender:function(){this._updatePeoplePicture(this.model.get("V_DEL3DL_AssignedPersonName"));this._updateStickerPicture(this.model.get("V_DEL3DL_Document_PID"));this._updateInformations();this.updateContent(this.model,this.model.get("V_DEL3DL_Sketch_Image"));this.updateBackground(this.model,this.model.get("V_DEL3DL_Background_Color"))}});return g});define("DS/DEL3DLeanViews/EditSticky/EditContextView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Utils/TaskUtils","DS/DEL3DLeanViews/Utils/IssueUtils","DS/DEL3DLeanViews/Components/ButtonView","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditContextView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditContextView.css"],function(g,k,j,b,e,c,h,l,a,i,d){var f=j.View.extend({iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"editContextView",ui:{},behaviors:[{behaviorClass:h,usePressEvent:true,useTapEvent:true,isActiveOnRender:false,className:".editContextViewImage"}],regions:{uploadDocumentRegion:".uploadButton",zoomDocumentRegion:".zoomButton",plusRegion:".plusButton"},template:k.template(d),templateContext:function(){return{get:g.proxy(this.model.get,this.model),getNLS:g.proxy(c.getTranslation,c)}},constructor:function f(){j.View.prototype.constructor.apply(this,arguments)},initialize:function(){this._logger=b.getLogger(f);this.openPanelDelegate=g.proxy(this.openPanel,this);this.zoomDocumentDelegate=g.proxy(this.zoomDocument,this);this.uploadDocumentButtonView=new i({icon:"Sketch/ImageChooser.svg",actionName:"updateDocument",callback:this.openPanelDelegate});this.zoomDocumentButtonView=new i({icon:"Unused/FloatableElementSizeM2.svg",actionName:"zoomDocument",callback:this.zoomDocumentDelegate});this.plusButtonView=new i({icon:"CreatePage.svg",actionName:"updateDocument",callback:this.openPanelDelegate})},zoomDocument:function(){if(this.model.get("V_DEL3DL_Has_Context")){g(".editStickyViewMaxLeftContent").toggle()}},openPanel:function(){this.imageInput.trigger("click")},updateDocument:function(m){if(this.model.isAction()){l.addContextCapture(m,this.model)}else{a.addContextCapture(m,this.model)}this.model.save({V_DEL3DL_Has_Context:true});g(".plusButton",this.$el).css("display","none");g(".plusLabel",this.$el).css("display","none");g(".uploadButton",this.$el).css("display","block");g(".zoomButton",this.$el).css("display","block");g(".editContextViewImage",this.$el).attr("src",m)},initUploadInput:function(){if(g("#editContextImageUpload."+this.cid).length===0){this.imageInput=g(document.createElement("input"));this.imageInput.attr("type","file");this.imageInput.attr("accept","image/*");this.imageInput.attr("id","editContextImageUpload."+this.cid);this.imageInput.context.onchange=g.proxy(function(){var m;var o=g.proxy(function(){this.updateDocument(m.result)},this);var n=this.imageInput.context.files[0];var p=new RegExp("^image/");if(n&&n.type.match(p)){m=new FileReader();m.addEventListener("load",o,false);m.readAsDataURL(n)}},this)}},onRender:function(){var n=this;n.initUploadInput();if(n.model.get("V_DEL3DL_Has_Context")){g(".plusButton",n.$el).css("display","none");g(".plusLabel",n.$el).css("display","none");g(".uploadButton",n.$el).css("display","block");g(".zoomButton",n.$el).css("display","block");var m=function(){};var o=function(p){p.then(function(q){g(".editContextViewImage",n.$el).attr("src",q)})};if(n.model.isAction()){l.getContextCapture(n.model,o,m)}else{a.getContextCapture(n.model,o,m)}}if(n.model.isEditable()){n.showChildView("uploadDocumentRegion",n.uploadDocumentButtonView);n.showChildView("plusRegion",n.plusButtonView)}else{g(".plusButton",n.$el).css("display","none");g(".uploadButton",n.$el).css("display","none");g(".plusLabel",n.$el).css("display","none")}n.showChildView("zoomDocumentRegion",n.zoomDocumentButtonView)},onAttach:function(){this.triggerMethod("view:activeHammer",true,true,false,false,false)},onBeforeDetach:function(){this.triggerMethod("view:activeHammer",false,false,false,false,false);if(g(".editStickyViewMaxLeftContent").css("display")==="none"){g(".editStickyViewMaxLeftContent").toggle()}},pressEventCallback:function(m){this.tapEventCallback(m)},tapEventCallback:function(){g(".editStickyViewMaxLeftContent").toggle()}});return f});define("DS/DEL3DLeanViews/EditSticky/EditStickyViewMax",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Behaviors/HammerBehavior","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditStickyViewMax.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditStickyViewMax.css"],function(d,h,g,j,c,b,f,e,i){var a=g.View.extend({iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"editStickyViewMax",ui:{},behaviors:[{behaviorClass:e,usePressEvent:true,useTapEvent:true,enableTapEvent:true,enablePressEvent:true,className:".modalLeanget"}],regions:{dataTabRegion:{selector:".editStickyViewMaxTabElement.data",replaceElement:true},leftContent:".editStickyViewMaxLeftContent",rightContent:".editStickyViewMaxRightContent",close:".editStickyViewMaxClose"},sideBarRadio:j.channel("sidebar"),thumbnailActionCollectionRadio:j.channel("thumbnailActionCollection"),template:h.template(i),templateContext:function(){return{tabs:["data"]}},initialize:function(){this.$el.attr({id:this.cid});this.onDataTabDelegate=d.proxy(this.onDataTab,this);this.onCloseDelegate=d.proxy(this.onClose,this);this.dataTabButtonView=new f({mode:"radio",checked:true,title:b.getTranslation("editIssueDataTab"),callback:this.onDataTabDelegate});this.closeButton=new f({icon:"Infra/SideBarActionCloseBlack.svg",actionName:"editStickyViewMaxClose",callback:this.onCloseDelegate})},onRender:function(){this.showChildView("leftContent",this.editDataView);this.showChildView("dataTabRegion",this.dataTabButtonView);this.showChildView("close",this.closeButton)},onClose:function(){d(".editStickyViewMaxViewWrapper",this.$el).addClass("onEditStickyViewMaxClose");setTimeout(d.proxy(function(){this.triggerMethod("view:editionFinished")},this),100)},onDataTab:function(){this.showDataTab()},showDataTab:function(){if(!this.dataTabButtonView.getChecked()){this.dataTabButtonView.setChecked(true)}},pressEventCallback:function(){this.onClose()},tapEventCallback:function(){this.onClose()}});return a});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SizeView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanViews/Components/ButtonView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/SizeView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/SizeView.css"],function(e,f,k,j,h,b,g,l,d,c,a,m){var i=h.View.extend({className:"sizeView",leangetTitle:"",iconPath:d.getWebappsAssetUrl("DEL3DLeanViews","icons"),template:k.template(m),templateContext:function(){return{leangetTitle:e.is(this.leangetTitle)&&this.leangetTitle!=="null"?this.leangetTitle:"",iconPath:this.iconPath,getNLS:f.proxy(c.getTranslation,c)}},childViewEvents:{"buttonView:clicked":"onSizeViewButtonClicked"},regions:{deleteLeangetButtonRegion:".deleteLeanget",size1LeangetButtonRegion:".size1LeangetButton",size2LeangetButtonRegion:".size2LeangetButton",size3LeangetButtonRegion:".size3LeangetButton",size4LeangetButtonRegion:".size4LeangetButton"},staticRadioChannel:l.channel("static"),initialize:function(n){h.View.prototype.initialize.apply(this,[n]);this.deleteLeangetButtonView=new g({icon:"Remove.svg",mode:"checkbox",iconChecked:"RemoveConfirm.svg",actionName:"DeleteLeanget",manualyCheck:true});this.size1LeangetButtonView=new g({title:"",actionName:"SIZE1",callback:f.proxy(this.onChangeSizeButtonClicked,this)});this.size2LeangetButtonView=new g({icon:"Infra/Expand.svg",title:"",actionName:"SIZE2",callback:f.proxy(this.onChangeSizeButtonClicked,this)});this.size3LeangetButtonView=new g({icon:"Infra/Expand.svg",title:"",actionName:"SIZE3",callback:f.proxy(this.onChangeSizeButtonClicked,this)});this.size4LeangetButtonView=new g({icon:"Infra/Expand.svg",title:"",actionName:"SIZE4",callback:f.proxy(this.onChangeSizeButtonClicked,this)});this.parentView=n.parentView;this.leangetTitle=n.leangetTitle;var o=b.getFromConstructor(n.parentView.relationModel.constructor);if(o.clientType===b.COORD.clientType){var q=n.parentView.relationModel.attributes.V_DEL3DL_Size_X;var p=n.parentView.relationModel.attributes.V_DEL3DL_Size_Y;if(q<=1&&p<=1){a.addClass(this.$el,"SIZE1_SELECTED")}else{if(q>=2&&p<=1){a.addClass(this.$el,"SIZE2_SELECTED")}else{if(q<=1&&p>=2){a.addClass(this.$el,"SIZE3_SELECTED")}else{if(q>=2&&p>=2){a.addClass(this.$el,"SIZE4_SELECTED")}}}}}},onRender:function(){this.showChildView("deleteLeangetButtonRegion",this.deleteLeangetButtonView);if(this.parentView._getParentStaticView().className!=="mapView"){setTimeout(f.proxy(function(){f(".size_SizeSelectorContainer",this.$el).show().css("display","flex");this.showChildView("size1LeangetButtonRegion",this.size1LeangetButtonView);this.showChildView("size2LeangetButtonRegion",this.size2LeangetButtonView);this.showChildView("size3LeangetButtonRegion",this.size3LeangetButtonView);this.showChildView("size4LeangetButtonRegion",this.size4LeangetButtonView)},this),0)}setTimeout(f.proxy(function(){f(".sizeViewTitleContainer",this.$el).show()},this),0)},onSizeViewButtonClicked:function(o,n){if(n==="DeleteLeanget"){if(this.deleteLeangetButtonView.getChecked()){this.staticRadioChannel.trigger("staticCollection:delete",this.parentView)}else{this.deleteLeangetButtonView.set("checked",true);a.addClass(f(".deleteLeangetConfirmation",this.$el),"visible");setTimeout(f.proxy(function(){this.deleteLeangetButtonView.set("checked",false);a.removeClass(f(".deleteLeangetConfirmation",this.$el),"visible")},this),3500)}}},onBeforeDetach:function(){var n=this.parentView.model.attributes.V_DEL3DL_Title;n=n===null||n==="null"?"":n;if(n!==f(".sizeViewTitleContainer",this.$el).val()){n=f(".sizeViewTitleContainer",this.$el).val();this.parentView.model.save({V_DEL3DL_Title:n})}},onAttach:function(){var n=this.parentView.model.attributes.V_DEL3DL_Title;f(".sizeViewTitleContainer",this.$el).val(e.is(n)&&n!==null&&n!=="null"?n:"")},onChangeSizeButtonClicked:function(q,p){var o;var n;a.removeClass(this.$el,["SIZE1_SELECTED","SIZE2_SELECTED","SIZE3_SELECTED","SIZE4_SELECTED"]);if(p==="SIZE1"){o=1;n=1;a.addClass(this.$el,"SIZE1_SELECTED")}else{if(p==="SIZE2"){o=1;n=2;a.addClass(this.$el,"SIZE3_SELECTED")}else{if(p==="SIZE3"){o=2;n=1;a.addClass(this.$el,"SIZE2_SELECTED")}else{if(p==="SIZE4"){o=2;n=2;a.addClass(this.$el,"SIZE4_SELECTED")}}}}this.staticRadioChannel.trigger("staticCollection:changeSize",this.parentView,o,n)},setSize:function(o,n){a.removeClass(this.$el,["SIZE1_SELECTED","SIZE2_SELECTED","SIZE3_SELECTED","SIZE4_SELECTED"]);if(o>1&&n>1){a.addClass(this.$el,"SIZE4_SELECTED")}else{if(o>1){a.addClass(this.$el,"SIZE2_SELECTED")}else{if(n>1){a.addClass(this.$el,"SIZE3_SELECTED")}else{a.addClass(this.$el,"SIZE1_SELECTED")}}}}});return i});define("DS/DEL3DLeanViews/StaticViews/PageView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/StaticView","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/StaticViews/InfraViews/SizeView","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/Statics/PageView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/PageView.css","css!DS/DEL3DLeanViews/assets/css/Statics/SwipeView.css"],function(f,i,m,g,a,h,n,k,l,d,c,e){var b=g.extend({className:"pageView",template:m.template(e),regions:function(){return m.extend(g.prototype.regions,{sizeRegion:".pageSizeContainer"})},behaviors:[{behaviorClass:k,isActiveOnRender:false,useTapEvent:true,useSwipeEvent:true,usePressEvent:true,usePinchEvent:true,pinchPointers:3,pinchThreshold:0.6},{behaviorClass:n,isActiveOnRender:false,isDraggable:true}],extendModelEvents:{"change:V_DEL3DL_Title":"refreshView"},_initialize:function(){this.staticCollectionView=a.createView(this.collectionViewsEnum.PAGESTATICCOLLECTIONVIEW,{collection:h.getStaticsRelationsFrom(this.model.id),collectionViewsEnum:this.collectionViewsEnum,staticViewModel:this.model,parent:this});this.floatableCollectionView=a.createView(this.collectionViewsEnum.FLOATABLECOLLECTIONVIEW,{collection:h.getFloatablesRelationsFrom(this.model.id),collectionViewsEnum:this.collectionViewsEnum,staticViewModel:this.model,parent:this});this.setLayoutEditableDelegate=i.proxy(this.setLayoutEditable,this);this.onSwipeDelegate=i.proxy(this.swipeEventCallback,this);this.sizeView=a.createView(l,{parentView:this,leangetTitle:d.getTranslation(this.model.get("type"))})},_bindEvents:function(){},_unBindEvents:function(){},_onRender:function(){this.showChildView("staticRegion",this.staticCollectionView);this.showChildView("floatableRegion",this.floatableCollectionView);this.floatableCollectionView.$el.addClass("pageFloatableCollectionView")},_meetingPreparation:function(o){if(!this.focused&&!this.focusable){return}if(o){this.sideBarRadioChannel.once("sideView:after:openPanel",i.proxy(function(){c.removeClass(this.floatableCollectionView.$el,"meetingPreparationTransition")},this))}else{this.sideBarRadioChannel.once("sideView:after:closePanel",i.proxy(function(){c.removeClass(this.floatableCollectionView.$el,"meetingPreparationTransition")},this))}c.addClass(this.floatableCollectionView.$el,"meetingPreparationTransition")},_toolsOpen:function(o){if(!this.focused&&!this.focusable){return}if(o){this.sideBarRadioChannel.once("sideView:after:openPanel",i.proxy(function(){c.removeClass(this.floatableCollectionView.$el,"toolsTransition")},this))}else{this.sideBarRadioChannel.once("sideView:after:closePanel",i.proxy(function(){c.removeClass(this.floatableCollectionView.$el,"toolsTransition")},this))}c.addClass(this.floatableCollectionView.$el,"toolsTransition")},_layoutEditable:function(){c.addClass(this.$el,"customizeMenuOpened");this.staticCollectionView.layoutEditable(true);this.floatableCollectionView.layoutEditable(true)},_layoutUneditable:function(){this.sideBarRadioChannel.once("sideView:after:closePanel",i.proxy(function(){c.removeClass(this.$el,"customizeMenuOpened");this.floatableCollectionView.layoutEditable(false)},this));this.staticCollectionView.layoutEditable(false)},_positionEditable:function(){this.setFocusable(false);c.addClass(this.$el,"customized");this.triggerMethod("view:activeInteract",true,true,false);this.showChildView("sizeRegion",this.sizeView)},_positionUneditable:function(){this.detachChildView("sizeRegion");this.triggerMethod("view:activeInteract",false,false,false);c.removeClass(this.$el,"customized");this.setFocusable(true)},_focusable:function(){c.addClass(this.$el,"focusable");this.triggerMethod("view:activeHammer",true,true,false,false,false)},_unfocusable:function(){c.removeClass(this.$el,"focusable");this.triggerMethod("view:activeHammer",false,false,false,false,false)},_unfocus:function(o){if(f.is(o.focusView)&&m.contains(this.staticCollectionView.children._views,o.focusView)){this.showOverlay();this.staticRadioChannel.once("after:focus",i.proxy(function(){this.setFocusable(true);c.addClass(this.$el,"hideUnfocusedSN")},this))}this.staticCollectionView.focus(false);this.floatableCollectionView.focus(false);this.sideBarRadioChannel.off("sideBarView:customize",this.setLayoutEditableDelegate);this.sideBarRadioChannel.off("sideBarView:navigate",this.onSwipeDelegate);this.triggerMethod("view:activeHammer",false,false,false,false,false);c.removeClass(this.$el,"focused");c.removeClass(i(".sideView"),"pageFocused")},_focus:function(){this.staticRadioChannel.once("after:focus",i.proxy(function(){if(!f.is(this.pageSketchesRefreshed)||this.pageSketchesRefreshed===false){this.pageSketchesRefreshed=true;this.staticCollectionView.refreshSketches()}this.triggerMethod("view:activeHammer",false,false,true,false,true)},this));this.setFocusable(false);this.staticCollectionView.focus(true);this.floatableCollectionView.focus(true);this.sideBarRadioChannel.on("sideBarView:customize",this.setLayoutEditableDelegate);this.sideBarRadioChannel.on("sideBarView:navigate",this.onSwipeDelegate);c.addClass(this.$el,"focused");c.addClass(i(".sideView"),"pageFocused")},_socketMeetingFocus:function(){this.staticRadioChannel.trigger("static:focusView",this)},_minimize:function(o){if(f.is(o.focusView)&&o.focusView===this){return}if(f.is(o.focusView)&&m.contains(this.staticCollectionView.children._views,o.focusView)){this.staticRadioChannel.once("before:minimize",i.proxy(this._minimize,this));this.uiRadioChannel.trigger("after:minimizeTransition");this.maximized=true;return}if(f.is(o.focusView)&&!this.isOnSwipe){c.addClass(this.$el,"pageWithoutTransition");c.addClass(this.$el,"forcePageIndex");this.uiRadioChannel.once("after:minimizeTransition",i.proxy(function(){c.removeClass(this.$el,"minMaxTransition");c.removeClass(this.$el,"pageWithoutTransition");c.removeClass(this.$el,"forcePageIndex")},this));c.addClass(this.$el,"minMaxTransition")}this.maximized=false;if(this.isOnSwipe){this.uiRadioChannel.trigger("before:minimizeTransition");c.removeClass(this.$el,"maximize");if(f.is(o.focusView)&&!this.isOnSwipe){c.removeClass(i(".mapView"),"childFixed")}this.uiRadioChannel.trigger("after:minimizeTransition")}else{c.removeClassWithTransition(this.$el,"maximize","minimizeTransition");if(f.is(o.focusView)&&!this.isOnSwipe){c.removeClass(i(".mapView"),"childFixed")}}},_maximize:function(){this.uiRadioChannel.once("after:maximizeTransition",i.proxy(function(){c.removeClass(this.$el,"minMaxTransition");c.addClass(i(".mapView"),"childFixed")},this));c.addClass(this.$el,"minMaxTransition");if(this.isOnSwipe||this.maximized){this.uiRadioChannel.trigger("before:maximizeTransition");c.addClass(this.$el,"maximize");this.uiRadioChannel.trigger("after:maximizeTransition")}else{c.addClassWithTransition(this.$el,"maximize","maximizeTransition")}},showOverlay:function(){c.addClass(i(".overlay",this.$el),"on");this.staticRadioChannel.once("before:focus",i.proxy(function(){c.removeClass(i(".overlay",this.$el),"on")},this))},pressEventCallback:function(o){this.tapEventCallback(o)},tapEventCallback:function(q){if(f.getGlobal().inMeeting&&!f.getGlobal().isMeetingLeader){return}var p=this;var o=p._getViewElement(q.target);if(f.is(o)&&o.id===p.cid){if(p.$el.hasClass("customizeMenuOpened")){p.sideBarRadioChannel.once("sideView:after:closePanel",function(){p.staticRadioChannel.trigger("static:focusView",p)});p.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}else{p.staticRadioChannel.trigger("static:focusView",p)}}},pinchInEventCallback:function(){this.sideBarRadioChannel.trigger("sideBarView:openMap")},swipeEventCallback:function(o){if(this.staticCollectionView.isLayoutEditable||i(o.target).hasClass("stickerViewContent")===true||i(o.target).hasClass("stickyNoteViewContent")===true||i(o.target).hasClass("stickyMemberThumbnail")===true||i(".mainView").hasClass("onSwipe")||this.positionEditable===true||this.meetingPreparation===true){return}this.trigger("staticView:swipe",{child:this,event:o})},refreshView:function(){if(this.model.has("V_DEL3DL_Title")){i(".pageName",this.$el).html(this.model.get("V_DEL3DL_Title"))}else{i(".pageName",this.$el).html(d.getTranslation(this.model.get("type")))}},setFocus:function j(o){this.callParent(b.__super__,"setFocus",[o]);if(o===true){widget.setTitle(this.getTitle())}}});return b});define("DS/DEL3DLeanViews/Components/SketchControlsView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/AView","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Components/CircleMenuCollectionView","text!DS/DEL3DLeanViews/assets/template/Components/SketchControlsView.template.html","css!DS/DEL3DLeanViews/assets/css/Components/SketchControlsView.css"],function(k,h,A,v,x,e,w,p,u,o){var z=v.extend({name:"SketchControlsView",className:"sketchControls",template:A.template(o),_logger:null,regions:{pen:{selector:".sketchControlPen",replaceElement:true},color:{selector:".sketchControlColor",replaceElement:true},erase:{selector:".sketchControlErase",replaceElement:true},clear:{selector:".sketchControlClear",replaceElement:true},undo:{selector:".sketchControlUndo",replaceElement:true},redo:{selector:".sketchControlRedo",replaceElement:true},image:{selector:".sketchControlImage",replaceElement:true},showHide:{selector:".sketchShowHide",replaceElement:true}},color:"Black",colorButtons:[{hasIcon:false,title:"",actionName:"penColorBlack"},{hasIcon:false,title:"",actionName:"penColorRed"},{hasIcon:false,title:"",actionName:"penColorOrange"},{hasIcon:false,title:"",actionName:"penColorYellow"},{hasIcon:false,title:"",actionName:"penColorBlue"},{hasIcon:false,title:"",actionName:"penColorGreen"}],iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),initialize:function a(C){this.callParent(z.__super__,"initialize",[C]);this._logger=x.getLogger(z);this._parent=this.getOption("parent");this.setSketchComponent(this.getOption("sketch"));this.onSketchDrawEndDelegate=h.proxy(this.onSketchDrawEnd,this)},setSketchComponent:function f(C){this.sketch=C},getSketchComponent:function n(){return this.sketch},showColorPicker:function(){this.colorBtn.showMenu()},hideColorPicker:function(){this.colorBtn.hideMenu()},onAttach:function c(){this.bind();this.enableLive(true);this._attachButtons();this._updateUndoRedo()},onDetach:function g(){this.unbind();this.enableLive(false);this._detachButtons()},onRender:function j(){},onDestroy:function m(){this.unbind()},bind:function B(){this.sketch.on("sketch:draw:end",this.onSketchDrawEndDelegate)},unbind:function i(){this.sketch.off("sketch:draw:end",this.onSketchDrawEndDelegate)},onCircleButton:function l(C,D){if(D.indexOf("penColor")>-1){this.onColorPicker(C)}else{this.onImagePicker(C,D)}},onColorPicker:function t(D){var G=D.$el.attr("class");var E=new RegExp("penColor(\\w+)");var C=E.exec(G);if(C&&C.length>1){this.penButtonView.$el.removeClass(this.color);this.color=C[1];this.penBtn.$el.addClass(this.color);this.penBtn.set("iconChecked","Sketch/Pen"+this.color+".svg");var F=D.$el.css("backgroundColor");this.sketch.setColor(this._toHexaColor(F))}this.hideColorPicker()},onPen:function d(){if(this.sketch&&this.penBtn.getChecked()){if(this.sketch.isPenEnabled()){}else{this.sketch.enablePen();this.penBtn.$el.addClass(this.color);this.penBtn.set("iconChecked","Sketch/Pen"+this.color+".svg")}}},onErase:function q(){if(this.sketch&&this.eraseBtn.getChecked()){this.hideColorPicker();this.sketch.enableErase()}},onClear:function(C){this.liveIt("onClear",arguments,{args:[this.getLiveId()]});this._undoRedoCall("clear",C)},onUndo:function(C){this.liveIt("onUndo",arguments,{args:[this.getLiveId()]});this._undoRedoCall("undo",C)},onRedo:function(C){this.liveIt("onRedo",arguments,{args:[this.getLiveId()]});this._undoRedoCall("redo",C)},onSketchDrawEnd:function(){this._updateUndoRedo()},_updateUndoRedo:function y(){this.undoBtn.setEnabled(this.sketch.hasUndo());this.redoBtn.setEnabled(this.sketch.hasRedo())},_undoRedoCall:function(D,C){if(this.sketch){C=A.isObject(C)||!k.is(C)?this.getLiveId():C;this.sketch[D](C);this._updateUndoRedo()}},onShowHide:function(C){C=k.is(C,"boolean")?C:this.showHideBtn.getChecked();this.showHideBtn.setChecked(C);this.liveIt("onShowHide",arguments,{args:[C]});if(C){w.addClass(this._parent.floatableCollectionView.$el,"onCaptureContext")}else{w.removeClass(this._parent.floatableCollectionView.$el,"onCaptureContext")}},_createButtons:function r(){this.penBtn=new p({mode:"radio",checked:true,icon:"Sketch/StickyNotePenUnselected.svg",iconChecked:"Sketch/Pen"+this.color+".svg",callback:this.onPen.bind(this),actionName:"sketchPen"});this.colorBtn=new u({circleMenuButtons:this.colorButtons,originRadius:0});this.eraseBtn=new p({mode:"radio",icon:"Sketch/StickyNoteEraseUnselected.svg",iconChecked:"Sketch/StickyNoteEraseDark.svg",callback:this.onErase.bind(this)});this.clearBtn=new p({icon:"Sketch/StickyNoteDeleteDark.svg",actionName:"sketchRemoveAll",callback:this.onClear.bind(this)});this.undoBtn=new p({icon:"Sketch/Undo.svg",callback:this.onUndo.bind(this)});this.redoBtn=new p({icon:"Sketch/Redo.svg",callback:this.onRedo.bind(this)});this.showHideBtn=new p({icon:"Sketch/ShowFlo.svg",iconChecked:"Sketch/HideFlo.svg",actionName:"captureShowHideFlo",mode:"checkbox",callback:this.onShowHide.bind(this)})},_attachButtons:function s(){this._createButtons();this.showChildView("pen",this.penBtn);this.showChildView("color",this.colorBtn);this.showChildView("erase",this.eraseBtn);this.showChildView("clear",this.clearBtn);this.showChildView("undo",this.undoBtn);this.showChildView("redo",this.redoBtn);this.showChildView("showHide",this.showHideBtn)},_detachButtons:function b(){this.detachChildView("pen",this.penBtn);this.detachChildView("color",this.colorBtn);this.detachChildView("erase",this.eraseBtn);this.detachChildView("clear",this.clearBtn);this.detachChildView("undo",this.undoBtn);this.detachChildView("redo",this.redoBtn);this.detachChildView("showHide",this.showHideBtn);this.penBtn.destroy();this.colorBtn.destroy();this.eraseBtn.destroy();this.clearBtn.destroy();this.undoBtn.destroy();this.redoBtn.destroy();this.showHideBtn.destroy()}});return z});define("DS/DEL3DLeanViews/StaticViews/InfraView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","pluginDS!DS/VEN3DLeanHTML2CanvasJS/HTML2CanvasJS.1.0.0.a12/html2canvas.min","DS/DEL3DLeanViews/StaticViews/StaticView","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/CoachMarkView","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","DS/DEL3DLeanViews/StaticViews/InfraViews/SizeView","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Components/ButtonModel","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanHttpRequest/LinkGenerator","DS/DEL3DLeanViews/Components/SketchComponent","DS/DEL3DLeanViews/Components/SketchControlsView","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Utils/TaskUtils","DS/DEL3DLeanViews/Utils/IssueUtils","text!DS/DEL3DLeanViews/assets/template/Statics/InfraView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/InfraView.css","css!DS/DEL3DLeanViews/assets/css/Statics/SwipeView.css"],function(e,B,L,r,o,y,M,G,m,F,u,a,c,v,z,t,h,d,C,E,D,p,k){var g=y.extend({leangetConstructor:null,name:"InfraView",className:"infraView",template:L.template(k),buttonsVisible:false,isOnSwipe:false,_lGlobal:e.getGlobal(),behaviors:[{behaviorClass:G,isActiveOnRender:false,useTapEvent:true,usePressEvent:true,useSwipeEvent:true},{behaviorClass:M,isActiveOnRender:false,isDraggable:true}],ui:{infraSketchContainer:".infraSketchContainer"},regions:function(){return L.extend(y.prototype.regions,{settingsRegion:".infraSettingsContainer",coachMarkRegion:".infraCoachMarkContainer",sizeRegion:".infraSizeContainer",leangetContainerRegion:".infraLeangetContainer",closeButtonRegion:".infraClose",reloadButtonRegion:".infraReload",reorderButtonRegion:".infraReorder",contextualMenuButtonRegion:".infraContextualMenu",captureButtonRegion:".infraCapture",activeSketchButtonRegion:".infraActiveSketch",titleRegion:".infraTitle",headerRegion:".infraHeader",templateRegion:".infraTemplate",captureContextValidation:".captureContextValidation",captureCancelRegion:".captureCancel",sketchControlsRegion:".infraSketchControls",castContentButtonRegion:".infraCastContent",zoomOutButtonViewRegion:".infraZoomOut",zoomInButtonViewRegion:".infraZoomIn"})},extendModelEvents:{"change:V_DEL3DL_Title":"render"},infraRadioChannel:r.channel("infra"),meetingRadioChannel:r.channel("meeting"),_initialize:function(){this.floatableCollectionView=m.createView(this.collectionViewsEnum.FLOATABLECOLLECTIONVIEW,{collection:E.getFloatablesRelationsFrom(this.model.id),collectionViewsEnum:this.collectionViewsEnum,staticViewModel:this.model,parent:this});this.leangetConstructor=this.getOption("leangetConstructor");this.onSwipeDelegate=B.proxy(this.swipeEventCallback,this);this.setSettingsEditableDelegate=B.proxy(this.setSettingsEditable,this);this.resizeDelegate=B.proxy(this.onResize,this);this.onSketchLiveDelegate=B.proxy(this.onSketchLive,this);this.sizeView=m.createView(a,{parentView:this,leangetTitle:z.getTranslation(this.model.get("type"))});this.leangetView=m.createView(this.leangetConstructor,B.extend(this.options,{parentView:this}));this.settingsView=this.leangetView.settingsView||m.createView(u,{model:this.model});this.coachMarkView=this.leangetView.coachMarkView||m.createView(F,{model:this.model,parentView:this});this.sketchControlsView=new d({parent:this,model:this.model})},_bindEvents:function(){},_unBindEvents:function(){},onResize:function(){this.sketch.resize()},createAndShowCaptureButtons:function(){var N=this;this.captureValidationButton=new c({model:new v({icon:"Infra/ButtonCapture.svg",actionName:"captureContext",callback:N.onCaptureValidation.bind(N)})});this.captureCancelButton=new c({model:new v({icon:"Infra/ButtonCross.svg",actionName:"captureCancel",callback:N.onCaptureCancel.bind(N)})});this.showChildView("captureContextValidation",this.captureValidationButton);this.showChildView("captureCancelRegion",this.captureCancelButton)},detachAndDestroyCaptureButtons:function(){if(e.is(this.captureValidationButton)&&e.is(this.captureCancelButton)){this.detachChildView("captureContextValidation",this.captureValidationButton);this.detachChildView("captureCancelRegion",this.captureCancelButton);this.captureValidationButton.destroy();this.captureCancelButton.destroy()}},onChildviewCaptureContext:function(N){this.captureFloatable=N;C.addClass(this.captureFloatable.$el,"floatableContext");this.onCapture()},onCastContent:function(){if(this.leangetView.canCapture()){this.leangetView.onCastContent(this.castContentButtonView.getChecked())}else{this.castContentButtonView.setChecked(false);this.$el.addClass("onCaptureError");setTimeout(B.proxy(function(){this.$el.removeClass("onCaptureError")},this),250)}},switchToolbarSketch:function(){if(e.is(this.leangetView.onBeforeCapture)&&e.is(this.leangetView.onAfterCapture)){if(!this.sketchButtonView.getChecked()){this.onCaptureCancel()}else{this.onCapture()}}else{if(!this.sketchButtonView.getChecked()){this.hideSketch()}else{this.showSketch()}}this.leangetView.switchToolbarSketch()},onSketchLive:function J(){if(e.is(this.sketch)&&!this.liveIt("onSketchLive",arguments)){this.sketch[arguments[0]].apply(this.sketch,Object.values(arguments).slice(1))}},onCapture:function l(){if(e.getGlobal().inMeeting){this.liveIt("onCapture",arguments)}this.sketchButtonView.setChecked(true);this.showSketch();this.createAndShowCaptureButtons()},onCaptureValidation:function(){var N=this;if(N.leangetView.canCapture()){C.addClass(N.$el,"screenshot");C.addClass(B(".mainView"),"onScreenshot");N.detachChildView("sketchControlsRegion",N.sketchControlsView);N.detachAndDestroyCaptureButtons();setTimeout(function(){N._generateScreenCapture()},150)}else{N.$el.addClass("onCaptureError");setTimeout(function(){N.$el.removeClass("onCaptureError");N.onCaptureCancel()},250)}},onCaptureCancel:function(){if(e.getGlobal().inMeeting){this.liveIt("liveOnCaptureCancel")}this.liveOnCaptureCancel()},liveOnCaptureCancel:function(){this.detachAndDestroyCaptureButtons();this.hideCapture()},hideCapture:function(){this.hideSketch();if(e.is(this.captureFloatable)){C.removeClass(this.captureFloatable.$el,"floatableContext");this.captureFloatable=null}C.removeClass(this.floatableCollectionView.$el,"onCaptureContext")},_generateScreenCapture:function q(){var O=this;var N=t.getSwymUrl();var P;if(!e.is(N)){P=O.leangetView.isSameOrigin("https://widgetfactory.extranet.3ds.com")}else{P=O.leangetView.isSameOrigin(t.getSwymUrl())}O.leangetView.onBeforeCapture();setTimeout(function(){o(document.querySelector("#"+O.cid),{scale:2,useCORS:true,allowTaint:true,letterRendering:true,imageTimeout:2000,logging:false,onclone:function(Q){B(".stickyNoteViewBackground",Q).css("border-color","rgba(0,0,0,0.4)");B(".stickyNoteViewBackground",Q).css("border-style","solid");B(".stickyNoteViewBackground",Q).css("border-width","0.06em");B(".pdfjsPage",Q).css("border-color","#b4b6ba");B(".pdfjsPage",Q).css("border-style","solid");B(".pdfjsPage",Q).css("border-width","0.1em");C.addClass(O.$el,"onCapture");C.removeClass(B(".mainView"),"onScreenshot");C.removeClass(O.$el,"screenshot")},ignoreElements:function(Q){if(Q.classList.contains("pageView")&&!Q.classList.contains("maximize")){return true}if(Q.classList.contains("infraView")&&!Q.classList.contains("focused")){return true}if(Q.classList.contains("sideViewContent")||Q.classList.contains("changelogButton")||Q.classList.contains("infraHeaderTools")||Q.classList.contains("rowControls")||Q.classList.contains("changelogButton")||Q.classList.contains("sketchLeangetSketchButtonsToolBar")){return true}if(Q.className==="postit-header-peoplePicture"||Q.className==="stickyMemberThumbnail"||Q.className==="personThumbnail"||Q.className==="teamThumbnail"||Q.className==="postit-info-status"){return !P}return false}}).then(function(Q){var R=Q.getContext("2d");R.webkitImageSmoothingEnabled=false;R.mozImageSmoothingEnabled=false;R.imageSmoothingEnabled=false;try{if(e.is(O.captureFloatable)){if(O.captureFloatable.model.isAction()){D.addContextCapture(Q.toDataURL("image/jpeg"),O.captureFloatable.model)}else{p.addContextCapture(Q.toDataURL("image/jpeg"),O.captureFloatable.model)}O.captureFloatable.model.save({V_DEL3DL_Has_Context:true})}else{O._exportCapture(Q)}}catch(S){O._logger.error(S)}finally{O.hideCapture();if(e.getGlobal().inMeeting){O.liveIt("liveOnCaptureCancel")}O.infraRadioChannel.trigger("after:generateScreenCapture");C.removeClass(O.$el,"onCapture");O.leangetView.onAfterCapture()}})},0)},_exportCapture:function(N){var Q=new Date().toISOString().slice(0,10);if(this.model.has("V_DEL3DL_Title")&&this.model.get("V_DEL3DL_Title")!==""){Q+=" - "+this.model.get("V_DEL3DL_Title")+".jpg"}else{Q+=" - "+z.getTranslation(this.model.get("type"))+".jpg"}if(this._lGlobal._IS_EDGE||this._lGlobal._IS_MS){window.navigator.msSaveOrOpenBlob(N.msToBlob(),Q)}else{var P=N.toDataURL("image/jpeg");var O=document.createElement("a");O.download=Q;O.href=P;this.$el.append(O);O.click();O.remove()}},onClose:function A(){if(e.getGlobal().inMeeting&&!e.getGlobal().isMeetingLeader){return}var N=this;if(N.isInAPage()){setTimeout(function(){N.staticRadioChannel.trigger("static:focusView",N._getParentStaticView())},0)}else{N.sideBarRadioChannel.trigger("sideBarView:openMap")}},onContextualMenu:function n(){this.leangetView.onContextualMenu()},onReorder:function I(){this.leangetView.onReorder()},onZoomIn:function K(){this.leangetView.onZoomIn()},onZoomOut:function i(){this.leangetView.onZoomOut()},onReload:function s(){if(e.getGlobal().inMeeting){this.liveIt("liveOnReload")}this.liveOnReload()},liveOnReload:function w(){this.leangetView.onReload()},onChildviewBeforeFloatableDrop:function f(N){this.leangetView.onBeforeFloatableDrop(N)},onChildviewAfterFloatableDrop:function x(P,O,N){this.leangetView.onAfterFloatableDrop(P,O,N)},_onRender:function(){this.coachMarkView.showView();this.showChildView("floatableRegion",this.floatableCollectionView);this.showChildView("leangetContainerRegion",this.leangetView);if(this.maximized){this.showButton()}if(this.positionEditable){this.showChildView("sizeRegion",this.sizeView)}if(this.settingsEditable){this.showChildView("settingsRegion",this.settingsView)}this.sketch=new h({container:this.getUI("infraSketchContainer")[0],sketchImage:null,pid:this.model.id,lineWidth:parseInt(widget.getValue("SketchThickness"))});this.sketchControlsView.setSketchComponent(this.sketch);C.addClass(this.$el,this.leangetConstructor.prototype.name)},_onBeforeRender:function(){if(this.rendered){this.hideButton();this.coachMarkView.detachView();this.detachChildView("floatableRegion",this.floatableCollectionView);this.detachChildView("leangetContainerRegion",this.leangetView);this.detachChildView("settingsRegion",this.settingsView);this.detachChildView("sizeRegion",this.sizeView);this.detachAndDestroyCaptureButtons()}},hideSketch:function(){B(".infraSketchContainer",this.$el).hide();if(e.is(this.sketchButtonView)){this.sketchButtonView.setChecked(false)}C.removeClass(this.$el,"onSketch");this.detachChildView("sketchControlsRegion",this.sketchControlsView);this.leangetView.onAfterAnnotate();this.sketch.off("sketch:live",this.onSketchLiveDelegate)},showSketch:function(){this.leangetView.onBeforeAnnotate();var N=B(".infraSketchContainer",this.$el).width();var O=B(".infraSketchContainer",this.$el).height();this.sketch.clear();this.sketch.flushUndoStack();this.sketch.resize(N,O);B(".infraSketchContainer",this.$el).show();C.addClass(this.$el,"onSketch");this.showChildView("sketchControlsRegion",this.sketchControlsView);C.addClass(this.sketchControlsView.$el,"sketchControlButtonsShow");this.sideBarRadioChannel.on("sideView:after:openPanel",this.resizeDelegate);this.sideBarRadioChannel.on("sideView:after:closePanel",this.resizeDelegate);this.sketch.on("sketch:live",this.onSketchLiveDelegate)},hideButton:function j(){if(this.buttonsVisible){this.detachChildView("closeButtonRegion",this.closeButtonView);this.closeButtonView.destroy();B(".infraClose",this.$el).css("display","none");if(e.is(this.leangetView.onBeforeCapture)&&e.is(this.leangetView.onAfterCapture)){this.detachChildView("captureButtonRegion",this.captureButtonView);this.captureButtonView.destroy();B(".infraCapture",this.$el).css("display","none")}if(e.is(this.leangetView.onReload)){this.detachChildView("reloadButtonRegion",this.reloadButtonView);this.reloadButtonView.destroy();B(".infraReload",this.$el).css("display","none")}if(e.is(this.leangetView.onReorder)){this.detachChildView("reorderButtonRegion",this.reorderButtonView);this.reorderButtonView.destroy();B(".infraReorder",this.$el).css("display","none")}if(e.is(this.leangetView.onContextualMenu)){this.detachChildView("contextualMenuButtonRegion",this.contextualMenuButtonView);this.contextualMenuButtonView.destroy();B(".infraContextualMenu",this.$el).css("display","none")}if(e.is(this.leangetView.switchToolbarSketch)){this.detachChildView("activeSketchButtonRegion",this.sketchButtonView);this.sketchButtonView.destroy();B(".infraActiveSketch",this.$el).css("display","none")}if(e.is(this.leangetView.onCastContent)){this.detachChildView("castContentButtonRegion",this.castContentButtonView);this.castContentButtonView.destroy();B(".infraCastContent",this.$el).css("display","none")}if(e.is(this.leangetView.onZoomIn)){this.detachChildView("zoomInButtonViewRegion",this.zoomInButtonView);this.zoomInButtonView.destroy();B(".infraZoomIn",this.$el).css("display","none")}if(e.is(this.leangetView.onZoomOut)){this.detachChildView("zoomOutButtonViewRegion",this.zoomOutButtonView);this.zoomOutButtonView.destroy();B(".infraZoomOut",this.$el).css("display","none")}}this.buttonsVisible=false;this.sideBarRadioChannel.off("sideView:after:openPanel",this.resizeDelegate);this.sideBarRadioChannel.off("sideView:after:closePanel",this.resizeDelegate)},showButton:function b(){var N=this;B(".infraClose",this.$el).css("display","block");this.closeButtonView=new c({model:new v({icon:"Infra/SideBarActionClose.svg",actionName:"closeInfraLeanget",callback:N.onClose.bind(N)})});this.showChildView("closeButtonRegion",this.closeButtonView);if(e.is(this.leangetView.onBeforeCapture)&&e.is(this.leangetView.onAfterCapture)){B(".infraCapture",this.$el).css("display","block");this.captureButtonView=new c({model:new v({icon:"Infra/photoCamera.svg",actionName:"captureInfraLeanget",callback:N.onCaptureValidation.bind(N)})});this.showChildView("captureButtonRegion",this.captureButtonView)}if(e.is(this.leangetView.onReload)){B(".infraReload",this.$el).css("display","block");this.reloadButtonView=new c({model:new v({icon:"Infra/InfraReload.svg",actionName:"reloadLeanget",callback:N.onReload.bind(N)})});this.showChildView("reloadButtonRegion",this.reloadButtonView)}if(e.is(this.leangetView.onReorder)){B(".infraReorder",this.$el).css("display","block");this.reorderButtonView=new c({model:new v({icon:"Infra/object-alignment.svg",actionName:"reorderLeanget",callback:N.onReorder.bind(N)})});this.showChildView("reorderButtonRegion",this.reorderButtonView)}if(e.is(this.leangetView.onContextualMenu)){B(".infraContextualMenu",this.$el).css("display","block");this.contextualMenuButtonView=new c({model:new v({icon:"Infra/contextualMenu.svg",actionName:"contextualMenu",callback:N.onContextualMenu.bind(N)})});this.showChildView("contextualMenuButtonRegion",this.contextualMenuButtonView)}if(e.is(this.leangetView.switchToolbarSketch)){B(".infraActiveSketch",this.$el).css("display","block");this.sketchButtonView=new c({model:new v({icon:"Infra/infraSketchCapture.svg",actionName:"activeInfraLeangetSketch",mode:"checkbox",callback:N.switchToolbarSketch.bind(N),iconChecked:"Infra/infraSketchCaptureActive.svg"})});this.showChildView("activeSketchButtonRegion",this.sketchButtonView)}if(e.is(this.leangetView.onCastContent)){B(".infraCastContent",this.$el).css("display","block");this.castContentButtonView=new c({model:new v({icon:"Infra/infraCastContent.svg",actionName:"castContent",mode:"checkbox",callback:N.onCastContent.bind(N),iconChecked:"Infra/infraCastContentActive.svg"})});this.showChildView("castContentButtonRegion",this.castContentButtonView)}if(e.is(this.leangetView.onZoomIn)){B(".infraZoomIn",this.$el).css("display","block");this.zoomInButtonView=new c({model:new v({icon:"Infra/zoomIn.svg",actionName:"zoomIn",callback:N.onZoomIn.bind(N)})});this.showChildView("zoomInButtonViewRegion",this.zoomInButtonView)}if(e.is(this.leangetView.onZoomOut)){B(".infraZoomOut",this.$el).css("display","block");this.zoomOutButtonView=new c({model:new v({icon:"Infra/zoomOut.svg",actionName:"zoomOut",callback:N.onZoomOut.bind(N)})});this.showChildView("zoomOutButtonViewRegion",this.zoomOutButtonView)}this.buttonsVisible=true},isInAPage:function H(){return"pageView"===this._getParentStaticView().className},_meetingPreparation:function(N){var O=this;if(!O.focused&&!O.focusable){return}if(N){O.sideBarRadioChannel.once("sideView:after:openPanel",function(){C.removeClass(O.floatableCollectionView.$el,"meetingPreparationTransition")})}else{O.sideBarRadioChannel.once("sideView:after:closePanel",function(){C.removeClass(O.floatableCollectionView.$el,"meetingPreparationTransition")})}C.addClass(O.floatableCollectionView.$el,"meetingPreparationTransition")},_toolsOpen:function(O){var N=this;if(!N.focused&&!N.focusable){return}if(O){N.sideBarRadioChannel.once("sideView:after:openPanel",function(){C.removeClass(N.floatableCollectionView.$el,"toolsTransition")})}else{N.sideBarRadioChannel.once("sideView:after:closePanel",function(){C.removeClass(N.floatableCollectionView.$el,"toolsTransition")})}C.addClass(N.floatableCollectionView.$el,"toolsTransition")},_settingsEditable:function(){this.floatableCollectionView.settingsEditable(true);this.showChildView("settingsRegion",this.settingsView);if(e.is(this._getParentStaticView())&&this._getParentStaticView().className==="pageView"){C.addClass(this._getParentStaticView().$el,"customizeMenuOpened")}this.hideButton();this.onCaptureCancel()},_settingsUneditable:function(){var N=this;N.sideBarRadioChannel.once("sideView:after:closePanel",function(){N.floatableCollectionView.settingsEditable(false)});N.detachChildView("settingsRegion",N.settingsView);if(e.is(N._getParentStaticView())&&N._getParentStaticView().className==="pageView"){C.removeClass(N._getParentStaticView().$el,"customizeMenuOpened")}N.showButton();N.render()},_positionEditable:function(){this.setFocusable(false);C.addClass(this.$el,"customized");this.triggerMethod("view:activeInteract",true,true,false);this.showChildView("sizeRegion",this.sizeView)},_positionUneditable:function(){this.detachChildView("sizeRegion");this.triggerMethod("view:activeInteract",false,false,false);C.removeClass(this.$el,"customized");this.setFocusable(true)},_focusable:function(){C.addClass(this.$el,"focusable");this.triggerMethod("view:activeHammer",true,true,false,false,false)},_unfocusable:function(){C.removeClass(this.$el,"focusable");this.triggerMethod("view:activeHammer",false,false,false,false,false)},_unfocus:function(){this.onCaptureCancel();this.hideButton();this.floatableCollectionView.focus(false);this.leangetView.setFocusView(false);this.coachMarkView.setFocusView(false);this.sideBarRadioChannel.off("sideBarView:customize",this.setSettingsEditableDelegate);this.sideBarRadioChannel.off("sideBarView:navigate",this.onSwipeDelegate);this.triggerMethod("view:activeHammer",false,false,false,false,false);C.removeClass(this.$el,"focused")},_focus:function(){this.staticRadioChannel.once("after:focus",B.proxy(function(){this.triggerMethod("view:activeHammer",false,false,true,false,false)},this));this.showButton();this.floatableCollectionView.focus(true);this.leangetView.setFocusView(true);this.coachMarkView.setFocusView(true);this.sideBarRadioChannel.on("sideBarView:customize",this.setSettingsEditableDelegate);this.sideBarRadioChannel.on("sideBarView:navigate",this.onSwipeDelegate);C.addClass(this.$el,"focused")},_socketMeetingFocus:function(){if(e.getGlobal().inFreeMeeting&&this.isInAPage()&&this._getParentStaticView().focused!==true){this.staticRadioChannel.trigger("static:focusView",this._getParentStaticView())}this.staticRadioChannel.trigger("static:focusView",this)},_minimize:function(O){if(this.isInAPage()){var N=this._getParentStaticView();C.removeClass(N.$el,"hideUnfocusedSN")}if(!this.isInAPage()||(e.is(O.focusView)&&O.focusView.className!=="mapView")){C.addClass(this.$el,"forceInfraIndex");C.addClass(this.$el,"minMaxTransition");this.uiRadioChannel.once("after:minimizeTransition",B.proxy(function(){C.removeClass(this.$el,"minMaxTransition");C.removeClass(this.$el,"forceInfraIndex")},this))}if(e.getGlobal().inGuidedMeeting||this.isOnSwipe){this.uiRadioChannel.trigger("before:minimizeTransition");C.removeClass(this.$el,"maximize");C.removeClass(B(".mapView"),"childFixed");this.uiRadioChannel.trigger("after:minimizeTransition")}else{C.removeClassWithTransition(this.$el,"maximize","minimizeTransition");C.removeClass(B(".mapView"),"childFixed")}},_maximize:function(){this.uiRadioChannel.once("after:maximizeTransition",B.proxy(function(){C.removeClass(this.$el,"minMaxTransition");C.addClass(B(".mapView"),"childFixed")},this));C.addClass(this.$el,"minMaxTransition");if(e.getGlobal().inGuidedMeeting||this.isOnSwipe){this.uiRadioChannel.trigger("before:maximizeTransition");C.addClass(this.$el,"maximize");this.uiRadioChannel.trigger("after:maximizeTransition")}else{C.addClassWithTransition(this.$el,"maximize","maximizeTransition")}},firstFocus:function(){this.staticRadioChannel.trigger("static:focusView",this);this.staticRadioChannel.trigger("after:unFocus",{focusView:this,unfocusView:null});this.staticRadioChannel.trigger("after:minimize",{focusView:this,unfocusView:null})},pressEventCallback:function(N){this.tapEventCallback(N)},tapEventCallback:function(P){if(e.getGlobal().inMeeting&&!e.getGlobal().isMeetingLeader){return}var O=this;var N=O._getViewElement(P.target);if(e.is(N)&&N.id===O.cid&&!e.getGlobal().inGuidedMeeting){if(O.meetingPreparation===true){O.sideBarRadioChannel.trigger("view:selectLeanget",O)}else{O.staticRadioChannel.trigger("static:focusView",O)}}},swipeEventCallback:function(P){if(B(P.target).hasClass("stickerViewContent")||B(P.target).hasClass("stickyNoteViewContent")||B(P.target).hasClass("stickyMemberThumbnail")||B(".mainView").hasClass("onSwipe")||this.positionEditable===true||this.settingsEditable===true||e.getGlobal().inGuidedMeeting===true){return}var N=this._getParentStaticView();if(e.is(N)){var O=e.is(P.maxPointers)?P.maxPointers:0;this.infraRadioChannel.trigger("after:swipe",{touchNumber:O,swipeEvent:P});if(N.className==="mapView"){this.trigger("staticView:swipe",{child:this,event:P})}else{N.trigger("staticView:swipe",{child:N,event:P,maximizeLeanget:this})}}}});return g});define("DS/DEL3DLeanViews/EditSticky/EditSketchView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/Logger/Logger","DS/DEL3DLeanViews/Components/SketchComponent","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Components/SketchControlsView","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditSketchView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditSketchView.css"],function(e,g,k,j,l,b,m,d,c,f,i,h){var a=j.View.extend({iconPath:d.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"editSketchView",ui:{sketch:".sketchDrawArea"},behaviors:[],regions:{sketchControlsRegion:".editSketchControls"},uiRadioChannel:l.channel("uiutils"),template:k.template(h),templateContext:function(){return{get:g.proxy(this.model.get,this.model),getNLS:g.proxy(c.getTranslation,c)}},constructor:function a(){j.View.prototype.constructor.apply(this,arguments)},initialize:function(){this._logger=b.getLogger(a);this.afterSidePanel=g.proxy(this.afterSidePanelTransition,this);this.sketchControlsView=new i({parent:this,model:this.model})},onRender:function(){this.showChildView("sketchControlsRegion",this.sketchControlsView);this._initSketch()},onAttach:function(){this.uiRadioChannel.on("after:sidePanelClose after:sidePanelOpen",this.afterSidePanel)},onDetach:function(){this.uiRadioChannel.off("after:sidePanelClose after:sidePanelOpen",this.afterSidePanel);this.saveSketch()},_initSketch:function(){var n=this.model.get("V_DEL3DL_Draw_Data");this.sketch=new m({container:this.getUI("sketch")[0],pid:this.model.id,lineWidth:parseInt(widget.getValue("SketchThickness")),buildCallback:g.proxy(function(){},this)});if(n){this.sketch.decode(n)}setTimeout(g.proxy(function(){this.resizeSketch()},this),0);this.sketchControlsView.setSketchComponent(this.sketch)},resizeSketch:function(){var n=g(this.$el).width();var o=g(this.$el).height();this.sketch.resize(n,o)},saveSketch:function(){this.model.save({V_DEL3DL_Draw_Data:this.sketch.encode()})},afterSidePanelTransition:function(){this.resizeSketch()}});return a});define("DS/DEL3DLeanViews/Components/PopupArea",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Utils/UIUtils","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/Components/PopupArea.template.html","css!DS/DEL3DLeanViews/assets/css/Components/PopupArea.css"],function(e,f,k,l,h,g,b,c,j){var d=null;var a=h.View.extend({name:"PopupArea",className:"popupArea",uiRadioChannel:l.channel("uiutils"),iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),regions:{popupPanelRegion:{el:".popupPanel",replaceElement:true}},behaviors:[{behaviorClass:g,enableTapEvent:true,enablePressEvent:true,useTapEvent:true,usePressEvent:true,className:".popupAreaClose"}],template:k.template(j),initialize:function(){},onRender:function(){f(".popupPanelCloseImage",this.$el).attr("src",this.iconPath+"/RemoveIcon.svg");this.$el.hide()},showArea:function(){this.$el.show();setTimeout(f.proxy(function(){b.addClassWithTransition(this.$el,"showArea","popupShowArea")},this),100)},hideArea:function(){this.uiRadioChannel.once("after:popupHideArea",f.proxy(function(){this.$el.hide()},this));b.removeClassWithTransition(this.$el,"showArea","popupHideArea")},openPanel:function(m){this.showChildView("popupPanelRegion",m);this.showArea();this.openedPanel=m;this.openedPanel.afterOpenPanel()},closePanel:function(){this.hideArea();this.detachChildView("popupPanelRegion");this.openedPanel.afterClosePanel();this.openedPanel=null},pressEventCallback:function(m){this.tapEventCallback(m)},tapEventCallback:function(){this.closePanel()}});function i(){if(!e.is(d)){d=new a()}return d}return i()});define("DS/DEL3DLeanViews/Components/PopupPanel",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Components/PopupArea"],function(e,h,g){var b=h.View.extend({initialize:function(){},onRender:function(){this.$el.addClass("popupPanel")},onDestroy:function(){},openPanel:function a(){g.openPanel(this);this.trigger("opened")},afterOpenPanel:function d(){},closePanel:function c(){g.closePanel();this.trigger("closed")},afterClosePanel:function f(){}});return b});define("DS/DEL3DLeanViews/Team/SearchPersonPanelView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/Components/PopupPanel","DS/DEL3DLeanHttpRequest/PeopleService","DS/DEL3DLeanCollectionViews/SearchPersonCollectionView","DS/DEL3DLeanResources/ResourcesManager","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Behaviors/HammerBehavior","text!DS/DEL3DLeanViews/assets/template/Team/SearchPersonPanelView.template.html","css!DS/DEL3DLeanViews/assets/css/Team/SearchPersonPanelView.css"],function(l,j,z,e,q,v,y,t,k,n,i,u,A){var h=null;var b=y.extend({className:"searchPersonPanelView",iconPath:i.getWebappsAssetUrl("DEL3DLeanViews","icons"),template:z.template(A),templateContext:function r(){return{getNLS:j.proxy(n.getTranslation,n)}},searchPeopleRadioChannel:v.channel("searchPeople"),ui:{searchParameter:".searchParameter"},events:{"input @ui.searchParameter":"updateSearchParameter"},regions:{resultsCollectionViewRegion:{selector:"div.resultsCollectionView"}},initialize:function d(B){y.prototype.initialize.apply(this,[B]);this._searchSuccessDelegate=j.proxy(this._searchSuccess,this);this._searchErrorDelegate=j.proxy(this._searchError,this);this._onMemberSelectedDelegate=j.proxy(this._onMemberSelected,this);this.searchPersonCollection=new e.Collection();this.searchPersonCollectionView=new k({collection:this.searchPersonCollection})},onRender:function(){y.prototype.onRender.apply(this);this.showChildView("resultsCollectionViewRegion",this.searchPersonCollectionView)},onDestroy:function m(){y.prototype.onDestroy.apply(this)},_onMemberSelected:function x(B){if(this.addToAuthor){t.addAuthor(B)}else{t.addContributor(B)}this.searchPersonCollection.reset();j(".searchParameter",this.$el).val("");j(".searchParameter",this.$el).focus()},_searchSuccess:function o(D){this.searchPersonCollection.reset();var E=JSON.parse(D);for(var C=0;E.length>C;C++){var B=E[C];this.searchPersonCollection.add(new e.Model({pid:B.id,login:B.login,firstname:B.fname,lastname:B.lname,employmenttype:B.employment,author:this.addToAuthor,picture:B.picture.substring(B.picture.lastIndexOf("http"))}))}},_searchError:function f(){},updateSearchParameter:function p(){var B=j(".searchParameter",this.$el).val();if(B.length>2){if(l.is(this._timeoutFct)){clearTimeout(this._timeoutFct)}this._timeoutFct=setTimeout(j.proxy(function(){t.searchPeople(B,this._searchSuccessDelegate,this._searchErrorDelegate)},this),250)}else{this.searchPersonCollection.reset()}},openPanel:function c(B){this.addToAuthor=B;y.prototype.openPanel.apply(this)},afterOpenPanel:function s(){this.searchPersonCollection.reset();j(".searchParameter",this.$el).val("");j(".searchParameter",this.$el).focus();this.bindEvents()},closePanel:function a(){y.prototype.closePanel.apply(this)},afterClosePanel:function g(){this.unbindEvents()},bindEvents:function(){this.searchPeopleRadioChannel.on("searchCollectionView:memberSelected",this._onMemberSelectedDelegate)},unbindEvents:function(){this.searchPeopleRadioChannel.off("searchCollectionView:memberSelected",this._onMemberSelectedDelegate)}});function w(){if(!l.is(h)){h=new b()}return h}return w()});define("DS/DEL3DLeanViews/ContentManager/ManageContentPanelView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/Components/PopupPanel","text!DS/DEL3DLeanViews/assets/template/ContentManager/ManageContentPanelView.template.html","css!DS/DEL3DLeanViews/assets/css/ContentManager/ManageContentPanelView.css"],function(a,d,j,g,b){var c=null;var f=g.extend({name:"ManageContentPanelView",className:"manageContentPanelView",template:j.template(b),initialize:function e(k){g.prototype.initialize.apply(this,[k])},onRender:function(){g.prototype.onRender.apply(this)},onDestroy:function h(){g.prototype.onDestroy.apply(this)}});function i(){if(!a.is(c)){c=new f()}return c}return i()});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/ActionLogSettingsView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/ActionLogSettingsView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/SettingsView.css"],function(b,a,e,c){var d=a.extend({name:"ActionLogSettingsView",className:"settingsView",template:b.template(c),sideBarRadioChannel:e.channel("sidebar"),ui:{title:".title",inputs:"input"},events:{"change @ui.title":"updateTitle","change @ui.inputs":"saveModel"},onFavoriteSelected:function(f){d.__super__.onFavoriteSelected.call(this,f);this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}});return d});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/ActionLogView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanResources/ResourcesManager","DS/Logger/Logger","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Utils/TaskUtils","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Utils/AutoRefreshUtils","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/ActionLogSettingsView","DS/WebappsUtils/WebappsUtils","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/ActionLogView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/ActionLogView.css"],function(h,j,n,l,o,e,b,c,m,i,d,a,k,f,q,g){var p=l.extend({className:"leangetView actionLogView",name:"ActionLogView",_logger:null,_areaInfos:{},behaviors:[{behaviorClass:o,isDroppable:true,isActiveOnRender:false,enableDropAcceptClass:".stickyNoteView",className:".actionlogSection"}],extendModelEvents:{"change:V_DEL3DL_AL_CustomLayout":"onCustomLayoutChange"},fakeKonamiCodeSequence:[38,40,37,39],actionLogWaitingIcon:f.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/alWaitingIcon.png",actionLogClosedIcon:f.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/alClosedIcon.png",taskRadioChannel:q.channel("taskutils"),template:n.template(g),templateContext:function(){var r=this.constructor.__super__.templateContext.call(this);r=n.extend(r,this.model.jsonData());return n.extend(r,{actionLogWaitingIcon:this.actionLogWaitingIcon,actionLogClosedIcon:this.actionLogClosedIcon,get:j.proxy(this.model.get,this.model),getNls:j.proxy(e.getTranslation,e)})},initialize:function(r){l.prototype.initialize.apply(this,[r]);this.settingsView=a.createView(k,{model:this.model});this.updateStickyNotePositionDelegate=j.proxy(this.updateStickyNotePosition,this);this.deleteStickyNoteDelegate=j.proxy(this.deleteStickyNote,this);this.floatableCollectionView.selectAllDelegate=j.proxy(this.selectAllFloatable,this.floatableCollectionView);this.floatableCollectionView.createViewDelegate=j.proxy(this.createFloatableView,this.floatableCollectionView);this.floatableCollectionView.updateRelation=this.updateRelation;this.floatableCollectionView.onAddChild=j.proxy(this.onAddChild,this);this.taskRadioChannel.off("stickynote:zone:updated");this.taskRadioChannel.off("stickynote:delete");this.taskRadioChannel.on("stickynote:zone:updated",this.updateStickyNotePositionDelegate);this.taskRadioChannel.on("stickynote:delete",this.deleteStickyNoteDelegate);if(!h.is(this._logger)){this._logger=b.getLogger(p)}h.getGlobal().hasActionLog=true;this.taskRadioChannel.trigger("hasActionLog:change")},onDestroy:function(){h.getGlobal().hasActionLog=false;this.taskRadioChannel.trigger("hasActionLog:change")},switchToolbarSketch:function(){},onBeforeCapture:function(){},onAfterCapture:function(){},onCustomLayoutChange:function(){this.triggerMethod("view:activeInteract",false,false,false);this.render();this.onReorder();this.triggerMethod("view:activeInteract",this.isFocus,this.isFocus,false)},classicLayout:function(){this._areaInfos.alToday={width:25,height:70,left:0,top:0};this._areaInfos.alTomorrow={width:25,height:70,left:25,top:0};this._areaInfos.alWeek={width:25,height:70,left:50,top:0};this._areaInfos.alNext={width:25,height:70,left:75,top:0};this._areaInfos.alParking={width:50,height:30,left:0,top:70};this._areaInfos.alDone={width:50,height:30,left:50,top:70}},customLayout:function(){this._areaInfos.alToday={width:Number(this.model.get("V_DEL3DL_AL_TodayWidth")),height:Number(this.model.get("V_DEL3DL_AL_TodayHeight")),left:Number(this.model.get("V_DEL3DL_AL_TodayLeft")),top:Number(this.model.get("V_DEL3DL_AL_TodayTop"))};this._areaInfos.alTomorrow={width:Number(this.model.get("V_DEL3DL_AL_TomorrowWidth")),height:Number(this.model.get("V_DEL3DL_AL_TomorrowHeight")),left:Number(this.model.get("V_DEL3DL_AL_TomorrowLeft")),top:Number(this.model.get("V_DEL3DL_AL_TomorrowTop"))};this._areaInfos.alWeek={width:Number(this.model.get("V_DEL3DL_AL_WeekWidth")),height:Number(this.model.get("V_DEL3DL_AL_WeekHeight")),left:Number(this.model.get("V_DEL3DL_AL_WeekLeft")),top:Number(this.model.get("V_DEL3DL_AL_WeekTop"))};this._areaInfos.alNext={width:Number(this.model.get("V_DEL3DL_AL_NextWidth")),height:Number(this.model.get("V_DEL3DL_AL_NextHeight")),left:Number(this.model.get("V_DEL3DL_AL_NextLeft")),top:Number(this.model.get("V_DEL3DL_AL_NextTop"))};this._areaInfos.alParking={width:Number(this.model.get("V_DEL3DL_AL_ParkingWidth")),height:Number(this.model.get("V_DEL3DL_AL_ParkingHeight")),left:Number(this.model.get("V_DEL3DL_AL_ParkingLeft")),top:Number(this.model.get("V_DEL3DL_AL_ParkingTop"))};this._areaInfos.alDone={width:Number(this.model.get("V_DEL3DL_AL_DoneWidth")),height:Number(this.model.get("V_DEL3DL_AL_DoneHeight")),left:Number(this.model.get("V_DEL3DL_AL_DoneLeft")),top:Number(this.model.get("V_DEL3DL_AL_DoneTop"))};j(".actionlogSection.alToday",this.$el).css({width:"calc("+this._areaInfos.alToday.width+"% - 1em)",height:"calc("+this._areaInfos.alToday.height+"% - 1em)",left:this._areaInfos.alToday.left+"%",top:this._areaInfos.alToday.top+"%"});j(".actionlogSection.alTomorrow",this.$el).css({width:"calc("+this._areaInfos.alTomorrow.width+"% - 1em)",height:"calc("+this._areaInfos.alTomorrow.height+"% - 1em)",left:this._areaInfos.alTomorrow.left+"%",top:this._areaInfos.alTomorrow.top+"%"});j(".actionlogSection.alWeek",this.$el).css({width:"calc("+this._areaInfos.alWeek.width+"% - 1em)",height:"calc("+this._areaInfos.alWeek.height+"% - 1em)",left:this._areaInfos.alWeek.left+"%",top:this._areaInfos.alWeek.top+"%"});j(".actionlogSection.alNext",this.$el).css({width:"calc("+this._areaInfos.alNext.width+"% - 1em)",height:"calc("+this._areaInfos.alNext.height+"% - 1em)",left:this._areaInfos.alNext.left+"%",top:this._areaInfos.alNext.top+"%"});j(".actionlogSection.alParking",this.$el).css({width:"calc("+this._areaInfos.alParking.width+"% - 1em)",height:"calc("+this._areaInfos.alParking.height+"% - 1.6em)",left:this._areaInfos.alParking.left+"%",top:this._areaInfos.alParking.top+"%"});j(".actionlogSection.alDone",this.$el).css({width:"calc("+this._areaInfos.alDone.width+"% - 1em)",height:"calc("+this._areaInfos.alDone.height+"% - 1em)",left:this._areaInfos.alDone.left+"%",top:this._areaInfos.alDone.top+"%"});j(".actionlogSection.alParking",this.$el).addClass("hideContentImg");j(".actionlogSection.alDone",this.$el).addClass("hideContentImg")},onRender:function(){l.prototype.onRender.apply(this,[]);if(h.is(this.model.get("V_DEL3DL_AL_CustomLayout"))&&this.model.get("V_DEL3DL_AL_CustomLayout")==="true"){this.customLayout()}else{this.classicLayout()}},onAttach:function(){if(!h.is(this.checkChildrenOnce)){this.checkChildrenOnce=true;this.checkAndReplaceNotes()}},onAddChild:function(r,s){s.enableView(this.isFocus);if(h.is(this.checkChildrenOnce)){this.checkAndReplaceNote(s)}},setFocusView:function(s){l.prototype.setFocusView.apply(this,[s]);this.triggerMethod("view:activeInteract",s,s,false);var r=widget.getValue("ActionLogAutoRefresh")==="true"||widget.getValue("ActionLogAutoRefresh")===true;if(s){d.enableAutoRefresh(r,30000);j(document).on("keydown",j.proxy(this.onFakeKonamiCode,this))}else{d.enableAutoRefresh(r,null);j(document).off("keydown",j.proxy(this.onFakeKonamiCode,this));if(this.fakeKonamiCodeOn){this.floatableCollectionView.children.each(function(t){t._updateCircleMenuActionsAvailability(t.model)})}}this.fakeKonamiCodeOn=false;this.fakeKonamiCodeStep=0},onFakeKonamiCode:function(r){if(r.keyCode===this.fakeKonamiCodeSequence[this.fakeKonamiCodeStep++]){if(this.fakeKonamiCodeStep===this.fakeKonamiCodeSequence.length){this.fakeKonamiCodeOn=true;this.fakeKonamiCodeStep=0;this.floatableCollectionView.children.each(function(s){s._forceCircleMenuActionsAvailable()})}}else{this.fakeKonamiCodeStep=0}},onDragEnterCallback:function(r){c.addClass(j(r.target),"actionLogCanDrop")},onDragLeaveCallback:function(r){c.removeClass(j(r.target),"actionLogCanDrop")},onDropCallback:function(u){c.removeClass(j(u.target),"actionLogCanDrop");var r=this.floatableCollectionView.children.filter({cid:u.relatedTarget.id})[0];var v=r.model.get("V_DEL3DL_ActionLogZone");var x=j(u.target).attr("class").split(" ").filter(function(y){return y.indexOf("al")===0})[0];if(!h.is(x)||(!r.model.isOurTeamAssigned()&&v!==x)||(v==="alDone"&&v!==x&&!this.fakeKonamiCodeOn)){if(h.is(r.liveIt)){r.liveIt("updatePosition")}r.updatePosition();return}var s={};var w={coordY:Number(u.relatedTarget.getAttribute("data-y")),coordX:Number(u.relatedTarget.getAttribute("data-x"))};switch(x){case"alParking":s.current="Active";break;case"alToday":s.current="Active";s.dueDate="0";break;case"alTomorrow":s.current="Active";s.dueDate="1";break;case"alWeek":s.current="Active";s.dueDate="7";break;case"alNext":s.current="Active";s.dueDate="30";break;case"alDone":s.current="Complete";s.dueDate="0";break;default:break}r.model.save({V_DEL3DL_ActionLogZone:x});r.relationModel.save({V_DEL3DL_X:w.coordX,V_DEL3DL_Y:w.coordY});if(v!==x){var t=i.getTasksRelationsFrom(r.model.id);if(t.length>0){m.updateTask(t.first().get("to"),s)}}},onReload:function(){d.refreshAILogElements()},onReorder:function(){var r=this;this.floatableCollectionView.children.each(function(t){var u=t.model;var s=t.relationModel;if(u.isAction()&&h.is(s.id)){t.$el.attr("data-x","-1");t.$el.attr("data-y","-1")}});this.floatableCollectionView.children.each(function(t){var u=t.model;var s=t.relationModel;if(u.isAction()&&h.is(s.id)){var v=r._searchFreeSpace(u.get("V_DEL3DL_ActionLogZone"));if(h.is(v)&&((s.get("V_DEL3DL_X")!==v.coordX)||(s.get("V_DEL3DL_Y")!==v.coordY)||(s.get("V_DEL3DL_Angle")!==0)||(s.get("V_DEL3DL_Size_X")!==1))){s.save({V_DEL3DL_X:v.coordX,V_DEL3DL_Y:v.coordY,V_DEL3DL_Angle:0,V_DEL3DL_Size_X:1});t.pinchScale=1;t.angleScale=0}else{t.$el.attr("data-x",v.coordX);t.$el.attr("data-y",v.coordY)}}})},createFloatableView:function(){},updateRelation:function(t,s){if(!t.model.isAction()){var r=t.relationModel;if(!h.is(r)){return}r.save(s)}},selectAllFloatable:function(){var r=this;r.forceChildPressEvent();r.children.each(function(s){if(s.model.isAction()&&s.model.isDone()){s.selectFloatable()}});r.onFloatableSelected()},deleteStickyNote:function(r){var s=this.floatableCollectionView.children.findByModel(r);this.floatableCollectionView.deleteFloatable(s)},_checkFloatableIsInCorrectZone:function(r){var t=r.relationModel.get("V_DEL3DL_Y");var x=r.relationModel.get("V_DEL3DL_X");var v=this._areaInfos[r.model.get("V_DEL3DL_ActionLogZone")];if(h.is(v)){var y=v.top;var w=v.left;var s=v.width;var u=v.height;if((t>=y&&t<=(y+u))&&(x>=w&&x<=(w+s))){return true}}return false},_searchFreeSpace:function(y){var A=this._areaInfos[y];if(!h.is(A)){return null}var x=A.top;var s=A.left;var w=A.width;var v=A.height;var u=s+2;var t=x+7.25;var r=s+w;var B=x+v;var z=u;for(;j('.stickyNoteView[data-x="'+u+'"][data-y="'+t+'"]',this.floatableCollectionView.$el).length>0;u+=7.25){if(u>(r-14)){if(t>(B-20)){break}else{u=z-7.25;t+=10}}}return{coordY:t,coordX:u}},updateStickyNotePosition:function(r){var s=this.floatableCollectionView.children.findByModel(r);var t=this._searchFreeSpace(r.get("V_DEL3DL_ActionLogZone"));if(h.is(t)&&h.is(s)){s.relationModel.save({V_DEL3DL_X:t.coordX,V_DEL3DL_Y:t.coordY})}this.taskRadioChannel.trigger("stickynote:zone:updated:end")},checkAndReplaceNotes:function(){var r=this;r.floatableCollectionView.children.each(function(s){r.checkAndReplaceNote(s)})},checkAndReplaceNote:function(t){var u=this;var v=t.model;var r=t.relationModel;var s=v.get("V_DEL3DL_ActionLogZone");if(h.is(r.id)&&v.isAction()&&h.is(s)&&!u._checkFloatableIsInCorrectZone(t)){var w=u._searchFreeSpace(s);if(h.is(w)){r.save({V_DEL3DL_X:w.coordX,V_DEL3DL_Y:w.coordY})}}}});return p});define("DS/DEL3DLeanViews/Panels/CustomizeView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Panels/CustomizeView.template.html","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanEnums/Model.enum","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanCollectionViews/SideCollectionViews/StoreCollectionView","DS/DEL3DLeanCollectionViews/SideCollectionViews/FavoritesCollectionView","css!DS/DEL3DLeanViews/assets/css/Panels/CustomizeView.css"],function(g,h,k,j,m,n,f,d,b,c,e,i,l){var a=j.View.extend({className:"customizeView",title:null,icon:f.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/CustomizePanel/PanelIcon.svg",sideBarRadioChannel:m.channel("sidebar"),staticRadioChannel:m.channel("static"),regions:{storeCollectionRegion:{selector:".storeCollectionView",replaceElement:true}},events:{},template:k.template(n),initialize:function(){this.title=e.getTranslation("customizeTitle");this.storeCollectionView=new i({collection:c.STORE.sessionInstance});this.staticRadioChannel.on("after:focus",h.proxy(this.onFocusedViewChange,this))},onShow:function(){},onAttach:function(){},onRender:function(){},onOpen:function(){d.addClass(h(".sideView"),"onCustomize");this.detachChildView("storeCollectionRegion");if(g.is(this.focusedViewModelType)&&this.focusedViewModelType!=="DEL3DL_Session"&&this.focusedViewModelType!=="DEL3DL_Page"){var o=b.getFromServerType(this.focusedViewModelType);this.showChildView("storeCollectionRegion",new l({collection:o.favorites}))}else{this.showChildView("storeCollectionRegion",this.storeCollectionView)}},onClose:function(){d.removeClass(h(".sideView"),"onCustomize");this.sideBarRadioChannel.trigger("sideBarView:customize",false)},onFocusedViewChange:function(o){this.focusedViewModelType=g.is(o.focusView)?o.focusView.model.serverType:null}});return a});define("DS/DEL3DLeanViews/Thumbnails/IssueThumbnailView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanViews/Thumbnails/StickyThumbnailView","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/Thumbnails/IssueThumbnailView.template.html","css!DS/DEL3DLeanViews/assets/css/Thumbnails/IssueThumbnailView.css"],function(b,d,h,g,j,e,c,a,i){var f=j.extend({behaviors:[{behaviorClass:e,enableTapEvent:true,enablePressEvent:true,usePressEvent:true,useTapEvent:true,className:".issueNoteViewContent"}],className:"thumbnailView issueThumbnailView",template:h.template(i),initialize:function(l){this._actionsLinked=this.getActionsLinked();this._staticsLinked=this.getStaticsLinked();var k=d.proxy(this._updateInformations,this);this._actionsLinked.on("add remove",k);this._staticsLinked.on("add remove",k);j.prototype.initialize.apply(this,[l])},onRender:function(){j.prototype.onRender.apply(this,[])},onAttach:function(){this.constructor.__super__._dataUpdated.apply(this,arguments)},pressEventCallback:function(){this.tapEventCallback(event)},tapEventCallback:function(){this.triggerMethod("editIssue:select",this)},_dataUpdated:function(m,k,l){this.constructor.__super__._dataUpdated.apply(this,arguments);if(k.V_DEL3DL_IssueLogZone!==l.V_DEL3DL_IssueLogZone&&k.V_DEL3DL_IssueLogZone==="ilIssueClosed"||(k.V_DEL3DL_Has_Context!==l.V_DEL3DL_Has_Context)){this._updateInformations()}},updateContent:function(l,k){if(!b.is(k)){k=this.model.get("V_DEL3DL_Sketch_Image")}if(g.isDataUrl(k)){d(".issueNoteViewContent",this.$el).css("background-image",'url("'+k+'")')}else{if(k){d(".issueNoteViewContent",this.$el).css("background-image",'url("'+this.iconPath+'/Loading.svg")');g.getImage(k).then(d.proxy(function(m){d(".issueNoteViewContent",this.$el).css("background-image",'url("'+m+'")')},this))}}},_updateInformations:function(){if(this.model.isDone()){d(".postit-info-status",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/padlock.svg)");d(".postit-info-status",this.$el).addClass("done");d(".postit-info-status",this.$el).show()}else{d(".postit-info-status",this.$el).hide()}if(this.hasActionLinked()){a.addClass(this.$el,"hasActionLinked")}else{a.removeClass(this.$el,"hasActionLinked")}if(this.hasStaticLinked()){a.addClass(this.$el,"hasStaticLinked")}else{a.removeClass(this.$el,"hasStaticLinked")}if(this.model.get("V_DEL3DL_Has_Context")===true){d(".issueClipContent",this.$el).attr("src",this.iconPath+"/trombone.png");a.addClass(this.$el,"hasStaticLinked")}},_allActionsDone:function(){var m=this.getActionsLinked();if(m.models.length>0){var o=true;var n=null;for(var k in m.models){n=m.models[k];var l=c.findModel(n.get("to"),["floatables"]);if(!l.isDone()){o=false;break}}return o}return false},hasActionLinked:function(){return this.getActionsLinked().length>0},hasStaticLinked:function(){return this.getStaticsLinked().length>0},getActionsLinked:function(){var k=null;if(b.is(this._actionsLinked)){k=this._actionsLinked}else{k=c.getFloatablesRelationsFrom(this.model.id);this._actionsLinked=k}return k},getStaticsLinked:function(){var k=null;if(b.is(this._staticsLinked)){k=this._staticsLinked}else{k=c.getStaticsRelationsFrom(this.model.id);this._staticsLinked=k}return k}});return f});define("DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/WebViewerCoachMarkView",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/CoachMarkView","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/CoachMarkView.css"],function(e,b,c,a){var d=a.extend({modelEvents:{"change:V_DEL3DL_Url":"hideShowRules"},templateContext:function(){return b.extend(this.model.toJSON(),{iconPath:this.iconPath,infraCoachMarkImg:"webviewerContainerEmptyImg.svg",infraCoachMarkFocusImg:"webviewerContainerCoachMarkImg.svg",infraCoachMarkFocusRessource:c.getTranslation("coachmark_webviewer")})},_initialize:function(){},hideShowRules:function(){if(this.model.has("V_DEL3DL_Url")&&this.model.get("V_DEL3DL_Url").length>0){this.$el.hide();this.coachMarkHidden=true}else{this.$el.show();this.coachMarkHidden=false}}});return d});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/FollowUpSettingsView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/FollowUpSettingsView.template.html"],function(b,a,e,c){var d=a.extend({name:"FollowUpSettingsView",className:"settingsView",template:b.template(c),sideBarRadioChannel:e.channel("sidebar"),ui:{title:".title",url:".url",inputs:"input"},events:{"change @ui.title":"updateTitle","change @ui.url":"updateUrl","change @ui.inputs":"saveModel"},onAttach:function(){d.__super__.onAttach.apply(this)},updateUrl:function(){var g=this.getUI("url");var f=g.val();this.model.set("V_DEL3DL_Url",f)},onFavoriteSelected:function(f){d.__super__.onFavoriteSelected.call(this,f);this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}});return d});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/FollowUpView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/FollowUpSettingsView","DS/PDFjs/PDFjs","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Behaviors/HammerBehavior","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/FollowUpView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/FollowUpView.css"],function(e,f,k,j,i,h,a,b,g,d){var l=j.extend({className:"leangetView followUpView",template:k.template(d),behaviors:[{behaviorClass:g,usePanEvent:true,usePinchEvent:true,eventDirection:8|16,pinchPointers:2}],pdfDoc:null,renderInProgress:false,actualPageNum:1,oldScrollTop:0,oldScrollHeight:0,scale:2,width:80,extendModelEvents:{"change:V_DEL3DL_Url":"onURLChange"},initialize:function(m){j.prototype.initialize.apply(this,[m]);this.loadPageNumPending=[];this.onWheelDelegate=f.proxy(this.onWheel,this);this.onKeyPressDelegate=f.proxy(this.onKeyPress,this);this.onIntervalForLiveDelegate=f.proxy(this.onIntervalForLive,this);this.settingsView=a.createView(i,{model:this.model})},onDestroy:function(){},onBeforeCapture:function(){},onAfterCapture:function(){},switchToolbarSketch:function(){},onReload:function(){this.disableNavigation();this.render();this.enableNavigation();this.liveRefresh()},onURLChange:function c(){this.disableNavigation();this.render();this.enableNavigation();this.liveRefresh()},initPDFViewer:function(){var o=this;var n=o.pdfDoc.numPages;for(var m=0;m<n;++m){o.createPage()}o.loadPDFPage(0);o.loadPDFPage(1)},isPDFPageRendered:function(m){var n=f(".pdfjsPage",this.$el)[m];if(e.is(f("canvas",n)[0])){return true}return false},createPage:function(){var n=document.createElement("div");var m=document.createElement("div");n.className="pdfjsPage";m.className="pdfjsCanvasGhost";n.appendChild(m);this.containerEl.appendChild(n);return n},createCanvas:function(m){this.deleteCanvas(m);var o=f(".pdfjsPage",this.$el)[m];var n=document.createElement("canvas");n.className="pdfjsCanvas";o.dataset.pageNum=m;o.appendChild(n);f(".pdfjsCanvasGhost",o).hide();return n},removeUnusedCanvas:function(){var m=this;f(".pdfjsPage",m.$el).each(function(o,p){var n=Number(p.dataset.pageNum);if((n>(m.actualPageNum+2))!==(n<(m.actualPageNum-2))){m.deleteCanvas(n)}})},sizeCanvas:function(n,m,o){var p=f(".pdfjsPage",this.$el)[n];if(e.is(f("canvas",p)[0])){f("canvas",p)[0].height=m;f("canvas",p)[0].width=o;this.resizeGhosts()}},resizeGhosts:function(){var m=f(".pdfjsPage",this.$el)[this.actualPageNum];f(".pdfjsCanvasGhost").height(f("canvas",m).height())},deleteCanvas:function(m){var n=f(".pdfjsPage",this.$el)[m];if(e.is(n)&&e.is(f("canvas",n)[0])){n.removeChild(f("canvas",n)[0]);f(".pdfjsCanvasGhost",n).show()}},renderPDFPage:function(m){var o=this;var n=o.createCanvas(m);o.pdfDoc.getPage(m+1).then(function(s){var p=s.getViewport(o.scale);o.sizeCanvas(m,p.height,p.width);var r={canvasContext:n.getContext("2d"),viewport:p};var q=s.render(r);q.promise.then(f.proxy(o.loadPendingPDFPage,o))})},loadPendingPDFPage:function(){var m=this;if(m.loadPageNumPending.length>0){m.renderPDFPage(m.loadPageNumPending.shift())}else{m.renderInProgress=false}},loadPDFPage:function(m){var n=this;if(m<0||m>(n.pdfDoc.numPages-1)){return}n.queueLoadPDFPage(m)},queueLoadPDFPage:function(m){var n=this;if(!n.isPDFPageRendered(m)){if(n.renderInProgress){if(!n.loadPageNumPending.includes(m)){n.loadPageNumPending.push(m)}}else{n.renderInProgress=true;n.renderPDFPage(m)}}},onRender:function(){var o=this;o.containerEl=f(".pdfjsContainer",o.$el)[0];var n=b.getWebappsAssetUrl("DEL3DLeanViews","pdf");var m=e.is(this.model.get("V_DEL3DL_Url"))&&this.model.get("V_DEL3DL_Url")!==""?this.model.get("V_DEL3DL_Url"):n+"/testpdf.pdf";var p=h.getDocument(m);p.promise.then(function(q){o.oldScrollTop=0;o.oldScrollHeight=0;o.actualPageNum=0;o.pdfDoc=q;o.width=80;o.initPDFViewer()})},onMove:function(){var n=this;var m=f(".pdfjsPage",this.$el)[n.actualPageNum];var o=Math.round(this.containerEl.scrollTop/m.clientHeight);o=o>(n.pdfDoc.numPages-1)?(n.pdfDoc.numPages-1):o;if(o!==n.actualPageNum){n.actualPageNum=o;n.loadPDFPage(n.actualPageNum);n.loadPDFPage(n.actualPageNum-1);n.loadPDFPage(n.actualPageNum+1);clearTimeout(this.timeOufFct);n.timeOufFct=setTimeout(f.proxy(n.removeUnusedCanvas,n),5000)}},enableNavigation:function(){if(!this.isFocus){return}f(".pdfjsContainer",this.$el).addClass("activeNavigation");f(document).on("keyup keydown",this.onKeyPressDelegate);f(this.$el).on("mousewheel",this.onWheelDelegate);this.triggerMethod("view:enablePan",true);this.triggerMethod("view:enablePinch",true)},disableNavigation:function(){f(".pdfjsContainer",this.$el).removeClass("activeNavigation");f(document).off("keyup keydown",this.onKeyPressDelegate);f(this.$el).off("mousewheel",this.onWheelDelegate);this.triggerMethod("view:enablePan",false);this.triggerMethod("view:enablePinch",false)},setFocusView:function(m){j.prototype.setFocusView.apply(this,[m]);if(m){if(!e.getGlobal().inMeeting||(e.getGlobal().inMeeting&&e.getGlobal().isMeetingLeader)){this.enableNavigation();this.liveRefresh();if(e.getGlobal().inMeeting&&e.getGlobal().isMeetingLeader){this.intervalForLive=setInterval(this.onIntervalForLiveDelegate,1000)}}}else{this.disableNavigation();this.removeUnusedCanvas();clearInterval(this.intervalForLive)}},onKeyPress:function(m){if(m.key==="ArrowUp"||m.key==="ArrowDown"||m.key==="PageUp"||m.key==="PageDown"){this.onMove();this.onMoveLive()}},onWheel:function(){this.onMove();this.onMoveLive()},panEventCallback:function(n){var m=-n.deltaY/10;this.containerEl.scrollTop=this.containerEl.scrollTop+m;this.onMove();this.onMoveLive()},onZoomIn:function(){if(e.getGlobal().inMeeting&&!e.getGlobal().isMeetingLeader){return}this.width=this.width+10>90?90:this.width+10;f(".pdfjsPage",this.$el).css("width",this.width+"%");this.pinchEndEventCallback()},onZoomOut:function(){if(e.getGlobal().inMeeting&&!e.getGlobal().isMeetingLeader){return}this.width=this.width-10<20?20:this.width-10;f(".pdfjsPage",this.$el).css("width",this.width+"%");this.pinchEndEventCallback()},pinchInEventCallback:function(){this.width=this.width-0.5<20?20:this.width-0.5;f(".pdfjsPage",this.$el).css("width",this.width+"%")},pinchOutEventCallback:function(){this.width=this.width+0.5>90?90:this.width+0.5;f(".pdfjsPage",this.$el).css("width",this.width+"%")},pinchEndEventCallback:function(){this.resizeGhosts();this.onMove();this.onZoomLive()},onIntervalForLive:function(){this.liveRefresh()},onMoveLive:function(){if(e.getGlobal().inMeeting&&e.getGlobal().isMeetingLeader){this.liveIt("liveOnMove",[this.containerEl.scrollTop,this.containerEl.scrollHeight])}},onZoomLive:function(){if(e.getGlobal().inMeeting&&e.getGlobal().isMeetingLeader){this.liveIt("liveOnZoom",[this.width])}},liveRefresh:function(){this.onZoomLive();this.onMoveLive()},liveOnZoom:function(m){if(this.width!==m){this.width=m;f(".pdfjsPage",this.$el).css("width",this.width+"%");this.resizeGhosts()}},liveOnMove:function(o,n){var m=(this.containerEl.scrollHeight*o/n);if(this.containerEl.scrollTop!==m){this.containerEl.scrollTop=m;this.onMove()}}});return l});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/WebViewerSettingsView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/WebViewerSettingsView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/WebViewerSettingsView.css"],function(b,a,e,c){var d=a.extend({name:"WebViewerSettingsView",className:"settingsView",template:b.template(c),sideBarRadioChannel:e.channel("sidebar"),ui:{title:".title",url:".url",zoom:".zoom",indicator:".rangeindicator",inputs:"input"},events:{"change @ui.title":"updateTitle","change @ui.url":"updateUrl","input @ui.zoom":"updateZoomNoSave","change @ui.zoom":"updateZoom","change @ui.inputs":"saveModel"},onAttach:function(){d.__super__.onAttach.apply(this);this._updateIndicator()},updateUrl:function(){var g=this.getUI("url");var f=g.val();this.model.set("V_DEL3DL_Url",f)},updateZoomNoSave:function(){var g=this.getUI("zoom");var f=Number(g.val());this.getUI("indicator").text(f);this._updateIndicator(f)},updateZoom:function(){var g=this.getUI("zoom");var f=Number(g.val());this.model.set("V_DEL3DL_Zoom",f);this.getUI("indicator").text(f);this._updateIndicator(f)},_updateIndicator:function(g){g=g||this.model.get("V_DEL3DL_Zoom");var h=(g-0.1)/1.9;var f=Math.floor(h*30);this.getUI("indicator").css("left","calc("+h*100+"% - "+f+"px)")},onFavoriteSelected:function(f){d.__super__.onFavoriteSelected.call(this,f);this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}});return d});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/WebViewerView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","UWA/Core","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/Utils/UIUtils","pluginDS!DS/VEN3DLeanHTML2CanvasJS/HTML2CanvasJS.1.0.0.a12/html2canvas.min","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/WebViewerSettingsView","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/WebViewerCoachMarkView","DS/DEL3DLeanEnums/PostMessage.enum","DS/WebappsUtils/WebappsUtils","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/WebViewerView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/WebViewerView.css","css!DS/UIKIT/UIKIT.css"],function(h,E,k,w,B,v,n,z,x,c,o,g,f){var C=z.extend({className:"leangetView webViewerView",template:E.template(f),iconPath:g.getWebappsAssetUrl("DEL3DLeanViews","icons"),ui:{frame:"iframe"},extendModelEvents:{"change:V_DEL3DL_Url":"onURLChange","change:V_DEL3DL_Zoom":"resizeView"},postMessageRadioChannel:w.channel("postmessage"),initialize:function a(F){this._msgOrigin=undefined;this._msgSubscribed=[];window.addEventListener("message",h.proxy(this.onPostMessage,this),false);this.settingsView=n.createView(x,{model:this.model});this.coachMarkView=n.createView(c,{model:this.model,parentView:F.parentView});this.beforeSidePanelTransitionDelegate=h.proxy(this.beforeSidePanelTransition,this);this.afterSidePanelTransitionDelegate=h.proxy(this.afterSidePanelTransition,this);this.beforeMinimizeDelegate=h.proxy(this.beforeMinimize,this);this.afterFocusDelegate=h.proxy(this.afterFocus,this);C.__super__.initialize.call(this,F)},bindEvents:function b(){this.uiRadioChannel.on("before:sidePanelClose before:sidePanelOpen",this.beforeSidePanelTransitionDelegate);this.uiRadioChannel.on("after:sidePanelClose after:sidePanelOpen",this.afterSidePanelTransitionDelegate);this.staticRadioChannel.on("before:minimize",this.beforeMinimizeDelegate);this.staticRadioChannel.on("after:focus",this.afterFocusDelegate)},unbindEvents:function i(){this.uiRadioChannel.off("before:sidePanelClose before:sidePanelOpen",this.beforeSidePanelTransitionDelegate);this.uiRadioChannel.off("after:sidePanelClose after:sidePanelOpen",this.afterSidePanelTransitionDelegate);this.staticRadioChannel.off("before:minimize",this.beforeMinimizeDelegate);this.staticRadioChannel.off("after:focus",this.afterFocusDelegate)},switchToolbarSketch:function s(){},canCapture:function(){return this.isSameOrigin(this.model.get("V_DEL3DL_Url"))},onBeforeCapture:function(){h(h(".webviewerFrame",this.$el)[0]).contents().find("link").each(function(F,G){if(!G.attributes.href.nodeValue.startsWith("h")){G.attributes.href.nodeValue=G.href}});h(h(".webviewerFrame",this.$el)[0]).contents().find("img").each(function(F,G){if(!G.attributes.src.nodeValue.startsWith("h")){G.attributes.src.nodeValue=G.src}})},onAttach:function(){this.resizeView()},onAfterCapture:function(){},onRender:function j(){this.loadUrl();this.resizeView()},onURLChange:function e(){this.loadUrl()},onReload:function(){this.loadUrl()},loadUrl:function(){this.getUI("frame").load(h.proxy(function(){if(this.canCapture()){this.onBeforeCapture()}},this));var F=this.getUI("frame")[0];F.src=this.model.get("V_DEL3DL_Url")},resizeView:function q(K){if(this.forceMaximizeSize){return}if(this.model.hasUrl()){var F=this.getUI("frame");var G=Number(this.model.get("V_DEL3DL_Zoom"));if(!G||G<=0||G>2){G=1}if((this.isFocus===true&&this.model.hasUrl())||(K===true&&this.model.hasUrl())){F.css("height",(100/G)+"%");F.css("width",(100/G)+"%");F.css("transform","scale("+G+")")}else{var I;var H;var J=this.infraView._getParentStaticView();if(J.className==="pageView"&&!J.$el.hasClass("maximize")){I=1000/G;H=0.1*G}else{I=333/G;H=0.3*G}F.css("height",I+"%");F.css("width",I+"%");F.css("transform","scale("+H+")")}}},beforeSidePanelTransition:function r(){if(h(".mapView.focused").length>0||h(".pageView.focused").length>0){this.hideFrame()}},afterSidePanelTransition:function u(){if(h(".mapView.focused").length>0||h(".pageView.focused").length>0){this.showFrame()}},beforeMinimize:function m(G){if(h(".swipeTransition").length<=0&&!h(".mainView").hasClass("onGuidedMeeting")){if(k.is(G.focusView)&&k.is(G.unfocusView)){var F=this.infraView._getParentStaticView();if(G.focusView===this.infraView||G.unfocusView===this.infraView||G.focusView.className==="pageView"&&G.unfocusView.className==="mapView"&&F===G.focusView||G.focusView.className==="mapView"&&F.className==="pageView"&&F.maximized){this.hideFrame()}}}},afterFocus:function t(I){var F=this.getUI("frame");var G=k.is(F)&&F.css("display")==="none";if(G&&k.is(I.focusView)&&k.is(I.unfocusView)){var H=this.infraView._getParentStaticView();if(I.focusView===this.infraView||I.unfocusView===this.infraView||I.focusView.className==="pageView"&&I.unfocusView.className==="mapView"&&H===I.focusView||I.focusView.className==="mapView"&&H.className==="pageView"){if(h(".swipeTransition").length<=0&&!h(".mainView").hasClass("onGuidedMeeting")){this.showFrame()}this.resizeView()}}},showFrame:function D(){var F=this.getUI("frame");if(k.is(F)){F.css("display","block")}},hideFrame:function d(){var F=this.getUI("frame");if(k.is(F)){F.css("display","none")}},onPostMessage:function p(G){var F=undefined;try{F=JSON.parse(G.data)}catch(I){this._logger.warn("JSON format expected from: "+this.model.get("V_DEL3DL_Url"));return}if(h.type(F.type)!=="string"||!k.is(F.content)){this._logger.warn('JSON format expected with "type" and "content" keys from: '+this.model.get("V_DEL3DL_Url"));return}if(F.type==="subscribe"||F.type==="unsubscribe"){this._subscribe(F);F.content=this._msgSubscribed}this._msgOrigin=G.origin;this.postMessageRadioChannel.trigger("postmessage:"+F.type.toLowerCase(),F.content,this);var H=this.getUI("frame")[0];H.contentWindow.postMessage(JSON.stringify(F),this._msgOrigin)},onAfterFloatableDrop:function l(I,G,F){if(k.is(this._msgOrigin)&&o.isMatching(I.relatedTarget,this._msgSubscribed)){var J=this.getUI("frame")[0];var H=o.getMessageFromElem(I.relatedTarget,G,F);J.contentWindow.postMessage(H,this._msgOrigin)}},_subscribe:function y(G){var F=false;if(h.type(G.content)!=="array"||G.content.length<0){this._logger.warn("Bad postMessage format and/or content from: "+this.model.get("V_DEL3DL_Url"));return}F=G.type==="subscribe";if(E.indexOf(G.content,"all")>=0){if(F){this._msgSubscribed=o.getTypes()}else{this._msgSubscribed=[]}}else{if(F){this._msgSubscribed=E.union(this._msgSubscribed,G.content)}else{this._msgSubscribed=E.without(this._msgSubscribed,G.content)}}},setFocusView:function A(F){C.__super__.setFocusView.call(this,F);if(F===false){this.onCastContent(false)}},onCastContent:function(F){if(F){B.addClass(h(".mainView"),"onScreenshot");this.onBeforeCapture();setTimeout(h.proxy(function(){h(".webviewerContainerCasted",this.$el).css("display","block");this.captureDisplayAndCastContent()},this),0)}else{h(".webviewerContainerCasted",this.$el).css("background-image","url("+this.iconPath+"/LoadingEmpty.svg)");h(".webviewerContainerCasted",this.$el).css("background-size","10%");h(".webviewerContainer",this.$el).css("display","block");h(".webviewerContainerCasted",this.$el).css("display","none")}},captureDisplayAndCastContent:function(){var F=this;v(h(".webviewerContainer",F.$el)[0],{useCORS:true,allowTaint:true,letterRendering:true,imageTimeout:2000,logging:false,ignoreElements:function(G){if(G.classList.contains("infraView")&&!G.classList.contains("focused")){return true}if(G.classList.contains("sideViewContent")||G.classList.contains("changelogButton")||G.classList.contains("infraHeaderTools")||G.classList.contains("rowControls")||G.classList.contains("changelogButton")||G.classList.contains("sketchLeangetSketchButtonsToolBar")){return true}return false}}).then(function(G){var H=G.getContext("2d");H.webkitImageSmoothingEnabled=false;H.mozImageSmoothingEnabled=false;H.imageSmoothingEnabled=false;try{h(".webviewerContainerCasted",F.$el).css("background-image","url("+G.toDataURL()+")");h(".webviewerContainerCasted",F.$el).css("background-size","100% 100%");h(".webviewerContainer",F.$el).css("display","none");F.liveIt("liveOnCastContent",arguments,{args:[G.toDataURL()]})}catch(I){F._logger.error(I)}finally{B.removeClass(h(".mainView"),"onScreenshot");F.onAfterCapture()}})},liveOnCastContent:function(F){this.infraView.castContentButtonView.setChecked(true);h(".webviewerContainerCasted",this.$el).css("background-image","url("+F+")");h(".webviewerContainerCasted",this.$el).css("background-size","100% 100%");h(".webviewerContainer",this.$el).css("display","none");h(".webviewerContainerCasted",this.$el).css("display","block")}});return C});define("DS/DEL3DLeanViews/EditSticky/EditIssueDataView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Thumbnails/IssueThumbnailView","DS/DEL3DLeanCollectionViews/ThumbnailCollectionViews/ActionThumbnailCollectionView","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditIssueDataView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditIssueDataView.css"],function(c,d,j,i,b,a,g,e,f){var h=i.View.extend({childViewTriggers:{"editAction:select":"editIssue:select","editIssue:select":"editIssue:select","view:delete":"view:delete"},iconPath:b.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"editIssueDataView",ui:{title:"#title",inputs:"input",actionCounter:".editIssueDataActionsContainer>p>span",contentCounter:".editIssueDataContentsContainer>p>span"},regions:{titleRegion:".editIssueDataSelfTitle",dateRegion:".editIssueDataSelfDate",thumbnailRegion:".editIssueDataSelfThumbnail",actionsRegion:".editIssueDataActions",contentsRegion:".editIssueDataContents"},events:{"focusout @ui.title":"updateTitle"},template:j.template(f),templateContext:function(){return{get:d.proxy(this.model.get,this.model),getNLS:d.proxy(a.getTranslation,a),numberActions:this.getNumberActions()}},initialize:function(){this.$el.attr({id:this.cid});this.actionsCollection=this.getOption("actions");this.issueThumbnailView=new g({model:this.model,title:a.getTranslation("editIssueFiveWsTab"),callback:this.onFiveWsTabDelegate});this.actionsCollectionView=new e({collection:this.actionsCollection});this.updateActionCounter=d.proxy(this.updateActionCounter,this);this.actionsCollection.on("add remove",this.updateActionCounter)},onDestroy:function(){this.actionsCollection.off("add remove",this.updateActionCounter)},updateTitle:function(k){var l=k.target.value;this.model.save({V_DEL3DL_Title:l})},getNumberActions:function(){return this.actionsCollection.length},onRender:function(){this.showChildView("thumbnailRegion",this.issueThumbnailView);this.showChildView("actionsRegion",this.actionsCollectionView)},updateActionCounter:function(l,n,k){var m=this.getNumberActions();d(".editIssueDataActionsContainer>p>span",this.$el).html(m);if(k.add===true&&this.onSketchTab!==true){setTimeout(d.proxy(function(){this.actionsCollectionView.children.last().tapEventCallback()},this),0)}},onStopDraw:function(l,k){k.updateContent(l.model,l.actions)},onClear:function(k){k.clear()}});return h});define("DS/DEL3DLeanViews/Thumbnails/ActionThumbnailView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanHttpRequest/ImageService","DS/DEL3DLeanViews/Thumbnails/StickyThumbnailView","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/Thumbnails/ActionThumbnailView.template.html","css!DS/DEL3DLeanViews/assets/css/Thumbnails/ActionThumbnailView.css"],function(d,e,j,h,k,f,c,a,b,g){var i=k.extend({iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"thumbnailView actionThumbnailView",behaviors:[{behaviorClass:f,enableTapEvent:true,enablePressEvent:true,usePressEvent:true,useTapEvent:true,className:".actionNoteViewContent"}],template:j.template(g),initialize:function(l){k.prototype.initialize.apply(this,[l])},onRender:function(){k.prototype.onRender.apply(this,[])},onAttach:function(){this.constructor.__super__._dataUpdated.apply(this,arguments)},pressEventCallback:function(){this.tapEventCallback(event)},tapEventCallback:function(){this.triggerMethod("editAction:select",this)},_dataUpdated:function(n,l,m){this.constructor.__super__._dataUpdated.apply(this,arguments);if((l.V_DEL3DL_AssignedTeamName!==m.V_DEL3DL_AssignedTeamName)||(l.V_DEL3DL_ActionLogZone!==m.V_DEL3DL_ActionLogZone&&l.V_DEL3DL_ActionLogZone==="alDone")||(l.V_DEL3DL_Has_Context!==m.V_DEL3DL_Has_Context)){this._updateInformations()}},updateContent:function(m,l){if(!d.is(l)){l=this.model.get("V_DEL3DL_Sketch_Image")}if(h.isDataUrl(l)){e(".actionNoteViewContent",this.$el).css("background-image",'url("'+l+'")')}else{if(l){e(".actionNoteViewContent",this.$el).css("background-image",'url("'+this.iconPath+'/Loading.svg")');h.getImage(l).then(e.proxy(function(n){e(".actionNoteViewContent",this.$el).css("background-image",'url("'+n+'")')},this))}}},_updateInformations:function(){var l=undefined;if(this.model.isDone()){e(".postit-info-status-arrow",this.$el).hide();e(".postit-info-status",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/action_done.svg)");e(".postit-info-status",this.$el).addClass("action_done");e(".postit-info-status",this.$el).show()}else{if(this.model.isShared()){e(".postit-info-status",this.$el).attr("style","background-image: url("+this.iconPath+"/Loading.svg)");e(".postit-info-status",this.$el).show();if(this.model.isOurTeamAssigned()){l=this.model.get("owner");e(".postit-info-status-arrow",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/ArrowReception.png); left: -45%")}else{l=this.model.get("V_DEL3DL_AssignedTeamName");e(".postit-info-status-arrow",this.$el).attr("style","background-image: url("+this.iconPath+"/Floatable/ArrowSent.png); left: 45%")}var m=a.PEOPLES.sessionInstance.getOrFetch({name:l});if(!d.is(m)){e(".postit-info-status",this.$el).hide()}else{m.getPicture().then(e.proxy(function(n){e(".postit-info-status-arrow",this.$el).show();e(".postit-info-status",this.$el).attr("style","background-image: url("+n+")");e(".postit-info-status",this.$el).show()},this))}}else{e(".postit-info-status",this.$el).hide()}}if(this.model.get("V_DEL3DL_Has_Context")===true){e(".taskClipContent",this.$el).attr("src",this.iconPath+"/trombone.png");b.addClass(this.$el,"hasStaticLinked")}}});return i});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/KPISettingsView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/KPISettingsView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/KPISettingsView.css"],function(h,f,c,b,e,a,d){var g=b.extend({name:"KPISettingsView",template:c.template(d),className:"settingsView kpisettingsview",ui:{title:".title",yaxistitle:".yaxistitle",xaxistitle:".xaxistitle",yaxismin:".yaxismin",yaxismax:".yaxismax",objective:".objective",indicator:".rangeindicator",workingweek:'input:checkbox[name="workingweek"]',inputs:"input",objectiveBefore:".objectiveBefore",objectiveAfter:".objectiveAfter",snapprecision:".snapprecision"},regions:{aboveNocolor:{selector:".aboveColor.nocolor",replaceElement:true},aboveRed:{selector:".aboveColor.red",replaceElement:true},aboveOrange:{selector:".aboveColor.orange",replaceElement:true},aboveYellow:{selector:".aboveColor.yellow",replaceElement:true},aboveGreen:{selector:".aboveColor.green",replaceElement:true},aboveDarkGreen:{selector:".aboveColor.darkgreen",replaceElement:true},aboveBlue:{selector:".aboveColor.blue",replaceElement:true},abovePurple:{selector:".aboveColor.purple",replaceElement:true},belowNocolor:{selector:".belowColor.nocolor",replaceElement:true},belowRed:{selector:".belowColor.red",replaceElement:true},belowOrange:{selector:".belowColor.orange",replaceElement:true},belowYellow:{selector:".belowColor.yellow",replaceElement:true},belowGreen:{selector:".belowColor.green",replaceElement:true},belowDarkGreen:{selector:".belowColor.darkgreen",replaceElement:true},belowBlue:{selector:".belowColor.blue",replaceElement:true},belowPurple:{selector:".belowColor.purple",replaceElement:true}},events:{"change @ui.title":"updateTitle","change @ui.yaxistitle":"updateAxisTitles","change @ui.xaxistitle":"updateAxisTitles","change @ui.yaxismin":"updateMin","change @ui.yaxismax":"updateMax","input @ui.objective":"updateObjectiveNoSave","change @ui.objective":"updateObjective","change @ui.workingweek":"updateWorkingWeek","change @ui.snapprecision":"updatePrecision","change @ui.inputs":"saveModel"},templateContext:function(){var p=this.constructor.__super__.templateContext.call(this);p=c.extend(p,this.model.jsonData());var l=this.model.get("V_DEL3DL_Work_Week");var q=c.contains(l,1);var j=c.contains(l,2);var k=c.contains(l,3);var n=c.contains(l,4);var o=c.contains(l,5);var m=c.contains(l,6);var i=c.contains(l,0);return c.extend(p,{colors:["nocolor","red","orange","yellow","green","darkgreen","blue","purple"],hasMonday:q,hasTuesday:j,hasWednesday:k,hasThursday:n,hasFriday:o,hasSaturday:m,hasSunday:i})},initialize:function(){g.__super__.initialize.apply(this);this.initButtons()},initButtons:function(){var m=this.model.get("V_DEL3DL_Above_Color");var o=this.model.get("V_DEL3DL_Below_Color");var q="rgba(0, 0, 0, 0)";var l="rgb(248, 197, 201)";var j="rgb(255, 241, 208)";var r="rgb(234, 251, 196)";var k="rgb(198, 243, 213)";var i="rgb(211, 238, 252)";var p="rgb(208, 209, 255)";var n="rgb(255, 213, 244)";this.aboveNocolorButton=new e({mode:"radio",parentView:this,checked:m===q,iconChecked:"CheckedIcon.svg",actionName:"aboveNocolor",title:"",callback:f.proxy(this.onChangeColor,this)});this.aboveRedButton=new e({mode:"radio",parentView:this,checked:m===l,iconChecked:"CheckedIcon.svg",actionName:"aboveRed",title:"",callback:f.proxy(this.onChangeColor,this)});this.aboveOrangeButton=new e({mode:"radio",parentView:this,checked:m===j,iconChecked:"CheckedIcon.svg",actionName:"aboveOrange",title:"",callback:f.proxy(this.onChangeColor,this)});this.aboveYellowButton=new e({mode:"radio",parentView:this,checked:m===r,iconChecked:"CheckedIcon.svg",actionName:"aboveYellow",title:"",callback:f.proxy(this.onChangeColor,this)});this.aboveGreenButton=new e({mode:"radio",parentView:this,checked:m===k,iconChecked:"CheckedIcon.svg",actionName:"aboveGreen",title:"",callback:f.proxy(this.onChangeColor,this)});this.aboveDarkGreenButton=new e({mode:"radio",parentView:this,checked:m===i,iconChecked:"CheckedIcon.svg",actionName:"aboveDarkGreen",title:"",callback:f.proxy(this.onChangeColor,this)});this.aboveBlueButton=new e({mode:"radio",parentView:this,checked:m===p,iconChecked:"CheckedIcon.svg",actionName:"aboveBlue",title:"",callback:f.proxy(this.onChangeColor,this)});this.abovePurpleButton=new e({mode:"radio",parentView:this,checked:m===n,iconChecked:"CheckedIcon.svg",actionName:"abovePurple",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowNocolorButton=new e({mode:"radio",parentView:this,checked:o===q,iconChecked:"CheckedIcon.svg",actionName:"belowNocolor",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowRedButton=new e({mode:"radio",parentView:this,checked:o===l,iconChecked:"CheckedIcon.svg",actionName:"belowRed",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowOrangeButton=new e({mode:"radio",parentView:this,checked:o===j,iconChecked:"CheckedIcon.svg",actionName:"belowOrange",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowYellowButton=new e({mode:"radio",parentView:this,checked:o===r,iconChecked:"CheckedIcon.svg",actionName:"belowYellow",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowGreenButton=new e({mode:"radio",parentView:this,checked:o===k,iconChecked:"CheckedIcon.svg",actionName:"belowGreen",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowDarkGreenButton=new e({mode:"radio",parentView:this,checked:o===i,iconChecked:"CheckedIcon.svg",actionName:"belowDarkGreen",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowBlueButton=new e({mode:"radio",parentView:this,checked:o===p,iconChecked:"CheckedIcon.svg",actionName:"belowBlue",title:"",callback:f.proxy(this.onChangeColor,this)});this.belowPurpleButton=new e({mode:"radio",parentView:this,checked:o===n,iconChecked:"CheckedIcon.svg",actionName:"belowPurple",title:"",callback:f.proxy(this.onChangeColor,this)})},onChangeColor:function(l){var k=l.$el.attr("class").indexOf("above")>-1;var i=l.$el.css("background-color");var j=i;if(!h.is(j)||j==="rgba(0, 0, 0, 0)"){j="lightgray"}if(k){this.getUI("objectiveAfter").css("background",j);this.model.set("V_DEL3DL_Above_Color",i)}else{this.getUI("objectiveBefore").css("background",j);this.model.set("V_DEL3DL_Below_Color",i)}this.saveModel()},onAttach:function(){g.__super__.onAttach.apply(this);this.bind()},onDetach:function(){g.__super__.onDetach.apply(this);this.unbind();var j=this.getUI("yaxismin");var i=this.getUI("yaxismax");j.val(this.model.get("V_DEL3DL_Y_Axis_Min"));i.val(this.model.get("V_DEL3DL_Y_Axis_Max"));a.removeClass(j,"error");a.removeClass(i,"error")},onBeforeRender:function(){this.initButtons()},onRender:function(){this.bind()},bind:function(){this._updateIndicator();this.showChildView("aboveNocolor",this.aboveNocolorButton);this.showChildView("aboveRed",this.aboveRedButton);this.showChildView("aboveOrange",this.aboveOrangeButton);this.showChildView("aboveYellow",this.aboveYellowButton);this.showChildView("aboveGreen",this.aboveGreenButton);this.showChildView("aboveDarkGreen",this.aboveDarkGreenButton);this.showChildView("aboveBlue",this.aboveBlueButton);this.showChildView("abovePurple",this.abovePurpleButton);this.showChildView("belowNocolor",this.belowNocolorButton);this.showChildView("belowRed",this.belowRedButton);this.showChildView("belowOrange",this.belowOrangeButton);this.showChildView("belowYellow",this.belowYellowButton);this.showChildView("belowGreen",this.belowGreenButton);this.showChildView("belowDarkGreen",this.belowDarkGreenButton);this.showChildView("belowBlue",this.belowBlueButton);this.showChildView("belowPurple",this.belowPurpleButton);var j=this.model.get("V_DEL3DL_Above_Color").replace("rgba(0, 0, 0, 0)","lightgray");var i=this.model.get("V_DEL3DL_Below_Color").replace("rgba(0, 0, 0, 0)","lightgray");this.getUI("objectiveAfter").css("background",j);this.getUI("objectiveBefore").css("background",i)},unbind:function(){this.detachChildView("aboveNocolor",this.aboveNocolorButton);this.detachChildView("aboveRed",this.aboveRedButton);this.detachChildView("aboveOrange",this.aboveOrangeButton);this.detachChildView("aboveYellow",this.aboveYellowButton);this.detachChildView("aboveGreen",this.aboveGreenButton);this.detachChildView("aboveDarkGreen",this.aboveDarkGreenButton);this.detachChildView("aboveBlue",this.aboveBlueButton);this.detachChildView("abovePurple",this.abovePurpleButton);this.detachChildView("belowNocolor",this.belowNocolorButton);this.detachChildView("belowRed",this.belowRedButton);this.detachChildView("belowOrange",this.belowOrangeButton);this.detachChildView("belowYellow",this.belowYellowButton);this.detachChildView("belowGreen",this.belowGreenButton);this.detachChildView("belowDarkGreen",this.belowDarkGreenButton);this.detachChildView("belowBlue",this.belowBlueButton);this.detachChildView("belowPurple",this.belowPurpleButton)},updateAxisTitles:function(k){var j=f(k.target);var l=j.val();var i=j.data("key");this.model.set(i,l);return{key:i,value:l}},updateGraphic:function(k){var j=f(k.target);var l=Number(j.val());var i=j.data("key");this.model.set(i,l);return{key:i,value:l}},updateMin:function(m){var l=f(m.target);var n=Number(l.val());var j=this.model.get("V_DEL3DL_Y_Axis_Max");if(n>=j){a.addClass(l,"error")}else{a.removeClass(l,"error");var i=this.updateGraphic(m);var k=this.model.get("V_DEL3DL_Target");n=Number(i.value);if(k<n){this._updateObjective(n)}this.getUI("objective").attr("min",n);this._updateIndicator()}},updateMax:function(m){var l=f(m.target);var n=Number(l.val());var k=this.model.get("V_DEL3DL_Y_Axis_Min");if(n<=k){a.addClass(l,"error")}else{a.removeClass(l,"error");var i=this.updateGraphic(m);var j=this.model.get("V_DEL3DL_Target");n=Number(i.value);if(j>n){this._updateObjective(n)}this.getUI("objective").attr("max",i.value);this._updateIndicator()}},updateObjectiveNoSave:function(l){var k=f(l.target);var m=Number(k.val());var j=k.data("key");var i={key:j,value:m};this.getUI("indicator").text(i.value);this._updateIndicator(i.value)},updateObjective:function(j){var i=this.updateGraphic(j);this.getUI("indicator").text(i.value);this._updateIndicator(i.value)},updateWorkingWeek:function(i){var r=f(i.target);var o=Number(r.val());var p=r.is(":checked");var l=this.model.get("V_DEL3DL_Work_Week")||[];l=c.uniq(l);if(p){l.push(o)}else{if(l.length>1){l=c.without(l,o)}else{r.prop("checked",true);return}}this.model.set("V_DEL3DL_Work_Week",l);var k=this.model.get("V_DEL3DL_Graph_Data");if(h.is(k)){var q=undefined;var n=undefined;if(l.length<7){q=k[k.length-1];n=new Date(q.x).getDay();var j=q.x;if(!p&&o===n){var m=q.y;q.y=null;do{j+=86400000;n=(n+1)%7;k.push({x:j,y:null})}while(!c.contains(l,n));q=k[k.length-1];q.y=m}}q=k[k.length-2];n=new Date(q.x).getDay();if(p&&o===n){while(!q.y){q=k.pop();k[k.length-1].y=q.y;q=k[k.length-2]}}this.model.set("V_DEL3DL_Graph_Data",k)}},updatePrecision:function(j){var i=f(j.target);var k=Number(i.val());if(k<0){i.val(this.model.get("V_DEL3DL_Round_Value"))}else{this.model.set("V_DEL3DL_Round_Value",k)}},_updateObjective:function(i){this.getUI("objective").val(i);this.getUI("indicator").text(i);this.model.set("V_DEL3DL_Round_Value",i)},_updateIndicator:function(k){var i=this.model.get("V_DEL3DL_Y_Axis_Min");var m=this.model.get("V_DEL3DL_Y_Axis_Max");k=k||this.model.get("V_DEL3DL_Target");var l=(k-i)/(m-i);var j=Math.floor(l*30);this.getUI("indicator").css("left","calc("+l*100+"% - "+j+"px)");this.getUI("objectiveBefore").css("width",l*100+"%");this.getUI("objectiveAfter").css({left:l*100+"%",width:100-l*100+"%"})}});return g});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/PlayerSettingsView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/PlayerSettingsView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/SettingsView.css"],function(b,a,e,c){var d=a.extend({name:"PlayerSettingsView",className:"settingsView",template:b.template(c),sideBarRadioChannel:e.channel("sidebar"),ui:{title:".title",url:".url",inputs:"input"},events:{"change @ui.title":"updateTitle","change @ui.url":"updateUrl","change @ui.inputs":"saveModel"},updateUrl:function(){var f=this.getUI("url");var g=f.val();this.model.set("V_DEL3DL_Url",g)},onFavoriteSelected:function(f){d.__super__.onFavoriteSelected.call(this,f);this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}});return d});define("DS/DEL3DLeanViews/SideBar/MapButtonView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","text!DS/DEL3DLeanViews/assets/template/SideBar/MapButtonView.template.html","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/Components/ButtonView","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","css!DS/DEL3DLeanViews/assets/css/SideBar/MapButtonView.css"],function(c,d,h,g,a,e,b,f,i){var j=g.View.extend({behaviors:[{behaviorClass:e,useTapEvent:true,enableTapEvent:true,usePressEvent:true,enablePressEvent:true,className:".navigateM"}],className:"mapButtonView",regions:{navigateNButtonRegion:{el:".navigateN",replaceElement:false},navigateEButtonRegion:{el:".navigateE",replaceElement:false},navigateWButtonRegion:{el:".navigateW",replaceElement:false},navigateSButtonRegion:{el:".navigateS",replaceElement:false}},events:{},triggers:{},childViewEvents:{"buttonView:clicked":"onNavigateClick"},radioChannel:i.channel("sidebar"),template:h.template(a),initialize:function(){b.addClass(this.$el,"onMap");this.actionName=this.getOption("actionName");this.updateMapButtonDelegate=d.proxy(this.updateMapButton,this);this.updateMapButtonAvailabilityDelegate=d.proxy(this.updateMapButtonAvailability,this);this.bindEvents();this.navigateNButtonView=new f({icon:"navigate_down.svg",actionName:"N"});this.navigateEButtonView=new f({icon:"navigate_down.svg",actionName:"E"});this.navigateWButtonView=new f({icon:"navigate_down.svg",actionName:"W"});this.navigateSButtonView=new f({icon:"navigate_down.svg",actionName:"S"})},getActionName:function(){return this.actionName},bindEvents:function(){this.radioChannel.on("mapButton:updateMapButtonAvailability",this.updateMapButtonAvailabilityDelegate);this.radioChannel.on("mapButton:updateMapButton",this.updateMapButtonDelegate)},unbindEvents:function(){this.radioChannel.off("mapButton:updateMapButtonAvailability",this.updateMapButtonAvailabilityDelegate);this.radioChannel.off("mapButton:updateMapButton",this.updateMapButtonDelegate)},onShow:function(){},onAttach:function(){},onRender:function(){this.showChildView("navigateNButtonRegion",this.navigateNButtonView);this.showChildView("navigateEButtonRegion",this.navigateEButtonView);this.showChildView("navigateWButtonRegion",this.navigateWButtonView);this.showChildView("navigateSButtonRegion",this.navigateSButtonView)},onDestroy:function(){this.radioChannel.off("mapButton:updateMapButton",this.updateMapButtonDelegate)},onNavigateClick:function(m,k){this.navigateNButtonView.triggerMethod("view:enableTap",false);this.navigateNButtonView.triggerMethod("view:enablePress",false);this.navigateEButtonView.triggerMethod("view:enableTap",false);this.navigateEButtonView.triggerMethod("view:enablePress",false);this.navigateWButtonView.triggerMethod("view:enableTap",false);this.navigateWButtonView.triggerMethod("view:enablePress",false);this.navigateSButtonView.triggerMethod("view:enableTap",false);this.navigateSButtonView.triggerMethod("view:enablePress",false);setTimeout(d.proxy(function(){this.navigateNButtonView.triggerMethod("view:enableTap",true);this.navigateNButtonView.triggerMethod("view:enablePress",true);this.navigateEButtonView.triggerMethod("view:enableTap",true);this.navigateEButtonView.triggerMethod("view:enablePress",true);this.navigateWButtonView.triggerMethod("view:enableTap",true);this.navigateWButtonView.triggerMethod("view:enablePress",true);this.navigateSButtonView.triggerMethod("view:enableTap",true);this.navigateSButtonView.triggerMethod("view:enablePress",true)},this),1000);var l;if(k==="E"){l={direction:2}}else{if(k==="S"){l={direction:8}}else{if(k==="N"){l={direction:16}}else{if(k==="W"){l={direction:4}}}}}this.radioChannel.trigger("sideBarView:navigate",l)},updateMapButtonAvailability:function(n){b.removeClass(d(".X0Y0",this.$el),"mapButtonAvailable");b.removeClass(d(".X0Y1",this.$el),"mapButtonAvailable");b.removeClass(d(".X0Y2",this.$el),"mapButtonAvailable");b.removeClass(d(".X1Y0",this.$el),"mapButtonAvailable");b.removeClass(d(".X1Y1",this.$el),"mapButtonAvailable");b.removeClass(d(".X1Y2",this.$el),"mapButtonAvailable");b.removeClass(d(".X2Y0",this.$el),"mapButtonAvailable");b.removeClass(d(".X2Y1",this.$el),"mapButtonAvailable");b.removeClass(d(".X2Y2",this.$el),"mapButtonAvailable");for(var l in n.models){var k=n.models[l];if(c.is(k)&&k.serverType!=="DEL3DL_Link"&&k.has("V_DEL3DL_X")){var p=k.get("V_DEL3DL_X");var o=k.get("V_DEL3DL_Y");var m="X"+p+"Y"+o;b.addClass(d("."+m,this.$el),"mapButtonAvailable")}}},updateMapButton:function(m){var o=d(".on",this.$el);if(o.length>0){b.removeClass(o,"on")}if(c.is(m)){b.removeClass(d(".navigateN",this.$el),"arrowAvailable");b.removeClass(d(".navigateS",this.$el),"arrowAvailable");b.removeClass(d(".navigateE",this.$el),"arrowAvailable");b.removeClass(d(".navigateW",this.$el),"arrowAvailable");b.removeClass(this.$el,"onMap");var r=m.get("V_DEL3DL_X");var p=m.get("V_DEL3DL_Y");var k=m.get("V_DEL3DL_Size_X");var q=m.get("V_DEL3DL_Size_Y");var l;var n="X"+r+"Y"+p;b.addClass(d("."+n,this.$el),"on");if(r>=0){l="X"+(Number(r)-1)+"Y"+p;if(d("."+l,this.$el).hasClass("mapButtonAvailable")){b.addClass(d(".navigateW",this.$el),"arrowAvailable")}}if(p>=0){l="X"+r+"Y"+(Number(p)-1);if(d("."+l,this.$el).hasClass("mapButtonAvailable")){b.addClass(d(".navigateN",this.$el),"arrowAvailable")}}if(r<=2){l="X"+(Number(r)+1)+"Y"+p;if(d("."+l,this.$el).hasClass("mapButtonAvailable")){b.addClass(d(".navigateE",this.$el),"arrowAvailable")}}if(p<=2){l="X"+r+"Y"+(Number(p)+1);if(d("."+l,this.$el).hasClass("mapButtonAvailable")){b.addClass(d(".navigateS",this.$el),"arrowAvailable")}}if(q>=2&&k>=2){n="X"+(r+1)+"Y"+(p+1);b.addClass(d("."+n,this.$el),"on")}if(k>=2){n="X"+(r+1)+"Y"+p;b.addClass(d("."+n,this.$el),"on")}if(q>=2){n="X"+r+"Y"+(p+1);b.addClass(d("."+n,this.$el),"on")}}else{b.addClass(this.$el,"onMap")}},pressEventCallback:function(k){this.tapEventCallback(k)},tapEventCallback:function(){this.triggerMethod("buttonView:clicked",this,this.actionName)}});return j});define("DS/DEL3DLeanViews/CurrentMeetingView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/CurrentMeetingView.template.html","DS/DEL3DLeanCollectionViews/MeetingLeangetCollectionView","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanHttpRequest/MessageHandler","DS/DEL3DLeanViews/Components/ButtonView","css!DS/DEL3DLeanViews/assets/css/CurrentMeetingView.css"],function(c,d,k,j,f,l,h,g,b,i,e){var a=f.View.extend({meetingLeangetCollectionView:null,className:"currentMeetingView",regions:{meetingLeangetCollectionRegion:{selector:".meetingLeangetCollectionView",replaceElement:true},previousButtonRegion:{selector:".previousButtonView"},nextButtonRegion:{selector:".nextButtonView"}},events:{},template:k.template(h),sideBarRadioChannel:l.channel("sidebar"),meetingRadioChannel:l.channel("meeting"),staticRadioChannel:l.channel("static"),socketChannel:l.channel("live"),initialize:function(){this.resetAndEndMeetingDelegate=d.proxy(this.resetAndEndMeeting,this);this.previousDelegate=d.proxy(this.previousLeanget,this);this.nextDelegate=d.proxy(this.nextLeanget,this);this.selectDelegate=d.proxy(this.selectLeanget,this);this.onSocketSelectLeangetDelegate=d.proxy(this.onSocketSelectLeanget,this);this.meetingLeangetCollection=new j.Collection();this.meetingLeangetCollectionView=new g({collection:this.meetingLeangetCollection});this.previousButtonView=new e({icon:"navigate_down.svg",actionName:"previousLGT",callback:this.previousDelegate,securityTap:true});this.nextButtonView=new e({icon:"navigate_down.svg",actionName:"nextLGT",callback:this.nextDelegate,securityTap:true})},onShow:function(){},onRender:function(){this.showChildView("meetingLeangetCollectionRegion",this.meetingLeangetCollectionView)},prepareMeeting:function(m){if(c.getGlobal().isMeetingLeader===true){this.showChildView("previousButtonRegion",this.previousButtonView);this.showChildView("nextButtonRegion",this.nextButtonView)}this.$el.removeClass("hideCurrentMeetingView");this.$el.attr("style","");this.currentIndex=0;this.indexVisited=[];this.selectedleangetCollectionView=m;this.meetingRadioChannel.on("meeting:previousLeanget",this.previousDelegate);this.meetingRadioChannel.on("meeting:nextLeanget",this.nextDelegate);this.meetingRadioChannel.on("meeting:selectLeanget",this.selectDelegate);this.meetingRadioChannel.on("meeting:resetAndEndMeeting",this.resetAndEndMeetingDelegate);this.socketChannel.on("guidedmeeting:selectLeanget",this.onSocketSelectLeangetDelegate);for(var n=0;n<m.collection.length;++n){var o=m.collection.models[n];this.meetingLeangetCollection.add(o);d(".roadMap",this.$el).append("<div class='roadMapStop' data-id='"+n+"'></div>");if(n===0){b.addClass(d(".roadMapStop[data-id='"+n+"']",this.$el),"current")}}this.meetingLeangetCollectionView.initMeetingCollection();this.previousButtonView.$el.hide();if(this.meetingLeangetCollectionView.children.length>1){this.nextButtonView.$el.show()}else{this.nextButtonView.$el.hide()}},resetAndEndMeeting:function(){this.staticRadioChannel.once("after:unFocus",d.proxy(function(){this.meetingRadioChannel.off("meeting:previousLeanget",this.previousDelegate);this.meetingRadioChannel.off("meeting:nextLeanget",this.nextDelegate);this.meetingRadioChannel.off("meeting:selectLeanget",this.selectDelegate);this.meetingRadioChannel.off("meeting:resetAndEndMeeting",this.resetAndEndMeetingDelegate);this.socketChannel.off("guidedmeeting:selectLeanget",this.onSocketSelectLeangetDelegate);d(".roadMap",this.$el).empty();this.meetingLeangetCollection.remove(this.meetingLeangetCollection.models);this.meetingRadioChannel.trigger("meeting:endMeeting")},this));this.staticRadioChannel.trigger("before:minimize",{focusView:null,unfocusView:null});this.staticRadioChannel.trigger("before:focus",{focusView:null,unfocusView:null});this.detachChildView("previousButtonRegion");this.detachChildView("nextButtonRegion")},previousLeanget:function(){if(this.currentIndex>0){this.selectLeanget(this.currentIndex-1)}},nextLeanget:function(){if(this.currentIndex<(this.meetingLeangetCollectionView.children.length-1)){this.selectLeanget(this.currentIndex+1)}},selectLeanget:function(m){if(m!==this.currentIndex&&m<(this.meetingLeangetCollectionView.children.length)){if(this.indexVisited.indexOf(this.currentIndex)===-1){this.indexVisited.push(this.currentIndex)}b.addClass(d(".roadMapStop[data-id='"+this.currentIndex+"']",this.$el),"visited");b.removeClass(d(".roadMapStop[data-id='"+this.currentIndex+"']",this.$el),"current");this.currentIndex=m;b.addClass(d(".roadMapStop[data-id='"+this.currentIndex+"']",this.$el),"current");if(c.getGlobal().isMeetingLeader){i.send({eventType:"guidedmeeting:selectLeanget",indexSelected:this.currentIndex,indexVisited:this.indexVisited},{welcomeAction:"add"})}this.meetingLeangetCollectionView.selectMeetingLeanget(m);this.selectedleangetCollectionView.onGuidedMeetingLeangetFocused(m);if(this.meetingLeangetCollectionView.focusLeangetIndex>0){this.previousButtonView.$el.show()}else{this.previousButtonView.$el.hide()}if(this.meetingLeangetCollectionView.focusLeangetIndex<(this.meetingLeangetCollectionView.children.length-1)){this.nextButtonView.$el.show()}else{this.nextButtonView.$el.hide()}}},onSocketSelectLeanget:function(n){if(this.indexVisited.length===0){for(var m=0;n.indexVisited.length>m;++m){var o=n.indexVisited[m];b.addClass(d(".roadMapStop[data-id='"+o+"']",this.$el),"visited");this.selectedleangetCollectionView.onGuidedMeetingLeangetVisited(m)}}if(this.currentIndex!==n.indexSelected){this.selectLeanget(n.indexSelected)}}});return a});define("DS/DEL3DLeanViews/EditSticky/EditActionDataView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Thumbnails/ActionThumbnailView","DS/DEL3DLeanViews/Utils/TaskUtils","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditActionDataView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditActionDataView.css"],function(d,g,e,i,b,a,f,h,c){var j=e.View.extend({childViewTriggers:{"editAction:select":"editAction:select","view:delete":"view:delete"},iconPath:b.getWebappsAssetUrl("DEL3DLeanViews","icons"),className:"editActionDataView",ui:{title:"#title",inputs:"input"},regions:{titleRegion:".editActionDataSelfTitle",dateRegion:".editActionDataSelfDate",thumbnailRegion:".editActionDataSelfThumbnail"},events:{"focusout @ui.title":"updateTitle"},modelEvents:{"change:V_DEL3DL_Data":"dataUpdated"},template:g.template(c),templateContext:function(){return{get:d.proxy(this.model.get,this.model),getNLS:d.proxy(a.getTranslation,a)}},initialize:function(){this.$el.attr({id:this.cid});this.actionThumbnailView=new f({model:this.model,title:a.getTranslation("editIssueFiveWsTab"),callback:this.onFiveWsTabDelegate})},dataUpdated:function(m){var k=JSON.parse(m.attributes.V_DEL3DL_Data);var l=JSON.parse(m._previousAttributes.V_DEL3DL_Data);if(k.V_DEL3DL_Title!==l.V_DEL3DL_Title){d(".editActionDataSelfTitle #title",this.$el).val(k.V_DEL3DL_Title)}},updateTitle:function(k){var l=k.target.value;this.model.save({V_DEL3DL_Title:l});h._stickyTitleUpdated(this.model)},onRender:function(){this.showChildView("thumbnailRegion",this.actionThumbnailView)},onStopDraw:function(k){this.actionThumbnailView.updateContent(k.model,k.actions)},onClear:function(){this.actionThumbnailView.clear()}});return j});define("DS/DEL3DLeanViews/SideBar/SideBarView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/assets/enums/SideBarActionEnum","DS/DEL3DLeanResources/ResourcesManager","text!DS/DEL3DLeanViews/assets/template/SideBar/SideBarView.template.html","DS/DEL3DLeanViews/SideBar/MapButtonView","DS/DEL3DLeanViews/Utils/UIUtils","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanHttpRequest/MessageHandler","css!DS/DEL3DLeanViews/assets/css/SideBar/SideBarView.css"],function(e,g,l,j,m,h,i,b,f,n,a,c,k){var d=j.View.extend({meetingButtonView:null,customizeButtonView:null,toolsButtonView:null,deleteButtonView:null,mapButtonView:null,isAskingValidation:false,className:"sideBarView",sideBarDate:new Date(),regions:{meetingButtonRegion:{el:".meetingButton",replaceElement:true},toolsButtonRegion:{el:".toolsButton",replaceElement:true},customizeButtonRegion:{el:".customizeButton",replaceElement:true},deleteButtonRegion:{el:".deleteButton",replaceElement:true},mapButtonRegion:{el:".mapButton",replaceElement:true},endMeetingButtonRegion:{el:".endMeetingButtonView",replaceElement:true}},ui:{deleteButtonLabel:"#deleteButtonLabel",deleteValidateButtonLabel:"#deleteValidateButtonLabel",customizeButton:".sideBarButton.customizeMenu",nbUsersConnected:".sidebarMeetingNbUser"},events:{},childViewEvents:{"buttonView:clicked":"onSideBarButtonClicked"},sideBarRadioChannel:m.channel("sidebar"),staticRadioChannel:m.channel("static"),liveRadioChannel:m.channel("live"),securityTapEnabled:false,template:l.template(f),iconPath:c.getWebappsAssetUrl("DEL3DLeanViews","icons"),templateContext:function(){var o=[b.getTranslation("JAN"),b.getTranslation("FEB"),b.getTranslation("MAR"),b.getTranslation("APR"),b.getTranslation("MAY"),b.getTranslation("JUN"),b.getTranslation("JUL"),b.getTranslation("AUG"),b.getTranslation("SEP"),b.getTranslation("OCT"),b.getTranslation("NOV"),b.getTranslation("DEC")];return{meetingButtonLabel:b.getTranslation("meetingButtonLabel"),toolsButtonLabel:b.getTranslation("toolsButtonLabel"),customizeButtonLabel:b.getTranslation("customizeButtonLabel"),deleteButtonLabel:b.getTranslation("selectButtonLabel"),deleteValidateButtonLabel:b.getTranslation("deleteValidateButtonLabel"),sideBarSide:this.getOption("side"),sideBarCalendarDay:this.sideBarDate.getDate(),sideBarCalendarMonth:o[this.sideBarDate.getMonth()],sideBarCalendarHour:("0"+this.sideBarDate.getHours()).slice(-2),sideBarCalendarMinute:("0"+this.sideBarDate.getMinutes()).slice(-2)}},initialize:function(){this.updateNbUsersDelegate=g.proxy(this.updateNbUsers,this);this.floatableElementSelectedDelegate=g.proxy(this.floatableElementSelected,this);this.beforeUnFocusViewDelegate=g.proxy(this.beforeUnFocusView,this);this.startMeetingChronoDelegate=g.proxy(this.startMeetingChrono,this);this.endMeetingChronoDelegate=g.proxy(this.endMeetingChrono,this);this.afterFocusViewDelegate=g.proxy(this.afterFocusView,this);this.openMenuDelegate=g.proxy(this.openMenu,this);this.liveMeetingPreparationDelegate=g.proxy(this.liveMeetingPreparation,this);this.meetingButtonView=new h({icon:"SideBar/SideBarActionMeeting.svg",actionName:i.MEETING,mode:"checkbox",iconChecked:"SideBar/SideBarActionOnMeetingInPreparation.svg",manualyCheck:true});this.customizeButtonView=new h({icon:"SideBar/SideBarActionCustomize.svg",actionName:i.CUSTOMIZE});this.toolsButtonView=new h({icon:"SideBar/SideBarActionStickies.svg",actionName:i.STICKIES});this.deleteButtonView=new h({icon:"SideBar/SideBarActionDeleteAll.svg",mode:"checkbox",iconChecked:"SideBar/SideBarActionDeleteSelected.svg",actionName:i.DELETEALL,manualyCheck:true});this.mapButtonView=new n({actionName:i.MAP});this.bindEvents();widget.addEvent("endEdit",g.proxy(this.onPreferencesEdited,this));if(this.getOption("side")==="right"){this.dateTimeTimeout=setTimeout(g.proxy(this._updateTime,this),60001)}},bindEvents:function(){this.liveRadioChannel.on("user:connection",this.updateNbUsersDelegate);this.liveRadioChannel.on("user:disconnection",this.updateNbUsersDelegate);this.staticRadioChannel.on("before:unFocus",this.beforeUnFocusViewDelegate);this.staticRadioChannel.on("after:focus",this.afterFocusViewDelegate);this.sideBarRadioChannel.on("floatableView:floatableElementSelected",this.floatableElementSelectedDelegate);this.sideBarRadioChannel.on("sideBarView:openMenu",this.openMenuDelegate);this.sideBarRadioChannel.on("sideBarView:startMeetingChrono",this.startMeetingChronoDelegate);this.sideBarRadioChannel.on("sideBarView:endMeetingChrono",this.endMeetingChronoDelegate);this.sideBarRadioChannel.on("sideBarView:liveMeetingPreparation",this.liveMeetingPreparationDelegate)},unbindEvents:function(){this.liveRadioChannel.off("user:connection",this.updateNbUsersDelegate);this.liveRadioChannel.off("user:disconnection",this.updateNbUsersDelegate);this.staticRadioChannel.off("before:unFocus",this.beforeUnFocusViewDelegate);this.staticRadioChannel.off("after:focus",this.afterFocusViewDelegate);this.sideBarRadioChannel.off("floatableView:floatableElementSelected",this.floatableElementSelectedDelegate);this.sideBarRadioChannel.off("sideBarView:openMenu",this.openMenuDelegate);this.sideBarRadioChannel.off("sideBarView:startMeetingChrono",this.startMeetingChronoDelegate);this.sideBarRadioChannel.off("sideBarView:endMeetingChrono",this.endMeetingChronoDelegate);this.sideBarRadioChannel.off("sideBarView:liveMeetingPreparation",this.liveMeetingPreparationDelegate)},beforeUnFocusView:function(){this.disableSideBar=true},afterFocusView:function(){this.disableSideBar=false},openMenu:function(o,p){if(o===this.getOption("side")){this.onSideBarButtonClicked(null,p)}},onSideBarButtonClicked:function(q,o){if(this.disableSideBar||g(".sideView").hasClass("sideViewTransition")){return}switch(o){case i.DELETEALL:if(this.deleteButtonView.getChecked()){this.sideBarRadioChannel.trigger("sideBarView:delete")}else{this.sideBarRadioChannel.trigger("sideBarView:selectAll")}break;case i.MAP:this.sideBarRadioChannel.trigger("sideBarView:openMap");break;case i.CUSTOMIZE:case i.MEETING:case i.STICKIES:a.addClass(g(".sideView"),"sideViewTransition");var p;if(o===i.CUSTOMIZE){p="sideBarView:customize"}else{if(o===i.MEETING){p="sideBarView:meetingPreparation"}else{if(o===i.STICKIES){p="sideBarView:tools"}}}this.triggerMethod("sideBarView:openPanel",o,p);break;case"endMeetingButtonView":this.sideBarRadioChannel.trigger("sideBarView:endMeeting");break;default:}},onAttach:function(){this._updateCustomizationAvailability()},onDestroy:function(){this.sideBarRadioChannel.off("floatableView:floatableElementSelected")},onRender:function(){this.showChildView("meetingButtonRegion",this.meetingButtonView);this.showChildView("toolsButtonRegion",this.toolsButtonView);this.showChildView("customizeButtonRegion",this.customizeButtonView);this.showChildView("deleteButtonRegion",this.deleteButtonView);this.showChildView("mapButtonRegion",this.mapButtonView)},onPreferencesEdited:function(){this._updateCustomizationAvailability()},updateNbUsers:function(){var o=k.getNbUsersConnected();if(o>1){this.getUI("nbUsersConnected").html(o);this.getUI("nbUsersConnected").show()}else{this.getUI("nbUsersConnected").hide()}},floatableElementSelected:function(o){if(o>0){g(".sidebarDeleteSelectedNb",this.$el).html(o);a.addClass(this.$el,"deleteSelected");this.deleteButtonView.set("checked",true);g("#deleteButtonLabel",this.$el).html(b.getTranslation("deleteButtonLabel"))}else{a.removeClass(this.$el,"deleteSelected");this.deleteButtonView.set("checked",false);g("#deleteButtonLabel",this.$el).html(b.getTranslation("selectButtonLabel"))}},_updateTime:function(){this.sideBarDate=new Date();g(".sideBarCalendarHour",this.$el)[0].innerHTML=("0"+this.sideBarDate.getHours()).slice(-2);g(".sideBarCalendarMinute",this.$el)[0].innerHTML=("0"+this.sideBarDate.getMinutes()).slice(-2);this.dateTimeTimeout=setTimeout(g.proxy(this._updateTime,this),60001)},_updateCustomizationAvailability:function(){if(widget.getValue("DisableCustomization")==="true"||widget.getValue("DisableCustomization")===true){a.addClass(this.getUI("customizeButton"),"disableCustomization")}else{a.removeClass(this.getUI("customizeButton"),"disableCustomization")}},showEndMeetingButton:function(){this.endMeetingButtonView=new h({icon:"Infra/SideBarActionClose.svg",actionName:"endMeetingButtonView",securityTap:true});this.showChildView("endMeetingButtonRegion",this.endMeetingButtonView);g(".endMeetingButtonView",this.$el).show()},hideEndMeetingButton:function(){if(e.is(this.endMeetingButtonView)){g(".endMeetingButtonView",this.$el).hide();this.detachChildView("endMeetingButtonRegion",this.endMeetingButtonView);this.endMeetingButtonView.destroy()}},startMeetingChrono:function(o){clearTimeout(this.dateTimeTimeout);if(this.getOption("side")==="right"){g(".sideBarButton.time .sideBarTime",this.$el).hide()}else{g(".sideBarButton.calendar .sideBarCalendar",this.$el).hide()}g(".meeting .buttonIconImage.checked",this.$el).attr("src",this.iconPath+"/SideBar/SideBarActionOnMeeting.svg");if(e.getGlobal().inGuidedMeeting===true&&e.getGlobal().isMeetingLeader===true){this.showEndMeetingButton()}g(".sideBarChrono",this.$el).show();this.endingTime=new Date();this.endingTime.setTime(this.endingTime.getTime()+o);this.updateMeetingChrono()},updateMeetingChrono:function(){var o=this.endingTime.getTime()-new Date().getTime();var q=Math.floor((o/1000)%60);var p=Math.floor((o/1000/60)%60);q=q<0?0:q;p=p<0?0:p;g(".sideBarChrono .sideBarChronoMin",this.$el)[0].innerHTML=("0"+p).slice(-2);g(".sideBarChrono .sideBarChronoSec",this.$el)[0].innerHTML=("0"+q).slice(-2);if(p>0||q>0){this.dateTimeTimeout=setTimeout(g.proxy(this.updateMeetingChrono,this),1001)}},endMeetingChrono:function(){clearTimeout(this.dateTimeTimeout);this.meetingButtonView.set("checked",false);g(".meeting .buttonIconImage.checked",this.$el).attr("src",this.iconPath+"/SideBar/SideBarActionOnMeetingInPreparation.svg");this.hideEndMeetingButton();g(".sideBarChrono",this.$el).hide();if(this.getOption("side")==="right"){g(".sideBarButton.time .sideBarTime",this.$el).show();this._updateTime()}else{g(".sideBarButton.calendar .sideBarCalendar",this.$el).show()}},liveMeetingPreparation:function(o){if(!e.getGlobal().inMeeting){this.meetingButtonView.set("checked",o)}}});return d});define("DS/DEL3DLeanViews/ToolsSubpanels/StickyNotePanelView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/EditSticky/EditStickyNoteView","text!DS/DEL3DLeanViews/assets/template/ToolsSubpanels/StickyNotePanelView.template.html","css!DS/DEL3DLeanViews/assets/css/ToolsSubpanels/StickyNotePanelView.css"],function(d,e,i,h,l,g,f,b,a,k,c){var j=g.View.extend({className:"stickyNotePanelView showCanvas",ui:{},regions:{editStickyNoteView:{selector:".stickyNoteEdit",replaceElement:false},createStickyNoteButton:{selector:".createStickyNoteButton",replaceElement:true},createStickyActionButton:{selector:".createStickyActionButton",replaceElement:true},createStickyIssueButton:{selector:".createStickyIssueButton",replaceElement:true}},staticRadioChannel:l.channel("static"),floatableRadioChannel:l.channel("floatable"),modelEvents:{},childViewEvents:{},template:i.template(c),templateContext:function(){return{createStickyLabel:b.getTranslation("createStickyLabel")}},initialize:function(){var m=d.getGlobal();this.staticRadioChannel.on("before:focus",e.proxy(this.beforeFocusView,this));this.staticRadioChannel.on("after:focus",e.proxy(this.afterFocusView,this));this.floatableRadioChannel.on("floatableView:onEditIssueView",e.proxy(this.onEditIssue,this));this.floatableRadioChannel.on("floatableView:onEditActionView",e.proxy(this.onEditAction,this));this.editStickyNoteView=new k({deletable:false,colorPicker:true});this.createStickyNoteButton=new f({actionName:"NOTE",title:b.getTranslation("noteButtonLabel"),callback:e.proxy(this.onCreateSticky,this)});this.createStickyActionButton=new f({actionName:"ACTION",title:b.getTranslation("actionButtonLabel"),callback:e.proxy(this.onCreateSticky,this)});this.createStickyIssueButton=new f({actionName:"ISSUE",title:b.getTranslation("issueButtonLabel"),callback:e.proxy(this.onCreateSticky,this)})},onShow:function(){},onAttach:function(){this.bind();this.editStickyNoteView.penButtonView.tapEventCallback()},onDetach:function(){this.unbind()},bind:function(){this.showChildView("editStickyNoteView",this.editStickyNoteView);this.showChildView("createStickyNoteButton",this.createStickyNoteButton);this.showChildView("createStickyActionButton",this.createStickyActionButton);if(d.is(this.createStickyIssueButton)){this.showChildView("createStickyIssueButton",this.createStickyIssueButton)}},unbind:function(){this.detachChildView("editStickyNoteView",this.editStickyNoteView);this.detachChildView("createStickyNoteButton",this.createStickyNoteButton);this.detachChildView("createStickyActionButton",this.createStickyActionButton);if(d.is(this.createStickyIssueButton)){this.detachChildView("createStickyIssueButton",this.createStickyIssueButton)}},onBeforeRender:function(){},onRender:function(){},onCreateSticky:function(m,n){if(!this.canCreate){return}var o=m;a.addClass(o.$el,"buttonActive");a.addClass(this.$el,"onCreateSticky");this.editStickyNoteView.model.set("V_DEL3DL_Category",n);this.editStickyNoteView.saveData().then(e.proxy(function(){this.editStickyNoteView.clear();this.editStickyNoteView.flushUndoStack();a.removeClass(o.$el,"buttonActive");a.removeClass(this.$el,"onCreateSticky");if(this.editStickyNoteView.isKeyboardShowed()){this.editStickyNoteView.showKeyboard()}},this))},beforeFocusView:function(){this.canCreate=false},onEditIssue:function(m){if(m){a.addClass(this.$el,"editIssueFocused")}else{a.removeClass(this.$el,"editIssueFocused")}},onEditAction:function(m){if(m){a.addClass(this.$el,"editActionFocused")}else{a.removeClass(this.$el,"editActionFocused")}},afterFocusView:function(m){this.canCreate=true;a.removeClass(this.$el,"actionLogViewFocused");a.removeClass(this.$el,"issueLogViewFocused");if(m.focusView.model.name==="ActionLogModel"){a.addClass(this.$el,"actionLogViewFocused")}else{if(m.focusView.model.name==="IssueLogModel"){a.addClass(this.$el,"issueLogViewFocused")}}}});return j});define("DS/DEL3DLeanViews/EditSticky/EditActionView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/EditSticky/EditStickyViewMax","DS/DEL3DLeanViews/EditSticky/EditActionDataView","DS/DEL3DLeanViews/EditSticky/EditStickyNoteView","DS/DEL3DLeanViews/EditSticky/EditPropertiesView","DS/DEL3DLeanViews/EditSticky/EditContextView","DS/DEL3DLeanViews/EditSticky/EditSketchView","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditIssueView.css"],function(e,g,i,l,c,h,b,m,k,d,f,a){var j=b.extend({childViewEvents:{"view:delete":"onDelete","sketch:draw:end":"onStopDraw","sketch:cleared":"onClear"},templateContext:function(){return{tabs:this.model.hasTask()?["data","properties","context","sketch"]:["data","context","sketch"]}},regions:function(){return i.extend(b.prototype.regions,{propertiesTabRegion:{selector:".editStickyViewMaxTabElement.properties",replaceElement:true},contextTabRegion:{selector:".editStickyViewMaxTabElement.context",replaceElement:true},sketchTabRegion:{selector:".editStickyViewMaxTabElement.sketch",replaceElement:true}})},initialize:function(){b.prototype.initialize.apply(this,[]);this.onPropertiesTabDelegate=g.proxy(this.onPropertiesTab,this);this.onContextTabDelegate=g.proxy(this.onContextTab,this);this.onSketchTabDelegate=g.proxy(this.onSketchTab,this);this.$el.addClass("editActionView");this.editDataView=new m({model:this.model});this.propertiesTabButtonView=new h({mode:"radio",checked:false,title:c.getTranslation("Properties"),callback:this.onPropertiesTabDelegate});this.editPropertiesView=new d({model:this.model});this.contextTabButtonView=new h({mode:"radio",checked:false,title:c.getTranslation("Context"),callback:this.onContextTabDelegate});this.editContextView=new f({model:this.model});this.sketchTabButtonView=new h({mode:"radio",checked:false,title:c.getTranslation("Sketch"),callback:this.onSketchTabDelegate});this.editSketchView=new a({model:this.model})},onRender:function(){b.prototype.onRender.apply(this,[]);if(this.model.hasTask()){this.showChildView("propertiesTabRegion",this.propertiesTabButtonView)}this.showChildView("sketchTabRegion",this.sketchTabButtonView);this.showChildView("contextTabRegion",this.contextTabButtonView);this.showElement(this.editDataView.actionThumbnailView);setTimeout(g.proxy(function(){g(".editStickyViewMaxViewWrapper",this.$el).removeClass("onEditStickyViewMaxOpen")},this),200)},onChildviewEditActionSelect:function(n){this.showDataTab();this.showElement(n)},onDelete:function(n,o){if(this._selectedView.model.id===this.model.id){this.triggerMethod("view:delete",n,o)}},onDataTab:function(){b.prototype.onDataTab.apply(this,[]);this.showElement(this.editDataView.actionThumbnailView)},onPropertiesTab:function(){if(e.is(this._selectedView)){this._selectedView.$el.removeClass("selected");this._selectedView=null}this.detachChildView("rightContent");this.showChildView("rightContent",this.editPropertiesView)},onContextTab:function(){if(e.is(this._selectedView)){this._selectedView.$el.removeClass("selected");this._selectedView=null}this.detachChildView("rightContent");this.showChildView("rightContent",this.editContextView)},onSketchTab:function(){if(e.is(this._selectedView)){this._selectedView.$el.removeClass("selected");this._selectedView=null}this.detachChildView("rightContent");this.showChildView("rightContent",this.editSketchView)},onStopDraw:function(n){this.editDataView.triggerMethod("stop:draw",n)},onClear:function(){this.editDataView.triggerMethod("clear")},showElement:function(n){if(e.is(this._selectedView)){if(n===this._selectedView){return}this._selectedView.$el.removeClass("selected")}var o=this.detachChildView("rightContent");if(e.is(o)&&e.is(o.saveData)){o.saveData()}o=new k({model:n.model});this.showChildView("rightContent",o);o._behaviors[0]._isDraggable=false;this._selectedView=n;this._selectedView.$el.addClass("selected")}});return j});define("DS/DEL3DLeanViews/FloatableElements/NoteElements/TaskNoteView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/FloatableElements/StickyNoteView","DS/DEL3DLeanViews/Utils/TaskUtils","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanViews/Utils/UIUtils","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/EditSticky/EditActionView","text!DS/DEL3DLeanViews/assets/template/FloatableElements/NoteElements/TaskNoteView.template.html","css!DS/DEL3DLeanViews/assets/css/FloatableElements/NoteElements/TaskNoteView.css"],function(c,d,h,g,i,a,b,k,j,f){var e=g.extend({className:"stickyNoteView taskNoteView",template:h.template(f),floatableRadioChannel:k.channel("floatable"),circleMenuButtons:[{hasIcon:true,icon:"Floatable/StickyNoteEdit.svg",actionName:"editFloatableElement"},{hasIcon:true,icon:"EditStickyNote/photoCamera.svg",actionName:"captureFloatableElement",securityTap:true},{hasIcon:true,icon:"Floatable/FloatableElementSizeL.svg",actionName:"shrinkFloatableElement"},{hasIcon:true,icon:"Floatable/FloatableElementSizeS.svg",actionName:"enlargeFloatableElement"},{hasIcon:true,icon:"EditStickyNote/Delete.svg",actionName:"deleteFloatableElement",securityTap:true}],onCircleMenuClicked:function(l,m){if(m==="shrinkFloatableElement"){this.resizeFloatableElement(l,false)}else{if(m==="enlargeFloatableElement"){this.resizeFloatableElement(l,true)}else{if(m==="deleteFloatableElement"){this.triggerMethod("FloatableElement:delete",this)}else{if(m==="editFloatableElement"){this.editStickyNote()}else{if(m==="captureFloatableElement"){this.captureContext()}}}}}},templateContext:function(){return h.extend(this.model.toJSON(),{get:d.proxy(this.model.get,this.model),iconPath:this.iconPath})},captureContext:function(){this.circleMenuCollectionView.hideMenu();this.trigger("captureContext",this)},onDragEnterCallback:function(l){if(this.model.isEditable()){g.prototype.onDragEnterCallback.apply(this,[l])}},onDragLeaveCallback:function(l){if(this.model.isEditable()){g.prototype.onDragLeaveCallback.apply(this,[l])}},onDropCallback:function(l){if(this.model.isEditable()){g.prototype.onDropCallback.apply(this,[l])}},_dataUpdated:function(n,l,m){this.constructor.__super__._dataUpdated.apply(this,arguments);if((l.V_DEL3DL_AssignedTeamName!==m.V_DEL3DL_AssignedTeamName)||(l.V_DEL3DL_ActionLogZone!==m.V_DEL3DL_ActionLogZone&&l.V_DEL3DL_ActionLogZone==="alDone")||(l.V_DEL3DL_Has_Context!==m.V_DEL3DL_Has_Context)){this._updateInformations()}},_editStickyNote:function(){this.triggerMethod("FloatableElement:editStickyView",true);this._editStickyNoteView=new j({model:this.model,parent:this});this.showChildView("editZoneRegion",this._editStickyNoteView);this.floatableRadioChannel.trigger("floatableView:onEditActionView",true)},_closeStickyNoteEdit:function(){this.triggerMethod("FloatableElement:editStickyView",false);this.floatableRadioChannel.trigger("floatableView:onEditActionView",false);this._updateInformations()},_updateInformations:function(){var p=undefined;var o=d(".stickyNoteViewScalable .postit-info-status",this.$el);var n=d(".stickyNoteViewScalable .postit-info-status-arrow",this.$el);var m=d(".stickyNoteViewScalable .postit-info",this.$el);var l=d(".stickyNoteViewScalable .taskClipContent",this.$el);if(this.model.isDone()){n.css("display","none");o.attr("style","background-image: url("+this.iconPath+"/Floatable/action_done.svg)");o.addClass("action_done");o.css("display","block")}else{if(this.model.isShared()){o.attr("style","background-image: url("+this.iconPath+"/Loading.svg)");o.css("display","block");if(this.model.isOurTeamAssigned()){p=this.model.get("owner");n.attr("style","background-image: url("+this.iconPath+"/Floatable/ArrowReception.png); left: -45%");b.addClass(this.$el,"received")}else{p=this.model.get("V_DEL3DL_AssignedTeamName");n.attr("style","background-image: url("+this.iconPath+"/Floatable/ArrowSent.png); left: 45%");b.addClass(this.$el,"sent")}var q=a.PEOPLES.sessionInstance.getOrFetch({name:p});if(!c.is(q)){o.css("display","none")}else{q.getPicture().then(d.proxy(function(r){n.css("display","block");o.attr("style","background-image: url("+r+")");o.css("display","block")},this))}}else{o.css("display","none");this.$el.removeClass("received sent")}}if(this.model.get("V_DEL3DL_Has_Context")===true){l.attr("src",this.iconPath+"/trombone.png");b.addClass(this.$el,"hasStaticLinked")}if(o.css("display")==="none"){m.css("display","none")}else{m.css("display","block")}},_updateCircleMenuActionsAvailability:function(){var m=this.circleMenuCollectionView.children;var n=m.find(function(o){if(o.model.get("actionName")==="deleteFloatableElement"){return true}return false});var l=m.find(function(o){if(o.model.get("actionName")==="captureFloatableElement"){return true}return false});if(c.is(l)){l.setEnabled(this.model.isEditable()&&(this.parent.fromViewModel.get("type")!=="DEL3DL_Page"))}if(c.is(n)){n.setEnabled(!(!this.model.isDeletable()&&this.parent.fromViewModel.get("type")==="DEL3DL_Action_Log"))}},_isDroppable:function(){return(!this.model.isDone())},_forceCircleMenuActionsAvailable:function(){var m=this.circleMenuCollectionView.children;var l=m.find(function(o){if(o.model.get("actionName")==="editFloatableElement"){return true}return false});var n=m.find(function(o){if(o.model.get("actionName")==="deleteFloatableElement"){return true}return false});if(c.is(l)){l.setEnabled(true)}if(c.is(n)){n.setEnabled(true)}},tapEventCallback:function(){this.triggerMethod("FloatableElement:putViewOnTop",this);if(this.enabled){if(this.forcePressEvent===true){if(!(!this.model.isDeletable()&&this.parent.fromViewModel.get("type")==="DEL3DL_Action_Log")){this.pressEventCallback()}}else{this.circleMenuCollectionView.toggleShowMenu();this._updateCircleMenuActionsAvailability()}}},pressEventCallback:function(){if(!(!this.model.isDeletable()&&this.parent.fromViewModel.get("type")==="DEL3DL_Action_Log")){g.prototype.pressEventCallback.apply(this,[])}else{this.triggerMethod("FloatableElement:putViewOnTop",this)}},onDragStartCallback:function(){g.prototype.onDragStartCallback.apply(this,[]);this.$el.attr({"data-id":this.model.id})},onDragEndCallback:function(m){g.prototype.onDragEndCallback.apply(this,[m]);var l=this;setTimeout(function(){l.$el.removeAttr("data-id")},0)},updatePosition:function(){g.prototype.updatePosition.apply(this,[]);if(this.relationModel.get("V_DEL3DL_X")>100){this.$el.addClass("outOfSight")}else{this.$el.removeClass("outOfSight")}}});return e});define("DS/DEL3DLeanViews/EditSticky/EditIssueView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/EditSticky/EditStickyViewMax","DS/DEL3DLeanViews/EditSticky/EditIssueDataView","DS/DEL3DLeanViews/EditSticky/EditStickyNoteView","DS/DEL3DLeanViews/EditSticky/EditContextView","DS/DEL3DLeanViews/EditSticky/EditSketchView","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditIssueView.css"],function(d,f,k,i,m,g,c,b,h,l,e,a){var j=b.extend({childViewEvents:{"view:delete":"onDelete","sketch:draw:end":"onStopDraw","sketch:cleared":"onClear"},regions:function(){return k.extend(b.prototype.regions,{contextTabRegion:{selector:".editStickyViewMaxTabElement.context",replaceElement:true},sketchTabRegion:{selector:".editStickyViewMaxTabElement.sketch",replaceElement:true}})},templateContext:function(){return{tabs:["data","context","sketch"]}},initialize:function(){b.prototype.initialize.apply(this,[]);this.onSketchTabDelegate=f.proxy(this.onSketchTab,this);this.onContextTabDelegate=f.proxy(this.onContextTab,this);this.$el.addClass("editIssueView");this.editDataView=new h({model:this.model,actions:this.getOption("actions")});this.contextTabButtonView=new g({mode:"radio",checked:false,title:c.getTranslation("Context"),callback:this.onContextTabDelegate});this.editContextView=new e({model:this.model});this.sketchTabButtonView=new g({mode:"radio",checked:false,title:c.getTranslation("Sketch"),callback:this.onSketchTabDelegate});this.editSketchView=new a({model:this.model})},onRender:function(){b.prototype.onRender.apply(this,[]);this.showChildView("sketchTabRegion",this.sketchTabButtonView);this.showElement(this.editDataView.issueThumbnailView);this.showChildView("contextTabRegion",this.contextTabButtonView);setTimeout(f.proxy(function(){f(".editStickyViewMaxViewWrapper",this.$el).removeClass("onEditStickyViewMaxOpen")},this),200)},onChildviewEditIssueSelect:function(n){this.showDataTab();this.showElement(n)},onDelete:function(n,o){if(this._selectedView.model.id===this.model.id){this.triggerMethod("view:delete",n,o)}else{f(".editStickySketchDrawAreaContainer",this.$el).addClass("onActionDelete");setTimeout(f.proxy(function(){this.thumbnailActionCollectionRadio.trigger("issueActions:collectionview:destroy",this._selectedView.relationModel);this.showElement(this.editDataView.issueThumbnailView);f(".editStickySketchDrawAreaContainer",this.$el).removeClass("onActionDelete")},this),200)}},onDataTab:function(){this.editDataView.onSketchTab=false;b.prototype.onDataTab.apply(this,[]);this.showElement(this.editDataView.issueThumbnailView)},onContextTab:function(){if(d.is(this._selectedView)){this._selectedView.$el.removeClass("selected");this._selectedView=null}this.detachChildView("rightContent");this.showChildView("rightContent",this.editContextView)},onSketchTab:function(){this.editDataView.onSketchTab=true;if(d.is(this._selectedView)){this._selectedView.$el.removeClass("selected");this._selectedView=null}this.detachChildView("rightContent");this.showChildView("rightContent",this.editSketchView)},showElement:function(n){if(d.is(this._selectedView)){if(n===this._selectedView){return}this._selectedView.$el.removeClass("selected")}var o=this.detachChildView("rightContent");if(d.is(o)&&d.is(o.saveData)){o.saveData()}o=new l({model:n.model});this.showChildView("rightContent",o);o._behaviors[0]._isDraggable=false;this._selectedView=n;this._selectedView.$el.addClass("selected")},onStopDraw:function(n){this.editDataView.triggerMethod("stop:draw",n,this._selectedView)},onClear:function(){this.editDataView.triggerMethod("clear",this._selectedView)}});return j});define("DS/DEL3DLeanViews/FloatableElements/NoteElements/IssueNoteView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/FloatableElements/StickyNoteView","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanEnums/Collection.enum","DS/DEL3DLeanViews/EditSticky/EditIssueView","DS/DEL3DLeanViews/Utils/UIUtils","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanEnums/Model.enum","text!DS/DEL3DLeanViews/assets/template/FloatableElements/NoteElements/IssueNoteView.template.html","css!DS/DEL3DLeanViews/assets/css/FloatableElements/NoteElements/IssueNoteView.css"],function(f,h,m,j,e,i,n,g,c,l,d,o,b,a){var k=j.extend({className:"stickyNoteView issueNoteView",behaviors:[{behaviorClass:i,usePressEvent:true,useTapEvent:true,isActiveOnRender:false,className:".stickyNoteViewContent"},{behaviorClass:n,isActiveOnRender:false,isDraggable:true,isGesturable:true,enableLive:true,ignoreFrom:".buttonView"},{behaviorClass:n,isActiveOnRender:false,isDroppable:true,enableDropAcceptClass:".sidePersonView, .stickyMemberView, .sideStickerView, .stickerView, .taskNoteView",className:".stickyNoteDropZone"}],floatableRadioChannel:o.channel("floatable"),circleMenuButtons:[{hasIcon:true,icon:"Floatable/StickyNoteEdit.svg",actionName:"editFloatableElement"},{hasIcon:true,icon:"EditStickyNote/photoCamera.svg",actionName:"captureFloatableElement",securityTap:true},{hasIcon:true,icon:"Floatable/FloatableElementSizeL.svg",actionName:"shrinkFloatableElement"},{hasIcon:true,icon:"Floatable/FloatableElementSizeS.svg",actionName:"enlargeFloatableElement"},{hasIcon:true,icon:"EditStickyNote/Delete.svg",actionName:"deleteFloatableElement",securityTap:true}],iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),template:m.template(a),childViewTriggers:{"view:editionFinished":"view:editionFinished","editIssue:updateIssue":"_updateInformations"},extendModelEvents:{"change:V_DEL3DL_Data":"dataUpdated","change:V_DEL3DL_Sketch_Image":"updateContent","change:links":"_updateInformations"},onCircleMenuClicked:function(p,q){if(q==="shrinkFloatableElement"){this.resizeFloatableElement(p,false)}else{if(q==="enlargeFloatableElement"){this.resizeFloatableElement(p,true)}else{if(q==="deleteFloatableElement"){this.triggerMethod("FloatableElement:delete",this)}else{if(q==="editFloatableElement"){this.editStickyNote()}else{if(q==="captureFloatableElement"){this.captureContext()}}}}}},templateContext:function(){return m.extend(this.model.toJSON(),{get:h.proxy(this.model.get,this.model),iconPath:this.iconPath})},captureContext:function(){this.circleMenuCollectionView.hideMenu();this.trigger("captureContext",this)},_initialize:function(){this._actionsLinked=this.getActionsLinked();var p=h.proxy(this._updateInformations,this);this._actionsLinked.on("add remove",p);this.createRelationDelegate=h.proxy(this.createRelation,this)},onDragEnterCallback:function(p){if(this.model.isEditable()){j.prototype.onDragEnterCallback.apply(this,[p])}},onDragLeaveCallback:function(p){if(this.model.isEditable()){j.prototype.onDragLeaveCallback.apply(this,[p])}},_dataUpdated:function(r,p,q){this.constructor.__super__._dataUpdated.apply(this,arguments);if(p.V_DEL3DL_IssueLogZone!==q.V_DEL3DL_IssueLogZone&&p.V_DEL3DL_IssueLogZone==="ilIssueClosed"||(p.V_DEL3DL_Has_Context!==q.V_DEL3DL_Has_Context)){this._updateInformations()}},_updateCircleMenuActionsAvailability:function(){var q=this.circleMenuCollectionView.children;var p=q.find(function(r){if(r.model.get("actionName")==="captureFloatableElement"){return true}return false});if(f.is(p)){p.setEnabled(this.model.isEditable()&&(this.parent.fromViewModel.get("type")!=="DEL3DL_Page"))}},_editStickyNote:function(){this.triggerMethod("FloatableElement:editStickyView",true);this._editStickyNoteView=new l({model:this.model,actions:this.getActionsLinked(),parent:this});this.showChildView("editZoneRegion",this._editStickyNoteView);this.floatableRadioChannel.trigger("floatableView:onEditIssueView",true);this.floatableRadioChannel.on("floatableCollection:newStickyNoteModel",this.createRelationDelegate)},_closeStickyNoteEdit:function(){this.triggerMethod("FloatableElement:editStickyView",false);this.floatableRadioChannel.trigger("floatableView:onEditIssueView",false);this.floatableRadioChannel.off("floatableCollection:newStickyNoteModel",this.createRelationDelegate);this._updateInformations();this.updateBackground(this.model,this.model.get("V_DEL3DL_Background_Color"))},onDropCallback:function(r){if(this.model.isEditable()){var p=r.relatedTarget;if(h(p).hasClass("sideStickerView")||h(p).hasClass("stickerView")){var q=r.relatedTarget.getAttribute("data-documentId");this.model.assignSticker(q)}else{if(h(p).hasClass("taskNoteView")){this.assignAction(r)}else{var s=r.relatedTarget.getAttribute("data-name");this.model.assignPeople(s,c,null)}}this._scaleElement(this.pinchScale);if(h(p).hasClass("stickyMemberView")||h(p).hasClass("stickerView")){h(p).fadeTo(200,0);this.trigger("FloatableElement:deleteId",p.id)}else{h(p).fadeTo(200,1)}}},createRelation:function(p){g.linkModels(this.model.id,p.get("physicalid"))},assignAction:function(p){var q=p.relatedTarget.getAttribute("data-id");g.linkModels(this.model.id,q);this.trigger("FloatableElement:deleteId",p.relatedTarget.id)},hasActionLinked:function(){return this.getActionsLinked().length>0},getActionsLinked:function(){var p=null;if(f.is(this._actionsLinked)){p=this._actionsLinked}else{p=g.getFloatablesRelationsFrom(this.model.id);this._actionsLinked=p}return p},_allActionsDone:function(){var r=this.getActionsLinked();if(r.models.length>0){var t=true;var s=null;for(var p in r.models){s=r.models[p];var q=g.findModel(s.get("to"),["floatables"]);if(!q.isDone()){t=false;break}}return t}return false},_updateInformations:function(){var t=h(".stickyNoteViewScalable .postit-info-status",this.$el);var s=h(".stickyNoteViewScalable .postit-info",this.$el);var q=h(".stickyNoteViewScalable .issueClipContent",this.$el);if(this.model.isDone()){t.attr("style","background-image: url("+this.iconPath+"/Floatable/padlock.svg)");t.addClass("done");t.css("display","block")}else{if(this._allActionsDone()){t.attr("style","background-image: url("+this.iconPath+"/Floatable/all_action_done.svg)");t.css("display","block")}else{t.css("display","none")}}if(this.hasActionLinked()){d.addClass(this.$el,"hasActionLinked");var v=this.getActionsLinked();var u=v.first();var r=g.findModel(u.get("to"));var p=r.get("V_DEL3DL_Background_Color");h(".actionLinkedIndicator",this.$el).css("background",p)}else{d.removeClass(this.$el,"hasActionLinked")}if(this.model.get("V_DEL3DL_Has_Context")===true){q.attr("src",this.iconPath+"/trombone.png");d.addClass(this.$el,"hasStaticLinked")}if(t.css("display")==="none"){s.css("display","none")}else{s.css("display","block")}}});return k});define("DS/DEL3DLeanViews/Panels/ToolsView",["pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","text!DS/DEL3DLeanViews/assets/template/Panels/ToolsView.template.html","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/ToolsSubpanels/StickyNotePanelView","DS/DEL3DLeanViews/ToolsSubpanels/FilterPanelView","DS/DEL3DLeanViews/ToolsSubpanels/StickerPanelView","DS/DEL3DLeanViews/ToolsSubpanels/TeamPanelView","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/assets/enums/ToolsViewActionEnum","DS/DEL3DLeanResources/ResourcesManager","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","css!DS/DEL3DLeanViews/assets/css/Panels/ToolsView.css"],function(h,m,k,e,o,n,a,g,i,j,f,c,d,b){var l=k.View.extend({className:"toolsView",title:null,icon:d.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/ToolsPanel/PanelIcon.svg",sideBarRadioChannel:o.channel("sidebar"),stickyNotePanelView:null,filterPanelView:null,stickerPanelView:null,teamPanelView:null,regions:{toolsViewContentRegion:{el:".toolsViewContent",replaceElement:true},headerStickyNoteRegion:".headerCreateStickies",headerFilterRegion:".headerFilter",headerStickerRegion:".headerIcon",headerTeamRegion:".headerTeam"},childViewEvents:{"buttonView:clicked":"headerClick"},template:m.template(e),initialize:function(){this.title=c.getTranslation("toolsTitle");this.stickyNotePanelView=new n();this.filterPanelView=new a();this.stickerPanelView=new g();this.teamPanelView=new i();this.stickyNotePanelButtonView=new j({title:c.getTranslation("notesTabLabel"),actionName:f.STICKIES});this.filterPanelButtonView=new j({title:c.getTranslation("filterTabLabel"),actionName:f.FILTER});this.stickerPanelButtonView=new j({title:c.getTranslation("stickersTabLabel"),actionName:f.ICON});this.teamPanelButtonView=new j({title:c.getTranslation("teamTabLabel"),actionName:f.TEAM})},headerClick:function(q,p){this.openSubMenu(p)},initToolsView:function(){this.openSubMenu(f.STICKIES)},openSubMenu:function(q){var p;b.removeClass(this.stickyNotePanelButtonView.$el,"active");b.removeClass(this.filterPanelButtonView.$el,"active");b.removeClass(this.stickerPanelButtonView.$el,"active");b.removeClass(this.teamPanelButtonView.$el,"active");switch(q){case f.STICKIES:p=this.stickyNotePanelView;b.addClass(this.stickyNotePanelButtonView.$el,"active");break;case f.FILTER:p=this.filterPanelView;b.addClass(this.filterPanelButtonView.$el,"active");break;case f.ICON:p=this.stickerPanelView;b.addClass(this.stickerPanelButtonView.$el,"active");break;default:p=this.teamPanelView;b.addClass(this.teamPanelButtonView.$el,"active");break}this.detachChildView("toolsViewContentRegion");this.showChildView("toolsViewContentRegion",p)},onShow:function(){},onAttach:function(){},onRender:function(){this.showChildView("headerStickyNoteRegion",this.stickyNotePanelButtonView);this.showChildView("headerFilterRegion",this.filterPanelButtonView);this.showChildView("headerStickerRegion",this.stickerPanelButtonView);this.showChildView("headerTeamRegion",this.teamPanelButtonView)},onOpen:function(){b.addClass(h(".sideView"),"onTools");this.initToolsView()},onClose:function(){b.removeClass(h(".sideView"),"onTools");this.sideBarRadioChannel.trigger("sideBarView:tools",false)}});return l});define("DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/KPICoachMarkView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/CoachMarkView","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/CoachMarkView.css"],function(f,d,b,c,a){var e=a.extend({modelEvents:{change:"hideShowRules"},templateContext:function(){return b.extend(this.model.toJSON(),{iconPath:this.iconPath,infraCoachMarkImg:"KPIEmptyImg.svg",infraCoachMarkFocusImg:"KPICoachMarkImg.svg",infraCoachMarkFocusRessource:c.getTranslation("coachmark_kpi")})},_initialize:function(){},hideShowRules:function(){var g=this.model.jsonData();if(f.is(g.KPICustomized)&&g.KPICustomized===true){this.$el.hide();this.coachMarkHidden=true}else{this.$el.show();this.coachMarkHidden=false}}});return e});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/KPIView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanLibs/DEL3DLHighstock","pluginDS!DS/VEN3DLeanHammer/hammer.2.0.8/hammer.min","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/KPISettingsView","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/KPICoachMarkView","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/KPIView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/KPIView.css"],function(h,i,l,k,m,b,j,e,f,d,c){var a=j.extend({className:"leangetView kpiView",template:l.template(c),_chart:null,_topOffset:null,_touches:[],ui:{chart:".chart"},extendModelEvents:{change:"render"},_interval:86400000,_sunday:255600000,initialize:function(n){this.settingsView=b.createView(f,{model:this.model});j.prototype.initialize.apply(this,[n]);this._isScrolling=false;this._isEditing=false;this._isZooming=false;this._kpiPrintChartNLS=e.getTranslation("kpi_print_chart");this._dlPngNLS=e.getTranslation("kpi_dl_png");this._dlJpgNLS=e.getTranslation("kpi_dl_jpg");this._dlPdfNLS=e.getTranslation("kpi_dl_pdf");this._dlSvgNLS=e.getTranslation("kpi_dl_svg");this._dlCsvNLS=e.getTranslation("kpi_dl_csv");this._dlXlsNLS=e.getTranslation("kpi_dl_xls");this._kpiViewDataTabletNLS=e.getTranslation("kpi_view_data_table");window.addEventListener("resize",function(){this.render()}.bind(this))},switchToolbarSketch:function(){},onBeforeCapture:function(){},onAfterCapture:function(){},onContextualMenu:function g(){setTimeout(i.proxy(function(){i(i(".highcharts-contextbutton",this.$el)[0]).click()},0),this)},setFocusView:function(n){j.prototype.setFocusView.apply(this,[n]);if(n){this._mc.input.store=[];this._hammerTap.options.enable=true;this._hammerPan.options.enable=true;this._hammerPress.options.enable=true;this._hammerPinch.options.enable=true;this._bindEdit();this._bindScroll();this._bindPanEnd();this._bindZoom();this._bindAdd()}else{this._unbindEdit();this._unbindScroll();this._unbindPanEnd();this._unbindZoom();this._unbindAdd();this._hammerTap.options.enable=false;this._hammerPan.options.enable=false;this._hammerPress.options.enable=false;this._hammerPinch.options.enable=false;this._mc.input.store=[]}},onRender:function(){this._constructGraph();if(!h.is(this._mc)){this._mc=new m.Manager(this.$el[0]);this._hammerTap=new m.Tap({event:"tap",pointers:1,enable:false});this._hammerPan=new m.Pan({event:"pan",pointers:1,preventDefault:true,enable:false});this._hammerPress=new m.Press({event:"pressup",pointers:1,enable:false});this._hammerPinch=new m.Pinch({event:"pinch",pointers:2,preventDefault:true,enable:false,threshold:0.15});this._mc.add(this._hammerPan);this._mc.add(this._hammerTap);this._mc.add(this._hammerPress);this._mc.add(this._hammerPinch)}var n=this.getUI("chart");n.data("hammerManager",this._mc)},onGlobalPinch:function(o){if(this._isEditing||this._isScrolling){return}var w=this.model.get("V_DEL3DL_Work_Week");var B=w.length<7;var p=undefined;var u=undefined;var y=undefined;var z=undefined;var n=undefined;var s=undefined;var v=undefined;var r=undefined;var q=false;var t=undefined;var x=undefined;if(o.type==="wheel"){p=this._chart.series[0].xAxis;var A=p.getExtremes();u=A.max-A.min;y=-1*Math.sign(o.deltaY);z=y*this._interval;n=z;s=z;if(B){while(Math.abs(n)-y*this._brokeDaysInRange(A.min,A.min+n)*this._interval<Math.abs(z)-1){n=n+y*this._interval}while(Math.abs(s)-y*this._brokeDaysInRange(A.max,A.max-s)*this._interval<Math.abs(z)-1){s=s+y*this._interval}}v=A.min+n>=p.dataMin-this._interval;r=A.max-s<=p.dataMax+this._interval;if(!v){n=0}if(!r){s=0}t=this._brokeDaysInRange(A.min+n,A.max-s);x=A.max-s-A.min-n-t*this._interval;if(y>0){q=x>this._interval*4}else{q=x<this._interval*30}if(z&&q){p.setExtremes(A.min+n,A.max-s,true,false)}}else{p=this._chart.series[0].xAxis;if(!this._isZooming){this._isZooming=true;this._unbindEdit();this._unbindScroll();this._startExtremes=p.getExtremes()}else{u=this._startExtremes.max-this._startExtremes.min;z=o.scale*u;z-=u;z/=2;y=Math.sign(z);n=z;s=z;if(B){while(Math.abs(n)-y*this._brokeDaysInRange(this._startExtremes.min,this._startExtremes.min+n)*this._interval<Math.abs(z)-1){n=n+y*this._interval}while(Math.abs(s)-y*this._brokeDaysInRange(this._startExtremes.max,this._startExtremes.max-s)*this._interval<Math.abs(z)-1){s=s+y*this._interval}}v=this._startExtremes.min+n>=p.dataMin-this._interval;r=this._startExtremes.max-s<=p.dataMax+this._interval;if(!v){n=0}if(!r){s=0}t=this._brokeDaysInRange(this._startExtremes.min+n,this._startExtremes.max-s);x=this._startExtremes.max-s-this._startExtremes.min-n-t*this._interval;if(y>0){q=x>this._interval*4}else{q=x<this._interval*30}if(z&&q){p.setExtremes(this._startExtremes.min+n,this._startExtremes.max-s,true,false)}}}},onGlobalPinchEnd:function(){this._isZooming=false;this._bindEdit();this._bindScroll();this.persist()},onGlobalTap:function(o){var p=i(o.target).parents(".highcharts-contextbutton");var n=i(o.target).parents(".highcharts-contextmenu");if(0>=p.length&&0>=n.length){var q=this._findPlot(o);var r=this._chart.series[0].data;if(q.plot.x>=r[r.length-1].x){this.addPoint();this.persist()}}},onGlobalPanVertical:function(n){if(this._isScrolling||this._isZooming){return}else{if(!this._isEditing){this._isEditing=true;this._unbindScroll()}}if(!h.is(this._topOffset)){this._topOffset=this.$el.offset().top}var v=this._chart.series[0].data;var t=false;var u=n.srcEvent.pointerId;if(!h.is(this._touches[u])){if(this._chart.series[0].points===0){return}this._touches[u]=this._findPlot(n);t=true}var s=this._touches[u];var q=s.plot;if(s.plot){var o=this._chart.series[0].yAxis;var r=this._findPlot(n).y;var w=o.toValue(r);if(w>o.max){w=o.max}if(w<o.min){w=o.min}if(t){s.difference=Math.floor(q.y-w);if(Math.abs(s.difference)<5){s.difference=0}}else{w=w+s.difference;if(w>o.max){w=o.max}if(w<o.min){w=o.min}q.y=w;q.update(q.y,false,false)}if(v[v.length-2]){if(s.plot.x===v[v.length-2].x){var p=v[v.length-1];p.update(q.y,false,false)}}this._chart.redraw(false)}},onGlobalPanHorizontal:function(o){if(this._isEditing||this._isZooming){return}var q=this._chart.series[0].xAxis;var u=this.model.get("V_DEL3DL_Work_Week");if(!this._isScrolling){this._unbindEdit();var p=u[0]*this._interval;this._dayInPixels=q.toPixels(p+this._interval,true)-q.toPixels(p,true);this._toValue=this._interval/this._dayInPixels;this._startExtremes=q.getExtremes();this._isScrolling=true}else{var w=o.deltaX*this._toValue;if(w){var t=this._startExtremes.min-w>=q.dataMin-this._interval;var r=this._startExtremes.max-w<=q.dataMax+this._interval;var x=u.length<7;var n=w;var s=w;if(x){var v=Math.sign(w);while(Math.abs(n)-this._brokeDaysInRange(this._startExtremes.min,this._startExtremes.min-n)*this._interval<Math.abs(w)-1){n=n+v*this._interval}while(Math.abs(s)-this._brokeDaysInRange(this._startExtremes.max,this._startExtremes.max-s)*this._interval<Math.abs(w)-1){s=s+v*this._interval}}if(t&&r){q.setExtremes(this._startExtremes.min-n,this._startExtremes.max-s,true,false)}}}},onGlobalPanEnd:function(o){var p=this.model.get("V_DEL3DL_Round_Value");var n=this.model.get("V_DEL3DL_Y_Axis_Min");var q=this.model.get("V_DEL3DL_Y_Axis_Max");var w=this._isEditing&&p>0;if(this._isScrolling){this._bindEdit();this._isScrolling=false}if(this._isEditing){this._bindScroll();this._isEditing=false}var t=this._touches[o.srcEvent.pointerId];var v=this._chart.series[0].data;if(t){if(w){var s=Math.round(t.plot.y/p)*p;var u=Math.min(Math.max(s,n),q);t.plot.update(u);if(v[v.length-2]){if(t.plot.x===v[v.length-2].x){var r=v[v.length-1];r.update(u)}}}if(t.plot.x>=v[v.length-1].x){this.addPoint()}}this.persist();delete this._touches[o.srcEvent.pointerId]},persist:function(){this.model.save({V_DEL3DL_Graph_Data:this._serializeGraph(),V_DEL3DL_Graph_Extremes:this._chart.series[0].xAxis.getExtremes()},{silent:true})},addPoint:function(){var n=this._chart.series[0];var r=n.data;var p=r[r.length-1];var q=p.x+this._interval;while(this._isDayBroke(q)){n.addPoint({x:q,y:null},true,false,false);q+=this._interval}n.zones[0].value=q-this._interval;n.addPoint({x:q,y:p.y},true,false,false);var o=n.xAxis;var t=o.getExtremes();var s=0;if(q>t.max){s=q-t.max;o.setExtremes(t.min+s+this._interval/10,t.max+s+this._interval/10,true,false)}if(t.dataMax-t.dataMin<this._interval*7){this._chart.render()}},_SVGDisplaySize:function(){var o=this._chart.xAxis[0].width;var s=this._chart.yAxis[0].height;var q=o/s;var n=this.$el.height();var p=this.$el.width();var r=p/n;if(r>q){p=p/r*q}else{n=n/q*r}return{height:n,width:p}},_removeDeadPointers:function(){var n=0;for(n in this._touches){if(!this._touches[n].currentTarget){delete this._touches[n]}}},_positionInSVG:function(p){var s=this._SVGDisplaySize();var q=this.$el.width()-s.width;var o=this.$el.height()-s.height;var n=p.x-q/2;var u=p.y-o/2;n-=this.$el.offset().left;u-=this.$el.offset().top;var t=this._chart.chartWidth;var r=this._chart.chartHeight;n=n/s.width*t;u=u/s.height*r;n=Math.min(Math.max(n,0),t);u=Math.min(Math.max(u,0),r);return{x:n,y:u}},_findPlot:function(o){var w=this._chart.series[0];var A=w.points;var p=w.xAxis;var q=this._positionInSVG(o.center);var z=q.x;var u=p.toValue(z);var r=u/this._interval;var s=A[0];var t=s.x;var n=t/this._interval;var v=this._brokeDaysInRange(p.getExtremes().min,u);var y=Math.round(r-n)-v;if(y<0){y=0}else{if(y>A.length-1){y=A.length-1}}return{plot:A[y],index:y,x:q.x,y:q.y}},_brokeDaysInRange:function(s,r){var o=s;var p=0;var q=s;if(r<s){s=r;r=o}var n=new Date(s);n.setHours(0,0,0,0);s=n.getTime();for(q=s;q<r;q+=this._interval){if(this._isDayBroke(q)){p++}}return p},_constructGraph:function(){var x=this;var H=this.model.get("V_DEL3DL_Graph_Data");var J=this.model.get("V_DEL3DL_Work_Week");var K=this.model.get("V_DEL3DL_X_Axis_Title");var u=this.model.get("V_DEL3DL_Y_Axis_Title");var L=this.model.get("V_DEL3DL_Y_Axis_Min");var N=this.model.get("V_DEL3DL_Y_Axis_Max");var n=this.model.get("V_DEL3DL_Above_Color");var E=this.model.get("V_DEL3DL_Below_Color");var F=this.model.get("V_DEL3DL_Target");var A=this.model.get("V_DEL3DL_Graph_Extremes");var y=new Date();y=Date.UTC(y.getFullYear(),y.getMonth(),y.getDate());y=new Date(y);H=H||[{x:y.setDate(y.getDate()),y:0}];var t=y.setDate(y.getDate()-1);if(h.is(H)){if(H.length>1){t=H[H.length-2].x}}var o=[1,2,3,4,5,6,0];var O=o.map(function(Q){if(!l.contains(J,Q)){var P=x._interval*Q+x._sunday;return{from:P,to:P+x._interval,repeat:x._interval*7}}return null}).filter(function(P){return h.is(P)});this._chart=window.Highstocks6.stockChart(this.getUI("chart")[0],{chart:{type:"line",width:i(".mainContent").width(),height:i(".mainContent").height(),animation:false,panning:false,backgroundColor:"rgba(255, 255, 255, 0.0)",followTouchMove:true,zoomType:undefined,resetZoomButton:{theme:{display:"none"}}},tooltip:{enabled:false},title:{text:null},lang:{viewData:this._kpiViewDataTabletNLS,downloadJPEG:this._dlJpgNLS,downloadPNG:this._dlPngNLS,downloadPDF:this._dlPdfNLS,downloadSVG:this._dlSvgNLS,downloadCSV:this._dlCsvNLS,downloadXLS:this._dlXlsNLS,printChart:this._kpiPrintChartNLS},xAxis:{title:{text:K},type:"datetime",minTickInterval:this._interval,pointInterval:this._interval,dateTimeLabelFormats:{day:"%e. %b %y"},breaks:O},yAxis:{title:{text:u},min:L,max:N,opposite:false},series:[{showInLegend:false,data:H,zoneAxis:"x",color:"#239de8",zones:[{value:t,color:"#f7a35c"},{dashStyle:"dot"}],marker:{enabled:true},enableMouseTracking:false,gapSize:1}],plotOptions:{series:{animation:false,showInNavigator:true},line:{marker:{radius:9},dataLabels:{enabled:true,format:"{point.y:.1f}"}}},exporting:{enabled:true,chartOptions:{title:{text:this.model.get("V_DEL3DL_Title")}}},rangeSelector:{enabled:false},credits:{enabled:false},navigator:{enabled:false},scrollbar:{enabled:false}});var z=this._chart.series[0].xAxis;if(A){z.setExtremes(A.min,A.max,true,false)}else{var D=z.getExtremes().min;z.setExtremes(D,D+this._interval*7,true,false)}var r=n?n!=="rgba(0, 0, 0, 0)":false;var G=E?E!=="rgba(0, 0, 0, 0)":false;if(r||G){var q=this._chart.chartHeight-this._chart.clipBox.height;var v=this._chart.chartWidth-this._chart.clipBox.width;var p=this._chart.marginRight;var s=this._chart.marginBottom;var C=N-L;var M=F-L;var w=M/C;var B=w*this._chart.clipBox.height;var I=(1-w)*this._chart.clipBox.height;if(r){this._chart.renderer.rect(v-p,q-s,this._chart.clipBox.width,I).attr({fill:n||"none"}).add()}if(G){this._chart.renderer.rect(v-p,q-s+I,this._chart.clipBox.width,B).attr({fill:E||"none"}).add()}}},_serializeGraph:function(){var n=this._chart.series[0].data;return n.map(function(o){return{x:o.x,y:o.y}})},_unbindScroll:function(){this._mc.off("panleft panright",this.onGlobalPanHorizontal.bind(this))},_unbindEdit:function(){this._mc.off("panup pandown",this.onGlobalPanVertical.bind(this))},_unbindAdd:function(){this._mc.off("tap pressup",this.onGlobalTap.bind(this))},_unbindPanEnd:function(){this._mc.off("panend",this.onGlobalPanEnd.bind(this))},_unbindZoom:function(){this._mc.off("pinch",this.onGlobalPinch.bind(this));this._mc.off("pinchend",this.onGlobalPinchEnd.bind(this))},_bindScroll:function(){this._mc.on("panleft panright",this.onGlobalPanHorizontal.bind(this))},_bindEdit:function(){this._mc.on("panup pandown",this.onGlobalPanVertical.bind(this))},_bindPanEnd:function(){this._mc.on("panend",this.onGlobalPanEnd.bind(this))},_bindAdd:function(){this._mc.on("tap pressup",this.onGlobalTap.bind(this))},_bindZoom:function(){this._mc.on("pinch",this.onGlobalPinch.bind(this));this._mc.on("pinchend",this.onGlobalPinchEnd.bind(this));this.$el[0].onwheel=this.onGlobalPinch.bind(this)},_isDayBroke:function(p){var o=new Date(p);var n=this.model.get("V_DEL3DL_Work_Week");return !l.contains(n,o.getDay())}});return a});define("DS/DEL3DLeanViews/StaticViews/MapView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/StaticView","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Behaviors/HammerBehavior","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanHttpRequest/MessageHandler","DS/DEL3DLeanSession/Session.manager","text!DS/DEL3DLeanViews/assets/template/Statics/MapView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/MapView.css"],function(d,g,l,e,a,f,i,b,k,j,c){var m=e.extend({name:"MapView",className:"mapView",template:l.template(c),behaviors:[{behaviorClass:i,useTapEvent:true,usePressEvent:true}],_initialize:function(){if(!d.is(this.model)){this.model=j.get3DLeanSession()}this.staticCollectionView=a.createView(this.collectionViewsEnum.MAPSTATICCOLLECTIONVIEW,{collection:f.getStaticsRelationsFrom(this.model.id),collectionViewsEnum:this.collectionViewsEnum,staticViewModel:this.model,parent:this});this.onOpenMapDelegate=g.proxy(this.focus,this);this.onSessionChangedDelegate=g.proxy(this.onSessionChanged,this);this.setLayoutEditableDelegate=g.proxy(this.setLayoutEditable,this);this.onLiveMeetingStartDelegate=g.proxy(this.onLiveMeetingStart,this);this.onLiveMeetingEndDelegate=g.proxy(this.onLiveMeetingEnd,this);this.listenTo(j,"after:loadsession",this.onSessionChangedDelegate)},_bindEvents:function(){this.sideBarRadioChannel.on("sideBarView:openMap",this.onOpenMapDelegate)},_unBindEvents:function(){this.sideBarRadioChannel.off("sideBarView:openMap",this.onOpenMapDelegate)},_onRender:function(){this.showChildView("staticRegion",this.staticCollectionView)},onLiveMeetingPreparation:function(o){var n={welcomeAction:o===true?"replace":"flush",meetingInfo:"preparation",force:true};this.liveIt("onLiveMeetingPreparation",arguments,n);this.sideBarRadioChannel.trigger("sideBarView:liveMeetingPreparation",o)},_meetingPreparation:function(n){var o=this;if(n===true){b.addClass(o.$el,"meetingPreparationOpened");if(!d.getGlobal().inMeeting){o.onLiveMeetingPreparation(true)}}else{o.sideBarRadioChannel.once("sideView:after:closePanel",function(){b.removeClass(o.$el,"meetingPreparationOpened");if(!d.getGlobal().inMeeting){o.onLiveMeetingPreparation(false)}})}},_toolsOpen:function(o){var n=this;if(o){b.addClass(n.$el,"toolsOpened")}else{n.sideBarRadioChannel.once("sideView:after:closePanel",function(){b.removeClass(n.$el,"toolsOpened")})}},_layoutEditable:function(){b.addClass(this.$el,"customizeMenuOpened");this.staticCollectionView.layoutEditable(true)},_layoutUneditable:function(){var n=this;n.sideBarRadioChannel.once("sideView:after:closePanel",function(){b.removeClass(n.$el,"customizeMenuOpened")});n.staticCollectionView.layoutEditable(false)},_unfocus:function(){this.staticCollectionView.focus(false);this.sideBarRadioChannel.off("sideBarView:customize",this.setLayoutEditableDelegate);b.removeClass(this.$el,"focused");b.removeClass(g(".sideView"),"mapFocused")},_focus:function(){this.staticCollectionView.focus(true);this.sideBarRadioChannel.on("sideBarView:customize",this.setLayoutEditableDelegate)},_socketMeetingFocus:function(){if(this.$el.hasClass("toolsOpened")){this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}this.staticRadioChannel.trigger("static:focusView",this)},_beforeChangeView:function(){b.addClass(this.$el,"focused");b.addClass(g(".sideView"),"mapFocused")},_minimize:function(){this.uiRadioChannel.trigger("before:minimizeTransition");b.removeClass(this.$el,"maximize");this.uiRadioChannel.trigger("after:minimizeTransition")},_maximize:function(){this.uiRadioChannel.trigger("before:maximizeTransition");b.addClass(this.$el,"maximize");this.uiRadioChannel.trigger("after:maximizeTransition")},onSessionChanged:function(){this.firstFocus();this.staticCollectionView.collection.setFromPid(this.model.id);this.enableLive(false,{forced:true});this.enableLive(true,{forced:true})},firstFocus:function(){this.staticRadioChannel.trigger("static:focusView",this);this.staticRadioChannel.trigger("after:unFocus",{focusView:this,unfocusView:null});this.staticRadioChannel.trigger("after:minimize",{focusView:this,unfocusView:null})},pressEventCallback:function(n){this.tapEventCallback(n)},tapEventCallback:function(o){var n=this._getViewElement(o.target);if(d.is(n)&&n.id===this.cid){this.staticRadioChannel.trigger("static:focusView",this)}},setFocus:function h(n){this.callParent(m.__super__,"setFocus",[n]);if(n===true){widget.setTitle(this.getTitle())}},getTitle:function(){return widget.getValue("WidgetTitle")}});return m});define("DS/DEL3DLeanViews/Panels/MeetingView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackbone/backbone.1.3.3/backbone","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Panels/MeetingView.template.html","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanCollectionViews/SideCollectionViews/SelectedLeangetCollectionView","css!DS/DEL3DLeanViews/assets/css/Panels/MeetingView.css"],function(f,g,l,k,i,m,j,e,c,d,h,b){var a=i.View.extend({className:"meetingView",title:null,sideBarRadioChannel:m.channel("sidebar"),meetingRadioChannel:m.channel("meeting"),icon:e.getWebappsAssetUrl("DEL3DLeanViews","icons")+"/MeetingPanel/PanelIcon.svg",iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),regions:{meeting5ButtonRegion:{selector:".meeting5Button",replaceElement:true},meeting10ButtonRegion:{selector:".meeting10Button",replaceElement:true},meeting15ButtonRegion:{selector:".meeting15Button",replaceElement:true},meeting30ButtonRegion:{selector:".meeting30Button",replaceElement:true},meetingViewContentRegion:{selector:".meetingViewContent"},meetingStartFooterRegion:{selector:".meetingStartFooter"},selectedLeangetCollectionRegion:{selector:".selectedLeangetCollectionView",replaceElement:true}},events:{},template:l.template(j),initialize:function(){this.parent=this.getOption("parent");this.title=d.getTranslation("meetingTitle");this.time=5*60000;this.onSelectLeangetDelegate=g.proxy(this.onSelectLeanget,this);this.onStartMeetingDelegate=g.proxy(this.onStartMeeting,this);this.onEndMeetingDelegate=g.proxy(this.onEndMeeting,this);this.onUpdateTimeDelegate=g.proxy(this.onUpdateTime,this);this.selectedLeangetCollection=new k.Collection();this.selectedLeangetViewCollection=new b({collection:this.selectedLeangetCollection});this.selectedLeangetViewCollection.render();this.meeting5ButtonView=new h({title:"5",actionName:"Meeting5",mode:"radio",parentView:this,callback:this.onUpdateTimeDelegate});this.meeting10ButtonView=new h({title:"10",actionName:"Meeting10",mode:"radio",parentView:this,callback:this.onUpdateTimeDelegate});this.meeting15ButtonView=new h({title:"15",actionName:"Meeting15",mode:"radio",parentView:this,callback:this.onUpdateTimeDelegate});this.meeting30ButtonView=new h({title:"30",actionName:"Meeting30",mode:"radio",parentView:this,callback:this.onUpdateTimeDelegate});this.meetingStart=new h({title:" "+d.getTranslation("meetingStart"),actionName:"meetingStart",callback:this.onStartMeetingDelegate});this.meetingEnd=new h({title:" "+d.getTranslation("meetingEnd"),actionName:"meetingEnd",callback:this.onEndMeetingDelegate})},onRender:function(){this.showChildView("selectedLeangetCollectionRegion",this.selectedLeangetViewCollection);this.showChildView("meeting5ButtonRegion",this.meeting5ButtonView);this.showChildView("meeting10ButtonRegion",this.meeting10ButtonView);this.showChildView("meeting15ButtonRegion",this.meeting15ButtonView);this.showChildView("meeting30ButtonRegion",this.meeting30ButtonView);this.showChildView("meetingStartFooterRegion",this.meetingStart);this.meeting5ButtonView.setChecked(true)},onOpen:function(){c.addClass(g(".sideView"),"onMeeting");this.sideBarRadioChannel.on("view:selectLeanget",this.onSelectLeangetDelegate)},onUpdateTime:function(o,n){if(n==="Meeting5"){this.time=5*60000}else{if(n==="Meeting10"){this.time=10*60000}else{if(n==="Meeting15"){this.time=15*60000}else{if(n==="Meeting30"){this.time=30*60000}}}}},onClose:function(){c.removeClass(g(".sideView"),"onMeeting");if(f.getGlobal().inGuidedMeeting!==true){for(var n=this.selectedLeangetCollection.length;n>=1;){this.onSelectLeanget(this.selectedLeangetCollection.models[--n].get("view"))}}this.sideBarRadioChannel.trigger("sideBarView:meetingPreparation",false);this.sideBarRadioChannel.off("view:selectLeanget",this.onSelectLeangetDelegate)},onSelectLeanget:function(o){var n=this.selectedLeangetCollection.where({view:o})[0];if(f.is(n)){o=n.get("view");o.selectedForMeeting=false;c.removeClass(o.$el,"selectedForMeeting");this.selectedLeangetViewCollection.reorderBeforeRemove(n);this.selectedLeangetCollection.remove(n)}else{if(this.selectedLeangetCollection.length<14){o.selectedForMeeting=true;c.addClass(o.$el,"selectedForMeeting");this.selectedLeangetCollection.add(new k.Model({view:o,viewmodel:o.model,order:this.selectedLeangetCollection.length}))}}},onStartMeeting:function(){this.sideBarRadioChannel.trigger("sideBarView:meetingPreparation",false);this.meetingRadioChannel.trigger("meeting:startMeeting",this.selectedLeangetViewCollection,this.time);this.detachChildView("meetingStartFooterRegion",this.meetingStart);if(f.getGlobal().isMeetingLeader===true){this.showChildView("meetingStartFooterRegion",this.meetingEnd)}this.sideBarRadioChannel.on("sideBarView:endMeeting",this.onEndMeetingDelegate);if(f.getGlobal().inGuidedMeeting===true){this.selectedLeangetViewCollection.onGuidedMeetingStart()}else{this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}},onEndMeeting:function(){this.sideBarRadioChannel.off("sideBarView:endMeeting",this.onEndMeetingDelegate);if(f.getGlobal().isMeetingLeader===true){this.detachChildView("meetingStartFooterRegion",this.meetingEnd)}this.showChildView("meetingStartFooterRegion",this.meetingStart);g(".currentMeetingView").addClass("hideCurrentMeetingView");if(f.getGlobal().inGuidedMeeting===true){for(var n=this.selectedLeangetCollection.length;n>=1;){this.onSelectLeanget(this.selectedLeangetCollection.models[--n].get("view"))}this.meetingRadioChannel.trigger("meeting:resetAndEndMeeting")}else{this.meetingRadioChannel.trigger("meeting:endMeeting")}this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")}});return a});define("DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/PlayerCoachMarkView",["UWA/Core","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanResources/ResourcesManager","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/CoachMarkView","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/CoachMarkView.css"],function(e,b,c,a){var d=a.extend({modelEvents:{"change:V_DEL3DL_Url":"hideShowRules"},templateContext:function(){return b.extend(this.model.toJSON(),{iconPath:this.iconPath,infraCoachMarkImg:"videoplayerEmptyImg.svg",infraCoachMarkFocusImg:"videoplayerCoachMarkImg.svg",infraCoachMarkFocusRessource:c.getTranslation("coachmark_player")})},_initialize:function(){},hideShowRules:function(){if(this.model.hasUrl()){this.$el.hide();this.coachMarkHidden=true}else{this.$el.show();this.coachMarkHidden=false}}});return d});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/PlayerView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/PlayerSettingsView","DS/DEL3DLeanViews/StaticViews/InfraViews/CoachMarkViews/PlayerCoachMarkView","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/PlayerView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/PlayerView.css"],function(i,g,v,q,j,b,d,m){var h=q.extend({className:"leangetView playerView",ui:{widgetContainer:".widgetContainer",video:"video"},extendModelEvents:{"change:V_DEL3DL_Url":"onURLChange"},template:v.template(m),onURLChange:function e(){this.render()},onRender:function h(){q.prototype.onRender.call(this);if(this.infraView.maximized){this.playVideo()}else{this.pauseVideo()}},onReload:function u(){this.loadVideo()},onAttach:function c(){if(this.infraView.maximized){this.playVideo()}else{this.pauseVideo()}},onDetatch:function n(){this.pauseVideo()},switchToolbarSketch:function o(){var w=g("video",this.$el)[0];if(w.controls===true){this.pauseVideo()}else{this.playVideo()}},canCapture:function(){return this.isSameOrigin(this.model.get("V_DEL3DL_Url"))},onBeforeCapture:function(){this.pauseVideo();var x=g(".playerCanvas",this.$el)[0];var A=x.getContext("2d");var y=g("video",this.$el)[0];var w=y.videoWidth;var z=y.videoHeight;x.width=w;x.height=z;A.fillRect(0,0,w,z);A.drawImage(y,0,0,w,z);g("video",this.$el).css("background-image","url("+x.toDataURL()+")");g("video",this.$el).css("background-size","auto "+y.clientHeight+"px");A.clearRect(0,0,w,z)},onAfterCapture:function(){g("video",this.$el).css("background-image","");g("video",this.$el).css("background-size","");this.playVideo()},setFocusView:function t(w){h.__super__.setFocusView.call(this,w);if(w){this.playVideo();g("video",this.$el).on("play",this.onPlayDelegate);g("video",this.$el).on("pause",this.onPauseDelegate);g("video",this.$el).on("seeked",this.onSeekedDelegate)}else{g("video",this.$el).off("play",this.onPlayDelegate);g("video",this.$el).off("pause",this.onPauseDelegate);g("video",this.$el).off("seeked",this.onSeekedDelegate);this.pauseVideo()}},onPlay:function p(){if(i.getGlobal().inMeeting&&i.getGlobal().isMeetingLeader){this.liveIt("liveOnPlay")}},liveOnPlay:function(){var w=this.getUI("video")[0];w.play()},onPause:function r(){if(i.getGlobal().inMeeting&&i.getGlobal().isMeetingLeader){this.liveIt("liveOnPause")}},liveOnPause:function(){var w=this.getUI("video")[0];w.pause()},onSeeked:function f(){if(i.getGlobal().inMeeting&&i.getGlobal().isMeetingLeader){var w=this.getUI("video")[0];w.pause();this.liveIt("liveOnSeeked",[w.currentTime])}},liveOnSeeked:function(x){var w=this.getUI("video")[0];w.pause();w.currentTime=x},playVideo:function l(){if(this.model.hasUrl()){var w=this.getUI("video")[0];w.disablePictureInPicture=true;if(!i.getGlobal().inMeeting){w.play();w.controls=true}else{if(i.getGlobal().isMeetingLeader){this.onSeeked();w.controls=true}}}},pauseVideo:function s(){if(this.model.hasUrl()){var w=this.getUI("video")[0];w.pause();w.controls=false}},loadVideo:function k(){if(this.model.hasUrl()){var w=this.getUI("video")[0];w.load()}},initialize:function a(w){this.settingsView=j.createView(b,{model:this.model});this.coachMarkView=j.createView(d,{model:this.model,parentView:w.parentView});this.onPlayDelegate=g.proxy(this.onPlay,this);this.onPauseDelegate=g.proxy(this.onPause,this);this.onSeekedDelegate=g.proxy(this.onSeeked,this);q.prototype.initialize.apply(this,[w])}});return h});define("DS/DEL3DLeanViews/CenterView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/StaticViews/MapView","DS/DEL3DLeanViews/assets/enums/CollectionViewsEnum","text!DS/DEL3DLeanViews/assets/template/CenterView.template.html","css!DS/DEL3DLeanViews/assets/css/CenterView.css"],function(b,f,a,e,d){var c=f.View.extend({mapView:null,name:"CenterView",className:"centerView",regions:{mapRegion:{el:"> .mapViewContent",replaceElement:true}},events:{},template:b.template(d),initialize:function(){this.mapView=new a({collectionViewsEnum:e})},getMapView:function(){return this.mapView},onShow:function(){},onRender:function(){this.showChildView("mapRegion",this.mapView)}});return c});define("DS/DEL3DLeanViews/SideBar/SidePanelView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/DEL3DLeanViews/Panels/ToolsView","DS/DEL3DLeanViews/Panels/MeetingView","DS/DEL3DLeanViews/Panels/CustomizeView","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/assets/enums/SideBarActionEnum","DS/DEL3DLeanResources/ResourcesManager","text!DS/DEL3DLeanViews/assets/template/SideBar/SidePanelView.template.html","css!DS/DEL3DLeanViews/assets/css/SideBar/SidePanelView.css"],function(e,f,l,j,k,b,a,h,g,c,d){var i=j.View.extend({meetingView:null,customizeView:null,toolsView:null,closeButtonView:null,sidePanelContentView:null,className:"sidePanelView",regions:{sidePanelContentRegion:".sidePanelContent",sidePanelCloseRegion:".sidePanelClose"},events:{},childViewEvents:{},childViewTriggers:{"buttonView:clicked":"sidePanelView:closePanel"},template:l.template(d),templateContext:function(){return{panelHeaderTitle:e.is(this.sidePanelContentView)?this.sidePanelContentView.title:"",panelHeaderIcon:e.is(this.sidePanelContentView)?this.sidePanelContentView.icon:""}},initialize:function(){this.meetingView=new b({parent:this});this.customizeView=new a();this.toolsView=new k();this.closeButtonView=new h({icon:"EditStickyNote/Close.svg",actionName:"Close"})},onShow:function(){},onAttach:function(){},onRender:function(){},openPanelView:function(m){this.panelOpened=m;switch(m){case g.MEETING:this.sidePanelContentView=this.meetingView;break;case g.CUSTOMIZE:this.sidePanelContentView=this.customizeView;break;default:this.sidePanelContentView=this.toolsView;break}this.render();this.showChildView("sidePanelContentRegion",this.sidePanelContentView);this.showChildView("sidePanelCloseRegion",this.closeButtonView);this.sidePanelContentView.onOpen()},closePanelView:function(){this.panelOpened="";if(e.is(this.sidePanelContentView)){this.sidePanelContentView.onClose()}this.detachChildView("sidePanelContentRegion");this.detachChildView("sidePanelCloseRegion");this.$el.empty()}});return i});define("DS/DEL3DLeanViews/ChangeLogPanelView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/Components/PopupPanel","DS/VEN3DLeanHTML2CanvasJS/Showdown/showdown","text!DS/DEL3DLeanViews/assets/CHANGELOG.md","text!DS/DEL3DLeanViews/assets/template/ChangeLogPanelView.template.html","css!DS/DEL3DLeanViews/assets/css/ChangeLogPanelView.css"],function(a,c,j,f,l,k,d){var e=null;var h=f.extend({name:"ChangeLogPanelView",className:"changeLogPanelView",template:j.template(d),initialize:function b(m){f.prototype.initialize.apply(this,[m])},_extendedShowdown:function(){var m=new l.Converter({tables:true,strikethrough:true,tasklists:true});return m},onRender:function(){f.prototype.onRender.apply(this);var m=this._extendedShowdown();c(".changelogContainer",this.$el).html(m.makeHtml(k));widget.setValue("changeLogLength",e.getLength())},onDestroy:function g(){f.prototype.onDestroy.apply(this)},getLength:function(){return k.length}});function i(){if(!a.is(e)){e=new h()}return e}return i()});define("DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SketchSettingsView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SettingsView","DS/DEL3DLeanHttpRequest/ImageService","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","text!DS/DEL3DLeanViews/assets/template/Statics/Infra/SketchSettingsView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Infra/SketchSettingsView.css"],function(b,a,d,f,c){var e=a.extend({name:"SketchSettingsView",className:"settingsView",template:b.template(c),sideBarRadioChannel:f.channel("sidebar"),ui:{title:".title",url:".url",isStretch:"input.isStretch",isToolbarHidden:"input.isToolbarHidden",inputs:"input"},events:{"change @ui.title":"updateTitle","change @ui.url":"updateUrl","change @ui.isStretch":"updateStretch","change @ui.isToolbarHidden":"updateToolbarHidden","change @ui.inputs":"saveModel"},updateStretch:function(g){this.model.set("V_DEL3DL_Stretch",g.target.checked)},updateToolbarHidden:function(g){this.model.set("V_DEL3DL_ToolBarHidden",g.target.checked)},updateUrl:function(){var h=this.getUI("url");var g=h.val();this.model.set("V_DEL3DL_Background_Image_Url",g);if(this.model.has("V_DEL3DL_Background_Image")){d.deleteDocument(this.model.get("V_DEL3DL_Background_Image"));this.model.set("V_DEL3DL_Background_Image",null)}},onFavoriteSelected:function(g){e.__super__.onFavoriteSelected.call(this,g);this.sideBarRadioChannel.trigger("sideBarView:closeOpenMenu")},onAttach:function(){var g=this.getUI("url");g.val(UWA.is(this.model.get("V_DEL3DL_Background_Image_Url"))?this.model.get("V_DEL3DL_Background_Image_Url"):"");e.__super__.onAttach.call(this)}});return e});define("DS/DEL3DLeanViews/StaticViews/LeangetViews/SketchView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/StaticViews/InfraViews/LeangetView","DS/DEL3DLeanCollections/Collection.manager","DS/DEL3DLeanViews/Factories/ViewsFactory","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/Components/CircleMenuCollectionView","DS/DEL3DLeanViews/Components/SketchComponent","DS/DEL3DLeanModels/SketchUtils/Action","DS/DEL3DLeanViews/StaticViews/InfraViews/SettingsViews/SketchSettingsView","DS/DEL3DLeanHttpRequest/ImageService","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/Statics/Leangets/SketchView.template.html","css!DS/DEL3DLeanViews/assets/css/Statics/Leangets/SketchView.css"],function(f,e,v,p,r,w,i,j,m,a,c,h,q,d,t,l){var u=r.extend({className:"leangetView sketchView",template:v.template(l),color:"Black",colorButtons:[{hasIcon:false,title:"",actionName:"penColorBlack"},{hasIcon:false,title:"",actionName:"penColorRed"},{hasIcon:false,title:"",actionName:"penColorOrange"},{hasIcon:false,title:"",actionName:"penColorYellow"},{hasIcon:false,title:"",actionName:"penColorBlue"},{hasIcon:false,title:"",actionName:"penColorGreen"}],imageButtons:[{hasIcon:true,icon:"Sketch/Open.svg",actionName:"selectImage"},{hasIcon:true,icon:"Sketch/ImageDelete.svg",actionName:"clearImage"}],iconPath:d.getWebappsAssetUrl("DEL3DLeanViews","icons"),childViewEvents:{"circleMenuCollectionView:buttonClick":"onCircleButton"},extendModelEvents:{"change:V_DEL3DL_Data":"dataUpdated","change:V_DEL3DL_Draw_Data":"onSketchDrawupdate"},ui:{sketch:".sketchLeangetDrawArea",foregroundImage:".sketchLeangetForegroundImage",backgroundImage:".sketchLeangetBackgroundImage"},regions:{penButtonRegion:{selector:"#sketchLeangetSketchPenButton",replaceElement:false},colorCircleButtonRegion:{selector:"#sketchLeangetSketchColorCircleButton",replaceElement:false},eraseButtonRegion:{selector:"#sketchLeangetSketchEraseButton",replaceElement:false},clearButtonRegion:{selector:"#sketchLeangetSketchClearButton",replaceElement:false},undoButtonRegion:{selector:"#sketchLeangetSketchUndoButton",replaceElement:false},redoButtonRegion:{selector:"#sketchLeangetSketchRedoButton",replaceElement:false},imageCircleButtonRegion:{selector:"#sketchLeangetSketchImageCircleButton",replaceElement:false},imageButtonRegion:{selector:"#sketchLeangetSketchImageButton",replaceElement:false},hideShowButtonRegion:{selector:"#sketchLeangetSketchHideShowButton",replaceElement:false}},initialize:function(x){this.invalidate();this.settingsView=i.createView(h,{model:this.model});this._timer=null;this._timerInterval=1000;this.loadData();u.__super__.initialize.call(this,x);this.onPenDelegate=e.proxy(this.onPen,this);this.onEraseDelegate=e.proxy(this.onErase,this);this.onClearDelegate=e.proxy(this.onClear,this);this.onUndoDelegate=e.proxy(this.onUndo,this);this.onRedoDelegate=e.proxy(this.onRedo,this);this.onImageDelegate=e.proxy(this.onImage,this);this.onSketchDrawEndDelegate=e.proxy(this.saveSketch,this);this.onSketchLiveDelegate=e.proxy(this.onSketchLive,this);this.onRenderDelegate=e.proxy(this.onRender,this);this.onResizeDelegate=e.proxy(this.onResize,this);this.beforeSidePanel=e.proxy(this.beforeSidePanelTransition,this);this.afterSidePanel=e.proxy(this.afterSidePanelTransition,this);this.onHideShowDelegate=e.proxy(this.onHideShowButtons,this);this.penButtonView=new j({mode:"checkbox",manualyCheck:true,checked:true,actionName:"sketchPen",icon:"Sketch/StickyNotePenUnselected.svg",iconChecked:"Sketch/Pen"+this.color+".svg",callback:this.onPenDelegate});this.colorCircleMenuCollectionView=new m({circleMenuButtons:this.colorButtons,originRadius:0});this.eraseButtonView=new j({mode:"checkbox",manualyCheck:true,icon:"Sketch/StickyNoteEraseUnselected.svg",iconChecked:"Sketch/StickyNoteEraseDark.svg",callback:this.onEraseDelegate});this.clearButtonView=new j({actionName:"sketchRemoveAll",icon:"Sketch/StickyNoteDeleteDark.svg",callback:this.onClearDelegate});this.undoButtonView=new j({icon:"Sketch/Undo.svg",callback:this.onUndoDelegate});this.redoButtonView=new j({icon:"Sketch/Redo.svg",callback:this.onRedoDelegate});this.imageCircleMenuCollectionView=new m({circleMenuButtons:this.imageButtons,originRadius:-0.5});this.imageButtonView=new j({icon:"Sketch/ImageChooser.svg",callback:this.onImageDelegate});this.hideShowButtons=new j({mode:"checkbox",actionName:"hideShowButtons",icon:"hideButtonsSketch.svg",iconChecked:"showButtonsSketch.svg",callback:this.onHideShowDelegate});widget.addEvent("endEdit",e.proxy(this.onPreferencesEdited,this))},onHideShowButtons:function(){if(this.hideShowButtons.getChecked()){if(!this.penButtonView.getChecked()){this.onPen()}else{this.hideColorPicker()}t.removeClass(this.$el,"sketchLeangetSketchButtonsShow")}else{t.addClass(this.$el,"sketchLeangetSketchButtonsShow")}},loadData:function(){this._data=this.model.jsonData()},saveData:function(x){try{var y=JSON.stringify(this._data)||{};this.model.save({V_DEL3DL_Data:y},x)}catch(z){return false}return true},switchToolbarSketch:function(){},canCapture:function(){if(this.model.has("V_DEL3DL_Background_Image_Url")){return this.isSameOrigin(this.model.get("V_DEL3DL_Background_Image_Url"))}return true},onBeforeCapture:function(){},onAfterCapture:function(){},onAfterAnnotate:function o(){this.showButtons()},onBeforeAnnotate:function k(){this.hideButtons()},onBeforeRender:function(){if(this.sketch){this.unbind();delete this.sketch}},onDestroy:function g(){u.__super__.onDestroy.apply(this);if(this.model.has("V_DEL3DL_Background_Image")){q.deleteDocument(this.model.get("V_DEL3DL_Background_Image"))}},onRender:function(){u.__super__.onRender.apply(this);this._initSketchAndBind();if(f.is(this._data)&&this._data.V_DEL3DL_Stretch===true){t.addClass(e(".sketchLeangetBackgroundImage",this.$el),"stretched")}if(this.model.has("V_DEL3DL_Background_Image_Url")){this.setBackgroundImage(this.model.get("V_DEL3DL_Background_Image_Url"))}else{if(this.model.has("V_DEL3DL_Background_Image")){this.setBackgroundImage(this.model.get("V_DEL3DL_Background_Image"))}}if(e("#sketchImageUpload."+this.cid).length===0){this.changeSketchImageInput=e(document.createElement("input"));this.changeSketchImageInput.attr("type","file");this.changeSketchImageInput.attr("accept","image/*");this.changeSketchImageInput.attr("id","sketchImageUpload."+this.cid);this.changeSketchImageInput.context.onchange=e.proxy(function(){var C=this.changeSketchImageInput.context.files;var B=C.length;var x;var D=e.proxy(function(){q.setImage(x.result,null,null,C[0].name).then(e.proxy(function(E){if(this.model.has("V_DEL3DL_Background_Image")){q.deleteDocument(this.model.get("V_DEL3DL_Background_Image"))}this.model.save({V_DEL3DL_Background_Image:E,V_DEL3DL_Background_Image_Url:null})},this))},this);for(var y=0;y<B;y++){var z=C[y];var A=new RegExp("^image/");if(z&&z.type.match(A)){x=new FileReader();x.addEventListener("load",D,false);x.readAsDataURL(z)}}},this);this.changeSketchImageInput.context.onchange()}},bind:function(){this.on("change",this.onRenderDelegate);this.sketch.on("sketch:draw:end",this.onSketchDrawEndDelegate);this.sketch.on("sketch:live",this.onSketchLiveDelegate);this.uiRadioChannel.on("before:sidePanelClose before:sidePanelOpen",this.beforeSidePanel);this.uiRadioChannel.on("after:sidePanelClose after:sidePanelOpen",this.afterSidePanel)},unbind:function(){this.off("change",this.onRenderDelegate);this.sketch.off("sketch:draw:end",this.onSketchDrawEndDelegate);this.sketch.off("sketch:live",this.onSketchLiveDelegate);this.uiRadioChannel.off("before:sidePanelClose before:sidePanelOpen",this.beforeSidePanel);this.uiRadioChannel.off("after:sidePanelClose after:sidePanelOpen",this.afterSidePanel)},showColorPicker:function(){this.colorCircleMenuCollectionView.showMenu()},hideColorPicker:function(){this.colorCircleMenuCollectionView.hideMenu()},showImagePicker:function(){this.imageCircleMenuCollectionView.showMenu()},hideImagePicker:function(){this.imageCircleMenuCollectionView.hideMenu()},onResize:function(){if(!this.$el.width()){return}var A=this;var y=A.getUI("sketch");if(y){var z=A.$el.width();var x=A.$el.height();if(A.sketch){A.sketch.resize(z,x)}}},beforeSidePanelTransition:function(){var x=widget.getValue("Animations");if(this.isFocus&&(x==="true"||x===true)){this.enableSketch(false)}},afterSidePanelTransition:function(){var x=widget.getValue("Animations");if(this.isFocus&&(x==="true"||x===true)){this.enableSketch(true)}},onCircleButton:function(x,y){if(y.indexOf("penColor")>-1){this.onColorPicker(x)}else{this.onImagePicker(x,y)}},onImagePicker:function(x,y){if(y==="selectImage"){this.changeSketchImageInput.trigger("click")}else{if(y==="clearImage"){if(this.model.has("V_DEL3DL_Background_Image")){q.deleteDocument(this.model.get("V_DEL3DL_Background_Image"));this.model.set("V_DEL3DL_Background_Image",null)}if(this.model.has("V_DEL3DL_Background_Image_Url")){this.model.set("V_DEL3DL_Background_Image_Url",null)}this.model.save()}}this.hideImagePicker()},onColorPicker:function(y){var B=y.$el.attr("class");var z=new RegExp("penColor(\\w+)");var x=z.exec(B);if(x&&x.length>1){this.penButtonView.$el.removeClass(this.color);this.color=x[1];this.penButtonView.$el.addClass(this.color);this.penButtonView.set("iconChecked","Sketch/Pen"+this.color+".svg");var A=y.$el.css("backgroundColor");this.sketch.setColor(this._toHexaColor(A))}this.hideColorPicker()},onPen:function(){this.eraseButtonView.setChecked(false);if(this.sketch){if(this.penButtonView.getChecked()){if(this.colorCircleMenuCollectionView&&this.colorCircleMenuCollectionView.isShowed()){this.hideColorPicker()}else{this.showColorPicker()}}else{this.penButtonView.setChecked(true);this.sketch.enablePen();this.penButtonView.$el.addClass(this.color);this.penButtonView.set("iconChecked","Sketch/Pen"+this.color+".svg")}}},onErase:function(){this.eraseButtonView.setChecked(true);this.penButtonView.setChecked(false);if(this.sketch&&this.eraseButtonView.getChecked()){this.hideColorPicker();this.sketch.enableErase()}},onClear:function(x){this.liveIt("onClear",arguments,{args:[this.getLiveId()]});this._undoRedoCall("clear",x)},onUndo:function(x){this.liveIt("onUndo",arguments,{args:[this.getLiveId()]});this._undoRedoCall("undo",x)},onRedo:function(x){this.liveIt("onRedo",arguments,{args:[this.getLiveId()]});this._undoRedoCall("redo",x)},onImage:function(){if(this.imageCircleMenuCollectionView&&this.imageCircleMenuCollectionView.isShowed()){this.hideImagePicker()}else{this.showImagePicker()}},dataUpdated:function(z){var x=JSON.parse(z.attributes.V_DEL3DL_Data);var y=JSON.parse(z._previousAttributes.V_DEL3DL_Data);x=f.is(x)?x:{};y=f.is(y)?y:{};if(x.V_DEL3DL_Background_Image!==y.V_DEL3DL_Background_Image){if(f.is(x.V_DEL3DL_Background_Image)){this.setBackgroundImage(x.V_DEL3DL_Background_Image)}else{if(!f.is(x.V_DEL3DL_Background_Image_Url)){this.setBackgroundImage("")}}}if(x.V_DEL3DL_Background_Image_Url!==y.V_DEL3DL_Background_Image_Url){if(f.is(x.V_DEL3DL_Background_Image_Url)){this.setBackgroundImage(x.V_DEL3DL_Background_Image_Url)}else{if(!f.is(x.V_DEL3DL_Background_Image)){this.setBackgroundImage("")}}}if(x.V_DEL3DL_Stretch!==y.V_DEL3DL_Stretch){this.onStretchChanged(z,x.V_DEL3DL_Stretch)}},onSketchDrawupdate:function(){if(!this.isFocus&&this._timer===null){this.invalidate();this.sketch.redraw(this.model.get("V_DEL3DL_Draw_Data"));this.refreshForeground()}},onStretchChanged:function(y,x){if(x===true){t.addClass(e(".sketchLeangetBackgroundImage",this.$el),"stretched")}else{t.removeClass(e(".sketchLeangetBackgroundImage",this.$el),"stretched")}},onPreferencesEdited:function(){if(this.sketch){this.sketch.setLineWidth(parseInt(widget.getValue("SketchThickness")))}},_updateUndoRedo:function(){this.undoButtonView.setEnabled(this.sketch.hasUndo());this.redoButtonView.setEnabled(this.sketch.hasRedo())},_toHexaColor:function(y){var z=y.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete (z[0]);for(var x=1;x<=3;++x){z[x]=parseInt(z[x]).toString(16);if(z[x].length===1){z[x]="0"+z[x]}}return"#"+z.join("")},startSaveTimer:function(){if(this._timer){this.stopSaveTimer()}this._timer=setInterval(this.timerSaveEnd.bind(this),this._timerInterval);return this},stopSaveTimer:function(){if(this._timer){clearInterval(this._timer);this._timer=null}return this},timerSaveEnd:function(){if(this.sketch.noTouch()){if(this._saveLiveId===this.getLiveId()){this.model.save({V_DEL3DL_Draw_Data:this.sketch.encode()})}this.stopSaveTimer()}},saveSketch:function(x){this._updateUndoRedo();this._saveLiveId=v.isObject(x)||!f.is(x)?this.getLiveId():x;this.startSaveTimer()},enableSketch:function(y,C,x,B){var A=this;var D=this.getUI("foregroundImage");var z=this.getUI("sketch");if(y&&A.isFocus){A.refreshAndReset();t.removeClass(z,"sketchLeangetHidden");t.addClass(D,"sketchLeangetHidden")}else{if(A.sketch){A.sketch.toDataUrl(undefined,x,B).then(function(E){D.attr("src",E);t.removeClass(D,"sketchLeangetHidden");t.addClass(z,"sketchLeangetHidden")})}}},refreshForeground:function(){if(!this.isValid()&&f.is(this.sketch)){var x=this.getUI("foregroundImage");this.sketch.toDataUrl(undefined,this.$el.width(),this.$el.height()).then(function(y){x.attr("src",y)});this.validate()}},isSketchEnabled:function(){return !this.getUI("sketch").hasClass("sketchLeangetHidden")},setFocusView:function(x){u.__super__.setFocusView.apply(this,[x]);if(this.isFocus){this.validate();this.showButtons();this.enableSketch(true);this.off("change",this.onRenderDelegate)}else{this.enableSketch(false);this.hideButtons();this.on("change",this.onRenderDelegate)}},afterSwipe:function(x){u.__super__.afterSwipe.apply(this,[]);setTimeout(e.proxy(function(){if(this.isSketchEnabled()){this.sketch.cancelDraws(x.touchNumber)}},this),150)},refreshAndReset:function(){this.onResize();if(this.sketch&&!this.penButtonView.getChecked()){this.onPen()}if(this.colorCircleMenuCollectionView&&this.colorCircleMenuCollectionView.isShowed()){this.hideColorPicker()}},setBackgroundImage:function(x){var y=this.getUI("backgroundImage");if(/^[a-f0-9]+$/i.test(x)){q.getImage(x,null,true).then(e.proxy(function(z){y.attr("src",z);y.show()},this))}else{y.attr("src",x+"?"+new Date().getTime());y.show()}},onReload:function(){var x=this.getUI("backgroundImage");x.attr("src","");if(this.model.has("V_DEL3DL_Background_Image_Url")){this.setBackgroundImage(this.model.get("V_DEL3DL_Background_Image_Url"))}else{if(this.model.has("V_DEL3DL_Background_Image")){this.setBackgroundImage(this.model.get("V_DEL3DL_Background_Image"))}}},showButtons:function n(){this.showChildView("colorCircleButtonRegion",this.colorCircleMenuCollectionView);this.showChildView("penButtonRegion",this.penButtonView);this.showChildView("eraseButtonRegion",this.eraseButtonView);this.showChildView("clearButtonRegion",this.clearButtonView);this.showChildView("undoButtonRegion",this.undoButtonView);this.showChildView("redoButtonRegion",this.redoButtonView);this.showChildView("imageCircleButtonRegion",this.imageCircleMenuCollectionView);this.showChildView("imageButtonRegion",this.imageButtonView);this.showChildView("hideShowButtonRegion",this.hideShowButtons);if(!this.hideShowButtons.getChecked()&&!this.model.get("V_DEL3DL_ToolBarHidden")){t.addClass(this.$el,"sketchLeangetSketchButtonsShow")}else{this.hideShowButtons.setChecked(this.model.get("V_DEL3DL_ToolBarHidden"))}},hideButtons:function s(){t.removeClass(this.$el,"sketchLeangetSketchButtonsShow");this.detachChildView("colorCircleButtonRegion",this.colorCircleMenuCollectionView);this.detachChildView("penButtonRegion",this.penButtonView);this.detachChildView("eraseButtonRegion",this.eraseButtonView);this.detachChildView("clearButtonRegion",this.clearButtonView);this.detachChildView("undoButtonRegion",this.undoButtonView);this.detachChildView("redoButtonRegion",this.redoButtonView);this.detachChildView("imageCircleButtonRegion",this.imageCircleMenuCollectionView);this.detachChildView("imageButtonRegion",this.imageButtonView);this.detachChildView("hideShowButtonRegion",this.hideShowButtons)},onSketchLive:function b(){var y=arguments[0].fctName||arguments[0];var x=arguments[0].options||{};if(f.is(this.sketch)&&!this.liveIt("onSketchLive",arguments,x)){this.sketch[y].apply(this.sketch,Object.values(arguments).slice(1))}},isValid:function(){return this._valid},validate:function(){this._valid=true},invalidate:function(){this._valid=false},_initSketchAndBind:function(x){var y=this.model.get("V_DEL3DL_Draw_Data");this.sketch=new a({container:this.getUI("sketch")[0],pid:this.model.id,sketchImage:x,lineWidth:parseInt(widget.getValue("SketchThickness")),buildCallback:e.proxy(function(){this.enableSketch(this.isFocus)},this),color:this.color});if(y){this.sketch.decode(y)}this._updateUndoRedo();this.bind();this.sketch.drawUndoStack().then(function(){this.enableSketch(this.isFocus)}.bind(this))},_undoRedoCall:function(y,x){if(this.sketch){x=v.isObject(x)||!f.is(x)?this.getLiveId():x;this.sketch[y](x);this._updateUndoRedo();this.saveSketch(x)}}});return u});define("DS/DEL3DLeanViews/SideBar/SideView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanViews/SideBar/SideBarView","DS/DEL3DLeanViews/SideBar/SidePanelView","DS/DEL3DLeanViews/Utils/UIUtils","text!DS/DEL3DLeanViews/assets/template/SideBar/SideView.template.html","css!DS/DEL3DLeanViews/assets/css/SideBar/SideView.css"],function(e,f,i,h,j,d,g,c,a){var b=h.View.extend({sideBarView:null,sidePanelView:null,className:"sideView",regions:{sideViewContent:".sideViewContent"},events:{},childViewEvents:{"sidePanelView:closePanel":"closePanel","sideBarView:openPanel":"openPanel"},sideBarRadioChannel:j.channel("sidebar"),uiRadioChannel:j.channel("uiutils"),floatableRadioChannel:j.channel("floatable"),template:i.template(a),initialize:function(){this.sideBarView=new d({side:this.getOption("side")});this.sidePanelView=e.is(this.getOption("panel"))?this.getOption("panel"):new g();c.addClass(this.$el,this.getOption("side"));this.bindEvents()},bindEvents:function(){this.sideBarRadioChannel.on("sideBarView:closeOpenMenu",f.proxy(this.closeOpenMenu,this));this.sideBarRadioChannel.on("sideBarView:openMap",f.proxy(this.onOpenMap,this));this.floatableRadioChannel.on("floatableView:onEditIssueView",f.proxy(this.onEditIssue,this));this.floatableRadioChannel.on("floatableView:onEditActionView",f.proxy(this.onEditAction,this))},unbindEvents:function(){this.sideBarRadioChannel.off("sideBarView:closeOpenMenu",f.proxy(this.closeOpenMenu,this));this.sideBarRadioChannel.off("sideBarView:openMap",f.proxy(this.onOpenMap,this));this.floatableRadioChannel.off("floatableView:onEditIssueView",f.proxy(this.onEditIssue,this));this.floatableRadioChannel.off("floatableView:onEditActionView",f.proxy(this.onEditAction,this))},getPanelView:function(){return this.sidePanelView},closeOpenMenu:function(){if(this.$el.hasClass("sidePanelOpened")){this.closePanel()}},onOpenMap:function(){if(this.sidePanelView.parent===this){if(this.sidePanelView.sidePanelContentView.className!=="meetingView"){this.detachChildView("sideViewContent");this.sidePanelView.closePanelView();this.sidePanelView.parent=null;c.addClass(this.$el,"closeSidePanelWithoutTransition");c.removeClass(this.$el,"sidePanelOpened");setTimeout(f.proxy(function(){c.removeClass(this.$el,"closeSidePanelWithoutTransition")},this),220);this.showChildView("sideViewContent",this.sideBarView);this.sideBarRadioChannel.trigger("sideView:after:closePanel")}}},onEditIssue:function(k){if(k){c.addClass(this.$el,"editIssue")}else{c.removeClass(this.$el,"editIssue")}},onEditAction:function(k){if(k){c.addClass(this.$el,"editAction")}else{c.removeClass(this.$el,"editAction")}},switchPanelSide:function(){this.uiRadioChannel.once("before:sidePanelSwitch",f.proxy(function(){this.detachChildView("sideViewContent")},this));this.uiRadioChannel.once("after:sidePanelSwitch",f.proxy(function(){c.removeClass(f(".sideView"),"sideViewTransition");this.showChildView("sideViewContent",this.sidePanelView);this.sidePanelView.parent=this},this));this.sidePanelView.parent.detachChildView("sideViewContent");this.sidePanelView.parent.showChildView("sideViewContent",this.sidePanelView.parent.sideBarView);c.removeClass(this.sidePanelView.parent.$el,"sidePanelOpened");c.addClassWithTransition(this.$el,"sidePanelOpened","sidePanelSwitch")},closePanel:function(){var k=this.sidePanelView.panelOpened;this.uiRadioChannel.once("before:sidePanelClose",f.proxy(function(){this.detachChildView("sideViewContent");this.showChildView("sideViewContent",this.sideBarView);this.sidePanelView.closePanelView();this.sidePanelView.parent=null},this));this.uiRadioChannel.once("after:sidePanelClose",f.proxy(function(){c.removeClass(f(".sideView"),"sideViewTransition");this.sideBarRadioChannel.trigger("sideView:after:closePanel",k)},this));c.removeClassWithTransition(this.$el,"sidePanelOpened","sidePanelClose")},openPanel:function(k,l){if(this.sidePanelView.panelOpened===k){this.switchPanelSide();return}this.sideBarRadioChannel.trigger(l,true);if(e.is(this.sidePanelView.parent)){this.sidePanelView.parent.closePanel()}this.uiRadioChannel.once("before:sidePanelOpen",f.proxy(function(){this.detachChildView("sideViewContent")},this));this.uiRadioChannel.once("after:sidePanelOpen",f.proxy(function(){c.removeClass(f(".sideView"),"sideViewTransition");this.showChildView("sideViewContent",this.sidePanelView);this.sidePanelView.parent=this;this.sidePanelView.openPanelView(k);this.sideBarRadioChannel.trigger("sideView:after:openPanel",k)},this));c.addClassWithTransition(this.$el,"sidePanelOpened","sidePanelOpen")},onRender:function(){this.showChildView("sideViewContent",this.sideBarView)}});return b});define("DS/DEL3DLeanViews/MainView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","pluginDS!DS/VENBackboneRadio/backbone.radio.2.0.0/backbone.radio","DS/DEL3DLeanHttpRequest/TouchService","DS/DEL3DLeanViews/ChangeLogPanelView","DS/DEL3DLeanViews/CenterView","DS/DEL3DLeanViews/CurrentMeetingView","DS/DEL3DLeanViews/SideBar/SideView","DS/DEL3DLeanViews/Utils/UIUtils","DS/DEL3DLeanViews/assets/enums/SideEnum","DS/DEL3DLeanHttpRequest/MessageHandler","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Components/PopupArea","text!DS/DEL3DLeanViews/assets/template/MainView.template.html","css!DS/DEL3DLeanViews/assets/css/MainView.css"],function(f,g,o,l,q,p,n,j,d,b,c,h,m,e,a,i){var k=l.View.extend({sideViewPanel:null,sideLeftView:null,sideRightView:null,centerView:null,currentMeetingView:null,loadingView:null,sideBarRadioChannel:q.channel("sidebar"),meetingRadioChannel:q.channel("meeting"),staticRadioChannel:q.channel("static"),loadingRadioChannel:q.channel("loadging"),connectionChannel:q.channel("connection"),socketChannel:q.channel("live"),name:"MainView",className:"mainView",regions:{loadingRegion:{el:".loadingView",replaceElement:true},sideLeftRegion:{el:".sideLeft",replaceElement:true},sideRightRegion:{el:".sideRight",replaceElement:true},popupAreaRegion:{el:".popupArea",replaceElement:true},mainContentRegion:".mainContent"},ui:{changelog:".changelogButton",connection:".connectionButton > img"},events:{"click @ui.changelog":"toggleChangelog"},template:o.template(i),templateContext:function(){return{iconPath:this.iconPath,changelogChanged:n.getLength()!==widget.getValue("changeLogLength"),touchDetected:p.detectTouchscreen()}},iconPath:e.getWebappsAssetUrl("DEL3DLeanViews","icons"),initialize:function(r){f.getGlobal().inMeeting=false;r=r||{};this.sideLeftView=new b({side:h.LEFT});this.sideRightView=new b({side:h.RIGHT,panel:this.sideLeftView.getPanelView()});this.centerView=new j();this.currentMeetingView=new d();this.loadingView=r.loadingView;this.pendingViewToFocus=[];this.onMeetingStartDelegate=g.proxy(this.onMeetingStart,this);this.onMeetingEndDelegate=g.proxy(this.onMeetingEnd,this);this.onLoadedDelegate=g.proxy(this.onLoaded,this);this.onHttpResultDelegate=g.proxy(this.onHttpResult,this);this.onLiveConnectedDelegate=g.proxy(this.onLiveConnected,this);this.onLiveDisconnectedDelegate=g.proxy(this.onLiveDisconnected,this);this.onSocketMeetingStartDelegate=g.proxy(this.onSocketMeetingStart,this);this.onSocketMeetingStopDelegate=g.proxy(this.onSocketMeetingStop,this);this.focusViewDelegate=g.proxy(this.focusView,this);this.meetingRadioChannel.on("meeting:startMeeting",this.onMeetingStartDelegate);this.meetingRadioChannel.on("meeting:endMeeting",this.onMeetingEndDelegate);this.loadingRadioChannel.on("loaded",this.onLoadedDelegate);this.connectionChannel.on("httpResponse",this.onHttpResultDelegate);this.socketChannel.on("connected",this.onLiveConnectedDelegate);this.socketChannel.on("disconnected",this.onLiveDisconnectedDelegate);this.socketChannel.on("meeting:start",this.onSocketMeetingStartDelegate);this.socketChannel.on("meeting:stop",this.onSocketMeetingStopDelegate);this.staticRadioChannel.on("static:focusView",this.focusViewDelegate)},onDestroy:function(){this.meetingRadioChannel.off("meeting:startMeeting",this.onMeetingStartDelegate);this.meetingRadioChannel.off("meeting:endMeeting",this.onMeetingEndDelegate);this.loadingRadioChannel.off("loaded",this.onLoadedDelegate);this.connectionChannel.off("httpResponse",this.onHttpResultDelegate);this.socketChannel.off("connected",this.onLiveConnectedDelegate);this.socketChannel.off("disconnected",this.onLiveDisconnectedDelegate);this.socketChannel.off("meeting:start",this.onSocketMeetingStartDelegate);this.socketChannel.off("meeting:stop",this.onSocketMeetingStopDelegate);this.staticRadioChannel.off("static:focusView",this.focusViewDelegate)},getLoadingView:function(){return this.loadingView},getMapView:function(){return this.centerView.getMapView()},onLoaded:function(){var r=this;r.detachChildView("loadingRegion",r.loadingView);r.loadingView.destroy();g(".loadingView",r.$el).hide()},focusView:function(r){var s=this;if(s.focusInProgress){s.pendingViewToFocus.push(r)}else{s.focusInProgress=true;s.processFocus(r)}},focusPendingView:function(){var r=this;if(r.pendingViewToFocus.length>0){r.processFocus(r.pendingViewToFocus.shift())}else{r.focusInProgress=false}},processFocus:function(r){var s=this;if(!r.focused){s.staticRadioChannel.once("after:focus",function(){s.focusPendingView()});r.focus()}else{s.focusPendingView()}},onRender:function(){this.showChildView("sideLeftRegion",this.sideLeftView);this.showChildView("sideRightRegion",this.sideRightView);this.showChildView("mainContentRegion",this.centerView);this.showChildView("loadingRegion",this.loadingView);this.showChildView("popupAreaRegion",a);document.onselectstart=function(){return false};document.oncontextmenu=function(){return false};for(var r=0;r<document.styleSheets.length;r++){if(f.is(document.styleSheets.item(r).href)&&document.styleSheets.item(r).href.contains("/iframe.css")){document.styleSheets.item(r).disabled=true;break}}},_startGuidedMeeting:function(s,r){f.getGlobal().inGuidedMeeting=true;this.staticRadioChannel.trigger("before:unFocus",{focusView:null,unfocusView:null});this.staticRadioChannel.trigger("before:minimize",{focusView:null,unfocusView:null});c.addClass(this.$el,"onGuidedMeeting");this.detachChildView("mainContentRegion",this.centerView);this.showChildView("mainContentRegion",this.currentMeetingView);this.currentMeetingView.prepareMeeting(s);this.sideBarRadioChannel.trigger("sideBarView:startMeetingChrono",r)},_stopGuidedMeeting:function(){f.getGlobal().inGuidedMeeting=false;c.removeClass(this.$el,"onGuidedMeeting");this.detachChildView("mainContentRegion",this.currentMeetingView);this.showChildView("mainContentRegion",this.centerView);this.centerView.mapView.firstFocus();c.removeClass(g(".mapView"),"childFixed");this.sideBarRadioChannel.trigger("mapButton:updateMapButton",null);this.sideBarRadioChannel.trigger("sideBarView:endMeetingChrono")},_startFreeMeeting:function(r){f.getGlobal().inFreeMeeting=true;c.addClass(this.$el,"onFreeMeeting");this.sideBarRadioChannel.trigger("sideBarView:openMap");this.sideBarRadioChannel.trigger("sideBarView:startMeetingChrono",r)},_stopFreeMeeting:function(){f.getGlobal().inFreeMeeting=false;c.removeClass(this.$el,"onFreeMeeting");this.sideBarRadioChannel.trigger("sideBarView:endMeetingChrono")},onMeetingStart:function(v,r){if(f.getGlobal().inMeeting===false){f.getGlobal().isMeetingLeader=true;c.addClass(this.$el,"meetingLeader");var u=[];for(var t=0;t<v.collection.models.length;++t){var s=v.collection.models[t];u[t]={id:s.attributes.viewmodel.id,isVisited:s.isVisited}}m.send({meetingTime:r,meetingLeangetCollection:u,eventType:"meeting:start",startDate:Date.now()},{welcomeAction:"add"})}f.getGlobal().inMeeting=true;if(f.is(v.collection)&&v.collection.length>0){this._startGuidedMeeting(v,r)}else{this._startFreeMeeting(r)}},onMeetingEnd:function(){if(f.getGlobal().inMeeting===true){m.send({eventType:"meeting:stop"},{welcomeAction:"flush"});c.removeClass(this.$el,"meetingLeader")}f.getGlobal().isMeetingLeader=false;f.getGlobal().inMeeting=false;this.sideBarRadioChannel.trigger("sideBarView:liveMeetingPreparation",false);if(f.getGlobal().inGuidedMeeting===true){this._stopGuidedMeeting()}else{if(f.getGlobal().inFreeMeeting===true){this._stopFreeMeeting()}}},onSocketMeetingStart:function(A){if(f.getGlobal().inMeeting===true){return}f.getGlobal().inMeeting=true;var w=this.sideLeftView.getPanelView().meetingView;var t=this.centerView.mapView.staticCollectionView;for(var u=0;u<A.meetingLeangetCollection.length;++u){var r=A.meetingLeangetCollection[u].id;for(var y=0;y<t.children.length;++y){var x=t.children.findByIndex(y);if(x.model.name==="PageModel"){for(var z=0;z<x.staticCollectionView.children.length;++z){var v=x.staticCollectionView.children.findByIndex(z);if(v.model.id===r){w.onSelectLeanget(v);break}}}else{if(x.model.id===r){w.onSelectLeanget(x);break}}}}var s=A.meetingTime-(Date.now()-A.startDate);w.time=s>0?s:0;w.onStartMeeting()},onSocketMeetingStop:function(){f.getGlobal().inMeeting=false;this.sideLeftView.getPanelView().meetingView.onEndMeeting()},onHttpResult:function(s){var r=Date.now();var t=this.getUI("connection");if(f.is(t)){if(r-s.startTime<500){}else{if(r-s.startTime<1000){}else{}}}},onLiveConnected:function(r){this.setConnectionImage(null)},onLiveDisconnected:function(r){this.setConnectionImage("connectionLost.svg")},setConnectionImage:function(r){var t=this.getUI("connection");if(f.is(t)&&f.is(t[0])){var s=f.is(r)?this.iconPath+"/"+r:"";t[0].setAttribute("src",s)}},toggleChangelog:function(){n.openPanel();this.getUI("changelog").removeClass("changelogHasNews")}});return k});define("DS/DEL3DLeanViews/EditSticky/EditStickyNoteFloatableView",["UWA/Core","pluginDS!DS/VENJQuery/jquery.1.11.1/jquery","pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","pluginDS!DS/VENMarionette/backbone.marionette.3.5.1/backbone.marionette","DS/WebappsUtils/WebappsUtils","DS/DEL3DLeanViews/Behaviors/InteractBehavior","DS/DEL3DLeanViews/Components/ButtonView","DS/DEL3DLeanViews/EditSticky/EditStickyNoteView","text!DS/DEL3DLeanViews/assets/template/EditSticky/EditStickyNoteFloatableView.template.html","css!DS/DEL3DLeanViews/assets/css/EditSticky/EditStickyNoteFloatableView.css"],function(b,c,h,f,a,i,d,j,e){var g=f.View.extend({iconPath:a.getWebappsAssetUrl("DEL3DLeanViews","icons"),behaviors:[{behaviorClass:i,draggableRestriction:".floatableCollectionView",isDraggable:true,ignoreFrom:"canvas, .buttonView"}],className:"editStickyNoteFloatableView onEditStickyOpen",regions:{closeButtonRegion:{selector:"#editStickySketchCloseButton",replaceElement:false},editContainer:{selector:".editStickyContainer",replaceElement:false}},childViewEvents:{"view:delete":"onDelete"},template:h.template(e),templateContext:function(){return{}},initialize:function(){this.onCloseDelegate=c.proxy(this.onClose,this);this.closeButtonView=new d({icon:"EditStickyNote/Close.svg",callback:this.onCloseDelegate,actionName:"close"});this.editView=new j({model:this.model});this.$el.attr({id:this.cid})},bind:function(){this.showChildView("closeButtonRegion",this.closeButtonView);this.showChildView("editContainer",this.editView);this.triggerMethod("view:enableInteract",true)},unbind:function(){this.detachChildView("closeButtonRegion",this.closeButtonView);this.detachChildView("editContainer",this.editView);this.triggerMethod("view:enableInteract",false)},onBeforeDestroy:function(){if(b.is(this.editView)){this.editView.destroy()}},onRender:function(){setTimeout(c.proxy(function(){var w=c(".focused > .floatableCollectionView");var s=w[0].clientWidth;var u=w[0].clientHeight;var t=this.$el[0].clientWidth;var r=this.$el[0].clientHeight;var q=this.$el.parent().position().top;var v=this.$el.parent().position().left;var m=this.$el.parent()[0].clientWidth;var n=this.$el.parent()[0].clientHeight;var o=((q+r+n)-u);var p=((v+t+m)-s);var k=o>0?(-(parseFloat(o-n)*100)/n):0;var l=p>0?(-(parseFloat(p-m)*100)/m):0;this.$el.css({top:k+"%",left:l+"%"});this.$el.attr({"data-x":l,"data-y":k});this.$el.removeClass("onEditStickyOpen")},this),100)},onAttach:function(){this.bind()},onDetach:function(){this.unbind()},onClose:function(){this.$el.addClass("onEditStickyClose");setTimeout(c.proxy(function(){this.triggerMethod("view:editionFinished")},this),100)},onDelete:function(l,k){this.triggerMethod("view:delete",l,k)},saveData:function(){}});return g});define("DS/DEL3DLeanViews/FloatableElements/NoteElements/NoteView",["pluginDS!DS/VENUnderscore/underscore.1.8.3/underscore","DS/DEL3DLeanViews/FloatableElements/StickyNoteView","DS/DEL3DLeanViews/EditSticky/EditStickyNoteFloatableView","text!DS/DEL3DLeanViews/assets/template/FloatableElements/NoteElements/NoteView.template.html","css!DS/DEL3DLeanViews/assets/css/FloatableElements/NoteElements/NoteView.css"],function(b,c,a,e){var d=c.extend({template:b.template(e),_editStickyNote:function(){this._editStickyNoteView=new a({model:this.model});this.showChildView("editZoneRegion",this._editStickyNoteView)},_closeStickyNoteEdit:function(){}});return d});