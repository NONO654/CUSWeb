function ENOCockpit(b){var c=function(e){var d=false;if(UWA.is(e,"boolean")){d=e}else{if(UWA.is(e,"string")){d=e.toLowerCase()==="true"}}return d};var a={widget:null,pad3DViewer:null,paddebug:false,_availableForRole:false,init:function(d){this.pcsPrefix=d.widget.id+"_"+d.widget.title;this.widget=d.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onSearch",this.onSearch.bind(this))},onRefresh:function(){if(this._availableForRole){setTimeout(function(){this.pad3DViewer.refresh()}.bind(this),500)}},onLoad:function(){var d=this;require(["DS/PADUtils/PADUtilsServices"],function(e){e.getGrantedRoles(function(g){for(var f=0;f<g.length;f++){if(g[f].id==="E19"||g[f].id==="InternalDS"){d._availableForRole=true;break}}d._availableForRole=d._availableForRole||e.getPlatformId()==="OnPremise";if(d._availableForRole){require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","text!DS/ENOCockpit/assets/json/ENOCockpitSettingsMgt.json","DS/ENOPAD3DViewer/PAD3DViewer","DS/Selection/CSOManager","UWA/Utils/Client","DS/Visualization/ThreeJS_DS"],function(n,h,q,o,k,j,p){function l(){n.setSetting("lang",d.widget.lang);d.widget.addEvent("endEdit",n.updateWidgetPreferences.bind(n));d.widget.mergePreferences(n.getWidgetPreferences());n.addEvent("onEnopad3dviewer_CGRorTHB",function(r){if(d.pad3DViewer&&d.pad3DViewer.getController()){d.pad3DViewer.setDefaultStreamToLoad(r)}});n.addEvent("onPaddebug_section",function(r){if(d.pad3DViewer){if(r&&d.paddebug===false){d.paddebug=true;d.pad3DViewer.loadActionBar({merge:true,file:"PADDebug.xml",module:"PADDebug"})}}});n.updateWidgetPreferences();if(!d.widget.getValue("Cockpit_RootIds")){widget.addPreference({name:"Cockpit_RootIds",type:"hidden",defaultValue:"[]"})}}function m(){d.pad3DViewer.subscribe({event:"onActionBarReady"},function(){d.widget.setBody(d.pad3DViewer.render());if(n.getSetting("paddebug_section")&&d.paddebug===false){console.log("PADDebug ActionBar added");d.paddebug=true;d.pad3DViewer.loadActionBar({merge:true,file:"PADDebug.xml",module:"PADDebug"})}if(d.pad3DViewer.getLevelSelectorCommand){d.pad3DViewer.getLevelSelectorCommand(function(r){if(r){r.displayLabels(true)}})}});d.pad3DViewer.subscribe({event:"onReady"},function(){var r=window.localStorage.getItem("TileModelPreloadData");if(r){var v=!UWA.is(r,"object")?JSON.parse(r):r;var s=d.pad3DViewer.getViewpoint();s.moveTo({eyePosition:new p.Vector3(v.viewpoint.pos.x,v.viewpoint.pos.y,v.viewpoint.pos.z),upDirection:new p.Vector3(v.viewpoint.up.x,v.viewpoint.up.y,v.viewpoint.up.z),sightDirection:new p.Vector3(v.viewpoint.sight.x,v.viewpoint.sight.y,v.viewpoint.sight.z),distanceToTarget:150,duration:0});window.ENOPADNoReframe=true;d.pad3DViewer.setAutomaticReframePolicy(false);setTimeout(function(){d.pad3DViewer.addRoots({objects:[{path:[v.rootId]}],});setTimeout(function(){oocLDHNodeManager.requestUpdate(true,true)},500)},1000)}else{var u=JSON.parse(d.widget.getValue("Cockpit_RootIds"));d.widget.setValue("Cockpit_RootIds","[]");var w=d.widget.getValue("X3DContentId");d.widget.deleteValue("X3DContentId");var t=[];u.forEach(function(x){if(UWA.is(x,"array")){t.push({path:x,hidden:false})}else{t.push({path:[x],hidden:false})}});if(u.length>0){if(c(d.widget.getValue("storedObjectMgt"))===true){require(["DS/PADUtils/views/PADStoredObjMgt"],function(z){var y=d.widget.getValue("Cockpit_objectInfos");if(UWA.is(y,"string")){y=JSON.parse(y)}else{y={}}var x=new z({render_div:".enopad3Dviewer_mainTriptych",objects3D:t,objectInfos:y,events:{onLoadObjects:function(A){d.pad3DViewer.addRoots({objects:A.objects3D,},false);d.widget.setValue("Cockpit_objectInfos",JSON.stringify(A.objectInfos));if(c(d.widget.getValue("storedObjectMgt"))!==A.showStoredObjectMgt){d.widget.setValue("storedObjectMgt",A.showStoredObjectMgt)}}}})})}else{d.pad3DViewer.addRoots({objects:t,},false)}}else{if(w){setTimeout(function(){d.pad3DViewer.addRootNodesFromContent({json3DXContent:JSON.parse(w),dispatch:false})},0)}}d.widget.dispatchEvent("onENOPADReady")}});d.pad3DViewer.subscribe({event:"onRootAdded"},function(s){if(s.rootLog){var r=s.rootLog;d.widget.setValue("Cockpit_RootIds",JSON.stringify(r))}d.pad3DViewer.getContentName({callbacks:{onComplete:function(t){d.widget.setTitle(t.contentName)}}})});d.pad3DViewer.subscribe({event:"onRootRemoved"},function(s){if(s.rootLog){var r=s.rootLog;d.widget.setValue("Cockpit_RootIds",JSON.stringify(r))}d.pad3DViewer.getContentName({callbacks:{onComplete:function(t){d.widget.setTitle(t.contentName)}}})})}q=UWA.is(q,"string")?JSON.parse(q):q;n.setApp(q,"enocockpit");h.addSharedSettings(d.widget,["x3dPlatformId","storedObjectMgt"]);var i=q.actionBarWkb.standard;q.enocockpit.layout_options.frmWindow_opts.workbench=i.file;q.enocockpit.layout_options.frmWindow_opts.workbenchModule=i.module;if(d.pad3DViewer===null){l();d.pad3DViewer=new o({widget:d.widget,css_view_class:d.css_view_class,windowOptions:q.enocockpit.layout_options.frmWindow_opts,allowAuthoring:false,authorizeSet3DStructure:true,selectiveLoading:UWA.is(n.getSetting("enopad3dviewer_selectiveLoading"),"boolean")?n.getSetting("enopad3dviewer_selectiveLoading"):n.getSetting("enopad3dviewer_selectiveLoading")==="true",enableSidePanel:true,propertiesFacet:UWA.is(n.getSetting("propertiesFacet"),"array")?n.getSetting("propertiesFacet"):[]});m()}})}else{require(["DS/PADUtils/views/PADSplash"],function(i){var h=new i();d.widget.setBody(h.render());d.widget.dispatchEvent("onENOPADReady")})}})})},onSearch:function(e){if(this._availableForRole){var d={searchQuery:e};this.pad3DViewer.search(d)}},onDestroy:function(){if(this._availableForRole){this.pad3DViewer.destroy()}}};a.init(b);return a};