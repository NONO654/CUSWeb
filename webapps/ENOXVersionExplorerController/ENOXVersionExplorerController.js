define("DS/ENOXVersionExplorerController/CreateNewVersionController",["UWA/Core","UWA/Controls/Abstract","DS/ENOXVersionExplorerViews/NewVersionDialog","DS/ENOXVersionExplorerViews/NewRevisionDialog","DS/ENOXVersionExplorerModelManager/ModelManagerBase","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/LifecycleCmd/MessageMediator","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","UWA/Promise","DS/ENOXVersionExplorerModelManager/ModelManagerP","DS/ENOXVersionExplorerModelManager/ModelManagerER","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],function(c,f,m,l,h,k,g,i,j,e,d,b,n){var a=f.extend({init:function(x){x=x||{};var v=this;var w=undefined,s=undefined,v=this;x=c.extend({newVersionDialogContainer:null,},x);this._parent(x);w=new (k.implement(h))();function o(y,z){if(typeof z==="string"&&z.length&&y!==i.DATA_MODEL_TYPES.MODEL_HISTORY){y=i.DATA_MODEL_TYPES[((z.contains(":"))?"MODEL_RDF":"MODEL_REVISION")]}if(y&&w._DATA_MODEL_TYPE!==y){w._DATA_MODEL_TYPE=y;switch(w._DATA_MODEL_TYPE){case i.DATA_MODEL_TYPES.MODEL_RDF:s=ModelManagerRDF;break;case i.DATA_MODEL_TYPES.MODEL_HISTORY:s=ModelManagerHistory2;break;default:s=e;break}w.setManager(s)}}function t(y){v.dispatchEvent("ENOXVersionExplorerError",y)}function q(z){var y=z.parentTreeNode;if(!y){throw Error("CreateNewVersionController:_displayNewversionDialog parent tree node is null")}else{m.displayDialog({dataModelType:w._DATA_MODEL_TYPE,defaultName:w.getNewVersionName(),derivedFrom:{id:y.options.id,name:y.options.grid.title},parentContainer:x.newVersionDialogContainer,onOK:function(D,B,A){var C={title:D,description:B,parent:y,nextRevision:b.getNextRevision(y.options.grid.code.split(".")[0])+".1",versionSemantic:A};u(C)}})}}function r(z){var y=z.parentTreeNode;if(!y){throw Error("CreateNewVersionController:_displayNewRevisionDialog parent tree node is null")}else{l.displayDialog({defaultName:y.options.grid.title,derivedFrom:{id:y.options.id,name:y.options.grid.title+" "+y.options.grid.code},nextRevision:b.getNextRevision(y.options.grid.code.split(".")[0])+".1",parentContainer:x.newVersionDialogContainer,onOK:function(C,A){var B={title:C,description:A,parent:y,versionSemantic:"E"};u(B)}})}}function u(y){w.createNewVersionPromise({parentid:y.parent.options.id,title:y.title,description:y.description,versionSemantic:y.versionSemantic,nextRevision:y.parent.nextRevision,itemID:w.itemID,loadThumbnail:false,}).then(function(z){g.dispatchEvent("_ENOXVersionExplorerNewVersionCreated",z);v.dispatchEvent("ENOXVersionExplorerNewVersionCreated",z)},t)}var p=c.Class.extend({showDialog:function(y){if(!(typeof y.parentID==="string"&&y.parentID.length)){throw Error("CreateNewVersionController:showDialog: parentPhysical ID cannot be null")}o(y.dataModelType,y.type);w.loadVersionModelPromise({id:y.parentID,loadThumbnail:false,tenantId:y.tenantId,securityContext:y.securityContext}).then(function(){var z=w.searchByID(y.parentID);if(z.length>1){throw Error("CreateNewVersionController:showDialog: more than one node with same ID")}else{if(!z.length){throw Error("CreateNewVersionController:showDialog: Parent ID not found")}else{(w._DATA_MODEL_TYPE===i.DATA_MODEL_TYPES.MODEL_REVISION)?r({parentTreeNode:z[0]}):q({parentTreeNode:z[0]})}}},t)},canNewVersionBeCreatedPromise:function(y){if(!(typeof y.parentID==="string"&&y.parentID.length)){throw Error("CreateNewVersionController:canNewVersionBeCreatedPromise: parentPhysical ID cannot be null")}o(y.dataModelType,y.type);return new j(function(A,z){w.loadVersionModelPromise({id:y.parentID,loadThumbnail:false,tenantId:y.tenantId,securityContext:y.securityContext,}).then(function(){var B=w.searchByID(y.parentID);if(B.length>1){throw Error("CreateNewVersionController:showDialog: more than one node with same ID")}else{if(!B.length){throw Error("CreateNewVersionController:showDialog: Parent ID not found")}}A(B[0].isLeaf())},z)})}});c.Class.implement.call(this,p)}});return a});define("DS/ENOXVersionExplorerController/VersionExplorerEventList",["UWA/Core","UWA/Class","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerViews/NodeDropdownMenu","DS/WebappsUtils/WebappsUtils","DS/LifecycleCmd/CommandAPI","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/LifecycleServices/LifecycleServices","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],function(h,a,j,c,b,k,e,i,d,f,l){var g=function(p,n){function o(t){var s,r,q;if(t instanceof b){r=t;s={position:{x:0,y:0},selectedNodes:[]}}else{s=t.menuctx;r=s.treeNode}q={physicalid:r.options.id,id:r.options.id,displayName:r.options.label,revision:r.options.grid.code,type:r.options.data.type,pos:[s.position.x,s.position.y],selectedNodes:s.selectedNodes,name:r.options.label};t.menuctx=undefined;return q}function m(s){var v=this,u=n._subwayGraphView;if(n._getActiveView()===j.DISPLAY_MODES.SUBWAY_VIEW&&u&&u.columnDataModelType!==p._DATA_MODEL_TYPE){u.columnDataModelType=p._DATA_MODEL_TYPE;u.prepareUpdateColumns();var q=u.getColumnManager();q.empty();q.addColumns(n.customizeColumns.getAll().map(function(w){return{text:w.columnNLS,dataIndex:w.outputKey,}}));if(n.customizeColumns._IS_COMPARE){n.customizeColumns.loadSettingsPromise().then(function(w){var x=d.intersectionDifference(n.customizeColumns.getAll(),w,function(y,z){return y.dbKey===z})[0].difference;q.hideColumns(x.map(function(y){return y.outputKey}));u.pushUpdateColumns();u.setRowHeight(j.SUBWAY_VIEW_MODE[c.UserSettings.subwayViewMode])})}else{var r=n.customizeColumns.load();var t=d.intersectionDifference(n.customizeColumns.getAll(),r,function(w,x){return w.dbKey===x})[0].difference;q.hideColumns(t.map(function(w){return w.outputKey}));u.pushUpdateColumns();u.setRowHeight(j.SUBWAY_VIEW_MODE[c.UserSettings.subwayViewMode])}}}this._eventList=[{id:"ENOXVersionExplorerSetActiveVersion",subscribed:true,published:false,externalsub:true,externalpub:false,subfn:function(r){var t=this;var s=(r.data||r);var q={};if(s instanceof b){q.treeNode=s}else{q.id=(s&&typeof s.id==="string")?s.id:(typeof s==="string"?s:undefined)}if(!q.treeNode&&!q.id){q.id=t._activeVersion||t._currentVersion}q.id&&t._setActiveVersion(q)}},{id:"ENOXVersionExplorerLoadVersionModel",subscribed:true,externalsub:true,onComplete:true,subfn:function(q){var t=this;var r=((q)&&(q.data||q))||{};if((typeof r.id==="string"&&r.id.length)||(typeof r.id==="object"&&r.id!==null)){var s=(r&&typeof r.onComplete==="function")?function(u){r.onComplete(u);t.publishEvent("ENOXVersionExplorerLoadCompleted",u)}:function(u){t.publishEvent("ENOXVersionExplorerLoadCompleted",u)};t._loadVersionModel(h.merge({reframe:true,onComplete:s},r))}else{throw Error("ENOXVersionExplorerLoadVersionModel:id <physicalid> cannot be null")}}},{id:"ENOXVersionExplorerLoadCompleted",published:true,externalpub:true,subscribed:true,subfn:function(q){m.bind(this)(q)}},{id:"ENOXVersionExplorerRefresh",subscribed:true,published:false,externalsub:true,externalpub:false,onComplete:true,subfn:function(q){var t=this;var r=((q)&&(q.data||q))||{};r.id=r.id||t._currentVersion;r.tenantId=r.tenantId||t._tenantId;r.context=r.context||t._context;r.type=r.type||t._type;r.dataModelType=r.dataModelType||p._DATA_MODEL_TYPE;if((typeof r.id==="string"&&r.id.length)||(typeof r.id==="object"&&r.id!==null)){var s=(r&&typeof r.onComplete==="function")?function(u){r.onComplete(u);t.publishEvent("ENOXVersionExplorerLoadCompleted",u)}:function(u){t.publishEvent("ENOXVersionExplorerLoadCompleted",u)};t._loadVersionModel(h.merge({reframe:true,onComplete:s},r))}else{throw Error("ENOXVersionExplorerRefresh:id <physicalid> cannot be null")}}},{id:"ENOXVersionExplorerThumbnailGraphLayoutChanged",published:true,externalsub:false,externalpub:true},{id:"ENOXVersionExplorerOpenVersion",externalpub:true,published:true},{id:"preENOXVersionExplorerNewRevisionFrom",published:true,externalpub:true,onCompleteEvent:"preEventCompletedENOXVersionExplorerNewRevisionFrom",subfn:function(q){var r=this;r.publishEvent("preEventCompletedENOXVersionExplorerNewRevisionFrom",q)},allowPreventDefault:true},{id:"preEventCompletedENOXVersionExplorerNewRevisionFrom",subscribed:true,externalsub:false,subfn:function(r){var t=this;var s=(r.data||r);if(p._DATA_MODEL_TYPE===j.DATA_MODEL_TYPES.MODEL_RDF){var q={};if(s instanceof b){q.treeNode=s}else{q.id=(s&&typeof s.id==="string")?s.id:(typeof s==="string"?s:undefined)}t._displayNewRevisionDialog(q)}else{i.runCommand("ReviseFromHdr",[o(s)],t._widget,t._context)}}},{id:"preENOXVersionExplorerCreateNewVersion",published:true,externalpub:true,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateNewVersion",subfn:function(q){var r=this;r.publishEvent("preEventCompletedENOXVersionExplorerCreateNewVersion",q)},allowPreventDefault:true},{id:"preEventCompletedENOXVersionExplorerCreateNewVersion",subscribed:true,externalsub:false,subfn:function(r){var t=this;var s=(r.data||r);if(p._DATA_MODEL_TYPE===j.DATA_MODEL_TYPES.MODEL_RDF){var q={};if(s instanceof b){q.treeNode=s}else{q.id=(s&&typeof s.id==="string")?s.id:(typeof s==="string"?s:undefined)}t._displayNewRevisionDialog(q)}else{i.runCommand("RevisionHdr",[o(s)],t._widget,t._context)}}},{id:"ENOXVersionExplorerNewVersionCreated",published:true,externalpub:true,subscribed:true,subfn:function(r){var s=r.data||r;if(n._getActiveView()===j.DISPLAY_MODES.THUMBNAIL_VIEW&&n._thumbnailGraphView){var q=[];q.push(s);(s.getParent())&&q.push(s.getParent());n._thumbnailGraphView.reframeOn(q)}}},{id:"preENOXVersionExplorerCreateNewBranch",published:true,externalpub:true,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateNewBranch",subfn:function(q){var r=this;r.publishEvent("preEventCompletedENOXVersionExplorerCreateNewBranch",q)},allowPreventDefault:true},{id:"preEventCompletedENOXVersionExplorerCreateNewBranch",subscribed:true,externalsub:false,subfn:function(r){var t=this;var s=(r.data||r);if(p._DATA_MODEL_TYPE===j.DATA_MODEL_TYPES.MODEL_RDF){var q={};if(s instanceof b){q.treeNode=s}else{q.id=(s&&typeof s.id==="string")?s.id:(typeof s==="string"?s:undefined)}t._displayNewVersionDialog(q)}else{i.runCommand("NewBranchHdr",[o(s)],t._widget,t._context)}}},{id:"preENOXVersionExplorerCreateDuplicate",published:true,externalpub:true,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateDuplicate",subfn:function(q){var r=this;r.publishEvent("preEventCompletedENOXVersionExplorerCreateDuplicate",q)},allowPreventDefault:true},{id:"preEventCompletedENOXVersionExplorerCreateDuplicate",subscribed:true,externalsub:false,subfn:function(r){var t=this;var s=(r.data||r);if(p._DATA_MODEL_TYPE===j.DATA_MODEL_TYPES.MODEL_RDF){var q={};if(s instanceof b){q.treeNode=s}else{q.id=(s&&typeof s.id==="string")?s.id:(typeof s==="string"?s:undefined)}t._displayNewVersionDialog(q)}else{i.runCommand("DuplicateHdr",[o(s)],t._widget,t._context)}}},{id:"preENOXVersionExplorerDeleteVersion",published:true,externalpub:true,onCompleteEvent:"preEventCompletedENOXVersionExplorerDeleteVersion",subfn:function(q){var r=this;r.publishEvent("preEventCompletedENOXVersionExplorerDeleteVersion",q)},allowPreventDefault:true},{id:"preEventCompletedENOXVersionExplorerDeleteVersion",subscribed:true,externalsub:false,subfn:function(q){var s=this;var r=(q.data||q);i.runCommand("DeleteHdr",[o(r)],s._widget,s._context)}},{id:"ENOXVersionExplorerVersionDeleteCompleted",published:true,externalpub:true,},{id:"preEventENOXVersionExplorerShowMaturity",published:true,externalpub:true,onCompleteEvent:"preEventCompletedENOXVersionExplorerShowMaturity",subfn:function(q){var r=this;r.publishEvent("preEventCompletedENOXVersionExplorerShowMaturity",q)},allowPreventDefault:true},{id:"preEventCompletedENOXVersionExplorerShowMaturity",published:true,externalpub:true,subscribed:true,externalsub:false,allowPreventDefault:true,subfn:function(q){var r=(q.data||q),s=this;i.runCommand("MaturityHdr",[o(r)],s._widget,s._context)}},{id:"ENOXVersionExplorerDoubleClickVersion",published:true,externalpub:true,},{id:"ENOXVersionExplorerError",published:true,externalpub:true,},{id:"ENOXVersionExplorerCompare",published:true,externalpub:true,subscribed:false,externalsub:false},{id:"select",published:true,externalpub:true,subscribed:true,subfn:function(q){n._highlightParents(q.data.nodeModel)},externalsub:true,noPubFn:true},{id:"unselect",published:true,externalpub:true,subscribed:true,subfn:function(q){n._unhighlightParents(q.data.nodeModel)},externalsub:true,noPubFn:true,},{id:"ENOXVersionExplorerVersionModified",published:true,externalpub:true,},{id:"ENOXVersionExplorerVersionOwnerChanged",published:true,externalpub:true,},{id:"ENOXVersionExplorerDisplayProperties",published:true,externalpub:true,subscribed:true,externalsub:false,allowPreventDefault:true,subfn:function(q){var r=(q.data||q),s=this;i.runCommand("Properties",[o(r)],s._widget,s._context)}},{id:"ENOXVersionExplorerModalOK",published:true,externalpub:true,},{id:"ENOXVersionExplorerModalCancel",published:true,externalpub:true,},{id:"ENOXVersionExplorerDropdownMenu",published:true,externalpub:false,subscribed:true,externalsub:false,subfn:function(q){var r=q.data||q,s=this;s._getNodeDropdownMenuListPromise(r.treeNode).then(function(t){r.menuList=t;k.displayNodeDropdownMenu.bind(s)(r)})},allowPreventDefault:true},{id:"ENOXVersionExplorerOnDrag",published:true,externalpub:false,subscribed:true,externalsub:false,subfn:function(q){var r=q.data||q,s=this;s._getNodeDropdownMenuListPromise(r.treeNode).then(function(t){r.menuList=t;k.displayNodeDropdownMenu.bind(s)(r)})},allowPreventDefault:true},{id:"ENOXVersionExplorerOnDrop",published:true,externalpub:false,subscribed:true,externalsub:false,subfn:function(q){var r=q.data||q,s=this;s._getNodeDropdownMenuListPromise(r.treeNode).then(function(t){r.menuList=t;k.displayNodeDropdownMenu.bind(s)(r)})},allowPreventDefault:true},{id:"_ENOXVersionExplorerInternalRefresh",published:true,subscribed:true,externalpub:false,externalsub:false,subfn:function(q){var r=this;if((typeof r._currentVersion==="string"&&r._currentVersion.length)||(typeof r._currentVersion==="object"&&r._currentVersion!==null)){r._loadVersionModel(h.extend({id:r._currentVersion,tenantId:r._tenantId,context:r._context,type:r._type,dataModelType:p._DATA_MODEL_TYPE,onComplete:function(s){r.publishEvent("_ENOXVersionExplorerInternalRefreshCompleted",s)}},q))}else{throw Error("_ENOXVersionExplorerInternalRefresh: _versionExplorerController._currentVersion is not defined")}}},{id:"_ENOXVersionExplorerInternalRefreshCompleted",published:true,externalpub:false,subscribed:true,externalsub:false},{id:"_ENOXVersionExplorerSelectionModeChanged",published:true,externalpub:false,subscribed:true,externalsub:false},{id:"_ENOXVersionExplorerManageMultiSelect",published:true,externalpub:false,subscribed:true,externalsub:false},{id:"_ENOXVersionExplorerNoActions",published:false,externalpub:false,pubfn:function(){}},{id:"_ENOXVersionExplorerViewChanged",published:true,externalpub:false,subscribed:true,subfn:function(q){m.bind(this)(q)}}];this._menuList=[{id:"ENOXVersionExplorerOpenVersion",event:"ENOXVersionExplorerOpenVersion",fonticon:"forward",text:l.open,userAccess:["read","write"],checkVersion:function(q){return !q.isActive()},nodeDropdown:true},{id:"ENOXVersionExplorerDisplayProperties",event:"ENOXVersionExplorerDisplayProperties",icon:i.getIconPath("Properties"),text:i.getTitle("Properties"),userAccess:["read","write"],checkVersion:function(q){return p._DATA_MODEL_TYPE!==j.DATA_MODEL_TYPES.MODEL_RDF},nodeDropdown:true},{id:"divider",},{id:"ENOXVersionExplorerShowMaturity",event:"preEventENOXVersionExplorerShowMaturity",icon:i.getIconPath("MaturityHdr"),text:i.getTitle("MaturityHdr"),userAccess:["read","write"],checkVersion:function(q){var r=this;return i.checkAvailability("MaturityHdr",[o(q)],r._widget,r._context)},nodeDropdown:true},{id:"ENOXVersionExplorerCreateNewRevision",event:"preENOXVersionExplorerCreateNewVersion",icon:i.getIconPath("RevisionHdr"),text:i.getTitle("RevisionHdr"),checkAccess:["read","write"],checkVersion:function(q){var r=this;return q.isLeaf()&&(c.X_DESIGN===true||p._DATA_MODEL_TYPE===j.DATA_MODEL_TYPES.MODEL_RDF||i.checkAvailability("RevisionHdr",[o(q)],r._widget,r._context))},nodeDropdown:true},{id:"ENOXVersionExplorerNewRevisionFrom",event:"preENOXVersionExplorerNewRevisionFrom",icon:i.getIconPath("ReviseFromHdr"),text:i.getTitle("ReviseFromHdr"),checkAccess:["read","write"],checkVersion:function(q){var r=this;return i.checkAvailability("ReviseFromHdr",[o(q)],r._widget,r._context)},nodeDropdown:true},{id:"ENOXVersionExplorerCreateNewBranch",event:"preENOXVersionExplorerCreateNewBranch",icon:i.getIconPath("NewBranchHdr"),text:i.getTitle("NewBranchHdr"),checkAccess:["read","write"],checkVersion:function(q){var r=this;return c.X_DESIGN===true||p._DATA_MODEL_TYPE===j.DATA_MODEL_TYPES.MODEL_RDF||i.checkAvailability("NewBranchHdr",[o(q)],r._widget,r._context)},nodeDropdown:true},{id:"ENOXVersionExplorerDeleteVersion",event:"preENOXVersionExplorerDeleteVersion",icon:i.getIconPath("DeleteHdr"),text:i.getTitle("DeleteHdr"),checkAccess:["read","write"],checkVersion:function(q){var r=this;return i.checkAvailability("DeleteHdr",[o(q)],r._widget,r._context)},nodeDropdown:true},{id:"ENOXVersionExplorerDuplicate",event:"preENOXVersionExplorerCreateDuplicate",icon:i.getIconPath("DuplicateHdr"),text:i.getTitle("DuplicateHdr"),checkAccess:["read","write"],checkVersion:function(q){var r=this;return i.checkAvailability("DuplicateHdr",[o(q)],r._widget,r._context)},nodeDropdown:true}];this._multiSelectMenuList=[{id:"ENOXVersionExplorerNoActions",event:"_ENOXVersionExplorerNoActions",fonticon:"block",text:l.noActions,checkVersion:function(q){return true},multiSelectMenu:true,minNodes:2,maxNodes:Infinity,excludeIfOtherItemsExist:true}]};return g});define("DS/ENOXVersionExplorerController/VersionExplorerEventManager",["UWA/Core","UWA/Class","UWA/Promise","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerController/VersionExplorerEventList","DS/CoreEvents/ModelEvents"],function(g,b,c,f,e,d){var a=d.extend({_disabledEventList:[],init:function(m,o,k){this._parent(m);var j=o;a.implement({addExternalNodeDropdownMenuItem:function(s){var p=(Array.isArray(s))?s:new Array(s);for(var r=0;r<p.length;r++){s=p[r];if(typeof s.id!=="string"||!s.id.length){throw Error("VersionExplorerEventManager:addDropDownMenuItem - eventId cannot be null ")}if(!s.icon&&!s.fonticon){throw Error("VersionExplorerEventManager:addDropDownMenuItem - icon cannot be null ")}if(typeof s.text!=="string"||!s.text.length){throw Error("VersionExplorerEventManager:addDropDownMenuItem - menu text cannot be null ")}if(typeof s.subfn!=="function"){throw Error("VersionExplorerEventManager:addDropDownMenuItem - subscribe function cannot be null")}if(typeof s.checkVersion!=="function"){throw Error("VersionExplorerEventManager:addDropDownMenuItem - checkVersion function cannot be null")}var q={id:s.id,externalpub:true,published:true,externalEvent:true,subfn:s.subfn};this._eventList.push(q);this._registerEvent(q);this._menuList.push({id:s.id,event:s.id,icon:s.icon||undefined,fonticon:s.fonticon||undefined,text:s.text,checkVersion:s.checkVersion,externalMenu:true,nodeDropdown:true})}},addExternalMultiSelectDropdownMenuItem:function(s){var p=(Array.isArray(s))?s:new Array(s);for(var r=0;r<p.length;r++){s=p[r];if(typeof s.id!=="string"||!s.id.length){throw Error("VersionExplorerEventManager:addDropDownMenuItem - eventId cannot be null ")}if(!s.icon&&!s.fonticon){throw Error("VersionExplorerEventManager:addDropDownMenuItem - icon cannot be null ")}if(typeof s.text!=="string"||!s.text.length){throw Error("VersionExplorerEventManager:addDropDownMenuItem - menu text cannot be null ")}if(typeof s.subfn!=="function"){throw Error("VersionExplorerEventManager:addDropDownMenuItem - subscribe function cannot be null")}if(typeof s.checkVersion!=="function"){throw Error("VersionExplorerEventManager:addDropDownMenuItem - checkVersion function cannot be null")}var q={id:s.id,externalpub:true,published:true,externalEvent:true,subfn:s.subfn};this._eventList.push(q);this._registerEvent(q);this._multiSelectMenuList.push({id:s.id,event:s.id,icon:s.icon||undefined,fonticon:s.fonticon||undefined,text:s.text,checkVersion:s.checkVersion,externalMenu:true,multiSelectMenu:true,minNodes:s.minNodes||2,maxNodes:s.maxNodes||Infinity})}},removeExternalNodeDropdownMenuItem:function(i){this._removeExternalDropdownMenuItem(i)},removeExternalMultiSelectDropdownMenuItem:function(i){this._removeExternalDropdownMenuItem(i,true)},getPublishedEvents:function(){return this._eventList.reduce(function(i,p){return((p.published===true&&p.externalpub===true)&&i.push({event:p.id,onCompleteEvent:p.onCompleteEvent}),i)},[])},getSubscribedEvents:function(){return this._eventList.reduce(function(i,p){return((p.subscribed===true&&p.externalsub===true)&&i.push({event:p.id,onComplete:p.onComplete}),i)},[])},subscribeEvent:function(s,r,p){var i=this._getEvent(s),q;if(i&&typeof r==="function"){q=this.subscribe({event:i.id},r);if(p&&i.tokenDefault&&i.allowPreventDefault===true){this.unsubscribe(i.tokenDefault);i.tokenDefault=undefined}i.tokens.push(q)}return q},unsubscribeEvent:function(q,p){var i=this._getEvent(q);if(i&&p){var r=i.tokens.splice(i.tokens.indexOf(p),1);(r.length===1)&&this.unsubscribe(r[0]);if(!i.tokens.length&&i.subfn&&!i.tokenDefault){i.tokenDefault=this.subscribe({event:i.id},i.externalEvent?i.subfn:i.subfn.bind(this))}}},publishEvent:function(p,q){var i=this._getEvent(p);if(i&&typeof i.pubfn==="function"){i.pubfn(q)}},disablePublishEvent:function(i){this._disabledEventList.push(i)},enablePublishEvent:function(i){this._disabledEventList.splice(this._disabledEventList.indexOf(i),1)},getMenuItemsIDList:function(i){return this[(i?"_multiSelectMenuList":"_menuList")].reduce(function(p,q){return(!(q.id==="divider"||q.id==="ENOXVersionExplorerNoActions")&&p.push(q.id),p)},[])},hideMenuItem:function(p,i){var q=this[(i?"_multiSelectMenuList":"_menuList")].find(function(r){return r.id===p});if(q){q.disabled=true}},showMenuItem:function(p,i){var q=this[(i?"_multiSelectMenuList":"_menuList")].find(function(r){return r.id===p});if(q){q.disabled=false}},setCheckVersionExternalFunction:function(q,i,p){var r=this[(p?"_multiSelectMenuList":"_menuList")].find(function(s){return s.id===q});(r&&typeof i==="function")&&(r.checkVersionExternal=i)},resetCheckVersionExternalFunction:function(p,i){var q=this[(i?"_multiSelectMenuList":"_menuList")].find(function(r){return r.id===p});if(q){q.checkVersionExternal=undefined}},publish:function(i){(this._disabledEventList.indexOf(i.event)<0)&&this._parent(i)},_removeExternalDropdownMenuItem:function(s,r){var p,i;var q=(r===true?"_multiSelectMenuList":"_menuList");p=this[q].splice(this[q].findIndex(function(t){return(t.id===s&&t.externalMenu===true)}),1);i=(p.length===1)?this._eventList.find(function(t){return(t.id===p[0].id&&p[0].externalMenu===true&&t.externalEvent===true)}):[];(i.length===1)&&this._unregisterEvent(i[0])},_registerEvent:function(i){if(!i.noPubFn){i.pubfn=function(p){this.publish({event:i.id,data:p})}.bind(this)}i.tokens=[];if(i.subfn){i.tokenDefault=this.subscribe({event:i.id},(i.externalEvent?i.subfn:i.subfn.bind(this)))}},_unregisterEvent:function(q){var p=q.tokens.length;for(var r=0;r<p;r++){this.unsubscribe(q.tokens[r])}q.tokens=[];q.tokenDefault&&(this.unsubscribe(q.tokenDefault),q.defaultToken=undefined)},_getEvent:function(i){return this._eventList.find(function(p){return p.id===i})},_getMenuItemList:function(p){var i=this;return i[(p===true?"_multiSelectMenuList":"_menuList")].map(function(s){if(typeof s!=="object"){return}var r={};if(s.event==="divider"){r=s}else{for(var q in s){r[q]=(q==="event")?i._eventList.find(function(t){return(t.id===s[q])}):s[q]}}return r})},_getNodeDropdownMenuListPromise:function(p){var i=this;return j._getPreContextualMenuPromise(p).then(function(q){var r=q;return new c(function(u,t){var s=i._getMenuItemList().reduce(function(v,x,w,y){return((x&&x.id&&(x.id==="divider"||(!x.disabled&&(!!(x.checkVersionExternal||(x.event.externalEvent===true?x.checkVersion:x.checkVersion.bind(i)))(r))&&x.nodeDropdown===true))&&v.push(x)),v)},[]);(s[s.length-1].id=="divider")&&s.pop();u(s)})})},_getMultiSelectMenuListPromise:function(q){if(!Array.isArray(q)){throw Error("_getMultiSelectMenuListPromise.nodeList: Input not of type array")}var p=this;var i=q.length;return new c(function(t,s){var r=p._getMenuItemList(true).reduce(function(u,y,w,z){var v=true;if(y.multiSelectMenu===true&&i>=y.minNodes&&i<=y.maxNodes){for(var x=0;x<i;x++){v&=(!y.disabled)&&(y.checkVersionExternal||y.checkVersion).bind(p)(q[x],q)}}return((y&&y.id&&(y.id==="divider"||Boolean(v)===true)&&u.push(y)),u)},[]);(r.length&&r[r.length-1].id=="divider")&&r.pop();(r.length>1)&&r.splice(r.findIndex(function(u){return u.excludeIfOtherItemsExist===true}),1);t(r)})}});b.implement.call(this,new e(o,k));var h=this._eventList.length;for(var n=0;n<h;n++){var l=this._eventList[n];this._registerEvent(l)}}});return a});define("DS/ENOXVersionExplorerController/VersionExplorerController",["UWA/Core","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerViews/VersionExplorerView","DS/ENOXVersionExplorerViews/NewVersionDialog","DS/ENOXVersionExplorerViews/NewRevisionDialog","DS/ENOXVersionExplorerController/VersionExplorerEventManager","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerModelManager/ModelManagerBase","DS/ENOXVersionExplorerModelManager/ModelManagerP","DS/ENOXVersionExplorerModelManager/ModelManagerER","DS/ENOXVersionExplorerModelManager/ModelManagerPPrime","DS/ENOXVersionExplorerModelManager/ModelManagerRDF","DS/ENOXVersionExplorerModelManager/ModelManagerHistory","DS/ENOXVersionExplorerModelManager/ModelManagerHistory2","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/ColumnList","DS/LifecycleCmd/MessageMediator","DS/ENOXVersionExplorerViews/VersionExplorerPrefs","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],function(f,q,j,d,i,e,l,m,h,s,p,o,u,w,t,v,n,g,a,c,r,b,k){var x=l.extend({_currentVersion:undefined,_activeVersion:undefined,_context:undefined,_tenant:undefined,_type:undefined,_widget:undefined,init:function(F){var I=undefined,P=undefined,A=false,H=undefined,M=undefined,L=undefined,O=undefined,B=undefined,D=undefined,y=undefined,Q=false,z=undefined;I=this;F=F||{};this._widget=F.widget,s._widget=F.widget;Q=typeof F.autoUpdate==="boolean"?F.autoUpdate:true;H=new (q.implement(p))();H._isODT=F._isODT;H.isCompare=typeof F.isCompare==="boolean"?F.isCompare:false;this._ID=H._ID="VE_"+Date.now().valueOf().toString();M=F.versionGraphContainer;O=F.nodeEdgeViewsTemplate;y=F.customOnDrop;L=F.newVersionDialogContainer;z=new r(F.widget,"RevisionExplorerCustomizeColumns",undefined,undefined,F._isODT,H.isCompare);if(Q){c.addEvent("_ENOXVersionExplorerNewVersionCreated",C);this.refreshSub=b.subscribe("Lifecycle.Modification",C);require(["DS/PADUtils/PADCommandProxy"],function(R){I.PADCommandProxy=R.create({events:{onRefresh:C.bind(I)}})})}P=new d({parentContainer:M,nodeEdgeViewsTemplate:O,customOnDrop:y,versionExplorerController:I,versionModel:H,_isODT:F._isODT,customizeColumns:z});this._parent(F,H,P);H._getTrueRoot()._modelEvents._setParent(this);P.build();H._SELECTION_MODE=F.selectionMode||(m.SELECTION_MODES.MULTI_SELECT_ONLY|m.SELECTION_MODES.WITH_COMMANDS);(H._SELECTION_MODE>=0&&(H._SELECTION_MODE&m.SELECTION_MODES.SINGLE_SELECT_ONLY))&&(H._SELECTION_MODE&=~m.SELECTION_MODES.MULTI_SELECT_ONLY);function C(X){var T;if(typeof X==="string"){var V=JSON.parse(X),Y=V.Refresh;if(Y){if(Array.isArray(Y.created)&&Y.created.length>0&&H.isNodeInModel(Y.created[0].sourceObjectId)){T={physicalid:Y.created[0].physicalid,tenant:V.tenant,fireEvent:"ENOXVersionExplorerNewVersionCreated"}}else{if(Array.isArray(Y.modified)&&Y.modified.length>0&&H.isNodeInModel(Y.modified[0].physicalid)){T={physicalid:Y.modified[0].physicalid,tenant:V.tenant,fireEvent:"ENOXVersionExplorerVersionModified"}}else{if(Array.isArray(Y.deleted)&&Y.deleted.length>0&&H.isNodeInModel(Y.deleted[0].physicalid)){var S=g.intersectionDifference(Y.deleted,H._nodeList,function(Z,aa){return Z.physicalid===aa.options.id});var W=S[1].difference,U=S[1].intersection;if(U.length){T={removedVersion:U[0],fireEvent:"ENOXVersionExplorerVersionDeleteCompleted"};U[0]===I._activeVersion&&(I._activeVersion=undefined);(W.length)&&f.extend(T,{physicalid:W[0].options.id,tenant:V.tenant})}}}}}}else{if(X&&X.authored&&X.authored.modified&&f.is(X.authored.modified,"array")&&X.authored.modified.length===1){if(f.is(X.authored.modified[0],"string")&&H.isNodeInModel(X.authored.modified[0])){T={physicalid:X.authored.modified[0],fireEvent:"ENOXVersionExplorerVersionModified"}}else{if(f.is(X.authored.modified[0].physicalid,"string")&&H.isNodeInModel(X.authored.modified[0].physicalid)){if(f.is(X.authored.modified[0].key,"string")&&f.is(X.authored.modified[0].key==="ownerChanged")){var R=H._nodeList.findIndex(function(Z){return Z.options.id===X.authored.modified[0].physicalid});if(R===0&&H._nodeList.length===1){T={removedVersion:H.searchByID(X.authored.modified[0].physicalid)[0],fireEvent:"ENOXVersionExplorerVersionOwnerChanged"}}else{T={removedVersion:H.searchByID(X.authored.modified[0].physicalid)[0],fireEvent:"ENOXVersionExplorerVersionOwnerChanged",physicalid:H._nodeList[(R===0?1:0)].options.id}}}}}}else{if(X.options&&X.options.id){T={physicalid:X.options.id,fireEvent:"NewVersionCreated"}}}}if(T){if(T.physicalid){I._loadVersionModel({id:T.physicalid,tenant:T.tenant,type:H.type,dataModelType:H._DATA_MODEL_TYPE,onComplete:function(ab){var aa,Z;aa=(T.fireEvent.contains("Created")||T.fireEvent.contains("Modified"))?((Z=H.searchByID(T.physicalid),Z.length===1)?Z[0]:undefined):T.removedVersion;if(I._activeVersion){var ac=H.searchByID(I._activeVersion);if(ac.length===1&&ac[0] instanceof j&&!ac[0].isActive()){I._setActiveVersion({treeNode:ac[0]})}}(!!aa)&&I.publishEvent(T.fireEvent,aa)}})}else{H.empty()}}}function K(R){console.log("VersionExplorerController error handler");console.log(R);I.publishEvent("ENOXVersionExplorerError",R);P.unmask()}function J(R){var S=this;document.body.style.cursor="default";S.showError(R)}function E(S){if(this.context!==undefined&&this.context!==null){if(this.hasOwnProperty("context")&&typeof this.context.displayNotification==="function"){var R={eventID:"warning",msg:S};this.context.displayNotification(R)}}}function N(S,R){H.createNewVersionPromise({parentid:S.parent.options.id,title:S.title,description:S.description,versionSemantic:S.versionSemantic,nextRevision:S.parent.nextRevision,itemID:H.itemID}).then(R,K)}function G(R,S){if(typeof S==="string"&&S.length&&R!==m.DATA_MODEL_TYPES.MODEL_HISTORY){R=m.DATA_MODEL_TYPES[((S.contains(":"))?"MODEL_RDF":"MODEL_REVISION")]}if(H._DATA_MODEL_TYPE!==R){H._DATA_MODEL_TYPE=R;var T=a(H._DATA_MODEL_TYPE);z.setParams("RevisionExplorerCustomizeColumns_"+H._DATA_MODEL_TYPE.toString(),T.columns,T.defaultCols);switch(H._DATA_MODEL_TYPE){case m.DATA_MODEL_TYPES.MODEL_RDF:B=t;break;case m.DATA_MODEL_TYPES.MODEL_HISTORY:B=n;break;default:B=o;break}H.setManager(B)}}f.Class.implement.call(this,{setSelectionMode:function(R){D=H._SELECTION_MODE;(R>=0&&R&m.SELECTION_MODES.SINGLE_SELECT_ONLY)&&(R&=~m.SELECTION_MODES.MULTI_SELECT_ONLY);P.setSelectionMode(R>=0?R:(m.SELECTION_MODES.MULTI_SELECT_ONLY|m.SELECTION_MODES.WITH_COMMANDS))},restorePreviousSelectionMode:function(){P.setSelectionMode(D||(m.SELECTION_MODES.MULTI_SELECT_ONLY|m.SELECTION_MODES.WITH_COMMANDS))},showDialog:function(T,V,U){if(V==null){V=this._widget!=null?this._widget.body:null}P.showDialog(T,V,U);var R,S=(R=H.searchByID(I._activeVersion),R.length===1)?R[0]:undefined;(S instanceof j)&&P.setTitle(S.options.label)},hideDialog:function(){P.hideDialog()},cleanup:function(){if(Q){c.removeEvent("_ENOXVersionExplorerNewVersionCreated",C)}P.cleanup();H.empty();H.itemID=null;H.items=null},getSelectedNodes:function(){return H.getSelectedNodes()},setSingleSelectionMode:function(){this.setSelectionMode(H._SELECTION_MODE&~m.SELECTION_MODES.MULTI_SELECT_ONLY)},setMultiSelectionMode:function(){this.setSelectionMode(H._SELECTION_MODE|m.SELECTION_MODES.MULTI_SELECT_ONLY)},enableCommands:function(){this.setSelectionMode(H._SELECTION_MODE|m.SELECTION_MODES.WITH_COMMANDS)},disableCommands:function(){this.setSelectionMode(H._SELECTION_MODE&~m.SELECTION_MODES.WITH_COMMANDS)},select:function(S){var R=(S instanceof j)?[S]:(typeof S==="string"&&S.length?H.searchByID(S):undefined);Array.isArray(R)&&(R.length===1)&&(R[0].select())},unselectAll:function(){if(H){H.prepareAddDelete();H.unselectAll();H.pushAddDelete()}},applyFilter:function(S){if(H){H.prepareAddDelete();H._FILTER_ENABLED=true;var R=(H)?H.applyFilter(S):[];(!R.length)&&(H._FILTER_ENABLED=false,this.clearFilter());H.pushAddDelete()}return R},clearFilter:function(){if(H){H.prepareAddDelete();H._FILTER_ENABLED=false;(H)&&H.clearFilter();H.pushAddDelete()}},enableDrag:function(R){this.setSelectionMode(H._SELECTION_MODE|m.SELECTION_MODES.ALLOW_DRAG)},disableDrag:function(){this.setSelectionMode(H._SELECTION_MODE&~m.SELECTION_MODES.ALLOW_DRAG)},enableDrop:function(){this.setSelectionMode(H._SELECTION_MODE|m.SELECTION_MODES.ALLOW_DROP)},disableDrop:function(){this.setSelectionMode(H._SELECTION_MODE&~m.SELECTION_MODES.ALLOW_DROP)},getObjects:function(){return H._nodeList.slice()},reframeAll:function(){P&&P.reframeThumbnailGraph()},_loadVersionModel:function(T){if(!F._isODT){P.setLoadingMask()}H.type=T.type||H.type;G(T.dataModelType,H.type);P&&P.updateViewOptions();var R=true,S,U=T.onComplete;I._context=T.context;I._tenant=T.tenantId;I._securityContext=T.securityContext;S=a(H._DATA_MODEL_TYPE).excludeFromQuery;T.attributeList=z.getAlldbKeys();if(Array.isArray(S)&&S.length){T.attributeList=g.intersectionDifference(T.attributeList,S,function(W,V){return W===V})[0].difference}R&&H.loadVersionModelPromise(T).then(function(V){if(!F._isODT){P.unmask()}if(V){P.displayView(T.reframe)}I._currentVersion=T.id;if(typeof U==="function"){U(T)}},function(V){if(I._widget&&I._widget.lifecycleWidget){I._widget.lifecycleWidget.empty()}K(V)})},_setActiveVersion:function(R){var T;if(R.treeNode){T=R.treeNode}else{if(R.id){var S=H.searchByID(R.id);if(S.length===1){T=S[0]}}}H.prepareAddDelete();H.setAttributeAll("__isActive__",false);if(T){H.setAttribute(T,"__isActive__",true);I._activeVersion=T.options.id;P.setTitle(T.options.label)}H.pushAddDelete()},_displayNewVersionDialog:function(R){var S;if(R.treeNode){S=R.treeNode}else{if(R.id){var T=H.searchByID(R.id);if(T.length===1){S=T[0]}}}(!!S)&&i.displayDialog({dataModelType:H._DATA_MODEL_TYPE,defaultName:H.getNewVersionName(),derivedFrom:{id:S.options.id,name:S.options.grid.title},parentContainer:L,onOK:function(X,V,U){var W={title:X,description:V,parent:S,versionSemantic:U};N(W,function(Y){I.publishEvent("ENOXVersionExplorerNewVersionCreated",Y)})}})},_displayNewRevisionDialog:function(R){var S;if(R.treeNode){S=R.treeNode}else{if(R.id){var T=H.searchByID(R.id);if(T.length===1){S=T[0]}}}if(S){e.displayDialog({defaultName:S.options.grid.title,derivedFrom:{id:S.options.id,name:S.options.grid.title+" "+S.options.grid.code},nextRevision:S.nextRevision,parentContainer:L,onOK:function(W,U){var V={title:W,description:U,parent:S,versionSemantic:"E"};N(V,function(X){I.publishEvent("ENOXVersionExplorerNewVersionCreated",X)})}})}}});if(F._isODT){f.Class.implement.call(this,{_ODTGetVersionExplorerView:function(){return P},_ODTGetVersionModel:function(){return H}})}}});return x});