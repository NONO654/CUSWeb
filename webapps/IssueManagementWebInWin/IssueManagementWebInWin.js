define("DS/IssueManagementWebInWin/MfgIssueManagement",["DS/IssueManagement/IssueManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI"],function(d,f,b){var c=null;var a={TASKS:{SELECT_IN_3D:"SELECT_IN_3D",ADD_OBJECTS:"ADD_OBJECTS",TAKE_SCREENSHOT:"TAKE_SCREENSHOT"}};var e={_tasks:{subscriberTokens:[],current:null},InitWebInWin:function(g){c=g;var h={};e._getWebInWinParameters(function(i){h=i?i:null;e._populate3DSpaceURL(h).then(function(k){var j=new d({standalone:true})},function(j){console.log("Populate 3DSpace URL failed");return Promise.reject(j)})})},_getWebInWinParameters:function(h){var g=this;if(!window.COMPASS_CONFIG||!window.COMPASS_CONFIG.myAppsBaseUrl){e._getAppsUrl(function(i){if(!window.COMPASS_CONFIG){window.COMPASS_CONFIG={}}if(i){window.COMPASS_CONFIG.myAppsBaseUrl=i;if(!window.COMPASS_CONFIG.userId){window.COMPASS_CONFIG.userId=c}if(!window.COMPASS_CONFIG.lang){window.COMPASS_CONFIG.lang=widget.lang}}h(window.COMPASS_CONFIG)})}else{h(window.COMPASS_CONFIG)}},_getAppsUrl:function(g){if(typeof dscef.getMyAppsURL==="function"){dscef.getMyAppsURL().then(function(h){console.log("MyApps URL",h);g.call(null,h)})["catch"](function(h){console.error("Failed to fetch MyApps URL: "+h);g.call(null,null)})}else{g.call(null,null)}},_populate3DSpaceURL:function(g){var h=new Promise(function(k,j){var i=null;if(g){i={};i.myAppsBaseUrl=g.myAppsBaseUrl,i.userId=g.userId,i.lang=g.lang}f.getPlatformServices({config:i,onComplete:function(m){for(var l=0;l<m.length;l++){console.log("platformId",m[l]["platformId"]);console.log("3DSpace",m[l]["3DSpace"]);console.log("3DSearch",m[l]["3DSearch"])}k()},onFailure:j})});return h},subscribeToTasks:function(){var j=this;j._tasks.subscriberTokens.push(b.subscribe("DS/IssueManagementTask/add",function g(m){var o=m.data.paths[0][0],l=m.data.attributes[o];if(Object.keys(a.TASKS).indexOf(l.taskType)!==-1){var n=[],k={};n.push([o]);k[o]={taskType:l.taskType,widgetIdIM:l.widgetIdIM,widgetId3D:widget.id};b.publish("DS/IssueManagementTask/ready",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:k},version:"1.0"})}}));j._tasks.subscriberTokens.push(b.subscribe("DS/IssueManagementTask/exec",function i(l){var m=l.data.paths[0][0],k=l.data.attributes[m];if(Object.keys(a.TASKS).indexOf(k.taskType)!==-1){j._tasks.current={taskId:m,taskType:k.taskType,widgetIdIM:k.widgetIdIM,widgetId3D:widget.id};switch(k.taskType){case a.TASKS.SELECT_IN_3D:console.log("Executing Select in 3D, We have to call C++ from here");dscef.sendString("SelectFrom3D=1");break;case a.TASKS.ADD_OBJECTS:console.log("Executing Select From Search, We have to call C++ from here");dscef.sendString("SelectFromSearch=1");break;case a.TASKS.TAKE_SCREENSHOT:console.log("Executing Take Snapshot, We have to call C++ from here");dscef.sendString("TakeScreenShot=1");break;default:break}}else{}}));j._tasks.subscriberTokens.push(b.subscribe("DS/IssueManagementTask/cancel",function h(k){console.log("Cancel Task triggered");dscef.sendString("TaskCancelled=1");j._tasks.current=null}))},SelectFrom3DDone:function(k){var j=this;var l=[],h={};var i={};i.nodes=[];i.nodes.push("node");i.paths=k;var g={};g[k]={x:0,y:0,z:0,balloons:[]};l.push([j._tasks.current.taskId]);h[j._tasks.current.taskId]={taskType:j._tasks.current.taskType,widgetIdIM:j._tasks.current.widgetIdIM,widgetId3D:j._tasks.current.widgetId3D,response:{target:k,positions:g,nodes:i}};b.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:l,attributes:h},version:"1.0"})},SelectFromSearchDone:function(m){var l=this;var g=m.split(",");var k=[];for(var j=0;j<g.length;j++){k.push(g[j])}var n=[],h={};n.push([l._tasks.current.taskId]);h[l._tasks.current.taskId]={taskType:l._tasks.current.taskType,widgetIdIM:l._tasks.current.widgetIdIM,widgetId3D:l._tasks.current.widgetId3D,response:{physicalIds:k}};b.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:h},version:"1.0"})},ScreenShotCaptured:function(g){var l=this;var j=g;var n="screenshot-"+Math.floor(Date.now())+".png";var h="image/png";var k=Date.now();var m=[],i={};m.push([l._tasks.current.taskId]);i[l._tasks.current.taskId]={taskType:l._tasks.current.taskType,widgetIdIM:l._tasks.current.widgetIdIM,widgetId3D:l._tasks.current.widgetId3D,response:{data:j,fileName:n,fileType:h,lastModified:k}};b.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:m,attributes:i},version:"1.0"})}};return e});define("DS/IssueManagementWebInWin/ENOIssueGenerationPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/create/Create"],function(b,e,d,c,a){return e.extend({init:function(h){function g(k){k.getDialog().addEvent("onResizeFloating",function(){var m=k.getDialog().elements.container.getSize();if(m.width!==window.widget.body.getSize().width||m.height!==window.widget.body.getSize().height){k.getDialog().setNewBodySize(window.widget.body.getSize())}});var l=new e.Listener();l.listenToOnce(k,"onCreateDialogClose",function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))})}function i(k){if("attachments" in k.views){k.views.attachments.view.fields.attachments.iconBar.disableItem("attachFrom3DX");k.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot")}if("related" in k.views){k.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled");k.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled");k.views.related.view.fields.reportedAgainst.iconBar.getItem("addReported").elements.container.addClassName("disabled");k.views.related.view.fields.contexts.iconBar.getItem("addContext").elements.container.addClassName("disabled")}k.getDialog().options.limitParent=true;k.getDialog().setNewBodySize(window.widget.body.getSize());if(document.getElementsByClassName("floatingPanel_RightButtons")[0]){document.getElementsByClassName("floatingPanel_RightButtons")[0].setStyle("display","none")}if(document.getElementById("create-view-footer-save-as-draft-btn")){document.getElementById("create-view-footer-save-as-draft-btn").setStyle("display","none")}if(document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0]){document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0].setStyle("display","none")}}function j(){var n=!h.contexts?[]:h.contexts.map(function(o){return{physicalId:o}});var l=!h.reportedAgainst?[]:h.reportedAgainst.map(function(o){return{physicalId:o,automation:{assignee:!h.assignees}}});var k=!h.attachments?[]:h.attachments;var m={id:"Ext_GenereateIssue",info:{description:null,name:null},ui:{assignees:[],responsibleOrganization:d.getCurrentCredentials().organization},data:{title:h.title,description:h.description,priority:h.priority===undefined?"Low":h.priority,resolutionDate:Date.now(),reportedAgainst:l,contexts:n,assignees:[],attachments:k,automationTasks:[],responsibleOrganization:d.getCurrentCredentials().organization,reportingOrganization:d.getCurrentCredentials().organization}};return new Promise(function(q){if(h.assignees&&h.assignees.length>=1){var p=[],o=h.assignees.length;h.assignees.forEach(function(r){d.getUserInfo(r,{onComplete:function(t){var s=JSON.parse(t);m.data.assignees.push(s.name);p.push({user:s.name,fullName:s.firstname+" "+s.lastname,organization:s.company.name});o--;if(o===0){m.ui.assignees=b.merge({},p);q()}},onFailure:function(){o--;if(o===0){q()}}})})}else{q()}}).then(function(){return m})}function f(){d.initPlatformServices().then(function(){j(h,d).then(function(l){c.add("widget",window.widget);c.get("widget").name="ENOIssueGenerationPanel";var k=new a(window.widget.body,{escapeToClose:false,resizable:false});k.render();k.isLoaded["finally"](function(){k.applyTemplate(l);g(k);i(k)})})})}f()}})});