define("DS/DELMOMWKIExperience/js/ParserUtility",["DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS"],function(c,b){var a=function(){};a.prototype.isInIEBrowser=function(){var e=window.navigator.userAgent;var d=e.indexOf("MSIE");if((d>0)||(!!navigator.userAgent.match(/Trident\/7\./))){return true}return false};a.prototype.fixIEAttr=function(f){if(this.isInIEBrowser){var e="";for(var d=0;d<f.length;d++){e+=f[d]}f=e.replace(/', '-', '/g,"")}return f};a.prototype.GetObjectArray=function(e){var f=e;var d=[];if(f==undefined){return d}if(f.constructor&&f.constructor===Array){d=f}else{d=[f]}return d};a.prototype.xmlToJson=function(o){var h="#text";var l={};var n=this.isInIEBrowser;if(o===null){return null}if(o.nodeType==1){if(o.attributes.length>0){l.attributes={};for(var k=0;k<o.attributes.length;k++){var d=o.attributes.item(k);l.attributes[d.nodeName]=d.nodeValue}}}else{if(o.nodeType==3){l=o.nodeValue}}if(o.hasChildNodes()){for(var m=0;m<o.childNodes.length;m++){var q=o.childNodes.item(m);var p=q.nodeName;var g=o.documentElement;if(g){var f=g.tagName;if(f&&p===f){p="RootEle"}}if(typeof(l[p])=="undefined"){l[p]=this.xmlToJson(q)}else{if(p===h&&l[h]&&n){l[h]=l[h]+q.nodeValue;continue}else{if(typeof(l[p].push)=="undefined"){var e=l[p];l[p]=[];l[p].push(e)}}l[p].push(this.xmlToJson(q))}}}return l};return a});define("DS/DELMOMWKIExperience/js/WkiStreamUtil",["UWA/Core","UWA/Class","UWA/Utils","DS/WAFData/WAFData","DS/VisuUnstreamers/FileInZipStreamObject","DS/ZipJS/zip-fs","DS/VisuDataAccess/Ox4XHRWithProxyAbstraction"],function(f,q,e,c,v,p,g){var j=[];g.useUWAProxy=function(w){g.proxyUsage=2;g.server=null;g.sport=null;g.proxymode="none";g.authentication="passport"};var m=q.extend({init:function(w){if(f.is(w.extendedStreamEnabled)){this.extendedStreamEnabled=w.extendedStreamEnabled}else{this.extendedStreamEnabled=true}this.serverURL=w.serverURL;this.securityContext=w.securityContext;this.plmIdentifier=w.plmIdentifier;this.urlUtility=(URL||webkitURL);this.mainZipBlob=null;this.extZipBlob=null;this.isLoading=false;this.isZipLoaded=false;return this},isLoading:function(){return this.isLoading},isZipLoaded:function(){return this.isZipLoaded},setZipLoaded:function(w){this.isZipLoaded=w},callServerRequest:function b(x,B,y,D,w,C,E){var A={Accept:"application/json, text/plain, application/octet-stream",SecurityContext:E};var z={method:w,type:D,cache:-1,headers:A,timeout:50000,proxy:"none",onComplete:B,onFailure:y?y:function(F){f.log("Error")}};c.authenticatedRequest(x,z)},loadExtendedStream:function a(D){var C=this;var x=this.plmIdentifier;var B=function(E){f.log("Error");console.log("Error "+E)};var A=function(E){if(f.is(E)&&E.size>0){C.extZipBlob=E}else{C.extZipBlob=null}C.isZipLoaded=true;D()};var z=function(E){if(!f.is(E)){C.isZipLoaded=true;D(null);return}var G=E.results[0];var F=G.fcsurl;C.callServerRequest(F,A,B,"blob","GET","",C.securityContext)};var w="resources/upr/wip/getextendedstream3dzipurl?PLMID=";var y=C.serverURL+w+encodeURIComponent(x);this.callServerRequest(y,z,B,"json","GET","",C.securityContext)},loadStreams:function h(D){var C=this;var x=this.plmIdentifier;var w="resources/upr/wip/getmainstream3dzipurl?PLMID=";var B=function(E){f.log("Error");console.log("Error "+E)};var A=function(E){if(f.is(E)&&E.size>0){C.mainZipBlob=E;C.loadExtendedStream(D)}else{C.mainZipBlob=null}};var z=function(E){if(!f.is(E)){D(null);return}var G=E.results[0];var F=G.fcsurl;C.callServerRequest(F,A,B,"blob","GET","",C.securityContext)};var y=C.serverURL+w+encodeURIComponent(x);this.callServerRequest(y,z,B,"json","GET","",C.securityContext)},get2DFiles:function k(D,z,B){var H=this;var w=[];var F=[];var C=this.plmIdentifier;var E=D.length;var y=[];var J=0;var L=function(O){f.log("Error");console.log("Error "+O)};if(!f.is(B)){B=false}var M=function M(P){var O=P.indexOf(".View.");var S=O+6;var R=P.indexOf(".",S);var Q=parseInt(P.substr(S,R));if(f.is(Q)){return Q-1}else{return 0}};var K=function(O){O.forEach(function(P){P.getData(new p.BlobWriter(),function(Q){var S=null;var R=null;if(f.is(Q)){R=H.urlUtility.createObjectURL(Q);j.push(R);S=M(P.filename);if(P.filename.indexOf("_THUMBNAIL")>0){F[S]=R}else{w[S]=R}J++;if(O.length===J){J=0;var T={image2DThumbnails:F,image2DFiles:w};z(T)}}},function(R,Q){})})};var N=function(O){console.log("***STREAM Error. "+O);z(null)};var I=function(O){p.createReader(new p.BlobReader(O),function(P){P.getEntries(function(Q){if(Q.length>0){var R="";Q.forEach(function(S){R=S.filename;if(R.substr(R.lastIndexOf(".")+1)==="png"&&(R.substr(0,E)===D)&&R.indexOf("View.")>0){y.push(S)}});if(y.length>0){K(y)}else{H.mainZipBlob=null;z(null)}P.close(function(){})}})},function(P){z(P)});H.mainZipBlob=O};var x=function(O){if(!f.is(O)){z(null);return}var Q=O.results[0];var P=Q.fcsurl;H.callServerRequest(P,I,L,"blob","GET","",H.securityContext)};if(f.is(H.mainZipBlob)){I(H.mainZipBlob)}else{var G="resources/upr/wip/getmainstream3dzipurl?PLMID=";if(B){G="resources/upr/wip/getextendedstream3dzipurl?PLMID="}var A=H.serverURL+G+encodeURIComponent(C);this.callServerRequest(A,x,L,"json","GET","",H.securityContext)}},get3DXmlFileURL:function s(z,F){var C=this;var E=this.securityContext;var D=this.serverURL;var A=this.plmIdentifier;var y=function(H){f.log("Error");console.log("Error "+H)};var w=function(H){console.log("***STREAM Error. "+H);F(null)};var x=function(I){C.mainZipBlob=I;var H=new v(I,z);H.readAsBlob(function(J){var K=null;if(f.is(J)){var K=C.urlUtility.createObjectURL(J);j.push(K)}F(K)});H.close()};var B=function(H){if(!f.is(H)){F(null);return}var J=H.results[0];var I=J.fcsurl;C.callServerRequest(I,x,y,"blob","GET","",E)};if(f.is(C.mainZipBlob)){x(C.mainZipBlob)}else{var G=D+"resources/upr/wip/getmainstream3dzipurl?PLMID="+encodeURIComponent(A);this.callServerRequest(G,B,y,"json","GET","",E)}},getFileFromExtendedStream:function l(A,F){var C=this;var E=this.securityContext;var D=this.serverURL;var y=this.plmIdentifier;var z=function(H){f.log("Error");console.log("Error "+H);F(null)};var w=function(H){console.log("***STREAM Error. "+H);F(null)};var x=function(I){if(f.is(I)&&I.size>0){C.extZipBlob=I;var H=new v(I,A);H.readAsText(function(J){if(f.is(J)){F(J)}else{C.getFileFromMainStream(A,F)}});H.close()}else{C.getFileFromMainStream(A,F)}};var B=function(H){if(!f.is(H)){C.getFileFromMainStream(A,F);return}var J=H.results[0];var I=J.fcsurl;C.callServerRequest(I,x,z,"blob","GET","",E)};if(f.is(C.extZipBlob)){x(C.extZipBlob)}else{var G=D+"resources/upr/wip/getextendedstream3dzipurl?PLMID="+encodeURIComponent(y);this.callServerRequest(G,B,z,"json","GET","",E)}},getFileFromMainStream:function d(A,F){var C=this;var E=this.securityContext;var D=this.serverURL;var y=this.plmIdentifier;var z=function(H){f.log("Error");console.log("Error "+H);F(null)};var w=function(H){console.log("***STREAM Error. "+H);F(null)};var x=function(I){C.mainZipBlob=I;var H=new v(I,A);H.readAsText(function(J){F(J)});H.close()};var B=function(H){if(!f.is(H)){F(null);return}var J=H.results[0];var I=J.fcsurl;C.callServerRequest(I,x,z,"blob","GET","",E)};if(f.is(C.mainZipBlob)){x(C.mainZipBlob)}else{var G=D+"resources/upr/wip/getmainstream3dzipurl?PLMID="+encodeURIComponent(y);this.callServerRequest(G,B,z,"json","GET","",E)}},getFile:function i(x,w){if(this.extendedStreamEnabled){this.getFileFromExtendedStream(x,w)}else{this.getFileFromMainStream(x,w)}},getMainStreamImageUrl:function o(A,F){var C=this;var E=this.securityContext;var D=this.serverURL;var y=this.plmIdentifier;var z=function(H){f.log("Error");console.log("Error "+H)};var w=function(H){console.log("***STREAM Error. "+H)};var x=function x(I){C.mainZipBlob=I;var H=new v(I,A);H.readAsBlob(function(J){if(f.is(J)){var K=C.urlUtility.createObjectURL(J);j.push(K);F(K)}else{F(null)}});H.close();H=null};var B=function B(H){if(f.is(H)){var J=H.results[0];var I=J.fcsurl;C.callServerRequest(I,x,z,"blob","GET","",E)}else{F(null)}};if(f.is(C.mainZipBlob)){x(C.mainZipBlob)}else{var G=D+"resources/upr/wip/getmainstream3dzipurl?PLMID="+encodeURIComponent(y);this.callServerRequest(G,B,z,"json","GET","",E)}},getExtendedStreamImageUrl:function u(A,F){var C=this;var E=this.securityContext;var D=this.serverURL;var y=this.plmIdentifier;var z=function(H){f.log("Error");console.log("Error "+H)};var w=function(H){console.log("***STREAM Error. "+H)};var x=function(I){if(f.is(I)&&I.size>0){C.extZipBlob=I;var H=new v(I,A);H.readAsBlob(function(J){if(f.is(J)){var K=C.urlUtility.createObjectURL(J);j.push(K);F(K)}else{C.getMainStreamImageUrl(A,F)}});H.close()}else{C.getMainStreamImageUrl(A,F)}};var B=function(H){if(f.is(H)){var J=H.results[0];var I=J.fcsurl;C.callServerRequest(I,x,z,"blob","GET","",E)}else{C.getMainStreamImageUrl(A,F)}};if(f.is(C.extZipBlob)){x(C.extZipBlob)}else{var G=D+"resources/upr/wip/getextendedstream3dzipurl?PLMID="+encodeURIComponent(y);this.callServerRequest(G,B,z,"json","GET","",E)}},getImageUrl:function n(A,z,y){var x=this;var w=function w(C){x.isLoading=false;if(f.is(C)){z(C)}else{var B={serverURL:x.serverURL,securityContext:x.securityContext,plmIdentifier:y};var D=new m(B);D.getMainStreamImageUrl(A,z)}};if(this.isZipLoaded){if(f.is(this.extZipBlob)||!f.is(this.mainZipBlob)){this.getExtendedStreamImageUrl(A,w)}else{if(f.is(this.mainZipBlob)){this.getMainStreamImageUrl(A,w)}}}else{this.getExtendedStreamImageUrl(A,w)}},getOldOperationThumbnailUrl:function r(A,z){var w=function(B){f.log("Error");console.log("Error "+B)};var x=function(B){if(f.is(B)){var D=B.results[0];var C=D.fcsurl;z(C)}else{z(null)}};var y=this.serverURL+"resources/upr/wip/getoldoperthumbnailurl?PLMID="+encodeURIComponent(A);this.callServerRequest(y,x,w,"json","GET","",this.securityContext)},dispose:function t(){var w=this;if(f.is(this.mainZipBlob)){if(f.is(this.mainZipBlob.waitingEntries)){if(f.is(this.mainZipBlob.waitingEntries.clear)){this.mainZipBlob.waitingEntries.clear()}else{this.mainZipBlob.waitingEntries=null}}if(f.is(this.mainZipBlob.zipEntries)){if(f.is(this.mainZipBlob.zipEntries.entries.clear)){this.mainZipBlob.zipEntries.entries.clear()}else{this.mainZipBlob.zipEntries.entries=null}}this.mainZipBlob=null}if(f.is(this.extZipBlob)){if(f.is(this.extZipBlob.waitingEntries)){if(f.is(this.extZipBlob.waitingEntries.clear)){this.extZipBlob.waitingEntries.clear()}else{this.extZipBlob.waitingEntries=null}}if(f.is(this.extZipBlob.zipEntries)){if(f.is(this.extZipBlob.zipEntries.entries.clear)){this.extZipBlob.zipEntries.entries.clear()}else{this.extZipBlob.zipEntries.entries=null}}this.extZipBlob=null}j.forEach(function(x){w.urlUtility.revokeObjectURL(x)})}});return m});define("DS/DELMOMWKIExperience/js/Part",["UWA/Class"],function(a){var c={MfgItem:{name:"Mfg Item",value:1},Resource:{name:"Resource",value:2},FTAReq:{name:"FTA Req",value:3},Product:{name:"Product",value:4},Unknown:{name:"Unknown",value:0}};var b=a.extend({init:function(d){this.id=null;this.path=null;this.position=null;this.buildupDisplayMode;this.type=null;this.persistentId=null;this.physicalId=null;this.isWithColor=true;this.isWithTransparency=false;return this},getId:function(){return this.id},getPhysicalId:function(){return this.physicalId},getPersistentId:function(){return this.persistentId},getPath:function(){return this.path},getPosition:function(){return this.position},getBuildupDisplayMode:function(){return this.buildupDisplayMode},setType:function(d){switch(d){case c.MfgItem.name:this.type=c.MfgItem.value;break;case c.Resource.name:this.type=c.Resource.value;break;case c.FTAReq.name:this.type=c.FTAReq.value;break;case c.Product.name:this.type=c.Product.value;break;default:this.type=c.Unknown.value;break}}});return b});define("DS/DELMOMWKIExperience/js/FTAHelper",["UWA/Core","UWA/Class","DS/PADUtils/PADContext","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(e,b,d,c){var a=b.extend({init:function(f){this.contextObject={context:d.get()}},loadFTA:function(h,f,g){this.initModelLoader();this.modelLoader.setActiveState(2);this.modelLoader.loadFTALightModel(h,f,g)},hideFTA:function(){this.initModelLoader();this.modelLoader.setActiveState(0)},initModelLoader:function(){if(!e.is(this.modelLoader)){this.modelLoader=c.giveAnnotationModelLoader(this.contextObject);if(!e.is(this.modelLoader)){this.modelLoader=c.getAnnotationModelLoader(this.contextObject)}}},destroy:function(){c.unreferenceAnnotationModelLoader(this.contextObject)}});return a});define("DS/DELMOMWKIExperience/commands/CmdMultiSelect",["DS/ApplicationFrame/Command"],function(a){var b=a.extend({init:function(c){this._parent(c,{isAsynchronous:true,mode:"exclusive"})},beginExecute:function(){var e=this;var d=this.getFrameWindow().experience;e._webGLV6Viewer=d.frmWindow.getViewer();e._webGLV6Viewer.forceMultiSel=true;var c=document.createEvent("CustomEvent");c.initCustomEvent("SELECTMODECHANGE",false,false,{SelectMode:"multi"});document.dispatchEvent(c)},endExecute:function(){this._webGLV6Viewer.forceMultiSel=false;var c=document.createEvent("CustomEvent");c.initCustomEvent("SELECTMODECHANGE",false,false,{SelectMode:"single"});document.dispatchEvent(c)}});return b});define("DS/DELMOMWKIExperience/js/EventDispatcher",["require","exports"],function(b,a){var c=(function(){function d(){this._eventHandlers={}}d.prototype.addEventListener=function(e,f){this._eventHandlers[e]=this._eventHandlers[e]||[];this._eventHandlers[e].push(f)};d.prototype.fireEvent=function(f,e){var h=this._eventHandlers[f];if(h){for(var g=0;g<h.length;g++){h[g](e)}}};return d}());a.EventDispatcher=c});define("DS/DELMOMWKIExperience/js/MappingFileParser",["UWA/Core","UWA/Class","DS/DELMOMWKIExperience/js/ParserUtility","DS/DELMOMWKIExperience/js/Part"],function(g,a,i,h){function k(){var p=window.navigator.userAgent;var n=p.indexOf("MSIE ");if(n>0){return parseInt(p.substring(n+5,p.indexOf(".",n)),10)}var m=p.indexOf("Trident/");if(m>0){var q=p.indexOf("rv:");return parseInt(p.substring(q+3,p.indexOf(".",q)),10)}var o=p.indexOf("Edge/");if(o>0){return parseInt(p.substring(o+5,p.indexOf(".",o)),10)}return false}function j(n){var m=new RegExp(",","g");var o=".";var p=n.replace(m,o);return p}function e(n){var m="0";if(n instanceof Array){if(n[n.length-1].attributes.InstPhyID){m=n[n.length-1].attributes.InstPhyID}}else{if(n.attributes.InstPhyID){m=n.attributes.InstPhyID}}return m}function c(r,m,q){var n,o;var p=q.split(";");for(n=0;n<m.length;n+=1){o=m[n].attributes.id;if(g.is(o)&&g.is(p[n])&&o===r){return p[n]}}}var d=a.singleton({init:function(m){this.parserUtility=new i();if(g.is(m)){this.setMapFileJson(m);this.isIntialized=true}},getIsConnectedMode:function(){return(this.mode==="Connected")},getIsLegacyMode:function(){return(this.mode==="Legacy")},getMode:function(){if(!g.is(this.json)){return null}this.isConnectedMode=true;if(this.json.RootEle.attributes.hasOwnProperty("mode")){this.mode=this.json.RootEle.attributes.mode}else{this.mode="Legacy"}return this.mode},setMapFileJson:function(m){this.json=m;this.mode=this.getMode();this.isConnectedMode=this.getIsConnectedMode();this.isLegacyMode=this.getIsLegacyMode()},getOper:function f(q,p){var m=null;var r=null;if(!g.is(this.json)||!g.is(this.json.RootEle)||!g.is(this.json.RootEle.Operations)){return null}var n=this.parserUtility.GetObjectArray(this.json.RootEle.Operations.Operation);if(!this.isLegacyMode){for(var o=0;n.length>o;o+=1){if(p==="id"){if(n[o].attributes[p]===q){r=n[o];break}}else{m=n[o].InstancePath.Instance;if(m.constructor===Array){if(m[m.length-1].attributes[p]===q){r=n[o];break}if(g.is(r)){break}}else{if(n[o].InstancePath.Instance.attributes[p]===q){r=n[o];break}}}}}else{for(var o=0;n.length>o;o+=1){if(n[o].attributes[p]===q){r=n[o];break}}}return r},loadPartPathsFromMappingFile:function(s,p){var m=[];var n=null;var t=this.getOper(s,p);if(t){var r=this.parserUtility.GetObjectArray(t.ProxyProductRef);for(var o=0;r.length>o;o+=1){n=r[o];var q=this.getHighlightedPath(n.attributes.idref);if(q!==null){m.push(q)}}}return m},getPartsForOperation:function(r,u){var t=[];var n=this.getOper(r,u);if(n){var v=null;var s=null;var q=0;var p=this.parserUtility.GetObjectArray(n.ProxyProductRef);for(q=0;q<p.length;q+=1){var m=new h();m.id=p[q].attributes.idref;m.position=j(p[q].Position["#text"]);v=this.getGranularObject(m.id);m.setType(v.attributes.Type);if(g.is(v.attributes.HighlightPath)){if(v.attributes.HighlightPath.indexOf(";")===-1){m.path=v.attributes.HighlightPath}else{m.path=c(m.id,v.ProxyProduct,v.attributes.HighlightPath)}}else{m.path=null}m.buildupDisplayMode=p[q].attributes.BuildupPos;m.visibility=p[q].VisProperties.attributes.Visibility;if(!g.is(p[q].VisProperties.attributes.WithColor)||p[q].VisProperties.attributes.WithColor==="TRUE"){m.isWithColor=true}else{m.isWithColor=false}if(p[q].VisProperties.attributes.B&&p[q].VisProperties.attributes.G&&p[q].VisProperties.attributes.R){m.color={B:p[q].VisProperties.attributes.B,G:p[q].VisProperties.attributes.G,R:p[q].VisProperties.attributes.R}}else{m.color=null}if(!g.is(p[q].VisProperties.attributes.WithTransparency)||p[q].VisProperties.attributes.WithTransparency==="TRUE"){m.isWithTransparency=true}else{m.isWithTransparency=false}m.opacity=p[q].VisProperties.attributes.Opacity;if(m.path&&m.path.length>0){m.persistentId=m.path.split("/").pop()}else{m.physicalId="0";if(Array.isArray(v.ProxyProduct)){var o;for(o=0;o<v.ProxyProduct.length;o+=1){if(v.ProxyProduct[o].attributes.id===m.id){var w=v.ProxyProduct[o].InstancePath.Instance;m.physicalId=e(w);break}}}else{if(g.is(v.ProxyProduct.InstancePath.Instance)){var w=v.ProxyProduct.InstancePath.Instance;m.physicalId=e(w)}}}t.push(m)}}return t},getPartPathsForOperation:function(r,o){var p=[];var s=this.getOper(r,o);if(s){var q=this.parserUtility.GetObjectArray(s.ProxyProductRef);for(var n=0;q.length>n;n+=1){var m=new h();m.id=q[n].attributes.idref;m.position=j(q[n].Position["#text"]);m.path=this.getHighlightedPath(m.id);p.push(m)}}return p},loadPartPathForId:function(o){var m=[];var n=this.getHighlightedPath(o);if(n!==null){m.push(n)}return m},getHighlightConnected:function(m){var o;var q="";var n="";if(Array.isArray(m.ProxyProduct)){q=[];for(o=0;o<m.ProxyProduct.length;o+=1){var p=m.ProxyProduct[o].InstancePath.Instance;n=e(p);q.push(n)}}else{q=e(m.ProxyProduct.InstancePath.Instance)}return q},getAllHighlightPhysicalIds:function(){var q=[];var o,s,n,p=0;var r=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(n=0;r.length>n;n+=1){o=this.getHighlightConnected(r[n]);if(Array.isArray(o)){var m;for(m=0;m<o.length;m+=1){if(g.is(o[m])){q.push(o[m])}else{q.push("0")}}}else{if(g.is(o)){q.push(o)}else{q.push("0")}}}return q},getAllHighlightPathIds:function(){var p=[];var o,s,n;var r=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(n=0;r.length>n;n+=1){o=r[n].attributes.HighlightPath;if(g.is(o)){var m;var q=o.split(";");for(m=0;m<q.length;m+=1){o=q[m];if(o.indexOf("/")>-1){o=o.split("/").pop()}p.push(o)}}}return p},getAllHighlightIds:function(){if(this.isConnectedMode){return this.getAllHighlightPhysicalIds()}else{return this.getAllHighlightPathIds()}},getGranularObjectsByType:function l(n){var m;var q=[];var o=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(m=0;o.length>m;m+=1){var p=o[m].attributes.Type;if(p&&p===n){q.push(o[m])}}return q},getGranularObject:function(p){var n,m,q;var o=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(n=0;o.length>n;n+=1){if(Array.isArray(o[n].ProxyProduct)){for(m=0;m<o[n].ProxyProduct.length;m+=1){q=o[n].ProxyProduct[m].attributes.id;if(g.is(q)&&q===p){return o[n]}}}else{q=o[n].ProxyProduct.attributes.id;if(q&&o[n].ProxyProduct.attributes.id===p){return o[n]}}}return null},getPartPathsForAllFtaReq:function(){var p=[];var o="";var n=this.getGranularObjectsByType("FTA Req");for(var m=0;n.length>m;m+=1){if(this.isConnectedMode){o=this.getHighlightConnected(n[m])}else{o=n[m].attributes.HighlightPath}p.push(o)}return p},getHighlightedPath:function(r){var o,m,s,n,p=null;var q=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(o=0;q.length>o;o+=1){n=q[o].attributes.HighlightPath;if(n.indexOf(";")>0){p=c(r,q[o].ProxyProduct,n);return p}else{s=q[o].ProxyProduct.attributes.id;if(g.is(s)&&g.is(n)&&s===r){return n}}}return p},getHighlightPathsByRefTitle:function(n){var q=new Array();var p,r,o,m,t;var s=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(o=0;s.length>o;o+=1){p=this.getHighlightId(s[o]);if(this.isLegacyMode){r=s[o].attributes.ReferenceTitle}else{if(g.is(s[o].InstancePath)){t=this.parserUtility.GetObjectArray(s[o].InstancePath.Instance)}else{t=[];r=""}if(t.length>0){r=t[t.length-1].attributes.ReferenceTitle}}if(p&&r&&r===n){q.push(p)}}return q},getHighlightId:function(m){if(this.getIsConnectedMode()){return this.getHighlightConnected(m)}else{return m.attributes.HighlightPath}},getRefTitle:function(w){var r,q,o,p,n,t,s;var v=w.split("/");var u=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(r=0;u.length>r;r+=1){t=this.getHighlightId(u[r]);s=t.split("/");if(s.length<v.length){p=v[0];for(q=1;q<s.length;q++){p+="/"+v[q]}}if(t.length>0&&(w===t||p===t)){if(this.isLegacyMode){n=u[r].attributes.ReferenceTitle;return n}else{var m=this.parserUtility.GetObjectArray(u[r].InstancePath.Instance);if(m.length>0){n=m[m.length-1].attributes.ReferenceTitle}return n}}}return n},getHighlightPathsByValues:function(t,s){var o=new Array();var r,n,q,p,u,m;var v=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(q=0;v.length>q;q+=1){u=false;r=this.getHighlightId(v[q]);for(p=0;p<s.length;p++){if(this.isLegacyMode){n=v[q].attributes[s[p]]}else{if(g.is(v[q].InstancePath)){m=this.parserUtility.GetObjectArray(v[q].InstancePath.Instance)}else{m=[];n=""}if(m.length>0){n=m[m.length-1].attributes[s[p]]}}if(r&&n&&n===t[p]){u=true;break}}if(u){o.push(r)}}return o},getHighlightPathsHavingAllValues:function(t,s){var o=new Array();var r,n,q,p,u,m;var v=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(q=0;v.length>q;q+=1){u=false;r=this.getHighlightId(v[q]);for(p=0;p<s.length;p++){if(this.isLegacyMode){n=v[q].attributes[s[p]]}else{if(g.is(v[q].InstancePath)){m=this.parserUtility.GetObjectArray(v[q].InstancePath.Instance)}else{m=[];n=""}if(m.length>0){n=m[m.length-1].attributes[s[p]]}}if(r&&n&&n===t[p]){u=true}else{u=false;break}}if(u){o.push(r)}}return o},getInstanceNameByHighlightPath:function(w){var s,r,p,q,u=false,o="",n=null,t=null,u=false,m=[];var q=w.split("/");var v=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(s=q.length-1;s>-1;s--){p=q[s];for(r=0;v.length>r;r++){u=false;t=this.getHighlightId(v[r]);n=t.split("/").pop();if(n===p){u=true;break}}if(u){if(this.isLegacyMode){o=v[r].attributes.InstanceName}else{if(g.is(v[r].InstancePath)){m=this.parserUtility.GetObjectArray(v[r].InstancePath.Instance)}if(m.length>0){o=m[m.length-1].attributes.InstanceName}}break}}return o},getLoadedPartIds:function b(){var o=new Map();var m="";var n=null;var r=function(s){if(g.is(s.AllChildren)&&s.AllChildren==="YES"){return 1}else{return 0}};if(this.isConnectedMode){n=function n(s){if(s.InstPhyID.length>0){o.set(s.InstPhyID,r(s))}}}else{n=function n(s){var t="";if(s.HighlightPath.length>0){t=s.HighlightPath;if(t.indexOf("/")>-1){t=t.split("/").pop()}o.set(t,r(s))}}}var p=function p(s){var t=0;if(g.is(s.attributes)){n(s.attributes)}if(s instanceof Array){for(t;t<s.length;t++){p(s[t])}}if(g.is(s.Instance)){p(s.Instance)}};var q=this.json.RootEle.LoadedProducts;if(g.is(q)){p(q.Reference)}return o},getProxyInstConnected:function(r){var m,q,o;var n=null;var p=this.parserUtility.GetObjectArray(this.json.RootEle.GranularObjects.GranularObject);for(m=0;p.length>m;m+=1){if(Array.isArray(p[m].InstancePath.Instance)){if(g.is(p[m].InstancePath.Instance)&&p[m].InstancePath.Instance.length>0){q=p[m].InstancePath.Instance.length-1;o=p[m].InstancePath.Instance[q].attributes.InstPhyID}else{continue}}else{if(g.is(p[m].InstancePath.Instance)){o=p[m].InstancePath.Instance.attributes.InstPhyID}else{continue}}if(o===r){n=p[m].ProxyProduct.InstancePath.Instance.attributes.InstPhyID}}return n},getProxyInstanceId:function(p){var n,m,o=null;if(this.getIsConnectedMode()){o=this.getProxyInstConnected(p)}else{return null}return o}});return d});define("DS/DELMOMWKIExperience/js/PartsDisplay",["UWA/Core","UWA/Class","DS/DELMOMWKIExperience/js/MappingFileParser","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS"],function(f,b,g,d,i){var k=null;var l=null;var h=b.extend({init:function(o,m,n){this.viewer=o;this.experience=m;this.sceneGraphName=n||"ViewsSG";k=m;l=m.getRootBag()},getPathFromId:function(t){var r=this;var n,s;if(g.isConnectedMode){s="id"}else{s="persistentId"}if(!t.split){return n}var m=t.split("/");var p=function(z,u){if(z.length>0){var v;for(v=0;v<z.length;v++){var x=z[v].getLastElement();if(f.is(x[s])){var y=x[s];if(y==u[0]){u.splice(0,1);if(u.length===0){n=z[v];break}}}var w=z[v].getChildrenOccurrencePathes();if(w!==undefined&&w!==null){p(w,u)}}}};var q=[j(k)];var o=q;p(o,m);return n},getPartPathElement:function(n){var o=this;var m=null;if(n.path){m=o.getPathFromId(n.path)}else{if(n.physicalId){m=o.getPathFromId(n.physicalId)}else{return}}return m},setPartPathVisibility:function(o,n){var p=this;var m=p.viewer.createSceneGraph(this.sceneGraphName,l);o.forEach(function(r){var q=p.getPathFromId(r);if(f.is(q)){m.setVisibility(q,n)}else{console.log("setPartPathVisiblity did not find path for id = "+r)}});this.viewer.render();m=null},setPartVisibility:function(p,n){var q=this;var o=null;var m=q.viewer.createSceneGraph(this.sceneGraphName,l);o=q.getPartPathElement(p);m.setVisibility(o,n);m=null},setPartPathPosition:function(n,p){var o=this;var m=this.viewer.createSceneGraph(this.sceneGraphName,l);n.forEach(function(r){var q=o.getPathFromId(r);o.setPartPosition(p,q,m)});m=null},setPartPosition:function(n,p,o){var r=n.split(" ");var m=[parseFloat(r[0]),parseFloat(r[3]),parseFloat(r[6]),parseFloat(r[1]),parseFloat(r[4]),parseFloat(r[7]),parseFloat(r[2]),parseFloat(r[5]),parseFloat(r[8])];var q=new i.Matrix4().setRotation(m).setPosition(new i.Vector3(parseFloat(r[9]),parseFloat(r[10]),parseFloat(r[11])));o.setPosition(p,q)},setPartsPosition:function(o){var n=this;var m=this.viewer.createSceneGraph(this.sceneGraphName,l);o.forEach(function(q){var p=n.getPathFromId(q.path);n.setPartPosition(q.position,p,m)});m=null},clearColorOverrides:function(){var n=this.experience.getRootBag();var m=this.viewer.getSceneGraph(this.sceneGraphName);if(m){var o=m.getOverridesFromPathElement(n);if(o){o.forEach(function(p){if(p.getMaterial()){p.setMaterial(null)}})}}this.viewer.render()},clearColorOverridesByPaths:function(r){var p=null;var o=0;var n=0;var q=null;var m=this.viewer.getSceneGraph(this.sceneGraphName);if(m){for(o=0;o<r.length;o++){q=this.getPathFromId(r[o]);p=m.getSceneGraphOverride(q);if(p){if(p.getMaterial()){p.setMaterial(null)}}}}this.viewer.render()},clearColorOverridesMultiParts:function(r){var q=null;var p=0;var o=0;var m=this.viewer.getSceneGraph(this.sceneGraphName);var n=null;if(f.is(m)){n=this.getPathElements(r);for(p=0;p<n.length;p++){q=m.getSceneGraphOverride(n[p]);if(f.is(q)){if(q.getMaterial()){q.setMaterial(null)}}}}this.viewer.render()},removePartPathColor:function(o){var m=this.viewer.createSceneGraph(this.sceneGraphName,l);var n=m.getSceneGraphOverride(o);if(f.is(n)){n.setMaterial(null,true);this.viewer.render()}},removePartColor:function(o){var q=this;var n=this.viewer.createSceneGraph(this.sceneGraphName,l);var m=q.getPartPathElement(o);var p=n.getSceneGraphOverride(m);if(f.is(p)){p.setMaterial(null,true);this.viewer.render()}},setPartColor:function(p,o){var r=this;var q=null;var n=null;var m=this.viewer.createSceneGraph(this.sceneGraphName,l);n=r.getPartPathElement(p);r.setPartPathElementColor(n,m,o);m=null;r.viewer.render()},setPartPathElementColor:function(q,m,n){var p=new i.MeshPhongMaterial({color:n});var o=m.getSceneGraphOverride(q);o.setMaterial(p,true);this.viewer.render()},setPartPathColor:function(n,o){var q=this;var p=null;var m=this.viewer.createSceneGraph(this.sceneGraphName,l);n.forEach(function(s){var r=q.getPathFromId(s);q.setPartPathElementColor(r,m,o)});m=null},setPartColorMultipleParts:function(s,n){var r=new i.MeshPhongMaterial({color:n});var q=null;var p=0;var m=this.viewer.getSceneGraph(this.sceneGraphName);var o=null;if(f.is(m)){o=this.getPathElements(s);for(p=0;p<o.length;p++){q=m.getSceneGraphOverride(o[p]);q.setMaterial(r,true)}}this.viewer.render()},setPartOpacity:function(p,o){var q=this;var m=this.viewer.createSceneGraph(this.sceneGraphName,l);var n=q.getPartPathElement(p);m.setOpacity(n,o);m=null},setPartPathOpacity:function(q,o){var p=this;var m=this.viewer.createSceneGraph(this.sceneGraphName,l);var n=p.getPathFromId(q);m.setOpacity(n,o);m=null},hideAllFtaReq:function e(){var m=g.getPartPathsForAllFtaReq();if(m.length>0){this.setPartPathVisibility(m,false)}this.viewer.render()},applyLoadedProducts:function c(){var o=null;var p=null;var q=g.getLoadedPartIds();if(q.size===0){return}var m=this.viewer.createSceneGraph(this.sceneGraphName,l);if(g.isConnectedMode){p="id"}else{p="persistentId"}var r=function(x){var u=null;var y=null;var w=-1;var v=null;if(x.length>0){var t;for(t=0;t<x.length;t++){u=x[t].getLastElement();y=u[p];if((f.is(u.isPLMInstance)&&u.isPLMInstance()||(f.is(u.productType)&&u.productType==="Instance3D"))&&f.is(y)){if(q.has(y)){o=x[t];m.setVisibility(o,true);var s=q.get(y);if(s===1){continue}}else{o=x[t];m.setVisibility(o,false)}}var v=x[t].getChildrenOccurrencePathes();if(f.is(v)){r(v)}}}};var n=j(this.experience);r(n.getChildrenOccurrencePathes());this.viewer.render()},reframeOn:function(v){var o=v.viewpoint;if(!f.is(v,"object")){throw new Error("No parameter defined")}if(!f.is(v.path)&&!f.is(v.paths)&&!f.is(v.BS)){throw new Error("No paths or bounding sphere defined")}if(!f.is(o)){throw new Error("No viewpoint defined")}if(f.is(v.BS)){o.reframe(null,undefined,v.BS)}else{var w=[];if(f.is(v.path)){w.push(v.path)}else{w=v.paths}var p=new i.Vector3(0,0,0),t=new i.Vector3(0,0,0),m=new i.Vector3(0,0,0);var q=0,r=0;w.forEach(function(B){var A=B.getLastElement(true).getBoundingBox().clone();var y=B.getWorldMatrix();A.applyMatrix4(y);var z=A.min,x=A.max;if(q===0){p.x=Math.min(z.x,x.x);p.y=Math.min(z.y,x.y);p.z=Math.min(z.z,x.z);t.x=Math.max(z.x,x.x);t.y=Math.max(z.y,x.y);t.z=Math.max(z.z,x.z)}else{p.x=Math.min(Math.min(z.x,x.x),p.x);p.y=Math.min(Math.min(z.y,x.y),p.y);p.z=Math.min(Math.min(z.z,x.z),p.z);t.x=Math.max(Math.max(z.x,x.x),t.x);t.y=Math.max(Math.max(z.y,x.y),t.y);t.z=Math.max(Math.max(z.z,x.z),t.z)}q++});r=Math.sqrt(Math.pow(t.x-p.x,2)+Math.pow(t.y-p.y,2)+Math.pow(t.z-p.z,2))/2;m.add(p).add(t);m.divideScalar(2);var u=1.1*r/Math.tan(22.5*Math.PI/180);var s=m.clone();var n=o.control.orientation.clone();o.control.moveTo({target:s,orientation:n,distanceToTarget:u,duration:400})}},showPartsForOperation:function(u,A,p){var q=this;var B=0,w=null,o=null,y=null,s=null,t=null,n=null;var r=[];var z=[];var m=this.viewer.createSceneGraph(this.sceneGraphName,l);if(p){this.clearColorOverrides()}var x=g.getPartsForOperation(u,A);if(g.isConnectedMode){x.forEach(function(F){var G=F.physicalId;z.push(G)})}else{x.forEach(function(F){var G=F.persistentId;z.push(G)})}var E={};var C=g.getAllHighlightIds();var D=null;if(g.isConnectedMode){D="id"}else{D="persistentId"}var v=function(I){if(I.length>0){var G;for(G=0;G<I.length;G++){var F=I[G].getLastElement();var J=F[D];if(f.is(J)){if(C.indexOf(J)>-1){t=I[G];o=z.indexOf(J);if(o>-1){w=x[o];if(w.visibility==="Show"){m.setVisibility(t,true);q.setPartPosition(w.position,t,m);if(w.type===1||w.type===4){if(w.isWithColor){if(w.color){s=new i.Color();s.setRGB(parseInt(w.color.R)/255,parseInt(w.color.G)/255,parseInt(w.color.B)/255);q.setPartPathElementColor(t,m,s)}}if(w.isWithTransparency&&f.is(w.opacity)){if(w.opacity){m.setOpacity(t,parseInt(w.opacity)/255)}}else{m.setOpacity(t,null)}}}else{m.setVisibility(t,false)}}else{m.setVisibility(t,false)}}}var H=I[G].getChildrenOccurrencePathes();if(H!==undefined&&H!==null){v(H)}}}};v([j(q.experience)]);this.viewer.render()},setVisiblePartOverrides:function(n){var o=this.experience.getRootBag();var m=this.viewer.getSceneGraph(this.sceneGraphName);if(m){var p=m.getOverridesFromPathElement(o);if(p){p.forEach(function(q){q.getPathes().forEach(function(r){m.setVisibility(r,n)})})}}this.viewer.render()},getPathElements:function a(o){var r=this;var q=[];var m=null;var p=null;var s=null;if(g.isConnectedMode){s="id"}else{s="persistentId"}var n=function(w){if(w.length>0){var u;for(u=0;u<w.length;u++){var t=w[u].getLastElement();var x=t[s];if(f.is(x)){m=w[u];p=o.indexOf(x);if(p>-1){q.push(m)}}var v=w[u].getChildrenOccurrencePathes();if(v!==undefined&&v!==null){n(v)}}}};n([j(r.experience)]);return q},getRootPathElement:function(){return j(this.experience)}});function j(o){var m=null;var n=new d();m=o.getRootBag();n.setFromArray([m]);return n}return h});define("DS/DELMOMWKIExperience/js/WKI3DPlayer",["require","exports","UWA/Core","UWA/Data","DS/3DPlayHelper/3DPlayHelper","DS/3DPlay/3DPlayScenarioManager","DS/DELMOMWKIExperience/js/EventDispatcher","DS/DELMOMWKIExperience/js/ParserUtility","DS/Selection/CSOManager","DS/ApplicationFrame/CommandsManager","DS/Utilities/KeyboardUtils","WebappsUtils/WebappsUtils","DS/DELMOMWKIExperience/js/MappingFileParser","DS/DELMOMWKIExperience/js/PartsDisplay","DS/Visualization/ThreeJS_DS","DS/CoreEvents/ModelEvents","DS/DELMOMWKIExperience/js/WkiStreamUtil"],function(i,D,f,u,w,e,C,y,x,a,s,d,m,v,B,n,k){var p={WorkInstruction:"WorkInstructionScenario",ProductBuildup:"ProductBuildupScenario"};var A=(function(){function E(){}return E}());D.ModelPart=A;var l=[];var h=null;var r=null;var b=null;var g=null;var c=null;var t=null;var o=null;function j(F){var E="";if(!f.is(F)||F.length<1){return F}var G=F.length-1;if(F.substr(G)==="/"){E=F.substr(0,G)}else{return F}return E}function q(E,G){var F={};if(f.is(h)&&h.length>0){F={provider:"FILE",filename:h,}}else{if(f.is(E.productId)){if(!E.requiredAuth){E.requiredAuth="passport"}F={provider:"EV6",dtype:"VPMReference",requiredAuth:E.requiredAuth,serverurl:j(E.serverURL),physicalid:E.productId}}else{if(f.is(E.systemPLMID)){if(G){F={provider:"EV6",dtype:"VPMReference",requiredAuth:E.requiredAuth,serverurl:j(E.serverURL),physicalid:""}}else{if(!E.requiredAuth){E.requiredAuth="passport"}F={provider:"FILE",filename:"",}}}}}return F}var z=(function(){var K;function M(){var Z=x.onRemove(function(aa){if(aa.pathElement!==undefined){N(aa,"remove")}});l.push(Z);Z=x.onPostAdd(function(ab){var aa=0;if(!Array.isArray(ab)){ab=[ab]}if(ab.length>0){for(aa=0;aa<ab.length;aa++){if(ab[aa].pathElement!==undefined){N(ab[aa],"add")}}}});l.push(Z)}function H(Z){var aa="";if(h.length>0){aa=h.substring(0,h.lastIndexOf("."))}else{if(Z.length>0){aa=Z}}return aa+"_mapping.xml"}function X(aa,ah,ai){var af=this;var ab=null;g=new C.EventDispatcher();this.container=aa;this.serverURL=ai.serverURL;this.securityContext=ai.securityContext;if(f.is(ai.systemPLMID)){this.systemPLMID=ai.systemPLMID}else{this.systemPLMID=null}if(f.is(ai.systemRefName)){this.systemRefName=ai.systemRefName}else{this.systemRefName=null}if(f.is(ai.systemRevision)){this.systemRevision=ai.systemRevision}else{this.systemRevision=null}if(f.is(ai.mode)){if(ai.mode=="connected"){this.isConnectedMode=true}else{this.isConnectedMode=false}}else{if(f.is(ai.productId)&&ai.productId.length>0){this.isConnectedMode=true}else{this.isConnectedMode=false}}this.productId=ai.productId;h=ah;aa.style.zIndex=1;if(f.is(aa.parentElement)){aa.parentElement.style.zIndex=1}e.dispose();ai=ai||{};ai.height=ai.height||"700px";ai.fullScreen=true;ai.mode="review";ai.enableSelection=true;ai.loading="autoplay";if(ai.callback){this.addEventListener("ModelLoaded",ai.callback)}this.addEventListener("ModelLoaded",this.onAllLoadingComplete);ai.callbacks={asset:{LoadingFinished:function(aj){af.experience=af.player.getExperience();af.viewer=af.experience.frmWindow.getViewer();af.onModelLoaded()}},experience:{ExperienceReady:function(aj){experience=aj.frmWindow.experience}}};F(aa,ai.height);M();r=H(ai.systemRefName);ab=q(ai,this.isConnectedMode);if(ab.provider==="FILE"){if(h.length===0){var ad=function ad(aj){ab.filename=aj;af.player=I(ab,ai);o=af.player;af.lastAsset=af.systemPLMID};var ac={serverURL:ai.serverURL,securityContext:ai.securityContext,plmIdentifier:ai.systemPLMID,extendedStreamEnabled:false};t=new k(ac);t.get3DXmlFileURL(af.systemRefName+".3dxml",ad)}else{this.player=I(ab,ai);o=this.player;this.lastAsset=h}}else{if(ab.provider==="EV6"){h=null;var ac={serverURL:ai.serverURL,securityContext:ai.securityContext,plmIdentifier:ai.systemPLMID,extendedStreamEnabled:true};t=new k(ac);if(ab.physicalid.length>0){this.lastAsset=ai.productId;this.player=I(ab,ai);o=this.player}else{var ae=function ae(aj){if(!f.is(ai.systemPLMID)||ai.systemPLMID.length===0){t.plmIdentifier=aj.plmIdentifier;ai.systemPLMID=aj.plmIdentifier;af.systemPLMID=aj.plmIdentifier}ab.physicalid=aj.publishedProductId;af.player=I(ab,ai);o=af.player};var ag=function(){console.log("Error getting system for connected mode streaming.")};var Z="";if(f.is(ai.systemPLMID)&&ai.systemPLMID.length>0){Z=ai.serverURL+"resources/upr/wip/shoporder?PLMIDENTIFIER="+encodeURIComponent(ai.systemPLMID)}else{if(f.is(ai.systemRevision)&&ai.systemRevision.length>0){Z=ai.serverURL+"resources/upr/wip/shoporder?PLMEXTERNALID="+encodeURIComponent(ai.systemRefName)+"&REVISION="+encodeURIComponent(ai.systemRevision)}}t.callServerRequest(Z,ae,ag,"json","GET","",ai.securityContext)}}}window.addEventListener("SCENARIOCHANGE",af.onScenarioChange);window.addEventListener("SCENARIOSTOP",af.onScenarioStop);window.addEventListener("SELECTMODECHANGE",af.onSelectModeChangeChanged);window.addEventListener("DELMOMVIEWSELECTED",af.onViewSelected)}function I(ae,aa){var ad=null;var Z=document.getElementById("wki3dplayer");Z.style.height=aa.height;var ac=aa;ac.serverURL=j(aa.serverURL);if(f.is(aa.serverURL)){ad=[{platformId:"delmomwki","3DSpace":ac.serverURL}]}aa.platformServices=ad;var ab=new w({container:Z,input:{experience:{provider:"FILE",filename:"DS/DELMOMWKIExperience/DELMOMWKIExperience"},asset:ae},options:ac,platformServices:ad});return ab}function F(ab,Z){var aa=document.createElement("div");aa.id="wki3dplayer";aa.className="wki3dplayer";aa.style.height=Z;ab.appendChild(aa);var ac=document.createElement("div");ac.className="clearfix";ab.appendChild(ac)}function V(aa,ad,ac){var ab=function ab(ae){var af={provider:"FILE",filename:ae,};aa.loadAsset(af,{clearSceneGraph:true});_this.lastAsset=ad};var Z={serverURL:_this.serverURL,securityContext:_this.securityContext,plmIdentifier:_this.systemPLMID};t.get3DXmlFileURL(ac+".3dxml",ab)}function Y(ab,Z){var aa;if(f.is(Z)&&Z.length>0){h=Z;aa={provider:"FILE",filename:Z,proxyurl:"none",requiredAuth:null,serverurl:""};r=Z.substring(0,Z.lastIndexOf("."))+"_mapping.xml";ab.loadAsset(aa,{clearSceneGraph:true})}}function Q(ac,aa,Z){Z=Z||{};if(f.is(aa)){h=null;if(!Z.serverURL){Z.serverURL=""}if(!Z.requiredAuth){Z.requiredAuth="passport"}var ab={provider:"EV6",dtype:"VPMReference",requiredAuth:Z.requiredAuth,serverurl:j(Z.serverURL),physicalid:aa};ac.loadAsset(ab,{clearSceneGraph:true});r=Z.systemMapFile}}function N(aa,ab){var Z=T(aa);if(!Z.instancePath){return}Z.action=ab;Z.pathElement=aa.pathElement;g.fireEvent("PartSelected",Z)}function P(Z){var ac=Z.pathElement;var ab="";while(ac!==undefined&&ac!==null){var aa=ac.getLastElement(true);if(aa.getPersistentId!==undefined){if(aa.productType=="Instance3D"||aa.getPersistentId()==1){if(ab.length!==0){ab="/"+ab}ab=aa.getPersistentId()+ab}}ac=ac.getParentOccurrencePath()}return ab}function T(af){var ad=false;var ab=new A();var ae=af.pathElement.externalPath;if(f.is(h)){for(var ac=ae.length-1;ac>=0;ac--){var Z=ae[ac];if((f.is(Z.productType))&&(Z.productType==="InstanceRep")||(f.is(Z.worktype))&&(Z.worktype==="InstanceRep")){ad=true;ab.instancePath=P(af)+"/"+Z.persistentId;var aa=Z.name.split(".");ab.modelPartID=aa[0];ab.revision=aa[1];break}}if(!ad){for(var ac=ae.length-1;ac>=0;ac--){var Z=ae[ac];if((Z.productType!==undefined)&&(Z.productType==="Instance3D")||(f.is(Z.worktype))&&(Z.worktype==="Instance3D")){ab.instancePath=P(af);ab.modelPartID=Z.name;ab.revision="0";break}}}}else{ab.modelPartID="";ab.instancePath="";for(var ac=ae.length-1;ac>=0;ac--){var Z=ae[ac];if((Z.worktype!==undefined)&&(Z.worktype==="VPMInstance")){ab.instancePath=Z.id;ab.modelPartID=Z.children[0].title;if(f.is(ae[ac-2])){Z=ae[ac-2];if((Z.worktype!==undefined)&&(Z.worktype==="VPMInstance")){ab.instancePath=Z.id}}break}}}return ab}function E(){var aa;c=e.getCurrentScenario();var ab=e.getAllScenarios();for(var Z=0;Z<ab.length;Z++){aa=ab[Z];aa.scenario.clean()}}function O(ad,ab,aa,ae){var Z="";if(f.is(h)&&h.length>0){Z=h.substring(0,h.lastIndexOf("/"))}else{if(f.is(t)){Z=null}else{Z=r.substring(0,r.lastIndexOf("/"))}}var ac=e.getCurrentScenario().scenario;ac.loadScreen(ad,ab,b,Z,t,ae)}function G(){var Z;if(window.XMLHttpRequest){Z=new XMLHttpRequest()}else{Z=new ActiveXObject("Microsoft.XMLHTTP")}return Z}function S(aa,af,ae){if(!f.is(r)){console.log("No system Map");return}if((f.is(af)&&af.length>0)||!f.is(aa.productId)){if(f.is(aa.systemPLMID)&&aa.systemPLMID.length>0){var ab=function ab(ah){if(f.is(ah)){var aj=new DOMParser();var ag=aj.parseFromString(ah,"text/xml");var ai=new y();b=ai.xmlToJson(ag)}ae()};t.getFile(r,ab)}else{var Z=G();var ac=this;Z.onreadystatechange=function(){if(Z.readyState==4&&Z.status==200){var ag=new y();b=ag.xmlToJson(Z.responseXML);ae()}};Z.open("GET",r,true);Z.send()}}else{if(aa.systemPLMID.length>0&&f.is(aa.productId)){var ad=function(ah){if(f.is(ah)){var aj=new DOMParser();var ag=aj.parseFromString(ah,"text/xml");var ai=new y();b=ai.xmlToJson(ag)}ae()};var ab=function ab(ag){if(f.is(ag)){ad(ag)}else{t.getFileFromMainStream(r,ad)}};t.getFileFromExtendedStream(r,ab)}}}function J(Z){if(m){m.setMapFileJson(Z)}else{m.init(Z)}}function L(ac){var aa=ac.getCtx();var Z=a.getCommand("MultiSelect",aa);Z.beginExecute();var ab=document.querySelector("div[data-command=MultiSelect]");ab.className+=" wux-ui-state-active"}function U(ac){var aa=ac.getCtx();var Z=a.getCommand("MultiSelect",aa);Z.endExecute();var ab=document.querySelector("div[data-command=MultiSelect]");ab.classList.remove("wux-ui-state-active")}function R(Z){if(Z.keyCode===s.CTRL){L(o)}}function W(Z){if(Z.keyCode===s.CTRL){U(o)}}X.prototype.resize=function(){};X.prototype.loadOperByInstName=function(Z,aa){O(Z,"InstanceName",this.player,aa)};X.prototype.loadOperByid=function(Z,aa){O(Z,"id",this.player,aa)};X.prototype.loadOperByRefName=function(aa,Z){O(aa,"ReferenceName",this.player,Z)};X.prototype.onAllLoadingComplete=function(aa){if(f.is(b)){J(b);var Z=aa.getExperience();Z.hideAllFtaReq();Z.displayLoadedProductsOnly()}};X.prototype.onModelLoaded=function(){var ab=this;this.viewer=this.player.getExperience().frmWindow.getViewer();document.addEventListener("keydown",R);document.addEventListener("keyup",W);if(e._currentID&&(e._currentID.registerID==e._defaultRegisterID)){e.changeScenario(e._currentID.registerID,e._currentID.scenarioID)}else{var aa=e.getAllScenarioForRegister(e._defaultRegisterID);if(c){for(var Z=0;Z<aa.length;Z++){if(aa[Z].scenario.description==c.scenario.description){e.changeScenario(e._defaultRegisterID,aa[Z].scenarioID);break}}}else{e.changeScenario(e._defaultRegisterID,aa[0].scenarioID)}}S(this,h,function(){g.fireEvent("ModelLoaded",ab.player)})};X.prototype.initialize=function(){};X.prototype.enableMultiSelect=function(){L(this.player)};X.prototype.disableMultiSelect=function(){U(this.player)};X.prototype.GetCurrentScenario=function(){c=e.getCurrentScenario();if(f.is(c)&&f.is(c.scenario)){return c.scenario.title}else{return""}};X.prototype.ChangeScenario=function(ac){c=e.getCurrentScenario();if(c.scenario.title!==ac){var ab=e.getAllScenarios();for(var Z=0;Z<ab.length;Z++){var aa=ab[Z];if(aa.scenario.title===ac){e.changeScenario(e._currentID.registerID,aa.scenarioID);break}}}this.currentScenario=e.getCurrentScenario()};X.prototype.onViewSelected=function(Z){g.fireEvent("ViewSelected",Z.detail)};X.prototype.onSelectModeChangeChanged=function(Z){g.fireEvent("SelectModeChange",Z.detail.SelectMode)};X.prototype.resetViewer=function(){if(!f.is(e._currentID)){return}var Z=e.getCurrentScenario();if(Z){Z.scenario.resetSceneGraph()}};X.prototype.GetAllScenarios=function(){var Z=e.getAllScenarios();return Z};X.prototype.dispose=function(){if(f.is(e.getExperience())){e.getExperience().resetSceneGraphOverrides()}E();e.dispose();var aa=0;for(;aa<l.length;aa++){x.unsubscribe(l[aa])}window.removeEventListener("SCENARIOCHANGE",this.onScenarioChange);window.removeEventListener("SCENARIOSTOP",this.onScenarioStop);window.removeEventListener("SELECTMODECHANGE",this.onSelectModeChangeChanged);window.removeEventListener("DELMOMVIEWSELECTED",this.onViewSelected);delete window.onresize;document.removeEventListener("keydown",R);document.removeEventListener("keyup",W);o=null;if(f.is(this.player)){if(f.is(this.player.dispose)){this.experience=null;this.viewer=null;this.player.dispose()}this.player=null;var Z=this.container.childNodes[0];while(f.is(Z)){Z.parentNode.removeChild(Z);Z=this.container.childNodes[0]}this.container=null}if(f.is(t)){t.dispose();t=null}};X.prototype.ResetScenarios=function(){E();e.dispose()};X.prototype.onScenarioChange=function(Z){g.fireEvent("ScenarioChange",Z)};X.prototype.onScenarioStop=function(Z){g.fireEvent("ScenarioStop",Z)};X.prototype.addEventListener=function(Z,ab,aa){g.addEventListener(Z,ab,aa)};X.prototype.fireEvent=function(aa,Z){g.fireEvent(aa,Z)};X.prototype.removeSelectionCB=function(Z){this.player.removeSelectionCB(Z)};X.prototype.addSelectionCB=function(Z){this.player.addSelectionCB(Z)};X.prototype.setNodeVisibility=function(ab,Z){var aa=new v(this.viewer,this.experience);aa.setPartPathVisibility(ab,Z)};X.prototype.selectNode=function(Z){this.player.selectNode(Z)};X.prototype.unselectNode=function(Z){this.player.unselectNode(Z)};X.prototype.emptySelection=function(){this.player.emptySelection()};X.prototype.loadFileFromStream=function(aa,Z){V(this.player,aa,Z);this.lastAsset=aa};X.prototype.loadFile=function(Z){Y(this.player,Z);this.lastAsset=Z};X.prototype.loadProduct=function(aa,Z){Q(this.player,aa,Z);this.lastAsset=aa};X.prototype.getHighlightPaths=function(Z){J(b);return m.getHighlightPathsByRefTitle(Z)};X.prototype.getTitleFromMappingFile=function(Z){J(b);return m.getRefTitle(Z)};X.prototype.getHighlightPathsByValues=function(aa,Z){J(b);return m.getHighlightPathsByValues(aa,Z)};X.prototype.getObjectPathsByReferenceOrInstanceName=function(aa,Z){return this.getHighlightPathsByValues([aa,Z],["ReferenceName","InstanceName"])};X.prototype.getObjectPathsByReferenceAndInstanceName=function(aa,Z){J(b);return m.getHighlightPathsHavingAllValues([aa,Z],["ReferenceName","InstanceName"])};X.prototype.getObjectPathsByReferenceName=function(Z){return this.getHighlightPathsByValues([Z],["ReferenceName"])};X.prototype.getObjectPathsByInstanceName=function(Z){return this.getHighlightPathsByValues([Z],["InstanceName"])};X.prototype.highlightByValues=function(ab,aa){var Z=null;var ac=this.getHighlightPathsByValues(ab,aa);for(Z=0;Z<ac.length;Z++){this.selectNode(ac[Z])}};X.prototype.highlightByReferenceName=function(Z){this.highlightByValues([Z],["ReferenceName"])};X.prototype.highlightByInstanceName=function(Z){this.highlightByValues([Z],["InstanceName"])};X.prototype.highlightByReferenceAndInstanceName=function(ac,Z){var aa=null;var ab=this.getHighlightPathsByValues([ac,Z],["ReferenceName","InstanceName"]);J(b);var ab=m.getHighlightPathsHavingAllValues([ac,Z],["ReferenceName","InstanceName"]);for(aa=0;aa<ab.length;aa++){this.selectNode(ab[aa])}};X.prototype.setObjectsColor=function(ae,ac,ab,Z){J(b);var aa=new B.Color();aa.setRGB(parseInt(ac)/255,parseInt(ab)/255,parseInt(Z)/255);var ad=new v(this.viewer,this.experience);ad.setPartPathColor(ae,aa)};X.prototype.resetObjectsColor=function(aa){J(b);var Z=new v(this.viewer,this.experience);Z.clearColorOverridesByPaths(aa)};X.prototype.setObjectOpacity=function(ab,Z){J(b);var aa=new v(this.viewer,this.experience);aa.setPartPathOpacity(ab,parseInt(Z)/255);this.viewer.render()};X.prototype.setObjectsColorLargeModel=function(ab,ad,ac,Z){J(b);var aa=new B.Color();aa.setRGB(parseInt(ad)/255,parseInt(ac)/255,parseInt(Z)/255);var ae=new v(this.viewer,this.experience);ae.setPartColorMultipleParts(ab,aa)};X.prototype.resetObjectsColorLargeModel=function(Z){J(b);var aa=new v(this.viewer,this.experience);aa.clearColorOverridesMultiParts(Z)};X.prototype.getInstanceNameFromMappingFile=function(Z){J(b);return m.getInstanceNameByHighlightPath(Z)};X.prototype.reframeOn=function(ab){var aa=new v(this.viewer,this.experience);var Z={};Z.paths=[aa.getPathFromId(ab)];Z.viewpoint=this.viewer.viewpoints[0];J(b);var aa=new v(this.viewer,this.experience);aa.reframeOn(Z)};return X}());D.WKI3DPlayer=z});define("DS/DELMOMWKIExperience/DELMOMWKIExperience",["DS/3DPlayDefaultExperience/3DPlayDefaultExperience","UWA/Core","DS/WebVisualization/WebVisualization","DS/Visualization/ThreeJS_DS","DS/DELMOMWKIExperience/js/PartsDisplay"],function(e,g,d,f,a){return e.extend({init:function(h){this._parent(h);if(this.isSpecTreeAllowed){this.isSpecTreeAllowed(false)}},onPreCreate:function(){this.args.visu={picking:false};if(this.args.options.enableSelection!==undefined&&this.args.options.enableSelection!==null){if(this.args.options.enableSelection===true||this.args.options.enableSelection==="true"){this.args.visu.picking=true;this.args.visu.displayPicking=true;this.args.visu.prePicking=true;this.args.visu.displayprePicking=true}}var h=this;this.args.ui={}},onPostCreate:function(){var h=this.frmWindow.getViewer();h.setVisuEnv("None");h.setRenderMode("@Edge",false);h.setRenderMode("@Point",false)},hideAllFtaReq:function c(){var h=new a(this.frmWindow.getViewer(),this,"DELMOMInitialFTA");h.hideAllFtaReq()},displayLoadedProductsOnly:function b(i){var h=new a(this.frmWindow.getViewer(),this,"DELMOMInitialLoad");h.applyLoadedProducts()},resetSceneGraphOverrides:function(){var j=function j(l){var m=l.getOverridesFromPathElement(i);if(m){m.forEach(function(n){n.getPathes().forEach(function(o){l.setVisibility(o,null)});if(n.getPosition()){n.getPathes().forEach(function(o){l.setPosition(o,null)})}if(n.getMaterial()){n.setMaterial(null)}if(n.getOpacity()){n.getPathes().forEach(function(o){l.setOpacity(o,null)})}})}};var k=this.frmWindow.getViewer();var i=this.getRootBag();var h=k.getSceneGraph("ViewsSG");if(g.is(h)){j(h);h.dispose()}h=k.getSceneGraph("AfterViewsSG");if(g.is(h)){j(h);h.dispose()}h=k.getSceneGraph("DELMOMInitialLoad");if(g.is(h)){j(h);h.dispose()}h=k.getSceneGraph("DELMOMInitialFTA");if(g.is(h)){j(h);h.dispose()}k.render()}})});define("DS/DELMOMWKIExperience/js/WkiStreamData",["UWA/Core","UWA/Class","DS/DELMOMWKIExperience/js/ParserUtility"],function(e,b,c){var a=null;var d=b.extend({init:function(f){this.dataType="stream";a=f.streamUtil;this.dmuJson=null;this.indexJson=null;this.viewInfoJson=null;this.wkiContentJson=null;this.numFilesToLoad=0;return this},loadData:function(h,l,k){this.onLoadDataEnd=l;this.onNothingLoaded=k;var g=this;this.numFilesToLoad=0;var f=null;var j=null;var m=null;var i=h.substr(0,h.indexOf("_index.xml"));f=i+"_DMU.json";this.numFilesToLoad++;j=i+"_WKIViewInfo.json";this.numFilesToLoad++;m=i+"_WKIContent.json";this.numFilesToLoad++;this.loadDmuJsonFile(f);this.loadViewInfoJsonFile(j);this.loadWKIContentJsonFile(m)},onLoadDataEnd:function(f){},onGetFileComplete:function(){this.numFilesToLoad--;if(this.numFilesToLoad===0){if(e.is(this.dmuJson)||e.is(this.viewInfoJson)){this.onLoadDataEnd(this)}else{this.onNothingLoaded(this)}}},loadDmuJsonFile:function(f){var g=this;var h=function(i){if(e.is(i)&&i.length>0){g.dmuJson=JSON.parse(i)}else{g.dmuJson=null}g.onGetFileComplete()};a.getFile(f,h)},loadViewInfoJsonFile:function(f){var g=this;var h=function(i){if(e.is(i)&&i.length>0){g.viewInfoJson=JSON.parse(i)}else{g.viewInfoJson=null}g.onGetFileComplete()};a.getFile(f,h)},loadWKIContentJsonFile:function(f){var g=this;var h=function(i){if(e.is(i)&&i.length>0){g.wkiContentJson=JSON.parse(i)}else{g.wkiContentJson=null}g.onGetFileComplete()};a.getFile(f,h)}});return d});define("DS/DELMOMWKIExperience/js/LocalBuildUp",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/DELMOMWKIExperience/js/MappingFileParser","DS/DELMOMWKIExperience/js/PartsDisplay","DS/DELMOMWKIExperience/js/FTAHelper"],function(a,l,g,e,m){var h={CURRENT:"Current",PARALLEL:"Parallel",PREVIOUS:"PreviousInSystem",PREVIOUS_SYSTEM:"PreviousFromPreviousSystem",CONTEXT:"Context",RESOURCE:"Resource",RESOURCE_ALL:"ResourceAll",FTA_REQ:"FtaReq",ADDITIONAL_PRODUCT:"AdditionalProducts",DISASSEMBLED:"Disassembled"};var j={PART:1,RESOURCE:2,FTA_REQ:3,PRODUCT:4};var i=a.extend({init:function(n){this.experience=n.experience;this.viewer=n.viewer;this.json=n.viewInfoJson;this.operIdName=n.operIdName;this.operIdValue=n.operIdValue;this.viewName=n.viewName;this.sceneGraphName="ViewsSG"},getCurrentViewInfo:function k(){var o=this.viewName;var n=this.json.DELWKIPublishToJSONWKIViewInfoRoot.Operation.Views;var p=n.filter(function(q){return q.Name===o})[0];return p},getDisplayOption:function f(n,q){var o=h[n.buildupDisplayMode];switch(o){case h.FTA_REQ:var p=q.BuildUpSettings.GeneralOptions.WithFTA;if(p==="TRUE"){displayOption={IsDisplayed:p}}else{return}break;case h.RESOURCE:case h.RESOURCE_ALL:displayOption=q.BuildUpSettings.DisplayOptions[h.RESOURCE];break;case h.DISASSEMBLED:displayOption=q.BuildUpSettings.DisplayOptions[h.DISASSEMBLED];break;default:displayOption=q.BuildUpSettings.DisplayOptions[o];break}return displayOption},applyResourceBuildup:function d(q,p,n,o){if(n.IsDisplayed==="FALSE"){o.setVisibility(p,false);return}if(n.Filter==="All"){o.setVisibility(p,true)}else{if(n.Filter==="OnlyAssignedResources"&&q.buildupDisplayMode==="RESOURCE"){o.setVisibility(p,true)}else{o.setVisibility(p,false)}}},applyPartBuildup:function c(s,r,o,u,p,q){if(o.IsDisplayed==="FALSE"){p.setVisibility(r,false);return}p.setVisibility(r,true);if(o.WithTransparency==="TRUE"){p.setOpacity(r,parseInt(o.TransparencyCoefficient)/255)}else{p.setOpacity(r,null)}if(u.BuildUpSettings.ColorOptions.WithColor==="TRUE"&&o.WithColor==="TRUE"){var t=h[s.buildupDisplayMode];color=u.BuildUpSettings.ColorOptions["Color"+t];newColor=new l.Color();newColor.setRGB(parseInt(color.R)/255,parseInt(color.G)/255,parseInt(color.B)/255);q.setPartPathElementColor(r,p,newColor)}else{q.removePartPathColor(r)}var n=new m();if(g.isConnectedMode){this.loadFTAForPart(s,u,null,n,r)}},apply:function(){var u=this;var s=0,o=null,C=null,r=null,x=null,w=null,A=null,n=null;var v=[];var q=[];var t=new e(this.viewer,this.experience);var D=this.viewer.createSceneGraph(this.sceneGraphName,this.experience.getRootBag());var y=this.getCurrentViewInfo();var z=g.getPartsForOperation(this.operIdValue,this.operIdName,true);if(g.isConnectedMode){z.forEach(function(E){var F=E.physicalId;q.push(F)})}else{z.forEach(function(E){var F=E.persistentId;q.push(F)})}var p=null;if(g.isConnectedMode){p="id"}else{p="persistentId"}var B=function(H){if(H.length>0){var F;for(F=0;F<H.length;F++){var E=H[F].getLastElement();var I=E[p];if(UWA.is(I)){w=H[F];C=q.indexOf(I);if(C>-1){o=z[C];if(!UWA.is(o.buildupDisplayMode)){continue}A=u.getDisplayOption(o,y);if(!UWA.is(A)){continue}switch(o.type){case j.PRODUCT:case j.PART:u.applyPartBuildup(o,w,A,y,D,t);break;case j.RESOURCE:u.applyResourceBuildup(o,w,A,D);break;case j.FTA_REQ:D.setVisibility(w,true);break;default:break}}}var G=H[F].getChildrenOccurrencePathes();if(G!==undefined&&G!==null){B(G)}}}};B([t.getRootPathElement(u.experience)]);this.viewer.render()},applyFtaReqGlobalHide:function b(){var q=this.getCurrentViewInfo();var p=q.BuildUpSettings.GeneralOptions.WithFTA;if(p==="TRUE"){return}var n=new e(this.viewer,this.experience,"AfterViewsSG");var o=g.getPartsForOperation(this.operIdValue,this.operIdName,true);o.forEach(function(r){if(r.type===j.FTA_REQ){n.setPartVisibility(r,false)}})},loadFTAForPart:function(r,q,p,n,o){var t=null;if(UWA.is(o)){t=o}else{t=p.getPartPathElement(r)}var s=q.FTAPerMfgItem;if(!UWA.is(s)||s.length<1){return}var u=s.filter(function(v){return v.ProxyProductRef===r.id})[0];if(UWA.is(u)){n.loadFTA(t,true,true)}}});return i});define("DS/DELMOMWKIExperience/ProductBuildupScenario",["DS/3DPlay/PlayScenario3D","DS/WebappsUtils/WebappsUtils","DS/DELMOMWKIExperience/js/PartsDisplay","DS/DELMOMWKIExperience/js/MappingFileParser"],function(j,b,a,f){var i;var e;var g;var h;var k;var d=0;var c=j.extend({init:function(l){this._parent(l);this.Experience=l.scenarioManager.getExperience()},launch:function(){this.loadWorkbench({module:"DELMOMWKIExperience",name:"ProductBuildupScenario"},true);setTimeout(function(){var l=document.createEvent("CustomEvent");l.initCustomEvent("SCENARIOCHANGE",false,false,{scenario:{title:"ProductBuildupScenario"}});window.dispatchEvent(l)},200)},stop:function(){var l=document.createEvent("CustomEvent");l.initCustomEvent("SCENARIOSTOP",false,false,{scenario:{title:"ProductBuildupScenario"}});window.dispatchEvent(l);this.resetSceneGraph()},loadScreen:function(p,o,n,l){if(n){if(f){f.setMapFileJson(n)}else{f.init(n)}var m=new a(this.Experience.frmWindow.getViewer(),this.Experience);m.showPartsForOperation(p,o,true)}else{console.log("Map file JSON missing")}},resetSceneGraph:function(){this.Experience.resetSceneGraphOverrides()},clean:function(){}});return c});define("DS/DELMOMWKIExperience/js/WkiData",["UWA/Class","DS/DELMOMWKIExperience/js/ParserUtility"],function(a,b){var f=a.extend({init:function(g){this.dataType="file";this.dmuJson=null;this.indexJson=null;this.viewInfoJson=null;this.wkiContentJson=null;this.numFilesToLoad=0;return this},loadData:function(h,k){this.onLoadDataEnd=k;var i=h.substr(0,h.indexOf("_index.xml"));var g=i+"_DMU.json";this.numFilesToLoad++;var j=i+"_WKIViewInfo.json";this.numFilesToLoad++;var l=i+"_WKIContent.json";this.numFilesToLoad++;this.loadDmuJsonFile(g);this.loadViewInfoJsonFile(j);this.loadWKIContentJsonFile(l)},onLoadDataEnd:function(){},onGetFileComplete:function(){this.numFilesToLoad--;if(this.numFilesToLoad===0){this.onLoadDataEnd(this)}},loadDmuJsonFile:function(g){var j=this;var i=function(k){j.dmuJson=k;j.onGetFileComplete()};var h=function(k){j.onGetFileComplete()};e(g,"json",i,h)},loadViewInfoJsonFile:function(g){var j=this;var i=function(k){j.viewInfoJson=k;j.onGetFileComplete()};var h=function(k){j.onGetFileComplete()};e(g,"json",i,h)},loadWKIContentJsonFile:function(g){var j=this;var i=function(k){j.wkiContentJson=k;j.onGetFileComplete()};var h=function(k){j.onGetFileComplete()};e(g,"json",i,h)}});function e(j,g,k,i){var h=d();var l=function(){if(this.readyState===4){switch(this.status){case 200:var m=null;if(g==="xml"){m=this.responseXML}else{m=JSON.parse(this.responseText)}k(m);break;case 404:default:i(this.status);break}}};h.onreadystatechange=l;h.open("GET",j,true);h.send()}function d(){var g;if(window.XMLHttpRequest){g=new XMLHttpRequest()}else{g=new ActiveXObject("Microsoft.XMLHTTP")}return g}function c(l,j){var h=0;var k=new b();var g=k.GetObjectArray(l.RootEle.file);for(h=0;h<g.length;h++){if(g[h].attributes.type===j){return g[h]}}return null}return f});define("DS/DELMOMWKIExperience/js/WkiDataManager",["UWA/Core","UWA/Class","DS/DELMOMWKIExperience/js/ParserUtility","DS/DELMOMWKIExperience/js/WkiData","DS/DELMOMWKIExperience/js/WkiStreamData","DS/DELMOMWKIExperience/js/WkiStreamUtil"],function(h,c,e,f,d,g){var b=null;var a=c.extend({init:function(i){this.dmuJson=null;this.indexJson=null;this.viewInfoJson=null;this.wkiContentJson=null;this.options=i;if(h.is(i.streamUtil)){b=new d(i)}else{b=new f(i)}return this},loadData:function(k,l){var m=this;var i=function i(){m.dmuJson=b.dmuJson;m.indexJson=b.indexJson;m.viewInfoJson=b.viewInfoJson;m.wkiContentJson=b.wkiContentJson;l(m)};var j=function j(){if(b.dataType==="stream"){if(!h.is(m.options.operPLMID)){l(m);return}var n=m.options.streamUtil;var p={serverURL:n.serverURL,securityContext:n.securityContext,plmIdentifier:m.options.operPLMID};var o=new g(p);b=new d({streamUtil:o});b.loadData(k,l,l)}};b.loadData(k,i,j)}});return a});define("DS/DELMOMWKIExperience/WorkInstructionScenario",["UWA/Core","DS/3DPlay/PlayScenario3D","DS/WebappsUtils/WebappsUtils","DS/WebUtils/StringUtils","DS/DELMOMWKIExperience/js/MappingFileParser","DS/DELMOMWKIExperience/js/PartsDisplay","DS/DELMOMWKIExperience/js/WkiDataManager","DS/DELMOMWKIExperience/js/LocalBuildUp","DS/DELMOMWKIExperience/js/FTAHelper","DS/DELMOMWKIExperience/js/WkiStreamUtil","DS/DELMOMViewComponents/DELDmuImporterAPI","i18n!DS/DELMOMWKIExperience/assets/nls/DELMOMWKIExperience",],function(d,m,c,u,j,o,n,q,f,i,a,t){var e,g;var b=0;function h(v){if(d.is(j)){j.setMapFileJson(v)}else{j.init(v)}}function r(x,y){var z=null;if(x==="ReferenceName"){return y}else{var v=j.getOper(y,x);if(d.is(v)){if(v.InstancePath.Instance.constructor===Array){var w=v.InstancePath.Instance.length-1;z=v.InstancePath.Instance[w].attributes.ReferenceName}else{z=v.InstancePath.Instance.attributes.ReferenceName}}else{return null}}return z}function l(G,E){var B=0,A=0,y=0;var w=null;var x=G.avpJson;var D={},z=null;var H=null,v=null,F="";if(!d.is(x.Model[0].WKIObjects)){return}x=x.Model[0].WKIObjects;for(B;B<x.length;B+=1){if(d.is(x[B].entities)){A=0;for(A;A<x[B].entities.length;A+=1){if(j.isConnectedMode){w=j.getProxyInstanceId(x[B].entities[A].identifier)}else{w=x[B].entities[A].identifier}if(d.is(w)){x[B].entities[A].proxyId=w;D[x[B].entities[A].id]=x[B].entities[A]}}if(d.is(x[B].occurrences)){var C=new o(null,E);A=0;for(A;A<x[B].occurrences.length;A+=1){H=x[B].occurrences[A].path;y=0;F="";for(y;y<H.length;y+=1){z=D[H[y]];if(d.is(z)&&d.is(z.proxyId)){F=z.proxyId}}if(F.length>0){v=C.getPathFromId(F);x[B].occurrences[A].pathElement=v}}}}}}function s(A,y,v,z){var x={json:A.dmuJson,avpJson:A.wkiContentJson};if(d.is(A.wkiContentJson)){l(x,y.Experience)}var w={context:y.Experience.pad3DViewer,frameWindow:y.Experience.frmWindow,bDisplayNominal:false,bDisplayInWork:false,thumbnailListTitle:t.ViewsLbl,activateSlide:false,beforeApplySlideCB:function(C,B){y.beforeApplySlide(C,B,y.Experience.frmWindow.getViewer(),A.viewInfoJson,v,z)},afterApplySlideCB:function(C,B){y.afterApplySlideCB(C,B,y.Experience.frmWindow.getViewer(),A.viewInfoJson,v,z)}};if(d.is(y.dmuImporter)){y.clean()}y.dmuImporter=new a(w);y.dmuImporter.importModel(x)}var k=m.extend({init:function(v){this._parent(v);this.Experience=v.scenarioManager.getExperience()},launch:function(){if(b>0){this.loadWorkbench({module:"DELMOMWKIExperience",name:"WorkInstructionScenario"},true);setTimeout(function(){var v=document.createEvent("CustomEvent");v.initCustomEvent("SCENARIOCHANGE",false,false,{scenario:{title:"WorkInstructionScenario"}});window.dispatchEvent(v)},200)}else{b++}},stop:function(){var v=document.createEvent("CustomEvent");v.initCustomEvent("SCENARIOSTOP",false,false,{scenario:{title:"WorkInstructionScenario"}});window.dispatchEvent(v);this.resetSceneGraph()},afterApplySlideCB:function(z,y,x,w,B,C){if(!d.is(y)){return}if(!(d.is(z)||d.is(y))){return}if(d.is(w)){var D={viewer:x,viewInfoJson:w,operIdName:B,operIdValue:C,viewName:y.name,experience:this.Experience};var A=new q(D);A.applyFtaReqGlobalHide();x.render()}var v=document.createEvent("CustomEvent");v.initCustomEvent("DELMOMVIEWSELECTED",false,false,{viewName:y._sName});window.dispatchEvent(v)},beforeApplySlide:function(D,z,y,x,G,H){var F=this;var E=false;if(!d.is(z)||D==z){return}var C=new o(y,this.Experience);if(d.is(D)){C.clearColorOverrides()}else{E=true}var w=new f();w.hideFTA();var v=y.getSceneGraphOverrideSetManager();var B=y.createSceneGraph("AfterViewsSG",F.Experience.getRootBag());v.removeSceneGraphOverrideSet(B.SceneGraphOverrideSet);C.showPartsForOperation(H,G,E);if(d.is(x)){var I={viewer:y,viewInfoJson:x,operIdName:G,operIdValue:H,viewName:z.name,experience:this.Experience};var A=new q(I);A.apply()}},clearDmuImporter:function(v){if(d.is(v.dmuImporter)){v.dmuImporter.removeModel();v.dmuImporter=null}},loadScreen:function(F,C,v,A,z,w){var y=this;if(!d.is(v)){return}h(v);var E=r(C,F);if(!d.is(E)){console.log("operation: "+F+" doesn't exist in mapping file");return}var D=function(I){var H=new o(y.Experience.frmWindow.getViewer(),y.Experience);y.Experience.frmWindow.getViewer().createSceneGraph("ViewsSG",y.Experience.getRootBag());if(d.is(I.dmuJson)){s(I,y,C,F)}else{y.clearDmuImporter(y);var G=new f();G.hideFTA();H.showPartsForOperation(F,C,true)}};var B=p(A,E);var x=new n({streamUtil:z,operPLMID:w});x.loadData(B,D)},resetSceneGraph:function(){this.clean();this.scenarioManager.getExperience().resetSceneGraphOverrides()},clean:function(){var v=new f();v.destroy();this.clearDmuImporter(this)}});function p(v,y){var x="";var w=y.replace(/ /g,"_");if(d.is(v)&&v.length>0){x=v+"/"+w+"_index.xml"}else{x=w+"_index.xml"}return x}return k});define("DS/DELMOMWKIExperience/WKIExperienceRegister",["DS/3DPlay/3DPlayRegister","DS/DELMOMWKIExperience/ProductBuildupScenario","DS/DELMOMWKIExperience/WorkInstructionScenario","i18n!DS/DELMOMWKIExperience/assets/nls/DELMOMWKIExperience"],function(e,b,a,d){var c=e.extend({init:function(f){this._parent(f);this._scenarioTableID=[];this._initScenarios()},_initScenarios:function(){var f=this;f._scenarioTableID.push(f.scenarioManager.addScenario({registerID:f.registerID,scenario:a,available:true,name:"WorkInstruction"}));f._scenarioTableID.push(f.scenarioManager.addScenario({registerID:f.registerID,scenario:b,available:true,name:"ProductBuildup"}))},});return c});