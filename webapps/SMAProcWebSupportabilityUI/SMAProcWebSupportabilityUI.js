var __extends=(this&&this.__extends)||(function(){var a=Object.setPrototypeOf||({__proto__:[]} instanceof Array&&function(e,c){e.__proto__=c})||function(f,c){for(var e in c){if(c.hasOwnProperty(e)){f[e]=c[e]}}};return function(f,c){a(f,c);function e(){this.constructor=f}f.prototype=c===null?Object.create(c):(e.prototype=c.prototype,new e())}})();define("DS/SMAProcWebSupportabilityUI/cmp-supportability-diagnostics/cmp-supportability-loggables",["require","exports","DS/Controls/Button","DS/Controls/Expander","DS/Controls/ProgressBar","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/SMAProcWebSupportabilityUtils/monitoring/Monitor","DS/SMAProcSP/CustomElementsEs5Adapter"],function(b,c,g,i,a,h,f,e){var d=(function(k){__extends(j,k);function j(m,l){var n=k.call(this)||this;n.logs=m;n.monitors=l;n.initialized=false;return n}j.prototype.connectedCallback=function(){var y=this;if(this.initialized){return}this.innerHTML='\n            <style>\n                #download, #stop-btn, #record-time {\n                    display: inline-block;\n                }\n\n                #small-download {\n                    cursor: pointer;\n                    margin-bottom: 8px;\n                    display: inline-block;\n                }\n\n                #selectables > a {\n                    cursor: pointer;\n                }\n\n                #selectables {\n                    margin-bottom: 8px;\n                }\n                \n                #progress-holder {\n                    position: absolute;\n                    top: 0;\n                    bottom: 0;\n                    left: 0;\n                    right: 0;\n                    width: 100%;\n                    height: 100%;\n                    background: rgba(255, 255, 255, 0.86);\n                }\n\n                #progress {\n                    position: sticky;\n                    top: 50%;\n                }\n\n                #progress > * {\n                    margin-bottom: 8px;\n                }\n\n                #page {\n                    position: relative;\n                }\n            </style>\n            <div id="page">\n                <br>\n                <p><i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attention"></i> These logs contain potentially sensitive information, please select which to download.</p>\n                <a id="small-download"><i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"></i> Download</a>\n                <br>\n                <div id="selectables">\n                    <a id="select-btn">Select all</a>&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;\n                    <a id="deselect-btn">Deselect all</a>\n                </div>\n                <div id="loggables"></div>\n                <br>\n                <div id="download"></div>\n                <div id="support-monitors"></div>\n                <div id="progress-holder" class="hidden">\n                    <div id="progress"></div>\n                </div>\n            </div>\n            <div id="record-page" class="hidden">\n                <br>\n                <div id="stop-btn"></div>\n                <div id="record-time"></div>\n            </div>\n        ';var o=this.querySelector("#loggables");var t=this.querySelector("#download");var s=this.querySelector("#small-download");this.progressDiv=this.querySelector("#progress");this.progressHolderDiv=this.querySelector("#progress-holder");this.recordingPage=this.querySelector("#record-page");this.logSelectionPage=this.querySelector("#page");var v=[];var m=this.querySelector("#select-btn");var n=this.querySelector("#deselect-btn");m.addEventListener("click",function(){y.selectAll(v)});n.addEventListener("click",function(){y.deselectAll(v)});var p=new g({label:"Download",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},emphasize:"primary"});p.addEventListener("buttonclick",function(){y.download()});s.addEventListener("click",function(){y.download()});var C=this.logs.getLoggables();var u={};var B={};for(var l=0,r=C;l<r.length;l++){var z=r[l];var w=z.getCategory();var D=z.getName();var A=z.getDescription();if(!z.isSensitive()){continue}if(!(w in u)){var x=document.createElement("div");var q=new i({header:w,body:x,expandedFlag:true});B[w]=q;q.inject(o);q.visibleFlag=false;u[w]=x}z.isRunnable().then(function(G,I,H,F,J){var K=this;if(J){var E=new h({type:"checkbox",label:"<strong>"+G+(F instanceof e?" (scenario recording only)":"")+"</strong>",checkFlag:!this.logs.isBlacklisted(F)});if(H){E.tooltipInfos=new f({title:G,shortHelp:H})}v.push(E);B[I].visibleFlag=true;E.inject(u[I]);E.addEventListener("change",function(L){K.logs.setShouldDownload(F,E.checkFlag)})}}.bind(this,D,w,A,z))}p.inject(t);this.createDownloadUI();this.createMonitoringUI();this.createRecordingUI();this.initialized=true};j.prototype.selectAll=function(n){for(var o=0,m=n;o<m.length;o++){var l=m[o];l.checkFlag=true}};j.prototype.deselectAll=function(n){for(var o=0,m=n;o<m.length;o++){var l=m[o];l.checkFlag=false}};j.prototype.download=function(){var l=this;return new Promise(function(m){l.progressBar.visibleFlag=true;l.progressHolderDiv.classList.remove("hidden");l.cancelBtn.disabled=false;return l.logs.download(function(n){return l.progressBar.value=Math.floor(n)}).then(function(){l.progressBar.visibleFlag=false;l.progressHolderDiv.classList.add("hidden");l.progressBar.value=0;l.cancelBtn.disabled=false;l.dispatchEvent(new CustomEvent("downloaded"));m()})})};j.prototype.createDownloadUI=function(){var l=this;this.progressBar=new a({visibleFlag:false});this.progressBar.inject(this.progressDiv);this.cancelBtn=new g({label:"Cancel"});this.cancelBtn.inject(this.progressDiv);this.cancelBtn.addEventListener("buttonclick",function(){l.logs.cancelDownload();l.cancelBtn.disabled=true})};j.prototype.createRecordingUI=function(){var l=this.querySelector("#stop-btn");this.stopBtn=new g({label:"Stop recording",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-stop"}});this.stopBtn.inject(l)};j.prototype.createMonitoringUI=function(){var n=this;var l=this.querySelector("#support-monitors");if(this.monitors){var m=new g({label:"Record scenario",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-record"}});m.inject(l);m.addEventListener("buttonclick",function(){n.monitors.start().then(function(){var r=n.querySelector("#record-time");n.recordingPage.classList.remove("hidden");n.logSelectionPage.classList.add("hidden");var q=0;var p=setInterval(function(){q+=1;r.innerHTML=q+"s"},1000);var o=function(){var s=this;clearInterval(p);r.innerHTML="";this.recordingPage.classList.add("hidden");this.logSelectionPage.classList.remove("hidden");this.querySelector("#stop-btn").innerHTML="";this.createRecordingUI();this.download().then(function(){s.monitors.stop()})};n.stopBtn.addEventListener("buttonclick",o.bind(n))})})}else{l.classList.add("hidden")}};return j}(HTMLElement));window.customElements.define("cmp-supportability-loggables",d);return d});define("DS/SMAProcWebSupportabilityUI/FileDownloader",["require","exports"],function(b,a){var c=(function(){function d(){}d.downloadText=function(f,e){this.downloadURI("data:text/plain;charset=utf-8,"+encodeURIComponent(f),e)};d.downloadURI=function(g,f){var e=document.createElement("a");e.setAttribute("href",encodeURI(g));e.setAttribute("download",f);e.style.display="none";document.body.appendChild(e);e.click();document.body.removeChild(e)};d.downloadBlob=function(f,e){if(window.navigator.msSaveBlob){window.navigator.msSaveBlob(f,e)}else{var g=window.URL.createObjectURL(f);this.downloadURI(g,e);window.URL.revokeObjectURL(g)}};return d}());return c});define("DS/SMAProcWebSupportabilityUI/SMAProcWebSupportabilityUI",function(){return{}});var __extends=(this&&this.__extends)||(function(){var a=Object.setPrototypeOf||({__proto__:[]} instanceof Array&&function(e,c){e.__proto__=c})||function(f,c){for(var e in c){if(c.hasOwnProperty(e)){f[e]=c[e]}}};return function(f,c){a(f,c);function e(){this.constructor=f}f.prototype=c===null?Object.create(c):(e.prototype=c.prototype,new e())}})();define("DS/SMAProcWebSupportabilityUI/cmp-supportability-diagnostics/cmp-supportability-diagnostics",["require","exports","text!DS/SMAProcWebSupportabilityUI/cmp-supportability-diagnostics/cmp-supportability-diagnostics.html","DS/SMAProcWebSupportabilityUI/cmp-supportability-diagnostics/cmp-supportability-loggables","DS/Controls/Expander","DS/Controls/Button","DS/Controls/Tab","DS/SMAProcWebSupportabilityUtils/diagnostics/DiagnosticStatusCode","DS/SMAProcSP/CustomElementsEs5Adapter"],function(a,c,d,e,i,h,f,b){var g=(function(j){__extends(k,j);function k(l,n,m){var o=j.call(this)||this;o.diagnosticsRunner=l;o.logs=n;o.monitors=m;o.initialized=false;return o}k.prototype.connectedCallback=function(){if(this.initialized){return}var l=document.createElement("template");l.innerHTML=d;var m=document.importNode(l.content,true);this.innerHTML="";this.appendChild(m);this.createTabs();this.createDiagnosticsUI();this.createLogsUI();this.initialized=true};k.prototype.createTabs=function(){this.diagnosticContent=document.createElement("div");this.diagnosticContent.innerHTML="<br>";this.logContent=document.createElement("div");var l=new f({displayStyle:"strip"});l.add({label:"Diagnostics",isSelected:true,content:this.diagnosticContent});l.add({label:"Logs",content:this.logContent});l.inject(this)};k.prototype.setOnCancel=function(m){var n=this;if(!m){return}if(this.onCancel){this.onCancel=m;return}this.onCancel=m;var l=new h({label:"Cancel"});l.inject(this.querySelector("#cancel-btn"));this.querySelector("#cancel-btn").classList.remove("hidden");l.addEventListener("buttonclick",function(){n.onCancel()})};k.prototype.createDiagnosticsUI=function(){var r=this;var n=this.diagnosticsRunner.getDiagnostics();var v=this.getCategories(n);var p={};var t={};var q=Object.keys(v).sort();var l=document.createElement("a");l.innerHTML="Expand all";this.diagnosticContent.appendChild(l);l.style.marginBottom="8px";l.style.display="inline-block";l.style.cursor="pointer";l.addEventListener("click",function(){for(var y in t){t[y].expandedFlag=true}});for(var o=0,u=q;o<u.length;o++){var m=u[o];var s=document.createElement("div");var x=new i({header:m,body:s,icon:"refresh",allowUnsafeHTMLHeader:false});p[m]=s;t[m]=x;x.inject(this.diagnosticContent)}var w=function(D,y){var C=document.createElement("div");C.classList.add("diagnostic");C.innerHTML="<p><strong>"+D.getName()+"</strong></p>";y.map(function(I){var H=r.getIcon(I.getStatusCode());var J=I.getMessage();if(typeof J==="string"){var G=document.createElement("div");G.classList.add("diagnostic-status-message");G.innerHTML='<i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-'+H+'"></i> <p>'+J.replace(/\n/g,"<br>")+"</p>";return G}else{var F=document.createElement("div");F.classList.add("diagnostic-status-message");var E=document.createElement("div");E.innerHTML=J.messages.map(function(L){return'<div class="diagnostic-status-message">\n                        <p style="padding-right: 8px;">&bull;</p><p>'+L.replace(/\n/g,"<br>")+"</p>\n                    </div>"}).join("");var K=new i({header:J.title,body:E,icon:H,style:"simple",allowUnsafeHTMLHeader:false});K.inject(F);return F}}).forEach(function(E){return C.appendChild(E)});var A=D.getCategory();var B=p[A];v[A]--;var z=y.map(function(E){return E.getStatusCode()});if(z.indexOf(b.ERROR)!==-1){r.setIcon(t[A],b.ERROR);B.appendChild(C)}else{if(z.indexOf(b.UNKNOWN)!==-1){r.setIcon(t[A],b.UNKNOWN);B.appendChild(C)}else{B.appendChild(C)}}if(v[A]===0){r.setIcon(t[A],b.OK)}};this.diagnosticsRunner.runDiagnostics(w).then(function(){})};k.prototype.createLogsUI=function(){var l=new e(this.logs,this.monitors);this.logContent.appendChild(l)};k.prototype.getIcon=function(l){switch(l){case b.ERROR:return"wrong";case b.UNKNOWN:return"attention";default:return"check"}};k.prototype.setIcon=function(p,m){var o=this.getIcon(b.ERROR);var l=this.getIcon(b.UNKNOWN);var n=this.getIcon(b.OK);switch(m){case b.ERROR:p.icon=o;break;case b.UNKNOWN:if(p.icon!==o){p.icon=l}break;default:if(p.icon!==o&&p.icon!==l){p.icon=n}break}};k.prototype.getCategories=function(n){var m={};for(var p=0,l=n;p<l.length;p++){var o=l[p];if(!m[o.getCategory()]){m[o.getCategory()]=1}else{m[o.getCategory()]++}}return m};return k}(HTMLElement));window.customElements.define("cmp-supportability-diagnostics",g);return g});define("DS/SMAProcWebSupportabilityUI/ZipJSArchiver",["require","exports","DS/ZipJS/zip-fs","DS/SMAProcWebSupportabilityUI/FileDownloader"],function(b,a,c,d){var e=(function(){function f(){this.zip=new c.fs.FS()}f.prototype.addFile=function(g,i,h){if(h==null){h=this.zip.root}if(typeof i==="string"){new c.fs.ZipFileEntry(this.zip,g,{Reader:c.TextReader,Writer:c.TextWriter,data:i},h)}else{new c.fs.ZipFileEntry(this.zip,g,{Reader:c.BlobReader,Writer:c.BlobWriter,data:i},h)}};f.prototype.addDirectory=function(g,h){if(h==null){h=this.zip.root}return new c.fs.ZipDirectoryEntry(this.zip,g,{},h)};f.prototype.extractArchiveContents=function(g,h,i){if(h==null){h=this.zip.root}if(i!=null&&i!=""){h=this.addDirectory(i,h)}h.importBlob(g,function(){},function(){})};f.prototype.getRootDirectory=function(){return this.zip.root};f.prototype.download=function(g){return this.toBlob().then(function(h){return d.downloadBlob(h,g)})};f.prototype.toBlob=function(){var g=this;return new Promise(function(i,h){g.zip.exportBlob(i,function(){},h)})};return f}());return e});var __awaiter=(this&&this.__awaiter)||function(a,c,b,d){return new (b||(b=Promise))(function(i,h){function e(j){try{f(d.next(j))}catch(k){h(k)}}function g(j){try{f(d["throw"](j))}catch(k){h(k)}}function f(j){j.done?i(j.value):new b(function(k){k(j.value)}).then(e,g)}f((d=d.apply(a,c||[])).next())})};var __generator=(this&&this.__generator)||function(i,d){var j={label:0,sent:function(){if(k[0]&1){throw k[1]}return k[1]},trys:[],ops:[]},e,h,k,c;return c={next:b(0),"throw":b(1),"return":b(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function b(f){return function(g){return a([f,g])}}function a(g){if(e){throw new TypeError("Generator is already executing.")}while(j){try{if(e=1,h&&(k=h[g[0]&2?"return":g[0]?"throw":"next"])&&!(k=k.call(h,g[1])).done){return k}if(h=0,k){g=[0,k.value]}switch(g[0]){case 0:case 1:k=g;break;case 4:j.label++;return{value:g[1],done:false};case 5:j.label++;h=g[1];g=[0];continue;case 7:g=j.ops.pop();j.trys.pop();continue;default:if(!(k=j.trys,k=k.length>0&&k[k.length-1])&&(g[0]===6||g[0]===2)){j=0;continue}if(g[0]===3&&(!k||(g[1]>k[0]&&g[1]<k[3]))){j.label=g[1];break}if(g[0]===6&&j.label<k[1]){j.label=k[1];k=g;break}if(k&&j.label<k[2]){j.label=k[2];j.ops.push(g);break}if(k[2]){j.ops.pop()}j.trys.pop();continue}g=d.call(i,j)}catch(f){g=[6,f];h=0}finally{e=k=0}}if(g[0]&5){throw g[1]}return{value:g[0]?g[1]:void 0,done:true}}};define("DS/SMAProcWebSupportabilityUI/WidgetLoader",["require","exports","DS/SMAProcWebSupportabilityUI/cmp-supportability-diagnostics/cmp-supportability-diagnostics","DS/SMAProcWebSupportabilityUtils/diagnostics/strategies/LicenseDiagnostic","DS/SMAProcWebSupportabilityUI/ZipJSArchiver","DS/SMAProcWebSupportabilityUtils/SupportabilityAPI","DS/SMAProcWebSupportabilityUtils/platform/SessionInfo","DS/SMAProcWebSupportabilityUtils/diagnostics/strategies/PremadeDiagnostics"],function(b,e,f,i,d,a,g,c){var h=(function(){function j(){}j.load=function(){return __awaiter(this,void 0,void 0,function(){var m,l,k;return __generator(this,function(n){switch(n.label){case 0:m={};l={};if(widget.getValue("session")){Object.assign(m,widget.getValue("session"))}if(widget.getValue("config")){Object.assign(l,widget.getValue("config"))}return[4,g.create(m)];case 1:k=n.sent();this.createWidget(k,l);return[2]}})})};j.createWidget=function(k,l){var n=this;var m={onLoad:function(){return __awaiter(n,void 0,void 0,function(){var q,p,r,o;return __generator(this,function(s){switch(s.label){case 0:widget.body.innerHTML="";q=a.Monitors.createMonitors();p=a.Logs.createEmptyLogs(new d());r=a.Diagnostics.createEmptyRunner();return[4,this.loadDiagnosticsFromConfig(r,k,l)];case 1:s.sent();return[4,this.loadLogsFromConfig(p,q,k,l)];case 2:s.sent();if(widget.getValue("neededLicenses")){r.addDiagnostic(new i(k,widget.getValue("neededLicenses")))}if(widget.getValue("job")){r.addDiagnostic(new c.JobLogDiagnostic(k,widget.getValue("job")));a.Logs.addJobLogs(p,k,widget.getValue("job"))}a.Logs.addScreenshot(p,q);o=new f(r,p,q);widget.body.appendChild(o);return[2]}})})},onRefresh:function(){}};widget.addEvent("onLoad",m.onLoad);widget.addEvent("onRefresh",m.onRefresh)};j.loadDiagnosticsFromConfig=function(l,m,k){return __awaiter(this,void 0,void 0,function(){var n,p,o,q;return __generator(this,function(r){switch(r.label){case 0:if(k.diagnostics==null){k.diagnostics=[]}n=function(w){var u,t,v,s;return __generator(this,function(x){switch(x.label){case 0:x.trys.push([0,2,,3]);return[4,new Promise(function(z,y){window.require([w.path],function(A){return z(A)},y)})];case 1:u=x.sent();if(w.arguments==null){w.arguments=[]}if(w.useSessionInfo){t=w.arguments.indexOf("__SESSION__");if(t!==-1){w.arguments[t]=m}}v=new (u.bind.apply(u,[void 0].concat(w.arguments)))();l.addDiagnostic(v);return[3,3];case 2:s=x.sent();console.error("Unable to load custom diagnostic:",s);return[3,3];case 3:return[2]}})};p=0,o=k.diagnostics;r.label=1;case 1:if(!(p<o.length)){return[3,4]}q=o[p];return[5,n(q)];case 2:r.sent();r.label=3;case 3:p++;return[3,1];case 4:if(k.useDefaultDiagnostics||k.useDefaultDiagnostics==null){a.Diagnostics.addDefaultDiagnostics(l,m)}return[2]}})})};j.loadLogsFromConfig=function(m,l,n,k){return __awaiter(this,void 0,void 0,function(){var r,q,p,o;return __generator(this,function(s){switch(s.label){case 0:if(k.logs==null){k.logs=[]}r=function(v){var u,t,w,x;return __generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);return[4,new Promise(function(A,z){window.require([v.path],function(B){return A(B)},z)})];case 1:u=y.sent();if(v.arguments==null){v.arguments=[]}if(v.useSessionInfo){t=v.arguments.indexOf("__SESSION__");if(t!==-1){v.arguments[t]=n}}w=new (u.bind.apply(u,[void 0].concat(v.arguments)))();if(v.extract){m.addArchiveContents(w,m.scenario(),v.filename)}else{m.addFile(v.filename,w,m.scenario())}return[3,3];case 2:x=y.sent();console.error("Unable to load custom log:",x);return[3,3];case 3:return[2]}})};q=0,p=k.logs;s.label=1;case 1:if(!(q<p.length)){return[3,4]}o=p[q];return[5,r(o)];case 2:s.sent();s.label=3;case 3:q++;return[3,1];case 4:if(k.useDefaultLogs||k.useDefaultLogs==null){a.Logs.addDefaultLogs(m,n,l)}return[2]}})})};return j}());return h});