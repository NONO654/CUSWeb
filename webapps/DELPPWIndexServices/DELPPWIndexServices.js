define("DS/DELPPWIndexServices/IndexParserNode",["UWA/Core","UWA/Class"],function(c,a){var b=a.extend({init:function(d){var e=this;this._children=[];this._result=d;this._result.attributes.forEach(function(g){var f=g.name,h;if(!c.is(e[f])){e[f]=g}else{if(c.is(e[f].value,"string")){h=e[f].value;e[f].value=[h,g.value]}else{if(c.is(e[f].value,"array")){e[f].value.push(g.value)}}}})},getAttribute:function(d){if(this.hasOwnProperty(d)){return this[d]}},getAttributeValue:function(e){var d=this.getAttribute(e);if(d){return d.value}},addChild:function(d){if(this._children.indexOf(d)===-1){this._children.push(d)}},getChildren:function(){return this._children},getRawResult:function(){return this._result}});return b});define("DS/DELPPWIndexServices/IndexParser",["UWA/Core","UWA/Class","DS/DELPPWIndexServices/IndexParserNode"],function(d,a,i){var e=a.singleton({name:"IndexParser",_indexMapping:null,init:function h(j){j=j||{};this._parent(j)},setIndexMapping:function g(j){this._indexMapping=j},translateAttributeToPredicate:function f(n,k){var j=[],m,l;if(!d.is(this._indexMapping)){return}k=k||{};m=k.type||"entity";switch(m){case"entity":l=this._indexMapping.IndexMapping.Entity.Key;break;case"relation":l=this._indexMapping.IndexMapping.Relation.Key;break;default:}if(this._indexMapping){n.forEach(function(p){var o;l.some(function(q){var r=q.database===p;if(r){o=q}return r});if(o){if(j.indexOf(o.index)===-1){j.push(o.index)}}})}return j},translatePredicateToAttribute:function c(k,l){var j,m,n,o=function(q){var p={};q=q||{};Object.keys(q).forEach(function(r){var s=q[r];if(!(s instanceof Function)&&0!==r.indexOf("_")){if(d.is(s)&&d.is(s.value)){p[r]=s.value}}});return p};if(!d.is(this._indexMapping)){return}l=l||{};n=l.type||"entity";if(k instanceof Array){j=[]}else{j={};if(l.fromExpandService){k=o(k)}}switch(n){case"entity":m=this._indexMapping.IndexMapping.Entity.Key;break;case"relation":m=this._indexMapping.IndexMapping.Relation.Key;break;default:}if(this._indexMapping){if(k instanceof Array){k.forEach(function(q){var p;m.some(function(r){var s=r.index===q;if(s){p=r}return s});if(p){if(j.indexOf(p.database)===-1){j.push(p.database)}}})}else{Object.keys(k).forEach(function(r){var q,s,p;m.some(function(t){var u=t.index===r;if(u){p=t}return u});if(p){q=k[p.index];m.some(function(t){var u=t.index===q;if(u){s=t}return u});if(s){q=s.database}j[p.database]=q}})}}return j},parseNavigateResult:function(n){var j=null,m={},k=[];if(typeof n==="string"){j=JSON.parse(n)}else{if(typeof n==="object"&&n!==null){j=n}}if(d.is(j)&&d.is(j.results,"array")){j.results.forEach(function l(p){var t,q,o,s,u,r;if(p.hasOwnProperty("attributes")){t=new i(p);q=t.getAttributeValue("did");m[q]=t}else{if(p.hasOwnProperty("path")){for(s=0;s<p.path.length;s++){u=p.path[s];r=m[u];if(!d.is(r)){throw new Error("Result corruption : did not found "+u)}else{if(s===0){if(k.indexOf(r)===-1){k.push(r)}o=r}else{o.addChild(r);o=r}}}}else{throw new Error("Unsupported element "+p)}}})}return k},parseFetchResult:function b(l){var j={attributes:{},ds6w:{}};if(d.is(l)){if(d.is(l.attributes,"array")){l.attributes.forEach(function k(m){var n;if(d.is(m)&&d.is(m.format,"string")){switch(m.format){case"attribute":if(!d.is(j.attributes[m.name])){j.attributes[m.name]=m.value}else{if(d.is(j.attributes[m.name],"string")){n=j.attributes[m.name];j.attributes[m.name]=[n,m.value]}else{if(d.is(j.attributes[m.name],"array")){j.attributes[m.name].push(m.value)}}}break;case"ds6w_facet":j.ds6w[m.name]={value:m.value,dispValue:m.dispValue,type:m.type};break;default:break}}})}}return j}});return e});