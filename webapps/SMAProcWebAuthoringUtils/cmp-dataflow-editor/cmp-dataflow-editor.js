define("DS/SMAProcWebAuthoringUtils/cmp-dataflow-editor/cmp-dataflow-editor",["UWA/Core","DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/SMAProcWebAuthoringUI/SMAProcWebProcessComposer","DS/SMAProcWebDiagram/graph","DS/Windows/DockingElement","DS/Controls/Toggle","DS/SMAProcWebAuthoringControls/WebUXDialog","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","text!DS/SMAProcWebAuthoringUtils/cmp-dataflow-editor/cmp-dataflow-editor.html","DS/SMAProcWebAuthoringUtils/cmp-dataflow-content/cmp-dataflow-content","DS/SMAProcWebAuthoringUtils/cmp-process-table/cmp-process-table","DS/SMAProcWebAuthoringUI/nTwoView"],function(d,p,c,j,m,h,k,r,b,o,a,i){c.registerDomModule(i);var s={CREATEANDMAP:"CREATEANDMAP",AToAMapMode:"AToAMapMode"};var n={OneToMany:"ONETOMANY",Sequential:"ROUTE",AtoA:"AtoA"};var e={TREE:"TREE",GRAPH:"GRAPH",RESETTOSELECTION:"RESETTOSELECTION",N2VIEW:"N2VIEW",TABCHANGE:"TABCHANGE",WIN:"WIN"};var f=n.OneToMany;var q,l;var g={NoneDockArea:0,TopDockArea:1<<0,BottomDockArea:1<<1,LeftDockArea:1<<2,RightDockArea:1<<3};return window.Polymer({is:"cmp-dataflow-editor",properties:{sourceActivity:{type:Object},destinationActivities:{type:Array,value:[]},selectionCache:{type:Object},mode:{type:String,value:n.AtoA}},ready:function(){var t=String(localStorage.getItem("showProcessTree")).toLowerCase()==="true";var t=true;l=document.createElement("cmp-dataflow-content");this.dataflowContent=l;l.addEventListener("modechanged",function(C){var B=C.detail.tabMode;if(B===s.CREATEANDMAP){this.mode=f;t&&q.setSelectionMode(true)}else{if(B===s.AToAMapMode){f=this.mode;this.mode=n.AtoA;t&&q.setSelectionMode(false)}}this.selectionCache=this.onTabChange(this.mode,this.sourceActivity,this.destinationActivities,this.selectionCache)}.bind(this));var x=new d.createElement("div",{styles:{overflow:"hidden",position:"absolute",left:"50%",transform:"translate(-50%)",height:"100%",width:"100%"}});this.mainContainerProcessTreeN2div=x;this.mainContainerProcessTreeN2div.style.borderLeft="1px solid #d1d4d4";var y=new d.createElement("div",{styles:{position:"relative"}});y.inject(x);if(String(localStorage.getItem("showProcessTree")).toLowerCase()==="true"){var u=new d.createElement("div",{styles:{display:"inline-block","margin-left":"10px","margin-right":"20px"}});u.inject(y);var w=new b({type:"switch",label:"Process tree",checkFlag:false,allowUnsafeHTMLLabel:false});w.inject(u);w.addEventListener("change",function(){if(this.processTree.style.display===""){this.processTree.style.display="none";this.nTwo.style.display=""}else{if(this.processTree.style.display==="none"){this.processTree.style.display="";this.nTwo.style.display="none"}}}.bind(this))}var v=new d.createElement("div",{styles:{display:"inline-block","margin-left":"10px"}});v.inject(y);var A=new b({type:"switch",label:"Unmapped Activities",checkFlag:false,allowUnsafeHTMLLabel:false});this.UnmappedActivitiesToggleButton=A;A.inject(v);A.addEventListener("change",function(B){this.nTwo.updateCurrentnTwoGraph(B.dsModel.checkFlag,this.mode)}.bind(this));t&&(q=document.createElement("cmp-process-table"));q&&(q.setHeight("96%"));this.processTree=q;t&&q.addEventListener("toggleselection",function(B){this.toggleActivitySelection(B.detail,e.TREE)}.bind(this));l.addEventListener("auto-mapping-mode-changed",function(B){this.mode=B.detail;if(this.nTwo&&String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){this.nTwo.highlightEdges(this.sourceActivity,this.destinationActivities,this.mode);this.nTwo.highlightNodes(this.sourceActivity,this.destinationActivities)}else{this.fire("highlightNodesandEdges",{sourceActivity:this.sourceActivity,destinationActivities:this.destinationActivities,mode:B.detail})}}.bind(this));x.appendChild(q);q.style.display="none";this.addEventListener("tabRefreshed",function(){if(String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){this.nTwo.updateCurrentnTwoGraph(this.UnmappedActivitiesToggleButton.checkFlag,this.mode)}});l.addEventListener("cmp-activitities-unselect",function(B){B.stopPropagation();this.updateSelection(this.sourceActivity,[],e.RESETTOSELECTION)}.bind(this));l.addEventListener("update-selection",function(B){B.stopPropagation();this.updateSelection(B.detail.sourceActivity,B.detail.destinationActivities,B.detail.source)}.bind(this));var z=new r({side:g.LeftDockArea,dockingZoneContent:x,dockingZoneSize:480,collapseDockingZoneFlag:false,visibleDockingZoneFlag:false,collapsibleFlag:false,minSize:150});this.addEventListener("toggle-n2-view",function(){z.collapseDockingZoneFlag=!z.collapseDockingZoneFlag;z.visibleDockingZoneFlag=!z.visibleDockingZoneFlag;this.nTwo.fitAllIn()}.bind(this));z.addEventListener("collapse",function(){this.onResize()}.bind(this));z.addEventListener("dockIsResizing",function(){this.onResize()}.bind(this));z.addEventListener("dockResize",function(){this.onResize()}.bind(this));z.addEventListener("expand",function(){this.onResize()}.bind(this));z.inject(this.$.content);z.freeZoneContent=l},attached:function(){this.fire(this.is+"-attached")},toggleActivitySelection:function(x,w){var u,t,v;u=this._getNewSourceActivity(x,this.sourceActivity,this.destinationActivities);v=this._getNewDestinationActivities(x,u,this.destinationActivities,this.mode);if(!v.inValidRelation){t=v.newDestinationActivities;this.updateSelection(u,t,w)}else{t=this.destinationActivities;this.updateSelection(u,t,w);this.showInvalidSelectionError(x,w)}},_getNewSourceActivity:function(v,u,w){var t=undefined;if(u===undefined){t=v}else{if(u===v){if(w.length===0){t=undefined}else{t=w[0]}}else{t=u}}return t},_getNewDestinationActivities:function(w,v,x,z){var t=[],u=false,y=false;if(w!==v&&v!==undefined&&v!==x[0]){if(z===n.AtoA){if(x[0]!==w&&x[0]!==v){if(this.isValidPairForMapping(v,w,z)){t.push(w)}else{y=true}}}else{if(z===n.OneToMany){x.forEach(function(A){if(A!==v&&A!==w){t.push(A)}if(A===w&&!u){u=true}});if(!u&&(t.indexOf(w)===-1)){if(this.isValidPairForMapping(v,w,z)){t.push(w)}else{y=true}}}else{if(z===n.Sequential){x.forEach(function(A){if(!u&&A!==v&&A!==w){t.push(A)}if(A===w&&!u){u=true}});if(!u&&(t.indexOf(w)===-1)){if(this.isValidPairForMapping(t.length>0?t[t.length-1]:v,w,z)){t.push(w)}else{y=true}}}}}}else{if(x[0]===v){x.splice(0,1);t=x}}return{inValidRelation:y,newDestinationActivities:t}},onTabChange:function(x,u,v,y){var t=[],w={},A=false,z=false;w.sourceActivity=u;w.destinationActivities=v;z=y&&y.destinationActivities&&y.destinationActivities.length>0;A=y&&w.sourceActivity!==y.sourceActivity;if(x===n.AtoA){if(A&&v.length>0){t.push(v[0])}else{if(A&&v.length===0){t=[]}else{if(!A&&z){t.push(y.destinationActivities[0])}else{if(!A&&!z){if(v.length>0){t.push(v[0])}else{t=[]}}}}}}else{if(A){t=v}else{if(z){t=y.destinationActivities}else{t=[]}}}this.updateSelection(u,t,e.TABCHANGE);this.dataflowContent.highlightDataPaths(x);return w},isValidPairForMapping:function(v,t,w){var u=j.getRelationship(v,t);if(u.value===j.Relation.Parent||u.value===j.Relation.Child||u.value===j.Relation.SiblingUpstream||(w===n.AtoA&&u.value===j.Relation.SiblingDownstream)){return true}return false},updateSelection:function(t,u,x){var w=t!==this.sourceActivity;var v=function(){if(!this.nTwo&&String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){var y=document.createElement("cmp-ntwo-view");this.nTwo=y;this.nTwo.sourceActivity=this.sourceActivity;this.nTwo.setHeight("96%");this.mainContainerProcessTreeN2div.appendChild(y);y.addEventListener("nTwoTextClicked",function(A){var z,B;if(A.detail.startNode&&A.detail.endNode){if(A.detail.startNode.indexOf("Process")===0){z=a.getCurrentProcess()}else{if(A.detail.startNode.indexOf("Activity")===0){z=a.getCurrentProcess().getActivityFromId(A.detail.startNode)}}if(A.detail.endNode.indexOf("Process")===0){B=a.getCurrentProcess()}else{if(A.detail.endNode.indexOf("Activity")===0){B=a.getCurrentProcess().getActivityFromId(A.detail.endNode)}}}this.updateSelection(z||this.sourceActivity,B?[B]:[])}.bind(this));y.addEventListener("toggleselection",function(z){this.toggleActivitySelection(z.detail.activity,e.N2VIEW)}.bind(this))}}.bind(this);l.setActivitySelection(t,u,w,v);if(String(localStorage.getItem("showProcessTree")).toLowerCase()==="true"){q.setActivitySelection(t,u)}if(m.isWebInWin()&&x!==e.N2VIEW){m.updateGraphNodesStyle(t,u,this.mode);this.updateGraphNodesStyle(t,u)}else{this.updateGraphNodesStyle(t,u)}if(this.nTwo&&String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){this.nTwo.sourceActivity=t;this.nTwo.destinationActivities=u;this.nTwo.highlightEdges(t,u,this.mode)}else{this.fire("highlightNodesandEdges",{sourceActivity:t,destinationActivities:u,mode:this.mode})}this.sourceActivity=t;this.destinationActivities=u;this.fire("dialogHeaderChanged",t)},showInvalidSelectionError:function(w,v){var t="Invalid Destination Activity";var u;if(v===e.GRAPH){u=this.getGraphNode(w);if(u){u.notify(t)}}else{if(v===e.TREE){q.showInvalidSelectionError(w,t)}else{if(v===e.WIN&&m.isWebInWin()){m.showInvalidSelectionError(w,t)}else{if(v===e.N2VIEW){u=this.getnTwoNode(w);if(u){u.notify(t)}this.fire("invalidNtwoViewActivitySelection",{activity:w,message:t})}}}}},updateGraphNodesStyle:function(u,x){var w,v,y,t;if(this.sourceActivity!==u){w=this.getGraphNode(this.sourceActivity);w&&w.unhighlight();v=this.getGraphNode(u);v&&h.updateHighlight(undefined,"activity",v);if(this.nTwo&&String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){var A=w&&this.getnTwoNode(this.sourceActivity);var z=v&&this.getnTwoNode(u);A&&A.unhighlight();z&&z.highlight()}else{this.fire("unhighlightOldSourceActivity",{oldActivity:this.sourceActivity})}}this.destinationActivities.forEach(function(B){if(x.indexOf(B)===-1&&B!==u){y=this.getGraphNode(B);y&&y.unhighlight();if(this.nTwo&&String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){t=this.getnTwoNode(B);t&&t.unhighlight()}else{this.fire("unhighlightOldSourceActivity",{oldActivity:B})}}}.bind(this));x.forEach(function(B){if(this.destinationActivities.indexOf(B)===-1){y=this.getGraphNode(B);y&&y.highlightForDF();t=this.getnTwoNode(B);t&&t.highlightForDF()}}.bind(this))},getGraphNode:function(u){var t;if(u){t=k.getGraphNode(u);if(t&&t.views&&t.views.main&&t.views.main.display){return t.views.main.display.elt}}return null},getnTwoNode:function(u){var t;if(String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){if(u){t=this.nTwo.getGraphNode(u);if(t&&t.views&&t.views.main&&t.views.main.display){return t.views.main.display.elt}}}return null},onClose:function(){l.onCancel();this._close()},onOK:function(t){l.onOK(function(){this._close();t&&t()}.bind(this))},onCancel:function(){l.onCancel();this._close()},_close:function(){this.updateGraphNodesStyle(undefined,[]);this.sourceActivity=undefined;this.destinationActivities=[]},onApply:function(t){l.onApply(function(){t&&t()})},onResize:function(){this.debounce("resized",function(){l.onResize()},400)}})});