/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebAuthoringUtils/SMAProcWebAuthoringServices",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAProcWebAuthoringNLSUtils","DS/UIKIT/Alert","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/ApplicationFrame/FrameWindowsManager"],function(h,f,d,i,g,b,c){var e=/\.Title$/;var a={composerMessages:null,notificationPref:"warning",notificationClassNames:["info","success","warning","error","always"],notificationPrefIndex:-1,Initialize:function(j){this.composerMessages=new d({visible:true,fullWidth:true,maximumVisibleMessages:3}).inject(j);this.loader=new b().inject(UWA.createElement("div",{id:"loaderContainer",styles:{position:"absolute",width:"80px",height:"80px",top:"10px",left:"10px"}}).inject(j))},showLoader:function(){this.loader.visibleFlag=true},hideLoader:function(){this.loader.visibleFlag=false},alert:function(j){var k=j||{};k.onOkay=k.onOkay||function(){console.info("No onOkay implementation")};delete k.onCancel;this._dialog(k)},confirm:function(j){var k=j||{};k.onCancel=k.onCancel||function(){console.info("No onCancel implementation")};this._dialog(k)},_dialog:function(r){if(typeof r==="string"){r={message:r}}var n=r&&r.title;var q=r&&r.message;var k=document.createElement("p");k.innerText=q;var l=r&&r.onOkay;var o=r&&r.onCancel;var p=c.getFrameWindow(),m=p?p.getImmersiveFrame():null;var j=new i({closeButtonFlag:false,modalFlag:true,title:n,content:k,immersiveFrame:m,buttons:{Ok:new g({onClick:function(){if(l){try{l()}catch(s){console.warn(s)}}else{console.info("Missing onOkay callback")}j.close()},allowUnsafeHTMLContent:false}),Cancel:new g({visibleFlag:Boolean(o),onClick:function(){try{o()}catch(s){console.warn(s)}j.close()},allowUnsafeHTMLContent:false})}})},displayClosableMessages:function(k,l,o,n){if(k||l){var j;if(k==="primary"){j=this.notificationClassNames.indexOf("info")}if(k==="always"){j=this.notificationClassNames.indexOf("error")}else{j=this.notificationClassNames.indexOf(k)}this.notificationPrefIndex=this.notificationClassNames.indexOf(this.notificationPref);if(j>=this.notificationPrefIndex){var m=f.translate.apply(this,l);if(this.composerMessages!==null){this.composerMessages.add({className:k,message:m,closeOnClick:o});if(n===undefined||n===null||n){this.composerMessages.options.autoHide=true;this.composerMessages.options.hideDelay=10000}else{this.composerMessages.options.autoHide=false}}}}},displayNotification:function(q,k){var p=k||{};var l=p.messageType||"primary";var m=l==="error";var o=q;if(this.composerMessages){if(p.autoHide!==undefined){this.composerMessages.options.autoHide=p.autoHide}else{this.composerMessages.options.autoHide=!m}this.composerMessages.options.hideDelay=p.hideDelay||2000;var n=localStorage.getItem("SIMPRCW_AP_ENABLE_SUPPORTABILITY");if(m&&n){o=document.createElement("div");o.textContent=q;o.innerHTML+="<br />";var j=new g({label:"Launch diagnostic",allowUnsafeHTMLContent:false,onClick:function(){require(["DS/ApplicationFrame/CommandsManager"],function(r){var s=r.getCommand("SMAProcWebSupportabilityCmdHdr");if(s&&s.begin){s.begin()}})}});j.inject(o)}this.composerMessages.add({className:l,message:o,closeOnClick:!m})}else{console.warn('Could not display notification of type: "'+l+'" with message: '+q);if(m){alert(q)}}},clearNotifications:function(){if(this.composerMessages&&this.composerMessages.getContent().hasChildNodes()){this.composerMessages.getContent().empty();this.composerMessages.messages=[]}},displayInWebUXDialog:function(j,n,m){j=j+"&protocol="+location.protocol;var l=document.createElement("iframe");l.src=j;l.height=(window.innerHeight-157);l.width=(window.innerWidth-157);l.style.overflow="hidden";var o=c.getFrameWindow(),p=o?o.getImmersiveFrame():null;var k=new i({closeButtonFlag:true,modalFlag:true,title:m||"",content:l,immersiveFrame:p});k.close=function(){if(n){h.refreshCEStamp(n,{onSuccess:function(q){console.log("CEStamp Updated")},onFailure:function(q){console.log("CEStamp update failed")}})}k.destroy()};return k},displayInTransientWidget:function(j,l,k){require(["DS/TransientWidget/TransientWidget"],function(n){var o={mode:"panel",height:800,width:700};var m=window&&window.widget&&window.widget.id;if(/^preview-/.test(m)){a.displayNotification("Please pin the current widget before showing: "+l,{messageType:"error"})}else{n.showWidget(j,l,k,o)}},function(m){console.warn("Failed to load transient widget: "+m,m)})},getNextActivityName:function(m,p){var j=null;if(p){j=f.translate.apply(this,[p]);if(j===p&&e.test(p)){j=p.replace(e,"")}}if(!j){p=f.translate.apply(this,["Activity.Title"])}if(m){var o=(m.isProcess())?m:m.getProcess();var n=o.getAllActivities();var l=0;var k=p=j;while(this.nameExist(n,p)===true){l++;p=k+"_"+l}}return p},getNextStepName:function(n,o){var k=null;if(o){k=f.translate.apply(this,[o]);if(k===o&&e.test(o)){k=o.replace(e,"")}}if(!k){o="Step"}if(n&&n.isActivity()){var j=n.getSteps();var m=0;var l=o=k;while(this.nameExist(j,o)===true){m++;o=l+m}}return o},nameExist:function(m,l){var n=false;for(var k=0;k<m.length;k++){var j=m[k].getName();if(j.localeCompare(l)===0){n=true;break}}return n},canCreateStep:function(l,j){var k=true;if(l===undefined||l===null||j===undefined||j===null){return k}if(j==="com.dassault_systemes.sma.adapter.Doe"||j==="com.dassault_systemes.sma.adapter.Loop"||j==="com.dassault_systemes.sma.adapter.Optimization"||j==="com.dassault_systemes.sma.adapter.MonteCarlo"){if(l.containsProcessStep()===true){k=false}}return k},importAndCreate:function(l,j,n,k){var m=new Error("empty error for stack");Polymer.Base.importHref([l],function(){function o(q){var p=document.createElement(j);if(p.root){n(p)}else{if(q>0){setTimeout(o.bind(this,q-1),250)}else{m.message="Element <"+j+"> not registered before timeout";k(m)}}}o(20)},function(o){m.message='Failed to import "'+l+'"';m.originalError=o;k(m)})}};return a});