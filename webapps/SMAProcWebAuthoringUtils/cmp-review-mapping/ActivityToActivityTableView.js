define("DS/SMAProcWebAuthoringUtils/cmp-review-mapping/ActivityToActivityTableView",["UWA/Core","DS/Utilities/Dom","UWA/Controls/Abstract","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAProcWebContents/WUXControlUtil","DS/SMAProcSPUI/Views/RulesEditor","DS/Controls/ComboBox","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/JSCMM/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtilsNLSUtils","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAJSCMMDataFlowUtilsNLS","css!DS/UIKIT/UIKIT.css","css!DS/SMAProcWebAuthoringUtils/cmp-review-mapping/ActivityToActivityTableView.css"],function(l,o,m,e,f,j,k,t,s,u,i,q,a,d,r){var c,g,n,p,h;var b={CREATEANDMAP:0,MAP:1,MAPPED:2};p=function(w){var v,x=w.nodeModel;if(!w.isHeader&&x.options.grid.tree){v=k.ParameterNameView(x.options.grid.tree);w.cellView.elements.container.setContent(v)}return v};h=function(v){var N,K,I,y,z,A=[],C,L=v.nodeModel;I=["In","Out","InOut"];y=["left flow-to","right flow-from","arrow-combo-horizontal flow-both"];if(!v.isHeader){if(this.isDirectionEditable&&L.options.grid.element){for(C=0;C<I.length;C++){A[C]={labelItem:"",valueItem:I[C],iconItem:y[C]};if(L.options.grid.flowDirection===I[C]){z=C}}N=new s({elementsList:A,selectedIndex:z,enableSearchFlag:false,actionOnClickFlag:false});N.addEventListener("change",function(R){R.preventDefault();R.stopImmediatePropagation();var T=R.dsModel.value,Q=L.options.grid,S=R.currentTarget.getBoundingClientRect().left,P=R.currentTarget.getBoundingClientRect().top,U=this.getNodeCacheKey(Q);if(T!==Q.element._flowDirection){this.dispatchEvent("onDirectionChange",[{value:T,grid:Q,nodeToUpdate:L,xAxis:S,yAxis:P,nodeCacheKey:U}])}}.bind(this))}else{if(L.options.grid.element){N=document.createElement("div");if(L.options.grid.flowDirection==="Out"){K=l.createElement("span",{"class":"flow-from wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-right"})}else{if(L.options.grid.flowDirection==="In"){K=l.createElement("span",{"class":"flow-to wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-left"})}else{if(L.options.grid.flowDirection==="InOut"){K=l.createElement("span",{"class":"flow-both wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-arrow-combo-horizontal"})}}}K.inject(N)}else{var B,G,w=v.nodeModel.options.grid;B=this.toSideDataContainer.findParameterByName(w.tree.getName());if(!B){N=document.createElement("div");N.classList.add("create-and-map-container");l.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus create-and-map",title:r["Dataflow.Mapping.CreateAndMap"],events:{click:function(Q){Q.stopImmediatePropagation();Q.preventDefault();var R=Q.target.getBoundingClientRect().left,P=Q.target.getBoundingClientRect().top;G=this.getNodeCacheKey(w);this.dispatchEvent("createAndMap",[{parameter:w.tree,xAxis:R,yAxis:P,nodeCacheKey:G}])}.bind(this)}}).inject(N)}else{var M=false;var H;var O=i.isToParameterAlreadyMapped(w.tree,B);if(!O.isAlreadyMapped){var x=i.structureCompatiblityCheck(w.tree,undefined,B,undefined);if(x.value){var J=i.getPossibleMappingDirectionBetweenParameters(w.tree,undefined,B,undefined,undefined);var E=i.dataTypeCompatiblityCheck(w.tree,B,J.value);if(E.value){M=true}else{H=E.errorCode}}else{H=x.errorCode}}else{var F=O.dataflow.getFromParameter().getParent().getName()+"."+O.dataflow.getFromParameter().getName();var D=O.dataflow.getToParameter().getParent().getName()+"."+O.dataflow.getToParameter().getName();H=d.translate("Dataflow.AlreadyMapped",F,D)}if(M){N=document.createElement("div");N.classList.add("create-and-map-container");l.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus create",title:"Map",events:{click:function(Q){Q.stopImmediatePropagation();Q.preventDefault();var R=Q.target.getBoundingClientRect().left,P=Q.target.getBoundingClientRect().top;G=this.getNodeCacheKey(w);this.dispatchEvent("map",[{fromSideParameter:w.tree,xAxis:R,yAxis:P,nodeCacheKey:G,toSideParameter:B}])}.bind(this)}}).inject(N)}else{N=document.createElement("div");N.classList.add("create-and-map-container");l.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus create-block",title:H}).inject(N)}}}}v.cellView.elements.container.setContent(N)}return N};n=function(w){var v,x=w.nodeModel;if(!w.isHeader){if(x.options.grid.element){v=this._toParameterContainer(w)}else{v=this._toParameterInput()}}else{if(w.isHeader&&w.dataIndex==="toParameter"){v=this.toSideDataContainer?this.toSideDataContainer.getName():""}}w.cellView.elements.container.setContent(v);return v};g=m.extend({name:"ActivityToActivityTableView",_initDefaultOptions:function(){var v;this.cachedViewObject={};this.nodeCache={};this.refreshDataFlowCache();if(this.toSideDataContainer){c=[{dataIndex:"tree",text:this.fromSideDataContainer.getName(),width:"auto",isDraggable:false,isEditable:false,onCellRequest:p.bind(this)},{dataIndex:"flowDirection",text:r["Dataflow.Mapping.Direction"],width:"92",isDraggable:false,isEditable:false,onCellRequest:h.bind(this)},{dataIndex:"toParameter",text:this.toSideDataContainer.getName(),width:"auto",isDraggable:false,isEditable:false,onCellRequest:n.bind(this)},{dataIndex:"Mode",text:"Mode",width:0,isFilterable:true},{dataIndex:"Type",text:"Type",width:0,isFilterable:true}];this.refreshToSideParameterCache()}else{c=[{dataIndex:"tree",text:this.fromSideDataContainer?this.fromSideDataContainer.getName():"",width:"auto",isDraggable:false,isEditable:false,onCellRequest:p.bind(this)},{dataIndex:"Mode",text:"Mode",width:0,isFilterable:true},{dataIndex:"Type",text:"Type",width:0,isFilterable:true}]}},init:function(v){this._parent(v)},refreshDataFlowCache:function(){this.dataFlows=this.fromSideDataContainer?i.getDataFlowSpaceForDataContainer(this.fromSideDataContainer).value:this.dataFlows},refreshToSideParameterCache:function(){var v;this.toParameterList={};if(this.toSideDataContainer){v=u.getAllParameters(this.toSideDataContainer);v.forEach(function(w){this.toParameterList[w.getName()]=w}.bind(this))}},setFromSideDataContainer:function(v){this.toSideDataContainer=undefined;this.fromSideDataContainer=v;this._initDefaultOptions();this.updateTable();this.selectedDataFlows=[]},setToSideDataContainer:function(v){this.isDirectionEditable=this._isDirectionEditable(this.fromSideDataContainer,v);this.toSideDataContainer=v;this.cachedViewObject={};this.clearNodes(this.nodeCache,this.model);this._initDefaultOptions();this.updateTable()},clearNodes:function(v,w){var x;if(w){w.prepareUpdate();for(x in v){v[x].remove();delete v[x]}w.pushUpdate()}},buildTabelView:function(w){var v;this.unloadDocument();v=this.elements.treeListView=this.getTreeListViewObject();this._buildTreeListView(v,function(){this._loadDocument(v);w&&w()}.bind(this))},getTreeListViewObject:function(){return new e({columns:c,defaultCellHeight:30,resize:{rows:false,columns:true},showVerticalLines:true,useTransparentScroller:false,alternateRowColor:false,isEditable:false,iconsSize:22,isSortable:false,show:{rowHeaders:false,columnHeaders:true},selection:{enableListSelection:true,nodes:true,cells:false,rowHeaders:true,columnHeaders:true,unselectAllOnEmptyArea:true,canMultiSelect:false,toggle:false},performances:{buildLinks:false,useRequestAnimationFrameRendering:false,renderingMode:"adaptive",debounceCellRequest:true,debounceCellInternalUpdateTimer:10},showLoaderIndicator:true,enableDragAndDrop:false,shouldAcceptDrag:function(){return false},shouldDisplayTooltip:function(v){var w=v.nodeModel;if(!v.isHeader){if(v.virtualColumnID===0){return{longHelp:w.options.grid.tree.getName()}}else{if(v.virtualColumnID===1&&w.options.grid.element){return{longHelp:w.options.grid.flowDirection}}}}return{longHelp:""}},height:"auto",apiVersion:"2",allowUnsafeHTMLContent:false})},_buildTreeListView:function(v,x){v.elements.container.addClassName("wux-controls-act-to-act-table-view");this.elements.body=new l.createElement("div",{"class":"wux-controls-process-body",html:[{tag:"div","class":"TreeListViewBody",html:v}]});this.elements.body.inject(this.options.elements.tableContainer);var w=v.getManager();v.onNodeClick(function(y){if(y.isHeader){w.unselectAll()}});w.onReady(function(){x()})},_loadDocument:function(x){var w,y,v;this.model=w=new f({useAsyncPreExpand:false});v=w.getXSO();v.onChange(function(){var C,B,J,H,z,F;C=this.model.getSelectedNodes();B=C[0];J=this.elements.treeListView.getManager().options;if(B){z=B.options.grid;if(q.isWebInWin()){var I=[];if(z.element&&z.element._dataFlowIn){I.push(z.element._dataFlowIn)}if(z.element&&z.element._dataFlowOut){I.push(z.element._dataFlowOut)}var K=[];var G=[];var E;var D=0;for(D=0;D<this.selectedDataFlows.length;D+=1){E=I.indexOf(this.selectedDataFlows[D]);if(E===-1){G.push(this.selectedDataFlows[D])}}for(D=0;D<I.length;D+=1){E=this.selectedDataFlows.indexOf(I[D]);if(E===-1){K.push(I[D])}}var A={selectedDataflows:K,unSelectedDataflows:G};q.highlightDataFlows(this.fromSideDataContainer,A);this.selectedDataFlows=I}F=this.getNodeCacheKey(z);if(this.toSideDataContainer){H=J.model[B._rowID][2].getView();this.filter=H.elements.container.querySelector("input");this.filter&&this.filter.setAttribute("placeholder",r["Dataflow.Selection.searchAndSelect"])}this.dispatchEvent("onSelect",[z.tree,F,B])}else{this.filter&&this.filter.removeAttribute("placeholder");this.dispatchEvent("onSelect",[null,null])}}.bind(this));y=x.getManager();y.loadDocument(w);o.addEndResizeListener(x.elements.container,function(){if(this.toSideDataContainer){var B,C,A,z;B=w.getSelectedNodes();C=B[0];if(C){A=x.getManager().options;z=A.model[C._rowID][2].getView();this.filter=z.elements.container.querySelector("input");this.filter&&this.filter.setAttribute("placeholder",r["Dataflow.Selection.searchAndSelect"])}}else{this.filter&&this.filter.removeAttribute("placeholder")}}.bind(this));this.rulesEditor=new t({spreadsheet:x,container:this.options.elements.filterContainer,searchHiddenColumns:true,searchDelay:500,columns:this.columns,show:{download:false,tablePreferences:false,subscription:false}})},getNodeCacheKey:function(v){var w=v.tree.getName();w=v.toParameter?w+"_"+v.toParameter.getName():w;return w},unloadDocument:function(){try{this.rulesEditor&&this.rulesEditor.destroy();if(this.elements){this.elements.treeListView&&this.elements.treeListView.getManager().unloadDocument();this.elements.treeListView&&this.elements.treeListView.destroy();this.elements.body&&this.elements.body.destroy()}this.model=null}catch(v){}},getColumnIndexDataIndex:function(w,y){var v=-1,x=0;w.forEach(function(z){if(z.dataIndex===y){v=x}x+=1});return v},updateTable:function(){var z,x,v,y,w=[];z=u.getAllParameters(this.fromSideDataContainer);z.forEach(function(A){if(A.getDataType()!==9){w.push(A)}},this);if(this.fromSideDataContainer&&this.toSideDataContainer){v=i.filterDFBetweenTwoActivities(this.dataFlows,this.fromSideDataContainer,this.toSideDataContainer);x=this.createViewObject(w,v)}else{if(this.fromSideDataContainer){x=this.createViewObject(w)}}if(this.fromSideDataContainer){y=this.getDataForReviewTable(x);if(this.isRerenderRequired(this.model,c,this.elements.treeListView)){this.buildTabelView(function(){this.doCRUDOnNodes(y,this.cachedViewObject,this.nodeCache,this.model);this.cachedViewObject=y}.bind(this))}else{this.doCRUDOnNodes(y,this.cachedViewObject,this.nodeCache,this.model);this.cachedViewObject=y}}else{this.unloadDocument()}},isRerenderRequired:function(x,v,w){if(!x||(v&&v.length!==w.options.columns.length)){return true}else{return false}},createViewObject:function(y,w){var z={},x,v,A;if(y&&w){y.forEach(function(B){if(B.getReference()){A=B.getReference()}else{A=B}z[B.getName()]={fromParameter:B,toParameter:{}};w.forEach(function(C){x={_parameter:B,_state:undefined,_flowDirection:undefined,_toParameter:undefined,_dataFlowIn:undefined,_dataFlowOut:undefined};if(C.getState()===a.State.Created){x._state=b.MAP}if(C._fromParameter===A){if(this.parameterPresent(z,B,C._toParameter)){z[B.getName()].toParameter[C._toParameter.getName()]._dataFlowOut=C;z[B.getName()].toParameter[C._toParameter.getName()]._flowDirection="InOut"}else{x._flowDirection="Out";if(this._toSideParameter&&this._toSideParameter.getReference()===C._toParameter){x._toParameter=this._toSideParameter;this._toParameter=undefined}else{x._toParameter=C._toParameter}if(x._toParameter.getState()===a.State.Created){x._state=b.CREATEANDMAP}x._dataFlowOut=C;v=C._toParameter.getName();z[B.getName()].toParameter[v]=x}}else{if(C._toParameter===A){if(this.parameterPresent(z,B,C._fromParameter)){z[B.getName()].toParameter[C._fromParameter.getName()]._dataFlowIn=C;z[B.getName()].toParameter[C._fromParameter.getName()]._flowDirection="InOut"}else{x._flowDirection="In";if(this._toSideParameter&&this._toSideParameter.getReference()===C._fromParameter){x._toParameter=this._toSideParameter;this._toParameter=undefined}else{x._toParameter=C._fromParameter}if(x._toParameter.getState()===a.State.Created){x._state=b.CREATEANDMAP}x._dataFlowIn=C;v=C._fromParameter.getName();z[B.getName()].toParameter[v]=x}}}}.bind(this))}.bind(this))}else{if(y){y.forEach(function(B){z[B.getName()]={fromParameter:B}})}}return z},parameterPresent:function(z,y,x){var v,w=false;if(z&&z[y.getName()]){v=z[y.getName()];if(v.toParameter&&v.toParameter[x.getName()]){w=true}else{w=false}}else{w=false}return w},getDataForReviewTable:function(y){var A,B,w,x,z,v={};if(y&&Object.keys(y).length>0){for(A in y){B=y[A].fromParameter;if(y[A].toParameter&&Object.keys(y[A].toParameter).length>0){x=y[A].toParameter;for(w in x){z=B.getName()+"_"+x[w]._toParameter.getName();v[z]={tree:B,Title:B.getName(),Mode:B._getModeName(),Type:B._getDataTypeName(),flowDirection:x[w]._flowDirection,state:x[w]._state,toParameter:this.toParameterList[w],element:x[w]}}}else{z=B.getName();v[z]={tree:B,Title:B.getName(),Mode:B._getModeName(),Type:B._getDataTypeName(),state:undefined,flowDirection:undefined,toParameter:undefined,element:undefined}}}}return v},updateNode:function(B,v,A){var w,x,z,y;x=this.createViewObject([B],v);z=this.getDataForReviewTable(x);w=this.nodeCache[A];y=Object.keys(z)[0];this.model.prepareUpdate();w.updateOptions({label:z[y].tree,grid:z[y]});this.rulesEditor.onAddRows([z[y]],0);this.model.pushUpdate();if(!z[A]){delete this.nodeCache[A];delete this.cachedViewObject[A];this.nodeCache[y]=w;this.cachedViewObject[y]=z[y];this.dispatchEvent("selectedNodeKeyChanged",[y])}},getModelLength:function(){var v=0;if(this.model&&this.model.getRoots()){v=this.model.getRoots().length}return v},addNodes:function(w){var x,v=false;if(this.model){this.model.prepareUpdate();v=w&&w.length===1;w.forEach(function(y){x=new j({label:y.tree,grid:y});this.nodeCache[y.Title]=x;this.cachedViewObject[y.Title]=y;this.model.addRoot(x)}.bind(this));this.rulesEditor&&this.rulesEditor.onAddRows(w,0);this.model.pushUpdate();if(v){this.scrollToNode(x)}}},getNodesKeyFromParameterTitles:function(w){var v=[];w.forEach(function(y){for(var x in this.nodeCache){if(this.nodeCache[x].options.grid.tree.getName()===y){v.push(y)}}}.bind(this));return v},removeNodes:function(v){this.model.prepareUpdate();v.forEach(function(w){w.node.remove()});this.model.pushUpdate()},getSelectedNodeParameter:function(){var w=this.model.getSelectedNodes(),v=[];w.forEach(function(x){if(x&&x._options&&x._options.grid&&x._options.grid.tree){v.push({parameter:x._options.grid.tree,node:x})}});return v},scrollToNode:function(v){setTimeout(function(){v&&this.elements.treeListView.getManager().scrollToNode(v);v.highlight();setTimeout(function(){v.unhighlight()},2000)}.bind(this),500)},addDataFlow:function(v){if(!this.containsObject(v,this.dataFlows)){this.dataFlows.push(v)}},removeDataFlow:function(v){var w=this.dataFlows.indexOf(v);if(w>-1){this.dataFlows.splice(w,1)}},containsObject:function(x,w){var v;for(v=0;v<w.length;v++){if(w[v]===x){return true}}return false},doCRUDOnNodes:function(v,C,B,x){var z,y=[],A=[],w=[];for(z in C){if(C.hasOwnProperty(z)){if(v[z]===undefined){y.push(z)}else{if(v[z]!==C[z]){w.push(z)}}}}for(z in v){if(v.hasOwnProperty(z)){if(C[z]===undefined){A.push(z)}}}x.prepareUpdate();y.forEach(function(D){B[D].remove();delete B[D]});w.forEach(function(D){B[D].updateOptions({label:D,grid:v[D]})});A.forEach(function(D){var E;E=v[D];x.addRoot(this.getTreeNodeModel(D,E))}.bind(this));x.pushUpdate();this.dispatchEvent("atoaTableReady",[])},getTreeNodeModel:function(v,x){var w;if(!this.nodeCache[v]){w=this.createNode(v,x)}else{w=this.nodeCache[v]}return w},createNode:function(w,x){var v;v=new j({label:x.tree,grid:x});this.nodeCache[w]=v;this.rulesEditor.onAddRows([x],0);return v},updateToParameterInCache:function(v){this.toParameterList[v.getName()]=v},_toParameterContainer:function(z){var x,y,w,v;x=document.createElement("div");x.classList.add("from-parameter");w=l.createElement("div",{title:"Click to edit","class":"from-parameter-name",html:{tag:"span",html:k.ParameterNameView(z.nodeModel.options.grid.toParameter,z.nodeModel.options.grid.state)},events:{click:function(){w.classList.add("hidden");v.classList.remove("hidden");y.value=z.nodeModel.options.grid.toParameter.getName();y.elements.container.firstElementChild.select();y.elements.container.firstElementChild.focus()}}}).inject(x);v=l.createElement("div",{"class":"from-parameter-name hidden"}).inject(x);l.createElement("span",{"class":"fonticon fonticon-trash delete-span",title:r["Dataflow.Mapping.Delete"],events:{click:function(B){B.stopImmediatePropagation();B.preventDefault();var C,A=z.nodeModel.options.grid;C=this.getNodeCacheKey(A);this.dispatchEvent("deleteDataflow",[A.element,C])}.bind(this)}}).inject(x);y=this._toParameterInput();y.addEventListener("focusout",function(){w.classList.remove("hidden");v.classList.add("hidden")});y.inject(v);return x},_toParameterInput:function(){var v=k.createControl(undefined,"lineEditor","",{readonly:false});v.elements.container.setAttribute("title",r["Dataflow.Selection.search"]);v.addEventListener("onkeyup",function(w){var x=w.target.querySelector("input").value;this.dispatchEvent("onKeyUp",[x])}.bind(this));return v},_isDirectionEditable:function(w,v){if(w&&v){var x=i.getRelationship(w,v);if(x.value===i.Relation.Parent||x.value===i.Relation.Child){return true}else{return false}}else{return false}}});return g});