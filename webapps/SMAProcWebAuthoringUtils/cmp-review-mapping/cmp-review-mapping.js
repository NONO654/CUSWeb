define("DS/SMAProcWebAuthoringUtils/cmp-review-mapping/cmp-review-mapping",["DS/SMAProcWebCommonControls/Polymer","UWA/Core","DS/SMAProcWebCommonControls/utils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebAuthoringUtils/cmp-review-mapping/ActivityToActivityTableView","DS/SMAProcWebAuthoringUtils/cmp-review-mapping/ParameterListTableView","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/JSCMM/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataContainerUtils","DS/SMAProcWebAuthoringControls/WebUXDialog","DS/SMAProcWebAuthoringUtils/ParameterUIUtil","DS/Windows/DockingElement","DS/Controls/Loader","DS/UIKIT/Iconbar","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtilsNLSUtils","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAJSCMMDataFlowUtilsNLS","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAProcWebAuthoringNLS","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","text!DS/SMAProcWebAuthoringUtils/cmp-review-mapping/cmp-review-mapping.html","DS/SMAProcWebAuthoringUtils/cmp-parameter-create/cmp-parameter-create-modal","DS/SMAProcWebCommonControls/import!DS/SMAProcSPUI/sp-button-type/sp-button-type.html","DS/SMAProcWebCommonControls/import!DS/SMAProcSPUI/sp-modal/sp-modal.html","DS/SMAProcWebCommonControls/import!DS/SMAProcSPUI/sp-notification/sp-notification.html","css!DS/SMAProcWebAuthoringUtils/cmp-review-mapping/cmp-review-mapping.css"],function(s,o,c,l,k,j,u,b,g,r,m,t,v,a,d,q,e,p,i){c.registerDomModule(i);var f=window.Polymer;var n;var h={NoneDockArea:0,TopDockArea:1<<0,BottomDockArea:1<<1,LeftDockArea:1<<2,RightDockArea:1<<3};return f({is:"cmp-review-mapping",properties:{enable:{type:Boolean,value:false},_dataFlows:{type:Array,notify:true},nodeToUpdate:{type:Object,value:undefined},parameterSelected:{type:Object,value:undefined,observer:"_parameterSelectionChanged"},paramCreate:{type:Object},hasToSideDataContainer:{type:Boolean,value:true},filters:{type:Boolean,value:false},showParameterPath:{type:Boolean,value:false}},attached:function(){this.fire(this.is+"-attached");this.paramCreate=this.$.paramCreateModal;this.$.reviewRulesEditor.style.display=this.filters?"inline-flex":"none";this.$.toolbar.style.display=this.filters?"inline-flex":"none";if(!this.runOnce){this.iconBar=new a({renderTo:this.querySelector("#reviewIconBar"),items:this.getIconItems()});this.iconBar.elements.container.dataset.enableEdit="false";this.iconBar.elements.container.dataset.enableDelete="false";this.iconBar.elements.container.dataset.enableSwap="false";this.runOnce=true}},ready:function(){this.initializeView()},initializeView:function(){this.rightDockingZone=new t({side:h.RightDockArea,dockingZoneSize:400,maxSize:600,minSize:150,autoExpandFlag:false});n=o.createElement("div",{styles:{height:"100%",width:"100%"}});this.rightDockingZone.freeZoneContent=n;this.rightDockingZone.inject(this.$.dockingZone);this.loader=new v({fadeDuration:1}).inject(this.$.loadIcon);this.loaderforSave=new v({fadeDuration:1,text:e["Saving.Changes"]}).inject(this.$.loadIcon);this.ParameterListTableView=this.createToSideParameterTree();this.ActivityToActivityTableView=this.createActivityToActivityTableView();this._modifiedParameters=[]},setDataContainers:function(x,w){if(this._fromSideDataContainer!==x){this._fromSideDataContainer&&this._fromSideDataContainer.removeParameterObservers();this.setFromSideDataContainer(x)}this.setToSideDataContainer(w)},setActivitySelection:function(x,w){if(x!==this._fromSideDataContainer||(w.length>0?w[0]:undefined)!==this._toSideDataContainer){this.fire("confirm-pending-changes",{callback:function(){this.setDataContainers(x,w.length>0?w[0]:undefined)}.bind(this),cancelCallback:function(){this.fire("update-selection-n2view",{sourceActivity:g.getFI(this._fromSideDataContainer),destinationActivities:this._toSideDataContainer?[g.getFI(this._toSideDataContainer)]:[],source:"SWAP"})}.bind(this)})}else{this.updateTable()}},setFromSideDataContainer:function(w){this._fromSideDataContainer=w;this.paramCreate=this.$.paramCreateModal;this.ActivityToActivityTableView.setFromSideDataContainer(w);this._fromSideDataContainer&&this._fromSideDataContainer.registerParameterObserver(b.State.Created,function(x){var z,y=[];x=x instanceof Array?x:[x];x&&x.forEach(function(A){z={tree:A,Title:A.getName(),Mode:A._getModeName(),Type:A._getDataTypeName(),state:undefined,flowDirection:undefined,toParameter:undefined,element:undefined};y.push(z)});this.ActivityToActivityTableView.addNodes(y);this._enableExportButton(this.iconBar)}.bind(this))},setToSideDataContainer:function(w){if(w){this._enableSwapButton(this.iconBar)}else{this._disableSwapButton(this.iconBar)}this._dataFlows=l.getDataFlowSpaceForDataContainer(this._fromSideDataContainer).value;this.ParameterListTableView&&this.ParameterListTableView.setDataContainer(w);this.ActivityToActivityTableView.setToSideDataContainer(w);if(this._toSideDataContainer!==w){this.refreshView(w)}this._toSideDataContainer=w},createToSideParameterTree:function(){return new j({elements:{tableContainer:this.rightDockingZone.elements.dockingZone},filterMode:true,filterType:true,heading:q["Dataflow.Destination.Parameters"],events:{onParameterSelect:function(B){var z,w,D,A;z=B.toParameter;w=B.xAxis;D=(w-40)+"px";A=110;if(this.parameterSelected&&l.isMappingPossibleBetweenParameters(this.parameterSelected,z)||l.isMappingPossibleBetweenParameters(z,this.parameterSelected)){this.modeChangeCancel();this.createDataFlow(this.parameterSelected,z,this.nodeToUpdate)}else{this.$.modeChangeConfirmation.classList.remove("modeChangeConfirmationbottom");var y=l.getRelationship(this._fromSideDataContainer,this._toSideDataContainer).value,E=l.isValidFromParameterMode(this.parameterSelected.getMode(),y),C=l.isValidToParameterMode(z.getMode(),y);this.$.modeChangeInfo.innerHTML="";if(!E.isValid){this.$.modeChangeInfo.appendChild(this._getModeInfoMsg(this.parameterSelected,E.details));A+=35}if(!C.isValid){this.$.modeChangeInfo.appendChild(this._getModeInfoMsg(z,C.details));A+=35}this.$.modeChangeConfirmation.style.left=D;this.$.modeChangeConfirmation.style.top=(B.yAxis-A)+"px";this.$.modeChangeConfirmation.style.display="block";this.$.modeChangeOkButton.onclick=this.modeChangeOk.bind(this,this.parameterSelected,z,this.nodeToUpdate);if((B.yAxis-A)<0){A=(B.yAxis-A)+this.$.modeChangeConfirmation.getBoundingClientRect().height+20;this.$.modeChangeConfirmation.style.top=A+"px";this.$.modeChangeConfirmation.classList.add("modeChangeConfirmationbottom")}}}.bind(this),parameterListViewScrolled:function(){this.modeChangeCancel()}.bind(this),parameterListViewCreated:function(){this.fire("parameterListViewCreated")}.bind(this)}})},createActivityToActivityTableView:function(){return new k({elements:{tableContainer:n,filterContainer:this.$.reviewRulesEditor},events:{onSelect:function(z,A,w){var x,y;this.modeChangeCancel();this.debounce("onSelectFromParameter",function(){if(this.showParameterPath){var B;if(z){B=l.getDataFlowPathForParameterPerActivity(z);if(p.isWebInWin()){p.highlightParameterDataPaths(B)}this.fire("dataPathsEvent",{dataPaths:B})}else{B=[];if(p.isWebInWin()){p.highlightParameterDataPaths(B)}this.fire("dataPathsEvent",{dataPaths:B})}}this.nodeCacheKey=A;this.parameterSelected=z;this.nodeToUpdate=w;if(this._toSideDataContainer){if(z&&A){this.rightDockingZone.collapseDockingZoneFlag=false;x=l.getMappableParameterFromFI(z,u.getAllParameters(this._toSideDataContainer));if(this.nodeToUpdate.options.grid.element){y=this.nodeToUpdate.options.grid.toParameter}if(x.length>0){this.filterToSideParameters(z,x,y)}else{this.filterToSideParameters(z,undefined,undefined)}}else{this.rightDockingZone.collapseDockingZoneFlag=true;this.filterToSideParameters(undefined,undefined,undefined)}}}.bind(this),10)}.bind(this),map:function(B){this.modeChangeCancel();var A,w,D,z=B.fromSideParameter,y=l.getRelationship(this._fromSideDataContainer,this._toSideDataContainer).value,E=l.isValidFromParameterMode(z.getMode(),y),C=l.isValidToParameterMode(B.toSideParameter.getMode(),y);w=B.xAxis;D=(w-119)+"px";A=118;if(E.isValid&&C.isValid&&this.nodeToUpdate&&this.parameterSelected){this.nodeCacheKey=B.nodeCacheKey;this.createDataFlow(z,B.toSideParameter,this.nodeToUpdate)}else{this.$.modeChangeInfo.innerHTML="";this.$.modeChangeConfirmation.classList.remove("modeChangeConfirmationbottom");if(!E.isValid){this.$.modeChangeInfo.appendChild(this._getModeInfoMsg(z,E.details));A+=35}if(!C.isValid){this.$.modeChangeInfo.appendChild(this._getModeInfoMsg(B.toSideParameter,C.details));A+=35}this.$.modeChangeConfirmation.style.left=D;this.$.modeChangeConfirmation.style.top=(B.yAxis-A)+"px";this.$.modeChangeConfirmation.style.display="block";this.$.modeChangeOkButton.onclick=this.modeChangeAndMap.bind(this,z,E,B.toSideParameter,C,y,this.nodeToUpdate);if((B.yAxis-A)<0){A=(B.yAxis-A)+this.$.modeChangeConfirmation.getBoundingClientRect().height+20;this.$.modeChangeConfirmation.style.top=A+"px";this.$.modeChangeConfirmation.classList.add("modeChangeConfirmationbottom")}}}.bind(this),createAndMap:function(A){this.modeChangeCancel();var z,w,B,y=l.getRelationship(this._fromSideDataContainer,this._toSideDataContainer).value,C=l.isValidFromParameterMode(A.parameter.getMode(),y);w=A.xAxis;B=(w-119)+"px";z=118;if(C.isValid&&this.nodeToUpdate&&this.parameterSelected){this.nodeCacheKey=A.nodeCacheKey;this._createParameterAndMap(A.parameter,y,this.nodeToUpdate)}else{this.$.modeChangeInfo.innerHTML="";this.$.modeChangeConfirmation.classList.remove("modeChangeConfirmationbottom");if(!C.isValid){this.$.modeChangeInfo.appendChild(this._getModeInfoMsg(A.parameter,C.details));z+=35}this.$.modeChangeConfirmation.style.left=B;this.$.modeChangeConfirmation.style.top=(A.yAxis-z)+"px";this.$.modeChangeConfirmation.style.display="block";this.$.modeChangeOkButton.onclick=this.modeChangeCreateAndMap.bind(this,A.parameter,C,y,this.nodeToUpdate);if((A.yAxis-z)<0){z=(A.yAxis-z)+this.$.modeChangeConfirmation.getBoundingClientRect().height+20;this.$.modeChangeConfirmation.style.top=z+"px";this.$.modeChangeConfirmation.classList.add("modeChangeConfirmationbottom")}}}.bind(this),onKeyUp:function(w){this.debounce("filterParameter",function(){this.ParameterListTableView&&this.ParameterListTableView.filterParameters(w)}.bind(this),200)}.bind(this),deleteDataflow:function(w,x){if(this.nodeToUpdate&&this.nodeToUpdate.options.grid.element&&this.parameterSelected){this.nodeCacheKey=x;if(w._dataFlowOut){this._deleteDataflow(w._dataFlowOut)}if(w._dataFlowIn){this._deleteDataflow(w._dataFlowIn)}this.ActivityToActivityTableView.updateNode(w._parameter,undefined,this.nodeCacheKey);this.ParameterListTableView.updateNode(w._toParameter)}}.bind(this),onDirectionChange:function(y){var z,x,w;w=y.nodeToUpdate;x=y.grid;z=y.value;this.nodeCacheKey=y.nodeCacheKey;this._changeMappingDirection(x,z,w)}.bind(this),selectedNodeKeyChanged:function(w){this.nodeCacheKey=w}.bind(this),filterFocusOut:function(){this.ParameterListTableView&&this.ParameterListTableView.filterParameters("")}.bind(this),atoaTableReady:function(){var w=this.ActivityToActivityTableView.getModelLength();if(w===0){this._disableExportButton(this.iconBar)}else{this._enableExportButton(this.iconBar)}}.bind(this)}})},getIconItems:function(){var w=[{fonticon:"exchange",text:q["Dataflow.SwapActivities"],className:"swap-activities",handler:this.swapActivities.bind(this)},{className:"divider"},{fonticon:"plus",text:q["Parameter.Add.QuickToTable"],handler:this.onAddDefaultParameter.bind(this)},{fonticon:"compare-add",text:q["Parameter.Add.Multiple"],handler:this.onAdd.bind(this)},{fonticon:"pencil",text:q["Parameter.EditSingle"],className:"parameter-edit",handler:this.onEdit.bind(this)},{fonticon:"trash",className:"parameter-delete",text:q["Parameter.DeleteSingle"],handler:this.onRemove.bind(this)},{fonticon:"import",text:q["Parameter.Import"],selectable:true,handler:this.onImport.bind(this)},{fonticon:"export",text:q["Parameter.Export"],selectable:true,className:"parameter-export",handler:this.onExportParam.bind(this)}];if(localStorage.getItem("SIMPRCW_AP_ENABLE_EXPERIMENTS")==="true"){var x={fonticon:"flow-children",text:q["Dataflow.ParameterPath"],id:"dataflowParameterPath",handler:this.toggleDataPathMode.bind(this)};w.splice(2,0,x)}return w},onAddDefaultParameter:function(){if(this._fromSideDataContainer){m.createDefaultParameter(this._fromSideDataContainer)}},onAdd:function(){this.paramCreate.setDataContainer(this._fromSideDataContainer)},onEdit:function(){var x=[],w=this.ActivityToActivityTableView.getSelectedNodeParameter();w.forEach(function(y){x.push(y.parameter)});this.paramCreate.setDataContainer(this._fromSideDataContainer,x,function(z,y){if(y&&y.length>0){y.forEach(function(A){this.ActivityToActivityTableView.removeDataFlow(A)}.bind(this))}z.forEach(function(E){this.ActivityToActivityTableView.rulesEditor.onAddRows([{Type:E._getDataTypeName(),Mode:E._getModeName()}]);var D,B,C=[],A;D=this.getNodeFromParameter(w,E);B=D.options.grid.element;if(B&&(B._dataFlowIn||B._dataFlowOut)){A=B._toParameter;if(B._dataFlowIn){if(l.isMappingPossibleBetweenParameters(A,E)){C.push(B._dataFlowIn)}else{this.ActivityToActivityTableView.removeDataFlow(B._dataFlowIn)}}if(B._dataFlowOut){if(l.isMappingPossibleBetweenParameters(E,A)){C.push(B._dataFlowOut)}else{this.ActivityToActivityTableView.removeDataFlow(B._dataFlowOut)}}}this.updateModifiedParametersList(E)}.bind(this));this.ActivityToActivityTableView.updateTable()}.bind(this))},onRemove:function(){var y=this.ActivityToActivityTableView.getSelectedNodeParameter();if(!(y&&y.length>0)){this.$.notification.logMessage({type:"warning",text:q["Parameter.Select"],autoRemove:true})}var C=[],x=[],w=[],z,D="",B="-----------------------------------------------";y.forEach(function(E){C.push(E.parameter)});x=l.getDataFlowsForParameters(C);x.fromSide.forEach(function(E){var H=E._fromParameter.getName();var F=E._toParameter.getName();var G=E._toParameter.getParent().getName();if(D!==H&&w.length>0){w.push(B)}D=H;w.push(H+" -> "+G+"."+F)});x.toSide.forEach(function(E){var H=E._fromParameter.getName();var F=E._toParameter.getName();var G=E._fromParameter.getParent().getName();if(D!==H&&w.length>0){w.push(B)}D=H;w.push(F+" <- "+G+"."+H)});if(w[w.length-1]===B){w.pop()}if(w.length>0){var A=q["Dataflow.DeleteParameter.MappingWarning"]+"\n";for(z=0;z<w.length;z++){A+="\n\t"+w[z]}A+="\n";this.$.deleteMessage.innerText=A;this.$.mappedParameterDialog.show()}else{this.removeParameters()}},disableParameterPath:function(){this.showParameterPath=false;try{this.querySelector("#dataflowParameterPath").style.color=""}catch(w){}},onImport:function(){var w=this;if(!w._fromSideDataContainer){throw new Error(q["Parameter.Import.MissingContainer"])}this.xmlFileChooser()},xmlFileChooser:function(){var x=this;var w;var z="";var y=s.dom(x.root).querySelector("#contentChooserFile");y.onclick=function(){y.value=""};y.onchange=function(){if(y.files.length>1){z=q["Parameter.Import.SelectOneFile"];x.importParameterNotifications(x,z,"error",false);return}w=y.files[0];if(y.value){x.xmlFileReader(w,function(A){var C;x.importParameters=function(D){x.$.overwriteDialog.hide();C=u.importParametersFromXml(x._fromSideDataContainer,A,D,function(F){if(D&&F.modified_params.length>0){var E=x.ActivityToActivityTableView.getNodesKeyFromParameterTitles(F.overriden_params_names);for(var G=0;G<E.length;G++){x.ActivityToActivityTableView.updateNode(F.modified_params[G],undefined,E[G])}}x.displayEndMessage(x,F)});if(typeof C==="string"){x.importParameterNotifications(x,C,"error",true)}};var B=u.getAllParameters(x._fromSideDataContainer);if(B.length>0){x.$.overwriteDialog.show();x.$.overwriteDialog.querySelector("#replaceButton").onclick=function(){x.importParameters(true)};x.$.overwriteDialog.querySelector("#discardReplace").onclick=function(){x.importParameters(false)}}else{x.importParameters(false)}})}};y.click()},xmlFileReader:function(y,z){var x,w=new FileReader();if(y){w.readAsText(y,"UTF-8")}w.onload=function(A){x=A.target.result;z(x)}},displayEndMessage:function(x,w){x.imported_count=(w.newlyCreated_params.length+w.overriden_params_names.length);x.newlyCreated_count=w.newlyCreated_params.length;x.overriden_count=w.overriden_params_names.length;x.discarded_count=w.discarded_params.length;x.failed_count=w.failed_params.length;x.$.importProcessCompletionDialog.show();x.$.importProcessCompletionDialog.querySelector("#downloadbutton").onclick=function(){u.downloadXmlFile(w.endMessage,"ParameterImport.log")};x.$.importProcessCompletionDialog.querySelector("#closeButton").onclick=function(){x.$.importProcessCompletionDialog.hide()}},importParameterNotifications:function(w,A,y,x){var z={};z.text=A;z.type=y;z.autoRemove=x;w.$.notification.logMessage(z)},onExportParam:function(){var w=this;var x="SimulationParameters.xml";u.exportParametersToXml(this._fromSideDataContainer,x,function(){w.$.notification.logMessage({type:"info",text:q["Parameter.Export.Complete"],autoRemove:true})})},getNodeFromParameter:function(w,y){var x;w.forEach(function(z){if(z.parameter===y||z.parameter===y.getReference()){x=z.node}});return x},removeParameters:function(){var y=[];var w=this.ActivityToActivityTableView.getSelectedNodeParameter();if(w&&w.length>0){w.forEach(function(z){u.deleteParameter(z.parameter);y.push(z.parameter)});this.fire("parameterRemoved",y);this.updateTable()}var x=this.ActivityToActivityTableView.getModelLength();if(x===0){this._disableExportButton(this.iconBar)}this.$.mappedParameterDialog.hide()},swapActivities:function(){this.fire("update-selection-n2view",{sourceActivity:g.getFI(this._toSideDataContainer),destinationActivities:this._fromSideDataContainer?[g.getFI(this._fromSideDataContainer)]:[],source:"SWAP"})},toggleDataPathMode:function(){this.showParameterPath=!this.showParameterPath;if(this.showParameterPath){var w=this.ActivityToActivityTableView.getSelectedNodeParameter();if(w.length>0){var y=w[0].parameter,x=l.getDataFlowPathForParameterPerActivity(y);if(p.isWebInWin()){p.highlightParameterDataPaths(x)}this.fire("dataPathsEvent",{dataPaths:x})}this.querySelector("#dataflowParameterPath").style.color="#368ec4"}else{this.fire("dataPathsEvent",{dataPaths:null});p.highlightParameterDataPaths(null);this.querySelector("#dataflowParameterPath").style.color=""}},onCloseConfirmation:function(w){w.stopPropagation()},onCancelConfirmation:function(){this.$.mappedParameterDialog.hide()},refreshView:function(w){this.modeChangeCancel();if(w){this.rightDockingZone.dockingZoneSize=260;this.rightDockingZone.resizableFlag=true;this.rightDockingZone.collapseDockingZoneFlag=true}else{this.rightDockingZone.collapseDockingZoneFlag=false;this.rightDockingZone.dockingZoneSize=260;this.rightDockingZone.resizableFlag=false;this.hasToSideDataContainer=false}this.ActivityToActivityTableView.updateTable()},modeChangeCancel:function(){this.$.modeChangeConfirmation.style.display="none"},modeChangeOk:function(C,x,A){var F,B,y,D,E,z,w;y=l.getRelationship(this._fromSideDataContainer,this._toSideDataContainer).value;F=l.isValidFromParameterMode(C.getMode(),y);B=l.isValidToParameterMode(x.getMode(),y);if(!F.isValid){D=b.Mode.client.properties[F.details.to].name;w=m.modifyParameter(C,{name:"Mode",value:D},true);this.parameterSelected=w;this.updateModifiedParametersList(w)}else{w=C}if(!B.isValid){E=b.Mode.client.properties[B.details.to].name;z=m.modifyParameter(x,{name:"Mode",value:E},true);this._toSideParameter=z;this.ActivityToActivityTableView.updateToParameterInCache(z)}else{z=x}if(y===l.Relation.SiblingDownstream&&l.isMappingPossibleBetweenParameters(z,w)){this.createDataFlow(w,z,A)}else{if(l.isMappingPossibleBetweenParameters(w,z)){this.createDataFlow(w,z,A)}}this.$.modeChangeConfirmation.style.display="none"},modeChangeCreateAndMap:function(A,y,w,x){var z,B;if(!y.isValid){z=b.Mode.client.properties[y.details.to].name;B=m.modifyParameter(A,{name:"Mode",value:z},true);this.parameterSelected=B}this._createParameterAndMap(B,w,x);this.$.modeChangeConfirmation.style.display="none"},modeChangeAndMap:function(C,z,x,E,y,B){var D,w=C,F,A=x;if(!z.isValid){D=b.Mode.client.properties[z.details.to].name;w=m.modifyParameter(C,{name:"Mode",value:D},true);this.parameterSelected=w;this.updateModifiedParametersList(w)}if(!E.isValid){F=b.Mode.client.properties[E.details.to].name;A=m.modifyParameter(x,{name:"Mode",value:F},true);this._toSideParameter=A;this.ActivityToActivityTableView.updateToParameterInCache(A)}this.createDataFlow(w,A,B);this.$.modeChangeConfirmation.style.display="none"},filterToSideParameters:function(z,x,y){var w={};if(x){x.forEach(function(A){w[A.getName()]=A});this.ParameterListTableView.updateTable(z,w,y)}else{this.ParameterListTableView.updateTable(z,{},undefined)}},createDataFlow:function(C,y,x){var z,A,w,B,D;if(C&&x&&!x.options.grid.element){D=this._createDataFlow(C,y)}else{if(x&&C&&x.options.grid.element&&(x.options.grid.element._dataFlowIn||x.options.grid.element._dataFlowOut)){z=x.options.grid.element._dataFlowIn;A=x.options.grid.element._dataFlowOut;if(z){w=this._deleteDataflow(z)}if(A){B=this._deleteDataflow(A)}if(w||B){D=this._createDataFlow(C,y)}}}if(D){this.ActivityToActivityTableView.updateNode(C,D,this.nodeCacheKey);this.ActivityToActivityTableView.updateTable();this.ParameterListTableView.updateNode(y,y)}},onConfirmDirectionChange:function(){var x,C,B,z,D,y,E,F,w,A;x=this.$.changeMode.options.grid;C=this.$.changeMode.options.direction;B=this.$.changeMode.options.nodeToUpdate;z=x.element;D=x.tree;y=x.toParameter;if(D.getMode()!==b.Mode.InOut){E=b.Mode.client.properties[b.Mode.InOut].name;w=m.modifyParameter(D,{name:"Mode",value:E},true);this.updateModifiedParametersList(w)}else{w=D}if(y.getMode()!==b.Mode.InOut){F=b.Mode.client.properties[b.Mode.InOut].name;A=m.modifyParameter(y,{name:"Mode",value:F},true);this._toSideParameter=A;this.ActivityToActivityTableView.updateToParameterInCache(A)}else{A=y}this._changeDirection(w,A,C,z,B);this.$.changeMode.hide()},onCancelDirectionChange:function(x){x.stopPropagation();var w=this.$.changeMode.options.grid.element,y=[];w._dataFlowOut&&y.push(w._dataFlowOut);w._dataFlowIn&&y.push(w._dataFlowIn);this.ActivityToActivityTableView.updateNode(w._parameter,y,this.nodeCacheKey);this.$.changeMode.hide()},_createParameterAndMap:function(A,x,y){var z,w;z=l.getMinValidModeToCreateMapping(x);w=m.cloneParameterWithMode(A,this._toSideDataContainer,z);this.ActivityToActivityTableView.updateToParameterInCache(w);this.ParameterListTableView.updateNode(w,w);this.createDataFlow(A,w,y)},_createDataFlow:function(y,w,z){var x,A=[];x=this.getDataContainerToSaveDataFlow(y.getParent(),w.getParent());if(z){if(z==="In"){A.push(l.addDataflow(l.createDataFlowObject(w,y),x))}else{if(z==="Out"){A.push(l.addDataflow(l.createDataFlowObject(y,w),x))}}}else{if(y.getMode()===b.Mode.InOut&&w.getMode()===b.Mode.InOut&&l.isMappingPossibleBetweenParameters(y,w)&&l.isMappingPossibleBetweenParameters(w,y)){A.push(l.addDataflow(l.createDataFlowObject(y,w),x));A.push(l.addDataflow(l.createDataFlowObject(w,y),x))}else{if(l.isMappingPossibleBetweenParameters(y,w)){A.push(l.addDataflow(l.createDataFlowObject(y,w),x))}else{if(l.isMappingPossibleBetweenParameters(w,y)){A.push(l.addDataflow(l.createDataFlowObject(w,y),x))}}}}A.forEach(function(B){this.ActivityToActivityTableView.addDataFlow(B)}.bind(this));return A},_deleteDataflow:function(x){var w=l.deleteDataflow(x,x.getParent());this.ActivityToActivityTableView.removeDataFlow(x);return w},_changeMappingDirection:function(z,B,x){var A,w,y,C;y=z.element;A=z.tree;w=z.toParameter;if(A.getMode()===b.Mode.InOut&&w.getMode()===b.Mode.InOut){this._changeDirection(A,w,B,y,x)}else{this.$.changeMode.options={direction:B,grid:z,nodeToUpdate:x};C=q["Dataflow.Mapping.ModeChange"]+"\n";this.$.changeModeMessage.innerText=C;this.$.changeModeMessageLi.innerHTML="";if(A.getMode()!==b.Mode.InOut){this.$.changeModeMessageLi.appendChild(this._getModeInfoMsg(A,{from:A.getMode(),to:b.Mode.InOut}))}if(w.getMode()!==b.Mode.InOut){this.$.changeModeMessageLi.appendChild(this._getModeInfoMsg(w,{from:w.getMode(),to:b.Mode.InOut}))}this.$.changeMode.show()}},_changeDirection:function(y,w,z,x){var A,B=[];if(z==="In"&&l.isMappingPossibleBetweenParameters(w,y)){if(x._dataFlowOut){this._deleteDataflow(x._dataFlowOut)}if(x._dataFlowIn){B.push(x._dataFlowIn)}else{A=this._createDataFlow(y,w,"In");A.forEach(function(C){B.push(C)})}}else{if(z==="Out"&&l.isMappingPossibleBetweenParameters(y,w)){if(x._dataFlowIn){this._deleteDataflow(x._dataFlowIn)}if(x._dataFlowOut){B.push(x._dataFlowOut)}else{A=this._createDataFlow(y,w,"Out");A.forEach(function(C){B.push(C)})}}else{if(z==="InOut"&&l.isMappingPossibleBetweenParameters(w,y)&&l.isMappingPossibleBetweenParameters(y,w)){if(x._dataFlowOut){B.push(x._dataFlowOut)}else{A=this._createDataFlow(y,w,"Out");A.forEach(function(C){B.push(C)})}if(x._dataFlowIn){B.push(x._dataFlowIn)}else{A=this._createDataFlow(y,w,"In");A.forEach(function(C){B.push(C)})}}}}if(B.length>0){this.ActivityToActivityTableView.updateNode(y,B,this.nodeCacheKey);this.ParameterListTableView.updateNode(w,w)}},_getModeInfoMsg:function(y,x){var w;w=document.createElement("li");w.innerText=d.translate("Dataflow.Mapping.ModeChangeMessage",y.getParent().getName()+"."+y.getName(),b.Mode.client.properties[x.from].name,b.Mode.client.properties[x.to].name);return w},_parameterSelectionChanged:function(){if(this.parameterSelected){this._enableEditButton(this.iconBar);this._enableDeleteButton(this.iconBar)}else{this._disableEditButton(this.iconBar);this._disableDeleteButton(this.iconBar)}},_enableExportButton:function(w){w.elements.container.dataset.enableExport="true";w.overflowMenu.elements.container.dataset.enableExport="true"},_disableExportButton:function(w){w.elements.container.dataset.enableExport="false";w.overflowMenu.elements.container.dataset.enableExport="false"},_enableEditButton:function(w){w.elements.container.dataset.enableEdit="true";w.overflowMenu.elements.container.dataset.enableEdit="true"},_enableDeleteButton:function(w){w.elements.container.dataset.enableDelete="true";w.overflowMenu.elements.container.dataset.enableDelete="true"},_disableEditButton:function(w){w.elements.container.dataset.enableEdit="false";w.overflowMenu.elements.container.dataset.enableEdit="false"},_disableDeleteButton:function(w){w.elements.container.dataset.enableDelete="false";w.overflowMenu.elements.container.dataset.enableDelete="false"},_enableSwapButton:function(w){w.elements.container.dataset.enableSwap="true";w.overflowMenu.elements.container.dataset.enableSwap="true"},_disableSwapButton:function(w){w.elements.container.dataset.enableSwap="false";w.overflowMenu.elements.container.dataset.enableSwap="false"},getDataContainerToSaveDataFlow:function(y,w){var x,z;x=l.getRelationship(y,w);z=l.getDataFlowDataContainerForDataContainers(y,w,x.value);return z},clear:function(){this._fromSideDataContainer=undefined;this._toSideDataContainer=undefined;this._modifiedParameters=[];this.unloadTable()},unloadTable:function(){this.ActivityToActivityTableView&&this.ActivityToActivityTableView.unloadDocument();this.ParameterListTableView&&this.ParameterListTableView.unloadDocument()},commitChanges:function(){this.showLoadingIdicatorforSave();var y,x,w;x=this._fromSideDataContainer;w=this._toSideDataContainer;if(w){y=this.getDataContainerToSaveDataFlow(x,w)}return new Promise(function(A,z){this.saveAllParameters(x,w).then(function(){var B=this.getOrigParameters(x,this._modifiedParameters);this.fire("parameterModified",B);this._modifiedParameters=[];if(y){this.getPromiseForSaveDataFlow(y).then(function(){this.hideLoadingIdicatorforSave();A()}.bind(this))["catch"](function(){this.hideLoadingIdicatorforSave();z()}.bind(this))}else{this.hideLoadingIdicatorforSave();A()}}.bind(this))}.bind(this))},getOrigParameters:function(B,y){var z=B.getParameters();var A=[];if(y.length>0){for(var x=0;x<y.length;x+=1){for(var w=0;w<z.length;w+=1){if(y[x].getId()===z[w].getId()){A.push(z[w]);break}}}}return A},updateModifiedParametersList:function(y){var x=false;for(var w=0;w<this._modifiedParameters.length;w+=1){if(this._modifiedParameters[w].getId()===y.getId()){this._modifiedParameters[w]=y;x=true}}if(!x){this._modifiedParameters.push(y)}},getPromiseForSaveDataFlow:function(w){return new Promise(function(y,x){l.saveAllDataFlows([w],{onSuccess:function(z){var A=new CustomEvent("refreshnTwoViewWebinWinEditor",{bubbles:true,detail:{}});this.dispatchEvent(A);y(z)}.bind(this),onFailure:function(z){this.$.notification.logMessage({type:"error",text:q["Dataflow.SaveError"],autoRemove:false});x(z)}.bind(this)})}.bind(this))},saveAllParameters:function(y,x){var w=[];if(y){w.push(y)}if(x){w.push(x)}return new Promise(function(A,z){u.saveAllParameters(w,{onSuccess:function(B){A(B)},onFailure:function(B){this.$.notification.logMessage({type:"error",text:B,autoRemove:false});z(B)}.bind(this)})}.bind(this))},discardChanges:function(){return new Promise(function(x,w){this.abortChanges();x()}.bind(this))},abortChanges:function(){var w=this.getAffectedDataContainers();this._modifiedParameters=[];w.forEach(function(x){l.clearTemporaryDataflows(x);u.clearTemporaryParameters(x)})},updateTable:function(){this.ActivityToActivityTableView.updateTable()},refreshAtoAView:function(w){this.ActivityToActivityTableView.refreshDataFlowCache();this.ActivityToActivityTableView.refreshToSideParameterCache();this.updateTable()},showLoadingIdicatorforSave:function(){this.$.loadContainer.classList.add("loadContainer");for(var w=0;w<document.getElementsByClassName("wux-windows-dialog-footer").length;w++){document.getElementsByClassName("wux-windows-dialog-footer")[w].style["pointer-events"]="none"}this.loaderforSave.on()},hideLoadingIdicatorforSave:function(){setTimeout(function(){if(this.loaderforSave){this.loaderforSave.off();this.$.loadContainer.classList.remove("loadContainer");for(var w=0;w<document.getElementsByClassName("wux-windows-dialog-footer").length;w++){document.getElementsByClassName("wux-windows-dialog-footer")[w].style["pointer-events"]=""}}}.bind(this),500)},exitReviewMode:function(){this.refreshView(undefined);this.fire("review-mapping-closed")},isDirty:function(){var w=false,x=[];x=this.getAffectedDataContainers();x.forEach(function(y){if(g.hasTemporaryData(y)){w=true}});return w},getAffectedDataContainers:function(){var w=[];if(this._fromSideDataContainer){w.push(this._fromSideDataContainer)}if(this._toSideDataContainer){w.push(this._toSideDataContainer);w.push(this.getDataContainerToSaveDataFlow(this._fromSideDataContainer,this._toSideDataContainer))}return w},dialogResized:function(){this.iconBar.resize()}})});