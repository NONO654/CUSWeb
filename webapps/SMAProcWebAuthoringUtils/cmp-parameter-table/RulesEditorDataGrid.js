define("DS/SMAProcWebAuthoringUtils/cmp-parameter-table/RulesEditorDataGrid",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/SMAProcSPUI/Views/Select","css!DS/SMAProcWebAuthoringUtils/cmp-parameter-table/RulesEditorDataGrid.css"],function(f,c,e,b,d){var a={defaultOptions:{spreadsheet:null,searchDelay:2500},isActive:true,loadIndicatorActive:false,searchHiddenColumns:false,currentSelection:{},searchTimeout:null,filterTimer:null,spreadsheetPreferences:null,init:function(g){this._parent(g);this.controls={};this.buildSkeleton()},buildSkeleton:function(){var l=this,i=this.options,m=this.elements,g,j;this.searchHiddenColumns=i.searchHiddenColumns?i.searchHiddenColumns:false;this.container=m.container=i.container;g=this.getFields();g.forEach(function(o){j=l.fieldBuilders[o.type](o,l);l.controls[j.getName()]=j;var n=o.isSearchable?"inline":"form-group";var p="";if(o.placeholder.indexOf("Filter ")>-1){p=o.placeholder}else{p="Filter "+o.placeholder}f.createElement("div",{"class":n,title:p,html:j}).inject(m.container)});var h={attributes:{autocomplete:"off",autocorrect:"off",autocapitalize:"off",events:{keyup:function(p){var o=p.target.value;var n=l.controls[this.name].getValue();if(!this.oldValue){n="";this.oldValue=p.target.value}else{o=p.target.value;n=this.oldValue;this.oldValue=o}if(o!==n){l.showLoadIndicator();window.clearTimeout(l.searchTimeout);l.searchTimeout=window.setTimeout(function(){l.dispatchEvent("onSearch")},l.options.searchDelay)}}}},id:"input-"+c.getUUID().substring(0,6),className:"text form-group",type:"text",name:"Filter",placeholder:"Filter"};l.controls[h.name]=new b(h).inject(m.container);f.createElement("div",{"class":"spreadsheet-header-button fonticon fonticon-clear ",title:"Clear Filters",events:{click:function(){c.toArray(l.controls).forEach(function(n){if(n.options.type==="select"){n.clear(false)}else{if(n.options.type==="text"){n.setValue("")}}});l.reset=true}}}).inject(m.container);if(i.show.download){var k=f.createElement("div",{"class":"header-button"}).inject(m.container);m.container.buttons=k;m.downloadButton=f.createElement("div",{"class":"spreadsheet-header-button fonticon fonticon-download",events:{click:function(n){l.dispatchEvent("downloadJobLog");n.stopImmediatePropagation()}}}).inject(m.container.buttons);m.downloadButton.setAttributes({title:"Export to CSV"})}},_getDistinctValuesFromColumn:function(g){var i=this.options.spreadsheet.model,j=i.length,k=[],n={},m,l=0,h;for(l=0;l<j;l+=1){m=i[l];h=m.options.grid[g];if(n[h]===undefined){n[h]=true;k.push(h)}}return k},getFields:function(){var j=this,i=this.options.spreadsheet,g=[],h;h=i.columns;h=h.filter(function(k){return k.isFilterable===true});h.forEach(function(k){var m={type:"select",name:k.dataIndex,placeholder:k.text,multiple:true},l=j._getDistinctValuesFromColumn(k.text);m.options=Array.prototype.map.call(l,function(n){return{label:n,value:n}});g.push(m)});return g},fieldBuilders:{text:function(i,j){var h,g={attributes:{autocomplete:"off",autocorrect:"off",autocapitalize:"off",events:{keyup:function(){j.showLoadIndicator();window.clearTimeout(j.searchTimeout);j.searchTimeout=window.setTimeout(function(){j.dispatchEvent("onSearch")},j.options.searchDelay)}}},id:"input-"+c.getUUID().substring(0,6),className:"text"};h=new b(f.extend(i,g,true));return h},select:function(i,j){var h,g={id:"input-"+c.getUUID().substring(0,6),events:{onChange:function(){j.showLoadIndicator();window.clearTimeout(j.searchTimeout);j.searchTimeout=window.setTimeout(function(){j.dispatchEvent("onSearch")},j.options.searchDelay)}}};h=new d(f.merge(i,g));return h}},onSearch:function(){this._buildRules();this._applyRules(0)},showLoadIndicator:function(){},hideLoadIndicator:function(){},_buildRules:function(){var g=this;this.rules=[];c.toArray(g.controls).forEach(function(k){if(!k.isDisabled()){var i=k.getName(),h=k.getValue(),j=k.options.type;g.buildRule(i,h,j,false)}})},buildRule:function(h,g,i,j){var k;if(j){this.rules=[]}if(g.length>0){k={name:h,values:c.splat(g),active:true}}else{k={name:h,values:[],active:false}}if(i==="select"){k.operator="is"}else{if(i==="text"){k.operator="contains"}}if(this.rules){this.rules.push(k)}else{this.rules=[k]}},_applyRules:function(k){var m=this,h=m.options.spreadsheet,l=this.options.spreadsheet.getTreeDocument(),o=this.rules||[],j=h.columns,n=[];j.forEach(function(p){if(!p.isHidden){n.push(p.dataIndex)}});var i=function(){l.pushUpdate();m.hideLoadIndicator();var p=false;if(m.reset){p=true;m.reset=false}m.dispatchEvent("onSearchEnd",{reset:p})};var g=function(s,r){var q=o.every(function(v){if(v.active){var t=l.getNthRoot(r);var u=v.values.some(function(A){switch(v.operator){case"is":var w=t.options.grid[v.name];return A===w;case"contains":var z=false;try{var C=new RegExp(A.toLowerCase());var y=t.options.grid;for(var x in y){if(y.hasOwnProperty(x)&&(m.searchHiddenColumns||n.indexOf(x)>-1)){var D=String(y[x]);if(D&&C.test(D.toLowerCase())){z=true;break}}}}catch(B){z=true}return z;default:return !v.active||(Boolean(A)&&w===A)}});return u}else{return true}});var p=l.getNthRoot(r);if(p){if(q){p.isHidden()&&p.show()}else{!p.isHidden()&&p.hide(true)}}};l.prepareUpdate();this._timedProcessRows(g,i,{minRowID:k})},onToggle:function(){var g=!this.isActive;this.elements.container.toggleClassName("active",g);this.isActive=g},_timedProcessRows:function(n,h,p,g){var j=this.options.spreadsheet.getTreeDocument(),i={minRowID:0,maxRowID:j.getRoots().length},m=80,k=20,l,o;p=p||{};p=f.extend(i,p);l=p.minRowID;this.filterTimer=setTimeout(function(){var q=new Date();while(l<p.maxRowID){o=this.options.spreadsheet.model[l];n.call(g?g:o,o,l);l++;if(new Date()-q>m){break}}if(l<p.maxRowID){this.filterTimer=setTimeout(arguments.callee,k)}else{if(h){h.call(g)}}}.bind(this),k)},onAddRows:function(j,k){var i=this,h=this.options.spreadsheet;var g=h.columns;g=g.filter(function(l){return l.isFilterable===true});g.forEach(function(l){j.forEach(function(q){var m=l.dataIndex,p=i.controls[m],n={label:q[m],value:q[m]},o=Boolean(p.getOption(n));if(!o){p.addOption(n)}})});this._applyRules(k)},destroy:function(){var k=this;this.filterTimer&&clearTimeout(this.filterTimer);if(this.spreadsheetPreferences){this.spreadsheetPreferences.destroy()}try{c.toArray(k.controls).forEach(function(i){i.removeEvents();i.destroy()})}catch(g){console.log(g)}var j=this.elements.container&&this.elements.container.children;if(j&&j.length>0){for(var h=j.length-1;h>=0;h-=1){this.elements.container.removeChild(j[h])}}k.controls={}}};return e.extend(a)});