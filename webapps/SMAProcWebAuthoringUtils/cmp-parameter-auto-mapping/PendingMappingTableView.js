define("DS/SMAProcWebAuthoringUtils/cmp-parameter-auto-mapping/PendingMappingTableView",["UWA/Core","UWA/Controls/Abstract","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAJSCMMDataFlowUtilsNLS","DS/SMAProcWebContents/WUXControlUtil","DS/JSCMM/SMAJSCMMUtils","css!DS/SMAProcWebAuthoringUtils/cmp-parameter-auto-mapping/PendingMappingTableView.css","css!DS/UIKIT/UIKIT.css"],function(i,f,e,a,d,h,g,c){var j,b;j=function(p){var l,k,m,n;if(!p.isHeader){m=p.cellModel.options.value;n=m.toParameter?m.toParameter.getName():p.nodeModel._options.label;k=document.createElement("div");if(m.error||m.isValidAfterFromModeChange||m.isValidAfterToModeChange){i.createElement("span",{"class":"fonticon fonticon-block danger"}).inject(k)}else{if(m.isValidAfterToCreate){i.createElement("span",{"class":"fonticon fonticon-new-create green"}).inject(k)}else{if(m.mappingAlreadyAvailable){i.createElement("span",{"class":"fonticon fonticon-parameter-mapping-ok"}).inject(k)}else{if(m.isValidForMapping){i.createElement("span",{"class":"fonticon fonticon-parameter-mapping green"}).inject(k)}}}}var o=p.cellModel.options.value&&p.cellModel.options.value.modeForNewToParam;var r=p.cellModel.options.value.toParameter;if(r){o=r.getMode()}if(o!==null&&o!==undefined){var q=c.Mode.client.properties[o].name;i.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-1x "+g._getModeIcon(o),title:q,styles:{color:"#b4b6ba",width:"14px"}}).inject(k)}l=document.createElement("span");l.textContent=n;k.appendChild(l);p.cellView.elements.container.setContent(k)}return k};b=f.extend({name:"PendingMappingTableView",init:function(k){this._parent(k);this._initDefaultOptions();this.cleanAndRebuildTable(k.fromSideDataContainer,[],{})},_initDefaultOptions:function(){this.mappingCache={};this.nodeCahce={};this.fromActivityName="";this.toSideDataContainers=[]},getColumnsObject:function(n,m){var l=[];l=[{dataIndex:"tree",text:n,width:220,isDraggable:false,isEditable:false}];for(var k=0;k<m.length;k++){l.push({dataIndex:m[k].getId(),text:m[k].getName(),width:220,isDraggable:false,isEditable:false,onCellRequest:j.bind(this)})}return l},getTreeListViewObject:function(k){return new e({columns:k,defaultCellHeight:30,resize:{rows:false,columns:true},showVerticalLines:true,useTransparentScroller:false,alternateRowColor:true,isEditable:false,iconsSize:22,isSortable:true,enableActiveUI:false,enableKeyboardNavigation:false,show:{rowHeaders:false,columnHeaders:true},selection:{nodes:false,cells:true,rowHeaders:true,columnHeaders:true,unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true},performances:{buildLinks:false,useRequestAnimationFrameRendering:false,debounceCellRequest:true,debounceCellInternalUpdateTimer:10},showLoaderIndicator:true,enableDragAndDrop:false,shouldAcceptDrag:function(){return false},shouldDisplayTooltip:this.getToolTipMsg.bind(this),height:"auto",apiVersion:"2",allowUnsafeHTMLContent:false})},getToolTipMsg:function(m){var k="";var l=m.cellModel.options.value;if(l.error){k=k+=l.error.type==="INVALID_RELATIONSHIP"?l.error.details.errorStr:"";k=k+=l.error.type==="INVALID_STRUCTURE"?l.error.details.errorStr:"";k=k+=l.error.type==="INVALID_DATATYPE"?l.error.details.errorStr:"";k=k+=l.error.type==="ALREADY_MAPPED"?l.error.details.errorStr:"";k=k+=l.error.type==="SEQUENCE_BROKEN"?h["Dataflow.Mapping.SequenceBroken"]:""}else{if(l.isValidAfterFromModeChange||l.isValidAfterToModeChange){k=k+=h["Dataflow.Mapping.ModeChangeSuggestion"]}else{if(l.isValidAfterToCreate){k=h["Dataflow.Mapping.CreateAndMap"]}else{if(l.mappingAlreadyAvailable){k=h["Dataflow.Mapping.AlreadyMapped"]}else{if(l.isValidForMapping){k=h["Dataflow.Mapping.toBeCreated"]}}}}}return{longHelp:k}},isRerenderRequired:function(n,o,q,p,l){var k=false,m;k=q!==p;if(!l){k=true}if(!k){k=o.length!==n.length;if(!k){for(m=0;m<o.length;m++){if(o[m]!==n[m]){k=true;break}}}}return k},_buildPendingMappingView:function(k,m,n){m.classList.add("wux-controls-input-output");k.elements.container.addClassName("wux-controls-automapping-table-view");this.elements.body=new i.createElement("div",{"class":"wux-controls-automapping-body",html:[{tag:"div",styles:{position:"relative",height:"100%"},html:k}]});this.elements.body.inject(m);var l=k.getManager();l.onReady(function(){n()})},_loadDocument:function(n,l,o){var k,m;this.model=k=new a({useAsyncPreExpand:false});k.prepareUpdate();k.addRoot(o);k.pushUpdate();m=l.getManager();m.loadDocument(k);m.onNodeClick(this.onNodeClick.bind(this))},onNodeClick:function(m){var n,k,l=m.model.options.value;n=m.view.elements.container.getBoundingClientRect().left;k=m.view.elements.container.getBoundingClientRect().top;if(l.isValidAfterFromModeChange||l.isValidAfterToModeChange){this.dispatchEvent("changeModeForMapping",[{xAxis:n,yAxis:k,mappingObject:l}])}},unloadDocument:function(){try{this.elements.treeListView&&this.elements.treeListView.getManager().unloadDocument();this.model=null;this.elements.treeListView&&this.elements.treeListView.destroy();this.elements.body&&this.elements.body.destroy();this.elements.tableContainer&&this.elements.tableContainer.empty()}catch(k){}},getTreeDataFromMappingCache:function(o){var k,l=[],n,m={};for(k in o){if(o.hasOwnProperty(k)){n=new d({label:k,grid:o[k]});l.push(n);m[k]=n}}return{data:l,nodeCache:m}},cleanAndRebuildTable:function(l,n,p){var m,k,o;this.unloadDocument();this.fromSideDataContainer=l;this.fromActivityName=l.getName();m=this.getColumnsObject(this.fromActivityName,n);k=this.elements.treeListView=this.getTreeListViewObject(m);this.mappingCache=p;this.nodeCahce={};this.toSideDataContainers=n;o=this.getTreeDataFromMappingCache(this.mappingCache);this.nodeCahce=o.nodeCache;this._buildPendingMappingView(k,this.options.elements.tableContainer,function(){this._loadDocument(this.options.elements.tableContainer,k,o.data)}.bind(this))},doCRUDOnNodes:function(k,l,o,n){var p,r=[],s=[],q=[],m;for(p in k){if(k.hasOwnProperty(p)){if(l[p]===undefined){r.push(p)}else{if(l[p]!==k[p]){q.push(p)}}}}for(p in l){if(l.hasOwnProperty(p)){if(k[p]===undefined){s.push(p)}}}n.prepareUpdate();r.forEach(function(t){o[t].remove();delete o[t]});q.forEach(function(t){o[t].updateOptions({label:t,grid:l[t]})});s.forEach(function(t){m=new d({label:t,grid:l[t]});n.addRoot(m);o[t]=m});n.pushUpdate()},updateTable:function(k,l,m){this.fromSideDataContainer=k;this.fromActivityName=k.getName();if(this.isRerenderRequired(l,this.toSideDataContainers,this.fromActivityName,this.fromActivityName,this.model)){this.cleanAndRebuildTable(this.fromSideDataContainer,l,m)}else{this.doCRUDOnNodes(this.mappingCache,m,this.nodeCahce,this.model);this.mappingCache=m}}});return b});