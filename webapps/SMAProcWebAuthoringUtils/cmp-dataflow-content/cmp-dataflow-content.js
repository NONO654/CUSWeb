define("DS/SMAProcWebAuthoringUtils/cmp-dataflow-content/cmp-dataflow-content",["UWA/Core","DS/Controls/Tab","DS/SMAProcWebCommonControls/Polymer","DS/JSCMM/SMAJSCMMDataContainer","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAJSCMMSimulationDataUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/Windows/DockingElement","DS/SMAProcWebAuthoringControls/WebUXDialog","DS/Logger/Logger","module","DS/SMAProcWebCommonControls/utils","DS/Controls/Toggle","text!DS/SMAProcWebAuthoringUtils/cmp-dataflow-content/cmp-dataflow-content.html","DS/SMAProcWebAuthoringUtils/cmp-parameter-table/cmp-parameter-table","DS/SMAProcWebAuthoringUtils/cmp-process-table/cmp-process-table","DS/SMAProcWebAuthoringUtils/cmp-parameter-auto-mapping/cmp-parameter-auto-mapping","DS/SMAProcWebAuthoringUtils/cmp-review-mapping/cmp-review-mapping"],function(e,h,m,o,b,i,l,j,n,k,p,a,d,c,g){d.registerDomModule(g);var r=p.getLogger(a);var q={CREATEANDMAP:"CREATEANDMAP",AToAMapMode:"AToAMapMode"};var f={NoneDockArea:0,TopDockArea:1<<0,BottomDockArea:1<<1,LeftDockArea:1<<2,RightDockArea:1<<3};return window.Polymer({is:"cmp-dataflow-content",properties:{_fromSideDataContainer:{type:Object},_selectedParameters:{type:Array,value:[]},_selectedFlowItems:{type:Array,value:[]},_selectedDataContainers:{type:Array,value:[]},hasSourceActivity:{type:Boolean,value:false},currentTab:{type:String,value:q.AToAMapMode}},ready:function(){this.tabWindow=this.createTabBar()},listeners:{"confirm-pending-changes":"onConfirmPendingChanges"},resetSelection:function(s){this.createAndMapTable.resetSelection(s)},setActivitySelection:function(t,u,v,s){this._fromSideDataContainer=t;this.hasSourceActivity=t!==undefined;if(v){this.loadDataFLowsInPLM(t,function(){this.initDataFlowEditor(t,u);if(s){s()}}.bind(this))}else{this.initDataFlowEditor(t,u)}},loadDataFLowsInPLM:function(u,v){var s=[],t;if(u){s.push(u);t=b.getParentFIsDataContainer(u);if(t){s.push(t)}l.getAllSimulationDataInPLM(s,{onSuccess:function(){i.getAllDataFlowsInPLM(s,{onSuccess:function(){v()},onFailure:function(w){r.log(w)}})},onFailure:function(w){r.log(w)}})}else{v()}},initDataFlowEditor:function(s,t){if(this.currentTab===q.CREATEANDMAP){this._setActivitySelectionOnAutoMappingTable(s,t,function(){this._setActivityOnParamaterTable(s)}.bind(this))}else{if(this.currentTab===q.AToAMapMode){this._setActivitySelectionOnAtoATable(s,t)}}},createTabBar:function(){var u;u=new h({reorderFlag:false,showComboBoxFlag:false,pinFlag:false,multiSelFlag:false,centeredFlag:false,editableFlag:false,touchMode:false,tabPanelContainer:this.$.tabPanelContainer,displayStyle:["strip"],allowUnsafeHTMLOnTabButton:false});u.add({label:"1 to 1",value:1,content:this.getAToATabContent(),icon:{iconName:" wux-ui-3ds-flow-children-eye",fontIconFamily:1},index:0});u.add({label:"1 to Many",value:2,content:this.getAutoCreateTabContent(),icon:{iconName:" wux-ui-3ds-parameter-mapping",fontIconFamily:1},index:1});u.value=[1];u.addEventListener("change",function(w){this.onResize();this.onTabModeChange(w.dsModel.value[0]===1?q.AToAMapMode:q.CREATEANDMAP,this._selectedDataContainers)}.bind(this));var t=new e.createElement("div",{styles:{width:"100%"}});u.inject(t);t.inject(this.$.tabBar);var v=new e.createElement("div",{styles:{position:"absolute",left:"0px"}});var s=new c({type:"switch",label:"n2 view",checkFlag:false,styles:{outline:"auto"},allowUnsafeHTMLLabel:false});if(String(localStorage.getItem("webinwinFlag")).toLowerCase()!=="true"){s.inject(v)}v.inject(this.$.tabBar);s.addEventListener("change",function(w){this.fire("toggle-n2-view",w.detail)}.bind(this));return u},getAutoCreateTabContent:function(){var t,s;t=document.createElement("div");t.style.height="100%";s=new n({side:f.BottomDockArea,dockingZoneContent:this.getCreateAndMapTable(),dockingZoneSize:260,collapsibleFlag:false,minSize:150});s.addEventListener("dockResize",function(){this.parametersTable.updateView()}.bind(this));s.inject(t);s.freeZoneContent=this.getParameterTable();return t},getAToATabContent:function(){var s;s=document.createElement("div");s.style.height="100%";s.appendChild(this.getActivityToActivityTable());return s},getParameterTable:function(){var s;if(!this.parametersTable){s=document.createElement("cmp-parameter-table");if(localStorage.getItem("SIMPRCW_AP_ENABLE_EXPERIMENTS")==="true"){s.showParameterPathColumn=true}s.classList.add("parameters-table");s.style.height="100%";s.filters=true;this.parametersTable=s;this.listen(this.parametersTable,"parametersSelectionChange","_onParametersSelectionChange");this.listen(this.parametersTable,"parametersModified","_onParametersModified")}return this.parametersTable},getCreateAndMapTable:function(){var s;if(!this.createAndMapTable){s=document.createElement("cmp-parameter-auto-mapping");s.classList.add("auto-mapping");s.style.display="block";s.style.height="calc(100% - 3px)";s.style.marginTop="5px";this.listen(s,"cmp-parameter-unselect","unselectAllParameters");s&&this._callWhenAttached(s,function(){s.addEventListener("parameterModified",function(t){this.parametersTable.findAndUpdateNode(t.detail)}.bind(this))}.bind(this));this.createAndMapTable=s}return this.createAndMapTable},unselectAllParameters:function(){this.parametersTable&&this.parametersTable.unselectAll()},getActivityToActivityTable:function(){var s;if(!this.aToAtable){s=document.createElement("cmp-review-mapping");s.filters=true;s.classList.add("review-mapping");s.style.height="100%";this.aToAtable=s;s&&this._callWhenAttached(s,function(){s.addEventListener("parameterModified",function(t){this.parametersTable.findAndUpdateNodesById(t.detail)}.bind(this));s.addEventListener("parameterRemoved",function(t){this.parametersTable.removeParametersFromTable(t.detail)}.bind(this));s.addEventListener("update-selection-n2view",function(t){this.fire("update-selection",t.detail)}.bind(this))}.bind(this))}return this.aToAtable},getDataContainer:function(){return this._fromSideDataContainer},_initData:function(s){this._setActivityOnParamaterTable(s);this._initCreateAndMapTable(s);this._initAToATable(s)},_setActivityOnParamaterTable:function(v,s){var t=this.getParameterTable();var u=this;t&&this._callWhenAttached(t,function(){t.setDataContainer(v?v.getDataContainer():undefined,s);u.fire("parametertableloaded")})},_setActivitySelectionOnAutoMappingTable:function(t,u,s){var v=this.getCreateAndMapTable();v&&this._callWhenAttached(v,function(){v&&v.setActivitySelection(t?t.getDataContainer():undefined,this.getDataContainerArray(u),s)}.bind(this))},_setActivitySelectionOnAtoATable:function(t,u,s){var v=this.getActivityToActivityTable();v&&this._callWhenAttached(v,function(){v&&v.setActivitySelection(t?t.getDataContainer():undefined,this.getDataContainerArray(u),s)}.bind(this))},_initCreateAndMapTable:function(s,t){var v=this.getCreateAndMapTable();var u=this;v&&this._callWhenAttached(v,function(){v&&v.clear();v&&v.setActivitySelection(s?s.getDataContainer():undefined,this.getDataContainerArray(t));v.addEventListener("parameterModified",function(w){u.parametersTable.findAndUpdateNode(w.detail)})}.bind(this))},getDataContainerArray:function(s){var t=[];s.forEach(function(u){t.push(u.getDataContainer())});return t},_initAToATable:function(s){var t=this.getActivityToActivityTable();t&&this._callWhenAttached(t,function(){t&&t.clear();t&&t.setFromSideDataContainer(s)})},_setAutoMappingMode:function(s){this.autoMappingMode=s.detail},onTabModeChange:function(t){this.currentTab=t;if(!this.showUnSavedChanges){var s;if(this.currentTab===q.CREATEANDMAP){s=q.AToAMapMode;this._forAtoAUnfocusFirst()}else{s=q.CREATEANDMAP}setTimeout(function(){if(this.isDirty(s)){this.confirmPendingChanges(function(){this.saveTab(s).then(function(){this.loadDataFLowsInPLM(this._fromSideDataContainer,function(){this.refreshTab(t,true);this.refreshTab(s,true);this.propogateTabChange(t)}.bind(this))}.bind(this))}.bind(this),function(){this.discardChangesInTab(s);this.refreshTab(t,true);this.refreshTab(s,true);this.propogateTabChange(t)}.bind(this),function(){this.showUnSavedChanges=true;var u=this.tabWindow.value.indexOf(2)>-1?[1]:[2];this.tabWindow.value=u}.bind(this))}else{this.propogateTabChange(t)}}.bind(this),5)}else{this.showUnSavedChanges=false}},onConfirmPendingChanges:function(u){var v=u.detail.callback,t=this.currentTab;var s=u.detail.cancelCallback;if(this.currentTab===q.AToAMapMode){this._forAtoAUnfocusFirst()}setTimeout(function(){if(this.isDirty(t)){this.confirmPendingChanges(function(){this.saveTab(t).then(function(){v()})}.bind(this),function(){this.discardChangesInTab(t);v()}.bind(this),function(){s()})}else{v()}}.bind(this),5)},_forAtoAUnfocusFirst:function(){var s;s=document.activeElement;if(s&&s.tagName==="INPUT"){s.parentElement.focus()}},confirmPendingChanges:function(t,u,x){var v,s,w;v=function(){this._closePendingChanges(v,s,w);t()}.bind(this);s=function(){this._closePendingChanges(v,s,w);u()}.bind(this);w=function(){this._closePendingChanges(v,s,w);x&&x()}.bind(this);this.$.unsavedChanges.addEventListener("cmp-wux-yes-clicked",v);this.$.unsavedChanges.addEventListener("cmp-wux-no-clicked",s);this.$.unsavedChanges.addEventListener("cmp-wux-cancel-clicked",w);this.$.unsavedChanges.addEventListener("cmp-wux-closed",w);this.$.closeDialogContent.innerText="You have unsaved changes. Do you want to save?";this.$.unsavedChanges.show()},_closePendingChanges:function(t,s,u){this.$.unsavedChanges.removeEventListener("cmp-wux-yes-clicked",t);this.$.unsavedChanges.removeEventListener("cmp-wux-no-clicked",s);this.$.unsavedChanges.removeEventListener("cmp-wux-closed",u);this.$.unsavedChanges.removeEventListener("cmp-wux-cancel-clicked",u);this.$.unsavedChanges.hide()},isDirty:function(s){var t=false;if(s===q.CREATEANDMAP||!s){if(this.getParameterTable().isDirty()||this.getCreateAndMapTable().isDirty()){t=true}}if(s===q.AToAMapMode||!s){t=t||this.getActivityToActivityTable().isDirty()}return t},getToSideDataContainer:function(){return this._selectedDataContainers},_onParametersSelectionChange:function(t){var s=[];t.stopPropagation();t.preventDefault();t.detail&&t.detail.forEach(function(u){s.push(u.parameter)});this._selectedParameters=s;this.createAndMapTable&&this.createAndMapTable.setFromSideParameters(s)},_onParametersModified:function(s){s.stopPropagation();s.preventDefault();this.createAndMapTable&&this.createAndMapTable.updateMappingForParameters(s.detail)},onCancel:function(){this.discardChangesInTab(this.currentTab);this._close()},onApply:function(t){var s=this.currentTab;if(this.isDirty(this.currentTab)){this.saveTab(s).then(function(){this.refreshTab(s);t&&t()}.bind(this))}},onOK:function(t){var s=this.currentTab;this.saveTab(s).then(function(){this._close();t&&t()}.bind(this))},saveTab:function(s){if(s===q.CREATEANDMAP){return this.saveCreateAndMapTab()}else{return this.saveAtoATab()}},saveCreateAndMapTab:function(){var t=this.getParameterTable(),s=this.getCreateAndMapTable();return new Promise(function(v,u){t.showLoadingIdicatorforSave();s.applyDataMapping().then(function(){t.applyChanges();t.hideLoadingIdicatorforSave(this);v()}.bind(this))["catch"](function(){t.hideLoadingIdicatorforSave(this);r.log("failed to Save to PLM");u(new Error("failed to Save to PLM"))})})},saveAtoATab:function(){return new Promise(function(t,s){this.aToAtable.showLoadingIdicatorforSave();this.aToAtable.commitChanges().then(function(){this.aToAtable.hideLoadingIdicatorforSave();this.aToAtable.refreshAtoAView();t()}.bind(this))["catch"](function(){this.aToAtable.hideLoadingIdicatorforSave();r.log("failed to Save to PLM");s(new Error("failed to Save to PLM"))}.bind(this))}.bind(this))},refreshTab:function(t,s){if(t===q.CREATEANDMAP){this.refreshCreateAndMapTab(s)}else{this.refreshAtoATab(s)}this.fire("tabRefreshed")},propogateTabChange:function(s){this.fire("modechanged",{tabMode:s})},refreshCreateAndMapTab:function(s){var u=this.getParameterTable(),t=this.getCreateAndMapTable();if(j.isWebInWin()){u.updateAllParametersReferenceToNode();u.applyChanges();u.updateView(s);t.clearMappingCache();t.clearParameterCache();var v=u.getSelectedParameters();t.setFromSideParameters(v)}else{u.applyChanges();u.updateView(s);t.refreshView()}},refreshAtoATab:function(s){this.aToAtable&&this.aToAtable.refreshAtoAView(s)},discardChangesInTab:function(s){if(s===q.CREATEANDMAP){return this.discardCreatedAndMapChanges()}else{return this.discardAtoATabChanges()}},discardCreatedAndMapChanges:function(){var t=this.getParameterTable(),s=this.getCreateAndMapTable();t.clearTempChanges();s.abortDataMapping()},discardAtoATabChanges:function(){this.aToAtable&&this.aToAtable.abortChanges()},onClose:function(){this.onCancel()},onResize:function(){this.parametersTable&&this.parametersTable.dialogResized();this.aToAtable&&this.aToAtable.dialogResized()},_clearToSideDataContainers:function(){this.parametersTable&&this.parametersTable.updateTable();this.createAndMapTable&&this.createAndMapTable.setToSideDataContainers([]);this.aToAtable&&this.aToAtable.setToSideDataContainer()},_close:function(){this._selectedDataContainers=[];this.parametersTable.tableExist()&&this.parametersTable.unloadTable();this.fire("onClose")},_callWhenAttached:function(s,u){if(s.isAttached){u()}else{s.addEventListener(s.tagName.toLowerCase()+"-attached",function t(){s.removeEventListener(s.tagName.toLowerCase()+"-attached",t);u()})}},highlightDataPaths:function(u){if(u==="ONETOMANY"||u==="ROUTE"){if(this.parametersTable.tableExist()&&this.parametersTable.parameterTable.getParameterPathParameter()){var w={parameter:this.parametersTable.parameterTable.getParameterPathParameter()};this.parametersTable._showParameterPath(w)}}else{if(u==="AtoA"){var v=this.aToAtable.ParameterListTableView.parameterCache;var s=Object.keys(this.aToAtable.ParameterListTableView.parameterCache)[0];var t=v[s];if(t){this.parametersTable._showParameterPath({parameter:t})}}}},isTabChanged:function(){return this.tabChanged}})});