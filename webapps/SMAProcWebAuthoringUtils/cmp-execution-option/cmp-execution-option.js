define("DS/SMAProcWebAuthoringUtils/cmp-execution-option/cmp-execution-option",["DS/SMAProcWebCommonControls/utils","DS/SMAProcWebCMMUtils/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMException/SMAProcWebCMMError","DS/SMAProcWebExceptionManager/SMAProcWebErrorManager","DS/SMAProcWebCMMUtils/SMAProcWebAuthoringNLSUtils","DS/ApplicationFrame/CommandsManager","text!DS/SMAProcWebAuthoringUtils/cmp-execution-option/cmp-execution-option.html","DS/SMAProcWebCommonControls/import!DS/SMAProcSPUI/sp-modal/sp-modal.html","DS/SMAProcWebCommonControls/import!DS/SMAProcSPUI/sp-exe-options/sp-exe-options.html"],function(m,b,n,h,e,l,a,j){m.registerDomModule(j);var g=window.Polymer;var k=["True","False"],i=["true","false"],f=["keepdirtype","isExecutable","monitorFiles","isFastflowEnabled","OS","Host","Others","Group","drmMode","timeout","noPermitParamSaveToDB","maxbatchsize"],d=["jobTitle","jobDescription","logLevel","modelUseFixedSeed","modelSeedValue"],c={Cleanup:"keepdirtype",SkipActivity:"isExecutable",MonitorFiles:"monitorFiles",FastFlow:"isFastflowEnabled",OperatingSystem:"OS",StationName:"Host",Custom:"Others",Group:"Group",drmMode:"drmMode",MaxRunTime:"timeout",saveIterationHistory:"noPermitParamSaveToDB",Maxbatchsize:"maxbatchsize"};g({is:"cmp-execution-option",properties:{_activity:{type:Object,observer:"loadExecutionOptions"},_process:{type:Object,observer:"loadExecutionOptionsForProcess"},_step:{type:Object,observer:"loadExecutionOptionsForStep"},_modified:{type:Boolean,value:false}},ready:function(){var o=this.querySelector(".access-overlay");o.parentNode.removeChild(o);this.$.options_md.show();console.log("cmp-execution-option.ready")},getDefaultValuesForNewActivity:function(p){for(var o=0;o<f.length;o++){p[f[o]].value.push({value:""})}p.keepdirtype.value[0].value="1";p.monitorFiles.value[0].value="false";p.isExecutable.value[0].value="true";p.isFastflowEnabled.value[0].value="false";p.drmMode.value[0].value="fiper";p.noPermitParamSaveToDB.value[0].value="true";return p},setStepExeOptions:function(p,v,r,t,s){if(p===v&&t._data.FlowItem.ExecutionConfig.Properties!==undefined){if(Array.isArray(t._data.FlowItem.ExecutionConfig.Properties.Property)){for(var q=0;q<t._data.FlowItem.ExecutionConfig.Properties.Property.length;q++){if(t._data.FlowItem.ExecutionConfig.Properties.Property[q].name===r){t._data.FlowItem.ExecutionConfig.Properties.Property.splice(q,1)}}}else{if(t._data.FlowItem.ExecutionConfig.Properties.Property.name===r){delete (t._data.FlowItem.ExecutionConfig.Properties)}}}else{if(p===v&&t._data.FlowItem.ExecutionConfig.Properties===undefined){return}else{if(p!==v&&t._data.FlowItem.ExecutionConfig.Properties===undefined){t._data.FlowItem.ExecutionConfig.Properties={Property:{}};t._data.FlowItem.ExecutionConfig.Properties.Property={Value:{"<TEXT>":v},name:r,type:s}}else{if(p!==v&&t._data.FlowItem.ExecutionConfig.Properties!==undefined){if(Array.isArray(t._data.FlowItem.ExecutionConfig.Properties.Property)){var u=t._data.FlowItem.ExecutionConfig.Properties.Property.length;for(var q=0;q<u;q++){if(t._data.FlowItem.ExecutionConfig.Properties.Property[q].name===r){t._data.FlowItem.ExecutionConfig.Properties.Property[q]={Value:{"<TEXT>":v},name:r,type:s}}}}else{if(t._data.FlowItem.ExecutionConfig.Properties.Property.name===r){delete (t._data.FlowItem.ExecutionConfig.Properties.Property);t._data.FlowItem.ExecutionConfig.Properties.Property={Value:{"<TEXT>":v},name:r,type:s}}else{var o=[t._data.FlowItem.ExecutionConfig.Properties.Property];o.push({Value:{"<TEXT>":v},name:r,type:s});t._data.FlowItem.ExecutionConfig.Properties.Property=o}}}}}}},e6wToLegacy:function(q,v,s,p,o,u,t){var r={};r.syncAssist="ExecOpt";r.level="2";r.title_display=q;r.title=s;r.id=v.toString();r.value=p;if(!isNaN(p)&&p!==null&&p!==""){r.datatype="integer"}if(typeof(o)!=="undefined"){r.choices_display=o;r.choices=u}if(t){r.editableInPS="false"}return r},renderExeoptionsModal:function(t){var u=t._exeOptions._options;var q=[];var p=1;var v;var w=function(z){return z=z&&z.value&&z.value[0]&&z.value[0].value||null};var r=function(A){var z=u[d[A-2]];return w(z)};var x=function(A){var z=u[f[A-2]];return w(z)};if(t.isProcess()){v={level:"0",title_display:t.getName(),icon:"../common/images/smaIconSimulation.gif",title:t.getName()};q.push(v);q.push(this.e6wToLegacy("Job Title",p++,"JobTitle",(r(p)?b.unescapeHTML(r(p)):r(p))));q.push(this.e6wToLegacy("Job Description",p++,"JobDescription",r(p)));q.push(this.e6wToLegacy("Log Level",p++,"LogLevel",r(p),["Debug","Info","Message","Warning","Error","System Error"],["Debug","Information","Message","Warning","Error","SysError"]));q.push(this.e6wToLegacy("Use Fixed Seed",p++,"modelUseFixedSeed",r(p),k,i));q.push(this.e6wToLegacy("Model Seed Value",p++,"modelSeedValue",r(p)))}else{if(t.isActivity){v={level:"0",title_display:t.getName(),icon:"../common/images/smaIconActivity.gif",title:t.getName()};var s=["Built-in"];var y=["fiper"];var o=(u.drmMode.value[0].value==="fiper");if(!o){var s=[u.drmMode.value[0].value];var y=[u.drmMode.value[0].value]}q.push(v);if(u.keepdirtype.value.length===0){u=this.getDefaultValuesForNewActivity(u)}q.push(this.e6wToLegacy("Cleanup",p++,"Cleanup",w(u.keepdirtype),["Always","On success","Never"],["0","1","2"]));q.push(this.e6wToLegacy("Execute this Activity",p++,"SkipActivity",w(u.isExecutable),k,i));q.push(this.e6wToLegacy("Monitor Files",p++,"MonitorFiles",(w(u.monitorFiles)===""||w(u.monitorFiles)===null)?"false":w(u.monitorFiles),k,["true","false"]));q.push(this.e6wToLegacy("Use fast-flow execution tier",p++,"FastFlow",w(u.isFastflowEnabled),k,i));if(o){q.push(this.e6wToLegacy("Operating System",p++,"OperatingSystem",w(u.OS)));q.push(this.e6wToLegacy("Station Name",p++,"StationName",(w(u.Host)?b.unescapeHTML(w(u.Host)):w(u.Host))));q.push(this.e6wToLegacy("Custom",p++,"Custom",w(u.Others)));q.push(this.e6wToLegacy("Location Group",p++,"Group",w(u.Group)))}q.push(this.e6wToLegacy("DRM mode",p++,"drmMode",w(u.drmMode),s,y,true));q.push(this.e6wToLegacy("Max run-time",p++,"MaxRunTime",w(u.timeout)));q.push(this.e6wToLegacy("Save Iteration History",p++,"saveIterationHistory",w(u.noPermitParamSaveToDB),k,i));q.push(this.e6wToLegacy("Max Batch Size",p++,"Maxbatchsize",w(u.maxbatchsize)))}}if(!o){this.$.notification.logMessage({type:"warning",text:"Unsupported DRM mode. Configure DRM in Performance Study"})}this.$.exeOptions.data=q},renderExeoptionsModalForStep:function(t){var r=[],q=1;var v={level:"0",title_display:t.getName(),icon:"../common/images/smaIconSimulation.gif",title:t.getName()};r.push(v);var o,p,x,w,y,z;(t._data.FlowItem.name!==null)?y=t._data.FlowItem.name:y="";(t._data.FlowItem.description!==null)?z=t._data.FlowItem.description:z="";(t._data.FlowItem.pauseBefore)?o=t._data.FlowItem.pauseBefore:o="false";(t._data.FlowItem.pauseAfter)?p=t._data.FlowItem.pauseAfter:p="false";var u=t._data.FlowItem.ExecutionConfig.Properties;if(u===undefined){w="true";x="0"}else{if(!Array.isArray(u.Property)){if(u.Property.name==="timeout"){x=Object.values(u.Property.Value)[0];x=String(parseInt(x)/1000);w="true"}if(u.Property.name==="isExecutable"){w=Object.values(u.Property.Value)[0];x="0"}}else{for(var s=0;s<u.Property.length;s++){if(u.Property[s].name==="timeout"){x=Object.values(u.Property[s].Value)[0];x=String(parseInt(x)/1000)}if(u.Property[s].name==="isExecutable"){w=Object.values(u.Property[s].Value)[0]}}}}r.push(this.e6wToLegacy("Title",q++,"title",y));r.push(this.e6wToLegacy("Description",q++,"description",z));r.push(this.e6wToLegacy("Execute this Step",q++,"isExecutable",w,k,i));r.push(this.e6wToLegacy("Pause Before",q++,"pauseBefore",o,k,i));r.push(this.e6wToLegacy("Pause After",q++,"pauseAfter",p,k,i));r.push(this.e6wToLegacy("Max run-time",q++,"timeout",x));this.$.exeOptions.data=r},loadExecutionOptions:function(){var o=this;console.log("loading exeoptions for activity");n.getActivityExecOptions(this._activity,{onSuccess:function(p){o.renderExeoptionsModal(p);console.log("Execution Options loaded successfully.")},onFailure:function(){console.log("Execution Options loading failed.")}})},loadExecutionOptionsForProcess:function(){console.log("loading exeoptions for process");var o=this;n.getProcessExecOptions(this._process,{onSuccess:function(p){o.renderExeoptionsModal(p)},onFailure:function(){console.log("Execution Options loading failed.")}})},loadExecutionOptionsForStep:function(){console.log("loading exeoptions for step");var o=this;n.updateStep(this._step,{onSuccess:function(p){console.log("success");o.renderExeoptionsModalForStep(p)},onFailure:function(){console.log("Execution Options loading failed.")}})},saveExecutionOptions:function(){var s;var q=function(F,H){for(var G=0;G<F.length;G++){if(H===F[G].title){return F[G].value}}};if(this._activity){s=this._activity}else{if(this._process){s=this._process}else{if(this._step){s=this._step}}}var x=l.translate(["ExecutionOptions.update.failed"]);var E=l.translate(["Modify_AccessMessage"]);if(s._exeOptions===undefined&&s.isFunctionStep()&&this._modified){var r=this.$.exeOptions.data;var B=q(r,"title");var D=q(r,"description");var p=q(r,"pauseAfter");var o=q(r,"pauseBefore");var y=q(r,"isExecutable");var A=String(parseInt(q(r,"timeout"))*1000);s._data.FlowItem.name=B;s._data.FlowItem.description=D;s._data.FlowItem.pauseAfter=p;s._data.FlowItem.pauseBefore=o;this.setStepExeOptions("true",y,"isExecutable",s,"boolean");this.setStepExeOptions("0",A,"timeout",s,"integer");var v=s.getId();n.saveStep(s,{onSuccess:function(H){console.log("Execution Options for step Saved successfully");var F=document.querySelector('cmp-step-view[step-id="'+v+'"]');if(F){F.updateTitle()}var G=require("DS/SMAProcWebDiagram/graph");var I=G.processDiagram.nodeMap[H.getParent().getId()].views.main.display.elt;I.updateExeOptionsIcons()},onFailure:function(F){x=x.replace("<p>","step :"+s.getName()+". ");if(F.length>0&&F.indexOf("access")>-1){x=x+E}e.notifyError(new h("Error",x),{autoRemove:false})}})}else{if(s._exeOptions&&s._exeOptions.getState()===b.State.Modified){var r=this.$.exeOptions.data;var z=s._exeOptions._options;if(s.isActivity()){for(var u=1;u<r.length;u++){z[c[r[u].title]].value[0].value=r[u].value}delete z.numprocs;n.modifyActivityExecOptions(s,{onSuccess:function(){console.log("Execution Options Saved successfully")},onFailure:function(F){x=x.replace("<p>","activity :"+s.getName()+". ");if(F.length>0&&F.indexOf("access")>-1){x=x+E}e.notifyError(new h("Error",x),{autoRemove:false})}})}else{if(s.isProcess()){for(var w=0,t=0;w<d.length;w++){var C=z[d[w]].value;if(C&&!C[0]){C.push({})}z[d[w]].value[0].value=r[++t].value}n.modifyProcessExecOptions(s,{onSuccess:function(){console.log("Execution Options Saved successfully")},onFailure:function(F){x=x.replace("<p>","process :"+s.getName()+". ");if(F.length>0&&F.indexOf("access")>-1){x=x+E}e.notifyError(new h("Error",x),{autoRemove:false})}})}}}}this.hide()},hide:function(){var o;if(this._activity){o=this._activity}else{if(this._process){o=this._process}else{if(this._step){this.$.options_md.hide();this._modified=false;return}}}o._exeOptions.setState(b.State.None);this.$.options_md.hide()},exeOptionsChange:function(){console.log("in exeOptionsChanged");if(this._activity){this._activity._exeOptions.setState(b.State.Modified)}else{if(this._process){this._process._exeOptions.setState(b.State.Modified)}else{if(this._step){this._modified=true}}}},onOk:function(){this.saveExecutionOptions();a.enableAll()},onCancel:function(){this.hide();a.enableAll()},onClose:function(o){if(o&&o.stopPropagation){o.stopPropagation()}a.enableAll()}})});