define("DS/RGR/commands/DisplayReportsCmd",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/Command"],function(d,a,c){var b=c.extend({init:function(f){this._parent(f);var g=this,h=f.context.reportDisplayer,e=f.context.ofDisplayer;if(h.isVisible()){this._switch=false;this.setState(true)}this.onStateChange(function(){if(g.getState()){var i=a.getCommandCheckHeader("DisplayOFCmd","RGR");i._switch=true;i.setState(false);g._switch=false;g.options.context.currentDisplayer=h;e.hide();h.show()}else{g._state=!g._switch}})}});return d.namespace("RGR/commands/DisplayReportsCmd",b)});define("DS/RGR/commands/DisplayOFCmd",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/Command"],function(d,a,c){var b=c.extend({init:function(f){this._parent(f);var g=this,h=f.context.reportDisplayer,e=f.context.ofDisplayer;if(e.isVisible()){this.setState(true);this._switch=false}this.onStateChange(function(){if(g.getState()){var i=a.getCommandCheckHeader("DisplayReportsCmd","RGR");i._switch=true;i.setState(false);g._switch=false;g.options.context.currentDisplayer=e;h.hide();e.show()}else{g._state=!g._switch}})}});return d.namespace("RGR/commands/DisplayOFCmd",b)});define("DS/RGR/commands/TilesViewCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:false})},beginExecute:function(){},execute:function(){[this.options.context.ofDisplayer,this.options.context.reportDisplayer].forEach(function(d){d.switchView("tile")})}});return c.namespace("RGR/commands/TilesViewCmd",b)});define("DS/RGR/OutputFormatForm",["DS/RGNServices/Request","DS/RGNServices/DataForm","DS/RGNServices/FormBuilder","DS/RGNServices/FormControl","DS/RGNServices/Alert"],function(d,c,e,a,b){return(function(){var f=function(j,h,i){var k=j["relationship[Active Version].to.attribute[Title]"];return new c([{label:"Name",type:"text",value:j.name,attributes:{id:"ofName",placeholder:"Leave blank for autoname"}},{label:"Title",type:"text",attributes:{id:"ofTitle"},value:j["attribute[Title]"],mandatory:true,control:{check:function(l){return l.value&&l.value!==""},message:"Title must be filled"}},{label:"Description",type:"textarea",attributes:{id:"ofDescription"},value:j.description},{label:"Policy",type:"droplist",attributes:{id:"ofPolicy"},value:j.policy,values:h},{label:"Output Format",type:"droplist",attributes:{id:"ofFile"},value:k,values:i,events:{onchange:function(l){l.target.offsetParent.querySelector("#ofFileDnd").style.display=l.target.selectedIndex===0?"block":"none"}}},{type:"dnd",value:"Drop file"+(k?", actual file is: "+k:""),attributes:{id:"ofFileDnd",style:"display: "+((k&&i.indexOf(k)>=0)?"none":"block")},events:{ondragover:function(l){if(l.preventDefault){l.preventDefault()}this.classList.add("ondragover");l.dataTransfer.dropEffect="copy";return false},ondragenter:function(){this.classList.add("ondragover");return false},ondragleave:function(){this.classList.remove("ondragover")},ondrop:function(n){n.preventDefault();var o=this,m=n.dataTransfer.files[0],l=new FileReader();o.previousFileName=k;l.onload=function(p){o.file=/.+;base64,(.+)/.exec(p.target.result)[1];o.fileName=m.name;o.querySelector(".dnd-label").innerHTML=m.name};this.querySelector(".dnd-label").innerHTML="Loading...";l.readAsDataURL(m);return false}}}])};function g(j,i,k){var h=k||{};this.library=j;this.policies=j.policies;this.files=j.files;this.appOptions=j.options;this.displayer=i;this.of=h.of;this.readOnly=h.readOnly||false;this.builder=new e();this.formControl=new a()}g.prototype.open=function(k){var h=this,j=this.of,i=this.library;if(!this.dataForm){this.getForm()}if(this.readOnly){this.dataForm.disable()}this.dataForm.inject(k,this.readOnly?[]:[{className:"primary",value:j?"Update":"Create",action:function(m){var l=m.getBody(),o=l.querySelector("#ofFile"),n={name:l.querySelector("#ofName").value,title:l.querySelector("#ofTitle").value,description:l.querySelector("#ofDescription").value,policy:l.querySelector("#ofPolicy").value,libraryFile:o.selectedIndex===0?undefined:o.value,customFileName:l.querySelector("#ofFileDnd").fileName,customPreviousFileName:l.querySelector("#ofFileDnd").previousFileName,customFileData:l.querySelector("#ofFileDnd").file};h.formControl.check(l).then(function(){if(j){n.physicalid=j.physicalid}m.getFooter().querySelector(".btn-primary").setAttribute("disabled","");new d()[j?"putJson":"postJson"](h.appOptions.restUrl+"resources/rgn/outputformat"+(j?"/"+j.physicalid:""),n).then(function(p){m.hide();i.pushOutputFormat(p,h.displayer)},function(p){m.getFooter().querySelector(".btn-primary").removeAttribute("disabled");b.error(p,m)})},function(p){p.forEach(function(s){var r=s.parentElement,q=r.querySelector(".form-control-error-text");if(!q){q=document.createElement("span");q.classList.add("form-control-error-text");q.innerHTML=s.control.message;r.appendChild(q)}q.style.display="block"})})}},{className:"default",value:"Cancel",action:function(l){l.hide()}}])};g.prototype.getForm=function(){this.dataForm=f(this.of||{},this.policies,this.files);return this.dataForm.form};return g})()});define("DS/RGR/commands/TreeListViewCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:false})},beginExecute:function(){},execute:function(){[this.options.context.ofDisplayer,this.options.context.reportDisplayer].forEach(function(d){d.switchView("table")})}});return c.namespace("RGR/commands/TreeListViewCmd",b)});define("DS/RGR/ReportForm",["DS/RGNServices/DataForm","DS/RGNServices/Request","DS/RGNServices/FormControl","DS/RGNServices/QuickSearch","DS/RGNServices/Alert"],function(d,c,a,e,b){return(function(){var j="Report Model",u="reportTemplate",n="Report Template",k="reportOutputFormat",r="DOCUMENTS",h="reportTargetDocument",f=function(A){var y=A.querySelector("#searchDiv"),z=A.querySelector("#searchButtons"),x=A.querySelector(".form-root"),w=A.querySelector(".modal-header"),v=A.querySelector(".modal-footer");x.style.display="none";v.style.display="none";w.querySelector(".close").style.display="none";y.style.display="block";z.style.display="block"},g=function(w,v,x){return{attributes:{"class":"btn btn-primary"},value:"Search",events:{onclick:function(A){var z=A.target.parentElement,y=z.offsetParent;new c().getJson(w.appOptions.restUrl+"resources/rgn/report/inputs/"+v+"/"+(z.querySelector("#"+x).value||"*")).then(function(D){var B=y.querySelector("#searchDiv"),C=new e(B,{selectable:true,multiSelection:false});y.searchOrigin=z;f(y);C.display(D)},function(B){b.error(B.message,y)})}}}},i=function(A){var y=A.querySelector("#searchDiv"),z=A.querySelector("#searchButtons"),x=A.querySelector(".form-root"),w=A.querySelector(".modal-header"),v=A.querySelector(".modal-footer");A.searchOrigin=null;x.style.display="block";v.style.display="block";w.querySelector(".close").style.display="block";y.style.display="none";z.style.display="none"},t=function(w,v){w.innerHTML=v||"Unexpected object type";w.classList.add("label");w.classList.add("label-error")},o=function(v){v.classList.remove("label");v.classList.remove("label-error")},s=function(y,z,x,A){var v=z.querySelector(".dnd-label"),w=z.parentElement.onvaluechange;o(v);z.querySelector(".form-oid").value=x;if(w){w(x,y.querySelector(".form-root"))}if(A){v.classList.add("font-3dsbold");if(A.length>40){v.innerHTML=A.substr(0,40)+"...";v.setAttribute("title",A)}else{v.innerHTML=A}}},m=function(A,y,B){var x=[],w=JSON.parse(y),z,v=A.querySelector(".dnd-label");if(w){o(v);if(w.data&&w.data.items){w.data.items.forEach(function(D){var C=D.objectType;if(B&&B.includes(C)){x.push(D.objectId);z=(z?z+"\n":"")+D.displayName}})}else{if(w.objects){w.objects.forEach(function(D){var C=D.type;if(B&&B.includes(C)){x.push(D.oid);z=(z?z+"\n":"")+(D.displayName||D.oid)}})}}if(x.length>0){s(A.offsetParent,A,x,z)}}if(x.length===0){t(v)}A.classList.remove("ondragover")},l=function(v){return{drop:function(w,x){m(x,w,v)},enter:function(w){w.classList.add("ondragover");return false},over:function(w){w.classList.add("ondragover");return false},leave:function(w){w.classList.remove("ondragover")}}},q=[{attributes:{"class":"btn btn-primary",style:"margin-right: 5px;"},value:"OK",events:{onclick:function(x){var w=x.target.offsetParent,v=[],y;w.querySelectorAll(".selected-data").forEach(function(z){v.push(z.info.physicalid);y=(y?y+"\n":"")+((z.titleAttribute?z.info[z.titleAttribute]:z.info["attribute[Title]"])||z.info.name)});s(w,w.searchOrigin,v,y);i(w)}}},{attributes:{"class":"btn btn-default"},value:"Cancel",events:{onclick:function(w){var v=w.target.offsetParent;i(v)}}}];function p(w,v,x){this.library=w;this.appOptions=w.options;this.displayer=v;this.report=x.report;this.withSearch=x.withSearch||false;this.readOnly=x.readOnly||false;this.formControl=new a()}p.prototype.open=function(w){var v=this;if(!this.dataForm){this.getForm()}if(this.readOnly){this.dataForm.disable()}this.dataForm.inject(w,this.readOnly?[]:[{className:"primary",value:v.report?"Update":"Create",action:function(z){var y=z.getBody(),x=function(B){return[].map.call(B,function(C){return C})},A={name:y.querySelector("#reportName").value,title:y.querySelector("#reportTitle").value,description:y.querySelector("#reportDescription").value,templateId:y.querySelector("#"+u+"OID").value.split(",")[0],outputFormatId:y.querySelector("#"+k+"OID").value.split(",")[0],inputParameterTypes:x(y.querySelectorAll(".form-report-parameter input.form-type")).map(function(B){return B.value}),inputParameterIds:x(y.querySelectorAll(".form-report-parameter input.form-oid")).map(function(B){return B.value.split(",")}),inputParameterIsPLM:x(y.querySelectorAll(".form-report-parameter input.form-is-plm-data")).map(function(B){return B.value})};v.formControl.check(y).then(function(){z.getFooter().querySelector(".btn-primary").setAttribute("disabled","");if(v.report){A.physicalid=v.report.physicalid}new c()[v.report?"putJson":"postJson"](v.appOptions.restUrl+"resources/rgn/report"+(v.report?"/"+v.report.physicalid:""),A).then(function(B){z.hide();v.library.pushReport(B,v.displayer)},function(B){z.getFooter().querySelector(".btn-primary").removeAttribute("disabled");b.error(B.message,z)})},function(B){if(B instanceof Array){B.forEach(function(E){var D=E.parentElement,C=D.querySelector(".form-control-error-text");if(!C){C=document.createElement("span");C.classList.add("form-control-error-text");C.innerHTML=E.control.message;D.appendChild(C)}C.style.display="block"})}else{b.error(B,z)}})}},{className:"default",value:"Cancel",action:function(x){x.hide()}}])};p.prototype.getForm=function(){var w=this,v=this.report||{},x=this.library.defaultInputDerivative||{};this.dataForm=new d([{label:"Name",type:"text",value:v.name,attributes:{id:"reportName",placeholder:"Leave blank for autoname"}},{label:"Title",type:"text",attributes:{id:"reportTitle"},value:v.title,mandatory:true,control:{check:function(y){return y.value&&y.value!==""},message:"Title must be filled"}},{label:"Description",type:"textarea",collapsed:true,attributes:{id:"reportDescription"},value:v.description},{label:"Template",inputTypeName:"PLM.Report Model",collapsed:false,type:"search",attributes:{id:u+"Group",inputId:u},value:{physicalid:v.templateId,display:v.templateTitle||v.templateName},mandatory:true,dnd:l(x.hasOwnProperty(j)?[j].concat(x[j]):[j]),control:{check:function(z){var y=z.querySelector(".form-oid").value;return y&&y.length>0},message:"Report Template must be filled"},events:{onvaluechange:function(A,z,y){return new Promise(function(B){var C=z;z.querySelectorAll(".form-report-parameter").forEach(function(D){D.remove()});if(A){new c().getJson(w.appOptions.restUrl+"resources/rgn/template/"+A).then(function(J){if(J.hasOwnProperty("parameters")){var D=J.parameters,L=function(M){return w.ctxData.connectedBus[M]};for(var K=0;K<D.length;K++){var E=D[K],G="Input"+K,H=y?(y.parameters[K]||{}):{},F=H.isPLMObject?H.value.map(L):H.value,I=w.dataForm.builder.newFormGroup(C,{label:E.typeSimpleName+": "+E.display,inputTypeName:E.typeName,isPLMObject:E.isPLMObject,type:E.isPLMObject?"search":"textInput",collapsed:false,attributes:{id:G},mandatory:E.cardinality===0,value:F,control:{check:function(N){var M=N.classList.contains("form-search")?N.querySelector(".form-oid").value:N.value;return M&&M.length>0},message:"Input must be filled"},dnd:l(E.acceptedTypes),search:g(w,E.typeName,G)});if(I){I.classList.add("form-report-parameter")}}}},function(D){b.error(D)})}B()})}},search:g(w,"PLM.Report Model",u)},{label:"Output Format",inputTypeName:"PLM.Report Template",type:"search",collapsed:false,attributes:{id:k+"Group",inputId:k},value:{physicalid:v.ofId,display:v.ofTitle||v.ofName},mandatory:true,dnd:l(x.hasOwnProperty(n)?[n].concat(x[n]):[n]),control:{check:function(z){var y=z.querySelector(".form-oid").value;return y&&y.length>0},message:"Output Format must be filled"},search:g(w,"PLM.Report Template",k)},{label:"Target Document",inputTypeName:"PLM.DOCUMENTS",type:"search",collapsed:true,attributes:{id:h+"Group",inputId:h},value:{physicalid:v.genDocId,display:v.genDocTitle||v.genDocName},mandatory:false,dnd:l(x.hasOwnProperty(r)?[r].concat(x[r]):[r]),search:g(w,"PLM.DOCUMENTS",h)}],{searchButtons:this.withSearch?q:[]});return this.dataForm.form};return p})()});define("DS/RGR/commands/NewCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/RGR/ReportForm","DS/RGR/OutputFormatForm"],function(e,a,d,c){var b=a.extend({init:function(f){this._parent(f,{isAsynchronous:false})},beginExecute:function(){},execute:function(){var i=this.options.context.reportDisplayer,g=this.options.context.reportLibrary,f=this.options.context.ofDisplayer,h=this.options.context.ofLibrary;if(this.options.context.currentDisplayer===i){new d(g,i,{withSearch:true}).open("New Report")}else{new c(h,f).open("New Output Format")}}});return e.namespace("RGR/commands/NewCmd",b)});define("DS/RGR/OutputFormatLibrary",["DS/RGNServices/RGNServices","DS/RGNServices/Request","DS/RGNServices/Dialogs","DS/RGNServices/Alert","DS/RGR/OutputFormatForm"],function(d,c,b,a,e){return(function(){var h="attribute[Title]",i=new b(),f=function(j){return j[h]||j.name};function g(j){this.options=j||{};this.ofs=this.options.outputFormats}g.prototype.inject=function(k){var m=this,l=this.options.app,j=this.options.restUrl;return new Promise(function(n,o){new c().getJson(j+"resources/rgn/outputformat/policies").then(function(p){m.policies=p;new c().getJson(j+"resources/rgn/outputformat/libraries").then(function(q){var r=["custom..."].concat(q);m.files=r;k.display(m.ofs,{contextualActions:{details:{className:"fonticon fonticon-attributes",icon:"legend-eye",tooltip:"Details",onclick:function(s){new e(m,k,{of:s,readOnly:true}).open(f(s))}},"delete":{className:"fonticon fonticon-trash",icon:"close",tooltip:"Delete",onclick:function(s){i.choice(l,{title:"Delete or Remove",message:"Delete "+f(s)+" or remove it from view?",buttons:[{className:"primary",value:"Delete",action:function(t){var u=s.physicalid;t.getFooter().querySelectorAll(".btn-primary")[0].setAttribute("disabled","");new c().deleteObject(j+"resources/rgn/outputformat/"+u).then(function(){k.removeElement(u).then(function(){new c().getJson(j+"resources/rgn/outputformat").then(function(v){k.refresh(v)},function(v){a.error(v)})},function(v){a.error(v.message)});t.hide()},function(v){t.hide();a.error(v.message)})}},{className:"primary",value:"Remove",action:function(t){t.getFooter().querySelectorAll(".btn-primary")[1].setAttribute("disabled","");m.popOutputFormat(s,k);t.hide()}},{className:"default",value:"Cancel",action:function(t){t.hide()}}]})}},edit:{className:"fonticon fonticon-pencil",icon:"pencil",tooltip:"Edit",onclick:function(s){new e(m,k,{of:s}).open("Edit "+f(s))}},download:{className:"fonticon fonticon-download",icon:"download",tooltip:"Download",onclick:function(t){var s=t["relationship[Active Version].to.attribute[Title]"];if(s){new c().download(j+"resources/rgn/outputformat/download/"+t.physicalid+"/"+s).then(function(u){d.download(s,u,true)})}}}}});n()},function(q){o(q)})},function(p){o(p)})})};g.prototype.getOutputFormats=function(){return this.ofs};g.prototype.pushOutputFormat=function(k,j){if(k instanceof Array){Array.prototype.push.apply(this.ofs,k)}else{this.ofs.push(k)}this.options.widgetInfo.setValue("outputFormats",JSON.stringify(this.ofs));j.refresh(this.ofs)};g.prototype.popOutputFormat=function(l,j){var k=this.ofs;k.forEach(function(n,m){if(n.physicalid===l.physicalid){k.splice(m,1)}});this.options.widgetInfo.setValue("outputFormats",JSON.stringify(k));j.refresh(k)};g.prototype.pushDroppedIds=function(k,j){var l=this;return new Promise(function(m,n){new c().getJson(l.options.restUrl+"resources/rgn/outputformat?physicalids="+k.join(",")).then(function(o){l.pushOutputFormat(o,j);if(o.length===k.length){m(l.ofs)}else{n(new Error("Output Formats not dropped or partially dropped"))}},function(o){n(o)})})};return g})()});define("DS/RGR/ReportLibrary",["DS/UIKIT/SuperModal","DS/RGNServices/RGNServices","DS/RGNServices/Request","DS/RGNServices/Dialogs","DS/RGNServices/Alert","DS/RGR/ReportForm"],function(a,e,d,c,b,f){return(function(){var o="name",k="title",l=new c(),n=function(s){return s[k]||s[o]||s.name},j={templateType:"Report Model",templateDomId:"reportTemplate",ofType:"Report Template",ofDomId:"reportOutputFormat",tgtDocType:"DOCUMENTS",tgtDocDomId:"reportTargetDocument"},h=function(s,u){var t=s.message||s.error.message;b.error(t);if(u){u(s)}},i,g=function(v,s,t,u){v.reload(s);i(v,s,t,u)},m=function(u,t,s){clearInterval(u.timer);u.timer=setInterval(function(){i(u,s)},t)},p=function(u,t,s){return new Promise(function(w,v){if(t.generationStatus.startsWith("NeedPostEdition")){var x=t.generationData.reportGeneratedName.replace(/^(.+)\.\w+$/,"$1.post");new d().getData(u.options.restUrl+"resources/rgn/report/download/"+t.genDocId+"/"+x,"text").then(function(y){new a().dialog({renderTo:s.container,title:"Post-Edition",body:y.replace("$PostEdition","Post-Edition"),buttons:[{value:"OK",action:function(A){var z={};A.getContent().getElements("span[contenteditable=true]").forEach(function(B){z[B.getAttribute("id")]=B.innerText||B.textContent});new d().putJson(u.options.restUrl+"resources/rgn/report/"+t.reportDataId+"/postedition",z).then(function(){A.hide();w()},function(B){A.hide();h(B,v)})}}]})},function(y){h(y,v)})}else{w()}})},r=function(u,t,s){return function(v,x){var w=v.physicalid;return new Promise(function(z,y){p(u,v,t).then(function(){v.generationData.RGNGenerationWithChanges=s;new d().postJson(u.options.restUrl+"resources/rgn/report/generate/"+w+(s?"/withchanges":"")).then(function(){x.style.color="#e87b00";x.title="Started";m(u,2000,t);z()},function(A){b.error(A.message);h(A,y)})})})}};i=function(y,v,w,x){var z=y.reports.map(function(A){return A.physicalid}),u=function(A){return function(B){return B.id===A}},t=v.container,s=[];t.querySelectorAll(".wux-layouts-collectionview-cell").forEach(function(A){if(A.getAttribute("is-visible")==="true"){s.push(A)}});if(z&&z.length>0){new d().postJson(y.options.restUrl+"resources/rgn/report/status",z).then(function(C){var E=false,I=false;for(var D=0;D<z.length;D++){var G=z[D],A=s.find(u(G));if(A){var L=A.info,F=A.querySelector(".wux-ui-3ds-reload"),K=A.querySelector(".wux-ui-3ds-rotate-cw"),B=L.generationData.RGNGenerationWithChanges?K:F,J=C[G];F.style.color="";K.style.color="";if(B){if(J){var H=J.status;L.generationStatus=H;if(J.progress!=="100"){B.style.color="#e87b00";E=true}else{I=I||(L.genDocId&&!A.querySelector(".wux-ui-3ds-download"));switch(J.status){case"":case"Succeeded":case"Completed":B.style.color="#57b847";H="Completed";break;case"NeedPostEdition":case"NeedPostEditionAndWithChanges":B.style.color="#0095ff";H="Click to perform the post-edition";break;default:B.style.color="#EA4F37";break}}B.setAttribute("title",H)}}}}m(y,E?2000:30000,v);if(I){g(y,v)}if(w){w()}},function(A){clearInterval(y.timer);if(x){x(A)}})}};function q(s){var t=this;this.options=s||{};this.reports=this.options.reports;new d().getJson(s.restUrl+"resources/rgn/report/derivative?types=DOCUMENTS,Report Model,Report Template").then(function(u){t.defaultInputDerivative=u},function(u){t.log(u);t.defaultInputDerivative={"Report Model":["Report Model"],"Report Template":["Report Template"],DOCUMENTS:["Report Document","Requirement Specification","Specification","DOCUMENTS","Document"]}})}q.prototype.log=function(s){if(window.rgnLog){window.rgnLog(s)}};q.prototype.reload=function(w,v){var y=this,u=this.options,x=u.app,t=u.restUrl,s=false;w.display(this.reports,{titleAttribute:k,contextualActions:{details:{className:"fonticon fonticon-attributes",icon:"legend-eye",tooltip:"Details",onclick:function(B){var A=new f(y,w,{report:B,withSearch:false,readOnly:true}),z=A.getForm().querySelector("#"+j.templateDomId),C=A.getForm().querySelector("#"+j.templateDomId+"OID").value.split(",")[0];z.onvaluechange(C,A.getForm().querySelector(".form-root"),B.inputInfo).then(function(){A.open(n(B))},function(D){b.error(D.message);A.open(n(B))})}},"delete":{className:"fonticon fonticon-trash",icon:"close",tooltip:"Delete",onclick:function(z){var A=z.physicalid;l.choice(x,{title:"Delete or Remove",message:"Delete "+z.display+" or remove it from view?",buttons:[{className:"primary",value:"Delete",action:function(B){B.getFooter().querySelectorAll(".btn-primary").forEach(function(C){C.setAttribute("disabled","")});new d().deleteObject(t+"resources/rgn/report/"+A).then(function(){w.removeElement(A).then(function(){y.reports=y.reports.filter(function(C){return C.physicalid!==A});i(y,w)},function(C){b.error(C.message)});B.hide()},function(C){B.hide();b.error(C.message)})}},{className:"primary",value:"Remove",action:function(B){B.getFooter().querySelectorAll(".btn-primary").forEach(function(C){C.setAttribute("disabled","")});y.popReport(z,w);B.hide()}},{className:"default",value:"Cancel",action:function(B){B.hide()}}]})}},edit:{className:"fonticon fonticon-pencil",icon:"pencil",tooltip:"Edit",onclick:function(B){var A=new f(y,w,{report:B,withSearch:false}),z=A.getForm().querySelector("#"+j.templateDomId),C=A.getForm().querySelector("#"+j.templateDomId+"OID").value.split(",")[0];z.onvaluechange(C,A.getForm().querySelector(".form-root"),B["attribute[ReportInputInformation]"]).then(function(){A.open("Edit "+n(B))},function(D){b.error(D.message)})}},download:{className:"fonticon fonticon-download",icon:"download",tooltip:"Download",onclick:function(B){if(B.genDocId){var A=B.generationData.reportGeneratedName,z=t+"resources/rgn/report/download/"+B.genDocId+"/"+A;e.download(A,z)}else{b.info("No file to download, please run a generation before")}}},reload:{className:"fonticon fonticon-reload",icon:"reload",tooltip:"Generate",getColor:function(A,B){var z=v[A];if(z){B.style.color="#e87b00"}},confirmation:function(z){return(z.generationStatus&&!z.generationStatus.startsWith("NeedPostEdition")&&z.needPostEdition)?"Skip post-edition?":undefined},onconfirm:r(y,w,false),onclick:r(y,w,false),onreject:function(z){return new Promise(function(C,B){var A=z.target;new d().postJson(t+"resources/rgn/report/generate/"+z.target.elementId+"/postedition").then(function(){A.style.color="#e87b00";A.title="Started";m(y,2000,w);C()},function(D){h(D,B)})})}},reloadWithChanges:{className:"fonticon fonticon-rotate-cw ",icon:"rotate-cw",tooltip:"Generate with changes",confirmation:function(z){return(z.generationStatus&&!z.generationStatus.startsWith("NeedPostEdition")&&z.needPostEdition)?"Skip post-edition?":undefined},onconfirm:r(y,w,true),onclick:r(y,w,true),onreject:function(z){return new Promise(function(C,B){var A=z.target;new d().postJson(t+"resources/rgn/report/generate"+z.target.elementId+"/posteditionandchanges").then(function(){A.style.color="#e87b00";A.title="Started";m(y,2000,w);C()},function(D){h(D,B)})})}}}});m(y,s?2000:30000,w)};q.prototype.refresh=function(s){g(this,s)};q.prototype.getReports=function(){return this.reports};q.prototype.pushReport=function(s,t){if(s instanceof Array){Array.prototype.push.apply(this.reports,s)}else{this.reports.push(s)}this.options.widgetInfo.setValue("reports",JSON.stringify(this.reports));t.refresh(this.reports)};q.prototype.popReport=function(s,t){var u=this.reports;u.forEach(function(w,v){if(w.physicalid===s.physicalid){u.splice(v,1)}});this.options.widgetInfo.setValue("reports",JSON.stringify(u));t.refresh(u)};q.prototype.pushDroppedIds=function(t,s){var u=this;return new Promise(function(v,w){new d().getJson(u.options.restUrl+"resources/rgn/report?physicalids="+t.join(",")).then(function(x){u.pushReport(x.reports,s);if(x.reports.length===t.length){v(u.reports)}else{w(new Error("Reports not dropped or partially dropped"))}},function(x){w(x)})})};q.prototype.inject=function(s){var t=this;return new Promise(function(v,w){try{g(t,s,v,w)}catch(u){w(u)}})};q.prototype.autoRefresh=function(s,t,u){i(this,s,t,u)};return q})()});define("DS/RGR/RGRApp",["UWA/Core","DS/ApplicationFrame/ActionBar","DS/RGNServices/QueryDisplayer","DS/RGR/OutputFormatLibrary","DS/RGR/ReportLibrary"],function(f,e,c,b,a){var d=function(g){this.options=g||{};this.reportLibrary=new a(g);this.reportPane=f.Element("div",{"class":"rgr-report"});this.reportDisplayer=new c(this.reportPane,{library:this.reportLibrary,label:"Reports",picture:g.appUrl+"snresources/images/icons/large/I_CDM_Document108x144.png",imageUrl:g.appUrl+"common/images/I_RGNReport.png"});this.ofLibrary=new b(g);this.outputFormatPane=f.Element("div",{"class":"rgr-output-format"});this.ofDisplayer=new c(this.outputFormatPane,{library:this.ofLibrary,label:"Output Formats",picture:g.appUrl+"snresources/images/icons/large/iconLargeDefault.png",imageUrl:g.appUrl+"common/images/I_RGNReportOutputFormat.png"});new e({file:"RGR.xml",context:{reportLibrary:this.reportLibrary,reportDisplayer:this.reportDisplayer,currentDisplayer:this.reportDisplayer,ofLibrary:this.ofLibrary,ofDisplayer:this.ofDisplayer,toString:function(){return"RGR"}},arguments:[{reportLibrary:this.reportLibrary,reportDisplayer:this.reportDisplayer,currentDisplayer:this.reportDisplayer,ofLibrary:this.ofLibrary,ofDisplayer:this.ofDisplayer}],module:"RGR"}).inject(g.app)};d.prototype.reloadWidget=function(){var g=this.options,h=g.app;this.reportDisplayer.show();this.ofDisplayer.hide();this.reportLibrary.inject(this.reportDisplayer);this.ofLibrary.inject(this.ofDisplayer);this.reportPane.inject(h);this.outputFormatPane.inject(h)};return d});define("DS/RGR/RGRUX",["UWA/Core","DS/Controls/Loader","DS/RGNServices/Request","DS/RGNServices/Alert","DS/RGR/RGRApp"],function(f,e,b,a,c){var d=function(g){this.options=g};d.prototype.initialize=function(h){var i=this,g=this.options.widgetInfo;return new Promise(function(q,s){var k=i.options.app,r=i.options,j=h[0]["3DSpace"]+"/",l=JSON.parse(g.getValue("reports")||"[]"),m=JSON.parse(g.getValue("outputFormats")||"[]"),p=j+"resources/rgn/report?physicalids="+l.map(function(t){return t.physicalid}).join(","),o=j+"resources/rgn/outputformat?physicalids="+m.map(function(t){return t.physicalid}).join(","),n=new e().inject(k);n.text="Reports Loading...";n.on();n.update("0");new b().getJson(p).then(function(t){n.text="Output Formats Loading...";n.update("50");new b().getJson(o).then(function(u){n.off();i.app=new c(f.extend({app:k,appUrl:j,restUrl:j,widgetInfo:g,source:g.getValue("x3dAppId")?g.getValue("x3dAppId"):"CATRGW_AP",reports:t.reports,outputFormats:u},r));i.app.reloadWidget();q(i.app)},function(u){n.off();a.error(u);s(u)})},function(t){n.off();a.error(t);s(t)})})};d.prototype.refresh=function(){this.app.reloadWidget();return f.Class.Promise.resolve()};return d});