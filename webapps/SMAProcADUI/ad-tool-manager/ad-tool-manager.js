/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
window.require(["DS/SMAProcADUI/ad-tool-instance/ADToolInstance","DS/SMAProcADUI/ad-tool-def/ADToolDef","DS/SMAProcADUI/ad-connector-def/ADConnectorDef"],function(x,b,u){var m=window.Polymer,n=window.DS;var y=null,g=null,h=null,I=null,c=null,B=null,w=null,l=null,v=null,k=null,o="../assets/images/SMAExeOSCommandConnector32.png",E={unknown:"unknown",osCommand:"osCommand",simToSO:"simToSO",osCommandSimToSO:"osCommandSimToSO"},d={osCommand:"com.dassault_systemes.sma.adapter.OSCommand",script:"com.dassault_systemes.sma.adapter.Script",v6Utility:"com.dassault_systemes.sma.adapter.V6Utility",v6UtilityPISimImport:"com.dassault_systemes.sma.plugin.V6UtilPIsimImport",v6UtilityPIResultsGen:"com.dassault_systemes.sma.plugin.V6UtilPIPhyResGenerate",download:"com.dassault_systemes.sma.adapter.Download",upload:"com.dassault_systemes.sma.adapter.Upload",cae3dx:"com.dassault_systemes.smampa.adapter.cae3dx",},j={templateWSError:"templateWSError",templateInfoWSError:"templateInfoWSError",templateViewWSError:"templateViewWSError",connectorWSError:"connectorWSError"},D={variable:"sp-variable"},F=null,z=null,e=null,i=null,H=null,q=null,t=null,f=null,a=null,G=null,s=null,p=null,r=null,C=null,A=null;y=function(K){var L,J,N,M;L=function(O){var P,Q;F.splice(0);if(O.response){Q=JSON.parse(O.response);Q.forEach(function(R){P=new b.ADToolDef();P.load(R);F.push(P)})}i[E.unknown]=o;i[E.osCommand]=o;i[E.simToSO]=o;if(K&&K.onComplete){K.onComplete(F)}}.bind(this);J=function(O){if(K&&K.onFailure){K.onFailure(j.templateWSError,O)}}.bind(this);N=function(O){this.fire("sessiontimeout",O)}.bind(this);M={verb:"GET",onComplete:L,onError:J,onSessionTimeout:N};this.$.templatesWS.sendRequest(M)};g=function(K){var J=E.unknownd;if(n.SMAProcADUI.ADToolManagerOSCommandSIMtoSOStrategy.isInstanceOfTool(K)){J=E.osCommandSimToSO}else{if(n.SMAProcADUI.ADToolManagerOSCommandStrategy.isInstanceOfTool(K)){J=E.osCommand}else{if(n.SMAProcADUI.ADToolManagerSimToSOStrategy.isInstanceOfTool(K)){J=E.simToSO}}}return J};h=function(K){var J=null;if(E.osCommand===K){J=new n.SMAProcADUI.ADToolManagerOSCommandStrategy();J.toolManager=this}else{if(E.simToSO===K){J=new n.SMAProcADUI.ADToolManagerSimToSOStrategy();J.toolManager=this}else{if(E.osCommandSimToSO){J=new n.SMAProcADUI.ADToolManagerOSCommandSIMtoSOStrategy();J.toolManager=this}}}return J};I=function(K){var J=null;if(K){J=i[K]}else{J=i[E.unknown]}return J};c=function(N,O,K,Q,P,R){var M=this.$.templateBaseWS.uri+K.modelID+"/instantiate?pid="+this.session.processID;var J=function(){if(R&&R.onComplete){R.onComplete(N,O,Q)}}.bind(this);var L=function(){if(R&&R.onFailure){R.onFailure(Q,"Web service failed attempting to create tool instance")}}.bind(this);this.$.templateBaseWS.sendRequest({uri:M,verb:"POST",headers:{"Content-Type":"application/ds-json",Accept:"*/*"},onComplete:J,onError:L,data:JSON.stringify(P)})};B=function(O,L){var M,J,N,K;M=function(V,U,R){var X,T=[],Q,W,S;W=H[V];if(typeof W!=="undefined"&&W&&W.length>0){if(R.response){X=JSON.parse(R.response);X.forEach(function(Y){Q=new u.ADConnectorDef();Q.load(Y);T.push(Q)});e[U.modelID]=T}for(S=0;S<W.length;S++){if(W[S].onComplete){W[S].onComplete(U,T)}}delete H[V]}};J=function(S,R){var T,Q;T=H[S];if(typeof T!=="undefined"&&T&&T.length>0){for(Q=0;Q<T.length;Q++){if(T[Q].onFailure){T[Q].onFailure(R,j.connectorWSError)}}delete H[S]}};N=this.$.connectorsWS.uri+O.modelID;K=H[N];if(!K){K=[];H[N]=K;var P={headers:{pragma:"no-cache"},verb:"GET",uri:N,onComplete:M.bind(this,N,O),onError:J.bind(this,N,O)};this.$.connectorsWS.sendRequest(P)}K.push(L?L:{})};w=function(O,L){var M,J,N,K;M=function(T,S,Q){var V,U,R;U=q[T];if(typeof U!=="undefined"&&U&&U.length>0){if(Q.response){V=JSON.parse(Q.response);S.editorID=V.TemplateViewID;S.toolDefID=V.ActivityTemplateID;for(R=0;R<U.length;R++){if(U[R].onComplete){U[R].onComplete(S,S.editorID)}}}delete q[T]}};J=function(S,R){var T,Q;T=q[S];if(typeof T!=="undefined"&&T&&T.length>0){for(Q=0;Q<T.length;Q++){if(T[Q].onFailure){T[Q].onFailure(R,j.templateInfoWSError)}}delete q[S]}};N=this.$.templateIDsWS.uri+O.modelID+"/templateViews?SecurityContext="+this.globals.securityContext;K=q[N];if(!K){K=[];q[N]=K;var P={headers:{pragma:"no-cache"},verb:"GET",uri:N,onComplete:M.bind(this,N,O),onError:J.bind(this,N,O)};this.$.templateIDsWS.sendRequest(P)}K.push(L?L:{})};l=function(O,L){var M,J,N,K;M=function(U,T,Q){var W,V,S,R;W=t[U];if(typeof W!=="undefined"&&W&&W.length>0){if(Q.response){V=JSON.parse(Q.response);S=new n.SMAProcADUI.ADToolEditor();S.load(V);z[T.editorID]=S;for(R=0;R<W.length;R++){if(W[R].onComplete){W[R].onComplete(T,S)}}}delete t[U]}};J=function(S,R){var T,Q;T=t[S];if(typeof T!=="undefined"&&T&&T.length>0){for(Q=0;Q<T.length;Q++){if(T[Q].onFailure){T[Q].onFailure(R,j.templateViewWSError)}}delete t[S]}};N=this.$.templateViewsWS.uri+O.editorID+"?SecurityContext="+this.globals.securityContext;K=t[N];if(!K){K=[];t[N]=K;var P={headers:{pragma:"no-cache"},verb:"GET",uri:N,onComplete:M.bind(this,N,O),onError:J.bind(this,N,O)};this.$.templateViewsWS.sendRequest(P)}K.push(L?L:{})};v=function(){this.DOM(this).find(D.variable).forEach(function(J){this.set("globals."+J.name,J.getValue())}.bind(this));if(!e){e={}}if(!z){z={}}if(!i){i={}}if(!H){H={}}if(!q){q={}}if(!t){t={}}};k=function(J){this.set("globals."+J.detail.name,J.detail.value)};f=function(K,J){if(!F||K){F=(!F)?[]:F;y.call(this,J)}else{if(J&&J.onComplete){J.onComplete(F)}}},a=function(N,M){var J=null,L,K;for(K=0;K<F.length;K++){if(F[K]){L=F[K];if(L.name===N){if(!M||L.isLatestRevision){J=L;break}}}}return J};G=function(M,K){var L,J,N;if(M){L=function(P,O){if(K&&K.onComplete){K.onComplete(P,O)}}.bind(this);J=function(P,O){if(K&&K.onFailure){K.onFailure(P,O)}}.bind(this);N=e[M.modelID];if(!N){B.call(this,M,{onComplete:L,onFailure:J})}else{if(K&&K.onComplete){K.onComplete(M,N)}}}};s=function(P,J,K){var L=null,O,N,M;O=e[P];if(typeof O!=="undefined"&&O){for(M=0;M<O.length;M++){N=O[M];if(N.appName===J&&(N.appVersion===K||typeof(K==="undefined")||!K||K==="")){L=N;break}}}return L};p=function(P,N,L,J,K){var Q=this.$.templateBaseWS.uri+L.modelID+"/options";var O=function(R){var V=[];var U=JSON.parse(R.response);for(var T=0;T<U.length;T++){if(T!==2){V.push(U[T])}else{var S=U[T];S.value=J;S.modified="true";V.push(S)}}c.call(this,P,N,L,J,V,K)}.bind(this);var M=function(){if(K&&K.onFailure){K.onFailure(J,"Web service failed attempting to instantiate")}}.bind(this);this.$.templateBaseWS.sendRequest({uri:Q,verb:"GET",onComplete:O,onError:M})};r=function(L,J){var K=new x.ADToolInstance();K.toolManager=this;K.stationManager=this.$.stationManager;K.toolType=g.call(this,L);K.configuration=h.call(this,K.toolType);K.icon=I.call(this,K.toolType);K.session=this.session;K.load(L,J);return K};C=function(O,M){var N=null,L=null,K=null,J=null;if(O){N=function(P){l.call(this,P,{onComplete:K,onFailure:J})}.bind(this);L=function(Q,P){if(M&&M.onFailure){M.onFailure(Q,P)}}.bind(this);K=function(Q,P){if(M&&M.onComplete){M.onComplete(Q,P)}}.bind(this);J=function(Q,P){if(M&&M.onFailure){M.onFailure(Q,P)}}.bind(this);if(!O.editorID){w.call(this,O,{onComplete:N,onFailure:L})}else{if(!z[O.editorID]){l.call(this,O,{onComplete:K,onFailure:J})}else{if(M&&M.onComplete){M.onComplete(O,z[O.editorID])}}}}};A=function(J){this.session.addReferencedContentAS(J)};n.SMAProcADUI=n.SMAProcADUI||{};n.SMAProcADUI.ADToolManager=m({is:"ad-tool-manager",properties:{globals:{type:Object,value:function(){return{}},},session:{type:Object,value:null},EXTENSIONTYPES:{type:Object,value:function(){return d},readOnly:true}},ready:function(){return v.apply(this,arguments)},onVariableValueChange:function(){return k.apply(this,arguments)},getToolDefs:function(){return f.apply(this,arguments)},findToolDef:function(){return a.apply(this,arguments)},getConnectorDefs:function(){return G.apply(this,arguments)},findToolConnectorDef:function(){return s.apply(this,arguments)},createToolInstance:function(){return p.apply(this,arguments)},loadToolInstance:function(){return r.apply(this,arguments)},getToolEditor:function(){return C.apply(this,arguments)},addReferencedContent:function(){A.apply(this,arguments)},behaviors:[n.SMAProcSP.SPBase],_computeConnectorsUri:function(J){var K="";if(typeof J!=="undefined"){K=J+"/connectors/options/"}return K},_computeTemplatesUri:function(J){var K="";if(typeof J!=="undefined"){K=J+"/templates?templateType=type_SimulationActivity&usage=Adhoc"}return K},_computeTemplateIDsUri:function(J){var K="";if(typeof J!=="undefined"){K=J+"/activity/"}return K},_computeTemplateViewsUri:function(J){var K="";if(typeof J!=="undefined"){K=J+"/templateviews/"}return K},_computeTemplatesBaseUri:function(J){var K="";if(typeof J!=="undefined"){K=J+"/templates/"}return K},_computeToolsMetadataUri:function(){return this.resolveUrl("../../SMAProcADUI/assets/toolsMetadata.json")}});n.SMAProcADUI.ADToolManager.TOOLTYPES=n.SMAProcADUI.ADToolManager.TOOLTYPES||E;n.SMAProcADUI.ADToolManager.EXTENSIONTYPES=n.SMAProcADUI.ADToolManager.EXTENSIONTYPES||d;n.SMAProcADUI.ADToolManager.ERRORS=n.SMAProcADUI.ADToolManager.ERRORS||j});