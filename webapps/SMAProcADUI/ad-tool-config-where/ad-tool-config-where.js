/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
window.require(["DS/SMAProcADUI/ad-station/ADStation","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle"],function(F,m,d){var Y=window.Polymer,ac=window.DS;var w=null,K=null,r=null,c=null,Q=null,z=null,N=null,p=null,s=null,U=null,E=null,b=null,C=null,L=null,aa=null,q=null,G=null,e=null,ad=null,O=null,M=null,f=null,B=null,u=null,ae=null,A=null,R=null,v=null,Z=null,I=null,t=null,j=null,a="Running stations",o="Other stations",T="Local station",S="__autogen",l="Select a server...",x="Select a station...",k="Loading...",X="An unspecified error occurred attempting to access the COS server.",i="An error occurred attempting to access the COS server.  This may be caused by Web browser security restrictions.",D="There are several issues with the selected station.  Click this icon to see more information.",ab="This station is not running. To run the tool, you must launch the selected station or select a different station.",ag="The local station is not running.  To run the tool, you must launch the local station or select a different station.",y="This station is not connected with a COS server. To run the tool, you must select a station that is connected with a COS server.",P="There are multiple servers that are connected to a station with this name.",W="Multiple COS servers are connected to a station with this name. The default COS server has been selected.",h="This station may not have access to the selected execution directory.",V="The execution directory will be automatically deleted on job completion.",n={appMessage:"appmessage",hideMessage:"hidemessage",},g={disabled:"disabled",hidden:"hidden"},H={python:"Abaqus/Python",viewer:"Abaqus/Viewer",cae:"Abaqus/CAE"},af=null,J=null;w=function(){this.$.serverList=new m({id:"serverList",placeholder:l});this.$.serverList.inject(this.$.serverListContainer);this.$.serverList.addEvent("onChange",B,this);this.$.stationList=new m({id:"stationList",placeholder:x});this.$.stationList.inject(this.$.stationListContainer);this.$.stationList.addEvent("onChange",u,this);this.$.directoryList=new m({id:"directoryList",placeholder:false});this.$.directoryList.inject(this.$.directoryListContainer);this.$.directoryList.addEvent("onChange",ae,this);this.$.cleanupOption=new d({type:"checkbox",id:"cleanupOption"+new Date().getTime(),name:"cleanupOption"+new Date().getTime(),label:"Remove directory after execution"}).setClassName("primary").inject(this.$.cleanupOptionContainer);this.$.cleanupOption.addEvent("onChange",A,this)};K=function(al){var ah=function(){this.$.serverList.setPlaceholder(k);this.$.serverList.disable();this.DOM(this.$.refreshServers).addClass(g.disabled);this.$.stationList.setPlaceholder(k);this.$.stationList.disable();this.DOM(this.$.refreshStations).addClass(g.disabled);this.$.directoryList.setPlaceholder(k);this.$.directoryList.disable();this.$.cleanupOption.disable()}.bind(this),ai=function(){this.$.serverList.setPlaceholder(l);this.$.serverList.enable();this.DOM(this.$.refreshServers).removeClass(g.disabled);this.$.stationList.setPlaceholder(x);this.$.stationList.enable();this.DOM(this.$.refreshStations).removeClass(g.disabled);this.$.directoryList.setPlaceholder(false);this.$.directoryList.enable();this.$.cleanupOption.enable()}.bind(this),ak=function(){ai();r.call(this,false);c.call(this,false);Q.call(this);this._uiPopulated=true;if(al&&al.onComplete){al.onComplete()}}.bind(this),aj=function(an){ai();r.call(this,false);c.call(this,false);Q.call(this);this._uiPopulated=true;if(al&&al.onFailure){al.onFailure(an)}}.bind(this);var am=function(){if(typeof this.$.serverList!=="undefined"&&typeof this.$.stationList!=="undefined"&&typeof this.$.directoryList!=="undefined"){ah();this.$.stationManager.refresh({onComplete:ak,onFailure:aj,refreshServers:!this.$.stationManager.hasRefreshed(),refreshStations:((typeof al.refreshStations!=="undefined")&&(al.refreshStations!==null))?al.refreshStations:true,refreshPrivateStations:((typeof al.refreshPrivateStations!=="undefined")&&(al.refreshPrivateStations!==null))?al.refreshPrivateStations:true})}else{setTimeout(am.bind(this),100)}}.bind(this);am()};r=function(ap){var aj,aq=0,ai=false,ak=false,ar=N.call(this),at=s.call(this),al=function(av,au){return av.id.toLowerCase().localeCompare(au.id.toLowerCase())},an,ah=null,ao=function(au){if(au&&au.length>0){au.sort(al);for(aj=0;aj<au.length;aj++){ai=((ar&&(au[aj].id===ar.id))||(au[aj].length===1));ak=ai||ak;an=this.$.serverList.add({value:au[aj].id,label:((au[aj].isDefault)?au[aj].id+" [Default]":au[aj].id),selected:ai});if(au[aj].isDefault){ah=an}aq++}if(at){U.call(this,at.name)}}if(!ak&&ah){this.$.serverList.select(ah);ak=true}this.$.serverList.setPlaceholder(ak?false:l);this.$.serverList.enable();this.$.stationList.enable();this.$.directoryList.enable();G.call(this);this._loading=false}.bind(this),am=function(){this.$.serverList.setPlaceholder(l);this.$.serverList.enable();this.$.stationList.enable();this.$.directoryList.enable();G.call(this);this._loading=false}.bind(this);this._loading=true;this.$.serverList.remove();this.$.serverList.setPlaceholder(k);this.$.serverList.disable();this.$.stationList.disable();this.$.directoryList.disable();this.$.stationManager.getServers({onComplete:ao,onFailure:am,refresh:ap})};c=function(al){var aj,ao=false,an=false,ap=N.call(this),ar=s.call(this),ak=null,am=null,aq=function(au,at){if(F.ADStation.LOCALSTATIONNAME===au.name){return -1}else{if(F.ADStation.LOCALSTATIONNAME===at.name){return 1}else{return au.name.toLowerCase().localeCompare(at.name.toLowerCase())}}},ai=function(aw){if(aw&&aw.length>0){var av=[],au=[],at;aw.forEach(function(ax){if(ax.status===F.ADStation.STATUS.running){av.push(ax)}else{au.push(ax)}}.bind(this));av.sort(aq);au.sort(aq);for(aj=0;aj<av.length;aj++){ao=((ar&&(ar.name===av[aj].name))&&(ap&&(ap.id===av[aj].server)));an=ao||an;at=(F.ADStation.LOCALSTATIONNAME===av[aj].name)?T:av[aj].name;ak=this.$.stationList.add({value:av[aj].name,label:at+" ["+F.ADStation.STATUS.running+"]",group:a,selected:ao});if(av[aj].name===F.ADStation.LOCALSTATIONNAME){am=ak}if(this.$.spCreditsCalculatorPremise){this.$.spCreditsCalculatorPremise.operatingSystem=av[aj].os}}for(aj=0;aj<au.length;aj++){ao=((ar&&(ar.name===au[aj].name))&&(ap&&(ap.id===au[aj].server)));an=ao||an;at=(F.ADStation.LOCALSTATIONNAME===au[aj].name)?T:au[aj].name;ak=this.$.stationList.add({value:au[aj].name,label:at+" ["+au[aj].status+"]",group:o,selected:ao});if(au[aj].name===F.ADStation.LOCALSTATIONNAME){am=ak}}}if(!an&&am){this.$.stationList.select(am);an=true}this.$.stationList.setPlaceholder(an?false:x);this.$.stationList.enable();if(this.$.spCreditsCalculatorPremise){this.$.spCreditsCalculatorPremise.addEventListener("coreschanged",t.bind(this));this.$.creditsEstimatorContainer.appendChild(this.$.spCreditsCalculatorPremise)}G.call(this);this._loading=false;if(an){u.call(this)}}.bind(this),ah=function(au){var at=X;if(ac.SMAProcADUI.ADStationManager.ERRORS.possibleMixedContent===au){at=i}this.fire(n.appMessage,{level:"error",category:"stationmanager",message:at});this.$.stationList.setPlaceholder(x);this.$.stationList.enable();G.call(this);this._loading=false}.bind(this);this._loading=true;this.$.stationList.remove();if(ap){this.$.stationList.setPlaceholder(k);this.$.stationList.disable();this.$.stationManager.getStations({onComplete:ai,onFailure:ah,serverId:ap.id,refresh:al})}};Q=function(){var aj,ai,al,ak,ah=function(an,am){return an.name.toLowerCase().localeCompare(am.name.toLowerCase())};this._loading=true;this.$.directoryList.remove();this.$.directoryList.setPlaceholder(k);this.$.directoryList.disable();this.$.directoryList.options.length=0;ai=E.call(this);ak={value:S,label:"Create new directory",selected:!ai};this.$.directoryList.add(ak);al=this.$.stationManager.getExecDirs(null);if(al&&al.length>0){al.sort(ah);for(aj=0;aj<al.length;aj++){if(!al[aj].removeAfterJob){ak={value:al[aj].name,label:al[aj].name,selected:ai&&al[aj].name.toLowerCase()===ai.name.toLowerCase()&&!al[aj].accessDisabled,disabled:al[aj].accessDisabled};this.$.directoryList.add(ak)}}}this.$.directoryList.setPlaceholder(false);this.$.directoryList.enable();G.call(this);this._loading=false};z=function(){var an=null,ar=null,ao=null,aj=false,at=false,ap=false,al=false,ai=false,ak,ah,am,aq;this._loading=true;if(this.tools){for(ak=0;ak<this.tools.length;ak++){if(!this.tools[ak].server){ah=this.$.stationManager.getServerForStation(this.tools[ak].station);this.tools[ak].server=ah?ah.id:null}if(ak>0){at=(this.tools[ak].server!==an);ap=(this.tools[ak].station!==ar);al=(this.tools[ak].workDir&&this.tools[ak].workDir.name!==ao);ai=(this.tools[ak].removeWorkDir!==aj)}an=this.tools[ak].server;ar=this.tools[ak].station;if(this.tools[ak].workDir){ao=this.tools[ak].workDir.name}else{ao=S}aj=this.tools[ak].removeWorkDir}if(this.session.onCloud&&this.tools[0].toolType!==ac.SMAProcADUI.ADToolManager.TOOLTYPES.simToSO&&this.tools[0].configuration.getAppName()!==H.python&&this.tools[0].configuration.getAppName()!==H.viewer&&this.tools[0].configuration.getAppName()!==H.cae){this.$.creditsEstimatorContainer.innerHTML="";this.$.spCreditsCalculatorPremise=document.createElement("sp-credits-calculator");this.$.spCreditsCalculatorPremise.id="spCreditsCalculatorPremise";this.$.spCreditsCalculatorPremise.onPremiseStationOnCloud3X=true;this.$.spCreditsCalculatorPremise.cpuLimt=this.session.cpuLimit;aq=this.tools[0].getActivityConfig();if(aq){this.$.spCreditsCalculatorPremise.options=aq}}}else{at=true;ap=true;al=true;ai=true}if(this.tools&&!at&&!ap&&!an&&!ar){ah=this.$.stationManager.getInitialServer();if(ah){p.call(this,ah.id);c.call(this,false);for(ak=0;ak<this.tools.length;ak++){this.tools[ak].server=ah.id}am=this.$.stationManager.getServerForStation(F.ADStation.LOCALSTATIONNAME);if(am&&(am.id===ah.id)){U.call(this,F.ADStation.LOCALSTATIONNAME);for(ak=0;ak<this.tools.length;ak++){this.tools[ak].station=F.ADStation.LOCALSTATIONNAME}}else{U.call(this,null)}}else{p.call(this,null);U.call(this,null)}}else{if(!at){p.call(this,an);c.call(this,false)}else{p.call(this,null)}if(!ap){if(an){U.call(this,ar)}else{if(ar){this.$.stationList.add({value:ar,label:(F.ADStation.LOCALSTATIONNAME===ar)?T:ar,selected:true})}}}else{U.call(this,null)}}if(!al){b.call(this,ao)}else{b.call(this,null)}if(!ai){this.$.cleanupOption.setCheck(aj);this.$.cleanupOption.indeterminate=false}else{this.$.cleanupOption.indeterminate=true}L.call(this);G.call(this);this._loading=false};N=function(){var ah,ai=null;ah=this.$.serverList.getSelection(false);if(ah&&(ah.length===1)){ai=this.$.stationManager.getServer(ah[0].value)}return ai};p=function(ai){var ah,ak=null,aj;if(ai){ah=this.$.serverList.getOptions(false);for(aj=0;aj<ah.length;aj++){if(ah[aj].value===ai){ak=ah[aj];break}}if(ak){this.$.serverList.select(ak)}}else{this.$.serverList.clear()}};s=function(){var ai,aj=null,ah=null;ai=this.$.stationList.getSelection(false);if(ai&&(ai.length===1)){aj=N.call(this);if(aj){ah=this.$.stationManager.getStation(ai[0].value,aj.id)}}return ah};U=function(ai){var ah,ak=null,aj;if(ai){ah=this.$.stationList.getOptions(false);for(aj=0;aj<ah.length;aj++){if(ah[aj].value===ai){ak=ah[aj];break}}if(ak){this.$.stationList.select(ak)}}else{this.$.stationList.clear()}};E=function(){var ai,ah=null;ai=this.$.directoryList.getSelection(false);if(ai&&(ai.length===1)){ah=this.$.stationManager.getExecDirByName(ai[0].value)}return ah};b=function(ai){var ah,ak=null,aj;if(ai){ah=this.$.directoryList.getOptions(false);for(aj=0;aj<ah.length;aj++){if(ah[aj].value===ai){ak=ah[aj];break}}if(ak){this.$.directoryList.select(ak)}}else{this.$.directoryList.clear()}};C=function(){var ah=function(){var aj=function(){z.call(this)}.bind(this),ai=function(){z.call(this)}.bind(this);if(this._uiCreated){if(this.tools.length===0){this.DOM(this.$.configurationSection).addClass(g.hidden);this.DOM(this.$.configurationErrorNone).removeClass(g.hidden)}else{this.DOM(this.$.configurationSection).removeClass(g.hidden);this.DOM(this.$.configurationErrorNone).addClass(g.hidden);if(!this._uiPopulated){K.call(this,{onComplete:aj,onFailure:ai})}else{z.call(this)}}}else{window.setTimeout(ah.bind(this),50)}};if(this._uiCreated){ah.call(this)}else{window.setTimeout(ah.bind(this),50)}};L=function(){var ah=this.$.stationList.getOptions(false),ai,aj;for(ai=0;ai<ah.length;ai++){aj=this.$.stationManager.getStation(ah[ai].value);if(aj){if(aa.call(this,aj)){this.$.stationList.enable(ah[ai])}else{this.$.stationList.disable(ah[ai])}}}};aa=function(aj){var ah=true,ai;if(this.tools){for(ai=0;ai<this.tools.length;ai++){if(!this.tools[ai].configuration.runsOnStation(aj)){ah=false;break}}}return ah};q=function(al,am,ah,aj,ai){var ak="There are several issues with the selected station.";if(al){if(aj){ak+="  "+ag}else{ak+="  "+ab}}if(am===0){ak+="  "+y}else{if(am>1){if(ah){ak+="  "+W}else{ak+="  "+P}}}if(ai){ak+="  "+h}return ak};G=function(){var ar=N.call(this),au=s.call(this),an=E.call(this),at=null,ap=false,aq=1,aj=false,ah=false,ao=false,am=0,ai=null,ak="",al="";if(au){if(F.ADStation.LOCALSTATIONNAME===au.name){aj=true}if(F.ADStation.STATUS.running!==au.status){ap=true;am++}at=this.$.stationManager.getServersForStation(au.name);if(Array.isArray(at)){aq=at.length;if(ar.isDefault){ah=true}am++}}else{ai=this.$.stationList.getSelection(false);if(ai&&(ai.length===1)){if(ai[0].value===F.ADStation.LOCALSTATIONNAME){aj=true;ap=true}else{aq=0}am++}}if(au&&an&&!this.$.stationManager.stationSupportsExecDir(au,an)){ao=true;am++}if(am>0){this.DOM(this.$.stationErrorMessage).removeClass(g.hidden);if(am>1){ak=D;al=q.call(this,ap,aq,ah,aj,ao)}else{if(ap){if(aj){ak=al=ag}else{ak=al=ab}}else{if(aq===0){ak=al=y}else{if(aq>1){if(ah){ak=al=W}else{ak=al=P}}else{if(ao){ak=al=h}}}}}this.$.stationErrorMessageIcon.title=ak;this.$.stationErrorMessageText.textContent=al}else{this.DOM(this.$.stationErrorMessage).addClass(g.hidden)}};O=function(){this._uiCreated=false;this._uiPopulated=false;this._loading=false};M=function(){w.call(this);this._uiCreated=true};f=function(){if(window.widget){this._tenantID=window.widget.getValue("tenantId");this._licenseURL=window.widget.getValue("licenseURL")}};B=function(){var ai=null,ah;if(!this._loading){ai=N.call(this);if(this.tools){for(ah=0;ah<this.tools.length;ah++){this.tools[ah].server=ai?ai.id:null;this.tools[ah].station=null}}if(ai){this.$.serverList.setPlaceholder(false)}}U.call(this,null);c.call(this,false);G.call(this)};u=function(){var ai,ah;if(!this._loading){ai=s.call(this);if(this.tools){for(ah=0;ah<this.tools.length;ah++){this.tools[ah].station=ai?ai.name:null;if(this.tools[ah].toolType===ac.SMAProcADUI.ADToolManager.TOOLTYPES.osCommandSimToSO){if(this.abaqusStudyMode){if(ai&&ai.os===F.ADStation.OSTYPES.linux){this.tools[ah].configuration.setSimToSOExecutable(false)}else{if(this.tools[ah].configuration.resultFormatSupportsSimToSo()){this.tools[ah].configuration.setSimToSOExecutable(true)}else{this.tools[ah].configuration.setSimToSOExecutable(false)}}}else{this.tools[ah].configuration.setSimToSOExecutable(false)}}}}if(ai){if(this.$.spCreditsCalculatorPremise){this.$.spCreditsCalculatorPremise.operatingSystem=ai.os}this.$.stationList.setPlaceholder(false)}G.call(this)}};ae=function(){var ak,ah=null,ai=null,aj;if(!this._loading){ak=this.$.directoryList.getSelection(false);if(ak&&(ak.length===1)){ah=ak[0].value}if(this.tools){if(ah&&ah!==S){ai=E.call(this)}for(aj=0;aj<this.tools.length;aj++){this.tools[aj].workDir=ai}}G.call(this)}};A=function(ai){var aj=this.$.cleanupOption.isChecked();if(!this._loading){if(aj){this.fire(n.appMessage,{level:"warning",category:"cleanupExecDirWarning",message:V,autoRemove:true})}else{this.fire(n.hideMessage,{category:"cleanupExecDirWarning"})}var ah;if(this.tools){for(ah=0;ah<this.tools.length;ah++){this.tools[ah].removeWorkDir=aj}}}G.call(this);ai.stopPropagation();ai.cancelBubble=true};R=function(ah){r.call(this,true);ah.stopPropagation();ah.cancelBubble=true};v=function(ah){c.call(this,true);ah.stopPropagation();ah.cancelBubble=true};Z=function(ah){this.DOM(this.$.stationErrorPopover).toggleClass(g.hidden);ah.stopPropagation();ah.cancelBubble=true};I=function(ah){this.DOM(this.$.stationErrorPopover).addClass(g.hidden);ah.stopPropagation();ah.cancelBubble=true};af=function(){var ai=function(){z.call(this);this._loading=false}.bind(this),ah=function(){z.call(this);this._loading=false}.bind(this);this._loading=true;K.call(this,{onComplete:ai,onFailure:ah})};J=function(){this._loading=true;Q.call(this);z.call(this);this._loading=false};j=function(){if(this.tools&&(this.tools.length>0)){this.tools[0].station=this.tools[0].station;this.tools[0].setOnPremiseExecConfig();if(this.tools[0].toolType!==ac.SMAProcADUI.ADToolManager.TOOLTYPES.simToSO){this.tools[0].configuration.resetCommand()}}};t=function(ah){ah.preventDefault();ah.stopPropagation();ah.cancelBubble=true;e.call(this,ah)};e=function(ah){ah.stopPropagation();ah.cancelBubble=true;this.numCores=ah.detail.cores;this.perfIndex=ah.detail.perfIndex;this.licenseType=ah.detail.licenseType;this.licenseEstimateOptions=ah.detail.licenseEstimateOptions;if(this.session&&this.tools&&(this.tools.length>0)&&this.session.onCloud){ad.call(this,this.licenseType,this._tenantID,this.numCores,this.perfIndex,this._licenseURL)}if(this.licenseEstimateOptions){this.tools[0].setActivityConfig(this.licenseEstimateOptions)}};ad=function(ah,al,ai,ak,aj){if(this.tools&&this.tools[0].toolType!==ac.SMAProcADUI.ADToolManager.TOOLTYPES.simToSO){this.tools[0].setEnvSettingsProperty(ah,al,ai,ak,aj)}};ac.SMAProcADUI=ac.SMAProcADUI||{};ac.SMAProcADUI.ADToolConfigWhere=Y({is:"ad-tool-config-where",properties:{session:{value:null,},tools:{type:Array,value:function(){return[]},observer:"toolsChanged"},abaqusStudyMode:{type:Boolean,value:false}},created:function(){return O.apply(this,arguments)},attached:function(){return M.apply(this,arguments)},ready:function(){return f.apply(this,arguments)},modeChanged:function(ah,ai){console.log(ah,ai)},onServerChange:function(){return B.apply(this,arguments)},onStationChange:function(){return u.apply(this,arguments)},onWorkingDirChange:function(){return ae.apply(this,arguments)},onCleanupOptionChange:function(){return A.apply(this,arguments)},onRefreshServers:function(){return R.apply(this,arguments)},onRefreshStations:function(){return v.apply(this,arguments)},onClickAlert:function(){return Z.apply(this,arguments)},onClickAlertPopover:function(){return I.apply(this,arguments)},refresh:function(){return af.apply(this,arguments)},refreshExecDirs:function(){return J.apply(this,arguments)},setOnPremiseExecConfig:function(){return j.apply(this,arguments)},onNumCoresChanged:function(){return t.apply(this,arguments)},toolsChanged:function(){C.call(this)},behaviors:[ac.SMAProcSP.SPBase]})});