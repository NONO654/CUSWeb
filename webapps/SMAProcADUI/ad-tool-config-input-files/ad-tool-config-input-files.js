/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
(function(m){var f=m.Polymer,l=m.DS;var x=null,t=null,n=null,v=null,s=null,w=null,b=null,h=null,e=null,r=null,q=null,d=null,u=null,a=null,k=null,g=null,j=null,p="InputFiles",o="ManagedData",i={disabled:"disabled"},c=null;x=function(){this.$.filesPanel.removeAllItems();this.loading=true;if(this.tools&&this.tools.length>0){var y=this.tools[0].inputObjects,A,B,z;if(y){for(A=0;A<y.length;A++){B=y[A];if(B.type==="fileversion"){z=this.$.filesPanel.createItem("ad-multiview-fileversion")}else{if(B.type==="file"){z=this.$.filesPanel.createItem("ad-multiview-file")}else{if(B.type==="document"){z=this.$.filesPanel.createItem("ad-multiview-document")}else{if(B.type==="folder"){z=this.$.filesPanel.createItem("ad-multiview-folder")}}}}z.model=B;z.modelSource=p;z.hideDetails=true;if(B.isActivityContent){z.viewState=z.VIEWSTATE.accessDisabled}else{z.viewState=z.VIEWSTATE.ready}this.$.filesPanel.addItem(z)}}n.call(this)}this.loading=false};t=function(){var y=this.$.filesPanel.selections.length,A=y>0,z;for(z=0;z<y;z++){if(this.$.filesPanel.selections[z].viewState===this.$.filesPanel.selections[z].VIEWSTATE.accessDisabled){A=false;break}}if(A){this.DOM(this.$.removeInputs).removeClass(i.disabled)}else{this.DOM(this.$.removeInputs).addClass(i.disabled)}if(this.viewMode===l.SMAProcADUI.ADMultiviewPanel.VIEWMODE.icon){this.DOM(this.$.viewIcons).addClass(i.disabled);this.DOM(this.$.viewList).removeClass(i.disabled)}else{if(this.viewMode===l.SMAProcADUI.ADMultiviewPanel.VIEWMODE.list){this.DOM(this.$.viewIcons).removeClass(i.disabled);this.DOM(this.$.viewList).addClass(i.disabled)}}};n=function(){var y=this.$.filesPanel.getItems();if(!y||y.length===0){this.DOM(this.$.contentRow).addClass("hidden");this.DOM(this.$.placeholderRow).removeClass("hidden")}else{this.DOM(this.$.contentRow).removeClass("hidden");this.DOM(this.$.placeholderRow).addClass("hidden")}};v=function(){if(this.tools&&this.tools.length===0){this.DOM(this.$.mainContentSection).removeClass("hidden");this.DOM(this.$.configurationSection).addClass("hidden");this.DOM(this.$.configurationErrorNone).removeClass("hidden");this.DOM(this.$.configurationErrorMultiple).addClass("hidden");this.DOM(this.$.noDownloadSupportNote).addClass("hidden")}else{if(this.tools&&this.tools.length>1){this.DOM(this.$.mainContentSection).removeClass("hidden");this.DOM(this.$.configurationSection).addClass("hidden");this.DOM(this.$.configurationErrorNone).addClass("hidden");this.DOM(this.$.configurationErrorMultiple).removeClass("hidden");this.DOM(this.$.noDownloadSupportNote).addClass("hidden")}else{if(this.tools&&this.tools[0].supportsDownload){this.DOM(this.$.mainContentSection).removeClass("hidden");this.DOM(this.$.configurationSection).removeClass("hidden");this.DOM(this.$.configurationErrorNone).addClass("hidden");this.DOM(this.$.configurationErrorMultiple).addClass("hidden");this.DOM(this.$.noDownloadSupportNote).addClass("hidden");x.call(this)}else{this.DOM(this.$.mainContentSection).addClass("hidden");this.DOM(this.$.noDownloadSupportNote).removeClass("hidden")}}}};s=function(A){var z=this.$.filesPanel.getItems(),B,y,C=false;if(A){for(B=0;B<z.length;B++){if(z[B]&&z[B].model){y=z[B].model;if(y.name&&A.name&&y.name===A.name&&(y.type===A.type||A.type==="file"&&y.type==="fileversion"||A.type==="fileversion"&&y.type==="file")){C=true;break}}}}return C};w=function(y){var B,D,z,E=false,F;var A=[];F=this.$.currentDragObject.getValue();if(Array.isArray(F)){for(var C=0;C<F.length;C++){A.push(F[C])}}else{A.push(JSON.parse(F))}for(var G=0;G<A.length;G++){B=A[G];D=B.modelSource;z=B.model;if((D===o)&&z){E=!s.call(this,z)}}if(!this.$.dashboard.isInDashboard()){y.dataTransfer.dropEffect=E?"copy":"none"}else{y.dataTransfer.dropEffect=E?"copy":"move"}};b=function(y){var E,G,z,C,J=null,F=null,K=null,H,B=[];var A=y.dataTransfer.getData("text");if(A&&(typeof A==="string")){try{F=JSON.parse(A)}catch(I){}if(F){K=F.data.items[0]}}H=this.$.currentDragObject.getValue();if(H&&Array.isArray(H)){B=H}else{try{E=JSON.parse(H);B.push(E)}catch(I){}}if(K&&(K.objectType==="Simulation Process"||K.objectType==="Simulation")){}else{y.stopPropagation();y.cancelBubble=true;y.preventDefault();for(var D=0;D<B.length;D++){E=B[D];if(E){G=E.modelSource;z=E.model;if(G===o&&z){if(z&&!s.call(this,z)){if(z.type==="file"){if(z.details&&z.details.revision){delete z.details.revision}C=this.$.filesPanel.createItem("ad-multiview-file");C.viewState=C.VIEWSTATE.ready;C.hideDetails=true;C.model=z;C.modelSource=p;this.$.filesPanel.addItem(C);J=z}else{if(z.type==="fileversion"){C=this.$.filesPanel.createItem("ad-multiview-fileversion");C.viewState=C.VIEWSTATE.ready;C.hideDetails=true;C.model=z;C.modelSource=p;this.$.filesPanel.addItem(C);J=z}else{if(z.type==="document"){C=this.$.filesPanel.createItem("ad-multiview-document");C.viewState=C.VIEWSTATE.ready;C.hideDetails=true;C.model=z;C.modelSource=p;this.$.filesPanel.addItem(C);J=z}else{if(z.type==="folder"){C=this.$.filesPanel.createItem("ad-multiview-folder");C.viewState=C.VIEWSTATE.ready;C.hideDetails=true;C.model=z;C.modelSource=p;this.$.filesPanel.addItem(C);J=z}}}}if(J&&this.tools[0]){this.tools[0].addInputObject(J)}}}}}}};h=function(z){var y;if(z){while(z.length>0){y=z[0];if(typeof y.model!=="undefined"&&y.model){this.tools[0].removeInputObject(y.model);this.$.filesPanel.removeItem(y)}}}t.call(this);n.call(this)};e=function(){this.loading=false};r=function(){var y=localStorage["SMAProcAdhoc.preferences.inputFilesViewMode"];if(y&&y.length>0){this.viewMode=y}t.call(this)};q=function(y){this.$.filesPanel.selections=[];t.call(this);y.stopPropagation();y.cancelBubble=true;y.preventDefault()};d=function(y){y.stopPropagation();y.cancelBubble=true;y.preventDefault();t.call(this)};u=function(y){y.stopPropagation();y.cancelBubble=true;y.preventDefault();w.call(this,y);return true};a=function(y){b.call(this,y);n.call(this);return true};k=function(){if(!f.dom(this.$.viewIcons).classList.contains(i.disabled)){this.viewMode=l.SMAProcADUI.ADMultiviewPanel.VIEWMODE.icon;localStorage["SMAProcAdhoc.preferences.inputFilesViewMode"]=l.SMAProcADUI.ADMultiviewPanel.VIEWMODE.icon;t.call(this)}};g=function(){if(!f.dom(this.$.viewList).classList.contains(i.disabled)){this.viewMode=l.SMAProcADUI.ADMultiviewPanel.VIEWMODE.list;localStorage["SMAProcAdhoc.preferences.inputFilesViewMode"]=l.SMAProcADUI.ADMultiviewPanel.VIEWMODE.list;t.call(this)}};j=function(){h.call(this,this.$.filesPanel.selections)};c=function(){x.call(this)};l.SMAProcADUI=l.SMAProcADUI||{};l.SMAProcADUI.ADToolConfigInputFiles=f({is:"ad-tool-config-input-files",properties:{access:{type:String,value:"",notify:true,reflectToAttribute:true},tools:{value:function(){return[]},observer:"toolsChanged"},viewMode:{type:String,value:"icon"}},attached:function(){return r.apply(this,arguments)},created:function(){return e.apply(this,arguments)},onContentAreaClick:function(){return q.apply(this,arguments)},onInputSelect:function(){return d.apply(this,arguments)},onDragOver:function(){return u.apply(this,arguments)},onDrop:function(){return a.apply(this,arguments)},onRemoveInputs:function(){return j.apply(this,arguments)},onViewIcons:function(){return k.apply(this,arguments)},onViewList:function(){return g.apply(this,arguments)},refresh:function(){return c.apply(this,arguments)},toolsChanged:function(){v.call(this)},behaviors:[l.SMAProcSP.SPBase],_computeClass:function(y){return this.tokenList({hidden:y==="icon"})+"btn btn-xs btn-default "+this.tokenList({hidden:y==="icon"})},_computeClass2:function(y){return this.tokenList({hidden:y==="list"})+"btn btn-xs btn-default "+this.tokenList({hidden:y==="list"})},tokenList:function(A){var y,z=[];for(var y in A){if(A[y]){z.push(y)}}return z.join(" ")}})}(this));