/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
window.require(["DS/UIKIT/Input/Select"],function(l){var h=window.Polymer,i=window.DS;var r,s=null,p=null,a=null,o=null,b=null,j=null,m=null,k=null,q=null,e=null,v=null,c=null,d=null,t={linux:"linux",windows:"windows"},g={cloud:"Cloud"},u={appMessage:"appmessage"},f="Abaqus Study is unable to find the DRM mode for the default 3DOrchestrate server. Try refreshing the widget or browser or contact your administrator for further assistance.",n="You selected an on-premise 3DOrchestrate server as default, however Abaqus Study is unable to find a server that supports cloud execution. Try refreshing the widget or browser or contact your administrator for further assistance.";b=function(){var x,w;if(this.tools&&this.tools[0]&&this.session.onCloud){this.$.creditsEstimatorContainer.innerHTML="";this.$.spCreditsCalculator=document.createElement("sp-credits-calculator");this.$.spCreditsCalculator.id="spCreditsCalculator";x=this.tools[0].getExecutionConfig();if(x&&x.properties&&x.properties.drmMode==="Cloud"&&x.properties.CloudConfig){if(x.properties.CloudConfig.os===t.linux){this.operatingSystem=t.linux;this.$.operatingSystem.select(t.linux)}else{if(x.properties.CloudConfig.os===t.windows){this.operatingSystem=t.windows;this.$.operatingSystem.select(t.windows)}}}if(this.tools[0].toolType===i.SMAProcADUI.ADToolManager.TOOLTYPES.simToSO){this.$.spCreditsCalculator.classList.add("hidden");this.$.operatingSystem.disable(t.linux)}else{this.$.spCreditsCalculator.operatingSystem=this.operatingSystem;this.$.spCreditsCalculator.onPremiseStationOnCloud3X=false;this.$.spCreditsCalculator.cpuLimit=this.session.cpuLimit;this.$.spCreditsCalculator.addEventListener("coreschanged",e.bind(this));this.$.creditsEstimatorContainer.appendChild(this.$.spCreditsCalculator);w=this.tools[0].getActivityConfig();if(w){this.$.spCreditsCalculator.options=w}}}};p=function(){b.call(this)};s=function(){p.call(this)};r=function(w){w.stopPropagation();w.cancelBubble=true;this.numCores=w.detail.cores;this.perfIndex=w.detail.perfIndex;this.licenseType=w.detail.licenseType;this.licenseEstimateOptions=w.detail.licenseEstimateOptions;if(this.session&&this.tools&&(this.tools.length>0)&&this.session.onCloud&&this.tools[0].isOnCloud()){c.call(this)}};q=function(w){w.preventDefault();w.stopPropagation();w.cancelBubble=true;this.operatingSystem=this.$.operatingSystem.getSelection()[0].value;c.call(this);this.$.spCreditsCalculator.operatingSystem=this.operatingSystem;this.$.spCreditsCalculator.estimate(this.operatingSystem);if(this.tools&&(this.tools.length>0)){if(this.tools[0].toolType===i.SMAProcADUI.ADToolManager.TOOLTYPES.osCommandSimToSO){if(this.operatingSystem===t.linux){this.tools[0].configuration.setSimToSOExecutable(false)}else{if(this.tools[0].configuration.resultFormatSupportsSimToSo()&&this.tools[0].configuration.getSimToSOExecutable()){this.tools[0].configuration.setSimToSOExecutable(true)}else{if(!this.tools[0].configuration.resultFormatSupportsSimToSo()&&this.tools[0].configuration.getSimToSOExecutable()){this.tools[0].configuration.setSimToSOExecutable(false)}}}}}};j=function(x,y){var w=new window.DOMParser(),E,D=[],z,B;z=function(F,G){F.server=G[0].id};B=function(){this.fire(u.appMessage,{level:"error",category:"checkServerError",message:n,autoRemove:true})};try{E=w.parseFromString(y,"text/xml");E=y.indexOf("<?xml")>=0?E.childNodes[0]:E}catch(C){E=null}if(E){for(var A=0;A<E.documentElement.childNodes.length;A++){D.push(E.documentElement.childNodes[A].getAttribute("name"))}if(D.indexOf(g.cloud)!==-1){this.tools[0].server=x.id}else{this.$.stationManager.getServers({onComplete:z.bind(this,this.tools[0]),onFailure:B.bind(this),refresh:false})}}};m=function(){this.fire(u.appMessage,{level:"error",category:"checkServerError",message:f,autoRemove:true})};c=function(){var w;if(this.operatingSystem===t.linux){this.$.operatingSystem.select(t.linux)}else{if(this.operatingSystem===t.windows){this.$.operatingSystem.select(t.windows)}}if(this.tools){this.tools[0].setCloudExecutionConfig(this.operatingSystem,this.numCores);w=this.$.stationManager.getDefaultServer();if(w){this.session.checkForCloudDrm(w,j.bind(this),m.bind(this))}if(this.licenseEstimateOptions){this.tools[0].setActivityConfig(this.licenseEstimateOptions)}}if(this.tools[0].workDir!==null){this.tools[0].workDir=null}if(this.tools[0].isOnCloud()){o.call(this,this.licenseType,this._tenantID,this.numCores,this.perfIndex,this._licenseURL)}};o=function(){if(this.tools&&this.tools[0].toolType!==i.SMAProcADUI.ADToolManager.TOOLTYPES.simToSO){this.tools[0].setEnvSettingsProperty(this.licenseType,this._tenantID,this.numCores,this.perfIndex,this._licenseURL)}};v=function(){o.call(this)};e=function(w){w.preventDefault();w.stopPropagation();w.cancelBubble=true;r.call(this,w)};a=function(){this.$.operatingSystem=new l({id:"operatingSystem",placeholder:false,options:[{value:"windows",label:"Windows",selected:true},{value:"linux",label:"Linux"}]});this.$.operatingSystem.inject(this.$.operatingSystemContainer);this.$.operatingSystem.addEvent("onChange",q,this)};d=function(){b.call(this)};k=function(){if(window.widget){this._tenantID=window.widget.getValue("tenantId");this._licenseURL=window.widget.getValue("licenseURL")}a.call(this)};window.DS.SMAProcADUI=window.DS.SMAProcADUI||{};window.DS.SMAProcADUI.ADToolConfigWhereCloud=h({is:"ad-tool-config-where-cloud",properties:{session:{value:null,},tools:{type:Array,value:function(){return[]},observer:"toolsChanged"},numCores:{type:Number,value:1},perfIndex:{type:Number,value:1},operatingSystem:{type:String,value:t.windows},licenseType:{type:String,value:""}},ready:function(){return k.apply(this,arguments)},onNumCoresChanged:function(){return e.apply(this,arguments)},toolsChanged:function(){s.call(this)},onOSChange:function(){return q.apply(this,arguments)},setCloudExecConfig:function(){return c.apply(this,arguments)},setEnvSettingsProperty:function(){return v.apply(this,arguments)},refresh:function(){return d.apply(this,arguments)},behaviors:[i.SMAProcSP.SPBase]})});