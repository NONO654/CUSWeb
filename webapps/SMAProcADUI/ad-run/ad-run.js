/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
window.require(["DS/SMAProcADUI/ad-station/ADStation"],function(j){var g=window.Polymer,i=window.DS;var m=null,h=null,c=null,q="A runtime error occurred. Check that your 3DSpace and COS servers are using compatible protocols (https and http).  Contact your Platform Manager for assistance.",d="Web service not found.",b="Check that you are using the same user for your local station.",e="The local station may not be running.",l="Please check the collaborative space selection in the preferences to verify that you have sufficient access to run a job.",a="adhoc",p="No create access to business object",f={jobNotStarted:1,execDirNotInitialized:2},r={appMessage:"appmessage"},n=null,o=null,k=null;m=function(w,u){var s=function(x){this.fire("success",{tool:u,execDir:x});w.accessDisabled=false}.bind(this),v=function(x){this.fire("error",{tool:u,execDir:w,error:f.execDirNotInitialized,message:x.message});w.accessDisabled=true}.bind(this),t={execDir:w,serverID:u.server,activityID:u.modelID,physicalID:w.mcsJobID,onComplete:s,onFailure:v};this.$.fileMonitor.initExecDir(t)};o=function(t,s){if(t){this.fire(r.appMessage,{level:"success",message:"Completed job for "+s})}};k=function(t,s){this.fire(r.appMessage,{level:"error",message:"Unable to check status of job for"+s})};h=function(t){var s;if(t.detail.result&&t.detail.result.context){s=t.detail.result.context;if(s.credentials){s.execDir.credentials={encryptedCredentials:s.credentials.encryptedCredentials,domainName:s.credentials.domainName,windowsUser:s.credentials.windowsUser,windowsPass:s.credentials.windowsPass,linuxUser:s.credentials.linuxUser,linuxPass:s.credentials.linuxPass,};s.tool.credentials={encryptedCredentials:s.credentials.encryptedCredentials,domainName:s.credentials.domainName,windowsUser:s.credentials.windowsUser,windowsPass:s.credentials.windowsPass,linuxUser:s.credentials.linuxUser,linuxPass:s.credentials.linuxPass,}}s.execDir.cosJobID=t.detail.result.EEDJobID;s.execDir.mcsJobID=t.detail.result.MCSJobID;if(s.getWorkingDirectory===true){m.call(this,s.execDir,s.tool)}else{s.execDir.accessDisabled=false;this.fire("success",{tool:s.tool,execDir:s.execDir});this.session.addMainJobTracker(s.execDir.mcsJobID,s.tool.name,o.bind(this),k.bind(this))}}t.stopPropagation();t.cancelBubble=true};c=function(u){var s;if(u.detail.result&&u.detail.result.context){s=u.detail.result.context;s.execDir.path=null;if(s.credentials){s.execDir.credentials={encryptedCredentials:s.credentials.encryptedCredentials,domainName:s.credentials.domainName,windowsUser:s.credentials.windowsUser,windowsPass:s.credentials.windowsPass,linuxUser:s.credentials.linuxUser,linuxPass:s.credentials.linuxPass,}}s.execDir.cosJobID=u.detail.result.EEDJobID;s.execDir.mcsJobID=u.detail.result.mcsJobID;s.execDir.accessDisabled=true;var t=q;if(u.detail.status===404){t=d}else{if(u.detail.status===i.SMAProcSP.SPRun.ERRORS.PRIVATE_STATION_USER_MISMATCH){t=b}else{if(u.detail.status===i.SMAProcSP.SPRun.ERRORS.PRIVATE_STATION_NO_STATION_FOUND){t=e}else{if(u.detail.status===500&&u.detail.response.indexOf(p)!==-1){t=l}}}}this.fire("error",{tool:s.tool,execDir:s.execDir,error:f.jobNotStarted,message:t})}u.stopPropagation();u.cancelBubble=true};n=function(t,s){var u={},v;if(typeof(t.model)!=="undefined"){v=t.model.id}else{v=t.modelID}u.that=this;u.tool=t;u.execDir=s;u.getWorkingDirectory=!s.path;if(j.ADStation.LOCALSTATIONNAME===t.station){u.station=j.ADStation.LOCALSTATIONNAME}u.credentials=null;if((typeof t.credentials!=="undefined")&&t.credentials&&t.credentials.enabled){u.credentials={encryptedCredentials:null,domainName:t.credentials.domainName,windowsUser:t.credentials.windowsUser,windowsPass:t.credentials.windowsPass,linuxUser:t.credentials.linuxUser,linuxPass:t.credentials.linuxPass,isightV5User:null,isightV5Password:null};this.$.runner.runSimulationAs(u,v,"",true,u.credentials,a,t.server)}else{this.$.runner.runSimulation(u,v,"",true,a,t.server)}};i.SMAProcADUI=i.SMAProcADUI||{};i.SMAProcADUI.ADRun=g({is:"ad-run",properties:{session:{value:null}},onRunSuccess:function(){return h.apply(this,arguments)},onRunError:function(){return c.apply(this,arguments)},runTool:function(){return n.apply(this,arguments)},behaviors:[i.SMAProcSP.SPBase],});i.SMAProcADUI.ADRun.ERRORS=i.SMAProcADUI.ADRun.ERRORS||f});