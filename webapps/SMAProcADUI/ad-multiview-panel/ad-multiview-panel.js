/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
(function(j){var g=j.Polymer,i=j.DS;var t=null,n=null,d=null,v=null,q=null,h=null,f=null,l=null,k=null,m=null,p={icon:"icon",list:"list"},u={select:"select",drilldown:"drilldown"},b={none:"none",up:"up",down:"down"},c=null,e=null,o=null,s=null,a=null,r=null;t=function(z){var y=-1,w,x;w=c.call(this);for(x=0;x<w.length;x++){if(w[x]===z){y=x;break}}return y};n=function(){var w,x;w=c.call(this);for(x=0;x<w.length;x++){w[x].selected=false}this.splice("selections",0)};d=function(x,y,w){if(w){v.call(this,x,y)}else{if(y){q.call(this,x,y)}else{n.call(this);x.selected=true;this.push("selections",x)}this.lastSelIndex=t.call(this,x)}};v=function(z,A){var w,x;var y=t.call(this,z);w=c.call(this);if(this.lastSelIndex<0){for(x=0;x<=y;x++){w[x].selected=true;this.push("selections",w[x])}}else{if(!A){n.call(this)}if(y<this.lastSelIndex){for(x=y;x<=this.lastSelIndex;x++){if(!w[x].selected){w[x].selected=true;this.splice("selections",x,0,w[x])}}}else{if(y>this.lastSelIndex){for(x=this.lastSelIndex;x<=y;x++){if(!w[x].selected){w[x].selected=true;this.splice("selections",x,0,w[x])}}}}}};q=function(y){var w,x;if(!y.selected){y.selected=true;this.push("selections",y)}else{for(x=0;x<this.selections.length;x++){w=this.selections[x];if(w===y){w.selected=false;this.splice("selections",x,1);break}}}};h=function(){var x=g.dom(this.$.flowView).childNodes,w,y;for(y=0;y<x.length;y++){w=x[y];if(this.selections.indexOf(w)>=0){w.selected=true}else{w.selected=false}}};f=function(){var w=g.dom(this.$.flowView).childNodes,x;for(x=0;x<w.length;x++){switch(this.viewMode){case p.icon:w[x].viewMode=p.icon;break;case p.list:w[x].viewMode=p.list;break}}};l=function(){this._eventBindings={};this.selections=[];this.sortFunction=null;this.shiftSelDirection=b.none;this.lastSelIndex=-1};k=function(w){if(w.detail.item){d.call(this,w.detail.item,w.detail.ctrlKey,w.detail.shiftKey);this.fire(u.select,{items:this.selections});w.stopPropagation();w.cancelBubble=true;return true}else{return false}};m=function(w){if(w.detail.item){n.call(this);d.call(this,w.detail.item,false,false);w.detail.item.selected=true;this.fire(u.drilldown,{item:w.detail.item});w.stopPropagation();w.cancelBubble=true;return true}else{return false}};c=function(){var w=g.dom(this.$.flowView).childNodes;return w};e=function(w){var x=this.$.itemFactory.getItem(w);if((typeof x.__panelID==="undefined")||!x.__panelID){x.__panelID=""+Date.now()+"-"+Math.random()}return x};o=function(C,A,w){var y=this.$.flowView.childNodes,x=[],z,B=null,D={};D[C.EVENTS.select]=k.bind(this);C.addEventListener(C.EVENTS.select,D[C.EVENTS.select]);D[C.EVENTS.drilldown]=m.bind(this);C.addEventListener(C.EVENTS.drilldown,D[C.EVENTS.drilldown]);C.viewMode=this.viewMode;this._eventBindings[C.__panelID]=D;if(A){A=false;this.DOM(g.dom(this.$.flowView).childNodes).forEach(function(E){if((E.model.name===C.model.name)&&!A){D=this._eventBindings[E.__panelID];if(D){E.removeEventListener(E.EVENTS.select,D[E.EVENTS.select]);E.removeEventListener(E.EVENTS.drilldown,D[E.EVENTS.drilldown]);delete this._eventBindings[E.__panelID]}C.model=E.model;this.$.flowView.replaceChild(C,E);A=true}}.bind(this))}if(!A){if(this.sortFunction){for(z=y.length-1;z>=0;z--){x.push(y[z])}x.push(C);x.sort(this.sortFunction);for(z=0;z<x.length;z++){if(x[z]===C){if(z<(x.length-1)){B=x[z+1]}}}}if(B){g.dom(this.$.flowView).insertBefore(C,B)}else{g.dom(this.$.flowView).appendChild(C)}}if(w){C.fire("click",{})}};s=function(z){var x=g.dom(this.$.flowView).childNodes,w,y,A;for(y=0;y<x.length;y++){w=x[y];if(w===z){A=this._eventBindings[w.__panelID];if(A){w.removeEventListener(w.EVENTS.select,A[w.EVENTS.select]);w.removeEventListener(w.EVENTS.drilldown,A[w.EVENTS.drilldown]);delete this._eventBindings[w.__panelID]}this.$.itemFactory.returnItem(w);break}}for(y=0;y<this.selections.length;y++){if(this.selections[y]===z){this.splice("selections",y,1);break}}};a=function(){var x=g.dom(this.$.flowView).childNodes,y,w,z;for(y=x.length-1;y>=0;y--){w=x[y];z=this._eventBindings[w.__panelID];if(z){w.removeEventListener(w.EVENTS.select,z[w.EVENTS.select]);w.removeEventListener(w.EVENTS.drilldown,z[w.EVENTS.drilldown]);delete this._eventBindings[w.__panelID]}this.$.itemFactory.returnItem(x[y])}n.call(this)};r=function(){if(this.sortFunction){var x=g.dom(this.$.flowView).childNodes,w=[],y;for(y=x.length-1;y>=0;y--){w.push(x[y]);g.dom(g.dom(x[y]).parentNode).removeChild(x[y])}w.sort(this.sortFunction);for(y=0;y<w.length;y++){this.DOM(this.$.flowView).append(w[y])}}};i.SMAProcADUI=i.SMAProcADUI||{};i.SMAProcADUI.ADMultiviewPanel=g({is:"ad-multiview-panel",properties:{selections:{type:Array,value:function(){return[]},observer:"selectionsChanged"},sortFunction:{value:null},viewMode:{value:function(){return p.icon},observer:"viewModeChanged"}},observers:["selectionsChanged(selections.splices)"],ready:function(){return l.apply(this,arguments)},onSelectItem:function(){return k.apply(this,arguments)},onDrilldownItem:function(){return m.apply(this,arguments)},_computeFlowViewClass:function(w){return"noselect flow-view flow-view-viewmode-"+w},getItems:function(){return c.apply(this,arguments)},createItem:function(){return e.apply(this,arguments)},addItem:function(){return o.apply(this,arguments)},removeItem:function(){return s.apply(this,arguments)},removeAllItems:function(){return a.apply(this,arguments)},sort:function(){return r.apply(this,arguments)},viewModeChanged:function(){f.call(this)},selectionsChanged:function(){h.call(this)},behaviors:[i.SMAProcSP.SPBase]});i.SMAProcADUI.ADMultiviewPanel.VIEWMODE=i.SMAProcADUI.ADMultiviewPanel.VIEWMODE||p;i.SMAProcADUI.ADMultiviewPanel.EVENTS=i.SMAProcADUI.ADMultiviewPanel.EVENTS||u}(this));