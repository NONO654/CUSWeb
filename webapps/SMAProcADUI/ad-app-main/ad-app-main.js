/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
(function(H){var L=H.Polymer,N=H.DS;var v=null,Q=null,n=null,e=null,J=null,F=null,f=null,A=null,k=null,d=null,h=null,K=null,p=null,t=null,G=null,y=null,s=null,P=null,O=null,o=null,b=null,u=null,i=null,l=null,S=null,w=null,r=null,B=null,M=null,g=null,D="/resources/slmservices",C="/simulationcentral/smaHomeUtil.jsp?objectAction=openInDiscover&objectId=",a="Simulation_Companion",I="Performance_Study",x="appDataFlush",j=500,E=null,c=30000,q={appMessage:"appmessage"},z={variable:"sp-variable"},R=null,m=null;v=function(){if(this._sessionLoaded){if(!this._toolkitViewLoaded&&typeof N.SMAProcADUI.ADToolkitView===typeof Function){n.call(this);this._toolkitViewLoaded=true}if(this._toolkitViewLoaded&&!this._toolkitViewSessionSet){this._toolkitView.session=this.$.session;this._toolkitViewSessionSet=true}if(!this._jobsViewLoaded&&typeof N.SMAProcADUI.ADJobsView===typeof Function){e.call(this);this._jobsViewLoaded=true}if(this._jobsViewLoaded&&!this._jobsViewSessionSet){this._jobsView.session=this.$.session;this._jobsViewSessionSet=true}if(!this._dataViewLoaded&&typeof N.SMAProcADUI.ADDataView===typeof Function){J.call(this);this._dataViewLoaded=true}if(this._dataViewLoaded&&!this._dataViewSessionSet){this._dataView.session=this.$.session;this._dataViewSessionSet=true}}if(!this._toolkitViewLoaded||!this._toolkitViewSessionSet||!this._jobsViewLoaded||!this._jobsViewSessionSet||!this._dataViewLoaded||!this._dataViewSessionSet||!this._sessionLoaded){this._loadingTimeout=H.setTimeout(v.bind(this),j)}};Q=function(){var Z=this.$.session.executionDirectories,W,V,Y,T=function(ab){var aa;for(aa=0;aa<this.$.session.tools.length;aa++){if(this.$.session.tools[aa].waitingForWorkDir&&(this.$.session.tools[aa].waitingForWorkDir.name===ab.name)){this.$.session.tools[aa].workDir=ab;this._toolkitView.refresh();break}}}.bind(this),X=function(){}.bind(this),U={physicalID:this.$.session.processID,onComplete:T,onFailure:X};if(Z){for(W=0;W<Z.length;W++){V=Z[W];if(V.station&&!V.path&&!V.creating){Y=this.$.session.findJob(V.mcsJobID);if(Y){if(Y.isStarted||Y.isFinished&&!V.didFinishedJobOrphanCheck){U.execDir=V;U.activityID="ANY";this.$.fileMonitor.initExecDir(U);if(Y.isFinished){V.didFinishedJobOrphanCheck=true}}}}}}E=H.setTimeout(Q.bind(this),c)};n=function(){this.DOM(this.$.toolkitProgressIndicator).addClass("hidden");if(this._toolkitSpinner){this._toolkitSpinner.destroy();this._toolkitSpinner=null}this._toolkitView=new N.SMAProcADUI.ADToolkitView();this._toolkitView.id="toolkitView";this._toolkitView.addEventListener("appmessage",P.bind(this));this._toolkitView.addEventListener("hidemessage",O.bind(this));this._toolkitView.addEventListener("jobstarting",o.bind(this));this._toolkitView.addEventListener("jobstarted",b.bind(this));this._toolkitView.addEventListener("sessiontimeout",M.bind(this));this._toolkitView.viewMode="icon";L.dom(this.$.toolkitViewContainer).appendChild(this._toolkitView)};e=function(){this.DOM(this.$.jobsProgressIndicator).addClass("hidden");if(this._jobsSpinner){this._jobsSpinner.destroy();this._jobsSpinner=null}this._jobsView=new N.SMAProcADUI.ADJobsView();this._jobsView.id="jobsView";L.dom(this.$.jobsViewContainer).appendChild(this._jobsView)};J=function(){this.DOM(this.$.dataProgressIndicator).addClass("hidden");if(this._dataSpinner){this._dataSpinner.destroy();this._dataSpinner=null}this._dataView=new N.SMAProcADUI.ADDataView();this._dataView.id="dataView";this._dataView.addEventListener("appmessage",P.bind(this));this._dataView.addEventListener("hidemessage",O.bind(this));L.dom(this.$.dataViewContainer).appendChild(this._dataView)};F=function(U){if(U.response){var T=U.response.url;if(T.lastIndexOf("/")===T.length-1){T=T.substr(0,T.length-1)}this.$.eedBaseURL.setValue(T)}};f=function(){require(["DS/UIKIT/Spinner"],function(T){this._toolkitSpinner=new T({renderTo:this.$.toolkitProgressIndicator,visible:true});this._jobsSpinner=new T({renderTo:this.$.jobsProgressIndicator,visible:true});this._dataSpinner=new T({renderTo:this.$.dataProgressIndicator,visible:true})}.bind(this));this.DOM(this.$.toolkitProgressIndicator).removeClass("hidden");this.DOM(this.$.dataProgressIndicator).removeClass("hidden");this.DOM(this.$.jobsProgressIndicator).removeClass("hidden")};A=function(){this.fire(q.appMessage,{level:"info",message:"Saving pending data changes...",category:x});var U=function(V,W){if(W){this.fire(q.appMessage,{level:"clear-status",message:""})}}.bind(this);var T=function(){this.fire(q.appMessage,{level:"error",message:"Couldn't save pending data changes",category:x})}.bind(this);this.$.session.flushPendingUpdates(U,T)};k=function(){this.DOM(this.$.licenseErrorMessage).addClass("hidden");this.DOM(this.$.mainUI).removeClass("hidden");if(this.$.isDash.isInDashboard()){this.DOM(this.$.openInPS).addClass("hidden")}d(function(){this.DOM(this).find(z.variable).forEach(function(ab){this.set("globals."+ab.name,ab.getValue())}.bind(this));var Y=H.location.pathname,V,T="",aa="",U="",W="";if(Y&&Y.length>0){if(Y[0]==="/"){Y=Y.substr(1)}V=Y.split("/");if(V.length>0){T=V[0]}}aa=T+D;if(this.$.isDash.isInDashboard()){this.$.inDash.setValue(true);var Z=this.$.isDash.getMcsURI();this.$.mcsBaseURL.setValue(Z);this.$.mcsWSBaseURL.setValue(Z+"/resources/slmservices");this.$.securityContext.setValue(this.securityContext);this.$.session.queryProcessID=this.procId}else{W=H.location.protocol+"//"+H.location.host+"/"+T;U=H.location.protocol+"//"+H.location.host+"/"+aa;this.$.mcsBaseURL.setValue(W);this.$.mcsWSBaseURL.setValue(U);this.$.securityContext.setValue("");if(!this.procId){this.procId=this.$.queryparams.get("objectId")}this.$.session.queryProcessID=this.procId}H.onbeforeunload=function(){this.stopFileMonitorJobs();if(this.$.session.hasPendingUpdates()){A.call(this);return"Your changes are still being saved(this should only take a moment longer).\n\nIf you leave now, your recent changes may be lost."}}.bind(this);f.call(this);if(!this.$.isDash.isInDashboard()){var X=true;if(typeof localStorage!=="undefined"){if(localStorage.getItem("adhoc-coachmark")==="N"){X=false}}this.$.coachMark.onClose=function(ab){if(ab===true){localStorage.setItem("adhoc-coachmark","N")}else{localStorage.setItem("adhoc-coachmark","Y")}};if(X){this.$.coachMark.open(true)}}this._loadingTimeout=H.setTimeout(v.bind(this),1)}.bind(this))};d=function(U){var T=["DS.SMAProcADUI.ADMDataRemoveDialog","DS.SMAProcADUI.ADMDataView","DS.SMAProcADUI.ADMultiviewExecdir","DS.SMAProcADUI.ADMultiviewFile","DS.SMAProcADUI.ADMultiviewFolder","DS.SMAProcADUI.ADMultiviewPart","DS.SMAProcADUI.ADPropertiesExecdir","DS.SMAProcADUI.ADRun","DS.SMAProcADUI.ADSession","DS.SMAProcADUI.ADStationCredentials","DS.SMAProcADUI.ADStationManager","DS.SMAProcADUI.ADToolConfigOutputFiles","DS.SMAProcADUI.ADToolConfigWhere","DS.SMAProcADUI.ADToolManager","DS.SMAProcADUI.ADToolManagerSimToSOStrategy","DS.SMAProcADUI.ADToolRunDialog","DS.SMAProcADUI.ADToolkitView","DS.SMAProcSP.SPCOSFileMonitor"];H.require(["DS/SMAProcADUI/ad-util/ADAMDUtil"],function(V){V.waitForWebComponents(T,U)})};h=function(){this.DOM(this.$.mainUI).addClass("hidden");this.DOM(this.$.licenseErrorMessage).removeClass("hidden")};K=function(){this._toolkitViewLoaded=false;this._toolkitViewSessionSet=false;this._jobsViewLoaded=false;this._jobsViewSessionSet=false;this._dataViewLoaded=false;this._dataViewSessionSet=false;this._sessionLoaded=false;this._orphanedExecDirs=[];this._toolkitView=null;this._jobsView=null;this._dataView=null;this._categoryMessages={};this.licenseRetries=5};p=function(T){this.set("globals."+T.detail.name,T.detail.value);if(!this.jspLaunch&&(this.globals.mcsWSBaseURL&&this.globals.mcsWSBaseURL.length>0)&&(!this.globals.eedBaseURL||this.globals.eedBaseURL.length===0)){this.$.eedurlWS.getData(F.bind(this))}};t=function(T){this.scl=T.detail.response[a]==="true";this.psl=T.detail.response[I]==="true"};G=function(){this.licenseRetries--;if(this.licenseRetries>0){document.getElementById("licenseWS").getData()}else{var T={type:"error",text:"Unable to get license information for Simulation Companion. Please try refreshing or dropping the process again"};this.$.notificationMessages.logMessage(T)}};y=function(){this._sessionLoaded=true;L.dom(this.$.sessionName).textContent=this.$.session.name;this.$.simDashTitle.style.display="none";if(E===null){E=H.setTimeout(Q.bind(this),1)}if(this.$.isDash.isInDashboard()){this.$.enoviaTitle.style.display="none";this.$.simDashTitle.style.display="block";if(H.widget){H.widget.setTitle(this.$.session.name+" - Owner: "+this.$.session.process.basics.owner)}this.DOM(this.$.mainUI).addClass("onDashboard")}};s=function(U){var T={};T.type="error";T.text=null;if(N.SMAProcADUI.ADSession.ERRORS.sessionWSError===U.detail.error){T.text="Process Web service error"}else{if(N.SMAProcADUI.ADSession.ERRORS.sessionDataError===U.detail.error){T.text="Process data error"}else{if(N.SMAProcADUI.ADSession.ERRORS.toolWSError===U.detail.error){T.text="Tool Web service error"}else{if(N.SMAProcADUI.ADSession.ERRORS.toolDataError===U.detail.error){T.text="Tool data error"}else{if(N.SMAProcADUI.ADSession.ERRORS.jobWSError===U.detail.error){T.text="Job Web service error"}else{if(N.SMAProcADUI.ADSession.ERRORS.jobDeleteWSError===U.detail.error){T.text="Job Delete Web service error"}else{if(N.SMAProcADUI.ADSession.ERRORS.jobDataError===U.detail.error){T.text="Job data error"}}}}}}}if(T.text){if(typeof U.detail.message!=="undefined"&&U.detail.message&&U.detail.message.length>0){T.text+=": "+U.detail.message}this.$.notificationMessages.logMessage(T)}};o=function(){this._dataView.refresh(false,true)};b=function(){this._dataView.refresh(false,true);this._jobsView.onRefreshJobsMenuButton()};u=function(){this._toolkitView.refresh()};i=function(){this._dataView.refresh(false,true);this._toolkitView.refresh()};P=function(V){var U={},W,T;if(V.detail.level!=="clear-urgent"&&V.detail.level!=="clear-status"){U.type=V.detail.level;U.text=V.detail.message;if(V.detail.level==="success"||V.detail.level==="info"||V.detail.autoRemove){U.autoRemove=true}else{if(V.detail.level==="error"){U.autoRemove=false}}W=V.detail.category;if(typeof W!=="undefined"&&W&&W.length>0){T=this._categoryMessages[W];T=this.$.notificationMessages.logMessage(U,T);this._categoryMessages[W]=T}else{this.$.notificationMessages.logMessage(U)}}return};O=function(W){var X=W.detail.category;var T=this._categoryMessages[X];var U=this.$.notificationMessages.$.notificationcomponent.children;for(var V=0;V<U.length;V++){if(U[V]["sp_notificatio_id"]===T){L.dom(U[V]).classList.remove("in")}}};l=function(){this.DOM(this.$.collapseTools).toggleClass("in");this.DOM(this.$.toolsArrow).toggleClass("fonticon-right-dir")};S=function(){this.DOM(this.$.collapseJobs).toggleClass("in");this.DOM(this.$.jobsArrow).toggleClass("fonticon-right-dir")};w=function(){this.DOM(this.$.collapseData).toggleClass("in");this.DOM(this.$.dataArrow).toggleClass("fonticon-right-dir")};r=function(){var T=null;T=this.globals.mcsBaseURL+C+this.$.session.processID;H.open(T,"_self")};B=function(){var T=true;if(typeof localStorage!=="undefined"){if(localStorage.getItem("adhoc-coachmark")==="N"){T=false}}this.$.coachMark.onClose=function(U){if(U===true){localStorage.setItem("adhoc-coachmark","N")}else{localStorage.setItem("adhoc-coachmark","Y")}};this.$.coachMark.open(T)};M=function(){var T=this.globals.mcsBaseURL+C+this.$.session.processID;H.open(T,"_self")};R=function(){if(this.scl){k.call(this)}};m=function(){var U,T={physicalID:this.$.session.processID,onComplete:null,onFailure:null};if(this.$.session&&this.$.session.executionDirectories){for(U=0;U<this.$.session.executionDirectories.length;U++){T.execDir=this.$.session.executionDirectories[U];this.$.fileMonitor.stopFileMonitor(T)}}};g=function(){this._toolkitView.blockToolConfig()};N.SMAProcADUI=N.SMAProcADUI||{};N.SMAProcADUI.ADAppMain=L({is:"ad-app-main",properties:{access:{type:String,value:"",reflectToAttribute:true},globals:{value:function(){return{}}},jspLaunch:{type:Boolean,value:false},procId:{type:String,value:null,observer:"procIdChanged"},psl:{type:Boolean,value:false},scl:{type:Boolean,value:false,observer:"sclChanged"},securityContext:{type:String,value:null,observer:"securityContextChanged"}},created:function(){return K.apply(this,arguments)},onVariableValueChange:function(){return p.apply(this,arguments)},onLicenseReady:function(){return t.apply(this,arguments)},onLicenseError:function(){return G.apply(this,arguments)},onSessionLoaded:function(){return y.apply(this,arguments)},onSessionError:function(){return s.apply(this,arguments)},onAppMessage:function(){return P.apply(this,arguments)},onHideMessage:function(){return O.apply(this,arguments)},onJobStarting:function(){return o.apply(this,arguments)},onJobStarted:function(){return b.apply(this,arguments)},onManagedDataRemoved:function(){return u.apply(this,arguments)},onExecDirRemoved:function(){return i.apply(this,arguments)},onCollapseTools:function(){return l.apply(this,arguments)},onCollapseJobs:function(){return S.apply(this,arguments)},onCollapseData:function(){return w.apply(this,arguments)},onOpeninPerfStudy:function(){return r.apply(this,arguments)},onHelp:function(){return B.apply(this,arguments)},onSessionTimeout:function(){return M.apply(this,arguments)},onBlockToolConfig:function(){return g.apply(this,arguments)},refresh:function(){return R.apply(this,arguments)},stopFileMonitorJobs:function(){return m.apply(this,arguments)},sclChanged:function(T){if(T===true||(T.toLowerCase&&(T.toLowerCase()==="true"))){k.call(this)}else{if(T===false||(T.toLowerCase&&(T.toLowerCase()==="false"))){h.call(this)}}},procIdChanged:function(){},securityContextChanged:function(){},behaviors:[N.SMAProcSP.SPBase],_computeWSInclude:function(T){return T===false},_computeEedUrlUri:function(T){var U="";if(typeof T!=="undefined"){U=T+"/cos/url"}return U},_computeLicenseUri:function(T){var U="";if(typeof T!=="undefined"){U=T+"/license?appNames=Performance_Study,Simulation_Companion"}return U},_computeCosTicketUrl:function(T){var U="";if(typeof T!=="undefined"){U=T+"/cos/ticket"}return U},_computePerfStudyButton:function(T){return T===true}})}(this));