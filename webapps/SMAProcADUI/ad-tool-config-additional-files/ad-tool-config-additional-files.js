/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
(function(i){var d=i.Polymer,h=i.DS;var t=null,q=null,j=null,r=null,n=null,e=null,s=null,c=null,m=null,l=null,b=null,g=null,p=null,o=null,k="InputFiles",f={disabled:"disabled"},a=null;t=function(){this.$.filesPanel.removeAllItems();this.loading=true;if(this.tools&&this.tools.length>0){var u=this.tools[0].inputObjects,x,w,y,v;if(u){for(x=0;x<u.length;x++){y=u[x];v=this.$.filesPanel.createItem("ad-additional-file-view");v.model=y;v.modelSource=k;if(y.isActivityContent){v.viewState=v.VIEWSTATE.accessDisabled}else{v.viewState=v.VIEWSTATE.ready}if(this.mainInputFiles.length>0){for(w=0;w<this.mainInputFiles.length;w++){if(this.mainInputFiles[w].name!==y.name){this.$.filesPanel.addItem(v)}}}else{this.$.filesPanel.addItem(v)}}}j.call(this)}this.loading=false};q=function(){var u=this.$.filesPanel.selections.length,w=u>0,v;for(v=0;v<u;v++){if(this.$.filesPanel.selections[v].viewState===this.$.filesPanel.selections[v].VIEWSTATE.accessDisabled){w=false;break}}if(w){this.DOM(this.$.removeInputs).removeClass(f.disabled)}else{this.DOM(this.$.removeInputs).addClass(f.disabled)}if(u>0){this.DOM(this.$.removeInputs).removeClass("hidden")}else{this.DOM(this.$.removeInputs).addClass("hidden")}};j=function(){var u=this.$.filesPanel.getItems();if(!u||u.length===0){this.DOM(this.$.contentRow).addClass("hidden");this.DOM(this.$.placeholderRow).removeClass("hidden")}else{this.DOM(this.$.contentRow).removeClass("hidden");this.DOM(this.$.placeholderRow).addClass("hidden")}};r=function(){if(this.tools&&this.tools.length===0){this.DOM(this.$.mainContentSection).removeClass("hidden");this.DOM(this.$.configurationSection).addClass("hidden");this.DOM(this.$.configurationErrorNone).removeClass("hidden");this.DOM(this.$.configurationErrorMultiple).addClass("hidden");this.DOM(this.$.noDownloadSupportNote).addClass("hidden")}else{if(this.tools&&this.tools.length>1){this.DOM(this.$.mainContentSection).removeClass("hidden");this.DOM(this.$.configurationSection).addClass("hidden");this.DOM(this.$.configurationErrorNone).addClass("hidden");this.DOM(this.$.configurationErrorMultiple).removeClass("hidden");this.DOM(this.$.noDownloadSupportNote).addClass("hidden")}else{if(this.tools&&this.tools[0].supportsDownload){this.DOM(this.$.mainContentSection).removeClass("hidden");this.DOM(this.$.configurationSection).removeClass("hidden");this.DOM(this.$.configurationErrorNone).addClass("hidden");this.DOM(this.$.configurationErrorMultiple).addClass("hidden");this.DOM(this.$.noDownloadSupportNote).addClass("hidden");t.call(this)}else{this.DOM(this.$.mainContentSection).addClass("hidden");this.DOM(this.$.noDownloadSupportNote).removeClass("hidden")}}}};n=function(w){var v=this.$.filesPanel.getItems(),x,u,y=false;if(w){for(x=0;x<v.length;x++){if(v[x]&&v[x].model){u=v[x].model;if(u.name&&w.name&&u.name===w.name&&(u.type===w.type||w.type==="file"&&u.type==="fileversion"||w.type==="fileversion"&&u.type==="file")){y=true;break}}}}return y};e=function(v){var u;if(v){while(v.length>0){u=v[0];if(typeof u.model!=="undefined"&&u.model){this.tools[0].removeInputObject(u.model);this.$.filesPanel.removeItem(u)}}}q.call(this);j.call(this)};s=function(w,y,v){var u=this.tools[0].inputObjects;for(var x=0;x<u.length;x++){if(w===u[x].name&&y===u[x].type){if(v!==null&&v===u[x].sourceFileVersion){return u[x]}else{return u[x]}}}};p=function(A,x){var B;for(var z=0;z<A.length;z++){var v=A[z];if(v){if(!n.call(this,v)){B=this.$.filesPanel.createItem("ad-additional-file-view");B.model=v;B.modelSource=k;if(v.isActivityContent){B.viewState=B.VIEWSTATE.accessDisabled}else{B.viewState=B.VIEWSTATE.ready}if(x){var u;var C=this.mainInputFiles;for(var y=0;y<C.length;y++){if(C[y].name!==v.name){u=s.call(this,C[y].name,C[y].type,null);this.mainInputFiles.splice(y,1);this.tools[0].removeInputObject(u)}else{if(C[y].type!==v.type){u=s.call(this,C[y].name,C[y].type,null);this.mainInputFiles.splice(y,1);this.tools[0].removeInputObject(u)}else{if(v.details&&v.details.version!==null){u=s.call(this,C[y].name,C[y].type,C[y].details.version);this.tools[0].removeInputObject(u)}}}}}if(this.tools[0]){this.tools[0].addInputObject(v)}if(this.mainInputFiles.length>0){for(var w=0;w<this.mainInputFiles.length;w++){if(this.mainInputFiles[w].name!==v.name){this.$.filesPanel.addItem(B)}}}else{this.$.filesPanel.addItem(B)}}else{this.fire("inputexists",{})}}}j.call(this)};c=function(){this.loading=false};m=function(){var u=localStorage["SMAProcAdhoc.preferences.inputFilesViewMode"];if(u&&u.length>0){this.viewMode="list"}q.call(this)};l=function(u){this.$.filesPanel.selections=[];q.call(this);u.stopPropagation();u.cancelBubble=true;u.preventDefault()};b=function(u){u.stopPropagation();u.cancelBubble=true;u.preventDefault();q.call(this)};g=function(){e.call(this,this.$.filesPanel.selections)};a=function(){t.call(this)};h.SMAProcADUI=h.SMAProcADUI||{};h.SMAProcADUI.ADToolConfigAdditionalFiles=d({is:"ad-tool-config-additional-files",properties:{access:{type:String,value:"",notify:true,reflectToAttribute:true},tools:{value:function(){return[]},observer:"toolsChanged"},viewMode:{type:String,value:"list"},mainInputFiles:{type:Object,value:[]}},attached:function(){return m.apply(this,arguments)},created:function(){return c.apply(this,arguments)},onContentAreaClick:function(){return l.apply(this,arguments)},onInputSelect:function(){return b.apply(this,arguments)},onRemoveInputs:function(){return g.apply(this,arguments)},addInputs:function(){return p.apply(this,arguments)},addItem:function(){return o.apply(this.arguments)},refresh:function(){return a.apply(this,arguments)},toolsChanged:function(){r.call(this)},behaviors:[h.SMAProcSP.SPBase],_computeClass:function(u){return this.tokenList({hidden:u==="icon"})+"btn btn-xs btn-default "+this.tokenList({hidden:u==="icon"})},_computeClass2:function(u){return this.tokenList({hidden:u==="list"})+"btn btn-xs btn-default "+this.tokenList({hidden:u==="list"})},tokenList:function(w){var u,v=[];for(var u in w){if(w[u]){v.push(u)}}return v.join(" ")}})}(this));