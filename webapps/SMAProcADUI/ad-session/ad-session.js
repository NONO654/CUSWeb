/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
window.require(["DS/SMAProcADUI/ad-execdir/ADExecDir","DS/SMAProcADUI/ad-job-instance/ADJobInstance","DS/SMAProcADUI/ad-mdata-instance/ADMDataInstance","DS/SMAProcADUI/ad-station/ADStation"],function(j,aD,s,m){var au=window.Polymer,W=window.DS;var y=null,f=null,U=null,ad=null,aC=null,D=null,aM=null,G=null,ac=null,a=null,O=null,X=null,ae=null,aJ=null,aA=null,h=null,aO=null,d=null,w=null,ay=null,am=null,az=null,t=null,A=null,ap=null,ax=null,aj=null,aa=null,aw=null,o=null,q=null,ao=null,aP=null,aG=null,aq=null,Q=null,aL=null,K="Internal Data",at="csrfTokenName",M="noOfFiles",aH="__fcs__jobTicket",e="bfile0",H="fileName0",al="format0",C="jobComplete",F="mainJobComplete",Y=5,T=0,v="adhoc",ar="Download failed:  Failed to get file URL. Please try again or contact your administrator",aN="Hidden_",an={variable:"sp-variable"},aE={sessionLoaded:"sessionloaded",toolsLoaded:"toolsloaded",jobsLoaded:"jobsloaded",jobsCompleted:"jobsCompleted",mdataRemoved:"mdataremoved",execDirRemoved:"execdirremoved",error:"error",appMessage:"appmessage",blockToolConfig:"blocktoolconfig"},z={sessionWSError:"sessionWSError",sessionDataError:"sessionDataError",toolWSError:"toolWSError",toolDataError:"toolDataError",toolDeleteError:"toolDeleteError",mdataLoadError:"mdataLoadError",mdataRemoveError:"mdataRemoveError",mdataAddReferenceError:"mdataAddReferenceError",mdataAddLocalFilesError:"mdataAddLocalFilesError",mdataDownloadError:"mdataDownloadError",mdataUploadError:"mdataUploadError",jobWSError:"jobWSError",jobDataError:"jobDataError",jobDeleteWSError:"jobDeleteWSError"},S={csrfTokenName:"ENO_CSRF_TOKEN",number:"1",format:"generic"},k={SIMDOC_V:"Simulation Document - Versioned",SIM_FOLDER:"Simulation Folder",FILE:"file",GENERIC_DOC:"document",GENERIC_FOLDER:"folder"},aI={version:"6.417.0",name:"ACT#",id:"FunctionStep8b6066d6-ea38-4dbe-89ab-dce498b0f63d",lastId:"1",category:"Product"},g={version:"6.417.0",name:"ACT#",id:"FunctionStep8b6066d6-ea38-4dbe-89ab-dce498b0f63d",lastId:"1",key:"DownloadModel"},l=null,L=null,R=null,V=null,B=null,I=null,b=null,N=null,p=null,n=null,r=null,ab=null,E=null,af=null,ag=null,aB=null,u=null,aQ=null,ai=null,ak=null,ah=null,x=null,aF=null,av=null,J=null,i=null,Z=null,c=null,aK=null,P=null;aO=function(aU){if(this.onCloud){var aT=function(aV){this.cpuLimit=aV.response};var aR=function(){this.cpuLimit=16;console.warn("Setting cpu limit to 16 which is the default")};var aS={verb:"GET",uri:aU+"/admin/drm/Cloud/cpu",onComplete:aT.bind(this),headers:{Accept:"*/*"},onError:aR.bind(this)};this.$.checkCPULimitWS.sendRequest(aS)}};y=function(aS){if(aS.response){var aR=aS.response.url;if(aR.lastIndexOf("/")===aR.length-1){aR=aR.substr(0,aR.length-1)}this.$.eedBaseURL.setValue(aR);aO.call(this,aR)}};f=function(){var aR=null,aT,aS;this._initializing=true;this.processID="";this.name="";this.description="";this.splice("executionDirectories",0);this.splice("hiddenExecutionDirectories",0);if(this.process&&(typeof this.process.attributes!=="undefined"&&this.process.attributes)){this.processID=this.process.id;this.name=this.process.attributes.title;this.description=this.process.attributes.description?this.process.attributes.description:"";if((typeof this.process.attributes.definition!=="undefined")&&this.process.attributes.definition&&(typeof this.process.attributes.definition.process!=="undefined"&&this.process.attributes.definition.process)&&(typeof this.process.attributes.definition.process.ExecutionConfig!=="undefined"&&this.process.attributes.definition.process.ExecutionConfig)&&(typeof this.process.attributes.definition.process.ExecutionConfig.properties!=="undefined"&&this.process.attributes.definition.process.ExecutionConfig.properties)&&(typeof this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories!=="undefined"&&this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories&&Array.isArray(this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories))){aR=this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories}if(aR){for(aS=0;aS<aR.length;aS++){aT=new j.ADExecDir();aT.load(aR[aS],this.process);if(aT.name.substr(0,7)!==aN){this.executionDirectories.push(aT)}else{this.hiddenExecutionDirectories.push(aT)}}}}this.managedData=new s.ADMDataInstance();this.managedData.type=s.ADMDataInstance.TYPES.category;this.managedData.modelID=this.getCategoryID(K);this.$.eedurlWS.getData(y.bind(this));this._initializing=false};U=function(){if(typeof this.process.attributes.definition==="undefined"||!this.process.attributes.definition){this.process.attributes.definition={process:{ExecutionConfig:{properties:{SCExecutionDirectories:[]}}}}}else{if(typeof this.process.attributes.definition.process==="undefined"||!this.process.attributes.definition.process){this.process.attributes.definition.process={ExecutionConfig:{properties:{SCExecutionDirectories:[]}}}}else{if(typeof this.process.attributes.definition.process.ExecutionConfig==="undefined"||!this.process.attributes.definition.process.ExecutionConfig){this.process.attributes.definition.process.ExecutionConfig={properties:{SCExecutionDirectories:[]}}}else{if(typeof this.process.attributes.definition.process.ExecutionConfig.properties==="undefined"||!this.process.attributes.definition.process.ExecutionConfig.properties){this.process.attributes.definition.process.ExecutionConfig.properties={SCExecutionDirectories:[]}}else{if(typeof this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories==="undefined"||!this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories||!Array.isArray(this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories)){this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories=[]}}}}}};ad=function(){if(this.queryProcessID&&this.queryProcessID.length>0){this.$.processWS.getData()}};aC=function(aT,aY,aV,aS,aU){var aX,aR,aW;aX=function(a0){var aZ=JSON.parse(a0.response).folderId;aM.call(this,aT,aY,aZ,aS,aU)}.bind(this);aR=function(){}.bind(this);aW={verb:"POST",uri:this.$.contentFolderCreateWS.uri+"/"+aV.modelID+"?folderTitle="+aT.name,onComplete:aX,onError:aR};this.$.contentFolderCreateWS.sendRequest(aW)};D=function(aS,aV,aU,aR,aT){aM.call(this,aS,aV,aU.modelID,aR,aT)};aM=function(a3,aV,aY,aR,aX){var aT=a3.type===k.GENERIC_FOLDER?k.SIM_FOLDER:k.SIMDOC_V,a4=aV[0],a5=a4.path,a8=null,a6=null,a9=null,aZ=null,ba=null,aW=new W.SMAProcADUI.ADStationManager(),aU=aW.getServerForStation(a4.station),a0=aW.getStation(a4.station);if(a4.relativePath&&""!==a4.relativePath&&" "!==a4.relativePath){var bc=a4.relativePath;var aS="\\";if(a0.os===m.ADStation.OSTYPES.linux){aS="/";bc=aS+bc}else{bc=aS+bc.replace(/(\/)/gm,aS)}var bb=aS+a3.name;bc=bc.replace(bb,"");a5=a5+bc}a5=a5.replace(/(\\)/gm,"\\\\\\\\");var a1=[];for(var a7=0;a7<aV.length;a7++){var a2;if(aV[a7].type==="folder"){a2=aV[a7].name+"/*";a1.push(a2)}else{a1.push(aV[a7].name)}}this.$.uploadRunner.jobData=JSON.stringify({REPLACE_VERSION:aI.version,REPLACE_PROCESS_ID:this.processID,REPLACE_DYNAMIC_ACTIVITY:aI.name,KEEP_DIR:"1",REPLACE_STEP_ID:aI.id,REF_ID:aY,REPLACE_WORKING_DIR:a5,REPLACE_LAST_ID:"1",REPLACE_HOST:a4.station,ADD_RULE_TYPE:aT,ADD_RULE_TITLE:a1.join(),ADD_RULE_CATEGORY:this.getCategoryID(K)});a8=function(be,bd){this.$.eventChecker.startListening(C,this,bd,true,Y,T,a9,aZ)}.bind(this);a6=function(be,bd){aX(be,bd)}.bind(this);a9=function(){aR()}.bind(this);aZ=function(bd){aX(-1,bd)}.bind(this);ba={successCallback:a8,errorCallback:a6};if((m.ADStation.LOCALSTATIONNAME===a0.name)||(m.ADStation.LOCALSTATIONNAME===a0.queryName)){ba.forceHasLocalHost=true}if(typeof a4.credentials!=="undefined"&&a4.credentials){ba.credentials=JSON.parse(JSON.stringify(a4.credentials));ba.credentials.encryptedCredentials=null;this.$.uploadRunner.runSimulationAs(ba,this.processID,"",true,ba.credentials,v,aU.id)}else{this.$.uploadRunner.runSimulation(ba,this.processID,"",true,v,aU.id)}};G=function(aX,aS,aR,aW){var aT,aY,a1,aV,aZ,a0,aU=new FileReader();aT=function(a2){delete this._uploadingItems[a2.id];if(aR){aR(a2)}}.bind(this);aY=function(a4,a3,a2){delete this._uploadingItems[a4.id];if(aW){aW(a3,a2)}}.bind(this);a1=function(a4){var a5=JSON.parse(a4.response),a6,a2,a3;a6=new DOMParser().parseFromString(a5.fcsTicket,"text/xml");a2=au.dom(a6.getElementsByTagName("Ticket")[0]).textContent;a3=au.dom(a6.getElementsByTagName("FcsUrl")[0]).textContent;delete a5.fcsTicket;this._uploadingItems[a5.id]=true;O.call(this,aS,a5,a2,a3,aT,aY)}.bind(this);aV=function(){if(aW){aW(z.mdataAddLocalFilesError,"Error creating content")}}.bind(this);aZ=function(a2){this.fire("sessiontimeout",a2)}.bind(this);a0={verb:"POST",uri:this.$.contentWS.uri+"?pid="+aX.modelID+"&name="+aS.name,data:aU.result,onComplete:a1,onError:aV,onSessionTimeout:aZ};this.$.contentWS.sendRequest(a0)};ac=function(aX,aS,aR,aW){var aT,aY,a1,aV,aZ,a0,aU=new FileReader();aT=function(a2){delete this._uploadingItems[a2.id];if(aR){aR(a2)}}.bind(this);aY=function(a4,a3,a2){delete this._uploadingItems[a4.id];if(aW){aW(a3,a2)}}.bind(this);a1=function(a4){var a5=JSON.parse(a4.response),a6,a2,a3;a6=new DOMParser().parseFromString(a5.fcsTicket,"text/xml");a2=au.dom(a6.getElementsByTagName("Ticket")[0]).textContent;a3=au.dom(a6.getElementsByTagName("FcsUrl")[0]).textContent;delete a5.fcsTicket;this._uploadingItems[a5.id]=true;O.call(this,aS,a5,a2,a3,aT,aY)}.bind(this);aV=function(){if(aW){aW(z.mdataAddLocalFilesError,"Error creating content")}}.bind(this);aZ=function(a2){this.fire("sessiontimeout",a2)}.bind(this);a0={verb:"PUT",uri:this.$.contentCreateFileWS.uri+"?oid="+aX.modelID+"&dname="+aS.name+"&SecurityContext="+this.globals.securityContext,data:aU.result,onComplete:a1,onError:aV,onSessionTimeout:aZ};this.$.contentCreateFileWS.sendRequest(a0)};a=function(aS,aU,aR,aT){ac.call(this,aS.parentInstance,aU,aR,aT)};O=function(aU,aT,aV,aW,aR,aS){var aX=new FormData(),aY=new XMLHttpRequest();aX.append(at,S.csrfTokenName);aX.append(M,S.number);aX.append(aH,aV);aX.append(e,aU);aX.append(H,aU.name);aX.append(al,S.format);aY.onreadystatechange=function(){if(aY.readyState!==4){return}if(aY.status===200){X.call(this,aT,aY.responseText,aR,aS)}else{if(aS){aS(aT,z.mdataAddLocalFilesError,aY.responseText)}}}.bind(this);aY.open("POST",aW,true);aY.send(aX)};X=function(aW,aX,aS,aT){var aV,aR,aU;aV=function(){if(aS){aS(aW)}}.bind(this);aR=function(aY){if(aT){aT(aW,z.mdataAddLocalFilesError,aY.response)}}.bind(this);aU={verb:"PUT",headers:{Accept:"text/plain"},data:(typeof aX==="object")?JSON.stringify(aX):aX,onComplete:aV,onError:aR};this.$.contentCommitCreateWS.sendRequest(aU)};ae=function(aT,aX,aS,aU){var aW,aR,aV;aW=function(a0){var aZ=JSON.parse(a0.response).folderId;if(aS){aS(aZ)}}.bind(this);aR=function(aZ){if(aU){if(aZ.response){aU(z.mdataAddLocalFilesError,aZ.response)}else{aU(z.mdataAddLocalFilesError,"")}}}.bind(this);var aY=function(aZ){this.fire("sessiontimeout",aZ)}.bind(this);aV={verb:"POST",uri:this.$.contentFolderCreateWS.uri+"/"+aT.modelID+"?folderTitle="+aX,onComplete:aW,onError:aR,onSessionTimeout:aY};this.$.contentFolderCreateWS.sendRequest(aV)};aJ=function(aX,aW,aS,aT){var aV,aR,aU;aV=function(aZ){var a0=false,a1;if(aZ.response){a1=JSON.parse(aZ.response);if(typeof a1.Job_Status!=="undefined"&&a1.Job_Status&&a1.Job_Status==="Completed"){a0=true}}if(aS){aS(a0)}}.bind(this);aR=function(a0){var aZ="Job Web service error";if(a0.response){aZ=a0.response}if(aT){aT(aZ)}}.bind(this);var aY=function(aZ){this.fire("sessiontimeout",aZ)}.bind(this);aU={verb:"GET",uri:this.$.jobStatusWS.uri+"/"+aW,onComplete:aV,onError:aR,onSessionTimeout:aY};this.$.jobStatusWS.sendRequest(aU)};aA=function(aX,aW,aS,aT){var aV,aR,aU;aV=function(aZ){var a0=false,a1;if(aZ.response){a1=JSON.parse(aZ.response);if(typeof a1.Job_Status!=="undefined"&&a1.Job_Status&&a1.Job_Status==="Completed"){a0=true}}if(aS){aS(a0)}}.bind(this);aR=function(a0){var aZ="Job Web service error";if(a0.response){aZ=a0.response}if(aT){aT(aZ)}}.bind(this);var aY=function(aZ){this.fire("sessiontimeout",aZ)}.bind(this);aU={verb:"GET",uri:this.$.jobStatusWS.uri+"/"+aW.mcsJobId,onComplete:aV,onError:aR,onSessionTimeout:aY};this.$.jobStatusWS.sendRequest(aU)};d=function(){this._initializing=false;this._uploadingItems={}};w=function(){this.DOM(this).find(an.variable).forEach(function(aR){this.set("globals."+aR.name,aR.getValue())}.bind(this));this.$.eventChecker.addEventCheckDef(C,aJ.bind(this));this.$.eventChecker.addEventCheckDef(F,aA.bind(this))};ay=function(aR){this.set("globals."+aR.detail.name,aR.detail.value);if(!this.jspLaunch&&(this.globals.mcsWSBaseURL&&this.globals.mcsWSBaseURL.length>0)&&(!this.globals.eedBaseURL||this.globals.eedBaseURL.length===0)){this.$.eedurlWS.getData(y.bind(this))}if(aR.detail.name==="securityContext"&&this.globals.securityContext){ad.call(this)}};am=function(){f.call(this);this.fire(aE.sessionLoaded,{})};az=function(){this.fire(aE.error,{error:z.sessionWSError})};t=function(){this.fire(aE.error,{error:z.sessionDataError})};A=function(){this.splice("tools",0);this.splice("hiddenTools",0);if(this.activities&&this.activities.length>0){this.activities.forEach(function(aT){if(aT.basics.name.substr(0,7)!==aN){var aR=this.toolManager.loadToolInstance(aT,aT);this.tools.push(aR)}else{var aS=this.toolManager.loadToolInstance(aT,aT);this.hiddenTools.push(aS)}}.bind(this))}this.fire(aE.toolsLoaded,{})};ap=function(){this.fire(aE.error,{error:z.toolWSError})};ax=function(){this.fire(aE.error,{error:z.toolDataError})};aj=function(aR){if(aR.detail.result&&aR.detail.result.context&&aR.detail.result.context.successCallback){aR.detail.result.context.successCallback(aR.detail.result.EEDJobID,aR.detail.result.MCSJobID)}};aa=function(aR){if(aR.detail.result&&aR.detail.result.context&&aR.detail.result.context.errorCallback){aR.detail.result.context.errorCallback(z.mdataUploadError,aR.detail.response)}};aw=function(aR){if(aR.detail.result&&aR.detail.result.context&&aR.detail.result.context.successCallback){aR.detail.result.context.successCallback()}};o=function(aR){if(aR.detail.result&&aR.detail.result.context&&aR.detail.result.context.errorCallback){aR.detail.result.context.errorCallback(z.mdataDownloadError,aR.detail.response)}};q=function(){var aW,aU,aX=[],aR=null,aV=[],aT=[],aS=[];if(this.processJobs&&this.processJobs.length>0){this.processJobs.forEach(function(aZ){var aY=new aD.ADJobInstance();aY.jobProcessId=this.processID;aY.load(aZ);aX.push(aY);if(aY.isFinished){aV.push(aY)}}.bind(this))}for(aW=0;aW<aV.length;aW++){aR=this.findJob(aV[aW].jobMcsPhysicalId);if(aR&&!aR.isFinished){aT.push(aV[aW])}}for(aW=0;aW<aV.length;aW++){for(aU=0;aU<this.executionDirectories.length;aU++){if(this.executionDirectories[aU].mcsJobID===aV[aW].jobMcsPhysicalId&&this.executionDirectories[aU].removeAfterJob){aS.push(this.executionDirectories[aU])}}for(aU=0;aU<this.hiddenExecutionDirectories.length;aU++){if(this.hiddenExecutionDirectories[aU].mcsJobID===aV[aW].jobMcsPhysicalId&&this.hiddenExecutionDirectories[aU].removeAfterJob){aS.push(this.hiddenExecutionDirectories[aU])}}}this.splice("jobs",0);for(aW=0;aW<aX.length;aW++){this.push("jobs",aX[aW])}if(aS.length>0){for(aW=0;aW<aS.length;aW++){this.removeExecutionDirectory(aS[aW])}}if(aT.length>0){this.fire(aE.jobsCompleted,{jobIDs:aT.map(function(aY){return aY.jobMcsPhysicalId})})}this.fire(aE.jobsLoaded,{})};aP=function(){this.fire(aE.error,{error:z.jobWSError})};ao=function(){this.fire(aE.error,{error:z.jobDataError})};aG=function(){this.fire(aE.error,{error:z.jobDeleteWSError})};l=function(){var aS=0,aR=function(){if(this.hasPendingUpdates()){console.log("Pending updates...wait till they finish")}else{window.clearInterval(aS);this.$.activitiesWS.getData()}}.bind(this);aS=window.setInterval(aR,1000)};L=function(){this.$.activitiesWS.getData()};R=function(aT){var aS,aR;if(aT){for(aS=0;aS<aT.length;aS++){aR=this.tools.indexOf(aT[aS]);if(aR<0){this.tools.push(aT[aS])}}}};V=function(aV){var aT,aS,aR=[];if(aV){for(aT=0;aT<aV.length;aT++){aS=this.tools.indexOf(aV[aT]);if(aS>=0){this.splice("tools",aS,1);aR.push(aV[aT].modelID)}}var aU=function(aW){this.fire("sessiontimeout",aW)}.bind(this);if(aR.length>0){this.$.activitiesWS.sendRequest({verb:"DELETE",data:JSON.stringify(aR),onSessionTimeout:aU})}}};B=function(aX,aZ,aT,aW){var aS=aX,aR,aV,a0,aU;aR=function(a3){var a5,a4,a1,a6=[],a2;a5=JSON.parse(a3.response);if(aS.type==="file"){if(a5.ROOT&&a5.ROOT.children&&(a5.ROOT.children.length>0)&&a5.ROOT.children[0].children){a5=a5.ROOT.children[0].children}}for(a4=0;a4<a5.length;a4++){a1=new s.ADMDataInstance();if(aS.type==="file"){if(a5[a4].info.fileModifiedMillis){a2=new Date();a2.setTime(parseInt(a5[a4].info.fileModifiedMillis))}else{a2=null}a1.load({basics:{type:"fileversion"},physicalid:a5[a4].info.fileContainerDocId,title:a5[a4].info.fileName,description:a5[a4].info.fileCheckinReason,originated:a2?a2.toLocaleString():"",version:a5[a4].info.fileVersion,size:parseInt(a5[a4].info.fileSize),comment:a5[a4].info.fileCheckinReason},aS)}else{a1.load(a5[a4],aS)}a6.push(a1)}aS.childInstances=a6;aS.loaded=true;if(aT){aT(aS)}}.bind(this);aV=function(a1){if(aW){aW(z.mdataLoadError,a1)}}.bind(this);var aY=function(a1){this.fire("sessiontimeout",a1)}.bind(this);aU=aX.type==="file"?this.globals.mcsWSBaseURL+"/simulationdocuments/fileVersionsInfo/"+aS.parentInstance.modelID+"?fileName="+aS.name:this.$.contentWS.uri+"?pid="+aS.modelID;a0={headers:{pragma:"no-cache"},verb:"GET",uri:aU,onComplete:aR,onError:aV,onSessionTimeout:aY};this.$.contentWS.sendRequest(a0)};I=function(aS,aU,aR,aT){if(s.ADMDataInstance.TYPES.folder===aS.type||s.ADMDataInstance.TYPES.category===aS.type){G.call(this,aS,aU,aR,aT)}else{if(s.ADMDataInstance.TYPES.document===aS.type){ac.call(this,aS,aU,aR,aT)}else{if(s.ADMDataInstance.TYPES.file===aS.type){a.call(this,aS,aU,aR,aT)}}}};J=function(aS,aU,aR,aT){ae.call(this,aS,aU,aR,aT)};b=function(aS,aV,aU,aR,aT){D.call(this,aS,aV,aU,aR,aT)};N=function(aR){var aS=false;if(aR.modelID&&this._uploadingItems[aR.modelID]){aS=true}return aS};p=function(a4,aS,aR,aX){var a2={successCallback:aR,errorCallback:aX};var aT=aS[0].type===k.GENERIC_FOLDER?k.SIM_FOLDER:aS[0].type==="fileversion"||aS[0].type==="file"?"file":k.SIMDOC_V;var a5=a4.path;var aW=new W.SMAProcADUI.ADStationManager();var aV=aW.getServerForStation(a4.station);var a1=aW.getStation(a4.station);if(a4.relativePath&&""!==a4.relativePath&&" "!==a4.relativePath){var a8=a4.relativePath;var aU="\\";if(a1.os===m.ADStation.OSTYPES.linux){aU="/";a8=aU+a8}else{a8=aU+a8.replace(/(\/)/gm,aU)}a5=a5+a8}a5=a5.replace(/(\\)/gm,"\\\\\\\\");var a3=[],aY=[];var aZ=null;for(var a6=0;a6<aS.length;a6++){var a9;if(aS[a6].id===null||aS[a6].id===""){a9=aS[a6].modelID}else{a9=aS[a6].id}if(aS[a6].type==="fileversion"){a3=[];a3.push(a9);aY=[];aY.push(aS[a6].name);aZ=aS[a6].details.version}else{if(aS[a6].type===k.FILE){a3=[];a3.push(a9);aY.push(aS[a6].name)}else{a3.push(a9);aY=[];aY.push("*")}}}var a7={REPLACE_VERSION:g.version,REPLACE_PROCESS_ID:this.processID,REPLACE_DYNAMIC_ACTIVITY:g.name,KEEP_DIR:"1",REPLACE_STEP_ID:g.id,REPLACE_WORKING_DIR:a5,REPLACE_LAST_ID:g.lastId,REPLACE_HOST:a4.station,ADD_RULE_TYPE:aT,ADD_RULE_TITLE:aY.join(","),ADD_RULE_CATEGORY:this.getCategoryID(K),REF_ID:a3.join(","),model_key:g.key};if(aZ){a7.ADD_RULE_VERSION=aZ}this.$.downloadRunner.jobData=JSON.stringify(a7);var a0=a4;while(typeof a0!=="undefined"&&a0&&!(a0 instanceof j.ADExecDir)){a0=a0.parent}if(a0 instanceof j.ADExecDir){a2.credentials=a0.credentials?JSON.parse(JSON.stringify(a0.credentials)):null;if(a2.credentials){a2.credentials.encryptedCredentials=null}}if((m.ADStation.LOCALSTATIONNAME===a1.name)||(m.ADStation.LOCALSTATIONNAME===a1.queryName)){a2.forceHasLocalHost=true}if(typeof a2.credentials!=="undefined"&&a2.credentials){this.$.downloadRunner.runSimulationAs(a2,this.processID,"",true,a2.credentials,v,aV.id)}else{this.$.downloadRunner.runSimulation(a2,this.processID,"",true,v,aV.id)}};n=function(a0,aS,aY){var aR,aV,aX,aU="",a2,aT;aR=function(a3){var a4=a3.response===""?{}:JSON.parse(a3.response);if(aS){aS(a4)}this.fire(aE.blockToolConfig,{});this.fire(aE.mdataRemoved,{})}.bind(this);aV=function(a3){if(aY){aY(z.mdataRemoveError,a3.response)}this.fire(aE.blockToolConfig,{})}.bind(this);var a1=function(a3){this.fire("sessiontimeout",a3)}.bind(this);for(aX=0;aX<a0.length;aX++){aU+=a0[aX].modelID;if(aX<(a0.length-1)){aU+=","}}if(a0[0].type==="fileversion"){aT=this.globals.mcsWSBaseURL+"/simulationdocuments/"+a0[0].parentInstance.parentInstance.modelID+"/fileversion?fileName="+a0[0].parentInstance.name;aT+="&deleteRules=true&simOId="+this.processID}else{if(a0[0].type==="file"){aT=this.globals.mcsWSBaseURL+"/simulationdocuments/"+a0[0].parentInstance.modelID+"/fileversion?fileName="+a0[0].name;aT+=a0[0].details.hasOwnProperty("revision")?"&version=all":"&version=none";aT+="&deleteRules=true&simOId="+this.processID}else{if(a0[0].type==="DesignSight"){aT=this.$.contentWS.uri+"/owned"}else{aT=this.$.contentWS.uri+"/owned?delRules=true"}}}a2={verb:"DELETE",uri:aT,headers:{"Content-Type":"application/ds-json",Accept:"*/*"},data:aU,onComplete:aR,onError:aV,onSessionTimeout:a1};var aZ=0,aW=function(){if(this.hasPendingUpdates()){console.log("Pending updates...wait till they finish")}else{window.clearInterval(aZ);this.fire(aE.blockToolConfig,{});this.$.contentWS.sendRequest(a2)}}.bind(this);aZ=window.setInterval(aW,1000)};i=function(aS){var aT=function(aU){this.fire("sessiontimeout",aU)}.bind(this);var aR={verb:"PUT",uri:this.globals.mcsWSBaseURL+"/simulationdocuments/"+aS.parentInstance.parentInstance.modelID+"/versioncomment?fileName="+aS.parentInstance.name+"&version="+aS.details.version,headers:{"Content-Type":"text/plain"},data:aS.details.comment,onComplete:function(){},onError:function(){},onSessionTimeout:aT};this.$.contentWS.sendRequest(aR)};Z=function(aS){var aU,aV,aT=function(aY){var aZ=JSON.parse(aY.response);if(aZ.data&&(aZ.data.length>0)&&aZ.data[0].dataelements&&aZ.data[0].dataelements.ticketURL){var aX=document.createElement("a");au.dom(document.body).appendChild(aX);aX.style.display="none";aX.href=aZ.data[0].dataelements.ticketURL;aX.download=aS.name;aX.target="_blank";aX.click();au.dom(document.body).removeChild(aX)}else{aR()}}.bind(this),aW=function(aX){var aY=JSON.parse(aX.response);if(aY.csrf){if(s.ADMDataInstance.TYPES.fileversion===aS.type){aV=this.globals.mcsBaseURL+"/resources/v1/modeler/documents/"+aS.parentInstance.parentInstance.modelID+"/files/"+aS.parentInstance.fileID+"/versions/"+aS.modelID+"/DownloadTicket"}else{if(s.ADMDataInstance.TYPES.file===aS.type){aV=this.globals.mcsBaseURL+"/resources/v1/modeler/documents/"+aS.parentInstance.modelID+"/files/"+aS.fileID+"/DownloadTicket"}else{aV=this.globals.mcsBaseURL+"/resources/v1/modeler/documents/"+aS.modelID+"/files/DownloadTicket"}}aU={uri:aV,verb:"PUT",data:JSON.stringify({csrf:{name:aY.csrf.name,value:aY.csrf.value}}),onComplete:aT,onError:aR};this.$.downloadWS.sendRequest(aU)}else{aR()}}.bind(this),aR=function(){this.fire(aE.appMessage,{level:"error",message:ar})}.bind(this);if(s.ADMDataInstance.TYPES.fileversion===aS.type){aV=this.globals.mcsBaseURL+"/resources/v1/modeler/documents/"+aS.parentInstance.parentInstance.modelID}else{if(s.ADMDataInstance.TYPES.file===aS.type){aV=this.globals.mcsBaseURL+"/resources/v1/modeler/documents/"+aS.parentInstance.modelID}else{aV=this.globals.mcsBaseURL+"/resources/v1/modeler/documents/"+aS.modelID}}aU={uri:aV,onComplete:aW,onError:aR};this.$.downloadWS.sendRequest(aU)};r=function(aX,aS,aT,aW){var aR,aV,aZ,aU;aR=function(){if(aT){aT()}}.bind(this);aV=function(a0){if(aW){aW(z.mdataAddReferenceError,a0.response)}}.bind(this);var aY=function(a0){this.fire("sessiontimeout",a0)}.bind(this);aU=this.$.contentReferencedWS.uri+"?contentId="+aX.modelID;if(aS!==null){aU=aU+"&folderId="+aS}aZ={verb:"POST",uri:aU,onComplete:aR,onError:aV,onSessionTimeout:aY};this.$.contentReferencedWS.sendRequest(aZ)};c=function(aT){var aS=this.$.contentReferencedWS.uri+"?contentId="+aT;var aR={verb:"POST",uri:aS,};this.$.contentReferencedWS.sendRequest(aR)};ab=function(a0,aS,aT,aZ){var aR,aW,a2,aY,aX,aU,aV;aR=function(){if(aT){aT()}this.fire(aE.mdataRemoved,{})}.bind(this);aW=function(a3){if(aZ){aZ(z.mdataRemoveError,a3.response)}}.bind(this);var a1=function(a3){this.fire("sessiontimeout",a3)}.bind(this);aV=a0.type==="fileversion"||a0.type==="file"?"DELETE":"POST";aU=a0.type==="fileversion"||a0.type==="file"?this.globals.mcsWSBaseURL+"/simulationdocuments/"+a0.parentInstance.modelID+"/fileversion?fileName="+a0.name+"&version="+(a0.type==="fileversion"?"last":a0.hasOwnProperty("revision")?"all":"none"):this.$.contentReferencedWS.uri+"?contentId="+a0.modelID+"&operation=delete";if(aS!==null){aU=aU+"&folderId="+aS}a2={verb:aV,uri:aU,onComplete:aR,onError:aW,onSessionTimeout:a1};aX={id:a0.modelID,type:a0.type,name:a0.name};for(aY=0;aY<this.tools.length;aY++){this.tools[aY].removeInputObject(aX)}this.$.contentReferencedWS.sendRequest(a2)};E=function(aV,aS,aU,aR,aT,aW,aY,aZ){var aX={};aX.path=aU.replace(/(\\)/gm,"\\\\");this.$.editFileComponent.editStartCallBack=aW;this.$.editFileComponent.editCompleteCallBack=aY;this.$.editFileComponent.editFailCallBack=aZ;this.$.editFileComponent.beginEdit(this.processID,K,aV,aS,v,aX,aT,aR)};af=function(){return this.$.editorStore.getItem("editor")};ag=function(aR){this.$.editorStore.setItem("editor",aR)};aB=function(){var aT=function(aV){this.$.processJobsWS.data=typeof aV.response==="string"?JSON.parse(aV.response):aV.response;this.onProcessJobsDataReady(null)}.bind(this);var aR=function(){this.onProcessJobsWSError(null)}.bind(this);var aU=function(aV){this.$.processJobsWS.fire("sessiontimeout",aV)}.bind(this);var aS={onComplete:aT,onError:aR,onSessionTimeout:aU,headers:{pragma:"no-cache"}};this.$.processJobsWS.sendRequest(aS)};u=function(aT){var aR,aS=null;if(aT){for(aR=0;aR<this.jobs.length;aR++){if(this.jobs[aR].jobMcsPhysicalId===aT){aS=this.jobs[aR];break}}}return aS};aQ=function(aR){var aT,aS,aU=[];if(aR){for(aT=0;aT<aR.length;aT++){aS=this.jobs.indexOf(aR[aT]);if(aS>=0){this.splice("jobs",aS,1);aU.push(aR[aT].jobMcsId)}}if(aU.length>0){var aV=function(aW){this.fire("sessiontimeout",aW)}.bind(this);this.$.jobDeleteWS.sendRequest({verb:"DELETE",data:JSON.stringify(aU),onSessionTimeout:aV})}}};ai=function(aS){var aT,aU=false,aR;if(aS){if(aS.name.substr(0,7)!==aN){for(aT=0;aT<this.executionDirectories.length;aT++){if((this.executionDirectories[aT].name===aS.name)&&(this.executionDirectories[aT].station===aS.station)&&(this.executionDirectories[aT].path===aS.path)){aU=true;break}}}else{for(aT=0;aT<this.hiddenExecutionDirectories.length;aT++){if((this.hiddenExecutionDirectories[aT].name===aS.name)&&(this.hiddenExecutionDirectories[aT].station===aS.station)&&(this.hiddenExecutionDirectories[aT].path===aS.path)){aU=true;break}}}if(!aU){U.call(this);aR={};aS.save(aR,this.process);this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories.push(aR);if(aS.name.substr(0,7)!==aN){this.executionDirectories.push(aS)}else{this.hiddenExecutionDirectories.push(aS)}this.process.update()}}};ak=function(aR){var aT,aS;if(aR){if(aR.name.substr(0,7)!==aN){for(aT=0;aT<this.executionDirectories.length;aT++){if(this.executionDirectories[aT].name===aR.name&&this.executionDirectories[aT].station===aR.station&&this.executionDirectories[aT].path===aR.path){this.splice("executionDirectories",aT,1);break}}}else{for(aT=0;aT<this.hiddenExecutionDirectories.length;aT++){if(this.hiddenExecutionDirectories[aT].name===aR.name&&this.hiddenExecutionDirectories[aT].station===aR.station&&this.hiddenExecutionDirectories[aT].path===aR.path){this.splice("hiddenExecutionDirectories",aT,1);break}}}aS=this.process.attributes.definition.process.ExecutionConfig.properties.SCExecutionDirectories;for(aT=0;aT<aS.length;aT++){if(aS[aT].name.indexOf(aR.name)===0&&aS[aT].station===aR.station&&aS[aT].path===aR.path){aS.splice(aT,1);break}}for(aT=0;aT<this.tools.length;aT++){if(this.tools[aT].workDir&&this.tools[aT].workDir.name===aR.name){this.tools[aT].workDir=null}}this.fire(aE.execDirRemoved,{});this.process.update()}};ah=function(aS){var aR=null;if(this.process&&(typeof this.process.connections!=="undefined"&&this.process.connections)&&(typeof this.process.connections.SimulationCategory!=="undefined"&&this.process.connections.SimulationCategory)){aR=this.process.connections.SimulationCategory[aS];if(typeof aR==="undefined"){aR=null}}return aR};x=function(){return(this.$.processWS.hasPendingUpdates()||this.$.activitiesWS.hasPendingUpdates()||(Object.keys(this._uploadingItems).length>0))};aF=function(){return(Object.keys(this._uploadingItems).length>0)};av=function(aR,aS){this.$.activitiesWS.abortGET=false;this.$.activitiesWS.flushAll(aR,aS)};h=function(aX,aV,aU,aT){var aW,aS;var aR={mcsJobId:aX,toolName:aV};aW=function(aY){aU(aY,aV)}.bind(this);aS=function(aY){aT(aY,aV)}.bind(this);this.$.eventChecker.startListening(F,this,aR,true,100,T,aW,aS)};aK=function(aU,aT,aS,aR){h.call(this,aU,aT,aS,aR)};Q=function(){if(this.envList.success&&this.envList.environments.length===0){this.onCloud=true}};aL=function(){};P=function(aT,aX,aY,aW){var aV=function(a0){var aZ=JSON.parse(a0.response);if(aY){aY(aZ.success)}};var aR=function(){if(aW){aW()}console.error("Parameters creation failed")};var aS="updateWidget="+encodeURIComponent(JSON.stringify(aX));var aU={verb:"POST",uri:this.globals.mcsBaseURL+"/resources/e6w/service/SMA_Parameter?objectId="+aT,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:aS,onComplete:aV,onError:aR};this.$.parameterWS.sendRequest(aU)};aq=function(aW,aS,aT){var aV=function(aX){if(aS){aS(aW,aX.response)}};var aR=function(){if(aT){aT()}};var aU={verb:"GET",uri:aW.fullCosUrl+"/admin/drm",onComplete:aV,headers:{"Content-Type":"application/xml",Accept:"*/*"},onError:aR};this.$.checkDrmWS.sendRequest(aU)};W.SMAProcADUI=W.SMAProcADUI||{};W.SMAProcADUI.ADSession=au({is:"ad-session",properties:{description:{type:String,value:"",observer:"descriptionChanged"},executionDirectories:{type:Array,value:function(){return[]},},hiddenExecutionDirectories:{type:Array,value:function(){return[]},},globals:{type:Object,value:function(){return{}},},jobs:{type:Array,value:function(){return[]},},managedData:{type:Object,value:null,notify:true},name:{type:String,value:"",observer:"nameChanged"},processID:{type:String,value:"",notify:true},queryProcessID:{type:String,value:null,observer:"queryProcessIDChanged"},toolManager:{type:Object,value:null},tools:{type:Array,value:function(){return[]},},hiddenTools:{type:Array,value:function(){return[]},},process:{type:Object,notify:true},onCloud:{type:Boolean,value:false},cpuLimit:{type:Number,value:0}},created:function(){return d.apply(this,arguments)},ready:function(){return w.apply(this,arguments)},onVariableValueChange:function(){return ay.apply(this,arguments)},onSessionDataReady:function(){return am.apply(this,arguments)},onSessionWSError:function(){return az.apply(this,arguments)},onSessionDataError:function(){return t.apply(this,arguments)},onToolDataReady:function(){return A.apply(this,arguments)},onToolWSError:function(){return ap.apply(this,arguments)},onToolDataError:function(){return ax.apply(this,arguments)},onUploadJobStarted:function(){return aj.apply(this,arguments)},onUploadJobError:function(){return aa.apply(this,arguments)},onDownloadJobStarted:function(){return aw.apply(this,arguments)},onDownloadJobError:function(){return o.apply(this,arguments)},onProcessJobsDataReady:function(){return q.apply(this,arguments)},onProcessJobsDataError:function(){return ao.apply(this,arguments)},onProcessJobsWSError:function(){return aP.apply(this,arguments)},onJobDeleteWSError:function(){return aG.apply(this,arguments)},envListReady:function(){return Q.apply(this,arguments)},loadTools:function(){return l.apply(this,arguments)},initTools:function(){return L.apply(this,arguments)},addTools:function(){return R.apply(this,arguments)},removeTools:function(){return V.apply(this,arguments)},loadContentObject:function(){return B.apply(this,arguments)},uploadLocalFile:function(){return I.apply(this,arguments)},uploadExecutionData:function(){return b.apply(this,arguments)},isItemBeingUploaded:function(){return N.apply(this,arguments)},downloadManagedData:function(){return p.apply(this,arguments)},removeOwnedContent:function(){return n.apply(this,arguments)},addReferencedContent:function(){return r.apply(this,arguments)},removeReferencedContent:function(){return ab.apply(this,arguments)},editFile:function(){return E.apply(this,arguments)},getEditorPath:function(){return af.apply(this,arguments)},setEditorPath:function(){return ag.apply(this,arguments)},loadJobs:function(){return aB.apply(this,arguments)},findJob:function(){return u.apply(this,arguments)},removeJobs:function(){return aQ.apply(this,arguments)},addExecutionDirectory:function(){return ai.apply(this,arguments)},removeExecutionDirectory:function(){return ak.apply(this,arguments)},getCategoryID:function(){return ah.apply(this,arguments)},hasPendingUpdates:function(){return x.apply(this,arguments)},hasPendingUploads:function(){return aF.apply(this,arguments)},flushPendingUpdates:function(){return av.apply(this,arguments)},createFolder:function(){return J.apply(this,arguments)},editComment:function(){return i.apply(this,arguments)},downloadFile:function(){return Z.apply(this,arguments)},addReferencedContentAS:function(){return c.apply(this,arguments)},addMainJobTracker:function(){return aK.apply(this,arguments)},set3DXParameters:function(){return P.apply(this,arguments)},checkForCloudDrm:function(){return aq.apply(this,arguments)},queryProcessIDChanged:function(){ad.call(this)},nameChanged:function(aR){if(!this._initializing){this.set("process.attributes.title",aR)}},descriptionChanged:function(aR){if(!this._initializing){this.set("process.attributes.description",aR)}},cloudCOSInfoReady:function(){return aL.apply(this)},_computeEedUrlUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/cos/url"}return aS},_computeProcessUri:function(aR,aT){var aS="";if(typeof aR!=="undefined"){aS=aR+"/simulations/"+aT}return aS},_computeActivitiesUri:function(aR,aT){var aS="";if(typeof aR!=="undefined"){aS=aR+"/activity?simId="+aT}return aS},_computeContentUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/simulations/content"}return aS},_computeCreateFileUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/fcs/checkin"}return aS},_computeCheckinFileUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/servlet/fcs/checkin"}return aS},_computeCommitCreateUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/fcs/commit"}return aS},_computeRefContentUri:function(aR,aT){var aS="";if(typeof aR!=="undefined"){aS=aR+"/simulations/"+aT+"/referencedContent"}return aS},_computeFolderCreate:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/simulationfolders"}return aS},_computeProcessJobsUri:function(aR,aT){var aS="";if(typeof aR!=="undefined"){aS=aR+"/simulations/"+aT+"/jobs"}return aS},_computeJobDeleteUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/jobs"}return aS},_computeJobStatusUri:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/jobs"}return aS},_computeUploadJobXmlUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/jobs/upload"}return aS},_computeCosPubkeyUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/execution/pubkey"}return aS},_computeMcsTicketUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/ticket/get"}return aS},_computeEncryptUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/data/getEncryptedCreds"}return aS},_computeRunUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/execution/run/workflow"}return aS},_computeDownloadJobXmlUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR+"/jobs/download"}return aS},_computeMcsUrl:function(aR){var aS="";if(typeof aR!=="undefined"){aS=aR}return aS},behaviors:[W.SMAProcSP.SPBase]});W.SMAProcADUI.ADSession.EVENTS=W.SMAProcADUI.ADSession.EVENTS||aE;W.SMAProcADUI.ADSession.ERRORS=W.SMAProcADUI.ADSession.ERRORS||z;W.SMAProcADUI.ADSession.CATEGORY_INTERNAL_DATA=W.SMAProcADUI.ADSession.CATEGORY_INTERNAL_DATA||K});