/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/Redux/Redux","DS/SMAPoweredByState/ad-state-store","DS/SMAPoweredByMonitors/ad-monitor-manager","DS/SMAPoweredByState/ad-state-domain/actions","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-managed-data/actions","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-domain-study/selectors","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-redux-observer"],function(b,h,n,e,g,m,l,d,j,k){var c={};var a="jobdata";function f(o,q){var p;p=g.allJobs(o.getState()).filter(function(r){return(((r.kind===g.JobKind.TOOL)&&((q&&!g.isJobConfiguring(o.getState(),r))||g.isJobRunning(o.getState(),r)))||(((r.kind===g.JobKind.UPLOAD)||(r.kind===g.JobKind.GENERATE_RESULT))&&g.isJobRunning(o.getState(),r))||((r.kind===g.JobKind.GENERATE_RESULT)&&q))});return p}function i(u){var s=false,r=new k(),o=false,q=h.getStore(),t=d.studyObject(q.getState()),p=function(w){if(w===j.PersistenceOperation.READING){s=true}else{if(s){u.mdUnsubscribe();u.mdUnsubscribe=null;f(q,u.firstTime).forEach(function(x){b.bindActionCreators(e,q.dispatch).refreshJob(t.id,x.id,u.firstTime)});u.firstTime=false}}},v=function(w){if(w===j.PersistenceOperation.READING){o=true}else{if(o){u.jobsUnsubscribe();u.jobsUnsubscribe=null;f(q,u.firstTime).forEach(function(x){b.bindActionCreators(e,q.dispatch).refreshJob(t.id,x.id,u.firstTime)});u.firstTime=false}}};if(f(q,u.firstTime).length>0){if(u.mdUnsubscribe){u.mdUnsubscribe()}u.mdUnsubscribe=r.observeStore({store:q,select:l.managedDataPersistenceOperation,onChange:p,compareFunc:function(y,w){var x=y?y:null;return x===w}});b.bindActionCreators(m,q.dispatch).refreshManagedData()}else{if(u.jobsUnsubscribe){u.jobsUnsubscribe()}u.jobsUnsubscribe=r.observeStore({store:q,select:g.jobsPersistenceOperation,onChange:v,compareFunc:function(y,w){var x=y?y:null;return x===w}})}}c.startJobMonitor=function(o){var p=(typeof o!=="undefined")&&(o!==null)?o:60;return n.startMonitor(a,null,{firstTime:true},i,null,p)};c.stopJobMonitor=function(){n.stopMonitorsOfType(a)};return c});