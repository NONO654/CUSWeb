define("DS/DELMOMViewComponents/DELAvpDataUtil",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(d,b,c){var a=b.singleton({init:function(){return this},strToType:function(f,e){if(f===null||f===undefined||f===""||e===null||e===undefined||e===""){return}switch(e){case"bool":return this.strToBool(f);break;case"float":return this.strToFloat(f);break;case"Color":return this.strToColor(f);break;case"Vector3":return this.strToVect(f);break;case"ListVector3":return this.strToListVect(f);break;case"ImageURL":return this.strToImageURL(f);break;case"string":return f;default:return f}return f},strToBool:function(e){if(typeof e==="string"){return e==="true"?true:(e==="false"?false:null)}return e},strToFloat:function(e){return parseFloat(e)},strToColor:function(f){var e=f.replace(/[RGB( )]/gi,"").split(",");return new c.Color().setRGB(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]))},strToVect:function(e){var f=e.split?e.split(" "):null;if(f){return new c.Vector3(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]))}else{if(e.length===3){return new c.Vector3(e[0],e[1],e[2])}}},strToListVect:function(f){var g=[];for(var e=0;e<f.length;e++){g.push(this.strToVect(f[e]))}return g},strToImageURL:function(g){var e=new Image();var f=g&&g.indexOf('"')===0?JSON.parse(g):g;if(f&&f!==""){e.src=f}return e},});return a});define("DS/DELMOMViewComponents/DELViewMathsVector3D",[],function(){var a=0.001;var c=0.000001;var b={modifyEpsilon:function(d){var e=a;if(d>0){a=d;c=d*d}return e},isNull:function(e){var d=(Math.abs(e[0])<a)&&(Math.abs(e[1])<a)&&(Math.abs(e[2])<a);return d},clone:function(e){var d=[];d[0]=e[0];d[1]=e[1];d[2]=e[2];return d},length:function(e){var d=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return d},squaredLength:function(e){var d=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return d},normalize:function(h,e){var f;var g=h[0]*h[0]+h[1]*h[1]+h[2]*h[2];if(Math.abs(g-1)<c){f=e||[0,0,0];f[0]=h[0];f[1]=h[1];f[2]=h[2]}else{if(g>c){var d=Math.sqrt(g);f=e||[0,0,0];f[0]=h[0]/d;f[1]=h[1]/d;f[2]=h[2]/d}}return f},multiply:function(g,d,e){var f=e||[0,0,0];f[0]=d*g[0];f[1]=d*g[1];f[2]=d*g[2];return f},areEqual:function(f,e){var d=(Math.abs(e[0]-f[0])<a)&&(Math.abs(e[1]-f[1])<a)&&(Math.abs(e[2]-f[2])<a);return d},add:function(g,f,d){var e=d||[0,0,0];e[0]=f[0]+g[0];e[1]=f[1]+g[1];e[2]=f[2]+g[2];return e},sub:function(g,f,d){var e=d||[0,0,0];e[0]=f[0]-g[0];e[1]=f[1]-g[1];e[2]=f[2]-g[2];return e},angle:function(i,h){var f;var e=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);var d=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);if((e>a)&&(d>a)){var g=(i[0]*h[0]+i[1]*h[1]+i[2]*h[2])/(e*d);f=Math.acos(Math.min(Math.max(g,-1),1))}return f},dot:function(f,e){var d=f[0]*e[0]+f[1]*e[1]+f[2]*e[2];return d},cross:function(h,g,i){var j=i||[0,0,0];var f=h[0];var e=h[1];var d=h[2];var m=g[0];var l=g[1];var k=g[2];j[0]=e*k-d*l;j[1]=d*m-f*k;j[2]=f*l-e*m;return j},subAndLength:function(h,g,e){var f=e||[0,0,0];f[0]=g[0]-h[0];f[1]=g[1]-h[1];f[2]=g[2]-h[2];var d=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);return d},subAndSquaredLength:function(h,f,d){var e=d||[0,0,0];e[0]=f[0]-h[0];e[1]=f[1]-h[1];e[2]=f[2]-h[2];var g=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return g},multiplyAndAdd:function(h,d,g,e){var f=e||[0,0,0];f[0]=h[0]*d+g[0];f[1]=h[1]*d+g[1];f[2]=h[2]*d+g[2];return f},isIdentity:function(d){var e=(Math.abs(d[0]-1)<a)&&(Math.abs(d[1])<a)&&(Math.abs(d[2])<a)&&(Math.abs(d[3])<a)&&(Math.abs(d[4])<a)&&(Math.abs(d[5]-1)<a)&&(Math.abs(d[6])<a)&&(Math.abs(d[7])<a)&&(Math.abs(d[8])<a)&&(Math.abs(d[9])<a)&&(Math.abs(d[10]-1)<a)&&(Math.abs(d[11])<a)&&(Math.abs(d[12])<a)&&(Math.abs(d[13])<a)&&(Math.abs(d[14])<a)&&(Math.abs(d[15]-1)<a);return e},areMatrixEqual:function(e,d){var f=(Math.abs(e[0]-d[0])<a)&&(Math.abs(e[1]-d[1])<a)&&(Math.abs(e[2]-d[2])<a)&&(Math.abs(e[3]-d[3])<a)&&(Math.abs(e[4]-d[4])<a)&&(Math.abs(e[5]-d[5])<a)&&(Math.abs(e[6]-d[6])<a)&&(Math.abs(e[7]-d[7])<a)&&(Math.abs(e[8]-d[8])<a)&&(Math.abs(e[9]-d[9])<a)&&(Math.abs(e[10]-d[10])<a)&&(Math.abs(e[11]-d[11])<a)&&(Math.abs(e[12]-d[12])<a)&&(Math.abs(e[13]-d[13])<a)&&(Math.abs(e[14]-d[14])<a)&&(Math.abs(e[15]-d[15])<a);return f},transformVector:function(j,e,h){var i=h||[0,0,0];var g=j[0];var f=j[1];var d=j[2];i[0]=e[0]*g+e[4]*f+e[8]*d;i[1]=e[1]*g+e[5]*f+e[9]*d;i[2]=e[2]*g+e[6]*f+e[10]*d;return i},transformPoint:function(j,e,h){var i=h||[0,0,0];var g=j[0];var f=j[1];var d=j[2];i[0]=e[0]*g+e[4]*f+e[8]*d+e[12];i[1]=e[1]*g+e[5]*f+e[9]*d+e[13];i[2]=e[2]*g+e[6]*f+e[10]*d+e[14];return i}};return b});define("DS/DELMOMViewComponents/DELBaseThumbnail",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","DS/UIKIT/Spinner","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","css!DS/DELMOMViewComponents/css/DELBaseThumbnail"],function(h,c,b,d,g,e){var f=0;var a=c.extend({init:function(E){var E=E||{};this._parent(E);var n=this;var l,D=new Image();var G;var x=typeof E.width==="number"?E.width:154,k=typeof E.height==="number"?E.height:118;var j=x,y=k;var p=false;var M,q=false,S;var L;var A=0;var I;var C=e.getWebappsAssetUrl("DELMOMViewComponents","graphics/")+"DefaultPreview.png";var K=false;var B=E.title;f++;this.setPreview=function(V,U){if(V){I=V;D.src=I;if(U){J.setStyles({"background-color":U})}if(!z()&&!L){L=setInterval(function(){if(z()){clearInterval(L);L=null}},10)}J.setStyles({backgroundImage:'url("'+I+'")'});this.hideSpinner()}else{this.displaySpinner()}};this.setThumbnailTexts=function(U){if(!v){v=h.createElement("div",{"class":"DELBaseThumbnailTextDiv"}).inject(F);v.setStyles({width:E.icon?"calc(100% - 45px)":"calc(100% - 25px)","margin-left":E.icon?"0":"15px"})}if(u){v.removeChild(u)}if(s){v.removeChild(s)}if(N){v.removeChild(N)}if(U.title){u=h.createElement("p",{id:"thumbTitle"+E.id,"class":"DELBaseThumbnailText DELBaseThumbnailTitle",contenteditable:false}).inject(v);u.innerText=U.title;u.title=U.title}if(u){v.appendChild(u)}if(s){v.appendChild(s)}if(N){v.appendChild(N)}F.setStyles({height:s||N?"100px":""})};this.setDisplayFlag=function(V,U){p=V;i.setStyle("background-color",V?(U?"rgb(87, 184, 71)":"rgb(54, 142, 196)"):"rgba(255, 255, 255, 0)")};this.getDisplayFlag=function(){return p};this.getData=function(){return E.data};this.displaySpinner=function(){if(!l){l=new d({visible:true});l.inject(o);l.getContent().addClassName("DELBaseThumbnailSpinner");o.setStyles({opacity:"1"})}};this.hideSpinner=function(){if(l){while(o.firstChild){o.removeChild(o.firstChild)}l.destroy();l=null}if(h.is(o)){o.setStyles({opacity:"0"})}};this.getThumbnailID=function(){return E.id};this.allowTitleEdition=function(U){K=U;if(!K&&O){_onEditionCanceled()}};this.getContent=function(){return R};this.inject=function(U){R.inject(U);return this};this.clear=function(){if(w&&H){b.removeEvent(w,"onPrimaryPointerClick",H)}if(t){b.removeEvent(R,"onPrimaryPointerClick",t)}this.hideSpinner();if(L){clearInterval(L)}D=t=H=null;P=i=J=o=F=r=v=u=s=N=null;w=Q=null};var z=function(){if(!D||(D&&D.src===C)){return true}var Y=D.width,U=D.height,V=G===0?(j-10):54,W=G===0?(y-10):54;if(Y>0&&U>0&&Y!==50&&U!==50){if(Y>V||U>W){var X=Y/U;if(X>(V/W)){U=W;Y=W*X}else{Y=V;U=V/X}}J.setStyles({"background-size":Math.round(Y)+"px "+Math.round(U)+"px"});D.src=C;return true}return false};this.setDisplayType=function(U){if(U!==G){G=U;j=G===0?x:285;y=G===0?k:84;if(G===1){if(J.hasClassName("DELBaseThumbnailPreviewThumbDiv")){J.removeClassName("DELBaseThumbnailPreviewThumbDiv")}if(F&&F.hasClassName("DELBaseThumbnailThumbContentDiv")){F.removeClassName("DELBaseThumbnailThumbContentDiv")}J.addClassName("DELBaseThumbnailPreviewTileDiv");if(F){F.addClassName("DELBaseThumbnailTileContentDiv");F.setStyles({top:""})}if(N){N.setStyles({display:""})}}else{if(J.hasClassName("DELBaseThumbnailPreviewTileDiv")){J.removeClassName("DELBaseThumbnailPreviewTileDiv")}if(F&&F.hasClassName("DELBaseThumbnailTileContentDiv")){F.removeClassName("DELBaseThumbnailTileContentDiv")}J.addClassName("DELBaseThumbnailPreviewThumbDiv");if(F){F.addClassName("DELBaseThumbnailThumbContentDiv");F.setStyles({top:(y-33)+"px",height:"100px"})}if(N){N.setStyles({display:"none"})}}P.setStyles({width:j+"px",height:y+"px"});if(I){D.src=I;if(!z()&&!L){L=setInterval(function(){if(z()){clearInterval(L);L=null}},10)}}}};this.getDisplayType=function(){return G};this.setIsCheckableFlag=function(U){if(U!==S){S=U;w.setStyles({display:S?"":"none"})}};this.getIsCheckableFlag=function(){return S};this.setCheckFlag=function(V,U,W){if(S&&V!==M){M=V;if(Q){Q.checkFlag=V;if(!W&&E.checkFlagChangedCB){E.checkFlagChangedCB({id:E.id,checkFlag:V,data:E.data,event:U})}}}if(G==="1"){P.setStyle("outline",S&&V?"4px solid #368ec4":"1px solid #e2e4e3")}};this.isChecked=function(){return S?M:false};var R=h.createElement("div",{id:"thumbnailView_"+f+"_"+E.id,"class":"DELBaseThumbnailThumbContainer"});var P=h.createElement("div",{id:"thumbMainDiv"+f+"_"+E.id,"class":"DELBaseThumbnailThumbMainDiv"}).inject(R);var i=h.createElement("div",{id:"thumbShading"+f+"_"+E.id,"class":"DELBaseThumbnailColorDiv"}).inject(P);var J=h.createElement("div",{id:"thumbAppIcon"+f+"_"+E.id,"class":"DELBaseThumbnailPreviewDiv"}).inject(P);var o=h.createElement("div",{"class":"DELBaseThumbnailDisabledDiv"});J.appendChild(o);var F,r,v,u,s,N;if(E.icon||E.title||E.subtitle){F=h.createElement("div",{id:"thumbContent"+f+"_"+E.id}).inject(P);if(E.icon){r=h.createElement("img",{id:"thumbImg"+f+"_"+E.id,src:E.icon,"class":"DELBaseThumbnailIcon"}).inject(F);r.setStyles({backgroundImage:'url("'+E.icon+'")'})}if(E.title||E.subtitle||E.additionalText){n.setThumbnailTexts(E)}}var w=h.createElement("div",{id:E.id+"_checkBoxDiv"+f+"_","class":"DELBaseThumbnailCheckBoxDiv"}).inject(J);var Q=new g({checkFlag:false}).inject(w);Q.elements.container.addClassName("DELBaseThumbnailCheckDiv");this.setIsCheckableFlag(typeof E.isCheckable==="boolean"?E.isCheckable:false);this.setCheckFlag(typeof E.checkFlag==="boolean"?E.checkFlag:false,null,true);this.setDisplayFlag(typeof E.displayFlag==="boolean"?E.displayFlag:false);this.setPreview(E.preview,E.backgroundColor);this.setDisplayType(typeof E.displayType==="number"?E.displayType:0);this.allowTitleEdition(typeof E.allowTitleEdition==="boolean"?E.allowTitleEdition:false);var O=false;var t,m;if(E.clickCB){t=function(U){if(!O){setTimeout(function(){if(!q&&A===0){E.clickCB({id:E.id,data:E.data,event:U})}q=false;if(A>0){A--}},E.doubleClickCB?200:10)}};b.addEvent(R,"onPrimaryPointerClick",t)}var H=function(U){if(S){q=true;n.setCheckFlag(!M,U.from[0].event)}};b.addEvent(w,"onPrimaryPointerClick",H);var T=function(){setTimeout(function(){if(Q&&S){Q.checkFlag=M}},0)};Q.addEventListener("buttonclick",T)}});a.THUMBNAIL=0;a.TILE=1;return a});define("DS/DELMOMViewComponents/DELMOMViewComponents",["UWA/Core"],function(a){});define("DS/DELMOMViewComponents/DELSubViewCell",["UWA/Class"],function(a){return a.extend({init:function(){var h=[1,1];var f=null;var b={x:0,y:0};var e=0;var c=0;var g=null;var d=null;this.getCellText=function(){return f};this.getCellImage=function(){return g};this.setCellImage=function(i){if(!g||(i&&i.src!==g.src)){g=i;d=null}};this.getCellImageToDisplay=function(){return d};this.setCellImageToDisplay=function(i){if(!d||(i&&(i.width!==d.width||i.height!==d.height||i.src!==d.src))){d=i}};this.removeCellImageToDisplay=function(){d=null};this.setCellIndex=function(i,j){h[0]=i;h[1]=j};this.getCellIndex=function(){var i={};i.row=h[0];i.col=h[1];return i};this.getCellPos=function(){return b};this.setCellPos=function(i){b=i};this.getCellWd=function(){return e};this.setCellWd=function(i){e=i};this.getCellHt=function(){return c};this.setCellHt=function(i){c=i}}})});define("DS/DELMOMViewComponents/DELBasePanel",["UWA/Core","UWA/Class","DS/Windows/Panel","DS/UIKIT/Spinner","css!DS/DELMOMViewComponents/css/DELBasePanel"],function(e,a,c,b){var d=c.extend({init:function(n){var n=n||{};n.floatableFlag=typeof n.floatableFlag==="boolean"?n.floatableFlag:true;n.snappableFlag=typeof n.snappableFlag==="boolean"?n.snappableFlag:true;n.autoDock=typeof n.autoDock==="boolean"?n.autoDock:true;n.closeButtonFlag=typeof n.closeButtonFlag==="boolean"?n.closeButtonFlag:false;n.autoCloseFlag=typeof n.autoCloseFlag==="boolean"?n.autoCloseFlag:true;n.resizableFlag=typeof n.resizableFlag==="boolean"?n.resizableFlag:true;n.horizontallyStretchableFlag=typeof n.horizontallyStretchableFlag==="boolean"?n.horizontallyStretchableFlag:true;n.verticallyStretchableFlag=typeof n.verticallyStretchableFlag==="boolean"?n.verticallyStretchableFlag:true;n.ensureHeightDefinitionOnHierarchy=true;this._parent(n);var g=true;var m=WUXDockAreaEnum.NoneDockArea;var j;var h=this;this.setPanelVisibilityFlag=function(p,q){if(p===this.visibleFlag&&!q){return}this.visibleFlag=p;if(this.visibleFlag&&this.getDockedFlag()&&q){var r=n.immersiveFrame.getDockingElement(this.currentDockArea).getContainedWindows();if(r.length===1&&r[0].isAWindowGroup()){r[0].currentWindows=[this]}var o=n.immersiveFrame.getDockingElement(this.currentDockArea);if(o.collapseDockingZoneFlag){o.collapseDockingZoneFlag=false}}};this.getPanelVisibilityFlag=function(){return this.visibleFlag};this.clean=function(){this.visibleFlag=false;this.destroy()};this.getPanelID=function(){return n.id};this.setWidth=function(r){if(n.widthStep){var q=r;var p=this.getMinWidth();var o=(q-p)/n.widthStep;var s=Math.floor(o);if((o-s)<0.7){q=p+s*n.widthStep}else{q=p+(s+1)*n.widthStep}if(this.getDockedFlag()){n.immersiveFrame.getDockingElement(this.currentDockArea).dockingZoneSize=q}this.width=q}else{if(this.getDockedFlag()){n.immersiveFrame.getDockingElement(this.currentDockArea).dockingZoneSize=r}this.width=r}};this.getWidth=function(){if(this.getDockedFlag()){return n.immersiveFrame.getDockingElement(this.currentDockArea).dockingZoneSize}else{return this.width}};this.setMinWidth=function(o){this.minWidth=o;if(this.minWidth>this.getWidth()){this.setWidth(this.minWidth)}};this.getMinWidth=function(){return this.minWidth};this.setHeight=function(s){if(n.heightStep){var o=s;var q=this.getMinHeight();var p=(o-q)/n.heightStep;var r=Math.floor(p);if((p-r)<0.7){o=q+r*n.heightStep}else{o=q+(r+1)*n.heightStep}this.height=o}else{if(!n.heightStep){this.height=s}}};this.getHeight=function(){return this.height};this.setMinHeight=function(o){this.minHeight=o;if(this.minHeight>this.getHeight()){this.setHeight(this.minHeight)}};this.getMinHeight=function(){return this.minHeight};this.setResizableFlag=function(o){if(this.resizableFlag!==o){if(!o){this.setWidth(this.getMinWidth());this.setHeight(this.getMinHeight())}this.resizableFlag=o}};this.getResizableFlag=function(){return this.resizableFlag};var i=function(p){if(n.autoDock&&h.getDockedFlag()){var o=n.immersiveFrame.getDockingElement(p).getContainedWindows();if(o&&o.length>0){h.attachToWindow(o[0],WUXSnapAreaEnum.InsideArea)}}};var f=e.createElement("div",{id:"DELBasePanelDisabledDiv","class":"DELBasePanelDisabledDiv"}).inject(this.elements.container);var l=new b({visible:true});l.inject(f);l.getContent().addClassName("DELBasePanelSpinner");if(n.minWidth){this.setMinWidth(n.minWidth)}if(n.width){this.setWidth(n.width)}if(n.minHeight){this.setMinHeight(n.minHeight)}if(n.height){this.setHeight(n.height)}if(n.currentDockArea){m=n.currentDockArea;i(m)}if(n.className){this.elements.container.addClassName(n.className)}this.addEventListener("placeChange",function(){setTimeout(function(){if(h.currentDockArea!==m&&h.visibleFlag){m=h.currentDockArea;if(m!==WUXDockAreaEnum.NoneDockArea){i(m)}if(n.onPlaceChangedCB){n.onPlaceChangedCB({currentDockArea:m})}}},0)});if(n.widthStep||n.onPanelResizedCB){var k={width:0,height:0};this.addEventListener("startResize",function(){k.width=h.getWidth();k.height=h.getHeight()});this.addEventListener("stopResize",function(){if(n.widthStep){h.setWidth(h.getWidth())}if(n.heightStep){h.setHeight(h.getHeight())}if(h.visibleFlag&&(k.width!==h.getWidth()||k.height!==h.getHeight())&&n.onPanelResizedCB){n.onPanelResizedCB({width:h.getWidth(),height:h.getHeight(),widthModifiedInteractively:true,currentDockArea:m})}k={width:0,height:0}})}if(n.closePanelCB){this.addEventListener("close",n.closePanelCB)}}});return d});define("DS/DELMOMViewComponents/DELSubViewTools",["DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Mesh/Mesh","DS/SceneGraphNodes/ArrowNode","DS/Visualization/MaterialManager","DS/DELMOMViewComponents/DELViewMathsVector3D"],function(b,g,e,d,a,c){var f={colorToHex:function(k){if(k){if(k.substr&&k.substr(0,1)==="#"){return k}else{if(k.r!==undefined&&k.g!==undefined&&k.b!==undefined){if(k.r<0||k.g<0||k.b<0){return null}var m=Math.round((k.r*255)).toString(16);m=(m.length<2)?"0"+m:m;var l=Math.round((k.g*255)).toString(16);l=(l.length<2)?"0"+l:l;var q=Math.round((k.b*255)).toString(16);q=(q.length<2)?"0"+q:q;return"#"+m+l+q}else{var h=/(.*?)rgb\((\d+), *(\d+), *(\d+)\)/.exec(k);if(h){if(parseInt(h[2],10)===0&&parseInt(h[3],10)===0&&parseInt(h[4],10)===0){return"#000000"}else{var i=parseInt(h[2],10);var j=parseInt(h[3],10);var p=parseInt(h[4],10);var o=p|(j<<8)|(i<<16);var n=i===0?"00"+o.toString(16):o.toString(16);return"#"+n}}}}}return k},quaternionToAxisSystem:function(j){var h={};var i=new b.Matrix4().setRotationFromQuaternion(j.clone()).elements;h.X=new b.Vector3(i[0],i[1],i[2]);h.Y=new b.Vector3(i[4],i[5],i[6]);h.Z=new b.Vector3(i[8],i[9],i[10]);h.Origin=new b.Vector3(i[12],i[13],i[14]);return h},getWindowPositionFromPoint:function(o,h,l){var n=new b.Projector();var k=n.projectVector(h.clone(),o.viewpoints[0].getCamera());var m=Math.round((0-k.y)*(l.getContent().offsetHeight/2))+l.getContent().offsetHeight/2;var j=Math.round(k.x*(l.getContent().offsetWidth/2))+l.getContent().offsetWidth/2;var i=((m>0)&&(m<l.getContent().offsetWidth)&&(j>0)&&(j<l.getContent().offsetWidth));return{top:m,left:j,bottom:l.getContent().offsetHeight-m,right:l.getContent().offsetWidth-j,inWindow:i}},getPositionFromIntersection:function(o,m,k,j){var l=f.getWindowPositionFromPoint(o,m,j);var n=f.getLineFromWindowPosition(o,l.left,l.top);var h=f.getViewpointInfo(o.currentViewpoint);var i=f.computeLinePlaneDistance(n.position.toArray(),n.direction.toArray(),k.toArray(),h.sight.toArray());return new b.Vector3(i.aPosition[0],i.aPosition[1],i.aPosition[2])},getViewpointInfo:function(k){if(k){var j=new b.Matrix4().lookAt(new b.Vector3(),k.getSightDirection(),k.getUpDirection());var i=new b.Quaternion().setFromRotationMatrix(j);var h=f.quaternionToAxisSystem(i);return{position:k.getEyePosition(),sight:k.getSightDirection(),right:h.X,up:k.getUpDirection(),distance:k.getTargetDistance()}}},getLineFromWindowPosition:function(l,m,k){var i=new b.Vector3(((m-window.pageXOffset)/l.canvas.offsetWidth)*2-1,-((k-window.pageYOffset)/l.canvas.offsetHeight)*2+1,0.5);var j=new b.Projector();var h=j.pickingRay(i.clone(),l.currentViewpoint.camera);return{position:h.ray.origin.clone(),direction:h.ray.direction.clone()}},getViewerPositionFromPoint:function(n,h){var m=new b.Projector();var k=m.projectVector(h.clone(),n.viewpoints[0].getCamera());var l=Math.round((0-k.y)*(n.canvas.offsetHeight/2))+n.canvas.offsetHeight/2;var j=Math.round(k.x*(n.canvas.offsetWidth/2))+n.canvas.offsetWidth/2;var i=((l>0)&&(l<n.canvas.offsetHeight)&&(j>0)&&(j<n.canvas.offsetWidth));return{top:l,left:j,bottom:n.canvas.offsetHeight-l,right:n.canvas.offsetWidth-j,inWindow:i}},getMMPerPixelRatio:function(n,j){var i;var m=n.currentViewpoint;if(m.getProjectionType()===1){i=m.camera.top-m.camera.bottom}else{var o=m.getAngle()*Math.PI/180;var h=m.getEyePosition();var l=new b.Vector3().copy(j);var k=new b.Vector3().subVectors(l,h);i=2*Math.tan(0.5*o)*k.length()}return i/n.SCREEN_HEIGHT},convertPixelToModel:function(h){if(h.coords){return h.sizeInPixels*f.getMMPerPixelRatio(h.viewer,h.coords)}return h.sizeInPixels/(96/25.4)},convertModelToPixels:function(h){if(h.coords){return h.sizeInMM/f.getMMPerPixelRatio(h.viewer,h.coords)}return h.sizeInMM*(96/25.4)},getDashPattern:function(n,h,k){var j=n;j=parseFloat(j);if(!k){var m=new a();var l=m.getDashPattern?m.getDashPattern(j):m._getDashPattern(j);if(!isNaN(h)){for(var i=0;i<l.length;i++){l[i]*=h}}return l}else{return j}},computePointPlaneDistance:function(m,i,k){var h={};h.returnCode=1;if(m&&i&&k){var j=c.squaredLength(k);if(j>0.000001){h.returnCode=0;var l=c.dot(c.sub(m,i),k)/j;h.aPosition=c.multiplyAndAdd(k,l,m);h.distance=c.subAndLength(m,h.aPosition)}}return h},computeLinePlaneDistance:function(k,l,j,i){var q={};q.returnCode=1;if(k&&l&&j&&i){q.returnCode=0;var n=c.normalize(l);var h=c.normalize(i);var o=c.dot(n,h);if(Math.abs(o)<0.001){q.angle=0;var m=f.computePointPlaneDistance(k,j,h);if((m.returnCode===0)&&(m.distance<0.001)){q.aPosition=c.clone(k)}else{q.aPosition=m.aPosition}}else{q.angle=Math.asin(o);var p=c.dot(c.sub(k,j),h)/o;q.aPosition=c.multiplyAndAdd(n,p,k)}}return q},areEqual:function(l,k,h,p){var j=(p!==undefined)?p:0.001;var m=true;var o=(h!==undefined)?h:"float";switch(o){case"float":m=(Math.abs(l-k)<j);break;case"Vector3":m=(Math.abs(l.x-k.x)<j)&&(Math.abs(l.y-k.y)<j)&&(Math.abs(l.z-k.z)<j);break;case"Matrix4":for(var n=0;n<16&&m;n++){m=(Math.abs(l.elements[n]-k.elements[n])<j)}break;default:console.log("areEqual used with unknown type: "+o);break}return m},modifyLeaderNode:function(v,z,i,y,A,u,r,h,x,l,t,k){var s;var p={};p.vBreak=y.clone();p.vAttach=y.clone();if(i){p=f._computeNewPoints(v,y,A,u,t,k)}if(p.vBreak===null&&p.vAttach===null){return s}var w=f.getDashPattern(x,null,true);var j=2;var o={arrowWidth:r,headLength:Math.max(2*r+4,10),viewpoint:v.currentViewpoint,arrowDashType:w,arrowScale:j,color:h};var q=!f.areEqual(p.vBreak,A,"Vector3");var m=z.getChildByName("attach");if(!m){if(q){o.initialPoint=p.vBreak.clone();o.finalPoint=A.clone();o.head=l;m=new d(o);m.name="attach";m.setPickable(g.NOPICKABLE);z.add(m);s+="(redraw attach)"}}else{if(q){m.updateInitialPosition(p.vBreak);m.updateFinalPosition(A);m.updateColor(h);m.setArrowWidth(r);m.setHeadSize(Math.max(2*r+4,10));m.setHeadType(l);m.setArrowPattern(w);m.setArrowPatternScale(j);s+="(modify attach)"}else{z.remove(m);s+="(delete attach)"}}var B=q&&!f.areEqual(p.vBreak,p.vAttach,"Vector3");var n=z.getChildByName("step");if(!n){if(B){o.initialPoint=p.vBreak.clone();o.finalPoint=p.vAttach.clone();o.head=0;n=new d(o);n.name="step";n.setPickable(g.NOPICKABLE);z.add(n);s+="(redraw step)"}}else{if(B){n.updateInitialPosition(p.vBreak);n.updateFinalPosition(p.vAttach);n.updateColor(h);n.setArrowWidth(r);n.setHeadSize(Math.max(2*r+4,10));n.setHeadType(0);m.setArrowPattern(w);m.setArrowPatternScale(j);s+="(modify step)"}else{z.remove(n);s+="(delete step)"}}return s},_computeNewPoints:function(y,k,C,u,s,l){var A={};A.vBreak=k.clone();A.vAttach=k.clone();var v=105*(Math.PI/180);var q=15;var w;var j;if(s.offsetHeight){j=s.offsetHeight/2}else{if(s.style.pixelHeight){j=s.style.pixelHeight/2}}if(s.offsetWidth){w=s.offsetWidth/2}else{if(s.style.pixelWidth){w=s.style.pixelWidth/2}}var z=f.getWindowPositionFromPoint(y,k,l);var i=f.getWindowPositionFromPoint(y,C,l);var n=i.left-z.left;var h=i.top-z.top;var o=w+q;var r=(h>0)?f.AttachmentSide.BOTTOM:f.AttachmentSide.TOP;if(n>0){if(u&&u.width!==undefined){q=s.offsetWidth*u.width;o=w+q}if(n>o){var t=new b.Vector3(-o,0,0);var p=new b.Vector3(n-o,h,0);var x=t.angleTo(p);if(x>v){r=f.AttachmentSide.RIGHT}}}else{if(-n>o){if(u&&u.width!==undefined){q=s.offsetWidth*u.width;o=w+q}var t=new b.Vector3(o,0,0);var p=new b.Vector3(n+o,h,0);var x=t.angleTo(p);if(x>v){r=f.AttachmentSide.LEFT}}}if(n<0){n=-n}var h=i.top-z.top;if(h<0){h=-h}if(h<j&&n<w){A.vBreak=null;A.vAttach=null;return A}if((r===f.AttachmentSide.RIGHT)||(r===f.AttachmentSide.LEFT)){var m=w;if(r===f.AttachmentSide.LEFT){m=-m}A.vAttach=f._computeProjection(y,k,z.left+m,z.top);m=w+q;if(r===f.AttachmentSide.LEFT){m=-m}A.vBreak=f._computeProjection(y,k,z.left+m,z.top)}else{if((r===f.AttachmentSide.TOP)||(r===f.AttachmentSide.BOTTOM)){var B=j;if(r===f.AttachmentSide.TOP){B=-B}A.vAttach=f._computeProjection(y,k,z.left,z.top+B);if(u&&u.height!==undefined){q=s.offsetHeight*u.height;B=j+q;if(r===f.AttachmentSide.TOP){B=-B}A.vBreak=f._computeProjection(y,k,z.left,z.top+B)}else{A.vBreak=A.vAttach.clone()}}}return A},_computeProjection:function(m,l,j,k){var n=f.getViewpointInfo(m.currentViewpoint);var o=n.sight.negate();var i=f.getLineFromWindowPosition(m,j,k);var h=f.computeLinePlaneDistance(i.position.toArray(),i.direction.toArray(),l.toArray(),o.toArray());return new b.Vector3(h.aPosition[0],h.aPosition[1],h.aPosition[2])}};f.AttachmentSide={CENTER:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4};return f});define("DS/DELMOMViewComponents/DELAvpData",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/DELMOMViewComponents/DELAvpDataUtil"],function(f,c,d,b){var a=[{name:"bVisible",type:"bool",JSONname:"DELAVPProperties.GraphicProperties.visible",defaultValue:true},{name:"bHasALeader",type:"bool",JSONname:"DELAVPProperties.HasALeader",defaultValue:false},{name:"sLeaderEndType",type:"string",JSONname:"DELAVPProperties.LeaderEndType"},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"DELAVPProperties.LeaderBreakPoint3D",defaultValue:new d.Vector3()},{name:"bIsFilled",type:"bool",JSONname:"DELAVPProperties.filled",defaultValue:true},{name:"bHasBorder",type:"bool",JSONname:"DELAVPProperties.border",defaultValue:false},{name:"sImageSrc",type:"ImageURL",JSONname:"DELAVPProperties.imgData.imgSrc"},{name:"fImageBoxHeight",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxHeight"},{name:"fImageBoxWidth",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxWidth"},{name:"fImageHeight",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxHeight"},{name:"fImageWidth",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxWidth"},{name:"sAnchorMode",type:"string",JSONname:"DELAVPProperties.AnchorMode"},{name:"bZoomMode",type:"bool",JSONname:"DELAVPProperties.ZoomMode",defaultValue:false},{name:"fLeaderAttachHeightRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachHeightRatio"},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachHeightRatio"},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachWidthRatio"},{name:"fBoxRotationAngle",type:"float",JSONname:"DELAVPProperties.BoxRotationAngle"},{name:"fBorderRadius",type:"float",JSONname:"DELAVPProperties.BorderRadius"},{name:"cFillStyleColor",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.FillStyle.color",defaultValue:new d.Color("#ffffff")},{name:"fOpacity",type:"float",JSONname:"DELAVPProperties.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"fLineStyleThickness",type:"float",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"sLineStylePattern",type:"string",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"cLineStyleColor",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.color",defaultValue:new d.Color("#000000")},{name:"fLeaderStyleThickness",type:"float",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"sLeaderStylePattern",type:"string",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"cLeaderStyleColor",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.color",defaultValue:new d.Color("#000000")},{name:"lLeaders",type:"array",JSONname:"DELAVPProperties.Leaders",defaultValue:[]},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"DELAVPProperties.Leaders.0.AbsPointPoint3D",defaultValue:[]},{name:"vLeaderAbsPointPoint3D",type:"Vector3",JSONname:"DELAVPProperties.Leaders.0.AbsPointPoint3D",defaultValue:new d.Vector3()},{name:"sPointedReference",type:"string",JSONname:"DELAVPProperties.Leaders.0.PointedReference"},];var e=c.extend({init:function(i,h,g){this.json=h;this.externalLinks=g;this.dataObj=null;this.viewer=i;this._readJSON(h);return this},getViewer:function(){return this.viewer},getAttribute:function(g){if(f.is(g)&&f.is(this[g])){if(g==="lLeaderPointingPoints"){return this._getLeaderPointingPoints()}else{return this[g]}}else{console.log("getAttribute error name: "+g);return null}},getAvpDataObj:function(){if(!f.is(this.dataObj)){this._createDataObj()}return this.dataObj},setExternalLinks:function(g){this.externalLinks=g},_getLeaderPointingPoints:function(){var g=0;var h=[];var j=this.getAttribute("lLeaders");for(g;g<j.length;g+=1){h.push(b.strToType(j[g].AbsPointPoint3D,"Vector3"))}return h},_getPointedReferencePathElement:function(){var h=null;var j=this.getAttribute("sPointedReference");if(!f.is(j)){return null}var k=this.externalLinks.occurrences;var g=0;for(g;g<k.length;g+=1){if(k[g].id===j){return k[g].pathElement}}return h},_readJSON:function(h){this.sID=h.id;this.sName=h.Name;for(var g=0;g<a.length;g++){var l=a[g];if(f.is(l.JSONname)){var k=h;var j=l.JSONname.split(".");while(true){if(0===j.length){this[l.name]=b.strToType(k,l.type)}k=k[j.shift()];if(!f.is(k)){break}}}}},_createDataObj:function(){this.dataObj={pointedReference:this._getPointedReferencePathElement(),isVisible:this.getAttribute("bVisible"),hasALeader:this.getAttribute("bHasALeader"),leaderEndType:this.getAttribute("sLeaderEndType"),position:this.getAttribute("vLeaderBreakPoint3D"),isFilled:this.getAttribute("bIsFilled"),hasBorder:this.getAttribute("bHasBorder"),imageWidth:this.getAttribute("fImageBoxWidth"),imageHeight:this.getAttribute("fImageBoxHeight"),subViewImage:this.getAttribute("sImageSrc"),anchorMode:this.getAttribute("sAnchorMode"),zoomMode:this.getAttribute("bZoomMode"),leaderAttachWidthRatio:this.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:this.getAttribute("fLeaderAttachHeightRatio"),boxRotationAngle:this.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:this.getAttribute("fBorderRadius"),fillStyle:{color:this.getAttribute("cFillStyleColor"),opacity:this.getAttribute("fOpacity"),gradient:this.getAttribute("oGradient")},lineStyle:{thickness:this.getAttribute("fLineStyleThickness"),pattern:this.getAttribute("sLineStylePattern"),color:this.getAttribute("cLineStyleColor")},leaderStyle:{thickness:this.getAttribute("fLeaderStyleThickness"),pattern:this.getAttribute("sLeaderStylePattern"),color:this.getAttribute("cLeaderStyleColor")}}}}});return e});define("DS/DELMOMViewComponents/DELSubViewShapeGrid",["UWA/Core","UWA/Class","DS/DELMOMViewComponents/DELSubViewCell"],function(d,c,b){var a=c.extend({init:function(){var j=1,h=1;var i=[],q=[0],l=[0],f=[0];var p=d.createElement("canvas");p.width=1000;p.height=300;var t=new b();t.setCellIndex(0,0);i.push(t);var o=this;this.updateGrid=function(){for(var y=0;y<h;y++){var w=0;for(var x=0;x<j;x++){var v=o.getMarkUpCell(x,y);if(v){var D=m(v);if(w<D.width){w=D.width}}}r(y,w)}for(var x=0;x<j;x++){var C=0;var B=0;for(var y=0;y<h;y++){var v=o.getMarkUpCell(x,y);if(v){var D=m(v);C=Math.max(D.height,C);B=Math.max(D.charHeight,B)}}k(x,C);s(x,B)}var u=0;var z=0;for(var y=0;y<j;y++){var C=q[y];u=0;for(var x=0;x<h;x++){var w=l[x];var v=o.getMarkUpCell(y,x);if(v){var A={};A.x=u;A.y=z;v.setCellPos(A)}u+=w}z+=C}};this.getMarkUpCell=function(v,y){var x;if(i.length>0){for(var u=0;u<i.length;u++){var w=i[u].getCellIndex();if(w.row===v&&w.col===y){x=i[u];break}}}return x};this.getNbofRows=function(){return j};this.setNbofRows=function(x){if(x!==j){g()}if(x>j){var w=j;for(var v=0;v<h;v++){for(var u=w;u<x;u++){var y=new b();y.setCellIndex(u,v);i.push(y);q[u]=0;f[u]=0}}}j=x};this.getNbofColumns=function(){return h};this.setNbofColumns=function(y){if(y!==h){g()}if(y>h){var x=h;for(var v=x;v<y;v++){for(var u=0;u<j;u++){var w=new b();if(w){w.setCellIndex(u,v);i.push(w)}}l[v]=0}}h=y};this.getRowHt=function(u){return q[u]};this.getRowCharHt=function(u){return f[u]};this.getColWd=function(u){return l[u]};function k(v,u){q[v]=u}function s(v,u){f[v]=u}function r(v,u){l[v]=u}function e(u,z){var y=u.getImageData(0,0,p.width,p.height).data,A=false,x=false,w=p.height,B=0;var v=0;while(!x&&w){w--;for(B=0;B<z;B++){if(y[w*p.width*4+B*4+3]){x=w;break}}}w=-1;while(w<p.height&&!A){w++;for(B=0;B<z;B++){if(y[w*p.width*4+B*4+3]){A=w;break}}if(A&&x){v=x-A}}return v}function n(v){if(v&&v.length){for(var u=0;u<v.length;u++){if(v[u].length){return true}}}return false}function m(w){var x=w.getCellText();var A=x?x.getTextToDisplay():null;if(n(A)){var F=x.getFontSize();var v=x.getFontName()||"sans-serif";var y=x.getFontStyle()||"";var D=w.size===undefined;if(!D){D=F!==w.size.fontSize;D=D||JSON.stringify(A)!==w.size.textContent;D=D||y!==w.size.fontStyle;D=D||v!==w.size.fontName}if(D){w.size={};var C=y?y+" ":"";C+=F*window.devicePixelRatio+"px ";C+=v;w.size.fontHeight=0;w.size.width=0;var E=p.getContext("2d");E.font=C;var u="";for(var z=0;z<A.length;++z){u=A[z]?A[z]:"aA_{}";E.clearRect(0,0,p.width,p.height);E.fillText(u,0,p.height);var B=E.measureText(u).width;w.size.width=Math.max(B,w.size.width);w.size.fontHeight=Math.max(e(E,B),w.size.fontHeight)}w.size.paddingY=Math.floor(0.5*w.size.fontHeight);w.size.paddingX=Math.floor(0.5*w.size.fontHeight);w.size.width+=2*w.size.paddingX;w.size.height=(w.size.fontHeight+2*w.size.paddingY)*A.length;w.size.fontStyle=y;w.size.textContent=JSON.stringify(A);w.size.fontSize=F}}else{w.size={};w.size.width=w.getCellWd();w.size.height=w.getCellHt();w.size.fontHeight=0}return w.size}function g(){i=[];q=[0];f=[0];l=[0];j=1;h=1;var u=new b();u.setCellIndex(0,0);i.push(u)}}});return a});define("DS/DELMOMViewComponents/DELAvpServices",["UWA/Core","UWA/Class","DS/DELMOMViewComponents/DELAvpData"],function(d,a,b){var c=a.extend({init:function(g){var f=g.Model[0].WKIObjects;this.getSlideObject=function e(k){var l=null;var h=0;var j=null;for(h;h<f.length;h+=1){j=f[h];if(j.type==="View"&&j.proxiedSlideUuid===k){l=f[h];break}}return l};this.getAvpData=function(p,o){var h=[];var s=null;var k=null;var q=null;var r=null;var n=this.data;var m=0;var l=0;q=this.getSlideObject(p);if(!d.is(q)){return h}if(!d.is(q.subObjects)||q.length===0){return null}r=q.subObjects;for(m=0;m<r.length;m+=1){for(l=0;l<f.length;l+=1){if(f[l].type==="AssociativeViewPicture"&&r[m]===f[l].id){s=new b(o,f[l]);h.push(s)}}}return h}}});return c});define("DS/DELMOMViewComponents/DELSubViewShape",["UWA/Core","UWA/Class","DS/DELMOMViewComponents/DELSubViewShapeGrid","DS/DELMOMViewComponents/DELSubViewTools"],function(e,c,a,d){var b=c.extend({init:function(h){var i,f,g="center";this.getObject=function(){return h};this.getMarkUpGrid=function(){if(!i){i=new a()}return i};this.getShapePosition=function(){return f};this.getAnchorMode=function(){return g};this.setAnchorMode=function(j){g=j}},buildGrid:function(){var k=this.getMarkUpGrid();if(k){var p=1,h=1,l=null;var m=this.getObject();var f,g,i;if(m){l=m.getAttribute("sImageSrc");var j=0;k.setNbofRows(p);k.setNbofColumns(h);if(l){i=k.getMarkUpCell(0,0);if(i){i.setCellImage(l);j=m.getAttribute("fImageWidth");var q=m.getAttribute("fImageHeight");if(j&&q){var o=m.getAttribute("vLeaderBreakPoint3D");if(o){j=d.convertModelToPixels({sizeInMM:j,viewer:m.getViewer()})*window.devicePixelRatio;q=d.convertModelToPixels({sizeInMM:q,viewer:m.getViewer()})*window.devicePixelRatio}else{if(m.getAttribute("bProportionalPosition")){var n=m.getViewer().SCREEN_HEIGHT/2;j=j*n;q=q*n}}}else{j=l.naturalWidth;q=l.naturalHeight}i.setCellWd(j);i.setCellHt(q)}}}k.updateGrid()}}});return b});define("DS/DELMOMViewComponents/DELSubViewShapeNode",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/SceneGraphNodes/CanvasNode","DS/DELMOMViewComponents/DELSubViewTools"],function(e,f,h,g,c,j,d,a,i){var b=f.extend({init:function(A){this._parent();var D=A.window,t=D.getViewer();var E=this;var y=e.createElement("canvas");y.width=1000;y.height=300;var z=e.createElement("canvas");var n=e.createElement("canvas");var w,r;var q={};var o;var l,s=0;var C=new Image();var p={anchorMode:"center",isFilled:true,hasBorder:false,graphicProperties:{padding:5,borderRadius:8,horizontalAlignement:"center",fontStyle:{height:12,familyName:"sans-serif",familyStyle:"normal",color:new h.Color(0)},fillStyle:{color:new h.Color(16777215),opacity:1},lineStyle:{thickness:1,pattern:"1",color:new h.Color(4013373)}},isHighlighted:false};if(A.data){p=e.extend(p,A.data,true)}function G(K,L,M,J){var H;p.canvasNodeTexture=new d({width:K,height:L,webGLV6Viewer:t,drawCB:M,rectangleTexture:true,materialParams:{depthTest:false}});var I;if(l||s){switch(p.anchorMode){case"topleft":I=new h.Vector3(-J/2,-L+J/2,0);break;case"center":I=new h.Vector3(-K/2,-L/2,0);break}H=new a({bottomLeftcorner:I,widthVector:new h.Vector3(K,0,0),heightVector:new h.Vector3(0,L,0),canvasNodeTexture:p.canvasNodeTexture},g)}else{switch(p.anchorMode){case"topleft":I=new h.Vector2(J/2,L-J/2);break;case"center":I=new h.Vector2(K/2,L/2);break}H=g.createCanvas2DNode({hotspot:I,canvasNodeTexture:p.canvasNodeTexture})}H.rectangle.setRenderDepth(10);H.rectangle.excludeFromHighlight(true,true);return H}function k(H,M){var L=H.getImageData(0,0,y.width,y.height).data,N=false,K=false,J=y.height,O=0,I=0;while(!K&&J){J--;for(O=0;O<M;O++){if(L[J*y.width*4+O*4+3]){K=J;break}}}J=-1;while(J<y.height&&!N){J++;for(O=0;O<M;O++){if(L[J*y.width*4+O*4+3]){N=J;break}}if(N&&K){I=K-N}}return I}function F(){q={};var L=null,Q;if(p.delShape){L=p.delShape.getMarkUpGrid()}if(L){q.height=0;q.width=0;for(var N=0;N<L.getNbofRows();N++){q.height+=L.getRowHt(N)}if(isNaN(q.height)){q.height=1}for(var M=0;M<L.getNbofColumns();M++){q.width+=L.getColWd(M)}if(isNaN(q.width)){q.width=1}}else{if(p.content&&p.content.length){var P=p.graphicProperties.fontStyle.familyStyle?p.graphicProperties.fontStyle.familyStyle+" ":"";P+=p.graphicProperties.fontStyle.height*window.devicePixelRatio+"px ";P+=p.graphicProperties.fontStyle.familyName;q.fontHeight=0;q.width=0;q.fontHeightComment=0;var S=y.getContext("2d");S.font=P;var I="";var K=0;for(Q=0;Q<p.content.length;Q++){I=p.content[Q]?p.content[Q]:"aA_{}";S.clearRect(0,0,y.width,y.height);S.fillText(I,0,y.height);var O=S.measureText(I).width;q.width=Math.max(O,q.width);q.fontHeight=Math.max(k(S,O),q.fontHeight)}if(p.commentContent&&p.commentContent.length){K=p.commentContent.length;var H=p.graphicProperties.fontStyleComment.familyStyle?p.graphicProperties.fontStyleComment.familyStyle+" ":"";var R=p.graphicProperties.fontStyleComment.familyName?p.graphicProperties.fontStyleComment.familyName:"sans-serif";S.font=H+p.graphicProperties.fontStyleComment.height*window.devicePixelRatio+"px "+R;for(Q=0;Q<p.commentContent.length;Q++){I=p.commentContent[Q]?p.commentContent[Q]:"aA_{}";S.clearRect(0,0,y.width,y.height);S.fillText(I,0,y.height);var J=S.measureText(I).width;q.width=Math.max(J,q.width);q.fontHeightComment=Math.max(k(S,J),q.fontHeightComment)}}q.paddingY=Math.floor(0.5*q.fontHeight);q.paddingYComment=Math.floor(0.5*q.fontHeightComment);q.paddingBorder=Math.max(q.paddingY,q.paddingYComment);q.width+=2*q.paddingBorder;q.height=(q.fontHeight+2*q.paddingY)*p.content.length-q.paddingY;if(K){q.height+=(q.fontHeightComment+2*q.paddingYComment)*K-q.paddingYComment}else{q.height-=q.paddingY}q.height+=2*q.paddingBorder;if(isNaN(q.width)){q.width=1}}}q.width+=2*p.graphicProperties.padding;q.height+=2*p.graphicProperties.padding;q.widthInMM=i.convertPixelToModel({sizeInPixels:q.width,viewer:t});q.heightInMM=i.convertPixelToModel({sizeInPixels:q.height,viewer:t});q.width=Math.round(q.width);q.height=Math.round(q.height);q.widthInMM=Math.round(q.widthInMM);q.heightInMM=Math.round(q.heightInMM)}function v(L,J,I,M,K){var H=p.graphicProperties.borderRadius;L.beginPath();L.moveTo(J+H,I);L.lineTo(J+M-H,I);L.arc(J+M-H,I+H,H,1.5*Math.PI,2*Math.PI);L.lineTo(J+M,I+K-H);L.arc(J+M-H,I+K-H,H,0,0.5*Math.PI);L.lineTo(J+H,I+K);L.arc(J+H,I+K-H,H,0.5*Math.PI,Math.PI);L.lineTo(J,I+H);L.arc(J+H,I+H,H,Math.PI,1.5*Math.PI);L.closePath()}function m(J,O,H,N,K,M,I,L){J.save();J.translate(H+K/2,N+M/2);J.scale(I?-1:1,L?-1:1);J.drawImage(O,-K/2,-M/2,K,M);J.restore()}function B(ac,M,K,W){var an,al,ak,J,N;M.scale(1/W,1/W);var af=M.canvas.width/(l?i.convertModelToPixels({sizeInMM:q.widthInMM+o,viewer:t}):(q.width+o));var H=af*(q.width),I=af*(q.height);var ag=(M.canvas.width-H)/2,ad=(M.canvas.height-I)/2;if(p.isFilled){if(p.graphicProperties.fillStyle.gradient){var ah;if(p.graphicProperties.fillStyle.gradient.type==="leftToRight"){ah=M.createLinearGradient(ag,ad,M.canvas.width-ag,ad)}else{if(p.graphicProperties.fillStyle.gradient.type==="topToBottom"){ah=M.createLinearGradient(ag,ad,ag,M.canvas.height)}else{if(p.graphicProperties.fillStyle.gradient.type==="topLeftToBottomRight"){ah=M.createLinearGradient(ag,ad,M.canvas.width-ag,M.canvas.height)}else{if(p.graphicProperties.fillStyle.gradient.type==="bottomLeftToTopRight"){ah=M.createLinearGradient(ag,M.canvas.height,M.canvas.width-ag,ad)}}}}var U=Object.keys(p.graphicProperties.fillStyle.gradient.specs);for(var Y=0;Y<U.length;Y++){ah.addColorStop(parseFloat(U[Y]),p.graphicProperties.fillStyle.gradient.specs[U[Y]])}M.fillStyle=ah}else{M.fillStyle=i.colorToHex(p.graphicProperties.fillStyle.color);M.globalAlpha=p.graphicProperties.fillStyle.opacity}}else{M.globalAlpha=0}v(M,((M.canvas.width-H)/2),((M.canvas.height-I)/2),H,I);M.fill();M.globalAlpha=1;M.fillStyle=i.colorToHex(p.graphicProperties.fontStyle.color);var X=p.delShape?p.delShape.getMarkUpGrid():null;var O=function(ar){ar.target.hasBeenLoaded=true;ar.target.removeEventListener("load",O);ar.target.listenToLoadEvt=false;if(p&&p.canvasNodeTexture){p.canvasNodeTexture.requestRedraw();t.render()}};if(X){for(an=0;an<X.getNbofRows();an++){for(al=0;al<X.getNbofColumns();al++){N=X.getMarkUpCell(an,al);if(N){var ae=N.getCellPos();var R=N.getCellImageToDisplay();if(!R){R=N.getCellImage()}if(R){var L=af*N.getCellWd(),aj=af*N.getCellHt();if(af*X.getRowHt(an)<aj){aj=af*X.getRowHt(an)}if(af*X.getColWd(al)<L){L=af*X.getColWd(al)}var aq;if(!l&&R.width&&R.height&&(R.width!==L||R.height!==aj)&&(R.width>300||R.height>300)){var aa=false;if(L!==R.width||aj!==R.height){z.width=R.width;z.height=R.height;var S=z.getContext("2d");S.drawImage(R,0,0);aa=true}var Z=R;R=C;n.width=L;n.height=aj;n.getContext("2d").drawImage(aa?z:Z,0,0,n.width,n.height);aq=n.toDataURL("image/png");R.width=n.width;R.height=n.height;N.setCellImageToDisplay(R)}if(!R.hasBeenLoaded){if(R.listenToLoadEvt){R.removeEventListener("load",O);R.listenToLoadEvt=false}R.addEventListener("load",O);R.listenToLoadEvt=true;if(aq){R.src=aq}}m(M,R,ag+af*ae.x+(p.graphicProperties.horizontalAlignement==="center"?((M.canvas.width-2*ag)-L)/2:0),ad+af*ae.y,L,aj,p.imageInvertH,p.imageInvertV)}else{J=N.getCellText();var ap=J?J.getTextToDisplay():null;if(ap&&ap.length){var ai=J.getFontStyle()?J.getFontStyle()+" ":"";var P=J.getFontName()?J.getFontName():"sans-serif";M.font=ai+af*J.getFontSize()*window.devicePixelRatio+"px "+P;var Q=af*p.graphicProperties.padding;for(ak=0;ak<ap.length;++ak){M.fillText(ap[ak],ag+af*(p.graphicProperties.padding+N.size.paddingX+ae.x),ad+Q+af*(N.size.paddingY+N.size.fontHeight+ae.y));Q+=af*(2*N.size.paddingY+N.size.fontHeight)}}}}}}}else{if(p.content&&p.content.length){var am=p.graphicProperties.fontStyle.familyStyle?p.graphicProperties.fontStyle.familyStyle+" ":"";var T=p.graphicProperties.fontStyle.familyName?p.graphicProperties.fontStyle.familyName:"sans-serif";M.font=am+p.graphicProperties.fontStyle.height*window.devicePixelRatio+"px "+T;var V=af*p.graphicProperties.padding;for(ak=0;ak<p.content.length;++ak){M.fillText(p.content[ak],ag+af*(p.graphicProperties.padding+q.paddingBorder),ad+V+af*((ak===0?q.paddingBorder:q.paddingY)+q.fontHeight));V+=af*((ak===0?(q.paddingBorder+q.paddingY):(2*q.paddingY))+q.fontHeight)}if(p.commentContent&&p.commentContent.length){var ab=p.graphicProperties.fontStyleComment.familyStyle?p.graphicProperties.fontStyleComment.familyStyle+" ":"";var ao=p.graphicProperties.fontStyleComment.familyName?p.graphicProperties.fontStyleComment.familyName:"sans-serif";M.font=ab+p.graphicProperties.fontStyleComment.height*window.devicePixelRatio+"px "+ao;for(ak=0;ak<p.commentContent.length;++ak){M.fillText(p.commentContent[ak],ag+af*(p.graphicProperties.padding+q.paddingBorder),ad+V+af*(q.paddingYComment+q.fontHeightComment));V+=af*(2*q.paddingYComment+q.fontHeightComment)}}}}if(!p.hasBorder&&p.inEdition){M.strokeStyle="#00C8FF";M.lineWidth=Math.max(p.graphicProperties.lineStyle.thickness,4);M.stroke()}else{if(p.hasBorder){if(!p.inEdition){M.strokeStyle=i.colorToHex(p.graphicProperties.lineStyle.color?p.graphicProperties.lineStyle.color:i.colorToHex(new h.Color(12775156)));M.lineWidth=p.graphicProperties.lineStyle.thickness}else{M.strokeStyle="#00C8FF";M.lineWidth=Math.max(p.graphicProperties.lineStyle.thickness,4)}if(p.graphicProperties.lineStyle.pattern){M.setLineDash(i.getDashPattern(p.graphicProperties.lineStyle.pattern,2))}M.stroke()}}t.render()}function x(H){var O=function(Q,P){if(P!==undefined&&Q!==undefined){return JSON.stringify(P)===JSON.stringify(Q)}return true};var L=Object.keys(H);for(var I=0;I<L.length;I++){if(L[I]!=="graphicProperties"&&L[I]!=="breakPoint2D"&&L[I]!=="position"&&L[I]!=="pointingPoints"){if(L[I]==="subViewImage"){if(p[L[I]]&&!H[L[I]]||!p[L[I]]&&H[L[I]]){return false}if(p[L[I]].src!==H[L[I]].src||p[L[I]].width!==H[L[I]].width||p[L[I]].height!==H[L[I]].height){return false}}else{if(!O(p[L[I]],H[L[I]])){return false}}}else{if(L[I]==="graphicProperties"){var N=Object.keys(H[L[I]]);for(var K=0;K<N.length;K++){if(N[K]==="fontStyle"||N[K]==="fillStyle"||N[K]==="lineStyle"){var J=Object.keys(H[L[I]][N[K]]);for(var M=0;M<J.length;M++){if(!O(p[L[I]][N[K]][J[M]],H[L[I]][N[K]][J[M]])){return false}}}else{if(!O(p[L[I]][N[K]],H[L[I]][N[K]])){return false}}}}}}return true}function u(I){var H=function(P){if(P!==null&&P!==undefined){return P.clone?P.clone():P}return P};var M=Object.keys(I);for(var J=0;J<M.length;J++){if(M[J]!=="graphicProperties"){p[M[J]]=H(I[M[J]])}else{var O=Object.keys(I[M[J]]);for(var L=0;L<O.length;L++){if(O[L]==="fontStyle"||O[L]==="fillStyle"||O[L]==="lineStyle"){var K=Object.keys(I[M[J]][O[L]]);for(var N=0;N<K.length;N++){p[M[J]][O[L]][K[N]]=H(I[M[J]][O[L]][K[N]])}}else{p[M[J]][O[L]]=H(I[M[J]][O[L]])}}}}}this.modify=function(J){if(J.position){p.position=J.position.clone();E.setMatrix(new h.Matrix4().setPosition(p.position))}if(!x(J)||!w){var I=false;if(p.subViewImage&&!J.subViewImage||!p.subViewImage&&J.subViewImage||p.subViewImage&&J.subViewImage&&(p.subViewImage.src!==J.subViewImage.src||p.subViewImage.width!==J.subViewImage.width||p.subViewImage.height!==J.subViewImage.height)){I=true}if((typeof J.imageWidth==="number"&&typeof p.imageWidth==="number"&&J.imageWidth!==p.imageWidth)||(typeof J.imageHeight==="number"&&typeof p.imageHeight==="number"&&J.imageHeight!==p.imageHeight)||I||J.imageInvertH!==p.imageInvertH||J.imageInvertV!==p.imageInvertV||s!==p.boxRotationAngle){var H=p.delShape?p.delShape.getMarkUpGrid():null;if(H){for(var K=0;K<H.getNbofRows();K++){for(var L=0;L<H.getNbofColumns();L++){if(H.getMarkUpCell(K,L)){H.getMarkUpCell(K,L).removeCellImageToDisplay();C.src="";C.width=1;C.height=1;C.hasBeenLoaded=false}}}}}u(J);if(p.delShape){p.delShape.buildGrid()}F();if((l!==p.zoomMode||s!==p.boxRotationAngle)&&r){E.removeChildren();r=null}if(r){r.removeChildren()}else{l=p.zoomMode;s=p.boxRotationAngle?p.boxRotationAngle:0;if(l){r=new c({type:"Spherical"});E.addChild(r)}else{if(s){var N=new c({type:"Spherical"});E.addChild(N);var M=new j({ratio:1});N.addChild(M);r=new f();M.addChild(r)}else{r=E}}}o=l?3:8;w=G((l?q.widthInMM:q.width)+o,(l?q.heightInMM:q.height)+o,B,o);r.addChild(w);if(s){r.setMatrix(new h.Matrix4().makeRotationAxis(new h.Vector3(0,0,1),s))}}};this.getDimensions=function(){return{offsetWidth:q.widthInMM>0?q.widthInMM:1,offsetHeight:q.heightInMM>0?q.heightInMM:1}};this._cleanNode=function(){E.stopEdition();E=p=D=y=r=z=n=null}},remove:function(){this._cleanNode()}});return b});define("DS/DELMOMViewComponents/DELSubViewNode3D",["UWA/Core","DS/CoreEvents/Events","DS/Visualization/Node3D","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/ThreeJS_DS","DS/DELMOMViewComponents/DELSubViewShapeNode","DS/DELMOMViewComponents/DELSubViewTools","DS/Manipulators/PointHandle","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/DELMOMViewComponents/DELSubViewShape"],function(e,d,g,h,i,a,j,l,c,b,k){var f=g.extend({init:function(n,w,v){this._parent(n);var u=this,s;var o=null;var t=new a({window:v,data:{delShape:new k(n),graphicProperties:{padding:0}}});this.addChild(t);t.setPickParent(true);this.setName(n.getAttribute("sName"));this.setNoZ(true);var x=new g();this.addChild(x);x.setPickParent(true);function m(B,y){var C=function(H){if(H!==null&&H!==undefined){return H.clone?H.clone():H}return H};var G=Object.keys(y);for(var F=0;F<G.length;F++){if(G[F]!=="graphicProperties"){B[G[F]]=C(y[G[F]])}else{var A=Object.keys(y[G[F]]);for(var D=0;D<A.length;D++){if(A[D]==="fontStyle"||A[D]==="fillStyle"||A[D]==="fillStyle"){var E=Object.keys(y[G[F]][A[D]]);for(var z=0;z<E.length;z++){B[G[F]][A[D]][E[z]]=C(y[G[F]][A[D]][E[z]])}}else{B[G[F]][A[D]]=C(y[G[F]][A[D]])}}}}return B}function r(z){if(!z||!w){return true}var y=w.getSceneGraphOverrideSetManager();var A=y?y.getCurrentVisibility(z):true;A=A===null||A===undefined?true:A;return A}function q(){if(!s.hasALeader){x.setVisibility(false);x.setVisibilityFree(true);return}x.setVisibility(true);x.setVisibilityFree(false);if((w.getVisibleSpace()===0&&s.isVisible===false)||(w.getVisibleSpace()===1&&s.isVisible===true)){var z=0;switch(n.getAttribute("sLeaderEndType")){case"Arrow":z=1;break;case"Bubble":z=2;break}var L=t.getDimensions();if(L.offsetWidth>0&&L.offsetHeight>0){var J=s.position.clone();var H={offsetWidth:j.convertModelToPixels({sizeInMM:L.offsetWidth,viewer:w,coords:s.zoomMode?J:null}),offsetHeight:j.convertModelToPixels({sizeInMM:L.offsetHeight,viewer:w,coords:s.zoomMode?J:null})};H.offsetWidth/=window.devicePixelRatio;H.offsetHeight/=window.devicePixelRatio;if(s.anchorMode==="topleft"){if(s.zoomMode){var I=w.currentViewpoint.getUpDirection().clone();var B=new i.Vector3().crossVectors(w.currentViewpoint.getSightDirection(),I).setLength(L.offsetWidth/2);I.setLength(-L.offsetHeight/2);J.add(I);J.add(B)}else{var N=j.getViewerPositionFromPoint(w,J);if(!isNaN(N.left)&&!isNaN(N.top)){var F=new i.Vector2(N.left+H.offsetWidth/2,N.top+H.offsetHeight/2);var A=j.getLineFromWindowPosition(w,F.x,F.y);var E=j.getViewpointInfo(w.currentViewpoint);var K=j.computeLinePlaneDistance(A.position.toArray(),A.direction.toArray(),s.position.toArray(),E.sight.toArray());J=new i.Vector3(K.aPosition[0],K.aPosition[1],K.aPosition[2])}}}var O=n.getAttribute("lLeaderPointingPoints");var y;if(O!==undefined&&O.length){var D=x.getChildren();for(var G=0;G<O.length;G++){y=D[G];if(!y){y=new g("DELSubViewLeaderNode");y.setPickParent(true);x.addChild(y)}var C={width:n.getAttribute("fLeaderAttachWidthRatio"),height:n.getAttribute("fLeaderAttachLengthRatio")};j.modifyLeaderNode(w,y,true,J,O[G],C,s.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,s.graphicProperties.leaderStyle.color,s.graphicProperties.leaderStyle.pattern,z,H,v)}D=x.getChildren();if(O.length<D.length){for(var M=D.length-1;M>=O.length;M--){x.removeChild(D[M])}}}}}}this.remove=function(){if(t){t.remove()}x=t=u=null};this.getPixelFontSize=function(){return j.convertModelToPixels({sizeInMM:n.getAttribute("fFontSize"),viewer:w})};this.update=function(z){if(!u){return}s=s?m(s,z):z;o=true;var y=true;if(e.is(s.pointedReference)){y=r(s.pointedReference);if(!y){s.hasALeader=false}}t.modify(s);q();u.setVisibility(s.isVisible&&o);w.render()};this.onViewerEventCB=function(y){if(y.eventType==="@onWindowResized"||y.eventType==="@onViewpointChange"||y.eventType==="onSwapVisibleSpace"){q();w.render()}else{if(y.eventType==="onHideShow"&&s.pointedReferences){o=r(s.pointedReference);u.setVisibility(s.isVisible&&o);w.render()}}};var p={};p.onVISUEvents=d.subscribe({event:"/VISU/"},this.onViewerEventCB)}});return f});define("DS/DELMOMViewComponents/DELSlidesController",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/DELMOMViewComponents/DELBasePanel","DS/DELMOMViewComponents/DELBaseThumbnail","DS/Selection/CSOManager","DS/DMUExperienceAPI/DMUWebDesignReviewSlideServices","DS/DELMOMViewComponents/DELAvpServices","DS/Visualization/Node3D","DS/DELMOMViewComponents/DELSubViewNode3D"],function(e,a,b,i,k,c,j,f,h,g){var d=a.extend({init:function(v){this._parent(v);var t=v||{};var M=this;var l={};var H={};var O=[];var B=[];var I=t.frameWindow,G=t.context,J=false,z=true;var D=null;var u=b.getWebappsAssetUrl("DELMOMViewComponents","icons/32/")+"I_WebSlide.png";var E=null,n=null,x=null,A=null,q=null;var R=t.beforeApplySlideCB,L=t.afterApplySlideCB;this.displayPanel=function(S,T){F(S,T)};this.addSlide=function(S,U){var T;if(!e.is(S)){return}for(T=0;T<O.length;T+=1){if(O[T].slide===S){return}}p({slide:S,id:"slide"+S.id,avpData:U})};this.clean=function(){O.forEach(function(S){if(e.is(S.thumbnail)){S.thumbnail.clear()}});if(e.is(x)){x.setPanelVisibilityFlag(false);x.clean()}P();O=x=O=R=L=q=n=null};this.getVisibleFlag=function(){return z};this.getActiveSlide=function(){return q};this.setActiveSlide=function(S){K(S)};this.removeDisplayPanel=function(){O.forEach(function(S){if(e.is(S.thumbnail)){S.thumbnail.clear()}});x.clean();O=null;x=null};function Q(X){var V=[];var W=null;var T=null;var U=0;var S=0;W=X.Model[0].WKIObjects;for(U=0;U<W.length;U+=1){if(e.is(W[U].entities)){V=W[U];return V}}return V}function y(T,V){var U=0;if(T.inWork){return false}if(!e.is(V)){return true}var S=V.Model[0].WKIObjects;for(U=0;U<S.length;U+=1){if(S[U].type==="View"){if(S[U].proxiedSlideUuid===T.uuid){return true}}}return false}function F(S,X){if(!x){n=e.createElement("div",{id:"DMUSlidePanelThumbMainDiv"});var U,Z=302;var T=C();U=A!==undefined?A:T;U=U>=T?U:T;var Y={id:"DELSlidesPanel",className:"DMUSlidesPanel",title:t.thumbnailListTitle,showTitleFlag:true,icon:u,immersiveFrame:I.getImmersiveFrame(),content:n,minWidth:T,width:U,widthStep:165,minHeight:Z,height:Z,heightStep:124,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,currentDockArea:WUXDockAreaEnum.LeftDockArea,onPanelResizedCB:function(ab){}};x=new i(Y);if(e.is(X)){H=Q(X)}else{H=null}if(e.is(S)&&S.length>0){var V,W;for(V=0;V<S.length;V+=1){W=S[V];W.id=V+1;if(!y(S[V],X)){continue}M.addSlide(W,X)}var aa={data:S[0],id:"slide"+S[0].id};M.setActiveSlide(aa)}}}function s(T,V){var S=null;var U=new f(V);S=U.getAvpData(T,G);l[T]=S}function p(U){var S=U.slide;var T={id:U.id,displayType:k.THUMBNAIL,data:S,preview:S.preview,title:S.name,displayFlag:false,isCheckable:false,checkFlag:false,clickCB:o};var V=new k(T);V.inject(n);U.thumbnail=V;O.push(U);if(e.is(U.avpData)){s(U.slide.uuid,U.avpData)}}function r(T){for(var S=0;S<O.length;S++){if(e.is(O[S].thumbnail)){if(O[S].id===T){return O[S].thumbnail}}}return undefined}function P(W,S){var U=G.getViewer().getRootNode().getChildByName("AVPNodeBag");var T=U.children.length;var V;for(T;T>-1;T-=1){V=U.children[T];U.removeChild(V)}if(e.is(W)){setTimeout(function(){W(S)},100)}}function m(){var T=0;var U=[];var S=G.getViewer().getRootNode().getChildByName("AVPNodeBag");var W=S.children.length;var V=null;for(T;T<W;T+=1){V=S.children[T];U.push(V)}return U}function N(V){var T=0;var S=G.getViewer().getRootNode().getChildByName("AVPNodeBag");var U=V.length;var W;for(T;T<U;T+=1){S.removeChild(V[T])}}function w(W){var V=0;var S=l[W];var X=[];var T=function T(aa){var Y=0;var Z=null;if(e.is(aa)&&S.length>0){for(Y;Y<aa.length;Y+=1){aa[Y].setExternalLinks(H);Z=new g(aa[Y],G.getViewer(),I);Z.update(aa[Y].getAvpDataObj());U.addChild(Z)}}};var U=G.getViewer().getRootNode().getChildByName("AVPNodeBag");if(e.is(U)){X=m()}else{U=new h("AVPNodeBag");G.getViewer().getRootNode().addChild(U)}T(S);N(X)}function K(U){var S=0;var T={slide:null};var V=null;if(e.is(U)&&U.id){var W=r(U.id);if(e.is(W)){W.setDisplayFlag(true)}for(S=0;S<O.length;S++){if(O[S].isActiveSlide){T=O[S]}if(O[S].id===U.id){O[S].isActiveSlide=true;if(!U.doNotSendCB){V=O[S]}}else{O[S].isActiveSlide=false;if(e.is(O[S].thumbnail)){O[S].thumbnail.setDisplayFlag(false)}}}c.empty();R(T.slide,V.slide);V.slide.context=G;j.applySlide(V.slide);w(V.slide.uuid);L(T.slide,V.slide);q=V.slide}}function C(){return 188}function o(S){K(S)}}});return d});define("DS/DELMOMViewComponents/DELDmuImporterAPI",["UWA/Core","UWA/Class","DS/DELMOMViewComponents/DELSlidesController","DS/DMUExperienceAPI/DMUWebDesignReviewSlideServices","DS/DMUExperienceAPI/DMUExperienceImporterAPI","DS/DELMOMViewComponents/DELAvpData"],function(g,b,d,a,f,e){var c=b.extend({init:function(j){var h=j?j.context:null;var i=null;var l={context:j.context,frameWindow:j.frameWindow,bDisplayNominal:false,bDisplayInWork:false,thumbnailListTitle:"",activateSlide:false,displayDMUSlidePanel:false,beforeApplySlideCB:null,afterApplySlideCB:null,bThumbnailsList:false};var k=new f(l);this.importModel=function(n){if(!g.is(n)||!g.is(n.json||!g.is(n.json.Model))){return}this.removeModel();var m=function m(){var p=[];var q=0;var o=null;n.json.context=h;p=a.getSlidesDefinition(n.json);if(p.length>0){i=new d(j);i.displayPanel(p,n.avpJson)}};n.onModelLoadedCB=m;k.importModel(n)};this.removeModel=function(){if(g.is(k)){k.removeModel()}if(g.is(i)){i.clean()}}}});return c});