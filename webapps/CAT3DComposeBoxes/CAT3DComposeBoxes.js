/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CAT3DComposeBoxes/CAT3DComposeBoxController",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/CAT3DComposeMoveManager/CAT3DComposeMoveManager","DS/CAT3DComposeMoveManager/CATC3DMoveReferent","DS/CoreEvents/Events","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(a,i,e,c,g,d,b){var j=a.extend({init:function(K){var l=K||{};this._parent(l);var s=50;var x=this;var F=[];var H;var u=[];var z=l.ctxViewer;var t=false,p=true;var A=null;var m=null;var I=null;var C,L;var E;var y=function(M){return b.isPLMNode(M)};var G=function(S){if(F.length===1){A=S.pathElement;var O=z.getFrameWindow().getContextualUIManager();O.hideContextualMenus();if(A){var R=[];if(y(A.getLastElement(true))&&y(A.getParentPath().getLastElement(true))){R.push({name:"CAT3DComposeBoxesLevelSelectorStr",line:1,hdr_list:["LevelSelectorHdr"]})}var N=false;var M=e.get();for(var P=0;P<M.length;P++){var Q=M[P].pathElement;Q=I.getMoveReferent(Q);var T=Q.getMatrix();if(T.elements[0]!==1||T.elements[5]!==1||T.elements[10]!==1||T.elements[15]!==1||T.elements[1]!==0||T.elements[2]!==0||T.elements[3]!==0||T.elements[4]!==0||T.elements[6]!==0||T.elements[7]!==0||T.elements[8]!==0||T.elements[9]!==0||T.elements[11]!==0||T.elements[12]!==0||T.elements[13]!==0||T.elements[14]!==0){N=true;break}}if(N){R.push({name:"CAT3DComposeBoxesIdentityPositionStr",line:1,hdr_list:["CAT3DComposeSetIdentityPositionHdr"]})}if(R.length>0){O.showContextualBar({hideWithDistance:true,fillingList:[{onContextualBarReady:function(){return{cmdList:R}},context:z.getCommandContext?z.getCommandContext():null,workbenchName:"CAT3DComposeWidgetWkb",module:"CAT3DComposeWidget",cmdPrefix:""}]})}}}};var o=function(){for(var M=0;M<F.length;M++){F[M].setVisibleFlag(false)}z.getViewer().render()};var r=function(){for(var M=0;M<F.length;M++){F[M].setVisibleFlag(true)}z.getViewer().render()};var B=function(N){if(!C){require(["DS/CAT3DComposeBoxes/CAT3DComposeBoxManipulator"],function(ac){C=ac;if(p&&t){var aa=e.get();for(var ab=0;ab<aa.length;ab++){L(aa[ab].pathElement)}}})}else{var U=z.getViewer(),P=U.getVisibleSpace(),R=N.getBoundingBox(null,U,P?"visibleSpace":"invisibleSpace");if(R&&!R.isNaN()){var S=N.getWorldMatrix(U);var X=new i.Vector3(R.min.x,R.min.y,R.min.z);var O=new i.Vector3(R.max.x,R.min.y,R.min.z);var Q=new i.Vector3(R.min.x,R.max.y,R.min.z);var Y=new i.Vector3(R.min.x,R.min.y,R.max.z);var V=new i.Vector3(O.x-X.x,O.y-X.y,O.z-X.z);var M=new i.Vector3(Q.x-X.x,Q.y-X.y,Q.z-X.z);var W=new i.Vector3(Y.x-X.x,Y.y-X.y,Y.z-X.z);var T=new C({pathElement:N,edgeMaterial:E,cornerPoint:X,fstAxis:V,sndAxis:M,thdAxis:W,matrix:S,rootBagPath:z.getRootBagPath().clone(),viewer:U});T.show();F.push(T);var Z={};Z.onClick=T.subscribe("onBoxClick",G);Z.onBeginManipulate=T.subscribe("onBoxBeginManipulate",o);Z.onEndManipulate=T.subscribe("onBoxEndManipulate",r);H.boxTokens.push(Z)}}};L=function(O){if(F.length<s){var N=O?I.getMoveReferent(O):null;var M=!N?true:F.some(function(P){return N.isEqual(P.getAssociatedPath())});if(!M){B(N)}}};var q=function(M){if(t){L(M.pathElement)}};var n=function(N,S){if(S&&t){x.refreshBoxes()}else{if(!S){u=[];if(F.length&&N&&Array.isArray(N)){var M=[];for(var P=0;P<N.length;P++){var R=N[P];R=I.getMoveReferent(R);for(var Q=0;Q<F.length;Q++){var O=F[Q].getAssociatedPath();if(R.isAParentOf(O)&&M.indexOf(Q)===-1){F[Q].setVisibleFlag(false);M.push(Q);u.push(O)}}}}}}};var v=function(N){var M=function(P,O){return P-O};N.sort(M)};var J=function(M){if(H&&H.boxTokens&&H.boxTokens[M]){F[M].unsubscribe(H.boxTokens[M].onClick);F[M].unsubscribe(H.boxTokens[M].onBeginManipulate);F[M].unsubscribe(H.boxTokens[M].onEndManipulate);H.boxTokens.splice(M,1)}F[M].hide();F.splice(M,1)};var w=function(T){if(t&&F&&F.length!==0){var M=[],P,S;if(!T){var N=e.get();for(P=0;P<F.length;P++){var R=true;for(var Q=0;Q<N.length;Q++){S=N[Q].pathElement;S=I.getMoveReferent(S);if(S&&S.isEqual(F[P].getAssociatedPath())){R=false;break}}if(R){M.push(P)}}}else{for(P=0;P<F.length;P++){S=I.getMoveReferent(T.pathElement);if(S&&S.isEqual(F[P].getAssociatedPath())){M.push(P);break}}}v(M);for(var O=M.length-1;O>=0;O--){J(M[O])}}};var D=function(){if(!H){H={boxTokens:[]};m=c.getMoveManager({context:z});I=g.getMoveReferentManager({context:z});H.onAdd=e.onAdd(q);H.onRemove=e.onRemove(w);H.onEmpty=e.onEmpty(w);H.Move=m.subscribe("Move",function(N){if(t){var O=[];N.objectsMoved.forEach(function(P){if(P.path){O.push(P.path)}});if(O.length){n(O,false)}}});H.MoveEnd=m.subscribe("MoveEnd",function(){if(t){for(var P=0;P<u.length;P++){var N=true;for(var Q=0;Q<F.length;Q++){if(u[P].isEqual(F[Q].getAssociatedPath())){N=false;if(!F[Q].getVisibleFlag()){var O=F[Q].getAssociatedPath().getWorldMatrix(z.getViewer());F[Q].setMatrix(O);F[Q].setVisibleFlag(true);z.getViewer().render()}}}if(N){B(u[P])}}u=[]}});H.onRootRemoved=z.subscribe({event:"onRootRemoved"},function(N){if(t){n([N.path],true)}});H.onRootDetached=z.subscribe({event:"onRootDetached"},function(N){if(t){n([N.path],true)}});H.onHide=z.subscribe({event:"onHide"},function(N){if(t){n(N.paths,true)}});H.onShow=z.subscribe({event:"onShow"},x.refreshBoxes);H.onEndMatriceUpdate=z.subscribe({event:"onEndMatriceUpdate"},x.refreshBoxes);H.swapVisibleSpace=z.getViewer()&&z.getViewer().onSwapVisibleSpace?z.getViewer().onSwapVisibleSpace(x.refreshBoxes):null;var M=false;H.VISU=d.subscribe({event:"/VISU/"},function(O){var N;if(t&&F.length){if(O.eventType==="@onViewpointBeginMove"){M=true}else{if(O.eventType==="@onViewpointChange"){if(M){for(N=0;N<F.length;N++){F[N].setVisibleFlag(false)}z.getViewer().render();M=false}}else{if(O.eventType==="@onViewpointEndMove"){for(N=0;N<F.length;N++){F[N].setVisibleFlag(true)}z.getViewer().render();M=false}}}}})}};var k=function(){if(H){if(H.VISU){d.unsubscribe(H.VISU)}if(H.onShow){z.unsubscribe(H.onShow)}if(H.onHide){z.unsubscribe(H.onHide)}if(H.onRootDetached){z.unsubscribe(H.onRootDetached)}if(H.onRootRemoved){z.unsubscribe(H.onRootRemoved)}if(H.onEndMatriceUpdate){z.unsubscribe(H.onEndMatriceUpdate)}if(H.MoveEnd){m.unsubscribe(H.MoveEnd)}if(H.Move){m.unsubscribe(H.Move)}if(H.onAdd){e.unsubscribe(H.onAdd)}if(H.onRemove){e.unsubscribe(H.onRemove)}if(H.onEmpty){e.unsubscribe(H.onEmpty)}if(H.swapVisibleSpace&&z.getViewer()){z.getViewer().unsubscribe(H.swapVisibleSpace)}for(var M=F.length-1;M>=0;M--){J(M)}u=[];H=null}};this.setActiveState=function(O){if(t===O){return}t=O;if(p){if(t){D();if(!E){E=new i.LineBasicMaterial({color:16744990,opacity:1})}var M=e.get();for(var N=0;N<M.length;N++){L(M[N].pathElement)}}else{k();E=null}}};this.displayBoxes=function(O){if(p===O){return}p=O;if(p&&t){D();var M=e.get();for(var N=0;N<M.length;N++){L(M[N].pathElement)}}else{k()}};this.getDisplayState=function(){return p};this.clearController=function(){this.setActiveState(false);this.displayBoxes(false);F=H=u=z=m=I=A=x=null};this.refreshBoxes=function(){var N;if(p&&t){for(N=F.length-1;N>=0;N--){J(N)}var M=e.get();for(N=0;N<M.length;N++){L(M[N].pathElement)}}}}});var f=[];var h=a.singleton({init:function(){},getBoxController:function(m){var n;if(m&&m.context){for(var k=0;k<f.length;k++){if(f[k].context===m.context){n=f[k].boxController;break}}if(!n){var l=new j({ctxViewer:m.context});f.push({context:m.context,boxController:l});n=l}}return n},unregisterBoxController:function(l){if(l&&l.context){for(var k=0;k<f.length;k++){if(f[k].context===l.context){f[k].boxController.clearController();f.splice(k,1);break}}}}});return h});define("DS/CAT3DComposeBoxes/CAT3DComposeBoxManipulator",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/ModelEvents","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Manipulators/Manipulator","DS/CAT3DComposeUtils/CAT3DComposeAnimation","DS/SceneGraphOverrides/SceneGraphOverrideSet"],function(a,k,g,c,d,j,b,i,f){var h=0.001;var l=b.extend({init:function(n){var m=n||{};this._parent(m);this._manipulation=0;this.setExclusive(true)},PrimaryPointerClick:function(n,m,p){this._parent(n,m,p);var o={element:n,event:m,intersection:p};this.publish("BoxClick",o)},BeginManipulate:function(n,m,o){this._parent(n,m,o);this._manipulation=0},Manipulate:function(n,m,p){this._parent(n,m,p);this._manipulation++;if(this._manipulation===3){var o={element:n,event:m,intersection:p};this.publish("BoxBeginManipulate",o)}},EndManipulate:function(n,m,p){this._parent(n,m,p);if(this._manipulation>3){var o={element:n,event:m,intersection:p};this.publish("BoxEndManipulate",o)}},BeginPreactivate:function(n,m,p){this._parent(n,m,p);var o={element:n,event:m,intersection:p};this.publish("BoxBeginPreactivate",o)},EndPreactivate:function(n,m,p){this._parent(n,m,p);var o={element:n,event:m,intersection:p};this.publish("BoxEndPreactivate",o)}});var e=a.extend({init:function(af){var E=af||{};this._parent(E);var M=E.fstAxis,u=M.length();var D=E.sndAxis,C=D.length();var v=E.thdAxis,y=v.length();var r=E.cornerPoint;var ai=E.pathElement;var V=E.matrix||new k.Matrix4();var X=E.rootBagPath;var aa=E.viewer;var N=new g();N.name="boxManipulatorNode";N.setNoZ(true);N.setVisibilityInTree(false);N.setVisibility(Boolean(aa.getVisibleSpace()));N.side=k.DoubleSide;N.exludeFromBounding(true);N._getExcludeFromCSO=function(){return true};var ag=new g();ag.name="lineicPreviewRepsBag";ag.setPickable(d.NODRAWHL);var S=new g();S.name="boxPreviewNodeBag";S.setPickable(d.NODRAWHL);var W=null;var ah=new c();var B=false;var K=16744448;var ab=new k.MeshBasicMaterial({side:k.DoubleSide,color:16744448,transparent:true});var n=E.edgeMaterial;var Z=false;var Y=null;var R=null;var aj=null;var F=new d.VertexComponent();F.component=d.VertexComponentEnum.POSITION;F.nbVertices=2;F.nbValuesPerVertex=3;F.format=d.DataTypeEnum.FLOAT;F.cardinality=0;F.bufferId=0;F.indices=new d.IndexArray();F.indices.format=d.DataTypeEnum.UINT;F.indices.bufferId=1;F.indices.offset=0;var ad=new d.Buffer();ad.indexBuffer=true;ad.size=2;ad.format=d.DataTypeEnum.UINT;ad.dimension=1;ad.data=new Uint16Array(2);ad.data[0]=0;ad.data[1]=1;var p=new d.FillAttributes();var H=new d.LineAttributes();var P=new d.PointAttributes();var x=null;var t=null;var L=null;var m=null;var G=null;var s=function(al,am){if(al){if(al.material){if(al.material.map&&am){al.material.map.dispose()}al.material.dispose()}for(var ak=al.children.length-1;ak>=0;ak--){s(al.children[ak])}al.removeChildren()}};var ae=function(al){if(!Y&&X){Y=new f(X.externalPath[0]);aa.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(Y);var ak=Y.createOverride(ai);ak.setColor(K,true);if(al){ak.setOpacity(1,true);ak=Y.createOverride(X);ak.setColor("white",false);ak.setOpacity(0.1,false)}}};var o=function(){if(Y){aa.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(Y);Y=null}};var ac=function(at,ao){var ap=new d.PrimitiveGroup();ap.fillAttr=p;ap.lineAttr=H;ap.pointAttr=P;ap.noz=false;var an=new d.Buffer();an.size=6;an.component=d.VertexComponentEnum.POSITION;an.format=d.DataTypeEnum.FLOAT;an.dimension=3;an.data=new Float32Array(6);ap.addBuffer(0,an);ap.addBuffer(1,ad);var al=an.data;var am=0;al[am++]=at.x;al[am++]=at.y;al[am++]=at.z;var ar=new k.Vector3().copy(at).add(ao);al[am++]=ar.x;al[am++]=ar.y;al[am++]=ar.z;var ak=new d.Primitive();ak.nbIndices=2;ak.connectivity=d.ConnectivityTypeEnum.LINE_STRIP;ak.attr={fill:p,line:H,point:P};ak.material=n;ak.addVertexComponent(F);ap.addPrimitive(ak);var aq=j.createMeshNode(ap);aq.setSSAO(false);aq.setShadow(false,false);aq.excludeFromCSO(true);aq.excludeFromHighlight(true,true);return aq};var Q=function(av,at,au,ak){var ap=new d.PrimitiveGroup();ap.noz=false;ap.fillAttr=p;ap.lineAttr=H;ap.pointAttr=P;var an=new d.Buffer();an.size=12;an.component=d.VertexComponentEnum.POSITION;an.format=d.DataTypeEnum.FLOAT;an.dimension=3;an.data=new Float32Array(12);if(!L){L=new d.Buffer();L.indexBuffer=true;L.size=4;L.format=d.DataTypeEnum.UINT;L.dimension=1;L.data=new Uint16Array(4);L.data[0]=0;L.data[1]=1;L.data[2]=3;L.data[3]=2}if(!m){m=new d.Buffer();m.size=3;m.component=d.VertexComponentEnum.NORMAL;m.format=d.DataTypeEnum.FLOAT;m.dimension=3;m.data=new Float32Array(3);m.data[0]=0;m.data[1]=0;m.data[2]=1}if(!G){G=new d.Buffer();G.indexBuffer=true;G.size=4;G.format=d.DataTypeEnum.UINT;G.dimension=1;G.data=new Uint16Array(4);G.data[0]=0;G.data[1]=0;G.data[2]=0;G.data[3]=0}ap.addBuffer(0,an);ap.addBuffer(1,L);ap.addBuffer(2,m);ap.addBuffer(3,G);var al=an.data;var am=0;al[am++]=av.x;al[am++]=av.y;al[am++]=av.z;var ar=new k.Vector3().copy(av).add(at);al[am++]=ar.x;al[am++]=ar.y;al[am++]=ar.z;ar=new k.Vector3().copy(av).add(at).add(au);al[am++]=ar.x;al[am++]=ar.y;al[am++]=ar.z;ar=new k.Vector3().copy(av).add(au);al[am++]=ar.x;al[am++]=ar.y;al[am++]=ar.z;var ao=new d.Primitive();ao.nbIndices=4;ao.connectivity=d.ConnectivityTypeEnum.TRIANGLE_STRIP;ab.opacity=ak/10;ab.needsUpdate=true;ao.material=ab;if(!x){x=new d.VertexComponent();x.component=d.VertexComponentEnum.POSITION;x.nbVertices=4;x.nbValuesPerVertex=3;x.format=d.DataTypeEnum.FLOAT;x.cardinality=0;x.bufferId=0;x.indices=new d.IndexArray();x.indices.format=d.DataTypeEnum.UINT;x.indices.bufferId=1;x.indices.offset=0}if(!t){t=new d.VertexComponent();t.component=d.VertexComponentEnum.NORMAL;t.nbVertices=4;t.nbValuesPerVertex=3;t.format=d.DataTypeEnum.FLOAT;t.cardinality=0;t.bufferId=2;t.indices=new d.IndexArray();t.indices.format=d.DataTypeEnum.UINT;t.indices.bufferId=3;t.indices.offset=0}ao.addVertexComponent(x);ao.addVertexComponent(t);ap.addPrimitive(ao);var aq=j.createMeshNode(ap);aq.setSSAO(false);aq.setShadow(false,false);aq.excludeFromCSO(true);aq.excludeFromHighlight(true,true);return aq};var J=function(at,ap){for(var aq=0;aq<6;aq++){var av,al,aw,ar,an,au,am;switch(aq){case 0:av=r;al=D;aw=M;ar=C;an=u;break;case 1:av=r;al=v;aw=D;ar=y;an=C;break;case 2:av=r;al=M;aw=v;ar=u;an=y;break;case 3:av=new k.Vector3().copy(r).add(M);al=D;aw=v;ar=C;an=y;break;case 4:av=new k.Vector3().copy(r).add(D);al=v;aw=M;ar=y;an=u;break;default:av=new k.Vector3().copy(r).add(v);al=M;aw=D;ar=u;an=C;break}if(ar>=h&&an>=h){if(ap!==1){var ao=0.5*ap;am=new k.Vector3().copy(av);var ak=new k.Vector3().copy(al).setLength(ar*ao);au=ac(am,ak);at.addChild(au);am=new k.Vector3().copy(av).add(al);ak=new k.Vector3().copy(aw).setLength(an*ao);au=ac(am,ak);at.addChild(au);am=new k.Vector3().copy(av).add(al).add(aw);ak=new k.Vector3().copy(al).setLength(ar*ao).multiplyScalar(-1);au=ac(am,ak);at.addChild(au);am=new k.Vector3().copy(av).add(aw);ak=new k.Vector3().copy(aw).setLength(an*ao).multiplyScalar(-1);au=ac(am,ak);at.addChild(au)}else{au=ac(av,al);at.addChild(au);am=new k.Vector3().copy(av).add(al);au=ac(am,aw);at.addChild(au)}}}};var T=function(an,ap){if(an){for(var ao=0;ao<6;ao++){var am=null,ak=null,al=null;switch(ao){case 0:am=r;ak=D;al=M;break;case 1:am=r;ak=v;al=D;break;case 2:am=r;ak=M;al=v;break;case 3:am=new k.Vector3().copy(r).add(M);ak=D;al=v;break;case 4:am=new k.Vector3().copy(r).add(D);ak=v;al=M;break;default:am=new k.Vector3().copy(r).add(v);ak=M;al=D;break}an.addChild(Q(am,ak,al,ap))}}};var I=function(am){ab.opacity=Math.round(am/12)/100;ab.needsUpdate=true;var ak=am/(100/(ag.children.length-1));for(var al=0;al<ag.children.length;al++){if(al===ak){ag.children[al].setVisibility(Boolean(aa.getVisibleSpace()));ag.children[al].setVisibilityFree(false)}else{ag.children[al].setVisibility(false);ag.children[al].setVisibilityFree(true)}}aa.render()};var A=function(){var al=0.5;var am=null;for(var ak=0;ak<6;ak++){am=new g();am.setVisibility(false);am.setVisibilityFree(true);J(am,al);ag.addChild(am);al=Math.round(al*10+1)/10}N.addChild(ag);T(S,K,0);N.addChild(S)};var w=function(al){var ak={pathElement:ai,position:al.event.from[0].currentPosition};ah.publish({event:"onBoxClick",data:ak})};var O=function(){Z=true;B=false;ae(true);R.animate(1);aa.currentViewpoint.getControl()._changeState(3);aj={};aj.eyePosition=aa.currentViewpoint.getEyePosition();aj.upDirection=aa.currentViewpoint.getUpDirection();aj.sightDirection=aa.currentViewpoint.getSightDirection();aj.distanceToTarget=aa.currentViewpoint.getTargetDistance();ah.publish({event:"onBoxBeginManipulate",data:{pathElement:ai}})};var z=function(){o();aa.setCursor("auto");Z=false;R.animate(0);aa.currentViewpoint.moveTo({eyePosition:aj.eyePosition,upDirection:aj.upDirection,sightDirection:aj.sightDirection,distanceToTarget:aj.distanceToTarget,duration:100});aj=null;ah.publish({event:"onBoxEndManipulate",data:{pathElement:ai}})};var U=function(){if(!Z){aa.setCursor("pointer");B=true;ae(false);R.animate(1)}};var q=function(){if(!Z){aa.setCursor("auto");B=false;o();R.animate(0)}};this.show=function(){J(N,0.5);aa.addNode(N,false);R=new i({animationTime:5,nbSteps:5,onBeforeFirstAnimation:A,onAnimation:I,onAnimationEnd:function(){if(Z||B){I(100)}else{I(0)}}});if(!W){W=new l();W.subscribe("BoxClick",w);W.subscribe("BoxBeginManipulate",O);W.subscribe("BoxEndManipulate",z);W.subscribe("BoxBeginPreactivate",U);W.subscribe("BoxEndPreactivate",q);W.linkToNode(N)}N.setMatrix(V);aa.render()};this.hide=function(){o();N.setVisibility(false);N.setVisibilityFree(true);W=null;s(N,true);aa.removeNode(N)};this.setMatrix=function(ak){V.copy(ak);N.setMatrix(V)};this.setVisibleFlag=function(ak){if(!ak&&Z){return}if(!ak){N.setVisibility(false);N.setVisibilityFree(true)}else{N.setVisibility(Boolean(aa.getVisibleSpace()));N.setVisibilityFree(false)}};this.getVisibleFlag=function(){if(!N){return false}return !N.visibilityFree};this.getAssociatedPath=function(){return ai};this.subscribe=function(ak,al){return(ak==="onBoxClick"||ak==="onBoxBeginManipulate"||ak==="onBoxEndManipulate")?ah.subscribe({event:ak},al):undefined};this.unsubscribe=function(ak){ah.unsubscribe(ak)}}});return e});define("DS/CAT3DComposeBoxes/CAT3DComposeBoxesCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/CAT3DComposeBoxes/CAT3DComposeBoxController","DS/PADUtils/PADContext"],function(d,b,c){var a=d.extend({init:function(g){this._parent(g,{});var j=this;var h=null;var i=this.onStateChange(function(){if(!h){h=c.get()}b.getBoxController({context:h}).displayBoxes(j.getState());localStorage.setItem("CAT3DComposeBoxesCmd",j.getState()?"true":"false")});var f=this._destroy;this._destroy=function(){if(h){b.unregisterBoxController({context:h})}j._modelEvents.unsubscribe(i);f.call(j)};var e=localStorage.getItem("CAT3DComposeBoxesCmd");e=e!=="false";this.setState(e,true)},_destroy:function(){this._parent()}});return a});