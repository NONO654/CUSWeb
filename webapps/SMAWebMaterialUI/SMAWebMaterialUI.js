define("DS/SMAWebMaterialUI/Model/SMAWebFedAttributesModel",["UWA/Core","UWA/Class/Model",],function(c,a){var b=a.extend({defaults:{title:"",name:"",matType:"",classification:"",creationDate:"",lastModifiedBy:"",modificationDate:"",organization:"",collabPolicy:"",collabSpace:"",responsible:""},isEditable:function(d){return["title","matType"].indexOf(d)>=0},getEditableTag:function(d){return{tag:"input",type:"text",value:this.get(d)}}});return b});define("DS/SMAWebMaterialUI/SMAWebMaterialManager",["UWA/Core","UWA/Class"],function(c,b){var a=b.extend({defaultOptions:{frameWindow:null,destinationPool:"",events:{onDragStart:function(d){c.log("Begin drag of material "+d.title+" id "+d.matid)},onDragEnd:function(d){c.log("End drag of material "+d.title+" id "+d.matid)},onPreDrop:function(){},onPostDrop:function(){},onRemoveMaterial:function(){}},federatedSearch:true,treeConfig:[{tag:"ds6w:what/ds6w:type",refine:{"ds6w:what/ds6w:type":[{object:["dsc_matref_ref_Core"],type:"string",field:["implicit"]},{object:["dsc_matref_ref_Covering"],type:"string",field:["implicit"]},{object:["dsc_matref_ref_CoreVector"],type:"string",field:["implicit"]},{object:["dsc_matref_ref_CoveringVector"],type:"string",field:["implicit"]}]}},{tag:"ds6w:how/ds6w:classification"}],compareRows:[{tag:"ds6w:type"},{tag:"ds6w:classification"},{tag:"ds6w:created"},{tag:"ds6w:identifier"},{tag:"ds6w:lastModifiedBy"},{tag:"ds6w:modified"},{tag:"ds6w:organizationResponsible"},{tag:"ds6w:policy"},{tag:"ds6w:project"},{tag:"ds6w:status"},{tag:"ds6w:responsible"}],quickFilters:[{tag:"ds6w:type"},{tag:"ds6w:classification"},{tag:"ds6w:responsible"}],excludeTags:[],includeTags:null},init:function(d){this.options=c.extend(this.defaultOptions,d);this.identityCards=[];this.globalEnvs={}},getFrameWindow:function(){if(this.options.frameWindow){return this.options.frameWindow}else{return document.body}},getUIFrame:function(){if(this.options.frameWindow){return this.options.frameWindow.getUIFrame()}else{return document.body}},getViewer:function(){if(this.options.frameWindow){return this.options.frameWindow.getViewer()}else{return null}},getImmersiveFrame:function(){if(this.options.frameWindow){return this.options.frameWindow.getImmersiveFrame()}else{return null}},getDestinationPool:function(){return this.options.destinationPool},usingFederatedSearch:function(){return this.options.federatedSearch},applyMaterial:function(){},removeMaterial:function(){},addIdentityCard:function(d){if(!d.hasOwnProperty("pool")||d.pool===""){d.pool=this.options.destinationPool}this.identityCards.push(d)},_getIdentityCard:function(d){var f=this.identityCards.length;var e;for(e=0;e<f;++e){if(this.identityCards[e].tag===d){return this.identityCards[e]}}return null},_getIdentityCardList:function(){return this.identityCards},addCompareRow:function(d){this.options.compareRows.push(d)},_getCompareRows:function(){return this.options.compareRows},_getQuickFilters:function(){return this.options.quickFilters},setQuickFilters:function(d){this.options.quickFilters=d},configTreeLevels:function(d){this.options.treeConfig=d},_getTreeConfig:function(){return this.options.treeConfig},setApplyCallback:function(d){if(!this.options.events){this.options.events={}}this.options.events.onApply=d},_getApplyCallback:function(){if(this.options.events){return this.options.events.onApply}else{return null}},setEnv:function(d,e){if(this.globalEnvs){this.globalEnvs[d]=e}},getEnv:function(d){if(this.globalEnvs&&this.globalEnvs.hasOwnProperty(d)){return this.globalEnvs[d]}else{return null}},excludeTags:function(d){this.options.excludeTags=d;this.options.includeTags=null},_getExcludeTags:function(){return this.options.excludeTags},includeTags:function(d){this.options.includeTags=d;this.options.excludeTags=null},_getIncludeTags:function(){return this.options.includeTags}});return a.singleton({uninitializedCalls:"throw"})});define("DS/SMAWebMaterialUI/Views/SMAWebAppearCardView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View"],function(e,d,b,c){var a=c.extend({tagName:"div",render:function(){var f=this;return f}});return a});define("DS/SMAWebMaterialUI/SMAWebMaterialTree",["UWA/Core","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(c,b){var a={buildTree:function(l,t,g){var n=[];var D,C,B;var A=function(j,i){return(j.length===i.length&&j.every(function(k,K){return k===i[K]}))};var e={};for(D=0;D<t.materials.length;++D){e[t.materials[D].id]=D}var m={};var u=0;for(D=0;D<g.length;++D){var x=g[D].tag;var I=t[x];if(!I){continue}for(C=0;C<t[x].length;++C){var o=I[C];n[u]=({id:o.id,searchId:o.id,title:o.title,count:0,treeType:"folder",mtpath:[""],mtdisp:[""],level:D});m[o.id]=u;++u}}var y=l.results;for(D=0;D<y.length;++D){var w=y[D];var s=w.attributes;var h=[""];var p=[""];var F="";for(C=0;C<s.length;++C){var z=s[C];if(z.name==="resourceid"){F=z.value}else{for(B=0;B<g.length;++B){var x=g[B].tag;if(z.name===x){h[B+1]=z.value;if(z.hasOwnProperty("dispValue")){p[B+1]=z.dispValue}else{p[B+1]=z.value}}}}}for(B=0;B<g.length;++B){if(!h[B+1]){h[B+1]=b["folder.nonconformal"];p[B+1]=b["folder.nonconformal"]}}var r=e[F];t.materials[r].mtpath=h;t.materials[r].mtdisp=p;for(C=0;C<g.length;++C){var d=h[C+1];var H=m[d];var q=n[H];var E=h.slice(0,C+1);var J=p.slice(0,C+1);if(q){if(!A(q.mtpath,E)){if(q.mtpath.length!==E.length){q.mtpath=E;q.mtdisp=J}else{var v=false;var f=1;var G=d;while(!v&&m.hasOwnProperty(d)){H=m[d];q=n[H];if(A(q.mtpath,E)){v=true}else{d=G+"_inst"+f;++f}}if(!v){n[u]=({id:d,searchId:q.id,title:q.title,count:0,treeType:"folder",mtpath:E,mtdisp:J,level:q.level});m[d]=u;q=n[u];++u}t.materials[r].mtpath[C+1]=d}}++q.count}else{if(d!==b["folder.nonconformal"]){c.log("Folder "+d+" not found")}else{n[u]=({id:d,searchId:"$nonconformal$",title:d,count:1,treeType:"folder",mtpath:E,mtdisp:J,level:C});m[d]=u;q=n[u];++u;t.materials[r].mtpath[C+1]=d}}}}n.push.apply(n,t.materials);return n}};return a});define("DS/SMAWebMaterialUI/SMAWebMaterialRequest",["UWA/Core","UWA/Class"],function(d,c){var a=null;var b=c.singleton({init:function(){d.log("RequestDispatcher::init");a=this;a.dispatchTable={};a.isWebInWin=typeof(dscef)!=="undefined"},initialize:function(){},send:function(g,f,e){if(!f){f=""}if(a.isWebInWin){d.log("RequestDispatcher::send "+g);if(e){a.dispatchTable[g]=e}dscef.sendString(g,f)}else{if(e){if(e.onError){e.onError(g,"",e)}else{if(e.onComplete){e.onComplete(g,"",e)}}}}},set:function(f,e){d.log("RequestDispatcher::set "+f);if(e){a.dispatchTable[f]=e}},dispatch:function(h,g){if(!g){g=""}var e=false;if(a.dispatchTable.hasOwnProperty(h)){var f=a.dispatchTable[h];if(f&&f.onComplete){f.onComplete(h,g,f);e=true}}else{if(h==="UnknownOperation"&&g!==""){if(a.dispatchTable.hasOwnProperty(g)){var f=a.dispatchTable[g];if(f){if(f.onError){f.onError(h,"",f);e=true}else{if(f.onComplete){f.onComplete(h,"",f);e=true}}}}}}return e}});return b});define("DS/SMAWebMaterialUI/Views/SMAWebSimCardExclude",[],function(){function b(){return{options:{},fields:{},columns:{}}}var c=b();var a={isOptionExcluded:function(d){return(c.options.hasOwnProperty(d)&&c.options[d]==="exclude")},isFieldExcluded:function(d){return(c.fields.hasOwnProperty(d)&&c.fields[d]==="exclude")},isColumnExcluded:function(d){return(c.columns.hasOwnProperty(d)&&c.columns[d]==="exclude")},excludeList:function(){return c}};return a});define("DS/SMAWebMaterialUI/SMAWebMaterialSearch",["UWA/Core","UWA/Class"],function(c,b){var a=b.singleton({init:function(){c.log("MaterialSearch::init");this.spServiceurl=document.createElement("sp-serviceurl");this.dashboard=document.createElement("sp-dashboard");if(typeof(widget)!=="undefined"&&widget){this.tenant=widget.getValue("x3dPlatformId")}if(!this.tenant){this.tenant="OnPremise"}this.serviceUrl=null},setTenant:function(d){c.log("MaterialSearch::setTenant set to "+d);this.tenant=d},setSearchServiceUrl:function(d){c.log("MaterialSearch::setSearchServiceUrl set to "+d);this.serviceUrl=d},getData:function(k){if(!k){k={}}var m="";if(widget&&widget.environment&&widget.environment.name){m=widget.environment.name}if(m!=="uwa"){if(this.dashboard.isInDashboard()||!widget){var l="post";var j="";var w="";var o="3dexpmat:()";var n=new Date();var A="MaterialPalette-"+n.getTime();var x;var z=function(i){var E=["*","(",")",'"',"'"];for(var D in E){if(i===E[D]){return false}}return true};var g=function(E){var F="";var G=E.split(/\s+/);for(var D=0;D<G.length;++D){var i=G[D];if(i!=="OR"&&i!=="AND"&&i!=="NOT"){if(z(i.charAt(0))){i="*"+i}if(z(i.charAt(i.length-1))){i=i+"*"}}F=F+i+" "}F.trim();return F};var e={};var q="";if(k.hasOwnProperty("path")&&k.hasOwnProperty("pathTags")){for(x=1;x<k.path.length;++x){var u=k.pathTags[x-1].tag;if(k.path[x]==="$nonconformal$"){var d=u.substr(1).search(/\//)+1;if(d>0){u=u.slice(d+1)}q=" NOT listoffields:["+u+"]"}else{e[u]=[{object:[k.path[x]],type:"string",field:["implicit"]}]}}if(k.path.length<=k.pathTags.length&&k.pathTags[k.path.length-1].hasOwnProperty("refine")){c.extend(e,k.pathTags[k.path.length-1].refine)}}if(k.filterTags){c.extend(e,k.filterTags)}var B="";var p=["sixw:ds6w:when/ds6w:created","sixw:ds6w:when/ds6w:modified"];for(x=0;x<p.length;++x){if(e.hasOwnProperty(p[x])){var u=p[x];var d=u.substr(1).search(/\//)+1;if(d>0){u=u.slice(d+1)}if(e[p[x]][0].object.hasOwnProperty("from")){var y=e[p[x]][0].object.from;if(y){if(B!==""){B+=" AND "}B+="["+u+']>="'+y+'"'}}if(e[p[x]][0].object.hasOwnProperty("to")){var y=e[p[x]][0].object.to;if(y){if(B!==""){B+=" AND "}B+="["+u+']<="'+y+'"'}}delete e[p[x]]}}if(B!==""){B="("+B+")"}if((k.hasOwnProperty("filter")&&k.filter!=="")||(k.hasOwnProperty("addFilter")&&k.addFilter!=="")){var s=k.filter;s=g(s);if(k.hasOwnProperty("addFilter")&&k.addFilter!==""){var f=g(k.addFilter);if(s!==""){s+=" AND "}s+=f}var C=[{tag:"ds6w:label"}];C.push.apply(C,k.pathTags);for(x=0;x<C.length;++x){var u=C[x].tag;var d=u.substr(1).search(/\//)+1;if(d>0){u=u.slice(d+1)}if(w!==""){w+=" OR "}w+="["+u+"]:("+s+")"}}if(w!==""){w="("+w+")"}if(w!==""||B!==""||q!==""){o="3dexpmat:(";if(B!==""){o+=B;if(w!==""){o+=" AND "}}if(w!==""){o+=w}if(q!==""){o+=q}o+=")"}if(k.query==="facets"){j=JSON.stringify({query:o,refine:e,order_field:"ds6w:label",order_by:"asc",with_nls:true,source:["3dspace"],nresults:1,locale:"en",tenant:this.tenant,label:A,with_synthesis:true})}else{if(k.query==="materials"||k.query==="filter"){var h=1000;var t=false;if(k.query==="filter"){h=40;t=true}j=JSON.stringify({query:o,refine:e,order_field:"ds6w:label",order_by:"asc",with_nls:true,source:["3dspace"],select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:modified","ds6w:created","ds6w:label","ds6w:identifier","ds6w:responsible","ds6w:type","ds6w:description","ds6w:classification","ds6w:policy","ds6w:materialDomain","ds6w:type","ds6w:lastModifiedBy","ds6w:project","ds6w:organizationResponsible"],nresults:h,start:"0",locale:"en",tenant:this.tenant,label:A,with_synthesis:t})}else{if(k.query==="recent"){var v=[];if(k.recentMaterials&&k.recentMaterials.length>0){for(var x=0;x<k.recentMaterials.length;++x){if(k.recentMaterials[x]!==""){v.push(k.recentMaterials[x])}}}if(v.length>0){var s=v.map(function(i){return" [ds6w:identifier]:("+i+")"});var r=s.join(" OR ");o="3dexpmat:("+r+")";j=JSON.stringify({query:o,order_field:"ds6w:label",order_by:"asc",with_nls:true,source:["3dspace"],select_file:["icon","thumbnail_2d"],nresults:1000,start:"0",locale:"en",tenant:this.tenant,label:A})}else{this._noResults(k);return null}}else{if(k.query==="in-session"){if(k.materialsJSON&&k.materialsJSON.length>0){var s=k.materialsJSON.map(function(i){return" [ds6w:identifier]:("+i.name+")"});var r=s.join(" OR ");o="3dexpmat:("+r+")";j=JSON.stringify({query:o,order_field:"ds6w:label",order_by:"asc",with_nls:true,source:["3dspace"],select_file:["icon","thumbnail_2d"],nresults:1000,start:"0",locale:"en",tenant:this.tenant,label:A})}else{this._noResults(k);return null}}}}}c.log("Using Federated Search Webservice to search "+l+" "+j);return this._getMaterialData(l,j,k)}}return null},_noResults:function(d){d.onComplete({infos:{nresults:0,nhits:0}})},_getMaterialData:function(g,f,d){var e=this;if(!this.serviceUrl){this.spServiceurl.getUrl({serviceid:"3DSearch",platformid:this.tenant,onComplete:function(h){e.serviceUrl=h;if(typeof(dscef)!=="undefined"){dscef.sendString("SearchServiceUrl",h);c.log("Setting search service url to "+h)}e._searchMaterial(g,f,d)},onError:function(h){c.log("error"+h);if(d.onError){d.onError("error: "+h)}}})}else{e._searchMaterial(g,f,d)}},_searchMaterial:function(h,g,d){var f="";if(h==="get"){f="?query="+g}var e=document.createElement("sp-webservice");e.sendRequest({handleprefix:false,handlepostfix:false,serviceId:"3DSearch",uri:this.serviceUrl+"/search"+f,verb:h,data:g,wait:0,success:[200,204],headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"},onComplete:function(i){if(d.onComplete){d.onComplete(JSON.parse(i.response))}},onError:function(i){c.log("error"+i);if(d.onError){d.onError("error: "+i)}}})}});return a});define("DS/SMAWebMaterialUI/Model/SMAWebFedMaterialModel",["UWA/Core","UWA/Class/Model"],function(c,a){var b=a.extend({defaults:{id:"",title:"",count:"",name:"",treeType:"",mtpath:[""],mtdisp:[""],thumbnail:"",preview:"",domains:[],type:"",classification:""}});return b});define("DS/SMAWebMaterialUI/SMAWebMaterialAuthenticate",["UWA/Core"],function(b){var a={authenticate:function(d,e){b.log("Authenticating web services");if(d){var c=document.createElement("sp-serviceurl");c.getUrl({serviceid:"3DSearch",platformid:d,onComplete:function(f){var g=document.createElement("sp-webservice");g.sendRequest({handleprefix:true,handlepostfix:true,serviceId:"3DSearch",uri:f+"/login?tenant="+d,verb:"get",wait:0,success:[200,204],headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"},onComplete:function(){e()},onError:function(){e()}})},onError:function(){e()}})}else{e()}}};return a});define("DS/SMAWebMaterialUI/Service/SMAWebUtils",["UWA/Core"],function(b){var a={debounce:function(f,c,e){var d=null;return function(){if(e){b.log(e)}var g=[];for(var h=0;h<arguments.length;h++){g.push(arguments[h])}if(d){clearInterval(d)}d=setTimeout(function(){d=null;f(null,g)},c)}},readFile:function(e,d,h,g,f){var c=new FileReader();c.onerror=function(i){switch(i.target.error.code){case i.target.error.NOT_FOUND_ERR:f("File Not Found!");break;case i.target.error.NOT_READABLE_ERR:f("File is not readable");break;case i.target.error.ABORT_ERR:break;default:f("An error occurred reading this file.")}};c.onprogress=function(j){if(j.lengthComputable){var i=Math.round((j.loaded/j.total)*100);if(i<100){h(i)}}else{h(100)}};c.onloadstart=d;c.onload=function(){g(null,c.result);c=null};c.readAsText(e);return{cancel:function(){c.abort();c=null}}},identity:function(c){return c},toModelId:function(c){return c.replace(/\?/g,"&qmark;")}};return a});define("DS/SMAWebMaterialUI/Service/SMAWebDispatcher",["UWA/Core","UWA/Dispatcher"],function(c,a){var b={callOperationStarted:new a(),callOperatedEnded:new a(),uploadOperationStarted:new a(),uploadOperationEnded:new a()};return b});define("DS/SMAWebMaterialUI/SMAWebMaterialTagger",["UWA/Core","UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/SMAWebMaterialUI/SMAWebMaterialManager","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebTagSpecifiers"],function(g,e,f,d,c){var a=null;var b=e.singleton({init:function(){g.log("MaterialTagger::init");a=this},initialize:function(j){g.log("MaterialTagger:initialize");j=j||{};a._tagChangeCallback=null;a._taggerChangeCallback=null;a._searchChangeCallback=null;a._searchString="";a._specifierTags=Object.keys(c);a._toSpecifiers={};a._toTags={};for(var k=0;k<a._specifierTags.length;++k){a._toSpecifiers[a._specifierTags[k]]=c[a._specifierTags[k]];a._toTags[c[a._specifierTags[k]]]=a._specifierTags[k]}if(a.initializeTagger){return}a.initializeTagger=true;if(!j.proxy){var h={filteringMode:"FilteringOnServer",events:{},freeInput:true};if(widget&&widget.environment.name!=="uwa"){h.widgetId=widget.id}else{h.contextId="default"}this.proxy=f.createProxy(h);this.proxy.addEvent("onFilterChange",a.onFilterChange)}else{this.proxy=j.proxy}this.allFilters={};this.filterKeys=[];this.allFacets=[];if(widget){widget.addEvent("onSearch",a.onSearch);widget.addEvent("onResetSearch",a.onResetSearch)}this.initTaggerEvents()},set:function(i){if(!i){i=[]}var h=a.configTags(i);a.proxy.activate();a.proxy.setTags({},h)},reset:function(){a.proxy.setTags({});a._tagChangeCallback=null;a._taggerChangeCallback=null;a._searchChangeCallback=null},onFilterChange:function(h){a.allFilters=h.allfilters;a.filterKeys=Object.keys(a.allFilters);if(a._tagChangeCallback){a._tagChangeCallback()}else{a.reset()}},onTagChange:function(h){a._tagChangeCallback=h},configTags:function(o){var h=[];var p=d._getExcludeTags();if(!p){p=[]}var n=d._getIncludeTags();var m,l;for(m=0;m<o.length;++m){var q=o[m];var k;if(n){k=true;for(l=0;l<n.length&&k;++l){k=(q.sixw!==n[l])}}else{k=false;for(l=0;l<p.length&&!k;++l){k=(q.sixw===p[l])}}if(!k){h.push(q)}}return h},hasFilters:function(){return(a.filterKeys.length||a._searchString!=="")},hasTags:function(){return(a.filterKeys.length)},getFilters:function(){return{tags:a.allFilters,search:a._searchString}},compareFilters:function(){},getTagString:function(m){var k=false;if(m&&m.hasOwnProperty("multiline")){k=m.multiline}var h="";for(var n=0;n<a.filterKeys.length;++n){if(a._toSpecifiers.hasOwnProperty(a.filterKeys[n])){for(var l=0;l<a.allFilters[a.filterKeys[n]].length;++l){if(h!==""){h+=" + ";if(k){h+="<br>"}}h+=a._toSpecifiers[a.filterKeys[n]]+':"'+a.allFilters[a.filterKeys[n]][l].disptext+'"'}}}return h},parseTagString:function(){var h=[];return h},onSearch:function(h){a._searchString=h;if(a._searchChangeCallback){a._searchChangeCallback(a._searchString)}},onResetSearch:function(){a._searchString="";if(a._searchChangeCallback){a._searchChangeCallback(a._searchString)}},onSearchChange:function(h){a._searchChangeCallback=h},toggle:function(){var h=window.top.document.getElementById("btn_tag_nav");if(h){h.click()}},initTaggerEvents:function(){var i=window.top.document.getElementById("btn_tag_nav");if(i){var h=new MutationObserver(a.onTaggerToggle);h.observe(i,{attributes:true})}},onTaggerToggle:function(){if(a._taggerChangeCallback){a._taggerChangeCallback(a.isVisible())}},onTaggerChange:function(h){a._taggerChangeCallback=h},isVisible:function(){var h=false;var i=window.top.document.getElementById("btn_tag_nav");if(i){h=i.hasClassName("tagger-icon-active")}return h},setFilters:function(l){var m=Object.keys(l);var k=m.length;for(var h=0;h<k;++h){var j=m[h];a.allFilters[j]=l[j]}a.filterKeys=Object.keys(a.allFilters)},clearFilters:function(l){var m=Object.keys(l);var k=m.length;for(var h=0;h<k;++h){var j=m[h];delete a.allFilters[j]}a.filterKeys=Object.keys(a.allFilters)},clearAllFilters:function(){a.allFilters={};a.filterKeys=[]},setFacets:function(h){a.allFacets=h},getFacets:function(){return(a.allFacets)}});return b});define("DS/SMAWebMaterialUI/SMAWebMaterialService",["UWA/Core","UWA/Class","UWA/Promise","DS/SMAWebMaterialUI/Model/SMAWebFedMaterialModel","DS/SMAWebMaterialUI/Model/SMAWebFedAttributesModel","DS/SMAWebMaterialUI/SMAWebMaterialSearch"],function(d,i,h,f,a,b){function e(){return{"ds6w:label":{property:"title"},"ds6w:identifier":{property:"name"},"ds6w:who/ds6w:responsible":{property:"responsible"},"ds6w:responsible":{property:"responsible"},"ds6w:when/ds6w:created":{property:"creationDate",date:true},"ds6w:created":{property:"creationDate",date:true},"ds6w:when/ds6w:modified":{property:"modificationDate",date:true},"ds6w:modified":{property:"modificationDate",date:true},"ds6w:who/ds6w:lastModifiedBy":{property:"lastModifiedBy"},"ds6w:lastModifiedBy":{property:"lastModifiedBy"},"ds6w:how/ds6w:classification":{property:"classification"},"ds6w:classification":{property:"classification"},"ds6w:what/ds6w:status":{property:"maturity",useDisplayValue:true},"ds6w:status":{property:"maturity",useDisplayValue:true},"ds6w:what/ds6w:library":{property:"library"},"ds6w:library":{property:"library"},"ds6w:what/ds6w:policy":{property:"collabPolicy",useDisplayValue:true},"ds6w:policy":{property:"collabPolicy",useDisplayValue:true},"ds6w:where/ds6w:context/ds6w:project":{property:"collabSpace",useDisplayValue:true},"ds6w:project":{property:"collabSpace",useDisplayValue:true},"ds6w:what/ds6w:type":{property:"matType",useDisplayValue:true},"ds6w:type":{property:"matType",useDisplayValue:true},"ds6w:who/ds6w:responsible/ds6w:organizationResponsible":{property:"organization"},"ds6w:organizationResponsible":{property:"organization"},thumbnail_2d:{property:"thumbnail"},type_icon_url:{property:"icon"},preview_url:{property:"preview"},resourceid:{property:"resourceid"}}}function c(D){var n=e();var t="ds6w:how/ds6w:materialDomain";var w="ds6w:materialDomain";var y="ds6w:what/ds6w:type";var B="ds6w:type";var p={};p.materials=[];var v,u;var C=D.facets;if(!C){C=[]}for(v=0;v<C.length;++v){var k=C[v];var A=k.sixw;if(!p.hasOwnProperty(A)){p[A]=[]}var s={};s.id=k.object;s.searchId=k.object;s.count=k.count;if(k.hasOwnProperty("dispValue")){s.title=k.dispValue}else{s.title=k.object}p[A].push(s)}var q=D.results;if(!q){q=[]}for(v=0;v<q.length;++v){var o=q[v];var m=o.attributes;var x={};x.classification="";x.domains=[];for(u=0;u<m.length;++u){var r=m[u];if(n.hasOwnProperty(r.name)){var z=n[r.name];x[z.property]=r.value;if(z.date){var l=new Date(r.value);x[z.property]=l.toLocaleString()}if(z.useDisplayValue&&r.hasOwnProperty("dispValue")){x[z.property]=r.dispValue}}if(r.name===t||r.name===w){x.domains.push(r.value)}if(r.name===y||r.name===B){x.type=r.value}}if(!x.thumbnail){if(x.preview){x.thumbnail=x.preview}else{x.thumbnail=x.icon}}p.materials.push({id:x.resourceid,name:x.name,treeType:"material",title:x.title,thumbnail:x.thumbnail,preview:x.preview,domains:x.domains,type:x.type,matType:x.matType,classification:x.classification,titleUpperCase:(x.title&&x.title.toUpperCase)?x.title.toUpperCase():x.title,properties:{classification:x.classification,creationDate:x.creationDate,name:x.name,title:x.title,lastModifiedBy:x.lastModifiedBy,modificationDate:x.modificationDate,organization:x.organization,collabPolicy:x.collabPolicy,collabSpace:x.collabSpace,maturity:x.maturity,responsible:x.responsible,matType:x.matType}})}return p}var g={transform:function(j){return c(j)},tagMap:function(){return e()},getRecentMaterials:function(){var j=typeof(dscef)!=="undefined";if(j){this.materialPromise=d.Promise.deferred();dscef.sendString("GetRecentMaterialsJSON");return this.materialPromise.promise}else{return this.getDummyMaterials().then(function(k){return k.slice(0,10)})}},getInSessionMaterials:function(){var j=typeof(dscef)!=="undefined";if(j){this.materialPromise=d.Promise.deferred();dscef.sendString("GetInSessionMaterialsJSON");return this.materialPromise.promise}else{return this.getDummyMaterials().then(function(k){return k.slice(0,10)})}},getFavoritesMaterials:function(){return this.getDummyMaterials().then(function(j){return j.slice(10,20)})},getMyMaterials:function(){return this.getDummyMaterials().then(function(j){return j.slice(20,30)})},getDummyMaterials:function(){var j=this;return new h(function(m,l){var k=b.getData({query:"recent",onComplete:function(n){m(j.transform(n).materials)},onError:function(n){l(n)}});if(k){setTimeout(function(){m(j.transform(k).materials)},400)}})}};return g});define("DS/SMAWebMaterialUI/SMAWebMaterialDrag",["UWA/Core","DS/SMAWebMaterialUI/SMAWebMaterialManager",],function(c,b){var a={setDragData:function(g,e){var d=typeof(dscef)!=="undefined";if(e.get("treeType")==="material"){var f={objectType:"material",title:e.get("title"),name:e.get("name"),matid:e.get("id"),id:e.get("id"),type:e.get("type")};if(d){dscef.sendString("PLMDragStart",f.id)}else{g.dataTransfer.setData("text",JSON.stringify({data:{items:[f]}}))}if(b.options.events.onDragStart){b.options.events.onDragStart(f)}}}};return c.namespace("DS/SMAWebMaterialUI/SMAWebMaterialDrag",a)});define("DS/SMAWebMaterialUI/Views/SMAWebMaterialImportPanel",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","UWA/Controls/Abstract","DS/Core/Events","DS/UIKIT/Input/File","DS/UIKIT/Mask","DS/Controls/ProgressBar","DS/Controls/Button","DS/SMAWebMaterialUI/Service/SMAWebDispatcher","DS/SMAWebMaterialUI/Service/SMAWebUtils"],function(f,m,l,d,h,c,i,e,b,k,a,j){var g=h.extend({init:function(n){this._parent(n);this._buildPanel();this._hookEvents()},bindings:[],_buildPanel:function(){var n=this;n.elements.container=f.createElement("div",{id:"importPanel",styles:{padding:"5px",width:"100%","max-width":"400px","min-width":"260px","min-height":"80px"}});n.elements.fileElement=new i({multiple:false,buttonBefore:false,name:"file-input",placeholder:"INP File...",events:{onChange:function(o){var p=o.target.files[0];n.setStatus("");if(!p.name.toLowerCase().endsWith(".inp")){n.setStatus("Choose an inp file");return}j.readFile(p,function(){n.elements.progressElement.value=0},function(q){n.elements.progressElement.value=q},function(q){n.elements.progressElement.value=100;n.fileContent=q;f.log(n.fileContent)},function(q){f.log(q)})}}}).inject(n.elements.container);n.elements.progressElement=new b({displayStyle:"lite",}).inject(n.elements.container);n.elements.statusElement=f.createElement("div",{styles:{height:"2 rem"}}).inject(n.elements.container)},ok:function(){f.log("upload file")},close:function(){var n=this;n.dispatchEvent("onClose")},_hookEvents:function(){var n=this;n.bindings.push(a.uploadOperationStarted.add(function(){if(this.elements.container){e.mask(this.elements.container.getParent().getParent())}},n));n.bindings.push(a.uploadOperationEnded.add(function(o){if(this.elements.container){this.setStatus(o);e.unmask(this.elements.container.getParent().getParent());this.elements.fileElement.clear();this.fileContent=""}},n))},setStatus:function(n){this.elements.statusElement.setText(n)},destroy:function(){this.elements.progressElement.destroy();this.elements.fileElement.destroy();[].forEach.call(this.bindings,function(n){n.detach()});this._parent()}});return g});define("DS/SMAWebMaterialUI/SMAWebMaterialCompare",["UWA/Core","UWA/Controls/Abstract","DS/Windows/Panel","DS/SMAWebMaterialUI/SMAWebMaterialManager","DS/SMAWebMaterialUI/SMAWebMaterialService","DS/SMAWebMaterialUI/SMAWebMaterialRequest","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(h,g,e,b,a,d,c){var f=g.extend({init:function(){this.panel=null;this.maxMaterials=4},show:function(i){if(!this.panel){this._buildPanel(i)}this._drawPanel(i)},hide:function(){this.panel.close()},toggle:function(i){if(!this.panel){this.show(i)}else{this.hide()}},onContextMenu:function(){h.log("Show context menu for material "+this.get("title")+" "+this.id);d.send("VPMContextMenu",this.id);return null},_buildPanel:function(i){this._position={};if(i.target){this._position.of=i.target;this._position.my="top left";this._position.at="top left";this._position.offsetX=-10;this._position.offsetY=-10}this.container=new h.Element("div");this.container.addClassName("smawebmat_filterpanel");this.container.style.minWidth="500px";this.panel=new e({title:c.compareTitle,content:this.container,position:this._position});this.panel.elements.container.setStyles({"z-index":1002});this.panel.inject(b.getUIFrame());this.panel.addEventListener("close",function(){this.panel=null}.bind(this))},_drawPanel:function(o){var C=this;this.container.innerHTML="";if(o.materials&&o.collection){var n=o.materials.length>this.maxMaterials?this.maxMaterials:o.materials.length;var u=b._getCompareRows();var p=u.length;var z,x,v,t,m,D;var s=a.tagMap();C.table=h.createElement("table",{styles:{width:"100%","class":"smawebmat_compare_table"}}).inject(this.container);var A=h.createElement("tr",{"class":"smawebmat_compare_hdr"}).inject(C.table);h.createElement("th",{"class":"smawebmat_compare_hdr"}).inject(A);for(z=0;z<n;++z){v=o.materials[z];t=o.collection.get(v);if(t){var y=h.createElement("th",{"class":"smawebmat_compare_hdr"}).inject(A);h.createElement("img",{src:t.get("preview"),"class":"smawebmat_compare_hdr"}).inject(y);h.createElement("div",{text:t.get("title"),"class":"smawebmat_compare_hdr"}).inject(y);y.addEvent("contextmenu",this.onContextMenu.bind(t))}}for(x=0;x<p;++x){var B=h.createElement("tr",{"class":"smawebmat_compare_cell"}).inject(C.table);var l="";var r="";var w=null;var q=u[x];if(q.hasOwnProperty("tag")){var E=s[q.tag];if(E){l=E.property;if(l){r=c[l]}}}else{if(q.hasOwnProperty("renderer")){w=q.renderer}}if(q.hasOwnProperty("label")){r=q.label}h.createElement("td",{text:r,"class":"smawebmat_compare_rowhdr"}).inject(B);for(z=0;z<n;++z){v=o.materials[z];t=o.collection.get(v);m=t.get("properties");D="";if(l){D=m[l]}var k=h.createElement("td",{"class":"smawebmat_compare_cell"}).inject(B);if(w){w(t).inject(k)}else{k.textContent=D}k.addEvent("contextmenu",this.onContextMenu.bind(t))}}if(b.getEnv("SMAWMT_ENHANCED_MATERIAL_PROPERTIES")){d.send("GetMaterialsJSON",o.materials.toString(),{onComplete:function(H,I){if(I!==""){var L=JSON.parse(I);var N=C._compareProps(L);var O=Object.keys(N);var K,J;for(J=0;J<O.length;++J){var P=N[O[J]];var G=h.createElement("tr",{"class":"smawebmat_compare_cell"}).inject(C.table);h.createElement("td",{text:P.label,"class":"smawebmat_compare_rowhdr"}).inject(G);for(K=0;K<n;++K){var M=h.createElement("td",{"class":"smawebmat_compare_cell"}).inject(G);var F=o.materials[K];if(P.hasOwnProperty(F)){M.textContent=P[F]}else{M.textContent=""}M.addEvent("contextmenu",C.onContextMenu.bind(t))}}}}})}}},_compareProps:function(H){var w={};var s=H.infos.nresults;var O,N,P,M,p;for(O=0;O<s;++O){var D=H.results[O];var G=D.resourceid;if(D.domains&&D.domains.simulation&&D.domains.simulation.behaviors){var F=D.domains.simulation.behaviors;var R=F.length;for(N=0;N<R;++N){if(F[N].isDefault){break}}if(!w.hasOwnProperty("_DefaultBehavior")){w._DefaultBehavior={};w._DefaultBehavior.label=c["simprops.defaultBehavior"]}w._DefaultBehavior[G]=F[N].Name;var r=F[N].options;var m=Object.keys(r);for(M=0;M<m.length;++M){var E=m[M];var x=r[E];if(x.fields){var J=x.fields;var n=J._FieldInfo_.FieldList;var C=J._FieldInfo_.FieldLabels;var z=J._FieldInfo_.FieldUnits;for(p=0;p<n.length;++p){var o=n[p];var y=J[o];if(z[o]){y+=z[o]}var I=o;if(o==="CoreMaterialDensity"){I="SMAMatDensityColumn"}if(!w.hasOwnProperty(I)){w[I]={};w[I].label=C[o]}w[I][G]=y}}if(x.tables){var A=x.tables;for(P=0;P<A.length;++P){var v=A[P];var B=v._ColumnInfo_.ColumnOrder;var L=v._ColumnInfo_.ColumnLabels;var Q=v._ColumnInfo_.ColumnUnits;var u=B.length;if(u===0){continue}var t=v[B[0]].length;if(t===1){for(p=0;p<u;++p){var q=B[p];var K=v[q];var l=K[0];if(Q[q]){l+=Q[q]}if(!w.hasOwnProperty(q)){w[q]={};w[q].label=L[q]}w[q][G]=l}}}}}}}return w}});return f});define("DS/SMAWebMaterialUI/Views/SMAWebSimCardView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","DS/Controls/Accordeon","DS/SMAWebMaterialUI/SMAWebMaterialRequest","DS/SMAWebMaterialUI/Views/SMAWebSimCardExclude","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(e,c,f,a,h,b,i,d){var g=a.extend({tagName:"div",render:function(){var k=this;var j=k.model;b.send("GetSimulationDomainJSON",j.id,{onComplete:function(v,p){if(p!==""){var Q=JSON.parse(p);var aa,Z,y,W,ae;if(k.container.innerHTML!==""){k.container.innerHTML=""}else{if(k.options.onContextMenu){k.container.addEvent("contextmenu",k.options.onContextMenu.bind(k))}k.container.setStyles({"text-align":"left",background:"white",height:"100%",padding:"0px 10px",overflow:"auto"})}if(Q.results&&Q.results[0].domains&&Q.results[0].domains.simulation&&Q.results[0].domains.simulation.behaviors){var A=function(){var ag=e.createElement("table",{styles:{width:"100%"}});e.createElement("tr",{html:[{tag:"th",text:d.property,styles:{"font-weight":"bold",color:"#777",padding:"0px 3px 4px"}},{tag:"th",text:d.value,styles:{"font-weight":"bold",color:"#777",padding:"0px 3px 4px"}}],styles:{"border-bottom":"2px solid #ddd"}}).inject(ag);return ag};var C=function(ah,ag){return e.createElement("tr",{html:[{tag:"td",text:ah,styles:{padding:"3px 3px","font-size":"12px"}},{tag:"td",text:ag,styles:{padding:"3px 3px","font-size":"12px"}}],styles:{"border-bottom":"1px solid #ddd"}})};var x=function(ai){var ah=e.createElement("table",{styles:{}});var aj=e.createElement("tr",{}).inject(ah);e.createElement("th",{text:"",styles:{padding:"1px 10px","border-bottom":"1px solid #ddd"}}).inject(aj);for(var ag=0;ag<ai.length;++ag){e.createElement("th",{text:ai[ag],styles:{padding:"1px 10px","border-bottom":"1px solid #ddd"}}).inject(aj)}return ah};var L=function(ag,aj){var ai=(ag%2===0?"#eee":"#fff");var ak=e.createElement("tr",{styles:{"background-color":ai}});e.createElement("td",{text:ag,styles:{padding:"1px 10px"}}).inject(ak);for(var ah=0;ah<aj.length;++ah){e.createElement("td",{text:aj[ah],styles:{padding:"1px 10px"}}).inject(ak)}return ak};var z=Q.results[0].domains.simulation.behaviors;var Y=z.length;for(aa=0;aa<Y;++aa){if(aa===0){e.createElement("h6",{text:d["simprops.summary"]+":"}).inject(k.container)}var u=e.createElement("div");var F=false;var J=z[aa].options;if(J){var V=Object.keys(J);var ab,I,af;var E=null;for(Z=0;Z<V.length;++Z){var T=V[Z];if(i.isOptionExcluded(T)){continue}var S=J[T];if(S.fields){var m=S.fields;var l=m._FieldInfo_.FieldList;var U=m._FieldInfo_.FieldLabels;var B=m._FieldInfo_.FieldUnits;for(W=0;W<l.length;++W){var G=l[W];var s=m[G];if(i.isFieldExcluded(G)){continue}if(!F){E=A();u.grab(E);F=true}ab=s;if(B[G]){ab+=B[G]}C(U[G],ab).inject(E)}}if(S.tables){var X=S.tables;for(y=0;y<X.length;++y){var P=X[y];var ac=P._ColumnInfo_.ColumnOrder;var n=P._ColumnInfo_.ColumnLabels;var t=P._ColumnInfo_.ColumnUnits;var o=ac.length;if(o===0){continue}var N=P[ac[0]].length;if(!F){E=A();u.grab(E);F=true}if(N>1){var D=e.createElement("div");var w=new h({items:[{header:S._OptionLabel_,content:D}],style:"simple",exclusive:false}).inject(u);var R=w.elements.container.querySelector(".wux-controls-expander-header");R.addClassName("smamat_subtable_expander");var H=w.elements.container.querySelector(".wux-controls-expander-body");if(H){H.setStyles({padding:"0px 25px"})}var ad=w.elements.container.firstChild.querySelector(".wux-controls-expander-header-container");ad.innerHTML="";e.createElement("span",{text:S._OptionLabel_,styles:{"font-weight":"normal",color:"#3d3d3d"}}).inject(ad);var O=[];for(W=0;W<o;++W){I=ac[W];var r=n[I];if(t[I]){r+=" "+t[I]}O.push(r)}var q=x(O);D.grab(q);for(ae=0;ae<N;++ae){af=[];for(W=0;W<o;++W){I=ac[W];af.push(P[I][ae])}L(ae+1,af).inject(q)}}else{if(N===1){for(W=0;W<o;++W){I=ac[W];af=P[I];ab=af[0];if(t[I]){ab+=t[I]}C(n[I],ab).inject(E)}}}}}}}if(!F){e.createElement("div",{text:d["simprops.noBehaviorProps"],styles:{color:"#777","padding-left":"5px","padding-top":"5px"}}).inject(u)}var K=d["simprops.behavior"]+": "+z[aa].Name;if(z[aa].isDefault===true){K+=" ("+d["simprops.defaultLabel"]+")"}var M=new h({items:[{header:K,content:u}],style:"filled-separate",exclusive:false}).inject(k.container);M.expandItem(0)}}else{e.createElement("div",{text:d["simprops.noProps"],styles:{"font-weight":"bold",color:"#777",padding:"5px"}}).inject(k.container)}}}});return k}});return g});define("DS/SMAWebMaterialUI/Collection/SMAWebTreeCollection",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/SMAWebMaterialUI/Model/SMAWebFedMaterialModel","DS/SMAWebMaterialUI/Model/SMAWebFedAttributesModel","DS/SMAWebMaterialUI/SMAWebMaterialSearch","DS/SMAWebMaterialUI/SMAWebMaterialService","DS/SMAWebMaterialUI/SMAWebMaterialManager","DS/SMAWebMaterialUI/SMAWebMaterialTagger","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(d,c,e,g,f,b,h,a,i,j){return e.extend({model:g,search:"*",setup:function(l,k){this._parent(l,k);this.treeList=[];this.mode=k.mode},sync:function(r,p,l){var o=this;if(o.mode!=="all"){return{}}switch(r){case"read":d.log("fetching initial facets");var k=a._getTreeConfig();var q=k[0].tag;var n=i.getFilters();var m;m=b.getData({query:"facets",path:[""],pathTags:k,filterTags:n.tags,addFilter:n.search,onComplete:function(s){o.treeList=o._buildTree(s,q);if(o.treeList.length===0){l.onComplete([{id:"@@EMPTY"}])}else{l.onComplete(o.treeList)}i.set(s.facets);i.setFacets(s.facets)},onError:function(){l.onComplete([{id:"@@FAIL"}])}});if(m){this.treeList=this._buildTree(m,q);l.onComplete(this.treeList)}break;default:throw new Error("Unsupported method")}return{onCancel:function(){}}},_buildTree:function(o,q){var n;var m;var p=[];n=h.transform(o);var l=n[q];if(l){for(m=0;m<l.length;++m){var k=l[m];p.push({id:k.id,searchId:k.id,title:k.title,count:k.count,treeType:"folder",mtpath:[""],mtdisp:[""],level:0})}}return(p)},toCsv:function(l){var m=new f().keys();var k=[];k.push(m.map(function(n){return j[n]}).join(","));this.forEach(function(p){if(l(p.id)){var o=p.get("properties");var q=[];for(var n=0;n<m.length;++n){q.push('"'+o[m[n]]+'"')}k.push(q.join(","))}});return k.join("\n")}})});define("DS/SMAWebMaterialUI/Collection/SMAWebExplorerCollection",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/SMAWebMaterialUI/Model/SMAWebFedMaterialModel","DS/SMAWebMaterialUI/Model/SMAWebFedAttributesModel","DS/SMAWebMaterialUI/SMAWebMaterialSearch","DS/SMAWebMaterialUI/SMAWebMaterialService","DS/SMAWebMaterialUI/SMAWebMaterialManager","DS/SMAWebMaterialUI/SMAWebMaterialTagger","DS/SMAWebMaterialUI/Service/SMAWebUtils","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(f,c,g,d,i,h,b,j,a,k,l,e){return g.extend({model:i,setup:function(n,m){this._parent(n,m);this.selectedItem=m._modelKey._attributes;this.getSearchFilter=m.getSearchFilter;this.treeView=m.skeleton.getViewAt(0)},sync:function(m,r,x){var s=this;switch(m){case"read":if(s.selectedItem.treeType==="folder"){var p=s.getSearchFilter();var n=a._getTreeConfig();var o=k.getFilters();var u=s.selectedItem.level;var v=s.selectedItem.mtpath.slice(0);var q=s.selectedItem.mtdisp.slice(0);v.push(s.selectedItem.searchId);q.push(s.selectedItem.title);if(u+1===n.length){b.getData({query:"materials",path:v,pathTags:n,filter:p,filterTags:o.tags,addFilter:o.search,onComplete:function(A){var z=j.transform(A);var B=z.materials.length;for(var y=0;y<B;++y){z.materials[y].mtpath=v;z.materials[y].mtdisp=q}s.treeView.addCollection(z.materials);x.onComplete(z.materials)}})}else{var t=n[u+1].tag;var w=n[u].tag;b.getData({query:"facets",path:v,pathTags:n,filter:p,filterTags:o.tags,addFilter:o.search,onComplete:function(D){var z=j.transform(D);var y=0;var F=z[w][0].count;var G=z[t];var H=d.getWebappsAssetUrl("SMAWebMaterialUI","icons/folder_thumbnail.png");if(G){for(var E=0;E<G.length;++E){G[E].folderIcon=H;var A=G[E].searchId;for(var C=u+1;C>0;--C){A=A+"@@"+v[C]}A=l.toModelId(A);G[E].id=A;G[E].mtpath=v;G[E].mtdisp=q;G[E].treeType="folder";G[E].level=u+1;y+=G[E].count}}else{G=[]}if(y!==F){var B={};B.searchId="$nonconformal$";B.count=F-y;B.title=e["folder.nonconformal"];B.folderIcon=H;var A=B.searchId;for(var C=u+1;C>0;--C){A=A+"@@"+v[C]}A=l.toModelId(A);B.id=A;B.mtpath=v;B.mtdisp=q;B.treeType="folder";B.level=u+1;G.push(B)}s.treeView.addCollection(G);x.onComplete(G)}})}}break;default:throw new Error("Unsupported method")}return{onCancel:function(){}}}})});define("DS/SMAWebMaterialUI/Views/SMAWebFolderView",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","DS/Core/Events","DS/Tree/FileTreeView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAWebMaterialUI/SMAWebMaterialSearch","DS/SMAWebMaterialUI/SMAWebMaterialService","DS/SMAWebMaterialUI/SMAWebMaterialDrag","DS/SMAWebMaterialUI/SMAWebMaterialManager","DS/SMAWebMaterialUI/SMAWebMaterialTagger","DS/SMAWebMaterialUI/SMAWebMaterialRequest","DS/SMAWebMaterialUI/SMAWebMaterialTree","DS/SMAWebMaterialUI/Service/SMAWebUtils","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(d,m,g,r,n,l,i,h,j,e,c,a,f,b,s,q,p,k){var o=n.extend({tagName:"div",className:"folderView",setup:function(t){this.skeleton=t.skeleton;this.panel=t.panel;this.isSingleSelect=this.panel.isSingleSelect;this.isWebInWin=this.panel.isWebInWin;this.searchFilter="";this._rendered=false;this._drawing=false;this._ignoreAddEvent=0;this.postSelectId=null;this.openFirstFolder=false;this.openFirstRoot=true;this.elements.noResults=d.createElement("span",{"class":"smawebmat_noresults",text:k.noResults}).inject(this.skeleton.getContent());this.elements.noSearch=d.createElement("span",{"class":"smawebmat_noresults",text:k.noSearch}).inject(this.skeleton.getContent());this.elements.noMaterials=d.createElement("span",{"class":"smawebmat_noresults",text:k.noMaterials}).inject(this.skeleton.getContent());this.elements.noResults.hide();this.elements.noSearch.hide();this.elements.noMaterials.hide();this._maxPreLoad=256;this.applyCallback=f._getApplyCallback();this.fixApplied=true},fixBadgeBug:function(){var t=document.getElementsByClassName("wux-layouts-treeview-badge"),u=t.length;while(u--){t[u].style.display="none"}},render:function(){var v=this;var w=new h({useAsyncPreExpand:true,shouldBeEditable:function(){return false},shouldAcceptDrag:function(){return true},shouldAcceptDrop:function(){return false},});v.tree=new i({treeDocument:w,apiVersion:2,height:"auto",onDragStartCell:function(x,A){var z=A.nodeModel.options.data;if(z.treeType==="material"&&!v.isSingleSelect){var y=v.collection.get(z.id);if(y){a.setDragData(x,y)}}},onDragEndCell:function(){},onDropCell:function(){},onDragEnterCell:function(){},onDragOverCell:function(){},onDragLeaveCell:function(){},onContextualEvent:{callback:function(A){if(A&&A.treeview&&!v.isSingleSelect){var z=A.treeview;if(z&&z.nodeModel){var x=z.nodeModel.options.data;if(x.treeType==="material"){if(v.isWebInWin){s.send("VPMContextMenu",x.id);return null}else{if(v.applyCallback){var y=[];y.push({type:"PushItem",title:k["menu.apply"],action:{callback:function(){v.unselectAll();z.nodeModel.select();if(v.applyCallback){v.applyCallback(x)}}}});y.push({type:"PushItem",title:k["menu.properties"],action:{callback:function(){v.selectItemById(x.id)}}});return y}}}}}return null}}}).inject(this.container);if(!this.fixApplied){if(this.isWebInWin){v.tree.elements.container.addEventListener("DOMNodeInserted",function(x){v.fixBadgeBug();x.stopPropagation()},true)}else{if(v.tree.elements.container){var t=new MutationObserver(v.fixBadgeBug);t.observe(v.tree.elements.container,{attributes:true,subtree:true})}}this.fixApplied=true}var u=v.tree.getManager();u.onCellClick(function(z){var y=z.model.options.value.options.data;if(y.id){v.panel.onSelect();if(y.treeType==="folder"){var x=v.collection.get(y.id);if(x&&v.skeleton.container.clientWidth>560){v.dispatchEvent("onItemViewSelect",x)}else{v.skeleton.slideBack()}}else{var x=v.collection.get(y.id);if(x){v.dispatchEvent("onItemViewSelect",x)}else{v.skeleton.slideBack()}}}});w.styleCount=function(x){return("  <span class='smawebmat_hitcount'>("+x+")</span>")};w.onPreExpand(function(x){if(v._drawing){x.target.preExpandDone();return}var y=f._getTreeConfig();var B=b.getFilters();var A=x.target.options.data.level;var C=x.target.options.data.mtpath.slice(0);C.push(x.target.options.data.searchId);var z;if(A+1===y.length){z=e.getData({query:"materials",path:C,pathTags:y,filter:v.searchFilter,filterTags:B.tags,addFilter:B.search,onComplete:function(D){w._makeMaterials(v.collection,x,D);v.postSelect();x.target.preExpandDone()},onError:function(){x.target.preExpandDone()}})}else{z=e.getData({query:"facets",path:C,pathTags:y,filter:v.searchFilter,filterTags:B.tags,addFilter:B.search,onComplete:function(D){w._makeFolders(v.collection,x,D);v.postSelect();x.target.preExpandDone()},onError:function(){x.target.preExpandDone()}});if(z){w._makeFolders(v.collection,x,z);x.target.preExpandDone()}}});w.onPreCollapse(function(y){var x=v.skeleton.getViewAt(1);if(x){y.target.getChildren().forEach(function(z){if(z.options.data.id===x.model.id){v.skeleton.slideBack()}})}});w._makeFolders=function(I,N,C){var P,M;var L=c;var G=L.transform(C);var x=f._getTreeConfig();var B=N.target.options.data.level;var J=x[B+1].tag;var O=x[B].tag;var S=G[J];if(N.target.getNumberOfChildren()>0){var A=N.target.getChildren();N.target.removeChildren(A)}var K=N.target.options.data.level;var y=N.target.options.data.mtpath.slice(0);var E=N.target.options.data.mtdisp.slice(0);y.push(N.target.options.data.searchId);E.push(N.target.options.data.title);var H=0;var Q=G[O][0].count;var z=null;if(S){for(P=0;P<S.length;++P){var T=S[P];var R=T.searchId;for(M=K+1;M>0;--M){R=R+"@@"+y[M]}R=p.toModelId(R);var D={id:R,title:T.title,searchId:T.searchId,mtpath:y,mtdisp:E,level:K+1,treeType:"folder"};var F=N.target.addChild(new j({label:T.title+this.styleCount(T.count),icons:[],children:[],data:D}));if(P===0){z=F}I.push(D,{silent:true});H+=T.count}}if(H!==Q){var T={};T.searchId="$nonconformal$";T.count=Q-H;T.title=k["folder.nonconformal"];d.log(T.count+" non-conformal materials found");var R=T.searchId;for(M=K+1;M>0;--M){R=R+"@@"+y[M]}R=p.toModelId(R);var D={id:R,title:T.title,searchId:T.searchId,mtpath:y,mtdisp:E,level:K+1,treeType:"folder"};var F=N.target.addChild(new j({label:T.title+this.styleCount(T.count),icons:[],children:[],data:D}));I.push(D,{silent:true});if(!z){z=F}}if(v.openFirstFolder&&z){z.expand()}};w._makeMaterials=function(E,x,B){var C;var z=c;var y=z.transform(B);var I=y.materials;var J=true;if(x.target.getNumberOfChildren()!==0){var H=[];x.target.getChildren().forEach(function(K){H.push(K)});x.target.removeChildren(H);J=false}var G=x.target.options.data.mtpath.slice(0);var D=x.target.options.data.mtdisp.slice(0);G.push(x.target.options.data.searchId);D.push(x.target.options.data.title);var A=I.length;for(C=0;C<A;++C){I[C].mtpath=G;I[C].mtdisp=D;var F=I[C];x.target.addChild(new j({label:F.title,icons:[F.thumbnail],data:{id:F.id,title:F.title,name:F.name,mtpath:G,mtdisp:D,treeType:"material"}}));if(J){E.push(F,{silent:true})}}if(v.openFirstFolder){v.openFirstFolder=false}};if(!this._rendered){this.listenTo(this.collection,{onAdd:function(){var K,J,I;this.elements.noSearch.hide();this.elements.noMaterials.hide();if(this.collection.get("@@FAIL")){this.elements.noSearch.show();this.collection.reset();return}if(this.collection.get("@@EMPTY")){this.elements.noMaterials.show();this.collection.reset();return}if(v._ignoreAddEvent){--v._ignoreAddEvent;if(v._ignoreAddEvent===0){var D=this.collection.clone();var B=D.size();this.collection.reset();for(J=0;J<B;++J){var C=D.at(J);if(C.get("treeType")==="folder"){var x=C.get("level");var z=C.get("mtpath");var M=C.get("searchId");for(I=x;I>0;--I){M=M+"@@"+z[I]}M=p.toModelId(M);C.set("id",M)}this.collection.push(C,{silent:true})}D.reset()}return}var L=[];var E={};var N={};var P=[];var B=this.collection.size();var y=f._getTreeConfig();for(K=0;K<y.length;++K){for(J=0;J<B;++J){var C=this.collection.at(J);if(C.get("treeType")==="folder"){var x=C.get("level");if(x!==K){continue}var H=C.get("id");var A=C.get("searchId");var z=C.get("mtpath");var G=z.slice(-1);var M=A;for(I=x;I>0;--I){M=M+"@@"+z[I]}M=p.toModelId(M);var O=new j({label:C.get("title")+w.styleCount(C.get("count")),icons:[],children:[],data:{id:M,searchId:A,title:C.get("title"),mtpath:z,mtdisp:C.get("mtdisp"),level:x,treeType:"folder"}});E[H]=O;if(H!==A){N[H]=A}if(x===0){w.addChild(O);P.push(O)}else{E[G].addChild(O)}L.push(O)}}}for(K=0;K<B;++K){var C=this.collection.at(K);if(C.get("treeType")==="material"){var z=C.get("mtpath");var G=z.slice(-1);E[G].addChild(new j({label:C.get("title"),icons:[C.get("thumbnail")],data:{id:C.get("id"),title:C.get("title"),name:C.get("name"),mtdisp:C.get("mtdisp"),treeType:"material"}}));for(J=1;J<z.length;++J){var H=z[J];if(N.hasOwnProperty(H)){z[J]=N[H]}}C.set("mtpath",z)}}for(K=0;K<L.length;++K){var z=L[K].options.data.mtpath;var F=false;for(J=1;J<z.length;++J){var H=z[J];if(N.hasOwnProperty(H)){L[K].options.data.mtpath[J]=N[H];F=true}}if(F){var x=L[K].options.data.level;var M=L[K].options.data.searchId;for(I=x;I>0;--I){M=M+"@@"+z[I]}M=p.toModelId(M);L[K].options.data.id=M}}if(P.length<L.length){v._drawing=true;for(K=0;K<P.length;++K){P[K].expandAll()}v._drawing=false}else{if(v.openFirstRoot){P[0].expand();v.openFirstRoot=false}}if(B){v._ignoreAddEvent=B-1}}});this._rendered=true}return this},getSelectedMaterialIds:function(){return this.tree.getDocument().getSelectedNodes().filter(function(t){return t.options.data.treeType==="material"}).map(function(t){return t.options.data.id})},getNodeById:function(v){var u=this.tree.getDocument();var t=u.search({match:function(w){if(w.nodeModel.options.data.id===v){return true}return false}});if(t){return t[0]}else{return null}},unselectAll:function(){this.tree.getDocument().getSelectedNodes().map(function(t){t.unselect();return 0})},postSelect:function(){if(this.postSelectId){var t=this.getNodeById(this.postSelectId);if(t){this.unselectAll();t.select()}this.postSelectId=null;this.panel.onSelect()}},addCollection:function(t){this.collection.add(t,{silent:true})},selectItemById:function(u){var z=this.collection.get(u);if(z){this.dispatchEvent("onItemViewSelect",z);var x=z.get("mtpath");var t=z.get("level");var w=z.get("treeType");if(w==="material"){t=f._getTreeConfig().length}if(t>0){var v=x[t];for(var y=t-1;y>0;--y){v=v+"@@"+x[y]}v=p.toModelId(v);var B=this.getNodeById(v);if(B){if(B.isExpanded()){var A=this.getNodeById(u);if(A){this.unselectAll();A.select()}}else{this.postSelectId=u;B.expand()}}}else{var A=this.getNodeById(u);if(A){this.unselectAll();A.select()}}this.panel.onSelect()}},show:function(){},showRecentMaterials:function(){this.elements.noMaterials.hide();this.doneSearching=false;this.showMaterials(c.getRecentMaterials.bind(c))},showInSessionMaterials:function(){this.elements.noMaterials.hide();this.doneSearching=false;this.showMaterials(c.getInSessionMaterials.bind(c),true)},showFavorites:function(){this.showMaterials(c.getFavoritesMaterials.bind(c),true)},showMyMaterials:function(){this.showMaterials(c.getMyMaterials.bind(c))},showMaterials:function(t,w){var u=this;if(u.doneSearching){return}u.collection.reset();var v=u.tree.getDocument();v.empty();t().then(function(x){u.elements.noMaterials.hide();if(x.length===0){u.elements.noMaterials.show()}u.collection.add(x,{silent:true});if(true===w){if(!u.collection.comparator){u.collection.comparator="titleUpperCase"}u.collection.sort()}u.collection.forEach(function(y){v.addChild(new j({label:y.get("title"),icons:[y.get("thumbnail")],data:{id:y.get("id"),title:y.get("title"),name:y.get("name"),treeType:"material"}}))});u.doneSearching=true},function(x){d.log(x)})},showSearchResults:function(u,z){var x=this;if(x._drawing){return}x._drawing=true;x.searchFilter=u;x.elements.noResults.hide();x.elements.noSearch.hide();x.skeleton.slideBack();x.collection.reset();var y=x.tree.getDocument();y.empty();var t=f._getTreeConfig();var w=b.getFilters();var A=t[0].tag;var v=e.getData({query:"filter",path:[""],pathTags:t,filter:u,filterTags:w.tags,addFilter:w.search,onComplete:function(F){x._drawing=false;var E=c.transform(F);z("("+F.infos.nhits+")");b.set(F.facets);if(F.infos.nhits===0){x.elements.noResults.show()}else{if(F.infos.nhits===F.infos.nresults){var D=q.buildTree(F,E,t);x.collection.add(D)}else{var B=x.collection._buildTree(F,A);if(B){var C;for(C=0;C<B.length;++C){var H=B[C];var G=y.addChild(new j({label:H.title+y.styleCount(H.count),icons:[],children:[],data:{id:H.id,searchId:H.searchId,title:H.title,mtpath:[""],mtdisp:[""],level:0,treeType:"folder"}}));if(F.infos.nhits<40){G.expandAll()}else{if(C===0){x.openFirstFolder=true;G.expand()}}}x.collection.add(B,{silent:true})}}}},onError:function(B){x._drawing=false;z("(0)");x.elements.noSearch.show()}});if(v){}},showFilterResults:function(){var v=this;if(v._drawing){return}v._drawing=true;v.skeleton.slideBack();v.collection.reset();var w=v.tree.getDocument();w.empty();var t=f._getTreeConfig();var u=b.getFilters();var x=t[0].tag;e.getData({query:"filter",path:[""],pathTags:t,filterTags:u.tags,addFilter:u.search,onComplete:function(A){v._drawing=false;var y=v.collection._buildTree(A,x);if(y){var z;for(z=0;z<y.length;++z){var B=y[z];w.addChild(new j({label:B.title+w.styleCount(B.count),icons:[],children:[],data:{id:B.id,searchId:B.searchId,title:B.title,mtpath:[""],mtdisp:[""],level:0,treeType:"folder"}}))}}v.collection.add(y,{silent:true});b.set(A.facets)}})},updateFacets:function(){var t=f._getTreeConfig();var u=b.getFilters();e.getData({query:"filter",path:[""],pathTags:t,filterTags:u.tags,addFilter:u.search,onComplete:function(v){b.set(v.facets)}})},showAll:function(){},destroy:function(){this.stopListening();this.tree.destroy();this._parent()}});return o});define("DS/SMAWebMaterialUI/Views/SMAWebDialogUtils",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","UWA/Controls/Abstract","DS/Core/Events","DS/Windows/Dialog","DS/Controls/Button","DS/SMAWebMaterialUI/SMAWebMaterialManager"],function(d,j,h,c,f,b,i,g,a){var e={showDialogMessage:function(n,m,k){var l=this;if(l.dialog){l.dialog.destroy();l.dialog=null}l.dialog=new i({title:n,content:d.createElement("div",{html:"<p>"+m+"</p>"}),immersiveFrame:a.getImmersiveFrame(),buttons:{Ok:new g({onClick:function(q){var o=q.dsModel;var p=o.dialog;p.close();k(null,true)}}),Cancel:new g({onClick:function(q){var o=q.dsModel;var p=o.dialog;p.close();k(null,false)}})}});l.dialog.bringToFront();l.dialog.inject(a.getUIFrame())},showDialogPanel:function(m,l){var k=this;if(k.dialog){k.dialog.destroy();k.dialog=null}k.dialog=new i({title:m,content:l,closeButtonFlag:false,immersiveFrame:a.getImmersiveFrame(),buttons:{Ok:new g({onClick:function(){if(d.typeOf(l.ok)==="function"){l.ok()}}}),Close:new g({onClick:function(){if(d.typeOf(l.close)==="function"){l.close()}}})}});k.dialog.bringToFront();k.dialog.inject(a.getUIFrame());l.addEvent("onClose",function(){l.destroy();l=null;k.dialog.close();k.dialog.destroy();k.dialog=null})}};return e});define("DS/SMAWebMaterialUI/SMAWebMaterialFilter",["UWA/Core","UWA/Controls/Abstract","DS/Windows/Panel","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/SMAWebMaterialUI/SMAWebMaterialTagger","DS/SMAWebMaterialUI/SMAWebMaterialManager","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebTagSpecifiers","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(f,g,c,j,d,k,h,b,i,e){var a=g.extend({init:function(l){this.panel=null;this.isWebInWin=typeof(dscef)!=="undefined";this.selectPrompt=e.select;this.namePrompt=e.name;this.filterList=[this.selectPrompt,this.namePrompt];this.palette=l.palette;this.rowAttr="data-rowid"},show:function(l){if(!this.panel){if(!this.quickFilters){this._buildFilters()}this._buildPanel(l)}},hide:function(){this.panel.close()},toggle:function(l){if(!this.panel){this.show(l)}else{if(this.panel.visibleFlag===true){this.hide()}else{this.show()}}},createRow:function(){this._removeBottomRow();this._addRow();++this.numFilters;this._addBottomRow()},deleteRow:function(l){var n=l.target.getParent();while(n&&n.tagName!=="TR"){n=n.getParent()}if(n){var m=n.getAttribute(this.rowAttr);if(m){delete this.allRows[m]}this.grid.removeChild(n);--this.numFilters}if(!this.numFilters){this.createRow()}},applyFilters:function(){var w,n,o,s,m,p;var r=Object.keys(this.allRows);var q=r.length;var v=this.palette.getSearchFilter();var l="";h.clearAllFilters();var u={};var t="";for(p=0;p<q;++p){w=this.allRows[r[p]];s=w.filterCombo.currentValue;if(s===this.selectPrompt){continue}if(s===this.namePrompt){if(l!==""){l+=" OR "}l=l+w.nameField.value}else{m=w.facetCombo.currentValue;if(m===""){continue}n=this.quickFilters[s];if(!n){continue}o=n.facets[m];if(!o){continue}if(!u.hasOwnProperty(n.tag)){u[n.tag]=[]}if(o.hasOwnProperty("dispValue")){t=o.dispValue}else{t=o.object}u[n.tag].push({disptext:t,object:o.object,type:o.type,field:[o.field]})}}h.setFilters(u);if(l!==v){this.palette.setSearchField(l)}else{this.palette.tagChange()}},_buildPanel:function(l){this._position={};if(this.palette.topbarContainer.clientWidth<510){this._position.of=this.palette.topbarContainer;this._position.my="top left";this._position.at="bottom left"}else{if(l.target){this._position.of=l.target.elements.container.firstChild;this._position.my="top left";this._position.at="bottom left"}}this.container=new f.Element("div");this.container.addClassName("smawebmat_filterpanel");this.container.style.width="300px";this.grid=new f.Element("table",{"class":"smawebmat_filterpanel"}).inject(this.container);this.rowId=0;this.allRows={};this.numFilters=0;this._drawFilters();this.panel=new c({title:e.filterTitle,content:this.container,position:this._position});this.panel.elements.container.setStyles({"z-index":1001});this.panel.inject(b.getUIFrame());this.panel.addEventListener("close",function(){this.panel=null}.bind(this))},_getAttr:function(l){var m=l;var n=l.substr(1).lastIndexOf("/")+1;if(n>0){m=l.slice(n+1)}return m},_buildFilters:function(){this.quickFilters={};var r=h.getFacets();var n=b._getQuickFilters();var t="";for(var q=0;q<r.length;++q){var m=r[q];var s=this._getAttr(m.sixw);for(var p=0;p<n.length;++p){var l=n[p];if(l.tag===s){var o=i[m.sixw];if(!this.quickFilters.hasOwnProperty(o)){this.quickFilters[o]={tag:m.sixw,label:o,facets:{},menu:[""]};this.filterList.push(o)}if(m.hasOwnProperty("dispValue")){t=m.dispValue}else{t=m.object}this.quickFilters[o].menu.push(t);this.quickFilters[o].facets[t]=m}}}},_drawFilters:function(){var n,s;var t=this.palette.getSearchFilter();if(t){this._addRow({filter:this.namePrompt,facet:t});++this.numFilters}var l=h.getFilters();var o=l.tags;var p=Object.keys(o);var m=p.length;for(var r=0;r<m;++r){s=p[r];n=o[s];for(var q=0;q<n.length;++q){this._addRow({filter:i[s],facet:n[q].disptext});++this.numFilters}}this._addBottomRow()},_selectFilter:function(){var m=this.filterCombo.currentValue;if(m===e.name){this.nameField.show();this.facetCombo.hide()}else{this.nameField.hide();this.facetCombo.show();var l=this.filterPanel.quickFilters[m];if(l&&l.menu){this.facetCombo.disabled=false;this.facetCombo.elementsList=l.menu;this.facetCombo.selectedIndex=0}else{this.facetCombo.disabled=true;this.facetCombo.elementsList=[""]}}},_addRow:function(v){if(!v){v={}}var t,r,u,l,n,q;t=new f.Element("tr").inject(this.grid);r=new f.Element("td",{"class":"smawebmat_filterpanel",}).inject(t);q=this.filterList;l=new k({elementsList:q,enableSearchFlag:false,selectedIndex:0,actionOnClickFlag:false}).inject(r);if(v.filter){l.currentValue=v.filter}l.elements.container.setStyles({"min-width":"100px",width:"100%"});r=new f.Element("td",{"class":"smawebmat_filterpanel"}).inject(t);r.setStyles({"max-width":"75px"});u=new f.Element("span",{text:" = "}).inject(r);r=new f.Element("td",{"class":"smawebmat_filterpanel"}).inject(t);q=[""];if(v.filter){var m=this.quickFilters[v.filter];if(m&&m.menu){q=m.menu}}n=new k({elementsList:q,selectedIndex:0,enableSearchFlag:true,}).inject(r);n.elements.container.setStyles({"min-width":"80px",width:"100%"});if(v.facet){n.currentValue=v.facet}else{n.disabled=true}var o=25;if(this.isWebInWin){o=20}var p=new d({autoCommitFlag:false,sizeInCharNumber:o}).inject(r);p.hide();if(v.filter===this.namePrompt){p.show();n.hide();p.value=v.facet}r=new f.Element("td",{"class":"smawebmat_filterpanel"}).inject(t);r.setStyles({"min-width":"15px"});new f.Element("div",{"class":"smawebmat_filterremove"}).inject(r);r.addEvent("click",function(w){this.deleteRow(w)}.bind(this));var s={rowId:this.rowId,filterCombo:l,operatorCombo:u,facetCombo:n,nameField:p,filterPanel:this};t.setAttribute(this.rowAttr,this.rowId);this.allRows[this.rowId]=s;++this.rowId;l.addEventListener("change",this._selectFilter.bind(s))},_addBottomRow:function(){var n=this;var l,m;if(!this.numFilters){this._addRow();++this.numFilters}this.bottomRow=new f.Element("tr").inject(this.grid);l=new f.Element("td",{"class":"smawebmat_filterpanel",colspan:1}).inject(this.bottomRow);m=new f.Element("div",{"class":"smawebmat_filteradd"}).inject(l);m.addEvent("click",function(){n.createRow()});l=new f.Element("td",{"class":"smawebmat_filterpanel",colspan:2}).inject(this.bottomRow);var o=f.createElement("div",{styles:{"text-align":"right",}}).inject(l);m=new j({label:e["palette.ok"],onClick:function(){n.applyFilters();n.panel.close()}}).inject(o);f.createElement("div",{styles:{display:"inline-block",width:"5px"}}).inject(o);m=new j({label:e["palette.cancel"],onClick:function(){n.panel.close()}}).inject(o)},_removeBottomRow:function(){this.grid.removeChild(this.bottomRow)}});return a});define("DS/SMAWebMaterialUI/Views/SMAWebIDCardView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","DS/Controls/Button","DS/SMAWebMaterialUI/SMAWebMaterialRequest","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(h,g,b,f,e,d,c){var a=f.extend({tagName:"div",domEvents:{"click button.wux-ui-state-primary":"onCancel","click button.wux-ui-state-secondary":"onCancel"},render:function(){var k=this;if(k.container.innerHTML!==""){k.container.innerHTML=""}else{if(this.options.onContextMenu){k.container.addEvent("contextmenu",this.options.onContextMenu.bind(k))}k.container.setStyles({"text-align":"left",background:"white",height:"100%",padding:"0px 10px",overflow:"auto"})}var j=h.createElement("table",{styles:{width:"100%"}});h.createElement("tr",{html:[{tag:"th",text:c.property,styles:{"font-weight":"bold","font-size":"12px",color:"#777",padding:"3px 4px"}},{tag:"th",text:c.value,styles:{"font-weight":"bold","font-size":"12px",color:"#777",padding:"3px 4px"}}],styles:{"border-bottom":"2px solid #ddd"}}).inject(j);k.collection.forEach(function(m){var p=m.keys();for(var o=0;o<p.length;++o){var q=p[o];var n=c[q]?c[q]:q.capitalize();var l=k.getEditor(m,q);h.createElement("tr",{html:[{tag:"td",text:n,styles:{padding:"3px 3px","font-size":"12px"}},{tag:"td",html:l,styles:{padding:"3px 3px","font-size":"12px"}}],styles:{"border-bottom":"1px solid #ddd"}}).inject(j)}});k.container.grab(j);k.createFooter();var i=k.model;d.send("GetMaterialAttributesJSON",i.id,{onComplete:function(q,p){if(p!==""){var l=JSON.parse(p);var o=l.results;if(o&&o.length===1){var m=o[0].attributes;for(var n=0;n<m.length;++n){if(!m[n].hasOwnProperty("PLMName")){continue}if(m[n].PLMName!=="revision"){continue}h.createElement("tr",{html:[{tag:"td",text:c.revision,styles:{padding:"3px 3px","font-size":"12px"}},{tag:"td",text:m[n].value,styles:{padding:"3px 3px","font-size":"12px"}}],styles:{"border-bottom":"1px solid #ddd"}}).inject(j)}}}}});return k},getEditor:function(j,k){if(j.isEditable(k)){return[{tag:"span",text:j.get(k),"data-key":k,"data-mode":"view"},h.extend(j.getEditableTag(k),{"data-key":k,"data-mode":"edit",styles:{display:"none",width:"80%"}})]}else{var i=j.get(k);if(i===""){i="(None)"}return[{tag:"span",text:i}]}},createFooter:function(){var i=this;var j=new h.Element("div",{"class":"footer wux-control-inline-container",styles:{"vertical-align":"top",display:"none","margin-top":"5px"}});new e({label:"Ok",emphasize:"primary"}).inject(j);new e({label:"Cancel",emphasize:"secondary"}).inject(j);i.container.grab(j)},onEdit:function(){var i=this;i.getElement(".footer").toggle();i.getElements("[data-mode=view]").forEach(function(j){j.toggle()});i.getElements("[data-mode=edit]").forEach(function(j){j.toggle()})},onCancel:function(){var i=this;i.getElement(".footer").hide();i.getElements("[data-mode=view]").forEach(function(j){j.show()});i.getElements("[data-mode=edit]").forEach(function(j){j.hide()})}});return a});define("DS/SMAWebMaterialUI/SMAWebMaterialPalette",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/Core/Events","DS/W3DXComponents/Skeleton","DS/W3DXComponents/ContentSet","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/Views/Layout/GridScrollView","DS/W3DXComponents/Views/Layout/TableScrollView","DS/W3DXComponents/Views/Item/TileView","DS/W3DXComponents/Views/Item/ThumbnailView","DS/SMAWebMaterialUI/Collection/SMAWebTreeCollection","DS/SMAWebMaterialUI/Collection/SMAWebExplorerCollection","DS/SMAWebMaterialUI/Model/SMAWebFedAttributesModel","DS/SMAWebMaterialUI/Views/SMAWebFolderView","DS/SMAWebMaterialUI/Views/SMAWebIDCardView","DS/SMAWebMaterialUI/Views/SMAWebSimCardView","DS/SMAWebMaterialUI/Views/SMAWebAppearCardView","DS/SMAWebMaterialUI/SMAWebMaterialDrag","DS/SMAWebMaterialUI/SMAWebMaterialManager","DS/SMAWebMaterialUI/Service/SMAWebUtils","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(g,p,n,q,f,a,d,c,l,m,s,h,w,r,b,i,j,u,e,k,v,o){var t=f.extend({init:function(N){var J=this;this.getSearchFilter=N.getSearchFilter;this.panel=N.panel;this.isSingleSelect=this.panel.isSingleSelect;this.isWebInWin=this.panel.isWebInWin;J._applyCallback=k._getApplyCallback();var x={contents:{useInfiniteScroll:false,usePullToRefresh:true},skeleton:J,panel:J.panel};var E=function(O){e.setDragData(O,this.model)};var C={onDblClick:function(){if(this.model){var O=J.getViewAt(0);O.selectItemById(this.model.id)}},onClick:function(){if(this.model&&J.isSingleSelect){J.panel.onSelect()}},onItemRendered:function(){if(this.container){if(this.container.hasClassName("thumbnail-container")){this.container.addClassName("smawebmat_thumbitem")}else{if(this.container.hasClassName("tile-container")){this.container.addClassName("smawebmat_tileitem")}else{if(this.container.hasClassName("row-container")){if(J.isWebInWin&&!J.isSingleSelect){this.container.addEvent("contextmenu",C.onContextMenu.bind(this))}}}}if(this.model&&J.isSingleSelect){this.container.setAttribute("data-matid",this.model.id)}}}};if(!J.isSingleSelect){C.onDrag=E;C.onContextMenu=function(){if(J.isWebInWin&&!J.isSingleSelect){var O=this.model;dscef.sendString("VPMContextMenu",O.id)}return null}}var L={mapping:{image:"preview",subtitle:"matType",content:function(){var O=this.model.get("classification");if(O!==""){O=o.classification+": "+O}return O}},events:C};if(!J.isSingleSelect&&!J.isWebInWin){L.contextualActions=function(){var O=[];if(J._applyCallback){O.push({text:o["menu.apply"],handler:function(Q){var P=Q.model;if(J._applyCallback){J._applyCallback({objectType:"material",title:P.get("title"),name:P.get("name"),id:P.get("id")})}}});O.push({text:o["menu.properties"],handler:function(Q){if(Q.model){var P=J.getViewAt(0);P.selectItemById(Q.model.id)}}})}return O}}var A=[{label:o.name,property:"title"},{label:o.matType,property:"matType"},{label:o.classification,property:"classification"},];var G={mapping:{image:"folderIcon",subtitle:function(){return o["material.count.prefix"]+this.model.get("count")+o["material.count.suffix"]}},events:C};var B={getSearchFilter:J.getSearchFilter,skeleton:J};var y={onRender:function(){var ac;var R=this.model.get("treeType");if(R==="folder"){var S=g.createElement("hr").inject(this.container);S.classList.add("smawebmat_breadcrumb");ac=this.container.querySelector(".title-section");var X=this.container.querySelector(".actions-list");if(X){while(X.firstChild){X.removeChild(X.firstChild)}}}else{var aa=this.container.querySelector(".title-section");aa.classList.add("smawebmat_idcard");ac=g.createElement("div");ac.classList.add("smawebmat_breadcrumb");var W=this.container.querySelector(".main-section");var Y=this.container.querySelector(".info-and-thumbnail-section");W.insertBefore(ac,Y);if(J.isWebInWin&&!J.isSingleSelect){this.container.addEvent("contextmenu",C.onContextMenu.bind(this))}var Z=this.container.querySelector(".facets-list");Z.setStyles({display:"inline-flex"});var aj=Z.children;for(var ad=0;ad<aj.length;++ad){var O=aj[ad].children[0];var ag=aj[ad].children[1];if(O&&O.classList.contains("fonticon-undefined")){aj[ad].setStyles({display:"flex","align-items":"center"});aj[ad].removeChild(O);var ae=g.createElement("div");var ai=aj[ad].getAttribute("data-name");if(ai==="Properties"){ae.addClassName("smawebmat_facet_prop")}else{if(ai==="dsc_matref_rep_SmaOptions"){ae.addClassName("smawebmat_facet_sim")}else{if(ai==="dsc_matref_rep_Rendering"){ae.addClassName("smawebmat_facet_render")}}}ag.parentNode.insertBefore(ae,ag)}}}if(ac){while(ac.firstChild){ac.removeChild(ac.firstChild)}var Q=this.model.get("mtpath");var U=this.model.get("mtdisp");var P=Q.length;var V=g.createElement("h5").inject(ac);V.classList.add("smawebmat_breadcrumb_hdr");for(var ad=1;ad<P;++ad){var ah=Q[ad];for(var ab=ad-1;ab>0;--ab){ah=ah+"@@"+Q[ab]}ah=v.toModelId(ah);var T=U[ad];var af=g.createElement("a",{text:T});af.classList.add("smawebmat_breadcrumb");af.setAttribute("data-folderId",ah);af.inject(V);V.grab(document.createTextNode(" > "))}if(R==="folder"){V.grab(document.createTextNode(this.model.get("title")))}ac.addEvent("click",function(al){var am=al.target.getAttribute("data-folderId");if(am){var ak=J.getViewAt(0);ak.selectItemById(am)}})}}};var I={treeRenderer:{collection:h,collectionOptions:{mode:N.mode},viewOptions:g.extend({events:{onItemViewDrag:function(){var O=arguments[arguments.length-1];var P=arguments[arguments.length-2];O.dataTransfer.setData("material",P.model.id)}}},x),view:b,idCardOptions:{thumbnailUrl:function(){return this.get("preview")},facets:function(){var T=this.get("treeType");if(T==="material"){var X=this.get("domains");var V=[{name:"Properties",text:o["domain.properties"],icon:"undefined",handler:f.getRendererHandler("propertiesRenderer")},];var Q=[];if(X.includes("dsc_matref_rep_SmaOptions")){Q.push("dsc_matref_rep_SmaOptions")}if(X.includes("dsc_matref_rep_Rendering")){Q.push("dsc_matref_rep_Rendering")}var R;for(R=0;R<Q.length;++R){var S=Q[R];var W=k._getIdentityCard(S);if(W){var P;if(W.hasOwnProperty("label")){P=W.label}else{P=o["domain."+S]}V.push({name:S,text:P,icon:"undefined",handler:f.getRendererHandler(S)})}}return V}else{if(T==="folder"){var U=this.get("level");var O=k._getTreeConfig();if(U+1===O.length){return[{name:"Explorer",handler:f.getRendererHandler("explorerRenderer")}]}else{return[{name:"Explorer",handler:f.getRendererHandler("explorerFolderRenderer")}]}}}return null},events:y},fetchMode:"once"},propertiesRenderer:{collection:function(O,P){return new n([P._modelKey._attributes.properties],{model:r})},view:i,viewOptions:{onContextMenu:C.onContextMenu},idCardOptions:{attributesMapping:{title:"cardname"},actions:[]},cacheFacets:false,fetchMode:"once"},explorerRenderer:{collection:w,collectionOptions:B,view:a,viewOptions:{contents:{useInfiniteScroll:false,usePullToRefresh:true,selectionMode:"nullToNull",views:[{id:"tile",title:"Tile",view:c,itemView:m,itemViewOptions:L},{id:"thumbnail",title:"Thumbnail",itemView:s,itemViewOptions:L,view:c},{id:"table",title:"Table",view:l,itemViewOptions:L},{id:"list",view:d,title:"ListView"}],headers:A}},idCardOptions:{actions:[]},fetchMode:"once"},explorerFolderRenderer:{collection:w,collectionOptions:B,view:a,viewOptions:{contents:{useInfiniteScroll:false,usePullToRefresh:true,selectionMode:"nullToNull",views:[{id:"tile",title:"Tile",view:c,itemView:m,itemViewOptions:G},{id:"thumbnail",title:"Thumbnail",itemView:s,itemViewOptions:G,view:c},{id:"list",view:d,title:"ListView"}]}},idCardOptions:{actions:[]},fetchMode:"once"}};if(k.getEnv("SMAWMT_USABILITY_2018X_FD02")){I.treeRenderer.idCardOptions.actions=function(){return[{text:o["simprops.refresh"],title:o["simprops.refresh"],icon:"arrows-ccw",handler:function(){if(this.model&&this.model._facetObjs){var P=this.model._facetObjs;for(var O=0;O<P.length;++O){P[O].view.render()}}}},{text:o["palette.materialmenu"],title:o["palette.materialmenu"],icon:"menu",handler:function(){if(this.model.id){if(typeof(dscef)!=="undefined"){dscef.sendString("VPMContextMenu",this.model.id)}}}}]}}if(this.isSingleSelect){I.explorerRenderer.viewOptions.contents.selectionMode="nullToOne"}if(k.getEnv("SMAWMT_ENHANCED_MATERIAL_PROPERTIES")){k.addIdentityCard({tag:"dsc_matref_rep_SmaOptions",renderer:j})}if(k.getEnv("SMAWMT_RENDERING_DOMAIN")){k.addIdentityCard({tag:"dsc_matref_rep_Rendering",renderer:u})}var D;var K=k._getIdentityCardList();for(D=0;D<K.length;++D){var M=K[D];var H=M.tag;var F=M.renderer?M.renderer:i;I[H]={collection:function(O,P){return new n([P._modelKey._attributes.properties],{model:p})},view:F,viewOptions:{onContextMenu:C.onContextMenu},collectionOptions:{cardname:H},idCardOptions:{attributesMapping:{title:"cardname"},actions:[]},fetchMode:"once"}}var z={root:"treeRenderer",useRootChannelView:false,responsiveTrigger:function(){if(!widget){return false}var O=widget.getView().type;if(widget.getValue("view")==="channel"){return O==="maximized"||O==="fullscreen"}else{return false}},events:{onItemSelect:function(){},onSlide:function(){},onRouteChange:function(){},onItemViewDrag:function(){}}};this._parent(I,z)}});return t});define("DS/SMAWebMaterialUI/SMAWebMaterialPanel",["UWA/Core","UWA/Controls/Abstract","DS/Core/Events","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/TabBar","DS/Controls/ComboBox","DS/Controls/Popup","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/SMAWebMaterialUI/SMAWebMaterialPalette","DS/SMAWebMaterialUI/SMAWebMaterialFilter","DS/SMAWebMaterialUI/SMAWebMaterialCompare","DS/SMAWebMaterialUI/Views/SMAWebMaterialImportPanel","DS/SMAWebMaterialUI/Views/SMAWebDialogUtils","DS/SMAWebMaterialUI/Service/SMAWebDispatcher","DS/SMAWebMaterialUI/SMAWebMaterialTagger","DS/SMAWebMaterialUI/SMAWebMaterialRequest","DS/SMAWebMaterialUI/SMAWebMaterialManager","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties","css!DS/SMAWebMaterialUI/assets/Styles/material.css"],function(d,s,r,n,x,f,h,z,C,k,o,w,u,i,p,v,c,B,g,m){var b={ALL:"all",RECENT:"recent",IN_SESSION:"inSession",FAVORTITES:"favorites",MYMATERIALS:"myMaterials",FILTER:"filterResults"};var l=[b.ALL,b.RECENT,b.IN_SESSION,b.FAVORTITES,b.MYMATERIALS,b.FILTER];var e=0;var j=1;var t=2;var A=3;var a=4;var q=5;var y=s.extend({init:function(D){this._parent(D);this.isWebInWin=typeof(dscef)!=="undefined";this.isSingleSelect=false;if(D&&D.hasOwnProperty("singleSelect")){this.isSingleSelect=true}this._quickFilter=new w({palette:this});this._comparePanel=new u(D);this._buildPanel();this._hookEvents()},destroy:function(){for(var D=0;D<l.length;++D){this.elements[l[D]].destroy()}[].forEach.call(this.bindings,function(E){E.detach()});this._parent()},selectedTab:0,unfilteredTab:0,numLines:1,_buildPanel:function(){this.elements.container=d.createElement("div",{id:"materialPanel","class":"smawebmat_panel",styles:{padding:"2px",position:"absolute",top:"2px",bottom:"5px",left:"5px",right:"5px"}});this._addTopBar();this._addSkeletons();this.onResize()},_addTopBar:function(){var L=this;L.topbarContainer=new d.Element("div",{"class":"smawebmat_topbar",styles:{height:"60px",width:"100%"}});L.tabContainer=new d.Element("div",{"class":"smawebmat_tab_container",styles:{padding:"0px",order:1}}).inject(L.topbarContainer);var I=[m["palette.tab.all"],m["palette.tab.recent"],m["palette.tab.inSession"]];I[1]=(m["palette.tab.applied"]);var F=new h({elementsList:I,enableSearchFlag:false,selectedIndex:0,actionOnClickFlag:false}).inject(L.tabContainer);F.getContent().setStyles({"min-width":"140px","vertical-align":"top","margin-top":"3px","margin-bottom":"5px"});F.addEventListener("change",function(M){if(M.dsModel.selectedIndex!==L.selectedTab){L.elements.filter.value="";L.onSelectTab(L.selectedTab,M.dsModel.selectedIndex);L.selectedTab=M.dsModel.selectedIndex;L.onSelect()}else{d.log("same tab clicked")}});L.numFiltButtons=1;if(!L.isWebInWin){++L.numFiltButtons}L.filtbarContainer=d.createElement("div",{"class":"smawebmat_filtbar_container smawebmat_noselect",styles:{"text-align":"right",height:"30px",display:"inline-block",width:23*L.numFiltButtons+8,padding:"0px",order:2}}).inject(L.topbarContainer);if(!L.isWebInWin){L.elements.tagbutton=d.createElement("div",{title:m.showTagger,"class":"smawebmat_tagger",events:{click:function(){L.onTagger()}}}).inject(L.filtbarContainer)}L.elements.filtbutton=d.createElement("div",{title:m.showFilter,"class":"smawebmat_qfilter",events:{click:function(){L.toggleFilter()}}}).inject(L.filtbarContainer);L.filterContainer=d.createElement("div",{"class":"smawebmat_filter_container",styles:{height:"30px",display:"inline-block",width:"100%","min-width":"225px"}}).inject(L.topbarContainer);d.createElement("div",{"class":"smawebmat_noselect",text:m["palette.filter"],styles:{display:"inline-block","margin-top":"5px"}}).inject(L.filterContainer);var E=document.createElement("canvas");var J=E.getContext("2d");J.font="12px Arial";var K=J.measureText(m["palette.filter"]).width+10;var D=new x({autoCommitFlag:false}).inject(L.filterContainer);L.elements.filter=D;D.getContent().setStyles({display:"inline-block","vertical-align":"top","margin-top":"3px",width:"calc(100% - "+K+"px)"});D.getContent().getChildren()[0].setStyles({width:"100%"});D.addEventListener("change",function(M){var N=M.dsModel.value;L.onSearch(N);M.dsModel._myInput.blur()});L.searchFilter="";var G=D.getContent();L.elements.dropdown=d.createElement("a",{"class":"smawebmat_search_dropdown",events:{click:function(){L._quickFilter.toggle({target:L.elements.filter})}}}).inject(G);L.elements.reset=d.createElement("a",{"class":"smawebmat_search_reset",title:m["palette.reset"],events:{click:function(){if(L.isWebInWin){c.clearAllFilters();L._removeFilterTip()}if(L.elements.filter.value===""){L._endSearch()}else{L.elements.filter.value=""}}}}).inject(G);L.elements.reset.hide();L.elements.hitcount=d.createElement("span",{"class":"smawebmat_hitcount smawebmat_search_count",}).inject(D.getContent());L.elements.hitcount.hide();L.elements.filterpopup=new z({target:null,position:"bottom",offset:{x:20,y:25},trigger:"hover",alignment:"near"});L.elements.popupContent=new d.Element("div",{styles:{"font-size":12}});L.elements.filterpopup.setBody(L.elements.popupContent);L.toolbarContainer=new d.Element("div",{styles:{"class":"smawebmat_noselect",height:"28px",width:"28px","float":"none",display:"inline-block","vertical-align":"top",padding:"3px 0px 0px 0px",position:"absolute",right:0,top:0,}}).inject(L.topbarContainer);var H;H=m["tooltip.compare"];L.elements.comparebutton=d.createElement("div",{"class":"smawebmat_toolbar smawebmat_compare smawebmat_disabled",title:H,styles:{"float":"none"},events:{click:function(){L.onCompare()}}}).inject(L.toolbarContainer);L.topbarContainer.inject(L.elements.container)},_makeFilterTip:function(D){if(this.isWebInWin){if(this.elements.dropdown){this.elements.filterpopup.position="left";this.elements.filterpopup.target=this.elements.dropdown;this.elements.popupContent.innerHTML=D}}else{if(this.elements.tagbutton){this.elements.filterpopup.target=this.elements.tagbutton;this.elements.popupContent.innerHTML=D}}},_removeFilterTip:function(){if(this.elements.filterpopup){this.elements.filterpopup.target=null}},_addSkeletons:function(){var F=this,D,H;F.paletteContainer=d.createElement("div",{styles:{position:"absolute",top:"65px",bottom:"2px",left:"2px",right:"2px",}}).inject(F.elements.container);for(var E=0;E<l.length;++E){F.elements[l[E]]=D=new o({mode:l[E],panel:F,getSearchFilter:F.getSearchFilter.bind(F)});D.leftColumnDefaultRatio=33;H=d.createElement("div",{"class":"smawebmat_skeleton",styles:{height:"100%",width:"100%","background-color":"white",display:"none"}});H.setContent(D.render());F.paletteContainer.grab(H)}F.elements[b.ALL].getContent().getParent().show();c.onTagChange(F.tagChange.bind(F));c.onSearchChange(F.tagChange.bind(F));c.onTaggerChange(F._taggerChange.bind(F));F._taggerChange(c.isVisible());if(this.isSingleSelect){F.paletteContainer.style.bottom="35px";var G=d.createElement("div",{styles:{"text-align":"right",padding:"2px",height:28,position:"absolute",right:0,bottom:0}}).inject(F.elements.container);F.elements.okbutton=new n({label:m["palette.ok"],disabled:true,onClick:F.onSingleSelect.bind(F)}).inject(G);d.createElement("div",{styles:{display:"inline-block",width:"5px"}}).inject(G);F.elements.cancelbutton=new n({label:m["palette.cancel"],onClick:F.onCancel.bind(F)}).inject(G)}},getCurrentSkeleton:function(){return this.elements[l[this.selectedTab]]},getSelections:function(){var H=this.getCurrentSkeleton();var D=H.getViewAt(0).getSelectedMaterialIds();if(D.length===0&&this.isSingleSelect){var E=H.getViewAt(1);if(E){var F=E.container.querySelector(".selected");if(F){var G=F.getAttribute("data-matid");if(G&&G!==""){D.push(G)}}}}return D},onSingleSelect:function(){var D=this.getSelections();if(D&&D[0]){if(this.isWebInWin){dscef.sendString("PLMSelectMaterial",D[0])}}},onCancel:function(){if(this.isWebInWin){dscef.sendString("Cancel")}},toggleFilter:function(){this.filterContainer.toggle();this.onResize()},_hookEvents:function(){var D=this;D.bindings=[];D.bindings.push(v.callOperationStarted.add(function(){if(this.elements.container){C.mask(D.elements.container.getParent().getParent())}},D));D.bindings.push(v.callOperatedEnded.add(function(){if(this.elements.container){C.unmask(D.elements.container.getParent().getParent())}},D));B.set("MaterialUpdateEvent",{onComplete:function(){var H=D.getCurrentSkeleton();var E=H.getViewAt(1);if(E&&E.model&&E.model._facets&&E.model._facetObjs){var I=E.model._facets;var G=E.model._facetObjs;for(var F=0;F<G.length;++F){if(I[F].name==="Explorer"){continue}G[F].view.render()}}}})},_updateHitcount:function(D){this.elements.hitcount.textContent=D},_beginSearch:function(){var D=this;if(D.selectedTab!==q){D.onSelectTab(D.selectedTab,q);D.unfilteredTab=D.selectedTab;D.selectedTab=q;var E=D.getCurrentSkeleton();E.getViewAt(0).unselectAll();D.onSelect()}},_endSearch:function(){var E=this;E.elements.reset.hide();E.elements.hitcount.hide();if(c.hasFilters()||E.elements.filter.value!==""){var F=E.getCurrentSkeleton();var D=F.getViewAt(0);D.showSearchResults(E.elements.filter.value,E._updateHitcount.bind(E))}else{E.onSelectTab(q,E.unfilteredTab);E.selectedTab=E.unfilteredTab;E.onSelect();var F=E.getCurrentSkeleton();var D=F.getViewAt(0);D.updateFacets()}},tagChange:function(){var E=this;if(c.hasFilters()){this._makeFilterTip(c.getTagString({multiline:true}));if(this.isWebInWin){E.elements.reset.show()}}else{this._removeFilterTip();if(E.elements.filter.value===""){E.elements.reset.hide()}}if(c.hasFilters()||E.elements.filter.value!==""){E._beginSearch();var F=E.getCurrentSkeleton();var D=F.getViewAt(0);D.showSearchResults(E.elements.filter.value,E._updateHitcount.bind(E))}else{E.onSelectTab(q,E.unfilteredTab);E.selectedTab=E.unfilteredTab;E.onSelect();var F=E.getCurrentSkeleton();var D=F.getViewAt(0);D.showFilterResults()}E._taggerChange(c.isVisible())},_taggerChange:function(E){var D=this;if(D.elements.tagbutton){D.elements.tagbutton.removeClassName("smawebmat_tagger");D.elements.tagbutton.removeClassName("smawebmat_taggeractive");D.elements.tagbutton.removeClassName("smawebmat_taggerfilter");D.elements.tagbutton.removeClassName("smawebmat_taggeractivefilter");if(c.hasTags()){if(E){D.elements.tagbutton.addClassName("smawebmat_taggeractivefilter")}else{D.elements.tagbutton.addClassName("smawebmat_taggerfilter")}}else{if(E){D.elements.tagbutton.addClassName("smawebmat_taggeractive")}else{D.elements.tagbutton.addClassName("smawebmat_tagger")}}}},onSearch:function(F){var G=this;var E=F.trim();G.searchFilter=E;if(E!==""){G._beginSearch();var H=G.getCurrentSkeleton();var D=H.getViewAt(0);var I=E.replace(/\*/g,"");if(I.length<3){new k({icon:true,closable:true,closeOnClick:true,visible:true,autoHide:true,hideDelay:6000,messages:[{message:m["palette.badString1"]+E+m["palette.badString2"],className:"error"}]}).inject(G.elements.container);G.elements.filter.value="";G.searchFilter=""}else{G.elements.reset.show();G._updateHitcount("");G.elements.hitcount.show();D.showSearchResults(E,G._updateHitcount.bind(G))}}else{G.elements.filter.value="";G._endSearch()}if(this.isWebInWin){if(c.hasFilters()){this._makeFilterTip(c.getTagString({multiline:true}));G.elements.reset.show()}else{this._removeFilterTip();if(G.elements.filter.value===""){G.elements.reset.hide()}}}},getSearchFilter:function(){return this.searchFilter},setSearchField:function(D){this.elements.filter.value=D},onTagger:function(){c.toggle()},onSelectTab:function(I,H){var F=this;var G=F.elements[l[I]];var E=F.elements[l[H]];if(I===q||I===j||I===t){G.slideBack();if(I===j||I===t){F.filterContainer.removeClassName("disable_container")}}G.getContent().getParent().hide();E.getContent().getParent().show();var D=E.getViewAt(0);if(H===e){D.showAll()}else{if(H===j){F.filterContainer.addClassName("disable_container");D.showRecentMaterials()}else{if(H===t){F.filterContainer.addClassName("disable_container");D.showInSessionMaterials()}else{if(H===A){D.showFavorites()}else{if(H===a){D.showMyMaterials()}else{if(H===q){}else{d.log("unknown tab")}}}}}}},onExport:function(){var H=this;if(H.elements.exportbutton.hasClassName("smawebmat_disabled")){return}var J=H.getCurrentSkeleton();var F=J.getViewAt(0).getSelectedMaterialIds();var K=J.getCollectionAt(0);var I=K.toCsv(function(L){return F.indexOf(L)>=0});var E=new Blob([I],{type:"text/csv"});var G=window.URL.createObjectURL(E);var D=document.querySelector(".materialDownloadLink");if(!D){D=document.createElement("a");D.style="display: none";D.download="Materials.csv";D.classList.add("materialDownloadLink");document.body.appendChild(D)}if(D.href){window.URL.revokeObjectURL(D.href)}D.href=G;D.click()},onImport:function(){p.showDialogPanel("Import Material",new i({}))},onSelect:function(){var D=this.getSelections();var F=D.length>1;var E=D.length>0;if(this.elements.okbutton){if(D.length===1){this.elements.okbutton.disabled=false}else{this.elements.okbutton.disabled=true}}if(this.elements.comparebutton){if(this.elements.comparebutton.hasClassName("smawebmat_disabled")){if(F){this.elements.comparebutton.removeClassName("smawebmat_disabled")}}else{if(!F){this.elements.comparebutton.addClassName("smawebmat_disabled")}}}if(this.elements.exportbutton){if(this.elements.exportbutton.hasClassName("smawebmat_disabled")){if(E){this.elements.exportbutton.removeClassName("smawebmat_disabled")}}else{if(!E){this.elements.exportbutton.addClassName("smawebmat_disabled")}}}},onCompare:function(){var E=this;if(E.elements.comparebutton.hasClassName("smawebmat_disabled")){return}var F=E.getCurrentSkeleton();var D=F.getViewAt(0).getSelectedMaterialIds();var G=F.getCollectionAt(0);E._comparePanel.toggle({target:E.elements.container,materials:D,collection:G})},onEdit:function(){d.log("on edit");var E=this.getCurrentSkeleton();var F=E.getCurrentPanelIndex();if(F>0){var D=E.getViewAt(F);if(d.typeOf(D.onEdit)==="function"){D.onEdit()}}},_setTopbarHeight:function(D){if(D===1||this.filterContainer.style.display==="none"){var F=175+20*this.numFiltButtons;var E="calc(100% - "+F+"px)";this.topbarContainer.style.height="30px";this.filterContainer.style.width=E;this.toolbarContainer.style.order=4;this.filterContainer.style.order=3;this.paletteContainer.style.top="35px"}else{this.topbarContainer.style.height="60px";this.filterContainer.style.width="100%";this.toolbarContainer.style.order=3;this.filterContainer.style.order=4;this.paletteContainer.style.top="65px"}},onResize:function(){var D=2;if(this.topbarContainer.clientWidth>395+20*this.numFiltButtons){D=1}this._setTopbarHeight(D)}});return y});define("DS/SMAWebMaterialUI/SMAWebMaterialCmd",["UWA/Core","UWA/Controls/Abstract","DS/Core/Events","DS/ApplicationFrame/Command","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/SMAWebMaterialUI/SMAWebMaterialManager","DS/SMAWebMaterialUI/SMAWebMaterialPanel","DS/SMAWebMaterialUI/SMAWebMaterialTagger","i18n!DS/SMAWebMaterialUI/assets/nls/SMAWebMaterialProperties"],function(h,j,f,e,d,i,b,a,k,g){var c=e.extend({init:function(l){l=l||{};this._parent(l,{mode:"undefined",isAsynchronous:true});this.panel=null},beginExecute:function(){return this._parent()},execute:function(){var p=this.getFrameWindow().elements._immersiveFrame;var o=this.getArguments();if(o&&(o.length>0)&&(o[0].ID==="TreeConfig")){var l;var m=parseInt(o[0].Value);if(m===2){l=[{tag:"ds6w:who/ds6w:responsible",refine:{"ds6w:what/ds6w:type":[{object:["dsc_matref_ref_Core"],type:"string",field:["implicit"]},{object:["dsc_matref_ref_Covering"],type:"string",field:["implicit"]}]}},{tag:"ds6w:what/ds6w:type"},{tag:"ds6w:how/ds6w:classification"}]}else{if(m===1){var l=[{tag:"ds6w:what/ds6w:type",refine:{"ds6w:what/ds6w:type":[{object:["dsc_matref_ref_Core"],type:"string",field:["implicit"]},{object:["dsc_matref_ref_Covering"],type:"string",field:["implicit"]}]}},{tag:"ds6w:how/ds6w:classification"}]}}b.configTreeLevels(l);if(m===2){var r=["ds6w:how/ds6w:classification","ds6w:who/ds6w:responsible","ds6w:when/ds6w:created"];b.includeTags(r)}else{if(m===1){var t=["ds6w:when/ds6w:modified","ds6w:who/ds6w:lastModifiedBy","ds6w:what/ds6w:policy","ds6w:what/ds6w:status","ds6w:what/ds6w:status/ds6w:reserved","ds6w:where/ds6w:context/ds6w:project","ds6w:who/ds6w:responsible/ds6w:organizationResponsible"];b.excludeTags(t)}}b.setApplyCallback(function(u){h.log("Apply material "+u.title+" "+u.id)})}k.initialize();this.container=new a();var n=300;var q=600;this.panel=new d({title:g.materialsTitle,content:this.container,width:n,height:q,position:{at:"center",offsetX:-n/2,offsetY:-q/2},immersiveFrame:p,resizableFlag:true});this.panel.minWidth=300;this.panel.minHeight=300;var s=this.panel.getContent().querySelector(".wux-windows-window-titlebar");s.addClassName("smawebmat_titlebar");this.panel.inject(b.getUIFrame());this.panel.addEventListener("close",function(){this.end()}.bind(this));this.panel.addEventListener("resize",this.container.onResize.bind(this.container));return this._parent()},endExecute:function(){if(this.container){this.container.destroy();this.container=null}if(this.panel){this.panel.destroy();this.panel=null}k.reset();return this._parent()}});return h.namespace("DS/SMAWcsMaterialAppUI/SMAWebMaterialCmd",c)});