/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationExpander",["UWA/Core","UWA/Class","DS/Controls/Expander","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(d,b,a){var c=a.extend({init:function(e){this._parent(e);this.displayTitle=e.displayTitle!==undefined?e.displayTitle:true},_applyHeader:function(){while(this.elements.headerContainer.firstChild){this.elements.headerContainer.removeChild(this.elements.headerContainer.firstChild)}var f=this._endOffset!==undefined&&parseFloat(this._endOffset)>50?parseFloat(this._endOffset):50;this.elements.headerContainer.setStyles({width:"calc(100% - "+f+"px)"});var e=d.createElement("h5",{"class":"headerTitle"}).inject(this.elements.headerContainer);if(this.displayTitle){e.title=this.header}e.setStyles({"font-weight":"normal","word-wrap":"break-word","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",width:"calc(100% - 7px)"});e.innerHTML=this.header}});return c});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationAttrListTable",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/WebappsUtils/WebappsUtils","DS/DataGridView/DataGridView","i18n!DS/CAT3DAnnotationBaseUI/assets/nls/CAT3DAnnotationBaseUI","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(g,b,f,e,a,c){var d=b.extend({init:function(j){this._parent(j);var h;var k;var o;var n=new f();var m=this;var i=e.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/");var l={4:i+"I_W3DAnnot_VeryHighFailureMode.png",3:i+"I_W3DAnnot_HighFailureMode.png",2:i+"I_W3DAnnot_MediumFailureMode.png",1:i+"I_W3DAnnot_LowFailureMode.png",0:i+"I_W3DAnnot_LeastImportantFailureMode.png"};this.publish=function(q,p){return n.publish({event:q,data:p,context:this})};this.addURLDiv=function(p,q){var r=g.createElement(p,{"class":"CAT3DAnnotSemAttrText CAT3DAnnotSemAttrUrl"});if(p==="a"){r.setAttributes({href:q.url})}if(q.title!==undefined&&q.title!==""){r.innerHTML=q.title;r.setAttributes({title:q.url})}else{r.innerHTML=q.url}r.addEventListener("mouseenter",function(){this.setStyles({color:"rgb(130, 190, 220)",cursor:"pointer"})});r.addEventListener("mouseleave",function(){this.setStyles({color:"#368ec4",cursor:""})});r.setStyles({color:"rgb(0, 120, 175)"});if(p!=="a"){r.linkedData=q;q.discipline=o;r.addEventListener("click",function(){m.publish("onAttributeClicked",q)})}return r};this.getRowHeight=function(r){if(!r){return 0}document.body.appendChild(r);var q=r.getStyle("position");r.setStyle("position","absolute");var p=r.offsetHeight;r.setStyle("position",q);document.body.removeChild(r);return p};this.buildLinks=function(t,s){if(!t||!t.length){return undefined}var p=new g.Element("div");p.setStyles({"padding-top":"4px"});var r;if(s==="urls"){for(r=0;r<t.length;r++){m.addURLDiv("a",t[r]).inject(p)}}else{if(s==="hiddenText"){var q;for(r=0;r<t.length;r++){q=g.createElement("p",{"class":"CAT3DAnnotSemAttrText"}).inject(p);q.innerText=t[r]}}else{for(r=0;r<t.length;r++){m.addURLDiv("p",{title:t[r].displayLabel,url:t[r].label,phyID:t[r].phyID,type:t[r].type,phyType:t[r].phyType}).inject(p)}}}return p};this.createSingleFailureDiv=function(t){var u=g.createElement("div",{"class":"CAT3DAnnotSemFailureDiv"});var r=g.createElement("div",{"class":"CAT3DAnnotSemFailureImgDiv"}).inject(u);r.setStyle("background-image","url("+l[t.crit]+")");var q=g.createElement("div",{"class":"CAT3DAnnotSemFailureTextDiv"}).inject(u);var v=g.createElement("p",{"class":"CAT3DAnnotSemFailureTextBoldDiv"}).inject(q);v.innerHTML=c.FailureModes[t.crit];for(var s=0;s<t.descriptions.length;s++){v=g.createElement("p",{"class":"CAT3DAnnotSemFailureTextValueDiv"}).inject(q);v.innerHTML=t.descriptions[s]}var p=m.getRowHeight(u);u.setStyle("height",p+"px");return u};this.buildFailureMode=function(t){if(!t||!t.length){return undefined}var s=[],q,r;var p=new g.Element("div");for(r=0;r<t.length;r++){q=t[r];if(s[q.crit]){s[q.crit].descriptions=s[q.crit].descriptions.concat(q.descriptions)}else{s[q.crit]={crit:q.crit,descriptions:q.descriptions.slice()}}}for(r=0;r<s.length;r++){if(s[r]){m.createSingleFailureDiv(s[r]).inject(p)}}return p};this.buildAttributeTable=function(p){if(k){while(k.firstChild){k.removeChild(k.firstChild)}}if(p.gridOptions){h=new a(p.gridOptions);h.inject(k);m.updateGridDisplay()}return h};this.updateGridDisplay=function(){};this.buildPanel=function(p){m.cleanPanel();k=g.createElement("div",{id:"CAT3DAnnotAttrBrowserMainDiv"});m.buildAttributeTable(p);return k};this.setDiscipline=function(p){o=p};this.getDiscipline=function(){return o};this.getDataGrid=function(){return h};this.cleanPanel=function(){if(k){while(k.firstChild){k.removeChild(k.firstChild)}}if(h){h.destroy()}h=k=null};this.destroy=function(){m.cleanPanel();n=m=null};this.subscribe=function(q,p){if(!q||!p){return undefined}return n.subscribe({event:q},p)};this.unsubscribe=function(p){if(p===null||p===undefined){return}n.unsubscribe(p)}}});return d});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI",[],function(){});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationAttrDiv",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CAT3DAnnotationUtils/CAT3DAnnotationUnits","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(f,a,e,b,d,g){var i="";var h={};require(["i18n!DS/CAT3DAnnotationBaseUI/assets/nls/CAT3DAnnotationBaseUI"],function(j){i=j.MoreLbl;h=j.FailureModes});var c=a.extend({init:function(z){this._parent(z);var j=f.createElement("div",{"class":"CAT3DAnnotationAttrDiv"});var v,q;var y,x;var n,l=[];var p=false;var r=d.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/");var k={4:"I_W3DAnnot_VeryHighFailureMode.png",3:"I_W3DAnnot_HighFailureMode.png",2:"I_W3DAnnot_MediumFailureMode.png",1:"I_W3DAnnot_LowFailureMode.png",0:"I_W3DAnnot_LeastImportantFailureMode.png"};var o;function w(){this.setStyles({color:"#368ec4",cursor:""})}function u(){this.setStyles({color:"rgb(130, 190, 220)",cursor:"pointer"})}function t(C,E){var B=f.createElement("div",{"class":"CAT3DAnnotationAttrDivTitleAndText"});if(C){var D=f.createElement("p",{"class":"CAT3DAnnotationAttrDivBoldTitle"}).inject(B);D.innerHTML=C}if(E){var A=f.createElement("p",{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivValue"}).inject(B);A.innerHTML=E}return B}function m(D){var E=f.createElement("div",{"class":"CAT3DAnnotationFailureDiv"});var B=f.createElement("div",{"class":"CAT3DAnnotationFailureImgBoxDiv"}).inject(E);f.createElement("img",{"class":"CAT3DAnnotationFailureImgDiv",src:r+k[D.crit]}).inject(B);var A=f.createElement("div",{"class":"CAT3DAnnotationFailureTextDiv"}).inject(E);var F=f.createElement("p",{"class":"CAT3DAnnotationFailureTextBoldDiv"}).inject(A);F.innerHTML=h[D.crit];for(var C=0;C<D.descriptions.length;C++){F=f.createElement("p",{"class":"CAT3DAnnotationFailureTextValueDiv"}).inject(A);F.innerHTML=D.descriptions[C]}return E}function s(A,B,D){var C=f.createElement(A,{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivUrl"});if(A==="a"){C.setAttributes({href:B.url})}if(B.title!==undefined&&B.title!==""){C.innerHTML=B.title;C.setAttributes({title:B.url})}else{C.innerHTML=B.url}C.addEventListener("mouseenter",u);C.addEventListener("mouseleave",w);C.setStyles({color:"rgb(0, 120, 175)",padding:p?"5px 0px":"2px 0px"});if(A!=="a"&&D){C.linkedData=B;l.push(b.addEvent(C,"onPrimaryPointerClick",function(){D(B)}))}return C}this.setTouchDisplay=function(D){var A=typeof D==="boolean"?D:false;if(p!==A){p=A;var C=j.querySelectorAll(".CAT3DAnnotationAttrDivUrl");if(!C.length){return}for(var B=0;B<C.length;B++){C[B].setStyles({padding:p?"5px 0px":"0px"})}}};this.getContent=function(){return j};this.buildDivWithDots=function(D){v=f.createElement("div");v.appendChild(j);var C=D.maxHeight;if(q&&o>D.maxHeight){C=0;var G=j.querySelectorAll(".CAT3DAnnotationAttrDivContent");if(G.length){G=G[0].childNodes;var F;for(var A=0;A<G.length;A++){for(var B=0;B<G[A].childNodes.length;B++){F=G[A].childNodes[B];if(C+F.divHeight<D.maxHeight){C+=F.divHeight}else{break}}}}}C=C?C:D.maxHeight;j.setStyles({"max-height":C+"px",width:"300px"});var E=f.createElement("div",{"class":"CAT3DAnnotationAttrDivDots"}).inject(v);E.innerHTML=i;n=b.addEvent(E,"onPrimaryPointerClick",function(H){H.from[0].event.stopPropagation();H.from[0].event.preventDefault();D.callback(H)});return v};this.expand=function(){if(v){if(n){b.removeEventFromToken(n);n=0}var A=v.querySelector(".CAT3DAnnotationAttrDivDots");v.removeChild(A)}j.setStyles({"max-height":"290px",width:"300px"});j.expand()};this.getContainerHeight=function(){return o};this.areAllInformationVisible=function(A){return A.maxHeight<o};this.build=function(A,D,I){var J,S,C;if(A===y&&x===D){return j}y=A;x=D;while(j.firstChild){j.removeChild(j.firstChild)}if(n){b.removeEventFromToken(n);n=0}if(l.length){for(J=0;J<l.length;J++){b.removeEventFromToken(l[J])}l.length=0}v=null;q=null;o=0;j.setStyles({"max-height":"",height:""});var G;for(J=0;J<y.length;J++){if(!G){G=f.createElement("div",{"class":"CAT3DAnnotationAttrDivMainContainer"})}var W=y[J];var P=f.createElement("div",{"class":"CAT3DAnnotationAttrDivContent"}).inject(G);if(x){var M=f.createElement("div",{"class":"CAT3DAnnotationAttrContainer"}).inject(P);if(W.icon){f.createElement("img",{src:W.icon,"class":"CAT3DAnnotationAttrDivIcon"}).inject(M)}if(W.name){var X=f.createElement("p",{"class":"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivTitle"}).inject(M);X.innerHTML=W.name;X.title=W.name}}q=f.createElement("div",{"class":"CAT3DAnnotationAttrDivTextContainer"}).inject(P);var V=W.infos;var L=Object.keys(V);for(S=0;S<L.length;S++){switch(L[S]){case"hyperlinksAndComments":var R=V.hyperlinksAndComments.urls;if(R&&R.length){for(C=0;C<R.length;C++){s("a",{title:R[C].title,url:R[C].url}).inject(q)}}if(V.hyperlinksAndComments.hiddenText){var E=V.hyperlinksAndComments.hiddenText.split(/(\r\n|\n|\r)/gm);for(C=0;C<E.length;C++){t(null,E[C]).inject(q)}}break;case"tolerances":if(V.tolerances.tabulatedLimit&&V.tolerances.toleranceLimits){t(V.tolerances.tabulatedLimit," ("+V.tolerances.toleranceLimits.min+" / +"+V.tolerances.toleranceLimits.max+")").inject(q)}if(V.tolerances.generalTol){t(V.tolerances.generalTol.name," ("+V.tolerances.generalTol.variation+")").inject(q)}break;case"failureModes":if(V.failureModes.length){var T=[],K;for(C=0;C<V.failureModes.length;C++){K=V.failureModes[C];if(T[K.crit]){T[K.crit].descriptions=T[K.crit].descriptions.concat(K.descriptions)}else{T[K.crit]={crit:K.crit,descriptions:K.descriptions.slice()}}}for(C=0;C<T.length;C++){if(T[C]){m(T[C]).inject(q)}}}break;default:if(L[S]==="requirements"||L[S]==="relatedDocs"){var B=V[L[S]];if(B&&B.length){for(C=0;C<B.length;C++){s("p",{title:B[C].displayLabel,url:B[C].label,phyID:B[C].phyID,type:B[C].type,phyType:B[C].phyType},I).inject(q)}}}else{if(Array.isArray(V[L[S]])){var Q,N;for(C=0;C<V[L[S]].length;C++){N=V[L[S]][C].Magnitude;Q=V[L[S]][C].Value;if(N&&N.toLowerCase){N=N.toLowerCase()}if(N==="length"||N==="area"||N==="volume"||N==="angle"){Q=g.convert(V[L[S]][C].Value,N,true)}else{if(N==="boolean"){Q=(Q==="1").toString()}}t(V[L[S]][C].Name+": ",Q).inject(q)}}else{var H=V[L[S]].split(/(\r\n|\n|\r)/gm);for(C=0;C<H.length;C++){if(H[C].charCodeAt(0)===10){continue}var O=H[C].indexOf("=");if(O===-1){O=H[C].indexOf(":")}if(O!==-1){t(H[C].substring(0,O+1),H[C].substring(O+1,H[C].length)).inject(q)}else{t(null,H[C]).inject(q)}}}}}}if(J!==y.length-1&&y.length>1){f.createElement("div",{"class":"CAT3DAnnotationAttrDivLine"}).inject(P)}}if(G){j.appendChild(G);j.expand=function(){j.setStyles({height:o+"px"});if(o>290){j.removeChild(G);var Y=new e().inject(j);Y.getInnerElement().setContent(G);G.parentNode.parentNode.setStyles({height:"100%"});G.setStyles({height:o+"px"})}};var F=0;var U=setInterval(function(){var Y=0;var ab=G.querySelectorAll(".CAT3DAnnotationAttrDivContent");if(ab.length&&F<500){F++;ab=ab[0].childNodes;var aa,Z;for(J=0;J<ab.length;J++){for(S=0;S<ab[J].childNodes.length;S++){aa=ab[J].childNodes[S];Z=Math.max(aa.offsetHeight,aa.clientHeight);if(Z){aa.divHeight=Z}Y+=Z}}if(Y>10){clearInterval(U);o=Y}}else{o=0;clearInterval(U)}},10)}return j}}});return c});define("DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBrowserSection",["UWA/Class","UWA/Core","DS/CAT3DAnnotationBaseUI/CAT3DAnnotationExpander","DS/VisuEvents/EventsManager","css!DS/CAT3DAnnotationBaseUI/CAT3DAnnotationBaseUI.css"],function(c,g,b,a){var d={};var f=b.extend({init:function(h){this._parent(h);this.header=h.name;this.body=g.createElement("div",{"class":"BrowserAnnotThumbsMainContainer"});if(!h.childrenContainer){for(var i=0;i<h.children.length;i++){h.children[i].view.getContent().inject(this.body)}}else{h.childrenContainer.getContent().inject(this.body)}var j=g.createElement("div",{"class":"BrowserAnnotSectionShadingCol"});j.setStyle("background-color","rgba(255, 255, 255, 0)");this.elements.header.appendChild(j);this.icon=h.icon;if(h.displayInfoButton){this.elements.header.childNodes[2].setStyle("width","calc(100% - 65px)")}this.getContent=function(){return this.elements.container};this.setShadingColor=function(k){j.setStyle("background-color",k?"rgb(87, 184, 71)":"rgba(255, 255, 255, 0)")};this.clear=function(){if(this.cbPreference){a.removeEvent(this.elements.header,"onPrimaryPointerUpUnique",this.cbPreference)}};if(d[this.header]===true||d[this.header]===undefined){this.expand()}else{this.close()}},buildView:function(){this._parent();if(!this.cbPreference){var h=this;this.cbPreference=function(){var i=d[h.header];d[h.header]=i!==true&&i!==undefined};a.addEvent(this.elements.header,"onPrimaryPointerUpUnique",this.cbPreference)}}});var e=c.extend({init:function(p){this._parent(p);var h=null;var k=null,l=null,o=null,m=null;if(p.displayInExpanders){h=new f(p);k=h.getContent()}else{k=g.createElement("div",{"class":"BrowserAnnotThumbsMainContainer"});l=g.createElement("div",{"class":"BrowserAnnotThumbsTitleDiv"}).inject(k);var j=g.createElement("div",{"class":"BrowserAnnotSectionShadingCol"}).inject(l);j.setStyle("background-color","rgba(255, 255, 255, 0)");g.createElement("img",{"class":"BrowserAnnotThumbsIcon",src:p.icon}).inject(l);o=g.createElement("p",{"class":"BrowserAnnotThumbsTitle"}).inject(l);o.setStyle("width","calc(100% - 25px)");o.textContent=p.name;if(!p.childrenContainer){for(var n=0;n<p.children.length;n++){p.children[n].view.getContent().inject(k)}}else{p.childrenContainer.getContent().inject(k)}}if(p.displayInfoButton){var i=p.displayInExpanders?k.getChildren()[0].getChildren()[0]:l;m=g.createElement("p",{"class":"BrowserAnnotThumbsInfoIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-info"}).inject(i);if(i===l){o.setStyle("width","calc(100% - 40px)");m.setStyles({"padding-bottom":"5px",display:"inline - block",overflow:"hidden"})}else{m.setStyle("margin","0")}m.addEventListener("click",function(q){q.stopPropagation();p.onInfoButtonClick(p.id)})}this.getContent=function(){return k};this.updateShadingColor=function(){var q=true,r;for(r=0;r<p.children.length;r++){if(!p.children[r].view.getDisplayFlag()){q=false;break}}if(q&&p.children){for(r=0;r<p.children.length;r++){p.children[r].view.setDisplayFlag(true,true)}}this.setShadingColor(q)};this.setShadingColor=function(q){if(h){h.setShadingColor(q)}else{j.setStyles({"background-color":q?"rgb(87, 184, 71)":"rgba(255, 255, 255, 0)",top:"5px",left:"3px"})}};this.clear=function(){if(h){h.clear()}};this.updateShadingColor()}});return e});