define("DS/DELWebMfgItemDefUIViews/BodyView",["UWA/Core","DS/Logger/Logger","DS/DELWebMfgAssetsDefUIServices/TableViewPreferences","DS/DELWebMfgAssetsDefUIServices/TreeListUtils","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefUIServices/CommandsManager","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/AbstractView","DS/DELWebMfgAssetsDefUIServices/TableViewDDManager","DS/DELWebMfgAssetsDefUIControls/Preferences","DS/DELWebMfgAssetsDefModelServices/BIUtils","DS/Core/Events","DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],function(k,B,u,w,G,c,A,o,F,d,C,v,s,g,f,t,b){var E=v.extend({name:"BodyView",treedocument:null,renderTo:null,_logger:null,_context:null,_dragAndDropMgr:null,_modelEvents:{"onChange:displayModel":function(K){var I,J;if(K.isReference()){I=K.get("displayModel");if(I.hasChanged("asRootInBodyView")){if(I.get("asRootInBodyView")){this.treeListView.utils.addToTreeList(K);g.addRootToPreferences(K.id,"BODY");this._context.getBodyDropView().hide()}else{this.treeListView.utils.hide(K,true);J=this.options.context.getBodyTreeListView().getRoots();if(J.length===0){this.options.context.getBodyDropView().show()}this.removeRootToPreferences(K.id,"BODY")}}}},onChange:function y(I){this.treeListView.utils.updateAttributes(I)},onAdd:function x(J,K,I){if(J.isConnection()){this._onConnectionAdd(J)}if(J.isInstance()){this.treeListView.utils.addToTreeList(J,I)}},onRemove:function j(I){if(I.isReference()){this.treeListView.utils.hide(I)}if(I.isConnection()){this._onConnectionRemove(I)}},},_modelDocEvents:{onAdd:function(I,J){c.changeDocCmdAvailability(I,J,this.treeListView)},onRemove:function(I,J){c.changeDocCmdAvailability(I,J,this.treeListView)}},setup:function r(K){var I,L=K.treelistviewoptions||{},J=this;K=K||{};this._logger=B.getLogger(E);this.renderTo=K.renderTo;this._context=K.context;if(!this.renderTo){this._logger.warn("No dom to render to")}if(!this._context){this._logger.warn("This object needs a context")}this.listenTo(this.options.referenceCollection,this._modelEvents);this.listenTo(this.options.connectionCollection,this._modelEvents);this.listenTo(this.options.instanceCollection,this._modelEvents);this.listenTo(this.options.documentConnectionCollection,this._modelDocEvents);this.listenTo(f.biModelCollection,"onAdd",this._onBIModelAdd);this.listenTo(f.biModelCollection,"onReset",this._onBIModelCollectionReset);this.listenTo(f.biModelCollection,"onChange",this._onBIModelAdd);L=k.extend(L,{className:A.getNLSValue(G.LeftBloc.name),});this._dragAndDropMgr=new s({view:this,elementUI:"LeftUI",displayModelRootAttribute:"asRootInBodyView",dropZoneName:"BodyViewDropZone",context:this,onEndLoading:this._onEndTreeListViewLoading});L=k.extend(L,this._dragAndDropMgr.getDDBehavior());L=k.extend(L,this._getContextualMenu());I={treeDocumentOptions:{context:this._context,currentView:K.context.VIEWS.BODY,shouldAcceptDrop:this._shouldAcceptDrop.bind(this),shouldAcceptDrag:this._shouldAcceptDrag.bind(this)},treelistviewOptions:L,preferences:u.getGenericViewPreference(G.LeftBloc),name:"BodyView"};this.treeListView=C.createTreelistview(I);b.registerReusableCellContent(this.treeListView);if(!this.getTreeListView()){this._logger.warn("Could not instantiate treelistview")}this.treeListView.getManager().loadDocument(this.treeListView.getDocument());this._handleEvents("selectedInBodyView",{isCrossHighlight:true});this.render();t.subscribe({event:"DELWebMfgItemDefUI/OnBICmdSetStatus"},function(M){var N;if(k.is(M.length)){N=M.where({type:"ProductsAssignmentStatus"});if(k.is(N,"array")&&N.length>0){J._onBIModelAdd(N)}}else{J._onBIModelAdd(M)}});t.subscribe({event:"FilterComponentProxy/ApplyFilter"},function(R){var O=k.is(R.rootIds)?R.rootIds:[],M=[],Q={},N=false;J._logger.log("Apply Filter event");J._onApplyFilter(R);O.forEach(function P(S){M=o.getTargetedByScopeLinks(S);Q=o.extractAttributesFromConnections(M);if(0<Q.length){Q.forEach(function T(U){if(k.is(U)){N=true;if(k.is(U)&&k.is(U.from)&&N){o.remove3DContentFromMBOM(U.from,{toPID:S,testAsRootInTableView:false})}}})}});O.forEach(function P(S){M=o.getTargetedByScopeLinks(S);Q=o.extractAttributesFromConnections(M);if(0<Q.length){Q.forEach(function T(U){if(k.is(U)){N=true;if(k.is(U)&&k.is(U.from)&&N){o.add3DContentFromMBOM(U.from,{toPID:S,cvquery3d:R.cvquery3d,testAsRootInTableView:true})}}})}})});t.subscribe({event:"FilterComponentProxy/RemoveFilter"},function(R){var O=k.is(R.rootIds)?R.rootIds:[],M=[],Q={},N=false;J._logger.log("Remove Filter event");J._onRemoveFilter(R);O.forEach(function P(S){M=o.getTargetedByScopeLinks(S);Q=o.extractAttributesFromConnections(M);if(0<Q.length){Q.forEach(function T(U){if(k.is(U)){N=true;if(k.is(U)&&k.is(U.from)&&N){o.remove3DContentFromMBOM(U.from,{toPID:S,testAsRootInTableView:false})}}})}});O.forEach(function P(S){M=o.getTargetedByScopeLinks(S);Q=o.extractAttributesFromConnections(M);if(0<Q.length){Q.forEach(function T(U){if(k.is(U)){N=true;if(k.is(U)&&k.is(U.from)&&N){o.add3DContentFromMBOM(U.from,{toPID:S,testAsRootInTableView:true})}}})}})})},_onEndTreeListViewLoading:function e(J){var I;if(J.isReference()){I=this.options.context.getBodyTreeListView().getRoots();if(k.is(I,"array")){if(I.length===0){this.options.context.getBodyDropView().show()}else{this.options.context.getBodyDropView().hide();g.addRootToPreferences(J.id,"BODY")}}}},_shouldAcceptDrop:function q(){return false},_shouldAcceptDrag:function a(){return !this._context.isInGraphMode("BODY")},_onConnectionAdd:function l(N){var P,K,I,R,O,Q,S,J,L;if(!N){this._logger.log("_onConnectionAdd called but no model is defined");return}P=N.get("type");K=N.get("from");if("ProductImplementLink"===P){I=this._context;if(!I){return}R=I.getMBOMTreeListView();if(!R){return}O=R.getDocument();if(!O){return}if(!k.is(O.getNodeModel,"function")){return}Q=O.getNodeModel(K,{searchReferencePID:true,returnFirstOne:true,});if(!Q){this._logger.warn("ERROR: no mdom node from scope");return}L=Q.getScopedNode();if(L){if(k.is(L,"array")){if(0<L.length){L.forEach(function M(T){T.updateBI();if(Q.isSelected()){T.highlight()}})}}else{L.updateBI();if(Q.isSelected()){L.highlight()}}}this._fillConnectionModelInfo(K)}else{if("ProductImplementLinkOcc"===P){S=N.get("to");if(k.is(S,"array")){J=S.length;if(0<J){L=this._context.getBodyTreeListView().getDocument().getNodeModel(S,{searchPathToScope:true,returnFirstOne:true,});if(L){L.updateBI();Q=this._context.getMBOMTreeListView().getDocument().getNodeModel(K,{searchInstancePID:true,returnFirstOne:true,});if(Q){if(Q.isSelected()){L.highlight()}this._fillConnectionModelInfo(K)}}}}}}},_onConnectionRemove:function m(J){var I,M,N,K,L;if(!J){this._logger.warn("No model");return}K=J.get("type");if("ProductImplementLink"===K){I=J.get("to");if(!k.is(I,"string")){this._logger.warn("PID should be a string");return}M=this.treeListView.getDocument().getNodeModel(I,{searchReferencePID:true});if(!M){this._logger.log("No node");return}if(k.is(M,"array")){if(0<M.length){M.forEach(function O(P){if(P.updateBI){P.updateBI()}})}}else{M.updateBI()}}else{if("ProductImplementLinkOcc"===K){N=J.get("to");if(!k.is(N,"array")){this._logger.warn("Path is not an array");return}L=N.length;if(1>L){this._logger.warn("Path is empty");return}M=this.treeListView.getDocument().getNodeModel(N,{searchAbsolutePath:true,returnFirstOne:true,});if(!M){this._logger.log("No node");return}M.updateBI()}}},_fillConnectionModelInfo:function z(I){var J=o.references.get(I);if(k.is(J)){F.fillConnectionModelInfo(J)}},_onBIModelAdd:function n(I){var J=this;if(!I){J._logger.warn("No model");return}J.treeListView.utils._treeDocument.prepareUpdate();if(k.is(I,"array")&&I.length>0){I.forEach(function(K){J._setAssignmentStatus(K)})}else{J._setAssignmentStatus(I)}J.treeListView.utils._treeDocument.pushUpdate();if(J.treeListView.utils._filterProxy){J.treeListView.utils._filterProxy.displayStatusTag()}},_setAssignmentStatus:function i(I){var P=this,Q,L,M,J,S,R,K=false,O,N=[];Q=I.get("type");if("ProductsAssignmentStatus"!==Q){return}O=I.get("id");N=O.split(",");L=N[N.length-1];M=I.get("status");S=f.getAssignmentStatusColorCode(M);R=f.getAssignmentStatusLabel(M);J=P.treeListView.getDocument().getNodeModel(L,{searchInstancePID:true});if(k.is(J,"array")&&0===J.length){J=P.treeListView.getDocument().getNodeModel(L,{searchReferencePID:true});K=true}if(k.is(J,"array")){if(0<J.length){J.forEach(function(U){var T;if(true===K&&false===U.isRoot()){return}T=U.getAbsolutePath().toString();if(0!==T.length){if(T===O){U.displayStatus("ProductAssignmentStatus",M,S,R);if(P.treeListView.utils._filterProxy){P.treeListView.utils._filterProxy.addStatus({absolutePath:U.isRoot()?U.getReferencePID():U.getAbsolutePath().toString(),status:M,dispValue:R,bimodel:I})}}}else{U.displayStatus("ProductAssignmentStatus",M,S,R);if(P.treeListView.utils._filterProxy){P.treeListView.utils._filterProxy.addStatus({absolutePath:U.isRoot()?U.getReferencePID():U.getAbsolutePath().toString(),status:M,dispValue:R,bimodel:I})}}})}}},_onBIModelCollectionReset:function p(){var I=this.treeListView.getDocument().getAllDescendants();this.treeListView.utils._treeDocument.prepareUpdate();I.forEach(function(J){J.displayStatus("ProductAssignmentStatus","","transparent","")});this.treeListView.utils._treeDocument.pushUpdate();if(this.treeListView.utils._filterProxy){this.treeListView.utils._filterProxy.removeStatus()}},render:function H(){this.getTreeListView().inject(this.renderTo)},getTreeListView:function h(){return this.treeListView},_getContextualMenu:function D(){var J=this;return{onContextualMenuReady:function I(Q){var R,N,M,K,L,P,O;if(!Q){return}R={};if(k.is(this.getVirtualCoordinates,"function")){R=this.getVirtualCoordinates()}N=[];M=Q.manager;K=M._treeDocument;J._context.getMBOMTreeListView();J._context.setFocus("BODY");if(-1===R.virtualRowID){N=[{icon:"url("+A.getIconURLFromKey("SortAToZ")+")",label:"Sort A to Z",callback:function(){M.sortColumnContent(R.virtualColumnID,{sortOrder:"asc",})},},{icon:"url("+A.getIconURLFromKey("SortZToA")+")",label:"Sort Z to A",callback:function(){M.sortColumnContent(R.virtualColumnID,{sortOrder:"desc",})},},{icon:"url("+A.getIconURLFromKey("Hide")+")",label:"Hide",callback:function(){L=u.getLeftViewColumns();if(!k.is(L,"array")){return}P=L.detect(function(S){return S.dataIndex===Q.dataIndex},this);if(!P){return}P.display=false;u.setViewPreference("LeftBloc",L);M.hideColumn(R.virtualColumnID)},}]}else{if(0<=R.virtualRowID){O=Q.nodeModel;if(O){if(!O.isSelected()){K.unselectAll();O.select()}}N=C.buildContextualMenuNodes(["CreateAssemblyAndScope"],J._context);N.push({type:"separator",});N=N.concat(C.buildContextualMenuNodes(["ActionBar_Attributes","Relations"],J._context));N.push({type:"separator",});N=N.concat(C.buildContextualMenuNodes(["ExpandAll","Hide","Refresh","ExploreInWebApp"],J._context))}}return N}}}});return E});define("DS/DELWebMfgItemDefUIViews/MBOMView",["UWA/Core","DS/Logger/Logger","DS/Core/Events","DS/DELWebMfgAssetsDefUIServices/TableViewPreferences","DS/DELWebMfgAssetsDefUIServices/TreeListUtils","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefUIServices/CommandsManager","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefUIServices/AttributeUtil","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/AbstractView","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefUIServices/RelationsColumnManager","DS/DELWebMfgAssetsDefUIServices/TableViewDDManager","DS/DELWebMfgAssetsDefUIControls/Preferences","DS/DELWebMfgAssetsDefModelServices/BIUtils","DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],function(c,b,Q,o,K,p,F,t,R,B,m,z,r,q,n,a,u,v,P){var H=r.extend({name:"MBOMView",renderTo:null,_logger:null,_context:null,_dragAndDropMgr:null,_modelDocEvents:{onAdd:function(S,T){F.changeDocCmdAvailability(S,T,this.treeListView)},onRemove:function(S,T){F.changeDocCmdAvailability(S,T,this.treeListView)}},setup:function f(U){var Y=this,T,Z,X;U=U||{};this._logger=b.getLogger(H);this.renderTo=U.renderTo;this._context=U.context;if(!this.renderTo){this._logger.warn("No dom to render to")}if(!this._context){this._logger.warn("This object needs a context")}this.listenTo(R.references,"onChange:displayModel",this._onReferenceDisplayModelChange);this.listenTo(R.instances,"onChange:displayModel",this._onInstanceDisplayModelChange);this.listenTo(R.references,"onRemove",this._onReferenceRemove);this.listenTo(R.references,"onChange",this._onReferenceChange);this.listenTo(R.instances,"onAdd",this._onInstanceAdd);this.listenTo(R.instances,"onRemove",this._onInstanceRemove);this.listenTo(R.instances,"onChange",this._onInstanceChange);this.listenTo(R.connections,"onAdd",this._onConnectionAdd);this.listenTo(R.connections,"onRemove",this._onConnectionRemove);this.listenTo(R.documentsConnection,this._modelDocEvents);this.listenTo(v.biModelCollection,"onAdd",this._onBIModelAdd);this.listenTo(v.biModelCollection,"onReset",this._onBIModelCollectionReset);this.listenTo(v.biModelCollection,"onChange",this._onBIModelAdd);Z={className:t.getNLSValue(p.TableView.name),};this._dragAndDropMgr=new a({view:this,elementUI:"TableUI",displayModelRootAttribute:"asRootInTableView",dropZoneName:"TableViewDropZone",});Z=c.extend(Z,z.getEditionManager(this));Z=c.extend(Z,this._dragAndDropMgr.getDDBehavior());Z=c.extend(Z,this._getContextualMenu());T={treeDocumentOptions:{context:U.context,currentView:U.context.VIEWS.MBOM},treelistviewOptions:Z,preferences:o.getTableViewPreference(),name:"MBOMView"};this.treeListView=z.createTreelistview(T);P.registerReusableCellContent(this.treeListView);o.getTableViewPreference();this._handleEvents("selectedInTableView",{isCrossHighlight:true,isSelectedFor3DView:true});this.render();Q.subscribe({event:"DELWebMfgItemDefUI/AddScopeBadge"},function V(ab){var aa={cvquery3d:c.is(ab.cvquery3d)?ab.cvquery3d:null};Y._doBadgeAnd3DManagement.call(Y,ab.scopedRefsArray,aa)});Q.subscribe({event:"DELWebMfgItemDefUI/OnBICmdSetStatus"},function(aa){if(c.is(aa.length)){X=aa.where({type:"MfgItemsUpdateStatus"});if(c.is(X,"array")&&X.length>0){Y._onBIModelAdd(X)}}else{Y._onBIModelAdd(aa)}});Q.subscribe({event:"DELWebMfgAssetsDefUI/ReparentInstances"},function(aa){Y._reparent(aa)});Q.subscribe({event:"DELWebMfgAssetsDefUI/CreateInstanceAndLink"},function(aa){Y._instanceCreation(aa)});Q.subscribe({event:"FilterComponentProxy/ApplyFilter"},function(aa){Y._logger.log("Apply Filter event");Y._onApplyFilter(aa)});Q.subscribe({event:"FilterComponentProxy/RemoveFilter"},function(aa){Y._logger.log("Remove Filter event");Y._onRemoveFilter(aa)});Q.subscribe({event:"changeEffectivity"},function S(aa){if(c.is(aa.viewId)&&aa.viewId===R.VIEWS.MBOM){Y.treeListView.utils._updateCfgColAttributes(aa.updatedAttributes,true)}});Q.subscribe({event:"updateViews"},function W(ac){var aa,ab,ad;Y._context.getMBOMTreeListView().utils.prepareUpdate();ac.forEach(function ae(af){aa=R.getInstanceFromCollection(af);ab=R.getReferenceFromCollection(af);if(c.is(aa)){n.forceCellUpdate(Y._context.getMBOMTreeListView().utils,aa)}if(c.is(ab)){n.forceCellUpdate(Y._context.getMBOMTreeListView().utils,ab);ad=Y._context.getMBOMTreeListView().getDocument().getNodeModel(af,{searchReferencePID:true});if(c.is(ad)){if(c.is(ad,"array")){ad.forEach(function(ag){ag.updateBI()})}else{ad.updateBI()}}}});Y._context.getMBOMTreeListView().utils.pushUpdate()})},_doBadgeAnd3DManagement:function M(ac,X){var T=X||{},Z=c.is(T.addOrRemove3D,"string")?(("add"===T.addOrRemove3D)?true:false):true,ab=c.is(T.cvquery3d)?T.cvquery3d:null,W=Object.keys(ac),aa=c.is(T.data)?(c.is(T.data.reason)?T.data.reason:null):null,V=true,ad,U,ae,Y={};W.forEach(function S(af){U=ac[af];ae=this.treeListView.getDocument().getNodeModel(U,{searchReferencePID:true,searchInstancePID:true,returnFirstOne:true});if(!c.is(ae)){ae=this.treeListView.getDocument().getNodeModel(U,{searchReferencePID:true,returnFirstOne:true})}if(c.is(ae)){ae.prepareUpdate();ae.updateBI();this._fillConnectionModelInfo(U);ae.pushUpdate()}if(c.is(aa,"string")){switch(aa){case"fromInstanceRemoval":ad=true;break;case"fromConnectionRemoval":if(c.is(ae)){if(ae.isRoot()){ad=false}else{V=false}}else{ad=true}break;default:ad=false}}else{ad=false}if(V){if(Z){Y={toPID:af,cvquery3d:ab};R.add3DContentFromMBOM(U,Y)}else{Y={testAsRootInTableView:ad,toPID:af,cvquery3d:ab};R.remove3DContentFromMBOM(U,Y)}}},this)},_onReferenceDisplayModelChange:function A(U){var S,Y,T,W,X,V;this._logger.log("_onReferenceAdd");if(c.is(U)){S=U.get("displayModel")}if(!S){this._logger.warn("No displayModel on reference");return}Y=S.changedAttributes();if(!Y){return}T=U.id;if(!c.is(T,"string")){return}if(S.hasChanged("asRootInTableView")){if(S.get("asRootInTableView")){this._onReferenceRootAdd(U,{silentMode:true,withLinksResolved:false})}else{this._onReferenceRootRemove(U)}}if(S.hasChanged("connectionModelInfo")){W=S.get("connectionModelInfo");if(W){this._onConnectionModelInfoChanged(U,W)}}if(S.hasChanged("documentIDList")){X=S.get("documentIDList");if(X){this._onDocumentIDListChanged(U,X)}}V=R.references.filter(function(Z){var aa=Z.getDisplayModelAttr("asRootInTableView");return aa});if(0===V.length){this._context.getMbomDropView().show()}else{this._context.getMbomDropView().hide()}},_onInstanceDisplayModelChange:function E(T){var S,U;this._logger.log("_onInstanceDisplayModelChange");S=T.get("displayModel");if(c.is(S)){if(S.hasChanged("connectionModelInfo")){U=S.get("connectionModelInfo");if(c.is(U)){this._onConnectionModelInfoChanged(T,U)}}}},_onReferenceRootAdd:function O(T,U){var S;if(!T){this._logger.warn("No model");return}S=T.get("displayModel");U=U||{};if(S.get("asRootInTableView")){this.treeListView.utils.addToTreeList(T,U);u.addRootToPreferences(T.id,"MBOM")}},_onReferenceRootRemove:function h(U){var V=this.treeListView.getDocument().getNodeModel(U.id,{searchReferencePID:true,returnFirstOne:true,}),S,T;if(!V){this._logger.warn("node was not found for pid : %s",U.id);return}this._context.getMBOMTreeListView().utils.hide(U,true);if(c.is(U)){T=c.is(U._attributes)?(c.is(U._attributes.displayModel._previousAttributes)?U._attributes.displayModel._previousAttributes:null):null;S=c.is(U._changed)?(c.is(U._changed.displayModel)?(c.is(U._changed.displayModel._changed)?U._changed.displayModel._changed:null):null):null;if(c.is(T)&&c.is(S)){if(T.asRootInTableView===true&T.asRootInAuxiliaryView===true){if(S.asRootInTableView===false||S.selectedInTableView===false){this.removeRootToPreferences(U.id,"MBOM")}else{this.removeRootToPreferences(U.id,"AUX")}}else{this.removeRootToPreferences(U.id,"MBOM")}}}},_onConnectionModelInfoChanged:function i(T){var U=this._context.getMBOMTreeListView(),V;if(c.is(U)&&c.is(T)){n.updateAttributes(U.utils,T);V=U.getDocument().getNodeModel(T.id,{searchReferencePID:true});V=c.is(V)?(c.is(V,"array")?V:[V]):null;if(c.is(V,"array")){V.forEach(function S(W){W.updateBI()})}}},_onDocumentIDListChanged:function x(T,X){var S,W,V;if(!c.is(X,"array")){this._logger.warn("documentIDList should be an array");return}V=this.treeListView.getDocument().getNodeModel(T.id,{searchReferencePID:true,returnFirstOne:true,});if(!V){this._logger.warn("Node was not found for pid : %s",T.id);return}V.setAttribute("documents.document",[]);X.forEach(function U(Y){if(!Y){this._logger.warn("No document id");return}S=R.documents.get(Y);if(!S){this._logger.warn("Doc model not found for pid : %s",Y);return}W=S.get("dataelements").title;V.pushRelatedObject(W,"documents.document")},this)},_onReferenceChange:function C(S){this.treeListView.utils.updateAttributes(S)},_onReferenceRemove:function e(V){var U,X,T,W,S;this._logger.log("_onReferenceRemove");if(c.is(V)){U=V.get("PID");if(c.is(U,"string")){X=this.treeListView.getDocument().getNodeModel(U,{searchReferencePID:true,returnFirstOne:true,});if(X){S=X.getAbsolutePath();T=X.isRoot();X._isHidden=true;if(T){this.treeListView.utils._treeDocument.removeRoot(X);this.removeRootToPreferences(V.id,"MBOM")}else{W=X.getParent();if(W){W.removeChild(X)}}if(c.is(this.treeListView.utils._filterProxy)){this.treeListView.utils._filterProxy.nodeUpdate({PID:X.getID(),Path:X.isRoot()?X.getReferencePID():S.toString(),event:"remove"})}}}}},_fillConnectionModelInfo:function L(S){var T=R.references.get(S)||R.instances.get(S);if(T){q.fillConnectionModelInfo(T)}},_onConnectionAdd:function N(S){var T,U={};if(c.is(S)){T=S.get("type");if(c.is(T,"string")){this._logger.log("_onConnectionAdd, type: "+T);if("ProductImplementLinkOcc"===T||"ProductImplementLink"===T||"MfgProcessAlternate"===T||"HistorizationLinkRefRef"===T){U[S.get("to")]=S.get("from");this._doBadgeAnd3DManagement(U)}}}},_onConnectionChange:function D(){if(this._logger){this._logger.log("_onConnectionChange")}},_onConnectionRemove:function g(S,W,U){var T,V={};if(c.is(S)){T=S.get("type");if(c.is(T,"string")){this._logger.log("_onConnectionRemove, type: "+T);if("ProductImplementLinkOcc"===T||"ProductImplementLink"===T){V[S.get("to")]=S.get("from");this._doBadgeAnd3DManagement(V,{addOrRemove3D:"remove",data:U})}}}},_onInstanceAdd:function k(T,U,S){this.treeListView.utils.addToTreeList(T,S)},_onInstanceChange:function j(S){this.treeListView.utils.updateAttributes(S)},_onInstanceRemove:function I(V){var U,Y,X=this,W,T;this._logger.log("_onInstanceRemove");if(!V){this._logger.warn("No model");return}U=V.get("PID");if(!c.is(U,"string")){this._logger.warn("PID is not a string");return}Y=this.treeListView.utils.search(U,null,true,false);if(c.is(Y,"array")&&(Y.length>0)){Y.forEach(function S(Z){W=Z.getParent();T=Z.getAbsolutePath();if(W){W.removeChild(Z)}if(c.is(X.treeListView.utils._filterProxy)){X.treeListView.utils._filterProxy.nodeUpdate({PID:Z.getID(),Path:Z.isRoot()?Z.getReferencePID():T.toString(),event:"remove"})}})}},_onBIModelAdd:function y(S){var T=this;if(!S){T._logger.warn("No model");return}T.treeListView.utils._treeDocument.prepareUpdate();if(c.is(S,"array")&&S.length>0){S.forEach(function(U){T._setUpdateStatus(U)})}else{T._setUpdateStatus(S)}T.treeListView.utils._treeDocument.pushUpdate();if(T.treeListView.utils._filterProxy){T.treeListView.utils._filterProxy.displayStatusTag()}},_setUpdateStatus:function J(S){var X=this,Y,V,W,T,aa,Z,U=false;Y=S.get("type");if("MfgItemsUpdateStatus"!==Y){return}V=S.get("id");W=S.get("status");aa=v.getUpdateStatusColorCode(W);Z=v.getUpdateStatusLabel(W);T=X.treeListView.getDocument().getNodeModel(V,{searchInstancePID:true});if(c.is(T,"array")&&0===T.length){T=X.treeListView.getDocument().getNodeModel(V,{searchReferencePID:true});U=true}if(c.is(T,"array")){if(0<T.length){T.forEach(function(ab){if(true===U&&false===ab.isRoot()){return}ab.displayStatus("ManufacturingItemUpdateStatus",W,aa,Z);if(X.treeListView.utils._filterProxy){X.treeListView.utils._filterProxy.addStatus({absolutePath:ab.isRoot()?ab.getReferencePID():ab.getAbsolutePath().toString(),status:W,dispValue:Z,bimodel:S})}})}}},_onBIModelCollectionReset:function s(){var S=this.treeListView.getDocument().getAllDescendants();this.treeListView.utils._treeDocument.prepareUpdate();S.forEach(function(T){T.displayStatus("ManufacturingItemUpdateStatus","","transparent","")});this.treeListView.utils._treeDocument.pushUpdate();if(this.treeListView.utils._filterProxy){this.treeListView.utils._filterProxy.removeStatus()}},render:function w(){this.getTreeListView().inject(this.renderTo)},getTreeListView:function G(){return this.treeListView},_instanceCreation:function l(T){var S;if(c.is(T)){this.treeListView.utils._treeDocument.prepareUpdate();if(c.is(T.instancePID,"string")){S=R.getInstanceFromCollection(T.instancePID);if(c.is(S)){this.treeListView.utils.addToTreeList(S)}}this.treeListView.utils._treeDocument.pushUpdate()}},_getContextualMenu:function d(){var T=this;return{onContextualMenuReady:function S(ab){var Z,Y,V,ac,U,W,aa,X={};if(!ab){return}Z={};if(c.is(this.getVirtualCoordinates,"function")){Z=this.getVirtualCoordinates()}Y=[];V=ab.manager;ac=V._treeDocument;T._context.setFocus("MBOM");if(-1===Z.virtualRowID){Y=[{icon:"url("+t.getIconURLFromKey("SortAToZ")+")",label:"Sort A to Z",callback:function(){V.sortColumnContent(Z.virtualColumnID,{sortOrder:"asc",})},},{icon:"url("+t.getIconURLFromKey("SortZToA")+")",label:"Sort Z to A",callback:function(){V.sortColumnContent(Z.virtualColumnID,{sortOrder:"desc",})},},{icon:"url("+t.getIconURLFromKey("Hide")+")",label:"Hide",callback:function(){W=o.getTableViewColumns();if(!c.is(W,"array")){return}aa=W.detect(function(ad){return ad.dataIndex===ab.dataIndex},this);if(!aa){return}aa.display=false;o.setViewPreference("TableView",W);V.hideColumn(Z.virtualColumnID)},}];return Y.concat(z.buildContextualMenuNodes(["ToggleGraphView",],T._context))}else{if(0<=Z.virtualRowID){U=ab.nodeModel;if(U){if(!U.isSelected()){ac.unselectAll();U.select()}}X={node:U,selectedNodes:T._context.getMBOMTreeListView().getDocument().getXSO().get(),column:T._context.getMBOMTreeListView().options.columns[ab.virtualColumnID]};X.infos=m.getNodeAndColumnInfos(U,X.column);Y=z.buildContextualMenuNodes(["InsertCreateAssembly","InsertProvide","InsertCreateMaterial","InsertCreateKit"],T._context);Y.push({type:"separator"});Y=Y.concat(z.buildContextualMenuNodes(["CreateScopeLink"],T._context));Y.push({type:"separator"});Y=Y.concat(z.buildContextualMenuNodes(["EditAttribute"],T._context,X));Y=Y.concat(z.buildContextualMenuNodes(["ActionBar_Attributes","Relations"],T._context));Y.push({type:"separator"});Y=Y.concat(z.buildContextualMenuNodes(["ExpandAll","Hide","Refresh","ExploreInWebApp"],T._context));return Y}else{if(c.is(Z.virtualRowID)){Y=Y.concat(z.buildContextualMenuNodes(["InsertCreateAssembly","InsertProvide","InsertCreateMaterial","InsertCreateKit"],T._context));return Y}}}}}}});return H});define("DS/DELWebMfgItemDefUIViews/DropView",["UWA/Core","UWA/Class/View","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/Resources","css!DS/DELWebMfgItemDefUIViews/DropView"],function(d,a,b,h,e){var j=a.extend(h,{name:"DropView",_logger:null,_dragAndDropManager:null,_accepts:[],tagName:"div",className:"dropViewInternal",init:function k(l){this._parent(l);if(b){this._logger=b.getLogger(j)}},setup:function c(){var n=this;if(this._logger){this._logger.log("setup")}var m=this.getOption("dragAndDropManager");if(m){this._dragAndDropManager=m}var l=this.getOption("accepts");if(d.is(l,"array")){this._accepts=l}if(this._dragAndDropManager){if(this.container){if(this._dragAndDropManager.onDragOver){this.container.addEventListener("dragover",this._dragAndDropManager.onDragOver)}if(this._dragAndDropManager.onDrop){this.container.addEventListener("drop",this._dragAndDropManager.onDrop.bind(n._dragAndDropManager))}}}this._buildSkeleton()},hide:function g(){if(!this.container){this._logger.warn("No container");return}this.container.hide()},show:function i(){if(!this.container){this._logger.warn("No container");return}this.container.show()},isVisible:function f(){var l=false;if(this.container){l="none"!==this.container.getStyle("display")}return l},_buildSkeleton:function(){if(this._logger){this._logger.log("_buildSkeleton")}var m=this,l;if(!m.container){this._logger.warn("No container defined");return}l=d.createElement("div",{"class":"mfndnd_invite_container",}).inject(m.container);if(!l){this._logger.warn("Could not create droplayer");return}var n=d.createElement("div",{"class":"mfndnd_invite_display",draggable:false}).inject(l);d.createElement("i",{"class":"mfndnd_invite_img wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-drag-drop",draggable:"false"}).inject(n);d.createElement("h5",{"class":"font-3dsregular",text:e.getNLSValue("Drag.Drop.Title")}).inject(n)},});return j});define("DS/DELWebMfgItemDefUIViews/ActionView",["UWA/Core","DS/Logger/Logger","DS/DELWebMfgItemDefUITreeDocuments/ActionTreeDocument","DS/DELWebMfgAssetsDefUIServices/TableViewPreferences","DS/DELWebMfgAssetsDefUIServices/TreeListUtils","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/AbstractView"],function(d,o,l,h,k,r,n,f,a,p,j){var b=j.extend({name:"ActionView",treeDocument:null,renderTo:null,draganddropmanager:null,contextualMenu:[],_logger:null,_constructionOptions:null,_context:null,setup:function g(u){var v,t;u=u||{};this._parent();this._logger=o.getLogger(b);this.renderTo=u.renderTo;this.draganddropmanager=u.draganddropmanager;this._contextualMenu=u.contextualMenu;this._context=u.mfgwidget;this._type=u.type;this._fromPID=u.fromPID;this.listenTo(f.connections,"onAdd",this._onConnectionAdd);if(!this.renderTo){this._logger.warn("No dom to render to")}if(!this._context){this._logger.warn("This object needs a context")}if(!this.draganddropmanager){this._logger.warn("A Drag and drop manager should be defined to handle drag and drop")}v={className:n.getNLSValue(u.title),};v=d.extend(v,p.getEditionManager(this));v=d.extend(v,this.draganddropmanager.getDDBehavior());v=d.extend(v,this._getContextualMenu());this.treeDocument=new l({context:this._context,treelistview:null,fromPID:this._fromPID});t={treeDocument:this.treeDocument,treelistviewOptions:v,preferences:h.getGenericViewPreference(r.RightBloc),};this.configureColumn();this.treeListView=p.createTreelistview(t);this.treeDocument._treelistview=this.getTreeListView();if(!this.getTreeListView()){this._logger.warn("Could not instantiate treelistview")}this.getTreeListView().getManager().loadDocument(this.treeDocument);this.getTreeListView().utils._treeDocument=this.treeDocument;this._context.setRightBloc({treeListView:this.getTreeListView()});this._handleEvents("selectedInActionView");this.render()},render:function s(){this.getTreeListView().inject(this.renderTo)},destroy:function m(){this.treeDocument.destroy();this.stopListening(f.connections,"onAdd",this._onConnectionAdd);this._parent()},_onConnectionAdd:function e(u){var t=u.get("from"),v=u.get("type"),w=f.references.get(u.get("to"));if(v===this._type&&t===this._fromPID){w.setDisplayModel({asRootInActionView:true})}},configureColumn:function i(){var t=h.getRightViewColumns(),u,v;if(!d.is(t,"array")){return}u=t.detect(function(w){return w.dataIndex==="Alternate.relation"},this);v=t.detect(function(w){return w.dataIndex==="Origin.relation"},this);if(d.is(u)){u.display=false}if(d.is(v)){v.display=false}if("Alternate"===this.options.title&&d.is(u)){u.display=true}else{if("Origin"===this.options.title&&d.is(v)){v.display=true}}h.setViewPreference("RightBloc",t)},getTreeListView:function c(){return this.treeListView},_getContextualMenu:function q(){var u=this;return{onContextualMenuReady:function t(z){var y,A={},x=[],w,v=z.manager;u._context.setFocus("ACTION");if(!z){return}if(d.is(this.getVirtualCoordinates,"function")){A=this.getVirtualCoordinates()}if(-1===A.virtualRowID){x=[{icon:"url("+n.getIconURLFromKey("SortAToZ")+")",label:"Sort A to Z",callback:function(){v.sortColumnContent(A.virtualColumnID,{sortOrder:"asc"})}},{icon:"url("+n.getIconURLFromKey("SortZToA")+")",label:"Sort Z to A",callback:function(){v.sortColumnContent(A.virtualColumnID,{sortOrder:"desc"})}}]}w=z.dataIndex==="tree"?z.nodeModel:z.dataIndex;if(u._contextualMenu.indexOf("ActionViewFilter")!==1&&A.virtualRowID!==-1){y=u._contextualMenu.filter(function(B){return B!=="ActionViewFilter"})}else{y=u._contextualMenu}return x.concat(p.buildContextualMenuNodes(y,u._context,{columnId:A.virtualColumnID,columnDataIndex:w}))}}}});return b});