define("DS/DELPPWLinksModule/LinksUI",["UWA/Core"],function(b){var a=function(C,m,D,K,o,f,w,l){var N={className:"Links MGA-linksUIContainer disableContentselection",},F,I,A,g,h=D.getNLSValue("LinksUI.PanelTitle"),G,x=null,d,y,M,k={title:"",labelAttribute:"V_Name",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:false,references:[],instances:[]}};var t,u,L,i,P,c,j,e,z,r,n;u=function u(){if(b.is(x)){x.title=h+k.title}};L=function L(){var U,Q,V,R,S=m.getComponent("WUXFrameWindowsManager"),T=S.getFrameWindow(C.getAppContext());x=m.create("Panel",{position:{my:"center",at:"center"},domId:"RelationsPanel",immersiveFrame:T.getImmersiveFrame(),resizableFlag:true,visibleFlag:false});x.close=function(){if(b.is(A)){C.notify("toggleCmdCheckHeaderState",{cmdName:A,cmdState:false})}else{c()}};y=m.create("Element","div",{"class":N.className});U=m.create("Element","div",{"class":"linksPanel-Container"});Q=m.create("Element","div",{"class":"module-messages"});V=i();R=P();Q.inject(U);V.inject(U);R.inject(U);U.inject(y)};i=function i(){var R;R=m.create("Element","div",{"class":"linkView-toolbar"});M=m.create("Filter");M.inject(R);M.addEvent("onChange",function Q(T,U){var S,V;V=this.getSelectedItems();for(S in G){if(G.hasOwnProperty(S)){if(V.indexOf(S)===-1){G[S]["pprTypeDiv"].hide()}else{if(b.is(T,"string")&&T==="PARENT"&&true===U&&false===k.whereUsed.isFetched){j()}G[S]["pprTypeDiv"].show()}}}});return R};P=function P(){var R,Q;R=m.create("Element","div",{"class":"LinksUI-menuDiv",styles:{"max-height":"300px",overflow:"auto"}});d=m.create("WUXLoader");d.inject(R);for(Q in G){if(G.hasOwnProperty(Q)){G[Q]["pprTypeDiv"]=new b.Element("div",{"class":"pprTypeDiv"}).inject(R)}}return R};c=function c(){x.hide()};j=function j(){var R,T,S=false,Q=false,ae=[],aa=[],W=[],Y=k.reference.model,ac=k.instance.model,ab=k.labelAttribute,ad=function ad(af,ag,ai){var ah={PRODUCT:[],PROCESS:[],SYSTEM:[],RESOURCE:[],PART:[],PARENT:[]};for(R in G){if(G.hasOwnProperty(R)){G[R]["pprTypeDiv"].empty()}}ah=z(af,Y,ac,ab,ah);ah=r(ag,ai,Y,ac,ab,ah);e(ah);d.hide()},Z=function U(){if(S&&Q){ad(ae,aa,W)}},X=function X(ag,af){Q=true;if(b.is(k.whereUsed)){k.whereUsed.isFetched=true;k.whereUsed.references=ag;k.whereUsed.instances=af}aa=ag;W=af;Z()},V=function V(af){S=true;ae=af;Z()};T=M.getSelectedItems();if(k.whereUsed.isFetched!==true){if(b.is(Y)&&T.indexOf("PARENT")!==-1){o.getWhereUsedReferences(Y,X);k.whereUsed.isFetched=true}else{Q=true}}else{if(b.is(Y)&&T.indexOf("PARENT")!==-1){aa=k.whereUsed.references||[];W=k.whereUsed.instances||[]}Q=true}for(R in G){if(G.hasOwnProperty(R)){G[R]["pprTypeDiv"].empty()}}d.show();K.getConnectionsByModel(Y,ac,{silentMode:true,onComplete:V})};e=function e(aa){var W,S,T,R,Z,Y,U,V,X,Q,ab;for(T in aa){if(aa.hasOwnProperty(T)){R=aa[T];if(R.length===0){continue}S=G[T]["pprTypeDiv"];new b.Element("div",{"class":"pprTypeTitleDiv",text:G[T]["title"]}).inject(S);for(W=0;W<aa[T].length;W++){U=m.create("Element","div",{"class":"connectionDiv"});Z=aa[T][W];Q=Z.type;if(b.is(Q)){X=Z.iconDirection;if(Q.indexOf("_inverse")!==-1){X.tooltipInfos=m.create("TooltipModel",{shortHelp:D.getNLSValue("LinksUI.BackwardIcon")})}else{X.tooltipInfos=m.create("TooltipModel",{shortHelp:D.getNLSValue("LinksUI.ForwardIcon")})}X.inject(U)}V=Z.icon;V.tooltipInfos=m.create("TooltipModel",{shortHelp:D.getNLSValue(Q)});V.inject(U);Y=m.create("Element","div",{"class":"connectionLabel",html:Z.label,styles:{display:"inline-block"}});Y.tooltipInfos=m.create("TooltipModel",{shortHelp:Z.label});Y.inject(U);ab=m.create("Button",{label:"",icon:"bars",iconSize:"2x",displayStyle:"lite",onClick:n}).inject(U);ab.getContent().setStyles({"float":"right"});ab.getContent().setData("pid",Z.pid);ab.getContent().setData("linkedReferencePID",Z.linkedReferencePID);U.inject(S)}}}};z=function z(ab,V,X,ac,ag){var ak,R,al,U,Y,S,aa,T,Z,ah,aj,Q,W,am,af,ad=F,ae=b.is(V)?V.id:"",ai=b.is(X)?X.id:"";for(ak=0;ak<ab.length;ak++){aa=ab[ak]._attributes;R=aa.type;aj=aa.to;if(b.is(aa.from,"array")&&b.is(aa.to,"array")&&b.is(k.instance.absPath)){if(!l.isLinkValidForOccPath(aa.from,aa.to,k.instance.absPath,aa.type)){continue}}if(b.is(aa.to,"array")){af=(ai===aa.to[aa.to.length-1])}if(ae===aa.to||ai===aa.to||af){aj=aa.from;R+="_inverse";Z=D.getIconElem("LinkInverse")}else{Z=D.getIconElem("Link")}Q=o.getReference(aj);if(!b.is(Q)){if(b.is(aj,"array")){ah=o.getInstance(aj[aj.length-1])}else{ah=o.getInstance(aj)}if(!ah){C.debug("No linked instance !!!")}else{Q=o.getReference(ah.get("isInstanceOf")||ah.get("to"))}}if(b.is(Q)){Y=Q.get("type");if(b.is(ad[Y])&&b.is(ad[Y].display_attribute)){W=ad[Y].display_attribute.split(",");S=ad[Y].separator||" ";U="";for(am=0;am<W.length;am++){if(am!==0){U+=S}U+=Q.get(W[am])}}else{U=Q.get(ac)}T=Q.get("PPRTYPE");if(b.is(T,"string")){if(T==="OPERATION"){T="SYSTEM"}al=D.getIconElem(R);ag[T].push({label:U,icon:al,iconDirection:Z,pid:aa.PID,linkedReferencePID:Q.id,type:R})}else{C.debug("PPRTYPE is not available for object type:"+Y)}}else{C.debug("No linked reference !!!")}}return ag};r=function r(Q,ae,V,W,aa,ac){var af,T,ag,U,X,S,Z,R,ad,Y,ah,ab=F;for(af=0;af<Q.length;af++){R=Q[af];X=R.get("type");if(b.is(ab[X])&&b.is(ab[X].display_attribute)){Y=ab[X].display_attribute.split(",");S=ab[X].separator||" ";U="";for(ah=0;ah<Y.length;ah++){if(ah!==0){U+=S}U+=R.get(Y[ah])}}else{U=R.get(aa)}Z=D.getIconElem("Link");ag=D.getIconElem(X);for(T=0;T<ae.length;T++){if(ae[T].get("isAggregatedBy")===R.id){ad=ae[T];break}}if(b.is(ad)){ac.PARENT.push({label:U,icon:ag,iconDirection:Z,pid:ad.id,linkedReferencePID:R.id})}else{C.debug("Instance of reference id:"+R.id+" not found.")}}return ac};t=function t(Q){var S,R;S=K.getConnection(Q);if(b.is(S)){K.deleteConnection(Q)}else{R=o.getInstance(Q);if(b.is(R)){o.deleteInstance([R],{askDeleteConfirmation:false})}}};n=function n(ag){var Y=[],W,U,af,aa,ai,T,ae,S,V,Z,ah,ad=this.getData("pid"),X=this.getData("linkedReferencePID"),aj=o.getReference(X),ab=aj.get("PPRTYPE"),R=ag.currentTarget.getOffsets().x,Q=ag.currentTarget.getOffsets().y+25,ac={icon:"url("+D.getIconURLFromKey("GeneralDelete")+")",label:D.getNLSValue("LinksUI.DeleteLink"),sensitivity:"enabled",callback:function(){t(ad)}};if(b.is(K.getConnection(ad))){Z=K.getConnection(ad);ah=Z.getAttribute("type");S=Z.getAttribute("from");T=o.getReferenceModel(S);V=Z.getAttribute("to");ae=o.getReferenceModel(V);ai=K.getPossibleRelationTypes(T,ae);if(ai.indexOf(ah)===-1){ac.sensitivity="disabled"}}W={icon:"url("+D.getIconURLFromKey("EditAttribute")+")",label:D.getNLSValue("LinksUI.EditAttribute"),sensitivity:"enabled",callback:function(){var an=K.getConnection(ad),ak=I[an.get("type")],al,am;if(b.is(ak)){al=ak.Attribute;am=f.getObjectAndAttributeInfos(al);am.forEach(function(ao){ao.objectToBeModified=an});w.editAttribute(an,am)}else{C.warn(D.getNLSValue("LinksUI.NoAttributes"))}}};U={icon:"url("+D.getIconURLFromKey("showAuxiliaryView")+")",label:D.getNLSValue("LinksUI.ShowInAuxiliaryView"),sensitivity:"enabled",callback:function(){C.notify("addToAuxiliaryView",aj)}};if(Object.keys(g).indexOf(ab)>-1){af={icon:"url("+D.getIconURLFromKey(g[ab].icon)+")",label:D.getNLSValue("LinksUI.ShowInNaturalView",{view:D.getNLSValue(g[ab].view)}),sensitivity:"enabled",callback:function(){C.notify("addReference",[aj,null,{withLinksResolved:true}])}}}aa={icon:"url("+D.getIconURLFromKey("ExploreInWebApp")+")",label:D.getNLSValue("ExploreInWebApp",null,"Cmd","Title"),sensitivity:"enabled",callback:function(){C.notify("ExploreInWebApp",[[{referencePID:X}]])}};if(b.is(K.getConnection(ad))){Y.push(ac);Y.push(W)}else{if(b.is(k.reference.model)&&k.reference.model.get("PPRTYPE")!=="PRODUCT"){Y.push(ac)}}Y.push(U);if(b.is(af,"object")){Y.push(af)}Y.push(aa);m.getComponent("ContextualMenuManager").show({nodes:Y},[R,Q])};return{init:function J(Q){N=b.extend(N,Q);F=Q.relAttributeConfig;I=Q.editLinkAttrsConfig;A=b.is(Q.relatedCmdId)?Q.relatedCmdId:null;g=b.is(Q.acceptedTypes)?Q.acceptedTypes:null;G={PRODUCT:{title:D.getNLSValue("PPRTYPE.PRODUCT")},PROCESS:{title:D.getNLSValue("PPRTYPE.PROCESS")},SYSTEM:{title:D.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{title:D.getNLSValue("PPRTYPE.RESOURCE")},PART:{title:D.getNLSValue("PPRTYPE.PART")},PARENT:{title:D.getNLSValue("PPRTYPE.PARENT")}};L()},destroy:function E(){if(this.isActive()){c()}if(b.is(x)){x.destroy();x=void 0}},showModal:function O(Q){k=b.extend(k,Q);j();x.show();u();x.content=y},isActive:function H(){return b.is(x)?x.visibleFlag:false},clear:function v(){var Q;k={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:false,references:[],instances:[]}};u();for(Q in G){if(G.hasOwnProperty(Q)){G[Q]["pprTypeDiv"].empty()}}},hideUI:function B(){x.hide()},updateWhereUsed:function s(S){var Q,T,R=-1;if(b.is(S)){Q=S.isInstance()?S.get("isAggregatedBy"):S.id;if(b.is(k.whereUsed.references,"array")){for(T=0;T<k.whereUsed.references.length;++T){if(k.whereUsed.references[T].id===Q){R=T;break}}if(R!==-1){k.whereUsed.references.splice(R,1)}else{if(S.isInstance()){k.whereUsed.instances.push(S);k.whereUsed.references.push(o.getReference(Q))}}j()}}},getCurrentModel:function p(){return k},updateTitle:function q(Q){k.title=Q;u()}}};return a});define("DS/DELPPWLinksModule/LinksModule",["UWA/Core","DS/DELPPWLinksModule/LinksUI"],function(c,b){var a=function(s,B,j,A,v,D,w,o,y){var t=null,h="V_Name",m,k,d;var u,G,i,F,e,q;G=function G(K,I){v.getXMLValues(m.relationsDialogDisplayAttributeConfigXML,function J(L){k=L.convert("DisplayAttributeDescriptionList.Type","name")||{};K()},function H(L){I(L)})};i=function i(K,I){v.getXMLValues(m.editLinkAttrsConfigXML,function J(L){d=L.Config||{};K()},function H(L){I(L)})};F=function F(K){var I=false,L=t.getCurrentModel(),H=c.is(L.reference.model)?L.reference.model.id:"",J=c.is(L.instance.model)?L.instance.model.id:"";if(K===H||K===J){I=true}return I};e=function e(J){var K={instModel:{},refModel:{},absPath:""},I=J.id?J.id:J.instancePID,H=J.id?J.id:J.referencePID;K.instModel=D.getInstance(I);if(!c.is(K.instModel)){K.refModel=D.getReference(H);if(!c.is(K.refModel)){s.debug("Object with reference PID:"+I+" and instance PID:"+H+" not found.")}}else{K.absPath=J.path?J.path:J.absPath;K.refModel=D.getReferenceModelFromInstance(K.instModel)}return K};u=function u(H){var K={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:false,references:[],instances:[]}},J,N,L,M,I;if(c.is(H)){N=e(H);L=N.refModel;M=N.instModel;I=N.absPath}else{if(1===A.getSelectedNodesCount()){J=A.getSelectionsWithPaths();J.forEach(function(O){if(c.is(O)&&O.length===1){O.forEach(function(P){N=e(P);L=N.refModel;M=N.instModel;I=N.absPath})}})}}K.title=c.is(L)?L.get(h):"";K.reference.model=L;K.instance.model=M;K.instance.absPath=I;return K};q=function q(){if(t.isActive()){t.showModal(u())}};return{name:"LinksModule",listenTo:function p(){return{select:this.onSelect,Relations:this.onShowRelations,addInstance:this.onAddInstance,addConnection:this.onAddOrRemoveConnections,removeConnection:this.onAddOrRemoveConnections,removeReference:this.onRemoveRefOrInst,changeReference:this.onChangeRefOrInst,removeInstance:this.onRemoveRefOrInst,refreshImpacted:this.relaodUI}},onStart:function z(J,H){m=J||{};if(!c.is(m.relationsDialogDisplayAttributeConfigXML)||!c.is(m.editLinkAttrsConfigXML)){s.debug("LinksModule loading failed : relationsDialogDisplayAttributeConfigXML or editLinkAttrsConfigXML options are undefined");H();return}Promise.all([new Promise(G.bind(this)),new Promise(i.bind(this))]).then(function K(){t=new b(s,B,j,v,D,w,o,y);t.init({relAttributeConfig:k,editLinkAttrsConfig:d,relatedCmdId:m.relatedCmdId,acceptedTypes:m.pprTypes});t.showModal(u(m.node));H()},function I(L){s.debug("LinksModule loading failed :"+L);H()})},onStop:function n(){t.destroy();t=void 0},onRemoveRefOrInst:function E(H){if(c.is(H)&&t.isActive()){if(F(H.id)){t.clear()}else{t.updateWhereUsed(H)}}},onChangeRefOrInst:function f(H){var I;if(t.isActive()&&c.is(H)&&H.isReference()){if(F(H.id)){I=H.changedAttributes();if(c.is(I)&&I.hasOwnProperty(h)){t.updateTitle(I[h])}}}},onShowRelations:function g(I){var H;H=c.is(I)?(c.is(I,"array")?I[0]:I):null;if(c.is(H)){if(t.isActive()){t.showModal(u(H))}}},onSelect:function C(H){q()},onAddOrRemoveConnections:function r(J){var L,K,I=false,H;if(t.isActive()){H=function H(M){if(c.is(M)){L=M.getAttribute("from");K=M.getAttribute("to");if(F(L)||F(K)){return true}}return false};I=c.is(J,"array")?J.some(H):H(J);if(I){t.showModal(t.getCurrentModel())}}},onAddInstance:function l(H){if(c.is(H)&&t.isActive()){if(F(H.get("isInstanceOf"))){t.updateWhereUsed(H)}}},relaodUI:function x(){q()}}};return{behaviors:["UXFactoryBehavior","ResourceBehavior","SelectionBehavior","LinkBehavior","ModelBehavior","AttributeBehavior","EditAttributeBehavior","ImplementBehavior"],creator:a}});