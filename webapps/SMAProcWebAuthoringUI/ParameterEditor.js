/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebAuthoringUI/ParameterEditor",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/SMAProcWebAuthoringControls/WebUXDialog","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMSimulationDataUtils","text!DS/SMAProcWebAuthoringUI/ParameterEditor.html","DS/Logger/Logger","module"],function(a,i,e,k,h,l,b,g,d,c){var j=d.getLogger(c);var f=a;i.registerDomModule(g);return f({is:"cmp-parameter-editor",properties:{_dataContainer:{value:null}},listeners:{"parameterDialog.cmp-wux-dialog-resized":"onResize","parameterDialog.cmp-wux-closed":"onClose","parameterDialog.cmp-wux-ok-clicked":"onOK","parameterDialog.cmp-wux-apply-clicked":"onApply","parameterDialog.cmp-wux-cancel-clicked":"onCancel","confirmClose.cmp-wux-closed":"onConfirmClose","confirmClose.cmp-wux-yes-clicked":"onConfirmOK","confirmClose.cmp-wux-no-clicked":"onConfirmCancel"},setDialogHeading:function(){this.$.parameterDialogContent.parentElement.style.backgroundColor="white";var m=this._dataContainer.getName();if(m.length>0&&this.$.parameterDialog&&this.$.parameterDialog.setTitle){var n="Parameters - "+m;this.$.parameterDialog.setTitle(n);this.$.parameterDialog.identifier="Parameters"}},setDataContainer:function(o){var n=this;if(o){this._dataContainer=o;this.showDialog();this.setDialogHeading();var m=l.getParentFIsDataContainer(o);b.getAllSimulationDataInPLM([o],{onSuccess:function(){h.getAllDataFlowsInPLM([o,m],{onSuccess:function(){j.log("parameters and simulation data successfully loaded from PLM for: "+o.getName());n.loadParameterTable(o)},onFailure:function(){j.log("parameters and simulation data not loaded from PLM for: "+o.getName())}})},onFailure:function(){j.log("simulation data not loaded from PLM for: "+o.getName())}})}},showDialog:function(){this.$.parameterDialog.show()},loadParameterTable:function(n){var m=this;this._dataContainer=n;if(!this.$.paramTable){require(["DS/SMAProcWebAuthoringUtils/cmp-parameter-table/cmp-parameter-table"],function(){var o=document.createElement("cmp-parameter-table");o.hideMappingIcons=true;o.setAttribute("id","paramTable");o.setAttribute("filters","");o.setAttribute("data-mode","standalone");m.$.dialogContent.innerHTML="";m.$.dialogContent.insertBefore(o,m.$.dialogContent.firstChild);m.$.paramTable=o;if(o){o.setDataContainer(m._dataContainer)}m.fire("parametereditorready")})}else{this.$.paramTable.setDataContainer(this._dataContainer)}},getDataContainer:function(){return this._dataContainer},onCancel:function(){this._close()},onConfirmCancel:function(){this.$.confirmClose.hide();this.onCancel()},onClose:function(){var m=k.hasPendingParameterUpdates(this._dataContainer);if(m){this.$.closeDialogContent.innerText=" Some Parameters are modified.\nDo you want to save changes before closing?";this.$.confirmClose.show()}else{this._close()}},onConfirmClose:function(m){m.stopImmediatePropagation();this.$.confirmClose.hide()},_close:function(){try{this.$.parameterDialog.hide();this.$.paramTable.abandonParameters();this.$.paramTable._removeTempDFs();this.$.paramTable.unloadTable();this.$.parameterDialog.destroy()}catch(m){j.log(m)}this.fire("onClose")},onOK:function(n){var o=k.hasPendingParameterUpdates(this._dataContainer);if(o){this.$.paramTable.showLoadingIdicatorforSave();var m=this;this.$.paramTable.commitParameters(n).then(function(){try{m.$.paramTable.hideLoadingIdicatorforSave(m);if(n){m.$.parameterDialog.hide();m.$.paramTable.unloadTable();m.$.parameterDialog.destroy()}}catch(p){j.log(p)}if(n){m.fire("onClose")}})["catch"](function(){j.log("failed to Save to PLM");m.$.paramTable.hideLoadingIdicatorforSave(m)})}else{if(n){this.$.parameterDialog.hide();this.$.paramTable.unloadTable();this.$.parameterDialog.destroy();this.fire("onClose")}}},onApply:function(){this.onOK(false)},onConfirmOK:function(){this.$.confirmClose.hide();this.onOK(true)},save:function(){var m=this;return new Promise(function(o,n){var p=k.hasPendingParameterUpdates(m._dataContainer);if(!p){m.$.paramTable.unloadTable();o()}else{m.$.paramTable.showLoadingIdicatorforSave();m.$.paramTable.commitParameters().then(function(){m.$.paramTable.hideLoadingIdicatorforSave(m);setTimeout(function(){m.$.paramTable.unloadTable();o()},500)})["catch"](function(){j.log("failed to Save to PLM");n(new Error("failed to Save to PLM"))})}})},onResize:function(){this.$.paramTable.dialogResized()}})});