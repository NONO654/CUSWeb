define("DS/DELWebMfgItemDefUIDragAndDropManagers/DragAndDropManagerAction",["DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","UWA/Core","DS/DELWebMfgAssetsDefUIServices/AbstractDragAndDropManager","DS/Logger/Logger","UWA/Class/Listener","DS/Core/Events","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils"],function(g,k,e,h,q,c,j,b,l,p,r){var a=h.singleton(c,{name:"DragAndDropManagerAction",_type:null,_logger:null,_fromPID:null,_context:null,_dropZone:null,init:function m(s){this._context=s.context;this._parent(s);this._dropZone=r.getMGAElement("ActionViewDropZone");this._dropZone.addEventListener("drop",function(t){t.preventDefault();a.onTreeListViewDrop(t);a._dropZone.visibleDockingZoneFlag=false;a._dropZone.collapseDockingZoneFlag=true});this._dropZone.addEventListener("dragover",function(t){t.preventDefault()})},destroy:function o(){this._parent()},onDragEnterColumnHeader:function(){if(!a._dropZone.visibleDockingZoneFlag){a._dropZone.visibleDockingZoneFlag=true;setTimeout(function(){a._dropZone.visibleDockingZoneFlag=false},5000)}},onDragLeaveColumnHeader:function(){return true},onDropCell:function(t,s){return a.onDropTreeListView(t,s)},onDropBlank:function(t,s){return a.onDropTreeListView(t,s)},checkType:function i(u){var v,t,s;if(e.is(u)&&e.is(u.get)){v=u.get("PPRTYPE")}else{if(e.is(u.objectType)){t=u.objectType;v=l.PPRTypes[t]}else{s=g.references.get(u.referenceID);v=s.get("PPRTYPE")}}if("PROCESS_MfgProcessAlternate"===this._type){if("PROCESS"===v){return true}}else{if("PROCESS_HistorizationLinkRefRef"===this._type){if("PROCESS"===v){return true}}else{if("PROCESS_DELAsmProcessCanUseCnx"===this._type){if("RESOURCE"===v){return true}}}}this._onFailure();r.AlertManager.add({className:"info",message:p.getNLSValue("Drop.NotValidType.Title"),});return false},onDropTreeListView:function n(v,u){var s,w=null;s=this.getDragNDropInfo(v,u);if(e.is(s)){if(e.is(s.draggedItems,"array")){s.draggedItems.forEach(function t(x){if(e.is(x)){w=this.getDraggedReferencePID(x);this._onAssemblyDrop({referenceID:w})}},this)}}},_onAssemblyDrop:function f(s){var t=this,w=e.is(s)?(e.is(s.referenceID)?s.referenceID:null):null,u,v;if(g.isValidPID(w)){u=g.references.get(w);if(u){if(true===t.checkType(u)){t.createConnection(w,t._fromPID)}}else{v=new k({PID:w});v.fetch({proxy:"passport",type:"json",headers:{SecurityContext:b.getSecurityContext()},wait:true,onFailure:t._onFailure.bind(t),onComplete:function(y,x){v.set(x);g.references.add(v);if(true===t.checkType(v)){t.createConnection(w,t._fromPID)}}})}}},createConnection:function(v,u){var s=this;var t={type:s._type,IDTo:v,IDFrom:u,};g.connections.create(null,{proxy:"passport",wait:true,type:"json",headers:b.getHeaders(),data:e.Json.encode(t),onFailure:s._onFailure.bind(s),onComplete:function(){var x=g.references.get(v);if(b.isStandAlone()){x.setDisplayModel({asRootInActionView:true})}else{if(g.needToQueryForChildren(v)){g.getDescendantsFromServer(x.id,function w(){x.setDisplayModel({asRootInActionView:true})},{withLinks:false,withLinksResolved:false})}}}})},_onFailure:function d(){r.AlertManager.add({className:"info",message:p.getNLSValue("Info.ElementNotAdded.Title"),})},});return a});