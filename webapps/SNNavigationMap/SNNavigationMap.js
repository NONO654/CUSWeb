/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/SNNavigationMap/utils/SearchUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(g,e,a,c,h,d,f){var b=g.extend({_currentRequest:null,init:function(i){this._debug=i.debugMode||false;this._notifManager=d;f.setNotificationManager(this._notifManager)},_searchCall:function(i){var j=this;var k={};if(this._currentRequest){this._currentRequest.cancel()}if(this._debug){k.debug=true}k.label=this._getSearchLabel();k.query=this._getQueryFromIds(i.ids,i.value);k.tenant=i.tenantName;k=JSON.stringify(k);return new g.Promise(function(m,l){j._currentRequest=a.authenticatedRequest(i.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:k,onComplete:function(n){j._currentRequest=null;m(n)},onFailure:function(n){j._currentRequest=null;console.log(n);j._notifManager.addNotif({level:"error",message:h.get("generic"),sticky:true});l(n)},onTimeout:function(n){j._currentRequest=null;console.log(n);j._notifManager.addNotif({level:"error",message:h.get("timeout"),sticky:true});l(n)}})})},_getQueryFromIds:function(l,m){var k=m+" AND";for(var j=0;j<l.length;j++){if(j===0){k=k+" (physicalid:"+l[j]}else{k=k+" OR ";k=k+"physicalid:"+l[j]}}k=k+")";return k},_getSearchLabel:function(){var i=c.getUser(),j=(typeof i!=="undefined"&&i!==null&&typeof i.login!=="undefined")?i.login:"";return"ENORIPE_"+j+"_"+Date.now()}});return b});define("DS/SNNavigationMap/utils/PromisesManager",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(f,d,a,g,c,e){var b=f.extend({init:function(h){this._debug=h.debugMode||false;this._notifManager=c;e.setNotificationManager(this._notifManager)},createPromise:function(h){if(this._debug){h.params.debug=true}h.params.label="RelationalExplorer";var j=JSON.stringify(h.params);var i=this;return new f.Promise(function(l,k){a.authenticatedRequest(h.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:j,onComplete:l,timeout:h.timeout,onFailure:function(m){console.log(m);if(!h.noErrorMsg){i._notifManager.addNotif({level:"error",message:g.get("generic"),sticky:true})}k(m)},onTimeout:function(m){console.log(m);i._notifManager.addNotif({level:"error",message:g.get("timeout"),sticky:true})}})})}});return b});define("DS/SNNavigationMap/views/ChordLayoutView",["UWA/Core","UWA/Class/View","DS/WebappsUtils/WebappsUtils"],function(d,b,c){var a=b.extend({markersData:[{id:"node-arrow",position:10,color:"#368EC4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus",position:10,color:"#368ec4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus-reverse",position:0,color:"#368ec4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-reverse",position:0,color:"#368EC4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-red",position:10,color:"#EA4F37",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-green",position:10,color:"#57B847",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-orange",position:10,color:"#FFA500",dValue:"M 0 0 L 10 5 L 0 10 z"}],init:function(e){this._parent(e)},setup:function(){this.width=window.innerWidth;this.height=window.innerHeight-150;this.container.addClassName("map-chord-layout");this.zoomListener=d3.behavior.zoom().scaleExtent(this._scaleExtent);this.svgContainer=d3.select(this.container).append("svg").attr("id","chord-svg-root").attr("width",this.width).attr("height",this.height).attr("pointer-events","all").call(this.zoomListener.on("zoom",this._redraw.bind(this))).on("dblclick.zoom",null);this.defs=this.svgContainer.append("svg:defs");this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(e){return e.id}).attr("viewBox","0 0 10 10").attr("refX",function(e){return e.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(e){return e.dValue}).attr("marker-end","url(#node-arrow)").attr("fill",function(e){return e.color});this.svgRootG=this.svgContainer.append("g")},clear:function(){this.svgRootG.select("#plot").remove();this.container.hide()},_redraw:function(e){if(this.nodeMouseDown){return}(e?this.svgRootG.transition():this.svgRootG).attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")")},_pan:function(f,j){var h=50,l,i,k,g=this;if(this._panTimer){clearTimeout(this._panTimer);var e=d3.transform(this.svgRootG.attr("transform"));if(j==="up"||j==="down"){l=e.translate[0];i=j==="up"?e.translate[1]+h:e.translate[1]-h}k=this.zoomListener.scale();if(l!==undefined&&i!==undefined){this.zoomListener.translate([l,i]).scale(k);this.svgRootG.transition().attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")");this._panTimer=setTimeout(function(){g._pan(f,h,j)},50)}}},render:function(g){var s=500;var i=s/2;var f=20;var h=this;function q(A){var v=parseFloat(A.attr("cx"));var D=parseFloat(A.attr("cy"));var w=parseFloat(A.attr("r"));var C=A.attr("title");var z=h._plot.append("text").text(C).attr("x",v).attr("y",D).attr("dy",-w*2).attr("id","tooltip");var B=z.node().getBBox().width/2;if((v-B)<-i){z.attr("text-anchor","start");z.attr("dx",-w)}else{if((v+B)>(i)){z.attr("text-anchor","end");z.attr("dx",w)}else{z.attr("text-anchor","middle");z.attr("dx",0)}}}function n(w){var v=h.svgContainer.attr("width",s).attr("height",s);h._plot=h.svgRootG.append("g").attr("id","plot").attr("transform","translate("+i+", "+i+")");p(w.nodes);j(w.links);r(w.nodes)}function p(v){var w=d3.scale.linear().domain([0,v.length]).range([0,2*Math.PI]);v.forEach(function(A,z){var y=w(z);var x=i-f;A.x=x*Math.sin(y);A.y=x*Math.cos(y)})}function r(w){var v=d3.scale.category20();var x=h._plot.selectAll(".node").data(w,function(y){return y.id}).enter().append("g").attr("transform",function(y){return"translate("+y.x+", "+y.y+")"}).attr("class","node-group").attr("id",function(z,y){return"group-"+z.id});x.append("circle").attr("class","node").attr("id",function(z,y){}).attr("title",function(z,y){}).attr("cx",function(z,y){}).attr("cy",function(z,y){}).attr("r",5).style("fill",function(z,y){return v(z.group)});x.append("text").text(function(y){return y.name}).attr("dx",function(y){return(y.x<0?-10:10)}).attr("dy","0.31em").attr("text-anchor",function(y){return(y.x<0?"end":"start")})}function m(v){h._plot.selectAll(".link").data(v,function(w){return w.id}).enter().append("line").attr("class","link").attr("x1",function(w){return w.source.x}).attr("y1",function(w){return w.source.y}).attr("x2",function(w){return w.target.x}).attr("y2",function(w){return w.target.y})}function j(v){var w=d3.svg.diagonal().projection(function(x){return[x.x,x.y]});h._plot.selectAll(".link").data(v,function(x){return x.id}).enter().append("path").attr("id",function(y,x){return"chord-"+y.id}).attr("class","link").attr("d",w)}n(g);this.container.show();return this;var h=this,s=window.innerWidth,i=s/2,k=i-120,o=d3.layout.cluster().size([260,260]).sort(null).value(function(v){return v.size}),u=d3.layout.bundle(),t=d3.svg.line.radial().interpolate("bundle").tension(0.85).radius(function(v){return v.y}).angle(function(v){return v.x/180*Math.PI}),l=this.linksContainer.selectAll(".link"),e=this.nodesContainer.selectAll(".node");d3.json(c.getWebappsAssetUrl("SNNavigationMap","readme-flare-imports.json"),function(x,y){var w=o.nodes(g.nodes),v=g.links;l=l.data(v,function(z){return z.id}).enter().append("path").each(function(z){z.source=z[0];z.target=z[z.length-1]}).attr("class","chord-link").attr("d",t);e=e.data(w,function(z){return z.id}).enter().append("text").attr("class","chord-node").attr("dy",".31em").attr("transform",function(z){return"rotate("+(z.x-90)+")translate("+(z.y+8)+",0)"+(z.x<180?"":"rotate(180)")}).style("text-anchor",function(z){return z.x<180?"start":"end"}).text(function(z){return z.key})});return this},_packageImports:function(f){var g={},e=[];f.forEach(function(h){g[h.name]=h});f.forEach(function(h){if(h.imports){h.imports.forEach(function(j){e.push({source:g[h.name],target:g[j]})})}});return e},_packageHierarchy:function(e){var f={};function g(h,l){var k=f[h],j;if(!k){k=f[h]=l||{name:h,children:[]};if(h.length){k.parent=g(h.substring(0,j=h.lastIndexOf(".")));k.parent.children.push(k);k.key=h.substring(j+1)}}return k}e.forEach(function(h){g(h.name,h)});return f[""]},filterByFading:function(h){var k=this,f=null;k.filteredLinksByFilter=[];var e=h.map(function(i){return"#group-"+i}),g=[];if(e.length>0){g=this.getElements(e)}this.getElements(".highlighted").forEach(function(i){i.removeClassName("highlighted")});this.resetLinksOpacity();this._filteredOpacity=true;this.svgRootG.classed("links-nodes-faded",true);for(var j=0;j<g.length;j++){g[j].addClassName("highlighted");f=g[j].getElement("circle");if(f&&f.addClassName){f.addClassName("highlighted")}}this.svgRootG.selectAll(".link").filter(function(i){if(h.indexOf(i.source.id)>-1&&h.indexOf(i.target.id)>-1){k.filteredLinksByFilter.push(this.id);return true}else{}}).classed("highlighted",true)},filterByFadingVolatile:function(k){if(k&&k.filteredPathIDList&&k.filteredLinks){var e=[],l=[],f=null,j=k.filteredPathIDList.map(function(i){return"#group-"+i}),h=k.filteredLinks.map(function(i){return"#chord-"+i});e=this.getElements(j);l=this.getElements(h);this.getElements(".highlighted").forEach(function(i){i.removeClassName("highlighted")});this.resetLinksOpacity();this._filteredOpacity=true;this.svgRootG.classed("links-nodes-faded",true);for(var g=0;g<e.length;g++){e[g].addClassName("highlighted");f=e[g].getElement("circle");if(f&&f.addClassName){f.addClassName("highlighted")}}for(g=0;g<l.length;g++){if(l[g]){l[g].addClassName("highlighted")}}}},resetLinksOpacity:function(){if(this._filteredOpacity){return}if(this._highlightTimeout){clearTimeout(this._highlightTimeout)}this.svgRootG.classed("links-nodes-faded",false);this.svgRootG.classed("links-faded",false);this.svgRootG.selectAll(".highlighted").classed("highlighted",false)},colorize:function(f){for(var g in f){if(f.hasOwnProperty(g)){var e=this.getElement("#group-"+g);if(e){e.getElement("circle").style.fill=f[g];e.getElement("text").style.fill=f[g]}}}},unColorize:function(){this.getElements(".node-group text").forEach(function(e){e.style.fill=""});this.getElements(".node-group circle").forEach(function(e){e.style.fill="#1f77b4"})},colorizeRelations:function(h){var g=this;for(var e in h.colorMap){if(h.colorMap.hasOwnProperty(e)){var f=this.getElement("#chord-"+e);if(f){f.setStyle("stroke",h.colorMap[e])}}}},colorizeSynchro:function(m){var l=null,h=null,n=null;for(var g=0;g<m.synchroLinks.length;g++){l=this.getElement("#chord-"+m.synchroLinks[g]);if(l){l.setStyle("stroke",m.synchroColor)}}for(var f=0;f<m.nonSynchroLinks.length;f++){h=this.getElement("#chord-"+m.nonSynchroLinks[g]);if(h){h.setStyle("stroke",m.nonSynchroColor)}}for(var e=0;e<m.unknownLinks.length;e++){n=this.getElement("#chord-"+m.unknownLinks[g]);if(n){n.setStyle("stroke",m.unknownColor)}}}});return a});define("DS/SNNavigationMap/utils/SNNavigationServices",["UWA/Core","UWA/Class/View","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(c,b,d){var a={isWebInWin:function(){var e=(typeof sendNotificationWebInWin!=="undefined")?true:false;return e},sendToMapWebInWin:function(i,g,e){var h=false;if(this.isWebInWin()){h=true;var k=(typeof e==="string")?e:"";var f=(Array.isArray(g))?g:[g];var j={action:k,id:f};sendNotificationWebInWin(i,JSON.stringify(j))}return h},ComputeContextualMenu:function(j,i){var f=[];if(UWA.is(i)){var h=JSON.parse(i.actions);var e=this._parseContextualMenu(j,h.actions);var g=e.length;if(g==1){f=e[0]}else{f=this._menusIntersection(h.actions,e)}}return f},_parseContextualMenu:function(j,h){var g=this;var k=[];var e=h.length;for(var f=0;f<e;f++){k[f]=this._getActionsForOneObject(j,h[f],h[f].actions,"")}return k},_getActionsForOneObject:function(l,f,m,j){var k=this;var e=[];var h=m.length;for(var g=0;g<h;g++){e[g]=this._getOneActionForOneObject(l,f,m[g],j)}return e},_getOneActionForOneObject:function(k,e,j,h){var i=this;var g;if(UWA.is(j.items)){g={text:j.title,};if((j.id!==undefined)&&(j.id!==null)){g.actionId=j.id}g.items=this._getActionsForOneObject(k,e,j.items,j.title)}else{var f=true;g={text:j.title,icon:j.image,multisel:j.multisel,};if(j.id!==undefined){g.actionId=j.id}if(j.accelerator!==undefined){g.accelerator=j.accelerator}if(UWA.is(j.disabled)){g.disabled=j.disabled}g.handler=function(m){var l={action:j.id,id:[e.id],};k._onCtxMenuItem(l)};if(UWA.is(h)){g.menu=h}}return g},_menusIntersection:function(l,o){var q=[];var g=o.length;if(g===0){return q}q=o[0];var p=[];for(var m=1;m<g;m++){var s=o[m];var e=s.length;for(var h=0;h<e;h++){var n=q.length;var r=false;for(var f=0;f<n;f++){if((s[h].actionId!=undefined)&&(s[h].actionId!=null)&&(q[f].actionId!=undefined)&&(q[f].actionId!=null)){if(s[h].actionId===q[f].actionId){r=true;break}}else{if(((s[h].actionId===undefined)&&(q[f].actionId===undefined))||((s[h].actionId===null)&&(q[f].actionId===null))){if(s[h].text===q[f].text){r=true;break}}}}if(r===true){p.push(s[h])}}q=p;p=[]}return q}};return a});define("DS/SNNavigationMap/views/elements/Links",["UWA/Class","UWA/Core","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(d,a,c){var b=d.extend({svgNS:null,init:function(){this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(g){var f=a.extendElement(document.createElementNS(this.svgNS.svg,"g")),n=a.extendElement(document.createElementNS(this.svgNS.svg,"title")),m=a.extendElement(document.createElementNS(this.svgNS.svg,"path")),k=a.extendElement(document.createElementNS(this.svgNS.svg,"text")),e=a.extendElement(document.createElementNS(this.svgNS.svg,"textPath")),h=(g.source.focus===true||g.target.focus===true),i="link col"+g.source.columnID+"-col"+g.target.columnID,j=g.display_name_attributes,l="";m.setAttributes({id:"from_"+g.source.id+"_to_"+g.target.id,"class":"path-element",fill:"none","marker-end":(h)?"url(#node-arrow-focus)":"url(#node-arrow)"});k.setAttributes({"class":"labelText","text-anchor":"middle",dy:-5,"font-size":"13px"});e.setAttributeNS(this.svgNS.xlink,"href","#from_"+g.source.id+"_to_"+g.target.id);e.setAttribute("startOffset","50%");if(j&&j.length){l=c[g[j[0]]]||g[j[0]]}else{l=c[g.type+"_short"]||c[g.type]||g.type}e.setContent(l);k.setContent(e);n.setContent(l);f.setAttribute("class",(h?i+" focus":i));if(g.instancelink){f.addClassName("displaynone")}f.setAttribute("id",g.id);f.setContent([n,k,m]);return f},updateLabel:function(f,e){f.setContent(c[e+"_short"]||c[e]||e)}});return b});define("DS/SNNavigationMap/views/ToolBarView",["UWA/Core","UWA/Class/View","DS/Controls/ComboBox","DS/UIKIT/Iconbar","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(f,e,a,c,d){var b=e.extend({name:"ToolBar",className:function(){return this.getClassNames("-container")},setup:function(g){this.toolBar=new f.createElement("ul",{"class":"map-toolbar",draggable:"false"});this.renderTo=g.renderTo;this._addinMode=g.addinMode;this._showChord=g.showChordCommand||false},render:function(){var g=this,i={fonticon:"graph-linear",text:d.get("SNNavigationMap.LayoutSelector.Title"),className:"layout-selector",content:{type:"dropdownmenu",options:{events:{onClick:function(l,k){try{document.querySelector(".layout-selector span").set("class",k.elements.icon.className)}catch(j){console.error(j)}}},items:[{fonticon:"graph-linear",text:d.get("SNNavigationMap.LinearLayoutView.Title"),className:"",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_showLinearLayout")}},{fonticon:"graph-chord",text:d.get("SNNavigationMap.ChordLayoutView.Title"),className:"",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_showChordLayout")}}]}}};var h=[{text:d.get("SNNavigationMap.Customize.Title"),className:"Customize_Command wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related-cog",handler:function(){g.dispatchEvent("ENORIPE_CustomizeCommandClick")}},{text:d.get("SNNavigationMap.CustomizeDisplay.Title"),className:"CustomizeDisplay_Command wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-cog",handler:function(){g.dispatchEvent("ENORIPE_CustomizeDisplayCommand")}},{fonticon:"select-on",text:d.get("SNNavigationMap.MultiSelection.Title"),className:"multisel-icons",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-on",text:d.get("SNNavigationMap.initMultiSelection.Title"),className:"MultiSelOn_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_initMultiSelectionFromCommand")}},{fonticon:"select-off",text:d.get("SNNavigationMap.stopMultiSelection.Title"),className:"MultiSelOff_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_stopMultiSelectionFromCommand")}},{fonticon:"select-all",text:d.get("SNNavigationMap.selectAll.Title"),className:"SelectAll_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_selectAllFromCommand")}},{fonticon:"select-none",text:d.get("SNNavigationMap.clearSelection.Title"),className:"ClearSelection_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_clearSelectionFromCommand")}}]}}},{className:"divider"},{fonticon:"info",text:d.get("SNNavigationMap.Information.Title"),className:"Info_Command",handler:function(){g.dispatchEvent("ENORIPE_InfoCommandClick")}},{fonticon:"search",text:d.get("SNNavigationMap.searchMap.Title"),className:"Search_Command",handler:function(){g.dispatchEvent("ENORIPE_SearchCommandClick")}},{fonticon:"print",text:d.get("SNNavigationMap.printMap.Title"),className:"Print_Command",handler:function(){g.dispatchEvent("ENORIPE_PrintCommandClick")}},{className:"divider"},{fonticon:"pencil",text:d.get("SNNavigationMap.EditLayout.Title"),className:"EditLayout_Command",handler:function(){g.dispatchEvent("ENORIPE_EditLayoutCommandClick")}},(this._showChord?i:undefined),{fonticon:"trash ",text:d.get("SNNavigationMap.Remove.Title"),className:"Remove_Command",content:{type:"dropdownmenu",options:{items:[{fonticon:"trash",text:d.get("SNNavigationMap.RemoveSelected.Title"),className:"RemoveSelected_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_RemoveSelectedCommand")}},{fonticon:"trash",text:d.get("SNNavigationMap.RemoveNotSelected.Title"),className:"RemoveNotSelected_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_RemoveNotSelectedCommand")}},{fonticon:"trash",text:d.get("SNNavigationMap.RemoveFiltered.Title"),className:"RemoveFiltered_Command",selectable:true,handler:function(){g.dispatchEvent("ENORIPE_RemoveFilteredCommand")}}]}}},{fonticon:"path-related",text:d.get("SNNavigationMap.computePaths.Title"),className:"ComputePath_Command",handler:function(){g.dispatchEvent("ENORIPE_ComputePathCommandClick")}},{className:"divider"},{fonticon:"arrow-double-combo",text:d.get("SNNavigationMap.fitAll.Title"),className:"FitAllIn_Command",handler:function(){g.dispatchEvent("ENORIPE_FitAllCommandClick")}},{fonticon:"close",text:d.get("SNNavigationMap.clearMap.Title"),className:"ClearView_Command",handler:function(){g.dispatchEvent("ENORIPE_ClearMapCommandClick")}},{fonticon:"reload",text:d.get("SNNavigationMap.refreshMap.Title"),tooltipPosition:"bottom right",className:"Refresh_Command",handler:function(){g.dispatchEvent("ENORIPE_RefreshMapCommandClick")}}].filter(function(j){return j!==undefined});if(this._addinMode==="solidworks"||this._addinMode==="catiav5"){h.unshift({fonticon:"open",text:d.get("SNNavigationMap.openMap.Title"),className:"Open_Command",handler:function(){g.dispatchEvent("ENORIPE_OpenCommandClick")}})}this.rightIconBar=new c({renderTo:g.toolBar,className:"right-toolbar",tooltipsPosition:"bottom",items:h});this.toolBar.addEventListener("dragenter",function(j){j.stopPropagation()});this.toolBar.inject(this.renderTo);return this},getCommand:function(g){var h=this.toolBar.getElement("."+g);if(h){return h}},toggleInfoCommand:function(){var g=this.getCommand("Info_Command");if(g.hasClassName("pressed")){g.removeClassName("pressed")}else{g.addClassName("pressed")}},disableIconsForChord:function(){var g=this;this.rightIconBar.menu.items.forEach(function(h){if(h.className.contains("layout-selector")){}else{g.rightIconBar.disableItem(h.id)}})},enableIconsForMapView:function(){var g=this;this.rightIconBar.menu.items.forEach(function(h){if(h.className.contains("layout-selector")){}else{g.rightIconBar.enableItem(h.id)}})},resizeHandler:function(){if(window&&window.innerWidth){var g=(window.innerWidth<300)?200:300}},destroy:function(){this._parent();this.toolBar.destroy();this.toolBar=null;this.container=null}});return b});define("DS/SNNavigationMap/views/MapSearchView",["UWA/Core","UWA/Class/View","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Handlebars/Handlebars","UWA/Event","css!DS/SNNavigationMap/SNNavigationMap"],function(g,f,b,e,a){var d='<div class="left_ctn_search ctn_search"></div>    <div class="input_ctn_search ctn_search ">        <div class="input_search_div with_nav" id="input_search_div">        <input class="input_search" id="input_search_input" type="text" placeholder="Search">        </div>        <div class="map_count_ctn" id="map_count_ctn"><div class="search_count" id="search_count"></div></div>        <div class="right_search">            <div class="clear_ctn_search ctn_search" title = "'+b.get("SNNFind_clearSearch")+'"><div class="clear_btn_search fonticon fonticon-cancel-squared" style="display:none;"></div></div>            <div class="run_ctn_search ctn_search" title = "'+b.get("MapSearchView_search")+'"><div class="run_btn_search" style="opacity:0.1;"></div></div>            <div class="right_ctn_search ctn_search"></div>        </div>    </div>';function c(o,l,k){var j,n,m;if(!g.is(o,"object")){return o}m=Object.keys(o);for(j=0,n=m.length;j<n;j++){l.call(k,o[m[j]],m[j],o)}return o}var h=f.extend({name:"MapSearchView",className:"global_ctn_search",domEvents:{"click div.run_ctn_search":"_onSearch","click div.clear_ctn_search":"_onClearSearch","click span.fonticon-up-open":"_onPrevious","click span.fonticon-down-open":"_onNext","keyup input.input_search":"_onSearchInputKeyUp","keydown input.input_search":"_onSearchInputKeyDown"},template:null,setup:function(i){var j=i||{};this.template=e.compile(d);this._parent(j)},render:function(){var i=this.template();this.container.setContent(i);c({searchInput:"input.input_search",searchButton:"div.run_btn_search",searchOptionButton:".option_ctn_search",clearSearchButton:"div.clear_btn_search",onprevious:"span.fonticon-up-open",onnext:"span.fonticon-down-open",nodeCount:"div.search_count"},function(j,k){this["$"+k]=this.getElement(j)},this);this.$searchInput.placeholder=b.MapSearchView_search;setTimeout((function(){this.$searchInput.focus()}).bind(this),500);return this},setCount:function(i){this.$nodeCount.setContent(i.index+"/"+i.total)},_onSearch:function(){if(g.is(this.options.callbacks.onSearch,"function")){this.options.callbacks.onSearch.call(null,{searchValue:this.$searchInput.value})}},_onClearSearch:function(){this.$searchInput.value="";this.$clearSearchButton.hide();this.$searchButton.setStyle("opacity","0.1");if(this.$onprevious!==null&&this.$onnext!==null&&this.$nodeCount!==null){this.$onprevious.hide();this.$onnext.hide();this.$nodeCount.setContent("")}if(g.is(this.options.callbacks.onClear,"function")){this.options.callbacks.onClear.call(null)}},_onSearchInputKeyUp:function(){if(this.$searchInput.value){this.$searchButton.setStyle("opacity","1");this.$clearSearchButton.setStyle("display","inline-block")}else{this.$clearSearchButton.hide();if(this.$onprevious!==null&&this.$onnext!==null&&this.$nodeCount!==null){this.$nodeCount.setContent("");if(this.$nodeCount.hasClassName("noSearchMatched")){this.$nodeCount.removeClassName("noSearchMatched")}}this.$searchButton.setStyle("opacity","0.1")}},_onPrevious:function(){if(g.is(this.options.callbacks.onPrevious,"function")){this.options.callbacks.onPrevious.call(null)}},_onNext:function(){if(g.is(this.options.callbacks.onNext,"function")){this.options.callbacks.onNext.call(null)}},_onSearchInputKeyDown:function(i){if(a.whichKey(i)==="return"||i.keyIdentifier==="Enter"||i.keyIdentifier==="return"){this._onSearch()}a.stopPropagation(i)},});return h});define("DS/SNNavigationMap/MapSettings",["text!DS/SNNavigationMap/assets/SNNavigationMap.settings.json","UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(f,a,g,i,h,j,c,k,b,e){var d=a.singleton(i,{name:"navigation_map_settings",options:{},_logger:null,init:function(){this._logger=c.getLogger(d);this._logger.log("init");var l=JSON.parse(f);this.setOptions(l);this._updateSettingsFromURL()},getLang:function(){return this.getOption("lang")},getYOffset:function(){if(this.getLayoutAxis()==="x"){if(this.getThumbnailsMode()==="thumbnailsMode"){return 150}else{return 75}}else{return 250}},getNodesWidth:function(){return 170},getNodesHeight:function(){if(this.getThumbnailsMode()==="thumbnailsMode"){return 130}else{return 65}},getExpendHeight:function(){return 23},getLayoutMode:function(){return this.getOption("layoutMode")},setLayoutMode:function(l){if(l==="true"||l==="recompute"||l===true){this.setOption("layoutMode","recompute")}else{this.setOption("layoutMode",false)}},getThumbnailsMode:function(){return this.getOption("thumbnails2d")},setThumbnailsMode:function(l){if(l==="true"||l==="thumbnailsMode"||l===true||l===undefined){this.setOption("thumbnails2d","thumbnailsMode")}else{this.setOption("thumbnails2d",false)}},getLayoutAxis:function(){return this.getOption("layoutAxis")},getLayoutDirection:function(){return this.getOption("layoutDirection")},getRoles:function(){var n=this.getOption("user_granted_roles"),l=[];if(n){if(typeof n==="string"&&(n[0]==="{"||n[0]==="[")){n=JSON.parse(n)}if(g.is(n,"array")){for(var m=0;m<n.length;m++){l.push(n[m].id)}}}return l},getPlatformId:function(){return this.getCurrentTenantName()},get3DSpaceUrl:function(){if(!g.is(this.getOption("platform_services"),"array")&&this.getOption("platform_services")!=="ODT_MODE"){throw new Error("Platform services not initialize yet")}var l=this.getCurrentTenantId();return this.getOption("platform_services")[l]["3DSpace"]},get3DSearchUrl:function(){if(!g.is(this.getOption("platform_services"),"array")&&this.getOption("platform_services")!=="ODT_MODE"){throw new Error("Platform services not initialize yet")}var l=this.getCurrentTenantId();return this.getOption("platform_services")[l]["3DSearch"]},setLang:function(l){this.setOption("lang",l)},getCurrentTenantName:function(){return this._currentTenant},get_current_tenant_idx:function(){if(UWA.is(current_tenant)){var l=current_tenant;if(!UWA.is(current_tenant_idx)||platform_services[current_tenant_idx].displayName!==l){for(var m=0;m<platform_services.length&&!UWA.is(current_tenant_idx);m++){if(platform_services[m].displayName===l){current_tenant_idx=m}}}}if(!UWA.is(current_tenant_idx)){logger.warn("Share current tenant and security context thru PADCommandProxy");current_tenant_idx=0}return current_tenant_idx},getCurrentTenantId_:function(){var n=this.getOption("platform_services");if(g.is(this._currentTenant)){var l=this._currentTenant;if(!g.is(this._currentTenantIdx)||n[this._currentTenantIdx].platformId!==l){for(var m=0;m<n.length&&!g.is(this._currentTenantIdx);m++){if(n[m].platformId===l){this._currentTenantIdx=m}}}}if(!g.is(this._currentTenantIdx)){this._currentTenantIdx=0}return this._currentTenantIdx},getCurrentTenantId:function(){var n=this.getOption("platform_services");if(g.is(this._currentTenant)){var l=this._currentTenant;if(!g.is(this._currentTenantIdx)||n[this._currentTenantIdx].platformId!==l){for(var m=0;m<n.length;m++){if(n[m].platformId===l){this._currentTenantIdx=m}}}}if(!g.is(this._currentTenantIdx)){this._currentTenantIdx=0}return this._currentTenantIdx},getTenantsPreference:function(){var m=[],l=this.getOption("platform_services");if(!g.is(l,"array")){throw new Error("Platform services not initialize yet")}l.forEach(function(n){m.push({label:n.displayName,value:n.platformId})});return m},getSecurityContext:function(){var l=this;return new h(function(n,m){if(l.getOption("Map_SecurityContext")){n(l.getOption("Map_SecurityContext"))}else{var o=l.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext";j.authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",onComplete:function(r){var q=JSON.parse(r);if(q&&q.SecurityContext){var p=q.SecurityContext;var s="";if(p.indexOf("ctx::")!==0){s="ctx::"}p=s+p;l.setOption("Map_SecurityContext",p);n(p)}},onFailure:function(p){console.log(p);p.type="generic";m(p)},onTimeout:function(p){console.log(p);p.type="timeout";m(p)}})}})},getUserID:function(){var l=k.getUser(),m=(l!==null&&l!==undefined&&l.login!==undefined)?k.getUser().login:"";return m},appInitializationPromised:function(n){var m=this,o=new h(function(q,p){if(n){m.setOption("platform_services",n.platform_services);var r=m.getTenantsPreference();if(!m._currentTenant&&r[0]){m._currentTenant=r[0].value}if(n.noautomode){m.setOption("noautomode",true)}q()}else{b.getPlatformServices({onComplete:function(s){m.setOption("platform_services",s);var t=m.getTenantsPreference();if(!m._currentTenant){m._currentTenant=widget.getValue("selected_tenant")||t[0].value}m._updateWidgetPref();q()},onFailure:function(s){p(s);console.error(s)}})}}),l=new h(function(p){if(n){m.setOption("user_granted_roles",n.user_granted_roles);p()}else{b.getGrantedRoles(function(q){m.setOption("user_granted_roles",q);p()})}});return h.all([o,l])},_updateWidgetPref:function(){widget.addPreference({name:"selected_tenant",type:"list",label:e.get("tentantPreferenceLabel"),defaultValue:this._currentTenant,options:this.getTenantsPreference()})},setCurrentTenant:function(l){this._currentTenant=l},_updateSettingsFromURL:function(){var m=window.location.search.substring(1);var o=m.split("&");var n={};for(var l=0;l<o.length;l++){var p=o[l].split("=");if(p.length===1&&p[0]!==""){n[p[0]]=true}else{if(p.length===2){if(p[0].length>0){n[p[0]]=p[1]}}}}this.setOptions(n)},getTimeout:function(){var l=this.getOption("timeout");return Math.min(l,180000)},getnav_history:function(){return this.getOption("nav_history")},});return d});define("DS/SNNavigationMap/commands/SNNavigationMapCommands",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger"],function(d,b,a){var c=b.extend({name:"navigation_map_actionbar",init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},execute:function(){if(!this._ctx){a.log("SNNavigationMap: No context for the action bar");return}switch(this._id){case"computePaths":this._ctx.computePaths();break;case"Customize":this._ctx.customize();break;case"fitAll":this._ctx.fitAllInMap();break;case"clearMap":this._ctx.clearMapClick();break;case"searchMap":this._ctx.searchMap();break;case"printMap":this._ctx.printMap();break;case"refreshMap":this._ctx.refreshMapCmd();break;case"initMultiSelection":this._ctx.initMultiSelectionFromCmd();break;case"stopMultiSelection":this._ctx.stopMultiSelectionFromCmd();break;case"clearSelection":this._ctx.clearSelectionFromCmd();break;case"selectAll":this._ctx.selectAllFromCmd();break;default:throw new Error("Invalid command id "+this._id)}}});return c});define("DS/SNNavigationMap/views/CustomizeDisplayView",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/WebappsUtils/WebappsUtils","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","text!DS/SNNavigationMap/assets/templates/customize.html","text!DS/SNNavigationMap/assets/templates/displayPref.html","text!DS/SNNavigationMap/assets/templates/customizeGrouped.html","DS/Notifications/NotificationsManagerUXMessages","DS/Controls/Accordeon","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(j,a,b,c,n,h,l,d,i,g,m,k,f){var e=a.extend({name:"CustomizeDisplay",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(o){var p=j.clone(o,false);this._immersiveFrame=new h();this._immersiveFrame.inject(this.container);this._groupRelations=o.needTranslate||false;this._displayPrefTemplate=b.compile(i);this.currentProfile=o.currentProfile;this.dimensions={};this.dimensions.position={};this.dimensions.position.offsetX=0;this.dimensions.position.offsetY=50;this.dimensions.dialogWidth=264;this.dimensions.dialogHeight=150;this.firstLaunch=true;this._notifManager=m;this._thumbnails2d=o.thumbnails2d;this._recompute=o.recomputeLayout;this._showpub=o.showpub},render:function(){var r=this._displayPrefTemplate.call(null,{thumbnails2DNls:f.get("thumbnails2DNls"),recumputeNls:f.get("recumputeNls"),ltrNls:f.get("ltrNls"),rtlNls:f.get("rtlNls"),tbNls:f.get("tbNls"),btNls:f.get("btNls"),showpubnls:f.get("showPub"),graphOrientationNls:f.get("graphOrientationNls"),thumbnailsIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/32/I_ExpandCollapseThumbnails.png"),thumbnailscbValue:this._thumbnails2d,recomputecbValue:this._recompute,showpubValue:this._showpub});if(this._dialog===null){this._dialog=new n({title:f.get("SNNavigationMap.CustomizeDisplay.Title"),content:r,immersiveFrame:this._immersiveFrame,expandedFlag:false,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:100,minHeight:50,resizableFlag:true,position:{at:"top left",my:"top left"},buttons:{Cancel:new l({label:f.get("SNNCustomize_Cancel"),onClick:this._destroyCurrentDialog.bind(this)}),Save:new l({label:f.get("SNNCustomize_Save"),onClick:this._okClick.bind(this)})}});this._dialog.position.offsetX=this.dimensions.position.offsetX;this._dialog.position.offsetY=this.dimensions.position.offsetY;this._dialog.buttons.Save.elements.button.title=f.get("SNNCustomize_Save");this._dialog.buttons.Cancel.elements.button.title=f.get("SNNCustomize_Cancel");this._dialog.elements._closeButton.setAttribute("title",f.get("SNNFind_closeFind"));j.createElement("span",{"class":"navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomLeftResizeHandler);this._dialog.addEventListener("close",this._destroyCurrentDialog.bind(this));this._dialog.elements._bottomLeftResizeHandler.addEventListener("touchstart",function(s){s.preventDefault()});var p=window.innerHeight-115;if(this.firstLaunch){this.firstLaunch=false;if(this._dialog.elements._contentDiv.clientHeight<this._dialog.elements._contentDiv.scrollHeight){var o=this._dialog.elements._contentDiv.scrollHeight-this._dialog.elements._contentDiv.clientHeight;var q=this._dialog.height+o;if(q>p){q=p}if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50}this._dialog.height=q}}else{if(this._dialog.height>p){this._dialog.height=p}if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50}}this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position.offsetY=this._dialog.position.offsetY;this._dialog._applyPosition();this._dialog._applyHeight();this._dialog._applyWidth();this.setUpEvents();this._dialog.buttons.Save.disabled=true}this._immersiveFrame.elements.container.setStyle("z-index",300)},stopMouseScroll:function(o){o.preventDefault();o.stopPropagation()},updateDisplayPref:function(o){if(o["recompute-cb"]!==undefined){this._recompute=o["recompute-cb"]}if(o["thumbnails2d-cb"]!==undefined){this._thumbnails2d=o["thumbnails2d-cb"]}if(o.showpub!==undefined){this._showpub=o.showpub}},_okClick:function(p){var o=this.getElements("input"),s=[],q=false,r={};for(var t=0;t<o.length;t++){if(o[t].className==="globalPref"){r[o[t].id]=o[t].checked}}this.dispatchEvent("ENORIPE_updateGlobalPref",[r]);if(p!==true){this.dimensions.dialogWidth=this._dialog.width;this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position=this._dialog.position;this._destroyCurrentDialog()}},updateDialogSize:function(){if(this._dialog){var o=(0.5)*(window.innerHeight-85);this._dialog.height=(o>this._dialog.minHeight)?o:this._dialog.minHeight}},updateDialogSizeOnResize:function(){if(this._dialog){var o=window.innerHeight-115;this._dialog.height=(o>this._dialog.minHeight)?o:this._dialog.minHeight;this.dimensions.dialogHeight=this._dialog.height;if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50;this.dimensions.position.offsetY=this._dialog.position.offsetY}this._dialog._applyPosition();this._dialog._applyHeight()}},setUpEvents:function(){var o=this.getElements("input");if(o.length>0){for(var p=0;p<o.length;p++){o[p].addEventListener("click",this.onCheckboxClick.bind(this))}}},onCheckboxClick:function(o){this._dialog.buttons.Save.disabled=false;this._dialog.buttons.Cancel.disabled=false},_destroyCurrentDialog:function(){this._immersiveFrame.elements.container.setStyle("z-index",0);this.dimensions.dialogWidth=this._dialog.width;this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position=this._dialog.position;this._dialog.destroy();this._dialog=null;this.hide()}});return e});define("DS/SNNavigationMap/views/NavigationPager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","text!DS/SNNavigationMap/assets/templates/pager.html"],function(f,e,d,c,b){var a=e.extend({name:"navigationapp-homepage-view",_matchedNodes:[],_selectedIndex:0,className:function(){return this.getClassNames("-container")},setup:function(h){var k=this;this._debug=h.debugMode;this._widgetId=h.widgetId||null;this._isWebInWin=h.isWebInWin;var i=d.compile(b),l={previousTitle:c.get("Pager-Previous"),nextTitle:c.get("Pager-Next"),closeTitle:c.get("Pager-Close")};var j=i.call(null,l),g=f.createElement("div",{"class":"ENORIPE-pager-container",html:j}).inject(this.container);this._setUpEvents()},render:function(g){if(g&&g.result&&g.result.length&&g.result.length>0){this.container.show();this._matchedNodes=g.result;this._matchedNodes.push("All");this._selectedIndex=0;this._setCount(this._matchedNodes.length);if(!g.noChangeFocus){var h=this._matchedNodes[this._selectedIndex];if(h){this.dispatchEvent("ENORIPE_HighlightNode",h)}}}else{this.container.hide()}},_setUpEvents:function(){var g=this;this.getElement(".ENORIPEPagerPreviousButton").addEventListener("click",g._prevClick.bind(g));this.getElement(".ENORIPEPagerNextButton").addEventListener("click",g._nextClick.bind(g));this.getElement(".ENORIPEPagerCloseButton").addEventListener("click",g._closeClick.bind(g))},_nextClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){if(this._selectedIndex===this._matchedNodes.length-1){this._selectedIndex=0}else{this._selectedIndex++}this._setCount(this._matchedNodes.length);var g=this._matchedNodes[this._selectedIndex];if(g){this.dispatchEvent("ENORIPE_HighlightNode",g)}}},_prevClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){if(this._selectedIndex===0){this._selectedIndex=this._matchedNodes.length-1}else{this._selectedIndex--}this._setCount(this._matchedNodes.length);var g=this._matchedNodes[this._selectedIndex];if(g){this.dispatchEvent("ENORIPE_HighlightNode",g)}}},_setCount:function(h){var g=this._selectedIndex+1,j=(this._selectedIndex+1)+"/"+(h-1),i=this.getElement(".ENORIPEPagerLabel");if(g===h){j="All"}if(i){i.setContent(j)}},_clearCount:function(){var g=this.getElement(".ENORIPEPagerLabel");if(g){g.empty()}},_closeClick:function(){this.closePager();this.dispatchEvent("ENORIPE_NavPagerClose")},closePager:function(){this._selectedIndex=0;this._matchedNodes=[];this._clearCount();this.container.hide()},destroy:function(){this._parent();this.container.destroy();this.container=null}});return a});define("DS/SNNavigationMap/views/PathPanelView",["UWA/Core","UWA/Class/View","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/Handlebars/Handlebars","text!DS/SNNavigationMap/assets/templates/paths.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/WebappsUtils/WebappsUtils","DS/Windows/Panel","DS/Windows/Dialog","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/Controls/TileView","DS/Tree/Tree","DS/Tree/TreeNodeModel","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/OpenWith","DS/UIKIT/Spinner","DS/SNNavigationMap/utils/SNNavigationServices"],function(a,t,b,l,e,j,k,u,c,h,f,r,p,i,m,o,n,s,q,d,g,v){var w=t.extend({name:"path-panel-view",_dialog:null,_pathNames:null,_paths:null,_anchor:[],_allThePaths:[],multiplePathTiles:[],models:[],allTrees:[],className:function(){return this.getClassNames("-container")},setup:function(x){var y=this;this._debug=x.debugMode;this._addinMode=x.addinMode||undefined;this._template=e.compile(j);this._widgetId=x.widgetId||null;try{this._url=l.get3DSpaceUrl()+"/resources/enorelnav/navigate/computepath?tenant="+l.getCurrentTenantName()}catch(z){this._url=null}this._pathsContainer=a.createElement("div",{"class":"paths-container"}).hide();this.dimensions={};this.dimensions.position={};this.dimensions.position.offsetX=(x.position.offsetX)?x.position.offsetX:0;this.dimensions.position.offsetY=(x.position.offsetY)?x.position.offsetY:-150;this.dimensions.dialogWidth=(x.position.dialogWidth)?x.position.dialogWidth:600;this.dimensions.dialogHeight=(x.position.dialogHeight)?x.position.dialogHeight:200;this._immersiveFrame=new p();this._immersiveFrame.inject(this.container)},renderInit:function(){this._createDialogContent();if(this._dialog===null){this._createDialog()}this.show();this._dialog.position.offsetX=this.dimensions.position.offsetX;this._dialog.position.offsetY=this.dimensions.position.offsetY;var y=window.innerHeight-115,x=window.innerWidth-180;if(this._dialog.height>y){this._dialog.height=y}if(this._dialog.width>x){this._dialog.width=x}if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50}this._dialog._applyPosition();this._dialog._applyHeight();this._dialog._applyWidth()},render:function(y){this.renderInit();if(!y){return}if(y&&y.length<1){return}for(var x=0;x<y.length;x++){this.fillDataInLine(x+1,y[x]);this.createNewLine();this.models.push(y[x])}this.findBtn.disabled=true;this.isAnchorRemoved=true},_createDialog:function(){this._dialog=new f({title:k.get("FindPaths"),content:this.mainContainer,immersiveFrame:this._immersiveFrame,expandedFlag:false,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:100,minHeight:100,resizableFlag:true,position:{at:"left",my:"center"},});a.createElement("span",{"class":"navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomLeftResizeHandler);a.createElement("span",{"class":"right-resize navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomRightResizeHandler);this._dialog.addEventListener("close",this._close.bind(this));this._dialog.elements._bottomLeftResizeHandler.addEventListener("touchstart",function(x){x.preventDefault()});this._dialog.elements._bottomRightResizeHandler.addEventListener("touchstart",function(x){x.preventDefault()})},_createDialogContent:function(){var A=this;this.mainContainer=a.createElement("div",{"class":"path-main-container"});var y=a.createElement("div",{"class":"path-input-container"}).inject(this.mainContainer);this.pathContentDiv=a.createElement("div",{"class":"path-content"}).inject(y);var C=a.createElement("div",{"class":"line-container"}).inject(this.pathContentDiv);a.createElement("div",{"class":"path-icon start-icon fonticon fonticon-anchor"}).inject(C);var x=a.createElement("div",{"class":"path-line"}).inject(C);a.createElement("div",{"class":"path-line-icon"}).inject(x);var B=a.createElement("div",{"class":"path-line-content",html:k.get("SelectStart")}).inject(x);B.setStyle("font-style","italic");this.createNewLine();var z=a.createElement("div",{"class":"findbtn-container",}).inject(y);this.findBtn=new r({label:k.get("Find"),onClick:A.showPathsBetween.bind(this)}).inject(z);this.findBtn.disabled=true;this._pathsContainer.inject(this.mainContainer)},addNodes:function(x){if(this.models.indexOf(x)!==-1){return}var y,z=this.pathContentDiv.getChildren();if(this.isAnchorRemoved){this.models.splice(0,0,x);this.fillDataInLine(0,x);if(this.models.length>1){this.findBtn.disabled=false}this.isAnchorRemoved=false;return}if(this.models.length===0){this.fillDataInLine(0,x)}else{if(this.models.length===1){this.fillDataInLine(1,x);this.findBtn.disabled=false;this.createNewLine()}}this.models.push(x);this.addModelInDialog(x)},addModelInDialog:function(y){if(this.models.length<3){return}else{var x=this.models.length-1,z=this.pathContentDiv.getChildren();if(z.length>=x){this.fillDataInLine(x,y)}this.createNewLine()}},createNewLine:function(z){var x=a.createElement("div",{"class":"line-container"}).inject(this.pathContentDiv);if(!z){a.createElement("div",{"class":"path-icon end-icon fonticon fonticon-plus"}).inject(x)}var y=a.createElement("div",{"class":"path-line"}).inject(x);a.createElement("div",{"class":"path-line-icon"}).inject(y);a.createElement("div",{"class":"path-line-content",html:k.get("SelectStop")}).inject(y);y.addClassName("last-node")},fillDataInLine:function(z,y){var B=this.pathContentDiv.getChildren(),A;B[z].getElement(".path-line").removeClassName("last-node");A=y.get("icon_url");B[z].getElement(".path-line-icon").setStyle("background-image","url("+A+")");B[z].getElement(".path-line-content").innerHTML=y.get("name");B[z].setData("id",y.get("id"));var x=a.createElement("div",{"class":"cross-icon fonticon fonticon-close"}).inject(B[z]);x.addEvent("click",this.removeLine.bind(this));var C=B[z].getElement(".path-icon");if(C){C.removeClassName("fonticon-plus");C.addClassName("fonticon-location")}},removeLine:function(B){var z=B.srcElement||B.target,y=z.getParent().getData("id"),x=-1;for(var A=0;A<this.models.length;A++){if(this.models[A].get("id")===y){x=A}}if(x!==-1){if(x===0&&!this.isAnchorRemoved){this.isAnchorRemoved=true;var C=this.pathContentDiv.getChildren();C[0].getElement(".path-line-icon").setStyle("background-image","");C[0].getElement(".path-line-content").innerHTML=k.get("SelectStart");z.remove();this.models.splice(x,1);this.findBtn.disabled=true;return}this.models.splice(x,1)}if(this.models.length===1){this.findBtn.disabled=true}z.getParent().remove()},renderPaths:function(){for(var x=0;x<this.tilesContent.length;x++){this._pathsContainer.addContent(this.tilesContent[x])}if(this._pathsContainer.getDimensions().height===130){}else{}if(this._paths){this._pathsContainer.show()}this.dispatchEvent("PathPanelViewRender");return this},_onDragEnd:function(){this.dispatchEvent("ENORIPE_dragEnd")},_buildDragMessage:function(G){var C=null,I="false",K=[],J=this._pathsContainer.getChildren();if(a.is(this._paths,"array")&&G<this._allThePaths.length){C=this._allThePaths[G]}var z=null,y={},L;try{L=(v.isWebInWin())?"OnPremise":l.getPlatformId()}catch(H){L=""}if(C===null){return false}else{y={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:(v.isWebInWin())?"web_in_win":this._widgetId,data:{items:[]}};for(var F=0;F<this._allThePaths.length;F++){I=J[F].getAttribute("isSelected");if(I==="true"||F===G){C=this._allThePaths[F];z=C[0];K={envId:L,serviceId:"3DSpace",contextId:"",objectId:z.resourceid,objectType:z.type,displayName:z.displayName,displayType:z.type,session_object:false,path:C};y.data.items.push(K)}}if(v.isWebInWin()){var D,B,x,A=[];for(var F=0;F<this._allThePaths.length;F++){D=[];B=0;x=[];I=J[F].getAttribute("isSelected");if(I==="true"||F===G){C=this._allThePaths[F];z=C[0];D=C;B=D.length;for(var E=0;E<B;E++){x.push(D[E].resourceid)}A.push(x)}}if(A.length>0){v.sendToMapWebInWin("RefreshOnDragPath",A,"path")}}}return y},createTreeView:function(G,x){var B=a.createElement("div",{"class":"tree-container",}).inject(x);var y=Math.floor(G.length/2)+1,D=y*30;var H=new m({enableTreeColumnEllipsisOverflow:true,height:D,useAsyncPreExpand:true,roots:[{label:G[0].displayName,icons:[G[0].icon_url],children:[]}]}).inject(B);if(G.length>2){var C=H.getRoots()[0],z,E="";for(var A=2;A<G.length;A++){if(A===2){E=G[A].displayName+"("+G[1].name+")";z=C.addChild(new o({label:E,icons:[G[A].icon_url]}))}else{if(G[A].displayName){E=G[A].displayName+"("+G[A-1].name+")";z=z.addChild(new o({label:E,icons:[G[A].icon_url]}))}}}}B.addEventListener("click",function(I){I.stopPropagation();I.preventDefault()});var F=H.getRoots();if(F.length>0){F[0].expandAll()}B.hide();this.allTrees.push(H)},_close:function(){this.dimensions.dialogWidth=this._dialog.width;this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position=this._dialog.position;this._pathNames=null;this._paths=null;this.models=[];this._dialog.destroy();this._dialog=null;this.hide();this.dispatchEvent("PathPanelViewClose")},showPathsBetween:function(){var A=this,C={widgetId:this._widgetId,idTo:A.models[0].get("id"),reverseDirection:false,bothWays:true},B=true;if(this._debug){C.debug=true}this._pathsContainer.setContent("");this.multiplePathTiles=[];this._allThePaths=[];this._anchor=A.models[0];this.models=A.models;this._paths=[];this.allTrees=[];var y=1,z=A.models.length;if(!this._pathSpinner){this._pathSpinner=new g().inject(a.createElement("div",{"class":"path-panel-spinner",styles:{position:"absolute",left:"49%"}}).inject(this._dialog.elements._titleBarDiv))}this._pathSpinner.show();this._pathsContainer.setContent("");var x=function(){if(A._url){A._selected=A.models[y];C.idFrom=A.models[y].get("id");b.authenticatedRequest(A._url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(C),onComplete:function(D){if(B){A._pathsContainer.setContent("");B=false}A._parseResponse(JSON.parse(D));A.renderPaths();y++;if(y===z){A._pathSpinner.hide();A.setUpEvents()}if(y<z){x()}},onFailure:function(E){console.log(E);if(B){A._pathsContainer.setContent("");B=false}var D={};D.type="generic";A._pathSpinner.hide();A.dispatchEvent("ENORIPE_handleErrorMsgs",[D])},onTimeout:function(E){console.log(E);if(B){A._pathsContainer.setContent("");B=false}var D={};D.type="timeout";A._pathSpinner.hide();A.dispatchEvent("ENORIPE_handleErrorMsgs",[D])}})}};x()},_parseResponse:function(B){this._paths=B.paths;var A=this._allThePaths.length;for(var D=0;D<B.paths.length;D++){this._allThePaths.push(B.paths[D])}this.tilesContent=[];var L=this._paths,C=[],M=[],F="",I,y=c.getWebappsAssetUrl("SNNavigationMap","icons/ui/grippy.png");if(L.length){for(var E=0;E<L.length;E++){var z=E+A,x=a.createElement("div",{"class":"path-container",id:"map-path-container-"+z}),K=a.createElement("div",{"class":"list-node",id:"map-path-"+z,draggable:"true"}).inject(x),H=[];this.multiplePathTiles.push(H);this.tilesContent.push(x);M=L[E];F="";I=new i({size:"small"});I.setPicture(M[0].thumbnail);var J=this.createTileContent(M);I.setTitle(J);I.setDescription("");I.setSubtitle("");I.inject(K);H.push(I);C.push({img:'<img class="drag-tooltip" src="'+y+'" />',name:F});if(!(v.isWebInWin()||this.ODTMode)){var G=this._createOpenWithContent(M);this._createDropDown(I,G)}I.elements.menu.hide();this.createTreeView(L[E],x)}this._pathNames={content:C}}else{this.dispatchEvent("noPathsFound",{anchor:this._anchor.get("name"),selected:this._selected.get("name")})}},_createOpenWithContent:function(B){var A=this;var y={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:(v.isWebInWin())?"web_in_win":this._widgetId,data:{items:[]}};if(B.length>0){var x=B[0],z={envId:l.getPlatformId()||"OnPremise",serviceId:"3DSpace",contextId:"",objectId:x.resourceid,objectType:x.type,displayName:x.displayName,displayType:x.type,session_object:false,path:B};y.data.items.push(z)}return y},_createDropDown:function(B,A){var y=a.createElement("div",{"class":"openWith-container"}).inject(B.elements.cartoucheContent),C=a.createElement("span",{"class":"fonticon fonticon-chevron-down"}).inject(y);B.elements.openWith=y;B.elements.openWith.addEventListener("click",function(D){D.stopPropagation()});var x={target:B.elements.openWith,items:[]},z=new q(x);new d().set3DXContent(A).render(z);return z},createTileContent:function(B){var y=a.createElement("div",{"class":"tileview-title",}),z=B.length,A;if(B.length===0){return""}if(B.length>5){y.addContent(a.createElement("span",{"class":"tileview-title-text",html:B[0].displayName+"..."}))}else{y.addContent(a.createElement("span",{"class":"tileview-title-text",html:B[0].displayName}))}y.addContent(a.createElement("span",{"class":"path-links fonticon fonticon-play"}));if(B.length===3){y.addContent(a.createElement("span",{"class":"tileview-title-text",html:B[2].displayName}))}else{y.addContent(a.createElement("span",{"class":"tileview-title-text",html:B[z-3].displayName}));A=a.createElement("span",{"class":"path-links fonticon fonticon-play"});y.addContent(A);y.addContent(a.createElement("span",{"class":"tileview-title-text",html:B[z-1].displayName}))}var x=Math.floor(B.length/2)+1;y.addContent(a.createElement("span",{"class":"tileview-title-nodecount",html:" ("+x+" nodes)",events:{click:function(C){C.stopPropagation();C.preventDefault();var D=this.getParent(".path-container");D.getElement(".tree-container").toggle()}}}));return y},setUpEvents:function(){if(this._addinMode==="catiav5"||this._addinMode==="solidworks"){return}var x=this,A=this._pathsContainer.getChildren(),B;if(a.is(A,"array")){for(var z=0;z<A.length;z++){var y=A[z];if(a.is(y)){y.addEventListener("dragstart",function(G){var F=this.id;if(a.is(F)){var D=F.split("-").pop();var E=x._buildDragMessage(parseInt(D));if(!E){x.dispatchEvent("_showError",[{message:"noPathSelected"}]);return false}E=JSON.stringify(E);if(G.dataTransfer){if(v.isWebInWin()){G.dataTransfer.setData("text",E)}else{try{G.dataTransfer.setData("text",E);G.dataTransfer.setData("text/searchitems",E)}catch(C){console.log(C);G.dataTransfer.setData("Text",E)}}}if(!(v.isWebInWin())){u.closeWidget()}}});y.addEventListener("dragend",this._onDragEnd.bind(this));y.addEventListener("click",function(E){E.stopPropagation();var C=A.indexOf(this);if(C===-1){return}B=x.multiplePathTiles[C];if(a.is(B)){this.setAttribute("isSelected","true");if(!(E.toElement.hasClassName("wux-ui-fa"))){B.forEach(function(F){F.elements.checkbox.toggle()})}var D=this.getElementsByTagName("input")[0].checked;this.getElementsByTagName("input")[0].checked=!D;if(this.getElementsByTagName("input")[0].checked){this.setAttribute("isSelected","true")}else{this.setAttribute("isSelected","false")}}x._setPathOnCompass(C)})}}}},_setPathOnCompass:function(A){var D=this,C=[],y=false,z=null,x=this._pathsContainer.getChildren();for(var B=0;B<this._allThePaths.length;B++){y=x[B].getAttribute("isSelected");if(y==="true"){C.push(this._allThePaths[B])}}if(C.length>0){z=this._buildDragMessage(A)}else{z={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:D._widgetId,data:{items:[]}}}this.dispatchEvent("ENORIPE_SetPathOnCompass",[z])},updateDialogSizeOnResize:function(){if(this._dialog){var y=window.innerHeight-115,x=window.innerWidth-180;if(this._dialog.height>y){this._dialog.height=y}if(this._dialog.width>x){this._dialog.width=x}if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50}this._dialog._applyPosition();this._dialog._applyHeight();this._dialog._applyWidth()}},_destroyCurrentDialog:function(){this.dimensions.dialogWidth=this._dialog.width;this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position=this._dialog.position},destroy:function(){this._dialog.destroy();this._dialog=null;this.container=null;this._parent()}});return w});define("DS/SNNavigationMap/views/MapViewFind",["i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","UWA/Core","UWA/Class/View","UWA/Class/Options","DS/SNNavigationMap/views/MapSearchView","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Toggle","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/D3js_external/D3js","DS/SNNavigationMap/MapSettings","css!DS/SNNavigationMap/SNNavigationMap"],function(n,h,a,j,e,g,i,k,c,f,m,d){function l(){var o="500";if(document.body.scrollHeight>40){o=document.body.scrollHeight}return o}var b=a.extend(j,{name:"MapViewFind",_modal:null,options:{isMatchCase:false,isWholeWord:false},_matchedNodes:[],_idx:0,init:function(r){this._parent(r);this.setOptions(r);if(!r.renderTo){r.renderTo=document.body}this.modalBodyContainer=h.createElement("div",{"class":"modal-content-container"});this.panelContainer=h.createElement("div",{"class":"MapViewFind-panel-container"});var p=h.createElement("div",{"class":"modal-content"});var t=h.createElement("div",{"class":"modal-base"});var s=this;this._mapsrcview=new e({callbacks:{onSearch:this._onMapSearch.bind(this),onNext:this._onSearchNext.bind(this),onPrevious:this._onSearchPrevious.bind(this),onClear:this._clearSearch.bind(this),}}).render().inject(p);this._arrowNavigationButtons=new i({className:s.name+"_arrow_btn_grp",buttons:[s.searchPreviousButton=new g({className:s.name+"_btn "+s.name+"_upArrow",icon:"up-open-big",attributes:{title:n.get("SNNFind_Previous")},events:{onClick:function(){s._onSearchPrevious()}}}),s.searchNextButton=new g({className:s.name+"_btn "+s.name+"_downArrow",icon:"down-open-big",attributes:{title:n.get("SNNFind_Next")},events:{onClick:function(){s._onSearchNext()}}})],}).inject(p);s.searchPreviousButton.disable();s.searchNextButton.disable();this.matchCaseCheckBox=new k({id:"matchCaseCheckBox",className:s.name+"_btn "+s.name+"_matchCase  toggle-primary",type:"checkbox",attributes:{title:n.SNNFind_matchcase},value:n.SNNFind_matchcase,label:n.SNNFind_matchcase,checked:false}).inject(t);this.wholeWordCheckBox=new k({id:"wholeWordCheckBox",className:s.name+"_btn "+s.name+"_wholeWord toggle-primary",attributes:{title:n.SNNFind_wholeword},type:"checkbox",value:n.SNNFind_wholeword,label:n.SNNFind_wholeword,checked:false}).inject(t);this.matchCaseCheckBox.elements.container.setAttribute("title",n.get("SNNFind_matchcase"));this.wholeWordCheckBox.elements.container.setAttribute("title",n.get("SNNFind_wholeword"));this.nodeCount=h.createElement("div",{"class":"search_count"}).inject(t);t.inject(p);this._modal=h.createElement("div",{"class":this.name+"_modal"});this._mapsrcview.$searchInput.addEventListener("focusin",this.handleFocusIn.bind(this));this._mapsrcview.$searchInput.addEventListener("focusout",this.handleFocusOut.bind(this));p.inject(this._modal);this._modal.inject(this.modalBodyContainer);this._immersiveFrame=new f();this._immersiveFrame.inject(this.panelContainer);this.searchPanel=new c({title:n.get("SNNavigationMap.searchMap.Title"),content:this.modalBodyContainer,immersiveFrame:this._immersiveFrame});this.panelContainer.inject(r.renderTo);this.searchPanel.elements._closeButton.onclick=function(){s.dispatchEvent("ENORIPE_clearSearch")};var u=l();var q=window.innerWidth;if(r.position.x===0&&r.position.y===0){this.searchPanel.position.offsetX=q/2-170;this.searchPanel.position.offsetY=u-200;this.searchPanel._applyPosition()}else{this.searchPanel.position.offsetX=r.position.x;this.searchPanel.position.offsetY=r.position.y;this.searchPanel._applyPosition()}var o=this.panelContainer.getElement(".wux-windows-panel");o.addEventListener("dragenter",function(v){v.stopPropagation()})},_onMapSearch:function(o){if(o.searchValue.length){this._clearSearch();this.dispatchEvent("ENORIPE_performSearch",[o.searchValue,{isMatchCase:this.matchCaseCheckBox.isChecked(),isWholeWord:this.wholeWordCheckBox.isChecked()}]);if(this._matchedNodes.length>0){this._idx=0;this._selectInList();if(this._matchedNodes.length>1){this.searchPreviousButton.disable();this.searchNextButton.enable()}}else{this.nodeCount.setContent("0 of 0");if(!this.nodeCount.hasClassName("noSearchMatched")){this.nodeCount.addClassName("noSearchMatched")}this.searchPreviousButton.disable();this.searchNextButton.disable()}}else{this._clearSearch()}},_onSearchNext:function(){if(this._matchedNodes.length>1){if(this._idx<this._matchedNodes.length-1){this._idx=this._idx+1}else{if(this._idx===this._matchedNodes.length-1){this._idx=0}}if(this._matchedNodes.length>0){this._selectInList()}if(this._idx===this._matchedNodes.length-1){this.searchNextButton.disable()}if(this._idx<=this._matchedNodes.length-1&&this.searchPreviousButton.isDisabled()){this.searchPreviousButton.enable()}if(this._idx===0){this.searchPreviousButton.disable()}}},_onSearchPrevious:function(){if(this._matchedNodes.length>1){if(this._idx>0){this._idx=this._idx-1}else{if(this._idx===0){this._idx=this._matchedNodes.length-1}}if(this._matchedNodes.length>0){this._selectInList()}if(this._idx===0){this.searchPreviousButton.disable()}if(this._idx<this._matchedNodes.length-1&&this.searchNextButton.isDisabled()){this.searchNextButton.enable()}if(this._idx===this._matchedNodes.length-1){this.searchNextButton.disable()}}},_clearSearch:function(){var o=this;if(this._matchedNodes){m.selectAll(this._matchedNodes).selectAll(".small-rect").filter(":not(.first)").classed("currentSearchNode",false).classed("searchMatched",false);m.selectAll(this._matchedNodes).selectAll(".node-text").classed("searchTextColorReset",false);m.selectAll(this._matchedNodes).selectAll(".thumbnail-background").classed("currentSearchNode",false).classed("searchMatched",false)}if(this.nodeCount.hasClassName("noSearchMatched")){this.nodeCount.removeClassName("noSearchMatched")}this.nodeCount.setContent("");o._matchedNodes=[]},getTranslation:function(q){var w={isTranslateReq:false,X:0,Y:0};var v=(0.8)*window.innerHeight;var z=(0.8)*window.innerWidth;var t=parseInt(q.getElement(".background").getAttribute("width"));var A=parseInt(q.getElement(".background").getAttribute("height"));var y=q.getOffsets();var x=y.x;var u=y.y;var s=0;var p=0;var r=0;var o=0;if(x<0){r=x}else{r=x+t}if(u<0){o=u}else{o=u+A}if(r<0){s=(0-r)+(0.3*z)}else{if(r>z){s=z-r-(0.3*z)}}if(o<0){p=(0-o)+(0.3*v)}else{if(o>v){p=v-o-(0.3*v)}}if(s!==0||p!==0){w.isTranslateReq=true;w.X=s;w.Y=p}return w},_scrollToNode:function(r){var s=m.transform(m.select("g").attr("transform")).scale[0];var p=m.transform(m.select("g").attr("transform")).translate[0];var o=m.transform(m.select("g").attr("transform")).translate[1];var q=this.getTranslation(r);q.X=p+q.X;q.Y=o+q.Y;if(q.isTranslateReq){m.select("g").transition().duration(500).attr("transform","translate("+q.X+","+q.Y+") scale("+s+")")}},_selectInList:function(){if(this._matchedNodes){if(d.getThumbnailsMode()===false){m.selectAll(this._matchedNodes).selectAll(".thumbnail-background").classed("currentSearchNode",false);m.select(this._matchedNodes[this._idx]).selectAll(".thumbnail-background").classed("currentSearchNode",true)}else{m.selectAll(this._matchedNodes).selectAll(".small-rect").filter(":not(.first)").classed("currentSearchNode",false);m.select(this._matchedNodes[this._idx]).selectAll(".small-rect").filter(":not(.first)").classed("currentSearchNode",true)}var o=this.getTranslation(this._matchedNodes[this._idx]);if(o.isTranslateReq){this._scrollToNode(this._matchedNodes[this._idx])}}this.nodeCount.setContent(this._idx+1+" of "+this._matchedNodes.length)},handleFocusIn:function(){var o=document.querySelector(".global_ctn_search");if(o&&o.hasClassName("MapViewFind_onFocusOut")){o.removeClassName("MapViewFind_onFocusOut")}if(o&&!o.hasClassName("MapViewFind_onFocusIn")){o.addClassName("MapViewFind_onFocusIn")}},handleFocusOut:function(){var o=document.querySelector(".global_ctn_search");if(o&&o.hasClassName("MapViewFind_onFocusIn")){o.removeClassName("MapViewFind_onFocusIn")}if(o&&!o.hasClassName("MapViewFind_onFocusOut")){o.addClassName("MapViewFind_onFocusOut")}},});return b});define("DS/SNNavigationMap/views/CustomizeView",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/MapSettings","DS/Handlebars/Handlebars","DS/WebappsUtils/WebappsUtils","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","text!DS/SNNavigationMap/assets/templates/customize.html","text!DS/SNNavigationMap/assets/templates/displayPref.html","text!DS/SNNavigationMap/assets/templates/customizeGrouped.html","DS/Notifications/NotificationsManagerUXMessages","DS/Controls/Accordeon","DS/UIKIT/Iconbar","DS/UIKIT/Autocomplete","DS/UIKIT/DropdownMenu","DS/Controls/ComboBox","DS/UIKIT/SuperModal","DS/UIKIT/Form","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(a,u,l,c,b,e,p,q,v,i,m,f,o,g,s,r,h,t,d,j,n,k){var w=u.extend({name:"Customize",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(x){var z=a.clone(x,false),y=this;if(!z.settings){return}this._immersiveFrame=new p();this._immersiveFrame.inject(this.container);this._groupRelations=x.needTranslate||false;this._template=c.compile((this._groupRelations?m:v));this._displayPrefTemplate=c.compile(i);this.currentProfile=x.currentProfile;this.dimensions={};this.dimensions.position={};this.dimensions.position.offsetX=0;this.dimensions.position.offsetY=50;this.dimensions.dialogWidth=400;this.dimensions.dialogHeight=520;this.firstLaunch=true;this._notifManager=f;this._thumbnails2d=x.thumbnails2d;this._recompute=x.recomputeLayout;this._autoNav=x.autoNav;this._templateContent={relations:this._translateRelations(z.settings),automaticNavigation:this._autoNav,notPresent:z.notPresentRelations,title:z.title,sectionName:k.get("relationsToShow"),moreName:k.get("Customize-More"),lessName:k.get("Customize-Less"),moreNls:k.get("Customize-MoreTitle"),lessNls:k.get("Customize-LessTitle"),expanderTitle:k.get("Customize-ExpanderTitle"),bodyText:this._getBodyText(x.currentProfile,z.settings)};this._initComboBox(x)},_getBodyText:function(z,x){var B;if(this._autoNav){if(x&&Object.keys(x)){var A=this._isAbsentRelExpanded();if(A){B=k.get("Customize_AllRelBodyText_More")}else{B=(Object.keys(x).length===0)?k.get("Customize-NoRelation"):k.get("Customize_AllRelBodyText_Less")}}return B}var y=k.get(z);if(y.contains(" Relations")){y=y.replace(" Relations","")}B=k.replace(k.get("Customize_BodyText"),{N:y});return B},_initComboBox:function(G){this.profileArray=G.profileArray;this.nlsProfileArray=[];var z=G.lastUsedProfile,E=160,y=0,F,x=G.lang||null;for(var A=0;A<this.profileArray.length;A++){this.nlsProfileArray[A]=k.get(this.profileArray[A].name);if(x){F=(x==="ja")?14:7}else{F=7}E=(E<this.nlsProfileArray[A].length*F)?this.nlsProfileArray[A].length*F:E;if(z!==null&&z!==""&&z!==undefined){if(this.profileArray[A].name===z){y=A}if(z==="AutoModeProfile"){this._autoNav=true}else{this._autoNav=false}}}this.profileTreeDocument=new j();for(var B=0;B<this.nlsProfileArray.length;B++){var C={label:this.nlsProfileArray[B],data:{name:this.profileArray[B].name}};if(this.profileArray[B].type){C.data.type=this.profileArray[B].type}var D=new n(C);this.profileTreeDocument.addRoot(D)}this.currentProfile=this.profileArray[y].name;this._selectedIndex=y},_setUpComboBox:function(x){var y={elementsTree:this.profileTreeDocument,nbDisplayedElements:this.nlsProfileArray.length,enableSearchFlag:false,actionOnClickFlag:false,selectedIndex:x.selectedIndex,touchMode:true};this._profileCombobox=new h(y);this._profileCombobox.addEventListener("change",this._handleProfileChange.bind(this))},render:function(x){if(this._template===undefined||this._template===null){if(this._notifManager===null||this._notifManager===undefined){this._notifManager=f}this._notifManager.addNotif({level:"info",message:k.get("noProfile"),sticky:false});return}if(this._dialog===null){var y=this._getDialogContent(x);this._createDialog(y)}this._handleDropDownCommands();this._immersiveFrame.elements.container.setStyle("z-index",300);if(this.getElement("#relations-list")){this._relationsList=this.getElement("#relations-list")}this._previousProfile=this._getSelectedProfile().options.data.name},_renderComboBox:function(){var y=this,x=a.createElement("div",{"class":"comboBox-component",minWidth:150,title:k.get("SNNavigationMap.Profiles.Title")});this.customizeProfileContainer=a.createElement("div",{"class":"CustomizeProfile_Container item"});this._setUpComboBox({selectedIndex:y._selectedIndex});this._profileCombobox.inject(x);x.inject(this.customizeProfileContainer);return this.customizeProfileContainer},_getDialogContent:function(G){var z=this;this._templateContent.sectionName=k.get("relationsToShow")+k.get(this.currentProfile);this._templateContent.automaticNavigation=this._autoNav;this._templateContent.autoNavLabel=k.get("autoNavLabel");if(this._autoNav&&G&&G.settings&&G.notPresentRelations){this._templateContent.relations=G.settings;this._templateContent.notPresent=G.notPresentRelations}if(G&&G.settings){this._templateContent.bodyText=this._getBodyText(this.currentProfile,G.settings)}var A=this._template.call(null,this._templateContent),C=this._displayPrefTemplate.call(null,{thumbnails2DNls:k.get("thumbnails2DNls"),recumputeNls:k.get("recumputeNls"),ltrNls:k.get("ltrNls"),rtlNls:k.get("rtlNls"),tbNls:k.get("tbNls"),btNls:k.get("btNls"),graphOrientationNls:k.get("graphOrientationNls"),thumbnailsIcon:b.getWebappsAssetUrl("SNNavigationMap","icons/32/I_ExpandCollapseThumbnails.png"),thumbnailscbValue:this._thumbnails2d,recomputecbValue:this._recompute}),y=new a.createElement("div",{"class":"customize-content",draggable:"false"}),B=new a.createElement("div",{"class":"customize-headercontent",draggable:"false"}).inject(y),x=new a.createElement("div",{"class":"customize-bodycontent",html:A,draggable:"false"}).inject(y);this._autocompleteInput=new s({noResultsMessage:false,placeholder:k.get("Customize-SearchTextInvite"),events:{onKeyUp:z._onKeyUp.bind(z)}}).inject(B);var D=this._renderComboBox();D.inject(B);this._autocompleteInput.elements.container.addClassName("customize-autocomplete customize-hidden");this._autocompleteInput.elements.clear.addEventListener("click",this._clearSearch.bind(z));var F=[{fonticon:"search",text:k.get("Customize_SearchCommmand"),className:"Customize_SearchCommand",handler:function(){this.getItem(0).elements.container.toggleClassName("pressed");z._autocompleteInput.elements.container.toggleClassName("customize-hidden");z.customizeProfileContainer.toggleClassName("customize-hidden");if(z._autocompleteInput.elements.container.hasClassName("customize-hidden")){B.setStyle("justify-content","flex-end")}else{B.setStyle("justify-content","space-between")}}},{fonticon:"menu",text:k.get("Customize_RelationSet"),className:"Customize_RelationSet",handler:function(){}},{fonticon:"select-all",text:k.get("Customize_SelectAll"),className:"Customize_multisel-icons",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-all",text:k.get("Customize_SelectAll"),className:"Customize_SelectAll",selectable:true,handler:function(){z.selectAll()}},{fonticon:"select-none",text:k.get("Customize_UnSelectAll"),className:"Customize_UnSelectAll",selectable:true,handler:function(){z.clearAll()}}]}}}],E=new g({renderTo:B,className:"customize-toolbar",items:F});if(this._groupRelations){this._checkParentToggleState(y)}return y},_onKeyUp:function(y){if(this._delayTimer){clearTimeout(this._delayTimer)}var x=this;this._delayTimer=setTimeout(function(){var z=null,A=y.srcElement||y.target;z=A.value;x._performSearch(z)},500)},_performSearch:function(B){this._clearSearch();if(B.length===0){return}else{B=B.toLocaleLowerCase();var A=this.getElements(".customize-childtoggle"),D=this.getElement(".customize-bodycontent"),z=0;if(D){D.addClassName("Customize-SearchOn")}for(var y=0;y<A.length;y++){var x=k.get(A[y].value).toLocaleLowerCase();if(x.search(B)===-1){A[y].getParent().addClassName("Customize-NoSearchMatch")}else{z++;A[y].getParent().addClassName("Customize-SearchMatch");A[y].getParent().removeAttribute("hidden")}}if(z>0){var C=this.getElement(".CustomizeAbsent-relations");if(C&&C.hasClassName("customize-hidden")){C.removeClassName("customize-hidden");this.isMoreExpanded=true}}}},_clearSearch:function(){var y=this.getElements(".Customize-SearchMatch"),x=this.getElements(".Customize-NoSearchMatch"),A=this.getElement(".customize-bodycontent");y.forEach(function(B){B.removeClassName("Customize-SearchMatch");B.setAttribute("hidden","")});x.forEach(function(B){B.removeClassName("Customize-NoSearchMatch")});A.removeClassName("Customize-SearchOn");if(this.isMoreExpanded){this.isMoreExpanded=false;var z=this.getElement(".CustomizeAbsent-relations");if(z&&!z.hasClassName("customize-hidden")){z.addClassName("customize-hidden")}}},_createDialog:function(z){var y=this;this._dialog=new e({title:this._templateContent.title,content:z,immersiveFrame:this._immersiveFrame,expandedFlag:false,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:160,minHeight:250,resizableFlag:true,position:{at:"top left",my:"top left"},buttons:{Cancel:new q({label:k.get("SNNCustomize_Cancel"),onClick:this._cancelClick.bind(this)}),Save:new q({label:k.get("SNNCustomize_Save"),onClick:this._okClick.bind(this)})}});var A=this.getElement(".Customize_RelationSet").getChildren()[0],x={target:A,closeOnClick:false,className:"customize-dropdownmenu"};x.items=[{id:"customize-saverelationset",text:k.get("Customize_SaveRelationSet"),className:"customize-hidden customize-item",handler:function(){y._onSaveClick()},},{id:"customize-deleterelationset",text:k.get("Customize_DeleteRelationSet"),className:"customize-hidden customize-item",handler:function(){y._onDeleteClick()},},{id:"customize-createrelationset",text:k.get("Customize_CreateRelationSet"),className:"customize-item",handler:function(){y._onCreateClick()},}];this.relationSetMenu=new r(x);this.relationSetMenu.addEvent("onClickOutside",function(B){this.toggle()});this.relationSetMenu.addEvent("onShow",function(){if(y.isCustomProfileSet()){y._showHideDropDownCommands("customize-deleterelationset",true)}y._handleDropDownCommands();if(y._isDropDownCmdHidden()){}});this._dialog.buttons.Save.elements.button.title=k.get("SNNCustomize_Save");this._dialog.buttons.Cancel.elements.button.title=k.get("SNNCustomize_Cancel");a.createElement("span",{"class":"navigation-dialog-resize fonticon fonticon-resize-full"}).inject(this._dialog.elements._bottomLeftResizeHandler);this._dialog.addEventListener("close",this._cancelClick.bind(this));this._dialog.elements._bottomLeftResizeHandler.addEventListener("touchstart",function(B){B.preventDefault()});this._adjustDialogDimensions();this.setUpEvents();this._dialog.buttons.Save.disabled=true},selectAll:function(){var y=this.getElements("input"),x=this.getElements(".customized-grouprel-mixed"),z=false;y.forEach(function(A){if(A.type==="checkbox"){if(typeof A.checked!=="undefined"&&A.checked===false){z=true}A.checked=true}});x.forEach(function(A){A.removeClassName("customized-grouprel-mixed")});if(z){this._dialog.buttons.Save.disabled=false}this._handleDropDownCommands()},clearAll:function(){var x=this.getElements("input"),y=false;if(x.length>0){x.forEach(function(z){if(z.type==="checkbox"){if(typeof z.checked!=="undefined"&&z.checked===true){y=true}z.checked=false}})}if(y){this._dialog.buttons.Save.disabled=false}this._handleDropDownCommands()},_checkParentToggleState:function(C){var x=C.getElements(".customize-relations-input");for(var A=0;A<x.length;A++){var B=x[A].getElements(".customize-childtoggle");var z=0;for(var y=0;y<B.length;y++){if(B[y].checked){z++}}if(z===0){x[A].getElement(".customize-parenttoggle").checked=false;x[A].getElement(".customized-grouprel").removeClassName("customized-grouprel-mixed")}else{if(z===B.length){x[A].getElement(".customize-parenttoggle").checked=true;x[A].getElement(".customized-grouprel").removeClassName("customized-grouprel-mixed")}else{x[A].getElement(".customize-parenttoggle").checked=true;x[A].getElement(".customized-grouprel").addClassName("customized-grouprel-mixed")}}}},_createRelationSet:function(A){var z=this._getCheckedRelations(),y={},B={};B.name=A;B.relations=[];for(var x=0;x<z.length;x++){B.relations.push({name:z[x]})}B.type="UserDefined";this._createNewProfile(B);this._showHideDropDownCommands("customize-saverelationset");this._showHideDropDownCommands("customize-deleterelationset",true)},_createNewProfile:function(B){this.dontHandleProfileChange=true;var z=true,x=this.profileTreeDocument.getRoots(),A=this;for(var y=0;y<x.length;y++){if(x[y].options.data.name===B.name){z=false;this._profileCombobox.selectedIndex=y}}if(z){this.profileArray.splice(1,0,{name:B.name,type:"UserDefined"});this.nlsProfileArray.splice(1,0,B.name);this.profileTreeDocument.addRoot(new n({label:B.name,data:{type:"UserDefined",name:B.name}}),1)}this.dispatchEvent("ENORIPE_CreateNewProfile",[B]);this._profileCombobox.selectedIndex=1;this._profileCombobox._applySelectedIndex()},_onCreateClick:function(){var C=this,y=null,A=new t({className:"Customize-Relationsetmodal",animate:true,events:{onHide:function(F){A.destroy()}}});var z={fields:[{type:"text",required:true,pattern:"^[_ A-Za-z0-9]+$",value:"",placeholder:k.get("Customize_RelationSetCreation"),name:"inputval"}],events:{onSubmit:function(H){var I=false;y=C.profileTreeDocument.getRoots();if(y&&y.length){for(var G=0;G<y.length;G++){if(y[G]&&y[G].options&&y[G].options.data&&y[G].options.data.name===H.inputval){I=true;break}}}if(I){var F=confirm(k.get("Customize-ExistingRelationSet"));if(F===true){A.modals.current.hide();C._createRelationSet(H.inputval)}}else{A.modals.current.hide();C._createRelationSet(H.inputval)}},onInvalid:function(){var F="",G=x.value.trim();if(G.length===0){F=k.get("Customize_EmptyProfileErr")}else{F=k.get("Customize_SpecialCharErr");F=F.concat(" !@#$%^&*()+=-[]\\';,./{}|\":<>?")}D.setContent(F)}}},B=new d(z),x=B.elements.container.getElement("input"),E=a.createElement("p",{"class":"CustomizeCreate",html:k.get("Customize_RelationSetTitle")}).inject(x,"before"),D=a.createElement("div",{"class":"Customize-ProfileNameError",html:""});A.dialog({body:B,title:k.get("Customize_ModalCreate"),buttons:[{className:"primary",value:k.get("SNNCustomize_Save"),action:function(){B.submit()}},{value:k.get("SNNCustomize_Cancel"),action:function(){A.modals.current.hide()}}]});if(A.modals.current.elements.body){A.modals.current.getBody().addContent(D)}x.addEventListener("click",function(F){this.focus()})},_onSaveClick:function(){var y=this._getCheckedRelations(),z={};z.name=this._getSelectedProfile().options.data.name;z.relations=[];for(var x=0;x<y.length;x++){z.relations.push({name:y[x]})}this.dispatchEvent("ENORIPE_SaveNewProfile",[z]);this._showHideDropDownCommands("customize-saverelationset")},_onDeleteClick:function(){var y=this.profileTreeDocument.getRoots(),x=this._getSelectedProfile(),B=null,C=null;if(x){B=x.options.data.name;this.profileTreeDocument.removeRoot(x);var z=null;for(var A=0;A<this.profileArray.length;A++){if(this.profileArray[A].name===x.options.data.name){z=A;break}}this.profileArray.splice(z,1);this.nlsProfileArray.pop(x.options.data.name);this.dontHandleProfileChange=true;this._profileCombobox.selectedIndex--;x=this._getSelectedProfile();C=x.options.data.name}this.dispatchEvent("ENORIPE_DeleteProfile",[B,C]);if(!this.isCustomProfileSet()){this._showHideDropDownCommands("customize-deleterelationset")}if(this._previousProfile===B){this._previousProfile=C}},_getSelectedProfile:function(){var x=this.profileTreeDocument.getRoots()[this._profileCombobox.selectedIndex];if(x){return x}},_adjustDialogDimensions:function(){this._dialog.position.offsetX=this.dimensions.position.offsetX;this._dialog.position.offsetY=this.dimensions.position.offsetY;var y=window.innerHeight-115;if(this.firstLaunch){this.firstLaunch=false;if(this._dialog.elements._contentDiv.clientHeight<this._dialog.elements._contentDiv.scrollHeight){var x=this._dialog.elements._contentDiv.scrollHeight-this._dialog.elements._contentDiv.clientHeight;var z=this._dialog.height+x;if(z>y){z=y}if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50}this._dialog.height=z}}else{if(this._dialog.height>y){this._dialog.height=y}if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50}}this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position.offsetY=this._dialog.position.offsetY;this._dialog._applyPosition();this._dialog._applyHeight();this._dialog._applyWidth()},isCustomProfileSet:function(){var y=this._getSelectedProfile(),x=false;if(y){if(y.options.data&&y.options.data.type&&y.options.data.type==="UserDefined"){x=true}}return x},_handleProfileChange:function(){if(this.dontHandleProfileChange){this.dontHandleProfileChange=false}if(this.isCustomProfileSet()){this._showHideDropDownCommands("customize-deleterelationset",true)}else{this._showHideDropDownCommands("customize-deleterelationset")}this.currentProfile=this._getSelectedProfile().options.data.name;if(this.currentProfile==="AutoModeProfile"){this._autoNav=true}else{this._autoNav=false}this._dialog.buttons.Save.disabled=false;this._dialog.buttons.Cancel.disabled=false;this.dispatchEvent("ENORIPE_updateRelations",[this.currentProfile])},showRelation:function(z,y,x){this._templateContent.automaticNavigation=this._autoNav;this._templateContent.relations=this._translateRelations(z);if(this._autoNav&&x){this._templateContent.notPresent=x}this._templateContent.bodyText=this._getBodyText(this.currentProfile,z);if(y!==this._groupRelations){this._groupRelations=y;this._template=c.compile((this._groupRelations?m:v))}this._templateContent.sectionName=k.get("relationsToShow")+k.get(this.currentProfile);var A=this._template.call(null,this._templateContent);if(this._dialog){this._dialog.elements.container.querySelector(".customize-bodycontent").innerHTML=A;this.setUpEvents();if(y){this._checkParentToggleState(this.container)}this._handleDropDownCommands()}},setNewValues:function(z){var y=this._templateContent.relations;for(var x in y){if(y.hasOwnProperty(x)){for(var A=0;A<y[x].length;A++){if(typeof z[y[x][A].id]!=="undefined"){y[x][A].value=(z[y[x][A].id]==="false")?false:"true"}}}}},_translateRelations:function(x){if(this._groupRelations){return this._translateAndGroupRelations(x)}else{return this._translateAndFlatten(x)}},_translateAndGroupRelations:function(x){if(x.v6){x=x.v6}return x},_translateAndFlatten:function(x){for(var y in x){if(x.hasOwnProperty(y)){for(var z=0;z<x[y].length;z++){}}}return x},setAutoNavMode:function(x){this._autoNav=x},_getCheckedRelations:function(){var x=this.getElements(".customize-childtoggle"),z=[];if(x.length>0){for(var y=0;y<x.length;y++){if(x[y].checked){z.push(x[y].value)}}}return z},_okClick:function(x){var z=this._getCheckedRelations(),y={};this.dispatchEvent("ENORIPE_updatePref",[z]);if(x!==true){this.dimensions.dialogWidth=this._dialog.width;this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position=this._dialog.position;this._destroyCurrentDialog()}},_cancelClick:function(){if(this._previousProfile&&this._previousProfile!==this._getSelectedProfile().options.data.name){var x=this.profileTreeDocument.getRoots();for(var y=0;y<x.length;y++){if(x[y].options.data.name===this._previousProfile){this._profileCombobox.selectedIndex=y}}}this._destroyCurrentDialog();this.dispatchEvent("ENORIPE_UpdateLUP",[this._previousProfile])},updateDialogSize:function(){if(this._dialog){var x=(0.5)*(window.innerHeight-85);this._dialog.height=(x>this._dialog.minHeight)?x:this._dialog.minHeight}},updateDialogSizeOnResize:function(){if(this._dialog){var x=window.innerHeight-115;this._dialog.height=(x>this._dialog.minHeight)?x:this._dialog.minHeight;this.dimensions.dialogHeight=this._dialog.height;if(this._dialog.position.offsetY>50){this._dialog.position.offsetY=50;this.dimensions.position.offsetY=this._dialog.position.offsetY}this._dialog._applyPosition();this._dialog._applyHeight()}},setUpEvents:function(){var B=this.getElements("input"),C=this;if(B.length>0){for(var z=0;z<B.length;z++){if(!B[z].hasClassName("autocomplete-input")){B[z].addEventListener("click",this.onCheckboxClick.bind(this))}}}this.getElements(".customize-downarrow").forEach(function(G){G.addEventListener("click",function(){this.toggleClassName("customize-inverticon");var H=this.getParent()?this.getParent().getParent():null;if(H){var J=H.getElementsByClassName("customize-childrel");for(var I=0;I<J.length;I++){if(J[I].hasAttribute("hidden")){J[I].removeAttribute("hidden")}else{J[I].setAttribute("hidden","")}}}})});var x=this._dialog.elements.container.getElement(".Customize-More"),y=this._dialog.elements.container.getElement(".Customize-Less"),A=this._dialog.elements.container.getElement(".Customize-Divider"),E=this.getElement(".customize-bodytext"),D=this._dialog.elements.container.getElement(".CustomizeAbsent-relations"),F=null;if(x){x.addEventListener("click",function(){if(D){D.toggleClassName("customize-hidden")}if(y){y.toggleClassName("customize-hidden")}if(A){A.toggleClassName("customize-hidden")}if(E){F=C._getBodyText(C.currentProfile,C._templateContent.relations);E.innerText=F}x.toggleClassName("customize-hidden")})}if(y){y.addEventListener("click",function(){if(D){D.toggleClassName("customize-hidden")}if(x){x.toggleClassName("customize-hidden")}if(A){A.toggleClassName("customize-hidden")}if(E){F=C._getBodyText(C.currentProfile,C._templateContent.relations);E.innerText=F}y.toggleClassName("customize-hidden")})}},_isAbsentRelExpanded:function(){var x=false;if(this._dialog){var y=this.getElement(".CustomizeAbsent-relations");if(a.is(y)&&a.is(y.hasClassName)){x=!y.hasClassName("customize-hidden")}}return x},_handleDropDownCommands:function(){if(this._isSaveRequired()){this._showHideDropDownCommands("customize-saverelationset",true)}else{this._showHideDropDownCommands("customize-saverelationset")}if(this._isNewRequired()){}else{}},_isSaveRequired:function(){var y=this.isCustomProfileSet(),z=this._getCheckedRelations(),B=this._getSelectedProfile().options.data.name,x=false;if(y){var A=this._getSavedRelationsForCustomProfiles(B);if(UWA.Array.equals(z,A)===false){x=true}}return x},_isNewRequired:function(){},_getRelationsSet:function(){var x=localStorage.getItem(l.getUserID()+"_ENORIPE_CustomRelationsSet");if(x){return JSON.parse(x)}},_getSavedRelationsForCustomProfiles:function(A){var C=this._getRelationsSet(),B=[],x=[];for(var z=0;z<C.length;z++){if(C[z].name===A){B=C[z].relations;break}}for(var y=0;y<B.length;y++){if(B[y].name){x.push(B[y].name)}}return x},onCheckboxClick:function(y){this._dialog.buttons.Save.disabled=false;this._dialog.buttons.Cancel.disabled=false;if(y.target.id==="autoNav-cb"&&this._relationsList){if(y.target.checked===true){this._relationsList.hide()}else{this._relationsList.show()}}if(this._groupRelations){var x;if(y.target.hasClassName("customize-parenttoggle")){if(y.target.parentElement&&y.target.parentElement.parentElement){x=y.target.parentElement.parentElement;x.querySelector(".customized-grouprel").removeClassName("customized-grouprel-mixed");if(y.target.checked===true){x.getElements(".customize-childtoggle").forEach(function(z){z.checked=true})}else{if(y.target.checked===false){x.getElements(".customize-childtoggle").forEach(function(z){z.checked=false})}}}}if(y.target.hasClassName("customize-childtoggle")){this._checkParentToggleState(this.container)}}if(this._isSaveRequired()){this._showHideDropDownCommands("customize-saverelationset",true)}},_showHideDropDownCommands:function(z,x){if(this.relationSetMenu){var y=this.relationSetMenu.getItem(z);if(y&&y.elements&&y.elements.container){if(x){y.elements.container.removeClassName("customize-hidden")}else{y.elements.container.addClassName("customize-hidden")}}}},_isDropDownCmdHidden:function(){},_destroyCurrentDialog:function(){this.relationSetMenu.hide();this._immersiveFrame.elements.container.setStyle("z-index",0);this.dimensions.dialogWidth=this._dialog.width;this.dimensions.dialogHeight=this._dialog.height;this.dimensions.position=this._dialog.position;this._selectedIndex=this._profileCombobox.selectedIndex;this._dialog.destroy();this._dialog=null;this.hide()}});return w});define("DS/SNNavigationMap/utils/MapFileUtils",["UWA/Class","DS/SNNavigationMap/MapSettings","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(f,b,c,d,e){var a=f.extend({init:function(g){this.spinner=g.spinner;this.notifManager=c;d.setNotificationManager(this.notifManager)},handleDownload:function(l,g){this._showSpinner();var k=this,h={tenant:b.getPlatformId(),tenantUrl:b.get3DSpaceUrl(),onComplete:function(m){k._downLoadFile(m,g)},onFailure:function(){k._showNotif({level:"error",msg:e.get("DownloadFailure")});k._hideSpinner()}},j="DS/DocumentManagement/DocumentManagement",i="DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext";require([j,i],function(o,n){if(n){var m=n.get();if(m&&m.change&&m.change.id!==""){h.additionalHeaders={"DS-Change-Authoring-Context":"pid:"+m.change.id}}}b.getSecurityContext().then(function(p){h.securityContext=p;o.downloadDocument(l,undefined,false,h)},function(q){var p={level:"error",msg:e.get(q.type)};k._showNotif(p);k._hideSpinner()})},function(){k._hideSpinner();console.log("DocumentManagementAMD not found")})},_downLoadFile:function(h,g){var j=new XMLHttpRequest(),i=this;j.open("GET",h);j.responseType="blob";j.onload=function(){if(!window.navigator.msSaveBlob){var k=document.createElement("a");k.href=window.URL.createObjectURL(j.response);if(g){k.download=g}k.style.display="none";document.body.appendChild(k);k.click();k=undefined}else{window.navigator.msSaveBlob(j.response,g)}i._hideSpinner()};j.send()},_showNotif:function(g){this.notifManager.addNotif({level:g.level,message:g.msg,sticky:false})},_hideSpinner:function(){if(this.spinner){this.spinner.hide()}},_showSpinner:function(){if(this.spinner){this.spinner.show()}},getFileType:function(){}});return a});define("DS/SNNavigationMap/utils/LayoutUtils",["UWA/Class","DS/DagreShim/DagreShim","DS/SNNavigationMap/MapSettings"],function(c,d,b){var a=c.extend({init:function(e){this._dagre=d;this.layoutOptions=e;this._nodesWidth=170;this._nodesHeight=65},getNodesWidth:function(){return b.getNodesWidth()},getNodesHeight:function(){return b.getNodesHeight()},_setupGraph:function(){if(this._graphObject){this._graphObject=null;delete this._graphObject}this._graphObject=new this._dagre.graphlib.Graph({}).setGraph({rankdir:"LR",align:"DL",ranksep:350,directed:true,multigraph:true}).setDefaultEdgeLabel(function(){return{}})},setData:function(g){this._setupGraph();var f=this,e=0;g.nodes.forEach(function(h){if(h.instances){if(h.instancesCollapsed===true){}else{e=h.instances.length*30}}f._graphObject.setNode(h.id,{label:h.name,width:f.getNodesWidth(),height:f.getNodesHeight()+e})});g.links.forEach(function(h){f._graphObject.setEdge(h.source.id,h.target.id)});return this},findLoops:function(){return this._dagre.graphlib.alg.findCycles(this._graphObject)},getPathCoordinates:function(j,f,i,e,h){var g="";if(this.layoutOptions.layoutAxis==="x"){g=this._getPathCoordinatesXAxis(j,f,i,e,h)}else{}return g},_getPathCoordinatesXAxis:function(n,r,p,i,q){var f=(n.source.columnID===(n.target.columnID-1))||(n.source.columnID===(n.target.columnID+1)),j=n.source.columnID===n.target.columnID,o=(n.source.columnID<n.target.columnID)?true:false,g,h="",l="",k=this.getNodesHeight()/2,e,m=170;if(!j){if(p&&o){k+=32.5}if(i===true){k-=32.5}h=(o)?(n.source.x+m)+" "+(n.source.y+k):n.source.x+" "+(n.source.y+k);l=(o)?n.target.x+" "+(n.target.y+k):(n.target.x+m)+" "+(n.target.y+k)}if(f){return"M"+h+" L "+l}else{if(j){g=n.source.y+((n.target.y-n.source.y)/2);h=(n.source.x+m)+" "+(n.source.y+k);l=(n.target.x+m)+" "+(n.target.y+k);return"M"+h+" Q "+(n.target.x+220)+" "+g+" "+l}else{if(!o){if(r.attr("marker-end")){e=r.attr("marker-end").slice(0,-1);e+="-reverse)";r.attr("marker-start",e);r.attr("marker-end",null)}q.attr("transform","rotate(180) translate("+parseFloat(-(n.source.x+(n.target.x+m)))+", "+parseFloat(-((n.source.y+k)+(n.target.y+k)))+")")}g=n.source.x+((n.target.x-n.source.x)/2);return"M"+h+" Q "+g+" "+0+" "+l}}},rotateTextLabel:function(f,e){if(this.layoutOptions.layoutAxis==="x"){return this._rotateTextLabelXlayout(f,e)}else{}},_rotateTextLabelXlayout:function(j,i){var f=(j.source.columnID===(j.target.columnID-1))||(j.source.columnID===(j.target.columnID+1)),k=j.source.columnID===j.target.columnID,g=(j.source.columnID<j.target.columnID)?true:false,h=170,e=this._nodesHeight;if(!g&&f){return"rotate(180) translate("+parseFloat(-(j.source.x+(j.target.x+h)))+", "+parseFloat(-((j.source.y+e)+(j.target.y+e)))+")"}else{if(!g&&!f&&!k){}}},});return a});define("DS/SNNavigationMap/views/SNMapSelector",["UWA/Core","UWA/Class/View","UWA/Utils/InterCom","DS/SNNavigationMap/utils/SNNavigationServices","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(d,c,b,e,a,g){var f={_ctx:{},_mapView:{},_listView:{},_collection:{},_compassSocket:{},_platformId:"",_widgetId:"",_isMultiSelON:0,_ObjectSelected:{},_mapViewSelected:{},_listViewSelected:{},_PathPanelDisplayed:0,_objectsInCompass:[],_feedBackMultiSelNumber:null,isSetTypesCallbackSubscribed:false,viewContext:"",initialize:function(k){var h=this;this._ctx=k.ctx;this._mapView=this._ctx.mapView;this._listView=this._ctx.listView;this._collection=k.collection;this._platformId=k.platformId||"onPremise";this._widgetId=k.widgetId;var j="com.ds."+this._widgetId;this._compassSocket=new b.Socket(j);var i="com.ds.compass";this._compassSocket.subscribeServer(i,window.parent);if(!this.isSetTypesCallbackSubscribed){}},setPlatformID:function(h){this._platformId=h},updateSelection:function(j,i){this._onSetObject(j);if(null===j||undefined===j){return}var l=false,h=false;if(i&&i!==this.viewContext){h=true}if(!this.isMultiSelActivated()){this._ObjectSelected={}}this._ObjectSelected[j.get("id")]=j;if(i===undefined||i===null){i=this.viewContext}else{this.viewContext=i}if(i==="ListView"){this._listViewSelected=this._ObjectSelected}else{this._mapViewSelected=this._ObjectSelected}if(h){this.handleContextSwitch(true)}var n=[];n.push(j);var m=this._buildCompassData({widgetId:this._widgetId,envId:this._platformId,selectedModels:n});if(this._compassSocket){this._compassSocket.dispatchEvent("onSetX3DContent",m)}var k=[];k.push(j.get("id"));e.sendToMapWebInWin("CleanCSO",[]);e.sendToMapWebInWin("InsertInCSO",k)},_onSetObject:function(h){if(null===h||undefined===h){var j={serviceId:"3DSpace",objectId:"",envId:"OnPremise",contextId:""};this._compassSocket.dispatchEvent("onSetObject",j);this._compassSocket.dispatchEvent("onResetX3DContent",{});return}var i={serviceId:"3DSpace",objectId:(h.get)?h.get("id"):h.id,envId:this._platformId,contextId:""};if(this._compassSocket.dispatchEvent){this._compassSocket.dispatchEvent("onSetObject",i);if(h.isPath){return}var k={widgetId:this._widgetId}}},_updateCompass:function(h,i){if(this._objectsInCompass.indexOf(h)===-1&&!h.get("isCount")){if(i===true){this._objectsInCompass=[h]}else{this._objectsInCompass.push(h)}}},_setTypesCallback:function(h){if(h.widgetId===this._widgetId){var i={appId:h.appId,widgetId:h.widgetId};if(this._objectsInCompass.length>0){var j=this.buildSelectionForNativeApps();i.fileName="-file";i.fileContent=JSON.stringify(j)}a.publish("launchApp",i)}},buildSelectionForNativeApps:function(){var l={version:"2.1",results:[],structures:[{structure:[]}]},h;var k=this.getSelected();for(var j=0;j<k.length;j++){h=JSON.stringify(j+1);l.results.push({id:h,phid:k[j].id});l.structures[0].structure.push({id:h,show:true,select:true,children:[]})}return l},initFeedbackMultiSel:function(){var i=document.getElementsByClassName("multisel-icons"),h;if(i&&i.length>0){h=i[0].getChildren();if(h&&h.length>0){this._feedBackMultiSelNumber=d.createElement("span",{"class":"feedBackMultiSel-count",html:""}).inject(h[0])}}},isMultiSelActivated:function(){return this._isMultiSelON},nbSelected:function(){var h=this.getSelectedIDs();var i=h.length;return i},isSelected:function(i){var h=this._ObjectSelected.hasOwnProperty(i);return h},initMultiSel:function(i){var h=this._collection.getFocusedNode();if(i){this.clearMultiSel(2)}if(this.viewContext===""){this.viewContext="MapView"}if(this.viewContext==="ListView"){this._ObjectSelected=this._listViewSelected}else{this._ObjectSelected=this._mapViewSelected}var j=this.getSelected();this._isMultiSelON=1;this._mapView.initMultiSelection();this._listView.initMultiSelection();if(j.length>0){this.onObjectToMultiSel(j,"add")}else{if(typeof h!=="undefined"&&!h.get("isCount")){}}},endMultiSel:function(){this.clearMultiSel(0);this._isMultiSelON=0},clearMultiSel:function(m){var k=this.getAllIDs();var j=k.length;if(m!==2){if(0===m){this._mapView.clearMultiSelection();this._listView.clearMultiSelection()}else{if(this.viewContext==="ListView"){this.clearMultiSelForListView();return}for(var h=j-1;h>=0;h--){this._mapView.removeFromMultiSel(k[h]);this._listView.removeFromMultiSel(k[h])}}var l=this;this._collection.where({focus:true}).forEach(function(i){l._RemoveFocusMS(i.get("id"));i.set("focus",false);l._mapView.removeFromMultiSel(i.get("id"))});this._listView.clearPanel();this._listView.hidePanel()}else{this._mapView.clearMultiSelection();this._listView.clearMultiSelection()}for(var h=j-1;h>=0;h--){delete this._mapViewSelected[k[h]];delete this._listViewSelected[k[h]];delete this._ObjectSelected[k[h]]}if(this._mapView&&this._mapView.container){this._mapView.container.removeClassName("unfocused")}if(this._listView&&this._listView.container){this._listView.container.removeClassName("unfocused")}this.setMultiSelCount(this.nbSelected().toString());e.sendToMapWebInWin("CleanCSO",[]);this._syncObjectToCompass()},clearMultiSelForListView:function(){var k=this.getAllIDs();var j=k.length;for(var h=j-1;h>=0;h--){this._listView.removeFromMultiSel(k[h]);delete this._listViewSelected[k[h]]}this._ObjectSelected=this._listViewSelected;this.setMultiSelCount(this.nbSelected().toString());e.sendToMapWebInWin("CleanCSO",[]);this._syncObjectToCompass()},getSelectedIDs:function(){var h=Object.keys(this._ObjectSelected);return h},getAllIDs:function(){var k=Object.keys(this._mapViewSelected);k=k.concat(Object.keys(this._listViewSelected));var h=Object.keys(this._ObjectSelected);for(var j=0;j<h.length;j++){if(k.indexOf(h[j])===-1){k.push(h[j])}}return k},getSelectedItemsForDragAndDrop:function(){return this._collection.where({focus:true})},getSelected:function(){var i=this;var h=Object.keys(this._ObjectSelected).map(function(j){return i._ObjectSelected[j]});return h},getMapViewSelectedIds:function(){var h=Object.keys(this._mapViewSelected);return h},refreshView:function(){this._ObjectSelected=this._mapViewSelected;this.viewContext="MapView";var h=this.getSelected();if(h.length>0){this.onObjectToMultiSel(h,"add",true)}},onObjectToMultiSel:function(n,s,r){var j=(Array.isArray(n))?n:[n],t=j.length,h=[],k="",m=this.viewContext;if("add"===s){for(var o=0;o<t;o++){var p=j[o];var l=p.id;if(!this.isMultiSelActivated()){this.initMultiSel()}this.viewContext=m;if(m==="ListView"){this._listViewSelected[l]=p;this._listView.addToMultiSel(l)}else{this._mapViewSelected[l]=p;this._AddFocusMS(l);this._mapView.addToMultiSel(l)}h.push(l);if(typeof p!=="undefined"){p.set("focus",true)}}k="InsertInCSO"}else{if("remove"===s){for(var o=0;o<t;o++){var p=j[o],l=p.id;h.push(l);if(m==="ListView"){delete this._listViewSelected[l];this._listView.removeFromMultiSel(l)}else{delete this._mapViewSelected[l];this._RemoveFocusMS(l);this._mapView.removeFromMultiSel(l)}if(typeof p!=="undefined"){p.set("focus",false)}}k="RemoveFromCSO"}}this.handleContextSwitch(r);this._syncObjectToCompass();if(k.length){if(r){var q=this.getSelectedIDs();if(q.length>0){e.sendToMapWebInWin(k,q)}}else{e.sendToMapWebInWin(k,h)}}},_AddFocusMS:function(j){var h=this._ctx.getElement("#container-"+j);if(h){var i=h.getAttribute("class");if(-1===i.indexOf(" focus")){i+=" focus";h.setAttribute("class",i)}}},_RemoveFocusMS:function(k){var i=this._ctx.getElement("#container-"+k);if(i){var j=i.getAttribute("class");if(0<j.indexOf(" focus")){var h=j.replace(" focus","");i.setAttribute("class",h);if(this._listView.model&&this._listView.model.id===k){this._listView.clearPanel();this._listView.hidePanel()}}}},handleContextSwitch:function(h){if(this.viewContext==="MapView"){this._ObjectSelected=this._mapViewSelected;if(h){this._changeSelectionToMapView()}}else{if(this.viewContext==="ListView"){this._ObjectSelected=this._listViewSelected;if(h){this._changeSelectionToListView()}}}if(this.isMultiSelActivated()){this.setMultiSelCount(this.nbSelected().toString())}e.sendToMapWebInWin("CleanCSO",[])},_changeSelectionToMapView:function(){var h=this._mapView.container,j=this._listView.container;this.viewContext="MapView";if(h){var i=this.getMapViewSelectedIds();h.removeClassName("unfocused");this._mapView.switchFocus(i,false)}if(j){j.addClassName("unfocused")}},_changeSelectionToListView:function(){var h=this._mapView.container,j=this._listView.container;this.viewContext="ListView";if(h){var i=this.getMapViewSelectedIds();h.addClassName("unfocused");this._mapView.switchFocus(i,true)}if(j){j.removeClassName("unfocused")}},updateFeedBack:function(j){for(var h=0;h<j.length;h++){delete this._ObjectSelected[j[h]];delete this._mapViewSelected[j[h]]}this.setMultiSelCount(this.nbSelected().toString())},setMultiSelCount:function(h){if(!this._feedBackMultiSelNumber){this.initFeedbackMultiSel()}else{if(h==="0"){this._feedBackMultiSelNumber.setContent("")}else{this._feedBackMultiSelNumber.setContent(h)}}},_syncPathToCompass:function(h){if(h.data&&h.data.items){if(0===h.data.items.length){this._onSetObject(null)}else{this._onSetObject({id:h.data.items[0].objectId,isPath:true})}this._compassSocket.dispatchEvent("onSetX3DContent",h)}},_syncObjectToCompass:function(){var j=this.getSelected();if(0===j.length){this._onSetObject(null)}else{var i={widgetId:this._widgetId}}if(j.length===1){this._onSetObject(j[0])}var h=this._buildCompassData({widgetId:this._widgetId,envId:this._platformId,selectedModels:j});this._compassSocket.dispatchEvent("onSetX3DContent",h)},_buildCompassData:function(j){var i={};if(d.is(j)){var h=j.selectedModels;if(d.is(h,"array")){i={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:j.widgetId,data:{items:[]}};var k=[];h.forEach(function(m){var l={};if(m.get){l={envId:j.envId,serviceId:"3DSpace",contextId:"",objectId:m.id,objectType:m.get("type"),displayName:m.get("name"),displayType:m.get("type")}}else{l={envId:j.envId,serviceId:"3DSpace",contextId:"",objectId:m.id,objectType:m.type,displayName:m.name,displayType:m.type}}k.push(l)});i.data.items=k}}return i},handleClearMap:function(){if(this._feedBackMultiSelNumber){this._feedBackMultiSelNumber.destroy();this._feedBackMultiSelNumber=null}}};return f});define("DS/SNNavigationMap/views/SplittedDropView",["UWA/Core","UWA/Class/View","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices"],function(e,d,c,b){var a=d.extend({name:"SDV-drop",_zonesCounter:{add:0,replace:0},className:function(){return this.getClassNames("-container")},setup:function(){this._addContentDiv=e.createElement("div",{"class":"drop-zone add-content",html:{tag:"div",html:[{tag:"span","class":"fonticon fonticon-popup"},{tag:"p",html:c.get("dropAddContent")}]}});this._replaceContentDiv=e.createElement("div",{"class":"drop-zone replace-content",html:{tag:"div",html:[{tag:"span","class":"fonticon fonticon-shuffle"},{tag:"p",html:c.get("dropReplaceContent")}]}});this._addContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this));this._addContentDiv.addEventListener("dragleave",this._dragleave.bind(this));this._addContentDiv.addEventListener("drop",this._onDrop.bind(this));this._replaceContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this));this._replaceContentDiv.addEventListener("dragleave",this._dragleave.bind(this));this._replaceContentDiv.addEventListener("drop",this._onDrop.bind(this));this.container.addEventListener("dragover",this._onDragOver);this.container.setContent(this._addContentDiv,this._replaceContentDiv);this.container.hide()},show:function(g,f){if(this.container.getStyle("display")==="none"){this.container.setStyle("width",g+"px");if(sessionStorage.getItem("ENORIPE_currentDrag")==="extract"||f===true){this._addContentDiv.addClassName("full");this._replaceContentDiv.hide()}else{this._addContentDiv.removeClassName("full");this._replaceContentDiv.show()}}this.container.show()},hide:function(){this.container.hide();this._zonesCounter.add=0;this._zonesCounter.replace=0;this.dispatchEvent("ENORIPE_SDV_hide",[])},updateHeight:function(f,g){if(g){this.container.setStyle("width",g)}this._addContentDiv.setStyle("height",f+"px");this._replaceContentDiv.setStyle("height",f+"px")},_getFreeZoneWidth:function(){var g=document.querySelector(".list-view-container"),i=null,f=null;if(g&&!g.isHidden()){i=g.querySelector("div.wux-windows-docking-element-free-zone.wux-docking-element-right")}if(i){f=i.getStyle("width");if(f){return parseFloat(f.substr(0,f.length-2))}}else{var h=document.getElementById("svg-root").getStyle("width");if(h){return parseFloat(h.substr(0,h.length-2))-50}}return window.innerWidth},_onDragOver:function(f){f.stopPropagation();f.preventDefault()},_onDragEnter:function(g){var f=g.currentTarget;g.stopPropagation();g.preventDefault();if(f.hasClassName("add-content")){this._zonesCounter.add++}else{this._zonesCounter.replace++}f.addClassName("current-dragover")},_dragleave:function(h){var f,g=h.currentTarget;h.stopPropagation();h.preventDefault();if(g.hasClassName("add-content")){this._zonesCounter.add--;f=this._zonesCounter.add}else{this._zonesCounter.replace--;f=this._zonesCounter.replace}if(f===0){g.removeClassName("current-dragover");if(!this.container.getElement(".current-dragover")){this.hide()}}},_onDrop:function(k){k.stopPropagation();k.preventDefault();this.hide();var i=e.is(k.dataTransfer.types.indexOf,"function")?"indexOf":"contains",l="",m=["text/searchitems","text/plain","Text"],n=k.currentTarget,j=(n.hasClassName("add-content"))?"add":"replace",g,f,p,h;for(var o=0;o<m.length&&l==="";o++){p=k.dataTransfer.types[i](m[o]);if((e.is(p,"number")&&p>=0)||(e.is(p,"boolean")&&p===true)){l=m[o]}}if(l===""){h=b.sendToMapWebInWin("RefreshOnDrop",[],j);if(!h){this.dispatchEvent("ENORIPE_dropNotSupported")}}else{f=k.dataTransfer.getData(l);if(f.length){g=JSON.parse(f);j=(g.action)?g.action:j}this.dispatchEvent("ENORIPE_drop",[j,g]);sessionStorage.removeItem("ENORIPE_currentDrag")}}});return a});define("DS/SNNavigationMap/views/ListView",["UWA/Core","UWA/Class/View","UWA/Class","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Controls/TileView","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/UIKIT/Tooltip","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Spinner","UWA/Class/Model","UWA/Date","DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(k,a,p,b,h,i,n,e,m,c,d,j,o,l,g){var f=a.extend({name:"list-view",isInitialized:false,_currentRequest:null,tilesContent:[],models:{},relations:{},fireEventsOnSlide:false,tiles:[],isCountNode:{},tilesStructure:{},currentlyColoredTiles:[],isMultiSelActivated:false,isFromSplitCount:false,_separator:"",_nameLabel:null,_detailLabel1:null,_detailLabel2:null,_informationPanel:null,_propCommandClicked:false,className:function(){return this.getClassNames("-container multisel-off")},setup:function(q){var r=this;this._debug=q.debugMode;this._widgetId=q.widgetId||null;try{this._url=e.get3DSpaceUrl()+"/resources/enorelnav/navigate/detail?tenant="+e.getCurrentTenantName()}catch(s){this._url=null}if(q.spinner){this._spinner=q.spinner}this._parent(q);this.isWebInWin=q.isWebInWin;this._separator=q.separator;this._nameLabel=q.nameLabel;this._detailLabel1=q.detailLabel1;this._detailLabel2=q.detailLabel2;this._dropZone=q.dropZone;this.mapAccordion=new k.createElement("ul",{"class":"map-accordion"});this._immersiveFrame=new h();this._immersiveFrame.inject(this.container);this.panel=new b({closeButtonFlag:false,width:0.24*window.innerWidth,resizableFlag:true,immersiveFrame:this._immersiveFrame,position:{my:"bottom right",at:"bottom right",offsetY:48},touchMode:true,currentDockArea:WUXDockAreaEnum.RightDockArea,verticallyStretchableFlag:true,floatableFlag:false,minWidth:120,snappableFlag:false});k.createElement("span",{"class":"listview-resize fonticon fonticon-resize-full"}).inject(this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.resizeHandler);this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize=360;this._immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).dockingZoneSize=0;this._immersiveFrame.getDockingElement(WUXDockAreaEnum.TopDockArea).dockingZoneSize=0;this._immersiveFrame.getDockingElement(WUXDockAreaEnum.BottomDockArea).dockingZoneSize=0;this._immersiveFrame.dockWindow(this.panel,WUXDockAreaEnum.RightDockArea);this.panel.allowedDockAreas=8;if(q.fireEventOnSlide){this.fireEventsOnSlide=true}this._listSpinner=new d().inject(k.createElement("div",{styles:{"text-align":"center",position:"absolute",top:"-4px",width:"95%"}}).inject(this.panel.elements.container)).show();this.mapAccordion.inject(this.panel.elements.container);this.container.addEventListener("dragenter",function(t){t.stopPropagation()});this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.collapser.addEventListener("click",function(){r.panelCollpsedByUser=(this.getParent().getAttribute("collapsed")==="")});this.slideOut();this.isMultiSelActivated=false},filterByFadingAndReordering:function(s){var t,q;this.container.addClassName("list-content-filtered");for(var r=0;r<s.length;r++){t=this.getElement('.list-node[data-id="'+s[r]+'"]');if(t){q=t.parentElement;if(q.getElement("h2")){t.addClassName("kept").remove().inject(q.getElement("h2"),"after")}else{t.addClassName("kept").remove().inject(q,"top")}}}},getFilteredIds:function(){var q=[],u,t=this.container.hasClassName("list-content-filtered"),s=this.getElements(".list-node");for(var r=0;r<s.length;r++){if(s[r].hasClassName("kept")||!t){u=s[r].getAttribute("data-id");q.push(u)}}return q},resetFilter:function(){this.container.removeClassName("list-content-filtered");this.getElements(".kept").forEach(function(q){q.removeClassName("kept")})},colorize:function(q){for(var r in q){if(q.hasOwnProperty(r)){if(this.tilesStructure[r]){this.tilesStructure[r].setColor(q[r]);this.currentlyColoredTiles.push(this.tilesStructure[r])}}}},unColorize:function(){this.currentlyColoredTiles.forEach(function(q){q.setColor(null)});this.currentlyColoredTiles=[]},_getDetail:function(s){var q=this,r={widgetId:this._widgetId,id:this.model.get("id")};if(this._debug){r.debug=true}this.isLoading(true);if(this._url){this._currentRequest=n.authenticatedRequest(this._url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(r),timeout:e.getTimeout(),onComplete:function(t){q._currentRequest=null;q._getNlsData(JSON.parse(t)).then(function(u){q.render(u);q.dispatchEvent("ENORIPE_listUpdated",[s])})},onFailure:function(u){console.log(u);var t={};t.type="generic";q._listSpinner.hide();q.onDetailsNoRender();q.dispatchEvent("ENORIPE_handleErrorMsgs",[t])},onTimeout:function(u){console.log(u);var t={};t.type="timeout";q.dispatchEvent("ENORIPE_handleErrorMsgs",[t]);q.onDetailsNoRender();q._listSpinner.hide()}})}},_getNlsData:function(t){var w=this,v={},z={},x=null;if(t.results){for(var u=0;u<t.results.length;u++){x=t.results[u];for(var r in x){if(x.hasOwnProperty(r)&&r.contains("ds6w")){if(v[r]){if(v[r].indexOf(x[r])===-1){v[r].push(x[r])}}else{v[r]=[x[r]]}}}}}else{for(var q in t){if(t.hasOwnProperty(q)){for(var y in t[q]){if(t[q].hasOwnProperty(y)){for(var s=0;s<t[q][y].length;s++){x=t[q][y][s];for(var r in x){if(x.hasOwnProperty(r)&&r.contains("ds6w")){if(v[r]){if(v[r].indexOf(x[r])===-1){v[r].push(x[r])}}else{v[r]=[x[r]]}}}}}}}}}return new p.Promise(function(B,A){if(!w.isWebInWin){l.getNlsOfPropertiesValues(JSON.stringify(v),{tenantId:e.getCurrentTenantName(),lang:e.getLang(),onComplete:function(C){z=w._convertToNls(t,C);B(z)},onFailure:function(C){console.log("Error in fetching NLS data from SearchDictionaryAccess.getNlsOfPropertiesValues, the response received is ::"+C);B(t)}})}else{B(t)}})},_convertToNls:function(u,s){if(s){var x=null,w=null;if(u.results){for(var v=0;v<u.results.length;v++){x=u.results[v];for(var r in x){if(x.hasOwnProperty(r)&&r.contains("ds6w")){if(s[r]&&s[r].hasOwnProperty(x[r])){w=s[r][x[r]];x[r]=w}}}}}else{for(var q in u){if(u.hasOwnProperty(q)){for(var y in u[q]){if(u[q].hasOwnProperty(y)){for(var t=0;t<u[q][y].length;t++){x=u[q][y][t];for(var r in x){if(x.hasOwnProperty(r)&&r.contains("ds6w")){if(s[r]&&s[r].hasOwnProperty(x[r])){w=s[r][x[r]];x[r]=w}}}}}}}}}}return u},isLoading:function(q){if(q){this._listSpinner.show()}else{this._listSpinner.hide()}},initMultiSelection:function(){this.container.removeClassName("multisel-off");this.container.addClassName("multisel-on");if(this.tilesContent.length>0){for(var q=0;q<this.tilesContent.length;q++){if(this.tilesContent[q].elements.checkbox){this.tilesContent[q].elements.checkbox.elements.container.show()}}}this.isMultiSelActivated=true;this.dispatchEvent("ENORIPE_MultiSelOn")},clearMultiSelection:function(){this.container.removeClassName("multisel-on");this.container.addClassName("multisel-off");if(this.tilesContent.length>0){for(var q=0;q<this.tilesContent.length;q++){if(this.tilesContent[q].elements.checkbox.checkFlag){this.tilesContent[q].elements.checkbox.checkFlag=false}this.tilesContent[q].elements.checkbox.elements.container.hide()}}this.isMultiSelActivated=false},addToMultiSel:function(r){if(this.tilesContent.length>0){for(var q=0;q<this.tilesContent.length;q++){if(this.tilesContent[q].elements.description.innerHTML===r){this.tilesContent[q].elements.checkbox.checkFlag=true;break}}}},removeFromMultiSel:function(r){if(this.tilesContent.length>0){for(var q=0;q<this.tilesContent.length;q++){if(this.tilesContent[q].elements.description.innerHTML===r){this.tilesContent[q].elements.checkbox.checkFlag=false;break}}}},render:function(J){this.renderData=J;if(J&&J.status&&J.status==="KO"){this.onDetailsNoRender();if(!this.isFromSplitCount){var r={};r.type="generic";this.dispatchEvent("ENORIPE_handleErrorMsgs",[r]);this.isFromSplitCount=false}return this}var u=0,C="",B,I,q={},x=[],G,w=[];this.models={};this.relations={};this.tilesContent=[];this.clearAccordion();this.tiles=[];this.isCountNode={};this._updateTitle();if(J.results){q=k.createElement("li",{});for(var E=0;E<J.results.length;E++){B=J.results[E];I=new i({size:"small"});G=new j({id:B.id,modelType:"node",name:B.name,type:B.type,columnID:0,focus:false,isAnchor:false});var t=this._getLabels(B,this._nameLabel);var H=this._getLabels(B,this._detailLabel1);var F=this._getLabels(B,this._detailLabel2);this.models[B.id]=G;if(B.relation){this.relations[B.relation]=G}I.setTitle(t);k.createElement("div",{"class":"listView-tileContent",html:F}).inject(I.elements.cartoucheContent);if(B.instanceDetailNumber){k.createElement("div",{"class":"listView-instances",html:B.instanceDetailNumber,title:B.instanceDetailNumber+" "+g.get("ListView-Instances")}).inject(I.elements.cartoucheContent)}I.setSubtitle(H);I.setDescription(B.id);I.setPicture(B.thumbnail);I.elements.picture.setStyles({backgroundSize:"contain",backgroundRepeat:"no-repeat"});I.setIcon(B.icon_url);if(!this.isMultiSelActivated){I.elements.checkbox.hide()}this.tilesContent.push(I);this.tilesStructure[B.id]=I;x[E]=k.createElement("div",{"class":"list-node","data-id":B.id,draggable:"true"});I.inject(x[E]);x[E].inject(q);this.tiles.push(x[E]);if(this.model){this.dispatchEvent("ENORIPE_getRelNameForCount",[this.model.get("id"),J.results.length])}}this.showPanel();this.mapAccordion.addContent(q);this.panel.content=this.mapAccordion;this.slideIn();this.showTitle()}else{for(var z in J){if(J.hasOwnProperty(z)){for(var y in J[z]){if(J[z].hasOwnProperty(y)){u=J[z][y].length;for(var v=0;v<J[z][y].length;v++){w[v]=J[z][y][v].id}this.dispatchEvent("ENORIPE_checkCountNode",[w]);var A=J[z][y].length;while(A--){var s=J[z][y][A].id;if(this.isCountNode.hasOwnProperty(s)&&!this.isCountNode[s]){J[z][y].splice(A,1)}}u=J[z][y].length;if(u>0){q=k.createElement("li",{html:'<input type="checkbox"><i></i><h2>'+g.get(y)+" ("+u+")</h2>"});for(var D=0;D<u;D++){I=new i({size:"small"});B=J[z][y][D];G=new j({id:B.id,modelType:"node",name:B.name,type:B.type,columnID:0,focus:false,isAnchor:false});this.models[B.id]=G;if(B.relation){this.relations[B.relation]=G}if(!this.isMultiSelActivated){I.elements.checkbox.hide()}var t=this._getLabels(B,this._nameLabel);var H=this._getLabels(B,this._detailLabel1);var F=this._getLabels(B,this._detailLabel2);k.createElement("div",{"class":"listView-tileContent",html:F}).inject(I.elements.cartoucheContent);if(B.instanceDetailNumber){k.createElement("div",{"class":"listView-instances",html:B.instanceDetailNumber,title:B.instanceDetailNumber+" "+g.get("ListView-Instances")}).inject(I.elements.cartoucheContent)}I.setSubtitle(H);I.setTitle(t);I.setDescription(B.id);I.setPicture(B.thumbnail);I.elements.picture.setStyles({backgroundSize:"contain",backgroundRepeat:"no-repeat"});I.setIcon(B.icon_url);this.tilesContent.push(I);this.tilesStructure[B.id]=I;x[D]=k.createElement("div",{"class":"list-node","data-id":B.id,draggable:"true"});I.inject(x[D]);x[D].inject(q);this.tiles.push(x[D])}this.mapAccordion.addContent(q)}}}this.panel.content=this.mapAccordion;u=0;C=""}}if(this.tilesContent.length===0){this.onDetailsNoRender()}else{this.showPanel();this.slideIn();this.showTitle()}}this.dispatchEvent("ENORIPE_RefreshDone");this.dispatchEvent("ENORIPE_ListViewRender");this._setListItemsEvent(this.tiles);if(this.tilesContent.length>0){this.tilesContent.forEach(this._multiselBoxClick.bind(this));this.tilesContent.forEach(this._onMouseEnter.bind(this));this.tilesContent.forEach(this._onMouseLeave.bind(this))}this.isLoading(false);return this},_multiselBoxClick:function(s){var r=this,q=function(x){var y=x.target||x.srcElement,z=false;if(!(y.hasClassName("wux-ui-fa-check")||y.hasClassName("wux-ui-fa")||y.hasClassName("wux-controls-toggle"))){s.elements.checkbox.toggle();var v=s.elements.checkbox.checkFlag,w=r.models[s.elements.description.innerHTML];z=x.ctrlKey?x.ctrlKey:false;if(r.isMultiSelActivated===false&&!z){r.firstSelected=s;r.clearMultiSelection();if(v===true){r.dispatchEvent("ENORIPE_SetOnCompass",[w]);s.elements.checkbox.toggle()}else{r.dispatchEvent("ENORIPE_SetOnCompass",[null])}s.elements.checkbox.elements.container.show();return}}if(r.isMultiSelActivated===false){var t=[];if(r.firstSelected&&r.firstSelected.elements&&r.firstSelected.elements.checkbox.checkFlag===true){var B=r.models[r.firstSelected.elements.description.innerHTML];if(B){t.push(r.models[r.firstSelected.elements.description.innerHTML])}}if(s!==r.firstSelected){t.push(r.models[s.elements.description.innerHTML])}if(t.length>0){r.dispatchEvent("ENORIPE_MultiSel_Object",[t,"add","ListView"])}return}var A=(true===s.elements.checkbox.checkFlag)?"add":"remove",u=s.elements.description.innerHTML;var w=r.models[u];r.dispatchEvent("ENORIPE_MultiSel_Object",[w,A,"ListView"])};s.elements.container.addEventListener("click",q);s.elements.container.title=g.get("dragToExtract")},_setListItemsEvent:function(q){for(var r=0;r<q.length;r++){q[r].addEvent("dragstart",this._onDragListElement.bind(this));q[r].addEvent("dragend",this._onDragEndListElement.bind(this));q[r].addEvent("touchstart",this._onTouchStart.bind(this));q[r].addEvent("touchmove",this._onTouchMove.bind(this));q[r].addEvent("touchend",this._onTouchEnd.bind(this))}},_getLabels:function(u,r){if(!r){return}var q="",t=0,w="";for(var s=0;s<r.length;s++){w="";if(u.hasOwnProperty(r[s])){w=u[r[s]];if(r[s].contains("modified")){if(w!==""){var v=new Date(w);w=o.strftime(v,"%m/%d/%Y %r")}}}if(w&&w.length>0){q=(q.length>0)?(q+this._separator+w):w;t++}if(t===3){break}}return q},getModels:function(){var r=this;var q=Object.keys(this.models).map(function(s){return r.models[s]});return q},slideOut:function(){this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapseDockingZoneFlag=true;this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea)._applyCollapseDockingZoneFlag();if(this.fireEventsOnSlide){this.dispatchEvent("sidePanelSlide")}},slideIn:function(){if(!this.panelCollpsedByUser){this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapseDockingZoneFlag=false;this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea)._applyCollapseDockingZoneFlag();if(this.fireEventsOnSlide){this.dispatchEvent("sidePanelSlide")}}},hidePanel:function(){this.container.hide();this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.container.hide()},showPanel:function(){this.container.show();this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.container.show()},_onDragListElement:function(u){var q=u.target.getElementsByClassName("wux-controls-tileview-title");if(q&&q.length&&q.length>0){q[0].addClassName("currently-dragging")}var s=[],v=u.target.dataset.id;s.push(v);for(var r=0;r<this.tilesContent.length;r++){if(this.tilesContent[r].elements.description.innerHTML!==v&&this.tilesContent[r].elements.checkbox.checkFlag){s.push(this.tilesContent[r].elements.description.innerHTML)}}if(u.dataTransfer){var t=this._getDragData(s);u.dataTransfer.setData("Text",JSON.stringify(t))}sessionStorage.setItem("ENORIPE_currentDrag","extract")},_onDragEndListElement:function(r){var q=r.target.getElementsByClassName("wux-controls-tileview-title");if(q&&q.length&&q.length>0){q[0].removeClassName("currently-dragging")}sessionStorage.removeItem("ENORIPE_currentDrag");this.dispatchEvent("ENORIPE_dragEnd")},_onMouseEnter:function(r){var q=function(t){t.stopPropagation();var s=this.getElement(".wux-controls-tileview-checkbox");if(s){s.show()}};r.elements.container.addEventListener("mouseenter",q)},_onMouseLeave:function(s){var r=this;var q=function(v){v.stopPropagation();var t=this.getElement(".wux-controls-tileview-checkbox"),u=r.isMultiSelActivated;if(t&&!u&&!t.hasAttribute("checked")){t.hide()}};s.elements.container.addEventListener("mouseleave",q)},_onTouchStart:function(q){sessionStorage.setItem("ENORIPE_currentDrag","extract")},_onTouchMove:function(r){var s=r.touches[0];this.realTarget=document.elementFromPoint(s.pageX,s.pageY);if(this.realTarget&&this.realTarget.closest("#svg-root")){var q=this._dropZone._getFreeZoneWidth();this._dropZone.show(q,true);this._dropZone._addContentDiv.addClassName("current-dragover")}},_onTouchEnd:function(u){this._dropZone._addContentDiv.removeClassName("current-dragover");this._dropZone.hide();var t=u.target.closest(".list-node");if(this.realTarget&&this.realTarget.closest(".drop-zone")){var s=[],v=t?t.dataset.id:"";s.push(v);for(var r=0;r<this.tilesContent.length;r++){if(this.tilesContent[r].elements.description.innerHTML!==v&&this.tilesContent[r].elements.checkbox.checkFlag){s.push(this.tilesContent[r].elements.description.innerHTML)}}if(s.length>0){var q={action:"extract",id:s};this.dispatchEvent("ENORIPE_drop",["extract",q])}}this.realTarget=null;sessionStorage.removeItem("ENORIPE_currentDrag");this.dispatchEvent("ENORIPE_dragEnd")},_getDragData:function(u){var r=[],q=e.getPlatformId(),s=null,v=null;for(var t=0;t<u.length;t++){v=u[t];s=this.models[v];r.push({envId:q,serviceId:"3DSpace",objectId:v,objectType:s.get("type"),displayName:s.get("name")})}return{action:"extract",id:u,protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:r}}},_updateTitle:function(){if(this.model){if(!this.model.get("isCount")){var q=this._getLabels(this.model._attributes,this._nameLabel);this.panel.title=q}else{if(this.model.get("isCount")){}}}},getWidth:function(){if(this._immersiveFrame&&this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea)&&!this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapseDockingZoneFlag){return this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize+22}else{return 22}},clearAccordion:function(){this.mapAccordion.empty()},setModel:function(q){if(this._currentRequest){this._currentRequest.cancel()}this.model=(this.model===q)?this.model:q;this._getDetail(this.model.get("id"))},_initInformationsPanel:function(r){var s=this,q=(r)?r:this.model;if(s._informationPanel===null){this._listSpinner.show();require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel"],function(y,u,w,t){var x=s.getpropOptions(u);s._informationPanel=new y(x);s.panel.content=s._informationPanel;s.hideTitle();var v=s.getPropModel(q,w,t);s._informationPanel.initDatas(v);s.showPanel();s.slideIn();s._listSpinner.hide()})}},getpropOptions:function(q){var s=[q.FACET_PROPERTIES,q.FACET_SWYM_CONTENT,q.FACET_SWYM_USER_PROPERTIES,q.FACET_SWYM_COMMUNITY_PROPERTIES,q.FACET_SWYMCOMMENTS];var r;if(this.isWebInWin){r={context:this,typeOfDisplay:q.ALL,selectionType:q.NO_SELECTION,facets:s,readOnly:true,extraNotif:true,editMode:true}}else{r={typeOfDisplay:q.ALL,selectionType:q.NO_SELECTION,facets:s,readOnly:true,extraNotif:true,editMode:true}}return(r)},setInfomationPanelObject:function(q){var s=this;this.showPanel();this.slideIn();if(s._informationPanel!==null){var r=this._informationPanel;require(["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel"],function(v,t){var u=s.getPropModel(q,v,t);r.initDatas(u)});s.panel.content=s._informationPanel;s.hideTitle();s.isLoading(false)}},getPropModel:function(r,u,q){var v=[];if(!k.is(r)||!k.is(u)||!k.is(q)){return v}var t=null;var s="3DSpace";widget.setValue("x3dPlatformId",e.getPlatformId());t=new u({metatype:"businessobject",objectId:r.id,source:s,tenant:e.getPlatformId()});v.push(t);return(v)},onDetailsNoRender:function(){if(this._propCommandClicked){this.setInfomationPanelObject(this.model)}else{this.slideOut();this.hidePanel()}},hideTitle:function(){this.panel.elements._titleBarDiv.hide()},showTitle:function(){this.panel.elements._titleBarDiv.show()},clearPanel:function(){this.panel.title="";this.clearAccordion();this.model=null;this.tilesContent=[];this.tiles=[];this.models={};this.relations={};this.slideOut()},resizeListView:function(){},destroy:function(){this.clearPanel();this._parent();this.container=null}});return f});define("DS/SNNavigationMap/views/elements/RoundedRect",["UWA/Class","UWA/Core","UWA/Utils/Client","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/TransientWidget/TransientWidget","DS/UIKIT/DropdownMenu","UWA/Date","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices","UWA/Class/Events"],function(l,k,h,e,f,d,a,j,c,g,i,m){var b=l.extend(m,{name:"Rounded-Rect",_strLimit:20,r:80/2,rNodeCount:40,imageSize:160/2,nodeCountImageSize:80,grayColor:"#d1d4d4",whiteColor:"#fff",nameLabel:"",separator:"",isChrome:false,svgNS:null,_UncheckedIcon:e.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:e.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),init:function(n){this._selector=n;this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},_check:function(n){if(!n){}},_trim:function(n){if(n){return n.length>this._strLimit?n.slice(0,this._strLimit)+"...":n}},createNode:function(N){this._check(N);if(k.is(N.value,"string")){return this.createCount(N)}var x=k.extendElement(document.createElementNS(this.svgNS.svg,"g")),q=k.extendElement(document.createElementNS(this.svgNS.svg,"title")),H=k.extendElement(document.createElementNS(this.svgNS.svg,"rect")),C,B=null,A=null,r=null,E=null,O=null,G=null,D=null,L=null,v=null,J=k.extendElement(document.createElementNS(this.svgNS.svg,"text")),p=null,I,y=null,u=null,s=[],z=null,M=null,o=k.extendElement(document.createElementNS(this.svgNS.svg,"g")),t=this;if(N.isCount){if(f.getThumbnailsMode()==="thumbnailsMode"){I=71}else{I=40}}else{if(f.getThumbnailsMode()==="thumbnailsMode"){I=90}else{I=25}}if(N.instances){if(N.instances){C=k.extendElement(document.createElementNS(this.svgNS.svg,"g"));C.setAttribute("class","instance-expander-g");u=k.extendElement(document.createElementNS(this.svgNS.svg,"rect"));u.setAttributes({width:170,height:20,"class":"rect-bkg-instance",y:(f.getThumbnailsMode()==="thumbnailsMode")?133:68,});u.inject(C);z=k.extendElement(document.createElementNS(this.svgNS.svg,"text"));z.setContent("...");z.setAttributes({"class":"node-text instance-expander",y:(f.getThumbnailsMode()==="thumbnailsMode")?145:80,x:75});z.inject(C);var n,w;o.setAttributes({"class":"instance-list-g"});for(var F=0;F<N.instances.length;F++){n=k.extendElement(document.createElementNS(this.svgNS.svg,"rect"));n.setAttributes({"class":"rect-bkg-instance",y:(f.getThumbnailsMode()==="thumbnailsMode")?155+(F*23):90+(F*23),width:170,height:20});n.inject(o);w=k.extendElement(document.createElementNS(this.svgNS.svg,"text"));w.setContent(this._trim(N.instances[F].name));w.setAttributes({id:"instance-"+N.instances[F].name,"class":"node-text",y:(f.getThumbnailsMode()==="thumbnailsMode")?170+(F*23):105+(F*23),x:5});w.inject(o);k.extendElement(document.createElementNS(this.svgNS.svg,"title")).setContent(N.instances[F].name).inject(w)}}}q.setContent(N.name);if(N.thumbnail){G=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));G.setAttributeNS(this.svgNS.xlink,"href",N.thumbnail);G.setAttributes({"class":"thumbnail-image",x:10,y:10,height:110,width:150})}v=this.createLoaderGif();if(N.icon_url){D=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));D.setAttributeNS(this.svgNS.xlink,"href",N.icon_url);D.setAttributes({x:5,y:I,height:16,width:16,"class":"map-type-icon"})}H.setAttributes({"class":"background",width:170,height:(f.getThumbnailsMode()==="thumbnailsMode")?130:65,});if(!N.isCount){A=k.extendElement(document.createElementNS(this.svgNS.svg,"rect"));A.setAttributes({"class":"small-rect",x:5,y:85,height:42,width:160});r=k.extendElement(document.createElementNS(this.svgNS.svg,"title"));r.setContent(g.get("dragToExtract"));B=k.extendElement(document.createElementNS(this.svgNS.svg,"rect"));B.setAttributes({"class":"thumbnail-background",x:5,y:5,width:160,height:(f.getThumbnailsMode()==="thumbnailsMode")?120:55,});E=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));E.setAttributeNS(this.svgNS.xlink,"href","");E.setAttributes({"class":"drag-icon",draggable:"true","data-id":N.id,x:0,y:0,width:170,height:(f.getThumbnailsMode()==="thumbnailsMode")?130:65});this.setDragEvents(E,N);if(this.layoutingOn){E.setStyle("display","none")}p=this._createMultiSelIcon(N)}if(N.thumbnail){O=k.extendElement(document.createElementNS(this.svgNS.xhtml,"img"));O.setAttributes({src:N.thumbnail})}J.setAttributes({"class":"node-text"+(N.isCount?" count-text":""),x:(N.isCount?80:25),y:I});x.setAttributes({"class":"node"+(N.focus?" focus":"")+(N.isCount?" node-count-new":""),id:"container-"+N.id,"data-id":N.id});if(!N.isCount){var K=this.getTextContent(N);J.setContent(this.wrapText(K));q.setContent(K)}else{J.setContent(N.name);q.setContent(N.name)}if(!(i.isWebInWin())){y=this._createForeignObject(N,x)}else{y=""}x.setContent([q,H,B,G,A,D,J,E,v,p,y,C,o]);return x},_createForeignObject:function(s,o){var u=this,n=k.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));u.isJapanese=(f.getLang()==="ja")?true:false;n.setAttributes({"class":"foreign-object-count-mobile",x:130,y:(f.getThumbnailsMode()==="thumbnailsMode")?95:35,height:50,width:50});n.setContent(k.createElement("span",{"class":"fonticon-2x fonticon fonticon-chevron-down"}));var t={target:n.firstChild,renderTo:n},v;if(s.isCount){t.items=[{id:s.id,text:g.get("splitCount"),fonticon:"folder-opening"}];t.events={onClick:function(x,w){x.stopPropagation();u.dispatchEvent("splitCountOnIpad",w.id)}}}else{if(s.type&&s.type.contains("Document")){t.items=[{id:s.id,name:s.name,text:g.get("Download"),fonticon:"fonticon-download"}];t.events={onClick:function(x,w){x.stopPropagation();u.dispatchEvent("ENORIPE_downloadDocument",[w.id,w.name])}}}else{t.items=[]}v={data:{items:[{serviceId:"3DSpace",envId:f.getPlatformId()||"OnPremise",objectId:s.id,objectType:s.type}]}};if(s.taxonomies&&s.taxonomies.length>0){var q=this._getTaxonomies(s.taxonomies);if(q&&q.length>0){v.data.items[0].objectTaxonomies=q}}}var p=new a(t);if(!s.isCount){if(!this.ODTMode){var r=new c().set3DXContent(v).render(p)}p.elements.container.addEvent("click",function(w){w.stopPropagation()})}p.addEvent("onClickOutside",function(w){if(!w.target.hasClassName("fonticon-right-open")){n.setAttribute("width",50)}});n.firstChild.addEvent("click",u.dropDownClickHandler.bind(u,p,o,s.isCount));return n},_getTaxonomies:function(r){if(r&&r.length>0){var n=r.split(","),p="";for(var o=0;o<n.length;o++){if(n[o].contains("types")){n=n[o];break}}var q=n.split("/");if(q.length>1){q.splice(0,1);return q}else{return[]}}},dropDownClickHandler:function(p,o,t,v){this.dispatchEvent("ENORIPE_movetofront",o);var n=o.getElement(".foreign-object-count-mobile"),y=50;var u=this,z=false,q=false,w=false;if(this.isChrome){if(v.detail&&v.detail.isCustom!=="true"){p.toggle();v.stopPropagation();return}}if(p.isVisible===true){y=this.isJapanese?300:200}n.setAttribute("width",y);if(t){v.stopPropagation();return}for(var s=0;s<p.items.length;s++){q=(p.items[s].name&&p.items[s].name.contains("open-with"));w=(p.items[s].text&&p.items[s].text.contains("Download"));if(!q&&!w){z=true;break}}if(z){if(u.isJapanese){p.elements.container.setStyle("width","80%")}if(!(o.getElement(".foreign-drop-down"))){var r=u._makeOpenWithUI(p);o.addContent(r)}var x=o.getElement(".foreign-drop-down");if(x){if(!p.isVisible){x.hide()}else{u._modifyOpenWithUI(p,z);x.show()}}}else{u._modifyOpenWithUI(p)}v.stopPropagation()},_modifyOpenWithUI:function(o,n){var q;if(o.items&&o.items.length===0){console.warn("No items present in dropdownmenu");return}for(var p=0;p<o.items.length;p++){if(o.items[p].name&&o.items[p].name.contains("open-with")){q=o.items[p];if(q.elements.container.getElement(".next-icon")&&q.elements.container.getElement(".next-icon").isHidden()){return}}else{if(o.items[p].text&&o.items[p].text.contains("Download")){}else{o.items[p].elements.container.hide()}}}if(q.elements.container.getElement(".next-icon")){q.elements.container.getElement(".next-icon").hide()}if(n){q.elements.container.removeClassName("disabled")}q.elements.container.addEvent("mouseover",function(s){s.stopPropagation();var r=s.target||s.srcElement;if(r&&r.getElement(".next-icon")){r.getElement(".next-icon").hide()}})},_makeOpenWithUI:function(p){var v=this,z=p.elements.container.getElement(".dropdown-menu.dropdown-menu-root.bottom-right");if(z){z.hide()}var x=p.items.slice(0),q=x.length,t;for(var u=0;u<q;u++){if(p.items[u].name&&p.items[u].name.contains("open-with")){t=p.items[u];x.splice(u,1)}else{if(p.items[u].text&&p.items[u].text.contains("Download")){x.splice(u,1)}}}var o=k.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),y=200;if(p.items&&p.items.length>0){y=p.items.length*45}o.setAttributes({"class":"foreign-object-count-mobile foreign-drop-down",x:(v.isJapanese)?370:280,y:(f.getThumbnailsMode()==="thumbnailsMode")?100:40,height:(y)?y:200,width:220});o.setContent(k.createElement("span",{"class":"fonticon-2x fonticon fonticon-right-open"}));var s={target:o.firstChild,renderTo:o},w;s.items=x;var r=new a(s);o.firstChild.addEvent("click",function(n){if(v.isChrome){if(n.detail&&n.detail.isCustom!=="true"){p.toggle()}}n.stopPropagation()});if(t){t.elements.container.addEvent("mouseenter",function(n){r.show()})}r.elements.container.addEvent("mouseleave",function(n){r.hide()});o.firstChild.addEvent("mouseover",function(n){r.show();n.stopPropagation()});r.elements.container.addEvent("click",function(n){n.stopPropagation()});p.addEvent("onClickOutside",function(n){if(!n.target.hasClassName("fonticon-right-open")){o.hide()}});p.addEvent("onClick",function(n){if(!this.isVisible){o.hide()}});return o},getFeedbackReorder:function(n){var o;if(!this._reorderFeedback){this._reorderFeedback=k.extendElement(document.createElementNS(this.svgNS.svg,"rect"))}if(n==="top"){o=-10}else{o=(f.getThumbnailsMode()==="thumbnailsMode")?130:65}this._reorderFeedback.setAttributes({y:o,id:"reorder-feedback",width:"170px",height:"10px"});return this._reorderFeedback},createLoaderGif:function(){var n=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));n.setAttributeNS(this.svgNS.xlink,"href",e.getWebappsAssetUrl("SNNavigationMap","icons/ui/uikit-loader.gif"));n.setAttributes({x:65,y:(f.getThumbnailsMode()==="thumbnailsMode")?40:20,height:40,width:40,"class":"loader-icon"});return n},createSplitCountIcon:function(o){var n=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));n.setAttributeNS(this.svgNS.xlink,"href",e.getWebappsAssetUrl("SNNavigationMap","icons/16/I_ExplodeOnSegments_16.png"));n.setAttributes({"class":"split-icon-new","data-id":o,x:150,y:110,width:16,height:16});return n},_createMultiSelIcon:function(o){var p=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));var n=(true===o.focus)?this._CheckedIcon:this._UncheckedIcon;p.setAttributeNS(this.svgNS.xlink,"href",n);p.setAttributes({"class":"multiSel-mapView-icon","data-id":o.id,"data-checked":o.focus||false,x:149,y:5,width:16,height:16});return p},setDragEvents:function(q,p){var o=this;q.addEventListener("mousedown",function(r){r.stopPropagation()});q.addEventListener("click",function(r){});q.addEventListener("dragstart",function(t){t.stopPropagation();var s={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:o.getSelectedItems({serviceId:"3DSpace",objectId:p.id,objectType:p.type,displayName:p.name})}};if(i.isWebInWin()){i.sendToMapWebInWin("RefreshOnDrag",p.id)}if(t.dataTransfer){if(i.isWebInWin()){try{t.dataTransfer.setData("text",JSON.stringify(s))}catch(r){console.log("Error in set Data for web in win : "+r)}}else{try{t.dataTransfer.setData("text/searchitems",JSON.stringify(s));t.dataTransfer.setData("text",JSON.stringify(s))}catch(r){console.log(r);t.dataTransfer.setData("Text",JSON.stringify(s))}}}d.closeWidget()});var n=null;q.addEventListener("touchmove",function(s){s.stopImmediatePropagation();s.preventDefault();var t=s.touches[0];n=document.elementFromPoint(t.pageX,t.pageY);if(n&&n.closest("#svg-root")){var r=o._dropZone._getFreeZoneWidth();o._dropZone.show(r,false)}n=document.elementFromPoint(t.pageX,t.pageY);if(n&&n.closest(".replace-content")){o._dropZone._replaceContentDiv.addClassName("current-dragover");o._dropZone._addContentDiv.removeClassName("current-dragover")}else{if(n&&n.closest(".add-content")){o._dropZone._addContentDiv.addClassName("current-dragover");o._dropZone._replaceContentDiv.removeClassName("current-dragover")}}});q.addEventListener("touchend",function(t){o._dropZone._replaceContentDiv.removeClassName("current-dragover");o._dropZone._addContentDiv.removeClassName("current-dragover");o._dropZone.hide();var s="";if(n&&n.closest(".replace-content")){s="replace"}else{if(n&&n.closest(".add-content")){s="add"}}if(s!==""){var r={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:o.getSelectedItems({serviceId:"3DSpace",objectId:p.id,objectType:p.type,displayName:p.name})}};o.dispatchEvent("ENORIPE_Drop",[s,r])}n=null})},getSelectedItems:function(q){var o=[],r=false,n=f.getPlatformId()||"OnPremise";if(this._selector.isMultiSelActivated()===1){var p=this._selector.getSelectedItemsForDragAndDrop();p.forEach(function(s){if(s.get("id")===q.id){r=true}o.push({envId:n,serviceId:"3DSpace",objectId:s.get("id"),objectType:s.get("type"),displayName:s.get("name")})});if(r===false){q.envId=n;o.push(q)}}else{q.envId=n;o.push(q)}return o},getTextContent:function(q){var o=this.nameLabel;if(!o){return}var n="",s="";for(var p=0;p<o.length;p++){s="";if(q.hasOwnProperty(o[p])){s=q[o[p]];if(o[p].contains("modified")){var r=new Date(s);s=j.strftime(r,"%m/%d/%Y %r")}}if(s&&s.length>0){n=(n.length>0)?(n+this.separator+s):s}if(p===2){break}}return n},wrapText:function(u){var x=[],o=[],q=0,n=0,p=22,r=0,t=0,v=22,w;while(r<u.length){if(t===0||t===1){r=n+v;q=this._widthOfText(u.substring(n,r));if(t===0){q=q+7}if(q>=34){p=10}else{if(q>v){p=(v)-((q-v)*(v/q));p=Math.floor(p)}else{p=v}}}r=n+p;x.push(u.substring(n,r));n=r;t++}if(x.length>2){x[1]=x[1].substring(0,x[1].length-3)+"..."}for(var s=0;s<x.length;s++){w=k.extendElement(document.createElementNS(this.svgNS.svg,"tspan"));if(s===0){w.setAttributes({x:26,dy:10*(s+1)})}else{w.setAttributes({x:10,dy:10*(s+1)})}w.setContent(x[s]);o.push(w);if(s===1){break}}return o},_widthOfText:function(r){var p=0,q=["$","_","<",">","+","~","&"],o="";for(var n=0;n<r.length;n++){o=r.charAt(n);if(o==="%"||o==="@"){p=p+2.2}else{if(o==="#"||o==="$"||o==="?"){p=p+1.2}else{if(o===o.toUpperCase()&&o!==o.toLowerCase()){p=p+1.5}else{if(q.indexOf(o)!==-1){p=p+1.3}else{p++}}}}}return Math.ceil(p)},showColor:function(o,n){if(!o){return}var p=o.getElements(".small-rect")[1]||o.getElement(".drag-icon");k.extendElement(document.createElementNS(this.svgNS.svg,"rect")).setAttributes({"class":"colored-rect-bi",fill:n,x:5,y:5,width:5,height:(f.getThumbnailsMode()==="thumbnailsMode")?120:55}).inject(p,"after")},createThumbnail:function(n,q){if(!n||!q){return}if(n.getElement(".thumbnail-image")){return}var p=n.getElement(".thumbnail-background");var o=k.extendElement(document.createElementNS(this.svgNS.svg,"image"));o.setAttributeNS(this.svgNS.xlink,"href",q);o.setAttributes({"class":"thumbnail-image",x:10,y:10,height:110,width:150}).inject(p,"after")}});return b});define("DS/SNNavigationMap/collections/NavigationCollection",["UWA/Core","UWA/Class/Collection","DS/SNNavigationMap/MapSettings","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","UWA/Promise","DS/PlatformAPI/PlatformAPI"],function(h,e,c,a,f,d,b){var g=e.extend({orphanNodesAllowed:true,multipleDrop:false,instancesMatch:{},nodesToBeRemoved:[],_requests:[],_layoutRecomputeReq:true,setup:function(j,i){this.add(j);this._layoutUtils=i.layoutUtils;this._widgetId=i.widgetId||null;this._savedColumns=i.savedColumns||{};this._savedRows=i.savedRows||{};this.setAvailableRelations(i._availableRelations);this._debug=i.debugMode||false},setAvailableRelations:function(m){var k=m,n={},j="";for(var l=0;l<k.length;l++){j=k[l].name;n[j]=true}this._baseRelations=n;this._availableRelations=k},getProfileDirections:function(i){var k=(i.indexOf("_from")>-1)?i.replace("_from",""):i.replace("_to",""),j={};j._from=this._baseRelations[k+"_from"];j._to=this._baseRelations[k+"_to"];return j},parse:function(i){var m=[],k=this,j=JSON.parse(i),l=this;j.New.Objects.forEach(function(n){var p=l._savedRows[n.id];n.modelType="node";if(p){n.rowID=p}if(n.instances){for(var o=0;o<n.instances.length;o++){k.instancesMatch[n.instances[o].id]=n.id}}m.push(n)});j.New.Links.forEach(function(o){var p=o.source,q=o.target,n=l.getProfileDirections(o.type);o.modelType="link";if(o.direction==="in"){o.type=(n._to)?o.type.replace("_from","_to"):o.type;o.source=(n._to)?q:p;o.target=(n._to)?p:q}m.push(o)});j.New.Counts.forEach(function(p){var o=p,r=l._savedRows[o.id],n=l.getProfileDirections(p.name),q={id:o.id,modelType:"node",name:o.count,isCount:true,direction:o.direction},s={id:o.source+"_"+o.id,modelType:"link",source:(o.direction==="in"&&n._to)?o.id:o.source,target:(o.direction==="in"&&n._to)?o.source:o.id,type:(o.direction==="in"&&n._to)?o.name.replace("_from","_to"):o.name};if(r){q.rowID=r}m.push(q,s)});j.old.Counts.forEach(function(n){var o=l.get(n.id);if(o){l.remove(l.where({source:o._attributes}));l.remove(l.where({target:o._attributes}));l.remove(n.id);if(l._savedColumns[n.id]){delete l._savedColumns[n.id]}if(l._savedRows[n.id]){delete l._savedRows[n.id]}}});return m},customFetch:function(j){var i="";if(this._widgetId){if(this._widgetId.search("preview")!==-1){var l=b.getUser(),n=(l!==null&&l!==undefined&&l.login!==undefined)?b.getUser().login:"",o=new Date(),p=o.getDay()+o.getMonth()+o.getFullYear(),q=p+"-"+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds();i="ENORIPE_AP-"+n+"-"+q}else{i=this._widgetId}}var m=this,k={ids:j,widgetId:i,checkSupported:false};if(this._debug){k.debug=true}return new d(function(r){a.authenticatedRequest(c.get3DSpaceUrl()+"/resources/enorelnav/navigate/getInfosForSupportedObjects?tenant="+c.getCurrentTenantName(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(k),timeout:60000,onComplete:function(s){var t=m._parseNodes(s);r(t)},onFailure:function(t){console.log(t);var s={};s.type="generic";m.dispatchEvent("ENORIPE_handleErrorMsgs",[s])},onTimeout:function(t){console.log(t);var s={};s.type="timeout";m.dispatchEvent("ENORIPE_handleErrorMsgs",[s])}})})},_parseNodes:function(m){var l=JSON.parse(m).infos.Objects,k=[],r=[],o="",q="",p=this._savedColumns||{},j=this._savedRows||{};for(var n=0;n<l.length;n++){if(l[n].supported===true&&l[n].found===undefined){l[n].modelType="node";l[n].columnID=p[l[n].id]||0;l[n].rowID=j[l[n].id]||undefined;k.push(l[n]);r.push(l[n].id)}else{if(l[n].found===false){q+=l[n].name+"</br>"}else{o+=l[n].name+" ("+l[n].type+")</br>"}}}return{supported:k,supportedIdsArray:r,notSupported:o,notFound:q}},setColumnIds:function(i){this._savedColumns=i},setRowIds:function(i){this._savedRows=i},extract:function(i){var j=JSON.stringify({ids:i,widgetId:this._widgetId,timeout:60000});this.fetch({url:c.get3DSpaceUrl()+"/resources/enorelnav/navigate/extract?tenant="+c.getCurrentTenantName(),data:j,remove:false,onComplete:this._prepareNodesAndLinks})},splitCount:function(j){var i=JSON.stringify({id:j,widgetId:this._widgetId,timeout:60000});this.fetch({url:c.get3DSpaceUrl()+"/resources/enorelnav/navigate/splitCount?tenant="+c.getCurrentTenantName(),data:i,remove:false,onComplete:this._prepareNodesAndLinks})},getFocusedNode:function(){if(this.length===1){return this._models[0]}return this.findWhere({focus:true})},removeElementUpdate:function(i){var k={widgetId:this._widgetId,ids:i},j=this;if(this._debug){k.debug=true}return new d(function(l){a.authenticatedRequest(c.get3DSpaceUrl()+"/resources/enorelnav/navigate/removeElements?tenant="+c.getCurrentTenantName(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(k),timeout:60000,onComplete:function(m){l(m)},onFailure:function(n){console.log(n);var m={};m.type="generic";j.dispatchEvent("ENORIPE_handleErrorMsgs",[m])},onTimeout:function(n){console.log(n);var m={};m.type="timeout";j.dispatchEvent("ENORIPE_handleErrorMsgs",[m])}})})},getEcoSystem:function(j){var i={widgetId:this._widgetId,timeout:c.getTimeout()};this._isBusy();i[(typeof j==="string"?"id":"ids")]=j;this.fetch({url:c.get3DSpaceUrl()+"/resources/enorelnav/navigate/getecosystem?tenant="+c.getCurrentTenantName(),data:JSON.stringify(i),remove:false,onComplete:this._prepareNodesAndLinks,timeout:c.getTimeout()})},removeSelectedNodes:function(){var i=this,j=this.where({focus:true});this.removeNodes(j)},removeNotSelectedNodes:function(){var j=this,i=this.filter(function(k){if(k.get("modelType")==="node"){if(k.get("focus")===true){return false}else{return true}}else{return false}});this.removeNodes(i)},removeFadedNodes:function(i){this.removeNodes(i)},removeNodes:function(i){var j=this;if(this._requestTimer){return}if(this._isBusy()){this._requestTimer=setInterval(function(){if(j._isBusy()){return}else{clearInterval(j._requestTimer);j._requestTimer=null;j._removeNodes(i)}},1000)}else{this._removeNodes(i)}if(this._requestTimer){setTimeout(function(){clearInterval(j._requestTimer);j._requestTimer=null},25000)}},_removeNodes:function(v){var s=this,n=[],u=[],r=[],t=[],l=[];v.forEach(function(j){var x=false;for(var w=0;w<s.nodesToBeRemoved.length;w++){if(j.id===s.nodesToBeRemoved[w].id){x=true;break}}if(!x){s.nodesToBeRemoved.push(j)}});for(var p=0;p<v.length;p++){var q=this.where({target:v[p]._attributes});q=q.concat(this.where({source:v[p]._attributes}));for(var o=0;o<q.length;o++){if(u.indexOf(q[o].id)===-1){u.push(q[o].id)}}r=r.concat(q);n.push(v[p].id)}t=t.concat(v);t=t.concat(r);this.remove(t);var m=this.filterOrphanNodes(),k=m.length>0;l=l.concat(n);l=l.concat(m);l=l.concat(u);this.removeElementUpdate(l).then(function(){s.dispatchEvent("ENORIPE_NodesRemoved",[l,k])},function(i){console.log(i)})},_isBusy:function(){var i=false,k=this,j=[];k._requests.forEach(function(l){if(l.xhr.readyState!==4){i=true;j.push(l)}});this._requests=j;return i},_prepareNodesAndLinks:function(m){var j=m.filter(function(n){var i=n._attributes;return(i.modelType==="link"&&(h.is(i.source,"string")||h.is(i.target,"string")))});j.forEach(function(i){if(m.get(i.get("source"))){i.set("source",m.get(i.get("source"))._attributes)}else{if(m.instancesMatch[i.get("source")]){i.set("source",m.get(m.instancesMatch[i.get("source")])._attributes)}}if(m.get(i.get("target"))){i.set("target",m.get(i.get("target"))._attributes)}else{if(m.instancesMatch[i.get("target")]){i.set("target",m.get(m.instancesMatch[i.get("target")])._attributes)}}});j.forEach(function(n){if(n.get("instancelink")!==true){var i=m.where({source:n.get("source"),target:n.get("target")});i.forEach(function(o){if(o.id!==n.id){o.set("instancelink",true)}})}});m._setColumnOnNodes();if(!m.needsRemove){m._models.forEach(function(p){if(m.nodesToBeRemoved&&m.nodesToBeRemoved.length>0){var o=m.nodesToBeRemoved;for(var n=0;n<o.length;n++){if(p.id===o[n].id){m.nodesToBeRemoved.splice(n,1);break}}}})}if(m.needsRemove&&m.nodesToBeRemoved&&m.nodesToBeRemoved.length>0){m.needsRemove=false;var k=[];for(var l=0;l<m.nodesToBeRemoved.length;l++){if(m.get(m.nodesToBeRemoved[l].id)){k.push(m.get(m.nodesToBeRemoved[l].id))}}if(k.length>0){m.removeNodes(k)}}m.dispatchEvent("ENORIPE_updateProxy")},_setColumnBasedOnLayout:function(){this._layoutUtils._dagre.layout(this._layoutUtils._graphObject);var m={},p=[],l=null,r=null,q=this._layoutUtils._graphObject.nodes();for(var o=0;o<q.length;o++){l=this.get(q[o]);if(l){l.set("xColumn",this._layoutUtils._graphObject.node(q[o]).x);l.set("yColumn",this._layoutUtils._graphObject.node(q[o]).y)}}m=this.groupBy("xColumn");delete m["undefined"];p=Object.keys(m).sort(function(j,i){return j-i});for(o=0;o<p.length;o++){r=m[p[o]].sort(function(j,i){return j.get("yColumn")-i.get("yColumn")});for(var n=0;n<r.length;n++){r[n].set("columnID",o);r[n].set("rowID",n)}}if(!this.orphanNodesAllowed){var k=this.filterOrphanNodes();this.orphanNodesAllowed=true}},_setColumnOnNodes:function(){this._layoutUtils.setData(this.getLinksAndNodes());if(c.getLayoutMode()==="recompute"||this.multipleDrop===true){this._setColumnBasedOnLayout();this.multipleDrop=false}var t=this,n=t.filter(function(i){return(i.get("modelType")==="node"&&i.get("columnID")===undefined)}),r=[],w=[],l=[],m=[],v=(h.is(this._savedColumns,"string")?JSON.parse(this._savedColumns):this._savedColumns)||{},u=(h.is(this._savedRows,"string")?JSON.parse(this._savedRows):this._savedRows)||{};for(var s=0;s<n.length;s++){r=t.where({target:n[s]._attributes});w=t.where({source:n[s]._attributes});if(r.length){for(var q=0;q<r.length;q++){l.push(t.get(r[q].get("source").id))}n[s].set("columnID",Math.max.apply(Math,l.map(function(i){return i.get("columnID")}))+1)}if(w.length){for(var p=0;p<w.length;p++){m.push(t.get(w[p].get("target").id))}n[s].set("columnID",Math.min.apply(Math,m.map(function(i){return i.get("columnID")}))-1)}v[n[s].get("id")]=n[s].get("columnID");if(n[s].get("rowID")){u[n[s].get("id")]=n[s].get("rowID")}r=[];w=[];l=[];m=[]}if(!this.orphanNodesAllowed){var o=this.filterOrphanNodes();this.orphanNodesAllowed=true}this._savedColumns=v;this._savedRows=u;u=u;v=JSON.stringify(v);this.dispatchEvent("ENORIPE_setSavedColumnIds",["ENORIPE_savedColumnIds",v]);this.dispatchEvent("ENORIPE_setSavedRowIds",["ENORIPE_savedRowIds",u])},filterOrphanNodes:function(r){var p=this,j=p.filter(function(i){return(i.get("modelType")==="node")}),m=[],q=[],k=false,t={},s="",l=[];var o=p.findWhere({isAnchor:true});if(o){s=o.get("id")}for(var n=0;n<j.length;n++){m=p.where({target:j[n]._attributes});q=p.where({source:j[n]._attributes});if(m.length===0&&q.length===0){if(s.length>0&&s===j[n].id&&!r){k=true;t=j[n]}else{p.remove(j[n],{silent:true});l.push(j[n].id)}}}if(k&&p.length>1){p.remove(t,{silent:true});l.push(t.id)}return l},sync:function(o,n,k){var j,m=this;if(this._debug){if(h.is(k.data,"string")){k.data=JSON.parse(k.data)}k.data.debug=true;k.data=JSON.stringify(k.data)}try{switch(o){case"read":var l=a.authenticatedRequest(k.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:k.data,onComplete:k.onComplete,onFailure:function(q){console.log(q);var p={};p.type="generic";m.dispatchEvent("ENORIPE_handleErrorMsgs",[p])},onTimeout:function(q){console.log(q);var p={};p.type="timeout";m.dispatchEvent("ENORIPE_handleErrorMsgs",[p])}});break;case"create":break;case"update":case"patch":break;case"delete":break;default:throw new Error('Unsupported method "{0}"'.format(o))}this._requests.push(l)}catch(i){j=i.message}return{cancel:function(){return}}},getModelsAttrs:function(i){if(!i){this.toJSON()}else{return this.where({modelType:i}).invoke("toJSON")}},getLinksAndNodes:function(l){var k=[],j=(l===false?false:true),i=[];this.filter(function(m){if(m.get("modelType")==="node"){if(j===true){k.push(m._attributes)}else{if(m.get("isCount")!==true){k.push(m._attributes)}}}else{if(m.get("modelType")==="link"){if(j===true){i.push(m._attributes)}else{if(m._attributes.source.isCount!==true&&m._attributes.target.isCount!==true){i.push(m._attributes)}}}}});return{nodes:k,links:i}}});return g});define("DS/SNNavigationMap/views/D3MapView",["UWA/Core","UWA/Class/View","DS/D3js_external/D3js","DS/SNNavigationMap/views/elements/RoundedRect","DS/SNNavigationMap/views/elements/Links","DS/D3Cola/D3Cola","UWA/Utils/Client","DS/UIKIT/Tooltip","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(h,a,l,b,i,g,k,j,c,d,f){var e=a.extend({name:"d3-map-view",className:function(){return this.getClassNames("-container multisel-off")},_tooltips:{},_highlightTimeout:null,_isMultiSelON:0,_UncheckedIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),_unfocusedIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel-unfocused.png"),nodeMouseDown:false,dragNodeStarted:false,currentlyDraggingNode:false,_currentDraggedNode:null,_selectedNode:null,_currentData:null,markersData:[{id:"node-arrow",position:10,color:"#368EC4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus",position:10,color:"#368ec4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus-reverse",position:0,color:"#368ec4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-reverse",position:0,color:"#368EC4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-red",position:10,color:"#EA4F37",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-green",position:10,color:"#57B847",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-orange",position:10,color:"#FFA500",dValue:"M 0 0 L 10 5 L 0 10 z"}],_scaleExtent:[0.2,3],setup:function(m){var n=this;l.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};this._selector=m.selector;this.NodeCreator=new b(this._selector);this.NodeCreator.isChrome=this.isChrome();this.NodeCreator._dropZone=m.dropZone;this.NodeCreator.layoutingOn=false;this.NodeCreator.addEvent("splitCountOnIpad",this.splitAction.bind(this));this.NodeCreator.addEvent("ENORIPE_downloadDocument",function(p,o){n.dispatchEvent("ENORIPE_downloadDocument",[p,o])});this.NodeCreator.addEvent("ENORIPE_Drop",function(p,o){n.dispatchEvent("ENORIPE_Drop",[p,o])});this.NodeCreator.addEvent("ENORIPE_movetofront",function(o){l.select(o).moveToFront()});this.LinksCreator=new i();this.initDragListener();this.layoutAxis=d.getLayoutAxis();this.layoutDirection=d.getLayoutDirection();if(d.getThumbnailsMode()===false){this.container.addClassName("no-thumbnails")}this._countLimit=m.countLimit;this.NodeCreator.nameLabel=m.nameLabel;this.NodeCreator.separator=m.separator;this._layoutUtils=m.layoutUtils;this.nodeRadius=80;this.width=window.innerWidth;this.height=window.innerHeight-150;this.zoomListener=l.behavior.zoom().scaleExtent(this._scaleExtent);this.svgContainer=l.select(this.container).append("svg").attr("id","svg-root").attr("width",this.width).attr("height",this.height).attr("pointer-events","all").call(this.zoomListener.on("zoom",this._redraw.bind(this))).on("dblclick.zoom",null).on("mousedown",function(){n.mouseDownTimeInContainer=new Date()}).on("mouseup",function(){n.mouseUpTimeInContainer=new Date()}).on("click",this._clearSelection.bind(this)).on("touchmove",function(){l.event.preventDefault()});this.svgRootG=this.svgContainer.append("g");this.linksContainer=this.svgRootG.append("g").attr("id","all-links");this.nodesContainer=this.svgRootG.append("g").attr("id","all-nodes");this.focusContainer=this.svgRootG.append("g").attr("id","focused-objects");this.defs=this.svgContainer.append("svg:defs");this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(o){return o.id}).attr("viewBox","0 0 10 10").attr("refX",function(o){return o.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(o){return o.dValue}).attr("fill",function(o){return o.color});this.force=g.d3adaptor().linkDistance(150).size([this.width,this.height]).on("tick",this.tick.bind(this));this.svgElement=this.getElement("svg")},_clearSelection:function(){if(l.event.srcElement){if(l.event.srcElement.className.baseVal!==""){return}}else{if(l.event.target){if(l.event.target.className.baseVal!==""){return}}}var m=this.mouseUpTimeInContainer-this.mouseDownTimeInContainer;if(l.event.defaultPrevented&&m>100){return}this.dispatchEvent("ENORIPE_clearSelection",["MapView"])},initDragListener:function(){var m=this;this.nodeMousePressTime=0;this.dragListener=l.behavior.drag().on("dragstart",function(n){m.nodeMouseDownTime=new Date();m.mouseOriginalY=l.mouse(this)[1];m.resetLinksOpacity(n);m.dragNodeStarted=true;m.currentlyDraggingNode=true;l.event.sourceEvent.stopPropagation()}).on("drag",function(r){if(m.NodeCreator.layoutingOn===false){return}var u=l.mouse(this),s=l.mouse(m.svgContainer[0][0]),v=20;if(m.dragNodeStarted){m.initiateDrag(r,this)}if(s[1]<v){m._panTimer=true;m._pan(this,"up")}else{if(s[1]>(m.svgContainer[0][0].height.baseVal.value-v)){m._panTimer=true;m._pan(this,"down")}else{try{clearTimeout(m._panTimer)}catch(q){}}}r.y0+=u[1]-m.mouseOriginalY;if(m._isTouchDevice()){var o,t=m.getElement("#"+this.id).getBoundingClientRect(),n=(t.top+t.bottom)/2;this._selectedNode=null;l.selectAll(".node").each(function(w){if(r.columnID===w.columnID&&r.id!==w.id){o=m.getElement("#"+this.id).getBoundingClientRect();if((o.top<n&&n<o.bottom)){m._selectedNode=w}}})}var p=l.select(this);p.attr("transform","translate("+r.x+","+r.y0+")");m._updateReorderFeedback()}).on("dragend",function(t){var q=l.select(this),s,o,p;if(m.nodeMouseUpTime){var r=new Date()-m.nodeMouseUpTime;if(r<100){return}}m.nodeMouseUpTime=new Date();m.nodeMousePressTime=m.nodeMouseUpTime-m.nodeMouseDownTime;q.classed("node-dragging",false);m.currentlyDraggingNode=false;m.mouseOriginalY=0;m.nodeMouseDown=false;if(m._selectedNode){s=(m._currentDraggedNode.rowID<m._selectedNode.rowID)?"down":"up";o=(m._currentDraggedNode.y0<m._selectedNode.y-(d.getThumbnailsMode()==="thumbnailsMode"?-20:-5))?"top":"bottom";if((s==="up"&&o==="top")||(s==="down"&&o==="bottom")){p=m._selectedNode.rowID}else{if(s==="up"&&o==="bottom"){p=m._selectedNode.rowID+1}else{if(s==="down"&&o==="top"){p=m._selectedNode.rowID-1}}}if(m._currentDraggedNode.rowID!==p){m.dispatchEvent("ENORIPE_ReorderColumn",[m._currentDraggedNode,m._selectedNode,p])}else{q.attr("transform","translate("+t.x+","+t.y+")")}}else{q.attr("transform","translate("+t.x+","+t.y+")")}m._currentDraggedNode=null;m._selectedNode=null;m.svgContainer.classed("dragging",false);m.svgContainer.select("#ghost-rect-"+t.id).attr("pointer-events","mouseover");m._updateReorderFeedback();if(m.isChrome()){if(m.nodeMousePressTime!==0&&m.nodeMousePressTime<250){var n=new CustomEvent("click",{detail:{isCustom:"true",ctrlKey:l.event.sourceEvent.ctrlKey},bubbles:true,cancelable:true});if(l.event.sourceEvent.toElement){l.event.sourceEvent.toElement.dispatchEvent(n)}else{if(l.event.sourceEvent.target){l.event.sourceEvent.target.dispatchEvent(n)}}}}})},_pan:function(n,r){var p=50,t,q,s,o=this;if(this._panTimer){clearTimeout(this._panTimer);var m=l.transform(this.svgRootG.attr("transform"));if(r==="up"||r==="down"){t=m.translate[0];q=r==="up"?m.translate[1]+p:m.translate[1]-p}s=this.zoomListener.scale();if(t!==undefined&&q!==undefined){this.zoomListener.translate([t,q]).scale(s);this.svgRootG.transition().attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")");this._panTimer=setTimeout(function(){o._pan(n,p,r)},50)}}},initiateDrag:function(n,m){this._currentDraggedNode=n;this.dragNodeStarted=false;this.svgContainer.select("#ghost-rect-"+n.id).attr("pointer-events","none");this.svgContainer.classed("dragging",true);l.select(m).classed("node-dragging",true).moveToFront()},fitAllIn:function(E){if(E===null||E===undefined){E={sidePanelWidth:0,actionBarHt:48}}var p=this.getBounds(),F=p.windowWidth,r=p.windowHeight,A=r*F,C=10,D=p.nodeWidth*p.nodeHeight,m=(D/A)*100,q=Math.sqrt(C/m),t=p.width,B=p.height,o=F-E.sidePanelWidth,u=r-E.actionBarHt,v=Math.min(o/t,u/B);v=(v>q)?q:v;var n=l.transform(l.select("g").attr("transform")),x=n.scale[0],z=n.translate[0],y=n.translate[1];v=v*x;v=(v>this._scaleExtent[1])?this._scaleExtent[1]:v;v=(v<this._scaleExtent[0])?this._scaleExtent[0]:v;this.zoomListener.translate([z,y]).scale(v);this._redraw(false);this._centerTheGraph(E)},_graphBounds:function(){var m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;this.nodesContainer.selectAll(".node").each(function(q){m=Math.min(m,q.x-10);p=Math.max(p,q.x+180);o=Math.min(o,q.y);n=Math.max(n,q.y+70)});return{x:m,X:p,y:o,Y:n}},setSVGDimensions:function(m,n){this.width=n;this.height=m;this.container.setStyle(m);this.svgContainer.attr("width",n).attr("height",m)},_addMissingThumbnail:function(o){var n=o.where({thumbnailTBU:true}),m=this;if(n.length>0){n.forEach(function(p){m.NodeCreator.createThumbnail(m.getElement("#container-"+p.id),p.get("thumbnail"))})}},updateNodesYposition:function(u){var n=this.getElements(".node-text, .map-type-icon"),p=this.getElements(".background"),y=this.getElements(".thumbnail-background"),m=this.getElements(".instance-expander-g .rect-bkg-instance"),r=this.getElements(".instance-expander"),z=this.getElements(".instance-list-g"),x=this.getElements(".drag-icon"),s;for(var q=0;q<x.length;q++){x[q].setAttribute("height",(u==="thumbnailsMode"?130:65))}for(q=0;q<n.length;q++){if(!n[q].hasClassName("count-text")){n[q].setAttribute("y",(u==="thumbnailsMode"?90:25))}else{n[q].setAttribute("y",(u==="thumbnailsMode"?71:40))}}for(q=0;q<p.length;q++){p[q].setAttribute("height",(u==="thumbnailsMode"?130:65))}for(q=0;q<y.length;q++){y[q].setAttribute("height",(u==="thumbnailsMode"?120:55))}m.forEach(function(A){A.setAttribute("y",(u==="thumbnailsMode"?133:68))});r.forEach(function(A){A.setAttribute("y",(u==="thumbnailsMode"?145:80))});var v,w;z.forEach(function(A){v=A.getElements(".rect-bkg-instance");w=A.getElements(".node-text");for(q=0;q<v.length;q++){v[q].setAttribute("y",(u==="thumbnailsMode"?155+(q*23):90+(q*23)))}for(q=0;q<w.length;q++){w[q].setAttribute("y",(u==="thumbnailsMode"?170+(q*23):105+(q*23)))}});var t=document.getElementsByClassName("loader-icon");for(q=0;q<t.length;q++){var o=t[q];if(u==="thumbnailsMode"&&o.getAttribute("y")==="20"){o.setAttribute("y","40")}else{if(u===false&&o.getAttribute("y")==="40"){o.setAttribute("y","20")}}}},render:function(m,o){this._currentData=m;var n=this._generateConstraints(o,m.nodes);this._resetFocusedLinksPosition();this._d3Update(m);this.force.constraints(n).start();m.nodes.forEach(function(p){p.y0=p.y});return this},removeLoadingClass:function(n){var m=this.getElement("#container-"+n);if(m){l.select(m).classed("is-loading",false)}},_bringFocusedLinksToFront:function(){var n=this.linksContainer.selectAll(".focus").remove(),m=this;if(!n.empty()){n.each(function(){var o=this;m.focusContainer.append(function(){return o})})}},_resetFocusedLinksPosition:function(){var m=this.focusContainer.selectAll("g").remove(),n=this;if(!m.empty()){m.each(function(){var o=this;n.linksContainer.append(function(){return o})})}},_redraw:function(m){if(this.nodeMouseDown){return}(m?this.svgRootG.transition():this.svgRootG).attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")")},_generateConstraints:function(q,v){var r=[],n={},m={},w=[],u=0,p,o=function(y,x){return(y._attributes.rowID>x._attributes.rowID)?1:((x._attributes.rowID>y._attributes.rowID)?-1:0)};if(q.undefined){delete q.undefined}for(var t in q){if(q.hasOwnProperty(t)){w=q[t];t=parseInt(t);if(q[t+1]){r.push({axis:this.layoutAxis,left:v.indexOf(w[0]._attributes),right:v.indexOf(q[t+1][0]._attributes),gap:300})}if(w.length>1){w=this._generateRowIDs(w);w.sort(o);n={type:"alignment",axis:this.layoutAxis,offsets:[]};m={type:"alignment",axis:(this.layoutAxis==="x"?"y":"x"),offsets:[]};for(var s=0;s<w.length;s++){u=(m.offsets[s-1])?m.offsets[s-1].offset+d.getYOffset():0;p=w[s-1];if(p&&p.get("instances")){u+=d.getExpendHeight();if(p.get("instancesExpanded")===true){u+=p.get("instances").length*d.getExpendHeight()}}n.offsets.push({node:v.indexOf(w[s]._attributes),offset:"0"});m.offsets.push({node:v.indexOf(w[s]._attributes),offset:u})}r.push(n,m)}}}return r},_generateRowIDs:function(r){var t=r.filter(function(u){return(u.get("rowID")!==undefined)}),q=r.filter(function(u){return(u.get("rowID")===undefined)}),s,m=[],o=r.length;for(var p=0;p<t.length;p++){s=t[p].get("rowID");if(s>r.length-1){t[p].set("rowID",r.length-1)}else{if(s<0){t[p].set("rowID",0)}}if(!m[t[p].get("rowID")]){m[t[p].get("rowID")]=t[p]}else{t[p].unset("rowID");q.push(t[p])}}for(var p=0;p<q.length;p++){for(var n=0;n<o;n++){if(m[n]===undefined){q[p].set("rowID",n);m[n]=q[p];break}}}return m},_d3Update:function(s){var q=this,n=s.nodes,u=s.links,p;this.force.size([this.width,this.height]).nodes(n).links(u);var t=this.linksContainer.selectAll(".link").data(u,function(v){return v.id}),m=this.nodesContainer.selectAll(".node").data(n,function(v){return v.id}),o=this.svgRootG.selectAll(".ghost-rect").data(n,function(v){return v.id});m.exit().remove();o.exit().remove();t.exit().remove();m.classed("focus",function(v){if(v.isCount===true&&this.getElement(".node-text")){this.getElement(".node-text").setContent(v.name)}return(v.focus)});t.classed("focus",function(x){var w=(x.source.focus===true||x.target.focus===true),v=this.getElementsByTagName("textPath")[0];if(w){this.getElement("path").setAttribute("marker-end","url(#node-arrow-focus)")}else{this.getElement("path").setAttribute("marker-end","url(#node-arrow)")}if(x.display_name_attributes){q.LinksCreator.updateLabel(v,x[x.display_name_attributes[0]])}else{q.LinksCreator.updateLabel(v,x.type)}return w});p=m.enter();o.enter().append("rect").attr("class","ghost-rect").attr("id",function(v){return"ghost-rect-"+v.id}).attr("width",this._layoutUtils.getNodesWidth()).attr("height",this._layoutUtils.getNodesHeight()).attr("pointer-events","mouseover").on("mouseover",this._onMouseOver.bind(this)).on("mouseout",this._onMouseOut.bind(this));var r=p.append(this.NodeCreator.createNode.bind(this.NodeCreator));r.on("mousedown",function(){q.nodeMouseDown=true}).on("mouseup",function(){q.nodeMouseDown=false}).on("touchmove",function(){l.event.preventDefault()}).call(this.dragListener).on("click",this.nodeClicked.bind(this)).on("contextmenu",this.nodeRightClicked.bind(this)).each(this._setupEvents.bind(this));if(k.Platform.ios!==true){r.on("mouseenter",this._onMouseEnter.bind(this)).on("mouseleave",this._onMouseLeave.bind(this))}l.selectAll(".node-count-new").classed("node-count-new",false).classed("node-count",true).on("dblclick",this.splitAction.bind(this));t.enter().append(this.LinksCreator.createNode.bind(this.LinksCreator));l.selectAll(".node-count").each(function(){var w=this.getChildren();if(w&&w.length>0&&w[0].tagName==="title"){var v=f.replace(f.get("countNodeToolTip"),{X:q._countLimit});w[0].textContent=v}})},_onMouseOver:function(m){if(this._currentDraggedNode.columnID===m.columnID){this._selectedNode=m;this._updateReorderFeedback()}},_onMouseOut:function(){this._selectedNode=null;this._updateReorderFeedback()},_updateReorderFeedback:function(){var m;l.select("#reorder-feedback").remove();if(this._currentDraggedNode!==null&&this._selectedNode!==null){m=this._selectedNode.y-(d.getThumbnailsMode()==="thumbnailsMode"?-20:-5);if(this._currentDraggedNode.y0<m){this.getElement("#container-"+this._selectedNode.id).appendChild(this.NodeCreator.getFeedbackReorder("top"))}else{this.getElement("#container-"+this._selectedNode.id).appendChild(this.NodeCreator.getFeedbackReorder("bottom"))}}},_onMouseEnter:function(n){if(this._filteredOpacity===true){return}var o=this.getElement("#container-"+n.id+" .multiSel-mapView-icon");if(o){o.show()}var m=this;if(this._highlightTimeout){clearTimeout(this._highlightTimeout)}this._highlightTimeout=setTimeout(function(){m._fadeLinks(n)},1000)},_onMouseLeave:function(m){this.resetLinksOpacity(m);var n=this.getElement("#container-"+m.id+" .multiSel-mapView-icon");if(n&&!this._isMultiSelON){n.removeAttribute("style")}},_fadeLinks:function(m){if(this.getElements(".link").length===0){return}var n=this.getElement("#container-"+m.id);if(m.isCount&&n===null){return}if(!this.currentlyDraggingNode){this.svgRootG.classed("links-nodes-faded",true);this.svgRootG.selectAll(".link").filter(function(o){if(o.source.id===m.id||o.target.id===m.id){l.select("#container-"+o.source.id).classed("highlighted",true);l.select("#container-"+o.target.id).classed("highlighted",true);return true}}).classed("highlighted",true)}},filterByFading:function(o){var q=this;q.filteredLinksByFilter=[];var m=o.map(function(r){return"#container-"+r}),n=[];if(m.length>0){n=document.querySelectorAll(m.join(", "))}this.getElements(".highlighted").forEach(function(r){r.removeClassName("highlighted")});this.resetLinksOpacity();this._filteredOpacity=true;this.svgRootG.classed("links-nodes-faded",true);for(var p=0;p<n.length;p++){n[p].addClassName("highlighted")}this.svgRootG.selectAll(".link").filter(function(r){if(o.indexOf(r.source.id)>-1&&o.indexOf(r.target.id)>-1){q.filteredLinksByFilter.push(this.id);return true}else{this.removeClassName("highlighted")}}).classed("highlighted",true)},clearOnlySearchResults:function(o){var q=this;var m=o.map(function(r){return"#container-"+r}),n=[];if(m.length>0){n=document.querySelectorAll(m.join(", "))}for(var p=0;p<n.length;p++){n[p].addClassName("highlighted")}},getFilteredNodes:function(){var m=[];m=this.getElements(".highlighted").map(function(n){if(n.id.contains("container-")){return n.id.replace("container-","")}});return m},colorize:function(m){for(var n in m){if(m.hasOwnProperty(n)){this.NodeCreator.showColor(this.getElement("#container-"+n),m[n])}}},colorizeSynchro:function(r){var q=r.synchroLinks.map(function(t){return document.getElementById(t)}),p=r.nonSynchroLinks.map(function(t){return document.getElementById(t)}),s=r.unknownLinks.map(function(t){return document.getElementById(t)});for(var o=0;o<q.length;o++){if(q[o]){q[o].addClassName("synchroLink")}}for(var n=0;n<p.length;n++){if(p[n]){p[n].addClassName("nonSynchroLink")}}for(var m=0;m<s.length;m++){if(s[m]){s[m].addClassName("unknownSynchroLink")}}l.selectAll(".synchroLink").select("path").attr("marker-end","url(#node-arrow-green)");l.selectAll(".nonSynchroLink").select("path").attr("marker-end","url(#node-arrow-red)");l.selectAll(".unknownSynchroLink").select("path").attr("marker-end","url(#node-arrow-orange)")},unColorizeSynchro:function(){l.selectAll(".synchroLink").select("path").attr("marker-end","url(#node-arrow)");l.selectAll(".nonSynchroLink").select("path").attr("marker-end","url(#node-arrow)");l.selectAll(".unknownSynchroLink").select("path").attr("marker-end","url(#node-arrow)");l.select(".focus.link").select("path").attr("marker-end","url(#node-arrow-focus)")},colorizeRelations:function(p){var s=this,o=false;for(var q=0;q<p.tagColors.length;q++){var r={id:"node-arrow-relations_"+p.tagColors[q].color,position:10,color:p.tagColors[q].color,dValue:"M 0 0 L 10 5 L 0 10 z"},t=false;for(var n=0;n<this.markersData.length;n++){if(this.markersData[n].id===r.id){t=true}}if(t===false){this.markersData.push(r);o=true}}if(o){this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(w){return w.id}).attr("viewBox","0 0 10 10").attr("refX",function(w){return w.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(w){return w.dValue}).attr("fill",function(w){return w.color})}for(var u in p.colorMap){if(p.colorMap.hasOwnProperty(u)){document.getElementById(u).setStyle("fill",p.colorMap[u]);document.getElementById(u).setStyle("stroke",p.colorMap[u]);document.getElementById(u).addClassName("filtered_rel");var m="url(#node-arrow-relations_"+p.colorMap[u]+")";var v=l.select(document.getElementById(u)).select("path").attr("marker-end");l.select(document.getElementById(u)).select("path").attr("previous-marker",v);l.select(document.getElementById(u)).select("path").attr("marker-end",m)}}},uncolorizeRelations:function(){l.selectAll(".filtered_rel").select("path").attr("marker-end",function(m){return l.select(document.getElementById(m.id)).select("path").attr("previous-marker")});this.svgRootG.selectAll(".filtered_rel").classed("filtered_rel",false);l.selectAll(".link").style("fill","");l.selectAll(".link").style("stroke","")},filterByFadingVolatile:function(p){if(p&&p.filteredPathIDList&&p.filteredLinks){var n=[],q=[],m=p.filteredPathIDList.map(function(r){return"#container-"+r});if(m.length>0){n=document.querySelectorAll(m.join(", "));q=p.filteredLinks.map(function(r){return document.getElementById(r)})}this.getElements(".highlighted").forEach(function(r){r.removeClassName("highlighted")});this.resetLinksOpacity();this._filteredOpacity=true;this.svgRootG.classed("links-nodes-faded",true);for(var o=0;o<n.length;o++){n[o].addClassName("highlighted")}for(var o=0;o<q.length;o++){if(q[o]){q[o].addClassName("highlighted")}}}},getFilteredNodesAndLinks:function(){var q={},m,p=(this.getElements(".links-nodes-faded").length>0)?true:false,s=this.getElements(".node"),r=this.getElements(".link");q.filteredNodes=[];q.filteredLinks=[];for(var o=0;o<s.length;o++){if(s[o].hasClassName("highlighted")||!p){q.filteredNodes.push(s[o].getAttribute("data-id"))}}for(var n=0;n<r.length;n++){if((s[n]&&s[n].hasClassName("highlighted"))||!p){q.filteredLinks.push(s[n].getAttribute("data-id"))}}return q},resetLinksOpacity:function(){if(this._filteredOpacity){return}if(this._highlightTimeout){clearTimeout(this._highlightTimeout)}this.svgRootG.classed("links-nodes-faded",false);this.svgRootG.classed("links-faded",false);this.svgRootG.selectAll(".highlighted").classed("highlighted",false)},_setupEvents:function(m){var n=this.getElement("#container-"+m.id+" .instance-expander-g");this._setupDragEndEvent(m);this._setupMultiSelEvent(m);if(n){n.addEvent("click",this._toggleInstances.bind(this))}},_toggleInstances:function(m){m.stopPropagation();if(l.event&&l.event.stopPropagation){l.event.stopPropagation()}if(h.Utils.Client.Engine.name==="chrome"){if(m&&m.detail&&m.detail.isCustom==="true"){this.dispatchEvent("ENORIPE_clickInstance",[m.currentTarget.parentNode.getAttribute("data-id")])}}else{this.dispatchEvent("ENORIPE_clickInstance",[m.currentTarget.parentNode.getAttribute("data-id")])}},_setupDragEndEvent:function(o){var n=this.getElement("#container-"+o.id+" .drag-icon"),m=this;if(n){n.addEventListener("dragend",function(){m.dispatchEvent("ENORIPE_dragEnd")})}},_setupMultiSelEvent:function(n){var o=this.getElement("#container-"+n.id+" .multiSel-mapView-icon"),m=this;if(o){o.addEventListener("click",function(q){if(m.isChrome()){if(!(q.detail&&q.detail.isCustom==="true")){return}}q.stopPropagation();var p=m._updateMultiSelState(n);m.dispatchEvent("ENORIPE_MultiSel_Object",[n.id,p,"MapView"]);m.dispatchEvent("ENORIPE_SetInfoPanelObject",[n.id,p])})}},_updateMultiSelState:function(o){var r=this.getElement("#container-"+o.id+" .multiSel-mapView-icon"),m="",n;if(r){if(this._xUncheckedIcon){n=0}if(this._xCheckedIcon){n=0}var q=r.getAttribute("data-checked");var p;if("false"===q){q="true";p=this._CheckedIcon;m="add"}else{q="false";p=this._UncheckedIcon;m="remove"}r.setAttributeNS("http://www.w3.org/1999/xlink","href",p);r.setAttribute("data-checked",q)}return m},initMultiSelection:function(){var m=this;this._isMultiSelON=1;this.container.removeClassName("multisel-off");this.container.addClassName("multisel-on");this.nodesContainer.selectAll(".node.focus").each(function(n){if(n.isCount){m.updateFocusClasses(n.id);m.dispatchEvent("removefocus",[n.id])}})},clearMultiSelection:function(){this._isMultiSelON=0;this.container.removeClassName("multisel-on");this.container.addClassName("multisel-off");this.container.removeClassName("unfocused");var m=this;this.getElements(".multiSel-mapView-icon").forEach(function(n){n.setAttribute("data-checked","false");n.setAttributeNS("http://www.w3.org/1999/xlink","href",m._UncheckedIcon)})},addToMultiSel:function(n){var m=this.getElement("#container-"+n+" .multiSel-mapView-icon");if(m){m.setAttribute("data-checked","true");m.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)}},removeFromMultiSel:function(o){var n=this.getElement("#container-"+o+" .multiSel-mapView-icon");var m=this.getElement("#container-"+o);if(m){m.removeClassName("focus")}if(n){n.setAttribute("data-checked","false");n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._UncheckedIcon)}},switchFocus:function(n,o){var q,p;for(var m=0;m<n.length;m++){q=n[m];p=this.getElement("#container-"+q+" .multiSel-mapView-icon");if(p){if(o){p.setAttribute("data-checked","false");p.setAttributeNS("http://www.w3.org/1999/xlink","href",this._unfocusedIcon)}else{p.setAttribute("data-checked","true");p.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)}}}},splitAction:function(n){if(h.is(n,"string")===true){n=l.select("#container-"+arguments[0]).datum()}if(parseInt(n.name)<=this._countLimit){var m=this.getElement("#container-"+n.id);l.select(m).classed("is-loading-count",true);this._splitCount(n.id)}else{this.dispatchEvent("ENORIPE_showNotif",[{level:"error",msg:f.get("countLimitError")}])}},_splitCount:function(m){if(l.event&&l.event.stopPropagation){l.event.stopPropagation()}this.dispatchEvent("ENORIPE_splitCount",[m]);this.resetLinksOpacity()},tick:function(){var n=this.svgRootG.selectAll(".link"),o=this.nodesContainer.selectAll(".node"),m=this.svgRootG.selectAll(".ghost-rect"),p=this,q={};o.attr("transform",function(r){return"translate("+r.x+","+r.y+")"});m.attr("x",function(r){return r.x});m.attr("y",function(r){return r.y});n.each(function(){var s=l.select(this),v=s.select("path"),u=s.select(".labelText"),r=l.select(this).datum(),w=p.getElements("#from_"+r.source.id+"_to_"+r.target.id),t=false;if(w.length>1){if(!q["#from_"+r.source.id+"_to_"+r.target.id]){t=false;q["#from_"+r.source.id+"_to_"+r.target.id]=true}else{t=true}}if(k.Engine.name==="ie"){this.parentNode.insertBefore(this,this)}v.attr("d",function(y){var x=p._layoutUtils.getPathCoordinates(y,l.select(this),p.getElement("#from_"+y.target.id+"_to_"+y.source.id),t,l.select(this.parentNode));return x});if(t===true){u.attr("dy",-35)}u.attr("transform",function(x){return p._layoutUtils.rotateTextLabel(x,t)})});q=null},nodeClicked:function(p){if(this.isPathPanel()){if(!p.isCount){this.dispatchEvent("ENORIPE_HandlePathPanel",[p.id])}return}if(l.event.srcElement){if(l.event.srcElement.className.baseVal==="multiSel-mapView-icon"){return}}else{if(l.event.target){if(l.event.target.className.baseVal==="multiSel-mapView-icon"){return}}}if(this.isChrome()){if(!(l.event.srcElement.hasClassName("drag-icon"))){if(!(l.event.detail&&l.event.detail.isCustom==="true")){return}}}if(l.event.defaultPrevented&&this.nodeMousePressTime>100){return}if(l.event.stopPropagation){l.event.stopPropagation()}var n=false;if(l.event.detail&&l.event.detail.ctrlKey){n=l.event.detail.ctrlKey}else{n=l.event.ctrlKey}if(n){var m=this._updateMultiSelState(p);this.dispatchEvent("ENORIPE_MultiSel_Object",[p.id,m,"MapView"]);this.dispatchEvent("ENORIPE_SetInfoPanelObject",[p.id,m]);return}var o=this.getElement("#container-"+p.id);if(!p.isCount){l.select(o).classed("is-loading",true)}this.resetLinksOpacity();this.dispatchEvent("onNodeClicked",[p.id])},isPathPanel:function(){var m=document.getElementsByClassName("ComputePath_Command");if(m.length>0){return m[0].hasClassName("pressed")}else{return false}},layoutingOff:function(){l.selectAll(".node .drag-icon").style("display","");this.NodeCreator.layoutingOn=false},layoutingOn:function(){l.selectAll(".node .drag-icon").style("display","none");this.NodeCreator.layoutingOn=true},nodeRightClicked:function(m){l.event.stopPropagation();l.event.preventDefault();this.resetLinksOpacity();this.dispatchEvent("onNodeRightClicked",[{id:m.id}])},updateFocusClasses:function(n,m){if(n&&n.length){this.nodesContainer.select("#container-"+n).classed({focus:false})}this.nodesContainer.select("#container-"+m).classed({focus:true});this.svgRootG.selectAll(".link").classed("focus",function(p){var o=(p.source.focus||p.target.focus);l.select(this).select("path").attr("marker-end",(o?"url(#node-arrow-focus)":"url(#node-arrow)"));return o})},highlightSearchedNodes:function(m){if(m){if(d.getThumbnailsMode()===false){l.selectAll(m).select(".node-text").classed("searchTextColorReset",true);l.selectAll(m).selectAll(".thumbnail-background").classed("searchMatched",true)}else{l.selectAll(m).select(".node-text").classed("searchTextColorReset",true);l.selectAll(m).selectAll(".small-rect").filter(":not(.first)").classed("searchMatched",true)}}},_centerTheGraph:function(B){var n=this.getBounds(),m=n.windowHeight,s=n.windowWidth,w=(m+B.actionBarHt)/2,y=(s-B.sidePanelWidth)/2,t=n.left+(n.width)/2,q=n.top+(n.height)/2,A=l.transform(l.select("g").attr("transform")),v=A.scale[0],u=A.translate[0],r=A.translate[1],p=y-t,o=w-q,z=u+p,x=r+o;this.zoomListener.translate([z,x]).scale(v);this._redraw(true)},getBounds:function(){var r=/(msie|trident)/i.test(navigator.userAgent),u=l.select("g").node().getBoundingClientRect(),A=l.select(".node").node().getBoundingClientRect();var n={};if(r){var o=this.getElements(".node");var w=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,m=Number.NEGATIVE_INFINITY;for(var v=0;v<o.length;v++){var t=o[v].getOffsets();s=Math.min(s,t.x);y=Math.max(y,t.x);w=Math.min(w,t.y);m=Math.max(m,t.y)}var x=A.width,q=A.height;y=y+x;m=m+q;var z=m-w,p=y-s;n.left=s;n.top=w;n.right=y;n.bottom=m;n.windowWidth=window.innerWidth;n.windowHeight=window.innerHeight;n.width=p;n.height=z;n.nodeWidth=x;n.nodeHeight=q}else{n.left=u.left;n.top=u.top;n.right=u.right;n.bottom=u.bottom;n.windowWidth=window.innerWidth;n.windowHeight=window.innerHeight;n.width=u.width;n.height=u.height;n.nodeWidth=A.width;n.nodeHeight=A.height}return n},_isTouchDevice:function(){var m=false;if(k.Platform.ios||k.Platform.android||k.Platform.tablet||k.Platform.blackberry){m=true}return m},isChrome:function(){var m=false;if(h.Utils.Client.Engine.name==="chrome"){m=true}return m},destroy:function(){this._parent();this.container=null}});return e});define("DS/SNNavigationMap/views/NavigationApp",["UWA/Core","UWA/Class/View","DS/RuntimeView/NLSManager","DS/UIKIT/Spinner","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SplittedDropView","DS/UIKIT/Native/Dropdown","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/views/SNMapSelector","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/Popover","DS/SNNavigationMap/views/D3MapView","DS/SNNavigationMap/views/ChordLayoutView","DS/SNNavigationMap/views/ListView","DS/SNNavigationMap/views/ToolBarView","DS/SNNavigationMap/views/NavigationPager","DS/UIKIT/SuperModal","css!DS/SNNavigationMap/SNNavigationMap"],function(a,p,l,h,g,e,k,d,q,s,n,c,j,v,r,i,f,b,o,u,m){var t=p.extend({name:"navigation-app-view",rootModel:null,_setFocusToLastExtracted:"",_isFiltered:false,_isSearched:false,_currentlyFilteredNodes:[],_isCoachMarkedTagger:false,_isCoachMarkedSearched:false,_isEmpty:true,_needFitAllInOnRender:false,_publications:{},_isWebInWin:s.isWebInWin(),_theContextualMenu:null,_theContextualMenuTarget:"",_loadingClassToRemove:[],_infoPanelCommandClick:false,_hideComboDone:false,className:function(){return this.getClassNames("-container")},setup:function(w){this._autoNavMode=w.autoNavMode;this._layoutUtils=w.layoutUtils;this._countLimit=w.countLimit;this._lang=w.lang;this._isEmpty=w.isEmpty;this._widgetId=w.widgetId;this._platformId=w.platformId;this._lastAnchorID=w.lastAnchorID;this._debug=w.debugMode||false;this._errorOnParseCompassData=w.errorOnParseCompassData||false;this._addinMode=w.addinMode;this._separator=w.separator;this._nameLabel=w.nameLabel;this._detailLabel1=w.detailLabel1;this._detailLabel2=w.detailLabel2;this._showChordView=w.chordViewEnabled||false;if(this._addinMode==="catiav5"||this._addinMode==="solidworks"){this.container.addClassName("addin-mode-ripe")}if(this.collection){this.listenTo(this.collection,"onSync",this.render)}if(this._errorOnParseCompassData){this._showNotif({level:"error",msg:k.get("ErrorCompassData")});this._errorOnParseCompassData=false}this._spinner=new h().inject(a.createElement("div",{styles:{position:"absolute"}}).inject(this.container,"top")).show();this._notifManager=g;e.setNotificationManager(this._notifManager);if(this._errorOnParseCompassData){this._showNotif({level:"error",msg:k.get("ErrorCompassData")})}this._initialize()},_initialize:function(){var w=this;this.setContainerEvents();this._dropInvite=a.createElement("div",{"class":"drop-invite",html:[{tag:"span","class":"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-drag-drop"},{tag:"h5","class":"font-3dsregular",html:k.get("dropHere")}]}).inject(this.container).hide();this._dropZone=new d().inject(this.container);this.listenTo(this._dropZone,"ENORIPE_drop",this._handleDrop);this.listenTo(this._dropZone,"ENORIPE_dropNotSupported",function(){w._showNotif({level:"error",msg:k.get("dropNotSupported")})});this.listenTo(this._dropZone,"ENORIPE_SDV_hide",this.setContainerEvents);window.addEventListener("keyup",this._onKeyUp.bind(this));if(this._isEmpty){this._initEmptyMap()}else{this._initSubViews()}},_loadSubViews:function(){require(["DS/SNNavigationMap/views/D3MapView","DS/SNNavigationMap/views/ListView","DS/SNNavigationMap/views/ToolBarView","DS/SNNavigationMap/views/ChordLayoutView"],this._initSubViews.bind(this))},_initSubViews:function(){var y=this.collection.getFocusedNode();var w=this;if(!this.mapView){this.mapView=new i({layoutUtils:this._layoutUtils,layoutAxis:this._layoutAxis,layoutDirection:this._layoutDirection,countLimit:this._countLimit,nameLabel:this._nameLabel,separator:this._separator,selector:n,dropZone:this._dropZone});if(this._showChordView){}this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth);this.listenTo(this.mapView,"onNodeClicked",this.nodeClicked);this.listenTo(this.mapView,"onNodeRightClicked",this._OnRightClick);this.listenTo(this.mapView,"ENORIPE_splitCount",this.splitCount);this.listenTo(this.mapView,"ENORIPE_dragEnd",this._hideDropZones);this.listenTo(this.mapView,"ENORIPE_showNotif",this._showNotif);this.listenTo(this.mapView,"ENORIPE_MultiSel_Object",this._onObjectToMultiSel);this.listenTo(this.mapView,"ENORIPE_ReorderColumn",this._reorderColumn);this.listenTo(this.mapView,"ENORIPE_downloadDocument",this._handleDownload);this.listenTo(this.mapView,"ENORIPE_clearSelection",this.clearSelectionFromCmd);this.listenTo(this.mapView,"ENORIPE_Drop",this._handleDrop);this.listenTo(this.mapView,"ENORIPE_clickInstance",this._clickInstance);this.listenTo(this.mapView,"ENORIPE_HandlePathPanel",function(A){if(A){var z=w.collection.get(A);if(z){w.pathPanel.addNodes(z)}}});this.listenTo(this.mapView,"ENORIPE_SetInfoPanelObject",function(B,A){if(B){if(A==="add"){var z=w.collection.get(B);if(z){w.setInfoPanelObject(z)}}else{w.manageProperties()}}});this.listenTo(this.mapView,"removefocus",function(A){if(A){var z=w.collection.get(A);if(z){z.set("focus",false)}}});this.mapView.inject(this.container);if(this._showChordView){}}if(!this.listView){this.listView=new b({model:y,spinner:this._spinner,fireEventOnSlide:true,widgetId:this._widgetId,debugMode:this._debug,nameLabel:this._nameLabel,separator:this._separator,detailLabel1:this._detailLabel1,detailLabel2:this._detailLabel2,isWebInWin:this._isWebInWin,dropZone:this._dropZone});this.listenTo(this.listView,"ENORIPE_dragEnd",this._hideDropZones);this.listenTo(this.listView,"ENORIPE_MultiSel_Object",this._onObjectToMultiSel);this.listenTo(this.listView,"ENORIPE_listUpdated",this._listViewUpdated);this.listenTo(this.listView,"ENORIPE_checkCountNode",this.checkNodeForListView);this.listenTo(this.listView,"ENORIPE_getRelNameForCount",this.updateTitleForCountsListView);this.listenTo(this.listView,"ENORIPE_handleErrorMsgs",this.handleServerErrorMsgs);this.listenTo(this.listView,"ENORIPE_ListViewResize",this._updateDropZonesHeight);this.listenTo(this.listView,"ENORIPE_RefreshDone",this.showRefreshMsg);this.listenTo(this.listView,"ENORIPE_MultiSelOn",function(){var z=this._toolBarView.getCommand("Info_Command");if(z){z.removeClassName("pressed");this.listView._propCommandClicked=false;if(!(z.hasClassName("disabled"))){z.addClassName("disabled")}}});this.listenTo(this.listView,"ENORIPE_SetOnCompass",function(z){n.updateSelection(z,"ListView")});this.listenTo(this.listView,"ENORIPE_drop",this._handleDrop);this.listenTo(this.listView,"ENORIPE_ListViewRender",function(){n._listViewSelected={}});this.listView.inject(this.container.parentElement)}if(!this._toolBarView){this.setUpToolBar(o)}else{this._toolBarView.toolBar.show()}var x={ctx:this,collection:this.collection,platformId:this._platformId,widgetId:this._widgetId};n.initialize(x);if(this._setFirstFocusOnCompass===true){n.updateSelection(this.collection.getFocusedNode(),"MapView");this._setFirstFocusOnCompass=false}if(!this._isEmpty&&this._dropInvite){this._dropInvite.hide()}},_clickInstance:function(y){var w=this.collection.get(y),x=this.mapView.getElement("#container-"+y+" .instance-list-g");w.set("instancesExpanded",(w.get("instancesExpanded")?false:true));this.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"));if(x&&w.get("instancesExpanded")===true){x.show()}else{if(x){x.hide()}}},hideComboProfiles:function(){},showComboProfiles:function(){},setUpToolBar:function(w){var x=this;this.profileArray=[];this.dispatchEvent("ENORIPE_ProfileInfo");this._toolBarView=new w({renderTo:this.container.parentElement,lang:this._lang,addinMode:this._addinMode,showChordCommand:this._showChordView});this._toolBarView.render();if(this._autoNavMode===true&&this._hideComboDone!==true){this.hideComboProfiles();this._hideComboDone=true}this.listenTo(this._toolBarView,"ENORIPE_initMultiSelectionFromCommand",this.initMultiSelectionFromCmd);this.listenTo(this._toolBarView,"ENORIPE_stopMultiSelectionFromCommand",this.stopMultiSelectionFromCmd);this.listenTo(this._toolBarView,"ENORIPE_selectAllFromCommand",this.selectAllFromCmd);this.listenTo(this._toolBarView,"ENORIPE_clearSelectionFromCommand",this.clearSelectionFromCmd);this.listenTo(this._toolBarView,"ENORIPE_showLinearLayout",this.showLinearLayout);this.listenTo(this._toolBarView,"ENORIPE_showChordLayout",this.showChordLayout);this.listenTo(this._toolBarView,"ENORIPE_CustomizeCommandClick",this.customize);this.listenTo(this._toolBarView,"ENORIPE_CustomizeDisplayCommand",this.customizeDisplay);this.listenTo(this._toolBarView,"ENORIPE_InfoCommandClick",this.ActivateDeactivateInformationsPanel);this.listenTo(this._toolBarView,"ENORIPE_SearchCommandClick",this.searchMap);this.listenTo(this._toolBarView,"ENORIPE_PrintCommandClick",this.printMap);this.listenTo(this._toolBarView,"ENORIPE_ComputePathCommandClick",function(){if(!x.pathPanel||x.pathPanel.container.isHidden()){var y=this._toolBarView.getCommand("ComputePath_Command");if(y){y.addClassName("pressed");x.computePaths()}}else{x.pathPanel._close()}});this.listenTo(this._toolBarView,"ENORIPE_FitAllCommandClick",this.fitAllInMap);this.listenTo(this._toolBarView,"ENORIPE_ClearMapCommandClick",this.clearMapClick);this.listenTo(this._toolBarView,"ENORIPE_RefreshMapCommandClick",this.refreshMapCmd);this.listenTo(this._toolBarView,"ENORIPE_OpenCommandClick",this.openCAD);this.listenTo(this._toolBarView,"ENORIPE_RemoveSelectedCommand",this.removeSelectedNodes);this.listenTo(this._toolBarView,"ENORIPE_RemoveNotSelectedCommand",this.removeNotSelectedNodes);this.listenTo(this._toolBarView,"ENORIPE_RemoveFilteredCommand",this.removeFadedNodes);this.listenTo(this._toolBarView,"ENORIPE_EditLayoutCommandClick",this.editLayout)},openCAD:function(){c.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:n.buildSelectionForNativeApps()}))},_handleDownload:function(y,x){var w=this;if(!this.fileUtils){require(["DS/SNNavigationMap/utils/MapFileUtils"],function(z){w.fileUtils=new z({spinner:w._spinner,notifManager:w._notifManager});w.fileUtils.handleDownload(y,x)})}else{this.fileUtils.handleDownload(y,x)}},getCurrentRelations:function(){return this._currentRelations},showChordLayout:function(){this.listView.hidePanel();this.mapView.container.hide();this._toolBarView.disableIconsForChord();if(!this.chordView){this.chordView=new f({})}this.chordView.render(this.collection.getLinksAndNodes(false)).inject(this.container);this.isChordLayout=true},showLinearLayout:function(){this.listView.showPanel();this.mapView.container.show();this.chordView.clear();this.isChordLayout=false;this._toolBarView.enableIconsForMapView()},setContainerEvents:function(){var w=this;this.container.addEventListener("dragenter",this.onDragEnter.bind(this));this.container.addEventListener("mousedown",function(){w.containerMouseDownTime=new Date()})},_onKeyUp:function(w){if(true===w.ctrlKey){w.stopPropagation();w.preventDefault();var x=w.keyCode||w.which;var y=String.fromCharCode(x);if("a"===y||"A"===y){this.selectAllFromCmd()}}},initMultiSelectionFromCmdIfMultiSelIsActivated:function(){if(n.isMultiSelActivated()){n.initMultiSel(true)}},_handleDrop:function(x,y){this._spinner.show();this._doContinueSearch();var z=(x==="extract")?y.id:null,w=(y.data&&a.is(y.data.items[0].objectId))?y.data.items:null;this.dispatchEvent("ENORIPE_DropByMode",[x,w,z])},onDropFromWebInWin:function(w){var A=null;var z=w.action;var y=(w.objects&&a.is(w.objects))?JSON.parse(w.objects):null;var x=n.isMultiSelActivated();if(y){this._spinner.show();this.dispatchEvent("ENORIPE_DropByMode",[z,y,A,x])}else{this._showNotif({level:"warning",lvl:"warning",msg:k.get("InvalidSelection")})}},refreshMapCmd:function(){this.dispatchEvent("ENORIPE_refreshMapCMD",[{initWithNodes:[],setPreferencesAlreadyDone:true}]);this.refreshMsgPending=true},refresh:function(w){this._isEmpty=w.isEmpty;if(!w.isEmpty){this.collection=w.collection;this.listenTo(this.collection,"onSync",this.render);this._initSubViews()}else{this._spinner.hide()}},showRefreshMsg:function(){if(this.refreshMsgPending){this.refreshMsgPending=false;this._showNotif({level:"info",lvl:"primary",msg:k.get("RefreshDone")})}},_onRemove:function(){this._doContinueSearch()},removeSelectedNodes:function(){this._onRemove();var w=this.collection.where({focus:true});if(w.length>0){this._spinner.show();this.collection.removeSelectedNodes()}else{this._showNotif({level:"error",msg:k.get("RemoveWithoutSelection")})}},removeNotSelectedNodes:function(){this._onRemove();var x=this.collection.where({focus:true});var w=this.collection.where({modelType:"node"});if(x.length===w.length){return}else{this._spinner.show();this.collection.removeNotSelectedNodes()}},removeFadedNodes:function(){this._onRemove();var w=[];this.getElements(".highlighted").forEach(function(y){w.push(y.getAttribute("data-id"))});var x=this.collection.filter(function(y){if(y.get("modelType")==="node"){if(w.indexOf(y.id)===-1){return true}else{return false}}else{return false}});if(x.length>0){this._spinner.show();this.collection.removeFadedNodes(x)}},onDragEnter:function(x){x.stopPropagation();x.preventDefault();var w=(this.listView&&this.listView.container)?this.listView.getWidth():0;this._dropZone.show(parseFloat(this.container.getStyle("width").slice(0,-2))-w,this._isEmpty)},_manageFirstFocusAndAnchor:function(A){var x,w=(A.indexOf(this._lastAnchorID)>=0),z=this.collection;for(var y=0;y<A.length;y++){x=z.get(A[y]);x.set("focus",(w&&A[y]===this._lastAnchorID));x.set("isAnchor",(w&&A[y]===this._lastAnchorID));if(w&&A[y]===this._lastAnchorID&&this.mapView){this.mapView.addToMultiSel(A[y]);n.updateSelection(x,"MapView")}}if(!w){x=z.get(A[0]);x.set("isAnchor",true);x.set("focus",true);if(this.mapView){this.mapView.addToMultiSel(A[0])}n.updateSelection(x,"MapView")}this._setFirstFocusOnCompass=true;this._lastRootID=JSON.stringify(A);this.dispatchEvent("setLastRootNodeID",this._lastRootID);this.dispatchEvent("setLastAnchorID",z.findWhere({isAnchor:true}).get("id"))},onResize:function(){this._updateContainerDimensions();this._updateSVGContainer();this._updateDropZonesHeight();this._updateSearchBox();this._updateListView();if(this._toolBarView){this._toolBarView.resizeHandler()}if(this.pathPanel){this.pathPanel.updateDialogSizeOnResize()}this.dispatchEvent("ENORIPE_ResizeDialog")},_updateContainerDimensions:function(){var w=this.container.parentElement;if(w){w=(w.getDimensions)?w:a.extendElement(w);var x=w.getDimensions();var y=65;this.ctnWidth=x.width;this.ctnHeight=(!this._isWebInWin)?x.height:(window.innerHeight-y);this.container.setStyle("height",this.ctnHeight)}},_updateDropZonesHeight:function(){var w=(this.listView)?this.container.getDimensions().width-this.listView.getWidth():this.container.getDimensions().width;if(this._dropZone){this._dropZone.updateHeight(this.ctnHeight,w)}},_updateSVGContainer:function(){if(this.mapView){this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth)}},_updateSearchBox:function(){if(this._mapSearchView){var x="500";if(document.body.scrollHeight>40){x=document.body.scrollHeight}var w=(1-(82/x))*100;this._mapSearchView._modal.setStyle("top",w+"%")}},_updateListView:function(){if(this.listView){this.listView.resizeListView()}},_initEmptyMap:function(w){if(this._widgetStateAtInit==="maximized"&&!w&&!this._errorOnParseCompassData){this._showNotif({level:"error",msg:k.get("emptyMap")})}this._errorOnParseCompassData=false;this._spinner.hide();this._lastRootID="[]";if(this._isEmpty&&this._dropInvite){this._dropInvite.show()}},switchThumbnailsMode:function(w){if(w==="thumbnailsMode"){this.getElement(".d3-map-view-container").removeClassName("no-thumbnails");this.mapView._addMissingThumbnail(this.collection)}else{this.getElement(".d3-map-view-container").addClassName("no-thumbnails")}this.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"));this.mapView.updateNodesYposition(w);this.getElements(".foreign-object-count-mobile").forEach(function(x){x.setAttribute("y",(w==="thumbnailsMode")?95:35)});this.getElements(".colored-rect-bi").forEach(function(x){x.setAttribute("height",(w==="thumbnailsMode")?120:55)})},_reorderColumn:function(C,B,A){var y=this.collection.groupBy("columnID")[C.columnID],w={},x=function(E,D){return(E._attributes.rowID>D._attributes.rowID)?1:((D._attributes.rowID>E._attributes.rowID)?-1:0)};y.sort(x);y.splice(A,0,y.splice(C.rowID,1)[0]);for(var z=0;z<y.length;z++){y[z].set("rowID",z);w[y[z].get("id")]=z}this.dispatchEvent("ENORIPE_setSavedRowIds",["ENORIPE_savedRowIds",w]);this.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"))},render:function(B,z,y){var E=B.getLinksAndNodes(),F=JSON.parse(y.data),C=false;if(this._isSearched){if(this._continueSearch){var w=this._searchValue;if(w){this.dispatchEvent("ENORIPE_Search",w)}this._continueSearch=false}else{this.clearFilterBySearch()}}if(this._setFocusToLastExtracted){this.setFocus(B.get(this._setFocusToLastExtracted));B.getEcoSystem(this._setFocusToLastExtracted);this._setFocusToLastExtracted=""}else{if(this.listView){this.mapView.render(E,B.groupBy("columnID"));if(this._showChordView){}if(F.id){this.mapView.removeLoadingClass(F.id)}if(this._needFitAllInOnRender===true){this._needFitAllInOnRender=false}if(n.isMultiSelActivated()){var x=(F.id||F.ids[0]).split("_")[0];var A=this.collection.get(x);var G=B.where({focus:true});if(this.currentModelClicked&&G.indexOf(this.currentModelClicked)!==-1){this.listView.setModel(this.currentModelClicked)}else{if(G.indexOf(A)!==-1){this.listView.setModel(A)}else{if(this.listView._propCommandClicked){this.manageProperties()}else{this.listView.isLoading(false);this.listView.clearPanel();this.listView.hidePanel();C=true}}}}else{var D=B.findWhere({focus:true});if(D){this.listView.setModel(D)}else{C=true}}}else{C=true}}this._spinner.hide();if(C){this.showRefreshMsg()}return this},checkNodeForListView:function(y){for(var x=0;x<y.length;x++){var w=this.collection.get(y[x]);if(!w){this.listView.isCountNode[y[x]]=true}else{this.listView.isCountNode[y[x]]=false}}},ActivateDeactivateInformationsPanel:function(){var w=this._toolBarView.getCommand("Info_Command");if(w&&w.hasClassName("pressed")){w.removeClassName("pressed");if(!(this.listView.panel.content.hasClassName&&this.listView.panel.content.hasClassName("map-accordion"))){this.listView.slideOut();this.listView.hidePanel()}this.listView._propCommandClicked=false;var D=this.collection.where({focus:true});if(D.length>0){this.listView.render(this.listView.renderData)}return}else{this.listView._propCommandClicked=true}var z=this,C=[],E=this.listView,B=false;if(E&&E.tilesContent&&E.tilesContent.length>0){for(var A=0;A<E.tilesContent.length;A++){if(E.tilesContent[A].elements.checkbox.checkFlag){var y=E.models[E.tilesContent[A].elements.description.innerHTML];C.push(y);B=true;break}}}if(C.length===0){C=this.collection.where({focus:true})}if(!C||C.length===0){z.listView.hidePanel();if(this._toolBarView.getCommand("Info_Command").hasClassName("pressed")){this._toolBarView.getCommand("Info_Command").removeClassName("pressed")}this._showNotif({level:"error",msg:k.get("propertiesWithoutSelection")});return}var x=C[0];if(x.get("isCount")){this._showNotif({level:"error",msg:k.get("noCountForProperty")});return}this._toolBarView.toggleInfoCommand();if(z.listView._informationPanel===null){if(B){z.listView._initInformationsPanel(x)}else{z.listView._initInformationsPanel()}}else{if(z.listView._informationPanel!==null){z.listView.setInfomationPanelObject(x)}}},manageProperties:function(){var w=this.collection.where({focus:true});if(w&&w.length>0){this.setInfoPanelObject(w[0])}},setInfoPanelObject:function(w){if(w&&!w.get("isCount")&&this.listView._propCommandClicked){this.listView.setInfomationPanelObject(w)}},updateTitleForCountsListView:function(B,z){var A=this.collection;if(A&&this.listView.panel){var x=A.where({modelType:"link"});for(var y=0;y<x.length;y++){var w=x[y]._attributes;if(B===w.source.id||B===w.target.id){this.listView.panel.title=k.get(w.type)+" ("+z+")"}}}},_hideDropZones:function(){if(this._dropZone){this._dropZone.hide()}},splitCount:function(z){var y=this.collection,x=y.get(z),w;if(x){this._spinner.show();w=x.get("focus");y.splitCount(z);if(this.listView){this.listView.isFromSplitCount=true}if(w){this._setFocusToLastExtracted=z.split("_")[0]}this._needFitAllInOnRender=true;this._doContinueSearch()}},nodeClicked:function(x){var w=this.collection.get(x);if(w){if(w.get("isCount")){if(n.viewContext==="ListView"){n.viewContext="MapView";n.handleContextSwitch(true)}if(!n.isMultiSelActivated()){n._mapViewSelected={}}this.setFocus(w);this.listView.setModel(w);this.listView.isLoading(true);return}this.setFocus(w);this.currentModelClicked=w;if(n.isMultiSelActivated()){this._onObjectToMultiSel(x,this.mapView._updateMultiSelState({id:x}),"MapView")}else{n.updateSelection(w,"MapView")}this.collection.getEcoSystem(x);this._doContinueSearch();this.dispatchEvent("ENORIPE_AddNavigatedNode",[x]);this.dispatchEvent("ENORIPE_AddVisitedNode",[x]);this.dispatchEvent("setLastAnchorID",[x]);this.listView.isLoading(true)}},editLayout:function(){var w=this._toolBarView.getCommand("EditLayout_Command");if(w&&this.mapView){if(w.hasClassName("pressed")){w.removeClassName("pressed");this.mapView.layoutingOff()}else{w.addClassName("pressed");this.mapView.layoutingOn()}}},computePaths:function(){var w=this.collection.where({focus:true,isCount:undefined});if(a.is(this._mapSearchView)){this.clearMapSearchView()}if(!this.pathPanel){this._initPathPanel()}else{this.pathPanel.render(w)}},customize:function(){if(a.is(this._mapSearchView)){this.clearMapSearchView()}this.dispatchEvent("ENORIPE_Customize")},customizeDisplay:function(){if(a.is(this._mapSearchView)){this.clearMapSearchView()}this.dispatchEvent("ENORIPE_CustomizeDisplay")},searchMap:function(){if(!a.is(this.mapView)){return}if(!a.is(this._mapSearchView)){if(!this.searchPanelPosition){this.searchPanelPosition={x:0,y:0}}var w=this;require(["DS/SNNavigationMap/views/MapViewFind"],function(x){w._mapSearchView=new x({position:w.searchPanelPosition,renderTo:w.container});w.listenTo(w._mapSearchView,"ENORIPE_performSearch",w._performSearch);w.listenTo(w._mapSearchView,"ENORIPE_clearSearch",w.clearMapSearchView)})}else{this.clearMapSearchView()}},printMap:function(x){if(a.is(this._mapSearchView)){this.clearMapSearchView()}var w=this.getElements(".d3-map-view-container")[0].outerHTML;this.printHTML(w,x)},printHTML:function(x,w){if(typeof this.WindowObject!=="undefined"&&null!==this.WindowObject&&this.WindowObject.closed===false){this.WindowObject.close()}var y=this;var z=function(){y.WindowObject=window.open("","PrintWindow","width=1024,height=768,top=0,left=0,scrollbars=yes,status=no,resizable=yes");y.WindowObject.document.writeln("<!DOCTYPE html>");y.WindowObject.document.writeln("<html><head><title>Print_Me</title>");y.WindowObject.document.writeln('<style type="text/css" media = "all">');y.WindowObject.document.writeln(" @page {margin-top: 1cm; 	margin-left: 1cm;}");y.WindowObject.document.writeln(" #svg-root {overflow: visible; display: inline; zoom : 50%}");y.WindowObject.document.writeln(" #svg-root text {stroke: none; font-family: arial;}");y.WindowObject.document.writeln(".node { fill:#fff;}");y.WindowObject.document.writeln(".node .background { cursor: pointer; fill:#fff; stroke: #e2e4e3; stroke-width: 1px; width : 170px; height : 130px}");y.WindowObject.document.writeln(".node .thumbnail-background { fill: #d1d4d4; height : 130px;}");y.WindowObject.document.writeln(".node .small-rect{opacity: .8;}");y.WindowObject.document.writeln(".node.focus rect.background{stroke: #368ec4; stroke-width: 4px;}");y.WindowObject.document.writeln(".no-thumbnails .node .background{height : 65px;}");y.WindowObject.document.writeln(".no-thumbnails .node .thumbnail-image{ display: none;}");y.WindowObject.document.writeln(".no-thumbnails .node .small-rect { display: none;}");y.WindowObject.document.writeln(".no-thumbnails .node .thumbnail-background{height : 55px;}");y.WindowObject.document.writeln(".link.focus path{stroke: #368ec4;}");y.WindowObject.document.writeln(".link.focus text{ fill: #368ec4;}");y.WindowObject.document.writeln(".node.focus {stroke-width: 2px;}");y.WindowObject.document.writeln(".link, #node-arrow path { stroke: #77797c; fill: #77797c;}");y.WindowObject.document.writeln("#node-arrow-focus path {fill:#368ec4;}");y.WindowObject.document.writeln(".type-icon { margin: 5px 2px 2px;}");y.WindowObject.document.writeln(".html-content {width: 145px; font-size: .9em; height: 80px;}");y.WindowObject.document.writeln(".html-content p {margin: 0; height: 80px; word-break: break-all; color: #368ec4; margin-left: 5px; padding-right: 5px;}");y.WindowObject.document.writeln(".node-thumbnail {  float: left; height: 78px; width: 80px; }");y.WindowObject.document.writeln(".node-thumbnail img{max-width: 100%;}");y.WindowObject.document.writeln("p.count{ text-align: center; font-size: 2em; padding-top: 10px; color: #368ec4; }");y.WindowObject.document.writeln(".link textpath { font-weight: 100; }");y.WindowObject.document.writeln(".node-text { font-size: 14px; fill: #368ec4;}");y.WindowObject.document.writeln(".count-text { font-size: 22px;}");y.WindowObject.document.writeln(".Customize-container h3.customize-heading { font-size: 1.5em; color: #77797c; margin-top: 0;}");y.WindowObject.document.writeln(".links-faded .link:not(.highlighted) { opacity: .2;}");y.WindowObject.document.writeln(".links-faded .node:not(.highlighted) { opacity: .2;}");y.WindowObject.document.writeln(".faded {opacity: .2;}");y.WindowObject.document.writeln(".highlighted path {stroke-width: 2px;}");y.WindowObject.document.writeln(".ghost-rect {display: none;opacity: 0;}");y.WindowObject.document.writeln(".multiSel-mapView-icon,.hidden,.loader-icon {visibility: hidden;}");y.WindowObject.document.writeln(".synchroLink {stroke: #57B847 !important;  fill: #57B847 !important;}");y.WindowObject.document.writeln(".nonSynchroLink {stroke: #EA4F37 !important;  fill: #EA4F37 !important;}");y.WindowObject.document.writeln(".unknownSynchroLink {stroke: #FFA500 !important;  fill: #FFA500 !important;}");y.WindowObject.document.writeln(".synchroLink.link.focus path {stroke: #57B847 !important;}");y.WindowObject.document.writeln(".synchroLink.link.focus text {fill: #57B847 !important;}");y.WindowObject.document.writeln(".nonSynchroLink.link.focus path {stroke: #EA4F37 !important;}");y.WindowObject.document.writeln(".nonSynchroLink.link.focus text {fill: #EA4F37 !important;}");y.WindowObject.document.writeln(".unknownSynchroLink.link.focus path {stroke: #FFA500 !important;}");y.WindowObject.document.writeln(".unknownSynchroLink.link.focus text {fill: #FFA500 !important;}");y.WindowObject.document.writeln("</style></head><body>");y.WindowObject.document.writeln(x);y.WindowObject.document.writeln("</body></html>");y.WindowObject.document.close();y.WindowObject.focus();setTimeout(function(){if(w===true){y.WindowObject.close()}else{y.WindowObject.print()}y.WindowObject.close()},500)};setTimeout(z,0)},_saveForRefresh:function(w,x){this.dispatchEvent("ENORIPE_SaveForRefresh",[w,x])},fitAllInMap:function(){var w=0;if(this._toolBarView){w=this._toolBarView.offsetHeight||48}if(this.mapView){var x={sidePanelWidth:0,actionBarHt:w};x.sidePanelWidth=this.listView.getWidth();this.mapView.fitAllIn(x)}},initMultiSelectionFromCmd:function(){n.initMultiSel()},stopMultiSelectionFromCmd:function(){n.endMultiSel();if(this._toolBarView){var w=this._toolBarView.getCommand("Info_Command");if(w&&w.hasClassName("disabled")){w.removeClassName("disabled")}}},clearSelectionFromCmd:function(w){if(w){n.viewContext=w}n.clearMultiSel(1)},selectAllFromCmd:function(){var w=this,z=[],y=this.mapView.getFilteredNodes(),x=this._isFiltered||this._isSearched;if(!n.isMultiSelActivated()){this.initMultiSelectionFromCmd()}if(n.viewContext==="MapView"){this.collection.where({modelType:"node"}).forEach(function(B){var A=B.get("isCount");if(true!==A){if(!x){z.push(B)}else{if(y.indexOf(B.get("id"))>-1){z.push(B)}}}})}else{if(this.listView){z=this.listView.getModels()}}if(z.length){n.onObjectToMultiSel(z,"add")}},_onObjectToMultiSel:function(A,w,x){if(A){var y=typeof(A)==="string"?this.collection.get(A):A,z=false;if(x&&n.viewContext!==""){z=(x===n.viewContext)?false:true}if(x==="MapView"){n.viewContext="MapView"}else{if(x==="ListView"){n.viewContext="ListView"}}n.onObjectToMultiSel(y,w,z)}},updateFeedbackForRemove:function(w){if(n.isMultiSelActivated()&&w&&w.length>0){n.updateFeedBack(w)}},addLoader:function(){v.mask(this.container)},removeLoader:function(w){v.unmask(this.container)},_listViewUpdated:function(w){this._refreshMultiSel(w);this.dispatchEvent("ENORIPE_updateProxy")},_refreshMultiSel:function(x){var w=this.collection.get(x)||null;if(n.isMultiSelActivated()&&w!==null&&!w.get("isCount")){n.refreshView();n._listViewSelected={}}},_initPathPanel:function(){var w=this;require(["DS/SNNavigationMap/views/PathPanelView"],function(y){var x={offsetX:0,offsetY:24,dialogWidth:520,dialogHeight:600};w.pathPanel=new y({spinner:w._spinner,widgetId:w._widgetId,debugMode:w._debug,position:x,addinMode:w._addinMode});w.listenTo(w.pathPanel,"ENORIPE_dragEnd",w._hideDropZones);w.listenTo(w.pathPanel,"ENORIPE_handleErrorMsgs",w.handleServerErrorMsgs);w.listenTo(w.pathPanel,"ENORIPE_ComputePath",w.computePaths);w.listenTo(w.pathPanel,"ENORIPE_SetPathOnCompass",function(z){if(n){n._syncPathToCompass(z)}});w.pathPanel.inject(w.container,"top");w.pathPanel.addEvent("PathPanelViewRender",function(){w._spinner.hide()}.bind(w));w.pathPanel.addEvent("PathPanelViewClose",function(){w._toolBarView.getCommand("ComputePath_Command").removeClassName("pressed")}.bind(w));w.pathPanel.addEvent("noPathsFound",function(z){w._showNotif({level:"error",msg:k.replace(k.get("noPathsFound"),{anchor:z.anchor,selected:z.selected})})}.bind(w));w.pathPanel.render(w.collection.where({focus:true,isCount:undefined}))})},filter:function(x){var w=this,y=Object.keys(x.allfilters).length>0;if(y===false){if(typeof x.volatileFilters!=="undefined"){}}if(y){if(this._isCoachMarkedTagger===false){this._isCoachMarkedTagger=true;this._showCoachMark()}}if(y){if(n.isMultiSelActivated()){this.collection.where({focus:true}).forEach(function(A){var z=A.get("id");if(x.filteredPathIDList.indexOf(z)===-1){A.set("focus",false);w.mapView.removeFromMultiSel(z)}})}this._isFiltered=true;if(x.isVolatileData){this._currentlyFilteredNodes=x.filteredPathIDList;this.mapView.filterByFadingVolatile(x);if(this.isChordLayout){this.chordView.filterByFadingVolatile(x)}if(this.listView&&!(x.isLoopData)){this.listView.filterByFadingAndReordering(x.filteredPathIDList)}return}this._currentlyFilteredNodes=x.filteredPathIDList;this.mapView.filterByFading(x.filteredPathIDList);if(this.isChordLayout){this.chordView.filterByFading(x.filteredPathIDList)}if(this.listView){this.listView.filterByFadingAndReordering(x.filteredPathIDList)}}else{this._isFiltered=false;this._currentlyFilteredNodes=[];if(this._isSearched){this.mapView.filterByFading(this._currentlySearchedNodes)}else{this.mapView._filteredOpacity=false;this.mapView.resetLinksOpacity();this.listView.resetFilter()}if(this.isChordLayout){this.chordView._filteredOpacity=false;this.chordView.resetLinksOpacity()}}},colorize:function(x,w){this.unColorize();this.mapView.colorize(x);if(!w){this.listView.colorize(x)}if(this.isChordLayout){this.chordView.colorize(x)}},filterBySearch:function(x){if(this._isCoachMarkedSearched===false){this._isCoachMarkedSearched=true;this._showCoachMark()}this._isSearched=true;this._currentlySearchedNodes=x;var w=a.clone(x);w=this._getIdsSortedByColumn(w);this._onPager({result:w});this.collection.filter(function(y){if(y.get("modelType")==="node"&&y.get("isCount")){x.push(y.get("id"))}});this.mapView.filterByFading(x);if(w.length===0){this._showNotif({level:"error",msg:k.get("No-SearchMatch")})}},_getIdsSortedByColumn:function(A){var z=this.collection.sortBy("columnID");var w=[];var B="";for(var y=0;y<z.length;y++){if(z[y]._attributes.modelType==="link"){continue}B=z[y]._attributes.id;for(var x=0;x<A.length;x++){if(B===A[x]){w.push(A[x]);break}}}return w},clearFilterBySearch:function(){if(this._isFiltered){this.mapView.clearOnlySearchResults(this._currentlyFilteredNodes)}else{this.mapView._filteredOpacity=false;this.mapView.resetLinksOpacity()}this._isSearched=false;this._continueSearch=false;this._currentlySearchedNodes=[];if(this._pager){this._pager.closePager()}},_doContinueSearch:function(){if(!this._isWebInWin){if(this._isSearched){this._continueSearch=true}else{this._continueSearch=false}}},unColorize:function(){this.getElements(".colored-rect-bi").forEach(function(w){w.remove()});this.mapView.unColorizeSynchro();this.mapView.uncolorizeRelations();this.getElements(".synchroLink").forEach(function(w){w.removeClassName("synchroLink")});this.getElements(".nonSynchroLink").forEach(function(w){w.removeClassName("nonSynchroLink")});this.getElements(".unknownSynchroLink").forEach(function(w){w.removeClassName("unknownSynchroLink")});if(this.listView){this.listView.unColorize()}if(this.isChordLayout){this.chordView.unColorize()}},colorizeSynchro:function(w){this.unColorize();this.mapView.colorizeSynchro(w);if(this.listView){this.listView.colorize(w.colorizedNodes)}if(this.isChordLayout){this.chordView.colorizeSynchro(w)}},colorizeRelations:function(w){this.unColorize();this.mapView.colorizeRelations(w);if(this.listView){this.listView.colorize(w.colorizedNodes)}if(this.isChordLayout){this.chordView.colorizeRelations(w)}},_showCoachMark:function(){var x=this;var w=new UWA.Element("div",{"class":"wux-control-inline-container removecoachmark-container"}),z=a.createElement("div",{"class":"removeCoachMark-closecontainer",events:{click:function(){y.hide()}}}).inject(w);a.createElement("span",{"class":"fonticon fonticon-close"}).inject(z);a.createElement("div",{"class":"removeCoachMark-bodytext",html:k.get("RemoveCoachMark-Text")}).inject(w);var y=new r({target:x._toolBarView.getCommand("Remove_Command"),trigger:"click touch",autoHide:false,position:"bottom",body:w,offset:{x:0,y:-5},events:{onHide:function(){y.destroy()}}}).show()},_onPager:function(w){if(!this._pager){this._pager=new u({debugMode:this._debug});this.listenTo(this._pager,"ENORIPE_NavPagerClose",this.clearFilterBySearch);this.listenTo(this._pager,"ENORIPE_HighlightNode",this._highlightNodeByPager);this._pager.inject(this.container)}if(this._continueSearch){w.noChangeFocus=true}this._pager.render(w)},_highlightNodeByPager:function(x){if(x==="All"){this.selectAllFromCmd()}else{if(n.isMultiSelActivated()){n.endMultiSel()}var w=this.collection.get(x);this.setFocus(w)}},_buildContentForPopover:function(){var x=this,w=new UWA.Element("div",{"class":"wux-control-inline-container removecoachmark-container"}),y=a.createElement("div",{"class":"removeCoachMark-closecontainer",events:{click:function(){}}}).inject(w);a.createElement("span",{"class":"fonticon fonticon-close"}).inject(y);a.createElement("div",{"class":"removeCoachMark-bodytext",html:k.get("RemoveCoachMark-Text")}).inject(w)},setFocus:function(y){if(!n.isMultiSelActivated()){var x=this.collection.findWhere({focus:true,modelType:"node"}),A=[];if(y===x){return}y.set("focus",true);var w=y.get("modelType");if(w==="node"&&!y.get("isCount")){s.sendToMapWebInWin("onObjectSelected",y.id)}var z=y.get("id");var B="";if(x){B=x.get("id");x.set("focus",false);this.mapView.removeFromMultiSel(B);this.listView.removeFromMultiSel(B)}this.mapView.updateFocusClasses(B,z,A);this.mapView.addToMultiSel(z);this.listView.addToMultiSel(z)}},_OnRightClick:function(y){if(this._isWebInWin){var x=this.collection.get(y.id);this._theContextualMenuTarget=y.id;if(n.isMultiSelActivated()){if(!n.isSelected(y.id)){this.stopMultiSelectionFromCmd();this.setFocus(x)}}else{this.setFocus(x)}if(a.is(x)&&this._isWebInWin){if(a.is(this._theContextualMenu)){this._theContextualMenu.destroy()}var w=n.getSelectedIDs();if(0===w.length){w=[y.id]}s.sendToMapWebInWin("onComputeCtxMenu",w)}}},_onCtxMenuItem:function(x){if(this._isWebInWin){var w=n.getSelectedIDs();s.sendToMapWebInWin("onCtxMenuClick",w,x.action)}},SetContextualMenu:function(z){if(this._isWebInWin){var C;var x=n.getSelectedIDs();x=(x.length)?x:[this._theContextualMenuTarget];C=s.ComputeContextualMenu(this,z);if(a.is(C)&&C.length){var B=this._theContextualMenuTarget;var A=this.getElement("#container-"+B);var y=this;if(this.collection.get(B)&&this.collection.get(B).get("isCount")){var w={id:B,text:k.get("splitCount"),icon:"I_ExplodeOnSegments",handler:y.mapView.splitAction.bind(y.mapView,B)};C.push(w)}this._theContextualMenu=new q({isContextual:true,target:A,items:C});this._theContextualMenu.show();this._theContextualMenuTarget=""}}},handleServerErrorMsgs:function(w){if(w){if(w.type==="timeout"){w.level="error";w.msg=k.get("timeout")}else{if(w.type==="internalServerError"){w.level="error";w.msg=k.get("internalServerError")}else{w.level="error";w.msg=k.get("generic")}}}if(this._spinner){this._spinner.hide()}this._showNotif(w)},_showNotif:function(w){if(s.isWebInWin()){if(this.alert){this.alert.destroy()}this.alert=new j({visible:true,autoHide:true,hideDelay:3000,animate:true}).inject(this.container);this.alert.add({messageClassName:w.lvl?w.lvl:"error",message:w.msg});this.alert.elements.container.setStyle("top","80px");return}this._notifManager.addNotif({level:w.level,message:w.msg,sticky:false})},clearMapClick:function(){var y=this,x=new m({renderTo:y.container}),z=k.get("ClearConfirmHeader"),w=k.get("ClearConfirmBody");x.confirm(w,z,function(A){if(A){y.dispatchEvent("ENORIPE_ClearMapClick")}})},clearMapFailure:function(){this._notifManager.addNotif({level:"info",message:k.get("clearView_failure"),sticky:false})},clearMapSuccess:function(){this._isEmpty=true;if(this._toolBarView){this._toolBarView.destroy();this._toolBarView=null}if(this.listView._informationPanel){this.listView._propCommandClicked=false}if(n){n.handleClearMap()}if(n.isMultiSelActivated()){this.stopMultiSelectionFromCmd()}this.collection=null;if(a.is(this.mapView)){this.mapView.destroy();this.mapView=null}if(a.is(this.listView)){this.listView.hidePanel();this.listView.clearPanel()}if(a.is(this.pathPanel)){this.pathPanel._close()}if(this._mapSearchView){this.clearMapSearchView();this.searchPanelPosition={x:0,y:0}}if(a.is(this._pager)){this._pager.destroy();this._pager=null}this._lastRootID="[]";this._initEmptyMap(true)},destroy:function(){this.stopListening(this.collection);this.stopListening(this.mapView);this.stopListening(this.listView);this.stopListening(this._dropZone);this.stopListening(this.pathPanel);this.stopListening(this._mapSearchView);this.collection=null;this.container=null;this._parent()},clearMapSearchView:function(){if(a.is(this._mapSearchView)){this._mapSearchView._clearSearch();this.searchPanelPosition={x:this._mapSearchView.searchPanel.position.offsetX,y:this._mapSearchView.searchPanel.position.offsetY};this._mapSearchView.searchPanel.destroy();this._mapSearchView.panelContainer.remove();this._mapSearchView=null}},_performSearch:function(w,B){w=w.replace(/[\[\]\/\{\}\(\)\*\+\?\\\^\$\|]/g,"\\$&");var I,H=false;this._mapSearchView._matchedNodes=[];if((B.isMatchCase===false)&&(B.isWholeWord===false)){I=new RegExp(w,"i")}else{if((B.isMatchCase===true)&&(B.isWholeWord===false)){I=new RegExp(w)}else{if((B.isMatchCase===false)&&(B.isWholeWord===true)){I=new RegExp("\\b"+w+"\\b","i");H=true}else{if((B.isMatchCase===true)&&(B.isWholeWord===true)){I=new RegExp("\\b"+w+"\\b");H=true}}}}var D=this.mapView.getElements("#all-nodes")[0].childNodes;var y=this.collection.sortBy("columnID");var E=[];var x="";for(var A=0;A<y.length;A++){if(y[A]._attributes.modelType==="link"){continue}x=y[A]._attributes.id;for(var z=0;z<D.length;z++){if(x===D[z].id.substring(10)){E.push(D[z]);break}}}var K="";for(var A=0;A<E.length;A++){var J=E[A].childNodes;for(var z=0;z<J.length;z++){if(J[z].tagName==="title"){K=J[z].textContent;break}}if(H){var G=K.split(" "),F="";for(var C=0;C<=G.length;C++){if(F.length>0){F=F+" "+G[C]}else{F=G[C]}if(w&&I.test(G[C])&&G[C].length===w.length){this._mapSearchView._matchedNodes.push(E[A]);break}if(w&&I.test(F)&&F.length===w.length){this._mapSearchView._matchedNodes.push(E[A]);break}}}else{if(w&&I.test(K)){this._mapSearchView._matchedNodes.push(E[A])}}}if(this._mapSearchView._matchedNodes.length>0){this.mapView.highlightSearchedNodes(this._mapSearchView._matchedNodes)}}});return t});define("DS/SNNavigationMap/ENORIPE",["UWA/Class","UWA/Core","UWA/Promise","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/views/NavigationApp","DS/SNNavigationMap/collections/NavigationCollection","DS/SNNavigationMap/utils/SNNavigationServices","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/utils/LayoutUtils","DS/SNNavigationMap/utils/SearchUtils","DS/UIKIT/Modal","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DEC","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Design","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Manufacturing","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Customer","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Simulation","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DBM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Knowledgeware","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Material","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_GEBOM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ReviewInterference","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SimulationProcess","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ECM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DPM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AER"],function(y,c,h,r,n,i,l,v,u,b,d,f,m,w,g,z,p,j,o,s,t,q,e,a,B,x,k){var A=y.extend({_navigatedNodes:[],_currentRelations:[],_publications:{},_groupedRelations:{},_activeProfiles:[],comboBoxProfiles:[],currentProfile:"",_availableRelations:[],_visitedNodes:[],lastSavedValues:{},synchroAllowed:false,_tempPreferences:{},resProfile:"",_isWebInWin:v.isWebInWin(),init:function(C){var D=this;c.merge(m,w);c.merge(m,g);c.merge(m,z);c.merge(m,p);c.merge(m,j);c.merge(m,o);c.merge(m,s);c.merge(m,t);c.merge(m,q);c.merge(m,e);c.merge(m,a);c.merge(m,B);c.merge(m,x);c.merge(m,k);this._widget=C.widget||null;this._populateTags=(C.populateTags==="true"||C.populateTags===true)?true:false;this.container=C.renderTo||null;this._navigatedNodes=this._getWidgetValue("ENORIPE_navigatedNodes");this._addinMode=this._getWidgetValue("addinmode");this._errorOnParseCompassData=C.errorOnParseCompassData||false;if(this._isWebInWin){this.container=c.extendElement(this.container)}this._PM=new r({debugMode:(n.getOption("debug_me")==="1")});if(this._widget){this._widgetId=(this._widget&&this._widget.id?this._widget.id:undefined);this._widgetStateAtInit=(this._widget.getView)?this._widget.getView().type:"";this._lastAnchorID=this._widget.getValue("lastAnchorID")||""}if(this._getValuesForProfile("LastUsedProfile")&&this._getValuesForProfile("LastUsedProfile")==="AutoModeProfile"){this._autoNavMode=true}if(!this._getValuesForProfile("LastUsedProfile")){this._autoNavMode=true}if(C.initWithTenant){n.setCurrentTenant(C.initWithTenant)}n.appInitializationPromised(C.mapSettings).then(function(){D._getPatterns().then(D._parsePatterns.bind(D)).then(D._getProfiles.bind(D)).then(D._parseRelations.bind(D)).then(D._setPreferences.bind(D)).then(function(){D._initCollection(C)})});n.setLang(C.lang);n.setLayoutMode(D._getValuesForRefresh("recompute-cb"));n.setThumbnailsMode(D._getValuesForRefresh("thumbnails2d-cb"));this._layoutUtils=new b({layoutAxis:n.getLayoutAxis(),layoutDirection:n.getLayoutDirection()})},_createFilterProxy:function(){if(this._filterProxy){return}this._summariesForVolatileTags=[{count:-1,dispValue:m.get("Synchronized"),object:"Synchronized",sixw:"ds6w:what/"+m.get("SynchronizationStatusPredicate"),type:"string",value:"Synchronized"},{count:-1,dispValue:m.get("NotSynchronized"),object:"NotSynchronized",sixw:"ds6w:what/"+m.get("SynchronizationStatusPredicate"),type:"string",value:"NotSynchronized"},{count:-1,dispValue:m.get("Unknown"),object:"Unknown",sixw:"ds6w:what/"+m.get("SynchronizationStatusPredicate"),type:"string",value:"Unknown"},{count:-1,dispValue:m.get("In"),object:"In",sixw:"ds6w:what/"+m.get("LoopsPredicate"),type:"string",value:"In"},{count:-1,dispValue:m.get("Out"),object:"Out",sixw:"ds6w:what/"+m.get("LoopsPredicate"),type:"string",value:"Out"},{count:-1,dispValue:m.get("Yes"),object:"Yes",sixw:"ds6w:what/"+m.get("IsLastVersionPredicate"),type:"string",value:"Yes"},{count:-1,dispValue:m.get("No"),object:"No",sixw:"ds6w:what/"+m.get("IsLastVersionPredicate"),type:"string",value:"No"}];this._colorMapsForVolatileTags={};this._colorMapsForVolatileTags["ds6w:what/"+m.get("SynchronizationStatusPredicate")]=[{color:"#57B847",object:"Synchronized",type:"string"},{color:"#EA4F37",object:"NotSynchronized",type:"string"},{color:"#FFA500",object:"Unknown",type:"string"}];this._colorMapsForVolatileTags["ds6w:what/"+m.get("LoopsPredicate")]=[{color:"#EA4F37",object:"In",type:"string"},{color:"#57B847",object:"Out",type:"string"}];this._colorMapsForVolatileTags["ds6w:what/"+m.get("IsLastVersionPredicate")]=[{color:"#57B847",object:"Yes",type:"string"},{color:"#EA4F37",object:"No",type:"string"}];this._filterProxy=new u({tenant:n.getCurrentTenantName(),colorize:true,widgetId:this._widgetId});this._filterProxy.addEvent("FilterBIColorize",this.onFilterBIColorize,this);this._filterProxy.addEvent("FilterBIUnColorize",this.onFilterBIUnColorize,this);this._filterProxy.addEvent("FilterBIFilteringEvent",this.onFilterBIFilteringEvent,this);this._filterProxy.addEvent("ColorizeVolatile",this.volatileColorize,this);this._filterProxy.addEvent("FilterVolatile",this.volatileFiltering,this)},_updateFilterProxy:function(G){var F=this;if(!this._populateTags){return}var H=[],C=[],D=0,E=false;if(G){if(Object.keys(G.allfilters).length>0||(G.volatileFilters&&Object.keys(G.volatileFilters).length>0)){E=true}}if(!E){this.collection.filter(function(I){if(!I.get("isCount")&&I.get("modelType")==="node"){H.push(I.get("id"))}});if(this._navigationMap.listView&&this._navigationMap.listView.models){if(Object.keys(this._navigationMap.listView.models).length){H=H.concat(Object.keys(this._navigationMap.listView.models))}}for(var D=0;D<H.length;D++){C.push([D])}}else{if(G&&G.filteredPathIDList){for(var D=0;D<G.filteredPathIDList.length;D++){if(G.filteredPathIDList[D].slice(-2,-1)!=="_"){H.push(G.filteredPathIDList[D]);C.push([D])}}}}if(this._filterProxy){this._filterProxy.setPathTags({nodes:H,paths:C},function(){F._filterProxy.setVolatileTags({summary:F._summariesForVolatileTags.concat(F._getRelationsSummary()),colorMap:F._colorMapsForVolatileTags})})}},_getRelationsSummary:function(){var C=[],D=[];this.collection.filter(function(F){if(F.get("modelType")==="link"){var E=F.get("type");if(D.indexOf(E)===-1){D.push(E);var G={count:-1,dispValue:m.get(E),object:E,sixw:"ds6w:what/"+m.get("RelationsPredicate"),type:"string",value:E};C.push(G)}}});return C},onFilterBIFilteringEvent:function(F){if(this._filterProxy.volatileStatus&&this._filterProxy.volatileStatus==="Intermediate"){return}this.allFilterLength=Object.keys(F.allfilters).length;var I=c.clone(F);if(!this._populateTags){return}var H=false,D=false,G=false,C=false,K=false,E=0;for(var J in I.volatileFilters){if(I.volatileFilters.hasOwnProperty(J)){if(J==="ds6w:what/"+m.get("SynchronizationStatusPredicate")){D=true;E++}else{if(J==="ds6w:what/"+m.get("LoopsPredicate")){K=true;E++}else{if(J==="ds6w:what/"+m.get("IsLastVersionPredicate")){G=true;E++}else{H=true}}}}}C=D||K||G;if(!H&&C&&E>1){this.handleMultipleFiltering(I)}else{this._navigationMap.filter(F);this._updateFilterProxy(F)}},onFilterBIColorize:function(E){if(!this._populateTags){return}var C=E.nodes,D={};E.coloredSubjects.map(function(F){D[C[F.path[0]]]=F.color});this._navigationMap.colorize(D)},onFilterBIUnColorize:function(){if(!this._populateTags){return}this._navigationMap.unColorize();this._refreshSynchroCache()},handleMultipleFiltering:function(H){var E=false,C=false,D=false,G=false;for(var F in H.volatileFilters){if(H.volatileFilters.hasOwnProperty(F)){if(F==="ds6w:what/"+m.get("SynchronizationStatusPredicate")){C=true}else{if(F==="ds6w:what/"+m.get("LoopsPredicate")){D=true}else{if(F==="ds6w:what/"+m.get("IsLastVersionPredicate")){G=true}else{E=true}}}}}if(D){H.predicateName="ds6w:what/"+m.get("LoopsPredicate");H.allfilters=c.clone(H.volatileFilters);this.loopFiltering(H,true)}if(G){}},volatileFiltering:function(C){if(!this._populateTags){return}if(this._navigationMap&&this._navigationMap._spinner){this._navigationMap._spinner.show()}if(C.predicateName==="ds6w:what/"+m.get("LoopsPredicate")){this.loopFiltering(C)}else{if(C.predicateName==="ds6w:what/"+m.get("SynchronizationStatusPredicate")){this.synchroFiltering(C);return}else{if(C.predicateName==="ds6w:what/"+m.get("IsLastVersionPredicate")){this.versionFiltering(C)}else{if(C.predicateName==="ds6w:what/"+m.get("RelationsPredicate")){this.relationsFiltering(C)}else{if(this._navigationMap&&this._navigationMap._spinner){this._navigationMap._spinner.hide()}}}}}},volatileColorize:function(C){if(!this._populateTags){return}if(C&&C.tagColors&&C.tagColors.length>0){if(this._navigationMap&&this._navigationMap._spinner){this._navigationMap._spinner.show()}if(C.tagColors[0].predicate==="ds6w:what/"+m.get("SynchronizationStatusPredicate")){this.synchroColorize(C)}else{if(C.tagColors[0].predicate==="ds6w:what/"+m.get("LoopsPredicate")){this.loopColorize(C)}else{if(C.tagColors[0].predicate==="ds6w:what/"+m.get("IsLastVersionPredicate")){this.versionColorize(C)}else{if(C.tagColors[0].predicate==="ds6w:what/"+m.get("RelationsPredicate")){this.relationsColorize(C)}else{if(this._navigationMap&&this._navigationMap._spinner){this._navigationMap._spinner.hide()}}}}}}},relationsFiltering:function(G){var I=this,M=false,P=[],C=[],O=[];G.isVolatileData=true;for(var J in G.allfilters){if(G.allfilters.hasOwnProperty(J)){if(J!=="ds6w:what/"+m.get("RelationsPredicate")){M=true}}}for(var D in G.allfilters){if(G.allfilters.hasOwnProperty(D)){if(D==="ds6w:what/"+m.get("RelationsPredicate")){for(var F=0;F<G.allfilters[D].length;F++){O.push(G.allfilters[D][F].object)}}}}G.filteredLinks=[];G.filteredPathIDList=[];var L,K;this.collection.filter(function(Q){if(Q.get("modelType")==="link"){if(O.indexOf(Q.get("type"))!==-1){G.filteredLinks.push(Q.id)}}});this.collection.filter(function(Q){if(Q.get("modelType")==="link"){if(G.filteredLinks.indexOf(Q.id)>-1){L=Q.get("source").id;K=Q.get("target").id;if(G.filteredPathIDList.indexOf(L)===-1){G.filteredPathIDList.push(L)}if(G.filteredPathIDList.indexOf(K)===-1){G.filteredPathIDList.push(K)}}}});if(this._navigationMap.listView&&this._navigationMap.listView.relations){if(Object.keys(this._navigationMap.listView.relations).length){var H=this._navigationMap.listView.relations;for(var N in H){if(H.hasOwnProperty(N)){for(var E=0;E<O.length;E++){if(N.contains(O[E])){G.filteredPathIDList.push(H[N].id)}}}}}}this.collection.filter(function(Q){if(Q.get("modelType")==="node"&&Q.get("isCount")){if(G.filteredPathIDList.indexOf(Q.id)===-1){G.filteredPathIDList.push(Q.id)}}});I._navigationMap.filter(G);I._updateFilterProxy(G);if(I._navigationMap&&I._navigationMap._spinner){I._navigationMap._spinner.hide()}},relationsColorize:function(E){var H=this,K={},I={};E.forColorize=true;E.colorMap={};var C={};for(var F=0;F<E.tagColors.length;F++){C[E.tagColors[F].object]=E.tagColors[F].color}this.collection.filter(function(L){if(L.get("modelType")==="link"){E.colorMap[L.id]=C[L.get("type")]}});if(this._navigationMap.listView&&this._navigationMap.listView.relations){if(Object.keys(this._navigationMap.listView.relations).length){var G=this._navigationMap.listView.relations;for(var J in G){if(G.hasOwnProperty(J)){for(var D=0;D<E.tagColors.length;D++){if(J.contains(E.tagColors[D].object)){I[G[J].id]=E.tagColors[D].color}}}}}}E.colorizedNodes=I;H._navigationMap.colorizeRelations(E);if(H._navigationMap&&H._navigationMap._spinner){H._navigationMap._spinner.hide()}},synchroFiltering:function(H,D){var G=this,F=false,C="";for(var E in H.allfilters){if(H.allfilters.hasOwnProperty(E)){if(E!=="ds6w:what/"+m.get("SynchronizationStatusPredicate")){F=true}}}this._getSynchroStatus(F).then(function(I){if(I){C=JSON.parse(I)}H=G._processSynchroData(H,C);G._navigationMap.filter(H);if(D){H.allfilters={}}G._updateFilterProxy(H);if(G._navigationMap&&G._navigationMap._spinner){G._navigationMap._spinner.hide()}},function(){H=G._processSynchroData(H,{});if(D){H.allfilters={}}G._updateFilterProxy(H);if(G._navigationMap&&G._navigationMap._spinner){G._navigationMap._spinner.hide()}})},synchroColorize:function(E){var D=this,C={};this._getSynchroStatus().then(function(F){if(F){C=JSON.parse(F)}E.forColorize=true;E=D._processSynchroData(E,C);for(var G=0;G<E.tagColors.length;G++){if(E.tagColors[G].object==="Synchronized"){E.synchroColor=E.tagColors[G].color}else{if(E.tagColors[G].object==="NotSynchronized"){E.nonSynchroColor=E.tagColors[G].color}else{if(E.tagColors[G].object==="Unknown"){E.unknownColor=E.tagColors[G].color}}}}D._navigationMap.colorizeSynchro(E);if(D._navigationMap&&D._navigationMap._spinner){D._navigationMap._spinner.hide()}},function(){if(D._navigationMap&&D._navigationMap._spinner){D._navigationMap._spinner.hide()}})},loopFiltering:function(V,O){var R=[],N=[],S=[],C=[],M=false,H=[];if(!V.forColorize){for(var D in V.allfilters){if(V.allfilters.hasOwnProperty(D)){if(D!=="ds6w:what/"+m.get("LoopsPredicate")){M=true}for(var P=0;P<V.allfilters[D].length;P++){if(V.allfilters[D][P].object==="In"||V.allfilters[D][P].object==="Out"){R.push(V.allfilters[D][P].object)}}}}}var K=this._layoutUtils.findLoops();for(var G=0;G<K.length;G++){var T=K[G];for(var E=0;E<T.length;E++){N.push(T[E])}}this.collection.filter(function(W){if(W.get("modelType")==="node"){if(N.indexOf(W.id)===-1&&!(W.get("isCount"))){S.push(W.id)}}});if(V.forColorize){V.inLoopNodes=N;V.outLoopNodes=S;return V}var I,F;this.collection.filter(function(W){if(W.get("modelType")==="link"){I=W.get("source").id;F=W.get("target").id;if(N.indexOf(I)>-1&&N.indexOf(F)>-1){C.push(W.get("id"))}else{if(R.length===1&&R[0]==="Out"){if(N.indexOf(I)>-1||N.indexOf(F)>-1){C.push(W.get("id"))}else{H.push(W.get("id"))}}else{H.push(W.get("id"))}}}});if(M){var L=this._navigationMap.mapView.getFilteredNodesAndLinks();var U=L.filteredNodes,J=L.filteredLinks;var Q=N.length;while(Q--){if(U.indexOf(N[Q])===-1){N.splice(Q,1)}}Q=S.length;while(Q--){if(U.indexOf(S[Q])===-1){S.splice(Q,1)}}Q=C.length;while(Q--){if(J.indexOf(C[Q])===-1){C.splice(Q,1)}}Q=H.length;while(Q--){if(J.indexOf(H[Q])===-1){H.splice(Q,1)}}}V.filteredLinks=[];V.filteredPathIDList=[];for(var P=0;P<R.length;P++){if(R[P]==="In"){V.filteredLinks=V.filteredLinks.concat(C);V.filteredPathIDList=V.filteredPathIDList.concat(N)}else{if(R[P]==="Out"){V.filteredLinks=V.filteredLinks.concat(H);V.filteredPathIDList=V.filteredPathIDList.concat(S)}}}this.collection.filter(function(W){if(W.get("modelType")==="node"){if(W.get("isCount")){if(V.filteredPathIDList.indexOf(W.id)===-1){V.filteredPathIDList.push(W.id)}}}});V.isLoopData=true;V.isVolatileData=true;this._navigationMap.filter(V);if(!O){this._updateFilterProxy(V)}if(this._navigationMap&&this._navigationMap._spinner){this._navigationMap._spinner.hide()}},loopColorize:function(I){I.forColorize=true;var H,F,J,D={};I=this.loopFiltering(I);for(var E=0;E<I.tagColors.length;E++){if(I.tagColors[E].object==="In"){H=I.tagColors[E].color}else{if(I.tagColors[E].object==="Out"){F=I.tagColors[E].color}}}for(var G=0;G<I.inLoopNodes.length;G++){J=I.inLoopNodes[G];D[J]=H}for(var C=0;C<I.outLoopNodes.length;C++){J=I.outLoopNodes[C];D[J]=F}this._navigationMap.colorize(D,true);if(this._navigationMap&&this._navigationMap._spinner){this._navigationMap._spinner.hide()}},parseVersionInfo:function(D){var C={},E;if(D&&D.results&&D.results.length>0){D.results.forEach(function(F){if(F.attributes&&F.attributes.length&&F.attributes.length>0){E=F.attributes;var H;for(var G=0;G<E.length;G++){if(E[G].name&&E[G].name==="resourceid"){H=E[G].value}if(E[G].name&&E[G].name==="ds6wg:PLMReference.V_isLastVersion"){if(H&&C[H]===undefined){C[H]=E[G].value}}}}})}return C},processVersionInfo:function(V,J){var G=this,U=[],C=[];for(var W in J){if(J.hasOwnProperty(W)){if(J[W]==="TRUE"){U.push(W)}else{C.push(W)}}}if(V.forColorize){V.lastVersionNodes=U;V.notLastVersionNodes=C;return V}var R=[],O=[],S=[],I=[],M=false,K=[];for(var D in V.allfilters){if(V.allfilters.hasOwnProperty(D)){if(D!=="ds6w:what/"+m.get("IsLastVersionPredicate")){M=true}for(var P=0;P<V.allfilters[D].length;P++){if(V.allfilters[D][P].object==="Yes"||V.allfilters[D][P].object==="No"){R.push(V.allfilters[D][P].object)}}}}var F,E;this.collection.filter(function(X){if(X.get("modelType")==="link"){F=X.get("source").id;E=X.get("target").id;if(U.indexOf(F)>-1&&U.indexOf(E)>-1){I.push(X.get("id"))}else{if(R.length===1&&R[0]==="Out"){if(U.indexOf(F)>-1||U.indexOf(E)>-1){I.push(X.get("id"))}else{K.push(X.get("id"))}}else{K.push(X.get("id"))}}}});if(M){var L=this._navigationMap.mapView.getFilteredNodesAndLinks(),T=L.filteredNodes,N=this._navigationMap.listView.getFilteredIds(),H=L.filteredLinks;T=T.concat(N);var Q=U.length;while(Q--){if(T.indexOf(U[Q])===-1){U.splice(Q,1)}}Q=C.length;while(Q--){if(T.indexOf(C[Q])===-1){C.splice(Q,1)}}Q=I.length;while(Q--){if(H.indexOf(I[Q])===-1){I.splice(Q,1)}}Q=K.length;while(Q--){if(H.indexOf(K[Q])===-1){K.splice(Q,1)}}}V.filteredLinks=[],V.filteredPathIDList=[];for(var P=0;P<R.length;P++){if(R[P]==="Yes"){V.filteredLinks=V.filteredLinks.concat(I);V.filteredPathIDList=V.filteredPathIDList.concat(U)}else{if(R[P]==="No"){V.filteredLinks=V.filteredLinks.concat(K);V.filteredPathIDList=V.filteredPathIDList.concat(C)}}}this.collection.filter(function(X){if(X.get("modelType")==="node"){if(X.get("isCount")){if(V.filteredPathIDList.indexOf(X.id)===-1){V.filteredPathIDList.push(X.id)}}}});V.isVolatileData=true;return V},versionFiltering:function(E,C){var D=this;this.getLastVersionInfo().then(function(F){E=D.processVersionInfo(E,D.parseVersionInfo(JSON.parse(F)));D._navigationMap.filter(E);if(!C){D._updateFilterProxy(E)}if(D._navigationMap&&D._navigationMap._spinner){D._navigationMap._spinner.hide()}},function(F){D._updateFilterProxy(E);if(D._navigationMap&&D._navigationMap._spinner){D._navigationMap._spinner.hide()}})},versionColorize:function(F){var D=this,G,E,H,C={};F.forColorize=true;this.getLastVersionInfo().then(function(L){F=D.processVersionInfo(F,D.parseVersionInfo(JSON.parse(L)));for(var J=0;J<F.tagColors.length;J++){if(F.tagColors[J].object==="Yes"){G=F.tagColors[J].color}else{if(F.tagColors[J].object==="No"){E=F.tagColors[J].color}}}for(var K=0;K<F.lastVersionNodes.length;K++){H=F.lastVersionNodes[K];C[H]=G}for(var I=0;I<F.notLastVersionNodes.length;I++){H=F.notLastVersionNodes[I];C[H]=E}D._navigationMap.colorize(C,false);if(D._navigationMap&&D._navigationMap._spinner){D._navigationMap._spinner.hide()}},function(I){if(D._navigationMap&&D._navigationMap._spinner){D._navigationMap._spinner.hide()}})},_getProfiles:function(){var C=this;return this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/getProfiles?tenant="+n.getCurrentTenantName(),params:{widgetId:C._widgetId,roles:n.getRoles(),profileVersion:2,lang:n.getLang()}})},_getSynchroStatus:function(F){var E=this,C=false,D=[];if(F){D=(this._navigationMap.mapView.filteredLinksByFilter)?this._navigationMap.mapView.filteredLinksByFilter:D}else{this.collection.filter(function(G){if(G.get("modelType")==="link"){D.push(G.get("id"))}})}if(this._navigationMap.listView&&this._navigationMap.listView.relations){if(Object.keys(this._navigationMap.listView.relations).length){D=D.concat(Object.keys(this._navigationMap.listView.relations))}}if(D.length===0){C=true}return E._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/getSynchroStatus?tenant="+n.getCurrentTenantName(),noErrorMsg:C,params:{widgetId:E._widgetId,ids:D},timeout:n.getTimeout()})},_refreshSynchroCache:function(){if(this._refreshSynchroCacheDone===true){this._refreshSynchroCacheDone=undefined;return}return this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/cleanSynchroStatus?tenant="+n.getCurrentTenantName(),params:{widgetId:this._widgetId,}})},_getPatterns:function(){var C=this;return this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/getProfiles?tenant="+n.getCurrentTenantName(),params:{widgetId:C._widgetId,roles:n.getRoles(),automode:true,profileVersion:2,label:"RelationalExplorer"}})},_processSynchroData:function(U,L){U.isVolatileData=true;var Q=[],D=[],N=[],K=[],T=[],C=[],I=[],S={},R=[];if(!U.forColorize){for(var E in U.allfilters){if(U.allfilters.hasOwnProperty(E)){for(var P=0;P<U.allfilters[E].length;P++){if(U.allfilters[E][P].object==="NotSynchronized"||U.allfilters[E][P].object==="Synchronized"||U.allfilters[E][P].object==="Unknown"){R.push(U.allfilters[E][P].object)}}}}}if(L.outputlist&&L.outputlist.primitives){D=L.outputlist.primitives}for(var O=0;O<D.length;O++){if(D[O].stampvalue==="notuptodate"){Q.push(D[O].parentRelationId)}else{if(D[O].stampvalue==="unknown"){K.push(D[O].parentRelationId)}else{if(D[O].stampvalue==="uptodate"){N.push(D[O].parentRelationId)}}}}var G;for(var O=0;O<D.length;O++){if(N.indexOf(D[O].parentRelationId)>-1){if(Q.indexOf(D[O].parentRelationId)!==-1){G=N.indexOf(D[O].parentRelationId);N.splice(G,1)}else{if(K.indexOf(D[O].parentRelationId)!==-1){G=N.indexOf(D[O].parentRelationId);N.splice(G,1)}}}if(Q.indexOf(D[O].parentRelationId)>-1){if(K.indexOf(D[O].parentRelationId)!==-1){G=Q.indexOf(D[O].parentRelationId);Q.splice(G,1)}}}if(this._navigationMap.listView&&this._navigationMap.listView.relations){if(Object.keys(this._navigationMap.listView.relations).length){var M=this._navigationMap.listView.relations;for(var J in M){if(M.hasOwnProperty(J)){if(K.indexOf(J)!==-1){T.push(M[J].id);S[M[J].id]="#FFA500"}else{if(Q.indexOf(J)!==-1){I.push(M[J].id);S[M[J].id]="#EA4F37"}else{if(N.indexOf(J)!==-1){C.push(M[J].id);S[M[J].id]="#57B847"}}}}}}}if(U.forColorize){U.synchroLinks=N;U.nonSynchroLinks=Q;U.unknownLinks=K;U.colorizedNodes=S;return U}U.filteredLinks=[];U.filteredPathIDList=[];for(var P=0;P<R.length;P++){if(R[P]==="Synchronized"){U.filteredLinks=U.filteredLinks.concat(N);U.filteredPathIDList=U.filteredPathIDList.concat(C)}else{if(R[P]==="NotSynchronized"){U.filteredLinks=U.filteredLinks.concat(Q);U.filteredPathIDList=U.filteredPathIDList.concat(I)}else{if(R[P]==="Unknown"){U.filteredLinks=U.filteredLinks.concat(K);U.filteredPathIDList=U.filteredPathIDList.concat(T)}}}}var H,F;this.collection.filter(function(V){if(V.get("modelType")==="link"){if(U.filteredLinks.indexOf(V.id)>-1){H=V.get("source").id;F=V.get("target").id;if(U.filteredPathIDList.indexOf(H)===-1){U.filteredPathIDList.push(H)}if(U.filteredPathIDList.indexOf(F)===-1){U.filteredPathIDList.push(F)}}}});this.collection.filter(function(V){if(V.get("modelType")==="node"&&V.get("isCount")){if(U.filteredPathIDList.indexOf(V.id)===-1){U.filteredPathIDList.push(V.id)}}});return U},getLastVersionInfo:function(){var C=[];this.collection.filter(function(D){if(D.get("modelType")==="node"&&!(D.get("isCount"))){C.push(D.get("id"))}});if(this._navigationMap.listView&&this._navigationMap.listView.models){if(Object.keys(this._navigationMap.listView.models).length){C=C.concat(Object.keys(this._navigationMap.listView.models))}}return this._PM.createPromise({url:n.get3DSpaceUrl()+"/cvservlet/fetch/v2",params:{widgetId:this._widgetId,physicalid:C,select_predicate:["ds6wg:PLMReference.V_isLastVersion"]},timeout:60000})},_parseRelations:function(E){if(E){var I=this,J=JSON.parse(E),D=J.profiles[0],C=this._getValuesForProfile("LastUsedProfile");if(this.autoModeProfile){J.profiles.unshift(this.autoModeProfile)}var H=this._getRelationsSet();if(H){for(var G=0;G<H.length;G++){J.profiles.splice(G+1,0,H[G])}}if(C!==null&&C!==""&&C!==undefined){this.resProfile=C}else{this.resProfile="AutoModeProfile";this._autoNavMode=true}this.currentProfile=J.profiles[0].name;this._activeProfiles=J.profiles;if(n.getOption("noautomode")){this.resProfile=J.profiles[1].name;this.currentProfile=J.profiles[1].name;this._autoNavMode=false}for(var F=0;F<J.profiles.length;F++){if(this.resProfile===J.profiles[F].name){D=J.profiles[F];this.currentProfile=J.profiles[F].name;break}}for(var G=0;G<this._activeProfiles.length;G++){this.comboBoxProfiles[G]=this._activeProfiles[G].name}return new h(function(L,K){if(D){I._availableRelations=D.relations;I._splitRelations(D.relations);L()}else{K()}})}},_parsePatterns:function(D){if(D){var E=this,F=JSON.parse(D);this.autoModeProfile={name:"AutoModeProfile"};this.autoModeProfile.relations=(F.patterns)?F.patterns:[];var C=this.autoModeProfile.relations.length;while(C--){if(this.autoModeProfile.relations[C].name.contains("v6_structure_roots")){console.log("rel removed "+this.autoModeProfile.relations[C].name);this.autoModeProfile.relations.splice(C,1)}}return new h(function(H,G){H()})}},_splitRelations:function(H){var K={},R=null,I,T=false,L={},S=[],G,N="",E=false,V=false,F=null,P="",D={},Q,O=[];this.isGrouping=false;H.forEach(function(W){O.push(W.name)});for(var U=0;U<H.length;U++){P="";G=H[U].name;P=this.currentProfile+":"+G;N=this._getMainRelName(G);if(this._getTempPreferences(P)===undefined){I=true}else{var C=this._getTempPreferences(P);if(C==="true"){C=true}else{if(C==="false"){C=false}}I=C}if(this.isGrouping===false){E=(O.indexOf(N.concat("_to"))!==-1);V=(O.indexOf(N.concat("_from"))!==-1);if(E&&V){this.isGrouping=true}}if(H[U].showdetail&&D[N]!=="done"){D[N]="done";if(this._getTempPreferences(this.currentProfile+":details_"+N)===undefined){T=false}else{T=this._getTempPreferences(this.currentProfile+":details_"+N)}R={id:"details_"+N,relationName:m.get("showPub"),value:T}}else{R=null}if(I&&!T){this._currentRelations.push(G)}else{if(I&&T){this._currentRelations=this._currentRelations.concat(H[U].showdetail);this._publications[G]=H[U].showdetail}}T=false;K={id:G,relationName:m[G],value:I};S=m.get(N);var M=N+"_to",J=N+"_from";if(O.indexOf(M)>-1){Q=m[M+"_short"]||m[M]}else{if(O.indexOf(J)>-1){Q=m[J+"_short"]||m[J]}}if(!c.is(L[S],"array")){L[S]=[]}if(K.id.contains("_from")){if(K.id==="v6_repreplink_from"){L[S].splice(1,0,K)}else{L[S].unshift(K)}}else{L[S].push(K)}L[S].title=m[N+"_short"]||m[N]||N;L[S].nlsLabel=Q||m[N+"_short"]||m[N]||N;if(R){L[S].unshift(R)}}this._groupedRelations=L},_getNlsForRelationGroup:function(H){if(H){var C={},G,F;for(var E in H){if(H.hasOwnProperty(E)){for(var D=0;D<H[E].length;D++){if(H[E][D].id.contains("_to")){F=H[E][D].id;G=m[F+"_short"]||m[F]||F;if(G){C[G]=H[E]}break}}}}return C}},_getMainRelName:function(C){var D="";if(C.substr(C.length-3)==="_to"){D=C.substr(0,C.length-3)}else{D=C.substr(0,C.length-5)}return D},_setPreferences:function(){var F=this,C=[],G=[],E=F._autoModeChanged,D=[];if(E){D=this._getExcludedRelations()}D.push("v6_structure_roots_from");D.push("v6_structure_roots");F._autoModeChanged=false;C=C.concat(n.getOption("displayNameAttributes"));C=C.concat(n.getOption("detailAttributesLevel1"));C=C.concat(n.getOption("detailAttributesLevel2"));G=G.concat(n.getOption("displayNameAttributes"));return this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/setpreferences?tenant="+n.getCurrentTenantName(),params:{widgetId:F._widgetId,relations:(F._autoNavMode)?["use-auto-by-type-relations"]:F._currentRelations,lang:n.getLang(),countmanagement:true,instanceMode:true,attributes_for_detailview:C,attributes_for_graphview:G,excludedRelations:D}})},_getExcludedRelations:function(){var C=[],E=this.autoModeProfile.relations;for(var D=0;D<E.length;D++){if(this._currentRelations.indexOf(E[D].name)===-1){C.push(E[D].name)}}return C},_updateRowIdsForColumn:function(D,C){var E=this._getWidgetValue("ENORIPE_savedRowIds");E=(E)?JSON.parse(E):{};this._setWidgetValue(D,c.merge(C,E))},_initCollection:function(D){var E=D.initWithNodes||this._lastRootID,I=this._navigatedNodes,F=this,G=this._getWidgetValue("ENORIPE_savedColumnIds"),H=this._getWidgetValue("ENORIPE_savedRowIds"),C=D.needClear;if(!E&&I){E=(I.length?I:E)}if(E&&E!=="[]"){if(E.indexOf("[")===0){E=JSON.parse(E)}else{if(typeof E==="string"){E=[E]}}if(!this.collection){this.collection=new l([],{widgetId:this._widgetId,layoutUtils:this._layoutUtils,savedColumns:(G?JSON.parse(G):null),savedRows:(H?JSON.parse(H):null),_availableRelations:this._availableRelations,debugMode:(n.getOption("debug_me")==="1")});this.collection.addEvent("ENORIPE_setSavedColumnIds",this._setWidgetValue.bind(this));this.collection.addEvent("ENORIPE_setSavedRowIds",this._updateRowIdsForColumn.bind(this));this.collection.addEvent("ENORIPE_handleErrorMsgs",function(J){if(F._navigationMap){F._navigationMap.handleServerErrorMsgs(J)}});if(this._populateTags){this.collection.addEvent("ENORIPE_updateProxy",this._updateFilterProxy.bind(this))}this.collection.addEvent("ENORIPE_NodesRemoved",function(J,L){if(F.collection.length===0){F.clearMap()}else{if(F._navigationMap&&F._navigationMap.mapView){if(this._layoutRecomputeReq===true){this._layoutRecomputeReq=false;this.multipleDrop=true}this._setColumnOnNodes();F._navigationMap.mapView.render(F.collection.getLinksAndNodes(),F.collection.groupBy("columnID"));F._navigationMap.updateFeedbackForRemove(J);if(F._navigationMap._continueSearch){var K=F._navigationMap._searchValue;if(K){F.onSearch(K)}}else{F._navigationMap.clearFilterBySearch()}F._navigationMap._spinner.hide()}}if(L){if(F._navigationMap){F._navigationMap._showNotif({level:"warning",lvl:"warning",msg:m.get("RemoveWarning")})}}F._navigatedNodes=F._navigatedNodes.filter(function(M){return !J.includes(M)})})}this.collection._layoutRecomputeReq=true;this._getInfosForObjects(E,C)}else{this._isEmpty=true;this._initMapView(this._isEmpty)}},_getInfosForObjects:function(D,C){var E=this;this.collection.customFetch(D).then(function(F){E._handleErrors(F);if(F.supported.length){E.collection.reset(F.supported);if(F.supported.length>1){E.collection.multipleDrop=true}E._initMapView(false);if(E._widget&&E._widget.getValue("lastAnchorID")&&E._navigationMap._lastAnchorID){if(E._navigationMap._lastAnchorID!==E._widget.getValue("lastAnchorID")){E._navigationMap._lastAnchorID=E._widget.getValue("lastAnchorID")}}E._navigationMap._manageFirstFocusAndAnchor(F.supportedIdsArray);E._isEmpty=(E.collection.length===0);E._navigationMap._isEmpty=E._isEmpty;E._navigatedNodes=F.supportedIdsArray;E._setWidgetValue("ENORIPE_navigatedNodes",E._navigatedNodes);E._addToVisitedIds(E._navigatedNodes);if(C){E._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/clear?tenant="+n.getCurrentTenantName(),params:{widgetId:E._widgetId}}).then(function(){E.collection.getEcoSystem(F.supportedIdsArray)})}else{E.collection.getEcoSystem(F.supportedIdsArray)}}else{E._isEmpty=(E.collection.length===0);if(E._navigationMap){E._navigationMap._isEmpty=E._isEmpty}if(E._isEmpty){E._initMapView(true)}else{E._navigationMap._spinner.hide()}}})},_initMapView:function(D){var C=this;if(!this._navigationMap){this._navigationMap=new i({addinMode:this._addinMode,collection:this.collection,layoutUtils:this._layoutUtils,autoNavMode:this._autoNavMode,countLimit:n.getOption("countLimit"),platformId:n.getPlatformId(),lang:n.getLang(),isEmpty:D,widgetId:this._widgetId,lastAnchorID:this._lastAnchorID,debugMode:(n.getOption("debug_me")==="1"),separator:n.getOption("displayNameSeparator"),nameLabel:n.getOption("displayNameAttributes"),detailLabel1:n.getOption("detailAttributesLevel1"),detailLabel2:n.getOption("detailAttributesLevel2"),chordViewEnabled:n.getOption("chord"),errorOnParseCompassData:this._errorOnParseCompassData});if(D){this._navigationMap._isEmpty=this._isEmpty}this._navigationMap.addEvent("ENORIPE_DropByMode",this._dropByMode.bind(this));this._navigationMap.addEvent("ENORIPE_setSavedRowIds",this._updateRowIdsForColumn.bind(this));this._navigationMap.addEvent("ENORIPE_refreshMapCMD",this._onRefresh.bind(this));this._navigationMap.addEvent("ENORIPE_ClearMapClick",this.clearMap.bind(this));this._navigationMap.addEvent("setLastAnchorID",function(E){C._setWidgetValue("lastAnchorID",E)});this._navigationMap.addEvent("ENORIPE_AddNavigatedNode",this._addToNavigatedIds.bind(this));this._navigationMap.addEvent("ENORIPE_AddVisitedNode",this._addToVisitedIds.bind(this));this._navigationMap.addEvent("setLastRootNodeID",function(E){C._setWidgetValue("lastRootNodeID",E)});this._navigationMap.addEvent("ENORIPE_Customize",this.customize.bind(this));this._navigationMap.addEvent("ENORIPE_CustomizeDisplay",this.customizeDisplay.bind(this));this._navigationMap.addEvent("ENORIPE_ResizeDialog",C._updateCustomizeDialog.bind(C));this._navigationMap.addEvent("ENORIPE_ProfileInfo",function(){var E=C._getValuesForProfile("LastUsedProfile");if(E!==null&&E!==""&&E!==undefined){C._navigationMap.lastUsedProfile=E}for(var F=0;F<C._activeProfiles.length;F++){C._navigationMap.profileArray[F]=C._activeProfiles[F].name}});if(this._populateTags){this._navigationMap.addEvent("ENORIPE_updateProxy",this._updateFilterProxy.bind(this))}C._navigationMap.addEvent("ENORIPE_updateRelations",C._updateRelations.bind(C));C._navigationMap.addEvent("ENORIPE_Search",C.onSearch.bind(C));this.container.setContent(this._navigationMap);this._navigationMap.onResize()}else{this._navigationMap.refresh({isEmpty:D,collection:this.collection})}if(this._populateTags){this._createFilterProxy()}},_saveTempPreferences:function(C,D){if(C&&D){this._tempPreferences[C]=D}},_getTempPreferences:function(C){if(this._tempPreferences){var D=this._tempPreferences[C];if(D){return D}}},_getValuesForRefresh:function(C){var D=(this._isWebInWin)?localStorage.getItem(C):undefined;if(this._widget&&!this._isWebInWin&&!D){D=this._widget.getValue(C)}if(D){return JSON.parse(D)}},_saveValuesForRefresh:function(C,D){if(this._isWebInWin){localStorage.setItem(C,JSON.stringify(D))}else{if(this._widget){this._widget.setValue(C,JSON.stringify(D))}}},_getRelationsSet:function(){var C=localStorage.getItem(n.getUserID()+"_ENORIPE_CustomRelationsSet");if(C){return JSON.parse(C)}},_setRelationSet:function(I){var E=n.getUserID()+"_ENORIPE_CustomRelationsSet",G=JSON.stringify(I),C=null,F=localStorage.getItem(E),H=false;if(F){C=JSON.parse(F);for(var D=0;D<C.length;D++){if(I.name===C[D].name){C[D].relations=I.relations;H=true}}if(!H){C.push(I)}}else{C=[];C.push(I)}localStorage.setItem(E,JSON.stringify(C))},_getValuesForProfile:function(C){var D,E=(this._isWebInWin)?false:(this._widgetId)?this._widgetId.contains("preview"):false;if(this._isWebInWin||E){D=localStorage.getItem(C)}else{if(this._widget){D=this._widget.getValue(C)}}if(!(D)){D=localStorage.getItem(C);if(D){this._saveValuesForProfile("LastUsedProfile",D)}}if(D){return D}},_saveValuesForProfile:function(C,D){var E=(this._isWebInWin)?false:this._widgetId.contains("preview");if(this._isWebInWin||E){localStorage.setItem(C,D)}else{if(this._widget){this._widget.setValue(C,D);localStorage.setItem(C,D)}}},_getWidgetValue:function(C){if(this._widget){return this._widget.getValue(C)}},_setWidgetValue:function(C,D){if(this._widget){D=c.is(D,"string")?D:JSON.stringify(D);this._widget.setValue(C,D)}},_dropByMode:function(E,C,G){var F=this.collection||null,D=null;if(G&&F){D=F.getFocusedNode();if(D&&D.get("isCount")===true&&D.get("name")==="2"){this._navigationMap._setFocusToLastExtracted=G}F.extract(G)}else{if(C&&E==="replace"){this._navigationMap.initMultiSelectionFromCmdIfMultiSelIsActivated();this._resetMap(C,true)}else{if(this._isEmpty){this._resetMap(C);return}this._dropAdd(C)}}},_resetMap:function(D,E){var G="[",C="";for(var F=0;F<D.length;F++){if(C===""){C=D[F].envId}else{if(C!==D[F].envId){}}G+='"'+D[F].objectId+'"';G+=((D.length-1)>F?",":"");G+=((D.length-1)===F?"]":"")}if(C&&n.getCurrentTenantName()!==C){this._changePlatformSL(C)}if(G[G.length-2]===","){G=G.substring(0,G.length-2)+"]"}if(G==="[]"){this._navigationMap._spinner.hide();return}this._cleanProxy();this._onRefresh({initWithNodes:G,needClear:E})},_cleanProxy:function(){if(this._filterProxy){this._filterProxy.cleanProxy();this._filterProxy.setPathTags({nodes:[],paths:[]})}},_onRefresh:function(C){this._refreshSynchroCache();if(C.newRelations){this._currentRelations=C.newRelations;C.needSetPref=true;C.needClear=true}if(C.initWithNodes){this._navigationMap._spinner.show();if(C.needClear===true){var D=this;if(C.needSetPref){this._setPreferences().then(function(){D._initCollection({initWithNodes:C.initWithNodes,objectType:C.objecType||null,needClear:true})})}else{this._initCollection({initWithNodes:C.initWithNodes,objectType:C.objecType||null,needClear:true})}}else{this._refreshCollection({initWithNodes:C.initWithNodes,objectType:C.objecType||null,needSetPref:C.needSetPref})}}},_refreshCollection:function(C){var E=this;if(this._navigationMap){this._navigationMap._spinner.show();if(C.firedFromWidgetMenu){this._navigationMap.refreshMsgPending=true}}if(this.collection){this.collection._models.forEach(function(H){if(E.collection.nodesToBeRemoved&&E.collection.nodesToBeRemoved.length>0){var F=E.collection.nodesToBeRemoved;for(var G=0;G<F.length;G++){if(H.id===F[G].id){E.collection.nodesToBeRemoved.splice(G,1);break}}}})}if(this.collection&&this._navigatedNodes&&this._navigatedNodes.length){if(C&&C.needSetPref===true){this._setPreferences().then(function(){E.collection.getEcoSystem(E._navigatedNodes)})}else{this.collection.needsRemove=true;var D=[];E._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/clear?tenant="+n.getCurrentTenantName(),params:{widgetId:E._widgetId}}).then(function(){E.collection.customFetch(E._navigatedNodes).then(function(F){E._navigatedNodes.forEach(function(H){for(var G=0;G<F.supported.length;G++){if(H===F.supported[G].id){D.push(E.collection.get(H))}}});E.collection.reset(D);E.collection.getEcoSystem(E._navigatedNodes)})})}}else{if(C.firedFromWidgetMenu){if(this._navigationMap){this._navigationMap._spinner.hide()}return}this._initCollection({initWithNodes:C.initWithNodes,objectType:C.objecType||null})}},_handleErrors:function(C){if(!this._navigationMap){this._initMapView(true)}if(this._navigationMap){if(C.notSupported){this._navigationMap._showNotif({level:"error",msg:m.get("TypeNotSupported")+": "+C.notSupported})}if(C.notFound){this._navigationMap._showNotif({level:"error",msg:m.get("ObjectNotFound")+": "+C.notFound})}}},_dropAdd:function(D){var C,G=[],F=this,H=this.collection;for(var E=0;E<D.length;E++){if(n.getCurrentTenantName()!==D[E].envId){this._addNewObjectsFromDifferentPlatform=D;this._currentNewTenantValue=D[E].envId;if(!this._modal){this._setupModal()}this._modal.show();return}C=H.get(D[E].objectId);if(C&&D.length===1){this._navigationMap.setFocus(C);H.getEcoSystem(D[E].objectId);return}else{G.push(D[E].objectId)}}if(G.length){H.customFetch(G).then(function(I){F._handleErrors(I);if(I.supported.length){H.add(I.supported);if(I.supported.length>1){H.multipleDrop=true}if(!F._isWebInWin){F._addRootNode(I.supportedIdsArray);F._addToNavigatedIds(I.supported);F._addToVisitedIds(I.supported)}H.getEcoSystem(I.supportedIdsArray)}else{F._navigationMap._spinner.hide()}})}else{this._navigationMap._spinner.hide()}},_addRootNode:function(C){var D=this._getWidgetValue("lastRootNodeID");if(c.is(D,"string")){D=D.slice(0,-1)+","}for(var E=0;E<C.length;E++){D+='"'+C[E]+'"';D+=((C.length-1)===E?"]":",")}this._setWidgetValue("lastRootNodeID",D)},onResize:function(){if(this._navigationMap){this._navigationMap.onResize()}},onSearch:function(F){var E=this;if(typeof this.collection==="undefined"||this.collection===null){return}if(typeof this._searchUtils==="undefined"){this._searchUtils=new d({debug:false})}var D=[];this._navigationMap._spinner.show();this.collection.filter(function(G){if(G.get("modelType")==="node"&&!G.get("isCount")){if(E._navigationMap._isFiltered){if(E._navigationMap._currentlyFilteredNodes.indexOf(G.get("id"))!==-1){D.push(G.get("id"))}}else{D.push(G.get("id"))}}});if(F&&D.length>0){var C={};C.ids=D;C.value=F;C.url=n.get3DSearchUrl()+"/search";C.tenantName=n.getCurrentTenantName();C.locale=n.getLang();this._searchUtils._searchCall(C).then(function(H){var I=JSON.parse(H);if(I&&typeof I.results!=="undefined"&&I.infos&&I.infos.nresults>0){var G=E._processSearchResult(I.results);E._navigationMap.filterBySearch(G)}else{E._navigationMap.filterBySearch([])}E._navigationMap._searchValue=F;E._navigationMap._spinner.hide()},function(){E._navigationMap._spinner.hide()})}else{}},_processSearchResult:function(E){var D=[],C=[];E.forEach(function(F){if(F.attributes){C=F.attributes;for(var G=0;G<C.length;G++){if(C[G].name==="resourceid"){D.push(C[G].value);break}}}});return D},onResetSearch:function(){if(this._navigationMap){this._navigationMap.clearFilterBySearch()}},_addToNavigatedIds:function(D){if(typeof D==="string"){if(this._navigatedNodes.indexOf(D)===-1){this._navigatedNodes.push(D)}}else{for(var C=0;C<D.length;C++){if(this._navigatedNodes.indexOf(D[C])===-1){this._navigatedNodes.push(D[C].id)}}}this._setWidgetValue("ENORIPE_navigatedNodes",this._navigatedNodes)},customize:function(D){var I=this,G=[],O,K=n.getOption("noautomode");if(!this._customizeView){if(this._navigationMap){this._navigationMap.addLoader()}var L=this._getValuesForProfile("LastUsedProfile"),M,C=[];if(L!==null&&L!==""&&L!==undefined){M=L}if(K&&M==="AutoModeProfile"){M=I._activeProfiles[1].name;this._saveValuesForProfile("LastUsedProfile",M)}var H=0;for(var F=0;F<I._activeProfiles.length;F++){if(K&&I._activeProfiles[F].name==="AutoModeProfile"){I._autoNavMode=false;continue}C[H]={name:I._activeProfiles[F].name,type:I._activeProfiles[F].type,nls:I._activeProfiles[F].nls};H++}var J=this._groupedRelations;if(this._autoNavMode){O=this._getRelForAutoMode(this._groupedRelations);J=O.present}require(["DS/SNNavigationMap/views/CustomizeView"],function(P){I.comboBoxProfiles=[];I._customizeView=new P({settings:J,notPresentRelations:(I._autoNavMode)?O.notPresent:[],title:m.get("SNNavigationMap.Customize.Title"),needTranslate:I.isGrouping,currentProfile:I.currentProfile,thumbnails2d:(n.getThumbnailsMode()==="thumbnailsMode"),recomputeLayout:I._getValuesForRefresh("recompute-cb"),autoNav:I._autoNavMode,lastUsedProfile:M,profileArray:C,lang:n.getLang()});I._customizeView.addEvent("ENORIPE_updatePref",I._updatePreferences.bind(I));I._customizeView.addEvent("ENORIPE_updateRelations",I._updateRelations.bind(I));I._customizeView.addEvent("ENORIPE_CreateNewProfile",I._createNewProfile.bind(I));I._customizeView.addEvent("ENORIPE_SaveNewProfile",I._createNewProfile.bind(I));I._customizeView.addEvent("ENORIPE_DeleteProfile",I._deleteProfile.bind(I));I._customizeView.addEvent("ENORIPE_UpdateLUP",function(Q){if(Q){I._saveValuesForProfile("LastUsedProfile",Q)}});I._customizeView.inject(I.container);if(!D){I._customizeView.show();I._customizeView.render()}if(I._navigationMap){I._navigationMap.removeLoader()}})}if(this._customizeView&&this._customizeView._dialog===null&&!D){var N={};for(var E=0;E<this._activeProfiles.length;E++){if(this._activeProfiles[E].name===this.currentProfile){this._availableRelations=this._activeProfiles[E].relations;this._splitRelations(this._activeProfiles[E].relations)}}if(this._autoNavMode){O=this._getRelForAutoMode(this._groupedRelations);N.settings=O.present;N.notPresentRelations=O.notPresent}this._customizeView.show();this._customizeView.render(N)}else{if(this._customizeView&&this._customizeView._dialog!==null){this._customizeView._destroyCurrentDialog()}}},customizeDisplay:function(){var C=this;if(!this._customizeDisplayView){if(this._navigationMap){this._navigationMap.addLoader()}require(["DS/SNNavigationMap/views/CustomizeDisplayView"],function(D){C._customizeDisplayView=new D({thumbnails2d:(n.getThumbnailsMode()==="thumbnailsMode"),recomputeLayout:C._getValuesForRefresh("recompute-cb"),showpub:C._getValuesForRefresh("showpub")});C._customizeDisplayView.addEvent("ENORIPE_updateGlobalPref",C._updateGlobalPreferences.bind(C));C._customizeDisplayView.inject(C.container);C._customizeDisplayView.show();C._customizeDisplayView.render();if(C._navigationMap){C._navigationMap.removeLoader()}})}if(this._customizeDisplayView&&this._customizeDisplayView._dialog===null){this._customizeDisplayView.show();this._customizeDisplayView.render()}else{if(this._customizeDisplayView&&this._customizeDisplayView._dialog!==null){this._customizeDisplayView._destroyCurrentDialog()}}},_createNewProfile:function(G){if(G){var D="ENORIPE_Profile_"+G.name,F=false;this._setRelationSet(G);this.currentProfile=G.name;var E=this._activeProfiles;for(var C=0;C<E.length;C++){if(E[C].name===G.name){this._activeProfiles[C].relations=G.relations;F=true}}if(!F){this._activeProfiles.splice(1,0,G)}}},_deleteProfile:function(E,C){var K=n.getUserID()+"_ENORIPE_CustomRelationsSet",J=localStorage.getItem(K),D;if(J){D=JSON.parse(J)}else{return}var F=D;for(var G=0;G<F.length;G++){if(F[G].name===E){D.splice(G,1)}}localStorage.setItem(K,JSON.stringify(D));var I=this._activeProfiles;for(var H=0;H<I.length;H++){if(I[H].name===E){this._activeProfiles.splice(H,1)}}this.currentProfile=C;this._saveValuesForProfile("LastUsedProfile",C)},_getRelForAutoMode:function(J){var G=[],K={};if(this.collection){this.collection.filter(function(M){if(M.get("modelType")==="link"){var L=M.get("type");if(G.indexOf(L)===-1){G.push(L)}}})}var I=this._sortGroupedRel(J);var C={},H=0;for(var D in J){if(J.hasOwnProperty(D)){for(var F=0;F<J[D].length;F++){for(var E=0;E<G.length;E++){if(J[D][F].id.contains(G[E])){J[D][F].present=true;H++;C[D]=J[D];delete I[D];break}}}}}K.present=C;K.notPresent=I;return K},_sortGroupedRel:function(E){if(E){var C={},H=[];for(var D in E){H.push([E[D].nlsLabel,D])}H.sort(function(K,J){var I=K[0].toLowerCase();var L=J[0].toLowerCase();return I<L?-1:I>L?1:0});for(var G=0;G<H.length;G++){var F=H[G][1];C[F]=E[F]}return C}},_updateGlobalPreferences:function(E){var H,D={},F=this,G;for(var C in E){if(E.hasOwnProperty(C)){H=this._getValuesForRefresh(C);if(H!==E[C]){this._saveValuesForRefresh(C,E[C]);D[C]=E[C]}}}if(D["recompute-cb"]!==undefined){n.setLayoutMode((D["recompute-cb"]===true)?"recompute":false);if(D["recompute-cb"]===true){this.collection._setColumnOnNodes();this._navigationMap.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"))}}if(D["thumbnails2d-cb"]!==undefined){G=(D["thumbnails2d-cb"]===true)?"thumbnailsMode":false;this._updateThumbnailPreference(G).then(function(){n.setThumbnailsMode(G);F._navigationMap.switchThumbnailsMode(G)})}if(D.showpub!==undefined){this._updateShowPub(D.showPub)}this._customizeDisplayView.updateDisplayPref(D)},_updateThumbnailPreference:function(D){var C=this;return new h(function(F,E){if(D!==false){C._setDisplayOptions(D).then(function(){C._getEcoSystem(C._navigatedNodes).then(function(J){J=JSON.parse(J);if(J.New&&J.New.Objects&&J.New.Objects.length){var I=J.New.Objects;for(var H=0;H<I.length;H++){var G=C.collection.get(I[H].id);if(G&&I[H].thumbnail&&!G.get("thumbnail")){G.set("thumbnail",I[H].thumbnail);G.set("thumbnailTBU",true)}}}F()})})}else{C._setDisplayOptions(D).then(function(){F()})}})},_getEcoSystem:function(C){var D=this;return this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/getecosystem?tenant="+n.getCurrentTenantName(),params:{widgetId:D._widgetId,ids:C,timeout:60000,lang:n.getLang()}})},_setDisplayOptions:function(E){var D=[],C=this;if(E===false){D.push("thumbnail_2d")}return this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/setOptions?tenant="+n.getCurrentTenantName(),params:{widgetId:C._widgetId,removeFileAttributes:D,lang:n.getLang()}})},_updateShowPub:function(C){},_updatePreferences:function(E){this._cleanProxy();this._navigationMap.filter({allfilters:{}});var H,D,G,I,C=[];this._availableRelations.forEach(function(J){C.push(J.name)});for(var F=0;F<this._activeProfiles.length;F++){if(this._activeProfiles[F].name===this.currentProfile){this._saveValuesForProfile("LastUsedProfile",this._activeProfiles[F].name)}}if(!this._currentRelations.equals(E)){for(var F=0;F<this._availableRelations.length;F++){D=this._availableRelations[F].name;G="";G=this.currentProfile+":"+D;I=this._getMainRelName(D);H=(E.indexOf(D)>-1)?"true":"false";if(this._availableRelations[F].showdetail){if(E.indexOf("details_"+I)>-1){E.splice(E.indexOf(D),1);E=E.concat(this._availableRelations[F].showdetail);this._saveTempPreferences("details_"+I,H);this._saveTempPreferences(this.currentProfile+":details_"+I,H);this.lastSavedValues["details_"+I]=H}else{this._saveTempPreferences("details_"+I,"false");this.lastSavedValues["details_"+I]="false"}}this._saveValuesForRefresh(D,H);this._saveTempPreferences(G,H);this.lastSavedValues[D]=H}for(F=0;F<E.length;F++){if(C.indexOf(E[F])===-1){D=E[F];G="";G=this.currentProfile+":"+D;I=this._getMainRelName(D);H=(E.indexOf(D)>-1)?"true":"false";this._saveValuesForRefresh(D,H);this._saveTempPreferences(G,H);this.lastSavedValues[D]=H;this._availableRelations.push({name:D})}}if(this._customizeView){this._customizeView.setNewValues(this.lastSavedValues)}this.collection.setAvailableRelations(this._availableRelations);this._currentRelations=E;this.collection.orphanNodesAllowed=false;if(this._autoNavMode){this._autoModeChanged=true}this._onRefresh({initWithNodes:this._navigatedNodes,newRelations:E})}},_updateRelations:function(G){if(G&&G==="AutoModeProfile"){this._autoNavMode=true}else{this._autoNavMode=false}for(var F=0;F<this._activeProfiles.length;F++){if(this._activeProfiles[F].name===G){this.currentProfile=G;this._availableRelations=this._activeProfiles[F].relations;this._splitRelations(this._activeProfiles[F].relations);if(this._customizeView){this._customizeView.currentProfile=G}var E=this._groupedRelations,D;if(this._autoNavMode){var C=this._getRelForAutoMode(this._groupedRelations);E=C.present;D=C.notPresent}if(this._customizeView){this._customizeView.showRelation(E,this.isGrouping,D)}break}}},_addToVisitedIds:function(D){if(D===undefined||D===null){return}if(typeof D==="string"){if(this._visitedNodes.indexOf(D)===-1){this._visitedNodes.push(D)}}else{for(var C=0;C<D.length;C++){var E=D[C].id||D[C];if(this._visitedNodes.indexOf(E)===-1){this._visitedNodes.push(E)}}}},_updateCustomizeDialog:function(){if(this._customizeView){this._customizeView.updateDialogSizeOnResize()}},onEndEditPref:function(){if(this._addinMode==="catiav5"||this._addinMode==="solidworks"){try{var C=JSON.parse(widget.getValue("X3DContentId"));this._navigationMap.initMultiSelectionFromCmdIfMultiSelIsActivated();this._resetMap(C.data.items,true)}catch(G){console.error(G)}return}var F=(this._getWidgetValue("populateTags")==="true")?true:false,E=this._getWidgetValue("selected_tenant"),D=this;if(this._populateTags===F&&E===n.getCurrentTenantName()){return}if(!F&&this._populateTags!==F){this._populateTags=false;this._cleanProxy()}else{if(F&&this._populateTags!==F){this._populateTags=true;this._updateFilterProxy()}}if(E!==n.getCurrentTenantName()){if(this._isEmpty){this._changePlatformSL(E)}else{this._needToConfirmPlatformChange=true;this._currentNewTenantValue=E;if(!this._modal){this._setupModal()}this._modal.show()}}},_setupModal:function(){var C=this;this._modal=new f({className:"site-reset",closable:false,header:"<h4>"+m.get("PlatformChange")+"</h4>",body:"<p>"+m.get("PlatformChangeMsg")+"</p>",footer:'<button type="button" id="confirm-change" class="btn btn-primary">'+m.get("SNNCustomize_Save")+'</button> <button type="button" id="cancel-change" class="btn btn-default">'+m.get("SNNCustomize_Cancel")+"</button>"}).inject(this._navigationMap.container);this._modal.getContent().getElements(".btn").forEach(function(D){D.addEvent("click",function(){C._needToConfirmPlatformChange=false;C._modal.hide();if(this.getAttribute("id")==="confirm-change"){C._refreshSynchroCache();C._refreshSynchroCacheDone=true;C.clearMap();C._changePlatformSL(C._currentNewTenantValue);C._currentNewTenantValue="";if(C._addNewObjectsFromDifferentPlatform){C._resetMap(C._addNewObjectsFromDifferentPlatform);C._addNewObjectsFromDifferentPlatform=undefined}}else{C._setWidgetValue("selected_tenant",n.getCurrentTenantName());C._currentNewTenantValue="";if(C._navigationMap&&C._navigationMap._spinner){C._navigationMap._spinner.hide()}}})})},_changePlatformSL:function(C){n.setCurrentTenant(C);if(this._getWidgetValue("selected_tenant")!==C){this._setWidgetValue("selected_tenant",C)}this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:m.get("PlatformChangesTo")+" "+C})},clearMap:function(){this._cleanProxy();this._isEmpty=true;this._navigatedNodes=[];this._setWidgetValue("ENORIPE_navigatedNodes",this._navigatedNodes);this._setWidgetValue("ENORIPE_savedColumnIds",{});this._setWidgetValue("ENORIPE_savedRowIds",{});this._setWidgetValue("X3DContentId",{});this._visitedNodes=[];this._setWidgetValue("lastRootNodeID","");this._setWidgetValue("lastAnchorID","");if(this.collection){this.collection.reset();this.collection=null}if(this._customizeView){this._customizeView.hide()}this._PM.createPromise({url:n.get3DSpaceUrl()+"/resources/enorelnav/navigate/clear?tenant="+n.getCurrentTenantName(),params:{widgetId:this._widgetId},timeout:60000}).then(this._navigationMap.clearMapSuccess.bind(this._navigationMap),this._navigationMap.clearMapFailure.bind(this._navigationMap))}});return A});