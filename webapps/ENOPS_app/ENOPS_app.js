/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
function ENOPS_app(c){var a={v1:{ap_custo:"ap_custo",ap_custoParams:"ap_custoParams",ap_root_pids:"ap_root_pids",ap_filter_ids:"saved_filter_ids",ap__root_pids_detached:"ap__root_pids_detached",ap_struct:"ap_struct"}};var b={widget:null,pad_app:null,setting_names:a.v1,xnav_component_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,layout:{title_update:true,view_customization:null,store_roots_in_pref:true,slidder:false,root_panel:true,padshell:false},settings:null,insert_replace:true,authorize_setStructure:true,authorizeChangeControl:false,amd_custo:{}},init:function(d){this.pcsPrefix=widget.id+"_"+widget.title;window.top.performance.mark(this.pcsPrefix+"_init");window.top.performance.measure(this.pcsPrefix+"_call_init","enops_app_load_html",this.pcsPrefix+"_init");this.widget=d.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this))},onRefresh:function(){this.pad_app.refresh()},onLoad:function(){var d=this;window.top.performance.mark(this.pcsPrefix+"_onload");window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload");require(["DS/PADUtils/Configuration","text!DS/ENOPS_app/assets/ProductStructureConf.json"],function(g,f){var e=JSON.parse(f);g.mergeConfig(e);require(["DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/PADUtils/Configuration","DS/PADServices/utils/AttributesMgt","UWA/Core","DS/PADUtils/PADSession","text!DS/ENOPS_app/assets/enops_settings.json","text!DS/ENOPS_app/assets/ProductStructureConf.json"],function(w,p,h,m,k,u,s,i,o,r){window.top.performance.mark(d.pcsPrefix+"_require_infra_padutils");window.top.performance.measure(d.pcsPrefix+"_require_infra",d.pcsPrefix+"_onload",d.pcsPrefix+"_require_infra_padutils");var q=JSON.parse(r);k.mergeConfig(q);if(!d.widget.getValue("x3dSharedId")&&!d.widget.getValue("x3dAppId")){var v="ENOPAD_appId";d.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:v})}var l=JSON.parse(o);if(d._odt_settings){l.padsettings=UWA.extend(l.padsettings,d._odt_settings,true)}p.setApp(l.padsettings,"enops",true);h.addSharedSettings(d.widget,["x3dPlatformId","pad_security_ctx","useIndexAccleration","maxDashSearch"]);d.widget.mergePreferences(p.getWidgetPreferences());d.widget.addEvent("endEdit",p.updateWidgetPreferences.bind(p));d.widget.addEvent("onPlatformIdChange",function(y,z){if(y=="x3dPlatformId"){p.updateTenantSecPreference(z,true)}});d.widget.addEvent("onChangeControlUpdate",function(y,z){var A=p.getSetting("changeControlActivation");if(d.widget.getValue("changeControlActivation")!==undefined){A=d.widget.getBool("changeControlActivation")}var B="bottom-right";if(sessionStorage.getItem("changeControlPosition")){B=sessionStorage.getItem("changeControlPosition")}else{B=p.getSetting("changeControlPosition")}if(z===false){d.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:B,})}else{d.widget.addPreference({name:"changeControlPosition",defaultValue:B,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})}d.widget.dispatchEvent("onEdit")});p.updateWidgetPreferences();if(p.getSetting("activateFUN078214")===true){d.widget.addEvent("onSearch",d.onSearch.bind(d))}var x=d._initializePADComponent_v2.bind(d);d.setting_names=a.v1;if(d.pad_app===null){var j=d.xnav_component_opts;j.x3dAppId=d.widget.getValue("x3dAppId");j.widget=d.widget;j.lang=d.widget.lang;j.active_view=d.widget.getValue("default_view")?d.widget.getValue("default_view"):"treelistview";j.settings=l;if(m.isCloud()===true){j.settings.action_bar.standard=j.settings.action_bar.standardCloud;j.settings.action_bar.touch=j.settings.action_bar.touchCloud}j.layout.root_panel=false;j.layout.padshell=true;j.layout.propertiesFacet=p.getSetting("propertiesFacet");if(p.getSetting("activateDropInviteWithFilter")===true){j.layout.drop_invite="inviteWithFilter"}if(p.getSetting("authorizeChangeControl")===true){j.authorizeChangeControl=true;if(d.widget.getValue("changeControlActivation")!==undefined){p.setSetting("changeControlActivation",d.widget.getBool("changeControlActivation"))}}if(p.getSetting("activateDGV")===true){j.layout.amdTreeView="datagridview";j.amd_custo.DataGridView="DS/ENOPAD_v2/views/PADDataGridView";if(j.active_view==="treelistview"){j.active_view="datagridview"}}else{if(j.active_view==="datagridview"){j.active_view="treelistview"}}if(p.getSetting("activateTXO")===true&&k.getConfig("WSAccessV2")===true){u.updateAttributesList(q.columnsCusto)}else{u.useIntent()}var n=d.widget.getValue(d.setting_names.ap_custo);var t=d.widget.getValue(d.setting_names.ap_custoParams);if(t){u.updateSelectedParams(JSON.parse(t))}if(n==="null"){n=null}if(p.getSetting("resetCustomization")===true||(n&&n.charAt(0)!=="{")){localStorage.removeItem("PADTreeListDefinition."+j.x3dAppId+"_"+widget.getValue("x3dPlatformId"));x(j)}else{if(n){j.layout.view_customization=JSON.parse(n);x(j)}else{m.app_initialization(function(y){if(y&&y.success){w.getMyAppsTemplate({preference_name:j.x3dAppId,onComplete:function(B){var z=null;if(B.length>0&&B.charAt(0)==="{"){try{z=JSON.parse(B)}catch(A){z=""}if(z.selectedExtensions&&z.selectedTypes){u.updateSelectedParams({selectedExtensions:z.selectedExtensions,selectedTypes:z.selectedTypes});delete z.selectedExtensions;delete z.selectedTypes}}j.layout.view_customization=z;x(j)},onFailure:function(z){x(j)}})}else{d._initialize_failure()}})}}}})})},onDestroy:function(){this.pad_app.destroy()},_initializePADComponent_v2:function(e){var d=this;window.top.performance.mark(d.pcsPrefix+"_require_padcomponent_before");require(["DS/ENOPAD_v2/PADComponent","UWA/Core","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(j,i,h,g){var f=function(m){window.top.performance.mark(d.pcsPrefix+"_require_padcomponent_done");window.top.performance.measure(d.pcsPrefix+"_require_padcomponent",d.pcsPrefix+"_require_padcomponent_before",d.pcsPrefix+"_require_padcomponent_done");var k=d._retrieveinitializationOpts(),l=UWA.extend(e,k);if(m.length){l.additionalColumnsModules=m}d.xnav_component=new j(l)};require(["DS/ENORIPE_NavColumn/AdditionalColumns","UWA/Promise"],function(n,p){var o=[];var m=[];var l=new p(function(r){p.all(m).then(function(){n.isAdditionalColumnsAvailable(function(s){if(s===true){o.push(n)}r()})})});l.name="Add "+n.getName();m.push(l);var k=new p(function(r){p.all(m).then(function(){if(g.getSetting("removeCfgColumns")!==true){var s="DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns";require([s],function(t){t.isAdditionalColumnsAvailable(function(u){if(u===true){o.push(t)}r()});k.name="Add "+t.getName()})}else{r()}})});m.push(k);var q=new p(function(r){p.all(m).then(function(){f(o);r()})});q.name="Launch real initialization";m.push(q)},function(){f([])})})},_initialize_failure:function(){var d=this;require(["css!DS/ENXNav/ENXNav","DS/ENXNav/views/xNavInitError","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(g,i,h){var f=UWA.createElement("div",{"class":"xnav_component"});var e=new i({msg:h.initialization_error});f.setContent(e);d.widget.setBody(f);d.widget.dispatchEvent("onENOPADReady")})},_retrieveinitializationOpts:function(){var d=this;return{events:{onReady:function(){window.top.performance.mark(d.pcsPrefix+"_padcomponent_onready");window.top.performance.measure(d.pcsPrefix+"_padcomponent_ready",d.pcsPrefix+"_require_padcomponent_done",d.pcsPrefix+"_padcomponent_onready");d.pad_app=this;function s(){var z=d.widget.getPreference("dnd");var y=z?z.value:"MOVE";d.pad_app.setDnDBehavior(y)}s();function n(){var y=false;if(d.widget.getPreference("confirmationDialog")!==undefined){y=d.widget.getBool("confirmationDialog")}d.pad_app.setConfirmdDialog(y)}n();d.widget.addEvent("onViewChange",d.pad_app.onResize.bind(d.pad_app));d.widget.addEvent("onResize",d.pad_app.onResize.bind(d.pad_app));d.pad_app.addEvent("onToggleView",function(y){d.widget.setValue("default_view",y)});var p=require("DS/PADServices/utils/GlobalModelEvents");var x=p.getModelEvents();x.subscribe({event:"ENXViews/Views/showInWidgetBody"},function(y){if(y.html){if(y.title){widget.setTitle(y.title)}widget.setBody(y.html)}else{if(y.restore===true){widget.setTitle(d.pad_app.getWidgetTitle());d.widget.setBody(d.pad_app.render())}}});d.widget.addEvent("endEdit",s);d.widget.addEvent("endEdit",n);var u=require("DS/PADUtils/PADSharedSettings");u.resetDebounceFlags();d.widget.setBody(d.pad_app.render());var q=[];var m=[];if(!d.widget.getValue(d.setting_names.ap_root_pids)){d.widget.addPreference({name:d.setting_names.ap_root_pids,type:"hidden",defaultValue:"[]"})}else{q=JSON.parse(widget.getValue(d.setting_names.ap_root_pids))}if(!widget.getValue(d.setting_names.ap__root_pids_detached)){widget.addPreference({name:d.setting_names.ap__root_pids_detached,type:"hidden",defaultValue:"[]"})}if(!d.widget.getValue(d.setting_names.ap_filter_ids)){d.widget.addPreference({name:d.setting_names.ap_filter_ids,type:"hidden",defaultValue:"[]"})}else{m=JSON.parse(widget.getValue(d.setting_names.ap_filter_ids))}var t=d.widget.getValue("X3DContentId");var i=widget.getValue(d.setting_names.ap_struct);var v=(m.length>0)?true:false;var e=(UWA.is(i,"string")&&i!=="{}")?true:false;var g=(q.length>0)?true:false;var f=require("UWA/Promise");if(v&&e){var r=[];var w=new f(function(y){f.all(r).then(function(){d.pad_app.addFilter({filterIds:m,broadcast:false,doNotFillTheTagger:true,callback:function(z){y(z)}})})});w.name="AddFilter";r.push(w);var j=JSON.parse(i);var l=new f(function(y){f.all(r).then(function(A){A.forEach(function(B){if(j.hasOwnProperty(B)){delete j[B]}});var z=JSON.parse(widget.getValue(d.setting_names.ap__root_pids_detached));widget.setValue(d.setting_names.ap_root_pids,"[]");widget.setValue(d.setting_names.ap__root_pids_detached,"[]");widget.setValue(d.setting_names.ap_struct,null);d.pad_app.add({content:"structure",structure:j,id_to_detach:z})});y()});l.name="AddRoots";r.push(l);f.all(r).then(function(){d.widget.dispatchEvent("onENOPADReady")})}else{if(v&&g){var r=[];var w=new f(function(y){f.all(r).then(function(){d.pad_app.addFilter({filterIds:m,broadcast:false,doNotFillTheTagger:true,callback:function(z){y(z)}})})});w.name="AddFilter";r.push(w);var l=new f(function(y){f.all(r).then(function(z){q=q.filter(function(B){return(this.rootIds[0].indexOf(B)<0)},z);var A=JSON.parse(widget.getValue(d.setting_names.ap__root_pids_detached));widget.setValue(d.setting_names.ap_root_pids,"[]");widget.setValue(d.setting_names.ap__root_pids_detached,"[]");d.pad_app.add({pids:q,id_to_detach:A})});y()});l.name="AddRoots";r.push(l);f.all(r).then(function(){d.widget.dispatchEvent("onENOPADReady")})}else{if(e){var k=JSON.parse(widget.getValue(d.setting_names.ap__root_pids_detached));widget.setValue(d.setting_names.ap_root_pids,"[]");widget.setValue(d.setting_names.ap__root_pids_detached,"[]");widget.setValue(d.setting_names.ap_struct,null);d.pad_app.add({content:"structure",structure:JSON.parse(i),id_to_detach:k},function(){d.widget.dispatchEvent("onENOPADReady")},false)}else{if(g){var o=JSON.parse(widget.getValue(d.setting_names.ap__root_pids_detached));widget.setValue(d.setting_names.ap_root_pids,"[]");widget.setValue(d.setting_names.ap__root_pids_detached,"[]");d.pad_app.add({pids:q,id_to_detach:o},function(){d.widget.dispatchEvent("onENOPADReady")},false)}else{if(UWA.is(t)){var h=UWA.is(t,"string")?JSON.parse(t):t;d.widget.setValue("X3DContentId",null);d.pad_app.addNodesFromContent(h,function(){d.widget.dispatchEvent("onENOPADReady")},null,false)}else{if(v){d.pad_app.addFilter({filterIds:m,broadcast:false,doNotFillTheTagger:true,callback:function(y){d.widget.dispatchEvent("onENOPADReady")}})}else{d.widget.dispatchEvent("onENOPADReady")}}}}}}window.top.performance.mark(d.pcsPrefix+"_app_load_complete");window.top.performance.measure(d.pcsPrefix+"_app_load_completed","enops_app_load_html",d.pcsPrefix+"_app_load_complete")},onAddFilters:function(g){var e=require("DS/PADUtils/PADSettingsMgt");if(e.getSetting("activate_reloadFilter")===true){if(g.filterIds.length>0){var f=JSON.parse(widget.getValue(d.setting_names.ap_filter_ids));f=f.concat(g.filterIds);f=f.filter(function(j,h,i){return i.indexOf(j)===h});d.widget.setValue(d.setting_names.ap_filter_ids,JSON.stringify(f))}}},onSaveRoots:function(){var f=[],l=[],k=d.pad_app.getPADTreeDocument();k.getRoots().forEach(function(i){f.push(i.getID())});if(k.hasOwnProperty("detachedRoots")){k.detachedRoots.forEach(function(i){l.push(i.getID());if(f.indexOf(i.getID())===-1){f.push(i.getID())}})}var g=widget.getValue(d.setting_names.ap_struct);if(UWA.is(g,"string")){var h,j=f.length;g=JSON.parse(g);var e={};for(h=0;h<j;h++){if(g.hasOwnProperty(f[h])){e[f[h]]=g[f[h]]}else{e[f[h]]={}}}widget.setValue(d.setting_names.ap_struct,JSON.stringify(e))}widget.setValue(d.setting_names.ap_root_pids,JSON.stringify(f));widget.setValue(d.setting_names.ap__root_pids_detached,JSON.stringify(l))},onAddPaths:function(l){var f=widget.getValue(d.setting_names.ap_struct);if(!UWA.is(f)){f={}}else{f=JSON.parse(f)}var g;var k=l.addedPaths.length;for(g=0;g<k;g++){var h=f;var e=0;var j=l.addedPaths[g].length;for(e=0;e<j;e++){if(!h.hasOwnProperty(l.addedPaths[g][e])){h[l.addedPaths[g][e]]={}}h=h[l.addedPaths[g][e]]}}widget.setValue(d.setting_names.ap_struct,JSON.stringify(f))},onDeleteRoots:function(j){var m=JSON.parse(widget.getValue(d.setting_names.ap_root_pids)),g=JSON.parse(widget.getValue(d.setting_names.ap__root_pids_detached));var l=JSON.parse(j);var k=[],f=[];if(l.length>0){if(m.length>0){k=m.filter(function(i){return this.indexOf(i)<0},l)}if(g.length>0){f=g.filter(function(i){return this.indexOf(i)<0},l)}}var n=widget.getValue(d.setting_names.ap_struct);if(UWA.is(n,"string")){n=JSON.parse(n);var h,e=l.length;for(h=0;h<e;h++){if(n.hasOwnProperty(l[h])){delete n[l[h]]}}widget.setValue(d.setting_names.ap_struct,JSON.stringify(n))}widget.setValue(d.setting_names.ap_root_pids,JSON.stringify(k));widget.setValue(d.setting_names.ap__root_pids_detached,JSON.stringify(f))},onRootsVisibility:function(){var f=[],e=d.pad_app.getPADTreeDocument();if(e.hasOwnProperty("detachedRoots")){e.detachedRoots.forEach(function(g){f.push(g.getID())})}widget.setValue(d.setting_names.ap__root_pids_detached,JSON.stringify(f))},onCustoViewChange:function(e,f){d.widget.setValue(d.setting_names.ap_custo,JSON.stringify(e));if(f){d.widget.setValue(d.setting_names.ap_custoParams,JSON.stringify(f))}},onSaveAsTemplate:function(e){if(e.selectedExtensions&&e.selectedTypes){d.widget.setValue(d.setting_names.ap_custoParams,JSON.stringify({selectedExtensions:e.selectedExtensions,selectedTypes:e.selectedTypes}))}var f=JSON.stringify(e);widget.deleteValue(d.setting_names.ap_custo);require(["DS/PADUtils/PADWSAccess"],function(g){g.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId"),value:f,onComplete:function(h){},onFailure:function(h){console.warn("Cannot save the new template",h)}})})},onAuthoringCtxAvailable:function(i){if(i.isLicenseValid===true){var f=require("DS/PADUtils/PADSettingsMgt");var g=require("DS/PADUtils/PADCommandProxy");d.debouncePrefSynchro=false;d._proxy=g.create({events:{onPreferenceModification:function(l,k){if(l.name==="changeControlActivation"){d.debouncePrefSynchro=true;d.widget.setValue(l.name,l.value);f.setSetting(l.name,l.value)}}}});var h=f.getSetting("changeControlActivation");if(d.widget.getValue("changeControlActivation")!==undefined){h=d.widget.getBool("changeControlActivation")}var j="bottom-right";if(sessionStorage.getItem("changeControlPosition")){j=sessionStorage.getItem("changeControlPosition")}else{j=f.getSetting("changeControlPosition")}var e=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");e.setPosition(j);d.widget.addPreference({name:"changeControlActivation",defaultValue:h,type:"boolean",label:"changeControlActivation_label",onchange:"onChangeControlUpdate"});d.widget.addPreference({name:"changeControlPosition",defaultValue:j,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]});f.addEvent("onChangeControlActivation",function(l){var k=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");if(!d.debouncePrefSynchro){d._proxy.preferenceModification({name:"changeControlActivation",value:l})}else{d.debouncePrefSynchro=false}if(l===true){k.show()}else{k.hide()}});f.addEvent("onChangeControlPosition",function(l){var k=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");k.setPosition(l);sessionStorage.setItem("changeControlPosition",l)})}}}}},onSearch:function(d){if(this.xnav_component){this.xnav_component.search.execute(d)}},};b.init(c);return b}define("DS/ENOPS_app/AdditionalColumns",["css!DS/ENOPS_app/ENOPS_app","i18n!DS/ENOPS_app/assets/nls/ENOPS_app.json","UWA/Core","UWA/Class","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/Utilities/Dom"],function(a,e,g,c,f,d,b){});