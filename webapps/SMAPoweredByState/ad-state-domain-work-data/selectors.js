/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-cos/selectors"],function(d,b){var a={},c;a.Types={EXECDIR:"execdir",FOLDER:"folder",FILE:"file",SIMOBJECT:"DesignSight"};a.ErrorCodes={INITIALIZE_EXEC_DIR_ERROR:"SMAPoweredByState.ad-state-domain-work-data.INITIALIZE_EXEC_DIR_ERROR",REFRESH_WORK_DATA_ERROR:"SMAPoweredByState.ad-state-domain-work-data.REFRESH_WORK_DATA_ERROR",DOWNLOAD_MANAGED_DATA_ERROR:"SMAPoweredByState.ad-state-domain-work-data.DOWNLOAD_MANAGED_DATA_ERROR",COS_JOB_NOT_DISPATCHED:"SMAPoweredByState.ad-state-domain-work-data.COS_JOB_NOT_DISPATCHED",EXE_DIR_CONTENT_NOT_FOUND:"SMAPoweredByState.ad-state-domain-work-data.EXE_DIR_CONTENT_NOT_FOUND",EXE_DIR_PATH_NOT_FOUND:"SMAPoweredByState.ad-state-domain-work-data.EXE_DIR_PATH_NOT_FOUND",FILE_MON_JOB_NOT_STARTED:"SMAPoweredByState.ad-state-domain-work-data.FILE_MON_JOB_NOT_STARTED",FILE_MON_JOB_USR_MISMATCH:"SMAPoweredByState.ad-state-domain-work-data.FILE_MON_JOB_USR_MISMATCH",FILE_MON_URL_NOT_FOUND:"SMAPoweredByState.ad-state-domain-work-data.FILE_MON_URL_NOT_FOUND",TRANSIENT_MON_FINISHED:"SMAPoweredByState.ad-state-domain-work-data.TRANSIENT_MON_FINISHED",CREDENTILAS_NOT_SUPPIED:"SMAPoweredByState.ad-state-domain-work-data.CREDENTILAS_NOT_SUPPIED"};c=function(h,g){var f=null;for(var e=0;e<h.length;e++){if((h[e].station===g)&&h[e].credentials){f=h[e].credentials}if((h[e].station===g)&&h[e].credentials&&h[e].credentials.encryptedCredentials){f=h[e].credentials;break}}return f};a.isWorkDataInitialized=function(e){return !e.domain.workData.uninitialized};a.workDataPersistenceStatus=function(e,g){var f;if(g){f=a.workDataWithID(e,g);return(f&&f.persistenceStatus)?f.persistenceStatus:null}else{return !e.domain.workData.persistenceStatus?null:e.domain.workData.persistenceStatus}};a.workDataPersistenceOperation=function(e,g){var f;if(g){f=a.workDataWithID(e,g);return(f&&f.persistenceOperation)?f.persistenceOperation:null}else{return !e.domain.workData.persistenceOperation?null:e.domain.workData.persistenceOperation}};a.workDataPersistenceError=function(e,g){var f;if(g){f=a.workDataWithID(e,g);return(f&&f.persistenceError)?f.persistenceError:null}else{return !e.domain.workData.persistenceError?null:e.domain.workData.persistenceError}};a.allWorkData=function(e){return e.domain.workData.objects};a.allExecDirs=function(e){return e.domain.workData.objects.filter(function(f){return(f.type===a.Types.EXECDIR)})};a.workDataWithID=function(f,h){var g=null,e;for(e=0;e<f.domain.workData.objects.length;e++){if(f.domain.workData.objects[e].id===h){g=f.domain.workData.objects[e];break}}return g};a.workDataType=function(e,g){var f=a.workDataWithID(e,g);return(f?f.type:null)};a.workDataParent=function(g,h){var f=d.findNodeInHierarchy(h,g.domain.workData.hierarchy),e=null;if(f){if(f.parent){e=a.workDataWithID(g,f.parent)}}return e};a.workDirForJob=function(g,h){var f=null,e;for(e=0;e<g.domain.workData.objects.length;e++){if((g.domain.workData.objects[e].mcsJobID===h)&&(g.domain.workData.objects[e].type===a.Types.EXECDIR)){f=g.domain.workData.objects[e];break}}return f};a.workDataChildren=function(g,i){var f=d.findNodeInHierarchy(i,g.domain.workData.hierarchy),h=null,e=[];if(f&&f.children&&(f.children.length>0)){h=f.children.reduce(function(j,k){if(k.id){j.push(k.id)}return j},[])}if(h&&(h.length>0)){e=g.domain.workData.objects.filter(function(j){return(h.indexOf(j.id)>=0)})}return e};a.workDataExecDir=function(e,g){var f=a.workDataWithID(e,g);while((f&&(f.type!==a.Types.EXECDIR))){f=a.workDataParent(e,f.id)}return f};a.workDataExecDirByLocation=function(g,f,h){var j=null,e;for(e=0;e<g.domain.workData.objects.length;e++){if((g.domain.workData.objects[e].type===a.Types.EXECDIR)&&(g.domain.workData.objects[e].station===f)&&(g.domain.workData.objects[e].path.toLowerCase()===h.toLowerCase())){j=g.domain.workData.objects[e];break}}return j};a.workDataRelPath=function(f,h){var g=a.workDataWithID(f,h),e="";while((g&&(g.type!==a.Types.EXECDIR))){e=g.name+(e.length>0?"/":"")+e;g=a.workDataParent(f,g.id)}if(g.station&&(b.OS.WINDOWS===g.station.os)){e=e.replace("/","\\")}return e};a.workDataFullPath=function(h,i){var f=a.workDataExecDir(h,i),g=a.workDataRelPath(h,i),e;e=f.path;if((e[length-1]!=="/")&&(e[length-1]!=="\\")){e+=(b.OS.LINUX===f.os)?"/":"\\"}e+=g;return e};a.getCredentials=function(e,g){var h=null,o,n,k,m,l,f;if(g.type&&(g.type===a.Types.EXECDIR)&&g.credentials){f=b.serverWithID(e,g.server);o=b.stationWithID(e,f,g.station);h=g.credentials}if(!h||!h.encryptedCredentials){if(!o&&g.os){o=g}if(o){n=a.allExecDirs(e);h=c(n,o.id);if(!h){k=b.allStations(e);for(m=0;m<k.length;m++){if(k[m].os===o.os){for(l=0;l<n.length;l++){if((n[l].station===k[m].id)&&n[l].credentials){h=n[l].credentials;o=k[m];break}}}}}}}h=h?d.shallowCopy(h):{encryptedCredentials:null,domainName:null,windowsUser:null,windowsPass:null,linuxUser:null,linuxPass:null};return h};return a});