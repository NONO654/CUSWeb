/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-domain-work-data/action-types","DS/SMAPoweredByState/ad-state-domain-work-data/selectors","DS/SMAPoweredByState/ad-state-domain-study/action-types","DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-defs"],function(f,a,d,k,l){var h={};const e={uninitialized:true,objects:[],hierarchy:{id:"WorkDataRoot",parent:null,children:[]}};function g(r,t){var s={},n={},p,q,o,u;r.objects.forEach(function(v){if(v.type===a.Types.EXECDIR){s[v.id]=v}});t.forEach(function(v){n[v.id]=v});Object.keys(s).forEach(function(v){o=s[v];u=n[v];if(u){if(o.filemonJobID){u.filemonJobID=o.filemonJobID}if(o.filemonURL){u.filemonURL=o.filemonURL}}});p=t.filter(function(v){return(Object.keys(s).indexOf(v.id)<0)});q=r.objects.filter(function(v){return((v.type===a.Types.EXECDIR)&&(Object.keys(n).indexOf(v.id)<0))});q.forEach(function(v){k.clearNodeDescendants(r,v.id,true)});p.forEach(function(v){r.objects.push(v);r.hierarchy.children.push({id:v.id,parent:r.hierarchy.id,children:[]})})}function b(n,p,v,x,u,r,w,t){var o,q,s;k.clearNodeDescendants(n,p,false);q=k.getObject(n.objects,p);q.modified=v;n.objects=n.objects.concat(x);s=k.findNodeInHierarchy(p,n.hierarchy);s.children=u.children;o=k.getObject(n.objects,r);if(w){o.filemonJobID=w}if(t){o.filemonURL=t}}function m(o,n){var p,q;switch(n.type){case f.REFRESH_WORK_DATA+l.AsyncStatus.PENDING:p={objects:o.objects.slice(),hierarchy:o.hierarchy};q=k.getObject(p.objects,n.payload.workDataID);if(q){q.persistenceOperation=l.PersistenceOperation.READING;k.replaceObject(p.objects,q)}break;case f.REFRESH_WORK_DATA+l.AsyncStatus.SUCCESS:p={objects:o.objects.slice(),hierarchy:o.hierarchy};b(p,n.payload.workDataID,n.payload.modified,n.payload.descendants,n.payload.descendantHierarchy,n.payload.execDirID,(typeof n.payload.filemonJobID!=="undefined")?n.payload.filemonJobID:null,(typeof n.payload.filemonURL!=="undefined")?n.payload.filemonURL:null);q=k.getObject(p.objects,n.payload.workDataID);if(q){if(q.persistenceOperation){delete q.persistenceOperation}if(n.payload.credentials){q.credentials=n.payload.credentials}k.replaceObject(p.objects,q)}break;case f.REFRESH_WORK_DATA+l.AsyncStatus.FAILURE:p={persistenceError:n.payload.error,objects:o.objects.slice(),hierarchy:o.hierarchy};if(n.payload.context.execDirID){q=k.getObject(p.objects,n.payload.context.execDirID);if(q){if(n.payload.context.filemonJobID){q.filemonJobID=n.payload.context.filemonJobID}if(n.payload.context.filemonURL){q.filemonURL=n.payload.context.filemonURL}if(n.payload.context.credentials&&(n.payload.error.code===l.ErrorCodes.RUNAS_CREDENTIALS_ERROR)){q.credentials=n.payload.context.credentials;q.credentials.encryptedCredentials=null}k.replaceObject(p.objects,q)}}q=k.getObject(p.objects,n.payload.context.workDataID);if(q){if(q.persistenceOperation){delete q.persistenceOperation}k.replaceObject(p.objects,q)}break;default:p=o;break}return p}function c(o,n){var p,q;switch(n.type){case f.INITIALIZE_EXEC_DIR+l.AsyncStatus.PENDING:p={objects:o.objects.slice(),hierarchy:o.hierarchy};q=k.shallowCopy(k.getObject(p.objects,n.payload.execDirID));if(q){q.persistenceOperation=l.PersistenceOperation.INITIALIZING;k.replaceObject(p.objects,q)}break;case f.INITIALIZE_EXEC_DIR+l.AsyncStatus.SUCCESS:p={objects:o.objects.slice(),hierarchy:o.hierarchy};if(n.payload){q=k.shallowCopy(k.getObject(p.objects,n.payload.execDirID))}if(q){if(q.persistenceOperation){delete q.persistenceOperation}q.path=n.payload.path;k.replaceObject(p.objects,q)}break;case f.INITIALIZE_EXEC_DIR+l.AsyncStatus.FAILURE:p={persistenceError:n.payload.error,objects:o.objects.slice(),hierarchy:o.hierarchy};q=k.shallowCopy(k.getObject(p.objects,n.payload.context));if(q){if(q.persistenceOperation){delete q.persistenceOperation}k.replaceObject(p.objects,q)}break;default:p=o;break}return p}function j(o,n){var p,q;switch(n.type){case f.MARK_FOR_REMOVAL:p={objects:o.objects.slice(),hierarchy:o.hierarchy};q=k.shallowCopy(k.getObject(p.objects,n.execDirID));if(q){q.removeAfterExecution=true;k.replaceObject(p.objects,q)}break;case f.REMOVE_EXEC_DIR:p={objects:o.objects.slice(),hierarchy:o.hierarchy};k.clearNodeDescendants(p,n.execDirID,true);break;default:p=o;break}return p}function i(o,n){var p,q;if(typeof o==="undefined"){p=k.deepCopy(e)}else{switch(n.type){case d.CREATE_STUDY+l.AsyncStatus.SUCCESS:case d.CLOSE_STUDY:p=k.deepCopy(e);break;case d.REFRESH_STUDY+l.AsyncStatus.PENDING:p=o;break;case d.REFRESH_STUDY+l.AsyncStatus.SUCCESS:p={objects:o.objects.slice(),hierarchy:o.hierarchy};g(p,n.payload.execDirs);break;case f.REFRESH_WORK_DATA+l.AsyncStatus.PENDING:case f.REFRESH_WORK_DATA+l.AsyncStatus.SUCCESS:case f.REFRESH_WORK_DATA+l.AsyncStatus.FAILURE:p=m(o,n);break;case f.CREATE_EXEC_DIR:p={objects:o.objects.slice(),hierarchy:o.hierarchy};p=k.shallowCopy(o);p.objects.push(n.execDir);p.hierarchy.children.push({id:n.execDir.id,parent:p.hierarchy.id,children:[]});break;case f.INITIALIZE_EXEC_DIR+l.AsyncStatus.PENDING:case f.INITIALIZE_EXEC_DIR+l.AsyncStatus.SUCCESS:case f.INITIALIZE_EXEC_DIR+l.AsyncStatus.FAILURE:p=c(o,n);break;case f.SET_EXEC_DIR_CREDENTIALS:p={objects:o.objects.slice(),hierarchy:o.hierarchy};q=k.shallowCopy(k.getObject(p.objects,n.execDirID));if(q){q.credentials=n.credentials;k.replaceObject(p.objects,q)}break;case f.CLEAR_EXEC_DIR_FILEMONITOR:p={objects:o.objects.slice(),hierarchy:o.hierarchy};q=k.shallowCopy(k.getObject(p.objects,n.execDirID));if(q){if(q.filemonJobID){delete q.filemonJobID}if(q.filemonURL){delete q.filemonURL}k.replaceObject(p.objects,q)}break;case f.MARK_FOR_REMOVAL:case f.REMOVE_EXEC_DIR:p=j(o,n);break;default:p=o;break}}return p}h["default"]=i;return h});