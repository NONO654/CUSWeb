/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-defs"],function(d){var b={};function a(j,h){var g=null,e,f;if(j&&h){e=h.split(".");for(f=0;f<e.length;f++){g=j[e[f]];if((typeof g==="undefined")||!g){break}}}return g}function c(g,q,n){var f,h,j,l,m,o,e,p,k;if(g&&q){f=q.split(".");h=g;for(j=0;j<f.length;j++){e=f[j].indexOf("[");if(e===-1){if(j<(f.length-1)){k=h[f[j]];if((typeof k==="undefined")||!k){h[f[j]]={}}else{h[f[j]]=b.shallowCopy(h[f[j]])}h=h[f[j]]}else{h[f[j]]=n}}else{l=f[j].substring(0,e);m=f[j].substring(e+1,f[j].indexOf("]")).trim();o=parseInt(m);p=isNaN(o);if(p){o=m.substring(1,m.length-1)}if(j<(f.length-1)){if(p){k=h[l][o];if((typeof k==="undefined")||!k){h[l][o]={}}else{h[l][o]=b.shallowCopy(h[l][o])}}else{h[l].splice(o,1,b.shallowCopy(h[l][o]))}h=h[l][o]}else{if(p){h[l][o]=n}else{h[l].splice(o,1,n)}}}}}}b.generateID=function(){return"ad-state-"+Date.now()+"-"+Math.random()};b.shallowCopy=function(e){var f=null;if(e){f=Object.create(Object.getPrototypeOf(e));Object.getOwnPropertyNames(e).forEach(function(g){f[g]=e[g]})}return f};b.deepCopy=function(e){var f=null;if(e){if(Array.isArray(e)){f=[];e.forEach(function(g){f.push(JSON.parse(JSON.stringify(g)))})}else{f=JSON.parse(JSON.stringify(e))}}return f};b.getObject=function(g,h){var f,e=null;if(g&&h){for(f=0;f<g.length;f++){if(g[f].id===h){e=g[f];break}}}return e};b.getObjectIDs=function(e){var f=[];if(e.length>0){f=e.reduce(function(g,h){g.push(h.id);return g},[])}return f};b.replaceObject=function(h,g,e){var f,j;if(h&&g){j=e?e.id:g.id;for(f=0;f<h.length;f++){if(h[f].id===j){h.splice(f,1,g);break}}}};b.removeObject=function(f,g){var e;if(f&&g){for(e=0;e<f.length;e++){if(f[e].id===g){f.splice(e,1);break}}}};b.setStateProperty=function(f,h,e,g){var i=f;if(f){if(a(f,h)!==e){i=b.shallowCopy(f);c(i,h,e);if(g){i.persistenceStatus=d.PersistenceStatus.DIRTY}}}return i};b.buildError=function(i,g,h,e){var f={error:{code:i,errorLvl:e},time:Date.now()};if(g){f.error.status=g.status;f.error.response=g.response}if(h){f.context=h;f.error.context=h}return f};b.getNodeParent=function(h,j){var g=b.findNodeInHierarchy(j,h.hierarchy),f=null,e;if(g&&g.parent){for(e=0;e<h.objects.length;e++){if(h.objects[e].id===g.parent){f=h.objects[e];break}}}return f};b.getNodeChildren=function(g,i){var f=b.findNodeInHierarchy(i,g.hierarchy),h=[],e=[];if(f){f.children.forEach(function(j){h.push(j.id)});g.objects.forEach(function(j){if(h.indexOf(j.id)>=0){e.push(j)}})}return e};b.getNodeDescendants=function(g,i){var f=b.findNodeInHierarchy(i,g.hierarchy),h=[],e=function(l,k,j){var m=[];if(k){k.children.forEach(function(n){e(l,n,j);m.push(n.id)});l.objects.forEach(function(n){if(m.indexOf(n.id)>=0){h.push(n)}})}};e(g,f,h);return h};b.findNodeInHierarchy=function(g,e){var f=function(l,h){var k=null,j;if(h){if(h.id===l){k=h}else{if(h.children){for(j=0;j<h.children.length;j++){k=f(l,h.children[j]);if(k){break}}}}}return k};return f(g,e)};b.clearNodeDescendants=function(j,m,l){var h,k=[],g,e,f=function(p,o){var n;if(p&&p.children){for(n=0;n<p.children.length;n++){o.push(p.children[n].id);f(p.children[n],o)}}};h=b.findNodeInHierarchy(m,j.hierarchy);if(h){f(h,k);h.children=[];if(k.length>0){g=0;while(g<j.objects.length){if(k.indexOf(j.objects[g].id)>=0){j.objects.splice(g,1)}else{g++}}}if((typeof l!=="undefined")&&(l)){e=b.findNodeInHierarchy(h.parent,j.hierarchy);if(e){for(g=0;g<e.children.length;g++){if(e.children[g].id===h.id){e.children.splice(g,1);break}}}}}if(l){for(g=0;g<j.objects.length;g++){if(j.objects[g].id===m){j.objects.splice(g,1);break}}}};b.parseTimestamp=function(f){var g=0,e=parseInt(f);if(!isNaN(e)){g=e}return g};b.getTimestamp=function(g){var f=g,m,e,k,l,h,n,j=0;if(g&&g.length>0){n=new Date(f);if(isNaN(n)){m=g.indexOf("T");if(m>0){f=g.substring(0,m+1);e=g.substring(m+1);k=e.indexOf("-");if(k<0){k=e.indexOf("+")}if(k>=0){l=e.substring(k+1);if(l.indexOf(":")<0){for(h=l.length;h<4;h++){l+="0"}l=l.substring(0,2)+":"+l.substring(2)}e=e.substring(0,k+1)+l}f+=e}n=new Date(f)}j=n.getTime()}return j};return b});