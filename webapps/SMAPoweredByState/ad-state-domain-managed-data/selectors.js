/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-domain-study/selectors"],function(b,c,d){var a={};a.Types={CATEGORY:"Simulation Category - Internal Data",FOLDER:"Simulation Folder",DOCUMENT:"Simulation Document - Versioned",NVDOCUMENT:"Simulation Document - NonVersioned",FILE:"file",FILEVERSION:"fileversion",SIMULATION_OBJECT:"DesignSight",RDOCUMENT:"Document",PROJECTION:"projection",PROJECTION3DX:"3dxprojection",UNKNOWN:"unknown"};a.ErrorCodes={GET_FILE_VERSIONS_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.GET_FILE_VERSIONS_WS_ERROR",GET_CONTENT_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.GET_CONTENT_WS_ERROR",ADD_REF_CONTENT_EXISTS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.ADD_REF_CONTENT_EXISTS_ERROR",ADD_REF_CONTENT_UNAUTHORIZED:"SMAPoweredByState.ad-state-domain-managed-data.ADD_REF_CONTENT_UNAUTHORIZED",ADD_REF_CONTENT_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.ADD_REF_CONTENT_WS_ERROR",UPLOAD_FILE_UNAUTHORIZED:"SMAPoweredByState.ad-state-domain-managed-data.UPLOAD_FILE_UNAUTHORIZED",UPLOAD_FILE_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.UPLOAD_FILE_WS_ERROR",UPLOAD_WORK_DATA_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.UPLOAD_WORK_DATA_ERROR",UPLOAD_JOB_FILE_CHECKIN_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.UPLOAD_JOB_FILE_CHECKIN_WS_ERROR",CREATE_CONTENT_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.CREATE_CONTENT_WS_ERROR",DELETE_CONTENT_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.DELETE_CONTENT_WS_ERROR",SET_FILE_VERSION_COMMENTS_WS_ERROR:"SMAPoweredByState.ad-state-domain-managed-data.SET_FILE_VERSION_COMMENTS_WS_ERROR"};a.isManagedDataInitialized=function(e){return !e.domain.managedData.uninitialized};a.managedDataPersistenceStatus=function(f,g){var e;if(g){e=a.managedDataWithID(f,g);return(e&&e.persistenceStatus)?e.persistenceStatus:null}else{return !f.domain.managedData.persistenceStatus?null:f.domain.managedData.persistenceStatus}};a.managedDataPersistenceOperation=function(f,g){var e;if(g){e=a.managedDataWithID(f,g);return(e&&e.persistenceOperation)?e.persistenceOperation:null}else{return !f.domain.managedData.persistenceOperation?null:f.domain.managedData.persistenceOperation}};a.managedDataPersistenceError=function(f,g){var e;if(g){e=a.managedDataWithID(f,g);return(e&&e.persistenceError)?e.persistenceError:null}else{return !f.domain.managedData.persistenceError?null:f.domain.managedData.persistenceError}};a.allManagedData=function(i,e,g){var j=((typeof e!=="undefined")&&e&&(e.length>0))?e.slice():null,h=((typeof g!=="undefined")&&g&&(g.length>0))?g.slice():null,f=i.domain.managedData.objects.filter(function(k){return((!j||(j.indexOf(k.type)>=0))&&(!h||(h.indexOf(k.type)<0)))});return f};a.managedDataWithID=function(g,h){var e=null,f;for(f=0;f<g.domain.managedData.objects.length;f++){if(g.domain.managedData.objects[f].id===h){e=g.domain.managedData.objects[f];break}}return e};a.managedDataParent=function(g,j,i){var h=(typeof i!=="undefined")?i:true,f=b.findNodeInHierarchy(j,g.domain.managedData.hierarchy),e=null;if(f&&f.parent){e=a.managedDataWithID(g,f.parent);if(h&&((a.Types.DOCUMENT===e.type)||(a.Types.NVDOCUMENT===e.type))){e=a.managedDataParent(g,e.id)}}return e};a.managedDataChildren=function(e,f,o){var n=(typeof o!=="undefined")?o:true,l,h,m=[],j,k,g=[];if(f){l=b.findNodeInHierarchy(f,e.domain.managedData.hierarchy)}else{l=b.findNodeInHierarchy(d.studyManagedDataRootID(e),e.domain.managedData.hierarchy)}if(l){l.children.forEach(function(i){h=a.managedDataWithID(e,i.id);if(n&&((a.Types.DOCUMENT===h.type)||(a.Types.NVDOCUMENT===h.type))){j=a.managedDataChildren(e,h.id);for(k=0;k<j.length;k++){m.push(j[k].id)}}else{if(h.id){m.push(h.id)}}})}if(m.length>0){g=e.domain.managedData.objects.filter(function(i){return(m.indexOf(i.id)>=0)})}return g};a.managedDataFilesWithName=function(h,f,e){var g=[],i=e?e:d.studyManagedDataRootID(h);a.managedDataChildren(h,i).forEach(function(j){if((j.type===a.Types.FILE)&&(j.name===f)){g.push(j)}});return g};a.nonJobOutputManagedData=function(h){var f=h.domain.jobs,e=a.managedDataChildren(h,null,true),i=[],g;f.objects.forEach(function(j){j.outputs.forEach(function(k){var m=a.managedDataWithID(h,k),l;if(m){l=m.id;if(m.type===a.Types.FILEVERSION){l=a.managedDataParent(h,k).id}i.push(l)}})});g=e.filter(function(j){return i.indexOf(j.id)===-1});return g};a.isFileUploading=function(h,i){var e=false,f=(typeof i==="string")?a.managedDataWithID(h,i):i;if(f.persistenceOperation===c.PersistenceOperation.CREATING){e=true}else{var g=a.managedDataChildren(h,f.id,true).filter(function(j){return j.persistenceOperation===c.PersistenceOperation.CREATING});e=g.length>0}return e};a.uploadingFiles=function(e){return a.allManagedData(e).filter(function(f){return(((f.type===a.Types.FILE)||(f.type===a.Types.FILEVERSION))&&(f.persistenceOperation===c.PersistenceOperation.CREATING))})};a.isFileDeleting=function(f,g){var e=(typeof g==="string")?a.managedDataWithID(f,g):g;return e.persistenceOperation===c.PersistenceOperation.DELETING};a.isFileParentReferenced=function(g,h){var e=(typeof h==="string")?a.managedDataWithID(g,h):h,f=a.managedDataParent(g,e.id,false);return f.referenced===true};a.getFileUploadProgress=function(g,h){var i=null,e=(typeof h==="string")?a.managedDataWithID(g,h):h;if(typeof e.persistenceOperation!=="undefined"){i=typeof e.uploadProgress!=="undefined"?e.uploadProgress:null}else{var f=a.managedDataChildren(g,e.id,true).filter(function(j){return typeof j.persistenceOperation!=="undefined"});i=f[0]&&typeof f[0].uploadProgress!=="undefined"?f[0].uploadProgress:null}return i};a.hasVersions=function(g,h){var e=(typeof h==="string")?a.managedDataWithID(g,h):h,f=b.findNodeInHierarchy(e.id,g.domain.managedData.hierarchy);return(f.children&&f.children.length>0)};return a});