/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-store","DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-wc-adapter","DS/SMAPoweredByState/ad-state-app/selectors","UWA/Class/Promise"],function(d,e,h,a,b,f){var c={};var i="OnPremise";var g=window.Promise||f;c.getMyAppsURL=function(){return a.getDashboard().then(function(j){return j.fetchMyappsUri()})};c.initPlatformInfo=function(){var j;return a.getDashboard().then(function(k){j=k;return j.getPlatforms(true)}).then(function(k){var l=j.getCurrentPlatform();return{spaceURL:j.getMcsUri(),platforms:k,currentPlatform:l,cloudEnabled:(l&&(l.toLowerCase()!==i.toLowerCase()))}})};c.initWhereUsedTenantInfo=function(){var j;return a.getDashboard().then(function(k){j=k;return j.getWhereUsedTenantInfo(true)}).then(function(k){return({whereUsedTenants:k,currentWhereUsedTenant:(k.length>0)?k[0]:null,dslsURL:j.getDslsUrl()})})};c.getLicenses=function(){return new g(function(n,m){var o=function(p){var q=JSON.parse(p.response),r=[];Object.keys(b.AppLicenses).forEach(function(s){if((typeof q[b.AppLicenses[s]]!=="undefined")&&(q[b.AppLicenses[s]].toLowerCase()==="true")){r.push(b.AppLicenses[s])}});n({licenses:r})},k=function(p){m(e.buildError(b.ErrorCodes.APPS_LICENSE_WS_ERROR,p))},l,j=true;l="/resources/slmservices/license?appNames=";Object.keys(b.AppLicenses).forEach(function(p){if(!j){l+=","}else{j=false}l+=b.AppLicenses[p]});a.call3DSpaceService({uri:l,onComplete:o,onError:k,sessionTimeoutInfo:{handler:m,context:null}})})};c.initSecurityContextInfo=function(){return a.getDashboard().then(function(j){return j.addSecurityContextPreference()})};return c});