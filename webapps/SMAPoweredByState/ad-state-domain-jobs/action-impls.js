/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-store","DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-defs","DS/SMAPoweredByState/ad-state-wc-adapter","DS/SMAPoweredByState/ad-state-domain-jobs/selectors","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","DS/SMAPoweredByState/ad-state-domain-managed-data/selectors","DS/SMAPoweredByState/ad-state-domain-study/selectors","DS/SMAPoweredByState/ad-state-domain-work-data/selectors","DS/SMAPoweredByState/ad-state-cos/selectors","DS/SMAPoweredByHandler/ADHandlerFactory","UWA/Class/Promise"],function(r,c,j,y,t,l,k,m,v,p,h,i){var x={};var n="Pending",u="com.dassault_systemes.sma.adapter.Task";var d=window.Promise||i;function a(D){var C=false,A,z,B=[];if(D&&D.WorkItemSummaries&&D.WorkItemSummaries.WorkItemSummary){if(Array.isArray(D.WorkItemSummaries.WorkItemSummary)){for(A=0;A<D.WorkItemSummaries.WorkItemSummary.length;A++){if(D.WorkItemSummaries.WorkItemSummary[A]["@type"]!==u){B.push(D.WorkItemSummaries.WorkItemSummary[A].WorkItemSummaryDetails)}}}else{if(D.WorkItemSummaries.WorkItemSummary["@type"]!==u){B.push(D.WorkItemSummaries.WorkItemSummary.WorkItemSummaryDetails)}}}for(A=0;A<B.length;A++){if(Array.isArray(B[A].WorkItemSummaryDetail)){for(z=0;z<B[A].WorkItemSummaryDetail.length;z++){if(B[A].WorkItemSummaryDetail[z]["@status"]!==n){C=true;break}}}else{if(B[A].WorkItemSummaryDetail["@status"]!==n){C=true;break}}if(C){break}}return C}function b(z){return new d(function(C,B){var D=function(F){var E=JSON.parse(F.response);C(E)},A=function(E){B(c.buildError(t.ErrorCodes.JOBS_WS_ERROR,E))};y.callSMAProcService({uri:"/simulations/"+z.studyID+"/jobs",onComplete:D,onError:A,sessionTimeoutInfo:{handler:B,context:null}})})}function o(z){return new d(function(C,B){var D=function(F){var E=JSON.parse(F.response);C(E)},A=function(E){B(c.buildError(t.ErrorCodes.JOBS_WS_ERROR,E))};y.callSMAProcService({uri:"/jobs/"+z.job.id+"/contents",onComplete:D,onError:A,sessionTimeoutInfo:{handler:B,context:null}})})}function f(z){return new d(function(C,B){var D=function(G){var H=null,F,E={};if(G.response&&(G.response.length>0)){H=JSON.parse(G.response)}if(H&&H.jobType&&H.activityDefinition){h.getHandler({jobTypeId:H.jobType,store:r.getStore()}).then(function(I){F=I.createJobFromPLMActivity(H.activityDefinition,r.getStore().getState());if(F){E.jobType=H.jobType;E._activityID=F.id;E.inputs=F.inputs;E.configuration=F.configuration;E.resultsOptions=F.resultsOptions;E.executionOptions=F.executionOptions;E.mainInputFile=F.mainInputFile}C(E)})}else{if(G.response===""){C({jobType:l.UNKNOWN_JOB_TYPE,inputs:[],configuration:{},resultsOptions:{},executionOptions:{},mainInputFile:null})}else{B(c.buildError(t.ErrorCodes.JOB_FILE_CHECKOUT_WS_ERROR,null,z.job.id))}}},A=function(E){B(c.buildError(t.ErrorCodes.JOB_FILE_CHECKOUT_WS_ERROR,E,z.job.id))};y.callSMAProcService({uri:"/jobs/"+z.job.id+"/file/"+t.TOOL_JOB_CONFIG_FILENAME,headers:{Accept:"*/*"},onComplete:D,onError:A,sessionTimeoutInfo:{handler:B,context:z.job.id}})})}function q(z){return new d(function(C,B){var D=function(E){var F=null;if(E.response&&(E.response.length>0)){F=JSON.parse(E.response)}if(F&&F.attachToJobID&&F.managedDataProjections){C(F)}else{B(c.buildError(t.ErrorCodes.JOB_FILE_CHECKOUT_WS_ERROR,null,z.job.id))}},A=function(E){B(c.buildError(t.ErrorCodes.JOB_FILE_CHECKOUT_WS_ERROR,E,z.job.id))};y.callSMAProcService({uri:"/jobs/"+z.job.id+"/file/"+t.UPLOAD_JOB_CONFIG_FILENAME,headers:{Accept:"*/*"},onComplete:D,onError:A,sessionTimeoutInfo:{handler:B,context:z.job.id}})})}function w(z){return new d(function(L,M){var N,C,H=null,O,I=0,J=0,F,E=null,B={claimed:false},G=function(P){C=JSON.parse(P.response);if(C.datarecords&&C.datarecords.datagroups&&(C.datarecords.datagroups.length>0)&&C.datarecords.datagroups[0].dataelements){O=C.datarecords.datagroups[0].dataelements.startDate;if(O&&O.value&&(O.value.length>0)&&O.value[0].actualValue){I=parseInt(O.value[0].actualValue)}O=C.datarecords.datagroups[0].dataelements.endDate;if(O&&O.value&&(O.value.length>0)&&O.value[0].actualValue){J=parseInt(O.value[0].actualValue)}F=C.datarecords.datagroups[0].dataelements.status;if(F&&F.value&&(F.value.length>0)&&F.value[0].value){E=F.value[0].value}B=h.createProgressFromMCSJobSummary(C);B.claimed=true}L({status:E,progress:B,started:I,ended:J,owner:C.user})},K=function(P){M(c.buildError(t.ErrorCodes.JOB_PROGRESS_WS_ERROR,P))},D=function(P){C=JSON.parse(P.response);if(C&&C.JobInfo){H=C.JobInfo}else{if(C&&C.JobInfoBrief){H=C.JobInfoBrief}}if(H){O=H.Started;if(O&&O["@millis"]&&(O["@millis"].length>0)&&(O["@millis"]!=="0")){I=parseInt(O["@millis"])}O=H.Ended;if(O&&O["@millis"]&&(O["@millis"].length>0)&&(O["@millis"]!=="0")){J=parseInt(O["@millis"])}E=H["@status"];if((E===t.JobStatus.DONE)&&(H["@completionCode"])){if((H["@completionCode"]===t.JobCompletionCode.FAILED)||(H["@completionCode"]===t.JobCompletionCode.SYSTEM_FAILED)){E=t.JobStatus.FAILED}else{if(H["@completionCode"]===t.JobCompletionCode.CANCELED){E=t.JobStatus.ABORTED}else{E=t.JobStatus.COMPLETED}}}if(H.JobSummary){B=h.createProgressFromCOSJobSummary(H.JobSummary);if(!z.job.progress||!z.job.progress.claimed){B.claimed=a(H.JobSummary)}else{B.claimed=z.job.progress.claimed}}L({status:E,progress:B,started:I,ended:J,owner:H.User})}else{M(c.buildError(t.ErrorCodes.JOB_PROGRESS_WS_ERROR,P,z.job.id))}},A=function(){y.call3DSpaceService({uri:"/resources/e6w/service/SMA_JobDetails?jobId="+z.job.id,onComplete:G,onError:K,sessionTimeoutInfo:{handler:M,context:z.job.id}})};N={objectId:z.job.id,onComplete:D,onError:A};if(z.job.progress&&z.job.progress.claimed){N.uri="job/"+z.job.eedJobID+"/summary/brief"}else{N.uri="job/"+z.job.eedJobID+"/summary/full"}if(z.job.executionOptions&&z.job.executionOptions.server){N.serverId=z.job.executionOptions.server}y.callCOSService(N)})}function g(z){return new d(function(D,C){var A={successes:[],failures:[]},E=function(){A.successes=A.successes.concat(z.activityIDs);D(A)},B=function(F){A.failures.push({ids:z.activityIDs,error:c.buildError(t.ErrorCodes.ACTIVITY_DELETE_WS_ERROR,F)});D(A)};y.callSMAProcService({uri:"/activity?simId="+z.studyID,verb:"DELETE",data:JSON.stringify(z.activityIDs),onComplete:E,onError:B,sessionTimeoutInfo:{handler:C,context:z.activityIDs}})})}function e(z){return new d(function(D,C){var A={successes:[],failures:[]},E=function(){A.successes=A.successes.concat(z.jobIDs);D(A)},B=function(F){A.failures.push({ids:z.jobIDs,error:c.buildError(t.ErrorCodes.JOB_DELETE_WS_ERROR,F)});D(A)};y.callSMAProcService({uri:"/jobs",verb:"DELETE",data:JSON.stringify(z.jobIDs),onComplete:E,onError:B,sessionTimeoutInfo:{handler:C,context:z.jobIDs}})})}function s(A,z){var B=true,D,C;if(A&&z&&(Object.keys(A).length===Object.keys(z).length)){D=Object.keys(A);for(C=0;C<D.length;C++){if(!(A[D[C]]&&z[D[C]])||(A[D[C]].toLowerCase()!==z[D[C]].toLowerCase())){B=false;break}}}else{B=false}return B}x.getExecutedJobs=function(B){var E={},D=[],C=[],F=[],z,A;return b(B).then(function(G){if(G&&(G.length>0)){G.forEach(function(H){E[H.physicalId]=H});t.executedJobs(r.getStore().getState()).forEach(function(H){if(E.hasOwnProperty(H.id)){H.status=E[H.id].status;C.push(H.id);F.push(H)}});Object.keys(E).forEach(function(H){if(H&&(C.indexOf(H)===-1)){D.push(E[H])}})}}).then(function(){for(A=0;A<D.length;A++){z=h.createTempJobFromPLMJob(D[A]);z.uninitialized=true;F.push(z)}return F})};x.getConfiguringJobs=function(z){return new d(function(C,B){var D=function(H){var F=JSON.parse(H.response),G,J=[],K=[],E=[],L=[],I;if(F&&(F.length>0)){G=F.map(function(M){return M.id});t.configuringJobs(r.getStore().getState()).forEach(function(M){if(G.indexOf(M.id)!==-1){J.push(M.id);L.push(M)}});F.forEach(function(M){if(M.id&&(J.indexOf(M.id)===-1)){K.push(M)}});E=K.map(function(M){return h.getHandler({plmActivity:M,store:r.getStore()})});d.all(E).then(function(M){for(I=0;I<K.length;I++){L.push(M[I].createJobFromPLMActivity(K[I],r.getStore().getState()))}C(L)})}else{C(L)}},A=function(E){B(c.buildError(t.ErrorCodes.ACTIVITIES_WS_ERROR,E))};y.callSMAProcService({uri:"/activity?simId="+z.studyID,onComplete:D,onError:A,sessionTimeoutInfo:{handler:B,context:null}})})};x.combineJobs=function(z){return new d(function(F){var B=r.getStore(),E=[],D={},A={},C;if(z.jobSets&&(z.jobSets.length>0)){z.jobSets.forEach(function(G){if((G.length>0)&&t.isJobConfiguring(B.getState(),G[0])){G.forEach(function(H){D[H.id]=H})}else{G.forEach(function(H){if((typeof H._activityID!=="undefined")&&H._activityID){A[H._activityID]=H}else{A[H.id]=H}})}})}Object.keys(A).forEach(function(G){if(D.hasOwnProperty(G)){A[G].mainInputFile=D[G].mainInputFile;A[G].configuration=D[G].configuration;A[G].resultsOptions=D[G].resultsOptions;A[G].executionOptions.drmMode=D[G].executionOptions.drmMode;A[G].executionOptions.removeWorkDir=D[G].executionOptions.removeWorkDir;A[G].executionOptions.licenseOptions=D[G].executionOptions.licenseOptions;A[G].executionOptions.station=D[G].executionOptions.station;if(!D[G].executionOptions.workDirectory){C=v.workDirForJob(B.getState(),A[G].id);if(C){A[G].executionOptions.workDirectory=C.id}}else{A[G].executionOptions.workDirectory=D[G].executionOptions.workDirectory}delete D[G]}E.push(A[G])});Object.keys(D).forEach(function(G){E.push(D[G])});F(E)})};x.refreshConfiguringJob=function(z){return new d(function(C,B){var D=function(F){var H=null,G,E=JSON.parse(F.response),I=null;if(E){for(G=0;G<E.length;G++){if(E[G].id===z.jobID){I=E[G];H=h.getHandler({jobTypeId:z.jobTypeID,store:r.getStore()});break}}}if(I){if(H){H.then(function(J){C({job:J.createJobFromPLMActivity(I,r.getStore().getState())})})}else{B(c.buildError(t.ErrorCodes.JOB_HANDLER_NOT_FOUND,null,z.jobID))}}else{B(c.buildError(t.ErrorCodes.ACTIVITY_NOT_FOUND,null,z.jobID))}},A=function(E){B(c.buildError(t.ErrorCodes.ACTIVITIES_WS_ERROR,E,z.jobID))};y.callSMAProcService({uri:"/activity?simId="+z.studyID,onComplete:D,onError:A,sessionTimeoutInfo:{handler:B,context:z.jobID}})})};x.refreshExecutedJob=function(A){var z={jobID:A.job.id},B=null,C=(A.refreshConfiguration&&A.job.uninitialized);if(A.job.executionOptions&&A.job.executionOptions.server){B=A.job.executionOptions.server}return o(A).then(function(D){z.inputs=[];z.outputs=[];if(D){D.forEach(function(E){if(E.type===v.Types.SIMOBJECT&&E.objectId){if(E.purpose&&(("both"===E.purpose.toLowerCase())||("output"===E.purpose.toLowerCase()))){z.outputs.push(E.objectId)}}else{if(E.fileInfo&&(E.fileInfo.length>0)){E.fileInfo.forEach(function(F){if(F.versionId&&F.purpose){if("input"===F.purpose.toLowerCase()){z.inputs.push(F.versionId)}else{if("output"===F.purpose.toLowerCase()){z.outputs.push(F.versionId)}}}})}}})}return A}).then(C?f:function(){return A}).then(function(D){if(C){z.jobType=D.jobType;z.inputs=D.inputs;z.configuration=D.configuration;z.mainInputFile=D.mainInputFile;z.resultsOptions=D.resultsOptions;z.executionOptions=D.executionOptions;if(!z.executionOptions.server&&B){z.executionOptions.server=B}}return A}).then(w).then(function(D){z.status=D.status;z.progress=D.progress;z.started=D.started;z.ended=D.ended;z.owner=D.owner;return z})};x.refreshUploadJob=function(A){var z={jobID:A.job.id,configuration:{}};return q(A).then(function(B){if(B){z.configuration.attachToJobID=B.attachToJobID;z.configuration.managedDataProjections=B.managedDataProjections}return A}).then(w).then(function(B){z.status=B.status;z.progress=B.progress;z.started=B.started;z.ended=B.ended;return z})};x.storeJobConfiguration=function(z){return new d(function(E,D){var B={},A,F=function(){E({jobID:z.job.id})},C=function(G){D(c.buildError(t.ErrorCodes.JOB_FILE_CHECKIN_WS_ERROR,G,z.job.id))};h.getHandler({jobTypeId:z.job.jobType,store:r.getStore()}).then(function(G){B.jobType=z.job.jobType;B.activityDefinition=G.createPLMActivityFromJob(z.job,r.getStore().getState());A=new Blob([JSON.stringify(B)]);A.name=t.TOOL_JOB_CONFIG_FILENAME;y.callUploadLocalFile({file:A,createURL:"/fcs/checkin?oid="+z.job.id+"&dname="+t.TOOL_JOB_CONFIG_FILENAME,createMethod:"PUT",onComplete:F,onFailure:C})})})};x.startJob=function(z){return new d(function(F,E){var D=true,H=false,G=function(I){F({eedJobID:I.eedJobID,mcsJobID:I.mcsJobID,serverID:I.serverID,credentials:(typeof I.credentials!=="undefined")?I.credentials:null,needNewExecDir:D,removeExecDir:H})},B=function(I){var J=t.ErrorCodes.START_JOB_RUNTIME_ERROR;if(I.code===j.ErrorCodes.UNAUTHORIZED_ACCESS_ERROR){J=t.ErrorCodes.JOB_CREATION_UNAUTHORIZED}else{if(I.code===y.ErrorCodes.COS_WS_NOT_FOUND){J=t.ErrorCodes.START_JOB_WS_NOT_FOUND}else{if(I.code===y.ErrorCodes.COS_PRIVATE_STATION_USER_MISMATCH){J=t.ErrorCodes.START_JOB_PRIVATE_STATION_USER_MISMATCH}else{if(I.code===y.ErrorCodes.COS_PRIVATE_STATION_SERVER_MISMATCH){J=t.ErrorCodes.START_JOB_PRIVATE_STATION_SERVER_MISMATCH}else{if(I.code===y.ErrorCodes.COS_PRIVATE_STATION_NOT_FOUND){J=t.ErrorCodes.START_JOB_PRIVATE_STATION_NOT_FOUND}else{if(I.code===y.ErrorCodes.COS_BUILD_JOB_ERROR){J=t.ErrorCodes.START_JOB_BUILD_JOB_ERROR}else{if(I.code===y.ErrorCodes.COS_SSO_LOGIN_REQUEST_ERROR){J=t.ErrorCodes.START_JOB_SSO_LOGIN_REQUEST_ERROR}}}}}}}E(c.buildError(J,{status:500,response:(I.message)?I.message:null},{jobID:z.jobID,credentials:(typeof z.credentials!=="undefined")?z.credentials:null}))},A,C;C=t.jobWithID(r.getStore().getState(),z.jobID);if(((typeof C.executionOptions.workDirectory!=="undefined")&&C.executionOptions.workDirectory)||z.workDirID){D=false;if(C.executionOptions.removeWorkDir){H=z.workDirID?z.workDirID:C.executionOptions.workDirectory}}A={jobID:z.jobID,onComplete:G,onFailure:B};if(z.serverID){A.serverID=z.serverID}else{if(C.executionOptions.server){A.serverID=C.executionOptions.server}}if(C.executionOptions.drmMode&&(C.executionOptions.drmMode===p.DRMMode.CLOUD)){A.disablePrivateStationCheck=true}if(z.credentials){A.credentials=z.credentials}y.callRunJob(A)})};x.createJobActivity=function(z){return new d(function(F,E){var G=function(H){F({pendingJobID:z.pendingJobID,id:H.response})},C=function(H){E(c.buildError(t.ErrorCodes.ACTIVITY_CREATE_WS_ERROR,H,z.pendingJobID))},A,D=[],B;A=l.jobTypeWithID(r.getStore().getState(),z.jobTypeID);if(A&&A.options){D=A.options.slice();for(B=0;B<D.length;B++){if(D[B].title==="Title"){D[B].value=z.jobTitle;D[B].modified="true"}else{if(z.jobDescription&&D[B].title==="Description"){D[B].value=z.jobDescription;D[B].modified="true"}}}}y.callSMAProcService({uri:"/templates/"+z.jobTypeID+"/instantiate?pid="+z.studyID,verb:"POST",headers:{"Content-Type":"application/ds-json",Accept:"*/*"},data:JSON.stringify(D),onComplete:G,onError:C,sessionTimeoutInfo:{handler:E,context:z.pendingJobID}})})};x.updateJobActivity=function(z){return new d(function(D,C){var E=function(){D({jobID:z.jobID})},A=function(F){C(c.buildError(t.ErrorCodes.ACTIVITY_UPDATE_WS_ERROR,F,z.jobID))},B=t.jobWithID(r.getStore().getState(),z.jobID);h.getHandler({jobId:z.jobID,store:r.getStore()}).then(function(F){y.callSMAProcService({uri:"/activity/"+z.jobID+"?simId="+z.studyID,verb:"PUT",data:F.createPLMActivityFromJob(B,r.getStore().getState()),onComplete:E,onError:A,sessionTimeoutInfo:{handler:C,context:z.jobID}})})})};x.updateJob=function(z){return new d(function(D,C){var E=function(){D({jobID:z.jobID})},A=function(F){C(c.buildError(t.ErrorCodes.JOB_UPDATE_WS_ERROR,F,z.jobID))},B=t.jobWithID(r.getStore().getState(),z.jobID);h.getHandler({jobId:z.jobID,store:r.getStore()}).then(function(F){y.callSMAProcService({uri:"/jobs/"+z.jobID,verb:"PUT",data:F.createPLMJobFromJob(B),onComplete:E,onError:A,sessionTimeoutInfo:{handler:C,context:z.jobID}})})})};x.updateJobClone=function(z){return new d(function(E,D){var F=function(){E({cloneJob:z.cloneJob})},B=function(G){D(c.buildError(t.ErrorCodes.ACTIVITY_UPDATE_WS_ERROR,G,z.cloneJob.id))},C,A;z.cloneJob.inputs=c.deepCopy(z.originalJob.inputs);z.cloneJob.mainInputFile=c.deepCopy(z.originalJob.mainInputFile);z.cloneJob.configuration=c.deepCopy(z.originalJob.configuration);z.cloneJob.executionOptions=c.deepCopy(z.originalJob.executionOptions);z.cloneJob.jobType=z.originalJob.jobType;C=z.cloneJob.resultsOptions.generateResultsUnitsDefault;z.cloneJob.resultsOptions=c.deepCopy(z.originalJob.resultsOptions);z.cloneJob.resultsOptions.generateResultsUnitsDefault=C;A=z.cloneJob.resultsOptions.generateResultsUnits?!s(z.cloneJob.resultsOptions.generateResultsUnits,C):false;z.cloneJob.resultsOptions.generateResultsUnitsEnabled=A;h.getHandler({jobId:z.originalJob.id,store:r.getStore()}).then(function(G){y.callSMAProcService({uri:"/activity/"+z.cloneJob.id+"?simId="+z.studyID,verb:"PUT",data:G.createPLMActivityFromJob(z.cloneJob,r.getStore().getState()),onComplete:F,onError:B,sessionTimeoutInfo:{handler:D,context:z.cloneJob.id}})})})};x.abortJob=function(z){return new d(function(E,D){var A=r.getStore(),C,F=function(){E({jobID:z.jobID})},B=function(G){D(c.buildError(t.ErrorCodes.JOB_ABORT_WS_ERROR,G,z.jobID))};C=t.jobWithID(A.getState(),z.jobID);if(C&&C.eedJobID&&C.executionOptions.server&&t.isJobRunning(A.getState(),C)){y.callCOSService({uri:"execution/"+C.eedJobID+"/cancel",verb:"PUT",headers:{Accept:"text/plain"},serverId:C.executionOptions.server,objectId:C.id,onComplete:F,onError:B})}else{D(c.buildError(t.ErrorCodes.JOB_ACTION_NOT_ALLOWED_ERROR,null,{jobID:z.jobID}))}})};x.deleteJobs=function(A){var C,z=[],B=[],D=[];A.jobIDs.forEach(function(E){C=t.jobWithID(r.getStore().getState(),E);if(t.JobStatus.CONFIGURING===C.status){z.push(E)}else{B.push(E)}});if(z.length>0){D.push(d.resolve({studyID:A.studyID,activityIDs:z}).then(g))}if(B.length>0){D.push(d.resolve({studyID:A.studyID,jobIDs:B}).then(e))}return d.all(D).then(function(E){var F={successes:[],failures:[]};E.forEach(function(G){F.successes=F.successes.concat(G.successes);F.failures=F.failures.concat(G.failures)});return F})};x.setJobDetails=function(z){return new d(function(D,C){var A,E=function(){D({jobID:z.jobID,description:z.description})},B=function(F){C(c.buildError(t.ErrorCodes.JOB_DETAILS_WS_ERROR,F,z.jobID))};A={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:z.jobID,dataelements:{title:{value:[{value:z.title}]},description:{value:[{value:z.description}]}}}],name:"SMA_JobDetails"},name:"SMA_JobDetails"};y.call3DSpaceService({uri:"/resources/e6w/service/SMA_JobDetails",verb:"POST",headers:{Accept:"*/*","Content-Type":"application/x-www-form-urlencoded"},data:"updateWidget="+JSON.stringify(A),onComplete:E,onError:B,sessionTimeoutInfo:{handler:C,context:z.jobID}})})};x.setJob3DXParameters=function(z){return new d(function(D,C){var B,E=function(){D({jobID:z.jobID,tenantID:z.tenantID,myAppsURL:z.myAppsURL})},A=function(F){C(c.buildError(t.ErrorCodes.JOB_PARAMETERS_WS_ERROR,F,z.jobID))};if(t.isJobConfiguring(r.getStore().getState(),z.jobID)){B={datarecords:{datagroups:[{updateAction:"CREATE",objectId:z.jobID,dataelements:{type:{value:[{value:"string"}]},name:{value:[{value:"MX_ONLINE_INSTANCE"}]},mode:{value:[{value:"input"}]},valuetype:{value:[{value:"single"}]},Value:{value:[{value:z.tenantID}]}}},{updateAction:"CREATE",objectId:z.jobID,dataelements:{type:{value:[{value:"string"}]},name:{value:[{value:"MyAppsUrl"}]},mode:{value:[{value:"input"}]},valuetype:{value:[{value:"single"}]},Value:{value:[{value:z.myAppsURL}]}}}],name:"SMA_Parameter"},name:"SMA_Parameter"};y.call3DSpaceService({uri:"/resources/e6w/service/SMA_Parameter?objectId="+z.jobID,verb:"POST",headers:{Accept:"*/*","Content-Type":"application/x-www-form-urlencoded"},data:"updateWidget="+JSON.stringify(B),onComplete:E,onError:A,sessionTimeoutInfo:{handler:C,context:z.jobID}})}else{C(c.buildError(t.ErrorCodes.JOB_ACTION_NOT_ALLOWED_ERROR,null,{jobID:z.jobID}))}})};x.getFileSpecArray=function(A){var F,D=-1,z,C,E,B=[];A=A.trim().replace(/'/g,'"');do{F=A.indexOf('"');if(F>=0){D=A.indexOf('"',F+1);if(D>=0){E=A.slice(F,D+1);A=A.substr(0,F)+A.substr(D+1);if(E.length>2){B.push(E)}F=D+1}}}while(F>=0&&D>=0);z=A.split(/[;,\s]/);for(C=0;C<z.length;C++){E=z[C].trim();if(E.length>0){B.push(E)}}return B};x.addJobOutput=function(z){return new d(function(G,F){var A=r.getStore(),H=function(){G({jobID:z.jobID,outputID:z.outputID})},C=function(I){F(c.buildError(t.ErrorCodes.JOB_ADD_OUTPUT_WS_ERROR,I,{jobID:z.jobID,outputID:z.outputID}))},E,B,D;E=t.jobWithID(A.getState(),z.jobID);B=k.managedDataWithID(A.getState(),z.outputID);if(E&&t.isJobExecuted(A.getState(),E)&&B&&((k.Types.FILEVERSION===B.type)||(k.Types.SIMULATION_OBJECT===B.type))){D={simulationId:m.studyObject(A.getState()).id,objectId:z.outputID};if(k.Types.FILEVERSION===B.type){D.objectId=k.managedDataParent(A.getState(),k.managedDataParent(A.getState(),B.id,false).id,false).id;D.fileName=k.managedDataParent(A.getState(),B.id,false).name;D.fileVersion=B.version}y.callSMAProcService({uri:"/jobs/"+z.jobID+"/outputs",verb:"POST",data:D,onComplete:H,onError:C,sessionTimeoutInfo:{handler:F,context:{jobID:z.jobID,outputID:z.outputID}}})}else{F(c.buildError(t.ErrorCodes.JOB_ACTION_NOT_ALLOWED_ERROR,null,{jobID:z.jobID,outputID:z.outputID}))}})};return x});