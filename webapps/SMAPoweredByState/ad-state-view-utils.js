/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["UWA/Class/Promise"],function(b){var a={};var c=window.Promise||b;a.observeStore=function(f,d,e,j){var h,g=function(){var k=d(f.getState());if(j){if(!j(h,k)){h=k;window.console.debug("Calling change handler (view-utils): "+e.name);e(h)}}else{if(k!==h){h=k;window.console.debug("Calling change handler (view-utils): "+e.name);e(h)}}};window.console.debug("Subscribing  (view-utils): "+e.name);var i=f.subscribe(g);g();return i};a.observeStore2=function(e){var f,g=null,d=function(){var h=[e.store.getState()].concat(e.selectArguments);var i=e.selectFunc.apply(null,h);if(e.unSubScribeCriteria){var j=e.unSubScribeCriteria(e.store.getState());if(j){g()}}if(e.compareFunc){if(!e.compareFunc(f,i)){f=i;window.console.debug("Calling change handler (view-utils): "+e.onChange.name);e.onChange(f)}}else{if(i!==f){f=i;window.console.debug("Calling change handler (view-utils): "+e.onChange.name);e.onChange(f)}}};window.console.debug("Subscribing  (view-utils): "+e.onChange.name);g=e.store.subscribe(d);d();return g};a.waitForAsyncState=function(d){return new c(function(h,g){var f=null,e=function(i){var k,j;if(d.isResolved){k=d.isResolved(i)}else{k=(i===null)}if(d.isError){j=d.isError(i)}else{if(d.errorSelector){j=d.errorSelector(d.store.getState())}}if(k){if(j){if(f){f()}g(j)}else{if(f){f()}h()}}};f=a.observeStore(d.store,d.selector,e)})};a.dispatchAsyncAction=function(d){return new c(function(h,g){var e=false,f=null,i=function(j){var m,l;if(d.isResolved){m=d.isResolved(j)}else{m=(j===null)}if(d.isError){l=d.isError(j)}else{if(d.errorSelector){l=d.errorSelector(d.store.getState())}}if(e&&l){f();var k=null;if(d.errorSelector){k=d.errorSelector(d.store.getState())}g(k)}else{if(m&&e){f();h()}}};f=a.observeStore(d.store,d.selector,i);d.action.apply(null,d.actionArgs?d.actionArgs:[null]);e=true})};return a});