/*!  Copyright 2017 Dassault Systemes. All rights reserved. */
define(["DS/SMAPoweredByState/ad-state-utils","DS/SMAPoweredByState/ad-state-wc-adapter","DS/SMAPoweredByState/ad-state-domain-job-types/selectors","UWA/Class/Promise","text!DS/SMAPoweredByState/assets/handlers.json"],function(h,c,a,e,f){var b={};var d=JSON.parse(f);var g=window.Promise||e;b.getJobTypes=function(){return new g(function(l,k){var j,m=function(p){var o=JSON.parse(p.response),n=[];if(o){n=o.map(function(q){if(d[q.title]){if(d[q.title][q.revision]){j=d[q.title][q.revision]}else{j=d[q.title]["default"]}}else{j=d["default"]}return{id:q.id,title:q.title,description:q.description,lifecycleState:q.currentState,revision:q.revision,revisionComments:q.revisionComments,isLatestRevision:q.isLatestrevision,handler:j,options:null}})}l(n)},i=function(n){k(h.buildError(a.ErrorCodes.JOB_TYPES_WS_ERROR,n))};c.callSMAProcService({uri:"/templates?templateType=type_SimulationActivity&usage=Adhoc",onComplete:m,onError:i,sessionTimeoutInfo:{handler:k,context:null}})})};b.getJobTypeOptions=function(i){return new g(function(l,k){var m=function(o){var n=JSON.parse(o.response);l({jobTypeID:i.jobType.id,options:n})},j=function(n){k(h.buildError(a.ErrorCodes.JOB_TYPE_OPTIONS_WS_ERROR,n,i.jobType.id))};c.callSMAProcService({uri:"/templates/"+i.jobType.id+"/options",onComplete:m,onError:j,sessionTimeoutInfo:{handler:k,context:i.jobType.id}})})};return b});