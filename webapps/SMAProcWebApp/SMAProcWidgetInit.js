define("DS/SMAProcWebApp/SMAProcWidgetInit",["UWA/Core","DS/SMAProcWebAuthoringUI/FrameWindowDiagram","DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAccessUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/UIKIT/Mask","DS/ApplicationFrame/CommandsManager","DS/SMAProcWebAuthoringUtils/SMAProcWebAuthoringServices","DS/JSCMM/SMAJSCMMProcess","DS/SMAProcWebCMMUtils/SMAProcWebEventHandler","DS/SMAProcWebCommonControls/import!DS/SMAProcSPUI/sp-drop/sp-drop.html"],function(m,q,f,h,d,p,j,c,g,k,o){var l="Simulation Process",n="Unable to create Simulation Process",b=0,e=null,a=function(){return window.widget};var i={processData:null,frmWindow:null,uiFrame:null,processComposer:null,isRefreshInProgress:false,license:false,token:null,initWidget:function(s,r){this.processData=s||null;if(r){o.subscribeToExternalEvents("DS/PADUtils/PADCommandProxy/refresh");o.subscribeToPSEvents("DS/SMAProcSP/mcsservice/modify");o.subscribeToPSEvents("DS/SMAProcPS/modify");o.subscribeToPSEvents("processApps");o.addListenerToEvents("processChanged",function(){if(p.currentProcess){i._updateWidgetTitle(p.currentProcess)}})}if(!o.hasListener("jobStatusChanged")){o.addListenerToEvents("jobStatusChanged",function(t){if(p.currentProcess){g.displayNotification("Job status is  "+t,{messageType:"warning",autoHide:false})}})}},onWidgetFailure:function(){var r=new m.createElement("div",{style:"text-align: center;",html:"<p>Unauthorized Access<br />Kindly request your Administrator to grant you a license to access Process Composer</p>"});r.inject(a().body);i.unmaskWidget()},_updateWidgetTitle:function(r){a().setTitle(r.getName()+(r.getRevision()?" ("+r.getRevision()+")":""))},onRefresh:function(){if(this.license===false){return}if(this.isRefreshInProgress===true){return}this.isRefreshInProgress=true;this.initializeDropzone();g.clearNotifications();if(this.processComposer){var r=this.processComposer.parentNode;r.removeChild(this.processComposer);this.processComposer=null;if(p.currentProcess){e.removeDropNotes();this.initWidget({objectId:p.currentProcess.getPhysicalId()});this.createProcessComposer()}p.currentProcess=null}else{this.isRefreshInProgress=false}},initializeDropzone:function(){if(e){e.revertToDrop();return}var s=this;e=document.createElement("sp-drop");e.setAttribute("show-add",true);e.setAttribute("show-search",true);e.setAttribute("drop-note-text",l);e.setAttribute("open-object",true);e.addEventListener("objectcreate",this.createSimulation.bind(this));e.style.height="calc(100% - 20px)";e.style.margin=0;e.style.padding="20px";e.customSearch='(NOT policy:"Simulation Template Content")';var r=function(){g.clearNotifications();s.processData=e.objectData;s.createProcessComposer()};e.addEventListener("onObjectDrop",r);this.uiFrame.appendChild(e)},createFrameWindow:function(){if(this.license===false){return}if(!this.frmWindow){var s=a().body;m.extendElement(s);s.empty();if(a().frmWindow){this.frmWindow=a().frmWindow;this.frmWindow.inject(s);this.maskWidget()}else{this.frmWindow=new q().inject(s);this.maskWidget();this.uiFrame=this.frmWindow.getUIFrame();a().frmWindow=this.frmWindow;g.Initialize(this.uiFrame);this.initializeDropzone();if(this.processData){var r=this.processData.displayName?" "+this.processData.displayName:this.processData.objectId?" (id: "+this.processData.objectId+")":"";g.displayNotification("Opening "+r);e.removeDropNotes()}this.token=this.frmWindow.onActionBarReady(this.onActionBarReady.bind(this))}}},disableActionBarCommands:function(){c.disableAll();var r=["SMAProcWebActionBarCreateProcessHdr","SMAProcWebActionBarSearchProcessHdr"];r.forEach(function(s){var t=c.getCommand(s);if(t&&t.enable){t.enable()}})},onActionBarReady:function(){this.unmaskWidget();this.disableActionBarCommands();if(this.processData&&this.processData.objectId){this.createProcessComposer()}if(localStorage.getItem("SIMPRCW_AP_ENABLE_EXPERIMENTS")==="true"){this.frmWindow.getActionBar().removeCallback(this.token);this.frmWindow.getActionBar().loadModel({file:"SMAWebAuthoringWorkbenchExperimental.xml",module:"SMAProcWebApp",merge:"true"})}},createProcessComposer:function(){if(this.license===false){return}var r=this;var s=r.processData&&r.processData.objectId;if(s){c.endAll();r.maskWidget();h.loadProcess(s,{onSuccess:r.openProcessInWidget.bind(r),onFailure:function(t){r.unmaskWidget();r.isRefreshInProgress=false;g.displayNotification("Not able to open selected process, error: "+t,{messageType:"error"});e.revertToDrop()}})}else{console.trace("No process to open")}},openProcessInWidget:function(t){var s=this;e.removeDropNotes();p.fetchCustomExtensionDescriptors();if(t instanceof k){var r=function(){p.setCurrentProcess(t);require(["DS/SMAProcWebAuthoringUI/ProcessComposer"],function(u){if(s.processComposer){var v=s.processComposer.parentNode;v.removeChild(s.processComposer);g.clearNotifications();s.processComposer=null}s.processComposer=new u();e.injectContent(s.processComposer);s.initializeComposer();s.isRefreshInProgress=false;a().setValue("processId",t.getPhysicalId());a().setValue("processName",t.getName());i._updateWidgetTitle(t);c.enableAll();if(t.getSimulationKind()=="adhoc"){g.displayClosableMessages("warning",["ProcessOpen.adhoc.warning"]);console.log("adhoc process")}})};d.fetchAccess(t,{onSuccess:function(){if(d.hasReadAccess()){r()}else{s.resetAndDisplayNotification()}},onFailure:function(){r();g.displayNotification('Not able to check access level on the selected process: "'+t.getName()+'" (id: '+t.getPhysicalId()+")",{messageType:"warning"})}})}else{this.resetAndDisplayNotification()}this.unmaskWidget()},resetAndDisplayNotification:function(){a().setValue("processId","");a().setValue("processName","");a().setTitle("Process Composer");g.displayNotification('Not able to open selected process: "'+this.processData.displayName+'" (id: '+this.processData.objectId+")",{messageType:"error"})},initializeComposer:function(){if(this.license===false){return}var r=this;if(!r.frmWindow||!r.uiFrame||!r.processComposer){return}r.processComposer.updateCurrentProcess()},createSimulation:function(){var r=function(w){var v=a().getValue("processNamePrefix")||"Process-";p.createProcess(v+w,{onSuccess:t.openProcessInWidget.bind(t),onFailure:function(x){g.displayNotification(n+"\n \n"+x,{messageType:"error"});t.unmaskWidget()}});t.maskWidget()};if(this.license===false){return}var t=this;b=parseInt(window.localStorage.getItem("processNumber"));var s=parseInt(window.localStorage.getItem("lastStackEntry"));if(isNaN(b)||(b>=s)){var u=p.getStackOfProcessNumbers();u.then(function(v){r(v)},function(){var v=parseInt(window.localStorage.getItem("dummyNumber"));if(isNaN(v)){v=1}else{v++}window.localStorage.setItem("dummyNumber",v);r(v)})}else{b++;window.localStorage.setItem("processNumber",b);r(b)}},searchSimulations:function(){e.onSearchObjectClick()},closeSimulation:function(){c.endAll();p.currentProcess=null;this.processData=null;a().setValue("processId","");a().setValue("processName","");a().setTitle("Process Composer");this.disableActionBarCommands();this.onRefresh()},maskWidget:function(){if(a()&&a().body){j.mask(a().body)}},unmaskWidget:function(){if(a()&&a().body){j.unmask(a().body)}}};return i});