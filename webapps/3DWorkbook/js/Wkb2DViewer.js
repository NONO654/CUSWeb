define("DS/3DWorkbook/js/Wkb2DViewer",["UWA/Core","DS/3DWorkbook/js/WkbUtils","DS/DELMOMWKIExperience/js/WkiStreamUtil","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(d,p,z,J){var E,n,i,H,t=0,m=0,c=0,I,N,F,e=null,M,L=false,a=null,B=null;var h=function(O){M=O.modelEvtManager||new ModelEvents();E=O.ematrixURL;i=E+"webapps/3DWorkbook/";L=true;if(e===null){M.subscribe({event:"wkbNav-SelectOper"},function(P){r(P)});M.subscribe({event:"wkbHeader-SelectOper"},function(P){r(P)});M.subscribe({event:"wkbHeader-SelectOrder"},function(P){G(P)});M.subscribe({event:"wkbMain-Remove2D"},f);M.subscribe({event:"wkbMain-GraphicsChanged"},function(P){if(P.object_type==="SYSTEM"){G(P)}else{r(P)}});M.subscribe({event:"wkbMain-NavSizeChanged"},l);M.subscribe({event:"wkbMain-DetailSizeChanged"},l);M.subscribe({event:"wkbHeader-Select2D"},x)}this.setContainer();H=O.systemPLMID;a=g(H);return this.getContainer()};function g(P){var O={serverURL:E,securityContext:widget.getValue("collabSpace"),plmIdentifier:P};return new z(O)}function G(O){var O={object_type:"SYSTEM",object_data:O.object_data};D(O)}function r(O){var O={object_type:"OPERATION",object_data:O.object_data};D(O)}function x(Q){L=true;l(Q);var P=e.getElement("#img0");var O=e.getElement("#msgDiv");if(O){O=P.removeChild(O)}H=Q.systemPLMID;D({object_data:{plmIdentifier:Q.plmId,parentPlmIdentifier:H}});C()}function f(O){if(e!==null){e.style.display="none"}L=false}function l(Q){if(d.is(e.parentElement)){var O=e.parentElement.offsetWidth;var P=e.parentElement.offsetHeight;e.setStyle("height",P+"px");e.setStyle("width",O+"px")}}function D(Q){if(L){var P=e.getElement("#img0");var O=e.getElement("#msgDiv");if(O){O=P.removeChild(O)}b(Q.object_data.id,Q.object_data.plmIdentifier,Q.object_data.parentPlmIdentifier)}}function A(O){var P=O.getElement("#msgDiv");if(d.is(P)){return}O.style.background="#ffffff";var P=p.createAndAppend(O,"div","msgDiv","msgDiv");P.textContent=J.No2DFoundMsg}function b(P,U,O){if(P){var S=function S(W){if(d.is(W)){K(W)}else{var X=function V(Y){if(d.is(Y)){K(Y)}else{B=g(U);B.get2DFiles(P,K,false)}};a.get2DFiles(P,X,true)}};a.get2DFiles(P,S,false)}else{var Q=e.getElement("#thumbnails");if(d.is(Q)){while(Q.firstChild){Q.removeChild(Q.firstChild)}}var T=e.getElement(".controlsDiv");if(d.is(T)){T.setStyle("display","none")}var R=e.getElement("#img0");A(R)}}function s(){var Q=e.getElement("#zoomControls");var P=e.getElement("#thumbnails");I=e.offsetWidth;N=e.offsetHeight;if(I==0){I=40}t=I;m=N;e.setStyle("height",m+"px");var O=e.getElement("#docContainer");m=m-Q.offsetHeight-P.offsetHeight-2;O.setStyle("height",m+"px");N=m;n.setOptions({height:N})}function j(Q){var P=e.getElementsByClassName("thumbImage itemRowCursor selected");var O;for(O=0;O<P.length;O++){P[O].classList.add("unselected");P[O].classList.remove("selected")}Q.classList.add("selected");Q.classList.remove("unselected")}var k=function(Q){if(Q!==null){var R=e.getElement("#zoomControls");R.setStyle("display","block");var O=e.getElement("#img0");var P=new Image();P.src=Q;P.onload=s;O.style.background="url("+P.src+") no-repeat 50% 0%";O.style.backgroundSize="contain"}};function C(){I=e.getElement("#docContainer").offsetWidth;N=e.getElement("#docContainer").offsetHeight;t=I;m=N;var O=e.getElement("#img0");O.setStyle("width","100%");O.setStyle("height","100%")}var w=function(O){O.onclick=function(){var P=e.getElement("#thumbdata"+this.id.substring(5));k(P.textContent);C();j(this);return false}};function y(){var P=parseInt((t*1.2),10);var O=parseInt((m*1.2),10);if(P<=4048&&O<4048){t=P;m=O;var Q=e.getElement("#img0");Q.setStyle("width",t);Q.setStyle("height",m)}}function o(){var P=parseInt((t/1.2),10);var O=parseInt((m/1.2),10);var R=20;if(P>=I||O>=(N-R)){t=P;m=O;var Q=e.getElement("#img0");Q.setStyle("width",t);Q.setStyle("height",m)}else{C()}}var K=function(R){var S,V,T,U;var Q=e.getElement("#thumbnails");while(Q.firstChild){Q.removeChild(Q.firstChild)}if(!d.is(R)||R.image2DFiles===null||R.image2DFiles.length===0){var P=e.getElement("#img0");A(P);var O=e.getElement(".controlsDiv");O.setStyle("display","none")}else{for(S=0;S<R.image2DFiles.length;S++){V=p.createAndAppend(Q,"img","thumbImage itemRowCursor","thumb"+S);if(S===0){V.classList.add("selected")}T=p.createAndAppend(V,"div","docdata","thumbdata"+S);T.textContent=R.image2DFiles[S];w(V);V.src=R.image2DThumbnails[S]}k(R.image2DFiles[0])}var W;window.onresize=function(){window.clearTimeout(W);W=setTimeout(l,500)}};function q(R,Q,P,O){switch(R){case"processImages":return K(Q);case"setScrollHeight":return s();case"resetImage":return C();case"zoomIn":return y();case"zoomOut":return o();default:return null}}function u(){if(d.is(a)){a.dispose()}if(d.is(B)){B.dispose()}}h.prototype={setContainer:function(){if(e===null){e=d.createElement("div",{id:"docDiv","class":"mainDocContainer"});var T=p.createAndAppend(e,"div","imageDiv","docContainer");var Q=p.createAndAppend(T,"div","docImage","img0");var S=p.createAndAppend(e,"div","controlsDiv","zoomControls");var R=p.createAndAppend(S,"img","zoomControl","zoomIn");R.src=i+"assets/images/widgets/zoomin.png";R.onclick=(function(){return function(){y()}}());var O=p.createAndAppend(S,"img","zoomControl","zoomOut");O.src=i+"assets/images/widgets/zoomout.png";O.onclick=(function(){return function(){o()}}());var P=p.createAndAppend(S,"img","zoomControl","reset");P.src=i+"assets/images/widgets/reset.png";P.onclick=(function(){return function(){C()}}());p.createAndAppend(e,"div","thumbnailDiv","thumbnails");S.setStyle("display","none");n=new d.Controls.Scroller(Q,{height:100,scrollableY:true,scrollableX:true,scrollDrag:true,snap:false,bounce:false,momentum:false,lockDirection:false,useNative:false,useTransform:false,events:{onScrollStart:function(){},onScrollPull:function(){},onScrollEnd:function(){}}});e.testFunction=q}else{e.style.display=""}},getContainer:function(){return e},updateClickHandler:function v(){if(e!=undefined){var Q=e.getElement(".partsClass");var P=Q.childNodes;for(var O=0;O<P.length;O++){P[O].setAttribute("onclick",null)}}},dispose:function u(){u()}};return h});