define("DS/3DWorkbook/js/WkbWidgetCom",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/DELMOMWKIExperience/js/ParserUtility","DS/3DWorkbook/js/WkbUtils"],function(e,t,c,u,m){var v={};var j={};var f={};var b={};var i="";var d=false;var q=null;function r(z){var w=[];var y={};var x=0;for(x;x<z.length;x+=1){y={};y.objPLMID=z[x].referenceName;y.refName=z[x].referenceTitle;y.instName=z[x].instanceName;w.push(y)}return w}function n(z){var w=[];var y;var x=0;for(x;x<z.length;x+=1){y={};y.id=z[x].id;y.name=z[x].name;y.plmexternalId=z[x].plmexternalId;y.title=z[x].title;y.worktype=z[x].worktype;y.persistentId=z[x].persistentId;w.push(y)}return w}function s(C,w){var E="";var A="";var D="";var x={};var F=[];var y={};y.action=C.action;if(!e.is(C.pathElement)){return y}var z=C.pathElement.externalPath;var B=z.length-1;for(B;B>0;B-=1){if(e.is(z[B].isPLMInstance)&&z[B].isPLMInstance()){D=z[B].plmexternalId;E=z[B].id;break}}F=m.getInstancePath(E,w);y.path=r(F);if(F.length>0){y.objPLMID=F[F.length-1].referenceName;y.refName=F[F.length-1].referenceTitle;y.instName=F[F.length-1].instanceName}y.productPath=n(z);return y}function h(x,y){var w=[];if(x.path&&x.path.length>0){w=m.getHighlightIdByExternalPath(x.path,y);if(w.length>0){w=[w]}else{w=[]}}else{if((x.objPLMID&&x.objPLMID.length>0)&&(x.instName&&x.instName.length>0)){w=f.get3DPlayer().getObjectPathsByReferenceAndInstanceName(x.objPLMID,x.instName)}else{if(x.instName&&x.instName.length>0){w=f.get3DPlayer().getObjectPathsByInstanceName(x.instName)}else{if(x.objPLMID&&x.objPLMID.length>0){w=f.get3DPlayer().getObjectPathsByReferenceName(x.objPLMID)}else{if(x.refName&&x.refName.length>0){w=f.get3DPlayer().getHighlightPaths(x.refName)}else{console.error("WkbWidgetCom:  Invalid item data")}}}}}return w}function g(x,A){var w=false;var z=x.split(".");var y=A.split(".");if(z[0]===y[0]){w=true}return w}function k(y,x){var w=false;if(x.sysRefName&&x.sysRefName.length>0){if(x.sysRefName!==y.plmIdentifier){w=true}}else{if(x.sysPLMID&&x.sysPLMID.length>0){if(x.sysPLMID!==y.id||!g(y.version,x.sysRevision)){w=true}}else{if(x.sysTitle&&x.sysTitle.length){if(x.sysTitle!==y.name||!g(y.version,x.sysRevision)){w=true}}}}return w}function p(w){if(!e.is(w.sysRefName)){w.sysRefName=""}if(!e.is(w.sysPLMID)){w.sysPLMID=""}if(!e.is(w.sysTitle)){w.sysTitle=""}}function o(w){if(e.is(w.opPLMID)&&w.opPLMID.length>0){q={};q.object_data={plmID:w.opPLMID}}else{if(e.is(w.opInstName)&&w.opInstName.length>0){q={};q.object_data={instanceName:w.opInstName}}else{if(e.is(w.opRefName)&&w.opRefName.length>0){q={};q.object_data={referenceName:w.opRefName}}}}}function a(y){var E=0;var B="";var x=[];var C=[];var A="System not found, ";var D=y.indexOf("PLMEXTERNALID");if(D>0){B=y.substring(D);x=B.split("&");if(x.length>0){var z=0;var w="";for(z;z<x.length;z+=1){var w=x[z].split("=");switch(w[0]){case"PLMEXTERNALID":A+=", sysRefName = "+w[1];break;case"TITLE":A+=", sysTitle = "+w[1];break;case"REVISION":E=w[1].indexOf('"');if(E>0){A+=", sysRevision = "+w[1].substring(0,E)}else{A+=" sysRevision = "+w[1]}break;default:break}}}}else{A+=", "+y}return A}var l=t.singleton({init:function(w){if(e.is(w)){v=w.wkbMain;j=w.wkbDetails;f=w.wkb3DViewer;b=w.wkbNavPanel;this.subscribeAll()}},setPanels:function(w){v=w.wkbMain;j=w.wkbDetails;f=w.wkb3DViewer;b=w.wkbNavPanel},subscribeAll:function(){c.subscribe("CAADELWKB.loadOper",this.onWkbLoad);c.subscribe("CAADELWKB.selectNode",this.onSelectNode);c.subscribe("CAADELWKB.unselectNode",this.onUnselectNode);c.subscribe("CAADELWKB.hideShow",this.onHideShowNode);c.subscribe("CAADELWKB.colorize",this.onSetNodeColor);c.subscribe("CAADELWKB.setOpacity",this.onSetNodeOpacity);c.subscribe("CAADELWKB.resetColor",this.onResetNodeColor);c.subscribe("CAADELWKB.reframeOn",this.onReframeOnNode)},publishOperationSelected:function(x){var w={opInstName:x.instanceName,opRefName:x.displayName};c.publish("CAADELWKB.operSelected",w)},publishPartSelected:function(x){var w=s(x,i);c.publish("CAADELWKB.addSelectionCB",w)},publishMappingFileLoaded:function(x){d=true;i=x;var y=new u();var w=y.xmlToJson(x);c.publish("CAADELWKB.getObjsFromMapping",w)},publishModelLoaded:function(w){c.publish("CAADELWKB.modelLoaded",w);if(e.is(q)){b.selectOperation(q);q=null}},publishWidgetLoaded:function(w){c.publish("CAADELWKB.widgetLoaded",w)},publishLoadError:function(y){var x=y;var w=y.indexOf("upr/wip/shoporder");if(w>0){x=a(y)}else{x=y}c.publish("CAADELWKB.systemOperLoadError",x)},onWkbLoad:function(z){var w=function(){if(e.is(z.operDetailCollapsed)&&e.is(j)&&e.is(b)){if(z.operDetailCollapsed.toUpperCase()==="TRUE"){v.closeDetailsPanel()}else{v.openDetailsPanel()}if(z.operPanelCollapsed.toUpperCase()==="TRUE"){v.closeNavPanel()}else{v.openNavPanel()}}else{setTimeout(w,200)}};p(z);o(z);var A=v.getSystemData();var x=e.is(A)&&k(A,z);if(!e.is(A)||x){v.loadSystem(z,w)}else{if(e.is(q)){try{b.selectOperation(q);q=null;w()}catch(y){console.log("WIDGETCOM: ERROR Loading operation "+y);q=null}}}},onSelectNode:function(x){var w=h(x,i);f.get3DPlayer().selectNode(w)},onUnselectNode:function(x){var w=h(x,i);f.get3DPlayer().unselectNode(w)},onHideShowNode:function(x){var w=h(x,i);f.get3DPlayer().setNodeVisibility(w,x.isVisible)},onSetNodeColor:function(y){var x=h(y,i);var w=y.color.split(" ");f.get3DPlayer().setObjectsColor(x,w[0],w[1],w[2])},onSetNodeOpacity:function(x){var w=h(x,i);if(w.length>0){f.get3DPlayer().setObjectOpacity(w[0],x.opacity)}},onResetNodeColor:function(x){var w=h(x,i);f.get3DPlayer().resetObjectsColor(w)},onReframeOnNode:function(x){var w=h(x,i);if(w.length>0){f.get3DPlayer().reframeOn(w[0])}}});return l});