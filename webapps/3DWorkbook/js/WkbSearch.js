define("DS/3DWorkbook/js/WkbSearch",["UWA/Core","UWA/Class","UWA/Utils/InterCom","DS/CoreEvents/ModelEvents","DS/3DWorkbook/js/WkbUtils","WebappsUtils/WebappsUtils","DS/UIKIT/Tooltip","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(d,r,g,j,l,a,o,q){var m="";var e="";var s={};var p=null;var i;var h=true;var k=null;var b=null;var c=function(t){console.log("error getting system PLMID from service "+t)};var n=function(t){var u=function(){i.publish({event:"wkbSearch-DataFound",data:t})};u()};var f=r.extend({init:function(t){t=t||{insertUI:false,container:null};i=t.modelEvtManager||new j();m=t.ematrixURL;if(t.widget_id.toString().indexOf("preview")!==-1){h=false}this.socketName="search_socket_"+(new Date()).getTime();s.role=t.role;s.title="3D Workbook";s.mode="furtive";s.attributeDisplayVals="";s.attributeTypes="";s.attributes="";s.default_with_precond=true;s.precond="flattenedtaxonomies:types/DELLmiPPRSystemReference";s.show_precond=false;s.multiSel=false;s.app_socket_id=this.socketName;s.widget_id=t.widget_id;if(!d.is(this.socket)){this.socket=new g.Socket(this.socketName,{dispacthRetryInterval:0});this.socket.subscribeServer("SearchComServer");p=this.socket}this.socket.dispatchEvent("RegisterContext",s);this.socket.addListener("Selected_Objects_search",this.selectedObjectsSearch.bind(this));if(t.insertUI&&t.container){this.insertUI(t.container)}},insertUI:function(t){var u=d.createElement("div",{id:"initialWKB","class":"initialWKB"});u.textContent=q.DefaultInitWBMsg;var w=this;var v=l.createAndAppend(u,"div","searchBar","wkb_search_bar");e=l.createAndAppend(v,"input","inputSearch","wkb_input_search");k=l.createAndAppend(v,"button","doSearch","wkb_do_search");e.onkeypress=function(x){if(x.keyCode==13){e.style.visibility="hidden";w.launchSearch(e.value)}};if(h){k.onclick=function(){w.launchSearch(e.value)}}else{b=new o({target:k,body:q.WidgetNotPinned,position:"bottom",trigger:"hover focus"})}u.inject(t)},displayUserRoleError:function(t){k=t.getElement("#wkb_do_search");b=new o({target:k,body:q.NoUserRole,position:"bottom",trigger:"hover focus"});k.onclick=function(){}},activateSearchContext:function(){if(d.is(this.socket)){this.socket.dispatchEvent("InContextSearch",s)}else{throw new Error("Socket not initialized")}},selectedObjectsSearch:function(u){this.socket.dispatchEvent("clearSearch");console.log("SEARCH PHYSICAL ID = "+u[0]["id"]);var t=m+"resources/upr/wip/shoporder?PLMID="+encodeURIComponent((u[0]["id"]));l.getServerData(t,n,c,"text")},resetSearchFilters:function(u){var t={};t.widget_id=s.widget_id;this.socket.dispatchEvent("unregisterSearchContext",t);this.socket.unsubscribeServer("SearchComServer");this.socket.removeListener("Selected_Objects_search",this.listener);this.socket.disconnect();this.socket=new g.Socket(this.socketName,{dispacthRetryInterval:0});this.socket.subscribeServer("SearchComServer");this.socket.dispatchEvent("RegisterContext",s);this.socket.addListener("Selected_Objects_search",this.selectedObjectsSearch.bind(this));p=this.socket},onDestroy:function(){this.socket.disconnect();delete this.socket;if(d.is(k)){k.onclick=null}if(d.is(b)){b.destroy()}},onDataFound:function(t){i.subscribe({event:"wkbSearch-DataFound",},function(u){t(u)})},launchSearch:function(t){var u=this;s.default_search_criteria=t;u.activateSearchContext()}});return f});