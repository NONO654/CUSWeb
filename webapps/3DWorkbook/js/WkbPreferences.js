define("DS/3DWorkbook/js/WkbPreferences",["UWA/Core","UWA/Class","DS/3DWorkbook/js/WkbUtils","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(f,c,e,d){var g=null;var k=null;var j=c.extend({init:function(){var m=widget.getUrl();g=m.substr(0,m.indexOf("webapps/3DWorkbook/"));return this},loadPreferences:function(){widget.addPreference({name:"collabSpace",type:"list",label:d.PrefUserRoleLbl,options:[]});widget.addPreference({name:"resType",type:"list",defaultValue:"linked",label:d.PrefResourceTypeLbl,options:[{label:d.PrefResourceTypeLinked,value:"linked"},{label:d.PrefResourceTypeCapable,value:"capable"}]})},loadUserRoles:function(m){k=m;var n=g+"resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces";e.getServerData(n,a,i,"json")},testFunction:function(n,m){switch(n){case"getPreferredSecurityContext":return h(m);case"getSecurityContextList":return l(m);case"processUserRoles":return a(m);default:break}}});function i(m){console.log("Error in loading user roles");if(k.workbook){k.workbook.userRoleError()}}function h(r){var o="";var n,q,p;var m=r.preferredcredentials;if(m&&m.collabspace&&m.role&&m.organization){n=m.collabspace.name;q=m.role.name;p=m.organization.name;o=q+"."+p+"."+n}return o}function l(q){var u=[];var s=q.collabspaces;var n,m,t,o;var r,p;if(s&&s.length>0){for(r=0;r<s.length;r++){n=s[r].name;m=s[r].couples;for(p=0;p<m.length;p++){t=m[p].organization.name;o=m[p].role.name;u.push(o+"."+t+"."+n)}}}if(u.length>0){u.sort()}return u}function a(p){var n=h(p);var u=l(p);var t=widget.getValue("collabSpace");if(t===undefined){t=""}var r=false;var o="";var s={name:"collabSpace",label:d.PrefUserRoleLbl,type:"list",options:[]};var q;for(q=0;q<u.length;q++){s.options.push({label:u[q],value:u[q]});if(t===u[q]){r=true}if(n===u[q]){o=u[q]}}widget.addPreference(s);if(r===false&&o.length>0){widget.setValue("collabSpace",o);t=o}else{if(r===false){widget.setValue("collabSpace","")}}if(t.length>0){var m=g+"resources/upr/wip/setUserRole?role="+encodeURIComponent(t);e.getServerData(m,b,b,"","json")}}function b(n){var m=n}return j});