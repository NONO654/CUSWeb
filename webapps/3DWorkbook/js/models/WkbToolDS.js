define("DS/3DWorkbook/js/models/WkbToolDS",["UWA/Core","UWA/Class","UWA/Utils","UWA/Data","UWA/Promise","DS/3DWorkbook/js/models/WkbAttributeConfig","DS/3DWorkbook/js/models/WkbTool","DS/3DWorkbook/js/WkbUtils"],function(f,m,j,n,k,i,g,b){function d(q,p){var o={input_physical_ids:q,primitives:[{navigate_to_rel:{id:7}}],patterns:{references:[{id:7}]},attributes:p,fileAttributes:[],flags:[],version:3,label:"ToolReferenceJson"};o=JSON.stringify(o);return o}function e(q){var o={input_physical_ids:[q],primitives:[{navigate_from_sr:{id:2,filter:{role:["51"],category:["5"]},mode:"ends"},navigate_to_sr:{id:3,filter:{role:["250"],category:["1"]},mode:"path"}}],patterns:{instances:[{id:2},{id:3}]},attributes:[],fileAttributes:[],version:3,label:"ToolInstanceJson"};var p=JSON.stringify(o);return p}function h(q,o){var p=0;for(p=0;p<q.length;p+=1){if(q[p].input_object.physicalid===o){return q[p].outputs.references[0]}}return null}var l=m.extend({init:function(o){i.setConfig(o)},getToolsData:function(r,p,o){var q=this;if(!f.is(r)){return new k(function(t,s){t([])})}return new k(function(u,t){var s=e(r);u(s)})["then"](function(t){var s=p+"cvservlet/navigate?SecurityContext="+encodeURIComponent(o);return b.serverRequestPromise(s,"json","POST",t)})["then"](function(s){return q.addReferenceData(s,p,o)})["then"](function(s){return new k(function(v,u){var t=[];if(s.references.length>0){t=q.transformToToolData(s)}v(t)})})["catch"](function(s){console.log(s)})},transformToToolData:function c(p){var s=0;var r=0;var u=-1;var w;var x={config:i.attributeConfig.tool};var v=[];var t={};var o=p.instances;var q=null;for(s=0;s<o.length;s+=1){t=new g(x);u=o[s].elements.length-1;if(u<0){continue}else{t.instancePhysicalId=o[s].elements[u].physicalid}w=h(p.references,t.instancePhysicalId);q=o[s].elements;t.loadWithIndexData(w,o[s].elements[u],q);v.push(t)}return v},addReferenceData:function a(p,q,o){return new k(function(A,D){var x=0;var y=-1;var w=null;var C=i.getAttributes("tool");var v=i.addDefaultAttributes(C);var s=[];if(p.result.length===0||!f.is(p.result[0].outputs.instances)){w={references:[],instances:p};A(w)}var r=p.result[0].outputs.instances;if(f.is(r)){for(x=0;x<r.length;x+=1){y=r[x].elements.length-1;if(y>=0){s.push(r[x].elements[y].physicalid)}}var B=d(s,v);var t=q+"cvservlet/navigate?SecurityContext="+encodeURIComponent(o);b.serverRequestPromise(t,"json","POST",B).then(function z(E){w={references:E.result,instances:r};A(w)},function u(E){D(E)})}})}});return l});