define("DS/3DWorkbook/js/WkbNavPanel",["UWA/Core","DS/3DWorkbook/js/WkbUtils","DS/CoreEvents/ModelEvents","DS/Controls/ResponsiveTileView","DS/UIKIT/Scroller","DS/3DWorkbook/js/WkbMask","i18n!DS/3DWorkbook/assets/nls/3DWorkbook","DS/DELMOMWKIExperience/js/WkiStreamUtil","DS/3DWorkbook/js/WkbWidgetCom","css!DS/3DWorkbook/css/WkbNavPanel.css"],function(c,o,q,J,v,m,G,y,t,s){var E,f,g=null,L="",w="SYSTEM",x=null,A=null,b,H,e,K,z=[],a,D;var j=function(P){K=P.modelEvtManager||new q();E=P.ematrixURL;L=P.systemPlmID;b=0;var Q=null;Q=K.subscribe({event:"wkbHeader-SelectOrder"},l);z.push(Q);Q=K.subscribe({event:"wkbHeader-SelectOper"},h);z.push(Q);if(c.is(P.wkiStreamUtil)){a=P.wkiStreamUtil}else{var O={serverURL:E,securityContext:widget.getValue("collabSpace"),plmIdentifier:L};a=new y(O)}this.setContainer();this.loadOperations();var N=this.getContainer();this.testFunction=p;this.wkiStreamUtil=a;return this};function u(N){A=N;b=1;n();F(N.children)}function I(Q,P,O){var R=O.thumbnailImage;if(c.is(R)&&R.length>0){Q.picture=O.thumbnailImage}else{var N=function S(T){if(c.is(T)){Q.picture=T}else{var U=function U(V){if(c.is(V)){Q.picture=V}else{Q.picture=E+"webapps/3DWorkbook/assets/images/defaultthumbnails/MOM-OperationDefault.png"}};a.getOldOperationThumbnailUrl(O.plmIdentifier,U)}};a.getImageUrl(P,N,O.plmIdentifier)}}function F(P){var N=null;var O=null;var Q=e.getElement(".navListDiv");if(Q!==null){Q.parentNode.removeChild(Q)}Q=c.createElement("div",{id:"navListDiv","class":"navListDiv"});var R=function(){P.forEach(function(S){var W=S.description;var T=S.displayName+"  ("+G.OperRevLbl+"."+S.version+")";var V=G.OperMaturityLbl+S.status;if(c.is(S.children)&&S.children.length>0){N=[" "];O=function(){u(S)}}else{N=null;O=null}var U=new J({tileWidth:290,title:T,multipleTitleLineNumber:false,subtitle:V,description:W,statusbarIcons:null,contextualMenu:N,onContextMenuBuildCallback:O});var X=S.id+"_thumbnail.png";I(U,X,S);U.elements.maincontent.parentElement.onclick=function(){k(S,U)};U.elements.description.style.height="26px";if(w===S){U.highlight();g=U}U.getContent().style.width=null;U.inject(Q)});Q.inject(e);H=new v({element:Q}).inject(e)};if(a.isZipLoaded){R()}else{a.loadStreams(R)}}function l(N){b=0;w="SYSTEM";x=null;n();if(f){F(f)}}function B(N){b=1;A=null;w=N;x=N.parentPlmIdentifier;n();F(f);t.publishOperationSelected(N)}function h(P){var N={};var O=0;for(O;O<f.length;O+=1){N=f[O];if(c.is(P.object_data.plmIdentifier)){if(N.plmIdentifier===P.object_data.plmIdentifier){B(N);break}}else{if(N.instanceName===P.object_data.instanceName){B(N);break}}}}function C(N){var O=JSON.parse(N);f=[];if(O.length){O.forEach(function(Q){if(Q.parentType==="SYSTEM"){Q.children=[];f.push(Q)}});O.forEach(function(Q){if(Q.parentType!=="SYSTEM"){f.forEach(function(R){if(R.plmIdentifier===Q.parentPlmIdentifier){R.children.push(Q)}})}});n();F(f);K.publish({event:"wkbNav-SystemLoaded",data:{object_type:"SYSTEM",object_data:f[0]}})}var P=e.getElement(".navListDiv");if(P!==null){m.unmask(P)}}function M(N){console.log(N)}function n(){var P=e.getElement(".navHeaderDiv");if(P!==null){P.parentNode.removeChild(P)}P=c.createElement("div",{id:"navHeaderDiv","class":"navHeaderDiv"});var O=c.createElement("div",{"class":"navHeaderChevron fonticon fonticon-open-left "}).inject(P);if(b===0||(b===1&&A===null)){c.createElement("p",{html:G.OperationsLbl}).inject(P);O.style.display="none"}else{c.createElement("p",{html:A.displayName}).inject(P);O.onclick=function N(){x=null;b=0;n();F(f);w=null;A=null}}P.inject(e)}function k(N,O){if(N!==w){if(N.parentPlmIdentifier!==x){b++}K.publish({event:"wkbNav-SelectOper",data:{object_data:N,level:b,parent:A}});w=N;x=w.parentPlmIdentifier;if(g!==null){g.unhighlight()}O.highlight();g=O;t.publishOperationSelected(N)}}function i(N,O){b=1;w=N;x=N.parentPlmIdentifier;n();F(O);w={};k(N,g)}function d(R){var P={},U=null,S=0,Q=0;var X=false,O=false,T=false;var W=R.object_data.instanceName;var V=R.object_data.referenceName;var N=R.object_data.plmID;if(c.is(N)&&N.length>0){T=true}else{if(c.is(W)&&W.length>0){X=true}else{if(c.is(V)&&V.length>0){O=true}else{return}}}for(S;S<f.length;S+=1){P=f[S];if((T&&P.id===N)||(X&&P.instanceName===W)||(O&&P.name===V)){i(P,f);return}else{Q=0;for(Q;Q<P.children.length;Q+=1){U=P.children[Q];if((T&&U.id===N)||(X&&U.instanceName===W)||(O&&U.name===V)){A=P;i(U,P.children);return}}}}t.publishLoadError("Operation not found, instance name = "+W)}function r(){if(c.is(H)){H.destroy();H=null}if(c.is(a)&&a.dispose){a.dispose()}a=null;z.forEach(function(N){K.unsubscribe(N)});e.testFunction=null;e.dispose=null;e.destroy()}function p(Q,P,O,N){switch(Q){case"createList":return F(P);case"processOperations":return C(P);case"addImageToTile":return I(P,O,N);case"manualSelectOperation":return d(P);default:break}}j.prototype={loadOperations:function(){if(c.is(L)&&L.length>0){var O=e.getElement(".navListDiv");if(O!==null){m.mask(O)}var N=E+"resources/upr/wip/operationsandsubops";N=N+"?parentPLMID="+L+"&displayThumbnails="+true+"&pageSize=-1&startIndex=0";o.getServerData(N,C,M,"text")}},setContainer:function(){var N=c.createElement("div",{id:"navPanelDiv","class":"navPanelDiv"});var O=c.createElement("div",{id:"navListDiv","class":"navListDiv"});O.inject(N);e=N},getContainer:function(){return e},dispose:r,getSystemPLMID:function(){return L},selectOperation:function(N){d(N)}};return j});