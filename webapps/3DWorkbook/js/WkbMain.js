define("DS/3DWorkbook/js/WkbMain",["UWA/Core","UWA/Class","UWA/Utils/InterCom","DS/CoreEvents/ModelEvents","DS/3DWorkbook/js/WkbUtils","WebappsUtils/WebappsUtils","DS/3DWorkbook/js/WkbNavPanel","DS/3DWorkbook/js/WkbDetails","DS/3DWorkbook/js/WkbSearch","DS/3DWorkbook/js/WkbHeaderPanel","DS/3DWorkbook/js/Wkb2DViewer","DS/3DWorkbook/js/Wkb3DViewer","DS/3DWorkbook/js/WkbWidgetCom","DS/Windows/DockingElement","UWA/Controls/Lightbox","DS/Utilities/Css","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(e,c,S,z,y,K,r,f,g,b,k,q,B,x,p,a,M){var u,h,o,l,H,w,U,C,n,m,P,n="",s=null,I=null,T=null,A=true,Q=false,O,N;var J={};var t=null;var L;var i;var D;var I;var G;var F=[];var v=function(W){var V=W};var d=function d(W,Y){var X=e.createElement("button",{"class":"button-primary button-all button-alert"});X.style.cursor="default";X.type="submit";X.value="Ok";X.textContent=M.GeneralOKLbl;X.onclick=function V(){Y.close()};X.inject(W);y.createAndAppend(W,"p","clear")};var j=function j(V,Y,aa,ab){var ad=e.createElement("div",{"class":"alertWindow"});var W=e.createElement("div",{"class":"fonticon fonticon-alert alertWindowTitleImg",styles:{"font-size":"40px"}});var ac=e.createElement("div",{"class":"alertWindowTitle"});ac.textContent=aa;W.inject(ad);ac.inject(ad);var Z=e.createElement("div",{"class":"alertMsg",id:"AlertWindowMsg"+Y});Z.innerHTML=y.getAlertMessageBody(ab);Z.inject(ad);d(Z,V);var X=u.getElement(".alert"+Y);ad.inject(X)};var R=function R(ab,X,ad,W){var Z=this;var Y="alert"+ab;var ac=(u.getElement("."+Y));if(ac){ac.destroy()}var aa=new p({closeable:false,className:Y+" alertOverlay",exclusive:(W===1)});aa.onOpen=function V(){j(aa,ab,X.name,ad);y.createAndAppend(aa.elements.container,"p","clear")};aa.fxOptions={fade:0.5};aa.inject(u);aa.open()};var E=c.extend({init:function(V){var V=V||{};var W=this;P=new z();w=V.url;U=w.substr(0,w.indexOf("3DWorkbook")+11);n=w.substr(0,w.indexOf("webapps/3DWorkbook/"));V.title="3D Workbook";this.options=V;this._parent(V);m=V.widgetBody;O=V.preferences;widget.setBody("");h=V.widget_id;this.resetSubscriptions();J={role:y.getPreferenceValue(O,"collabSpace"),insertUI:true,container:V.widgetBody,widget_id:h,ematrixURL:n,modelEvtManager:P};G=new g(J);var X={wkbMain:this,wkbDetails:I,wkb3DViewer:o,wkbNavPanel:s,wkbHeader:T};B.init(X)},initializeSearch:function(){this.socketName="search_socket_"+(new Date()).getTime();var V={};V.role=y.getPreferenceValue(O,"collabSpace");V.title="3D Workbook";V.mode="furtive";V.attributeDisplayVals="";V.attributeTypes="";V.attributes="";V.default_with_precond=true;V.precond="flattenedtaxonomies:types/DELLmiPPRSystemReference";V.show_precond=false;V.multiSel=false;V.app_socket_id=this.socketName;V.widget_id=widget.id;if(!e.is(this.socket)){this.socket=new S.Socket(this.socketName,{dispacthRetryInterval:0});this.socket.subscribeServer("SearchComServer");t=this.socket}this.socket.dispatchEvent("RegisterContext",V)},resetSubscriptions:function(){F.forEach(function(X){P.unsubscribe(X)});var W=this;var V=P.subscribe({event:"wkbSearch-DataFound",},function(X){W.onSystemSelected(X)});F.push(V);V=P.subscribe({event:"wkbDetails-Alert",},function(X){W.onAlert(X)});F.push(V);V=P.subscribe({event:"wkbHeader-Select2D",},function(X){W.onSelectGraphics(X,"2D")});F.push(V);V=P.subscribe({event:"wkbHeader-Select3D",},function(X){W.onSelectGraphics(X,"3D")});F.push(V)},onRefresh:function(V){this.widgetPreferences=V},endEdit:function(W){this.widgetPreferences=W;var X=y.getPreferenceValue(W,"collabSpace");if(X.length>0){var V=n+"resources/upr/wip/setUserRole?role="+encodeURIComponent(X);y.getServerData(V,v,v,"","json")}},closeDetailsPanel:function(V){i.collapseDockingZoneFlag=true},openDetailsPanel:function(V){i.collapseDockingZoneFlag=false},closeNavPanel:function(V){L.collapseDockingZoneFlag=true},openNavPanel:function(V){L.collapseDockingZoneFlag=false},onNavSizeChange:function(V){setTimeout(function(){P.publish({event:"wkbMain-NavSizeChanged",data:{}})},500)},onDetailSizeChange:function(V){setTimeout(function(){P.publish({event:"wkbMain-DetailSizeChanged",data:{}})},500)},getSystemData:function(){return N},onSystemSelected:function(W,X){var V=this;N=JSON.parse(W);setTimeout(function(){V.resetSubscriptions();V.destroy();var Y=JSON.parse(W);V.buildWidget(Y);if(e.is(X)){X()}},200)},_onLoadSystemError:function(V){console.log("LOAD SYSTEM ERROR: "+V);B.publishLoadError(V.message)},loadSystem:function(Y,Z){var X=this;var W=function(aa){X.onSystemSelected(aa,Z)};var V=n+"resources/upr/wip/shoporder?PLMEXTERNALID="+encodeURIComponent(Y.sysPLMID)+"&REVISION="+encodeURIComponent(Y.sysRevision)+"&PLMIDENTIFIER="+Y.sysRefName+"&TITLE="+Y.sysTitle;y.getServerData(V,W,X._onLoadSystemError,"text")},onSelectGraphics:function(X,Z){var W={modelEvtManager:P,appURL:U,ematrixURL:n,widgetPreferences:O,widget_id:h,name:X.id,systemRefName:X.systemRefName,systemPLMID:X.systemPLMID};P.publish({event:(Z==="2D")?"wkbMain-Remove3D":"wkbMain-Remove2D",data:{}});D.freeZoneContent=null;if(Z==="2D"){D.freeZoneContent=new k(W)}else{if(e.is(o)){D.freeZoneContent=o.getContainer()}else{o=new q(W);D.freeZoneContent=o.getContainer()}}var Y=X.object_type;var V={plmIdentifier:X.plmId,parentType:X.parent_type,id:X.id,systemPlmIdentifier:X.systemPLMID,systemPhysicalId:X.systemPhysicalId,publishedProductId:X.publishedProductId};if(X.parentPlmId){V.parentPlmIdentifier=X.parentPlmId}P.publish({event:"wkbMain-GraphicsChanged",data:{object_type:Y,object_data:V}})},onAlert:function(W){var V;for(V=W.length-1;V>-1;V--){R(V,W[V],W[V].message,W.length)}},getAppURL:function(){return U},publishWidgetLoaded:function(V){B.publishWidgetLoaded(V)},getEventManager:function(){return P},destroy:function(){if(e.is(o)){C=o.getCtx();o.dispose()}P.publish({event:"wkbMain-Remove2D",data:{}});if(e.is(l)){l.dispose()}if(e.is(G)){G.onDestroy();G=null}if(e.is(I)){I.dispose();I=null}if(e.is(s)){s.dispose()}if(e.is(L)){L.removeEventListener("collapse",this.onNavSizeChange);L.removeEventListener("expand",this.onNavSizeChange);L.removeEventListener("dockResize",this.onNavSizeChange);L.destroy()}if(e.is(i)){i.removeEventListener("collapse",this.onDetailSizeChange);i.removeEventListener("expand",this.onDetailSizeChange);i.removeEventListener("dockResize",this.onDetailSizeChange);i.destroy()}if(e.is(D)){D.destroy()}},userRoleError:function(){if(e.is(G)){G.displayUserRoleError(J.container)}},buildWidget:function(W){Q=true;u=e.createElement("div",{id:"wkbMainDiv","class":"wkbMainDiv"});u.style.height="100%";var Z=320;var ac=screen.width*0.51;var V={ematrixURL:n,systemPlmID:W.plmIdentifier,systemRefName:W.id,publishedProductId:W.publishedProductId,modelEvtManager:P,wkbWidgetCom:H};s=new r(V);var ab={useBordersFlag:false,side:WUXDockAreaEnum.LeftDockArea,maxSize:ac,minSize:Z,dockingZoneSize:Z,dockingZoneContent:s.getContainer()};L=new x(ab);L.elements.dockingZone.style.overflow="hidden";L.addEventListener("collapse",this.onNavSizeChange);L.addEventListener("expand",this.onNavSizeChange);L.addEventListener("dockResize",this.onNavSizeChange);var V={modelEvtManager:P,appURL:U,widgetPreferences:O,ematrixURL:n,systemData:W};I=new f(V);var Y={useBordersFlag:false,side:WUXDockAreaEnum.RightDockArea,maxSize:ac,minSize:Z,dockingZoneSize:Z,collapsibleFlag:true,dockingZoneContent:I};i=new x(Y);i.elements.dockingZone.style.overflow="hidden";i.addEventListener("collapse",this.onDetailSizeChange);i.addEventListener("expand",this.onDetailSizeChange);i.addEventListener("dockResize",this.onDetailSizeChange);V={modelEvtManager:P,appURL:U,ematrixURL:n,widgetPreferences:O,widget_id:h,plmID:W.plmIdentifier,name:W.displayName,systemRefName:W.id,systemPhysicalId:W.physicalId,publishedProductId:W.publishedProductId,ctx:C};T=new b(V);var X={useBordersFlag:false,side:WUXDockAreaEnum.TopDockArea,maxSize:38,minSize:38,dockingZoneSize:38,collapsibleFlag:false,dockingZoneContent:T};D=new x(X);o=new q(V);D.freeZoneContent=o.getContainer();i.freeZoneContent=D;L.freeZoneContent=i;L.inject(u);widget.setBody(u);var aa={wkbMain:this,wkbDetails:I,wkb3DViewer:o,wkbNavPanel:s,wkbHeader:T};B.setPanels(aa)},insertAlertOkButton:function(V,W){d(V,W)},insertAlertWindow:function(Y,V,W,X){j(Y,V,W,X)}});return E});