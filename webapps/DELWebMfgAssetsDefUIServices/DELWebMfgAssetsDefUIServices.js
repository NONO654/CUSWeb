define("DS/DELWebMfgAssetsDefUIServices/UIPreferences",["UWA/Core","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils"],function(g,b){var f={TableView:null,LeftBloc:null,RightBloc:null,AuxiliaryView:null,BOMView:null,InsertCmdFormAttribute:null,getLabel:function(i){var j={treeDataIndex:null,label:null,labelIsOnRef:null,dicoType:null},k,h;if(g.owns(i,"Label")){j.treeDataIndex=i.Label.dataIndex;j.dicoType=i.Label.dicoType;k=j.treeDataIndex.split(".");j.label=k[0];h=k[1];if(h==="instance"){j.labelIsOnRef=false}else{j.labelIsOnRef=true}}return j},getLabelByView:function c(h){var i;switch(h){case"MBOM":case"ROUTINGS":i=this.getLabel(this.TableView);break;case"BODY":i=this.getLabel(this.LeftBloc);break;default:}return i},getColumnsValue:function(h){var j="",i;if(g.owns(h,"Columns")){i=h.Columns.Column;i.forEach(function(k){if(j===""){j=k.dataIndex}else{j=j+","+k.dataIndex}})}return j},getBlockAttributes:function d(i){var h={index:[],database:[]},l=0,j=g.is(i.Columns)?i.Columns.Column:[],k=this.getLabel(i);if(g.is(k.label)){h.index.push(k.label);h.database.push(k.label)}j.forEach(function(n){var m=n.dataIndex,o=m.split(".")[0];if((m.split(".")).length===3){o=m.split(".")[0]+"."+m.split(".")[1]}if(m.indexOf(".instance")!==-1||m.indexOf(".reference")!==-1){if(h.index.indexOf(o)===-1){h.index.push(o)}}if(m.indexOf(".relation")!==-1){l++}if(h.database.indexOf(o)===-1){h.database.push(o)}});if(l>0){Object.keys(b._relAttrToRelations).forEach(function(n){var m=b._relAttrToRelations[n];Object.keys(m).forEach(function(q){var p,r,o=m[q];if(o==="RelationType"){q=b.typeToDisplayAttrMap[q];p=q.display_attribute;r=p.split(".")[0];if((p.split(".")).length===3){r=p.split(".")[0]+"."+p.split(".")[1]}if(h.index.indexOf(r)===-1){h.index.push(r)}}})});l=0}return h},getAttributeNameFromColumn:function e(i){var j=i.dataIndex.split("."),h=j[0]===i.dicoType?j[1]:j[0];if(g.is(i.dicoType)){h=i.dicoType+"."+h}return h},getShowDialog:function(){var h=widget.getValue("showDialog");if(!g.is(h)||h==="true"){return true}return false},getSeparator:function(){return widget.getValue("separator")},processGraphViewPreferences:function a(h,k){var j,i;if(g.is(h.Config.Preferences[k])){f[k]={};if(g.is(h.Config.Preferences[k]["Color"])){f[k]["Color"]=h.Config.Preferences.BOMView.Color.AttributeDefinition;f[k]["Color"]["colorDef"]=h.convert("Config.Preferences.BOMView.Color.ColorDefinition","value")}if(g.is(h.Config.Preferences[k]["Content"])){f[k]["Content"]={};i=h.convert("Config.Preferences.BOMView.Content.Type","name");for(j in i){if(i.hasOwnProperty(j)){f[k]["Content"][j]=Array.isArray(i[j].Row)?i[j].Row:[i[j].Row]}}}}},};return f});define("DS/DELWebMfgAssetsDefUIServices/Viewer3DUtil",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils"],function(f,b,c,d){var a=function a(){var j=c.getAppId(),i="DS/PADUtils/PADCommandProxy/",h={HIDE:"hide",SHOW:"show"};var g;g=function g(o,n,t){var v=t||{},p=f.is(v.privateEvent,"boolean")?v.privateEvent:false,s={},r,q,u=null;if(f.is(n)){s.data=n}q=d._get3DViewerMetadatas();if(f.is(q)){s=f.merge(s,q);if(p){r=i+o+j}else{r=i+o}u={name:r,parameters:s}}return u};return{compute3DViewerPathFromEBOM:function m(q){var o=0,n={attributes:{},paths:[],};q.forEach(function p(r){var t=r.getPath();t.forEach(function s(u){if(!f.is(n.paths[o])){n.paths.push([])}if(f.is(u.getInstancePID())){n.paths[o].push(u.getInstancePID())}n.paths[o].push(u.getReferencePID());n.attributes[u.getReferencePID()]=u.getReferenceType()});o+=1});return n},compute3DViewerPathFromMBOM:function l(u){var r=0,t={attributes:{},paths:[],},q,n,w,o,p,v;u.forEach(function s(B){var y=B.getScopedNode(),A;if(f.is(y)){A=B.getFirstParentWithAScopeNode();q=f.is(A)?A:B;if(Array.isArray(y)){y=y[0]}o=B.getImplementLinks();if(Array.isArray(o)&&(o.length>0)){w=o.map(function x(C){return C.to})}else{n=[y.getID()];w=[]}}else{q=B.getFirstParentWithAScopeNode();o=B.getImplementLinks();if(Array.isArray(o)&&(o.length>0)){w=o.map(function x(C){return C.to})}}if(f.is(q)){p=q.getScopedNode();if(!Array.isArray(p)){p=[p]}p.forEach(function z(F){var G=[],D,E;for(E=0;E<w.length;E++){D=F.getDescendantNode(w[E]);if(f.is(D)){G.push(D);break}}if(f.is(y)){G=G.filter(function C(J){var I=false;if(f.is(J)&&(J.getInstancePID()===y.getInstancePID())){I=true}return I})}if(Array.isArray(G)&&(0<G.length)){v=G[0].getPath();v.forEach(function H(I){if(!f.is(t.paths[r])){t.paths.push([])}if(f.is(I.getInstancePID())){t.paths[r].push(I.getInstancePID())}t.paths[r].push(I.getReferencePID());t.attributes[I.getReferencePID()]=I.getReferenceType()});r+=1}else{if(Array.isArray(n)&&(-1!==n.indexOf(F.getReferencePID()))){t.attributes[F.getReferencePID()]=F.getReferenceType();if(!f.is(t.paths[r])){t.paths.push([])}t.paths[r].push(F.getReferencePID());r+=1}}})}});return t},hideShow3D:function k(u,p){var r=this,o,q=p?h.SHOW:h.HIDE,t,n,s=function s(y){var w=null,v,x,z=[];v=[];v.push(y);while(v.length>0){x=v.pop();if(x.isRoot()||x.isImplemented()){z.push(x);continue}if(x.hasChildren()){x.getChildren().forEach(function A(B){v.push(B)})}}if(z.length>0){w=r.compute3DViewerPathFromMBOM(z)}return w};o=s(u);if(f.is(o)){n=o;t=g(q,n,{privateEvent:true});if(f.is(t)){b.publish(t.name,t.parameters)}}}}};var e=(function e(){var g;return{getInstance:function h(){if(!f.is(g)){g=new a()}return g}}})();return e});define("DS/DELWebMfgAssetsDefUIServices/TreeListViewManager",["UWA/Core","UWA/Class","DS/Tree/Manager"],function(e,b,c){var a=c.extend({name:"TreeListViewManager",init:function d(g,f){this._parent(g,f)}});return a});define("DS/DELWebMfgAssetsDefUIServices/DocumentColumnManager",["UWA/Core","UWA/Class","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefUIControls/DocumentMgmtUI","DS/DELWebMfgAssetsDefModelServices/DocumentObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefModelServices/Resources"],function(e,b,j,h,m,d,a){var k=b.singleton({name:"DocumentColumnManager",init:function l(n){this._parent(n)},fillNodeOptions:function g(o,s){var p,q=j.references.get(o.referencePID),r=q.getDisplayModelAttr("documentIDList"),n=k._getDocumentNames(r,s);for(p in n){if(!q.get("queriedForDocuments")){o.grid[p]=[a.getNLSValue("RelationsNotLoadedQuestionMark")]}else{if(n.hasOwnProperty(p)){o.grid[p]=n[p]}}}return o},updateAttributes:function f(n,p){var r=p.changedAttributes(),q=n.getColumnsDataIndex(),s,o;if(!e.is(r)){return}if(r.hasOwnProperty("displayModel")){s=r.displayModel.changedAttributes()["documentIDList"];o=k._getDocumentNames(s,q)}if(e.is(o)&&Object.keys(o).length>0){n.updateTreeDocument(p,null,o)}},_getDocumentNames:function i(u,t){var r,o,s=[],q={},p,n;if(!Array.isArray(t)){t=[t]}if(!e.is(u)||t.length<=0){return}for(r=0;r<t.length;r++){o=t[r];if(o.split(".")[1]!=="document"){continue}q[o]=[];for(p=0;p<u.length;p++){n=j.documents.where({id:u[p]});s[p]=m.getDocumentAttributes(n,o)}q[o]=s}return q},formatDocumentColumn:function c(s){var q,r,n,p,o;if(!s.isHeader){q=s.cellModel.options.value;if(Array.isArray(q)&&q.length!==0){if(q[0].Value===a.getNLSValue("RelationsNotLoadedQuestionMark")){r=s.cellView.reuseCellContent("relationsNotLoadedCell");if(e.is(r)){o=q[0].Value;n=r.children[0].getElement(".wux-layouts-treeview-label");if(e.is(n)){if(j.getReferenceFromCollection(s.nodeModel.getReferencePID()).get("queriedForDocuments")){n.innerHTML=""}else{n.innerHTML=o}}n.addClassName("data-not-loaded");s.cellView.getContent().setContent(r)}}else{r=s.cellView.reuseCellContent("multiValueLabelCell");if(e.is(r)){n=r.getElement(".wux-layouts-treeview-label");if(e.is(n)){n.innerHTML=q[0];n.removeClassName("data-not-loaded")}p=r.getElement(".wux-layouts-rowentry-moreindicator");if(e.is(p)){p.style.display=(q.length>1)?"inline-block":"none"}}if(q[0]===a.getNLSValue("RelationsNotLoadedQuestionMark")){if(j.getReferenceFromCollection(s.nodeModel.getReferencePID()).get("queriedForDocuments")){n.innerHTML=""}else{n.addClassName("data-not-loaded")}}s.cellView.getContent().setContent(r)}}}}});return k});define("DS/DELWebMfgAssetsDefUIServices/ToggleCustom",["UWA/Core","DS/Controls/Abstract","DS/Utilities/Utils","DS/Utilities/Dom","DS/Core/PointerEvents"],function(e,h,j,a,f){var l=h.inherit({name:"toggleCustom",cssEye:"wux-ui-3ds-eye",cssEyeOff:"wux-ui-3ds-eye-off",publishedProperties:{type:{defaultValue:"checkbox",type:"string",category:"Behavior"},checkFlag:{defaultValue:false,type:"boolean",category:"Behavior",recordFlag:true},label:{defaultValue:"",type:"string",category:"Appearance"},value:{defaultValue:(void 0),type:"object",noNeedToApplyFlag:true,category:"Behavior",recordFlag:true},clickMode:{defaultValue:0,type:"integer",category:"Behavior"},allowUnsafeHTMLLabel:{defaultValue:(void 0),type:"boolean",category:"Behavior"}},keymaps:{"return":{keydown:"validate",keyup:"validate"},space:{keydown:"validate",keyup:"validate"},},commands:{validate:function(t){var u={},s,r;if(this.disabled){return{stopPropagation:false}}if((this.clickMode===1&&t.type==="keydown")||(this.clickMode===0&&t.type==="keyup")){u.actionPerformed=this.toggle();s={ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey};this.fire("buttonclick",s)}if(e.Event.whichKey(t)==="return"){r={stopPropagation:false,infos:u}}else{r={stopPropagation:true,infos:u}}return r},},buildView:function n(){this.elements.container.classList.add("wux-controls-toggle");this.elements.container.setStyle("text-align","center");this.elements.container.setAttribute("tabindex",0);this.elements.checkSign=e.createElement("div",{"class":"wux-ui-3ds wux-ui-3ds-1x",styles:{fontSize:"14px"},tabindex:-1});this.elements.checkSign.inject(this.elements.container);this.preventTriggeringChangeEvent=true},_postBuildView:function p(){this.preventTriggeringChangeEvent=false},handleEvents:function k(){var r=this;a.addEventOnElement(this,r.elements.container,"click",function(t){var s;if(r.clickMode===0){if(r.disabled){return}r.callMethodFromUIInteraction("toggle");s={ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey};r.fire("buttonclick",s)}});a.addEventOnElement(this,r.elements.container,f.POINTERDOWN,function(t){var s;if(r.clickMode===1){if(r.disabled){return}r.callMethodFromUIInteraction("toggle");s={ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey};r.fire("buttonclick",s)}});a.addEventOnElement(this,r.elements.container,f.POINTERHIT,function(s){if(s.multipleHitCount!==2){return}s.stopPropagation();if(r.disabled){return}r.fire("buttonDblClick")});a.addEventOnElement(this,this.elements.checkSign,"focus",function(s){r.elements.container.focus()})},_applyType:function c(){if(this.type==="checkbox"){this.elements.checkSign.classList.add(this.cssEye)}this._applyCheckFlag()},_applyLabel:function i(){var r;if(this.label===""&&this.elements.label){this.elements.label.destroy()}else{if(this.label!==""){if(!this.elements.label){this.elements.label=e.createElement("label",{"class":"wux-label",tabindex:-1});this.elements.label.inject(this.elements.container);r=this;a.addEventOnElement(this,this.elements.label,"focus",function(s){r.elements.container.focus()})}if(!j.getUnsafeHTMLContentValueToApply(this.allowUnsafeHTMLLabel)){this.elements.label.setText(this.label)}else{this.elements.label.setHTML(this.label)}}}},_applyAllowUnsafeHTMLLabel:function q(){this._applyLabel()},_applyCheckFlag:function b(){if(this.checkFlag===true){this.elements.checkSign.classList.remove(this.cssEyeOff);this.elements.checkSign.classList.add(this.cssEye)}else{this.elements.checkSign.classList.remove(this.cssEye);this.elements.checkSign.classList.add(this.cssEyeOff)}if(!this.preventTriggeringChangeEvent){this.fire("change")}},_applyDisabled:function o(){this._parent();if(this.disabled===true){this.elements.container.setAttribute("tabindex",-1);this.elements.checkSign.disabled=this.disabled}else{this.elements.container.setAttribute("tabindex",0)}},_applyProperties:function m(r){this._parent(r);if(this.isDirty("type")){this._applyType()}if(this.isDirty("label")||this.isDirty("allowUnsafeHTMLLabel")){this._applyLabel()}if(this.isDirty("checkFlag")){this._applyCheckFlag()}},_giveFocus:function d(){if(!this._isFocused()){this.elements.container.focus()}},toggle:function g(){var r=false;if(this.type==="checkbox"){this.checkFlag=!this.checkFlag;r=true}return r}});return l});define("DS/DELWebMfgAssetsDefUIServices/FilterComponentServices",["UWA/Core","UWA/Class"],function(g,c){var b=c.extend({init:function(i){this._treeDocument=i.treeDocument},parse:function f(i){var l=this,n,p,m,q,j,o={},k=[];for(n in i){if(!i.hasOwnProperty(n)){continue}p=i[n];for(m in p){if(!p.hasOwnProperty(m)){continue}q=p[m];if(!o[m]){o[m]={}}if(q.type==="date"){q.value=q.value.split("-").join("/").substr(0,10)}if(!o[m][q.value]){o[m][q.value]={type:q.type,dispValue:q.dispValue||q.value,subjects:[]}}o[m][q.value].subjects.push(n)}}for(q in o){if(!o.hasOwnProperty(q)){continue}for(j in o[q]){if(!o[q].hasOwnProperty(j)){continue}k.push({sixw:q,object:j,value:j,count:o[q][j].subjects.length,type:o[q][j].type,dispValue:o[q][j].dispValue})}}return{ds6wTagGrouped:o,ds6wTagSummary:k,}},findColoredPaths:function(l,j){var k=[],m={};if(j.type==="date"){m=l[j.predicate];for(var i in m){if(m.hasOwnProperty(i)){if(i.indexOf(j.object)!==-1){g.merge(k,m[i].subjects)}}}}else{if(l[j.predicate]&&l[j.predicate][j.object]){k=l[j.predicate][j.object].subjects}}return k},getTagsSummary:function a(k){var i,j,l=[];for(i in k){if(!k.hasOwnProperty(i)){continue}for(j in k[i]){if(!k[i].hasOwnProperty(j)){continue}l.push({sixw:i,object:j,value:j,count:k[i][j].subjects.length,type:k[i][j].type,dispValue:k[i][j].dispValue})}}return l},getFilteredSubjects:function h(n,m){var j=[],q=[],l,o,k;for(o in n){if(n.hasOwnProperty(o)){l=n[o];for(k=0;k<l.length;k++){if(m&&m[o]&&m[o][l[k].object]){if(Array.isArray(j)&&(j.length===0)){m[o][l[k].object].subjects.forEach(function(i){j.push(i)})}else{q=[];m[o][l[k].object].subjects.forEach(function(i){q.push(i)});q=j.filter(function p(r){var i=q.indexOf(r)!==-1;return i});if(0!==q.length){j=q}}}}}}return j},flagFilteredInNodes:function d(k){var j=this,l=k.subjectpaths,i=k.allsubjectpaths;l.forEach(function(n){var m=i[n],o=j._treeDocument.getNodeModel(m);if(Array.isArray(o)&&(o.length>0)){o.forEach(function(p){var q=p.isRoot()?p.getReferencePID():p.getAbsolutePath().toString();if(q===n){p._filterStatus="IN";p.getParents().forEach(function(r){r._filterStatus="IN"})}})}})},filterOutNodes:function e(){var l=this,k=l._treeDocument.getRoots().slice(0),j;var i=function i(m){if(m._filterStatus==="IN"){j=m.getChildren();if(j&&j.length>0){j.slice(0).forEach(function(n){i(n)})}}else{m.filterOut()}delete m._filterStatus};k.forEach(function(m){i(m)})},});return b});define("DS/DELWebMfgAssetsDefUIServices/TooltipUtils",["UWA/Core","UWA/Class","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/ModelUtils"],function(d,a,h,e,b){var k=a.singleton({init:function l(m){this._parent(m);this.tooltipMap={};this._getTooltipConfiguration()},_getTooltipNLSValue:function f(m,n){var o;o=e.getNLSValue(n+"."+m);return d.is(o)?o:n+"."+m},_extractInformation:function j(o,n){var m;if(d.is(n)){n=(Array.isArray(n))?n:[n];for(m=0;m<n.length;m++){o.tooltipMap[n[m].name]=(Array.isArray(n[m].Attribute))?n[m].Attribute:[n[m].Attribute]}}},_getTooltipConfiguration:function c(){var m=this;b.getXMLValues("DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUITooltipConfig",function n(o){var p=o.Tooltips;m._extractInformation(m,p.Tooltip)})},_getToolTipInformation:function i(m){return this.tooltipMap[m]},getTooltipValue:function g(y){var t,n="",x,v,w,o,u,q,r,p=d.is(y.nodeModel.getInstancePID()),s=p?h.instances.get(y.nodeModel.getInstancePID()):h.references.get(y.nodeModel.getReferencePID()),m=y.manager.options.columns[y.data.columnID].tooltipIndex;if(d.is(m)){x=this._getToolTipInformation(m);if(d.is(x)){for(t=0;t<x.length;t++){q=x[t].dataIndex.split(".");u=q[0];v=q[q.length-2];w=v===u?v:u+"."+v;o=q[q.length-1];if(o==="instance"&&!p){continue}if(s){r=s.get(w);if(d.is(r)&&r!==""){n+=k._getTooltipNLSValue(v,x[t].dicoType)+" : "+r+"\n"}}}}}return n}});return k});define("DS/DELWebMfgAssetsDefUIServices/Search",["UWA/Core","UWA/Utils/InterCom"],function(c,b){var a=function(d){this.socketName="search_socket_"+(new Date()).getTime();this.socket=new b.Socket(this.socketName,{dispatchRetryInterval:5});this.socket.subscribeServer("SearchComServer");this.callback=d.bind(this);this.socket.addListener("Selected_Objects_search",this.callback)};a.prototype.options=function(h,d,e,g){var f={};f.title=h;f.mode="furtive";f.app_socket_id=this.socketName;f.widget_id=widget.id;f.default_with_precond=true;f.show_precond=false;f.source=["3dspace"];f.default_search_criteria="";f.precond="";f.multiSel=c.is(g,"boolean")?g:true;if(c.is(e)){e.forEach(function(i){if(""!==f.default_search_criteria){f.default_search_criteria+=" OR "}f.default_search_criteria+=i})}if(c.is(d)){d.forEach(function(i){if(""!==f.precond){f.precond+=" OR "}f.precond+='flattenedtaxonomies:"types/'+i+'"'});f.precond="("+f.precond+")"}return(f)};a.prototype.register=function(e){var d=this;e=(null!==e)?e:this.options();this.socket.dispatchEvent("RegisterContext",e);this.socket.addListener("onCloseTransient",function f(){d.socket.removeListener("onCloseTransient");d.unRegister()})};a.prototype.unRegister=function(){var d={widget_id:widget.id};this.socket.dispatchEvent("unregisterSearchContext",d);this.socket.dispatchEvent("UnregisterContext",d)};a.prototype.destroy=function(){this.unRegister();this.socket.unsubscribeServer("SearchComServer");this.socket.removeListener("Selected_Objects_search",this.listener);this.socket.disconnect()};a.prototype.activate=function(h,e,f,g){var d=this.options(h,e,f,g);this.register(d);this.socket.dispatchEvent("InContextSearch",d)};return(a)});define("DS/DELWebMfgAssetsDefUIServices/UXComponentUtil",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/Logger/Logger","DS/ApplicationFrame/FrameWindowsManager","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIControls/ConfirmationDialog"],function(f,a,h,c,e,m,g,d){var k=a.singleton({_logger:null,init:function l(){if(f.is(c)){k._logger=c.getLogger(k)}},_launchConfirmationDialog:function b(t,r,o){var p,q,s;q=e.getFrameWindow(m.getActionBarContext());s=q.getImmersiveFrame();p=new d(t);p.show(t.title,t.message,t.data,function n(u){if(f.is(u,"boolean")&&u){if(f.is(r)){r()}}else{if(f.is(o)){o()}}},s)},buildFetchRootsFromDBDialog:function j(n,p,o){o=o||{};o=f.merge(o,{title:g.getNLSValue("AbstractDragAndDropManager.indexOrDBDialog"),message:g.getNLSValue("AbstractDragAndDropManager.RootsNotInIndex"),data:{attributes:["V_Name"],models:p}});k._launchConfirmationDialog(o,n)},buildExtendTimeoutDialog:function i(o,n,q,p){p=p||{};p=f.merge(p,{okBtnOptions:{label:g.getNLSValue("TimeOutExtensionDialog.okBtn.Label"),tooltipInfos:g.getNLSValue("TimeOutExtensionDialog.okBtn.ToolTip")},cancelBtnOptions:{label:g.getNLSValue("TimeOutExtensionDialog.cancelBtn.Label"),tooltipInfos:g.getNLSValue("TimeOutExtensionDialog.cancelBtn.ToolTip")},title:g.getNLSValue("TimeOutExtensionDialog.title"),data:{attributes:["V_Name","revision"],models:q}});k._launchConfirmationDialog(p,o,n)}});return k});define("DS/DELWebMfgAssetsDefUIServices/SecurityContext",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources"],function(g,b,d,c,h){var f=b.singleton({name:"SecurityContext",init:function p(q){this._parent(q);if(g.is(d)){this._logger=d.getLogger(f)}},_getSCFromPreferences:function n(){var t,s,q,r;t=widget.getValue("role");s=widget.getValue("organization");q=widget.getValue("collaborativeSpace");if(g.is(t)&&g.is(s)&&g.is(q)){r=t+"."+s+"."+q}return r},_getAllSctx:function k(s){var t,r,q=this;q.sctxAll=[];s.forEach(function(u){for(r=0;r<u.couples.length;r++){t=u.couples[r].role.name;t+="."+u.couples[r].organization.name;t+="."+u.name;q.sctxAll.push(t)}})},_setPrefSctx:function l(){var q,r;q=this._getSCFromPreferences();if(g.is(q,"string")&&this.sctxAll.indexOf(q)!==-1){this.updateSecurityContext(q)}else{if(g.is(this.response.preferredcredentials)&&Object.keys(this.response.preferredcredentials).length>0){r=this.response.preferredcredentials.role.name;r+="."+this.response.preferredcredentials.organization.name;r+="."+this.response.preferredcredentials.collabspace.name;this.updateSecurityContext(r)}else{this.updateSecurityContext(this.sctxAll[0]);this.warnings=h.getNLSValue("SecurityContext.NoPreferredCredentials")+this.sctxAll[0]}}},loadSecurityContexts:function a(t,s){var r=this,q=function q(u){r.warnings=null;r.response={};if(g.is(u)&&u.collabspaces.length>0){r.response=u;r._getAllSctx(u.collabspaces);r._setPrefSctx();t(r.warnings)}else{widget.body.empty();g.createElement("div",{type:"text","class":"widget-Loading-Error-Message",html:h.getNLSValue("init.buildView.NoSecurityContext")}).inject(widget.body);s()}};c.webServiceRequest({url:"modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",method:"GET",headers:{Accept:"application/json,text/javascript,*/*","Content-Type":"application/ds-json"},onComplete:q,onFailure:s,onTimeout:s})},getOrganization:function m(){var q=this,r=[];q.organizations=[];this.response.collabspaces.forEach(function(s){s.couples.forEach(function(t){if(r.indexOf(t.organization.name)===-1){r.push(t.organization.name);q.organizations.push({value:t.organization.name,label:t.organization.name})}})});return q.organizations},getCollabSpace:function j(t){var q=this,r=[],s;q.collabSpaces=[];this.response.collabspaces.forEach(function(u){for(s=0;s<u.couples.length;s++){if(t===u.couples[s].organization.name){if(r.indexOf(u.name)===-1){r.push(u.name);q.collabSpaces.push({value:u.name,label:u.name})}}}});return q.collabSpaces},getRole:function i(t,s){var q=this,r;q.roles=[];this.response.collabspaces.forEach(function(u){if(s===u.name){for(r=0;r<u.couples.length;r++){if(t===u.couples[r].organization.name){q.roles.push({value:u.couples[r].role.name,label:u.couples[r].role.nls})}}}});return q.roles},updateSecurityContext:function e(s){var u,r,t,q=this._getSCFromPreferences();if(g.is(s,"string")&&s!==q){u=s.split(".")[1];widget.setValue("organization",u);r=s.split(".")[2];widget.setValue("collaborativeSpace",r);t=s.split(".")[0];widget.setValue("role",t);q=s}if(g.is(q,"string")){c.setSecurityContext(q)}},isChanged:function o(){var r=false,q=c.getSecurityContext();if(g.is(q,"string")&&q.indexOf(this._getSCFromPreferences())===-1){r=true}return r}});return f});define("DS/DELWebMfgAssetsDefUIServices/RelationsColumnManager",["UWA/Core","UWA/Class","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/ImplementLinkUtil","DS/DELWebMfgAssetsDefModelServices/ModelPreferences"],function(f,c,k,d,h,b,l,e){var j=c.singleton({name:"RelationsColumnManager",init:function m(o){this._parent(o)},fillNodeOptions:function i(w,o,t){var r=!f.is(t),p=r?k.getReferenceFromCollection(w.referencePID):k.getInstanceFromCollection(t.PID),u=p.get("displayModel").get("connectionModelInfo"),q=[],s,v;if(d.getWidgetTrigram()!=="MFN"){if(f.is(w.absolutePath)&&f.is(w.absolutePath,"array")){if(f.is(u)&&f.is(u,"array")&&u.length>0){q=l.getFilteredConnectionModelInfo(w.absolutePath,u);u=q}}}s=h.getRelationAttributes(u,o);for(v in s){if(!p.get("queriedForConnections")){w.grid[v]=[];w.grid[v].push({Icon:"",Value:b.getNLSValue("RelationsNotLoadedQuestionMark")})}else{if(s.hasOwnProperty(v)){if(f.is(w.grid[v],"array")&&f.is(t)){w.grid[v]=w.grid[v].concat(s[v])}else{w.grid[v]=s[v]}}}}return w},updateAttributes:function g(o,p){var t,s,q,u,r=false;if(f.is(p)&&f.is(o)){t=p.changedAttributes();if(f.is(t)){if(t.hasOwnProperty("displayModel")){s=t.displayModel.changedAttributes()["connectionModelInfo"];if(f.is(s)){r=true}}else{q=p.get("type");if(f.is(h.typeToDisplayAttrMap[q])){u=h.typeToDisplayAttrMap[q]["display_attribute"];u=u.split(".")[0]}else{u="V_Name"}if(t.hasOwnProperty(u)){r=true}}}}if(r){h.updateConnectionsRelationAttributes(o,p)}},forceCellUpdate:function a(o,p){h.updateRelationAttributes(o,p)},formatCellMultiValue:function n(t){var u,q,s,o,v,w,p,r;if(!t.isHeader){s=t.dataIndex;o=t.nodeModel.options.grid;v=o[s];if(Array.isArray(v)&&v.length!==0){if(v[0].Value===b.getNLSValue("RelationsNotLoadedQuestionMark")){u=t.cellView.reuseCellContent("relationsNotLoadedCell");if(f.is(u)){q=v[0].Value;r=u.children[0].getElement(".wux-layouts-treeview-label");if(f.is(r)){r.innerHTML=q}r.addClassName("data-not-loaded");t.cellView.getContent().setContent(u)}}else{u=t.cellView.reuseCellContent("multiValueCell");if(f.is(u)){q=f.is(v[0].Value)?v[0].Value:"";r=u.children[0].getElement(".wux-layouts-treeview-label");if(f.is(r)){r.innerHTML=q;r.removeClassName("data-not-loaded")}p=u.children[0].getElement(".wux-layouts-treeview-icon");if(f.is(p)){p.style.display="inline-block";p.style.backgroundImage="url("+b.getIconURLFromKey(v[0].Icon)+")"}w=u.getElement(".wux-layouts-rowentry-moreindicator");if(f.is(w)){w.style.display=(v.length>1)?"inline-block":"none"}if(q===b.getNLSValue("RelationsNotLoadedQuestionMark")){r.addClassName("data-not-loaded");p.style.display="none"}t.cellView.getContent().setContent(u)}}}}}});return j});define("DS/DELWebMfgAssetsDefUIServices/TweakerCustomBoolean",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Utils","DS/DELWebMfgAssetsDefUIServices/ToggleCustom"],function(c,j,f,i){var l=j.inherit({name:"TweakerCustomBoolean",publishedProperties:{value:{defaultValue:false,type:"boolean",advancedSetter:true},valueType:{defaultValue:"boolean",type:"string"},displayStyle:{defaultValue:"customCheckbox",type:"string"}},_upgradeValue:function d(o){var n;if(!c.is(o)){n=o}else{if(o==="1"||o===1||o==="true"||o===true){n=true}else{if(o==="0"||o===0||o==="false"||o===false){n=false}else{n=Boolean(o)}}}return n}});var a,h;a=function(o,n){j.prototype.baseViewModule.call(this,o,n)};f.applyMixin(a,j.prototype.baseViewModule);h=function(o,n){a.call(this,o,n)};f.applyMixin(h,a);h.prototype.buildView=function k(){var n;if(!this._tweaker.elements.container){return}n=this._options.viewOptions||{};n.type=this._options.viewOptions.displayStyle;n.touchMode=this._tweaker._getCurrentTouchMode();n.fireOnlyFromUIInteractionFlag=true;this._view=new i(n);this.setValue(this._tweaker.value)};h.prototype.computeTweakerContentLength=function e(){return this._tweaker._getCurrentTouchMode()?19:14};h.prototype.handleEvents=function g(){var n=this._view;var o=this;n.addEventListener("change",function(p){p.stopPropagation();o.setTweakerValue(n.checkFlag)})};h.prototype.setValue=function b(o,n){if(!this._view){return}if(typeof this._tweaker.value==="undefined"||this._tweaker.value===null){this._view.checkFlag=false}else{this._view.checkFlag=this._tweaker.value}};h.prototype.setTouchMode=function m(o,n){if(!this._view){return}this._view.touchMode=o};l.prototype.baseViewModule=a;l.prototype.VIEW_MODULES={customCheckbox:{classObject:h,options:{viewOptions:{displayStyle:"checkbox"}}}};return l});define("DS/DELWebMfgAssetsDefUIServices/TableViewPreferences",["UWA/Core","UWA/Class","DS/DELWebMfgAssetsDefUIServices/UIPreferences"],function(h,b,c){var n=b.singleton({_TVColumnsPrefValue:null,_consumedItemsPrefValue:null,_capableResourcesPrefValue:null,_widgetLayoutPrefValue:null,_syncWithXML:function m(q,r){var p=0,o={};for(p in q){if(q.hasOwnProperty(p)){switch(p){case"Columns":o[p]=q[p];r=(h.is(r)&&(r.length>0))?h.Json.decode(r):{};o[p].Column=this._syncColumns(r,q[p]["Column"]);break;default:o[p]=q[p];break}}}return o},_syncColumns:function j(u,v){var p=0,t={},s=[],o={},r="",q;if((h.is(u)===false)||(Object.keys(u).length<=0)){s=v;for(p=0;p<v.length;p++){s[p]["display"]=true}}else{for(p=0;p<v.length;p++){o[v[p]["dataIndex"]]=v[p]}for(p=0;p<u.length;p++){r=u[p]["dataIndex"];if(h.is(o[r])){t=u[p];for(q in o[r]){if(o[r].hasOwnProperty(q)&&!h.is(t[q])){t[q]=o[r][q]}}s[s.length]=t;delete o[r]}}for(r in o){if(o.hasOwnProperty(r)){t=o[r];t.display=true;s[s.length]=t}}}return s},setViewPreference:function d(o,q){var p,s=[],t,r;if(o==="Widget Layout"){widget.setValue("widgetLayoutValues",h.Json.encode(q));this._widgetLayoutPrefValue=q;return}for(p=0;p<q.length;++p){r=q[p];t={};t.dataIndex=r.dataIndex;t.display=r.display;t.width=r.width;t.minWidth=r.minWidth||"100";s[s.length]=t}if(o===c.TableView.Name){widget.setValue("systemsViewColumns",h.Json.encode(s));this._TVColumnsPrefValue.Columns.Column=q}else{if(o===c.LeftBloc.Name){widget.setValue("consumedItemsColumns",h.Json.encode(s));this._consumedItemsPrefValue.Columns.Column=q}else{if(o===c.RightBloc.Name){widget.setValue("capableResourcesColumns",h.Json.encode(s));this._capableResourcesPrefValue.Columns.Column=q}}}},getTableViewPreference:function f(){var p,o=JSON.parse(JSON.stringify(c.TableView));if(!h.is(this._TVColumnsPrefValue)){p=widget.getValue("systemsViewColumns");this._TVColumnsPrefValue=this._syncWithXML(o,p);this.setViewPreference(o.Name,this._TVColumnsPrefValue.Columns.Column)}return this._TVColumnsPrefValue},getGenericViewPreference:function l(q){var o,r,p=JSON.parse(JSON.stringify(q));if(p.Name===c.LeftBloc.Name){if(!h.is(this._consumedItemsPrefValue)){r=widget.getValue("consumedItemsColumns");this._consumedItemsPrefValue=this._syncWithXML(p,r);this.setViewPreference(p.Name,this._consumedItemsPrefValue.Columns.Column)}o=this._consumedItemsPrefValue}else{if(!h.is(this._capableResourcesPrefValue)){r=widget.getValue("capableResourcesColumns");this._capableResourcesPrefValue=this._syncWithXML(p,r);this.setViewPreference(p.Name,this._capableResourcesPrefValue.Columns.Column)}o=this._capableResourcesPrefValue}return o},getTableViewColumns:function k(){return this._TVColumnsPrefValue.Columns.Column},getTableViewLabelColumn:function g(){return this._TVColumnsPrefValue.Label},getLeftViewColumns:function a(){return this._consumedItemsPrefValue.Columns.Column},getRightViewColumns:function e(){return this._capableResourcesPrefValue.Columns.Column},getWidgetLayoutValues:function i(){var o=widget.getValue("widgetLayoutValues");if(o){o=h.Json.decode(o)}return o},});return n});define("DS/DELWebMfgAssetsDefUIServices/AttributeUtil",["UWA/Core","DS/UIKIT/Modal","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIPreferences"],function(c,f,a,L,U,M,E,B){var t={REGEX_OTHER_DATE_FORMAT:/(\d+)\/(\d+)\/(\d+)@\d+:\d+:\d+:\w+/,_formatDateObj:function e(X){var W,Y,ad,af,ac,ab,ag,ae,aa,Z,V;if(!X){return null}W=X.split("@");Y=X;if(W.length>1){ad=W[0].split("/");af=ad[0];ac=ad[1];ab=ac-1;ag=ad[2];ae=W[1].split(":");aa=ae[0];Z=ae[1];V=ae[2];Y=new Date();Y.setUTCHours(aa);Y.setUTCMinutes(Z);Y.setUTCSeconds(V);Y.setUTCFullYear(af);Y.setUTCDate(1);Y.setUTCMonth(ab);Y.setUTCDate(ag)}return Y},_convertDateTime:function i(X){var V="",W,Y;if(X==="NULL"){V=""}else{if(t.REGEX_OTHER_DATE_FORMAT.test(X)){W=t._formatDateObj(X);X=W.toUTCString()}Y=c.is(X,"number")?X:Date.parse(X);if(!isNaN(Y)){V=new Date(Y)}}return V},getNodeAndColumnInfos:function K(ab,Z){var X,aa,V,Y,W={};if(Z.dataIndex==="tree"){W.dataIndex=Z.label;W.instOrRef=Z.labelIsOnRef?"reference":"instance"}else{if((Z.dataIndex.split(".")).length===3){W.dataIndex=Z.dataIndex.split(".")[0]+"."+Z.dataIndex.split(".")[1];W.instOrRef=Z.dataIndex.split(".")[2]}else{W.dataIndex=Z.dataIndex.split(".")[0];W.instOrRef=Z.dataIndex.split(".")[1]}}V=("reference"===W.instOrRef)?ab.getReferencePID():ab.getInstancePID();W.dicoType=Z.dicoType;X=B.getAttributeNameFromColumn(W);W.attributeName=X;aa=(W.instOrRef==="instance")?E.getNLSValue("TableView.InstancePrefix"):"";W.attributeNLSTitle=aa+E.getNLSValue(X);if(W.instOrRef==="instance"){W.objectToBeModified=U.instances.get(V)}else{W.objectToBeModified=U.references.get(V)}W.attributeInfo=E.getAttributeInfo(X);if(!c.is(W.attributeInfo)){if(c.is(W.objectToBeModified)){Y=W.objectToBeModified.get("type");if(c.is(Y,"string")){X=W.objectToBeModified.get("type")+"."+W.dataIndex}else{X=W.dataIndex}}else{X=W.dataIndex}W.attributeInfo=E.getAttributeInfo(X);if(!c.is(W.attributeInfo)){W.attributeInfo={}}}if(c.is(W.objectToBeModified)){W.attributeDef=E.getTypeMaskInfo(W.objectToBeModified.get("PPRTYPE"))}else{W.attributeDef={}}return W},getObjectAndAttributeInfos:function N(W){var Y=[],X;var V=function V(Z){var aa={attributeName:Z.name,dataIndex:Z.name.split(".")[1],attributeNLSTitle:E.getNLSValue(Z.name),attributeInfo:E.getAttributeInfo(Z.name),readOnly:c.is(Z.readOnly,"boolean")&&Z.readOnly};Y.push(aa)};if(c.typeOf(W)!=="array"){V(W)}else{for(X=0;X<W.length;X++){V(W[X])}}return Y},isBoolean:function H(V){return t.getType(V)==="Boolean"},isDouble:function G(V){return t.getType(V)==="Double"},isInteger:function q(V){return t.getType(V)==="Integer"},isDate:function A(V){return t.getType(V)==="Date"},getFormattedDate:function P(V,X,Y){var Z=V,aa=widget.lang,W=t._convertDateTime(V);if(!isNaN(W)&&W!==""){if(true===X){Z=W.toLocaleString(aa,Y)}else{Z=W.toLocaleDateString(aa,Y)}}else{Z=""}return Z},getDate:function u(V){return t._convertDateTime(V)},isReadOnly:function s(Y,V,X){var W=false;if(c.is(Y)){W=c.is(Y.Protection)&&Y.Protection!==1&&Y.Protection!==2;if(!X){W|=Y.isReadOnly===true}}if(c.is(V)){W|=(V.readOnly===true)||(V.visible===false)}return W},isVisible:function d(V){var W=true;if(c.is(V)){W=V.visible}return W},isMultiValuated:function j(V){return c.is(V.MultiValuated)&&V.MultiValuated==="Yes"},isMultiDate:function O(V){return t.isDate(V)&&t.isMultiValuated(V)},isMultiLine:function h(V){return c.is(V.MultiLine)&&V.MultiLine==="Yes"},hasRangeDefined:function Q(X,V){var W=false;W=c.is(X)&&c.is(X.HasRangeDefined)&&X.HasRangeDefined==="Yes";if(c.is(V)&&Array.isArray(V.authorizedValues)){W=W||(V.authorizedValues.length>0)}return W},hasMagnitude:function r(V){return c.is(V.Magnitude)&&V.Magnitude!==""},getMagnitudeValue:function k(V,W){if(t.hasMagnitude(W)){if(c.is(V,"array")){V=t.getValueAsString(V,t.getType(W))}else{V=V==="NULL"?"":V}}return V},getNLSForUnit:function n(W){var V="";if(c.is(W)&&t.hasMagnitude(W)){if(c.is(W.ManipulationUnit,"string")){if(0!==W.ManipulationUnit.length){V=E.getNLSForUnit(W.Magnitude,W.ManipulationUnit)}else{V=E.getNLSForUnit(W.Magnitude)}}}return V},getAuthorizedValue:function x(X,W){var V;for(V=0;V<X.AuthorizedValues.length;V++){if(t.getAuthorizedValueNLS(X,V)===W){if(t.isInteger(X)){return V+1}return X.AuthorizedValues[V].Name}}},getAuthorizedValueIndex:function p(Y,V,X){var W;if(c.is(V)&&Array.isArray(V.authorizedValues)&&(V.authorizedValues.length>0)){for(W=0;W<V.authorizedValues.length;W++){if(V.authorizedValues[W].NLS===X){return W+1}}return 1}for(W=0;W<Y.AuthorizedValues.length;W++){if(t.getAuthorizedValueNLS(Y,W)===X){return W+1}}},getAuthorizedValueNLS:function T(W,V){return W.AuthorizedValues[V].NLS},getAuthorizedValuesNLSList:function J(Y,V){var W,X=[];if(c.is(V)&&Array.isArray(V.authorizedValues)&&(V.authorizedValues.length>0)){for(W=0;W<V.authorizedValues.length;W++){X.push(V.authorizedValues[W].NLS)}return X}for(W=0;W<Y.AuthorizedValues.length;W++){X.push(t.getAuthorizedValueNLS(Y,W))}return X},getDefaultValue:function b(V){return c.is(V.DefaultValue)?V.DefaultValue:""},getMagnitude:function I(V){return t.hasMagnitude(V)?V.Magnitude:""},getFullName:function z(V){return V.FullName},getMaxLength:function m(V){return c.is(V.MaxLength)?V.MaxLength:0},getPattern:function F(W){var V;if(t.isInteger(W)){return"^[-+]?([1-9][0-9]*)|(0)$"}if(t.isDouble(W)){return"^([+-]?([1-9][0-9]*)|(0))([.,][0-9]+)?"}V=t.getMaxLength(W);if(V<=0){return null}return"^.{0,"+V+"}$"},getNLS:function w(V){var W="";if(c.is(V)){W=c.is(V.NLS)?V.NLS:""}return W},getType:function y(W){var V="";if(c.is(W)){V=c.is(W.Type)?W.Type:""}return V},doesAttributeExist:function o(W,V){if(!c.is(W)){return false}return W._attributes.hasOwnProperty(V)},getValueAsArray:function l(V){if(c.typeOf(V)!=="array"){if(c.is(V)&&V.length>0&&V!=="NULL"&&V!=="null"){V=V.split(B.getSeparator())}else{V=[]}}return V},getValueAsDateArray:function v(Y){var X,W,V=[];if(c.typeOf(Y)==="array"){for(X=0;X<Y.length;X++){W=t.getDate(Y[X]);if(c.is(W)){V.push(W)}}}else{if(c.is(Y)&&Y.length>0&&Y!=="NULL"&&Y!=="null"){Y=Y.split(B.getSeparator());for(X=0;X<Y.length;X++){W=t.getDate(Y[X]);if(c.is(W)){V.push(W)}}}}return V},getValueAsString:function C(ac,ab){var Z,X=c.is(ab)&&ab==="Double",ad=c.is(ab)&&ab==="Integer",aa=B.getSeparator(),Y=widget.lang,W=(ad)?1:2,ae,V="";ac=t.getValueAsArray(ac);for(Z=0;Z<ac.length;Z++){if(Z>0){V+=aa}if(ad||X){ae=(ad)?parseInt(ac[Z]):parseFloat(ac[Z]);if(!isNaN(ae)){ae=ae.toLocaleString(Y,{minimumSignificantDigits:W,maximumSignificantDigits:21});V+=ae}}else{V+=ac[Z]}}return V},createField:function S(Z,X,Y){var V,W;if(t.isMultiValuated(Y)){Z.type="text";if(t.isDate(Y)){W=t.getValueAsDateArray(X);X=W.map(function(aa){return t.getFormattedDate(aa)})}Z.value=t.getValueAsString(X,t.getType(Y))}else{if(t.isBoolean(Y)){Z.type="checkbox";Z.value=(X==="TRUE")}else{if(t.isDate(Y)){Z.type="date";Z.value=(!c.is(X)||X==="NULL"||X==="")?null:t.getDate(X);if(Z.displayType==="datetime"){Z.timePickerFlag=true}}else{if(t.hasRangeDefined(Y)){Z.type="select";Z.value=X;Z.options=[];for(V=0;V<Y.AuthorizedValues.length;V++){Z.options.push({label:t.getAuthorizedValueNLS(Y,V),value:t.getAuthorizedValueNLS(Y,V)})}}else{if(t.isMultiLine(Y)){Z.type="textarea";Z.value=X==="NULL"?"":X;Z.pattern=t.getPattern(Y);Z.rows="6"}else{Z.type="text";if(t.isDouble(Y)||t.isInteger(Y)){Z.value=t.getValueAsString(X,t.getType(Y))}else{Z.value=X==="NULL"?"":X}Z.pattern=t.getPattern(Y)}}}}}return Z},getFieldValue:function R(W,Y){var V,X=W;if(t.isMultiDate(Y)){X=t.getValueAsArray(W);X=X.map(function(aa){var Z=new Date(aa);if(!isNaN(Z.getTime())){aa=Math.floor(Z.getTime()/1000)}return aa})}else{if(t.isMultiValuated(Y)){X=t.getValueAsArray(W)}else{if(t.isBoolean(Y)){X=W==="true"?"TRUE":"FALSE"}else{if(t.isDate(Y)){W=W==="NULL"||!c.is(W)?"":W;V=new Date(W);if(!isNaN(V.getTime())){X=Math.floor(V.getTime()/1000)}}else{if(t.hasRangeDefined(Y)&&t.isInteger(Y)){X=t.getAuthorizedValueIndex(Y,null,W)}}}}}return X},saveValue:function D(ao,ab,af,aq,ae,ar,ak,ag,ad,X){var V,Y,ap,an,ah,al=[],ac,am=[],aa=t.hasRangeDefined(ad,X)&&t.isInteger(ad),aj,ai=ab.get(aq),W,Z=function Z(aw){var au=aw,av=function av(ax){return c.is(ax,"string")?t.getFormattedDate(ax):t.getFormattedDate(t.getDate(ax*1000))};if(t.isDate(ad)){if(Array.isArray(aw)){au=aw.map(function at(ax){return av(ax)})}else{au=av(aw)}}return au};W=function W(at,au){if(c.is(au)&&c.is(au.message,"string")){at=at+"<br>"+au.message}if(c.is(t._logger)){t._logger.warn("Failed to save value. Save Error: "+c.Json.encode(au))}ao.add({className:"error",message:at})};if(!c.is(ai)||ai==="NULL"){ai=""}if(aa){ai=t.getAuthorizedValueIndex(ad,X,ai);ai=ai.toString();ae=ae.toString()}if(!c.is(af)){al=[ab];ac=ab}else{if(ag==="instance"){for(an=0;an<af.length;an++){ah=af[an].getInstancePID();if(c.is(ah)){al.push(U.instances.get(ah))}}}else{for(an=0;an<af.length;an++){ah=af[an].getReferencePID();al.push(U.references.get(ah))}}}for(an=0;an<al.length;an++){aj=al[an].get(aq);if(aa){aj=t.getAuthorizedValueIndex(ad,X,aj)}if(t.isDate(ad)){aj=new Date(aj).getTime()/1000}if(aj!==ae){if(!t.doesAttributeExist(al[an],aq)){ao.add({className:"warning",message:E.getNLSValue("TableView.AvailabilityFailure",{key:ar})})}else{am.push(al[an].id)}}}ap=function ap(at,aw,au,ay,aB,ax){var aD=c.createElement("div"),aC,av=Z(aB),aE=E.getNLSValue("UpdateAttributeUI.Text",{prevValue:av}),aF=E.getNLSValue("UpdateAttributeUI.Header",{attributeName:ax}),az=function az(){Y(at,aw,au,ay,aB,ax);aC.destroy();aC=null},aA=function aA(){aC.destroy();aC=null};new L({value:"Yes",className:"btn btn-primary",events:{onClick:az}}).inject(aD);new L({value:"No",className:"btn btn-default",events:{onClick:aA}}).inject(aD);aC=new f({className:"MGA-DELWebMfgAssetsDefUIServices-UpdateAttributeUI-Dialog editViews-modal",header:aF,body:aE,closable:false,footer:aD});aC.inject(widget.body);aC.show()};if(am.length===0){return}if(am.length>1){V=function V(ay,av,at,az,ax,aC,aw){var aA={keyValues:{},pids:ay},au,aB;aA.keyValues[at]=ax;au=function au(aD){var aE;aD.forEach(function(aF){aF=aF.attributesValue;if(az==="instance"){aE=U.instances.get(aF.PID)}else{aE=U.references.get(aF.PID)}if(aE._attributes.hasOwnProperty(av)){aE.set(av,aF[av])}});if(aD.length!==ay.length){ao.add({className:"warning",message:E.getNLSValue("TableView.UpdateWarning",{key:aw})})}else{if(c.is(aE)){ax=Z(aE.get(av))}ao.add({className:"success",message:E.getNLSValue("TableView.MassUpdateSuccess",{key:aw,value:ax})})}};aB=function aB(aG,aF){var aD=Z(ax),aE=E.getNLSValue("TableView.MassUpdateFailure",{key:aw,value:aD});if(c.is(aG)&&c.is(aG.set,"function")){aG.set(av,aC)}W.call(null,aE,aF)};M.webServiceRequest({url:"modeler/pprirpc/"+az,method:"PUT",data:c.Json.encode(aA),onComplete:au,onFailure:aB,logMessage:E.getNLSValue("TableView.MassUpdateLogMessage")})};V(am,aq,ak,ag,ae,ai,ar)}else{Y=function Y(at,ax,au,az,aB,ay){var aA={previous:{}};aA[au]=az;aA.previous[au]=aB;at.save(null,{proxy:"passport",wait:true,headers:M.getHeaders(),data:c.Json.encode(aA),onFailure:function av(aF,aE){var aC=Z(az),aD=E.getNLSValue("TableView.SingleUpdateFailure",{key:ay,value:aC});aF.set(ax,aB);W.call(null,aD,aE)},onComplete:function aw(aE){var aC,aD=aE.get(ax);if(c.is(aE._changed.modified)){aC=Z(aD);ao.add({className:"success",message:E.getNLSValue("TableView.SingleUpdateSuccess",{key:ay,value:aC})})}else{ao.add({className:"warning",message:E.getNLSValue("TableView.UpdateWarning",{key:ay})});ap(at,ax,au,az,aD,ay)}},logMessage:E.getNLSValue("TableView.SingleUpdateLogMessage")})};if(!c.is(ac)){if(ag==="instance"){ac=U.instances.get(am[0])}else{ac=U.references.get(am[0])}}Y(ac,aq,ak,ae,ai,ar)}},saveValues:function g(Z,ab,W){var Y,X,aa=[],V;for(X=0;X<W.length;X++){V=ab.get(W[X].dataIndex);if(t.hasRangeDefined(W[X].attributeInfo,W[X].attributeDef)&&t.isInteger(W[X].attributeInfo)){V=t.getAuthorizedValueIndex(W[X].attributeInfo,W[X].attributeDef,V)}if(t.isDate(W[X].attributeInfo)){V=new Date(V).getTime()/1000}if(V!==W[X].newValue){if(!t.doesAttributeExist(ab,W[X].dataIndex)){Z.add({className:"warning",message:E.getNLSValue("TableView.AvailabilityFailure",{key:W[X].attributeNLSTitle})})}else{W[X].previousValue=V;aa.push(W[X])}}}if(aa.length===0){return}Y=function Y(af,ag){var ac={};for(X=0;X<ag.length;X++){ac[ag[X].attributeName]=ag[X].newValue}af.save(null,{proxy:"passport",wait:true,headers:M.getHeaders(),data:c.Json.encode(ac),onFailure:function ad(ah){for(X=0;X<ag.length;X++){ah.set(ag[X].dataIndex,ag[X].previousValue)}Z.add({className:"error",message:E.getNLSValue("AttributeUtil.SaveFailed")})},onComplete:function ae(){Z.add({className:"success",message:E.getNLSValue("AttributeUtil.SaveSucceeded")})}})};Y(ab,aa)}};if(c.is(a)){t._logger=a.getLogger(t)}return t});define("DS/DELWebMfgAssetsDefUIServices/FilterComponentProxy",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/Core/Events","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX/FilterBIComponentProxy","UWA/Promise","DS/DELWebMfgAssetsDefUIServices/FilterComponentServices","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/BIUtils"],function(i,u,C,p,m,x,h,c,j,g,e){var B=u.extend({init:function(D){this.activeView="";this.view=D.view;if("MBOM"===this.view){this.customPredicate="ds6w:what/Update Status"}else{if("BODY"===this.view){this.customPredicate="ds6w:what/Assignment Status"}}this.nodeUpdates=[];this._allRoots=[];this._allAbsolutePaths={};this._ds6wTagsTriple={};this._treeDocument=D.treeDocument;this._logger=C.getLogger(B);if(!this.tagNavigatorProxy){this.tagNavigatorProxy=m.createProxy({widgetId:widget.id,tenant:"OnPremise",colorize:true,filteringMode:"FilteringOnServer"});this.tagNavigatorProxy.addEvent("colorize",this.onColorize.bind(this));this.tagNavigatorProxy.addEvent("unColorize",this.onUnColorize.bind(this));this.tagNavigatorProxy.addEvent("onFilterChange",this.onFilterChange.bind(this));this.tagNavigatorProxy.deactivate();this.filterServices=new c({treeDocument:this._treeDocument});this.setCustomColorMap()}if(!this._biFilterProxy){this._biFilterProxy=new x({tenant:"OnPremise",processingMode:"appProcessing",colorize:"true",widgetId:widget.id,appId:widget.data.appId});if(i.is(this._biFilterProxy.setNGFilterOptions,"function")){this._biFilterProxy.setNGFilterOptions({expandServices:"expand",appID:widget.data.appId});this._biFilterProxy.addEvent("ApplyNGFilter",this.onApplyFilter,this)}}return this},onApplyFilter:function r(M){var E=M||null,K=this,G={},I=[],F=false,O=true,L,H=function H(S){var R=i.is(S.cvquery)?S.cvquery:null,Q=i.is(S.cvquery3d)?S.cvquery3d:null,P=i.is(S.results)?S.results:null;p.publish({event:"FilterComponentProxy/ApplyFilter",data:{cvquery:R,cvquery3d:Q,rootIds:I,numFilteredInNodes:i.is(P,"array")?P.length:-1}})},J=function J(){i.is(this._logger)?this._logger.warn("Expand failed after filter was applied"):{}},D=function D(P){p.publish({event:"FilterComponentProxy/RemoveFilter",data:{cvquery:i.is(P.cvquery)?P.cvquery:null,cvquery3d:i.is(P.cvquery3d)?P.cvquery3d:null,rootIds:I}})};if(K.view===K.activeView){E=i.is(E,"string")?JSON.parse(E):E;G=i.is(E)?E.CVQuery:{};I=i.is(E.filterRootIds)?E.filterRootIds:{};F=i.is(E.empty)?E.empty:false;if(F){if(0<I.length&&i.is(G)){O=I.every(function N(P){return(P!=="")});if(O){I.forEach(function(P){K.removeFilterFromCollection(P,G)});D({cvquery:G})}}}else{if(i.is(G)&&i.is(I)){L={ordered:false,context:this,doNotExpand:true,expandLevel:-1,cvquery:G,cvquery3d:i.is(E.CVQuery3D)?E.CVQuery3D:null,onFailure:J,onTimeout:J,onCancel:J};j.getDescendantsFromServer(I,H,L)}}}},removeFilterFromCollection:function n(D,E){j.traverseInstanceModels(D,function F(H){var G=H.getDisplayModelAttr("cvquery");if(i.is(G)){H.setDisplayModel({cvquery:null},{silent:true})}})},resetFilterUI:function f(){this._biFilterProxy.resetNGFilterUI({widgetId:widget.id})},_FillTreeNodeChildrenWithFilterRecursive:function k(L,E,O){var R=this,N,I,J,K,H,P=true,F,Q,G,D;O=O||{};F=i.is(O.onEndLoading,"function")?O.onEndLoading:null;if(i.is(F)){delete O.onEndLoading}Q=function Q(){var S=i.is(O.silentMode)?{silent:true}:{};if(!i.is(N)){return}if(i.is(R._treeList.options.nodesCounter)){J.incrementDisplayModelCounter(R._treeList.options.nodesCounter,S)}R.fillReferenceTreeNode(N,O);if(i.is(F)){R._treeDocument.prepareUpdate();F(J,N);R._treeDocument.pushUpdate()}};if(!i.is(E)){J=j.references.get(L);if(i.is(J)){I=this._createReferenceNodeOptions(J.toJSON());N=new this._TreeNodeModel(I);this._treeDocument.addRoot(N)}}else{K=j.instances.get(L);if(i.is(K)){H=E.getChildren();P=true;if(i.is(H,"array")){H.forEach(function M(S){if(i.is(S)){if(S.options.instancePID===L){if(S.options.referencePID!==K.get("isInstanceOf")){G=R.search(K.id,null,true,false);if(i.is(G,"array")&&(G.length>0)){D=G[0]._getLocalID();E.removeChild(G[0])}}else{P=false;if(i.is(O)&&i.is(O.updateLoadedChild)){J=j.getReferenceModelFromInstance(K);I=R._createReferenceNodeOptions(J.toJSON());I=R._addInstanceNodeOptions(I,K.toJSON());S.updateOptions(I);S.updateBI();N=S}}}}})}if(P){J=j.getReferenceModelFromInstance(K);I=this._createReferenceNodeOptions(J.toJSON());I=this._addInstanceNodeOptions(I,K.toJSON());if(j.needToQueryForChildren(J.id)){I.children=[]}N=new this._TreeNodeModel(I);E.addChild(N,D)}}else{J=j.references.get(L)}}if(i.is(this._filterProxy)&&i.is(N)){this._filterProxy.nodeUpdate({PID:N.getID(),Path:N.isRoot()?N.getReferencePID():N.getAbsolutePath().toString(),event:"add"})}if(i.is(K)){Q()}else{if(j.needToQueryForChildren(J.id)){j.getDescendantsFromServer(J.id,Q,O)}else{if(i.is(O.withLinksResolved)&&O.withLinksResolved){j.findMissingLinkedObjects(J,Q,O)}else{Q()}}}},onColorize:function w(F){var E=this,D=E._treeDocument.getTreeListView();if(E.view!==E.activeView){return}if(D.getManager().isColumnHidden("taggerColor")===true){D.getManager().showColumn("taggerColor")}E._treeDocument.withTransactionUpdate(function(){F.tagColors.forEach(function(H){var G=E.filterServices.findColoredPaths(E._ds6wTagsTriple,H);G.forEach(function(J){var I=E._allAbsolutePaths[J];E._treeDocument.getNodeModel(I).forEach(function(L){var K=L.isRoot()?L.getReferencePID():L.getAbsolutePath().toString();if(K===J){L.updateOptions({taggerColor:H.color})}})})})})},onUnColorize:function t(){var E=this,D=E._treeDocument.getTreeListView();if(E.view!==E.activeView){return}if(D.getManager().isColumnHidden("taggerColor")===false){D.getManager().hideColumn("taggerColor")}},onFilterChange:function o(J){var I=this,H=J.allfilters,F=[],E=[],D=(I._allRoots.length>0)?I._allRoots.slice(0):I._treeDocument.getRoots().slice(0),G;if(I.view!==I.activeView){return}I._treeDocument.withTransactionUpdate(function(){I._allRoots=[];D.forEach(function(K){K.filterIn(true);I._allRoots.push(K)});if(Object.keys(H).length===0){I._allRoots=[];for(G in I._allAbsolutePaths){if(I._allAbsolutePaths.hasOwnProperty(G)){E.push(G)}}I.setTags(E);return}F=I.filterServices.getFilteredSubjects(H,I._ds6wTagsTriple);if(F.length===0){return}I.filterServices.flagFilteredInNodes({subjectpaths:F,allsubjectpaths:I._allAbsolutePaths});I.filterServices.filterOutNodes();I.setTags(F)})},setCustomColorMap:function b(){var G=this,D=G.customPredicate,I,E={},H=[],F;if("MBOM"===G.view){I=e.getAllUpdateStatus()}else{if("BODY"===G.view){I=e.getAllAssignmentStatus()}}for(F in I){if(I.hasOwnProperty(F)){H.push({color:I[F].colorCode,type:"string",object:F})}}E[D]=H;if(i.is(E)){G.tagNavigatorProxy.setColorMap(E)}},setTags:function v(G){var J=this,E=J._treeDocument,I={},F,H,D;G.forEach(function(L){var K=J._allAbsolutePaths[L];H=E.getNodeModel(K);H.forEach(function(N){var O=N.isRoot()?N.getReferencePID():N.getAbsolutePath().toString(),M=J._allAbsolutePaths[L],P;if(O!==L){return}F=j.getReferenceFromCollection(M);if(!i.is(F)){return}P=F.getAdditionalInfo("ds6w");if(P){I[O]=i.clone(P)}N.getParents().forEach(function(S){var R=S.isRoot()?S.getReferencePID():S.getAbsolutePath().toString(),Q=J._allAbsolutePaths[R],T;if(i.is(I)&&I.hasOwnProperty(R)){return}F=j.getReferenceFromCollection(Q);if(!i.is(F)){return}T=F.getAdditionalInfo("ds6w");if(T){I[R]=i.clone(T)}})})});J.updateTripletsForCustomPredicate(I);D=J.filterServices.parse(I);D=D||{ds6wTagSummary:[]};J.tagNavigatorProxy.setTags(null,D.ds6wTagSummary)},nodeUpdate:function d(D){var E=this;if(!D){return}if(Array.isArray(D)){E.nodeUpdates=E.nodeUpdates.concat(D)}else{E.nodeUpdates.push(D)}setTimeout(E.processNodeUpdate.bind(E),500)},processNodeUpdate:function y(){var F=this,D=F.nodeUpdates.splice(0,this.nodeUpdates.length);if(D.length<=0){return}new Promise(function(K,J){var H=[],I,L;D.forEach(function(M){if(("add"===M.event)){F._allAbsolutePaths[M.Path]=M.PID;I=j.getReferenceFromCollection(M.PID);if(!i.is(I)){return}L=I.getAdditionalInfo("ds6w");if(!L){H.push(M.PID)}}else{if("remove"===M.event){delete F._allAbsolutePaths[M.Path]}}});if(Object.keys(F._allAbsolutePaths).length<=0){J()}if(H.length>0){g.fetchOnIndex(H,{select_predicate:["physicalid"],onComplete:function(M){if(M){if(Array.isArray(M)){M.forEach(function(N){I=j.getReferenceFromCollection(N.attributes.PID);if(i.is(I)&&i.is(N.ds6w)){I.setAdditionalInfo({ds6w:N.ds6w})}})}else{I=j.getReferenceFromCollection(M.attributes.PID);if(i.is(I)&&i.is(M.ds6w)){I.setAdditionalInfo({ds6w:M.ds6w})}}}K()}})}else{K()}}).then(function G(){var K={},I,M,H,J,L;for(M in F._allAbsolutePaths){if(F._allAbsolutePaths.hasOwnProperty(M)){H=F._allAbsolutePaths[M];J=j.getReferenceFromCollection(H);if(!i.is(J)){return}L=J.getAdditionalInfo("ds6w");if(L){K[M]=L}}}I=F.filterServices.parse(K);I=I||{ds6wTagSummary:[]};F._ds6wTagsTriple=I.ds6wTagGrouped;F.tagNavigatorProxy.setTags(null,I.ds6wTagSummary)},function E(){F.tagNavigatorProxy.unsetTags()})},setActiveView:function z(D){this.activeView=D},addStatus:function s(E){var H=this,P=H.customPredicate,J,L=E.absolutePath,D=E.status,O=E.dispValue,F=E.bimodel,N,M={},K,I=[],G;if(!H._ds6wTagsTriple[P]){H._ds6wTagsTriple[P]={}}if(true===F._changing){if(!i.is(F._previousAttributes.status)){return}K=F._previousAttributes.status;if(H._ds6wTagsTriple[P]&&H._ds6wTagsTriple[P][K]){I=H._ds6wTagsTriple[H.customPredicate][K].subjects;G=I.indexOf(L);if(-1!==G){if(I.length===1){delete H._ds6wTagsTriple[H.customPredicate][K]}else{H._ds6wTagsTriple[H.customPredicate][K].subjects.splice(G,1)}}}}if(H._ds6wTagsTriple[P]&&H._ds6wTagsTriple[P][D]&&H._ds6wTagsTriple[P][D].subjects.length>0){if(-1!==H._ds6wTagsTriple[P][D].subjects.indexOf(L)){return}}if(!H._ds6wTagsTriple[P][D]){H._ds6wTagsTriple[P][D]={};H._ds6wTagsTriple[P][D]={type:"string",dispValue:O,subjects:[]}}H._ds6wTagsTriple[P][D].subjects.push(L);J=H._allAbsolutePaths[L];N=j.getReferenceFromCollection(J);if(i.is(N)&&i.is(N.getAdditionalInfo,"function")){M=N.getAdditionalInfo("ds6w");M=M||{};if(i.is(M)){M[P]={dispValue:O,type:"string",value:D};N.setAdditionalInfo({ds6w:M})}}},removeStatus:function l(){var G=this,E=G._treeDocument.getAllDescendants(),D=G.customPredicate,H,F,I=[];if(i.is(G._ds6wTagsTriple[D])){delete G._ds6wTagsTriple[D]}I=G.filterServices.getTagsSummary(G._ds6wTagsTriple);if(i.is(I)){G.tagNavigatorProxy.setTags(null,I)}E.forEach(function(J){H=j.getReferenceFromCollection(J.getReferencePID());if(i.is(H)){F=H.getAdditionalInfo("ds6w");if(i.is(F)&&i.is(F[D])){delete F[D];H.setAdditionalInfo({ds6w:F})}}})},displayStatusTag:function a(){var D=this,E=[];E=D.filterServices.getTagsSummary(D._ds6wTagsTriple);if(i.is(E)){D.tagNavigatorProxy.setTags(null,E)}},clear:function q(){var D=this;D.nodeUpdates=[];D._ds6wTagsTriple={};D._allAbsolutePaths={}},updateTripletsForCustomPredicate:function A(H){var I=this,E=I.customPredicate,G,D,F;if(!I._ds6wTagsTriple.hasOwnProperty(E)){return}for(G in H){if(H.hasOwnProperty(G)){for(D in I._ds6wTagsTriple[E]){if(I._ds6wTagsTriple[E].hasOwnProperty(D)){F=I._ds6wTagsTriple[E][D];if(-1!==F.subjects.indexOf(G)){H[G][E].value=D;H[G][E].dispValue=F.dispValue;break}}}}}}});return B});define("DS/DELWebMfgAssetsDefUIServices/TreeListUtils",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil","DS/DELWebMfgAssetsDefUIOccurenceModel/AbstractTreeNodeModel","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefUIServices/RelationsColumnManager","DS/DELWebMfgAssetsDefUIServices/DocumentColumnManager","DS/DELWebMfgAssetsDefUIServices/FilterComponentProxy","DS/DELWebMfgAssetsDefUIServices/UXComponentUtil","DS/DELWebMfgAssetsDefModelServices/BIUtils","DS/Core/Events"],function(f,c,d,P,p,y,aa,E,R,A,u,z,o,e,D,Y){var h=c.extend({init:function U(ab){this._parent(ab);this._treeListToFilter=ab.treeListToFilter;this._treeListManager=ab.treeListToFilter.getManager();this.hiddenTreeNodeModels=[];this.displayedTypes=[]},filterByType:function F(ae){var ac=this,ab=this._treeListToFilter.getRoots(),ad=[];this.displayedTypes=ae;this.hiddenTreeNodeModels.forEach(function(ah,ai){var af=aa.references.get(ah.getReferencePID());var ag=af.get("PPRTYPE");if(ag==="OPERATION"){ag="SYSTEM"}if(ae.indexOf(ag)!==-1){ah.show()}else{ad.push(ai)}});ad.reverse().forEach(function(af){ac.hiddenTreeNodeModels.splice(af,1)});ab.forEach(function(ai){var af=ai.getReferencePID();var ah=aa.references.get(af);var ag=ah.get("PPRTYPE");if(ag==="OPERATION"){ag="SYSTEM"}if(ae.indexOf(ag)===-1){ac.hiddenTreeNodeModels.push(ai);ai.hide()}})},onNodeRemove:function(ac){var ab=-1;this.hiddenTreeNodeModels.every(function(ae,af){var ad=true;if(ae.getReferencePID()===ac){ab=af;ad=false}return ad});if(ab>-1){this.hiddenTreeNodeModels.splice(ab,1)}}});var S=c.extend({name:"TreeListUtils",_logger:null,init:function U(ab){this._parent(ab);if(f.is(d)){this._logger=d.getLogger(S)}this._widgetTrigram=P.getWidgetTrigram();this._TreeNodeModel=y;if(f.is(ab)){if(f.owns(ab,"treeList")){this._treeList=ab.treeList;this.filter=new h({treeListToFilter:ab.treeList});if(f.owns(ab,"treeDocument")){this._treeDocument=ab.treeDocument}else{this._treeDocument=this._treeList.getDocument()}}if(f.owns(ab,"treenodemodel")){this._TreeNodeModel=ab.treenodemodel}this.view=this._treeDocument.getOption("currentView");if("MBOM"===this.view||"BODY"===this.view||"ROUTINGS"===this.view){this._filterProxy=new o({view:this.view,treeDocument:this._treeDocument})}}},updateDocumentColumn:function M(ac){var ae=this.getColumnsDataIndex(),ab=this;if(f.is(ac,"array")){this._treeDocument.prepareUpdate();ac.forEach(function ad(ah){var ag=aa.getReferenceFromCollection(ah),ai=ag.getDisplayModelAttr("documentIDList"),af=z._getDocumentNames(ai,ae);if(f.is(af)&&Object.keys(af).length>0){ab.updateTreeDocument(ag,null,af)}});this._treeDocument.pushUpdate()}},getColumnsDataIndex:function i(){var ad=[],ab=this._treeList.getManager().getNumberOfColumns(),ac,ae;if(f.is(this._treeList._treeDataIndex)){ad.push(this._treeList._treeDataIndex)}for(ac=1;ac<ab;ac++){ae=this._treeList.getManager().getColumnOptions(ac);if(f.is(ae)&&f.owns(ae,"dataIndex")){ad.push(ae.dataIndex)}}return ad},getDateDataIndex:function q(){var ad=[],ab=this._treeList.getManager().getNumberOfColumns(),ac,ae;for(ac=1;ac<ab;ac++){ae=this._treeList.getManager().getColumnOptions(ac);if(f.is(ae)&&f.owns(ae,"dataIndex")&&f.owns(ae,"displayType")&&("Date"===ae.displayType)){ad.push(ae.dataIndex)}}return ad},addToTreeList:function V(ae,af){var aj=this,ag,ac,ai,ab,ad;af=af||{};ab=f.is(af.doNotExpand)?af.doNotExpand:false;af.loadRootOnly=f.is(af.loadRootOnly)?af.loadRootOnly:p.shouldLoadRootOnly();ac=P.printCurrentDateTime("addToTreeList start - ");this._treeDocument.prepareUpdate();ad=function ad(){};af.onEndAddNode=ad;if(ae.isReference()){this._addToTreeListRecursive(ae.id,null,af)}else{if(ae.isInstance()){ag=aa.getAggregatingReferenceModelFromInstance(ae);if(f.is(ag)){ai=this.search(ag.id);ai.forEach(function ah(ak){aj._addToTreeListRecursive(ae.id,ak,af);if(!ab){if(!ak.isExpanded()){ak.expand()}}})}}}this._treeDocument.pushUpdate();P.printDuration(ac,"addToTreeList");return this},fillReferenceTreeNode:function C(ac,ah){var ae,aj=this,ad,af,ag,ai;this._treeDocument.prepareUpdate();ae=aa.getInstancesFromCollection(ac._referencePID);ae=ae.map(function(ak,al){return{position:al,data:ak}});ae=ae.sort(function(an,am){var al=an.data.get("V_TreeOrder"),ao=am.data.get("V_TreeOrder"),ak;if(al&&ao){ak=Number(al)-Number(ao)}else{ak=an.position-am.position}return ak});ae=ae.map(function(ak){return ak.data});ae.forEach(function ab(ak){aj._addToTreeListRecursive(ak.id,ac,ah)});if(f.is(ac)){if(f.is(ac.updateBI,"function")&&(aj._widgetTrigram==="MFN")){ac.updateBI()}}if(true===D.isBIComputed()){ai=function ai(al,ak){if("MBOM"===aj.view){af=D.biModelCollection.findWhere({id:al.getInstancePID()});if(!f.is(af)){af=D.biModelCollection.findWhere({id:al.getReferencePID()})}}else{if("BODY"===aj.view){ag=ak?al.getReferencePID():al.getAbsolutePath().toString();if(0!==ag.length){af=D.biModelCollection.findWhere({id:ag})}}}if(f.is(af)){Y.publish({event:"DELWebMfgItemDefUI/OnBICmdSetStatus",data:af})}};ad=ac.getChildren();if(ac.isRoot()){ai(ac,true)}if(f.is(ad,"array")&&0<ad.length){ad.forEach(function(ak){ai(ak,false)})}}this._treeDocument.pushUpdate()},_addToTreeListRecursive:function j(ah,ab,ae){var an=this,ao,au,ad,aj,aw,ap=true,ag,ac,ar,av,al,at,af,ax,ai,am;ae=ae||{};av=f.is(ae.cvquery)?ae.cvquery:null;at=f.is(ae.supportPartiallyExpandedState,"boolean")?ae.supportPartiallyExpandedState:false;ag=f.is(ae.onEndLoading,"function")?ae.onEndLoading:null;if(f.is(ag)){delete ae.onEndLoading}ai=f.is(ae.onEndAddNode,"function")?ae.onEndAddNode:null;if(f.is(ai)){delete ae.onEndAddNode}if(f.is(an.view)&&!f.is(ae.configIds)){if(an.view==="BODY"||an.view==="MBOM"||an.view==="ROUTINGS"){ae.configIds={pids:[],relids:[]}}}ac=function ac(){var ay=f.is(ae.silentMode)?{silent:true}:{};if(!f.is(ao)){return}if(f.is(an._treeList.options.nodesCounter)){ad.incrementDisplayModelCounter(an._treeList.options.nodesCounter,ay)}an.fillReferenceTreeNode(ao,ae);if(f.is(an.view)&&(an.view==="MBOM"||an.view==="BODY"||an.view==="ROUTINGS")&&f.is(ai)&&f.is(ae.configIds)){if(p.isEffectivityColumn()){an._updateRootMfgCfgColAttributes(ae.configIds.pids);an._updateCfgColAttributes(ae.configIds)}ae.configIds={pids:[],relids:[]}}if(f.is(ag)){an._treeDocument.prepareUpdate();ag(ad,ao);an._treeDocument.pushUpdate()}};if(!f.is(ab)){ad=aa.references.get(ah);if(f.is(ad)){if(f.is(ae.configIds)&&f.is(ae.configIds.pids,"array")&&!(ae.configIds.pids.indexOf(ah)!==-1)){ae.configIds.pids.push(ah)}au=this._createReferenceNodeOptions(ad.toJSON());if(f.is(ae.loadRootOnly)&&ae.loadRootOnly){ae.expandLevel=0}if(aa.needToQueryForChildren(ad)){au.children=[]}ao=new this._TreeNodeModel(au);this._treeDocument.addRoot(ao)}}else{aj=aa.instances.get(ah);if(f.is(aj)){if(f.is(ae.configIds)&&f.is(ae.configIds.relids,"array")&&!(ae.configIds.relids.indexOf(ah)!==-1)){ae.configIds.relids.push(ah)}aw=ab.getChildren();ap=true;if(f.is(av)){ap=false;al=aj.getDisplayModelAttr("cvquery");if(f.is(al)){ap=(av===al)}}if(Array.isArray(aw)){aw.forEach(function aq(ay){var az;if(f.is(ay)){if(ay.getInstancePID()===ah){az=ay.getReferencePID();if(az!==aj.get("isInstanceOf")){ar=an.search(aj.id,null,true,false);if(Array.isArray(ar)&&(ar.length>0)){af=ar[0]._getLocalID();ab.removeChild(ar[0])}}else{ap=false;if(ay.getState()==="partiallyExpanded"){if(!aa.needToQueryForChildren(az)){an.fillReferenceTreeNode(ay);ay.unsetNodePartiallyExpandedState()}}if(f.is(ae)&&f.is(ae.updateLoadedChild)){ad=aa.getReferenceModelFromInstance(aj);au=an._createReferenceNodeOptions(ad.toJSON());au.absolutePath=ay.getAbsolutePath();au=an._addInstanceNodeOptions(au,aj.toJSON());ay.updateOptions(au);ay.updateBI();ao=ay}}}}})}if(ap){ad=aa.getReferenceModelFromInstance(aj);au=this._createReferenceNodeOptions(ad.toJSON());ax=ab.getAbsolutePath();ax.push(aj.id);au.absolutePath=ax;au=this._addInstanceNodeOptions(au,aj.toJSON());am=aa.needToQueryForChildren(ad);if(am){au.children=[]}ao=new this._TreeNodeModel(au);ab.addChild(ao,af);if(at===true){if(am){if(ab.getState()==="expanded"){if(aa.needToQueryForChildren(ab.getReferencePID())){ab.setNodePartiallyExpandedState()}}ao.setNodePartiallyExpandedState()}}}}else{ad=aa.references.get(ah)}}if((this._widgetTrigram==="MFN")&&f.is(this._filterProxy)&&f.is(ao)){this._filterProxy.nodeUpdate({PID:ao.getID(),Path:ao.isRoot()?ao.getReferencePID():ao.getAbsolutePath().toString(),event:"add"})}if(f.is(aj)){ac()}else{if(aa.needToQueryForChildren(ad)){ae=f.merge(ae,{timeOutExtensionPromise:function ak(){return new Promise(function ay(aA,az){e.buildExtendTimeoutDialog(aA,az,[ad],{message:R.getNLSValue("TimeoutExtension.FetchItem.Title")})})}});aa.getDescendantsFromServer(ad.id,ac,ae)}else{if(f.is(ae.withLinksResolved)&&ae.withLinksResolved&&aa.needToQueryForConnections(ad)&&!P.isNavigateOn()==="indexOndemand"){aa.findMissingLinkedObjects(ad,ac,ae)}else{ac()}}}},_fillRequiredAttrForGraphView:function I(ad,ac){var ab;if(f.is(this._graphView)&&f.is(this._graphView.contentPref)){if(f.is(this._graphView.contentPref.Color)&&ad.indexOf(this._graphView.contentPref.Color.dataIndex)<0){ad.push(this._graphView.contentPref.Color.dataIndex)}if(f.is(this._graphView.contentPref.Content)&&f.is(this._graphView.contentPref.Content[ac])){ab=this._graphView.contentPref.Content[ac];ab.forEach(function(ae){if(ad.indexOf(ae.dataIndex)<0){ad.push(ae.dataIndex)}})}}},_createReferenceNodeOptions:function v(am){var al,ad,ak=am.type,ac,aj,af,ai,ah,ae,ab={icons:"",label:"",grid:{},useAsyncPreExpand:true},ag=f.is(this._treeList._columnsValue)?this._treeList._columnsValue.split(","):[];this._fillRequiredAttrForGraphView(ag,ak);if(this._treeList._labelIsOnRef){aj=R.getIconURLFromKey(ak);ab.icons=[aj];ab.label="";if(f.is(this._treeList._isMultipleLabel)&&this._treeList._isMultipleLabel){af=this._treeList._label.split(A.getSeparator());ai=this._treeList._type.split(A.getSeparator());for(ah=0;ah<af.length;ah++){if(f.is(am.type)&&(("undefined"===ai[ah])||(("undefined"!==ai[ah])&&P.isAKindOf(am.type,ai[ah])))){ae=(0===ah)?"":A.getSeparator();if(f.owns(am,af[ah])&&f.is(am[af[ah]])){ab.label+=am[af[ah]]!=="NULL"?ae+am[af[ah]]:""}}}}if(f.owns(am,this._treeList._label)){ab.label=am[this._treeList._label]!=="NULL"?am[this._treeList._label]:""}}for(al in am){if(am.hasOwnProperty(al)){ad=am[al];if(f.is(ad)&&ad!=="NULL"){if(ag&&ag.indexOf(al+".reference")>=0){ab.grid[al+".reference"]=am[al]}else{if(al==="PID"){ab.referencePID=am[al]}else{if(al==="type"){ab.referenceType=am[al]}}}}}}u.fillNodeOptions(ab,this.getColumnsDataIndex());z.fillNodeOptions(ab,this.getColumnsDataIndex());if("MBOM"===this.view){ab.hideShow3D=true}return ab},_addInstanceNodeOptions:function L(ae,af){var ad=f.is(this._treeList._columnsValue)?this._treeList._columnsValue.split(","):[],ab,ac;this._fillRequiredAttrForGraphView(ad,ae.referenceType);if(!this._treeList._labelIsOnRef&&f.owns(af,this._treeList._label)){ae.label=af[this._treeList._label]!=="NULL"?af[this._treeList._label]:""}for(ab in af){if(af.hasOwnProperty(ab)){ac=af[ab];if(f.is(ac)&&ac!=="NULL"){if(ad&&ad.indexOf(ab+".instance")>=0){ae.grid[ab+".instance"]=af[ab]}else{if(ab==="PID"){ae.instancePID=af[ab]}}}}}u.fillNodeOptions(ae,this.getColumnsDataIndex(),af);return ae},isInTreeList:function w(ad,ab){var ac=false,ae;if(f.is(ab)&&ab){ae=this.search(ad,null,false,true)}else{ae=this.search(ad)}if(f.is(ae,"array")){if(ae.length>0){ac=true}}return ac},_search:function l(ab,ac){var ad=this._treeDocument._getTrueRoot();return this._searchRecursive(ad,ab,ac)},_searchRecursive:function t(ad,ac,af){var ag={nodeModel:ad},ab,ae;if(!f.is(af)){af=[]}else{ab=ac.match(ag);if(ab){af.push(ad)}}if(f.is(ad)){ae=ad.getChildren();if(ae){ae.forEach(function(ah){if(f.is(ah)){this._searchRecursive(ah,ac,af)}},this)}}return af},search:function Z(ab,ad,ag,af){var ah,ae=this._search({match:function ac(aj){var ak=f.is(aj)?(f.is(aj.nodeModel)?aj.nodeModel:null):null,ai=false;if(f.is(ak)){if(af&&!ak.isRoot()){ai=false}else{if(!ad||"PID"===ad){if(ag){if(ab===ak.getInstancePID()){ai=true}}else{if(ab===ak.getReferencePID()){ai=true}}}else{if(ad){ah=ag?".instance":".reference";if(ab===ak.options.grid[ad+ah]){ai=true}}}}}return ai}});return ae},prepareUpdate:function W(){if(f.is(this._treeDocument)){this._treeDocument.prepareUpdate()}},pushUpdate:function x(){if(f.is(this._treeDocument)){this._treeDocument.pushUpdate()}},hide:function Q(ae,ab){var ad=this,af=false,ac;if(ae.isInstance()){af=true}this._treeDocument.prepareUpdate();ac=this.search(ae.id,"PID",af,ab);ac.forEach(function(ag){ag.remove();if(f.is(ad._treeList.options.nodesCounter)){ad.decrementCounterRecursive(ag)}});this._treeDocument.pushUpdate()},highlight:function X(ab){this._handleReferenceCrossHL(ab,true)},unHighlight:function n(ab){this._handleReferenceCrossHL(ab,false)},_handleReferenceCrossHL:function G(ab,ad){var ae=null;if(f.is(ab)&&f.is(ab.id)){ae=this.search(ab.id);if(f.is(ae,"array")){ae.forEach(function ac(af){(ad===true)?af.highlight():af.unhighlight()})}}},handleOccCrossHighLight:function J(ac,ab){var af=ac.split(","),ae=this.search(af[0],null,true),ag=1,ad;if(f.is(ae)&&ae.length>0){ad=ae[0];if(af.length>1){ad=this.getChildNodeInOccPathRecursive(ad,af,ag)}}if(f.is(ad)){if(ab){ad.highlight()}else{ad.unhighlight()}}},getChildNodeInOccPathRecursive:function b(af,ae,ag){var ah=af.getChildren(),ad,ab,ac;if(f.is(ah,"array")){for(ac=0;ac<ah.length;ac++){ad=ah[ac];ab=ah[ac].getInstancePID();if(ab===ae[ag]){ag++;if(ag<ae.length){ad=this.getChildNodeInOccPathRecursive(ad,ae,ag)}return ad}}}else{return null}},select:function O(ab){var ad=null;if(f.is(ab)&&f.is(ab.id)){ad=this.search(ab.id);if(f.is(ad,"array")){ad.forEach(function ac(ae){ae.select(false)})}}},unselect:function s(ab){var ad=null;if(f.is(ab)&&f.is(ab.id)){ad=this.search(ab.id);if(f.is(ad,"array")){ad.forEach(function ac(ae){ae.unselect()})}}},decrementCounterRecursive:function g(ae){var ab=this,ad=aa.references.get(ae.getReferencePID()),ac;if(f.is(ad)){ad.decrementDisplayModelCounter(this._treeList.options.nodesCounter)}ac=ae.getChildren();if(f.is(ac)){ac.forEach(function(af){ab.decrementCounterRecursive(af)})}},updateAttributes:function(ae){var ai=ae.changedAttributes(),ab=(ae.isInstance())?".instance":".reference",ag=this.getColumnsDataIndex(),ad={},af,ah,ac;if(ae.isConnection()){return}if(!f.is(ai)){return}u.updateAttributes(this,ae);z.updateAttributes(this,ae);for(af in ai){if(ai.hasOwnProperty(af)){ah=af+ab;if(ag.indexOf(ah)!==-1){if(ai[af]==="NULL"){ad[ah]=""}else{ad[ah]=ai[af]}}if(ah===this._treeList._treeDataIndex){if(ai[af]==="NULL"){ac=""}else{ac=ai[af]}}}}if(f.is(ac)||Object.keys(ad).length>0){this.updateTreeDocument(ae,ac,ad)}},updateTreeDocument:function a(ad,ac,ab){var ae=f.is(ad)?ad.isInstance():false;this.updateNode(ad.id,ac,ab,ae)},updateNode:function K(ae,ad,ac,af){var ab;ab=this.search(ae,"PID",af);this._treeDocument.prepareUpdate();ab.forEach(function(ah){var ag;if(f.is(ad)){ah.setLabel(ad)}if(f.is(ac)){if(f.is(ah._getRowID())){ah.updateOptions({grid:ac})}else{for(ag in ac){if(ac.hasOwnProperty(ag)){ah.options.grid[ag]=ac[ag]}}}}});this._treeDocument.pushUpdate()},emptyTreeList:function H(){var ad=[],ab;ab=this._treeDocument.getRoots();if(f.is(ab,"array")){ab.forEach(function ac(ae){var af=ae.getReferencePID();if(f.is(af,"string")&&(af.length>0)){ad.push(af)}})}this._treeDocument.empty();return ad},getSelectedOccurencePaths:function T(){var ag=this._treeDocument.getXSO().get(),af=[],ae,ad,ab,ac;for(ac=0;ac<ag.length;ac++){ad=ag[ac];ab=ad.getReferencePID();ae=[{refPID:ab}];af.push({path:ae})}return af},getExpandedStructureUnderSelections:function N(ad){var af=this._treeDocument.getXSO().get(),ab=[],ae,ac;for(ac=0;ac<af.length;ac++){ae=af[ac];if(-1!==ad.indexOf(ae.getReferencePID())){this._recursiveExpand(ae,ab)}}return ab},_recursiveExpand:function B(af,ad){var ac,ab,ae;ae=af.getChildren();if(f.is(ae)){ae.forEach(function(ag){ab=ag.getReferencePID();ac=ag.getInstancePID();ad.push({instPID:ac,refPID:ab});B(ag,ad)})}},_updateCfgColAttributes:function k(af,ab){var ac=this,ag={},ad,ah,ae=function(ai){f.extend(ag,ai,true);ac._treeDocument.prepareUpdate();try{ad=Object.getOwnPropertyNames(ag.relids);for(ah=0;ah<ad.length;ah++){ac.updateNode(ad[ah],null,ag.relids[ad[ah]],true)}}finally{ac._treeDocument.pushUpdate()}};if(f.is(ab)&&ab===true){ae(af)}else{E.updateAttributes(af,ae)}},_updateRootMfgCfgColAttributes:function r(ae){var ac=this,ab={CurrentEvolutionEffectivity:" ",Effectivity:" ",ProjectedEvolutionEffectivity:" ",VariantEffectivity:" "},ad;if(f.is(ae,"array")&&ae.length>0){for(ad=0;ad<ae.length;ad++){ac.updateNode(ae[ad],null,ab,false)}}},loadRelations:function m(ag){var ac=[],ah=[],ak=[],af=[],an=[],aj,al,am=this,ad;if("MBOM"===am.view){al=this._treeDocument;aj=al.getSelectedNodes()}ad=function ad(){if(f.is(ag,"function")){ag.call(null,aj)}};if(f.is(aj,"array")&&aj.length>0){aj.forEach(function ab(ao){ao.getParents().forEach(function(ap){if(f.is(ap.getInstancePID())){ac.push(ap.getInstancePID());ak.push(ap.getInstancePID())}ac.push(ap.getReferencePID());ah.push(ap.getReferencePID())});if(f.is(ao.getInstancePID())){ac.push(ao.getInstancePID());ak.push(ao.getInstancePID())}ac.push(ao.getReferencePID());ah.push(ao.getReferencePID())});ac=aa.removeDuplicate(ac);ah=aa.removeDuplicate(ah);ak=aa.removeDuplicate(ak);ah.forEach(function ae(ao){af.push(aa.getReferenceFromCollection(ao)._attributes)});ak.forEach(function ai(ao){an.push(aa.getInstanceFromCollection(ao)._attributes)});aa.getConnectionsFromIndex(ac,af,an,ad)}}});return S});define("DS/DELWebMfgAssetsDefUIServices/UIUtils",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/ApplicationFrame/FrameWindow","DS/Layouts/SlidingViews","DS/Controls/ComboBox","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/Toggle","DS/Core/Events","DS/Tree/TreeListView","DS/DELWebMfgAssetsDefUIControls/UnitsEditor","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefUIOccurenceModel/AbstractTreeDocument","DS/DELWebMfgAssetsDefUIControls/VariableAutoHideAlert","DS/UIKIT/SuperModal","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefModelServices/LoggerUtils","DS/DELWebMfgAssetsDefUIServices/AttributeUtil","DS/DELWebMfgAssetsDefUIServices/UIPreferences","DS/DELWebMfgAssetsDefUIServices/TreeListUtils","DS/DELWebMfgAssetsDefUIServices/TreeListViewManager","DS/DELWebMfgAssetsDefUIControls/BlocLayout","DS/ApplicationFrame/CommandsManager","DS/UIBehaviors/ContextualMenuManager","DS/DELWebMfgAssetsDefUIControls/EditAttributeUI","DS/DELWebMfgAssetsDefUIServices/RelationsColumnManager","DS/DELWebMfgAssetsDefUIServices/DocumentColumnManager","DS/Windows/DockingElement","DS/DELWebMfgAssetsDefUIServices/TooltipUtils","DS/DELWebMfgAssetsDefUIServices/SecurityContext","DS/DELWebMfgAssetsDefUIControls/Preferences","DS/Utilities/Utils","DS/Utilities/Dom","DS/DELWebMfgAssetsDefUIServices/Viewer3DUtil","DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],function(aE,aH,E,r,az,aj,g,n,z,aS,T,aL,ak,aF,A,d,K,U,ah,W,h,aN,H,aB,aK,i,a,y,ap,u,M,ab,o,ay,ag,v,B,aa,x,l,ac){var av=aH.singleton({name:"UIUtils",_logger:null,_widgetTrigram:null,_refreshCmdCounter:0,init:function ad(aT){this._parent(aT);this._logger=E.getLogger(av);this._acceptedTypes=null;if(aE.is(widget)){this.AlertManager=new U();this.ModalManager=new ah({closable:true})}if(aE.is(aT)&&aE.is(aT.widgetTrigram)){this._widgetTrigram=aT.widgetTrigram}else{this._widgetTrigram=""}this._viewer3DUtil=l.getInstance();widget.addEvent("onShowAuxView",this._showAuxView,this);aS.subscribe({event:"DELWebMfgAssetsDefUI/DocumentModelReady"},this._onDocumentModelReady);aS.subscribe({event:"DELWebMfgAssetsDefUI/RefreshCmdStateChange"},this._onRefreshCmdStateChange);aS.subscribe({event:"DELWebMfgAssetsDefUI/asRootInView"},this._onAsRootInView)},buildUI:function L(){this._buildDOM();this._buildView()},setWidget:function R(aT){this._myWidget=aT},getWidget:function aG(){return this._myWidget},getRefreshCmdAvailability:function w(){var aT=(av._refreshCmdCounter>0)?false:true;return aT},setAcceptedTypesInTableView:function m(aT){av._acceptedTypes=aT},validateAcceptedTypesInTableView:function aA(aU){var aT=false;if(aE.is(av._acceptedTypes,"array")&&aE.is(aU)&&(av._acceptedTypes.indexOf(aU.get("PPRTYPE"))!==-1)){aT=true}return aT},validateAcceptedTypesInBodyView:function f(aV){var aU=false,aT;if(aE.is(aV)&&("MFN"===av._widgetTrigram)){aT=aV.get("PPRTYPE");if(("PRODUCT"===aT)||("PART"===aT)){aU=true}}return aU},_onAsRootInView:function I(aW){var aX=aW||{},aU=aE.is(aX.rootPLMID,"string")?((aX.rootPLMID.length>0)?W.getReferenceFromCollection(aX.rootPLMID):null):null,aY=aE.is(aX.onComplete,"function")?aX.onComplete:function aV(){av._logger.log("on add as root in view complete.")},aT=aE.is(aX.forceDBMode)?aX.forceDBMode:false,aZ={withLinksResolved:true,displayMdlRootAttr:"asRootInAuxiliaryView",elementUI:"TreeUI",forceDBMode:aT,onEndLoading:aY};if(av.validateAcceptedTypesInTableView(aU)){aZ=aE.extend(aZ,{displayMdlRootAttr:"asRootInTableView",elementUI:"TableUI"})}else{if(av.validateAcceptedTypesInBodyView(aU)){aZ=aE.extend(aZ,{displayMdlRootAttr:"asRootInBodyView",elementUI:"LeftUI"})}}if(aE.is(aU)){av.addToTreeList(aU,aZ);if(aZ.elementUI==="TreeUI"){widget.dispatchEvent("onShowAuxView",[{PPRType:aU.get("PPRTYPE")}])}}},_onRefreshCmdStateChange:function aO(aV){var aT,aU;if(aV){av._refreshCmdCounter--;if(av._refreshCmdCounter<0){av._refreshCmdCounter=0}}else{av._refreshCmdCounter++}aU=av.getRefreshCmdAvailability();aT=ap.getCommand("Refresh",aN.getActionBarContext());if(aE.is(aT)){if(aU){if(aE.is(av._myWidget)){av._myWidget.manageCommandsAvailability()}}else{aT.disable()}}},getMGAElement:function af(aX){var aW,aZ,aV,aT,aY,aU;aZ=av._myWidget;if(!aZ){av._logger.warn("Could not get widget");return null}aY=aZ._rightBloc;aU=aZ._leftBloc;aV=aZ._auxiliaryView;aT=aZ._bottomBloc;if(aX&&""!==aX){switch(aX){case"MainBlocLayout":aW=av._mainBlocLayout;break;case"InnerBlocLayout":aW=av._innerBlocLayout;break;case"GraphViewContainer":aW=av._graphViewContainer;break;case"TableViewContainer":aW=av._bottomBlocContainer;break;case"RightBlocContainer":aW=av._rightBlocContainer;break;case"LeftBlocContainer":aW=av._leftBlocContainer;break;case"AuxiliaryViewContainer":aW=av._auxiliaryViewContainer;break;case"AuxiliaryViewTypeFilter":aW=av._auxiliaryViewTypeFilter;break;case"AuxiliaryBlocContainer":aW=av._auxiliaryBlocContainer;break;case"LinkViewTypeFilter":aW=av._linkViewTypeFilter;break;case"UIContainer":aW=av._UIContainer;break;case"FrameWindow":aW=av._frameWindow;break;case"SlidingViews":aW=av._slidingViews;break;case"RightUI":if(!aY){av._logger.warn("Could not get right bloc");break}aW=aY.treeListView;break;case"LeftUI":if(!aU){av._logger.warn("Could not get left bloc");break}aW=aU.treeListView;break;case"TreeUI":if(!aV){av._logger.warn("Could not get auxiliary view");break}aW=aV.treeListView;break;case"TableUI":if(!aT){av._logger.warn("Could not get tableView");break}aW=aT.treeListView;break;case"TableViewDropZone":aW=av._tableViewDockingElement;break;case"BodyViewDropZone":aW=av._bodyViewDockingElement;break;case"ActionViewDropZone":aW=av._actionViewDockingElement;break;case"ProgressBar":aW=av._progressBarIndicatorContainer;break;default:break}}return aW},initAuthoringContextUI:function O(aV){var aU=av.getMGAElement("UIContainer"),aT="show",aX="bottom-right",aW=aV||{},aY=function aY(a0){var aZ=aE.is(aW.context)?aW.context:null;if(aE.is(aW.onComplete,"function")){aW.onComplete.call(aZ,a0)}};if(!aF.isStandAlone()){ak.initialize2(aU,widget.id,aT,aX,aY)}else{ak.initialize(aU,widget.id,aT,aX);aY()}},getHeight:function aJ(){var aU,aT=0;if(aE.is(this._UIContainer)){aU=this._UIContainer.getSize();if(aE.is(aU)&&aE.is(aU.height)){aT=aU.height}}return aT},_onDocumentModelReady:function b(aZ){var aV=av.getMGAElement("TableUI"),aU=av.getMGAElement("LeftUI"),aX=av.getMGAElement("RightUI"),aW=[],aT=[],a1=[],aY=function aY(a3,a4,a2){if(aE.is(a3)){if(a3.utils.isInTreeList(a4)){a2.push(a4)}}};if(aE.is(aZ,"array")){aZ.forEach(function a0(a2){aY(aV,a2,aW);aY(aU,a2,aT);aY(aX,a2,a1)})}if(aW.length>0){aV.utils.updateDocumentColumn(aW)}if(aT.length>0){aU.utils.updateDocumentColumn(aT)}if(a1.length>0){aX.utils.updateDocumentColumn(a1)}},_endloadingCBForRelatedObjects:function C(aX,be){var aV=av.getMGAElement("TableUI"),aZ=av.getMGAElement("LeftUI"),a8=av.getMGAElement("RightUI"),aT=false,aW=false,aU={silent:true},bc={referencesPID:[]},a3,a7,bb,a4,aY,a0,a9,a5,bd;a7=aF.printCurrentDateTime("_endloadingCBForRelatedObjects start - ");if(aE.is(aV)){ab.forceCellUpdate(aV.utils,aX);o.fillNodeOptions(be.options,aV.utils.getColumnsDataIndex())}if("MFN"===av._widgetTrigram){if(aX.getDisplayModelAttr("asRootInTableView")){a3=aX.getDisplayModelAttr("connectionModelInfo");if(aE.is(a3,"array")){a3.forEach(function ba(bf){var bh=null,bg={asRootInBodyView:true};if("ProductImplementLink"===bf.connectionTypeName){bh=W.getReferenceFromCollection(bf.modelID);if(aE.is(bh)&&!bh.getDisplayModelAttr("asRootInBodyView")){bh.setDisplayModel(bg)}}})}aF.printDuration(a7,"_endloadingCBForRelatedObjects after - ")}}else{aY=function aY(bh){var bf=(bh.getDisplayModelAttr("refCountLeftBloc")>=1),bg=(bh.getDisplayModelAttr("nodesInLeftBloc")===0);return(bf&&bg)};a9=function a9(bh){var bf=(bh.getDisplayModelAttr("refCountRightBloc")>=1),bg=(bh.getDisplayModelAttr("nodesInRightBloc")===0);return(bf&&bg)};if(aE.is(d)){if(aE.is(d.LeftBloc)){if(d.LeftBloc.considerAllNodes){aT=true;a4=d.LeftBloc.ConnectionTypes}}if(aE.is(d.RightBloc)){if(d.RightBloc.considerAllNodes){aW=true;bb=d.RightBloc.ConnectionTypes}}}W.expandOnBackbone(aX.id,bc);bd=W.getReferenceFromCollection(bc.referencesPID);bd.push(aX);bd.forEach(function a2(bf){var bg=bf.getDisplayModelAttr("connectionModelInfo");if(aE.is(bg,"array")){bg.forEach(function bh(bk){var bj=bk.modelID,bi=bk.connectionTypeName,bl;if(aE.is(bj)){bl=W.getReferenceFromCollection(bj);if(aE.is(bl)){if(aT&&a4.hasOwnProperty(bi)){bl.incrementDisplayModelCounter("refCountLeftBloc",aU)}if(aW&&bb.hasOwnProperty(bi)){bl.incrementDisplayModelCounter("refCountRightBloc",aU)}}}})}});aF.printDuration(a7,"_endloadingCBForRelatedObjects after link computation");if(aE.is(aZ)&&aE.is(aZ.utils)){a0=W.references.filter(aY);aZ.utils._treeDocument.prepareUpdate();a0.forEach(function a1(bf){aZ.utils.addToTreeList(bf)});aZ.utils._treeDocument.pushUpdate()}aF.printDuration(a7,"_endloadingCBForRelatedObjects after LeftView");if(aE.is(a8)&&aE.is(a8.utils)){a8.utils._treeDocument.prepareUpdate();a5=W.references.filter(a9);a5.forEach(function a6(bf){a8.utils.addToTreeList(bf)});a8.utils._treeDocument.pushUpdate()}aF.printDuration(a7,"_endloadingCBForRelatedObjects after RightView")}},addToTreeList:function aP(aY,a3){var aT=a3||{},aV=av.getMGAElement("TableUI"),aZ=aE.is(aT.elementUI,"string")?av.getMGAElement(aT.elementUI):aV,a0=aE.is(aT.displayMdlRootAttr,"string")?aT.displayMdlRootAttr:"asRootInTableView",a4=aE.is(aT.displayMdlRootAttr,"string")?null:{asRootInTableView:true},a6=("asRootInTableView"===a0)?true:false,aX=aE.is(aT.context)?aT.context:null,a7=aE.is(aT.withLinksResolved,"boolean")?aT.withLinksResolved:true,aU=aE.is(aT.forceDBMode,"boolean")?aT.forceDBMode:false,a1=true,aW,a5=function a5(){if(aE.is(a3)&&aE.is(a3.onFailure,"function")){a3.onFailure.call(aX)}},a2=function a2(a9,a8){if("MFN"===av._widgetTrigram){if(a0==="asRootInTableView"){av._myWidget.getMbomDropView().hide()}else{if(a0==="asRootInBodyView"){av._myWidget.getBodyDropView().hide()}}}if(a7&&a6){av._endloadingCBForRelatedObjects.call(av,a9,a8)}if(aE.is(a3)&&aE.is(a3.onEndLoading,"function")){a3.onEndLoading.call(aX,a9,a8)}};if(!aE.is(a4)){a4={};a4[a0]=true}a1=aY.setDisplayModel(a4,{silent:true});if(a1){if(aE.is(aZ.utils)){aZ.utils.addToTreeList(aY,{silentMode:true,withLinksResolved:a7,onEndLoading:a2,onFailure:a5,onTimeout:a5,forceDBMode:aU})}if("MFN"===av._widgetTrigram){if(a4.asRootInTableView===true){aW="MBOM"}else{if(a4.asRootInBodyView===true){aW="BODY"}else{aW="AUX"}}}else{if(a4.asRootInTableView===true){aW="TABLE"}else{aW="AUX"}}B.addRootToPreferences(aY.id,aW)}else{if(aE.is(a3)&&aE.is(a3.onFailure,"function")){a3.onFailure.call(aX)}}},createTreelistview:function al(a0){var a1={shouldAcceptDrag:function(){return true},shouldAcceptDrop:function(){return true}},aU,aT,aX={height:"auto",performances:{resizeDebounceTimeout:200},resize:{columns:true,rows:true},selection:{unselectAllOnEmptyArea:true,toggle:false,cells:false,enableListSelection:true},managerClass:a,enableActiveUI:true,enableKeyboardNavigation:true,shouldDisplayTooltip:function(bo){var bm=bo.manager.getColumnOptions(bo.virtualColumnID),bh={longHelp:"",},bq=[],bk=aK.getAttributeNameFromColumn(bm),bn=h.getAttributeInfo(bk),bj=bo.cellModel.options.value,bp,bi,bl;switch(bm.displayType){case"Relation":case"Multivalue":case"DocMgmt":if(bm.displayType==="Multivalue"&&!bo.isHeader){bj=aB.getValueAsArray(bm.getValue(bo))}if(Array.isArray(bj)&&bj.length!==0){for(bi=0;bi<bj.length;bi++){bp=bj[bi];if(aE.is(bp)){bq.push(aE.is(bp.Value)?bp.Value:bp)}}bh.longHelp=aB.getValueAsString(bq,aB.getType(bn)).split(aK.getSeparator()).join("\n")}else{if(bo.isHeader){bh.longHelp=bj}}break;case"MultiDate":bj=aB.getValueAsArray(bj);if(Array.isArray(bj)&&bj.length!==0){for(bi=0;bi<bj.length;bi++){bp=aB.getFormattedDate(bj[bi]);bq.push(aE.is(bp.Value)?bp.Value:bp)}bh.longHelp=bq.toString().replace(/,/g,"\n")}else{if(bo.isHeader){bh.longHelp=bj}}break;case"Date":bl=bo.cellModel.options.value;if(!bo.isHeader){bl=aB.getFormattedDate(bl)}bh.longHelp=bl;break;case"BI":bl=bo.cellModel.options.value;if(!bo.isHeader){if(!aE.is(bl)||!aE.is(bl.tooltip)){bl=""}else{bl=bl.tooltip}}bh.longHelp=bl;break;case"hide3D":if(!bo.isHeader){bl=bo.cellModel.options.value;if(aE.is(bl,"boolean")){bh.longHelp=bl?h.getNLSValue("HideShow3D.hide3D"):h.getNLSValue("HideShow3D.show3D")}}else{bh.longHelp=h.getNLSValue("HideShow3D.tooltip")}break;default:bl=bo.cellModel.options.value;if(!bo.isHeader){if(!aE.is(bl)){bl=""}else{if(aE.typeOf(bl)==="object"){bl=bl.getLabel()}else{if(aE.typeOf(bl)==="boolean"){bl=(bl)?"True":"False"}else{if(aB.hasRangeDefined(bn)){bl=bo.cellModel.options.value}else{if(aB.isDouble(bn)||aB.isInteger(bn)){bl=aB.getValueAsString(bl,aB.getType(bn))}}}}}}bh.longHelp=bl}if(!bo.isHeader){bh.longHelp+="\n\n"+ag.getTooltipValue(bo)}return bh},shouldBeEditable:function(bj){var bh=true,bi;if(bj.isHeader===true){bh=false}else{if(bj.dataIndex==="selection"){bh=true}else{bi=aB.getNodeAndColumnInfos(bj.nodeModel,bj.parent.options.columns[bj.virtualColumnID]);bh=!aB.isReadOnly(bi.attributeInfo,bi.attributeDef)}}return bh},apiVersion:2},a6={treeDataIndex:"",label:"",labelIsOnRef:null,isMultipleLabel:false,type:"",dicoType:""},a5,bf,a4,ba,bd,be,aZ,a9,a3,bg,aY,a2,bc,a7,bb=function bb(bi){var bl,bk,bh;bi.preventDefault();bi.stopPropagation();bh=bi.target.getParent();if(aE.is(bh)&&aE.is(bh.dsView)){bl=bh.dsView.getCellInfos();bk=aB.getNodeAndColumnInfos(bl.nodeModel,aU[bl.virtualColumnID]);if(aE.is(bk.objectToBeModified)&&!aB.doesAttributeExist(bk.objectToBeModified,bk.dataIndex)){bk.objectToBeModified.fetch({proxy:"passport",type:"json",headers:aF.getHeaders(),queriedForConnections:bk.objectToBeModified.get("queriedForConnections"),onComplete:function bj(bn){var bm=aE.is(bn.changedAttributes(),"boolean")?false:true;bn.setAdditionalInfo({isFetched:true});if(aB.doesAttributeExist(bn,bk.dataIndex)){av._logger.log("Model refreshed (PID, isChanged): "+bn.id+", "+(bm?"TRUE":"FALSE"))}else{av.AlertManager.add({className:"error",message:h.getNLSValue("TableView.AvailabilityFailure",{key:bk.attributeNLSTitle})})}if(bm){bl.cellView.getGridEngine().updateRowView(bl.virtualRowID)}}})}}};if(!a0){a0={}}a9=a0.hasOwnProperty("preferences")?a0.preferences:aK.TableView;bd=a0.hasOwnProperty("treeDocumentOptions")?aE.extend(a1,a0.treeDocumentOptions):a1;be=a0.hasOwnProperty("treeDocument")?a0.treeDocument:new K(bd);aY=a0.hasOwnProperty("treelistviewOptions")?aE.extend(aX,a0.treelistviewOptions):aX;aY=aE.extend(aY,{treeDocument:be});bg=a0.hasOwnProperty("name")?a0.name:null;be.alertManager=av.AlertManager;if(a9.createTree){bf=aE.is(aK.AuxiliaryView)?aK.AuxiliaryView.Label:null;if(aE.is(bf)&&aE.is(bf.length)){if(bf.length>1){a6.isMultipleLabel=true}for(a4=0;a4<bf.length;a4++){a6.treeDataIndex+=bf[a4].dataIndex;a6.dicoType+=bf[a4].dicoType;a6.type+=(aE.is(bf[a4].Type))?bf[a4].Type:"undefined";a5=bf[a4].dataIndex.split(".");a6.label+=a5[0];ba=a5[1];if(ba==="instance"){if(!aE.is(a6.labelIsOnRef)){a6.labelIsOnRef=false}else{a6.labelIsOnRef=a6.labelIsOnRef&&false}}else{if(!aE.is(a6.labelIsOnRef)){a6.labelIsOnRef=true}else{a6.labelIsOnRef=a6.labelIsOnRef&&true}}if(a4+1!==bf.length){a6.label+=aK.getSeparator();a6.type+=aK.getSeparator();a6.dicoType+=aK.getSeparator();a6.treeDataIndex+=aK.getSeparator()}}aU=[{text:h.getNLSValue(a6.label.split(aK.getSeparator())[0],null,a6.dicoType.split(aK.getSeparator())[0]),dataIndex:"tree",dicoType:a6.dicoType,label:a6.label,labelIsOnRef:a6.labelIsOnRef,setValue:av._setValue}]}else{a6=aK.getLabel(aK.AuxiliaryView);aU=[{text:h.getNLSValue(a6.label,null,a6.dicoType),dataIndex:"tree",dicoType:a6.dicoType,label:a6.label,labelIsOnRef:a6.labelIsOnRef,setValue:av._setValue}]}aU.splice(0,0,{isSortable:false,text:"",dataIndex:"selection",type:"selection",width:40});aX=aE.extend(aX,{columns:aU});aX.isEditable=false;a2=new T(aX)}else{a6=aK.getLabel(a9);a3=a9.Columns.Column;aU=this._createTreeListViewColumns(a3);aU.splice(0,0,{isSortable:false,text:a0.treelistviewOptions.className,dataIndex:"tree",width:"30%",minWidth:150,dicoType:a6.dicoType,label:a6.label,labelIsOnRef:a6.labelIsOnRef,setValue:av._setValue,isEditable:!aB.isReadOnly(h.getAttributeInfo(a6.dicoType+"."+a6.label))});if(aE.is(bg)){if(bg==="MBOMView"){if(!A.isSuppressHideShow3DColumn()){aU.splice(0,0,{isSortable:false,isEditable:true,isDraggable:false,text:"",dataIndex:"hide_show_3D",displayType:"hide3D",typeRepresentation:"custoBooleanRep",width:30,getValue:function aW(bh){return bh.nodeModel.options.hideShow3D},setValue:function aV(bk){var bj,bi=bk.nodeModel,bh=false;bj=bi.options.hideShow3D;if(aE.is(bj)){bh=!bj}av._viewer3DUtil.hideShow3D(bi,bh);bi.updateOptions({hideShow3D:bh})}})}}}aU.splice(0,0,{isSortable:false,text:"",dataIndex:"selection",type:"selection",width:40});aU.splice(0,0,{isSortable:false,isEditable:false,isDraggable:false,isHidden:true,text:"",dataIndex:"taggerColor",width:5,onCellRequest:function a8(bi){var bh;if(bi.manager.getColumnOptions("taggerColor").isHidden===false){if(!bi.isHeader){bh=bi.cellView.reuseCellContent("resuableTaggerColor");if(bh){bh.style["background-color"]=bi.nodeModel.options.taggerColor;bi.cellView.getContent().setContent(bh)}}}},});aY=aE.extend(aY,{columns:aU});a2=new T(aY);a2._columnsValue=aK.getColumnsValue(a9);bc=a2.getManager();a7=bc.getTypeRepresentationFactory();a7.registerTypeTemplates({custoBooleanType:{path:"DS/DELWebMfgAssetsDefUIServices/TweakerCustomBoolean",options:{}}});a7.registerTypeRepresentations({custoBooleanRep:{stdTemplate:"custoBooleanType",semantics:{valueType:"boolean"}}});a3.forEach(function(bh){if(aE.is(bh.display)&&bh.display===false){bc.hideColumn(bh.dataIndex)}});bc.registerReusableCellContent({id:"resuableTaggerColor",buildContent:function(){return new aE.Element("div",{"class":"taggerColorCell"})}});bc.registerReusableCellContent({id:"_unitsEditor",buildContent:function(){var bh=new aL({displayStyle:"lite",requiredFlag:false,});bh.getContent().addEventListener("focus",bb);return bh}});bc.registerReusableCellContent({id:"_toggle",buildContent:function(){var bh=new z({checkFlag:false});bh.getContent().addEventListener("focus",bb);return bh}});bc.registerReusableCellContent({id:"_comboBox",buildContent:function(){var bh=new aj({elementsList:["dummy"]});bh.addEventListener("preDropdown",bb);return bh}});bc.registerReusableCellContent({id:"_lineEditor",buildContent:function(){var bh=new n({displayStyle:"lite"});bh.getContent().addEventListener("focus",bb);return bh}});bc.registerReusableCellContent({id:"_editor",buildContent:function(){var bh=new g();bh.getContent().addEventListener("focus",bb);return bh}});bc.registerReusableCellContent({id:"BICell",buildContent:function(){return new aE.Element("span",{"class":"indicator",styles:{display:"none"}})}});bc.registerReusableCellContent({id:"relationsNotLoadedCell",buildContent:function(){var bi,bh,bj;bi=new aE.Element("div",{"class":"wux-layouts-rowentry",name:"mainDiv"});bh=new aE.Element("div",{"class":"wux-layouts-treeview-multivaluecell-container",});bj=new aE.Element("div",{"class":"wux-layouts-treeview-label",id:"multiValueCellLabel"});bh.inject(bi);bj.inject(bh);return bi}});bc.registerReusableCellContent({id:"multiValueCell",buildContent:function(){var bj,bi,bh,bl,bk;bj=new aE.Element("div",{"class":"wux-layouts-rowentry",name:"mainDiv"});bi=new aE.Element("div",{"class":"wux-layouts-treeview-multivaluecell-container",});bh=new aE.Element("div",{"class":"wux-layouts-treeview-icon","icon-type":"css",id:"multiValueCellIcon"});bl=new aE.Element("div",{"class":"wux-layouts-treeview-label",id:"multiValueCellLabel"});bk=new aE.Element("i",{"class":"wux-ui-3ds wux-ui-3ds-menu-dot wux-layouts-rowentry-moreindicator",id:"multiValueCellMoreIndicator",styles:{display:"none"}});bi.inject(bj);bh.inject(bi);bl.inject(bi);bk.inject(bj);return bj}});bc.registerReusableCellContent({id:"multiValueLabelCell",buildContent:function(){var bh,bj,bi;bh=new aE.Element("div",{"class":"wux-layouts-rowentry",name:"mainDiv"});bj=new aE.Element("div",{"class":"wux-layouts-treeview-multivaluecell-container wux-layouts-treeview-label",id:"multiValueCellLabel"});bi=new aE.Element("i",{"class":"wux-ui-3ds wux-ui-3ds-menu-dot wux-layouts-rowentry-moreindicator",id:"multiValueCellMoreIndicator",styles:{display:"none"}});bh.addEvent("dblclick",function(bn){var bl=bn.currentTarget,bk=bl.getParent(),bm,bo;bm=bk.value;bl.hide();bo=new n({displayStyle:"lite",value:aE.is(bm)?bm:""}).inject(bk);bo._myInput.focus();bo.addEventListener("blur",function(bq){var br=bq.currentTarget,bp=br.getParent().getElement(".wux-layouts-rowentry");if(aE.is(bp)){br.destroy();bp.show()}})});bj.inject(bh);bi.inject(bh);return bh}})}a2._treeDataIndex=a6.treeDataIndex;a2._label=a6.label;a2._labelIsOnRef=a6.labelIsOnRef;a2._isMultipleLabel=a6.isMultipleLabel;a2._type=a6.type;aZ=a0.hasOwnProperty("treeListUtilsOptions")?aE.extend({treeList:a2},a0.treeListUtilsOptions):{treeList:a2};a2.utils=new i(aZ);be._treelistview=a2;aT=aK.getBlockAttributes(a9);aF.setSelectPredicate(a0.name,aT.index);return a2},getColumnDisplayValue:function e(aV){var aT=aK.getAttributeNameFromColumn(aV),aY=aV.dataIndex.split(".")[1]==="instance",aX="",aW=aY?h.getNLSValue("TableView.InstancePrefix"):"",aU=aW+h.getNLSValue(aT)+aX;return aU},getColumnNLSValue:function aw(aV){var aU=aK.getAttributeNameFromColumn(aV),aW=h.getAttributeInfo(aU),aT;if(aE.is(aW)){aT=aW.NLS}else{aT=aV.dataIndex.split(".")[0]}return aT},_createTreeListViewColumns:function p(aU){var aT=this,aV=[];aU.forEach(function aW(aY){var aZ={},aX=aK.getAttributeNameFromColumn(aY),a0=h.getAttributeInfo(aX);if(!aE.is(aY.displayType)&&aE.is(a0)){if(aE.is(a0.Magnitude,"string")&&""!==a0.Magnitude){aY.displayType="MagnitudeValue"}else{if(aB.isMultiDate(a0)){aY.displayType="MultiDate"}else{if(aB.isMultiValuated(a0)){aY.displayType="Multivalue"}else{if(aB.isDate(a0)){aY.displayType="Date"}}}}}if(aE.is(aY.displayType)){switch(aY.displayType){case"Relation":aZ.onCellRequest=ab.formatCellMultiValue;break;case"MagnitudeValue":aZ.onCellRequest=av._onCellRequest;aZ.setValue=av._setValue;break;case"MultiDate":aZ.onCellRequest=av._onCellRequest;aZ.getValue=av._getMultivalue;aZ.setValue=av._setMultivalue;break;case"Multivalue":aZ.onCellRequest=av._onCellRequest;aZ.getValue=av._getMultivalue;aZ.setValue=av._setMultivalue;break;case"DocMgmt":aZ.onCellRequest=o.formatDocumentColumn;break;case"CFG":aZ.onCellRequest=ac._columnDef[aY.dataIndex].onCellRequest;break;case"Date":case"DateTime":aZ.isEditable=!aB.isReadOnly(a0);aZ.typeRepresentation=(aY.displayType==="DateTime")?"datetime":"date";aZ.getValue=function(a3){var a1=a3.nodeModel.options.grid[a3.dataIndex],a2=typeof a1==="number"?a1*1000:a1;return aE.is(a2)?aB.getDate(a2):null};aZ.setValue=function(a3){var a1=Math.floor(a3.value.getTime()/1000);var a2=aB.getNodeAndColumnInfos(a3.nodeModel,aV[a3.virtualColumnID]);a3.nodeModel.options.grid[a3.dataIndex]=a1;a3.manager.updateRowViewWithException(a3.nodeModel,a3.dataIndex);aB.saveValue(av.AlertManager,a2.objectToBeModified,null,a2.dataIndex,a1,a2.attributeNLSTitle,a2.attributeName,a2.instOrRef,a2.attributeInfo)};break;case"MIL":aZ.onCellRequest=av._onMILCellRequest;aZ.setValue=av._setMILValue;break;case"BI":aZ.onCellRequest=av._onBICellRequest;break;default:break}}else{aZ.isEditable=!aB.isReadOnly(a0);aZ.onCellRequest=av._onCellRequest;aZ.setValue=av._setValue}aZ=aE.merge(aZ,{isSortable:false,isEditable:false,dataIndex:aY.dataIndex,dicoType:aY.dicoType,displayType:aY.displayType,width:isNaN(aY.width)?"auto":parseInt(aY.width),minWidth:aY.minWidth||"100",text:aT.getColumnDisplayValue(aY),tooltipIndex:aY.Tooltip});aV.push(aZ)});return aV},_onCellRequest:function au(a4){var a5,aW,a3=a4.cellView,aV,aT=this.options.columns,a2,a6,a1,a8,a7,a0,aX,aU,aZ,aY;if(a4.isHeader){return}aZ=a3.elements.labelContainer;if(aE.is(aZ)&&aZ.hasAttribute("title")){aZ.removeAttribute("title")}a2=function a2(a9,bb){var ba=a4.cellView.reuseCellContent("_lineEditor");bb=aE.is(bb)?bb:false;if(aE.is(ba)){ba.value=a0;ba.disabled=bb;if(a9){ba.pattern=aB.getPattern(aX.attributeInfo)}}a4.cellView.getContent().setContent(ba)};a0=a4.cellModel.options.value;aX=aB.getNodeAndColumnInfos(a4.nodeModel,aT[a4.virtualColumnID]);a8=function a8(){var ba=0,bb;if(!aE.is(a0)){a0=""}aU=aB.isReadOnly(aX.attributeInfo,aX.attributeDef);if(aB.isVisible(aX.attributeDef)===false){a2(false,true)}else{if(aB.hasMagnitude(aX.attributeInfo)){a6=a4.cellView.reuseCellContent("_unitsEditor");a0=a4.nodeModel.options.grid[a4.dataIndex];if(aE.is(a6)){a6.value=aB.getMagnitudeValue(a0,aX.attributeInfo);if(aE.is(a6.setUnit,"function")){a1=aB.getNLSForUnit(aX.attributeInfo);a6.setUnit(a1)}a6.disabled=aU;a4.cellView.getContent().setContent(a6)}}else{if(aB.isMultiDate(aX.attributeInfo)){a0=aB.getValueAsDateArray(a0);a7=a0.map(function(bc){return aB.getFormattedDate(bc)});a0=aB.getValueAsString(a7,aB.getType(aX.attributeInfo));a2(false,aU)}else{if(aB.isMultiValuated(aX.attributeInfo)){a0=aB.getValueAsString(a0,aB.getType(aX.attributeInfo));a2(false,aU)}else{if(aB.isBoolean(aX.attributeInfo)){aV=a4.cellView.reuseCellContent("_toggle");if(aE.is(aV)){aV.checkFlag=a0==="TRUE";aV.disabled=aU}a4.cellView.getContent().setContent(aV)}else{if(aB.hasRangeDefined(aX.attributeInfo,aX.attributeDef)){if(aE.is(a4.cellView._reusableContent)&&aE.is(a4.cellView._reusableContent.elements)&&aE.is(a4.cellView._reusableContent.elements.popup)&&aE.is(a4.cellView._reusableContent.elements.popup.visibleFlag,"boolean")){bb=a4.cellView._reusableContent.elements.popup.visibleFlag}else{bb=false}a5=a4.cellView.reuseCellContent("_comboBox");if(aE.is(a5)){a5.actionOnClickFlag=false;a5.enableSearchFlag=false;a5.expanderVisibleFlag=false;a5.elementsList=aB.getAuthorizedValuesNLSList(aX.attributeInfo,aX.attributeDef);if(aE.is(a0)){ba=aB.getAuthorizedValueIndex(aX.attributeInfo,aX.attributeDef,a0);if(aE.is(ba,"number")&&(ba>=1)){a5.selectedIndex=ba-1}}a5.disabled=aU;a4.cellView.getContent().setContent(a5);if(bb){x.onNodeRendered(a5.getContent(),function a9(){a5._showPopup()})}}}else{if(aB.isMultiLine(aX.attributeInfo)){aW=a4.cellView.reuseCellContent("_editor");if(aE.is(aW)){aW.value=a0;aW.disabled=aU;aW.pattern=aB.getPattern(aX.attributeInfo)}a4.cellView.getContent().setContent(aW)}else{if(aB.isDouble(aX.attributeInfo)||aB.isInteger(aX.attributeInfo)){a0=aB.getValueAsString(a0,aB.getType(aX.attributeInfo));a2(false,aU)}else{a2(true,aU)}}}}}}}}if(aU){a4.cellView.getContent().addClassName("editor-read-only")}};if(aE.is(aX.objectToBeModified)){aY=aB.doesAttributeExist(aX.objectToBeModified,aX.dataIndex);if(aY||(!aY&&(d.getNavigateOn()==="index"||d.getNavigateOn()==="indexOndemand")&&!aX.objectToBeModified.getAdditionalInfo("isFetched"))){a8()}}},_onMILCellRequest:function aQ(aY){var aV,aW,aZ,a1=[],a0,aX,aU=-1,aT;if(aY.isHeader){return}aW=aY.cellModel.options.value;aX=function aX(){aV=aY.cellView.reuseCellContent("_lineEditor");if(aE.is(aV)){aV.value=aW;aV.disabled=true}aY.cellView.getContent().setContent(aV);if("MIL_previous"===aY.dataIndex){aT=aY.nodeModel.options.grid.cellInfo.PreviousProdIconUrl;if(aE.is(aT)){aY.cellView.getContent().innerHTML='<img class="type-icon-datagrid" src="'+aT+'" draggable="false"/>'+aW}}else{if("MIL_manufactured"===aY.dataIndex){aT=aY.nodeModel.options.grid.cellInfo.MfgItemIconUrl;if(aE.is(aT)){aY.cellView.getContent().innerHTML='<img class="type-icon-datagrid" src="'+aT+'" draggable="false"/>'+aW}}}};if("MIL_suggestion"===aY.dataIndex){aZ=aY.cellView.reuseCellContent("_comboBox");if(aE.is(aZ)){aZ.actionOnClickFlag=false;aZ.enableSearchFlag=false;aZ.expanderVisibleFlag=true;aZ.elements.container.getChildren().forEach(function(a2){if(true===a2.hasClassName("wux-controls-combobox-mainelement")){a2.addClassName("mil-combobox-button")}a2.addClassName("mil-combobox-expanderbutton")});if(aE.is(aY.nodeModel)&&aE.is(aY.nodeModel.options)){a0=aY.nodeModel.options;if(aE.is(a0.grid)&&aE.is(a0.grid.cellInfo)){a0=a0.grid.cellInfo;if(aE.is(a0.suggestionToPerformEntries)){a1=a0.suggestionToPerformEntries}}}aZ.elementsList=a1;a1.forEach(function(a2){aU++;if(a2.valueItem===aW.value){aZ.selectedIndex=aU}})}aY.cellView.getContent().setContent(aZ)}else{if("MIL_rerouting"===aY.dataIndex){if(aE.is(aY.nodeModel)&&aE.is(aY.nodeModel.options)){a0=aY.nodeModel.options;if(aE.is(a0.grid)&&aE.is(a0.grid.cellInfo)){a0=a0.grid.cellInfo;if(aE.is(a0.candidateEntries)&&1<a0.candidateEntries.length){a1=a0.candidateEntries;aZ=aY.cellView.reuseCellContent("_comboBox");if(aE.is(aZ)){aZ.actionOnClickFlag=false;aZ.enableSearchFlag=false;aZ.expanderVisibleFlag=true;aZ.elements.container.getChildren().forEach(function(a2){if(true===a2.hasClassName("wux-controls-combobox-mainelement")){a2.addClassName("mil-combobox-button")}a2.addClassName("mil-combobox-expanderbutton")});aZ.elementsList=a1;a1.forEach(function(a2){aU++;if(a2.valueItem===aW){aZ.selectedIndex=aU}})}aY.cellView.getContent().setContent(aZ)}else{aX()}}}}else{aX()}}},_onBICellRequest:function S(aV){var aU,aT;if(!aV.isHeader){aT=aV.cellView.reuseCellContent("BICell");if(aE.is(aT)){if(aE.is(aV.dataIndex)){aU=aV.nodeModel.getAttributeValue(aV.dataIndex)}if(aE.is(aU)){aT.style.display="block";aT.style.color=aU.colorCode;if(aU.status==="Inconsistent"){aT.setContent("?");aT.removeClassName("bullet-indicator")}else{aT.setContent("");aT.addClassName("bullet-indicator")}}else{aT.style.display="none"}aV.cellView.getContent().setContent(aT)}}},_onMultivalueCellRequest:function Y(a2){var a3,aV,a1,aU=this.options.columns,aX=aB.getNodeAndColumnInfos(a2.nodeModel,aU[a2.virtualColumnID]),aZ,a0=aX.attributeInfo,aT=[],a4,aW,aY;if(!a2.isHeader){aY=aB.doesAttributeExist(aX.objectToBeModified,aX.dataIndex);if(aY||(!aY&&(d.getNavigateOn()==="index"||d.getNavigateOn()==="indexOndemand")&&!aX.objectToBeModified.getAdditionalInfo("isFetched"))){aZ=a2.manager.getColumnOptions(a2.virtualColumnID);if(aE.is(a2.value)){aT=aB.getValueAsArray(a2.value)}else{a1=aE.is(aZ.getValue)?aZ.getValue(a2):a2.cellModel.options.value;if(!aE.is(a1)){a1=""}if(Array.isArray(a1)){aT=a1}else{if(a1===""){aT[0]=a1}else{aT=aB.getValueAsArray(a1)}}}a2.cellView.elements.container.value=aB.getValueAsString(aT,aB.getType(a0));if(Array.isArray(aT)&&aT.length!==0){a3=a2.cellView.reuseCellContent("multiValueLabelCell");if(aE.is(a3)){a3.style.display="block";aV=aE.is(aT[0])?aB.getValueAsString(aT[0],aB.getType(a0)):"";aW=a3.getElement(".wux-layouts-treeview-label");if(aE.is(aW)){aW.innerHTML=aV}a4=a3.getElement(".wux-layouts-rowentry-moreindicator");if(aE.is(a4)){a4.style.display=(aT.length>1)?"inline-block":"none"}a2.cellView.getContent().setContent(a3)}}}}},_setValue:aa.debounce(function am(aW){var aU,aT,aV=aB.getNodeAndColumnInfos(aW.nodeModel,this.options.columns[aW.virtualColumnID]);if(!aB.doesAttributeExist(aV.objectToBeModified,aV.dataIndex)){av.AlertManager.add({className:"error",message:h.getNLSValue("TableView.AvailabilityFailure",{key:aV.attributeNLSTitle})});return}if(aB.isBoolean(aV.attributeInfo)){aU=aW.event.target.dsModel.checkFlag?"TRUE":"FALSE"}else{if(aB.hasRangeDefined(aV.attributeInfo,aV.attributeDef)){if(!aE.is(aW.event.target.dsModel)){return}aU=aW.event.target.dsModel.currentValue;aU=aB.getAuthorizedValue(aV.attributeInfo,aU)}else{if(aB.isDate(aV.attributeInfo)){aU=new Date(aW.value);if(!isNaN(aU.getTime())){aU=Math.floor(aU.getTime()/1000)}else{av.AlertManager.add({className:"error",message:h.getNLSValue("TableView.InvalidDateMessage",{date:aW.value})});aW.manager.updateCellView(aW.nodeModel,aW.virtualColumnID);return}}else{if(aE.is(aW.event.target.dsModel)){aU=aW.event.target.dsModel.value}else{aU=aW.event.target.value;aT=aB.getMaxLength(aV.attributeInfo);if(aT>0&&aU.length>aT){av.AlertManager.add({className:"error",message:h.getNLSValue("TableView.MaxLengthFailure",{length:aU.length,maxLength:aT})});return}}if(aB.isMultiValuated(aV.attributeInfo)){aU=aB.getValueAsArray(aU)}}}}aB.saveValue(av.AlertManager,aV.objectToBeModified,null,aV.dataIndex,aU,aV.attributeNLSTitle,aV.attributeName,aV.instOrRef,aV.attributeInfo,aV.attributeDef)},100,true),_setMILValue:aa.debounce(function c(aX){var aV,aU,aW,aY,aT;if("MIL_suggestion"===aX.dataIndex){if(!aE.is(aX.event.target.dsModel)){return}aV=aX.event.target.dsModel.currentValue;if(!aE.is(aV)){return}aW=aX.nodeModel.options.grid.cellInfo.suggestionToPerformEntries;aW.forEach(function(aZ){if(aZ.valueItem===aV){aY={label:aZ.labelItem,value:aZ.valueItem,getLabel:function a0(){return this.label}}}});aX.cellModel.setCellContent(aY);if(aE.is(aX.nodeModel)&&aE.is(aX.nodeModel.options)){aU=aX.nodeModel.options;if(aE.is(aU.grid)){aU.grid.MIL_suggestion=aY;if(aE.is(aU.grid.cellInfo)){aU=aU.grid.cellInfo;if(aE.is(aU.action)){aU.action=aV}}}}}else{if("MIL_rerouting"===aX.dataIndex){if(!aE.is(aX.event.target.dsModel)){return}aV=aX.event.target.dsModel.currentValue;if(!aE.is(aV)){return}aX.cellModel.setCellContent(aV);if(aE.is(aX.nodeModel)&&aE.is(aX.nodeModel.options)){aU=aX.nodeModel.options;if(aE.is(aU.grid)){aU.grid.MIL_rerouting=aV;if(aE.is(aU.grid.cellInfo)){aU=aU.grid.cellInfo;if(aE.is(aU.candidateId)){aT=aV.split(",");aU.candidateId=aT[aT.length-1];aU.candidateOccPath=aT}}}}}}},100,true),_setMultivalue:aa.debounce(function ao(aY){var aW,aT=[],aX,aV,aU;aW=aY.value;aX=aB.getNodeAndColumnInfos(aY.nodeModel,this.options.columns[aY.virtualColumnID]);if(!aB.doesAttributeExist(aX.objectToBeModified,aX.dataIndex)||!aX.objectToBeModified.hasChanged()){return}if(!aE.is(aW)){aW=""}aT=aB.getValueAsArray(aW);if(aB.isMultiDate(aX.attributeInfo)){for(aU=0;aU<aT.length;aU++){aV=new Date(aT[aU]);if(!isNaN(aV.getTime())){aT[aU]=Math.floor(aV.getTime()/1000)}else{av.AlertManager.add({className:"error",message:h.getNLSValue("TableView.InvalidDateMessage",{date:aT[aU]})});aY.manager.updateCellView(aY.nodeModel,aY.virtualColumnID);return}}}aY.nodeModel.options.grid[aY.dataIndex]=aW;aY.manager.updateRowViewWithException(aY.nodeModel,aY.dataIndex);aB.saveValue(av.AlertManager,aX.objectToBeModified,null,aX.dataIndex,aT,aX.attributeNLSTitle,aX.attributeName,aX.instOrRef,aX.attributeInfo,aX.attributeDef)},100,true),_getMultivalue:function an(aT){return aT.nodeModel.options.grid[aT.dataIndex]},_buildDOM:function ae(){var aU,aT;this.createUIContainer();this.buildProgressBarContainer();aT={workbench:"DELWebMfgAssetsDefUI.xml",workbenchModule:"DELWebMfgAssetsDefUI",viewer:"none",width:"100%",context:aN.getActionBarContext(),language:widget.lang};this._frameWindow=new r(aT);aU={kinetic:false,views:[{content:{iframe:false},styles:{overflow:"hidden"},title:"Table"},{content:{iframe:false},styles:{overflow:"hidden"},title:"Graph"}],showPager:false};this._slidingViews=new az(aU);this._slidingViews.getContent().addClassName("DEL-MGA-bottomBloc");this.createLinkViewTypeFilter();this.createAuxiliaryViewDom();this._leftBlocContainer=aE.createElement("div",{"class":"leftBloc-container"});this._rightBlocContainer=aE.createElement("div",{"class":"rightBloc-container"});this._bottomBlocContainer=aE.createElement("div",{"class":"bottomBloc-container"});this._graphViewContainer=aE.createElement("div",{"class":"graphView-container"});this._mainBlocLayout=new y({minSize:"250px",rows:[{columns:2}]});this._innerBlocLayout=new y({rows:[{columns:2},{columns:1}]})},createAuxiliaryViewDom:function G(){var aU,aY,aX,aT,aW,aV;aU=new aE.Controls.Segmented({multiSelect:true,data:{PART:{text:h.getNLSValue("PPRTYPE.PART")},PRODUCT:{text:h.getNLSValue("PPRTYPE.PRODUCT")},PROCESS:{text:h.getNLSValue("PPRTYPE.PROCESS")},SYSTEM:{text:h.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{text:h.getNLSValue("PPRTYPE.RESOURCE")}}});aY=h.getIconFromKey("Part");aU.setItemTitle("PART",aY.elements.image);aX=h.getIconFromKey("Product");aU.setItemTitle("PRODUCT",aX.elements.image);aT=h.getIconFromKey("Process");aU.setItemTitle("PROCESS",aT.elements.image);aW=h.getIconFromKey("System");aU.setItemTitle("SYSTEM",aW.elements.image);aV=h.getIconFromKey("Resource");aU.setItemTitle("RESOURCE",aV.elements.image);aU.selectItem("PART");aU.selectItem("PRODUCT");aU.selectItem("PROCESS");aU.selectItem("SYSTEM");aU.selectItem("RESOURCE");this._auxiliaryViewTypeFilter=aU;this._auxiliaryViewToolBar=aE.createElement("div",{"class":"auxiliaryView-toolbar"});this._auxiliaryBlocContainer=aE.createElement("div",{"class":"auxiliaryBloc-container"});this._auxiliaryViewContainer=aE.createElement("div",{"class":"auxiliaryView-container"})},createLinkViewTypeFilter:function s(){var aT=h.getIconFromKey("Product"),aV=h.getIconFromKey("Process"),a2=h.getIconFromKey("System"),aW=h.getIconFromKey("Resource"),a1=h.getIconFromKey("Part"),aZ=h.getIconFromKey("CreateInstance"),aY,a0,aX,aU=(widget.getValue("showRequirementsInRelationPanel")==="true")?true:false;aX={PART:{text:h.getNLSValue("PPRTYPE.PART")},PRODUCT:{text:h.getNLSValue("PPRTYPE.PRODUCT")},PROCESS:{text:h.getNLSValue("PPRTYPE.PROCESS")},SYSTEM:{text:h.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{text:h.getNLSValue("PPRTYPE.RESOURCE")},PARENT:{text:h.getNLSValue("PPRTYPE.PARENT")}};if(aU){aY=h.getIconFromKey("Requirement");aX.REQUIREMENT={text:h.getNLSValue("PPRTYPE.REQUIREMENT")}}a0=new aE.Controls.Segmented({multiSelect:true,data:aX});a0.setItemTitle("PRODUCT",aE.clone(aT.elements.image));a0.setItemTitle("PROCESS",aE.clone(aV.elements.image));a0.setItemTitle("SYSTEM",aE.clone(a2.elements.image));a0.setItemTitle("RESOURCE",aE.clone(aW.elements.image));a0.setItemTitle("PART",aE.clone(a1.elements.image));a0.setItemTitle("PARENT",aE.clone(aZ.elements.image));if(aU){a0.setItemTitle("REQUIREMENT",aE.clone(aY.elements.image))}a0.selectItem("PRODUCT");a0.selectItem("PROCESS");a0.selectItem("SYSTEM");a0.selectItem("RESOURCE");a0.selectItem("PART");this._linkViewTypeFilter=a0;this._linkViewToolBar=aE.createElement("div",{"class":"linkView-toolbar"});this._linkViewTypeFilter.inject(this._linkViewToolBar);return a0},createInnerBlocLayout:function J(aT){this._innerBlocLayout=new y(aT);return this._innerBlocLayout},createMainBlocLayout:function Z(aT){this._mainBlocLayout=new y(aT);return this._mainBlocLayout},createUIContainer:function aM(){this._UIContainer=new aE.Element("div",{"class":"ui-container"});return this._UIContainer},buildProgressBarContainer:function aI(){this._progressBarIndicatorContainer=aE.createElement("div",{"class":"appProgressInd-container"}).inject(this._UIContainer);return this._progressBarIndicatorContainer},createTableViewDockingElement:function t(){var aT=new aE.Element("div",{"class":"tableView-drop-zone",styles:{height:"100%",width:"100%","background-color":"#f1f1f1"}}),aU=new ay({side:WUXDockAreaEnum.BottomDockArea,dockingZoneContent:aT,dockingZoneSize:50,collapseDockingZoneFlag:true,visibleDockingZoneFlag:false,collapsibleFlag:false,resizableFlag:false});aT.addEventListener("dragenter",function(){aT.setStyle("border","#79A7E2 solid 1px")});aT.addEventListener("dragleave",function(){aT.setStyle("border","none")});return aU},_buildView:function aR(){var aT=this;this._bottomBlocDockContainer=new ay({dockingZoneContent:this._bottomBlocContainer,dockingZoneSize:((widget.getViewportDimensions().height)/2),collapseDockingZoneFlag:false,visibleDockingZoneFlag:true,collapsibleFlag:false,resizableFlag:false});widget.addEvent("resizeBottomDock",function(aV){var aU=aV.height-1;if(aT._bottomBlocDockContainer.dockingZoneSize!==aU){aT._bottomBlocDockContainer.dockingZoneSize=aU}});this._tableViewDockingElement=this.createTableViewDockingElement();this._tableViewDockingElement.freeZoneContent=this._bottomBlocDockContainer;this._tableViewDockingElement.inject(this._slidingViews.getView(0));this._graphViewContainer.inject(this._slidingViews.getView(1));this._linkViewTypeFilter.inject(this._linkViewToolBar);this._auxiliaryViewTypeFilter.inject(this._auxiliaryViewToolBar);this._auxiliaryViewToolBar.inject(this._auxiliaryBlocContainer);this._auxiliaryViewContainer.inject(this._auxiliaryBlocContainer);this._innerBlocLayout.setColumnContent(0,0,this._leftBlocContainer);this._innerBlocLayout.setColumnContent(0,1,this._rightBlocContainer);this._innerBlocLayout.setColumnContent(1,0,this._slidingViews.getContent());this._mainBlocLayout.setColumnContent(0,0,this._auxiliaryBlocContainer);this._mainBlocLayout.setColumnContent(0,1,this._innerBlocLayout.getContent());this._mainBlocLayout.inject(this._frameWindow.getUIFrame());this._frameWindow.inject(this._UIContainer)},_showAuxView:function ai(aV){var aT,aU;if(aE.is(aV)&&aE.is(aV.PPRType)){if(aV.PPRType==="OPERATION"){aV.PPRType="SYSTEM"}aU=this.getMGAElement("AuxiliaryViewTypeFilter");if(!aU.isSelected(aV.PPRType)){aU.selectItem(aV.PPRType)}}aT=this.CommandsCheckHeaderManager.getCmd("showAuxiliaryView");if(!aT.getState()){aT.toggleState()}},getPopUpMaxHeight:function ax(){var aT=this.getHeight()-150;return(aT>400)?aT:400},buildContextualMenuNodes:function Q(aU,aV,a2,a1,aT,aZ,a0){var a3=this,aX,aW,aY=[];a1=a1||"Cmd";aT=aT||"Title";if(!aE.is(aV)){av._logger.warn("No context given");return null}if(!aE.is(aU,"array")){av._logger.warn("Nodes should be an array");return null}aU.forEach(function(a4){aW="enabled";if(!aE.is(a4,"string")){av._logger.warn("Nodes should be an array of string");return}if(aE.is(a4)){if(a4==="EditAttribute"){if(aB.isReadOnly(a2.infos.attributeInfo,a2.infos.attributeDef)){aW="disabled"}}else{aX=ap.getCommand(a4,aN.getActionBarContext());if(!aE.is(aX)){aX=a3.CommandsCheckHeaderManager.getCmd(a4)}if(aE.is(aX)){if(aX.isEnabled()){aW="enabled"}else{aW="disabled"}}}}aY.push({icon:"url("+h.getIconURLFromKey(a4,aZ,a0)+")",label:h.getNLSValue(a4,null,a1,aT),sensitivity:aW,callback:function(){var a5;if(a4==="EditAttribute"){M.editAttribute(av.AlertManager,a2);return}a5=ap.getCommand(a4,aV);if(aE.is(a5)){a5.beginExecute(a2);a5.execute();a5.endExecute()}else{a5=a3.CommandsCheckHeaderManager.getCmd(a4);a5.toggleState()}}})},this);return aY},buildContextualMenu:function N(aT,aV,aW){var aU=this.buildContextualMenuNodes(aT,aV);u.onReady({target:aW,nodes:aU})},getDefaultContextualMenu:function at(){return["showAuxiliaryView","BottomBlock","LeftBlock","RightBlock"]},getLabelValue:function j(aT){var aU="V_Name",aV=this.getMGAElement("TableUI");if(aT.isInstance()){if(aV._labelIsOnRef===false){aU=aV._label}}else{if(aT.isReference()){if(aV._labelIsOnRef===true){aU=aV._label}}}return aT.get(aU)},CommandsCheckHeaderManager:aH.singleton({init:function ad(){this._cmds={}},registerCmd:function aC(aT,aU){this._cmds[aT]=aU},getCmd:function ar(aT){var aU;if(this._cmds.hasOwnProperty(aT)){aU=this._cmds[aT]}return aU},getAllCommands:function aD(){return this._cmds}}),BlocksViewCmdManager:aH.singleton({init:function ad(){this._cmdMap={}},registerCmdState:function F(aT,aU){this._cmdMap[aT]=aU},getActiveCmdNames:function X(aV){var aW,aT=[],aU=aV||"";for(aW in this._cmdMap){if(this._cmdMap[aW]){if(aW!==aU){aT.push(aW)}}}return aT}}),refreshWidget:function P(a0){var a3=av.getMGAElement("LeftUI"),a8=av.getMGAElement("RightUI"),aX=av.getMGAElement("TableUI"),aT=av.getMGAElement("TreeUI"),ba=null,a4=[],aW=[],a1=[],a9=0,aV=0,aZ=a0||{},a5=aE.is(aZ.onComplete)?aZ.onComplete:null,a2=aE.is(aZ.context)?aZ.context:null,a6=H.getNextIndex(),bb=function bb(){var bc=h.getNLSValue("onRefresh.RootsRefreshed");if(aE.is(a5,"function")){a5.call(a2,a1,aW,a4)}av.AlertManager.add({className:"success",message:bc});H.logCompleted(a6,bc)},aY=function aY(){var bc,be;if(aE.is(ba)&&aE.is(ba.missingRefModel,"array")&&(ba.missingRefModel.length>0)){ba.missingRefModel.forEach(function bd(bf){var bg=aE.is(be)?",":"";be=bg+bf.get("V_Name")});bc=h.getNLSValue("onRefresh.RootsRefreshedIssueWithName",{nameList:be})}else{bc=h.getNLSValue("onRefresh.RootsRefreshedIssue")}if(aE.is(a5,"function")){a5.call(a2,a1,aW,a4)}av.AlertManager.add({className:"warning",message:bc});H.logCompleted(a6,bc)},aU=function aU(bi,be){var bg,bh=function bh(bk,bj){aV++;if(aE.is(bj)&&!A.shouldLoadRootOnly()){if(!bj.isExpanded()){bj.expand()}}if(aV===a9){bi()}},bd=function bd(){be()},bf=function bf(){be()},bc=function bc(bj){av.addToTreeList(W.getReferenceFromCollection(bj),bg)};if(a9!==0){if("MFN"===av._widgetTrigram){bg={onFailure:bd,onEndLoading:bh,withLinksResolved:true,elementUI:"LeftUI",displayMdlRootAttr:"asRootInBodyView"};a1.forEach(bc)}bg={onFailure:bd,onTimeout:bf,onEndLoading:bh,withLinksResolved:true,elementUI:"TableUI",displayMdlRootAttr:"asRootInTableView"};a4.forEach(bc);bg={onFailure:bd,onTimeout:bf,onEndLoading:bh,withLinksResolved:false,elementUI:"TreeUI",displayMdlRootAttr:"asRootInAuxiliaryView"};aW.forEach(bc)}else{bi()}},a7=function a7(bc){ba=bc;new Promise(aU).then(bb,aY)};H.logStarted(a6,h.getNLSValue("onRefresh.RefreshLogMsg"));if(aE.is(a3)&&aE.is(a3.utils)){a1=a3.utils.emptyTreeList();if("MGA"===av._widgetTrigram){a1=[]}}if(aE.is(a8)&&aE.is(a8.utils)){a8.utils.emptyTreeList()}if(aE.is(aX)&&aE.is(aX.utils)){a4=aX.utils.emptyTreeList()}if(aE.is(aT)&&aE.is(aT.utils)){aW=aT.utils.emptyTreeList()}a9=a1.length+a4.length+aW.length;W.refreshAll(a1,a4,aW,{onComplete:a7,context:this})},getEditionManager:function q(){return{isEditable:true}},updateWidgetTitle:function k(){var a2,a4,a5,aX,a1,a0,aV,aU,aT,a3=[],aZ=widget.getValue("showCollaborativeSpace"),aW=widget.getValue("showRole"),aY=widget.getValue("showOrg");aV=widget.getValue("organization");a2=widget.getValue("collaborativeSpace");aX=widget.getValue("role");if(aY==="true"){v.getOrganization().forEach(function(a6){if(aV===a6.value){aT=a6.label}});aU=h.getNLSValue("Preferences.Org");a3.push(aU+aT)}if(aZ==="true"){v.getCollabSpace(aV).forEach(function(a6){if(a2===a6.value){a5=a6.label}});a4=h.getNLSValue("Preferences.CollabSpace");a3.push(a4+a5)}if(aW==="true"){v.getRole(aV,a2).forEach(function(a6){if(aX===a6.value){a0=a6.label}});a1=h.getNLSValue("Preferences.Role");a3.push(a1+a0)}widget.setTitle(a3.join(", "))},emptySelection:function aq(aU){var aW=[aE.is(av.getMGAElement("TableUI"))?av.getMGAElement("TableUI").getDocument().getXSO():null,aE.is(av.getMGAElement("TreeUI"))?av.getMGAElement("TreeUI").getDocument().getXSO():null,aE.is(av.getMGAElement("LeftUI"))?av.getMGAElement("LeftUI").getDocument().getXSO():null,aE.is(av.getMGAElement("RightUI"))?av.getMGAElement("RightUI").getDocument().getXSO():null],aV=aU||{},aX=aE.is(aV.silent)?!aV.silent:true;aW.forEach(function aT(aY){if(aE.is(aY)){aY.empty(aX)}})},addSelectedNode:function V(aU,aT){if(aE.is(aT)){aU.empty();h.getIconFromKey(aT.getReferenceType()).inject(aU);new aE.Element("div",{"class":"CreateUpdateMfgSubLabelDiv",html:aT.getLabel()}).inject(aU);new aE.Element("div",{"class":"CreateUpdateMfgSubRevisionDiv",html:aT.options.grid["revision.reference"]}).inject(aU)}},createTitleSectionInDialog:function D(aU,aX,aW){var aV,aT;aV=new aE.Element("div",{"class":"row",html:"<h5>"+h.getNLSValue(aU)+"</h5>"});aV.inject(aX);aT=new aE.Element("div",{"class":"row TNRInfo"});if(aE.is(aW)){aT=new aE.Element("div",{"class":"product-revision-list-container",})}aT.inject(aX);return aT},});return av});define("DS/DELWebMfgAssetsDefUIServices/CommandsManager",["UWA/Core","DS/Logger/Logger","DS/ApplicationFrame/CommandsManager","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefModelServices/CollectionUtils"],function(j,A,e,z,r,i,f,o){var d=j.Class.singleton({name:"CommandsManager",_logger:null,init:function u(C){this._parent(C);if(j.is(A)){this._logger=A.getLogger(d)}this._validChildTypesMap=[];this._typeCommandMap=[];this._isInitialized=false},initialize:function c(){var F=e.getCommands(f.getActionBarContext()),D=null,E,I,C,H,J,G=this;for(E in F){if(j.is(E)){I=e.getCommand(E,f.getActionBarContext());if(j.is(I)){C=I.getArguments();if(j.typeOf(C)==="array"){if(C.length>0){J=C[0];if(j.is(J)){if(j.is(J.ID)){if(J.ID==="ReferenceType"){if(j.is(J.Value)){D=J.Value}}}}}}if(j.is(D)){this._typeCommandMap[D.split("/")[1]]=E;D=null}}}}this.manageCommandsAvailability();this.onGetChildTypesComplete=function(K){d._validChildTypesMap=K;d._isInitialized=true;G._processCustomInstanceConfig();widget.dispatchEvent("DELWebMfgAssetsDefUI/endLoadingWidget")};H=widget.getValue("oneDelmiaAggregationMode");i.webServiceRequest({url:"modeler/ppr/getChildTypes",method:"GET",data:{oneDelmiaAggregationMode:H},onComplete:this.onGetChildTypesComplete})},isInitialized:function(){return this._isInitialized},setCreateCommandsState:function(D){var C,E,F;for(C in this._typeCommandMap){if(j.is(C)){E=this._typeCommandMap[C];F=e.getCommand(E,f.getActionBarContext());if(j.is(F)){if(D){F.enable()}else{F.disable()}}}}},enableCreationCommandsByType:function t(C,D,E){if(("TableView"===E)||(("AuxView"===E)&&("PROCESS"===D||"RESOURCE"===D))||(("LeftView"===E)&&("PROCESS"===D||"RESOURCE"===D))||(("RightView"===E)&&("PROCESS"===D||"RESOURCE"===D))){C.forEach(function(G){var F=d._typeCommandMap[G],H=e.getCommand(F,f.getActionBarContext());if(j.is(H)){H.enable()}})}},_processCustomInstanceConfig:function p(){var I,H,F,C,G,E,D=r.CustomInstanceList;if(j.is(D)){for(I in D){if(D.hasOwnProperty(I)){for(H in D[I]){if(D[I].hasOwnProperty(H)){F=D[I][H];G=d._validChildTypesMap;E=d._validChildTypesMap[I];if(j.is(E)){C=E.indexOf(H);if(C>=0){if(!F){E.splice(C,1)}}else{if(F){E.push(H)}}}else{if(F){G[I]=[H]}}}}}}}},setCommandState:function b(C,E){var D;if(j.is(C)){D=e.getCommand(C,f.getActionBarContext());if(!j.is(D)){D=e.getCommandCheckHeader(C,f.getActionBarContext())}if(j.is(D)){if("Refresh"!==C||z.getRefreshCmdAvailability()){if(E){D.enable()}else{D.disable()}}}else{if(j.is(d._logger)){d._logger.log("disableCommand, unknown command: "+C)}}}else{if(j.is(d._logger)){d._logger.log("disableCommand, no command in input !!!")}}},_setEffectivityCmdState:function y(C,E){var D=E;if(D===true){if(j.is(window)&&j.is(window.cfgCmdWidgetData)&&j.is(window.cfgCmdWidgetData._isDecouplingActivated,"boolean")){if(window.cfgCmdWidgetData._isDecouplingActivated===false){D=false}}else{D=false}}this.setCommandState(C,D)},disableActionPanel:function v(){d.setCheckCommandState("AlternateCommand",false);d.setCheckCommandState("OriginCommand",false);d.setCheckCommandState("CapableResourceCommand",false)},setCheckCommandState:function m(C,E){var D;if(j.is(C)){D=e.getCommandCheckHeader(C,f.getActionBarContext());if(j.is(D)&&j.is(E,"boolean")){D.setState(E)}}},noItemSelected:function s(){var C=false;d.setCommandState("CapableResourceBL",C);d.setCommandState("Hide",C);d.setCommandState("Remove",C);d.setCommandState("Delete",C);d.setCommandState("DeleteHdr",C);d.setCommandState("DuplicateHdr",C);d.setCommandState("DuplicateAdv",C);d.setCommandState("MaturityHdr",C);d.setCommandState("RevisionHdr",C);d.setCommandState("HistoryHdr",C);d.setCommandState("createInstance",C);d.setCommandState("InsertInstance",C);d.setCommandState("PPRReplaceByLatestRevision",C);d.setCommandState("PPRReplaceByExistingRevision",C);d.setCommandState("createLink",C);d.setCommandState("Relations",C);d.setCommandState("AttachDocument",C);d.setCommandState("SearchDocument",C);d.setCommandState("ManageDocuments",C);d.setCommandState("ActionBar_Attributes",C);d.setCommandState("ActionBar_ChangeOwner",C);d.setCommandState("ShowCharacteristicsCmd",C);d.setCommandState("ShowConsolidatedCharactscsCmd",C);d.setCommandState("Refresh",C);d.setCommandState("ExploreInWebApp",C);d.setCommandState("ProductFlowCmd",C);d.setCreateCommandsState(true)},oneItemSelected:function w(G){var H=G.type,F=true,D,E,C;d.setCommandState("Remove",o.getSelectedInsts().length!==0);d.setCommandState("CapableResourceBL",F);d.setCommandState("Delete",F);d.setCommandState("DeleteHdr",F);d.setCommandState("DuplicateHdr",F);d.setCommandState("DuplicateAdv",F);d.setCommandState("MaturityHdr",F);d.setCommandState("RevisionHdr",F);d.setCommandState("HistoryHdr",F);d.setCommandState("InsertInstance",F);d.setCommandState("PPRReplaceByLatestRevision",F);d.setCommandState("PPRReplaceByExistingRevision",F);d.setCommandState("Relations",F);d.setCommandState("AttachDocument",F);d.setCommandState("SearchDocument",F);d.setCommandState("ManageDocuments",G.documentCount!==0);d.setCommandState("ActionBar_Attributes",F);d.setCommandState("ActionBar_ChangeOwner",F);d.setCommandState("ShowCharacteristicsCmd",F);d.setCommandState("ShowConsolidatedCharactscsCmd",F);d.setCommandState("Refresh",F);d.setCommandState("ExploreInWebApp",F);d.setCommandState("ProductFlowCmd",F);d.setCommandState("createInstance",false);d.setCommandState("createLink",false);d.setCreateCommandsState(false);D=d._validChildTypesMap[H];if(j.is(D)){d.enableCreationCommandsByType(D,G.PPRType,G.from)}else{C=function(I){D=I[H];d._validChildTypesMap[H]=D;d.enableCreationCommandsByType(D,G.PPRType,G.from)};E=widget.getValue("oneDelmiaAggregationMode");i.webServiceRequest({url:"modeler/ppr/getChildTypes",method:"GET",data:{type:H,pprtype:G.PPRType,oneDelmiaAggregationMode:E},onComplete:C})}},severalItemsSelected:function q(C){var D=false;d.setCommandState("CapableResourceBL",D);d.setCommandState("Remove",o.getSelectedInsts().length!==0);d.setCommandState("Delete",true);d.setCommandState("DeleteHdr",D);d.setCommandState("DuplicateHdr",D);d.setCommandState("DuplicateAdv",D);d.setCommandState("MaturityHdr",true);d.setCommandState("RevisionHdr",true);d.setCommandState("HistoryHdr",D);d.setCommandState("createInstance",D);d.setCommandState("InsertInstance",D);d.setCommandState("PPRReplaceByLatestRevision",D);d.setCommandState("PPRReplaceByExistingRevision",D);d.setCommandState("createLink",D);d.setCommandState("Relations",D);d.setCommandState("AttachDocument",D);d.setCommandState("SearchDocument",D);d.setCommandState("ManageDocuments",D);d.setCommandState("ActionBar_Attributes",D);d.setCommandState("ActionBar_ChangeOwner",true);d.setCommandState("ShowCharacteristicsCmd",D);d.setCommandState("ShowConsolidatedCharactscsCmd",D);d.setCommandState("ProductFlowCmd",D);d.setCommandState("Refresh",true);d.setCommandState("ExploreInWebApp",D);d.setCommandState("DefineFilter",D);d.setCommandState("EditConfigurationContext",D);d.setCommandState("EditVariant",D);d.setCommandState("EditEvolution",D);d.setCreateCommandsState(D);if(j.is(C)){if(this.isLinkPossible(C.fromReference,C.toReference,C.fromInstance,C.toInstance)){d.setCommandState("createLink",true)}if(this.isInstancePossible(C.fromReference,C.toReference)){d.setCommandState("createInstance",true)}}},manageCommandsAvailability:function n(){var K=j.is(z.getMGAElement("TableUI"))?z.getMGAElement("TableUI").getDocument().getXSO().get():[],H=j.is(z.getMGAElement("TreeUI"))?z.getMGAElement("TreeUI").getDocument().getXSO().get():[],L=j.is(z.getMGAElement("LeftUI"))?z.getMGAElement("LeftUI").getDocument().getXSO().get():[],I=j.is(z.getMGAElement("RightUI"))?z.getMGAElement("RightUI").getDocument().getXSO().get():[],F=K.length+H.length+L.length+I.length,D=false,M,G,J,E,C;if(!j.is(z.getMGAElement("TableUI"))||!j.is(z.getMGAElement("TreeUI"))){return}if(0===F){d.noItemSelected()}else{D=K.some(function(N){return N.isRoot()});if(!D){D=H.some(function(N){return N.isRoot()})}if(!D){D=L.some(function(N){return N.isRoot()})}if(!D){D=I.some(function(N){return N.isRoot()})}if(D){d.setCommandState("Hide",true)}if(1===F){if(1===K.length){G=K[0];C="TableView"}else{if(1===L.length){G=L[0];C="LeftView"}else{if(1===I.length){G=I[0];C="RightView"}else{G=H[0];C="AuxView"}}}J=o.references.get(G.getReferencePID());if(j.is(J)){E={documentCount:j.is(J.getDisplayModelAttr("documentIDList"),"array")?J.getDisplayModelAttr("documentIDList").length:0,type:J.get("type"),from:C,PPRType:J.get("PPRTYPE")};d.oneItemSelected(E);d._manageConfigurationCommands(D,H.length,C)}}else{M=this.getSelectedObjectsForLinkCreation();d.severalItemsSelected(M)}}},_manageConfigurationCommands:function g(F,C,E){var H=(C>0),D=(E==="TableView"),G=(!H&&D);d.setCommandState("DefineFilter",(F&&G));d.setCommandState("EditConfigurationContext",G);d._setEffectivityCmdState("EditVariant",(!F&&G));d._setEffectivityCmdState("EditEvolution",(!F&&G))},getPossibleRelationTypes:function x(G,M,N,H){var J=j.is(G)?G.get("PPRTYPE"):null,F=j.is(G)?G.get("type"):null,D=j.is(M)?M.get("PPRTYPE"):null,O=j.is(M)?M.get("type"):null,C,I,E=[],K,L;if(!J||!D||!F||!O){this._logger.warn("No PPRTypes on models");return E}L=r.CustomRelationsList;if(j.is(L)&&j.is(L[F])&&j.is(L[F][O])){I=L[F][O]}else{C=r.RelationsList[J];I=C[D]}E=o.getRelationTypes(I,"write");if(!j.is(H)||!j.is(N)){K=E.indexOf("DELLmiMaterialPathCnxCust");if(K>-1){E.splice(K,1)}K=E.indexOf("DELLmiMaterialPathCnxCust_inverse");if(K>-1){E.splice(K,1)}K=E.indexOf("DELLmiTimeConstraintCnx");if(K>-1){E.splice(K,1)}K=E.indexOf("DELLmiTimeConstraintCnx_inverse");if(K>-1){E.splice(K,1)}}return E},isLinkPossible:function l(G,F,D,H){var C=this.getPossibleRelationTypes(G,F,D,H),E=this.getPossibleRelationTypes(F,G,H,D);return(C.length>0)||(E.length>0)},isInstancePossible:function B(G,F){var D=false,E=j.is(G)?(d._validChildTypesMap[G.get("type")]):null,C=function C(H,K){var J,M,I,L;if(K.id!==H.id){J=o.getInstancesOfReference(K.id);for(L=0;L<J.length;L++){M=J[L];I=o.getAggregatingReferenceModelFromInstance(M);if(C(H,I)){return true}}return false}else{return true}};if(j.is(E)&&E.indexOf(F.get("type"))>=0&&!C(F,G)){D=true}return D},getSelectedObjectsForLinkCreation:function a(H){var C=o.getSelectedRefs(),M=o.getSelectedInsts(),I="selectedInAuxiliaryView",G,F,K,J,N,L,E=[],P=null,O=function O(Q){var S=Q.fromReference,R=Q.fromInstance;Q.fromReference=Q.toReference;Q.fromInstance=Q.toInstance;Q.toReference=S;Q.toInstance=R},D=function D(W,V){var U=false,S="",T="selectedInTableView",R=function R(X){if(""===S){if(W.getDisplayModelAttr(X)&&V.getDisplayModelAttr(X)){S=T}}},Q=function Q(ab){var Z,aa=0,Y,X=0;Z=z.getMGAElement(ab).utils.search(W.id);Y=z.getMGAElement(ab).utils.search(V.id);if(j.is(Z,"array")&&(Z.length>0)){aa=Z[0]._getRowID()}if(j.is(Y,"array")&&(Y.length>0)){X=Y[0]._getRowID()}if(j.is(aa,"number")&&j.is(X,"number")){if(aa>X){U=true}}};R(T);switch(S){case T:Q("TableUI");break;default:break}return U};if(j.is(C,"array")){if(C.length===2){P={fromReference:C[0],toReference:C[1],};if(M.length===2){P.fromInstance=(P.fromReference.id===M[0].get("isInstanceOf"))?M[0]:M[1];P.toInstance=(P.toReference.id===M[1].get("isInstanceOf"))?M[1]:M[0]}N=P.fromReference.getDisplayModelAttr(I);L=P.toReference.getDisplayModelAttr(I);if(N!==L){if(N){O(P)}}else{if(N&&L){if(P.fromReference.isResource()&&P.toReference.isProcess()){O(P)}}else{if(D(P.fromReference,P.toReference)){O(P)}}}}}if(H){G=z.getMGAElement("TableUI");E=G.getDocument().getSelectedNodes();F=z.getMGAElement("LeftUI");E=E.concat(F.getDocument().getSelectedNodes());K=z.getMGAElement("RightUI");E=E.concat(K.getDocument().getSelectedNodes());J=z.getMGAElement("TreeUI");E=E.concat(J.getDocument().getSelectedNodes());E.forEach(function(Q){if(Q.getReferencePID()===P.fromReference.id){P.fromAbsolutePath=Q.getAbsolutePath()}else{if(Q.getReferencePID()===P.toReference.id){P.toAbsolutePath=Q.getAbsolutePath()}}})}return P},changeDocCmdAvailability:function k(E,G,D){var F=D.getDocument().getXSO().get(),C;if(F.length===1){C=F[0].getReferencePID();if(C===E.get("irpcID")){if(G.where({irpcID:C}).length>0){d.setCommandState("ManageDocuments",true)}else{d.setCommandState("ManageDocuments",false)}}}},getValidChildTypesForParentType:function h(C){return this._validChildTypesMap[C]}});return d});define("DS/DELWebMfgAssetsDefUIServices/CrossHighlighting",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Date","DS/PlatformAPI/PlatformAPI","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefUIServices/Viewer3DUtil"],function(e,t,c,u,a,m,w,b,y){var s=t.singleton(c,{name:"CrossHighlight",init:function r(A){this._parent(A);this.inProgress=false;this.previousListView=null;this.highlightListCount={};this.viewer3DPath={attributes:{},paths:[],};this.widgetTrigram=b.getWidgetTrigram();this.viewer3DUtil=y.getInstance();this.listenTo(m.connections,"onAdd",this._onConnectionAdd);this.listenTo(m.connections,"onRemove",this._onConnectionRemove);widget.addEvent("onRefresh",this.onRefresh)},_onConnectionChange:function v(E,C){var G,D,A=this.highlightListCount,B={},I=[w.getMGAElement("TableUI"),w.getMGAElement("LeftUI"),w.getMGAElement("RightUI")],F=true,H=[];if(E.get("type").indexOf("ProductImplementLinkOcc")!==-1){F=false}H=this._getSelectedNodeIds(F);if(H.indexOf(E.get("from"))>-1){D=E.get("to").toString()}else{if(H.indexOf(E.get("to"))>-1){D=E.get("from")}else{return}}if(e.is(C)){if(C){if(A.hasOwnProperty(D)){A[D]++}else{A[D]=1;B[D]=C}}else{if(A.hasOwnProperty(D)){if(A[D]===1){delete A[D];B[D]=C}else{A[D]--}}}}for(G=0;G<I.length;G++){if(e.is(I[G])){if(F){this._handleReferenceCrossHighlight(I[G],B)}else{this._handleOccurrenceCrossHighLight(I[G],B)}}}},_onConnectionAdd:function j(A){this._onConnectionChange(A,true)},_onConnectionRemove:function l(A){this._onConnectionChange(A,false)},_getSelectedNodeIds:function f(C){var B,A=[],D=C?m.getSelectedRefs():m.getSelectedInsts();for(B=0;B<D.length;B++){A[B]=D[B].id}return A},onRefresh:function o(){s.previousListView=null;s.highlightListCount={}},execute:function i(D,C,H,A,B){var E=0,G={},I={},K=[w.getMGAElement("TableUI"),w.getMGAElement("LeftUI"),w.getMGAElement("RightUI")],J={data:{attributes:{},paths:[]}};e.merge(J,m._get3DViewerMetadatas());if(this.inProgress){return}this.inProgress=true;try{this._updateListBasedOnSelectedModel(G,I,C,H,A,B);this._updateListBasedOnPreviousSelectedModels(G,I,D);if(H.isProduct()||H.isPart()){J.data=this._buildEBOMCrossHighlightingPath(D)}else{J.data=this._buildMBOMCrossHighlightingPath(D)}a.publish("DS/PADUtils/PADCommandProxy/select",J);for(E=0;E<K.length;E++){if(e.is(K[E])){this._handleReferenceCrossHighlight(K[E],G);this._handleOccurrenceCrossHighLight(K[E],I)}}this._postCrossHighlightSelection(G,I,D);this.previousListView=D;this.inProgress=false}catch(F){this.inProgress=false}},_buildEBOMCrossHighlightingPath:function g(A){var B=A.getDocument().getSelectedNodes();return this.viewer3DUtil.compute3DViewerPathFromEBOM(B)},_buildMBOMCrossHighlightingPath:function n(A){var B,C=A.getDocument().getSelectedNodes(),D=[];for(B=0;B<C.length;B++){if(!C[B].isRoot()&&!C[B].isImplemented()&&C[B].hasChildren()){C=C.concat(C[B].getChildren())}else{D.push(C[B])}}return this.viewer3DUtil.compute3DViewerPathFromMBOM(D)},_updateListBasedOnSelectedModel:function x(H,M,E,L,A,C){var F=E.getReferencePID(),I=m.getImpactedConnections(F),N,B=L.get("PPRTYPE"),K,J,D,G;if(e.is(A)){K=(this.widgetTrigram==="MFN"&&B==="PRODUCT");J=(this.widgetTrigram==="MGA"&&B==="PROCESS");if(K||J){N=E.getPathToScope()}else{N=E.getInstancePID()}G=this._getImpactedInstConnAttributes(E,N);if(e.is(G)&&G.length>0){I=m.getScopeLinksInGivenRefConns(I)}}D=m.extractAttributesFromConnections(I);this._updateHighlightListCount(H,D,F,C);this._updateHighlightListCount(M,G,N,C)},_updateHighlightListCount:function q(B,H,F,E){var G=this.highlightListCount,D,A,C;if(!e.is(B)||!e.is(F)){return}if(G.hasOwnProperty(F)&&!E){B[F]=true}if(!e.is(H)){return}for(D=0;D<H.length;D++){if(e.is(H[D].from,"array")){C=H[D].from;C=C[C.length-1]}else{C=H[D].from}if(C===F){A=H[D].to.toString()}else{A=H[D].from}if(G.hasOwnProperty(A)){if(E){G[A]++}else{if(!E&&G[A]===1){delete G[A];B[A]=E}else{G[A]--}}}else{if(E){G[A]=1;B[A]=E}}}},_updateListBasedOnPreviousSelectedModels:function h(B,J,F){var G,C,D,H,I,E,A;if(e.is(this.previousListView)){if(this.previousListView!==F){C=this.previousListView.getDocument().getXSO().get();for(G=0;G<C.length;G++){D=C[G];H=D.getReferencePID();I=m.references.get(H);E=D.getInstancePID();if(e.is(E)){A=m.instances.get(E)}else{A=null}D.unselect();if(I){this._updateListBasedOnSelectedModel(B,J,D,I,A,false)}}}}},_getImpactedInstConnAttributes:function p(D,B){var A,C,F,E;C=m.getImpactedConnectionsOfInstance(B,D);A=m.extractAttributesFromConnections(C);if(e.is(B,"string")){F=D.getFirstParentWithAScopeNode();if(e.is(F)&&!F.isRoot()){E=F.getScopedNodeAbsolutePath();if(e.is(C)&&C.length>0&&(e.is(E))){A[0].to=E.concat(A[0].to)}}}return A},_handleReferenceCrossHighlight:function z(B,A){var D,C;for(D in A){if(A.hasOwnProperty(D)){C=m.references.get(D);if(A[D]){B.utils.highlight(C)}else{B.utils.unHighlight(C)}}}},_handleOccurrenceCrossHighLight:function k(C,A){var B,D;for(B in A){if(A.hasOwnProperty(B)){D=A[B];C.utils.handleOccCrossHighLight(B,D)}}},_postCrossHighlightSelection:function d(J,N,H){var F,A,C,I,E,O,M,L,B,K,D,G;A=H.getDocument().getXSO().get();for(F=0;F<A.length;F++){C=A[F];I=C.getReferencePID();if(e.is(J[I])){C.highlight()}E=C.getInstancePID();if(e.is(E)){K=m.references.get(I);B=K.get("PPRTYPE");M=(this.widgetTrigram==="MFN"&&B==="PRODUCT");L=(this.widgetTrigram==="MGA"&&B==="PROCESS");if(M||L){O=C.getPathToScope();D=C.getFirstParentWithAScopeNode();if(e.is(D)&&!D.isRoot()){G=D.getAbsolutePath();O=(e.is(G))?G.concat(E):E}}else{O=E}if(e.is(N[O])){C.highlight()}}}}});return s});define("DS/DELWebMfgAssetsDefUIServices/AbstractView",["UWA/Core","UWA/Class/View","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefModelServices/Selection","DS/DELWebMfgAssetsDefUIServices/CrossHighlighting","DS/DELWebMfgAssetsDefUIServices/CommandsManager","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIControls/Preferences"],function(g,p,j,o,c,i,b,t,s,e){var n=p.extend({name:"AbstractView",lastNode:{},treeListView:null,_handleEvents:function k(y,B){var E=this,x=g.is(this.treeListView)?this.treeListView:null,w=g.is(x)?x.getDocument().getXSO():null,v=B||{},C=g.is(v.isCrossHighlight)?v.isCrossHighlight:false,A=g.is(v.isManageCommandAvailability)?v.isManageCommandAvailability:false,z=g.is(v.isHandleSelection)?v.isHandleSelection:true,D=function D(J){var G=J.getReferencePID(),H=J.getInstancePID(),I=J.isSelected(),M=g.is(H)?H:G,F={},K=null,L=null;if(g.is(y,"string")&&g.is(I,"boolean")){F[y]=I}if(g.is(E.lastNode)){if((E.lastNode.id===M)&&(E.lastNode.isSelected===I)){return}}E.lastNode={id:M,isSelected:I};if(g.is(H,"string")&&(H!=="")){L=j.instances.get(H);if(g.is(L)){L.setDisplayModel(g.clone(F))}}if(g.is(G,"string")&&(G!=="")){K=j.references.get(G);if(g.is(K)){if(z){K.setDisplayModel(g.clone(F))}if(C){i.execute(x,J,K,L,I)}}}if(g.is(E._context)&&g.is(E._context.setFocus)){E._context.setFocus(x.utils.view)}c.selectionChanged(G,H,I);if(A){b.manageCommandsAvailability()}};if(g.is(w)){w.onChange(D)}},getAcceptedTypes:function q(){var x=this.options.acceptedTypes,w,v=[];return Object.keys(o.PPRTypes).filter(function(y){return(x.indexOf(o.PPRTypes[y])>-1)})},isAcceptedType:function l(v){var w="",x=this.options.acceptedTypes;if(g.is(v)){if(g.is(v.get)){w=v.get("PPRTYPE")}else{if(g.is(v.objectType)){w=o.PPRTypes[v.objectType]}else{v=j.references.get(v.referenceID);w=v.get("PPRTYPE")}}}return g.is(x)?(x.indexOf(w)!==-1):true},removeRootToPreferences:function h(A,w){var z,x,y="Default",v=e.getRootsPrefName();z=g.Json.decode(widget.getValue(v));if(z.hasOwnProperty(y)&&z[y].hasOwnProperty(w)){x=z[y][w];if(x.indexOf(A)!==-1){z[y][w].splice(x.indexOf(A),1)}}widget.setValue(v,g.Json.encode(z))},_loadStoredRoots:function m(x){var w=this,z={action:[],parameters:[]};if(g.is(x)){x.forEach(function(A,B){z.action[B]="addRoot";z.parameters[B]={rootReferencePID:A}});w.treeListView.utils.prepareUpdate();this._dragAndDropMgr.processDropEffect(z).then(function v(){w.treeListView.utils.pushUpdate()}).fail(function y(A){w.treeListView.utils.pushUpdate();w._logger.error("processDropEffect failed")})}},_getFilterRootNodes:function d(x){var v,z,w=this.treeListView.utils._treeDocument,y;v=w.getRoots();z=x.reduce(function(B,C){var A;A=Array.isArray(C)&&C.length>0?C[0]:C;if(!Array.isArray(A)){B.push(A)}return B},[]);y=v.filter(function(A){return z.indexOf(A.getReferencePID())!==-1});return y},_replaceChildrenAsPerFilter:function u(z,w,y){var v=this.treeListView.utils._treeDocument,x=this,A=w?{cvquery:y}:{supportPartiallyExpandedState:true};v.prepareUpdate();z.forEach(function(B){var D;B.removeChildren();D=j.getInstancesFromCollection(B.getReferencePID());B.setIsFiltered(w);D.forEach(function C(E){if(g.is(E)){x.treeListView.utils.addToTreeList(E,A)}});B.updateFilterBadge()});v.pushUpdate()},_onApplyFilter:function r(B){var y=g.is(B.cvquery)?B.cvquery:{},x=g.is(B.rootIds)?B.rootIds:[],v=this.treeListView.utils._treeDocument,z,A=g.is(B.numFilteredInNodes)?B.numFilteredInNodes:-1,w=true;if(x.length>0&&v){z=this._getFilterRootNodes(x);if(z.length>0){if(A===0){t.AlertManager.add({className:"info",message:s.getNLSValue("ExpandFilter.EmptyResult.Message")})}this._replaceChildrenAsPerFilter(z,w,y)}}},_onRemoveFilter:function f(z){var x=g.is(z.rootIds)?z.rootIds:[],v=this.treeListView.utils._treeDocument,y,w=false;if(x.length>0&&v){y=this._getFilterRootNodes(x);if(y.length>0){this._replaceChildrenAsPerFilter(y,w)}}},_reparent:function a(y){var x,w;if(g.is(y)){this.treeListView.utils._treeDocument.prepareUpdate();if(g.is(y.formerParentsPIDArray,"array")){y.formerParentsPIDArray.forEach(function A(B){x=j.getReferenceFromCollection(B);if(g.is(x)){w=this.treeListView.utils.search(x.id)}if(g.is(w,"array")){w.forEach(function C(D){var F=D.getChildren();if(g.is(F,"array")){F=F.filter(function G(H){var J=false,I=H.getInstancePID();if(g.is(y.movedInstPIDArray,"array")){y.movedInstPIDArray.forEach(function K(L){if(I===L){J=true}})}return J});F.forEach(function E(H){D.removeChild(H)})}})}},this)}if(g.is(y.newParentPID,"string")){x=j.getReferenceFromCollection(y.newParentPID);if(g.is(x)){w=this.treeListView.utils.search(x.id);if(g.is(w,"array")){w.forEach(function v(B){B.removeChildren()});if(g.is(y.newInstPIDArray,"array")){y.newInstPIDArray.forEach(function z(C){var B=j.getInstanceFromCollection(C);if(g.is(B)){this.treeListView.utils.addToTreeList(B)}},this)}}}}this.treeListView.utils._treeDocument.pushUpdate()}}});return n});define("DS/DELWebMfgAssetsDefUIServices/CreateLinkUtil",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/Logger/Logger","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/Core/Events","DS/DELWebMfgAssetsDefUIServices/CommandsManager","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/LoggerUtils","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil","DS/DELWebMfgAssetsDefModelServices/ExternalEventsUtils","DS/DELWebMfgAssetsDefUIControls/LinksUI","DS/DELWebMfgAssetsDefModelServices/ImplementLinkUtil",],function(f,c,A,d,g,E,x,I,C,z,t,w,J,F,b,k,B,p,j){var s=c.singleton({_context:null,_widgetTrigram:"",name:"CreateLinkUtil",init:function H(L){L=L||{};if(L.context){this._context=L.context}if(f.is(d)){this._logger=d.getLogger(s)}this._widgetTrigram=F.getWidgetTrigram()},_createModal:function l(){if(f.is(this._createLinkModal)){this._createLinkModal.destroy()}this.name="CreateLinkUtil";this._createLinkModal=new g({header:w.getNLSValue("CreateLinkUtil.CreateLinkTitle"),closable:true,className:"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-Dialog"});this._createLinkModal.inject(widget.body);if(f.is(this._createInstanceModal)){this._createInstanceModal.destroy()}this._createInstanceModal=new g({header:w.getNLSValue("CreateLinkUtil.CreateLinkOrInstanceTitle"),closable:true,className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-Dialog"});this._createInstanceModal.inject(widget.body)},_completed:function D(L,M){if(f.is(L)){F.setForceDBMode(true)}if(f.is(M)){I.publish({event:M+"/COMPLETED",data:L})}},createLink:function u(ac,O,aj,ap,av,au,N,al){var ai=al||{},ao=f.is(ai.onComplete,"function")?ai.onComplete:null,M=f.is(ai.onFailure,"function")?ai.onFailure:null,aw=f.is(ai.context)?ai.context:null,ar=this,aE=ac.get("PPRTYPE"),az=C.getPossibleRelationTypes(ac,O,aj,ap),P=C.getPossibleRelationTypes(O,ac,ap,aj),aa=null,R=null,aC=null,W=null,Q=null,L,ax,at,af,ae,ad,V,T,aq,aB,am,aA,an,Z,X,ab=null,Y=null,aD=null,ah=null,U,ag=z.getLabelValue(ac),S=z.getLabelValue(O),ak=w.getNLSValue("CreateLinkUtil.From"),ay=w.getNLSValue("CreateLinkUtil.To");if((az.length===0)&&(P.length>0)){ar.createLink(O,ac,ap,aj,av,al);return}R=function R(aJ,aH){var aL={},aP,aN,aO,aQ,aI,aF,aG,aM={},aK=false;if(f.is(aJ,"array")&&f.is(aH,"array")){for(aN=aJ.length-1;aN>=0;aN--){aQ=aJ[aN];aP=J.getInstanceFromCollection(aQ);aO=aP.get("isAggregatedBy");for(aI=aH.length-1;aI>=0;aI--){aF=aH[aI];if(f.is(aM[aF])){aG=aM[aF]}else{aP=J.getInstanceFromCollection(aF);aG=aP.get("isAggregatedBy");aM[aF]=aG}if(aO===aG&&(aQ!==aF)){aK=true;break}}if(aK){break}}for(;aN<aJ.length;aN++){aL.fromPath=f.is(aL.fromPath,"string")?(aL.fromPath+","+aJ[aN]):aJ[aN]}for(;aI<aH.length;aI++){aL.toPath=f.is(aL.toPath,"string")?(aL.toPath+","+aH[aI]):aH[aI]}}return aL};aa=function aa(aJ,aF){var aG,aI;if("MFN"===this._widgetTrigram){at=this._context.getMBOMTreeListView();af=this._context.getBodyTreeListView();ae=z.getMGAElement("TreeUI");ad=at.getDocument();V=af.getDocument();T=ae.getDocument();if(0<aJ.indexOf("_inverse")){an=O;Z=ap;am=ac;aA=aj}else{an=ac;Z=aj;am=O;aA=ap}aq=ad.getNodeModel(an.id,{searchReferencePID:true,returnFirstOne:true});if(aq===null){aq=T.getNodeModel(an.id,{searchReferencePID:true,returnFirstOne:true})}aB=V.getNodeModel(am.id,{searchReferencePID:true,returnFirstOne:true});if(aB===null){aB=T.getNodeModel(am.id,{searchReferencePID:true,returnFirstOne:true})}if(f.is(aA)){ab=f.is(aA.id)?aA.id:null;if(f.is(ab)){Y=V.getNodeModel(ab,{searchInstancePID:true,returnFirstOne:true});if(null===Y){Y=T.getNodeModel(ab,{searchInstancePID:true,returnFirstOne:true})}if(f.is(Y)){aB=Y}}}if(f.is(Z)){aD=f.is(Z.id)?Z.id:null;if(f.is(aD)){ah=ad.getNodeModel(aD,{searchInstancePID:true,returnFirstOne:true});if(null===ah){ah=T.getNodeModel(aD,{searchInstancePID:true,returnFirstOne:true})}if(f.is(ah)){aq=ah}}}if("PROCESS_ProductImplementLink"===aJ||"PART_ProductImplementLink"===aJ||"PRODUCT_ProductImplementLink"===aJ||"RESOURCE_ProductImplementLink"===aJ||"PROCESS_ProductImplementLink_inverse"===aJ||"PART_ProductImplementLink_inverse"===aJ||"PRODUCT_ProductImplementLink_inverse"===aJ||"RESOURCE_ProductImplementLink_inverse"===aJ){X=this._context.getCommand("CreateScopeLink");X._createScope(aq,aB).then(ao,M);ar._createLinkModal.hide();return}else{if("PROCESS_ProductImplementLinkOcc"===aJ||"PART_ProductImplementLinkOcc"===aJ||"PRODUCT_ProductImplementLinkOcc"===aJ||"RESOURCE_ProductImplementLinkOcc"===aJ||"PROCESS_ProductImplementLinkOcc_inverse"===aJ||"PART_ProductImplementLinkOcc_inverse"===aJ||"PRODUCT_ProductImplementLinkOcc_inverse"===aJ||"RESOURCE_ProductImplementLinkOcc_inverse"===aJ){X=this._context.getCommand("AssignProvide");aq=(f.is(aq,"array")&&(aq.length>0))?aq[0]:aq;aB=f.is(aB,"array")?aB:[aB];X.createImplementLink(aq,aB).then(ao,M);ar._createLinkModal.hide();return}}}ar._createLinkModal.hide();U={type:aJ,IDFrom:ac.id,IDTo:O.id};if(f.is(ap)&&f.is(aj)){if(aJ==="OPERATION_DELLmiTimeConstraintCnx"){aG=R(au,N);U.IDTo=aG.toPath;U.IDFrom=aG.fromPath}else{if(aJ==="OPERATION_ProcessImplementLink"||aJ==="PROCESS_ProcessImplementLink_inverse"){if(f.is(ap)&&f.is(aj)){aI=j.getPathsToScope(au,N);if(f.is(aI)){if(f.is(aI.fromPathScope)&&f.is(aI.toPathScope)){if(aJ==="OPERATION_ProcessImplementLink"){U={implementingID:ac.id,implementedID:O.id,implementingPath:aI.fromPathScope,implementedPath:aI.toPathScope,type:"ProcessImplementLink"}}else{U={implementingID:O.id,implementedID:ac.id,implementingPath:aI.toPathScope,implementedPath:aI.fromPathScope,type:"ProcessImplementLink"}}ar.createSystemScopeAndImplementLink(U);return}}}}else{if(aJ==="OPERATION_ProcessImplementLinkOcc"||aJ==="PROCESS_ProcessImplementLinkOcc_inverse"){if(f.is(ap)&&f.is(aj)){aI=j.getPathsToScope(au,N);if(f.is(aI)){if(f.is(aI.fromPathScope)&&f.is(aI.toPathScope)){U.IDFrom=aI.fromPathScope.toString();U.IDTo=aI.toPathScope.toString()}}else{U.IDTo=ap.id;U.IDFrom=aj.id}}}}}}J.connections.create(null,{proxy:"passport",wait:true,headers:F.getHeaders(),data:f.Json.encode(U),onFailure:function aH(aL,aN){var aM=w.getNLSValue("CreateLinkUtil.LinkCreationFailure");if(f.is(aN)&&f.is(aN.message,"string")){aM=aM+"<br>"+aN.message}z.AlertManager.add({className:"error",message:aM});if(f.is(ar._logger)){ar._logger.warn("Create link error: "+f.Json.encode(aN))}ar._completed(null,av);if(f.is(M)){M.call(aw)}},onComplete:function aK(aL){var aO=J.references.get(ac.id),aP=J.references.get(O.id),aN,aM;if(f.is(aO)){t.fillConnectionModelInfo(aO)}if(f.is(aP)){t.fillConnectionModelInfo(aP)}if((f.is(aj)&&f.is(aj.id))&&(f.is(ap)&&f.is(ap.id))){aN=J.instances.get(aj.id);if(f.is(aN)){t.fillConnectionModelInfo(aN)}aM=J.instances.get(ap.id);if(f.is(aM)){t.fillConnectionModelInfo(aM)}}z.AlertManager.add({className:"success",message:w.getNLSValue("CreateLinkUtil.LinkCreationSuccess",{selectedDisplayedType:aF,targetLabel:ag,draggedLabel:S})});p.updateUI(aL);ar._completed(aL,av);if(f.is(ao)){ao.call(aw)}},logMessage:w.getNLSValue("CreateLinkUtil.LogMessage",{type:aF,from:ag,to:S})})};aC=new f.Element("div");if(P.length>0){W=new f.Element("div",{"class":"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-SwitchBtnDiv"});W.inject(aC);L=new E({className:"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-SwitchBtn",events:{onClick:function(){if(ar._createLinkModal.getBody().childElementCount>0){ar._createLinkModal.getBody().firstChild.destroy()}ar.createLink(O,ac,ap,aj,av,N,au,al)}}});ax=w.getIconFromKey("SwitchFromTo");ax.inject(L.getContent());new x({position:"top left",target:L.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipSwitchFromTo")});L.inject(W)}Q=new f.Element("div",{"class":"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-FromToDiv",html:ak+ag+"<br>"+ay+S+"<br>"});Q.inject(aC);az.forEach(function(aH){var aF=function(aL,aI){var aJ=new E({value:aI,className:"default large block MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-Btn",events:{onClick:function(){aa.call(ar,aE+"_"+aL,aI)}}}),aK;if(aH==="DELAsmProcessCanUseCnx"){if(aE==="PROCESS"){aH+="_process"}}aK=w.getIconFromKey(aH);aK.getContent().setStyles({height:"32",width:"32","float":"left","margin-left":"15%"});aK.inject(aJ.getContent());aJ.inject(aC)},aG=w.getNLSValue(aH);aF(aH,aG)});if(!f.is(this._createLinkModal)){this._createModal()}this._createLinkModal.setBody(aC);this._createLinkModal.show()},createInstance:function o(V,P,O,T){var L=T||{},U=f.is(L.onComplete,"function")?L.onComplete:null,Q=f.is(L.onFailure,"function")?L.onFailure:null,N=f.is(L.context)?L.context:null,R=this,M=widget.getValue("oneDelmiaAggregationMode"),S={isAggregatedBy:V,isInstanceOf:P,oneDelmiaAggregationMode:M==="true"};if(f.is(this._context)&&f.is(this._context.hideLoadingCircle)){this._context.displayLoadingCircle(this._context.VIEWS.MBOM)}J.instances.create(null,{proxy:"passport",wait:true,headers:F.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),data:f.Json.encode(S),onComplete:function(W){R._completed(W,O);if(f.is(U)){U.call(N)}},onFailure:function(X,W){if(f.is(W)&&f.is(W.message,"string")){z.AlertManager.add({className:"error",message:W.message})}R._completed(null,O);if(f.is(Q)){Q.call(N)}}})},moveInstance:function e(X){var L=X||{},aa=f.is(L.onComplete,"function")?L.onComplete:null,T=f.is(L.onFailure,"function")?L.onFailure:null,N=f.is(L.context)?L.context:null,Q=f.is(L.popupMessage)?L.popupMessage:true,S=null,V=null,Y=null,P=null,W=b.getNextIndex(),Z=w.getNLSValue("CreateLinkUtil.ReparentInstances"),O=w.getNLSValue("CreateLinkUtil.ReparentInstancesSuccess"),U=w.getNLSValue("CreateLinkUtil.ReparentInstancesFailure");S=function S(ag){var ai,af=[],ae={formerParentsPIDArray:Y.formerInstancesParentPIDs,movedInstPIDArray:Y.instancesPIDsToReparent,newParentPID:Y.newParentPID,newInstPIDArray:[]},ab={silent:true,merge:true};if(f.is(ag,"array")){ag.forEach(function ac(aj){ai=aj.attributesValue;if(!ai.hasOwnProperty("isInstanceOf")){J.references.add(ai,{silent:false,merge:true})}else{ae.newInstPIDArray.push(ai.PID);J.instances.add(ai,ab)}});if(f.is(Y.instancesPIDsToReparent,"array")){af=Y.instancesPIDsToReparent.filter(function ad(al){var ak=!ae.newInstPIDArray.some(function aj(am){return al===am});return ak});if(f.is(af,"array")){af.forEach(function ah(aj){J.instances.remove(aj,ab)})}}I.publish({event:"DELWebMfgAssetsDefUI/ReparentInstances",data:ae});if(f.is(aa)){aa.call(N)}}if(Q){z.AlertManager.add({className:"success",message:O})}b.logCompleted(W,Z)};V=function V(){if(Q){z.AlertManager.add({className:"error",message:U})}b.logFailed(W,Z);if(f.is(T)){T.call(N)}};b.logStarted(W,Z);Y={instancesPIDsToReparent:f.is(L.instancesPIDsToReparent)?L.instancesPIDsToReparent:[],formerInstancesParentPIDs:f.is(L.formerInstancesParentPIDs)?L.formerInstancesParentPIDs:[],newParentPID:f.is(L.newParentPID)?L.newParentPID:"",newParentInstancesOrder:f.is(L.newParentInstancesOrder)?L.newParentInstancesOrder:[]};P={url:"modeler/ppr/reparent",method:"POST",onComplete:S,onFailure:V,onTimeout:V,data:f.Json.encode(Y)};this._logger.info("Reparent instance ("+Y.instancesPIDsToReparent.reduce(function M(ac,ad,ab){return ac+=((ab===0)?"":", ")+ad+"#"+J.getInstanceFromCollection(ad).get("PLM_ExternalID")},"")+"), formerly under reference ("+Y.formerInstancesParentPIDs.reduce(function R(ac,ad,ab){return ac+=((ab===0)?"":", ")+ad+"#"+J.getReferenceFromCollection(ad).get("V_Name")},"")+"), under new reference ("+Y.newParentPID+"#"+J.getReferenceFromCollection(Y.newParentPID).get("V_Name")+")");F.webServiceRequest(P)},createLinkOrInstance:function a(ai,ah,ae,P,X,S,T,N){var Y=N||{},Z=f.is(Y.context)?Y.context:null,R=this,aa=new f.Element("div"),ag,ad,aj,am,ak,af,M,L=w.getNLSValue("CreateLinkUtil.FromOrParent"),ac=w.getNLSValue("CreateLinkUtil.ToOrChild"),an=J.references.get(ai),ab,W=J.references.get(ah),O,al,Q,V;this._createModal();if(f.is(ae)){ab=J.instances.get(ae)}if(f.is(P)){O=J.instances.get(P)}al=C.isInstancePossible(an,W);Q=C.isLinkPossible(an,W,ab,O);V=X&&al&&f.is(O)&&(an!==W);if(al){ag=new f.Element("div",{"class":"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-FromToDiv",html:L+z.getLabelValue(an)+"<br>"+ac+z.getLabelValue(W)+"<br>"});ag.inject(aa);if(Q){ak=new E({icon:"",className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-link-Button",events:{onClick:function(){R._createInstanceModal.hide();R.createLink(an,W,ab,O,null,S,T,Y)}}});ak.inject(aa);ad=w.getIconFromKey("CreateLink");ad.inject(ak.getContent());new x({position:"bottom right",target:ak.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipCreateLink")})}af=new E({icon:"",className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-instance-Button",events:{onClick:function(){R._createInstanceModal.hide();R.createInstance(ai,ah,null,Y)}}});af.inject(aa);aj=w.getIconFromKey("CreateInstance");aj.inject(af.getContent());new x({position:"bottom right",target:af.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipCreateInstance")});if(V){M=new E({icon:"",className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-move-Button",events:{onClick:function U(){var ap=f.merge({instancesPIDsToReparent:[P],formerInstancesParentPIDs:[J.getInstanceFromCollection(P).get("isAggregatedBy")],newParentPID:ai,newParentInstancesOrder:J.getInstancesFromCollection(ai).map(function ao(aq){return aq.id})},Y);ap.newParentInstancesOrder.push(null);R._createInstanceModal.hide();R.moveInstance(ap)}}});M.inject(aa);am=w.getIconFromKey("MoveInstance");am.inject(M.getContent());new x({position:"bottom right",target:M.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipMoveInstance")})}R._createInstanceModal.setBody(aa);R._createInstanceModal.show()}else{if(Q){this.createLink(an,W,ab,O,null,S,T,Y)}else{z.AlertManager.add({className:"error",message:w.getNLSValue("CreateLinkUtil.NoPossibleAction")});if(f.is(Y.onFailure,"function")){Y.onFailure.call(Z)}}}},createSystemScopeAndImplementLink:function G(U){var L=U||{},X=f.is(L.onComplete,"function")?L.onComplete:null,P=f.is(L.onFailure,"function")?L.onFailure:null,M=f.is(L.context)?L.context:null,Q=null,S=null,W=null,N=null,R=b.getNextIndex(),V=w.getNLSValue("AbstractDragAndDropManager.CreateSystemContextualScopeLink"),O=w.getNLSValue("AbstractDragAndDropManager.CreateSystemContextualScopeLinkSuccess"),T=w.getNLSValue("AbstractDragAndDropManager.CreateSystemContextualScopeLinkSuccessFailure");Q=function Q(ad){var ac=[],aa=[],ab=[];ad.instancesAndReferences.forEach(function(af){var ae=af.attributesValue;if(ae.hasOwnProperty("isInstanceOf")){ae.queriedForConnections=true;aa.push(ae)}else{ac.push(ae)}});ad.connections.forEach(function Z(af){var ae=J.parseConnection(af);ab.push(ae)});J.addToCollections({stackedReferences:ac,stackedInstances:aa,stackedConnections:ab,onComplete:function Y(){ab.forEach(function ae(ag){var ai,aj,ah,af;if(f.is(ag.from,"array")){ah=J.instances.get(ag.from[ag.from.length-1]);af=J.instances.get(ag.to[ag.to.length-1]);t.fillConnectionModelInfo(ah);t.fillConnectionModelInfo(af)}else{ai=J.references.get(ag.from);aj=J.references.get(ag.to);t.fillConnectionModelInfo(ai);t.fillConnectionModelInfo(aj)}});if(f.is(X)){X.call(M)}}});z.AlertManager.add({className:"success",message:O});b.logCompleted(R,V)};S=function S(){z.AlertManager.add({className:"error",message:T});b.logFailed(R,V);if(f.is(P)){P.call(M)}};b.logStarted(R,V);W={implementingID:f.is(L.implementingID)?L.implementingID:"",implementedID:f.is(L.implementedID)?L.implementedID:"",implementingPath:f.is(L.implementingPath)?L.implementingPath.toString():"",implementedPath:f.is(L.implementedPath)?L.implementedPath.toString():"",type:f.is(L.type)?L.type:""};N={url:"modeler/ppr/createscopeandimplementlinkbytype",method:"POST",onComplete:Q,onFailure:S,onTimeout:S,data:f.Json.encode(W)};F.webServiceRequest(N)},getConsumeMultipleEBOMPromise:function r(N){var M=[];N.forEach(function L(O){var P=null,R=null,Q=null;R=J.getClosestScope(O.targetRootReferencePID,O.targetInstancePIDsArray,O.rootReferencePID,O.instancePIDsArray);if(f.is(R)){Q=J.getReferenceFromCollection(O.targetReferencePID);if(F.isAKindOf(Q,"Provide")){P=J.getConsumeEBOMOccurencePromise(O.targetReferencePID,O.referencePID,O.targetInstancePID,R.secondSubPath)}else{P=J.getCreateMBOMFromEBOMPromise(O.rootReferencePID,[R.secondSubPath],O.targetRootReferencePID,O.targetReferencePID)}}else{P=J.getCreateScopePromise(O.targetReferencePID,O.referencePID)}M.push(P)});return A.all(M)},getCreateMultipleMovesPromise:function y(P,M,S){var L=[],O={PID:"",isInstanceOf:"",isAggregatedBy:"",oldParentPID:""},R=new A(function Q(W,V){var U={instancesPIDsToReparent:null,formerInstancesParentPIDs:null,newParentPID:null,newParentInstancesOrder:null,popupMessage:false,onComplete:W,OnFailure:V};P.forEach(function T(Y,Z){var aa=J.getInstanceFromCollection(Y.instancePID),ab=f.is(aa)?aa.get("isAggregatedBy"):null;if(0===Z){U.instancesPIDsToReparent=[];U.formerInstancesParentPIDs=[];U.newParentPID=Y.targetReferencePID;U.newParentInstancesOrder=J.getInstancesFromCollection(Y.targetReferencePID).map(function X(ac){return ac.id})}U.instancesPIDsToReparent.push(Y.instancePID);U.formerInstancesParentPIDs.push(ab);U.newParentInstancesOrder.push(null);O={PID:Y.instancePID,isInstanceOf:Y.referencePID,isAggregatedBy:Y.targetReferencePID,oldParentPID:ab};L.push({attributesValue:O})});s.moveInstance(U)}),N=function N(){var T;B.emitCreateInstanceEvent(L);T=w.getNLSValue("CreateLinkUtil.MoveSuccess",{instanceLabel:S,newParentLabel:M});return A.resolve(T)};return R.then(N)},getCreateInstancePromise:function v(L,N){var O=new A(function M(V,Q){var U=b.getNextIndex(),T=w.getNLSValue("CreateLinkUtil.InstanceCreationNoMsg"),W=w.getNLSValue("CreateLinkUtil.InstanceCreationSuccessNoMsg"),Y=w.getNLSValue("CreateLinkUtil.InstanceCreationFailureNoMsg"),P="true"===widget.getValue("oneDelmiaAggregationMode"),X={isAggregatedBy:L,isInstanceOf:N,oneDelmiaAggregationMode:P};b.logStarted(U,T);J.instances.create(null,{proxy:"passport",headers:F.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),wait:true,data:f.Json.encode(X),onComplete:function S(Z){b.logCompleted(U,W);V(Z)},onFailure:function R(aa){var Z=w.getNLSValue("InsertCmd.CreateInstanceFailure");if(f.is(aa)&&f.is(aa.message,"string")){Z+="<br>"+aa.message}b.logFailed(U,Y);Q(Z)}})});return O},getCreateMultipleInstancesPromise:function h(O,M,Q){var P=A.all(O.map(function L(R){return s.getCreateInstancePromise(R.targetReferencePID,R.referencePID)})),N=function N(){var R=w.getNLSValue("CreateLinkUtil.InstanceCreationSuccess",{instanciatedReference:Q,referenceName:M});return A.resolve(R)};return P.then(N)},_getCreateLinkUIContentPromise:function K(M,Q,S,N,P,L){var O=new A(function R(ah,V){var T=new f.Element("div"),ac=w.getNLSValue("CreateLinkUtil.From"),ag=w.getNLSValue("CreateLinkUtil.To"),ae=false,af=null,aa=null,X=null,Y=null,U=null,W=null,ad=function ad(ai,aj){var al=new A(function ak(an){var ap=w.getNLSValue(ai),am=ai,ao=new E({value:ap,className:"default large block MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-Btn",events:{onClick:function ar(){an({linkType:ai,switchValue:ae})}}}),aq;if("DELAsmProcessCanUseCnx"===ai){if("PROCESS"===aj){am+="_process"}}aq=w.getIconFromKey(am);aq.getContent().setStyles({height:"32",width:"32","float":"left","margin-left":"15%"});aq.inject(ao.getContent());ao.inject(af)});return al},ab=function ab(aj){return A.race(aj.map(function ai(ak){return ad(ak,(ae?L:P))}))},Z=function Z(){if(f.is(aa)){aa.destroy()}aa=new f.Element("div",{"class":"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-FromToDiv",html:ac+(ae?S:N)+"<br>"+ag+(ae?N:S)+"<br>"});aa.inject(T);if(f.is(af)){af.destroy()}af=new f.Element("div");W=ae?ab(Q):ab(M);W.then(ah,V);af.inject(T)};if(Q.length>0){X=new f.Element("div",{"class":"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-SwitchBtnDiv"});X.inject(T);Y=new E({className:"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-SwitchBtn",events:{onClick:function(){ae=!ae;Z()}}});U=w.getIconFromKey("SwitchFromTo");U.inject(Y.getContent());new x({position:"top left",target:Y.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipSwitchFromTo")});Y.inject(X)}Z();if(!f.is(s._createLinkModal)){s._createModal()}s._createLinkModal.setBody(T);s._createLinkModal.show()});return O},_getConnectionCreationPromise:function i(N,M,L){var P=new A(function O(ak,Y){var am,al,ar,ag,af,ae,X,V,ao,ab,an,aw,aq,ax,ac,aa,az,ah,Z,W,R=w.getNLSValue(N),ad=J.getReferenceFromCollection(L?M.referencePID:M.targetReferencePID),S=J.getReferenceFromCollection(L?M.targetReferencePID:M.referencePID),aj=J.getInstanceFromCollection(L?M.instancePID:M.targetInstancePID),ap=J.getInstanceFromCollection(L?M.targetInstancePID:M.instancePID),at=L?M.instancePIDsArray:M.targetInstancePIDsArray,Q=L?M.targetInstancePIDsArray:M.instancePIDsArray,aA=ad.get("PPRTYPE"),av=aA+"_"+N,ai=z.getLabelValue(ad),U=z.getLabelValue(S),T=function T(aF,aD){var aH={},aL,aJ,aK,aM,aE,aB,aC,aI={},aG=false;if(f.is(aF,"array")&&f.is(aD,"array")){for(aJ=aF.length-1;aJ>=0;aJ--){aM=aF[aJ];aL=J.getInstanceFromCollection(aM);aK=aL.get("isAggregatedBy");for(aE=aD.length-1;aE>=0;aE--){aB=aD[aE];if(f.is(aI[aB])){aC=aI[aB]}else{aL=J.getInstanceFromCollection(aB);aC=aL.get("isAggregatedBy");aI[aB]=aC}if(aK===aC&&(aM!==aB)){aG=true;break}}if(aG){break}}for(;aJ<aF.length;aJ++){aH.fromPath=f.is(aH.fromPath,"string")?(aH.fromPath+","+aF[aJ]):aF[aJ]}for(;aE<aD.length;aE++){aH.toPath=f.is(aH.toPath,"string")?(aH.toPath+","+aD[aE]):aD[aE]}}return aH};if("MFN"===s._widgetTrigram){ar=s._context.getMBOMTreeListView();ag=s._context.getBodyTreeListView();af=z.getMGAElement("TreeUI");ae=ar.getDocument();X=ag.getDocument();V=af.getDocument();if(0<av.indexOf("_inverse")){ao=S;ab=ap;an=ad;aw=aj}else{ao=ad;ab=aj;an=S;aw=ap}aq=ae.getNodeModel(ao.id,{searchReferencePID:true,returnFirstOne:true});if(aq===null){aq=V.getNodeModel(ao.id,{searchReferencePID:true,returnFirstOne:true})}ax=X.getNodeModel(an.id,{searchReferencePID:true,returnFirstOne:true});if(ax===null){ax=V.getNodeModel(an.id,{searchReferencePID:true,returnFirstOne:true})}if(f.is(aw)){ac=f.is(aw.id)?aw.id:null;if(f.is(ac)){aa=X.getNodeModel(ac,{searchInstancePID:true,returnFirstOne:true});if(null===aa){aa=V.getNodeModel(ac,{searchInstancePID:true,returnFirstOne:true})}if(f.is(aa)){ax=aa}}}if(f.is(ab)){az=f.is(ab.id)?ab.id:null;if(f.is(az)){ah=ae.getNodeModel(az,{searchInstancePID:true,returnFirstOne:true});if(null===ah){ah=V.getNodeModel(az,{searchInstancePID:true,returnFirstOne:true})}if(f.is(ah)){aq=ah}}}if("PROCESS_ProductImplementLink"===av||"PART_ProductImplementLink"===av||"PRODUCT_ProductImplementLink"===av||"RESOURCE_ProductImplementLink"===av||"PROCESS_ProductImplementLink_inverse"===av||"PART_ProductImplementLink_inverse"===av||"PRODUCT_ProductImplementLink_inverse"===av||"RESOURCE_ProductImplementLink_inverse"===av){Z=s._context.getCommand("CreateScopeLink");Z._createScope(aq,ax).then(ak,Y);s._createLinkModal.hide();return}else{if("PROCESS_ProductImplementLinkOcc"===av||"PART_ProductImplementLinkOcc"===av||"PRODUCT_ProductImplementLinkOcc"===av||"RESOURCE_ProductImplementLinkOcc"===av||"PROCESS_ProductImplementLinkOcc_inverse"===av||"PART_ProductImplementLinkOcc_inverse"===av||"PRODUCT_ProductImplementLinkOcc_inverse"===av||"RESOURCE_ProductImplementLinkOcc_inverse"===av){Z=s._context.getCommand("AssignProvide");aq=(f.is(aq,"array")&&(aq.length>0))?aq[0]:aq;ax=f.is(ax,"array")?ax:[ax];Z.createImplementLink(aq,ax).then(ak,Y);s._createLinkModal.hide();return}}}s._createLinkModal.hide();W={type:av,IDFrom:ad.id,IDTo:S.id};if(f.is(ap)&&f.is(aj)){if(av==="OPERATION_DELLmiTimeConstraintCnx"){am=T(at,Q);W.IDTo=am.toPath;W.IDFrom=am.fromPath}else{if(av==="OPERATION_ProcessImplementLink"||av==="PROCESS_ProcessImplementLink_inverse"){if(f.is(ap)&&f.is(aj)){al=j.getPathsToScope(at,Q);if(f.is(al)){if(f.is(al.fromPathScope)&&f.is(al.toPathScope)){if(av==="OPERATION_ProcessImplementLink"){W={implementingID:ad.id,implementedID:S.id,implementingPath:al.fromPathScope,implementedPath:al.toPathScope,type:"ProcessImplementLink"}}else{W={implementingID:S.id,implementedID:ad.id,implementingPath:al.toPathScope,implementedPath:al.fromPathScope,type:"ProcessImplementLink"}}s.createSystemScopeAndImplementLink(f.merge(W,{onComplete:ak,onFailure:Y}));return}}}}else{if(av==="OPERATION_ProcessImplementLinkOcc"||av==="PROCESS_ProcessImplementLinkOcc_inverse"){if(f.is(ap)&&f.is(aj)){al=j.getPathsToScope(at,Q);if(f.is(al)){if(f.is(al.fromPathScope)&&f.is(al.toPathScope)){W.IDFrom=al.fromPathScope.toString();W.IDTo=al.toPathScope.toString()}}else{W.IDTo=ap.id;W.IDFrom=aj.id}}}}}}J.connections.create(null,{proxy:"passport",wait:true,headers:F.getHeaders(),data:f.Json.encode(W),onFailure:function ay(aB,aD){var aC=w.getNLSValue("CreateLinkUtil.LinkCreationFailure");if(f.is(aD)&&f.is(aD.message,"string")){aC=aC+"<br>"+aD.message}if(f.is(s._logger)){s._logger.warn("Create link error: "+f.Json.encode(aD))}Y(aC)},onComplete:function au(aB){var aE=J.references.get(ad.id),aF=J.references.get(S.id),aD,aC;if(f.is(aE)){t.fillConnectionModelInfo(aE)}if(f.is(aF)){t.fillConnectionModelInfo(aF)}if((f.is(aj)&&f.is(aj.id))&&(f.is(ap)&&f.is(ap.id))){aD=J.instances.get(aj.id);if(f.is(aD)){t.fillConnectionModelInfo(aD)}aC=J.instances.get(ap.id);if(f.is(aC)){t.fillConnectionModelInfo(aC)}}p.updateUI(aB);ak({displayedLinkType:R,switchValue:L})},logMessage:w.getNLSValue("CreateLinkUtil.LogMessage",{type:R,from:ai,to:U})})});return P},getCreateLinksPromise:function n(V){var O,M,N,R="",P=null,L=null,Q=null,T=function T(X){return A.all(V.map(function W(Y){return s._getConnectionCreationPromise(X.linkType,Y,X.switchValue)}))},U=function U(W){var X=w.getNLSValue("CreateLinkUtil.LogMessage",{type:W[0].displayedLinkType,from:(W[0].switchValue?R:Q),to:(W[0].switchValue?Q:R)});return A.resolve(X)};V.forEach(function S(aa,Z){var X=J.getReferenceFromCollection(aa.targetReferencePID),af=J.getReferenceFromCollection(aa.referencePID),ae=J.getInstanceFromCollection(aa.targetInstancePID),ab=J.getInstanceFromCollection(aa.instancePID),ag=(0===Z)?"":", ",ac=[],Y=[];if(0===Z){M=C.getPossibleRelationTypes(X,af,ae,ab);N=C.getPossibleRelationTypes(af,X,ab,ae);P=X.get("PPRTYPE");L=af.get("PPRTYPE");Q=z.getLabelValue(X)}else{ac=C.getPossibleRelationTypes(X,af,ae,ab);Y=C.getPossibleRelationTypes(af,X,ab,ae);M=ac.filter(function W(ai){var ah=(M.indexOf(ai)>-1);return ah});N=Y.filter(function ad(ai){var ah=(N.indexOf(ai)>-1);return ah})}R+=(ag+z.getLabelValue(af))});O=s._getCreateLinkUIContentPromise(M,N,R,Q,P,L).then(T).then(U);return O},getActionPromise:function m(M,Q,L){var P=new A(function O(ad){var X,aa=w.getNLSValue("CreateLinkUtil.FromOrParent"),af=w.getNLSValue("CreateLinkUtil.ToOrChild"),R=new f.Element("div"),Z="",U=null,ab=null,V=null,Y=null,ah=null,S=null,ag=null;M.forEach(function ac(ai,aj){var al=J.getReferenceFromCollection(ai.targetReferencePID),ak=J.getReferenceFromCollection(ai.referencePID),am=(0===aj)?"":", ";if(0===aj){X=z.getLabelValue(al)}Z+=(am+z.getLabelValue(ak))});if(L&&k.isDialogDisplayedAtDDinCaseOfMove()){ad({type:3,toLabel:Z,firstFromLabel:X})}else{U=new f.Element("div",{"class":"MGA-DELWebMfgAssetsDefUIServices-CreateLinkUtil-FromToDiv",html:aa+X+"<br>"+af+Z+"<br>"});U.inject(R);if(Q){ab=new E({icon:"",className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-link-Button",events:{onClick:function W(){ad({type:1,toLabel:Z,firstFromLabel:X})}}});ab.inject(R);V=w.getIconFromKey("CreateLink");V.inject(ab.getContent());new x({position:"bottom right",target:ab.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipCreateLink")})}Y=new E({icon:"",className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-instance-Button",events:{onClick:function ae(){ad({type:2,toLabel:Z,firstFromLabel:X})}}});Y.inject(R);ah=w.getIconFromKey("CreateInstance");ah.inject(Y.getContent());new x({position:"bottom right",target:Y.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipCreateInstance")});if(L){S=new E({icon:"",className:"MGA-DELWebMfgAssetsDefUIServices-createLinkOrInstance-move-Button",events:{onClick:function T(){ad({type:3,toLabel:Z,firstFromLabel:X})}}});S.inject(R);ag=w.getIconFromKey("MoveInstance");ag.inject(S.getContent());new x({position:"bottom right",target:S.getContent(),body:w.getNLSValue("CreateLinkUtil.tooltipMoveInstance")})}if(!f.is(s._createLinkModal)){s._createModal()}s._createInstanceModal.setBody(R);s._createInstanceModal.show()}}),N=function N(R){var S;s._createInstanceModal.hide();switch(R.type){case 1:S=s.getCreateLinksPromise(M);break;case 2:S=s.getCreateMultipleInstancesPromise(M,R.firstFromLabel,R.toLabel);break;case 3:S=s.getCreateMultipleMovesPromise(M,R.firstFromLabel,R.toLabel);break;default:S=A.reject(w.getNLSValue("CreateLinkUtil.InternalError"));break}return S};return P.then(N)},getCreateMultipleLinksPromise:function q(P){var R=f.is(P,"array")?P.length:-1,M=(R>0)?true:false,Q=M,L=M,O=null;if(M){P.forEach(function N(S){var V=J.getReferenceFromCollection(S.targetReferencePID),U=J.getReferenceFromCollection(S.referencePID),T=J.getInstanceFromCollection(S.targetInstancePID),W=J.getInstanceFromCollection(S.instancePID);M=M&&C.isInstancePossible(V,U);Q=Q&&C.isLinkPossible(V,U,T,W);L=L&&S.allowMove&&M&&f.is(W)&&(S.targetReferencePID!==S.referencePID)});if(M){O=s.getActionPromise(P,Q,L)}else{if(Q){O=s.getCreateLinksPromise(P)}else{O=A.reject(w.getNLSValue("CreateLinkUtil.NoPossibleAction"))}}}else{O=A.resolve(null)}return O}});return s});define("DS/DELWebMfgAssetsDefUIServices/AbstractDragAndDropManager",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/Logger/Logger","DS/Core/Events","UWA/Class/Promise","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil","DS/DELWebMfgAssetsDefUIServices/CreateLinkUtil","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/UXComponentUtil","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/LoggerUtils","DS/DELWebMfgAssetsDefUIOccurenceModel/AbstractTreeNodeModel","DS/DELWebMfgAssetsDefUIServices/CommandsManager"],function(k,v,w,A,t,d,s,C,B,o,g,p,z,m,a,b){var r=v.extend(w,{name:"AbstractDragAndDropManager",_logger:null,_view:null,_elementUI:null,init:function x(G){var E,F;if(A){this._logger=A.getLogger(r)}this._parent(G);E=this.getOption("view");if(E){this._view=E}if(k.is(G)&&k.is(G.elementUI)){this._elementUI=G.elementUI}F=this.getOption("displayModelRootAttribute");if(k.is(F)){this._displayModelRootAttribute=F}this._context=this.getOption("context")},getDDBehavior:function n(){var E=this;return{onDragStartCell:E.onDragStartCell,onDragEndCell:E.onDragEndCell,onDragEnterRowHeader:E.onDragEnterRowHeader,onDragLeaveRowHeader:E.onDragLeaveRowHeader,onDragEnterColumnHeader:E.onDragEnterColumnHeader,onDragLeaveColumnHeader:E.onDragLeaveColumnHeader,onDragEnterCell:E.onDragEnterCell,onDragLeaveCell:E.onDragLeaveCell,onDragOverCell:E.onDragOverCell,onDropCell:E.onDropCell,onDragEnterBlank:E.onDragEnterBlank,onDragLeaveBlank:E.onDragLeaveBlank,onDropBlank:E.onDropBlank}},retrieveItems:function D(H){var I=[],E,F,G,K="",L=["text/searchitems","text/plain","Text"],N,M;if(!k.is(H)){this._logger.warn("ERROR: No dropped item found");return I}G=k.is(H.dataTransfer.types.indexOf,"function")?"indexOf":"contains";for(N=0;N<L.length&&K==="";N++){M=H.dataTransfer.types[G](L[N]);if((k.is(M,"number")&&M>=0)||(k.is(M,"boolean")&&M===true)){K=L[N]}}if(""===K){this._logger.warn("ERROR: No data retrieved");return I}E=H.dataTransfer.getData(K);try{F=k.Json.decode(E)}catch(J){return I}if(!k.is(F)){this._logger.warn("ERROR: Parsing returned null");return I}if(!k.is(F.data)){this._logger.warn("ERROR: No data retrieved");return I}if(!k.is(F.data.items,"array")){this._logger.warn("ERROR: Items is not an array");return I}return F.data.items},onDragStartCell:function e(J,I){var E=[],L=I.nodeModel,K=widget.data,H=g.get3DSpaceServiceName(),G={protocol:"3DXContent",version:"1.1",source:K.appId,widgetId:widget.id,data:{items:[]}},F={properties:[function(){return{property:"referencePID",value:this.getReferencePID()}},function(){return{property:"instancePID",value:this.getInstancePID()}},function(){return{property:"absolutePath",value:this.getAbsolutePath()}},function(){return{property:"parentReferencePID",value:(this.getParent() instanceof a)?this.getParent().getReferencePID():null}},function(){return{property:"referenceType",value:this.getReferenceType()}},function(){return{property:"wuxID",value:this._getID()}},function(){return{property:"wuxlocalID",value:this._localID}},function(){return{property:"envId",value:g.getPlatformId({serviceId:H})}},function(){return{property:"serviceId",value:H}},function(){return{property:"contextId",value:[K.role,K.organization,K.collaborativeSpace].join(".")}},function(){return{property:"objectId",value:this.getReferencePID()}},function(){return{property:"objectType",value:this.getReferenceType()}},function(){return{property:"displayName",value:this.getLabel()}},function(){return{property:"displayType",value:z.getNLSValue(this.getReferenceType(),null,"Type"),}}]};if(!L.isSelected()){L.select()}I.manager.getDocument().getXSO().get().forEach(function(M){E.push(M.dump(F))});G.data.items=E;this.serializeDragAndDropEvent(J,G);J.dataTransfer.effectAllowed="move"},computeAddToTreelistOptions:function y(){var E={elementUI:this._elementUI,context:this.getOption("context",this),onEndLoading:this.getOption("onEndLoading",null),withLinksResolved:true};return E},getLastElementAggregatingReferencePID:function l(E){return p.getLastElementInstanceInfoPID(E,"isAggregatedBy")},getLastElementReferencePID:function c(E){return p.getLastElementInstanceInfoPID(E,"isInstanceOf")},getDraggedReferencePID:function u(E){var F=null;if(k.is(E)){if(k.is(E.instancePIDsArray,"array")&&(E.instancePIDsArray.length>0)){F=this.getLastElementReferencePID(E.instancePIDsArray)}else{F=p.isValidPID(E.rootReferencePID)?E.rootReferencePID:null}}return F},getTargetReferencePID:function j(E){var F=null;if(k.is(E)){if(k.is(E.targetInstancePIDsArray,"array")&&(E.targetInstancePIDsArray.length>0)){F=this.getLastElementReferencePID(E.targetInstancePIDsArray)}else{F=p.isValidPID(E.targetRootReferencePID)?E.targetRootReferencePID:null}}return F},getDragNDropInfo:function q(I,H){var K,J,E,G={draggedItems:[],info:{fromWUX:false,dropPosition:null,fromSameSource:false,wuxLocalID:null,wuxID:null},targetRootReferencePID:null,targetInstancePIDsArray:null,targetInstanceSiblingPID:null};if(k.is(I)&&k.is(I.dataTransfer)&&k.is(I.dataTransfer.getData,"function")){J=I.dataTransfer.getData("Text");if(k.is(J,"string")&&(J.length>0)){E=JSON.parse(J);if(k.is(E)&&k.is(E.widgetId,"string")){G.info.fromSameSource=(E.widgetId===widget.id)}}}if(k.is(H)&&k.is(H.nodeModel,"object")&&k.is(H.dropPosition)){G.info.fromWUX=true;G.info.dropPosition=H.dropPosition;G.targetTreeNodeModel=H.nodeModel}K=this.retrieveItems(I);if(k.is(K,"array")){K.forEach(function F(M){var L={},N;if(k.is(M)){L.rootReferencePID=null;L.instancePIDsArray=k.is(M.absolutePath,"array")?M.absolutePath:null;L.name=k.is(M.displayName,"string")?M.displayName:null;L.type=k.is(M.referenceType,"string")?M.referenceType:(k.is(M.objectType)?M.objectType:null);L.typeNLS=k.is(M.displayType,"string")?M.displayType:(k.is(M.displayType)?M.displayType:null);L.securityContext=k.is(M.contextId,"string")?M.contextId:null;L.tenant=k.is(M.envId,"string")?M.envId:null;L.service=k.is(M.serviceId,"string")?M.serviceId:null;L.wuxID=k.is(M.wuxID,"number")?M.wuxID:null;L.wuxLocalID=k.is(M.wuxlocalID,"number")?M.wuxlocalID:null;if(k.is(L.instancePIDsArray,"array")&&(L.instancePIDsArray.length>0)){N=p.getInstanceFromCollection(L.instancePIDsArray[0]);if(k.is(N)){L.rootReferencePID=N.get("isAggregatedBy")}}else{L.rootReferencePID=k.is(M.referencePID,"string")?M.referencePID:(k.is(M.objectId)?M.objectId:null)}}G.draggedItems.push(L)});if(k.is(G.targetTreeNodeModel)){if(k.is(G.targetTreeNodeModel.getRootPID,"function")){G.targetRootReferencePID=G.targetTreeNodeModel.getRootPID();G.targetInstancePIDsArray=G.targetTreeNodeModel.getAbsolutePath();G.targetInstanceSiblingPID=G.targetTreeNodeModel.getSiblingsPID();G.info.wuxLocalID=G.targetTreeNodeModel._localID;G.info.wuxID=k.is(G.targetTreeNodeModel._getID,"function")?G.targetTreeNodeModel._getID():null}delete G.targetTreeNodeModel}}return G},_computeDropEffect:function i(Q){var J={action:new Array(Q.draggedItems.length),parameters:new Array(Q.draggedItems.length),message:new Array(Q.draggedItems.length),dragNDropInfo:Q},M={parameters:null,message:null},T={createLink:null,createLinkOrInstance:null,addCA:null,addRoot:null,reOrderRoot:null,reOrder:null,reParent:null},R=this,L=function L(V){var U=false;if(k.is(R._view)){if(k.is(R._view.isAcceptedType,"function")&&(R._view.isAcceptedType({objectType:V}))){U=true}}else{U=true}return U},K=function K(V){var U=false;if(p.isValidPID(Q.draggedItems[V].rootReferencePID)&&(!k.is(p.getLastElement(Q.draggedItems[V].instancePIDsArray)))){U=true}return U},G=function G(X){var U=false,W=null,V=null;if(!K(X)){W=R.getLastElementAggregatingReferencePID(Q.draggedItems[X].instancePIDsArray);V=R.getLastElementAggregatingReferencePID(Q.targetInstancePIDsArray);if(p.isValidPID(W)&&p.isValidPID(V)&&(W===V)){U=true}}return U},E=function E(W){var V=false,U=null;if("middle"===Q.info.dropPosition){if((Q.targetRootReferencePID!==Q.draggedItems[W].rootReferencePID)||(!p.arrayCompare(Q.draggedItems[W].instancePIDsArray,Q.targetInstancePIDsArray))){if(s.isNewDragNDrop()&&("MFN"===g.getWidgetTrigram())){U="createLink"}else{U="createLinkOrInstance"}M.parameters={rootReferencePID:Q.draggedItems[W].rootReferencePID,referencePID:R.getDraggedReferencePID(Q.draggedItems[W]),targetReferencePID:R.getTargetReferencePID(Q),instancePID:p.getLastElement(Q.draggedItems[W].instancePIDsArray),targetRootReferencePID:Q.targetRootReferencePID,targetInstancePID:p.getLastElement(Q.targetInstancePIDsArray),allowMove:Q.info.fromSameSource&&("middle"===Q.info.dropPosition),instancePIDsArray:Q.draggedItems[W].instancePIDsArray,targetInstancePIDsArray:Q.targetInstancePIDsArray};if(k.is(T[U],"number")){J.action[W]="aggregatedAction";J.parameters[W]=T[U];J.message[W]=null;J.parameters[T[U]].push(M.parameters)}else{J.action[W]=U;J.parameters[W]=[M.parameters];J.message[W]=null;T[U]=W}V=true}else{J.action[W]="error";J.parameters[W]=null;J.message[W]=z.getNLSValue("AbstractDragAndDropManager.SameOccurencePath")}}return V},S=function S(V){var U=false;if(!p.isValidPID(Q.targetRootReferencePID)){if("Change Action"===Q.draggedItems[V].type){J.action[V]="addChangeAction";J.parameters[V]={rootReferencePID:Q.draggedItems[V].rootReferencePID};J.message[V]=null;U=true}}return U},F=function O(V){var U=false;if(!p.isValidPID(Q.targetRootReferencePID)){if(L(Q.draggedItems[V].type)){J.action[V]="addRoot";J.parameters[V]={rootReferencePID:R.getDraggedReferencePID(Q.draggedItems[V])};J.message[V]=null;U=true}else{J.action[V]="error";J.parameters[V]=null;J.message[V]=z.getNLSValue("AbstractDragAndDropManager.NotAuthorized")}}return U},I=function I(V){var U=false;if(K(V)&&Q.info.fromSameSource&&L(Q.draggedItems[V].type)){J.action[V]="reorderRoots";J.parameters[V]={rootReferencePID:R.getDraggedReferencePID(Q.draggedItems[V]),targetRootReferencePID:Q.targetRootReferencePID,position:Q.info.dropPosition};J.message[V]=null;U=true}return U},H=function H(Z){var X=false,W=Q.info.wuxLocalID,U=k.is(Q.targetInstanceSiblingPID,"array")?Q.targetInstanceSiblingPID.slice(0):[],V=Q.draggedItems[Z],Y=p.getLastElement(V.instancePIDsArray);if(Q.info.fromSameSource&&G(Z)&&L(Q.draggedItems[Z].type)){J.action[Z]="reorder";if(("top"===Q.info.dropPosition)&&(W>V.wuxLocalID)){W--}else{if(("bottom"===Q.info.dropPosition)&&(W<V.wuxLocalID)){W++}}U.splice(W,0,U.splice(V.wuxLocalID,1)[0]);J.parameters[Z]={movedInstancePID:Y,newChildrenPID:U};J.message[Z]=null;X=true}return X},N=function N(aa){var V=false,U=Q.info.wuxLocalID,Z=Q.draggedItems[aa].instancePIDsArray,W=p.getLastElement(Z),X=R.getLastElementAggregatingReferencePID(Q.targetInstancePIDsArray),Y=k.is(Q.targetInstanceSiblingPID,"array")?Q.targetInstanceSiblingPID.slice(0):[];if(Q.info.fromSameSource&&("middle"!==Q.info.dropPosition)&&!G(aa)&&p.isValidPID(X)&&L(Q.draggedItems[aa].type)){if("bottom"===Q.info.dropPosition){U++}Y.splice(U,0,null);M.parameters={instancesPIDsToReparent:[W],formerInstancesParentPIDs:[R.getLastElementAggregatingReferencePID(Z)],newParentPID:X,newParentInstancesOrder:Y};if(k.is(T.reParent,"number")){J.action[aa]="aggregatedAction";J.parameters[aa]=T.reParent;J.message[aa]=null;if(k.is(J.parameters[T.reParent])){J.parameters[T.reParent].instancesPIDsToReparent.push(W);J.parameters[T.reParent].formerInstancesParentPIDs.push(M.parameters.formerInstancesParentPIDs[0]);J.parameters[T.reParent].newParentInstancesOrder.splice(U,0,null)}}else{J.action[aa]="reparent";J.parameters[aa]=M.parameters;J.message[aa]=null;T.reParent=aa}V=true}return V};Q.draggedItems.forEach(function P(U,V){J.action[V]="error";J.parameters[V]=null;J.message[V]=null;if(!E(V)){if(!S(V)){if(!F(V)){if(!I(V)){if(!H(V)){if(!N(V)){this._logger.log("AbstractDragAndDropManager.InternalError")}}}}}}},this);return J},processDropEffect:function f(E){var G=this,J=this,F=[],K=function K(L){o.buildFetchRootsFromDBDialog(L,F,null)},I=new d(function H(W){var P=false,Z={},R=null,T=null,O=z.getNLSValue("AbstractDragAndDropManager.AddRoot"),ac=z.getNLSValue("AbstractDragAndDropManager.AddRootWithError"),N=function N(ae){var ag=new d(function af(al,ai){var am=null,aj=function aj(av,ay){var aw=false,az=ay||{},aq={},an=k.is(az.forceDBMode,"boolean")?az.forceDBMode:false,aA,ax=G.computeAddToTreelistOptions(),at=ax.onEndLoading,ap=ax.context,ar=function ar(){t.publish({event:"DELWebMfgAssetsDefUI/RefreshCmdStateChange",data:true});m.logCompleted(R,ac);ai()},ao=function ao(aC,aB){if(k.is(at,"function")){at.call(ap,aC,aB)}if(k.is(aB)&&!s.shouldLoadRootOnly()){if(!aB.isExpanded()){aB.expand()}}t.publish({event:"DELWebMfgAssetsDefUI/RefreshCmdStateChange",data:true});m.logCompleted(R,O);al()},au;p.references.add(av);au=av.get("displayModel").validate(Z,{silent:true});if(au){if("PPRType"===au.key){if("asRootInTableView"===G._displayModelRootAttribute&&!av.isSystem()){ax=k.merge({withLinksResolved:true,elementUI:"TreeUI",onEndLoading:ao},ax);B.addToTreeList(av,k.merge(ax,{displayMdlRootAttr:"asRootInAuxiliaryView",onFailure:ar,forceDBMode:an}));widget.dispatchEvent("onShowAuxView",[{PPRType:av.get("PPRTYPE")}]);B.AlertManager.add({className:"info",message:z.getNLSValue("AbstractDragAndDropManager.RepositionAuxView")});aw=true}}else{aq[au.param]=au.paramValue;aA=z.getNLSValue(au.key,aq,"ValidationError");m.logFailed(R,aA);aw=true;ai()}}if(!aw){t.publish({event:"DELWebMfgAssetsDefUI/RefreshCmdStateChange",data:false});ax=k.merge({onEndLoading:ao},ax);B.addToTreeList(av,k.merge(ax,{displayMdlRootAttr:G._displayModelRootAttribute,onFailure:ar,forceDBMode:an}))}},ak=function ak(an,ao){if(k.is(ao)){if(k.is(ao.forceDBMode)&&ao.forceDBMode){F.push(an);ai()}else{aj(an,ao)}}else{aj(an,ao)}if(F.length>0&&E.action.length-1===ae){new d(K).then(function(){F.forEach(function(ap){aj(ap,ao)})},ai())}},ah=function ah(){B.AlertManager.add({className:"error",message:z.getNLSValue("AbstractDragAndDropManager.RootNotInDB")});m.logFailed(R,O);ai()};if(G._displayModelRootAttribute){R=m.getNextIndex();m.logStarted(R,O);Z[G._displayModelRootAttribute]=true;am=p.getReferenceFromCollection(E.parameters[ae].rootReferencePID);if(am){ak(am)}else{p.fetchRoot(E.parameters[ae].rootReferencePID,{context:G,onComplete:ak,onFailure:ah})}}else{G._logger.warn("ERROR: Define this._displayModelRootAttribute when extending AbstractDragAndDropManager")}});return ag},L=function L(ae){var af=new d(function ag(aj,ah){var al=function al(ao){var ap=[];if(k.is(ao,"array")){ao.forEach(function am(aq){if(k.is(aq.PID,"string")&&(aq.PID>0)&&k.is(aq.V_TreeOrder)){p.getInstanceFromCollection(aq.PID).set("V_TreeOrder",aq.V_TreeOrder)}});E.parameters[ae].newChildrenPID.forEach(function an(aq){ap.push(p.instances.remove(aq))});p.instances.add(ap)}aj()},ai=null,ak=null;ai={listOrdered:E.parameters[ae].newChildrenPID,listModifiable:[E.parameters[ae].movedInstancePID]};ak={url:"modeler/ppr/persistChildrenOrder",method:"POST",onComplete:al,onFailure:ah,data:k.Json.encode(ai)};g.webServiceRequest(ak)});return af},Y=function Y(ag){var ae=d.reject(),af=k.is(ag,"string")?ag:z.getNLSValue("AbstractDragAndDropManager.InternalError");B.AlertManager.add({className:"error",message:af});G._logger.warn(ag);return ae},Q=function Q(af){var ae=d.resolve();B.AlertManager.add({className:"success",message:af});G._logger.log(af);return ae},aa=function aa(ae){var af=k.is(E.parameters[ae],"array")?E.parameters[ae]:[E.parameters[ae]],ah=[];af.forEach(function ag(al){var ak=p.getReferenceFromCollection(al.referencePID),aj=new d(function ai(aq,an){var ao={onComplete:function ap(ar){aq({rootReferenceMdl:ar,actionIndex:ae})},onFailure:function am(){an(z.getNLSValue("AbstractDragAndDropManager.NoRootReferenceModel"))}};if(k.is(ak)){aq({rootReferenceMdl:ak,actionIndex:ae})}else{p.fetchRoot(al.rootReferencePID,ao)}});ah.push(aj)});return d.all(ah)},U=function U(ag){var ah=ag||[],af=[];ah.forEach(function ae(ak){var aj=new d(function ai(an,am){if(k.is(ak.rootReferenceMdl)){if(p.needToQueryForChildren(ak.rootReferenceMdl.id)){p.getDescendantsFromServer(ak.rootReferenceMdl.id,function al(){an(ak)})}else{an(ak)}}else{am(z.getNLSValue("AbstractDragAndDropManager.NoRootReferenceModel"))}});af.push(aj)});return d.all(af)},ad=function ad(af){var ag=af||[{actionIndex:null}],ae=ag[0].actionIndex,ah=k.is(ae,"number")?E.parameters[ae]:null;return C.getCreateMultipleLinksPromise(ah).then(Q)},M=function M(am){var ae=am||[{actionIndex:null}],an=ae[0].actionIndex,ag=k.is(an,"number")?E.parameters[an]:null,al=[],ak=[],aj=null,ai=true,ah,ao=function ao(ar){var at=z.getNLSValue("CreateLinkUtil.LinkCreationSuccessNoMsg"),aq=k.is(ar[0],"string")&&(ar[0].length>0),ap=k.is(ar[1],"string")&&(ar[1].length>0);if(aq){if(ap){at=ar[0]+"<br>"+ar[1]}else{at=ar[0]}}else{if(ap){at=ar[1]}}return d.resolve(at)};if(k.is(ag,"array")){ag.forEach(function af(ar){var aq=p.getReferenceFromCollection(ar.referencePID),ap=p.getReferenceFromCollection(ar.targetReferencePID);if(k.is(aq)&&k.is(ap)){if((aq.isProduct()||aq.isPart())&&ap.isProcess()){al.push(ar)}else{ak.push(ar)}}else{aj=d.reject("AbstractDragAndDropManager.DropEffectError")}})}if(!k.is(aj)){if(g.isNavigateOn()==="indexOndemand"){if(ak.length===0){ah=[{instancePID:al[0].targetInstancePID,referencePID:al[0].targetReferencePID}]}else{ah=ak}}ai=B.getMGAElement(J._elementUI).options.treeDocument.areRelationsLoaded(ah);if(ai){aj=d.all([C.getCreateMultipleLinksPromise(ak),C.getConsumeMultipleEBOMPromise(al)])}else{B.AlertManager.add({className:"error",message:z.getNLSValue("Error.RelationsNotLoaded.Title")});return}}return aj.then(ao).then(Q)},X=function X(ae){var af=new d(function ag(aj,ah){var ai=k.merge({onComplete:aj,onFailure:ah},E.parameters[ae]);C.moveInstance(ai)});return af},S=function S(ag){var af=new d(function ae(aj,ai){if(k.is(ag,"array")){ag.forEach(function ah(am){var al=p.getReferenceFromCollection(am),ak=function ak(an){var ao={};if(G._view.isAcceptedType(an)){ao.action=["addRoot"];ao.parameters=[{rootReferencePID:an.id}];ao.message=[null]}else{ao.action=["error"];ao.parameters=[null];ao.message=[z.getNLSValue("Drop.NotValidType.Title")]}f.call(G,ao).then(aj,ai)};if(al){ak(al)}else{p.fetchRoot(am,{context:G,onComplete:ak,onFailure:ai})}},G)}});return af},V=function V(ai,ag){var aj=null,af,al,ah,ae,am,ak;switch(ai){case"addRoot":aj=N(ag);break;case"addChangeAction":aj=g.setCAAndGetDetailsPromise(E.parameters[ag].rootReferencePID).then(S,Y);break;case"createLink":aj=aa(ag).then(U).then(M).fail(Y);break;case"createLinkOrInstance":aj=aa(ag).then(U).then(ad).fail(Y);break;case"reorderRoots":aj=N(ag);break;case"reorder":aj=L(ag);break;case"reparent":af=p.getReferenceFromCollection(E.parameters[ag].newParentPID);ak=false;ae=E.parameters[ag].instancesPIDsToReparent;for(am=0;am<ae.length;am++){ah=ae[am];al=p.getReferenceFromInstancePID(ah);if(!b.isInstancePossible(af,al)){ak=true;break}}if(!ak){aj=X(ag)}else{aj=d.resolve()}break;case"aggregatedAction":aj=d.resolve();break;case"error":aj=Y(E.message[ag]);break;default:aj=Y("AbstractDragAndDropManager.DropEffectError");break}return aj};if(k.is(E)){if(k.is(E.action,"array")){E.action.forEach(function ab(ag,ae){var af=function af(){return V(ag,ae)};if(k.is(T)){T=T.then(af,af)}else{T=V(ag,ae)}},this);T.then(W,W)}}return P});return I},onTreeListViewDrop:function h(I,H){var E=true,F=this.getDragNDropInfo(I,H),G;if(k.is(F)){G=this._computeDropEffect(F);if(k.is(G)){this.processDropEffect(G)}}return E}});return r});define("DS/DELWebMfgAssetsDefUIServices/TableViewDDManager",["UWA/Core","DS/Logger/Logger","UWA/Class","DS/DELWebMfgAssetsDefUIServices/AbstractDragAndDropManager","DS/DELWebMfgAssetsDefUIServices/UIUtils"],function(f,d,c,e,b){var a=function(g){var j;j=e.singleton({name:"ViewDragAndDropManager",_logger:null,_DropZoneSTO:null,init:function(n){var o;this._parent(n);if(d){this._logger=d.getLogger(j)}o=this.getOption("dropZoneName");if(f.is(o)){this._dropZone=b.getMGAElement(o);this._dropZone.addEventListener("drop",function(p){p.preventDefault();j.onTreeListViewDrop(p);if(j._DropZoneSTO!==null){clearTimeout(j._DropZoneSTO);j._DropZoneSTO=null}j._dropZone.visibleDockingZoneFlag=false;j._dropZone.collapseDockingZoneFlag=true});this._dropZone.addEventListener("dragover",function(p){p.preventDefault()})}},onDragEnterColumnHeader:function m(){var n;if(f.is(j._dropZone)){if(!j._dropZone.visibleDockingZoneFlag){j._dropZone.visibleDockingZoneFlag=true;n=j._dropZone.getModel();n.elements.dockingZone.style.zIndex=200;j._DropZoneSTO=setTimeout(function(){j._dropZone.visibleDockingZoneFlag=false;j._DropZoneSTO=null},5000)}}},onDragLeaveColumnHeader:function l(){return true},onDropCell:function i(o,n){return j.onTreeListViewDrop(o,n)},onDropBlank:function k(o,n){return j.onTreeListViewDrop(o,n)}});j.init(g);return{getDDBehavior:function(){return j.getDDBehavior()},processDropEffect:function h(n){return j.processDropEffect(n)}}};return a});