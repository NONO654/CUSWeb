define("DS/SMAProcJobListingUI/JobListingWidget",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/WAFData/WAFData","DS/UIKIT/Alert","DS/DataDragAndDrop/DataDragAndDrop","DS/SMAProcJobListingUI/Data","DS/SMAProcJobListingUI/Collection/IdCollection","DS/SMAProcJobListingUI/Collection/CollabStorageCollection","DS/SMAProcJobListingUI/Model/SimulationJob","DS/W3DXComponents/Skeleton","DS/SMAProcJobListingUI/EnoviaBootstrap","DS/SMAProcJobListingUI/SkeletonUtils/JobListingSkeletonOptions","i18n!DS/SMAProcJobListingUI/assets/nls/JobListingWidget","DS/PlatformAPI/PlatformAPI","css!DS/SMAProcJobListingUI/SMAProcJobListingUI"],function(D,n,N,k,h,t,H,a,y,O,Q,M,q,g,A){var B,x,L,i,l=false,v,r,s=false,f="SMAProcJobListingUI",C=["Simulation","Simulation Process"],w,E,G,I=false,d=function(){return window.widget};function P(){if(localStorage.getItem("PS_INTERNAL")==="true"){A.subscribe("SIMJDIS_AP:refresh",function(R){if(R.objectId){i.onRefresh()}})}}function o(S){var R,T=d().getValue("view-access")==="*"?g.all_label:g.owned_label;if(this instanceof Q){R=this.getCurrentPanelIndex();S=this.getModelAt(R)}if(S instanceof O){T=S.get("title");T=T.unescapeHTML()}return d().setTitle(T)}function c(){if(r.length===0&&w&&w.title){var S=g.replace(g.noJobs,{tag1:w.title});B.add({className:"primary",message:S})}if(L){L.destroy();o()}var R,T;T={channelView:d().getValue("main-view")==="channel",events:{onSlide:function(U,V){o.call(this,V)},onRouteChange:function(U){var V=new RegExp(this.rootRendererName+"/$");if(V.test(U)&&D.is(w)){w=undefined;i.onRefresh.apply(null)}},onItemSelect:o},idsCollection:r,processData:w};R={minimizeIdCardView:true,idsCollection:r,moduleName:f,processData:w};L=new Q(q.getRendererMap(R),q.getRootIdCardOptions(T));L.render().inject(d().body.getElement("#widget-content"));if(x){L.setHeight(x)}}function K(){r.orgModels=r._models;return null}var z=function(W){var T,S=[];if(!W){return}if(W.filteredSubjectList.length===0){return}for(T=0;T<W.filteredSubjectList.length;T+=1){var U=W.filteredSubjectList[T];S[T]=U.replace("pid://","")}var R=[];for(var V=0;V<r.orgModels.length;V+=1){if(S.indexOf(r.orgModels[V].id)>-1){R.push(r.orgModels[V])}}r._models=R;c()};function b(){var S=[];for(var R=0;R<r.length;R++){S.push({id:r._models[R].id})}E.refresh(S)}function F(){var S=[];for(var R=0;R<r.length;R++){S.push({id:r._models[R].id})}E=D.createElement("sp-6wtagger");E.inject(d().body);E.filtercallback=z.bind(this);E.init(S)}function j(R,T){var S;if(R){S=R[T];if(D.is(S,"function")){S=S.call(R)}}return S}function e(){var R=null;R=G.get(widget.getValue("x3dPlatformId")).get("url");H.initialize(R);r=new a({owner:d().getValue("view-access"),limit:d().getValue("nb-items")});r.fetch({onComplete:function(){c();F();K()},onFailure:function(){B.add({message:g.errorFetchContents,clasName:"error"})}});I=false}function m(V){if(!V){return}var T,R={type:"list",name:"collab-storage",label:g.storage_label,options:[],onchange:"onStorageChange"},U=d().getValue("collab-storage");if(U===""){var S=d().getValue("x3dPlatformId");T=V.get(S);if(!T){T=V.at(0)}if(T){d().setValue("collab-storage",T.id)}}else{T=V.get(U)}V.forEach(function(W){var Y,X;X=W.get("displayName").unescapeHTML();Y=W.get("id");R.options.push({label:X,value:Y})});T=d().getValue("x3dPlatformId");if(s){d().dispatchEvent("onEdit",["refreshPrefs"])}if(T){i.onStorageChange("collab-storage",T)}else{B.add({message:g.updatePreference,className:"warning"})}return T}function J(){var R=window.widget.getValue("x3dPlatformId");if(R!=="OnPremise"){var S={name:"WAtenantId",type:"list",label:"Platform"};S.options=[{value:R,label:R}];S.defaultValue=R;d().setValue("WAtenantId",S.defaultValue);d().addPreference(S)}}function u(U){if(!U){return}var T=U.cspaces;var S,W={type:"list",name:"collab-space",label:g.space_label,options:[]},V=d().getValue("collab-space");if(V===""||!D.is(V)){var R=T.filter(function(X){return X.isDefault===true});S=R[0]||T[0];d().setValue("collab-space",S.name)}T.forEach(function(Y){var Z,X;X=Y.displayName;Z=Y.name;W.options.push({label:X,value:Z});if(Z===V){S=Z}});if(T.length===1&&S){W.type="hidden"}d().addPreference(W);if(s){d().dispatchEvent("onEdit",["refreshPrefs"])}if(!D.is(S)){B.add({message:g.updateCollaborativeSpacePref,className:"warning"})}return S}function p(){if(l){return}if(!d()){throw new Error("Job Listing must be executed in a widget environement")}v=new y();o();l=true}i={onLoad:function(){var R;B=new h({className:"csg-alert",closable:true,renderTo:document.body,visible:true,autoHide:false,fullWidth:true,messageClassName:"error"});M.start({id:d().id,collection:v});P();v.fetch({onComplete:function(S){J();m(S);I=true;G=S},onFailure:function(){B.add({message:g.errorFetchStorages,className:"error"})}});d().setBody([{tag:"div",id:"widget-content"}]);R=d().getElement("#widget-content");t.droppable(R,{drop:function(S){var V=null;var U;try{V=JSON.parse(S);if(V.source==="SIMJDIS_AP"){return false}}catch(T){V=null;U=T;if(!V&&window.console&&window.console.error){window.console.error("drop: Failed to parse data",U,S)}}if(V&&V.data&&V.data.items){var W=V.data.items[0];if(W&&C.indexOf(W.objectType)>-1){w={};w.id=W.objectId;w.title=W.displayName;i.onRefresh.apply(null)}else{console.error("some error")}}}})},onViewChange:function(S){var R;if(S.type==="maximized"){R=x=S.height-parseFloat(d().body.getStyle("paddingBottom",true).split("px")[0])}else{x=null}if(L){!R&&(R=(L.getCurrentPanelIndex()===0&&L.options.useRootChannelView)?L.options.channelViewHeight:L.options.height);L.setHeight(R)}},onRefresh:function(){H.initialize(j(M.getStorage(),"url"));r=new a({owner:d().getValue("view-access"),limit:d().getValue("nb-items"),simulationId:w?w.id:null});r.fetch({onComplete:function(){c();b()},onFailure:function(){B.add({message:g.errorFetchContents,clasName:"error"})}});K();if(d().taggerProxy){d().taggerProxy.clearLocalFilter()}},onEdit:function(S){s=true;if(S!=="refreshPrefs"){var R={type:"list",name:"collab-storage",label:g.storage_label,options:[{label:g.loading_label,value:""}],onchange:"onStorageChange"};d().dispatchEvent("onEdit",["refreshPrefs"]);v.fetch({onComplete:function(T){m(T);G=T}})}},endEdit:function(){s=false},onStorageChange:function(S,T){var X=v.get(T);var V,R,U;M.onStorageChange(X);var W={type:"list",name:"collab-space",label:g.space_label,options:[{label:g.loading_label,value:""}]};if(s){d().addPreference(W);d().dispatchEvent("onEdit",["refreshPrefs"])}V=j(M.getStorage(),"url");U=V+"/resources/bps/cspaces";if(d().getValue){U=U+"?tenant="+T}R={onComplete:function(Y){d().setValue("x3dPlatformId",T);u.call(undefined,Y);if(I){e()}},onFailure:function(){B.add({message:g.errorFetchCollabSpaces,clasName:"error"})},type:"json"};D.extend(R,M.getSyncOptions());k.authenticatedRequest(U,R)},getSkeletionObject:function(){return L}};p();return i});