define("DS/ENOXVersionExplorerSubwayListView/VersionExplorerColumnManager",["UWA/Core","DS/GraphListView/ColumnManagerBase","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","i18n!DS/ENOXVersionExplorerSubwayListView/assets/nls/SubwayColumnsTitles"],function(e,b,d,a,c){return b.extend({init:function(f){this._parent(f);this.setDefaultColumns([{dataIndex:"bi_color",onCellRequest:function(i){if(!i.isHeader){var h=i.nodeModel;var g=i.cellView.getContent();i.cellView.getContent().empty();if(h.__MASTER__._isHighlighted){g.setContent(e.createElement("div",{"class":"version-explorer-listview-connection-state",html:["<span>",'<div class="highlighted" style="background:'+h.__MASTER__.__BRANCH__.data.color+'" ></div>',"</span>"].join("\n")}))}else{g.setContent(e.createElement("div",{"class":"version-explorer-listview-connection-state",html:["<span>",'<div class="unhighlighted"></div>',"</span>"].join("\n")}))}}}},{dataIndex:"__GRAPH__",sortFunction:function(h,g){return h.options.creationDate<g.options.creationDate?-1:1},onCellRequest:function(i){if(i.isHeader){var h=i.cellView._cellInfos;var g=h.manager.getOrderedColumnState();if(g.dataIndex==="creationDate"||g.dataIndex==="__GRAPH__"){i.cellView.getContent().addClassName("wux-ui-sort-"+g.sortOrder)}else{i.cellView.getContent().removeClassName("wux-ui-sort-asc");i.cellView.getContent().removeClassName("wux-ui-sort-desc")}}}},{width:250,dataIndex:"tree",onCellRequest:function(o){if(!o.isHeader){var n=o.nodeModel;var h=n.getTreeDocument()._DATA_MODEL_TYPE;if(!(h===a.DATA_MODEL_TYPES.MODEL_P||h===a.DATA_MODEL_TYPES.MODEL_REVISION)){var j=o.cellView.getContent();if(!j.getElement(".with-version-semantic")){j.setContent(e.createElement("div",{"class":"with-version-semantic",html:["<span>",'<div class="symbol"></div>','<div class="title"></div>',"</span>"].join("\n")}))}var m=j.getElement(".symbol"),l,g;if(n.options.ancestors&&n.options.ancestors.length){m.show();for(var k=0;k<n.options.ancestors.length;k++){if(!l||n.options.ancestors[k].semantic==="I"){l=n.options.ancestors[k].icon}if(n.options.ancestors[k].semantic!=="I"){g=n.options.ancestors[k].semantic}}if(l){m.setHTML('<img src="'+l+'">');m.setStyle("background-color","transparent")}else{m.setHTML(g);m.setStyle("background-color",null)}}else{m.hide()}j.getElement(".title").setContent(n.options.label)}else{o.cellView.getContent().setContent(o.nodeModel.options.label)}}},customCellView:{id:"thumbnail_cell",buildContent:function(){return new e.Element("div",{styles:{height:"80px","background-repeat":"no-repeat","background-size":"contain","background-position":"center center"}})}}}])},_customizeColumnView:function(f){var f=this._parent(f);if(f.dataIndex==="modified"){f.onCellRequest=function(i){if(!i.isHeader){var h=i.nodeModel;var g=navigator.language||navigator.browserLanguage;(h.options.grid[i.dataIndex] instanceof Date)&&i.cellView.getContent().setHTML(h.options.grid[i.dataIndex].toLocaleString(g))}f.width=163}}else{if(f.dataIndex==="creationDate"){f.onCellRequest=function(k){if(!k.isHeader){var j=k.nodeModel;var g=navigator.language||navigator.browserLanguage;(j.options.grid[k.dataIndex] instanceof Date)&&k.cellView.getContent().setHTML(j.options.grid[k.dataIndex].toLocaleString(g))}else{var i=k.cellView._cellInfos;var h=i.manager.getOrderedColumnState();if(h.dataIndex==="creationDate"||h.dataIndex==="__GRAPH__"){k.cellView.getContent().addClassName("wux-ui-sort-"+h.sortOrder)}else{k.cellView.getContent().removeClassName("wux-ui-sort-asc");k.cellView.getContent().removeClassName("wux-ui-sort-desc")}}f.width=163}}else{if(f.dataIndex==="code"){f.width=75}else{if(f.dataIndex==="current"){f.width=150}else{if(f.dataIndex==="resp"){f.width=225}else{if(f.dataIndex==="thumbnail"){f.text="";f.width=80;f.onCellRequest=function(h){if(!h.isHeader){var i=h.nodeModel.options.grid.thumbnail||h.nodeModel.options.grid.icon;var g=h.cellView.reuseCellContent("thumbnail_cell");if(g){g.style.backgroundImage="url("+h.nodeModel.options.grid.thumbnail+")"}}};f.cellClickCB=function(g){if(g.cellModel){require(["DS/PADUtils/views/PADThumbnail"],function(h){var i=new h({cellModel:g.cellModel});i._modal.elements.body.getElement(".padthumbnail_main").setStyle("background-image","url("+g.cellModel.options.value+")")})}}}}}}}}return f},getColumns:function(){var f=this._parent();if(d.historyConfig&&d.historyConfig.settings&&d.historyConfig.settings.subwayGraph&&Array.isArray(d.historyConfig.settings.subwayGraph.sortColumns)&&d.historyConfig.settings.subwayGraph.sortColumns.length){f.forEach(function(g){g.isSortable=d.historyConfig.settings.subwayGraph.sortColumns.indexOf(g.dataIndex)>=0?true:false})}return f},})});define("DS/ENOXVersionExplorerSubwayListView/VersionExplorerSubwayListView",["UWA/Core","DS/GraphListView/GraphListView","DS/ENOXVersionExplorerSubwayListView/VersionExplorerColumnManager","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Mask","css!DS/ENOXVersionExplorerSubwayListView/styles/VersionExplorerSubwayListView"],function(f,h,k,a,l,g,b,d,i){function c(n){this.addChild(n.data.nodeModel)}function m(n){this.removeChild(n.data.nodeModel)}function j(t){var s=this,p=[];if(t[0]&&t[1]){var r=t[0].__SUBWAYGRAPHNODE__.data.parentEdges.find(function(v){return v.parentNode===t[1].__SUBWAYGRAPHNODE__})||t[0].__SUBWAYGRAPHNODE__.data.childEdges.find(function(v){return v.childNode===t[1].__SUBWAYGRAPHNODE__});if(r){p.push(r)}else{var o;for(var q=0,n=this._grMergeConnections.length;q<n;q++){var u=this._grMergeConnections[q];if(u.grParent===t[0].__SUBWAYGRAPHNODE__&&u.grChild.__SUBWAYGRAPHNODE__===t[1]||u.grParent===t[1].__SUBWAYGRAPHNODE__&&u.grChild===t[0].__SUBWAYGRAPHNODE__){o=u;break}}if(o){if(o.edge){p.push(o.edge)}else{if(o.edges){p=o.edges}}}}}return p}var e=h.extend({_options:undefined,init:function(n){this._options=f.extend({columnManager:new k(n),customOnDrop:n.customOnDrop,defaultCellHeight:48,enableListSelection:true,onDragStartCell:function(q,r){var o=r.nodeModel._options.data;var s={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:[{envId:b.getTenant(),serviceId:"3DSpace",contextId:"",objectId:o.id,objectType:o.type,displayName:o.displayName+" "+o.revision,session_object:false}]}};try{q.dataTransfer.effectAllowed="uninitialized";q.dataTransfer.setData("text/searchitems",JSON.stringify(s));q.dataTransfer.setData("Text",JSON.stringify(s))}catch(p){q.dataTransfer.setData("Text",JSON.stringify(s))}},onDropCell:function(o,p){if(typeof this.options.customOnDrop==="function"){this.options.customOnDrop(o)}},onDropBlank:function(o,p){if(typeof this.options.customOnDrop==="function"){this.options.customOnDrop(o)}},onDropColumnHeader:function(p,o){return true},graphSortingColumnID:["creationDate","__GRAPH__"],ascending:a.UserSettings.subwaySortAscending,enableActiveUI:true,enableKeyboardNavigation:true},n);this._parent(this._options)},updateSelectionMode:function(){var n=this._manager;this.prepareUpdateColumns();n.getColumnIDFromDataIndex("__DROPDOWN__")&&this.options.columnManager[(this._model._SELECTION_MODE&l.SELECTION_MODES.WITH_COMMANDS?"showColumns":"hideColumns")](["__DROPDOWN__"]);if(!(this._model._SELECTION_MODE&l.SELECTION_MODES.MULTI_SELECT_ONLY)){n.options.selection.canMultiSelect=false;this.options.columnManager.hideColumns(["selection"]);(this._model.getXSO().get().length>1)&&this._model.getXSO().empty()}else{n.options.selection.canMultiSelect=true;this.options.columnManager.showColumns(["selection"])}this.pushUpdateColumns();(!(this._model._SELECTION_MODE&l.SELECTION_MODES.MULTI_SELECT_ONLY)||!(this._model._SELECTION_MODE&l.SELECTION_MODES.MULTI_SELECT_ACTIVE))&&(this._treeDoc.getXSO().get().length>1)&&this._treeDoc.getXSO().empty()},onSelectListView:function(o){if(!(this._model._FILTER_ENABLED&&!o.data.nodeModel.__MASTER__.getAttribute("__filter__"))){this._parent(o);var n=this._model.getXSO().get();if(!(this._model._SELECTION_MODE&l.SELECTION_MODES.MULTI_SELECT_ACTIVE)&&n.length>1){for(var p=0;p<n.length;p++){n[p].options.grid.__checked__=true}o.data.nodeModel.__MASTER__._modelEvents.publish({event:"_ENOXVersionExplorerManageMultiSelect",data:false})}this._manager.forceMultiSelection(!!(this._model._SELECTION_MODE&l.SELECTION_MODES.MULTI_SELECT_ACTIVE))}else{if(this._model._FILTER_ENABLED&&!o.data.nodeModel.__MASTER__.getAttribute("__filter__")){o.data.nodeModel.unselect();this._processMask(o.data.nodeModel._getRowID(),true)}}},onUnselectListView:function(n){this._parent(n);this._manager.forceMultiSelection(!!(this._model._SELECTION_MODE&l.SELECTION_MODES.MULTI_SELECT_ACTIVE))},onHighlightNode:function(n){this._manager.showColumn("bi_color")},onUnhighlightNode:function(n){this._manager.showColumn("bi_color")},onHighlightLink:function(n){var p=this._graph,o=j.bind(this)(n.data);p.withLockedUpdate(function q(){o.forEach(function(r){p.addToSelection(r)})})},onUnhighlightLink:function(n){var p=this._graph,o=j.bind(this)(n.data);p.withLockedUpdate(function q(){o.forEach(function(r){p.removeFromSelection(r)})})},_addEventListeners:function(){var n=this;this._parent();this._addEvent("LISTVIEWMANAGER","preFullUpdateView",function(o){n._manager.onPostUpdateViewOnce(function(p){n.onUpdateViewComplete.bind(n)(p)})});this._addEvent("LISTVIEWMANAGER","showColumn",function(p){var o=n._manager.getDataIndexFromColumnID(p.columnID);if(o==="creationDate"){n._manager._setColumnState(p.columnID,"sort:"+(n.options.ascending?"asc":"desc"))}});this._addEvent("LISTVIEWMANAGER","click",function(p){var o=n._manager.options.columns.find(function(q){return q.dataIndex===p.dataIndex});if(o&&typeof o.cellClickCB==="function"){o.cellClickCB(p)}});n._addEvent("MASTER","highlight",n.onHighlightNode.bind(this));n._addEvent("MASTER","unhighlight",n.onUnhighlightNode.bind(this));n._addEvent("MASTER","highlightLink",n.onHighlightLink.bind(this));n._addEvent("MASTER","unhighlightLink",n.onUnhighlightLink.bind(this))},onMasterNodeAttributeChanged:function(n){var o=n.data||n;this._parent(n);this.onUpdateViewComplete(n)},_setActive:function(o){var n=this._manager;n[(o.__MASTER__.isActive()?"addRowClass":"removeRowClass")](o._getRowID(),"version-explorer-subway-listview-active-version")},_setFilter:function(p){var n=this._manager;var o=p._getRowID();if(this._model._FILTER_ENABLED&&!p.__MASTER__.getAttribute("__filter__")){this._processMask(o,true)}},onUpdateViewComplete:function(p){var r=this._manager,s=this,o;if(p.event==="attributeChanged"){o=p.data.nodeModel}if(o&&o.__LISTVIEWCOPY__){this._setActive(o.__LISTVIEWCOPY__);this._setFilter(o.__LISTVIEWCOPY__)}else{for(var q=0,t,u=this._treeDoc.getAllDescendants(),n=u.length;q<n;q+=1){t=u[q];this._setActive(t);this._setFilter(t)}}},_processMask:function(q,o){var p=this._manager;var n;p.processCellsOfRow({rowID:q,minColumnID:0},function(r,t,s){n=r.getView();if(n){if(o){d.mask(n.getContent(),"");n.getContent().getElement(".spinner").hide()}else{d.unmask(n.getContent())}}})},onSort:function(n){var o=this;if(n.columnDataIndex==="__GRAPH__"){if(o._manager.getColumnIDFromDataIndex("creationDate")>=0){this._manager.sortColumnContent("creationDate",{typeOfCell:"number",sortOrder:(this.options.ascending===true)?"desc":"asc"})}}else{this._parent(n)}if(n.columnDataIndex==="creationDate"){a._saveUserSettings("subwaySortAscending",this.options.ascending,this._model.isCompare)}},updateNodes:function(){this._parent();this._manager.sortColumnContent(this._manager.getColumnIDFromDataIndex("creationDate")>=0?"creationDate":"__GRAPH__",{typeOfCell:"number",sortOrder:(this.options.ascending===true)?"asc":"desc"})},deactivate:function(){this._parent();var n=this._graph;n.withLockedUpdate(function o(){for(var p,q=n.edges.first;q;q=p){p=q.next;if(q.isSelected()){n.removeFromSelection(q)}}})},activate:function(){this._parent();var o=this._model.getHighlightedLinksData(),p=[],r=this._graph;if(o.length){for(var q=0,n=o.length;q<n;q++){p=p.concat(j.bind(this)(o[q]))}}r.withLockedUpdate(function s(){p.forEach(function(t){r.addToSelection(t)})})},prepareUpdateView:function(){this._removeEvent("MASTER","select");this._removeEvent("MASTER","unselect");this._removeEvent("MASTER","attributeChanged");this._parent()},pushUpdateView:function(){this._parent();this._addEvent("MASTER","select",this.onSelectMaster.bind(this));this._addEvent("MASTER","unselect",this.onUnselectMaster.bind(this));this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this))},setRowHeight:function(o){var p=this.options.columnManager.getColumns(),n=p.findIndex(function(q){return q.dataIndex==="thumbnail"&&!q.isHidden})>=0?80:o;this._parent(n)}});return e});