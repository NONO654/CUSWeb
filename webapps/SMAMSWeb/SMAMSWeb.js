/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSGenerateConfigFile",["UWA/Core","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","text!DS/SMAMSWeb/assets/IntVar/fsi_std.xml","text!DS/SMAMSWeb/assets/IntVar/fsi_cfd.xml","text!DS/SMAMSWeb/assets/IntVar/cht_std.xml","text!DS/SMAMSWeb/assets/IntVar/cht_cfd.xml","text!DS/SMAMSWeb/assets/IntVar/em1_a.xml","text!DS/SMAMSWeb/assets/IntVar/em1_b.xml","text!DS/SMAMSWeb/assets/IntVar/em2_a.xml","text!DS/SMAMSWeb/assets/IntVar/em2_b.xml","text!DS/SMAMSWeb/assets/IntVar/sxs_std.xml","text!DS/SMAMSWeb/assets/IntVar/sxs_xpl.xml","text!DS/SMAMSWeb/assets/IntVar/sxl_std.xml","text!DS/SMAMSWeb/assets/IntVar/sxl_xpl.xml","text!DS/SMAMSWeb/assets/IntVar/iht_std.xml","text!DS/SMAMSWeb/assets/IntVar/iht_cst.xml","DS/SMAMSExecutionServices/SMAMSExecutionServices","UWA/Class"],function(g,f,a,e,p,l,c,o,b,n,d,h,j,k,i,m,t,r){var s={};s.separateVars=function(v){var u={};u.ic=v.getElementsByTagName("InitialConditionVariables")[0].getElementsByTagName("variables")[0];u.cs=v.getElementsByTagName("CouplingStepVariables")[0].getElementsByTagName("variables")[0];u.spec=v.getElementsByTagName("SpecVariables")[0].getElementsByTagName("variables")[0];return u};var q=g.Class.extend({init:function(v,u){this.option=v;this.model=u},submit:function(b5,aF,a4){var C=this;var Q=g.Utils.loadXml(a).firstChild;var aZ=g.Utils.loadXml(e).firstChild;var aq=g.Utils.loadXml(p).firstChild;var a7=g.Utils.loadXml(l).firstChild;var au=g.Utils.loadXml(c).firstChild;var at=g.Utils.loadXml(o).firstChild;var bA=g.Utils.loadXml(b).firstChild;var by=g.Utils.loadXml(n).firstChild;var av=g.Utils.loadXml(d).firstChild;var v=g.Utils.loadXml(h).firstChild;var ap=g.Utils.loadXml(j).firstChild;var cc=g.Utils.loadXml(k).firstChild;var W=g.Utils.loadXml(i).firstChild;var aC=g.Utils.loadXml(m).firstChild;Q=s.separateVars(Q);aZ=s.separateVars(aZ);aq=s.separateVars(aq);a7=s.separateVars(a7);au=s.separateVars(au);at=s.separateVars(at);bA=s.separateVars(bA);by=s.separateVars(by);av=s.separateVars(av);v=s.separateVars(v);ap=s.separateVars(ap);cc=s.separateVars(cc);W=s.separateVars(W);aC=s.separateVars(aC);var aT=b5;var bm='<?xml version="1.0" encoding="UTF-8"?>';bm=bm+"<CoupledMultiphysicsSimulation>";bm=bm+"<header>";bm=bm+"<SchemaVersion>1.1</SchemaVersion>";bm=bm+"</header>";bm=bm+"<components/>";bm=bm+"<componentInstances/>";bm=bm+"<connectors/>";bm=bm+"<connectionSets/>";bm=bm+"<mappingSpecifications/>";bm=bm+"<modulationSpecifications/>";bm=bm+"<execution>";bm=bm+"<compositeActors>";bm=bm+'<compositeActor name="continuousTime">';bm=bm+"<actors>";bm=bm+"</actors>";bm=bm+"<modelOfComputation>";bm=bm+"<continuousTime>";bm=bm+"</continuousTime>";bm=bm+"</modelOfComputation>";bm=bm+"</compositeActor>";bm=bm+"</compositeActors>";bm=bm+"<connectionGroups>";bm=bm+'<connectionCategory name="InitialConditions">';bm=bm+"</connectionCategory>";bm=bm+'<connectionCategory name="CouplingStep">';bm=bm+"</connectionCategory>";bm=bm+"</connectionGroups>";bm=bm+"<scenario>";bm=bm+"<duration>";bm=bm+"</duration>";bm=bm+"</scenario>";bm=bm+"</execution>";bm=bm+"</CoupledMultiphysicsSimulation>";var bx=g.Utils.loadXml(bm);var ba='<?xml version="1.0" encoding="UTF-8"?>';ba=ba+"<SIMULIA_CSE_3D>";ba=ba+'<Abaqus duration ="'+aF.getDuration()+'"/>';ba=ba+"<Regions/>";ba=ba+"</SIMULIA_CSE_3D>";var ca=g.Utils.loadXml(ba);var H=bx.getElementsByTagName("components")[0];var Z=bx.getElementsByTagName("actors")[0];var a1=bx.getElementsByTagName("componentInstances")[0];for(var bn=aT.nodes.first;bn;bn=bn.next){if(!bn.data){continue}var b8=bn.data.RFLComponent.reference;var b6=bn.data.RFLComponent;var an=b6.getID();var bT=null,aR=null,aQ=null,aP=null,aM=null,aL=null,aJ=null;bT=bx.createElement("component");bT.setAttribute("name",an);var b4=b6.getSelectedBehavior();if(b4){H.appendChild(bT);if(b4.sim){aR=bx.createElement("bottomUpImplementation")}else{if(b4.fmu){aR=bx.createElement("topDownImplementation")}}bT.appendChild(aR);aQ=bx.createElement("identifier");aR.appendChild(aQ);aP=bx.createTextNode(an);aQ.appendChild(aP);if(b4.sim){aM=bx.createElement("codeName");aR.appendChild(aM);aL=bx.createTextNode(b4.codeName);aM.appendChild(aL)}bT=bx.createElement("componentInstance");bT.setAttribute("modelIdentifier",an);bT.setAttribute("name",an);a1.appendChild(bT);aR=bx.createElement("component");bT.appendChild(aR);aP=bx.createTextNode(an);aR.appendChild(aP);aM=bx.createElement("timeIncrementation");bT.appendChild(aM);aL=bx.createElement("lockstep");aM.appendChild(aL);var bG=false;aJ=bx.createTextNode(bG);aL.appendChild(aJ);aM=bx.createElement("initialConditions");bT.appendChild(aM);aL=bx.createElement("sendBeforeReceive");aM.appendChild(aL);var bV=true;if(b4.codeName==="CFD"){bV=false}aJ=bx.createTextNode(bV);aL.appendChild(aJ);var bs=ca.cloneNode(true).firstChild;a4[an]=bs;if(b4.sim&&b4.is3dfmu&&b4.clientSolverParameters){var F=g.Utils.loadXml(b4.clientSolverParameters);a4[an].appendChild(ca.cloneNode(true).importNode(F,true));if(t.isCloud){var b3=b4.clientSolverParameters.getElementsByTagName("Execution");for(var bt=0;bt<b3.length;bt++){var u=b3[bt].getAttribute("codeName");if(u&&(u==="Abaqus/Standard"||u==="Abaqus/Explicit")){var az=b4.clientSolverParameters.getElementsByTagName("argument");var aN="1";for(var br=0;br<az.length;br++){if(az[br].getAttribute("parameter")==="-cpus"){aN=az[br].getAttribute("value");break}}var a5=g.Utils.loadXml("<systemEnvVariables></systemEnvVariables>").firstChild;var ac=ca.createElement("variable");var b1=ac.cloneNode(true);b1.setAttribute("parameter","SMA_ABQSTUDY");b1.setAttribute("value","1");a5.appendChild(b1);var b2=ac.cloneNode(true);b2.setAttribute("parameter","ABQLMIMPL");b2.setAttribute("value","DSLS");a5.appendChild(b2);var aj=ac.cloneNode(true);aj.setAttribute("parameter","ABQCUSTID");aj.setAttribute("value",t.WUTenantID);a5.appendChild(aj);var Y=ac.cloneNode(true);Y.setAttribute("parameter","ABQ_USERUVM_PVM");Y.setAttribute("value",aN);a5.appendChild(Y);var aK=ac.cloneNode(true);aK.setAttribute("parameter","ABQDSLSSERVER");aK.setAttribute("value",t.dslsServer);a5.appendChild(aK);var aO=ac.cloneNode(true);aO.setAttribute("parameter","SMA_MAXCPUS");aO.setAttribute("value","64");a5.appendChild(aO);var bJ=b3[bt].getElementsByTagName("systemEnvVariables");if(bJ.length>0){b3[bt].replaceChild(a5,bJ[0])}else{b3[bt].appendChild(a5)}}}}}bT=bx.createElement("atomicActor");aR=bx.createTextNode(an);if(b6.getInfo().name===aF.getLeadActor()&&Z.childNodes.length){Z.insertBefore(bT,Z.childNodes[0])}else{Z.appendChild(bT)}bT.appendChild(aR)}for(var A in b8.connectors){var bz=b8.getConnector(A);var aS=0;for(var T=0;T<b8.instances.length;T++){if(b8.instances[T].connectors[bz.name]&&b8.instances[T].connectors[bz.name].length){aS++}}if(aS===0){continue}var bX=null,bW=null,aI=null,aH=null;if(bz.type==="Real"||bz.type==="Boolean"||bz.type==="Integer"||bz.type==="Enumeration"||bz.type==="String"){var bR=bx.getElementsByTagName("connectors")[0];var ar=bz.name;var bd=an+"_"+ar;bT=bx.createElement("connector");bT.setAttribute("name",bd);bR.appendChild(bT);bX=bx.createElement("componentInstance");bT.appendChild(bX);aI=bx.createTextNode(an);bX.appendChild(aI);bX=bx.createElement("variables");bT.appendChild(bX);if(bz.causality==="I"){bW=bx.createElement("input")}else{bW=bx.createElement("output")}bX.appendChild(bW);aI=bx.createElement("variable");bW.appendChild(aI);aH=bx.createTextNode(ar);aI.appendChild(aH)}else{if(bz.type==="Region"&&bz.causality==="N"){var bv=bx.getElementsByTagName("connectors")[0];var aB=bz.name;var bO="IC_"+an+"_"+aB;bT=bx.createElement("connector");bT.setAttribute("name",bO);bv.appendChild(bT);bX=bx.createElement("componentInstance");bT.appendChild(bX);aI=bx.createTextNode(an);bX.appendChild(aI);var B="CS_"+an+"_"+aB;bT=bx.createElement("connector");bT.setAttribute("name",B);bv.appendChild(bT);bX=bx.createElement("componentInstance");bT.appendChild(bX);aI=bx.createTextNode(an);bX.appendChild(aI)}}}}var bI=bx.getElementsByTagName("connectionSets")[0];var ad=bx.getElementsByTagName("mappingSpecifications")[0];var b0=bx.getElementsByTagName("modulationSpecifications")[0];var ax=bx.getElementsByTagName("continuousTime")[0];var a3=bx.getElementsByTagName("connectionCategory");for(var bw=aT.edges.first;bw;bw=bw.next){if(!bw.cl2.c.node.data||!bw.cl1.c.node.data){continue}var bP=null,bN=null,bM=null,bL=null;var aX=bw.cl1.c.node.data.RFLComponent;var aw=aX.getID();var bh=bw.cl1.c.data.name;var G=null,aG=null;var aE=bw.cl2.c.node.data.RFLComponent;var a0=aE.getID();var aW=bw.cl2.c.data.name;var aY=aw+"_"+bh;var a9=a0+"_"+aW;var a2=aY+"_"+a9;G=aX.getSelectedBehavior();aG=aE.getSelectedBehavior();if(aE.reference.getConnector(aW)&&aE.reference.getConnector(aW).type==="Region"){var bH=bw.data.RFLlink;var bf,aD,bi;var aF=aX.reference.model.experiment;for(var bt=0;bt<aF.interactions.length;bt++){var I=aF.interactions[bt];if(I.linkID===bH.phID){bf=I.mapping;aD=I.ramping;bi=I.coupling;break}}if(bf){var X=bx.createElement("mapSpec");X.setAttribute("name","mapTol_"+a2);ad.appendChild(X);var V=bx.createElement("search");X.appendChild(V);var bB=false;if(bf.search.isAbsolute){bB=bf.search.isAbsolute}V.setAttribute("isAbsolute",bB);var U=bx.createElement("normal");V.appendChild(U);var S=bx.createElement("inward");U.appendChild(S);var aA=0.5;if(bf.search.normal.inward!==""){aA=bf.search.normal.inward}var L=bx.createTextNode(aA);S.appendChild(L);var P=bx.createElement("outward");U.appendChild(P);var bY=0.5;if(bf.search.normal.outward!==""){bY=bf.search.normal.outward}var K=bx.createTextNode(bY);P.appendChild(K);var N=bx.createElement("requireFacingNormals");U.appendChild(N);var J=bx.createTextNode(bf.search.normal.requireFacingNormals);N.appendChild(J);var am=bx.createElement("neighborhoodSearch");V.appendChild(am);var cb=0.1;if(bf.search.neighborhoodSearch!==""){cb=bf.search.neighborhoodSearch}var al=bx.createTextNode(cb);am.appendChild(al);var ak=bx.createElement("tangential");V.appendChild(ak);var a6=0.5;if(bf.search.tangential!==""){a6=bf.search.tangential}var ai=bx.createTextNode(a6);ak.appendChild(ai);var ah=bx.createElement("transfer");X.appendChild(ah);var ag=bx.createElement("flux");ah.appendChild(ag);var af=bx.createElement("globalConservation");ag.appendChild(af);var ae=bx.createTextNode(bf.transfer.flux.globalConservation);af.appendChild(ae);if(bf.transfer.orphanTreatment){var ab=bx.createElement("orphanTreatment");ah.appendChild(ab);if(bf.transfer.orphanTreatment.nearestNeighbor){var aa=bx.createElement("nearestNeighbor");ab.appendChild(aa);var O=bx.createTextNode(1);aa.appendChild(O)}else{var R=bx.createElement("constantValue");ab.appendChild(R);var M=bx.createTextNode(bf.transfer.orphanTreatment.constantValue);R.appendChild(M)}}}if(aD){var X=bx.createElement("modSpec");X.setAttribute("type","SMOOTH");X.setAttribute("name","spline");b0.appendChild(X);var V=bx.createElement("parameters");X.appendChild(V);var U=bx.createElement("parameter");U.setAttribute("value",aD.t1);U.setAttribute("name","t1");V.appendChild(U);var S=bx.createElement("parameter");S.setAttribute("value",aD.t2);S.setAttribute("name","t2");V.appendChild(S);var P=bx.createElement("connector");var bg;if(G.codeName==="Abaqus/Standard"||G.codeName==="Abaqus/Explicit"){P.textContent="CS_"+aY;bg=bh}else{P.textContent="CS_"+a9;bg=aW}X.appendChild(P);var N=bx.createElement("variables");X.appendChild(N);var L=bx.createElement("variable");L.textContent="force."+bg.toUpperCase();N.appendChild(L)}if(bi){var X=bx.createElement("iterativeCoupling");ax.appendChild(X);var V=bx.createElement("exchangeLimit");V.textContent=bi.iterations;X.appendChild(V);var U=bx.createElement("couplingTolerance");U.textContent=bi.tolerance;X.appendChild(U)}bP=bx.createElement("connectionSet");bP.setAttribute("name","IC_"+a2);bI.appendChild(bP);bN=bx.createElement("connection");bN.setAttribute("mapSpec","mapTol_"+a2);bP.appendChild(bN);bP.setAttribute("type","FIELD");bM=bx.createElement("connector");bN.appendChild(bM);bL=bx.createTextNode("IC_"+aY);bM.appendChild(bL);bM=bx.createElement("connector");bN.appendChild(bM);bL=bx.createTextNode("IC_"+a9);bM.appendChild(bL);bP=bx.createElement("connectionSet");bP.setAttribute("name","CS_"+a2);bI.appendChild(bP);bN=bx.createElement("connection");bN.setAttribute("mapSpec","mapTol_"+a2);bP.appendChild(bN);bP.setAttribute("type","FIELD");bM=bx.createElement("connector");bN.appendChild(bM);bL=bx.createTextNode("CS_"+aY);bM.appendChild(bL);bM=bx.createElement("connector");bN.appendChild(bM);bL=bx.createTextNode("CS_"+a9);bM.appendChild(bL);var bu=bx.getElementsByTagName("connector");var bc=g.Utils.loadXml("<variables></variables>").firstChild;var ao;var bl={},be={};bl.ic=bc;bl.cs=bc;bl.spec=bc;be.ic=bc;be.cs=bc;be.spec=bc;var a8=WUX.AFR.CommandsManager.getCommand("SMAMultiScaleInterCmdHdr");a8.setOptions(C.model,null,bw.data.RFLlink);if(!a8.compatibleTypes()){continue}bP.setAttribute("type","FIELD");var bb=bw.views.main.structure.root.querySelector(".my-interaction-type");if(bb){bb=bb.textContent;if(bb==="CHT"&&bw.cl1.c.data.regionType.indexOf("cht_std")>-1){be=aq;bl=a7}else{if(bb==="CHT"&&bw.cl1.c.data.regionType.indexOf("cht_cfd")>-1){be=a7;bl=aq}else{if(bb==="FSI"&&bw.cl1.c.data.regionType.indexOf("fsi_std")>-1){be=Q;bl=aZ}else{if(bb==="FSI"&&bw.cl1.c.data.regionType.indexOf("fsi_cfd")>-1){be=aZ;bl=Q}else{if(bb==="EM1"&&bw.cl1.c.data.regionType.indexOf("em1_a")>-1){be=au;bl=at}else{if(bb==="EM1"&&bw.cl1.c.data.regionType.indexOf("em1_b")>-1){be=at;bl=au}else{if(bb==="EM2"&&bw.cl1.c.data.regionType.indexOf("em2_a")>-1){be=bA;bl=by}else{if(bb==="EM2"&&bw.cl1.c.data.regionType.indexOf("em2_b")>-1){be=by;bl=bA}else{if(bb==="SXS"&&bw.cl1.c.data.regionType.indexOf("sxs_std")>-1){be=av;bl=v}else{if(bb==="SXS"&&bw.cl1.c.data.regionType.indexOf("sxs_xpl")>-1){be=v;bl=av}else{if(bb==="SXL"&&bw.cl1.c.data.regionType.indexOf("sxl_std")>-1){be=ap;bl=cc}else{if(bb==="SXL"&&bw.cl1.c.data.regionType.indexOf("sxl_xpl")>-1){be=cc;bl=ap}else{if(bb==="IHT"&&bw.cl1.c.data.regionType.indexOf("iht_std")>-1){be=W;bl=aC}else{if(bb==="IHT"&&bw.cl1.c.data.regionType.indexOf("iht_cst")>-1){be=aC;bl=W}}}}}}}}}}}}}}for(var bq=0;bq<bu.length;bq++){if(bu[bq].getAttribute("name")==="IC_"+a9||bu[bq].getAttribute("name")==="CS_"+a9){var x=aW;if(aE.reference.getConnector(aW).mangledName&&aE.reference.getConnector(aW).mangledName!==""){x=aE.reference.getConnector(aW).mangledName}var bC=bl.ic.cloneNode(true);if(bu[bq].getAttribute("name")==="CS_"+a9){bC=bl.cs.cloneNode(true)}bu[bq].appendChild(bC);var y=bu[bq].getElementsByTagName("variable");for(var aV=0;aV<y.length;aV++){if(aG&&(aG.codeName==="Abaqus/Standard"||aG.codeName==="Abaqus/Explicit")){y[aV].textContent+="."+x.toUpperCase()}else{y[aV].textContent+="."+x}}var b9=g.Utils.loadXml(ba);ao=b9.createElement("Region");ao.setAttribute("name",x);ao.appendChild(bl.spec);b9.getElementsByTagName("Regions")[0].appendChild(ao);a4[aE.getID()]=b9.firstChild;if(aG.sim&&aG.is3dfmu&&aG.clientSolverParameters){var bk=g.Utils.loadXml(aG.clientSolverParameters);a4[aE.getID()].appendChild(bk)}}else{if(bu[bq].getAttribute("name")==="IC_"+aY||bu[bq].getAttribute("name")==="CS_"+aY){var z=bh;if(aX.reference.getConnector(bh).mangledName&&aX.reference.getConnector(bh).mangledName!==""){z=aX.reference.getConnector(bh).mangledName}var bU=be.ic.cloneNode(true);if(bu[bq].getAttribute("name")==="CS_"+aY){bU=be.cs.cloneNode(true)}bu[bq].appendChild(bU);var w=bu[bq].getElementsByTagName("variable");for(var aU=0;aU<w.length;aU++){if(G&&(G.codeName==="Abaqus/Standard"||G.codeName==="Abaqus/Explicit")){w[aU].textContent+="."+z.toUpperCase()}else{w[aU].textContent+="."+z}}var b7=g.Utils.loadXml(ba);ao=b7.createElement("Region");ao.setAttribute("name",z);ao.appendChild(be.spec);b7.getElementsByTagName("Regions")[0].appendChild(ao);a4[aX.getID()]=b7.firstChild;if(G.sim&&G.is3dfmu&&G.clientSolverParameters){var bj=g.Utils.loadXml(G.clientSolverParameters);a4[aX.getID()].appendChild(bj)}}}}}for(var bo=0;bo<a3.length;bo++){var E=null,D=null;if(a3[bo].getAttribute("name")==="InitialConditions"){E=bx.createElement("connectionSet");D=bx.createTextNode("IC_"+a2);E.appendChild(D);a3[bo].appendChild(E)}if(a3[bo].getAttribute("name")==="CouplingStep"){E=bx.createElement("connectionSet");D=bx.createTextNode("CS_"+a2);E.appendChild(D);a3[bo].appendChild(E)}}}else{bP=bx.createElement("connectionSet");bP.setAttribute("name",a2);bI.appendChild(bP);bN=bx.createElement("connection");bP.appendChild(bN);bM=bx.createElement("connector");bN.appendChild(bM);bL=bx.createTextNode(aY);bM.appendChild(bL);bM=bx.createElement("connector");bN.appendChild(bM);bL=bx.createTextNode(a9);bM.appendChild(bL);for(var bp=0;bp<a3.length;bp++){var bS=null,bQ=null;bS=bx.createElement("connectionSet");bQ=bx.createTextNode(a2);bS.appendChild(bQ);a3[bp].appendChild(bS)}}}if(!ad.hasChildNodes()){ad.parentNode.removeChild(ad)}if(!b0.hasChildNodes()){b0.parentNode.removeChild(b0)}var bK=null,bF=null,bE=null,bD=null;var ay=bx.getElementsByTagName("continuousTime")[0];bK=bx.createElement("algorithm");ay.appendChild(bK);bF=bx.createTextNode(aF.getAlgorithm());bK.appendChild(bF);bE=bx.createElement("negotiationMethod");ay.appendChild(bE);bF=bx.createTextNode(aF.getMethod());bE.appendChild(bF);if(aF.getMethod()==="CONSTANTDT"){bD=bx.createElement("constantDt");ay.appendChild(bD);bF=bx.createTextNode(aF.getConstantDt());bD.appendChild(bF)}else{if(aF.getMethod()==="MASTER"){bD=bx.createElement("masterActor");ay.appendChild(bD);bF=bx.createTextNode(aF.getMasterActor());bD.appendChild(bF)}}var bZ=bx.getElementsByTagName("duration")[0];bF=bx.createTextNode(aF.getDuration());bZ.appendChild(bF);return bx},execute:function(){var z=this;z.model.getEditor().hideContextualBar();var A=z.model.getEditor().gr;var x={},y=null;var v=z.model.getExperiment();if(v===null||typeof(v)===undefined){var w=f.get("exp_not_created");if(w==="exp_not_created"){w="An experiment must be created first."}z.model.addMessage(w,"error","notification")}else{y=z.submit(A,v,x)}if(z.option==="spec"){return x}else{if(z.option==="config"){return y}else{if(z.option==="open"){var u=(new XMLSerializer()).serializeToString(y);window.open("data:text/xml;charset=utf-8,"+escape(u))}}}}});return q});
/*! Copyright 2015 Dassault Systemes 
 * XSS_CHECKED
 * */
define("DS/SMAMSWeb/SMAMSMonitoring",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Controls/ProgressBar","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/SMAMSExecutionServices/SMAMSMonitoringAPI","DS/Core/Core","DS/RFLModelerWeb/RFL_EditorPanel","DS/SMAMSExecutionServices/SMAMSSolverMessageProcessing","DS/SMAMSExecutionServices/SMAMSCommonServices","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAMSExecutionServices2Unqueued/Constants","DS/Controls/Expander"],function(e,a,f,d,l,m,g,j,p,c,b,o,n,k){var i;var h=e.Class.extend({init:function(q){var u=this;this.experiment=q;this.statusDiv=null;this.panel=null;this.perc=null;this.justInitialized=true;this.EKconnectionOK=false;this.counter=0;var t=null;try{t=this.experiment.getModel().getEditor()}catch(v){}if(!t){return}var r=t.getUIFrame().querySelectorAll("#monitoringDiv");for(var s=0;s<r.length;s++){r[s].parentNode.parentNode.parentNode.parentNode.destroy()}this._createPanel();if(i){document.removeEventListener("openSimulationSuccess",i)}i=u.connectProcess.bind(u,q);document.addEventListener("openSimulationSuccess",i)},_myonCompleteFunction:function(B,v,A){var z=this;var K=B.response;var E=false;var q=0;var D=0;var s=false;var u=0;var w=0;var t=new DOMParser();var L=JSON.parse(K);var G=L.JobInfo.JobSummary.WorkItemSummaries.WorkItemSummary;var I=z.statusDiv.querySelector(".ec-monitoring").parentNode;if(G.length<=2&&v===true){I.setStepStatus("Checking Execution Settings","Experiment steps","Done");I.setStepStatus("Creating Job","Experiment steps","Done");I.setStepStatus("Submitting to station","Experiment steps","Aborted");clearInterval(A);return}else{if(G.length>2&&v===false){if(z.counter===0){I.setStepStatus("Submitting to station","Experiment steps","Done");z.counter++;z.setStatus("Starting Cosimulation",-1);I.setStepStatus("Starting Cosimulation","Experiment steps","Running")}}}for(var H=0;H<G.length;H++){var J=G[H]["@path"];if(J.split("#").length>1){var x=J.split("#")[J.split("#").length-2].split(".")[0]+","+J.split("#")[J.split("#").length-1];var r=J.split("#")[J.split("#").length-2].split(".")[0];var F=G[H].WorkItemSummaryDetails.WorkItemSummaryDetail["@status"];if(F==="Running"&&v===true){I.setStepStatus("Checking Execution Settings","Experiment steps","Done");I.setStepStatus("Creating Job","Experiment steps","Done")}if(x.split(",")[1]==="CSE-Director"){if(G[H].WorkItemSummaryDetails.WorkItemSummaryDetail["@completionCode"]==="Canceled"||G[H].WorkItemSummaryDetails.WorkItemSummaryDetail["@completionCode"]==="Failed"){I.setStepStatus("Running Cosimulation","Experiment steps","Aborted");E=true}else{if(G[H].WorkItemSummaryDetails.WorkItemSummaryDetail["@completionCode"]==="OK"){I.setStepStatus("Checking Execution Settings","Experiment steps","Done",false);I.setStepStatus("Creating Job","Experiment steps","Done",false);I.setStepStatus("Submitting to station","Experiment steps","Done",false);I.setStepStatus("Starting Cosimulation","Experiment steps","Done",false);I.setStepStatus("Running Cosimulation","Experiment steps","Done")}}}else{if(x.split(",")[1]==="Upload"){q++;I.setStepStatus("Running Cosimulation","Experiment steps","Done");if(F==="Running"){I.setStepStatus("Starting Cosimulation","Experiment steps","Done");I.setStepStatus("Uploading Results","Experiment steps","Running");z.setStatus("Uploading Results");I.setStepStatus(x.split(",")[0],"Uploading Results",F,true)}if(F==="Done"){var C=G[H].WorkItemSummaryDetails.WorkItemSummaryDetail["@completionCode"];if(C==="OK"){D++;I.setStepStatus("Starting Cosimulation","Experiment steps","Done");I.setStepStatus(x.split(",")[0],"Uploading Results","Done",true)}else{if(C==="Canceled"||C==="Failed"){I.setStepStatus(x.split(",")[0],"Uploading Results","Aborted",true);I.setStepStatus("Starting Cosimulation","Experiment steps","Done");I.setStepStatus("Uploading Results","Experiment steps","Aborted");s=true;if(v===true){I.setStepStatus("Checking Execution Settings","Experiment steps","Done",false);I.setStepStatus("Creating Job","Experiment steps","Done",false);I.setStepStatus("Submitting to station","Experiment steps","Done",false);I.setStepStatus("Starting Cosimulation","Experiment steps","Done",false);I.setStepStatus("Running Cosimulation","Experiment steps","Done",false)}}}}}else{if(x.split(",")[0]==="Results Generation"){u++;if(F==="Running"){I.setStepStatus("Starting Cosimulation","Experiment steps","Done");I.setStepStatus("Results Generation","Experiment steps","Running");z.setStatus("Results Generation");I.setStepStatus(x.split(",")[1],"Results Generation",F,true)}if(F==="Done"){var C=G[H].WorkItemSummaryDetails.WorkItemSummaryDetail["@completionCode"];if(C==="OK"){w++;I.setStepStatus(x.split(",")[1],"Results Generation","Done",true)}else{if(C==="Canceled"||C==="Failed"){I.setStepStatus(x.split(",")[1],"Results Generation","Aborted",true);I.setStepStatus("Results Generation","Experiment steps","Aborted");s=true;if(v===true){I.setStepStatus("Checking Execution Settings","Experiment steps","Done",false);I.setStepStatus("Creating Job","Experiment steps","Done",false);I.setStepStatus("Submitting to station","Experiment steps","Done",false);I.setStepStatus("Starting Cosimulation","Experiment steps","Done",false);I.setStepStatus("Running Cosimulation","Experiment steps","Done",false);I.setStepStatus("Uploading Results","Experiment steps","Done",false)}}}}}}}}else{if(J.split("#").length===1){var x=J}}}if(D===z.experiment.model.root.listInstances().length&&q!==0&&s===false){I.setStepStatus("Uploading Results","Experiment steps","Done")}if(D===q&&q!==0&&q<z.experiment.model.root.listInstances().length){z.setStatus("Uploading Results");I.setStepStatus("Uploading Results","Experiment steps","Running")}if(u!==0&&w===I.getNumberOfSteps("Results Generation")){I.setStepStatus("Results Generation","Experiment steps","Done")}if(L.JobInfo["@status"]==="Done"){if(L.JobInfo["@completionCode"]==="Canceled"||L.JobInfo["@completionCode"]==="Failed"){if(L.JobInfo["@completionCode"]==="Failed"){z.setStatus("failed")}var y=I.getCurrentStep();if(y){I.setStepStatus(y,"Experiment steps","Aborted",false)}else{if(!y&&E&&v===true){I.setStepStatus("Checking Execution Settings","Experiment steps","Done",false);I.setStepStatus("Creating Job","Experiment steps","Done",false);I.setStepStatus("Submitting to station","Experiment steps","Done",false);I.setStepStatus("Starting Cosimulation","Experiment steps","Done",false);I.setStepStatus("Running Cosimulation","Experiment steps","Aborted")}}}else{if(L.JobInfo["@completionCode"]!=="Canceled"&&L.JobInfo["@completionCode"]!=="Failed"&&v===false){I.setStepStatus("Finalizing","Experiment steps","Running");z.setStatus("Finalizing");z.checkStatus()}else{if(L.JobInfo["@completionCode"]==="OK"&&v===true){I.setStepStatus("Checking Execution Settings","Experiment steps","Done",false);I.setStepStatus("Creating Job","Experiment steps","Done",false);I.setStepStatus("Submitting to station","Experiment steps","Done",false);I.setStepStatus("Starting Cosimulation","Experiment steps","Done",false);I.setStepStatus("Finalizing","Experiment steps","Done",false)}}}clearInterval(A)}},connectProcess:function(){var r=this;if(r.experiment.getID()!==undefined&&r.experiment.getID()!==null){c.getJobStatus(r.experiment.getID(),function(s){if(s.toLowerCase()==="completed"){r.setStatus("succeeded")}else{if(s.toLowerCase()==="running"){r.setStatus(s);r.startMonitoring()}else{r.setStatus(s.toLowerCase())}}},function(s){if(s==="succeeded"||s==="failed"){r.setStatus(s)}})}var q=e.createElement("sp-cosservice");c.getJobInfo(r.experiment.phID,function(t){if(t){var u=t.eedJobId;var s=function(v){var w=v;var x=w+"/job/"+u+"/summary/full";c.getJobInfo(r.experiment.phID,function(A){var B=A.eedJobId;var z=A.eedTicket;var y={uri:x,verb:"GET",headers:{EEDTicket:z},onComplete:function(E){var G=widget.editor.getUIFrame().querySelector(".ec-monitoring").parentNode;var D=r.experiment;var C=false;for(var F=0;F<D.model.getRoot().listInstances().length;F++){if(D.model.getRoot().listInstances()[F].getSelectedBehavior().simResults&&D.model.getRoot().listInstances()[F].getSelectedBehavior().simResults===true){C=true}}if(C===true){var H=G.parentNode;G.remove();G=e.createElement("ec-monitoring").inject(H);G.initialize(["Checking Execution Settings","Creating Job","Submitting to station","Starting Cosimulation","Running Cosimulation","Uploading Results","Results Generation","Finalizing"]);for(var F=1;F<D.model.components.length;F++){G.addStep(D.model.components[F].instances[0].name,F-1,"Uploading Results")}o.openProcess(D.getProcess().getProcessInfo().physicalId,{onSuccess:function(K){var J=K.getActivityByName(n.RESULTS_GENERATION);for(var I=0;I<(J.getSteps().length);I++){G.addStep(J.getSteps()[I].getName(),I,"Results Generation")}r._myonCompleteFunction(E,true)},onFailure:function(){}})}else{if(C===false){var H=G.parentNode;G.remove();G=e.createElement("ec-monitoring").inject(H);G.initialize(["Checking Execution Settings","Creating Job","Submitting to station","Starting Cosimulation","Running Cosimulation","Uploading Results","Finalizing"]);for(var F=1;F<D.model.components.length;F++){G.addStep(D.model.components[F].instances[0].name,F,"Uploading Results")}r._myonCompleteFunction(E,true)}}},onError:function(C){}};q.sendRequest(y)})};c.getEEDUrl(s,function(){})}},function(){})},startMonitoring:function(){var r=this;r.counter=0;var q=r.statusDiv.querySelector(".ec-monitoring").parentNode;r.setStatus("Submitting to station",-1);q.setStepStatus("Creating Job","Experiment steps","Done");q.setStepStatus("Submitting to station","Experiment steps","Running");c.getJobInfo(r.experiment.phID,function(v){var t=0;var u=e.createElement("sp-cosservice");var w=v.eedJobId;var s=function(z){var A=z;var B=A+"/job/"+w+"/summary/full";c.getJobInfo(r.experiment.phID,function(E){var F=E.eedJobId;var D=E.eedTicket;var C={uri:B,verb:"GET",headers:{EEDTicket:D},onComplete:function(I){var N=false;var K=I.response;var M=JSON.parse(K);if(M.JobInfo.JobSummary.WorkItemSummaries){var H=M.JobInfo.JobSummary.WorkItemSummaries.WorkItemSummary;for(var J=0;J<H.length;J++){var L=H[J]["@path"];if(L.split("#").length>1){var G=L.split("#")[L.split("#").length-2].split(".")[0]+","+L.split("#")[L.split("#").length-1];if(G.split(",")[1]==="CSE-Director"){if(H[J].WorkItemSummaryDetails.WorkItemSummaryDetail["@completionCode"]==="OK"){N=true}}}}}if(N===false){r.startEKmonitoring()}},onError:function(G){}};u.sendRequest(C)});var x=function(C){clearInterval(y)};var y=setInterval(function(){if(r.experiment===r.experiment.getModel().getExperiment()){c.getJobInfo(r.experiment.phID,function(E){var F=E.eedJobId;var D=E.eedTicket;var C={uri:B,verb:"GET",headers:{EEDTicket:D},onComplete:function(G){r._myonCompleteFunction(G,false,y)},onError:function(G){x(G)}};u.sendRequest(C)})}},3000)};c.getEEDUrl(s,function(){})},function(){})},checkStatus:function(){var q=this;q.interval=setInterval(function(){c.getJobStatus(q.experiment.getID(),function(r){if(r.toLowerCase()==="running"){if(q.EKconnectionOK===false&&q.experiment.monitoring.status==="Starting Execution..."){q.setStatus("running")}}else{if(r.toLowerCase()==="completed"){q.setStatus("succeeded");var s=q.statusDiv.querySelector(".ec-monitoring").parentNode;s.setStepStatus("Finalizing","Experiment steps","Done");clearInterval(q.interval)}else{q.setStatus(r.toLowerCase());clearInterval(q.interval)}}},function(r){if(r==="succeeded"||r==="failed"){q.setStatus(r)}clearInterval(q.interval)})},3000)},startEKmonitoring:function(){var t=this;var s=0;var x=0;var w=function(G){var H=e.Utils.loadXml(G);var F=H.firstChild;var D=parseFloat(F.getAttribute("endTime"));var z=F.getElementsByTagName("agent");var B=parseFloat(z[0].textContent);var C=F.getAttribute("status");t.setStatus(C,Math.floor(100*B/D));if(x===0){var E=t.statusDiv.querySelector(".ec-monitoring").parentNode;E.setStepStatus("Starting Cosimulation","Experiment steps","Done");E.setStepStatus("Running Cosimulation","Experiment steps","Running");if(typeof(Event)==="function"){var A=new Event("execution-started")}else{var A=document.createEvent("Event");A.initEvent("execution-started",true,true)}document.dispatchEvent(A);x=1}};t.experiment.solverMessages=p;var u=function(){var A=function(B){t.experiment.solverMessages.putMessages(B)};var z=function(){};t.experiment.services.getAllSolverMessages(A,z);t.experiment.services.getSolverMessages(1,A,z)};var r=function(){};var v=function(D){var E=t.experiment.getModel().root._instances;var C=null;for(var B=0;B<E.length;B++){if(E[B].phID===D){C=E[B].name;break}}if(C!==null){var z=l.get("monitoring_04");if(z==="monitoring_04"){z="Co-simulation terminated by component "}var F=l.get("monitoring_05");if(F==="monitoring_05"){F="Check output from the component for more details. "}var A=z+C+". "+F;t.experiment.getModel().addMessage(A,"error","notification")}};var y=function(){var z=l.get("monitoring_06");t.experiment.getModel().addMessage(z,"error","notification")};var q=this.statusDiv.ProgressBar;q.infiniteFlag=true;m.getServices(this.experiment.getID(),function(z){if(t.experiment!==t.experiment.getModel().getExperiment()){if(t.experiment.services){t.experiment.services.stopAllServices()}}else{if(t.experiment===t.experiment.getModel().getExperiment()){t.experiment.services=z;z.getProgress(1,w,r);z.notifyFailedComponent(v);z.cssError(y);u()}}},function(z){if(z==="succeeded"){t.checkStatus()}else{if(z){t.setStatus(z)}else{var A=l.get("monitoring_02");if(A==="monitoring_02"){A="The experiment progress monitoring failed."}t.experiment.getModel().addMessage(A,"error","notification")}}})},checkCOSstatus:function(){var q=this;c.getJobStatus(q.experiment.getID(),function(r){q.setStatus(r.toLowerCase())},function(r){if(r==="succeeded"||r==="failed"){q.setStatus(r)}})},setStatus:function(q,s){var u=this;var t=null;try{t=this.experiment.getModel().getEditor()}catch(v){}if(!t){return}var w=(function(){if(t.getUIFrame().querySelector("#monitoringDiv")&&(q==="Running"||q==="running"||q==="succeeded"||q==="compiling results"||q==="Starting Execution..."||q==="Execution Complete"||q==="Aborted"||q==="Failed"||q==="failed")&&this.justInitialized){g.AFR.CommandsManager.getCommand("SMAMultiScaleStatusCmdHdr").panel.visibleFlag=true;this.justInitialized=false}}).bind(this);this.status=q;if(s){this.perc=s}if(this.statusDiv){if(q==="running"){q=l.get("Experiment_Status_Running");if(q==="Experiment_Status_Running"){q="Running"}this._setText(q+"...");var r=this.statusDiv.ProgressBar;if(this.EKconnectionOK===true){if(this.perc){r.value=this.perc}r.emphasize="success";r.infiniteFlag=false;r.statusFlag=true}else{if(this.EKconnectionOK===false){r.emphasize="info";r.infiniteFlag=true;r.statusFlag=false}}}else{if(q==="paused"){q=l.get("Experiment_Status_Paused");if(q==="Experiment_Status_Paused"){q="Paused"}this._setText(q);var r=this.statusDiv.ProgressBar;r.infiniteFlag=false;r.emphasize="info";if(this.perc){r.value=this.perc}}else{if(q==="notstarted"){q=l.get("Experiment_Status_NotStarted");if(q==="Experiment_Status_NotStarted"){q="Not Started"}this._setText(q);var r=this.statusDiv.ProgressBar;r.infiniteFlag=false;r.value=0;r.emphasize="info"}else{if(q==="succeeded"||q==="completed"){this.EKconnectionOK=false;q=l.get("Experiment_Status_Succeeded");if(q==="Experiment_Status_Succeeded"){q="Execution Complete"}this._setText(q);var r=this.statusDiv.ProgressBar;r.infiniteFlag=false;r.emphasize="success";r.value=100;r.statusFlag=true}else{if(q==="failed"){q=l.get("Experiment_Status_Failed");if(q==="Experiment_Status_Failed"){q="Failed"}this._setText(q);var r=this.statusDiv.ProgressBar;r.infiniteFlag=false;r.emphasize="high-attention";r.value=100;r.statusFlag=false}else{if(q==="aborted"){this.EKconnectionOK=false;q=l.get("Experiment_Status_Aborted");if(q==="Experiment_Status_Aborted"){q="Aborted"}this._setText(q);var r=this.statusDiv.ProgressBar;r.infiniteFlag=false;r.emphasize="high-attention";r.value=100;r.statusFlag=false}else{if(q==="compiling results"){q=l.get("Experiment_Status_Compiling_Results");if(q==="Experiment_Status_Compiling_Results"){q="Compiling Results"}this._setText(q+"...");var r=this.statusDiv.ProgressBar;r.emphasize="info";r.infiniteFlag=true;r.statusFlag=false}else{q=l.get(q);this._setText(q);var r=this.statusDiv.ProgressBar;if(this.perc===-1){r.value=0;r.emphasize="info";r.infiniteFlag=true}else{r.infiniteFlag=true}r.statusFlag=false}}}}}}}w()}},_createPanel:function(){if(!this.panel){var r=null;try{r=this.experiment.getModel().getEditor()}catch(v){}if(!r){return}var q=e.createElement("div");q.setAttribute("class","container-fluid");q.setAttribute("id","monitoringDiv");var u={};u.editor=r;u.title="Execution Status";u.content=q;u.onOK=function(){};u.onCancel=function(){};u.hideFooter=true;u.minHeight=95;u.width=310;u.isResizable=false;u.absolutePosition={x:0,y:70};var w=new j(u);this.panel=w.getPanel();this.panel.getContent().querySelector(".wux-windows-window-content").style.overflowY="hidden";this.panel.getContent().querySelector(".wux-windows-window-header-button").style.display="none";var t=e.createElement("button");t.setAttribute("class","wux-windows-window-header-button wux-windows-window-header-close wux-ui-3ds wux-ui-3ds-wrong ec-panel-close-button");t.inject(this.panel.getContent().querySelector(".wux-windows-window-header-buttons-div"));t.addEventListener("click",(function(){this.panel.visibleFlag=false}).bind(this,r));this._createStatusBar();r.getImmersiveFrame().addWindow(this.panel);this.panel.visibleFlag=false;this.panel.resizableFlag=true;var s=new e.Element("div");s.style.height="310px";s.setAttribute("class","monitoring-expander-content");new k({allowUnsafeHTMLHeader:false,header:"Execution Monitoring Details",body:s}).inject(this.statusDiv);var x=e.createElement("ec-monitoring").inject(s);if(x.initialize){x.initialize(["Checking Execution Settings","Creating Job","Submitting to station","Starting Cosimulation","Running Cosimulation","Uploading Results","Finalizing"])}if(g.AFR.CommandsManager.getCommand("SMAMultiScaleStatusCmdHdr")){g.AFR.CommandsManager.getCommand("SMAMultiScaleStatusCmdHdr").panel=this.panel}}},_createStatusBar:function(){if(!this.statusDiv){if(!this.panel){return}this.statusDiv=this.panel.getContent().querySelector("#monitoringDiv");while(this.statusDiv.firstChild){this.statusDiv.removeChild(this.statusDiv.firstChild)}this.statusDiv.ProgressBar=new d({shape:"circular",infiniteFlag:false}).inject(this.statusDiv);var q=new e.createElement("span");q.setAttribute("class","experiment-status-text");q.inject(this.statusDiv.ProgressBar.getContent());if(typeof this.status==="undefined"){q.textContent="Loading..."}}},_setText:function(r){var q=null;try{q=this.experiment.getModel().getEditor()}catch(t){}if(!q){return}if(q.getUIFrame().querySelector("#monitoringDiv")){var s=q.getUIFrame().querySelector("#monitoringDiv").querySelector(".experiment-status-text");s.textContent=r;if(r==="Aborted"||r==="Failed"){}else{}}}});return h});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSFileMonitoring",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAMSExecutionServices/SMAMSCommonServices","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(h,d,c,f,e,a,g){var b=h.Class.extend({init:function(i){this.experiment=i;this.execDirArray=[];this.physicalID=null},initializeFileMonitoring:function(k,l,n){var j=this;var m=function(s){var w=widget.editor;var v=w.model.getExperiment().getID();var q=[];if(s){for(var t=0;t<s.length;t++){if(s[t].title==="StationName"){q.push(s[t].value)}}}var u=q.filter(function(A,z,y){return z==y.indexOf(A)});var o=v;var x=e.ThreeDSpaceUrl;var r=x+"/resources/slmservices/simulations/"+o+"/jobs?_="+Math.random();var p=function(z){var y={onComplete:function(D){var B=0;var H=[];for(var E=0;E<u.length;E++){var F=E;var G=h.createElement("sp-cos-filemonitor");G.setAttribute("unauthenticated-stations",true);var I={};var A=widget.editor.model.getExperiment().getID();if(D){var C=D[0].physicalId;I.physicalID=D[0].physicalId;I.station=u[F];I.cosJobID=D[0].eedJobId;I.mcsJobID=D[0].physicalId}I.onComplete=function(){var K={};var J=this.execDir;K.execDir=J;K.physicalID=C;j.execDirArray.push(J);j.physicalID=C;j.spcosfilemonitor=this.that;K.onComplete=function(){B=B+1;if(B<u.length){H.push(this.lsResult)}else{if(B===u.length){H.push(this.lsResult);n(H,j)}}};K.onFailure=function(){var L=g.get("monitoring_03");if(L==="monitoring_03"){L="The experiment is running, but file monitoring is not available. To enable file monitoring, ensure the execution station you have selected has properly specified p12 file or reverse proxy."}j.experiment.getModel().addMessage(L,"error","notification");B=B+1;if(B===u.length){n(H,j)}};this.that.ls(K)};I.onFailure=function(){};G.initExecDir(I)}},onError:function(){}};f.get(null,z,y)};p(r)};var i=function(o){};a.getExecOptions(k,m,i)},refreshList:function(q){var o=this;var p={};var k=this.execDirArray;var l=this.physicalID;var n=[];var j=0;for(var m=0;m<k.length;m++){p.execDir=k[m];p.physicalID=l;p.onComplete=function(){j=j+1;if(j<k.length){n.push(this.lsResult)}else{if(j===k.length){n.push(this.lsResult);q(n,o)}}};p.onFailure=function(){};this.spcosfilemonitor.ls(p)}},stopFileMonitoring:function(){var k={};var j=this.execDirArray;for(var l=0;l<j.length;l++){k.execDir=j[l];k.physicalID=this.physicalID;k.onComplete=function(){console.log("file monitoring has been stopped")};k.onFailure=function(){console.log("file monitoring could not be stopped")};this.spcosfilemonitor.stopFileMonitor(k)}}});return b})
/*! Copyright 2015 Dassault Systemes */
;define("DS/SMAMSWeb/SMAMSRuleChecker",["UWA/Core"],function(b){var a=b.Class.extend({init:function(d,c){this._experiment=d;this._listRules=c;this._rulesToChek=[];this._errors={}},getName:function(){return this._name},getTitle:function(){return this._title},getErrors:function(){return this._errors},run:function(f){this._errors={};var d=0;var g=this._listRules.length;for(var c=0;c<g;c++){try{require([this._listRules[c]],(function(e){var i=new e();i.check(this._experiment,(function(){this._errors[i.getName()]=i.getErrors();this._errors[i.getName()].status="OK";d++;if(d===g){f()}}).bind(this),function(){this._errors[i.getName()].status="KO"})}).bind(this))}catch(h){continue}}},getListErrors:function(){return this._errors},});return a});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSEditorManager",["UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Spinner","DS/UIKIT/SuperModal","DS/SMAMSExperimentServices/Document","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/WebappsUtils/WebappsUtils","DS/RFLModelerWeb/RFL_Link","DS/SMAMSExperimentServices/SMAMSExperimentServices","DS/SMAProcWebCMMUtils/SMAJSCMMUtils"],function(f,k,i,e,c,h,l,g,a,d,b){var m=f.Class.extend({init:function(n){this.model=n},setModel:function(n){this.model=n},onDrop:function(A,C,w,F){var z=this;var r=this.model;var t=r.getEditor();var n=t.gr.views.main.clientToViewpoint(A.clientX,A.clientY);if(t.locked===true){var v=l.get("drop_02");if(v==="drop_02"){v="Drag and drop is not allowed when the experiment is active."}r.addMessage(v,"warning","notification");if(F){F()}return}if(C){var o=r.root.listInstances();for(var B=0;B<o.length;B++){if(o[B].ui.div===C){C=o[B]}}}if(A.dataTransfer.files&&A.dataTransfer.files.length>0){if(!r.getRoot()){var q=l.get("sys_01");if(q==="sys_01"){q="An experiment must be created first."}r.addMessage(q,"warning","notification");if(F){F()}return}for(var x=0;x<A.dataTransfer.files.length;x++){var G={value:A.dataTransfer.files[x]};if(!b.isValidTitle(G.value.name.slice(0,G.value.name.lastIndexOf(".")))){t.model.addMessage("Abstraction name cannot be empty or contain special characters.","warning","notification");return}if(G.value.name.search(".fmu")!==-1&&G.value.name.indexOf(".fmu")+4===G.value.name.length){G.type="fmu";G.path="DS/SMAMSWeb/SMAFmuBehavior";G.name=A.dataTransfer.files[x].name.slice(0,A.dataTransfer.files[x].name.indexOf(".fmu"));r.isValidFmu(G).then(function(H){j.openFile.call(z,H,C,n[0],n[1],w,F);n[0]+=10;n[1]+=10})["catch"](function(H){r.addMessage(H,"error","notification");if(F){F()}})}else{if(G.value.name.search(".simfmu")!==-1&&G.value.name.indexOf(".simfmu")+7===G.value.name.length){G.type="sim";G.path="DS/SMAMSWeb/SMASimulationBehavior";G.name=A.dataTransfer.files[x].name.slice(0,A.dataTransfer.files[x].name.indexOf(".simfmu"));j.openFile.call(this,G,C,n[0],n[1],w,F);n[0]+=10;n[1]+=10}else{if(G.value.name.search(".3dfmu")!==-1&&G.value.name.indexOf(".3dfmu")+6===G.value.name.length){G.type="sim";G.path="DS/SMAMSWeb/SMASimulationBehavior";G.is3dfmu=true;G.name=A.dataTransfer.files[x].name.slice(0,A.dataTransfer.files[x].name.indexOf(".3dfmu"));j.openFile.call(this,G,C,n[0],n[1],w,F);n[0]+=10;n[1]+=10}else{var s=l.get("drop_01");if(s==="drop_01"){s="The drag and drop of this object type is not supported."}r.addMessage(s,"error","notification");if(F){F()}}}}}}else{var u;try{u=JSON.parse(A.dataTransfer.getData("text"))}catch(D){try{u=JSON.parse(A.dataTransfer.getData("text/searchitems"))}catch(D){var p=l.get("drop_01");if(p==="drop_01"){p="The drag and drop of this object type is not supported."}r.addMessage(p,"warning","notification");if(F){F()}return}}if(u.protocol!=="3DXContent"){if(F){F()}return}if(u.data.items.length!==1){if(F){F()}return}if(!b.isValidTitle(u.data.items[0].displayName)){r.addMessage("Object name cannot contain special characters.","warning","notification");if(F){F()}return}if(typeof widget!=="undefined"&&f.is(widget)&&f.is(widget.getValue)&&(widget.getValue("x3dPlatformId")!==u.data.items[0].envId)){r.addMessage("Tenant mismatch.","warning","notification");if(F){F()}return}var y=u.data.items[0].objectId;if(u.data.items[0].objectType==="Simulation"){j.openSimulation.call(this,y,n[0],n[1],w,F);if(widget.getValue("RealTimeVariables")){widget.setValue("RealTimeVariables","")}}else{if(u.data.items[0].objectType==="RFLVPMLogicalReference"||u.data.items[0].objectType==="Logical Reference"){j.openReference.call(this,y,n[0],n[1],true,w,F)}else{var E=l.get("drop_01");if(E==="drop_01"){E="The drag and drop of this object type is not supported."}r.addMessage(E,"error","notification");if(F){F()}}}}},openSimulation:function(n,o){j.openSimulation.call(this,n,0,0,o)},onSearchSelect:function(o,n,q,p){j.openReference.call(this,o,n,q,false,p)},openModelInApp:function(n,r,o,u,v){var w=d.securityContext;var t=widget.getValue("x3dPlatformId");if(!t){t="OnPremise"}var q={contextId:w,envId:t,objectId:n,objectType:r,serviceId:"3DSpace"};var p={protocol:"3DXContent",version:"1.0",source:"SIMMSEC_AP",data:{items:[q]}};var s=this;require(["UWA/Utils/InterCom"],function(y){var z=new y.Socket("com.ds."+widget.id);z.subscribeServer("com.ds.compass",window.parent);z.dispatchEvent("onSetObject",q,"com.ds."+widget.id);z.dispatchEvent("onSetX3DContent",p,"com.ds."+widget.id);var x={model:n,type:r,appId:o,mode:u,cb:v};-z.addListener("launchApp",(function(A,C){if(C.response!=="COMPLETE"){if(A.mode!=1){var B=l.get("beh_10");B+=" ";B+=l.get("beh_10b");s.model.addMessage(B,"error","log");console.log("EC : App "+C.appId+" is not availabe. status is "+C.respnse);if(A.appId=="SIMMECS_AP"){s.openModelInApp(A.model,A.type,"SIMEMCS_AP",1,A.cb);return}else{if(A.appId=="SIMEMCS_AP"){s.openModelInApp(A.model,A.type,"SIMMECS_AP",1,A.cb);return}}}var B=l.get("beh_10");B+=" ";B+=l.get("beh_10b");s.model.addMessage(B,"error","notification");console.log("EC : App "+C.appId+" is not availabe. status is "+C.respnse)}z.dispatchEvent("onResetObject",{},"com.ds."+widget.id);z.dispatchEvent("onResetX3DContent",{},"com.ds."+widget.id);if(v){v()}}).bind(this,x));z.dispatchEvent("onLaunchApp",{appId:o},"com.ds."+widget.id)})}});var j={};j.openFile=function(r,v,B,A,w,p){var u=this;var z=u.model;var n=z.getEditor();if(!v){var t=l.get("comp_add_spinner");if(t==="comp_add_spinner"){t="Adding Component..."}var q={message:t,exclusive:false};n.addSystemSpinner(q);j.getUIInstanceName.call(u,r.name,null,function(x,y){if(!x){n.removeSystemSpinner(q);return}var C={};C.title=r.name;C.type="DS/RFLModelerWeb/RFL_Component";z.createComponent(C,function(D){z.root.addInstance1(B,A,110,86,y,null,D.getID(),function(E){E.getReference().addBehavior1(r.name,r.path,r.type,null,"",function(F){if(r.is3dfmu){F.is3dfmu=true}F.addFile(r.value,function(){z.addMessage("The file has been opened.","info","log");n.removeSystemSpinner(q);if(w){w(E)}})},function(){z.addMessage("The file could not be opened because the abstraction could not be added.","error","notification");n.removeSystemSpinner(q);if(p){p()}})},function(){z.addMessage("The file could not be opened because the instance could not be added.","error","notification");n.removeSystemSpinner(q);if(p){p()}})},function(){z.addMessage("The file could not be opened because the component could not be created.","error","notification");n.removeSystemSpinner(q);if(p){p()}})})}else{var o={message:"Adding Abstraction...",exclusive:false};n.addSystemSpinner(o);var s=v.getReference();s.addBehavior1(r.name,r.path,r.type,null,"",function(x){x.addFile(r.value,function(){z.addMessage("The file has been opened.","info","log");n.removeSystemSpinner(o);if(w){w(v)}})},function(){z.addMessage("The file could not be opened because the abstraction could not be added.","error","notification");n.removeSystemSpinner(q);if(p){p()}})}};j.openReference=function(n,u,t,p,v){var r=this;var q=r.model;var s=q.getEditor();var o={message:"Loading Components...",exclusive:false};s.addSystemSpinner(o);require(["DS/SMAMSExperimentServices/Reference"],function(w){var x={};x.physicalId=n;x.onComplete=function(z){z.type="DS/RFLModelerWeb/RFL_Component";if(s.root){if(z.subComponents.length>0){var y=l.get("sys_13");if(y==="sys_13"){y="The selected reference could not be added because it is not a valid component."}r.model.addMessage(y,"error","notification");s.removeSystemSpinner(o);return}if(z.physicalId===s.root.getID()){var B=l.get("sys_14");if(B==="sys_14"){B="The selected reference cannot be added because it is currently open as the system."}r.model.addMessage(B,"error","notification");s.removeSystemSpinner(o);return}j.getUIInstanceName.call(r,z.title,n,function(D,E){if(!D){s.removeSystemSpinner(o);return}r.model.createComponent(z,function(F){r.model.root.addInstance1(u,t,110,86,E,null,F.getID(),function(){r.model.addMessage("The reference has been read.","info","log");s.removeSystemSpinner(o);if(v){v()}},function(){r.model.addMessage("The component could not be created because the instance could not be added.","error","notification");s.removeSystemSpinner(o)})},function(){r.model.addMessage("The component could not be created.","error","notification");s.removeSystemSpinner(o)})})}else{if(z.subComponents.length===0&&z.behaviors&&z.behaviors.length>0){var A=l.get("sys_12");if(A==="sys_12"){A="The selected reference could not be opened because it is not a valid system."}r.model.addMessage(A,"error","notification");s.removeSystemSpinner(o);return}if(p===true){var C=l.get("drop_01");if(C==="drop_01"){C="The drag and drop of this object type is not supported."}r.model.addMessage(C,"error","notification");s.removeSystemSpinner(o);return}else{r.model.createComponent(z,function(D){r.model.createSystem(D,z,function(E){r.model.setRoot(E);s.removeSystemSpinner(o);if(v){v()}},function(){r.model.addMessage("The component could not be created.","error","notification");s.removeSystemSpinner(o)})},function(){r.model.addMessage("The component could not be created.","error","notification");s.removeSystemSpinner(o)})}}};x.onFailure=function(A,z,C){var y=l.get("comp_read");if(y==="comp_read"){y="The component could not be read."}var B=[A,z,C];q.addMessage(y,"error","notification",B);s.removeSystemSpinner(o)};w.read(x)})};j.openSimulation=function(r,n,t,s){var q=this;var p=q.model.getEditor();var o=p.getUIFrame().querySelector("#eGraphDiv");if(o){o.hide()}require(["DS/SMAMSExecutionServices2/SMAMSExecutionServices2","DS/SMAMSWeb/SMAMSExperiment"],function(u,w){q.model.closeModel();var v={message:"Loading Experiment...",exclusive:true};p.addSystemSpinner(v);p.removeIntroText();p.removeRecentExp();u.load(r,function(x){var z=function(H){var B=new CustomEvent("openSimulationSuccess");document.dispatchEvent(B);p.removeSystemSpinner(v);widget.setTitle(x.getProcessInfo().title);widget.setValue("rootID",r);var G=f.clone(widget.getValue("recentExp"));if(!G){G=[]}if(G.length>4){G.splice(0,G.length-4)}var D={name:H.name,description:H.description,phID:H.phID};for(var E=0;E<G.length;E++){var F=G[E];if(F.phID===D.phID){G.splice(E,1)}}G.push(D);widget.setValue("recentExp",G);var C=l.get("exp_08");if(C==="exp_08"){C="The experiment has been loaded."}q.model.addMessage(C,"success","notification");delete H.opening;if(o){o.show()}if(s){s()}};var A=0;var y=function(){q.model.experiment=null;p.removeSystemSpinner(v);A++;if(A===1){var B=l.get("exp_09");if(B==="exp_09"){B="The experiment could not be loaded."}}WUX.AFR.CommandsManager.disableAll();WUX.AFR.CommandsManager.getCommand("SMAMultiScaleSearchExpCmdHdr").enable();WUX.AFR.CommandsManager.getCommand("SMAMultiScaleExpCmdHdr").enable();WUX.AFR.CommandsManager.getCommand("SMAMultiScaleCloseCmdHdr").begin();if(o){o.show()}if(s){s()}return};x.getSystem(function(B){j.openReference.call(q,B,n,t,false,function(){var C=0;var D=new w(q.model,x.getProcessInfo().physicalId);D.setInfo(x.getProcessInfo(),function(){},function(){});D.setProcess(x);q.model.addExperiment(D);D.opening=true;C++;x.getSolverParameters(function(F){var E={};E.duration=F.ExperimentDuration;E.algorithm=F.Algorithm;E.negotiationMethod=F.NegotiationMethod;E.leadActor=F.LeadActor;E.constantDt=F.ConstantDT;E.masterActor=F.MasterActor;D.setSolverOptions(E,true,function(){},function(){});C--;if(C===0){z(D)}},function(E){q.model.addMessage(E,"error","info");q.model.addMessage("The experiment could not be loaded because the solver options could not be retrieved.","error","notification");C=0;y();return});C++;x.getBehaviors(function(F){for(var E=0;E<F.length;E++){var H=q.model.getRoot().getInstance(F[E].instancePhysicalId);if(!H){q.model.addMessage("The experiment could not be loaded because the system and the experiment are not synchronized.","error","notification");C=0;y();return}}var I=function(){for(var J=0;J<F.length;J++){C++;x.getLinkInteractionConfiguration(F[J].activityPhysicalId,(function(P){for(var N in P){var O=N;var U=q.model.getRoot().listLinks();var R=null;for(var T=0;T<U.length;T++){if(U[T].phID===O){R=U[T];break}}var M=null;var V=null;var Q=null;var S=null;if(typeof P[N]==="string"){S=P[N]}else{S=P[N].interaction;M=P[N].mapping;V=P[N].ramping;Q=P[N].coupling}D.addInteraction1(R,S,M,V,Q,true,function(){},function(){})}C--;if(C===0){z(D)}}).bind(F[J]),function(M){q.model.addMessage("The experiment could not be loaded because the interactions could not be retrieved.","error","notification");q.model.addMessage(M,"error","info");C=0;y();return});C++;x.getBehaviorParameters(F[J].activityPhysicalId,(function(N){var O={};for(var M=0;M<N.length;M++){O[N[M].name]={type:"Real",value:N[M].startValue}}D.setParameters(this.instancePhysicalId,O,null,function(){},function(){});C--;if(C===0){z(D)}}).bind(F[J]),function(M){q.model.addMessage("The experiment could not be loaded because the parameters could not be retrieved.","error","notification");q.model.addMessage(M,"error","info");C=0;y();return});var L=q.model.getRoot().getInstance(F[J].instancePhysicalId).reference;var K=L.getBehavior(F[J].repPhysicalId);if(K.sim){if(K.is3dfmu){C++;x.downloadSpec(F[J].activityPhysicalId,(function(O){var M=new FileReader();var N=q.model.root.getInstance(this.instancePhysicalId).getSelectedBehavior();M.onload=function(){var P=f.Utils.loadXml(M.result);if(P.getElementsByTagName("clientSolver")[0]){N.clientSolverParameters=P.getElementsByTagName("clientSolver")[0]}C--;if(C===0){z(D)}};M.readAsText(O)}).bind(F[J]),function(M){q.model.addMessage("The experiment could not be loaded because the spec file could not be retrieved.","error","notification");q.model.addMessage(M,"error","info");C=0;y();return})}else{C++;x.getSimulationConfiguration(F[J].activityPhysicalId,(function(M){D.setSimConfig(this.instancePhysicalId,M,true,function(){},function(){});C--;if(C===0){z(D)}}).bind(F[J]),function(M){q.model.addMessage("The experiment could not be loaded because the SIM configuration could not be retrieved.","error","notification");q.model.addMessage(M,"error","info");C=0;y();return})}}}};var G=0;for(var E=0;E<F.length;E++){D.addBehavior1(F[E].instancePhysicalId,F[E].repPhysicalId,F[E].activityPhysicalId,function(){G++;if(G===F.length){I()}},function(){C=0;y();return})}C--;if(C===0){z(D)}},function(E){q.model.addMessage(E,"error","info");q.model.addMessage("The experiment could not be loaded because the abstractions could not be retrieved.","error","notification");C=0;y();return})})},function(B){q.model.addMessage("The experiment could not be loaded because the system could not be retrieved.","error","notification");q.model.addMessage(B,"error","info");y();return})},function(y){var x=l.get("exp_09");if(x==="exp_09"){x="The experiment could not be loaded."}q.model.addMessage(x,"error","notification");q.model.addMessage(y,"error","info");p.removeSystemSpinner(v);WUX.AFR.CommandsManager.disableAll();WUX.AFR.CommandsManager.getCommand("SMAMultiScaleSearchExpCmdHdr").enable();WUX.AFR.CommandsManager.getCommand("SMAMultiScaleExpCmdHdr").enable();WUX.AFR.CommandsManager.getCommand("SMAMultiScaleCloseCmdHdr").begin();if(o){o.show()}})})};j.getUIInstanceName=function(o,s,u){var r=this.model.getComponent(s);var w=1;if(r){for(var p=0;p<r.instances.length;p++){var v=r.instances[p].name;var n=v.lastIndexOf("-");if(n!==-1){n=v.lastIndexOf("-")+1;var q=v.substring(n,v.length);if(isNaN(q)){w++}else{if(w<=parseInt(q)){w=parseInt(q)+1}}}}}var t=o+"-"+w;u(true,t)};return m});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSInitWidget",["UWA/Core","module","DS/Logger/Logger","DS/RFLModelerWeb/RFL_Editor","DS/RFLModelerWeb/RFL_Model","DS/SMAMSWeb/SMAMSEditorManager","DS/SMAMSWeb/SMAMSExperiment","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/egraph/core","DS/egraph/views","DS/egraph/iact","DS/SMAMSExperimentServices/SMAMSExperimentServices","DS/SMAMSExperimentServices/Document","DS/PlatformAPI/PlatformAPI","DS/SMAMSExecutionServices/SMAMSExecutionServices","DS/Core/Core"],function(h,a,p,k,d,m,j,e,o,l,n,c,g,b,q,f){var r=p.getLogger(a);var i=h.Class.extend({init:function(){this.editor=null;this.RefreshInProgress=false},onReady:function(w){var u=widget.getViewportDimensions().height+"px";widget.body.setStyle("height",u);r.log("MS info : EXPC widget initialized");var t=widget.environment.name;if(t==="uwa"){define("DS/i3DXCompass/i3DXCompassServices",{getServiceUrl:function(){}})}else{var s=widget.getValue("x3dPlatformId");if(!s||s===undefined||s===""){s="OnPremise"}r.log(s);var v=this;e.initialize(s,{onSuccess:function(y){r.log(y);var x=function(G){var z=new m();var F=widget.body.querySelector("#graph_canvas");var C="SMAMultiScale";var B={container:F,application:C,module:"SMAMSWebUI",theme:"DS/RFLModelerWeb/RFL_ThemeBase",editor_event_handler:z};widget.editor=new k(B);var A=new d();A.addToEditor(widget.editor);widget.editor.model=A;z.setModel(A);var D=widget.editor.spinner;D.hide();var E=widget.getValue("rootID");if(E&&E.length&&E!==undefined&&E!==null){z.openSimulation(E)}if(G){G()}};if(w){x(w)}else{widget.spDashboard=document.createElement("sp-dashboard");widget.spDashboard.addSecurityContextPreference().then(function(){if(widget.getValue("collabspaces")){e.setCurrentContext(widget.getValue("collabspaces"))}c.securityContext=e.getCurrentContext();c.serverUrl=e.ThreeDSpaceUrl;g.getToken({onComplete:function(){}});var z=widget.spDashboard.getCurrentPlatform();if(widget.spDashboard.getCurrentPlatform()&&widget.spDashboard.getCurrentPlatform()!=="OnPremise"){v.setTenantId()}x()},function(z){r.log(z)})}},onFailure:function(x){r.log(x)}})}},onLoad:function(){var s=this;if(!h.is(console)){console={};console.log=function(){return};console.info=function(){return};console.error=function(){return};console.warn=function(){return}}var t=sessionStorage.getItem("DS/Logger/Logger.loggerConfig");if(typeof t!=="undefined"&&h.is(t)){t=JSON.parse(t);if(!t["DS/RFLModelerWeb/RFL_Model"]||!t["DS/SMAMSWeb/SMAMSInitWidget"]){t["DS/RFLModelerWeb/RFL_Model"]={level:"OFF"};t["DS/SMAMSWeb/SMAMSInitWidget"]={level:"OFF"}}}else{t={};t["DS/RFLModelerWeb/RFL_Model"]={level:"OFF"};t["DS/SMAMSWeb/SMAMSInitWidget"]={level:"OFF"}}sessionStorage.setItem("DS/Logger/Logger.loggerConfig",JSON.stringify(t));if(document.createElement("sp-dashboard").isInDashboard){s.onReady.call(s)}else{window.addEventListener("polymer-ready",s.onReady.bind(s))}},endEdit:function(){r.log("MS info : EXPC widget security context changed");e.setCurrentContext(widget.getValue("collabspaces"));c.securityContext=e.getCurrentContext()},onPreferenceEdit:function(){r.log("MS info : EXPC widget prefix changed")},onRefresh:function(){if(!widget.RefreshInProgress){widget.RefreshInProgress=false}if(widget.RefreshInProgress===true){return}widget.RefreshInProgress=true;var s=widget.editor.eventHandler;var t=widget.getValue("rootID");if(t&&t.length&&t!==undefined&&t!==null&&s){s.openSimulation(t,function(){widget.RefreshInProgress=false})}else{widget.editor.model.closeModel()}r.log("MS info : EXPC widget refreshed")},onResize:function(){r.log("MS info : EXPC widget resize");var s=widget.getViewportDimensions().height+"px";widget.body.setStyle("height",s)},onViewChange:function(s){if(!s){return}r.log("MS info : EXPC widget viewchange");if(s.type==="maximized"||s.type==="fullscreen"){widget.body.setStyle("height",s.height+"px")}else{widget.body.setStyle("height","516px")}},setTenantId:function(){var y=document.createElement("sp-webservice");var x,t,v,s;var w=b.getApplicationConfiguration("app.urls.myapps");q.myAppsUrl=w;var u={name:"tenantId",type:"list",label:"License Pool"};x=function(A){var C,z,D=[];if(A.response){C=A.response.split(/\n/)[0].split(/=/)[1].split(/,/);z=A.response.split(/\n/)[2].split(/=/)[1];if(C.length>1){for(var B=0;B<C.length;B++){D.push({value:C[B],label:C[B]})}u.options=D;u.defaultValue=C[0];widget.addPreference(u)}else{widget.setValue("tenantId",C[0])}widget.setValue("licenseURL",z);q.WUTenantID=C[0];q.dslsServer=z;q.WATenantID=widget.spDashboard.getCurrentPlatform();q.isCloud=true}}.bind(this);t=function(z){var A={text:"Unable to get Tenant ID",type:"error",autoRemove:false}}.bind(this);v={verb:"GET",uri:w+"/resources/AppsMngt/licenses/whereused",headers:{Accept:"text/plain"},onComplete:x,onError:t,};y.sendRequest(v)}});return i});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSRule",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/Core/Core"],function(e,b,d){function a(g,h,f,i){this._type=g;this._message=h;this._owner=f;this._cmdHdr=i;this._editionCallbacks=[];this.getType=function(){return this._type};this.getMessage=function(){return this._message};this.getOwner=function(){return this._owner};this.getCommand=function(){return this._cmdHdr};this.onEdition=function(j){this._editionCallbacks.push(j)};this.createUI=function(){var q=e.createElement("div");q.setAttribute("class","MS_Rule_Error");var n=e.createElement("div").inject(q);var k=e.createElement("span").inject(n);var j="wux-ui-3ds MS_Rule_Command_Neutral";if(g==="error"){j+=" wux-ui-3ds-alert"}else{if(g==="warning"){j+=" wux-ui-3ds-attention"}else{if(g==="info"){j+=" wux-ui-3ds-info"}}}k.setAttribute("class",j);k.style.marginRight="10px";var l=e.createElement("div").inject(q);l.setAttribute("class","MS_Rule_Message_Inactive");l.appendChild(e.createElement("span",{text:h}));l.appendChild(e.createElement("br"));if(this._owner&&this._owner.type){l.setAttribute("class","MS_Rule_Message_Active");l.onclick=(function(){if(this._owner.type==="component"){var w=this._owner.component.instances[0];var t=w.view;var y=w.getReference().getModel().getEditor();t.gr.replaceSelectionWith(t);setTimeout(function(){y.reframeOnComponent(w)},300)}else{if(this._owner.type==="instance"){var A=this._owner.instance;var C=A.view;var x=A.getReference().getModel().getEditor();x.clearSelection();C.gr.replaceSelectionWith(C);setTimeout(function(){x.reframeOnComponent(A)},300)}else{if(this._owner.type==="connector"){var z=this._owner.instance;var B=z.view;var v=z.getReference().getModel().getEditor();var r=B.children.first;var u=function(){v.reframeOnComponent(z)};while(r){if(r.data.name===this._owner.connector){B.gr.replaceSelectionWith(B);B.gr.addToSelection(r);setTimeout(u,300);break}r=r.next}}else{if(this._owner.type==="link"){var s=f.link.view;s.gr.replaceSelectionWith(s)}}}}}).bind(this)}var m=e.createElement("div").inject(q);var o=e.createElement("span").inject(m);var j="wux-ui-3ds wux-ui-3ds-pencil MS_Rule_Command_Inactive";o.setAttribute("class",j);o.style.marginLeft="10px";o.style.fontSize="1.3em";if(this._cmdHdr){var p=d.AFR.CommandsManager.getCommand(this._cmdHdr);if(p){o.classList.remove("MS_Rule_Command_Inactive");o.classList.add("MS_Rule_Command_Active");o.onclick=(function(){if(this._owner&&this._owner.type==="instance"){var r=this._owner.instance;var s=r.view;s.gr.replaceSelectionWith(s)}p.begin()}).bind(this);p.onEnd((function(){for(var r=0;r<this._editionCallbacks.length;r++){this._editionCallbacks[r]()}}).bind(this))}}return q}}var c=e.Class.extend({init:function(){this._name="";this._title="";this._errors=[]},getName:function(){return this._name},getTitle:function(){return this._title},getErrors:function(){return this._errors},addError:function(g,h,f,i){this._errors.push(new a(g,h,f,i))},check:function(f){f();return}});return c});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSRuleInteraction",["DS/SMAMSWeb/SMAMSRule","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(b,c){var a=b.extend({init:function(){this._parent();this._name="Interactions";this._title="Interactions validation"},check:function(k,m){var l=k.getModel().getRoot();for(var y=0;y<l.listLinks().length;y++){var g=l.listLinks()[y].comp1.getReference().getConnector(l.listLinks()[y].con1);if(g.type!="Region"){continue}var r=false;for(var v=0;v<k.listInteractions().length;v++){if(k.listInteractions()[v].linkID==l.listLinks()[y].getID()){r=true;break}}if(r){continue}var s={};s.link=l.listLinks()[y];s.type="link";var t=s.link.view.views.main.structure.root.querySelector(".my-interaction-type");var w=WUX.AFR.CommandsManager.getCommand("SMAMultiScaleInterCmdHdr");w.setOptions(k.model,t,s.link);var h=c.get("check_interaction1");if(h==="check_interaction1"){h="Interaction cannot be empty."}this.addError("error",h,s,"SMAMultiScaleInterCmdHdr")}var e=k.listInteractions();var x=k.getAlgorithm();var n=0,p=0,z=0,u=0,d=0,f=0;for(var y=0;y<e.length;y++){if(e[y].value==="SXS"){n++}if(e[y].value==="SXL"){p++}if(e[y].value==="FSI"){z++}if(e[y].value==="CHT"){u++}if(e[y].value==="IHT"){d++}}f=l.listLinks().length-e.length;if(n+p+z+u+d>2){var h=c.get("check_interaction11");if(h==="check_interaction11"){h="more than 2 3D interations is not suppoted."}this.addError("error",h,null,null)}if(n+p+z+u+d==2){var q=l.getLink(e[0].linkID);var o=l.getLink(e[1].linkID);if(q&&o){if(o.comp1!=q.comp1&&o.comp1!=q.comp2&&o.comp2!=q.comp1&&o.comp2!=q.comp2){var h=c.get("check_interaction12");if(h==="check_interaction12"){h="The 2 interactions cannot be independent."}this.addError("error",h,null,null)}}}if(n>1){var h=c.get("check_interaction2");if(h==="check_interaction2"){h="SXS is an exclusive Interaction, only 1 must exist per Experiment."}this.addError("error",h,null,null)}else{if(n>0&&(p+z+u+d+f>0)){var h=c.get("check_interaction3");if(h==="check_interaction3"){h="SXS is an exclusive Interaction, it cannot be mixed with other types of links."}this.addError("error",h,null,null)}else{if(n>0&&x!=="GANDC"){var h=c.get("check_interaction4");if(h==="check_interaction4"){h="GANDC Algorithm must be chosen for SXS Interactions."}this.addError("error",h,null,"SMAMultiScaleExpParamsCmdHdr")}}}if(p>0&&(n+z+u+d+f>0)){var h=c.get("check_interaction5");if(h==="check_interaction5"){h="SXL is an exclusive Interaction, it cannot be mixed with other types of links."}this.addError("error",h,null,null)}else{if(p>0&&x!=="GAUSS-SEIDEL-PREDICTOR"){var h=c.get("check_interaction6");if(h==="check_interaction6"){h="GAUSS-SEIDEL-PREDICTOR Algorithm must be chosen for SXL Interactions."}this.addError("error",h,null,"SMAMultiScaleExpParamsCmdHdr")}}if(z>0&&(n+p+d>0)){var h=c.get("check_interaction7");if(h==="check_interaction7"){h="FSI Interaction can only be used with other FSI or CHT interactions."}this.addError("error",h,null,null)}else{if(z>0&&(x!=="GAUSS-SEIDEL"&&x!=="JACOBI")){var h=c.get("check_interaction8");if(h==="check_interaction8"){h="FSI Interaction can only be used with GAUSS-SEIDEL or JACOBI Algorithm."}this.addError("error",h,null,"SMAMultiScaleExpParamsCmdHdr")}}if(u>0&&(n+p+d>0)){var h=c.get("check_interaction9");if(h==="check_interaction9"){h="CHT Interaction can only be used with other CHT or FSI interactions."}this.addError("error",h,null,null)}else{if(u>0&&(x!=="GAUSS-SEIDEL"&&x!=="JACOBI")){var h=c.get("check_interaction10");if(h==="check_interaction10"){h="CHT Interaction can only be used with GAUSS-SEIDEL or JACOBI Algorithm."}this.addError("error",h,null,"SMAMultiScaleExpParamsCmdHdr")}}if(f>0&&p+n+z+u+d==0&&(x!=="GAUSS-SEIDEL"&&x!=="JACOBI")){var h=c.get("check_interaction13");if(h==="check_interaction13"){h="Without 3D Interactions, only GAUSS-SEIDEL or JACOBI Algorithm can be used."}this.addError("error",h,null,"SMAMultiScaleExpParamsCmdHdr")}if(d>0&&(n+p+z+u>0)){var h=c.get("check_interaction5");if(h==="check_interaction5"){h="IHT is an exclusive Interaction, it cannot be mixed with other types of links."}this.addError("error",h,null,null)}else{if(d>0&&x!=="GAUSS-SEIDEL"){var h=c.get("check_interaction6");if(h==="check_interaction6"){h="GAUSS-SEIDEL Algorithm must be chosen for IHT Interactions."}this.addError("error",h,null,"SMAMultiScaleExpParamsCmdHdr")}}m()}});return a});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSRuleBehaviorSelection",["DS/SMAMSWeb/SMAMSRule"],function(a){var b=a.extend({init:function(){this._parent();this._name="Abstraction selection";this._title=""},check:function(c,d){var h=c.getModel().getRoot().listInstances();for(var e=0;e<h.length;e++){if(!h[e].getSelectedBehavior()){var f='no abstraction selection for "'+h[e].getInfo().name+'"';var g={};g.type="instance";g.instance=h[e];this.addError("error",f,g,"SMAMultiScaleBehSelCmdHdr")}}d()}});return b});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSRuleMapping",["DS/SMAMSWeb/SMAMSRule"],function(a){var b=a.extend({init:function(){this._parent();this._name="Mapping";this._title="Maping validation"},check:function(e,d){var h=e.getModel().getRoot().listInstances();var n=[];var l=[];var j;for(var o=0;o<h.length;o++){n=[];j=h[o].reference.getListConnectors();for(var f in j){if(!j.hasOwnProperty(f)){continue}n.push(f)}var g=h[o].reference.listBehaviors();var m=null;if(e.behaviors[h[o].getID()]){m=e.behaviors[h[o].getID()].behavior}for(var i=0;i<g.length&&m;i++){if(g[i].getID()===m){l=[];var k=g[i].getConnectors();for(var c=0;c<k.length;c++){l.push(k[c].name)}this.processBehavior.call(this,h[o],g[i],n,l);break}}}d()},processBehavior:function(k,c,i,f){for(var j=0;j<i.length;j++){var h=f.indexOf(i[j]);if(h===-1){var l='Port "'+i[j]+'" is not mapped for "'+c.getInfo().name+'" Abstraction of "'+k.getInfo().name+'" Component';var g={};g.type="instance";g.instance=k;this.addError("error",l,g,"SMAMultiScaleEditCompCmdHdr")}else{f.splice(h,1)}}for(j=0;j<f.length;j++){var d='Port "'+f[j]+'" belonging to "'+c.getInfo().name+'" is not present on Component "'+k.getInfo().name;var e={};e.type="instance";e.instance=k;this.addError("error",d,e,"SMAMultiScaleEditCompCmdHdr")}}});return b});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSRuleConnector",["DS/SMAMSWeb/SMAMSRule","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages",],function(a,c){var b=a.extend({init:function(){this._parent();this._name="Connectors";this._title="Connectors validation"},check:function(e,d){var h=e.listBehaviors();for(var k in h){if(!h.hasOwnProperty(k)){continue}var m=e.getModel().getRoot().getInstance(k);if(m&&m.getSelectedBehavior()){var i=m.getReference();var f=i.getListConnectors();if(Object.keys(m.connectors).length===0){var n=c.get("check_connector3");if(n==="check_connector3"){n="instance %1 is not connected."}n=n.replace("%1",'"'+m.getInfo().name+'"');var j={};j.type="instance";j.instance=m;this.addError("error",n,j,null)}else{for(var g in f){if(f[g].causality==="I"&&!m.connectors[g]){var n=c.get("check_connector1");if(n==="check_connector1"){n='"Port %1 of instance %2 is not connected."'}n=n.replace("%1",'"'+g+'"');n=n.replace("%2",'"'+m.getInfo().name+'"');var j={};j.type="connector";j.instance=m;j.connector=g;this.addError("error",n,j,null)}else{if(f[g].causality==="I"){var l=i.getBehavior(h[k].behavior);if(l&&l.sim){var n=c.get("check_connector2");if(n==="check_connector2"){n="The input value provided to port %1 of instance %2 will be applied as an amplitude to the feature published in the model."}n=n.replace("%1",'"'+g+'"');n=n.replace("%2",'"'+m.getInfo().name+'"');var j={};j.type="connector";j.instance=m;j.connector=g;this.addError("warning",n,j,null)}}}}}}else{continue}}d()}});return b});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSRuleExperiment",["DS/SMAMSWeb/SMAMSRule"],function(a){var b=a.extend({init:function(){this._parent();this._name="Experiment";this._title="Experiment validation"},check:function(e,g){var d=e.listBehaviors();var i=e.model.components;var c=true;var h=0;for(var k in d){if(d.hasOwnProperty(k)){c=false;for(var f=0;f<i.length;f++){if(i[f].getBehavior(d[k].behavior)&&!i[f].getBehavior(d[k].behavior).fmu){h++}}}}if(c){this.addError("error","Experiment should contain atleast one component with a selected abstraction",null,"SMAMultiScaleBehSelCmdHdr")}if(h===0&&e.solverOptions.negotiationMethod!=="CONSTANTDT"){this.addError("error","Experiment negotiation method should be CONSTANTDT",null,"SMAMultiScaleExpParamsCmdHdr")}if(e.solverOptions.negotiationMethod==="CONSTANTDT"){if(isNaN(e.solverOptions.constantDt)||e.solverOptions.constantDt<=0){this.addError("error","Experiment ConstantDT value should be a Number greater than 0",null,"SMAMultiScaleExpParamsCmdHdr")}}if(e.solverOptions.duration<=0){this.addError("error","Experiment duration is invalid",null,"SMAMultiScaleExpParamsCmdHdr")}g()}});return b});define("DS/SMAMSWeb/SMABehavior",["UWA/Core","DS/RFLModelerWeb/RFL_Base","DS/WebappsUtils/WebappsUtils","DS/SMAMSExperimentServices/Behavior","DS/SMAMSWeb/SMAMSGenerateConfigFile","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(g,f,c,e,a,d){var b=g.Class.extend({init:function(i,h,j){this.component=h;this.name=i;this.phID=j;this.defaultParameters={};this.parameters={};this.fieldVariables=[];this.connectors=[];this.mapping={};this.thumbnail={};this.description="";this.md=null},getInfo:function(){var h={};h.name=this.name;h.description=this.description;return h},setInfo:function(k,l,i){var o=this;var h=o.component.model;var n=o.getInfo();var m=function(p){if(p===-1){o.name=n.name;o.description=n.description;i()}else{l()}};if(n===k){m(0);return}o.name=k.name;o.description=k.description;var j={};j.physicalId=o.getID();j.title=o.name;j.description=o.description;j.onComplete=function(){h.addMessage("The abstraction has been updated.","info","log");m(0)};j.onFailure=function(r,q,t){var s=[r,q,t];var p=d.get("beh_update");if(p==="beh_update"){p="The abstraction could not be updated."}h.addMessage(p,"error","notification",s);m(-1)};e.update(j)},getID:function(){return this.phID},setDefaultParameters:function(h){this.defaultParameters=h},getDefaultParameters:function(){return this.defaultParameters},setFieldVariables:function(h){this.fieldVariables=h},getFieldVariables:function(){return this.fieldVariables},addConnector:function(h){this.connectors.push(h)},getConnectors:function(){return this.connectors},setMapping:function(h){this.mapping=h},getMapping:function(){return this.mapping},setThumbnail:function(h,n,o,j){var m=this;var k=JSON.parse(JSON.stringify(m.getThumbnail()));var l=m.component.getModel();var p=function(q){if(q===-1){m.thumbnail.file=k.file;j()}else{for(var r=0;r<m.component.instances.length;r++){var s=m.component.instances[r];if(s.getSelectedBehavior()===m){s.setThumbnail(m.thumbnail.file);s.buildNode()}}o()}};m.thumbnail.file=h.file;if(n){var i={};i.physicalId=m.phID;i.file=h.file;i.onComplete=function(){l.addMessage("The thumbnail has been changed.","info","log");p(0)};i.onFailure=function(s,r,u){var t=[s,r,u];var q=d.get("thumbnail_change");if(q==="thumbnail_change"){q="The thumbnail could not be changed."}l.addMessage(q,"error","notification",t);p(-1)};e.changeThumbnail(i)}else{p(0)}},getThumbnail:function(){return this.thumbnail},removeThumbnail:function(m,j){var n=this;var h=n.component.getModel();var k=JSON.parse(JSON.stringify(n.getThumbnail()));var l=function(o){if(o===-1){n.thumbnail=k;j()}else{m()}};this.thumbnail={};var i={};i.physicalId=n.getID();i.onComplete=(function(){h.addMessage("The thumbnail has been removed.","info","log");l(0)}).bind(n);i.onFailure=function(q,p,s){var r=[q,p,s];var o=d.get("thumbnail_remove");if(o==="thumbnail_remove"){o="The thumbnail could not be removed."}h.addMessage(o,"error","notification",r);l(-1)};e.removeThumbnail(i)},instanceAdded:function(k,l,i){try{var h=k.getReference().getModel().getExperiment();if(g.is(h)&&h.opening!==true){if(k.getReference().listBehaviors()[0]===this){h.addBehavior1(k.getID(),this.phID,null,function(){l()},function(){i()})}else{l()}}else{l()}}catch(j){i(j)}},removeFromComponent:function(){},removeInstance:function(j){var i=this.component.getModel();if(!g.is(j)||j.getReference()!==this.component){i.addMessage("SMABehavior.removeInstance bad input parameter","error","log");return}var h=i.getExperiment();h.removeBehavior1(j.getID(),function(){},function(){})},localSave:function(o,m){var n=[];var l=function(s,r,q){var p={};p.physicalId=s;p.onComplete=function(t){r(t)};p.onFailure=function(){console.log("error getting FMU");q()};e.downloadFmu(p)};var i=function(q,r){var p=document.createElement("a");document.body.appendChild(p);p.setAttribute("style","display: none");p.href=window.URL.createObjectURL(q);p.download=r;p.click();window.URL.revokeObjectURL(window.URL.createObjectURL(q));document.body.removeChild(p)};var h=function(p,r){var q=this;require(["DS/ZipJS/zip-fs"],function(s){s.createWriter(new s.BlobWriter("application/zip"),function(t){t.add("resources/sim.SMASim",new s.BlobReader(p),function(){t.add("modelDescription.xml",new s.BlobReader(new Blob([q.md])),function(){if(q.getThumbnail()&&q.getThumbnail().file){t.add("model.png",new s.BlobReader(q.getThumbnail().file),function(){t.close(r)})}else{t.close(r)}})})},function(){console.log("ERROR")})})};for(var k in this.defaultParameters){if(!this.defaultParameters.hasOwnProperty(k)){continue}n.push({title:k,value:this.defaultParameters[k].value,dimension:this.defaultParameters[k].type})}var j={title:this.getInfo().name,description:this.getInfo().description,physicalId:this.getID(),parameters:n,type:this.fmu?"fmu":"sim",thumbnail:"",file:{md:this.md,fileBlob:this.getInfo().name+(this.fmu?".fmu":".simfmu")}};if(m){l(this.getID(),(function(p){if(this.sim){h.call(this,p,function(q){q.fileName=j.file.fileBlob;o(j,q)})}else{p.fileName=j.file.fileBlob;o(j,p)}}).bind(this))}else{o(j)}}});return b});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAFmuBehavior",["UWA/Core","DS/SMAMSWeb/SMABehavior","DS/RFLModelerWeb/RFL_Base","DS/WebappsUtils/WebappsUtils","DS/SMAMSExperimentServices/Behavior","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/RFLModelerWeb/RFL_Connector"],function(b,g,f,c,a,i,e){var d=g.extend({init:function(k,j,l){this._parent(k,j,l);this.fmu=null;this.div=null},addFile:function(k,n,l,j){if(!this.fmu){var m=this;m.fmu=k;m.readFMU(k,m.div,n,l,j)}},readFMU:function(k,p,o,m,j){var n=this;var l=n.component.model;if(typeof k==="string"){h(n,k,m,j,o,function(){},function(){})}else{require(["DS/ZipJS/zip-fs"],function(q){q.workerScriptsPath=c.getWebappsBaseUrl()+"ZipJS/";q.createReader(new q.BlobReader(k),function(r){r.getEntries(function(t){var v=0;var u=0;var w=null;var x=null;for(var s=0;s<t.length;s++){if(v===2){break}if(t[s].filename==="modelDescription.xml"||t[s].filename==="./modelDescription.xml"){w=t[s];v++;u++;continue}if(t[s].filename==="model.png"||t[s].filename==="./model.png"){x=t[s];v++;u++;continue}}if(x){x.getData(new q.BlobWriter("image/png"),function(B){var A={};A.file=B;n.setThumbnail(A,true,function(){},function(){});var z=URL.createObjectURL(B);var y=b.createElement("IMG");y.src=z;u--;if(u===0){r.close()}})}w.getData(new q.TextWriter(),function(y){h(n,y.target.result,m,j,function(){u--;if(u===0){r.close()}o()})},function(){},function(){return})})},function(){l.addMessage("zipReader_Create_Failure","error","log")})})}},buildNode:function(){var j=this.component.behaviors.length;var k=c.getWebappsBaseUrl()+"SMAMSWeb/assets/fmu.png";if(j>1){k=c.getWebappsBaseUrl()+"SMAMSWeb/assets/multi.png"}this.div=b.createElement("div");this.div.setAttribute("class","my-node-inner");this.div.appendChild(b.createElement("img",{src:k}));return this.div}});function h(I,B,D,U,K){var k=I.component.model;var C=new Blob([B],{type:"text/plain"});I.md=B;if(!D){var o={};o.physicalId=I.phID;o.file=C;o.onComplete=function(){k.addMessage("The modelDescription file has been uploaded.","info","log");var W={};W.physicalId=I.phID;W.file=I.fmu;W.onComplete=function(){k.addMessage("The FMU has been uploaded.","info","log")};W.onFailure=function(Z,Y,ab){var aa=[Z,Y,ab];var X=i.get("beh_05");if(X==="beh_05"){X="The FMU could not be uploaded."}k.addMessage(X,"error","notification",aa)};a.changeFmu(W)};o.onFailure=function(Y,X,aa){var Z=[Y,X,aa];var W=i.get("beh_06");if(W==="beh_06"){W="The modelDescription file could not be uploaded."}k.addMessage(W,"error","notification",Z)};a.changeModelDescription(o)}var n=b.Utils.loadXml(B);var F=n.getElementsByTagName("fmiModelDescription")[0];var z=F.getElementsByTagName("ModelExchange");var u=F.getElementsByTagName("ModelVariables");var j={};var v=u[0].getElementsByTagName("ScalarVariable");var l=1;var L=1;var O=false;if(Object.keys(I.component.getListConnectors()).length){O=true}var J=[];for(var S=0;S<v.length;S++){var T=v[S].getAttribute("causality");var t=v[S].getAttribute("variability");var q=v[S].getAttribute("valueReference");var y="";var V="Real";var M=["Real","String","Boolean","Integer","Enumeration"];for(var R=0;R<M.length;R++){var G=v[S].getElementsByTagName(M[R]);if(G.length!==0){V=M[R];break}}if(T==="output"){var H=v[S].getAttribute("name");I.addConnector({name:H,type:V,causality:f.Causality.output,valueref:q,mangledName:y});if(!D){var E={};E.name=H;E.type=V;E.causality=f.Causality.output;E.position={attach:3,offset:17*(L-0.5)};E.valueRef=q;E.mangledName=y;E.phID=null;E.typeID=I.component.model.typeRefs[E.type][0];E.parent=I.component;E.description="";var p=new e(E);if(!O){J.push(p)}L++}}else{if(T==="input"){var r=v[S].getAttribute("name");I.addConnector({name:r,type:V,causality:f.Causality.input,valueref:q,mangledName:y});if(!D){var Q={};Q.name=r;Q.type=V;Q.causality=f.Causality.input;Q.position={attach:2,offset:17*(l-0.5)};Q.valueRef=q;Q.mangledName=y;Q.phID=null;Q.typeID=I.component.model.typeRefs[Q.type][0];Q.parent=I.component;Q.description="";var A=new e(Q);if(!O){J.push(A)}l++}}else{if(T==="parameter"||T==="internal"||t==="parameter"){var w=v[S].getAttribute("name");var s={};s.value=G[0].getAttribute("start");s.type=V;j[w]=s}}}}if(J.length){I.component.addConnectors(J,function(){},function(){})}var x=JSON.parse(JSON.stringify(j));I.setDefaultParameters(x);if(!D){var m=k.getExperiment();var N=I.component.listBehaviors().length;var P=function(){I.component.buildAllNodes();if(K){K()}};if(m&&m.process&&N===1){for(var R=0;R<I.component.instances.length;R++){m.addBehavior1(I.component.instances[R].phID,I.getID(),null,P,P)}}else{if(K){K()}}}else{if(I.component.listBehaviors().length===1){I.component.buildAllNodes()}}}return d});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMASimulationBehavior",["UWA/Core","DS/SMAMSWeb/SMABehavior","DS/RFLModelerWeb/RFL_Base","DS/WebappsUtils/WebappsUtils","DS/SMAMSExperimentServices/Behavior","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/RFLModelerWeb/RFL_Connector"],function(c,g,f,d,a,i,e){var b=g.extend({init:function(k,j,l){this._parent(k,j,l);this.sim=null;this.div=null;this.codeName=null;this.is3dfmu=false;this.clientSolverParameters=c.Utils.loadXml("<clientSolver></clientSolver>").firstChild;this.simResults=true},addFile:function(l,n,k,j){if(!this.sim){var m=this;m.sim=l;m.readSIM(l,m.div,n,k,j)}},readSIM:function(m,p,o,l,j){var n=this;var k=n.component.model;if(typeof m==="string"){h(n,m,l,j,function(){},function(){})}else{require(["DS/ZipJS/zip-fs"],function(q){q.workerScriptsPath=d.getWebappsBaseUrl()+"ZipJS/";q.createReader(new q.BlobReader(m),function(r){r.getEntries(function(u){var x=0;var s=0;var y=null;var w=null;var z=null;if(n.is3dfmu){x++;s++;z=n.sim}for(var B=0;B<u.length;B++){if(x===3){break}if(u[B].filename==="modelDescription.xml"){y=u[B];x++;s++;continue}if(u[B].filename==="resources/sim.SMASim"||u[B].filename==="sim.SMASim"){z=u[B];x++;s++;continue}if(u[B].filename==="model.png"){w=u[B];x++;s++;continue}}if(w){w.getData(new q.BlobWriter("image/png"),function(F){var E={};E.file=F;n.setThumbnail(E,true,function(){},function(){});var D=URL.createObjectURL(F);var C=c.createElement("IMG");C.src=D;s--;if(s===0){r.close()}})}if(!z&&!n.is3dfmu){var v=i.get("beh_07");if(v==="beh_07"){v="Invalid SIMFMU"}k.addMessage(v,"error","notification");return}var A=function(){var C={};C.physicalId=n.phID;C.file=n.sim;C.onComplete=function(){k.addMessage("The SIMFMU has been uploaded.","info","log");s--;if(s===0){r.close()}};C.onFailure=function(F,E,H){var G=[F,E,H];var D=i.get("beh_08");if(D==="beh_08"){D="The SIMFMU could not be uploaded."}k.addMessage(D,"error","notification",G)};a.changeFmu(C)};if(!n.is3dfmu){z.getData(new q.BlobWriter("application/octet-stream"),function(C){n.sim=C;A()},function(){},function(){return})}else{A()}if(!y){var t=i.get("beh_07");if(t==="beh_07"){t="Invalid SIMFMU"}k.addMessage(t,"error","notification");return}y.getData(new q.TextWriter(),function(C){h(n,C.target.result,l,j,function(){s--;if(s===0){r.close()}o()})},function(){},function(){return})})},function(){k.addMessage("The zip reader could not be created.","error","log")})})}},buildNode:function(){var j=this.component.behaviors.length;var k=d.getWebappsBaseUrl()+"SMAMSWeb/assets/sim.png";if(j>1){k=d.getWebappsBaseUrl()+"SMAMSWeb/assets/multi.png"}this.div=c.createElement("div");this.div.setAttribute("class","my-node-inner");this.div.appendChild(c.createElement("img",{src:k}));return this.div},});function h(T,G,N,am,Y){var l=T.component.model;var H=new Blob([G],{type:"text/plain"});T.md=G;if(!N){var s={};s.physicalId=T.phID;s.file=H;s.onComplete=function(){l.addMessage("The modelDescription file has been uploaded.","info","log")};s.onFailure=function(aq,ap,at){var ar=[aq,ap,at];var ao=i.get("beh_06");if(ao==="beh_06"){ao="The modelDescription file could not be uploaded."}l.addMessage(ao,"error","notification",ar)};a.changeModelDescription(s)}var r=c.Utils.loadXml(G);var O=r.getElementsByTagName("fmiModelDescription")[0];if(O.nodeName!=="fmiModelDescription"){var y=i.get("beh_07");if(y==="beh_07"){y="Invalid SIMFMU"}l.addMessage(y,"error","notification");return}var x=O.getElementsByTagName("ModelVariables");var J=O.getElementsByTagName("VendorAnnotations");if(x.length!==1||J.length!==1){var j=i.get("beh_07");if(j==="beh_07"){j="Invalid SIMFMU"}l.addMessage(j,"error","notification");return}if(T.is3dfmu){var Z=O.getElementsByTagName("Execution");var R=O.getElementsByTagName("Results")[0];if(Z.length===0){var j=i.get("beh_07");if(j==="beh_07"){j="Invalid SIMFMU"}l.addMessage(j,"error","notification");return}while(Z[0]){if(Z[0].getAttribute("cosimulation")==="true"&&Z[0].getAttribute("codeName")){T.codeName=Z[0].getAttribute("codeName")}if(!Z[0].querySelector("[parameter='additionalArguments']")&&Z[0].querySelector("[parameter='applicationName']").getAttribute("modify")==="true"){var M=r.createElement("argument");M.setAttribute("parameter","additionalArguments");M.setAttribute("type","String");M.setAttribute("modify","true");M.setAttribute("value"," ");Z[0].getElementsByTagName("arguments")[0].appendChild(M)}T.clientSolverParameters.appendChild(Z[0])}if(R){var X=R.getElementsByTagName("argument");for(var ai=0;ai<X.length;ai++){if(X[ai].getAttribute("parameter")==="simResults"){T.simResults=X[ai].getAttribute("value");if(T.simResults==="false"){T.simResults=false}else{T.simResults=true}break}}T.clientSolverParameters.appendChild(R)}}var k={};var m=[];var z=x[0].getElementsByTagName("ScalarVariable");var I=J[0].getElementsByTagName("FieldVariable");var E=J[0].getElementsByTagName("Region");var S=J[0].getElementsByTagName("Abaqus")[0];if(S){if(S.getAttribute("analysisType")==="STANDARD"){T.codeName="Abaqus/Standard"}else{if(S.getAttribute("analysisType")==="EXPLICIT"){T.codeName="Abaqus/Explicit"}else{if(S.getAttribute("analysisType")==="CFD"){T.codeName="CFD"}}}if(S.getAttribute("applicationID")){T.appName=S.getAttribute("applicationID")}}var n=1;var aa=1;var U=1;var W=[];var ad=false;if(Object.keys(T.component.getListConnectors()).length){ad=true}for(var ak=0;ak<z.length;ak++){var al=z[ak].getAttribute("causality");var w=z[ak].getAttribute("variability");var t=z[ak].getAttribute("valueReference");var C="";var an="Real";var P=z[ak].getElementsByTagName(an);if(P.length===0){an="Integer";P=z[ak].getElementsByTagName(an)}if(P.length===0){an="Boolean";P=z[ak].getElementsByTagName(an)}if(P.length===0){an="String";P=z[ak].getElementsByTagName(an)}if(P.length===0){an="Enumeration";P=z[ak].getElementsByTagName(an)}if(P.length===0){}if(al==="output"){var Q=z[ak].getAttribute("name");T.addConnector({name:Q,type:an,causality:f.Causality.output,valueref:t,mangledName:C});if(!N){var L={};L.name=Q;L.type=an;L.causality=f.Causality.output;L.position={attach:3,offset:17*(aa-0.5)};L.valueRef=t;L.mangledName=C;L.phID=null;L.typeID=T.component.model.typeRefs[L.type][0];L.parent=T.component;L.description="";var q=new e(L);if(!ad){W.push(q)}aa++}}else{if(al==="input"){var v=z[ak].getAttribute("name");T.addConnector({name:v,type:an,causality:f.Causality.input,valueref:t,mangledName:C});if(!N){var ah={};ah.name=v;ah.type=an;ah.causality=f.Causality.input;ah.position={attach:2,offset:17*(n-0.5)};ah.valueRef=t;ah.mangledName=C;ah.phID=null;ah.typeID=T.component.model.typeRefs[ah.type][0];ah.parent=T.component;ah.description="";var F=new e(ah);if(!ad){W.push(F)}n++}}else{if(al==="parameter"||al==="internal"||w==="parameter"){var A=z[ak].getAttribute("name");var u={};u.value=P[0].getAttribute("start");u.type=an;k[A]=u}else{continue}}}}var B=JSON.parse(JSON.stringify(k));T.setDefaultParameters(B);for(var ac=0;ac<I.length;ac++){var aj={};aj.name=I[ac].getAttribute("name");aj.causality=I[ac].getAttribute("causality");aj.MassExponent=I[ac].getAttribute("MassExponent");aj.LengthExponent=I[ac].getAttribute("LengthExponent");aj.TimeExponent=I[ac].getAttribute("TimeExponent");aj.type=I[ac].getAttribute("type");aj.position=I[ac].getAttribute("position");m.push(aj)}T.setFieldVariables(m);for(var ae=0;ae<E.length;ae++){var p=E[ae].getAttribute("name");var V=E[ae].getAttribute("mangled-name");if(!V){V=""}var K="Region";T.addConnector({name:p,type:K,causality:f.Causality.neutral,valueref:"",mangledName:V});if(!N){var af={};af.name=p;af.type=K;af.causality=f.Causality.neutral;af.position={attach:0,offset:17*(U-0.4)};af.valueRef="";af.mangledName=V;af.phID=null;af.typeID=T.component.model.typeRefs[af.type][0];af.parent=T.component;af.description="";var D=new e(af);if(!ad){W.push(D)}U++}}T.component.addConnectors(W,function(){},function(){});if(!N){var o=l.getExperiment();var ab=T.component.listBehaviors().length;var ag=function(){T.component.buildAllNodes();if(Y){Y()}};if(o&&o.process&&ab===1){if(T.component.instances.length===0){if(Y){Y()}}for(var ai=0;ai<T.component.instances.length;ai++){o.addBehavior1(T.component.instances[ai].phID,T.getID(),null,ag,ag)}}else{if(Y){Y()}}}else{if(T.component.listBehaviors().length===1){T.component.buildAllNodes()}}}return b});
/*! Copyright 2015 Dassault Systemes */
define("DS/SMAMSWeb/SMAMSExperiment",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/SMAMSWeb/SMAMSMonitoring","DS/RFLModelerWeb/RFL_Base","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/SMAMSExecutionServices/SMAMSExecutionServices","DS/SMAMSExperimentServices/SMAMSExperimentServices","DS/SMAMSExecutionServices2/SMAMSExecutionServices2","DS/SMAMSWeb/SMAMSGenerateConfigFile","DS/SMAMSExecutionServices/SMAMSCommonServices","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(d,a,g,j,h,m,b,i,n,f,l,c,k){var e=d.Class.extend({init:function(o,p){this.name="";this.description="";this.model=o;this.status="none";this.phID=p;this.process=null;this.solverOptions={};this.solverOptions.duration=0;this.solverOptions.algorithm="GAUSS-SEIDEL";this.solverOptions.negotiationMethod="MIN";this.solverOptions.leadActor=null;this.solverOptions.constantDt=0;this.solverOptions.masterActor=null;this.behaviors=[];this.interactions=[];this.simConfig=[];this.config=null;this.statusDiv=null;this.isValidated=false;this.monitoring=new j(this);this.solverMessages=null;this._cbOK=[];this._cbKO=[]},getActivityID:function(o,q,p){if(!this.behaviors[o].activity){if(q){this._cbOK.push(q)}if(p){this._cbKO.push(p)}}else{if(q){q(this.behaviors[o].activity)}else{return this.behaviors[o].activity}}},setActivityID:function(o,q){this.behaviors[o].activity=q;for(var p=0;p<this._cbOK.length;p++){this._cbOK[p].call(this,q)}this._cbOK=[];this._cbKO=[]},cancelActivityID:function(){for(var o=0;o<this._cbKO.length;o++){this._cbKO[o].call()}this._cbOK=[];this._cbKO=[]},getInfo:function(){var o={};o.title=this.name;o.description=this.description;o.physicalId=this.phID;return o},setInfo:function(q,r,p){var u=this;var o=u.model;var t=u.getInfo();var s=function(v){if(v===-1){u.name=t.title;u.description=t.description;p()}else{r()}};if(t===q){s(0);return}u.name=q.title;u.description=q.description;if(u.process){u.process.setProcessInfo(q,function(){o.addMessage("The name and description of the process has been updated.","info","log");s(0)},function(w){var v=k.get("proc_update");if(v==="proc_update"){v="The name and description of the experiment could not be updated."}o.addMessage(v,"error","notification",w);s(-1)})}else{s(0)}},setActivityName:function(t,s,r){var q=this.model;var o=this.listBehaviors();var p=o[t.inst.phID].activity;this.getProcess().changeBehavior(p,{title:t.name,description:t.description},function(){q.addMessage("The activity has been updated.","info","log");s()},function(v){var u=k.get("inst_update");if(u==="inst_update"){u="The instance could not be updated."}q.addMessage(u,"error","notification",v);r()})},getID:function(){return this.phID},setID:function(o){this.phID=o},getModel:function(){return this.model},getProcess:function(){return this.process},setProcess:function(o){this.process=o},getSolverOptions:function(){return this.solverOptions},getDuration:function(){return this.solverOptions.duration},getAlgorithm:function(){return this.solverOptions.algorithm},getMethod:function(){return this.solverOptions.negotiationMethod},getLeadActor:function(){return this.solverOptions.leadActor},getConstantDt:function(){return this.solverOptions.constantDt},getMasterActor:function(){return this.solverOptions.masterActor},setSolverOptions:function(v,p,u,o){var t=this;var s=t.model;var q=t.getSolverOptions();var w=function(x){if(x===-1){t.getProcess().getSolverParameters(function(z){var y={};y.duration=z.ExperimentDuration;y.algorithm=z.Algorithm;y.negotiationMethod=z.NegotiationMethod;y.leadActor=z.LeadActor;y.constantDt=z.ConstantDT;y.masterActor=z.MasterActor;t.solverOptions=y;o()},function(y){o()})}else{u()}};if(q===v){w(0)}t.solverOptions=v;if(!p){var r={};r.Algorithm=t.getAlgorithm();r.ExperimentDuration=t.getDuration();r.NegotiationMethod=t.getMethod();r.ConstantDT=t.getConstantDt();r.LeadActor=t.getLeadActor();r.MasterActor=t.getMasterActor();t.getProcess().setSolverParameters(r,function(){s.addMessage("The experiment parameters have been set.","info","log");w(0)},function(y){var x=k.get("proc_exp_param");if(x==="proc_exp_param"){x="The experiment parameters could not be set."}s.addMessage(x,"error","notification",y);w(-1)})}else{w(0)}},setDuration:function(o){this.solverOptions.duration=o},setAlgorithm:function(o){this.solverOptions.algorithm=o},setMethod:function(o){this.solverOptions.negotiationMethod=o},setLeadActor:function(o){this.solverOptions.leadActor=o},setConstantDt:function(o){this.solverOptions.constantDt=o},setMasterActor:function(o){this.solverOptions.masterActor=o},setConfig:function(p){var o=this.model;this.config=(new XMLSerializer()).serializeToString(p);var q=new Blob([this.config]);this.getProcess().uploadSolverFile(q,function(){o.addMessage("The config file has been uploaded.","info","log")},function(s){var r=k.get("proc_03");if(r==="proc_03"){r="The config file could not be uploaded."}o.addMessage(r,"error","notification",s)})},getConfig:function(){return this.config},addBehavior1:function(E,x,v,B,s){var w=this;var u=w.model;var y=u.getEditor();var q=w.getProcess();var C=null;var r=null;if(w.model.getRoot()){C=w.model.getRoot().getInstance(E)}if(C){r=C.getReference().getBehavior(x)}var t={message:"Adding Abstraction...",exclusive:false};if(y){y.addSystemSpinner(t)}var p=function(F){if(y){y.removeSystemSpinner(t)}if(F===-1){delete w.behaviors[E];C.removeThumbnail();C.buildNode();s()}else{if(F===-2){s()}else{if(F===1){B()}else{if(r.sim){var G=new l("spec",w.model);var H=G.execute();if(H[E]){var I=(new XMLSerializer()).serializeToString(H[E]);w.getProcess().uploadSpec(w.behaviors[E].activity,I,function(){u.addMessage("The spec file has been uploaded.","info","log")},function(K){var J=k.get("proc_04");if(J==="proc_04"){J="The spec file could not be uploaded."}u.addMessage(J,"error","notification",K)})}}B()}}}};if(!C||!r){p(-2);return}if(w.behaviors[E]){if(w.behaviors[E].behavior===x){p(1);return}else{w.removeBehavior1(E,function(){},function(){})}}var o={};o.behavior=x;o.instance=E;o.parameters={};o.activity=null;w.behaviors[E]=o;if(v){w.behaviors[E].activity=v}if(r&&r.getThumbnail()){C.setThumbnail(r.getThumbnail().file);C.buildNode()}if(!v){var A={};A.title=C.getInfo().name;A.description=C.getInfo().description;A.repPhysicalId=x;A.instancePhysicalId=E;if(r.sim){if(!r.is3dfmu){var z=null;if(r.codeName==="Abaqus/Standard"){z="STANDARD"}else{if(r.codeName==="Abaqus/Explicit"){z="EXPLICIT"}else{if(r.codeName==="CFD"){z="CFD"}}}A.analysisType=z}else{A.simResults=r.simResults}}else{if(r.fmu){A.outputs=[];for(var D=0;D<r.getConnectors().length;D++){if(r.getConnectors()[D].causality===h.Causality.output){A.outputs.push({name:r.getConnectors()[D].name})}}}}q.addBehavior(A,function(){u.addMessage("The abstractions have been added.","info","log");if(w.behaviors[E]){w.setActivityID(E,A.activityPhysicalId);p(0)}else{w.cancelActivityID();p(-1)}},function(G){var F=k.get("proc_05");if(F==="proc_05"){F="The abstractions could not be added."}u.addMessage(F,"error","notification",G);p(-1)})}else{p(1)}},removeBehavior1:function(C,w,p){var v=this;var t=v.model;var z=t.root.getInstance(C);var B=function(D){if(D===-1){v.behaviors[C]=r;if(q){z.setThumbnail(q);z.buildNode()}p();return}else{if(D===-2){p();return}else{w();return}}};if(v.behaviors[C]===null||typeof v.behaviors[C]==="undefined"||!v.behaviors[C].activity){B(-2);return}z.removeThumbnail();z.buildNode();var u=v.behaviors[C].activity;var r=JSON.parse(JSON.stringify(v.behaviors[C]));var q=z.getSelectedBehavior().getThumbnail().file;if(z&&z.getSelectedBehavior()&&z.getSelectedBehavior().phID===v.behaviors[C].behavior&&z.getSelectedBehavior().sim){for(var y in z.connectors){if(z.connectors.hasOwnProperty(y)){var A=z.connectors[y];for(var s=0;s<A.length;s++){var x=A[s];if(x.comp1.getSelectedBehavior()&&x.comp1.getSelectedBehavior().sim&&x.comp2.getSelectedBehavior()&&x.comp2.getSelectedBehavior().sim){v.removeInteraction1(x,function(){},function(){})}}}}}delete v.behaviors[C];var o=v.getProcess();o.removeBehavior(u,function(){t.addMessage("The abstraction haved been removed.","info","log");B(0)},function(E){var D=k.get("proc_06");if(D==="proc_06"){D="The abstraction could not be removed."}t.addMessage(D,"error","notification",E);B(-1)})},listBehaviors:function(){return this.behaviors},setParameters:function(y,r,u,x,q){var w=this;var v=w.model;var s=w.getParameters(y);var p=function(z){if(z===-1){if(s){w.behaviors[y].parameters=s}q()}else{if(z===-2){q()}else{x()}}};if(!w.behaviors[y]){p(-2);return}w.behaviors[y].parameters=r;if(u){var o=w.getProcess();var t=w.behaviors[y].activity;o.updateBehaviorParameters(u,t,function(){v.addMessage("The parameters have been updated.","info","log");p(0)},function(A){var z=k.get("proc_param_update");if(z==="proc_param_update"){z="The parameters could not be updated."}v.addMessage(z,"error","notification",A);p(-1)})}else{p(0)}},getParameters:function(o){if(this.behaviors[o]){return this.behaviors[o].parameters}},addInteraction1:function(y,w,z,u,C,F,v,H){var D=this;var s=D.model;var t=s.getEditor();var p=s.getRoot().listLinks();var K=y.comp1;var J=y.comp2;var o=D.listInteractions();var E=function(P){if(P===-1||P===-2){for(var S=0;S<D.interactions.length;S++){if(D.interactions[S].linkID===y.getID()){D.interactions.splice(S,1)}}if(t){t.updateEdge(y," ")}if(P===-2){var Q={};var M=[y.comp1.phID,y.comp2.phID];for(var O=0;O<M.length;O++){D.getProcess().setLinkInteractionConfiguration(D.behaviors[M[O]].activity,Q,function(){s.addMessage("The interaction has been removed.","info","log")},function(V){var U=k.get("proc_09");if(U==="proc_09"){U="The interaction could not be removed."}s.addMessage(U,"error","notification",V)})}}H()}else{var T=new l("spec",s);var R=T.execute();var N=(new XMLSerializer()).serializeToString(R[K.phID]);var L=(new XMLSerializer()).serializeToString(R[J.phID]);D.getProcess().uploadSpec(D.behaviors[K.phID].activity,N,function(){s.addMessage("The spec file has been uploaded.","info","log")},function(V){var U=k.get("proc_04");if(U==="proc_04"){U="The spec file could not be uploaded."}s.addMessage(U,"error","notification",V)});D.getProcess().uploadSpec(D.behaviors[J.phID].activity,L,function(){s.addMessage("The spec file has been uploaded.","info","log")},function(V){var U=k.get("proc_04");if(U==="proc_04"){U="The spec file could not be uploaded."}s.addMessage(U,"error","notification",V)});v()}};for(var G=0;G<o.length;G++){if(o[G].linkID===y.getID()){o.splice(G,1)}}var A={linkID:y.phID,value:w};if(z){A.mapping=z}if(u){A.ramping=u}if(C){A.coupling=C}o.push(A);if(t){t.updateEdge(y,w)}if(!F){var B=0;var I=0;var x={};var r=function(){B++;if(B===1){E(-1)}};var q=function(L){var N=function(){I++;if(I===2){E(0)}};var M={};M.interaction=w;if(z){M.mapping=z}if(u){M.ramping=u}if(C){M.coupling=C}x[y.phID]=M;D.getProcess().setLinkInteractionConfiguration(L,x,function(){s.addMessage("The interaction has been added.","info","log");N()},function(P){var O=k.get("proc_08");if(O==="proc_08"){O="The interaction could not be added."}s.addMessage(O,"error","notification",P);E(-2)})};D.getActivityID(K.getID(),q,r);D.getActivityID(J.getID(),q,r)}else{v()}},removeInteraction1:function(w,v,D){var A=this;var t=A.model;var u=t.getEditor();var r=t.getRoot().listLinks();var F=w.comp1;var E=w.comp2;var p=A.listInteractions();var o=null;var x=function(G){if(G===-1||G===-2){p.push(o);if(u){u.updateEdge(w,o.value)}if(G===-2){var K={};for(var J=0;J<p.length;J++){for(var I=0;I<r.length;I++){var H=r[I];if(p[J].linkID===H.phID){if(H.comp1===F){K[H.phID]=p[J].value}}}}A.getProcess().setLinkInteractionConfiguration(A.behaviors[w.comp1.phID].activity,K,function(){t.addMessage("The interaction has been added.","info","log")},function(M){var L=k.get("proc_09");if(L==="proc_09"){L="The interaction could not be added."}t.addMessage(L,"error","notification",M)})}D()}else{if(G===-3){D()}else{v()}}};if(!A.behaviors[w.comp1.phID]||!A.behaviors[w.comp2.phID]){x(-3);return}for(var z=0;z<A.interactions.length;z++){if(A.interactions[z].linkID===w.getID()){o=A.interactions[z];A.interactions.splice(z,1)}}if(!o){x(-3);return}if(u){u.updateEdge(w,"")}var s={};var q={};for(var C=0;C<p.length;C++){for(var B=0;B<r.length;B++){var y=r[B];if(p[C].linkID===y.getID()){if(y.comp1===F){s[y.phID]=p[C].value}else{if(y.comp2===E){q[y.phID]=p[C].value}}}}}if(!A.behaviors[w.comp1.phID]||!A.behaviors[w.comp1.phID].activity){x(0);return}A.getProcess().setLinkInteractionConfiguration(A.behaviors[w.comp1.phID].activity,s,function(){t.addMessage("The interaction has been removed.","info","log");if(!A.behaviors[w.comp2.phID]||!A.behaviors[w.comp2.phID].activity){x(0);return}A.getProcess().setLinkInteractionConfiguration(A.behaviors[w.comp2.phID].activity,q,function(){t.addMessage("The interaction has been removed.","info","log");x(0)},function(H){var G=k.get("proc_09");if(G==="proc_09"){G="The interaction could not be removed."}t.addMessage(G,"error","notification",H);x(-2)})},function(H){var G=k.get("proc_09");if(G==="proc_09"){G="The interaction could not be removed."}t.addMessage(G,"error","notification",H);x(-1)})},listInteractions:function(){return this.interactions},setSimConfig:function(w,u,p,t,o){var r=this;var q=r.model;var s=r.getSimConfig(w);var v=function(x){if(x===-1){if(s){r.simConfig[w]=s}else{delete r.simConfig[w]}o()}else{if(x===-2){o()}else{t()}}};r.simConfig[w]=u;if(!p){r.getProcess().setSimulationConfiguration(r.behaviors[w].activity,u,function(){q.addMessage("The sim configuration has been updated.","info","log");v(0)},function(y){var x=k.get("proc_sim_config");if(x==="proc_sim_config"){x="The sim configuration could not be updated."}q.addMessage(x,"error","notification",y);v(-1)})}},getSimConfig:function(o){return this.simConfig[o]},createProcessNew:function(u,t){var r=this;var q=r.model.editor;var p=this.model;var o=k.get("exp_10");if(o==="exp_10"){o="Creating Experiment..."}var s={message:o,exclusive:true};if(q){q.addSystemSpinner(s)}f.create({title:r.name,description:r.description},function(v){p.addMessage("The process has been created.","info","log");r.setProcess(v);r.setID(v.getProcessInfo().physicalId);if(typeof widget!=="undefined"&&d.is(widget)&&d.is(widget.setValue)){widget.setValue("rootID",r.phID);var y=d.clone(widget.getValue("recentExp"));if(!y){y=[]}if(y.length>4){y.splice(0,y.length-4)}var w={name:r.name,description:r.description,phID:r.phID};for(var x=0;x<y.length;x++){var z=y[x];if(z.phID===w.phID){y.splice(x,1)}}y.push(w);widget.setValue("recentExp",y);if(widget.getValue("RealTimeVariables")){widget.setValue("RealTimeVariables","")}}var A=r.model.getRoot()?r.model.getRoot().getID():null;if(A){v.setSystem(A,function(){p.addMessage("The system has been set on the experiment.","info","log");if(q){q.removeSystemSpinner(s)}var F=k.get("exp_07");if(F==="exp_07"){F="The experiment has been created."}r.model.addMessage(F,"success","notification");if(!t){for(var E=0;E<p.components.length;E++){for(var D=0;D<p.components[E].instances.length;D++){if(p.components[E].behaviors.length){var C=p.components[E].instances[D].getID();var B=p.components[E].behaviors[p.components[E].behaviors.length-1].getID();r.addBehavior1(C,B,null,function(){},function(){})}}}}u(r.phID)},function(C){if(q){q.removeSystemSpinner(s)}var B=k.get("proc_01");if(B==="proc_01"){B="The system could not be set on the experiment."}p.addMessage(B,"error","notification",C)})}},function(w){if(q){q.removeSystemSpinner(s)}var v=k.get("proc_02");if(v==="proc_02"){v="The process could not be created."}p.addMessage(v,"error","notification",w)})},startExecution:function(o){var q=this;q.monitoring.setStatus("Starting Execution...",-1);if(q.solverMessages){q.solverMessages.clear()}var s=function(){m.getEEDUrl({onSuccess:function(w){var x=w;var v={};v.onSuccess=function(){q.monitoring.startMonitoring()};v.onError=function(y){q.monitoring.checkCOSstatus();if(y!==undefined||y!==null){q.model.addMessage(y,"error","notification")}};i.executeProcess(q.phID,x,o,v);q.monitoring.setStatus("Creating Job",-1);var u=widget.editor.getUIFrame().querySelector(".ec-monitoring").parentNode;u.setStepStatus("Checking Execution Settings","Experiment steps","Done");u.setStepStatus("Creating Job","Experiment steps","Running")},onFailure:function(u){q.model.addMessage(u,"error","info")}})};if(i.isCloud){i.WUTenantID=widget.getValue("tenantId");var p=function(u){q.model.addMessage(u,"error","info")};var t=function(){var u={};u.MX_ONLINE_INSTANCE=i.WATenantID;u.MyAppsUrl=i.myAppsUrl;q.getProcess().setCloudParamsForResultsActivity(u,s,p)};var r="dslsServer\t"+i.dslsServer+"\nWUTenantID\t"+i.WUTenantID+"\nWATenantID\t"+i.WATenantID;q.getProcess().setCloudProperty(r,t,p)}else{s()}},pauseExecution:function(){},resumeExecution:function(){},stopExecution:function(){},cancelExecution:function(){},monitorExecution:function(){},localSave:function(s){var q={};q.title=this.getInfo().title;q.description=this.getInfo().description;q.physicalId=this.getID();q.options=this.getSolverOptions();q.behaviors=[];var o=this.listBehaviors();for(var r in o){if(!o.hasOwnProperty(r)){continue}var p={};p.activity=o[r].activity;p.behavior=o[r].behavior;p.instance=o[r].instance;p.parameters=o[r].parameters;q.behaviors.push(p)}q.interactions=this.listInteractions();q.config=this.getConfig()?true:false;q.process=this.getProcess()?true:false;q.simconfig=this.getSimConfig()?true:false;s(q)},});return e});