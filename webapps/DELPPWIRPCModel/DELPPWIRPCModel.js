define("DS/DELPPWIRPCModel/Model/AbstractIRPCModel",["UWA/Core","UWA/Date","UWA/Class/Model","UWA/Class/Debug","DS/DELPPWModelServices/ModelUtils","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWDicoServices/DicoUtils","DS/DELPPWModelServices/Navigation/IndexedDBUtils"],function(e,p,j,q,c,g,h,l,m){var k=j.extend(q,{idAttribute:"PID",_modelEvents:{},_attributesDef:{},init:function(t,u){u=u||{};u.parse=true;this._parent(t,u)},destroy:function(t){m.removeModel(this);return this._parent(e.merge({type:"json"},t))},setup:function o(){this._parent.apply(this,arguments)},setAdditionalInfo:function f(t){if(t){if(this._additionalInfo){e.extend(this._additionalInfo,t)}}},getAdditionalInfo:function d(t){if(t){if(e.is(this._additionalInfo)&&e.is(this._additionalInfo[t])){return e.result(this._additionalInfo,t)}}},sync:function i(v,x,w){var G=this,E,F=p.now(),y,t,D,A,L,C=G._parent,N=w.onComplete,J=w.onFailure,H=w.onTimeout,M=e.is(w.forceRefresh)?w.forceRefresh:false,O,z="START - "+v+" request",I=" / Time: "+new p(F).toISOString(),K="END - "+v+" request",u,B=function B(P,R){var T=R||{},Q=P||"NOURL",S={url:Q,data:e.is(T.data)?T.data:"",headers:e.is(T.headers)?T.headers:"",method:e.is(T.method)?T.method:"GET",type:e.is(T.type)?T.type:null,onComplete:e.is(T.onComplete)?T.onComplete:null,onFailure:e.is(T.onFailure)?T.onFailure:null,onTimeout:e.is(T.onTimeout)?T.onTimeout:T.onFailure};g.webServiceRequest(S);return S};E=e.is(x.id)?(z+" on "+x.id+I):(z+I);h.debug(E);if(e.is(w)){if(e.is(w.logMessage)){h.debug("AbstractIRPCModel",w.logMessage)}}w.onComplete=function(S,R){var P=true,Q={code:500,message:"",status:"External Server error",type:""};if(e.is(S)){if(e.is(S.type)){if(S.type==="Generic Error"||S.type==="BL Error"){P=false;Q.message=S.message;Q.type=S.type}}}if(P){y=p.now();t=y-F;u=" / Duration: "+t+" ms";E=e.is(x.id)?(K+" on "+x.id+u):(K+u);h.debug(E);if(e.is(w)){if(e.is(N)){N.call(null,S,R);m.storeModel(G)}if(e.is(w.logMessage)){h.debug("AbstractIRPCModel success",w.logMessage)}}}else{w.onFailure.call(null,Q,S,R)}};w.onFailure=function(P,R,Q){E="FAILURE during "+v+": "+e.Json.encode(P);h.debug(E);if(!e.is(R)){R=P}if(e.is(w)){if(e.is(J)){J.call(null,R,Q)}if(e.is(w.logMessage)){h.debug("AbstractIRPCModel failed",w.logMessage)}}};w.onTimeout=function(P,R,Q){E="TIMEOUT during "+v+": "+e.Json.encode(P);h.debug(E);if(e.is(w)){if(e.is(H)){H.call(null,R,Q)}if(e.is(w.logMessage)){h.debug("AbstractIRPCModel timedout",w.logMessage)}}};O=c.getTimeoutPreference();if(e.is(O)){w.timeout=O}w.ajax=B;if(!c.isStandAlone()&&v==="read"&&c.getNavigateOnIndexedDB()&&!M){A=function A(P){D=P._attributesDef;this.set(P);this.setAdditionalInfo({queriedForChildren:false});this.setAdditionalInfo({queriedForConnections:false});w.onComplete({attributesValue:this._attributes,attributesDef:D})}.bind(this);L=function L(){return C.call(G,v,x,w)}.bind(this);m.getModel(x,A,L)}else{return G._parent.call(G,v,x,w)}},parse:function n(t){var v;if(!t){return}if(e.is(t.attributesValue)){v=this.setTypeAndPPRTYPE(t.attributesValue)}else{v=this.setTypeAndPPRTYPE(t)}Object.keys(v).forEach(function u(y){var B=l.getAttributeInfo(y),x=false,A=/^\+?[1-9]\d*$/,z=A.test(v[y]),w;if(B&&B.AuthorizedValues){w=B.AuthorizedValues;w.forEach(function(C){if(C.Name===v[y]){v[y]=C.NLS;x=true}});if(!x&&z){v[y]=w[Number.parseInt(v[y])-1].NLS}}});return v},setTypeAndPPRTYPE:function s(u){var t;if(("VPMReference"===u.type)||("ErgoHuman"===u.type)||(""===u.type)){if(l.isAKindOf(u["interface"],"Resource")){u.type=u["interface"];delete u["interface"]}else{if(e.is(u.V_discipline)&&(u.V_discipline.length>0)&&(u.V_discipline!=="NULL")){u.type=u.V_discipline}}}if(u.type){t=l.getPPRType(u.type);if(t){u.PPRTYPE=t}}return u},isReference:function a(){return !(this.isInstance()||this.isConnection())},isInstance:function b(){return this.has("isInstanceOf")},isConnection:function r(){return this.has("to")&&this.has("from")}});return k});define("DS/DELPPWIRPCModel/Collections/AbstractIRPCCollection",["UWA/Core","UWA/Date","UWA/Class/Collection","UWA/Class/Debug"],function(g,d,b,e){var a=b.extend(e,{comparator:"PID",parse:function f(i,h){if(g.is(i.attributesValue)){i[this.model.prototype.idAttribute]=i.attributesValue[this.model.prototype.idAttribute]}return i},sync:function c(k,j,i){var h=this;(function(){var u,m=d.now(),r,q,p=i.onComplete,n=i.onFailure,s="START - "+k+" request",l=" / Time: "+new d(m).toISOString(),t="END - "+k+" request",o;if(g.is(h._logger)){u=g.is(j.id)?s+" on "+j.id+l:s+l;h._logger.log(u)}i.onComplete=function(x,w){var v=0;if(g.is(h._logger)){r=d.now();q=r-m;o=" / Duration: "+q+" ms";u=g.is(j.id)?t+" on "+j.id+o:t+o;h._logger.log(u)}if(Array.isArray(x)){for(v=0;v<x.length;v++){if(g.is(x[v].attributesValue)){x[v].PID=x[v].attributesValue.PID}}}p.call(null,x,w)};i.onFailure=function(v,x,w){if(g.is(h._logger)){u="FAILURE during "+k+": "+g.Json.encode(v);h._logger.log(u)}n.call(null,v,x,w)};return h._parent.call(h,k,j,i)})()}});return a});define("DS/DELPPWIRPCModel/Model/BIModel",["DS/DELPPWIRPCModel/Model/AbstractIRPCModel"],function(b){var a=b.extend({name:"BIModel",idAttribute:"id"});return a});define("DS/DELPPWIRPCModel/Collections/BIModelCollection",["DS/DELPPWIRPCModel/Collections/AbstractIRPCCollection","DS/DELPPWIRPCModel/Model/BIModel"],function(a,b){var c=a.extend({name:"BIModelCollection",model:b,comparator:"id"});return c});define("DS/DELPPWIRPCModel/Model/InstanceModel",["UWA/Core","DS/DELPPWIRPCModel/Model/AbstractIRPCModel","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWModelServices/Navigation/IndexedDBUtils"],function(e,c,a,b){var d=c.extend({name:"InstanceModel",_logger:null,urlRoot:function(){return a.getWebServicesURL()+"/instance"},defaultAdditionalInfo:{queriedForConnections:false},setup:function(f,g){this._parent.apply(this,arguments);this._additionalInfo=e.clone(this.defaultAdditionalInfo);if(e.is(a.instanceModelSetup)){a.instanceModelSetup(this,g)}},parse:function(g,h){var l={},f=this._parent.apply(this,arguments),j,k,i;if(!f){return}if(e.is(h.queriedForConnections)){this.setAdditionalInfo({queriedForConnections:h.queriedForConnections})}if(e.is(a.referenceModelParse)){a.referenceModelParse(this,f,h)}else{if(e.is(h.request)&&e.is(h.request.method,"string")&&h.request.method==="POST"){for(j in g){if(g.hasOwnProperty(j)){if(j.contains("to.")){k=j.substring(j.indexOf("to.")+3);l[k]=g[j]}}}if(Object.keys(l).length>0){i=this.collection.referenceCollection.add(l,{silent:true});if(i){i.setAdditionalInfo({queriedForChildren:true,queriedForConnections:true});b.storeModel(i)}}}}return f}});return d});define("DS/DELPPWIRPCModel/Collections/InstanceCollection",["UWA/Core","DS/DELPPWIRPCModel/Collections/AbstractIRPCCollection","DS/DELPPWIRPCModel/Model/InstanceModel","DS/DELPPWWebServices/WebserviceUtils"],function(g,b,f,d){var e=b.extend({name:"InstanceCollection",model:f,comparator:null,setup:function a(){},url:function c(){return d.getWebServicesURL()+"/instance"}});return e});define("DS/DELPPWIRPCModel/Model/ReferenceModel",["UWA/Core","DS/DELPPWIRPCModel/Model/AbstractIRPCModel","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWIndexServices/IndexParser"],function(g,c,m,j){var h=c.extend({name:"ReferenceModel",idAttribute:"PID",urlRoot:function b(){return m.getWebServicesURL()+"/reference"},defaultAdditionalInfo:{queriedForDocuments:false,queriedForChildren:false,queriedForConnections:false},setup:function d(n,o){this._parent.apply(this,arguments);this._additionalInfo=g.clone(this.defaultAdditionalInfo);if(g.is(m.referenceModelSetup)){m.referenceModelSetup(this,o)}},isSystem:function k(){var o,n=this.get("PPRTYPE");if(g.is(n)){if(n==="SYSTEM"||n==="OPERATION"){o=true}else{o=false}}return o},isProcess:function i(){var o,n=this.get("PPRTYPE");if(g.is(n)){if(n==="PROCESS"){o=true}else{o=false}}return o},isResource:function a(){var o,n=this.get("PPRTYPE");if(g.is(n)){if(n==="RESOURCE"){o=true}else{o=false}}return o},isPart:function l(){var o=false,n=this.get("PPRTYPE");if(g.is(n)&&(n==="PART")){o=true}return o},isProduct:function f(){var o=false,n=this.get("PPRTYPE");if(g.is(n)&&(n==="PRODUCT")){o=true}return o},parse:function e(p,q){var o=this._parent.apply(this,arguments),n;if(!o){return}if(g.is(m.referenceModelParse)){m.referenceModelParse(this,o,q)}if(g.is(q.queriedForDocuments)){this.setAdditionalInfo({queriedForDocuments:g.is(q.queriedForDocuments)})}if(g.is(q.queriedForChildren)){this.setAdditionalInfo({queriedForChildren:g.is(q.queriedForChildren)})}if(g.is(q.queriedForConnections)){this.setAdditionalInfo({queriedForConnections:g.is(q.queriedForConnections)})}if(!o.PID&&g.is(o._results)){n=j.translatePredicateToAttribute(o,{type:"entity",fromExpandService:o._results});o=g.merge(o,n)}return o},});return h});define("DS/DELPPWIRPCModel/Collections/ReferenceCollection",["DS/DELPPWIRPCModel/Collections/AbstractIRPCCollection","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWWebServices/WebserviceUtils"],function(a,d,c){var b=a.extend({name:"ReferenceCollection",comparator:"PID",model:d,_collectionEvents:{},setup:function(){},url:function(){return c.getWebServicesURL()+"/reference"}});return b});define("DS/DELPPWIRPCModel/Model/ConnectionModel",["UWA/Core","DS/DELPPWIRPCModel/Model/AbstractIRPCModel","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWModelParsers/ConnectionParser"],function(g,f,e,b){var d=f.extend({name:"ConnectionModel",defaults:{},getAttribute:function a(h){var i=this.get(h);if("to"===h||"from"===h){i=Array.isArray(i)?i[i.length-1]:i}return i},setup:function(h,i){if(g.is(e.connectionModelSetup)){e.connectionModelSetup(this,i)}},parse:function(i,j){var h;if(g.is(j)&&g.is(j.request)&&(g.is(j.request.method,"string"))&&j.request.method==="GET"){i=b.parse(i)}else{if(g.is(j)&&g.is(j.request)&&(g.is(j.request.method,"string"))&&j.request.method==="POST"){i=b.parseAuthoringResponse(i,j)}else{i=this._parent.apply(this,arguments)}}if(g.is(i)&&g.is(i.PID)&&g.is(this.collection)){if(!this.collection.get(i.PID)){if((-1!==i.PID.indexOf("ProductImplementLinkOcc|"))||(-1!==i.PID.indexOf("ProductImplementLink|"))){h=this.collection.findWhere({from:i.from,type:i.type});if(h){this.collection.remove(h)}}}}return i},destroy:function c(){var i,h;if(arguments[0],"object"&&!g.is(e.connectionModelSetup)){h=arguments[0]["onComplete"];i=function i(l,j,k){b.parseAuthoringResponse(j);if(g.is(h)){h.apply(this,arguments)}};arguments[0]=g.merge({onComplete:i},arguments[0])}return this._parent.apply(this,arguments)},});return d});define("DS/DELPPWIRPCModel/Collections/ConnectionCollection",["UWA/Core","DS/DELPPWIRPCModel/Collections/AbstractIRPCCollection","DS/DELPPWIRPCModel/Model/ConnectionModel","DS/DELPPWWebServices/WebserviceUtils"],function(e,a,c,d){var b=a.extend({name:"ConnectionCollection",model:c,url:function(){var f=d.getWebServicesURL();if(this._isER){f+="/erconnection"}else{f+="/connection"}return f},setup:function(f){var g;if(e.is(f)){g=f.isER;if(e.is(g,"boolean")){this._isER=g}}},useERObjects:function(f){if(e.is(f,"boolean")){this._isER=f}},isER:function(){return this._isER}});return b});