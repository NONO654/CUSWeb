function ENOPS3D_AP(b){var c=function(d){return(d.toLowerCase()==="true")};var a={widget:null,viewercont:null,css_view_class:"windowed",paddebug:false,fpsdebug:false,BIMode:"SLAVE",selectiveLoading:false,defaultProgressBarVisibility:true,automaticReframePolicy:true,allowAuthoring:false,supportPgpBasedOnDescription:false,enableFiltering:false,enableOcclusionTest:false,init:function(d){this.pcsPrefix=widget.id+"_"+widget.title;window.top.performance.mark(this.pcsPrefix+"_init");window.top.performance.measure(this.pcsPrefix+"_call_init","enopad3dviewer_app_load_html",this.pcsPrefix+"_init");this.widget=d.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onSearch",this.onSearch.bind(this));this.BIMode=undefined!==d.BIMode?d.BIMode:this.BIMode;this.selectiveLoading=d.selectiveLoading;this.defaultProgressBarVisibility=undefined!==d.defaultProgressBarVisibility?d.defaultProgressBarVisibility:this.defaultProgressBarVisibility;this.automaticReframePolicy=undefined!==d.automaticReframePolicy?d.automaticReframePolicy:this.automaticReframePolicy;this.allowAuthoring=undefined!==d.allowAuthoring?d.allowAuthoring:this.allowAuthoring;this.visuProgressiveTileModel=undefined!==d.visuProgressiveTileModel?d.visuProgressiveTileModel:false;this.supportPgpBasedOnDescription=undefined!==d.supportPgpBasedOnDescription?d.supportPgpBasedOnDescription:false;this.offline=undefined!==d.offline?d.offline:false;this.debugVisuCommand=d.debugVisuCommand===undefined?false:d.debugVisuCommand;this.workbench=d.workbench;this.workbenchModule=d.workbenchModule;this.enableFiltering=d.enableFiltering||false;this.enableOcclusionTest=d.enableOcclusionTest},onRefresh:function(){this.viewercont.refresh()},onLoad:function(){var d=this;window.top.performance.mark(d.pcsPrefix+"_onload");window.top.performance.measure(d.pcsPrefix+"_call_onload",d.pcsPrefix+"_init",d.pcsPrefix+"_onload");window.top.performance.mark(d.pcsPrefix+"_requirePADSettingsMgt_begin");require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings"],function(g,e){window.top.performance.mark(d.pcsPrefix+"_requirePADSettingsMgt_end");window.top.performance.measure(d.pcsPrefix+"_requirePADSettingsMgt",d.pcsPrefix+"_requirePADSettingsMgt_begin",d.pcsPrefix+"_requirePADSettingsMgt_end");if(!d.widget.getValue("x3dSharedId")&&!d.widget.getValue("x3dAppId")){d.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOPAD_appId"})}g.set_app_context("enopad3dviewer",true);e.addSharedSettings(d.widget);if(d.viewercont===null){g.setSetting("lang",d.widget.lang);var f=widget.getValue("authorizeChangeControl");if(UWA.is(f,"string")&&f.toLowerCase()==="true"){g.setSetting("authorizeChangeControl",f)}d.widget.mergePreferences(g.getWidgetPreferences());d.widget.addEvent("endEdit",g.updateWidgetPreferences.bind(g));g.addEvent("onEnopad3dviewer_activateBI",function(h){if(d.viewercont&&d.viewercont.getBIController()){d.viewercont.getBIController().toggleBetweenStandaloneAndSlaveMode(h===true?"STANDALONE":"SLAVE")}});g.addEvent("onEnopad3dviewer_navigate_with_wrap",function(h){if(d.viewercont&&d.viewercont.getController()){d.viewercont.getController().setWrapUsage(h)}});g.addEvent("onEnopad3dviewer_CGRorTHB",function(h){if(d.viewercont){if(h===true){d.viewercont.getController()._defaultStreamToLoad="cgr"}else{d.viewercont.getController()._defaultStreamToLoad="thumbnail"}}});g.addEvent("onDisplay_sceneGraph",function(h){if(d.viewercont){d.viewercont.displayTree(h)}});g.addEvent("onPaddebug_section",function(h){if(d.viewercont){if(h&&d.paddebug===false){d.paddebug=true;d.viewercont.loadActionBar({merge:true,file:"PADDebug.xml",module:"PADDebug"})}}});g.updateWidgetPreferences();if(!d.widget.getValue("PADCusto_roots_pids")){widget.addPreference({name:"PADCusto_roots_pids",type:"hidden",defaultValue:"[]"})}if(!d.widget.getValue("PADCusto_roots_pids_detach")){widget.addPreference({name:"PADCusto_roots_pids_detach",type:"hidden",defaultValue:"[]"})}if(g.getSetting("authorizeChangeControl")===true){g.addEvent("onChangeControlActivation",function(i){var h=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");if(!debouncePrefSynchro){d._proxy.preferenceModification({name:"changeControlActivation",value:i})}else{debouncePrefSynchro=false}if(i===true){h.show()}else{h.hide()}});g.addEvent("onChangeControlPosition",function(i){var h=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");h.setPosition(i)})}window.top.performance.mark(d.pcsPrefix+"_setPref_end");window.top.performance.measure(d.pcsPrefix+"_setWidgetPref",d.pcsPrefix+"_requirePADSettingsMgt_end",d.pcsPrefix+"_setPref_end");require(["DS/ENOPAD3DViewer/PAD3DViewer"],function(h){window.top.performance.mark(d.pcsPrefix+"_require_end");window.top.performance.measure(d.pcsPrefix+"_require3DViewer",d.pcsPrefix+"_setPref_end",d.pcsPrefix+"_require_end");d.viewercont=new h({widget:d.widget,authorizeSet3DStructure:true,isVolumeFilter:true,css_view_class:d.css_view_class,windowOptions:{BIMode:d.BIMode,defaultProgressBarVisibility:d.defaultProgressBarVisibility,automaticReframePolicy:d.automaticReframePolicy,workbench:d.workbench,workbenchModule:d.workbenchModule},allowAuthoring:d.allowAuthoring,selectiveLoading:d.selectiveLoading,visuProgressiveTileModel:d.visuProgressiveTileModel,offline:d.offline,debugVisuCommand:d.debugVisuCommand,supportPgpBasedOnDescription:d.supportPgpBasedOnDescription,enableFiltering:d.enableFiltering,enableOcclusionTest:d.enableOcclusionTest});d.viewercont.subscribe({event:"onActionBarReady"},function(){window.top.performance.mark(d.pcsPrefix+"_onActionBarReadyCB_begin");if(g.getSetting("authorizeChangeControl")===true){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(m,n){var l=d.widget.body;var o="hide";if(g.getSetting("changeControlActivation")===true){o="show"}m.initialize(l,n.appId(),o,g.getSetting("changeControlPosition"))})}d.widget.setBody(d.viewercont.render());if(d.widget.widgetDomain&&d.widget.widgetDomain.indexOf("debug_me")>0){console.warn("Debug mode activated");if(g.getSetting("paddebug_section")&&d.paddebug===false){d.paddebug=true;d.viewercont.loadActionBar({merge:true,file:"PADDebug.xml",module:"PADDebug"})}d.viewercont.displayTree(g.getSetting("display_sceneGraph"));if(g.getSetting("enopad3dviewer_CGRorTHB")===true){d.viewercont.getController()._defaultStreamToLoad="cgr"}else{d.viewercont.getController()._defaultStreamToLoad="thumbnail"}if(d.viewercont.getBIController()){d.viewercont.getBIController().toggleBetweenStandaloneAndSlaveMode(g.getSetting("enopad3dviewer_activateBI")===true?"STANDALONE":"SLAVE")}}if(d.viewercont.getLevelSelectorCommand){d.viewercont.getLevelSelectorCommand(function(l){if(l){l.displayLabels(true)}})}if(!d.wkbLoaded){d.wkbLoaded=true;window.top.performance.mark(d.pcsPrefix+"_onReady");window.top.performance.measure(d.pcsPrefix+"_app_load_completed","enopad3dviewer_app_load_html",d.pcsPrefix+"_onReady");d.widget.dispatchEvent("onENOPADReady")}var i=JSON.parse(d.widget.getValue("PADCusto_roots_pids"));var k=JSON.parse(d.widget.getValue("PADCusto_roots_pids_detach"));d.widget.setValue("PADCusto_roots_pids","[]");d.widget.setValue("PADCusto_roots_pids_detach","[]");var j=[];i.forEach(function(l){if(UWA.is(l,"array")){j.push({path:l,hidden:k.indexOf(l[0])>=0?true:false})}else{j.push({path:[l],hidden:k.indexOf(l)>=0?true:false})}});if(i.length>0){d.viewercont.addRoots({objects:j},false)}window.top.performance.mark(d.pcsPrefix+"_onActionBarReadyCB_end");window.top.performance.measure(d.pcsPrefix+"_setPreferences",d.pcsPrefix+"_onActionBarReadyCB_begin",d.pcsPrefix+"_onActionBarReadyCB_end")});d.viewercont.subscribe({event:"onRootAdded"},function(j){if(j.rootLog){var i=j.rootLog;d.widget.setValue("PADCusto_roots_pids",JSON.stringify(i))}d.viewercont.getContentName({callbacks:{onComplete:function(k){d.widget.setTitle(k.contentName)}}})});d.viewercont.subscribe({event:"onRootRemoved"},function(j){if(j.rootLog){var i=j.rootLog;d.widget.setValue("PADCusto_roots_pids",JSON.stringify(i))}d.viewercont.getContentName({callbacks:{onComplete:function(k){d.widget.setTitle(k.contentName)}}})});d.viewercont.subscribe({event:"onRootAttached"},function(k){if(k.id){var l=JSON.parse(d.widget.getValue("PADCusto_roots_pids_detach"));for(var j=0;j<l.length;j++){if(l[j]===k.id){l.splice(j,1);break}}d.widget.setValue("PADCusto_roots_pids_detach",JSON.stringify(l))}d.viewercont.getContentName({callbacks:{onComplete:function(i){d.widget.setTitle(i.contentName)}}})});d.viewercont.subscribe({event:"onRootDetached"},function(i){if(i.id){var j=JSON.parse(d.widget.getValue("PADCusto_roots_pids_detach"));j.push(i.id);d.widget.setValue("PADCusto_roots_pids_detach",JSON.stringify(j))}d.viewercont.getContentName({callbacks:{onComplete:function(k){d.widget.setTitle(k.contentName)}}})})})}})},onSearch:function(e){var d={searchQuery:e};this.viewercont.search(d)},onDestroy:function(){this.viewercont.destroy();this.viewercont=null}};a.init(b);return a};