define("DS/SMAProcSPUI/Views/LogsDataGrid",["UWA/Core","UWA/Controls/Abstract","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Tree/TreeDocument","DS/SMAProcSPUI/Views/RulesEditor","DS/UIKIT/Tooltip","css!DS/SMAProcSPUI/Views/LogsDataGrid.css"],function(f,j,h,g,b,e,l){var a,m;var o=function(u){if(!u.isHeader){var q="#000",t=u.dataIndex,s=u.nodeModel.options.grid,v=s[t],r=s.severity,p=document.createElement("div");p.classList.add("ellipsis");p.innerHTML=v;switch(r){case"Information":case"Always":case"Message":q="#000";break;case"Debug":q="#3071a9";break;case"Warning":q="#8a6d3b";break;case"Error":case"SysError":case"System Error":q="#a94442";break;default:q="#000"}p.style.color=q;u.cellView.getContent().setContent(p)}};var k=function(r){var q=document.createElement("textarea");q.classList.add("dummyElement");q.value=r;document.body.appendChild(q);q.select();try{document.execCommand("copy");document.body.removeChild(q);return true}catch(p){document.body.removeChild(q);return false}};var n=function(x,u){var w=x.cellView,t=document.body,s=document.documentElement,r,q,v,y,z,p;p={body:u,position:"bottom",bound:true,trigger:"manual",target:w.getContent(),animate:false};y=Math.max(t.scrollHeight,t.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);r=w.getContent().getPosition(document.body);q=w.getContent().getSize();if(a){a.destroy();clearTimeout(m);a=null}z=new l(p);z.show();v=z.getContent().getSize();if(y<r.y+q.height+v.height){z.destroy();p.position="top";z=new l(p);z.show()}a=z;m=setTimeout(function(){this.hide();this.destroy();a=null}.bind(z),5000)};var i=["Running","Paused","NotStarted","Initializing","Waiting","Queued","Started"];var d=j.extend({className:"logs-monitor",defaultOptions:{columns:[{text:"Time",dataIndex:"Time",onCellRequest:o,sortFunction:function(r,q){var t;var u=r.options.grid.timeMillis;var p=q.options.grid.timeMillis;if(u===p){t=0}else{var v=Number(u);var s=Number(p);if(isNaN(v)||isNaN(s)){t=u<p?-1:1}else{t=v<s?-1:1}}return t}},{dataIndex:"severity",text:"Severity",isFilterable:true,onCellRequest:o},{dataIndex:"source",text:"Source",isFilterable:true,onCellRequest:o},{dataIndex:"CompDisplayPath",text:"Execution Path",isFilterable:true,onCellRequest:o},{text:"Run Id",dataIndex:"CompIterRunId",onCellRequest:o},{dataIndex:"Msg",text:"Message",onCellRequest:o}],defaultCellHeight:30,resize:{rows:false,columns:true},showVerticalLines:true,useTransparentScroller:false,alternateRowColor:false,isEditable:false,iconsSize:22,isSortable:true,show:{rowHeaders:false,columnHeaders:true},selection:{cells:true,rowHeaders:true,columnHeaders:false,canMultiSelect:false,useUnselectAllOnEmptyArea:true},showLoaderIndicator:true,height:"auto",apiVersion:"2",enableActiveUI:true,enableKeyboardNavigation:true,performances:{buildLinks:false},shouldAcceptDrag:function(){return false},onContextualEvent:{callback:function c(r){var q=[];if(r&&r.treeview){var p=r.treeview;if(p.cellModel&&!p.isHeader){q.push({type:"PushItem",title:"Copy cell to Clipboard",icon:"",action:{callback:function(){var s=p.model;var t=s.getCellContent();var u=k(t);if(u){n(p,"Copied to Clipboard.")}}}})}}return q}}},isDestroyed:false,spreadsheet:null,rulesEditor:null,ready:false,init:function(p){p=p||{};this._parent(p);this.getContent();this.createSpreadsheet()},getContent:function(){if(!this.elements.container){this.buildSkeleton()}return this.elements.container},buildSkeleton:function(){var p=this,q=p.elements;q.container=f.createElement("div",{});q.header=f.createElement("div",{"class":"spreadsheet-header",id:"logs-header"}).inject(q.container);q.body=f.createElement("div",{"class":"spreadsheet-body"}).inject(q.container)},createSpreadsheet:function(){var s=this,r;this._model=new b({useAsyncPreExpand:true});this._model.prepareUpdate();var t=this.options.source;for(var q=0;q<t.length;q+=1){var p=new g({label:q,grid:t[q]});this._model.addRoot(p)}this._model.pushUpdate();this.spreadsheet=new h(this.options);r=this.spreadsheet.getManager();r.onReady(function(){r.loadDocument(s._model);s.dispatchEvent("onReady")});this.spreadsheet.inject(this.elements.body)},handleEvents:function(){var p=this.spreadsheet.getManager();p.onCellClick(function(s){var q=s.model;var r=q.getCellContent();n(s,r)});p.onCellDblClick(function(s){var q=s.model;var r=q.getCellContent();var t=k(r);if(t){n(s,"Copied to Clipboard.")}})},onReady:function(){var u=this,r=this.spreadsheet.getManager(),v,q,p,s;if(this.ready){return}this.ready=true;var t=this.spreadsheet.getContent();t.querySelector(".wux-datagrid").style.top="38px";u.createRulesEditor();r.prepareUpdateView();r.hideColumn("tree");r.setColumnWidth("tree",0);u.options.columns.forEach(function(z){var x=sessionStorage.getItem(z.dataIndex);var y=x==="true";if(!y){r.hideColumn(z.dataIndex)}});q=r.getColumnWidth("Time")+75;r.setColumnWidth("Time",q);p=r.getColumnWidth("CompDisplayPath")+75;r.setColumnWidth("CompDisplayPath",p);v=r.getContent().clientWidth;s=v-q-p-25;if(this.options.hasRunIDCloumn||(i.indexOf(u.options.jobExecutionStatus)!==-1)){s=s-100}var w=s>1000?s:1000;if(s>0){r.setColumnWidth("Msg",w)}else{r.setColumnWidth("Msg",100)}r.pushUpdateView(true);this.handleEvents();setTimeout(function(){if(u.options.autoScroll){u.scrollToEnd()}if(u.rulesEditor&&u.rulesEditor.onAddRows){u.rulesEditor.onAddRows(u.options.source,0)}try{var z=u.spreadsheet.getManager().getNumberOfRows();var y={rows:z};window.parent.postMessage({type:"odt-trace",operation:"logsdatagrid-complete",data:y},"*")}catch(x){}},500)},appendToModel:function(r){var u=r.data;var s=this.spreadsheet.getManager();u.splice(0,r.linesParsed);var v=this.spreadsheet.getManager().getRoots().length;this._model.prepareUpdate();for(var q=0;q<u.length;q+=1){var p=new g({label:r.linesParsed+q,grid:u[q]});this._model.addRoot(p)}this._model.pushUpdate();s.updateView();if(this.rulesEditor&&this.rulesEditor.onAddRows){this.rulesEditor.onAddRows(u,v);var t=this.spreadsheet.getContent();t.querySelector(".wux-datagrid").style.top="38px"}return this},createRulesEditor:function(){var p=this;this.rulesEditor=new e({spreadsheet:this.spreadsheet,container:this.elements.header,jobObjectId:this.options.jobObjectId,mcsBaseURL:this.options.mcsBaseURL,columns:this.defaultOptions.columns,show:{download:true,tablePreferences:true,subscription:true},events:{onSearchEnd:function(){if(p.options.autoScroll){p.scrollToEnd()}},downloadJobLog:function(){if(p.spreadsheet){try{window.parent.postMessage(JSON.stringify({type:"downloadJobLog",operation:"downloadJobLog"}),"*")}catch(q){}}}}})},scrollToEnd:function(){if(this.spreadsheet){var p=this.spreadsheet.getManager(),q=p.getNumberOfRows();p.scrollToRow(q,"bottom")}},destroy:function(){var p=this.spreadsheet;this._model.empty();this._model=null;this.isDestroyed=true;if(this.rulesEditor&&this.rulesEditor.destroy){this.rulesEditor.destroy()}p.getManager().destroy();this.rulesEditor=null;this.spreadsheet=null;this._parent()}});return d});