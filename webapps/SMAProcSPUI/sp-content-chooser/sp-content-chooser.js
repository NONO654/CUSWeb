(function(m){var r,x,v,p,F,h,w,i,A,y,d,n,e,s,G,E,j,z,D,C,b,g,a,k={ONCHANGE:"change",ONCLEAR:"clear",DROPUNSUPPORTEDOBJECT:"dropUnsupportedObject"},q=["objectId","objectType","objectTitle"],B="../../W3DSpace/assets/img/small/I_DefaultThumbnail.png";z=false;function l(H){if(!H){return false}H.preventDefault&&H.preventDefault();H.returnValue=false;if((H.cancelable===undefined||H.cancelable===true)&&H.defaultPrevented===undefined){H.defaultPrevented=true}}function o(H){H.stopPropagation&&H.stopPropagation();H.cancelBubble=true}function u(H){o(H);l(H)}function t(H){return{objectId:H.objectId,objectType:H.objectType,objectTitle:H.displayName,displayType:H.displayType,displayIcon:H.displayIcon,objectTypeValue:H.objectTypeValue}}function c(H){if(!D){D=new Promise(function(L,K){var M=200;var I=304;var J=new Error("sp-content-chooser: failed to get VocabularyClasses");H.$.vocabularyclasses.sendRequest({uri:H.$.dashboard.getMcsUri()+"/resources/6WVocab/access/VocabularyClasses?name=ds6wg",verb:"GET",wait:0,success:[M,I],context:H,headers:{Accept:"application/json"},onComplete:function(O){try{var N=JSON.parse(O.response);L(N&&N.vocabularyClassInfo||[])}catch(P){J.originalError=P;K(J)}},onError:function(N){J.originalError=N;K(J);return true}})})}return D}function f(){if(!b){b=new Promise(function(I,H){var J=new Error("sp-content-chooser: failed to get icons map");require(["text!DS/SMAProcSPUI/assets/sp-content-chooser.json"],function(L){try{var K=JSON.parse(L);I(K)}catch(M){J.originalError=M;H(M)}},function(K){J.originalError=K;H(K)})})}return b}r=function(){var H=this;H.displayIcon=H.resolveUrl(B);f().then(function(I){g=I},function(){g=null}).then(x.bind(H));c(H).then(function(J){var I={};J.forEach(function(K){I[K.name]=K.nlsName});C=I},function(){H._objectTypeNlsMap=null}).then(x.bind(H))};x=function(){var H=G.call(this,{objectType:this.objectType});this.displayIcon=H.displayIcon;this.displayType=H.displayType};v=function(L){o(L);if(this.objectId&&!this.disableprop){if(this.$.dashboard.isInDashboard()&&this.objectType==="DesignSight"){var K=this.objectId;var I=m.widget&&m.widget.getValue("collabspaces");var H={getSecurityContext:function(){return I},getSelectedNodes:function(){return[{getID:function(){return K}}]}};require(["DS/LifecycleControls/EditPropDialog"],function(N){var M=new N();M.launchProperties(H)},function(M){logger.warn("Failed to load LifecycleControls widget: "+M,M)})}else{var J=this.$.dashboard.getAuthenticatedJspUri("/common/emxNavigator.jsp?"+this.JS.toQueryString({isPopup:"true",objectId:this.objectId}));m.DS.SMAProcSP.SPBase.WIN.openInWindow.call(this,J)}}else{if(!this.readOnly){this.$.spSearch.search()}}};p=function(){var I=G.call(this,t(this.value));for(var H=0;H<q.length;H++){var J=q[H];if(I.hasOwnProperty(J)){this[J]=I[J]}}this.displayIcon=I.displayIcon;this.displayType=I.displayType;this.fire(k.ONCHANGE,this)};F=function(){this.$.spSearch.search()};h=function(){this.onInvalidIcon();this.value=undefined;this.objectId=undefined;this.objectTitle="";this.objectType=undefined;this.showclear=false;this.fire(k.ONCLEAR)};w=function(H){u(H);var I=H.detail.getSelectedObjects()[0];s.call(this,I,this.dummyDocType)};i=function(I){o(I);var H={protocol:"3DXContent",version:"1.0",source:"ContentChooser",data:{items:[{envId:"OnPremise",serviceId:"3DSpace",objectId:this.objectId,displayName:this.objectTitle,objectType:this.objectType}]}};I.dataTransfer.effectAllowed="all";I.dataTransfer.setData("text",JSON.stringify(H));I.target.style.opacity="0.4";z=true};A=function(H){if(!z){if(!this.readOnly){var I=this.DOM(this).find(".link-itm-drop-target").element();this.DOM(I).addClass("drag-over");l(H);H.dataTransfer.dropEffect="move"}else{H.dataTransfer.dropEffect="none"}}else{H.dataTransfer.dropEffect="none"}};y=function(H){if(!this.readOnly){l(H)}else{H.dataTransfer.dropEffect="none"}};d=function(H){var M,J,I,L;if(!this.readOnly){u(H);M=this.DOM(this).find(".link-itm-drop-target").element();this.DOM(M).removeClass("drag-over");try{J=H.dataTransfer.getData("text");L=JSON.parse(J)}catch(K){L=null}if(L&&L.data&&L.data.items){I=L.data.items[0];s.call(this,I,this.dummyDocType)}else{this.fire(k.DROPUNSUPPORTEDOBJECT)}}};n=function(){var H=this.DOM(this).find(".link-itm-drop-target").element();this.DOM(H).removeClass("drag-over")};e=function(H){z=false;H.target.style.opacity="1.0"};s=function(L,M){this.value=L;if(L&&this.objectId!==L.objectId){var J=L.objectType;if(this.strictMatch){if(this.parentType==="DOCUMENTS"){var K=this.$.dashboard.getMcsUri()+"/resources/enong/dico/gettypeshierarchy";this.$.compatibleObject.sendRequest({verb:"POST",uri:K,data:JSON.stringify({types:[J]})})}else{if(M===J||M===L.objectTypeValue){this.changeProperties()}else{this.fire(k.DROPUNSUPPORTEDOBJECT)}}}else{var H=false;if(this.reject){for(var I=0;I<this.reject.length;I++){if(J===this.reject[I]){H=true;this.fire(k.DROPUNSUPPORTEDOBJECT);break}}}if(!H){this.changeProperties()}}}};G=function(H){H=H||{};var K={objectId:H.objectId,objectType:H.objectType,objectTitle:H.objectTitle,description:H.description,modified:H.modified,displayIcon:H.displayIcon,displayType:H.displayType};var I=g||{};var J=C||{};for(var N in K){if(N===undefined){delete K[N]}}if(!K.displayIcon){var M=H.objectType&&I[H.objectType];if(!M){M=H.objectTypeValue&&I[H.objectTypeValue]}K.displayIcon=M?this.$.dashboard.getMcsUri()+"/snresources/images/icons/small/"+M:this.resolveUrl(B)}if(!K.displayType){var L=H.objectType&&J[H.objectType];if(!L){L=H.objectTypeValue&&J[H.objectTypeValue]}K.displayType=L||H.objectType||H.objectTypeValue}return K};E=function(L){var J=JSON.parse(L.detail.response),K=this.parentType,H=J.types_hierarchies.length-1,M=J.types_hierarchies[H].hierarchy.length-1;var I=J.types_hierarchies[H].hierarchy[M];if(K===I){this.changeProperties()}else{this.fire(k.DROPUNSUPPORTEDOBJECT)}};j=function(){this.displayIcon=this.resolveUrl(B)};a=function(H,I){return(H&&!I)};Polymer({is:"sp-content-chooser",behaviors:[m.DS.SMAProcSP.SPBase],listeners:{"vocabularyclasses.error":"_stopEvent","spSearch.close":"_stopEvent"},properties:{objectId:{type:String,notify:true,reflectToAttribute:true},objectTitle:{type:String,notify:true,reflectToAttribute:true},objectType:{type:String,notify:true,reflectToAttribute:true,observer:"objectTypeChanged"},readOnly:{type:Boolean,value:false,notify:true,reflectToAttribute:true},parentType:{type:String,notify:true},accept:{type:String,value:"DOCUMENTS",notify:true},reject:{type:Array,value:function(){return[]},notify:true},strictMatch:{type:Boolean,value:false,notify:true,reflectToAttribute:true},disableprop:{type:Boolean,value:false},showclear:{type:Boolean,value:false,reflectToAttribute:true}},ready:r,showProperties:v,retrieveParentType:E,onBrowse:F,onClear:h,onSearch:w,onDragStart:i,onDragEnter:A,onDragOver:y,onDrop:d,onDragLeave:n,onDragEnd:e,onInvalidIcon:j,changeProperties:p,objectTypeChanged:x,_stopEvent:u,_computeShowClear:a})}(this));