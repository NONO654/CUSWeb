/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
(function(e){var c="Please drop an object of type  ";var b="Opening selected object ";var d=false;var a={ON_OBJECT_DROP:"onObjectDrop"};e.Polymer({is:"sp-drop",properties:{accepts:{type:Array,value:function(){return["Simulation","Simulation Process"]},notify:true},errorMessage:{value:function(){return c}},infoMessage:{value:function(){return b}},isRefresh:{type:Boolean,value:false,notify:true,observer:"checkRefresh"},objectData:{value:null,notify:true},objectId:{type:String,value:"",notify:true},objectTitle:{type:String,value:"",notify:true},showAdd:{type:Boolean,value:false},dropNoteText:{type:String,value:""},addNoteText:{type:String,value:""},openObject:{type:Boolean,value:false},showSearch:{type:Boolean,value:false},plmType:{type:String,computed:"_computePLMType(accepts)",notify:true},customSearch:{type:String,value:""}},listeners:{"objectSearch.sp-error":"_searchError"},attached:function(){this._setVisibility(this.$.addNote,this.showAdd);this._setVisibility(this.$.separatorTextDrop,this.showAdd);this._setVisibility(this.$.searchNote,this.showSearch);this._setVisibility(this.$.separatorTextSearch,this.showSearch);var f=this;this.async(function(){if(f.openObject){if(e.widget){var g=e.widget.getValue("X3DContentId");e.widget.setValue("X3DContentId","");if(g){d=true;f.onDrop(g)}}}},1000)},_searchError:function(g,f){if(g){g.stopPropagation()}if(f){this.$.notificationMessages.logMessage({type:"error",text:f.message})}},checkRefresh:function(f){if(f){this.removeDropNotes()}},onDragover:function(f){f.preventDefault();f.dataTransfer.dropEffect=(["all","move","linkmove","copyMove","uninitialized"].indexOf(f.dataTransfer.effectAllowed.toLowerCase())!==-1)?"move":"copy";e.Polymer.dom(this.$.dropDiv).classList.add("drop")},injectContent:function(f){e.Polymer.dom(this).appendChild(f)},onDragLeave:function(){e.Polymer.dom(this.$.dropDiv).classList.remove("drop")},revertToDrop:function(){e.Polymer.dom(this.$.dropDiv).classList.remove("afterDrop");this._setVisibility(this.$.dropNote,true);this._setVisibility(this.$.addDropContainer,true);this._setVisibility(this.$.searchContainer,true);this._setVisibility(this.$.parentContainer,true);this._setVisibility(this.$.addNote,this.showAdd);this._setVisibility(this.$.separatorTextDrop,this.showAdd);this._setVisibility(this.$.searchNote,this.showSearch);this._setVisibility(this.$.separatorTextSearch,this.showSearch);this.objectData=null;this.objectId="";this.objectTitle=""},removeDropNotes:function(){this._setVisibility(this.$.dropNote,false);this._setVisibility(this.$.addNote,false);this._setVisibility(this.$.searchNote,false);this._setVisibility(this.$.separatorTextDrop,false);this._setVisibility(this.$.separatorTextSearch,false);this._setVisibility(this.$.addDropContainer,false);this._setVisibility(this.$.searchContainer,false);this._setVisibility(this.$.parentContainer,false);e.Polymer.dom(this.$.dropDiv).classList.add("afterDrop")},onDrop:function(g){var h=null;this.$.notificationMessages.$.notificationcomponent.textContent="";if(g.dataTransfer){h=g.dataTransfer.getData("text");g.preventDefault()}else{if(h===null&&g){h=g}}var l=null;var k;try{l=JSON.parse(h)}catch(j){l=null;k=j;try{h=g.dataTransfer.getData("text/searchitems");l=JSON.parse(h)}catch(i){l=null;k=i}if(!l&&e.console&&e.console.log){e.console.log("sp-drop: Failed to parse data",k,h)}}if(l&&l.data&&l.data.items){var f=l.data.items[0];this.objectSelected(f)}e.Polymer.dom(this.$.dropDiv).classList.remove("drop")},onNewObjectClick:function(f){if(f){f.preventDefault();f.stopPropagation()}this.fire("objectcreate",{})},onSearchObjectClick:function(f){if(f){f.preventDefault();f.stopPropagation()}this.$.objectSearch.search(this.customSearch)},_computePLMType:function(f){return f.toString()},onChange:function(h){h.preventDefault();h.stopPropagation();var f=h.detail.getSelectedObjects();if(f&&f[0]){var g=f[0];this.objectSelected(g)}},objectSelected:function(g,j){var i={},h=g.objectTypeValue?g.objectTypeValue:g.objectType,f=g.objectType;if(!d&&g&&this.accepts.indexOf(h)>-1){this.objectData=g;this.removeDropNotes();this.fire(a.ON_OBJECT_DROP,j)}else{if(d&&g&&this.accepts.indexOf(h)>-1){f=g.objectType;this.objectData=g;this.objectId=g.objectId;i.type="info";i.autoRemove=true;if(g.displayName){this.objectTitle=g.displayName;i.text=this.infoMessage+'"'+this.objectTitle+'" of type '+f}else{if(g.objectData&&g.objectData.attributes){this.objectTitle=g.objectData.attributes.title;i.text=this.infoMessage+'"'+this.objectTitle+'" of type '+f}else{this.objectTitle="";i.text=this.infoMessage+" of type "+f}}this.$.notificationMessages.logMessage(i);this.removeDropNotes();this.fire(a.ON_OBJECT_DROP,j)}else{i.type="error";this.objectTitle=(g&&g.displayName)?g.displayName:"";i.text=this._computeMessage(this.accepts,this.errorMessage,this.dropNoteText,this.objectTitle);this.$.notificationMessages.logMessage(i)}}},toListDisplay:function(f,g){if(g===""){return f.join?f.join(", "):f}else{return g}},_computeMessage:function(i,h,g,f){if(f!==""){return"Selected object "+f+" is not compatible. "+h+this.toListDisplay(i,g)}else{return"Selected object is not compatible. "+h+this.toListDisplay(i,g)}},computeAddNote:function(g,f){if(g!==""){return g}else{if(f!==""){return f}}},_setVisibility:function(f,g){g?e.Polymer.dom(f).classList.remove("hidden"):e.Polymer.dom(f).classList.add("hidden")}})}(this));