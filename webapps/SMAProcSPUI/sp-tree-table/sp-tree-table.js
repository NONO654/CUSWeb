/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
(function(a){Polymer({is:"sp-tree-table",properties:{height:{type:String,value:null,notify:true},width:{type:String,value:null,notify:true},fixedWidth:{type:Boolean,value:true,notify:true},_columns:{type:Array,value:function(){return[]},notify:true},_bypassIcon:{type:String,value:function(){return this.resolveUrl("../assets/images/bypass.png")}},_childIcon:{type:String,value:function(){return this.resolveUrl("../assets/images/child.png")}},_colwidths:{type:Array,value:function(){return[]}},_columnMaxWidth:{type:Number,value:500},_columnMinWidth:{type:Number,value:42},_rowheight:{type:Number,value:34},_bButtonClicked:{type:Boolean,value:false},_fillerIcon:{type:String,value:function(){return this.resolveUrl("../assets/images/filler.png")}},_lastChildIcon:{type:String,value:function(){return this.resolveUrl("../assets/images/lastchild.png")}},_parentIcon:{type:String,value:function(){return this.resolveUrl("../assets/images/parent.png")}},_resize:{type:Object,value:function(){return{start:undefined,index:-1,width:0,otherIndex:-1,otherWidth:0,tableWidth:0}}},_selectedRow:{value:null}},getSelectedRowIndex:function(){return this._selectedRow!=null&&this._selectedRow>=0?this._selectedRow:-1},getRow:function(b){return this._getRow(b)},getRoot:function(b){return this._getRoot(this._getRow(b))},getRowInfo:function(d){var b;var c=this._getRow(d);if(c){b=this._rowAttributes(c)}return b},getCell:function(c,b){return this._getCell(c,b)},getCellInfo:function(e,c){var d;var b=this._getCell(e,c);if(b){d=this._cellAttributes(b)}return d},setCellContent:function(d,b,c){this._setCellContent(this._getCell(d,b),c)},findRow:function(e){var d;if(e&&e.value){var c=this._rootIterator();while(!c.done()){var b=c.value();if(b&&b.rowdata&&b.rowdata.value){if(b.rowdata.value===e.value){d=b;break}}c.next()}}return d},getRowdata:function(d){var c;var b=this._getRow(d);if(b){c=b.rowdata}return c},insertRow:function(f,c){var i;var b=this._getBody();if(b){var j=this._bodyRows(b);var d=c;if(c>0){var g=j[c];if(!this._isRoot(g)){var h=this.getRoot(g);d=this._bodyIndex(h)}}i=document.createElement("tr");if(i){if(d<0){d=j.length;Polymer.dom(b).appendChild(i)}else{Polymer.dom(b).insertBefore(i,b.childNodes[c+1])}this._makeRow(i,f);var e=this._rowAttributes(i);this.fire("onRowInserted",{position:d,rowInfo:e})}}return i},removeRow:function(g){var c=g;var d=this._getBody();var f=this._bodyRows(d);if(f&&!g&&this._selectedRow!=null&&this._selectedRow>=0&&this._selectedRow<f.length){c=f[this._selectedRow]}if(c&&this._isRoot(c)){var e=this._bodyIndex(c);var b=this.getRowInfo(e);this._deleteChildRows(d,c);Polymer.dom(d).removeChild(c);this.fire("onRowDeleted",{position:e,rowInfo:b});this._clearSelection(d)}},removeRows:function(){var c=this._getBody();if(c){var b=this._firstRoot();while(b){this._deleteChildRows(c,b);Polymer.dom(c).removeChild(b);b=this._firstRoot()}this._clearSelection(c);this.fire("onAllRowsDeleted")}},moveUp:function(){if(this._selectedRow!=null&&this._selectedRow>0){var d=this._getBody();var g=this._bodyRows(d);if(d){var e=this._selectedRow;if(e>=0&&e<g.length){var c=g[e];if(c.depth===0){var f=e-1;var b=g[f];while(b.depth!==0){b=g[--f]}Polymer.dom(d).insertBefore(c,b);this._moveChildRowsUp(d,c,b);this._selectRow(f,d);this.fire("onRowMoved",{oldPosition:e,newPosition:f,rowInfo:this.getRowInfo(f)})}}}}},moveDown:function(){var c=this._getBody();var e=this._bodyRows(c);if(e&&this._selectedRow!=null&&e.length>this._selectedRow){var b=e[this._selectedRow];var f=this._nextRoot(b);if(f&&!this._isLastRoot(f)){f=this._nextRoot(f);Polymer.dom(c).insertBefore(b,f)}else{f=null;Polymer.dom(c).appendChild(b)}this._moveChildRowsDown(c,b,f);var d=this._bodyIndex(b);this._selectRow(d,c);this.fire("onRowMoved",{oldPosition:d,newPosition:d+1,rowInfo:this.getRowInfo(d)})}},filter:function(c){var g,f;var m=[];for(g=0;g<c.length;++g){var b=c[g];if(b.type&&b.type==="regex"){try{if(b.flags.indexOf("ignoreCase")>=0){m.push(new RegExp(b.value,"i"))}else{m.push(new RegExp(b.value))}}catch(h){alert("Name filter: Invalid regular expression")}}else{m.push(undefined)}}var k=this._rootIterator();while(!k.done()){var l=k.value();var n=true;for(g=0;n&&g<c.length;++g){var b=c[g];if(b&&b.value&&b.value.length>0){for(f=0;n&&f<this._columns.length;f++){var p=this._columns[f];if(p.key===b.key){var o=l.children[f];var d=this._getCellValue(o);if(d){if(o.type==="text"&&m[g]){if(!m[g].test(d)){n=false}}else{if(d.toString()!=b.value){n=false}}}else{n=false}}}}}if(!n){l.setAttribute("hidden","true")}else{if(l.hasAttribute("hidden")){l.removeAttribute("hidden")}}this._setChildDisplay(l);k.next()}},getColumns:function(){var h=[];var b=this._getHCells();var g=this._getColgrp();for(var d=0;d<b.length;++d){var f={};var e=b[d].cellIndex;if(e>=0){f.index=e;if(g){var c=g.children[e];f.name=c.name;f.key=c.id}}h.push(f)}return h},hideColumn:function(d){var h=this._getColgrp();var g=h.children;var e=-1;for(var c=0;c<g.length;++c){if(g[c].id===d){e=c;break}}if(e>=0){var b=this._getHCells();b[e].setAttribute("hidden","true");var f=this._bodyRows();for(var c=0;c<f.length;++c){f[c].children[e].setAttribute("hidden","true")}}},showColumn:function(d){var h=this._getColgrp();var g=h.children;var e=-1;for(var c=0;c<g.length;++c){if(g[c].id===d){e=c;break}}if(e>=0){var b=this._getHCells();b[e].removeAttribute("hidden");var f=this._bodyRows();for(var c=0;c<f.length;++c){f[c].children[e].removeAttribute("hidden")}}},showAllColumns:function(){var b=this._getHCells();for(var e=0;e<b.length;++e){b[e].removeAttribute("hidden")}var f=this._bodyRows();for(var e=0;e<f.length;++e){var d=f[e].children;for(var c=0;c<d.length;++c){d[c].removeAttribute("hidden")}}},hideAllColumns:function(){var b=this._getHCells();for(var e=0;e<b.length;++e){b[e].setAttribute("hidden","true")}var f=this._bodyRows();for(var e=0;e<f.length;++e){var d=f[e].children;for(var c=0;c<d.length;++c){d[c].setAttribute("hidden","true")}}},numRows:function(){var c=0;var b=this.$.table.tBodies[0];if(b){var d=this._bodyRows(b);if(d){c=d.length}}return c},numColumns:function(){var b=0;if(this._columns){b=this._columns.length}return b},setColumns:function(c,d,b){if(this._columns.length>0||this._width||this._height){console.log("ERROR: table columns have alredy been specified");return}this._updateColumns(c,d,b)},setFixedWidth:function(b){this.fixedWidth=b},addDropdownOption:function(h,c,g,f){var b=this._getCell(h,c);var e=this._getCellContent(b);if(e.type==="dropdown"){var i=e.element;var d=document.createElement("option");d.text=g;if(f>=0&&f<i.options.length){i.add(d,i.options[f])}else{i.add(d)}}else{console.log("ERROR: attempt to add a dropdown option to a non-dropdown cell")}},removeDropdownOptionByIndex:function(f,d,c){var b=this._getCell(f,d);var e=this._getCellContent(b);if(e.type==="dropdown"){var g=e.element;if(c>=0&&c<g.options.length){g.remove(c)}}else{console.log("ERROR: attempt to remove a dropdown option from a non-dropdown cell")}},removeDropdownOptionByValue:function(h,d,g){var b=this._getCell(h,d);var f=this._getCellContent(b);if(f.type==="dropdown"){var i=f.element;var c=i.options;for(var e=0;e<c.length;++e){if(c[e].text===g){i.remove(e);break}}}else{console.log("ERROR: attempt to remove a dropdown option from a non-dropdown cell")}},getSelectedDropdownOption:function(f,d){var c=0;var b=this._getCell(f,d);var e=this._getCellContent(b);if(e.type==="dropdown"){var g=e.element;c=g.selectedIndex}else{console.log("WARNING: attempt to select a dropdown option from a non-dropdown cell")}return c},selectDropdownOptionByIndex:function(f,d,c){var b=this._getCell(f,d);var e=this._getCellContent(b);if(e.type==="dropdown"){var g=e.element;if(c>=0&&c<g.options.length){g.selectedIndex=c}}else{console.log("WARNING: attempt to select a dropdown option from a non-dropdown cell")}},selectDropdownOptionByValue:function(h,d,g){var b=this._getCell(h,d);var f=this._getCellContent(b);if(f.type==="dropdown"){var i=f.element;var c=i.options;for(var e=0;e<c.length;++e){if(c[e].text===g){i.selectedIndex=e;break}}}else{console.log("WARNING: attempt to select a dropdown option from a non-dropdown cell")}},expandAllRows:function(b){this._expandAll(true,b)},collapseAllRows:function(b){this._expandAll(false,b)},_updateColumns:function(h,f,p){if(this._columns.length>0){alert("ERROR: table initialized more than once");return}if(!h||h.length===0){console.log("ERROR: bad columns specification");return}var l;for(l=0;l<h.length;++l){this.push("_columns",h[l])}this.set("_width",f);this.set("_height",p);var c=this.$.container;var q=this.$.table;this._setWidth(c,this._width+"px");c.style.height=this._height+"px";var k=document.createElement("colgroup");Polymer.dom(q).appendChild(k);var m=document.createElement("thead");Polymer.dom(q).appendChild(m);var n=document.createElement("tr");Polymer.dom(m).appendChild(n);this._computeColumnWidths();this._setWidth(m,this._width+"px");var j=this;for(l=0;l<this._columns.length;++l){var r=this._columns[l];var g=document.createElement("col");g.id=r.key;g.name=r.name;Polymer.dom(k).appendChild(g);var e=document.createElement("th");Polymer.dom(e).classList.add("headCell");Polymer.dom(n).appendChild(e);if(l===this._colwidths.length-1&&this._colwidths.length>1){this._setWidth(e,"100%")}else{this._setWidth(e,this._colwidths[l]+"px")}var b=document.createElement("div");Polymer.dom(b).classList.add("textdiv");Polymer.dom(e).appendChild(b);var d=document.createElement("span");Polymer.dom(d).classList.add("textSpan");Polymer.dom(d).classList.add("noedit");Polymer.dom(b).appendChild(d);var o=document.createTextNode(r.name);Polymer.dom(d).appendChild(o);e.onmousedown=function(w){var u=w.target.getBoundingClientRect();var v=w.currentTarget.cellIndex;var x=w.currentTarget.parentElement;var t=x.childElementCount;if(j.resizing(w.clientX,u)){j._resize.start=w.clientX;if(j._resizeRight(w.clientX,u)){if(j.fixedWidth){if(v<t-1){j._resize.index=v;j._resize.width=u.width;j._resize.otherIndex=v+1;j._resize.otherWidth=x.cells[j._resize.otherIndex].getBoundingClientRect().width;Polymer.dom(w.currentTarget).classList.add("resizing")}}else{if(v<t){j._resize.tableWidth=j.$.table.getBoundingClientRect().width;if(v<t-1){j._resize.index=v;j._resize.width=u.width}Polymer.dom(w.currentTarget).classList.add("resizing")}}}else{if(j._resizeLeft(w.clientX,u)&&v>0){j._resize.index=v-1;var s=w.currentTarget.parentElement.children[j._resize.index];j._resize.width=s.getBoundingClientRect().width;if(j.fixedWidth){j._resize.otherIndex=v;j._resize.otherWidth=x.cells[j._resize.otherIndex].getBoundingClientRect().width}else{j._resize.tableWidth=j.$.table.getBoundingClientRect().width}Polymer.dom(w.currentTarget).classList.add("resizing")}}}else{j._clearSelection()}};e.onclick=function(){var s=j._cellAttributes(this);j.fire("onCellSelected",{cellInfo:s})};e.ondblclick=function(){var s=j._cellAttributes(this);j.fire("onCellDblClick",{cellInfo:s})};q.onmousemove=function(z){if(j._resize&&j._resize.start!=undefined){var y=z.clientX-j._resize.start;if(j._resize.index>=0){var u=j._resize.width+y;var v=j._resize.index;if(u>j._columnMinWidth){var t=j._resize.otherIndex<0?false:true;if(t){var x=j._resize.otherWidth-y;var s=j._resize.otherIndex;if(x>j._columnMinWidth){j._resizeColumns(v,u,s,x)}}else{var A=j._resize.tableWidth+y;j._resizeColumn(v,u);j._resizeTable(A)}}}else{if(j._resize.tableWidth>0){var A=j._resize.tableWidth+y;j._resizeTable(A)}}}};j.onmouseleave=function(t){j._resizeDone();var s=Polymer.dom(t.currentTarget);if(s.classList.contains("resizing")){s.classList.remove("resizing")}};j.onmouseup=function(t){j._resizeDone();var s=Polymer.dom(t.currentTarget);if(s.classList.contains("resizing")){s.classList.remove("resizing")}}}var i=document.createElement("tbody");i.id="tbody";Polymer.dom(q).appendChild(i);i.style.height=(this._height-this._rowheight)+"px";this.fire("onTreeTableReady",this)},_updateContent:function(f){if(!f){console.log("ERROR: bad table content, rows not defined");return}var b=this._getBody();if(!b){console.log("ERROR: content cannot be added to table prior to column specification");return}if(Array.isArray(f)){var e=f.length;for(var c=0;c<e;++c){var d=document.createElement("tr");Polymer.dom(b).appendChild(d);this._makeRow(d,f[c])}}},_getBody:function(){return Polymer.dom(this.root).querySelector("tbody")},_getHead:function(){return Polymer.dom(this.root).querySelector("thead")},_getColgrp:function(){return Polymer.dom(this.root).querySelector("colgroup")},_getNumHeadRows:function(){var b=0;var c=this._getHead();if(c&&c.children){b=c.children.length}return b},_getHCells:function(){var e=this._getHead();if(e){var d=e.children;var c=d.length;if(c>0){var b=d[c-1];return b.children}}return[]},_getRow:function(f){var e;var b=this._getBody();if(b){var d=this._bodyRows(b);var c=this._bodyRowIndex(f);if(c<d.length){e=d[f]}}return e},_getRowCells:function(c){var b=[];if(c){b=c.children}return b},_getCell:function(f,d){var b;var e=this._getRow(f);if(e){var c=e.children;if(d<c.length){b=c[d]}}return b},_getCellContent:function(b){var d={};if(b){switch(b.type){case"checkbox":var c=b.getElementsByTagName("input");if(c&&c.length===1&&c[0].type==="checkbox"){d.element=c[0];d.type="checkbox"}break;case"text":var c=b.getElementsByClassName("textSpan");if(c&&c.length===1){d.element=c[0];d.type="text"}else{c=b.getElementsByClassName("textInp");if(c&&c.length===1){d.element=c[0];d.type="textinp"}}break;case"dropdown":var c=b.getElementsByTagName("select");if(c&&c.length===1){d.element=c[0];d.type="dropdown"}break;case"tag":d.element=b.firstChild;d.type="tag";break}}return d},_getCellValue:function(b){var e;var d=this._getCellContent(b);if(d&&d.element){var c=d.element;if(d.type==="checkbox"){e=c.checked}else{if(d.type==="text"){e=Polymer.dom(c).textContent}else{e=c.value}}}return e},_selectRow:function(g,d){if(!d){d=this._getBody()}this._clearSelection(d);var f=this._bodyRows(d);if(f&&g>=0&&g<f.length){this._selectedRow=g;var c=f[g].children;if(c){for(var e=0;e<c.length;++e){var b=Polymer.dom(c[e]);if(!b.classList.contains("selected")){b.classList.add("selected")}}}}},_maskRow:function(f){var d=f.children;if(d){for(var e=0;e<d.length;++e){var c=Polymer.dom(d[e]);if(!c.classList.contains("masked")){c.classList.add("masked")}var b=d[e];if(b&&b.children){var g=b.children[0];if(g.children){for(var e=0;e<g.children.length;++e){g.children[e].contententEditable="false"}}}}}},_setWidth:function(b,c){b.style.minWidth=c;b.style.maxWidth=c;b.style.width=c},_isRoot:function(b){return b&&b.depth===0?true:false},_hasRoot:function(b){return b&&b.depth>0?true:false},_isLastRoot:function(b){return b&&this._nextRoot(b)===undefined?true:false},_treeRootPath:function(e){var d;if(e&&this._hasRoot(e)){d=[];var b=e.children[0];d.push(this._getCellValue(b));var c=e.parentRow;while(c){b=c.children[0];d.splice(0,0,this._getCellValue(b));c=c.parentRow}}return d},_bodyIndex:function(d){var c=-1;if(d&&d.parentElement&&d.parentElement.firstChild){var b=d.parentElement.firstChild.rowIndex;if(b>=0){c=d.rowIndex-b}}return c},_bodyRowIndex:function(d){var f=-1;var e=this._getBody();if(e){var c=e.firstChild;if(c){var b=c.rowIndex;if(b>=0){f=d-b}}}return f},_bodyRows:function(b){var c=[];if(!b){b=this._getBody()}if(b){c=b.children}return c},_tableIndex:function(d){var c=d;var b=this._getHead();if(b){c+=b.rows.length}return c},_getRoot:function(f){var c;if(f){if(f.depth===0){return f}var d=this._bodyIndex(f);var b=this._getBody();var e=this._bodyRows(b);c=e[d];while(c&&c.depth!=0){var c=e[--d];if(d<0){console.log("Internal Error")}}}return c},_rootIterator:function(){var b=this;var c=this._firstRoot();return{value:function(){return c},done:function(){return c?false:true},next:function(){c=b._nextRoot(c)}}},_firstRoot:function(){var c;var b=this._getBody().rows;if(b&&b.length>0){if(b[0].depth===0){c=b[0]}}return c},_nextRoot:function(h){var g;if(h){var b=this._getBody();var e=this._bodyRows(b);var d=e.length-1;var c=this._bodyIndex(h);if(c<d){if(h.childrows){var f=e[++c];if(f.depth==0){g=f}else{while(f.depth!=0){if(c===d){break}f=e[++c];if(f.depth===0){g=f;break}}}}else{g=e[++c]}}}return g},_moveChildRowsUp:function(c,f,b){if(f.childrows){for(var e=0;e<f.childrows.length;++e){var d=f.childrows[e];Polymer.dom(c).insertBefore(d,b);this._moveChildRowsUp(c,d,b)}}},_moveChildRowsDown:function(b,f,d){if(f.childrows){for(var e=0;e<f.childrows.length;++e){var c=f.childrows[e];if(d){Polymer.dom(b).insertBefore(c,d)}else{Polymer.dom(b).appendChild(c)}this._moveChildRowsDown(b,c,d)}}},_deleteChildRows:function(b,e){if(e.childrows){for(var d=0;d<e.childrows.length;++d){var c=e.childrows[d];this._deleteChildRows(b,c);Polymer.dom(b).removeChild(c)}}},_expandAll:function(c,i){var b=this._getBody();var f=this._bodyRows(b);if(f.length>0){var e=f.length-1;var d=0;while(d!=e){var h=f[d];if(h.childrows){if(c){this._expandRow(h)}else{this._collapseRow(h)}if(i){var g=f[++d];while(g.depth!=0){if(d===e){d--;break}g=f[++d];if(g.depth===0){d--;break}}}}d++}}},_expandRow:function(c){if(c){c.removeAttribute("collapsed");var b=c.querySelector("button");Polymer.dom(b).classList.remove("expandable");Polymer.dom(b).classList.add("collapsable");this._setChildDisplay(c)}},_collapseRow:function(c){if(c){c.removeAttribute("collapsed");c.setAttribute("collapsed","true");var b=c.querySelector("button");Polymer.dom(b).classList.remove("collapsable");Polymer.dom(b).classList.add("expandable");this._setChildDisplay(c)}},expandRow:function(c){if(c>-1){var b=this._getRow(c);if(b){this._expandRow(b)}}},collapseRow:function(c){if(c>-1){var b=this._getRow(c);if(b){this._collapseRow(b)}}},_clearSelection:function(e){if(!e){e=this._getBody()}var g=this._bodyRows(e);if(g){var f;for(f=0;f<g.length;++f){var d=Polymer.dom(g[f]);if(d.classList.contains("selected")){d.classList.remove("selected")}}for(f=0;f<g.length;++f){var c=g[f].children;if(c){for(var b=0;b<c.length;++b){var d=Polymer.dom(c[b]);if(d.classList.contains("selected")){d.classList.remove("selected")}}}}}this._selectedRow=null},_rowAttributes:function(g){var h={};if(g){var d=this._bodyIndex(g);var e=d<0;h.DOMrow=g;h.isHeaderRow=e;if(e){h.rowIndex=g.rowIndex}else{h.rowIndex=d;h.rowdata=g.rowdata;h.root=this._isRoot(g)?g:this._getRoot(g);var b=this._getRowCells(g);if(b){var f=[];for(var c=0;c<b.length;++c){f.push(this._cellAttributes(b[c]))}h.cells=f}if(this._hasRoot(g)){h.treePath=this._treeRootPath(g)}}}return h},_cellAttributes:function(i){var g={};if(i){var j=i.parentElement;var h=this._getCellContent(i);var f=this._bodyIndex(j);var b=i.classList.contains("headCell");g.DOMcell=i;g.srcElement=h?h.element:null;g.DOMrow=j;g.cellData=i.celldata;g.colIndex=i.cellIndex;g.isHeaderRow=b;if(b){g.rowIndex=j.rowIndex;var d=this.$.table;var e=d.getElementsByTagName("colgroup");if(i.cellIndex>=0&&e){if(e[0]){var c=e[0].children[i.cellIndex];g.colKey=c.id;g.colName=c.name}}}else{g.rowIndex=f;g.root=this._isRoot(j)?j:this._getRoot(j);g.rowdata=j.rowdata;g.colName=i.column.name;g.colKey=i.column.key;g.cellType=i.type;g.editable=i.editable;if(h){g.value=this._getCellValue(i);if(h.type==="dropdown"){if(h.element&&h.element.selectedIndex>=0){g.selectedIndex=h.element.selectedIndex}}}}}return g},_insertDropDown:function(b,e){var d=this;var g=e.options?e.options:b.column.options;var c=[];var i=document.createElement("select");g.forEach(function(j){var k=document.createElement("option");k.text=j.value;if(j.icon){k.icon=j.icon}c.push(j.value);i.add(k)});b.editable=false;if(b.hasChildNodes()){Polymer.dom(b).replaceChild(i,b.children[0])}else{Polymer.dom(b).appendChild(i)}Polymer.dom(i).classList.add("dropdown");Polymer.dom(b).classList.add("dropdownCell");i.selectedIndex=c.indexOf(e.value);i.title=e.value;var f=null;if(i.selectedIndex>=0){f=g[i.selectedIndex].icon}if(f){var h="url('"+f+"')";b.style.backgroundImage=h;b.setAttribute("icon",f)}else{b.style.backgroundImage="none"}i.addEventListener("change",function(l){var k=this.options[this.selectedIndex];i.title=this.options[this.selectedIndex].value;var j=this.parentElement;if(k.icon){var m="url('"+k.icon+"')";j.style.backgroundImage=m}else{j.style.backgroundImage="none"}var n=d._cellAttributes(j);d.fire("onCellModified",{cellInfo:n})})},_insertCheckbox:function(b,e){var d=this;var c=document.createElement("input");c.type="checkbox";c.checked=e.value==="false"?false:true;c.title=c.checked;b.editable=false;if(b.hasChildNodes()){Polymer.dom(b).replaceChild(c,b.children[0])}else{Polymer.dom(b).appendChild(c)}Polymer.dom(c).classList.add("checkbox");Polymer.dom(b).classList.add("checkboxCell");c.addEventListener("change",function(g){var f=this.parentElement;var h=d._cellAttributes(f);c.title=c.checked;d.fire("onCellModified",{cellInfo:h})})},setCheckboxValue:function(c,b){c.checked=b;c.title=c.checked},_insertText:function(k,h,n){var m=this;var c="false";if(h.editable!=undefined){c=h.editable}else{if(k.column.editable!=undefined){c=k.column.editable}}var b=document.createElement("div");Polymer.dom(b).classList.add("textdiv");if(typeof c==="string"||c instanceof String){k.editable=c==="true"?true:false}else{k.editable=c}if(k.hasChildNodes()){Polymer.dom(k).replaceChild(b,k.children[0])}else{Polymer.dom(k).appendChild(b)}if(h.genealogy){for(var g=0;g<n.depth;g++){var j=document.createElement("img");if(g===n.depth-1){if(h.genealogy[g]==="leaf"){Polymer.dom(j).setAttribute("src",this._lastChildIcon)}else{Polymer.dom(j).setAttribute("src",this._childIcon)}}else{if(h.genealogy[g]==="leaf"){Polymer.dom(j).setAttribute("src",this._fillerIcon)}else{Polymer.dom(j).setAttribute("src",this._bypassIcon)}}Polymer.dom(b).appendChild(j);Polymer.dom(j).classList.add("treeline")}}if(h.isParent){var f=document.createElement("button");Polymer.dom(b).appendChild(f);f.row=n;Polymer.dom(f).classList.add("expbtn");if(n.hasAttribute("collapsed")){Polymer.dom(f).classList.add("expandable")}else{Polymer.dom(f).classList.add("collapsable")}f.onclick=function(){m._bButtonClicked=true;var o=f.row;if(o.hasAttribute("collapsed")){o.removeAttribute("collapsed")}else{o.setAttribute("collapsed","true")}var d=Polymer.dom(f);if(d.classList.contains("collapsable")){d.classList.remove("collapsable")}if(d.classList.contains("expandable")){d.classList.remove("expandable")}if(o.hasAttribute("collapsed")){Polymer.dom(f).classList.add("expandable")}else{Polymer.dom(f).classList.add("collapsable")}m._setChildDisplay(o)}}if(h.icon){var j=document.createElement("img");Polymer.dom(b).appendChild(j);Polymer.dom(j).setAttribute("src",h.icon);Polymer.dom(j).classList.add("icon");k.setAttribute("icon",h.icon)}Polymer.dom(k).classList.add("textCell");Polymer.dom(k).classList.add("treeCell");if(c==="true"){var e=document.createElement("div");Polymer.dom(b).appendChild(e);Polymer.dom(e).classList.add("flexdiv");var i=document.createElement("input");Polymer.dom(e).appendChild(i);i.type="text";i.value=h.value;i.title=h.value;Polymer.dom(i).classList.add("textInp");this._addClickHandlers(i,k);i.addEventListener("change",function(){var d=m._cellAttributes(k);i.title=i.value;m.fire("onCellModified",{cellInfo:d})})}else{var l=document.createElement("span");l.title=h.value;Polymer.dom(b).appendChild(l);Polymer.dom(l).classList.add("textSpan");Polymer.dom(k).classList.add("masked");Polymer.dom(l).textContent=h.value;Polymer.dom(l).contentEditable="false";this._addClickHandlers(l,k)}},_insertTag:function(h,e){var j=this;var b=e.tagName?e.tagName:h.column.tagName;var g=e.value;var k=document.createElement(e.tagName);h.editable=true;if(h.hasChildNodes()){Polymer.dom(h).replaceChild(k,h.children[0])}else{Polymer.dom(h).appendChild(k)}if(e.attributes){var d=e.attributes;for(var c=0;c<d.length;c++){k.setAttribute(d[c].name,d[c].value)}}if(e.properties){var f=e.properties;for(var c=0;c<f.length;c++){k[f[c].name]=f[c].value}}k.value=e.value;k.addEventListener("change",function(l){var i=this.parentElement;var m=j._cellAttributes(i);j.fire("onCellModified",{cellInfo:m})})},makeTextCellEditable:function(i,d,g){var c=this;var b=this._getCell(i,d);var e=document.createElement("div");Polymer.dom(e).classList.add("textdiv");if(b.hasChildNodes()){Polymer.dom(b).replaceChild(e,b.children[0])}else{Polymer.dom(b).appendChild(e)}var h=document.createElement("div");Polymer.dom(e).appendChild(h);Polymer.dom(h).classList.add("flexdiv");var f=document.createElement("input");Polymer.dom(h).appendChild(f);f.type="text";f.value=g;f.title=f.value;Polymer.dom(f).classList.add("textInp");this._addClickHandlers(f,b);f.addEventListener("change",function(){var j=c._cellAttributes(b);f.title=f.value;c.fire("onCellModified",{cellInfo:j})})},_setChildDisplay:function(c){if(c.childrows){for(var b=0;b<c.childrows.length;++b){if(c.hasAttribute("collapsed")||c.hasAttribute("hidden")){c.childrows[b].setAttribute("hidden","true")}else{c.childrows[b].removeAttribute("hidden")}this._setChildDisplay(c.childrows[b])}}},_insertImage:function(b,d){var c=document.createElement("img");Polymer.dom(c).setAttribute("src",d.value);if(b.hasChildNodes()){Polymer.dom(b).replaceChild(c,b.children[0])}else{Polymer.dom(b).appendChild(c)}Polymer.dom(b).classList.add("imageCell");Polymer.dom(c).classList.add("image");b.editable=false},_insertEmpty:function(b){var c=document.createElement("span");if(b.hasChildNodes()){Polymer.dom(b).replaceChild(c,b.children[0])}else{Polymer.dom(b).appendChild(c)}Polymer.dom(b).classList.add("emptyCell");Polymer.dom(b).classList.add("masked");b.editable=false},_setCellContent:function(b,c,e){if(c.celldata){b.celldata=c.celldata}if(c.customClickHandler){b.customClickHandler=c.customClickHandler}var d=c.type?c.type:b.column.type;b.type=d;switch(d){case"dropdown":this._insertDropDown(b,c);this._addClickHandlers(b);break;case"checkbox":this._insertCheckbox(b,c);this._addClickHandlers(b);break;case"text":this._insertText(b,c,e);break;case"image":this._insertImage(b,c);this._addClickHandlers(b);break;case"tag":this._insertTag(b,c);this._addClickHandlers(b);break;default:this._insertEmpty(b);this._addClickHandlers(b);break}},_addClickHandlers:function(e,b){var d=this;var c=b?b:e;e.onclick=function(){var f=d._cellAttributes(c);d.fire("onCellSelected",{cellInfo:f});if(c.customClickHandler){c.customClickHandler.call(d,{cellInfo:f})}};e.ondblclick=function(){var f=d._cellAttributes(c);d.fire("onCellDblClick",{cellInfo:f})}},_addCell:function(g,h,c){var b=document.createElement("td");Polymer.dom(g).appendChild(b);var d=h===0&&c.children;if(h===this._columns.length-1&&this._columns.length>1){this._setWidth(b,"100%")}else{this._setWidth(b,this._colwidths[h]+"px")}var e=this._columns[h];var f=c[e.key];b.column=e;if(f){if(h===0){if(d){f.isParent=true}if(c.genealogy){f.genealogy=c.genealogy}}this._setCellContent(b,f,g)}else{this._insertEmpty(b)}},_makeRow:function(m,g,e,h){var k=this;m.onclick=function(){if(k._bButtonClicked===false){k._clearSelection();k._selectedRow=k._bodyRowIndex(this.rowIndex);k._selectRow(k._selectedRow);var i=k._rowAttributes(this);k.fire("onRowSelected",{rowInfo:i})}else{k._bButtonClicked=false}};m.onmouseover=function(){var j=this.children;if(j){for(var n=0;n<j.length;++n){Polymer.dom(j[n]).classList.add("highlight")}Polymer.dom(k._getBody()).classList.add("highlight")}};m.onmouseout=function(){var n=this.children;if(n){for(var o=0;o<n.length;++o){var j=Polymer.dom(n[o]);if(j.classList.contains("highlight")){j.classList.remove("highlight")}}Polymer.dom(k._getBody()).classList.remove("highlight")}};if(e===undefined){e=0}m.depth=e;if(h){m.parentRow=h}if(g.rowdata){m.rowdata=g.rowdata}if(g.children){m.setAttribute("collapsed","true")}for(var c=0;c<this._columns.length;c++){this._addCell(m,c,g)}if(g.children){for(var f=0;f<g.children.length;f++){var l=g.children[f];if(g.genealogy){l.genealogy=g.genealogy.slice()}else{l.genealogy=[]}var d=m.parentElement;var b=document.createElement("tr");Polymer.dom(d).appendChild(b);if(f===g.children.length-1){l.genealogy.push("leaf")}else{l.genealogy.push("internal")}this._makeRow(b,l,e+1,m);if(!m.childrows){m.childrows=[]}m.childrows.push(b)}this._setChildDisplay(m)}},_resizeDone:function(){this.set("_resize.start",undefined);this.set("_resize.index",-1);this.set("_resize.width",0);this.set("_resize.otherIndex",-1);this.set("_resize.otherWidth",0);this.set("_resize.tableWidth",0)},resizing:function(c,b){return this._resizeRight(c,b)||this._resizeLeft(c,b)},_resizeRight:function(c,b){return b.right-c<10},_resizeLeft:function(c,b){return c-b.left<10},_computeColumnWidths:function(){if(this._width&&!isNaN(this._width)){if(this._colwidths.length>0){this.splice("_colwidths",0,this._colwidths.length-1)}var d=0;var j=this._width;var f=j/100;var g=this._columns.length;var e;for(e=0;e<g;++e){var c=this._columns[e];if(c.width_percent){var h=parseFloat(c.width_percent);if(isNaN(h)){d++}else{h*=f;j-=h}this.push("_colwidths",h)}else{d++;this.push("_colwidths",NaN)}}if(d>0){var b=j/d;for(e=0;e<g;++e){if(isNaN(this._colwidths[e])){this.set("_colwidths"+("."+e),b)}}}}},_resizeColumns:function(d,e,b,c){this._resizeColumn(d,e);this._resizeColumn(b,c)},_resizeColumn:function(e,l){if(e<this.numColumns()-1){var b=l+"px";var j=this.$.table;var f=j.tHead;var h=f.children[0];this._setWidth(h.cells[e],b);var d=j.tBodies[0];var k=d.children;for(var c=0;c<k.length;++c){var g=k[c].cells[e];this._setWidth(g,b)}this.set("_colwidths"+("."+e),l)}},_resizeTable:function(d){var b=d+"px";var c=this.$.table;var e=c.tHead;this._setWidth(c,b);this._setWidth(e,b)}})}(this));