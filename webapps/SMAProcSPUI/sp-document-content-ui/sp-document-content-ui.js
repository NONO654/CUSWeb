(function(c){var d,a,b;d={noData:"no-data",filesAvailable:"files-available",noFiles:"no-files",loading:"is-loading",updating:"is-updating",error:"is-error",readonly:"is-readonly",readwrite:"is-read-write",dropping:"is-dropping"};a={pdf:{name:"Portable Document",image:"smaFilePDF.gif"},doc:{name:"Word 97-2003 Document",image:"smaFileWord.gif"},docx:{name:"Word Document",image:"smaFileWord.gif"},xls:{name:"Excel 97-2003 Document",image:"smaFileExcel.gif"},xlsx:{name:"Excel Document",image:"smaFileExcel.gif"},txt:{name:"Normal Text Document",icon:"fonticon-doc"},png:{name:"Portable Network Graphics Image",icon:"fonticon-picture"},jpg:{name:"JPG Image",icon:"fonticon-picture"},jpeg:{name:"JPEG Image",icon:"fonticon-picture"},zip:{name:"Zipped File",icon:"fonticon-archive"},ppt:{name:"PowerPoint 97-2003 Presentation",image:"smaFilePowerPoint.gif"},pptx:{name:"PowerPoint Presentation",image:"smaFilePowerPoint.gif"}};b={chrome:"Files",firefox:"application/x-moz-file",ie:"Files"};Polymer({is:"sp-document-content-ui",properties:{contentid:{notify:true,observer:"__contentIdChanged"},_files:{type:Array,notify:true,value:[]},_filteredfiles:{type:Array,notify:true,value:[]},readOnly:{type:Boolean,value:false,observer:"__readOnlyChanged",notify:true},type:{type:String,value:"",notify:true},showUploadProgress:{type:Boolean,value:false,notify:true},state:{value:d.noData,notify:true},disabled:{type:Boolean,value:false,notify:true},stateread:{notify:true,value:d.readwrite},currentPage:{type:Number,value:0,notify:true},pageSize:{type:Number,value:10,notify:true},_range:{type:Object,notify:true,value:{min:0,max:10},computed:"_cumputeRange(_files, currentPage, pageSize)"}},observers:["computefilteredfiles(_files, _range, showPagebar)"],__contentIdChanged:function(){this.state=d.noData;if(this.contentid&&this.contentid!==""&&this.contentid.indexOf("{{")<0){this.state=d.loading;this.debounce("_fetchData",this._fetchData.bind(this),100)}},__readOnlyChanged:function(){if(this.readOnly){this.stateread=d.readonly}else{this.stateread=d.readwrite}},_cumputeRange:function(g,i,f){var j=g.length;var h=0;var e=0;if((j/f)>1&&(i<(j/f))&&i>=0){h=i*f;if((h+f)>=j){this.lastPage=true;e=j}else{this.lastPage=false;e=(h+f)}this.showPagebar=true;return{min:h,max:e}}this.showPagebar=false;return{min:0,max:j}},_rangeChanged:function(){this.$.fileList.render()},_fetchData:function(){this.$.spFileContent.getContentInfo(this.contentid).then(function(e){this._files=JSON.parse(e);this.state=this._files.length>0?d.filesAvailable:d.noFiles;if(this.state==="files-available"){this.fire("sp-document-content-ui-files-available",{valid:true})}else{this.fire("sp-document-content-ui-files-available",{valid:false})}}.bind(this))["catch"](function(){this.state=d.error}.bind(this))},refresh:function(){this._fetchData()},computefilteredfiles:function(){var e;if(this.showPagebar){e=this._files.sort(this._computeSort);this._filteredfiles=e.filter(this._computeFilter.bind(this))}else{this._filteredfiles=this._files.sort(this._computeSort)}},download:function(e){if(!this.disabled){this._download(e,false)}},checkout:function(e){if(!this.disabled){this._download(e,true)}},update:function(e){if(!this.disabled){this.uploadModel=e.model[this.$.fileList.as];this.$.uploadBtn.setAttribute("accept","."+this._getFileExtn(this.uploadModel.basics.name));this.$.uploadBtn.click()}},deletefile:function(f){var e;if(!this.disabled){e=f.model[this.$.fileList.as];this.deleteFileName=e.basics.name;this.deleteFileVersion=e.basics.revision?"all":"none";this.$.deleteConfirmation.show()}},proceedDelete:function(e){e.stopPropagation();this._delete(this.deleteFileName,this.deleteFileVersion);this.$.deleteConfirmation.hide();this.deleteFileName="";this.deleteFileVersion=""},discardDelete:function(e){e.stopPropagation();this.$.deleteConfirmation.hide();this.deleteFileName="";this.deleteFileVersion=""},upload:function(){if(!this.disabled){this.uploadModel=undefined;this.$.uploadBtnMultiple.click()}},previousPage:function(e){e.stopPropagation();if(this.currentPage!==0){this.currentPage=this.currentPage-1}},nextPage:function(e){e.stopPropagation();if(!this.lastPage){this.currentPage=this.currentPage+1}},_download:function(g,e){var f=g.model[this.$.fileList.as];var h=e?"checkout":"download";this.notifyUpdate("info",f.basics.name,h,"Started");this.state=d.updating;this.disabled=true;this.$.spFileContent.downloadFile(this.contentid,f.basics.name,null,h).then(function(){this.notifyUpdate("info",f.basics.name,h,"Completed");this.disabled=false;this.refresh()}.bind(this))["catch"](function(i){this.notifyUpdate("error",f.basics.name,h,"Error",i);this.disabled=false;this.refresh()}.bind(this))},_delete:function(f,e){this.state=d.updating;this.disabled=true;this.$.spFileContent.deleteFile(this.contentid,f,e).then(function(){this.notifyUpdate("info",f,"Delete","Completed");this.disabled=false;this.refresh()}.bind(this))["catch"](function(g){this.notifyUpdate("error",f,"Delete","Error",g);this.disabled=false;this.refresh()}.bind(this))},_fetchFileFromDisk:function(e){var f=e.target;if(f.files[0]!==null){if(this.uploadModel&&(this.uploadModel.basics.name!==f.files[0].name)){this.notifyUpdate("error","Please select file "+this.uploadModel.basics.name,"Checkin","Error")}else{this._upload(f.files[0])}}f.value=""},_fetchMultipleFileFromDisk:function(e){var f=e.target;if(f.files.length>0){if(!this.containsHTMLFiles(f.files)){this._uploadMultipleFiles(f.files)}else{this._onDropError(e)}}f.value=""},_uploadMultipleFiles:function(l){var f="";var k=this._files;var e=[];var n=[];var m=-1;var h=0,g=0;for(h=0;h<l.length;h+=1){f=l[h];e.push(f);m=this._getFileIndex(k,f.name);if(m===-1){n.push({attributes:{title:f.name},basics:{fileLockedForCheckin:false,isLocked:"FALSE",modified:(new Date()).toString(),name:f.name,type:"file"},uploaded:10})}else{this._files[m].uploaded=0;n.push(this._files[m])}}this._files=n;this._uploadFileCount=e.length;for(g=0;g<e.length;g+=1){this._upload(e[g])}},_upload:function(e){var f={documentid:this.contentid,policy:"Simulation Document",fileName:e.name,file:e};this.state=d.updating;this.disabled=true;this.$.spFileContent.uploadFile(f).then(function(){this.removeProgressBar(f.fileName)}.bind(this))["catch"](function(i){var h="";try{h=JSON.parse(i.response).datarecords.datagroups[0].dataelements.error.value[0].value;this.notifyUpdate("error",f.fileName,"Upload","Error",h)}catch(g){}this.notifyUpdate("error",f.fileName,"Upload","Error","Unable to upload. Please select/drop valid files");this.removeProgressBar(f.fileName)}.bind(this));this.$.filesContainer.scrollTop=0},updateProgress:function(f){var g=f.detail;var e=this._getFileIndex(this._filteredfiles,g.fileInfo.fileName);if(e!==-1){this._filteredfiles[e].uploaded=g.uploaded;Polymer.Base.set("_filteredfiles."+e+".uploaded",g.uploaded,this);this.notifyPath("_filteredfiles."+e+".uploaded",g.uploaded)}},_getFileIndex:function(g,f){var e=-1;g.forEach(function(h){if(h.basics.name===f){e=g.indexOf(h)}});return e},removeProgressBar:function(f){var e=this._getFileIndex(this._filteredfiles,f);if(e!==-1){this._filteredfiles[e].uploaded=100;Polymer.Base.set("_filteredfiles."+e+".uploaded",100,this);this.notifyPath("_filteredfiles."+e+".uploaded",100)}if(this._uploadFileCount&&this._uploadFileCount>1){this._uploadFileCount-=1}else{if(this._uploadFileCount){this._uploadFileCount-=1}this.disabled=false;this.refresh()}},getStyleForProgress:function(e){var f;if(Number(e)!==isNaN&&Number(e)<100&&Number(e)>0){f=Number(e);return"background-image: linear-gradient(to right,#57B847, #57B847 "+f+"%, #e2e4e3 "+f+"%,#e2e4e3 "+(100-f)+"%)"}return"background-image: none"},onDragEnter:function(e){var f=e.dataTransfer;if(this._isValidDropData(e)&&!this.readOnly){f.dropEffect="move";this.DOM(this.$.dropOverlay).addClass(d.dropping);this._stopPropogation(e)}else{f.dropEffect="none"}},onDragOver:function(e){if(this._isValidDropData(e)&&!this.readOnly){this._stopPropogation(e);this.onDragEnter(e)}},onDragLeave:function(e){if(this._isValidDropData(e)&&!this.readOnly){this._stopPropogation(e);this.DOM(this.$.dropOverlay).removeClass(d.dropping)}},onDrop:function(e){if(!this.disabled&&!this.readOnly){this._onDrop(e)}},_onDrop:function(e){if(this._isValidDropData(e,true)&&!this.readOnly&&!this.disabled){this._onDropSuccess(e)}else{this._onDropError(e)}},_onDropSuccess:function(e){this.onDragLeave(e);if(e.dataTransfer.files){this._uploadMultipleFiles(e.dataTransfer.files);this._stopPropogation(e)}},_onDropError:function(e){if(!this.readOnly&&!this.disabled){this.notifyUpdate("error","","Upload","Error","Invalid Files(HTML/HTM) or Folder dropped. Please drop valid files")}this._stopPropogation(e);this.DOM(this.$.dropOverlay).removeClass(d.dropping)},_stopPropogation:function(e){e.preventDefault();e.stopPropagation()},_isValidDropData:function(f,k){var l,g,n,e,j,h;var m=f.dataTransfer.types;if(this.contentid&&!this.readonly&&!this.disabled){l=navigator.userAgent;g=l.contains("Chrome")?b.chrome:"";if(g===""){g=l.contains("Firefox")?b.firefox:b.ie}if(l.contains("Chrome")){h="chrome"}else{if(l.contains("Firefox")){h="firefox"}else{h="ie"}}n=false;for(e in m){if(m[e]===g){n=true;break}}if(n&&k){n=!this.containsHTMLFiles(f.dataTransfer.files);if(n&&h==="chrome"){if(f.dataTransfer.items&&f.dataTransfer.items.length){[].forEach.call(f.dataTransfer.items,function(o){var i=o.webkitGetAsEntry();if(i&&i.isDirectory){n=false}})}}else{if(n&&h==="ie"){if(k&&n&&f.dataTransfer.files&&f.dataTransfer.files.length===0){n=false}}else{if(h==="firefox"){if(n&&this.containsFFFolder(f.dataTransfer.files)){n=false}}}}}return n}return false},containsFFFolder:function(f){var e=false;[].forEach.call(f,function(g){if(g.type===""&&g.name.indexOf(".")===-1&&g.size%4096===0){e=true}});return e},containsHTMLFiles:function(f){var e=false;[].forEach.call(f,function(g){if(g.type==="text/html"){e=true}});return e},notifyUpdate:function(h,g,f,e,i){this.fire("sp-document-content-ui-update",{type:h,filename:g,operation:f,status:e,msg:i})},_getFileExtn:function(e){return/[^.]+$/.exec(e)[0]},_getFileRevision:function(e){return e?" (ver "+e+")":""},_getCurrentPageInfo:function(f,e,h){var g=Math.ceil(f.length/e);return"Page "+(h+1)+" of "+g},_isPreviousDisabled:function(e){if(e<=0){return true}return false},_isNextDisabled:function(e){return e},_getFileContainerPage:function(e){if(e){return"multi"}return"one"},_getFileTitleOnHover:function(f){var e,h,g;var j="Title: "+f.name;if(f.revision){j+="\nVersion: "+f.revision}if(f.modified){j+="\nModified: "+f.modified}if(f.size){e=Number(f.size);h=["Bytes","KB","MB","GB","TB"];if(e===0){j+="\nSize: 0 Byte"}else{g=parseInt(Math.floor(Math.log(e)/Math.log(1024)));j+="\nSize: "+Math.round(e/Math.pow(1024,g),2)+" "+h[g]}}return j},_computeFileIcon:function(e){var f=this._getFileExtn(e)?this._getFileExtn(e).toLowerCase():undefined;if(a[f]){if(a[f].icon){return"fonticon "+a[f].icon}else{if(a[f].image){return"fonticon image-container"}}}return"fonticon fonticon-doc"},_computeIconImageSrc:function(e){var f=this._getFileExtn(e)?this._getFileExtn(e).toLowerCase():undefined;if(a[f]&&a[f].image){return this.$.dashboard.getMcsUri()+"/common/images/"+a[f].image}return""},_computeFileType:function(e){var f=this._getFileExtn(e)?this._getFileExtn(e).toLowerCase():undefined;return a[f]?a[f].name:"Unknown File Format"},_computeFileIconContainer:function(g,e){var f="file-icon-container ";if(String(e).toLowerCase()==="true"){f+="lock-other"}else{if(String(g).toLowerCase()==="true"){f+="lock-self"}}return f},_computeCheckOutClass:function(f,e){if(String(e).toLowerCase()==="true"||String(f).toLowerCase()==="true"){return"no-action update-operation file-action fonticon fonticon-export"}return"update-operation file-action fonticon fonticon-export"},_computeUploadClass:function(e){if(String(e).toLowerCase()==="true"){return"no-action update-operation file-action fonticon fonticon-upload"}return"update-operation file-action fonticon fonticon-upload"},_computeDeleteClass:function(f,e){if(String(e).toLowerCase()==="true"||String(f).toLowerCase()==="true"){return"no-action update-operation file-action fonticon fonticon-trash"}return"update-operation file-action fonticon fonticon-trash"},_computeSort:function(f,e){var h=new Date(f.basics.modified);var g=new Date(e.basics.modified);if(h.getTime()===g.getTime()){return f.basics.name>e.basics.name?1:-1}return h>g?-1:1},_computeFilter:function(f,e){return(e>=this._range.min&&e<this._range.max)},_computeMainClass:function(f){var e="main";if(f){e+=" is-disabled"}return e},behaviors:[c.DS.SMAProcSP.SPBase]})}(this));