define("DS/DELWebMfgItemDefUITreeDocuments/ActionTreeDocument",["UWA/Core","DS/Logger/Logger","UWA/Class/Options","UWA/Class/Listener","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","DS/DELWebMfgAssetsDefInstanceModel/InstanceModel","DS/DELWebMfgAssetsDefUIOccurenceModel/AbstractTreeDocument","DS/DELWebMfgItemDefUITreeNodeModels/ActionTreeNodeModel","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils"],function(d,b,j,o,e,c,l,m,f,i){var a=l.extend(j,o,{name:"ActionTreeDocument",_references:null,_connections:null,_fromPID:null,init:function n(p){var q=this;this._fromPID=p.fromPID;this._parent(p);this._references=this._context.getReferenceCollection();this._connections=this._context.getConnectionCollection();this.listenTo(q._references,"onChange:displayModel",q._onReferenceAdd);this.listenTo(q._connections,"onRemove",q._onConnectionRemove)},destroy:function(){this.stopListening();this._parent()},_onReferenceAdd:function h(u){var s,r,v,t,q,w;var p=u.get("displayModel");if(p){s=p.get("asRootInActionView");if(s){r=u.id;if(d.is(r,"string")){v=this.getNodeModel(r,{searchReferencePID:true,returnFirstOne:true,});if(v){return null}}v=m.createNodeFromModels({treelistview:this.getTreeListView(),reference:u,});this.addRoot(v);w=[];q=i.connections.where({from:r});q.forEach(function(x){w.push({modelID:x.get("to"),connectionID:x.id,connectionTypeName:x.get("type")})});t=i.connections.where({to:r,from:this._fromPID});t.forEach(function(x){w.push({modelID:x.get("from"),connectionID:x.id,connectionTypeName:x.get("type")+"_inverse"})});if(w){this._onConnectionModelInfoChanged(u,w)}}}this.getTreeListView().dispatchEvent("treeListViewUpdate")},_onConnectionRemove:function k(q){var p=q.get("to"),s=i.getReferenceFromCollection(p),r=this.getNodeModel(p,{searchReferencePID:true,returnFirstOne:true,});if(d.is(r)&&d.is(s)){s.setDisplayModel({asRootInActionView:false},{silent:true});this.removeRoot(r);this.getTreeListView().dispatchEvent("treeListViewUpdate")}},_onConnectionModelInfoChanged:function g(q,w){var s,r,u,p,t;if(!d.is(w,"array")){return}s=this.getTreeListView();r=s._datagrid;u=r._listOfColumns;u=u.filter(function v(x){var y=x.split(".");return"relation"===y[1]},this);p=f.getRelationAttributes(w,u);if(d.is(p)&&Object.keys(p).length>0){this.getTreeListView().utils.updateTreeDocument(q,null,p)}t=this.getNodeModel(q.id,{searchReferencePID:true});if(d.is(t,"array")){t.forEach(function(x){x.updateBI()})}else{t.updateBI()}},});return a});