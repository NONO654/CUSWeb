define("DS/QKMQualityMetrics/model/abstract/Model_Abstract",["UWA/Core","UWA/Class/Model","DS/WAFData/WAFData"],function(d,c,a){var b=c.extend({idAttribute:"resourceid",init:function(e){this._parent(e)}});return b});define("DS/QKMQualityMetrics/model/collections/PreferencePidCollection",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils"],function(e,d,b,c){var a=b.extend({model:d.extend({idAttribute:"objectId"}),convertFromModelToTreeFilterView:function(){var f=this.map(function(g){return{label:g.get("displayName"),value:g.get("objectId")}});return f}});return a});define("DS/QKMQualityMetrics/view/controls/popup/Popup",["UWA/Core","UWA/Class/View"],function(c,b){var a=b.extend({render:function(){this.container.setStyles({width:"100%",height:"100%",position:"fixed","z-index":"100"});var d='<div class="row" style="height:100%;">    <div class="col-xs-5" style="height:99%; background-color:transparent;"></div>    <div class="col-xs-7 popup" style="height:99%; background-color:white;"></div></div>';this.container.setContent(d);this.elements.container1=this.container.getElement("div.row:nth-child(1) > div.col-xs-5");this.elements.container2=this.container.getElement("div.row:nth-child(1) > div.col-xs-7");this.elements.container1.addEvent("click",function(){this.dispatchEvent("onClosePopup",[]);this.destroy()}.bind(this));return this},setContent:function(d){this.elements.container2.setContent(d)},destroy:function(){this.stopListening();this.model=null;try{this._parent()}catch(d){}}});return a});define("DS/QKMQualityMetrics/view/controls/rangeslider/RangeSlider",["UWA/Core","UWA/Class/View","css!DS/QKMQualityMetrics/assets/RangeSlider.css"],function(c,b){var a=b.extend({render:function(){var f=this;this.container.setStyles({width:"100%",height:"100%",});var g='<div class="range-slider">    <span class="rangeValues"></span>'+'    <input value="{0}" min="0" max="{1}" step="10" type="range">'.format(0,this.options.max)+'    <input value="{0}" min="0" max="{1}" step="10" type="range">'.format(this.options.max,this.options.max)+"</div>";this.container.setContent(g);var d=this.container.getElement(".range-slider");var e=d.getElements("input");for(var h=0;h<e.length;h++){if(e[h].type==="range"){e[h].oninput=function(){var m=this.parentNode;var l=m.getElements("input");var k=parseFloat(l[0].value);var j=parseFloat(l[1].value);if(k>j){var i=j;j=k;k=i}var n=m.getElements(".rangeValues")[0];n.innerHTML=k+" - "+j};e[h].oninput()}}var d=this.container.getElement(".range-slider");var e=d.getElements("input");e[0].addEvent("change",function(){f.dispatchEvent("change",[[parseFloat(e[0].value),parseFloat(e[1].value)]])});e[1].addEvent("change",function(){f.dispatchEvent("change",[[parseFloat(e[0].value),parseFloat(e[1].value)]])});return this},changeValue:function(f,d){var e=this.container.getElement(".range-slider");var g=e.getElements("input");var h=e.getElements(".rangeValues")[0];h.innerHTML=f+" - "+d;if(typeof f!=="undefined"){g[0].value=f}if(typeof d!=="undefined"){g[1].value=d}},enable:function(){var d=this.container.getElement(".range-slider");var e=d.getElements("input");e[0].disabled=false;e[1].disabled=false},disable:function(){var d=this.container.getElement(".range-slider");var e=d.getElements("input");e[0].disabled=true;e[1].disabled=true},getValues:function(){var d=this.container.getElement(".range-slider");var e=d.getElements("input");return{min:e[0].value,max:e[1].value,}},destroy:function(){this.stopListening();this.model=null;try{this._parent()}catch(d){}}});return a});define("DS/QKMQualityMetrics/controller/abstract/Controller_Abstract",["UWA/Class","UWA/Class/Listener","UWA/Class/Debug"],function(a,d,c){var b=a.extend(d,c,{init:function(f){var h=["model","view"];for(var g=h.length-1;g>=0;g--){var e=h[g];if(f.hasOwnProperty(e)){this[e]=f[e];delete f[e]}}this.setup()},setup:function(){}});return b});define("DS/QKMQualityMetrics/view/subviews/TreeFilterView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Form","DS/UIKIT/Popover","DS/UIKIT/Input/Button","i18n!DS/QKMQualityMetrics/assets/nls/QKMQualityMetrics"],function(h,f,g,b,d,a,e){var c=f.extend({render:function(){var p=this;var r=this.options.target;this.elements.popover=new d({target:r,position:"bottom",body:this.container,title:e.get("NLS_TREE_FILTER"),offset:{y:-12,x:270}});var k=null;r.addEventListener("mouseenter",function(u){if(k){clearTimeout(k)}h.log("show");p.elements.popover.show()});this.container.addEventListener("mouseenter",function(u){if(k){clearTimeout(k)}h.log("show");p.elements.popover.show()});this.container.addEventListener("mouseleave",function(u){k=setTimeout(function(){h.log("hide");p.elements.popover.hide()}.bind(this),1000)});r.addEventListener("mouseleave",function(u){k=setTimeout(function(){h.log("hide");p.elements.popover.hide()}.bind(this),1000)});this.elements.popover.getContent().getElement(".popover-arrow").style.left="29px";this.elements.popover.getContent().style.maxWidth="600px";this.container.setStyles({width:"570px",height:"100%",});var s='<div class="row">    <div class="col-xs-11" style="height:100%">        <div class="row">            <div class="col-xs-12" style="height:100%"></div>        </div>        <div class="row" style="height:100%">            <div class="col-xs-1" style="height:100%">                <span class="fonticon fonticon-2x fonticon-level-down "></span>            </div>            <div class="col-xs-11" style="height:100%"></div>        </div>        <div class="row">            <div class="col-xs-1" style="height:100%"></div>            <div class="col-xs-1" style="height:100%">                <span class="fonticon fonticon-2x fonticon-level-down "></span>            </div>            <div class="col-xs-10" style="height:100%"></div>        </div>    </div>    <div class="col-xs-1" style="height:100%">        <div class="row">        	 <div class="col-xs-12" style="height:100%"></div>        </div>    </div></div><div class="row">    <div class="col-xs-4 col-xs-offset-8">'+'        <button type="button" style="float: right" class="btn btn-primary">{0}</button>'.format(e.get("NLS_FILTER"))+"    </div></div>";this.container.setContent(s);this.elements.container1=this.container.getElement("div.row:nth-child(1) > div.col-xs-11 > div.row:nth-child(1) > div.col-xs-12");this.elements.container2=this.container.getElement("div.row:nth-child(1) > div.col-xs-1  > div.row:nth-child(1) > div.col-xs-12");this.elements.container3=this.container.getElement("div.row:nth-child(1) > div.col-xs-11 > div.row:nth-child(2) > div.col-xs-11");this.elements.container4=this.container.getElement("div.row:nth-child(1) > div.col-xs-11 > div.row:nth-child(3) > div.col-xs-10");this.elements.applyButton=this.container.getElement("div.row:nth-child(2) .btn");this.elements.applyButton.addEvent("click",this.onApply.bind(this));var m=this.model.get("preferencesModel");var q=this.model.get("assessmentsResultsCollection").convertFromModelToTreeFilterView().profiles;var j=this.model.get("assessmentsResultsCollection").convertFromModelToTreeFilterView().checks;var t=m.get("pidCollection").convertFromModelToTreeFilterView();this.elements.form1=new b({fields:[{placeholder:e.get("NLS_SELECT_ITEM_TO_FILTER"),name:"products",label:e.get("NLS_PRODUCTS"),type:"select",multiple:true,options:t}],events:{onChange:function(v){var u=this.getValue(v).split(",");if(u.length===1&&u[0]===""){u.splice(0,1)}m.set("treeProducts",u)}}}).inject(this.elements.container1);var n=m.get("treeProducts");if(n){this.elements.form1.lists[0].setValue("");this.elements.form1.lists[0].setValue(n)}this.elements.btn=new a({icon:"arrow-combo",id:"siwtchBtn",className:"primary"}).inject(this.elements.container2);this.elements.btn.elements.icon.className+=" fonticon-1-2x";this.elements.btn.elements.icon.style.width="auto";this.elements.btn.addEvent("onClick",this.onClickSwitch.bind(this));this.elements.form2=new b({fields:[{placeholder:"Select item to filter, ALL by default",name:"Profiles",label:e.get("NLS_PROFILES"),type:"select",multiple:true,options:q}],events:{onChange:function(v){var u=this.getValue(v).split(",");if(u.length===1&&u[0]===""){u.splice(0,1)}m.set("treeProfiles",u)}}}).inject(this.elements.container3);var o=m.get("treeProfiles");if(o){this.elements.form2.lists[0].setValue("");this.elements.form2.lists[0].setValue(o)}this.elements.form3=new b({fields:[{placeholder:"Select item to filter, ALL by default",name:"Checks",label:e.get("NLS_CHECKS"),type:"select",multiple:true,options:j}],events:{onChange:function(v){var u=this.getValue(v).split(",");if(u.length===1&&u[0]===""){u.splice(0,1)}m.set("treeChecks",u)}}}).inject(this.elements.container4);var l=m.get("treeChecks");if(o){this.elements.form3.lists[0].setValue("");this.elements.form3.lists[0].setValue(l)}var i=m.get("treeMode");if(i==="profile"){this.elements.form1.inject(this.elements.container3);this.elements.form2.inject(this.elements.container1)}if(i==="product"){this.elements.form1.inject(this.elements.container1);this.elements.form2.inject(this.elements.container3)}return this},onClickSwitch:function(){var i=this.model.get("preferencesModel");if(this.elements.container1.contains(this.elements.form1.getContent())){i.set("treeMode","profile");this.elements.form1.inject(this.elements.container3);this.elements.form2.inject(this.elements.container1)}else{i.set("treeMode","product");this.elements.form1.inject(this.elements.container1);this.elements.form2.inject(this.elements.container3)}},onApply:function(){this.elements.popover.hide();this.model.dispatchEvent("applyPreference")},destroy:function(){this.stopListening();this.model=null;try{this._parent()}catch(i){}}});return c});define("DS/QKMQualityMetrics/controller/QKMQualityMetricsController",["UWA/Core","DS/QKMQualityMetrics/controller/abstract/Controller_Abstract","DS/TagNavigatorProxy/TagNavigatorProxy"],function(d,b,c){var a=b.extend({setup:function(){this.createTagNavigator();this.listenTo(this.model,"onSyncModel",this.onSync)},onSync:function(){var e=this.model.get("assessmentsResultsCollection").facets;this.taggerProxy.setTags(null,e)},createTagNavigator:function(){var e={widgetId:widget.id,filteringMode:"FilteringOnServer",events:{addFilterChangeListener:this.onTagFilterChange.bind(this),addTagCreationListener:this.onCreationTag.bind(this),addTagDeletionListener:this.onDeletionTag.bind(this),addUnfocusSubjectsListener:this.onUnfocusSubjects.bind(this)}};this.taggerProxy=c.createProxy(e)},onTagFilterChange:function(g){var f=this;var h=this.model.get("preferencesModel");h.set("sixwtags",g.allfilters);this.model.dispatchEvent("applyPreference")},onCreationTag:function(f){d.log(f)},onDeletionTag:function(f){d.log(f)},onUnfocusSubjects:function(f){d.log(f)}});return a});define("DS/QKMQualityMetrics/model/abstract/Collection_Abstract",["UWA/Core","UWA/Class/Collection","DS/WAFData/WAFData","DS/QKMQualityMetrics/model/abstract/Model_Abstract"],function(e,c,a,d){var b=c.extend({model:d,init:function(f){this._parent([],f);this.baseUrl=f.url;this.url=this.wsPath.format(this.baseUrl)},sync:function(j,h,g){j="create";var i={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};var f=i[j];if(!g.data){g.data=JSON.stringify(this.data)}else{g.data=JSON.stringify(g.data)}return this._parent(j,h,e.merge({ajax:a.authenticatedRequest,method:f,type:"json",headers:{"Content-Type":"application/json",Accept:"application/json"}},g))},parse:function(g){var f=[];if(g.facets){this.facets=g.facets}if(g.results){f=g.results.map(function(k,h){var j={};k.attributes.forEach(function(l,m){if(l.name){var i=l.value;if(!isNaN(i)){i=parseInt(i)}else{if(!!Date.parse(i)){i=Date.parse(i)}}if(!j.hasOwnProperty(l.name)){j[l.name]=i}else{if(!Array.isArray(j[l.name])){j[l.name]=[j[l.name]]}j[l.name].push(i)}}});return j})}return this.parseCusto(f)},parseCusto:function(f){return f}});return b});define("DS/QKMQualityMetrics/model/collections/HistoryCollection",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/QKMQualityMetrics/model/abstract/Collection_Abstract"],function(d,c,b){var a=b.extend({init:function(e){this.wsPath="{0}/search/";this.preferencesModel=e.preferencesModel;this.contextCollection=e.contextCollection;this._parent(e)},setup:function(){this.data={with_indexing_date:true,query:"(type:PLMAssessmentResultRepReference)",refine:{},order_field:"ds6w:modified",order_by:"asc",select_predicate:["bo.plmassessmentresultrepreference.contextphysicalid","bo.plmassessmentresultrepreference.contextname","bo.plmassessmentresultrepreference.profilephysicalid","bo.plmassessmentresultrepreference.profilename","originated","bo.plmassessmentresultrepreference.v_computedassessmentquality"],nresults:100,start:"0",locale:"en",tenant:this.tenant,label:"QKMHistoryCollection"}},parseCusto:function(f){var e=Math.max.apply(null,f.map(function(g){return g["bo.plmassessmentresultrepreference.v_computedassessmentquality"]}));e=e<1000?1000:e;this.max=e;return f},getProfileNames:function(){var i=this.groupBy("bo.plmassessmentresultrepreference.profilephysicalid");var h=Object.keys(i).length;var f=h!==0?[]:"";for(var g in i){var e=i[g].length;if(h!==0){f.push(i[g][e-1].get("bo.plmassessmentresultrepreference.profilename"))}else{f=i[0][e-1].get("bo.plmassessmentresultrepreference.profilename")}}return f},getContextNames:function(){var i=this.groupBy("bo.plmassessmentresultrepreference.contextphysicalid");var h=Object.keys(i).length;var f=h!==0?[]:"";for(var g in i){var e=i[g].length;if(h!==0){f.push(i[g][e-1].get("bo.plmassessmentresultrepreference.contextname"))}else{f=i[0][e-1].get("bo.plmassessmentresultrepreference.contextname")}}return f},convertFromModelToLineChart:function(j){var h=null;if(j==="product"){h="profile"}if(j==="profile"){h="context"}var i=this.groupBy("bo.plmassessmentresultrepreference.{0}physicalid".format(h));var f=[];for(var g in i){var e=i[g].length;f.push({name:i[g][e-1].get("bo.plmassessmentresultrepreference.{0}name".format(h)),data:i[g].map(function(k){return[k.get("originated"),k.get("bo.plmassessmentresultrepreference.v_computedassessmentquality")]})})}return f}});return a});define("DS/QKMQualityMetrics/view/subviews/HistoryView",["UWA/Core","UWA/Class/View","DS/3DXHighcharts/3DXHighcharts","DS/QKMQualityMetrics/view/controls/popup/Popup","DS/UIKIT/Mask","i18n!DS/QKMQualityMetrics/assets/nls/QKMQualityMetrics","DS/UIKIT/Alert"],function(h,g,c,d,f,e,b){var a=g.extend({setup:function(){this.listenTo(this.collection,"onRequest",this.onRequest);this.listenTo(this.collection,"onSync",this.onSync);this.listenTo(this.collection,"onError",this.onSyncError);var j=this.options.profile;var i=this.options.context;if(Array.isArray(this.options.profile)){j=j.join(" OR ")}if(Array.isArray(this.options.context)){i=i.join(" OR ")}if(this.collection.isEmpty()){var k=h.clone(this.collection.data);k.query+=" bo_46_plmassessmentresultrepreference_46_profilephysicalid:({0}) bo_46_plmassessmentresultrepreference_46_contextphysicalid:({1})".format(j,i);this.collection.fetch({data:k})}},onPostInject:function(){if(!this.collection.isEmpty()){f.unmask(this.elements.popup.elements.container2);this.renderLinechart()}},onRequest:function(k,i,j){h.log("onRequest")},onSync:function(k,i,j){h.log("onSync");f.unmask(this.elements.popup.elements.container2);this.renderLinechart()},onSyncError:function(l,j,k){f.unmask(this.elements.popup.elements.container2);var i="error";if(h.is(j,"string")){i=j}if(h.is(j,"object")){i=JSON.stringify(j)}f.unmask(this.container);this.elements.alert.add({className:"error",message:i})},renderLinechart:function(){this.elements.popup.elements.container2.empty();var m=this.collection.convertFromModelToLineChart(this.options.mode);var n=this.collection.getContextNames();var l=this.collection.getProfileNames();var j=(this.options.mode==="product"?"{2} : {0}  |  {3}: {1}":"{3}: {1}  |  {2}: {0}").format(n,l,e.get("NLS_PRODUCT"),e.get("NLS_PROFILE"));var i={credits:{enabled:false},exporting:{enabled:false},chart:{renderTo:this.elements.popup.elements.container2},title:{text:e.get("NLS_QUALITY_HISTOY"),},subtitle:{text:j,},xAxis:{type:"datetime",},yAxis:{title:{text:e.get("NLS_QUALITY_LEVEL"),},min:0,max:this.options.max},tooltip:{pointFormat:e.get("NLS_QUALITY_LEVEL")+" : {point.y}"},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:m};var k=new c.Chart(i)},render:function(){this.elements.popup=new d().render().inject(this.container);this.listenTo(this.elements.popup,"onClosePopup",function(){this.destroy()});this.elements.alert=new b({closable:true,visible:true,autoHide:true,hideDelay:5000,maximumVisibleMessages:8,}).inject(this.elements.popup.elements.container2,"top");f.mask(this.elements.popup.elements.container2);this.elements.alert.elements.container.setStyle("visibility","visible");return this},destroy:function(){this.stopListening();this.model=null;try{this._parent()}catch(i){}}});return a});define("DS/QKMQualityMetrics/model/models/PreferencesModel",["UWA/Core","DS/QKMQualityMetrics/model/abstract/Model_Abstract","DS/QKMQualityMetrics/model/collections/PreferencePidCollection"],function(d,c,b){var a=c.extend({setup:function(e){this.initVars()},initVars:function(){this.set({globalMode:"product",treeMode:"product",treeProducts:[],treeProfiles:[],treeChecks:[],qualityRangeMode:"ALL",qualityRange:null,qualityCalculationMode:"Sum",sixwtags:[],pidCollection:new b()})}});return a});define("DS/QKMQualityMetrics/model/collections/ContextCollection",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/QKMQualityMetrics/model/abstract/Collection_Abstract"],function(d,c,b){var a=b.extend({init:function(e){this.wsPath="{0}/search/";this.preferencesModel=e.preferencesModel;this.listenTo(e.preferencesModel.get("pidCollection"),"onAdd",this.onChangePreferencePidCollection);this.listenTo(e.preferencesModel.get("pidCollection"),"onRemove",this.onChangePreferencePidCollection);this._parent(e)},onChangePreferencePidCollection:function(){var e=this.preferencesModel.get("pidCollection").pluck("objectId").join(" OR ");this.data.query="physicalid:({0})".format(e)},parseCusto:function(e){return e.map(function(f){f.type_icon_url=f.type_icon_url.replace("/small/I_VPMNavProduct.png","/large/I_VPMNavProduct108x144.png");return f})},setup:function(){this.data={with_indexing_date:true,query:"",refine:{},order_field:"ds6w:modified",order_by:"asc",nresults:100,start:"0",locale:"en",tenant:this.tenant,label:"QKMContextCollection"}}});return a});define("DS/QKMQualityMetrics/model/collections/AssessmentsResultsCollection",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/QKMQualityMetrics/model/abstract/Collection_Abstract","UWA/Class/Promise","i18n!DS/QKMQualityMetrics/assets/nls/QKMQualityMetrics"],function(f,d,c,b,e){var a=c.extend({init:function(g){this.wsPath="{0}/search/";this.preferencesModel=g.preferencesModel;this.contextCollection=g.contextCollection;this._parent(g)},setup:function(){this.rangeTab=[];this.data={with_indexing_date:true,query:"(type:PLMAssessmentResultRepReference) bo_46_plmassessmentresultrepreference_46_islastbyprofileandcontext:True",refine:{},order_field:"ds6w:modified",order_by:"asc",select_predicate:["bo.plmassessmentresultrepreference.profilephysicalid","bo.plmassessmentresultrepreference.contextphysicalid","originated","bo.plmassessmentresultrepreference.v_computedassessmentquality","bo.plmassessmentresultrepreference.qualityvariationbyprofileandcontext","bo.plmassessmentresultrepreference.profilename","bo.plmassessmentresultrepreference.checkname","bo.plmassessmentresultrepreference.checkweight","bo.plmassessmentresultrepreference.qualityrangename","bo.plmassessmentresultrepreference.qualityrangemax","bo.plmassessmentresultrepreference.qualityrangemin","bo.plmassessmentresultrepreference.qualityrangeicon",],nresults:100,start:"0",locale:"en",tenant:this.tenant,label:"QKMAssesmentResultCollection"}},fetch:function(g){var h=this;var j=new b(function(m,l){var k={onComplete:m,onFailure:l};h.contextCollection.fetch(k)});var i=new b(function(m,l){var k={onComplete:m,onFailure:l};if(g){k.data=g.data}h._parent(k)});b.all([j,i]).then(function(k){h.map(function(m){var l=h.contextCollection.get(m.get("bo.plmassessmentresultrepreference.contextphysicalid"));m.set({"bo.plmassessmentresultrepreference.contextname":l.get("ds6w:label"),"bo.plmassessmentresultrepreference.contextowner":l.get("ds6w:who/ds6w:responsible"),"bo.plmassessmentresultrepreference.contextownerfullname":l.get("ds6w:who/ds6w:responsible"),"bo.plmassessmentresultrepreference.contextIcon":l.get("type_icon_url")});return m});if(g.onComplete){g.onComplete([h,h,g])}return h.dispatchEvent("onSyncFetchCusto",[h,h,g])},function(k){g.onFailure(k)})},parseCusto:function(j){var i=this;var h=j.map(function(n,l){var k=n["bo.plmassessmentresultrepreference.qualityrangename"].map(function(o,p){return{Max:n["bo.plmassessmentresultrepreference.qualityrangemax"][p],Min:n["bo.plmassessmentresultrepreference.qualityrangemin"][p],Icon:n["bo.plmassessmentresultrepreference.qualityrangeicon"][p],Name:o}});i.rangeTab=k;delete n["bo.plmassessmentresultrepreference.qualityrangename"];delete n["bo.plmassessmentresultrepreference.qualityrangemax"];delete n["bo.plmassessmentresultrepreference.qualityrangemin"];delete n["bo.plmassessmentresultrepreference.qualityrangeicon"];if(!Array.isArray(n["bo.plmassessmentresultrepreference.checkname"])){n["bo.plmassessmentresultrepreference.checkname"]=[n["bo.plmassessmentresultrepreference.checkname"]];n["bo.plmassessmentresultrepreference.checkweight"]=[n["bo.plmassessmentresultrepreference.checkweight"]]}else{if(!Array.isArray(n["bo.plmassessmentresultrepreference.checkweight"])){n["bo.plmassessmentresultrepreference.checkweight"]=n["bo.plmassessmentresultrepreference.checkname"].map(function(){return n["bo.plmassessmentresultrepreference.checkweight"]})}}n.checks=n["bo.plmassessmentresultrepreference.checkname"].map(function(p,o){var q=n["bo.plmassessmentresultrepreference.checkweight"][o];return{name:p,weight:q,state:(function(){var r="";k.forEach(function(t,s){if(q>=t.Min&&q<=t.Max){r=s}});return r})()}});delete n["bo.plmassessmentresultrepreference.checkname"];delete n["bo.plmassessmentresultrepreference.checkweight"];var m="";k.forEach(function(p,o){if(n["bo.plmassessmentresultrepreference.v_computedassessmentquality"]>=p.Min&&n["bo.plmassessmentresultrepreference.v_computedassessmentquality"]<=p.Max){m=o}});n.state=m;return n});var g=Math.max.apply(null,j.map(function(k){return k["bo.plmassessmentresultrepreference.v_computedassessmentquality"]}));g=g<1000?1000:g;this.max=g;return h},convertFromModelToTreeFilterView:function(){var g=[];if(this.profileList){g=this.profileList.map(function(k,j){return{label:k.name,value:k.id}})}var h=[];if(this.checkList){h=this.checkList.map(function(k,j){return{label:k.name,value:k.id}})}return{profiles:g,checks:h}},convertFromModelToTreeListView:function(){var h=this.preferencesModel;var g=[];if(h.get("treeMode")==="product"){g=this.byProductTreeListViewAdapter()}if(h.get("treeMode")==="profile"){g=this.byProfileTreeListViewAdapter()}return g},saveProfileAndCheckList:function(){if(!this.isEmpty()&&!this.profileList){this.profileList=[];var g={};g=this.groupBy("bo.plmassessmentresultrepreference.profilephysicalid");for(var h in g){this.profileList.push({name:g[h][0].get("bo.plmassessmentresultrepreference.profilename"),id:g[h][0].get("bo.plmassessmentresultrepreference.profilephysicalid")})}}if(!this.isEmpty()&&!this.checkList){this.checkList=[];var i=[];i=this.pluck("checks").map(function(l,k){var j=[];j=l.map(function(m,n){return m.name});return j});i=i.reduce(function(k,j){return k.concat(j)});i=i.filter(function(j,k){return i.indexOf(j)===k});i=i.map(function(j,k){return{name:j,id:j}});this.checkList=i}},byProductTreeListViewAdapter:function(){var o=this;this.saveProfileAndCheckList();var s=this.preferencesModel;var k=this.contextCollection;var l=this.toJSON();var n=new f.Class.Collection(this.sortBy("originated"));var m=n.groupBy("bo.plmassessmentresultrepreference.contextphysicalid");var r=Object.keys(m).map(function(w){var y=new f.Class.Collection(m[w]);var v=y.groupBy("bo.plmassessmentresultrepreference.profilename");Object.keys(v).map(function(D){var C=new f.Class.Collection(v[D]);if(C.length>1){C.sortBy("originated");while(y.length>1){y.remove(C.first());C.remove(C.first())}}});var A=y.sortBy("bo.plmassessmentresultrepreference.v_computedassessmentquality");A=A.reverse();var B=A.map(function(C){return C.get("bo.plmassessmentresultrepreference.v_computedassessmentquality")});B=B.filter(function(C){return typeof C==="number"});var x=A.map(function(C){return C.get("bo.plmassessmentresultrepreference.qualityvariationbyprofileandcontext")});x=x.filter(function(C){return typeof C==="number"});x=x.reduce(function(D,C){return D+C},0);switch(s.get("qualityCalculationMode")){case"Sum":B=B.reduce(function(D,C){return D+C},0);break;case"Average":B=B.reduce(function(D,C){return D+C},0)/B.length;break;case"Min":B=Math.min.apply(Math,B);break;case"Max":B=Math.max.apply(Math,B);break;default:B=B.reduce(function(D,C){return D+C},0)}var z={id:y.last().get("bo.plmassessmentresultrepreference.contextphysicalid"),name:y.last().get("bo.plmassessmentresultrepreference.contextname"),icon:y.last().get("bo.plmassessmentresultrepreference.contextIcon"),quality:B,state:"4",responsible:{id:y.last().get("bo.plmassessmentresultrepreference.contextowner"),fullName:y.last().get("bo.plmassessmentresultrepreference.contextownerfullname")},lastexecution:y.last().get("originated"),history:{mode:s.get("treeMode"),context:y.last().get("bo.plmassessmentresultrepreference.contextphysicalid"),profile:y.map(function(C){return C.get("bo.plmassessmentresultrepreference.profilephysicalid")})},variation:x};return{id:z.id,label:z.name,icons:[z.icon],data:z,grid:{quality:z.quality,responsible:z.responsible.fullName,lastexecution:z.lastexecution,history:true,trend:z.variation},children:A.map(function(E){var C=new f.Class.Collection(E.get("checks"));var D=C.sortBy(function(G){return parseInt(G.get("weight"))}).reverse();var F={id:E.get("bo.plmassessmentresultrepreference.profilephysicalid"),name:E.get("bo.plmassessmentresultrepreference.profilename"),quality:E.get("bo.plmassessmentresultrepreference.v_computedassessmentquality"),state:E.get("state"),lastexecution:E.get("originated"),history:{mode:s.get("treeMode"),context:E.get("bo.plmassessmentresultrepreference.contextphysicalid"),profile:E.get("bo.plmassessmentresultrepreference.profilephysicalid")},variation:E.get("bo.plmassessmentresultrepreference.qualityvariationbyprofileandcontext")};return{id:F.id,label:F.name,icons:[d.getWebappsAssetUrl("QKMQualityMetrics","profile.png")],data:F,grid:{quality:F.quality,responsible:undefined,history:true,lastexecution:F.lastexecution,trend:F.variation},children:D.map(function(G){var H={id:G.get("name"),name:G.get("name"),quality:G.get("weight"),state:G.get("state"),};return{label:H.name,icons:[d.getWebappsAssetUrl("QKMQualityMetrics","check.png")],data:H,grid:{quality:H.quality,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}}})}})}});var t=s.get("pidCollection");var j=s.get("treeProducts");var u=s.get("treeProfiles");var g=s.get("treeChecks");if(t){var q=[];q=t.filter(function(v){return this.pluck("bo.plmassessmentresultrepreference.contextphysicalid").indexOf(v.get("objectId"))<0}.bind(this));if(j.length>0){q=q.filter(function(v){return j.indexOf(v.get("objectId"))>=0}.bind(this))}if(q.length>0){q.forEach(function(x,w){var v=k.get(x.get("objectId"));if(v){r.push({id:v.get("resourceid"),label:v.get("ds6w:label")+e.get("NLS_NO_RESULTS_FOUND"),icons:[v.get("type_icon_url")],noResultFound:true,grid:{quality:undefined,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}})}})}}if(this.profileList){var q=[];r=r.map(function(v){if(v.children){q=o.profileList.filter(function(w){return v.children.map(function(x){return x.id}).indexOf(w.id)<0});if(u.length>0){q=q.filter(function(w){return u.indexOf(w.id)>=0}.bind(this))}q.forEach(function(w){v.children.push({id:w.id,label:w.name+e.get("NLS_NO_RESULTS_FOUND"),icons:[d.getWebappsAssetUrl("QKMQualityMetrics","profile.png")],noResultFound:true,grid:{quality:undefined,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}})})}return v})}var i=s.get("qualityRange");if(i){var p=[];var h=[];r.forEach(function(w,v){if(w.data&&w.data.quality>=i[0]&&w.data.quality<=i[1]){p.push(w)}else{h.push({id:w.data.id,label:w.data.name+e.get("NLS_NO_RESULTS_FOUND"),icons:[w.data.icon],noResultFound:true,grid:{quality:undefined,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}})}});r=p.concat(h)}return r},byProfileTreeListViewAdapter:function(){var n=this;var s=this.preferencesModel;var k=this.contextCollection;var l=this.toJSON();var m=new f.Class.Collection(this.sortBy("originated"));var r=m.groupBy("bo.plmassessmentresultrepreference.profilephysicalid");var q=Object.keys(r).map(function(v){var x=new f.Class.Collection(r[v]);var z=x.sortBy("bo.plmassessmentresultrepreference.v_computedassessmentquality");z=z.reverse();var A=z.map(function(B){return B.get("bo.plmassessmentresultrepreference.v_computedassessmentquality")});A=A.filter(function(B){return typeof B==="number"});var w=z.map(function(B){return B.get("bo.plmassessmentresultrepreference.qualityvariationbyprofileandcontext")});w=w.filter(function(B){return typeof B==="number"});w=w.reduce(function(C,B){return C+B},0);switch(s.get("qualityCalculationMode")){case"Sum":A=A.reduce(function(C,B){return C+B},0);break;case"Average":A=A.reduce(function(C,B){return C+B},0)/A.length;break;case"Min":A=Math.min.apply(Math,A);break;case"Max":A=Math.max.apply(Math,A);break;default:A=A.reduce(function(C,B){return C+B},0)}var y={id:x.last().get("bo.plmassessmentresultrepreference.profilephysicalid"),name:x.last().get("bo.plmassessmentresultrepreference.profilename"),quality:A,state:"4",lastexecution:x.last().get("originated"),history:{mode:s.get("treeMode"),profile:x.last().get("bo.plmassessmentresultrepreference.profilephysicalid"),context:x.map(function(B){return B.get("bo.plmassessmentresultrepreference.contextphysicalid")})},variation:w};return{id:y.id,label:y.name,icons:[d.getWebappsAssetUrl("QKMQualityMetrics","profile.png")],data:y,grid:{quality:y.quality,responsible:undefined,lastexecution:y.lastexecution,history:true,trend:y.variation},children:z.map(function(D){var B=new f.Class.Collection(D.get("checks"));var C=B.sortBy(function(F){return parseInt(F.get("weight"))}).reverse();var E={id:D.get("bo.plmassessmentresultrepreference.contextphysicalid"),name:D.get("bo.plmassessmentresultrepreference.contextname"),icon:D.get("bo.plmassessmentresultrepreference.contextIcon"),quality:D.get("bo.plmassessmentresultrepreference.v_computedassessmentquality"),state:D.get("state"),responsible:{id:D.get("bo.plmassessmentresultrepreference.contextowner"),fullName:D.get("bo.plmassessmentresultrepreference.contextownerfullname")},lastexecution:D.get("originated"),history:{mode:s.get("treeMode"),context:D.get("bo.plmassessmentresultrepreference.contextphysicalid"),profile:D.get("bo.plmassessmentresultrepreference.profilephysicalid")},variation:D.get("bo.plmassessmentresultrepreference.qualityvariationbyprofileandcontext")};return{id:E.id,label:E.name,icons:[E.icon],data:E,grid:{quality:E.quality,responsible:E.responsible.fullName,lastexecution:E.lastexecution,history:true,trend:E.variation},children:C.map(function(F){var G={id:F.get("name"),name:F.get("name"),quality:F.get("weight"),state:F.get("state"),};return{label:G.name,icons:[d.getWebappsAssetUrl("QKMQualityMetrics","check.png")],data:G,grid:{quality:G.quality,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}}})}})}});var t=s.get("pidCollection");var j=s.get("treeProducts");var u=s.get("treeProfiles");var g=s.get("treeChecks");if(this.profileList){var p=[];if(q.length===0){p=n.profileList}else{q.forEach(function(v){p=n.profileList.filter(function(w){return q.map(function(x){return x.id}).indexOf(w.id)<0})})}if(u.length>0){p=p.filter(function(v){return u.indexOf(v.id)>=0}.bind(this))}p.forEach(function(v){q.push({id:v.id,label:v.name+e.get("NLS_NO_RESULTS_FOUND"),icons:[d.getWebappsAssetUrl("QKMQualityMetrics","profile.png")],noResultFound:true,grid:{quality:undefined,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}})})}if(t&&!this.isEmpty()){var p=[];q=q.map(function(v){if(v.children){p=t.filter(function(w){return v.children.map(function(x){return x.id}).indexOf(w.get("objectId"))<0}.bind(this));if(j.length>0){p=p.filter(function(w){return j.indexOf(w.get("objectId"))>=0}.bind(this))}if(p.length>0){p.forEach(function(x){var w=k.get(x.get("objectId"));if(w){v.children.push({id:w.get("resourceid"),label:w.get("ds6w:label")+e.get("NLS_NO_RESULTS_FOUND"),icons:[w.get("type_icon_url")],noResultFound:true,grid:{quality:undefined,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}})}})}}return v})}var i=s.get("qualityRange");if(i){var o=[];var h=[];q.forEach(function(w,v){if(w.data&&w.data.quality>=i[0]&&w.data.quality<=i[1]){o.push(w)}else{h.push({id:w.label,label:w.label+e.get("NLS_NO_RESULTS_FOUND"),icons:[d.getWebappsAssetUrl("QKMQualityMetrics","profile.png")],noResultFound:true,grid:{quality:undefined,responsible:undefined,lastexecution:undefined,history:undefined,trend:undefined}})}});q=o.concat(h)}return q}});return a});define("DS/QKMQualityMetrics/model/QKMQualityMetricsModel",["UWA/Core","UWA/Class/Collection","UWA/Class/Promise","UWA/Class/Model","UWA/Class/Options","DS/QKMQualityMetrics/model/collections/AssessmentsResultsCollection","DS/QKMQualityMetrics/model/models/PreferencesModel","DS/QKMQualityMetrics/model/collections/ContextCollection","DS/QKMQualityMetrics/model/collections/HistoryCollection"],function(e,f,h,b,i,a,d,g,c){var j=b.extend(i,{init:function(k){this.setOptions(k);this._parent()},initVars:function(){this.set({WsBaseUrl:this.options.serverBaseUrl,preferencesModel:new d(),searchString:null});this.set({contextCollection:new g({url:this.get("WsBaseUrl"),preferencesModel:this.get("preferencesModel")})});this.set({assessmentsResultsCollection:new a({url:this.get("WsBaseUrl"),preferencesModel:this.get("preferencesModel"),contextCollection:this.get("contextCollection")})})},onChangeSearchString:function(){this.onApplyPreference()},onChangePreferencePidCollection:function(){var k=this.get("preferencesModel").get("pidCollection");widget.setValue("preferencePidCollection",k.toJSON());var m=k.pluck("objectId").join(" OR ");if(!k.isEmpty()){var l=e.clone(this.get("assessmentsResultsCollection").data);l.query+=" (bo_46_plmassessmentresultrepreference_46_contextphysicalid:{0})".format(m);this.get("assessmentsResultsCollection").fetch({data:l})}else{this.get("assessmentsResultsCollection").set([]);this.get("assessmentsResultsCollection").dispatchEvent("onSyncFetchCusto",[[]])}},onApplyPreference:function(){widget.setTitle("");var p=this.get("searchString");var r=this.get("preferencesModel");var n=e.clone(this.get("assessmentsResultsCollection").data);var t=e.clone(r.get("sixwtags"));var q=[];if(t){Object.keys(t).forEach(function(v,u){t[v].forEach(function(w,x){q.push(w.disptext)})})}if(q.length!==0){q=q.join(",");widget.setTitle(widget.getTitle()+" 6wtags : {0} -".format(q))}n.refine=t;var m=e.clone(r.get("treeProducts"));if(m.length!==0){var q=r.get("pidCollection");q=q.filter(function(v,u){return m.indexOf(v.get("objectId"))>=0});q=q.map(function(u){return u.get("displayName")}).join(",");widget.setTitle("Products : {0} -".format(q));n.query+=" (bo_46_plmassessmentresultrepreference_46_contextphysicalid:{0})".format(m.join(" OR "))}else{var s=e.clone(r.get("pidCollection").pluck("objectId"));n.query+=" (bo_46_plmassessmentresultrepreference_46_contextphysicalid:{0})".format(s.join(" OR "))}var o=e.clone(r.get("treeProfiles"));if(o.length!==0){var q=this.get("assessmentsResultsCollection").profileList;q=q.filter(function(v,u){return o.indexOf(v.id)>=0});q=q.map(function(u){return u.name}).join(",");widget.setTitle(widget.getTitle()+" Profiles : {0} -".format(q));n.query+=" (bo_46_plmassessmentresultrepreference_46_profilephysicalid:{0})".format(o.join(" OR "))}var k=e.clone(r.get("treeChecks"));if(k.length!==0){var q=this.get("assessmentsResultsCollection").checkList;q=q.filter(function(v,u){return k.indexOf(v.id)>=0});q=q.map(function(u){return u.name}).join(",");widget.setTitle(widget.getTitle()+" Checks : {0} -".format(q));n.query+=" ({0})".format(k.join(" OR "))}if(p){widget.setTitle(widget.getTitle()+" Search : {0} -".format(p));n.query+=" ({0})".format(p)}var l=r.get("qualityRange");if(l){widget.setTitle(widget.getTitle()+" Weight between {0} and {1} -".format(l[0],l[1]))}this.get("assessmentsResultsCollection").fetch({data:n})},attachEvents:function(){this.listenTo(this,"onAnyEvent",function(l){if(l==="onChange:searchString"){this.onChangeSearchString()}}.bind(this));this.listenTo(this,"applyPreference",this.onApplyPreference);this.listenTo(this.get("assessmentsResultsCollection"),"onRequest",this.onRequest);this.listenTo(this.get("assessmentsResultsCollection"),"onSyncFetchCusto",this.onSync);this.listenTo(this.get("assessmentsResultsCollection"),"onError",this.onError);var k=this.get("preferencesModel").get("pidCollection");this.listenTo(k,"onAdd",this.onChangePreferencePidCollection);this.listenTo(k,"onRemove",this.onChangePreferencePidCollection)},setup:function(){this.initVars();this.attachEvents();if(widget.getValue("preferencePidCollection")){var k=this.get("preferencesModel").get("pidCollection");k.add(widget.getValue("preferencePidCollection"),{silent:true});k.dispatchEvent("onAdd")}},onRequest:function(m,k,l){this.dispatchEvent("onRequestModel",[m,k,l])},onSync:function(m,k,l){this.dispatchEvent("onSyncModel",[m,k,l])},onError:function(m,k,l){this.dispatchEvent("onSyncErrorModel",[m,k,l])}});return j});define("DS/QKMQualityMetrics/view/subviews/QualityFilterView",["UWA/Core","UWA/Class/View","DS/UIKIT/Form","DS/UIKIT/Popover","DS/QKMQualityMetrics/view/controls/rangeslider/RangeSlider","DS/UIKIT/Input/Toggle","i18n!DS/QKMQualityMetrics/assets/nls/QKMQualityMetrics"],function(h,f,b,d,a,g,e){var c=f.extend({setup:function(){},render:function(){var o=this;var p=this.options.target;this.elements.popover=new d({target:p,position:"bottom",body:this.container,title:e.get("NLS_DEFECT_FILTERS"),offset:{y:-12,x:3}});var i=null;p.addEventListener("mouseenter",function(u){if(i){clearTimeout(i)}h.log("show");o.elements.popover.show()});this.container.addEventListener("mouseenter",function(u){if(i){clearTimeout(i)}h.log("show");o.elements.popover.show()});this.container.addEventListener("mouseleave",function(u){i=setTimeout(function(){h.log("hide");o.elements.popover.hide()}.bind(this),1000)});p.addEventListener("mouseleave",function(u){i=setTimeout(function(){h.log("hide");o.elements.popover.hide()}.bind(this),1000)});this.elements.popover.getContent().style.maxWidth="600px";this.container.setStyles({width:"570px",height:"100%",});var q='<div class="row">   <div class="col-xs-3">'+"		<label>{0}</label>".format(e.get("NLS_DEFECT_RANGE"))+'	</div>   <div class="col-xs-9"></div></div><div class="row">   <div class="col-xs-12">'+"		<label>{0}</label>".format(e.get("NLS_DEFECT_MODE"))+'	</div></div><div class="row">    <div class="col-xs-4 col-xs-offset-8">'+'        <button type="button" style="float: right" class="btn btn-primary">{0}</button>'.format(e.get("NLS_FILTER"))+"    </div></div>";this.container.setContent(q);this.elements.formContainer=this.container.getElement(".col-xs-3");this.elements.formContainer2=this.container.getElement(".col-xs-12");this.elements.sliderContainer=this.container.getElement(".col-xs-9");this.elements.applyButton=this.container.getElement(".btn");var l=this.model.get("preferencesModel");var j=new b({fields:[{name:"radio1",type:"radio",className:"primary",value:"ALL",label:e.get("NLS_ALL"),checked:true},{name:"radio1",type:"radio",className:"primary",value:"Custom",label:e.get("NLS_CUSTOM")}],events:{onChange:function(v,w){l.set("qualityRangeMode",this.getValue(v));if(this.getValue(v)==="ALL"){o.elements.rangeSlider.disable();var u=o.model.get("assessmentsResultsCollection").max;o.elements.rangeSlider.changeValue(0,u);l.set("qualityRange",null)}if(this.getValue(v)==="Custom"){o.elements.rangeSlider.enable()}}}});j.inject(this.elements.formContainer);var t=l.get("qualityRangeMode");if(t){j.booleans.forEach(function(u){if(u.getValue()===t){u.check()}else{u.uncheck()}})}var s=new b({className:"inline",fields:[{name:"radio2",type:"radio",className:"primary",value:"Sum",label:e.get("NLS_SUM"),checked:true},{name:"radio2",type:"radio",className:"primary",value:"Average",label:e.get("NLS_AVERAGE"),},{name:"radio2",type:"radio",className:"primary",value:"Min",label:e.get("NLS_MIN"),},{name:"radio2",type:"radio",className:"primary",value:"Max",label:e.get("NLS_MAX"),}],events:{onChange:function(u){l.set("qualityCalculationMode",this.getValue(u))}}});s.inject(this.elements.formContainer2);var n=l.get("qualityCalculationMode");if(n){s.booleans.forEach(function(u){if(u.getValue()===n){u.check()}else{u.uncheck()}})}this.elements.rangeSlider=new a({max:this.model.get("assessmentsResultsCollection").max});this.elements.rangeSlider.render().inject(this.elements.sliderContainer);if(l.get("qualityRangeMode")!=="Custom"){this.elements.rangeSlider.disable()}this.elements.rangeSlider.addEvent("change",function(u){l.set("qualityRange",u)});var k=l.get("qualityRange");if(k){var m=k[0];var r=k[1];this.elements.rangeSlider.changeValue(m,r)}this.elements.applyButton.addEvent("click",this.onApply.bind(this));return this},onApply:function(){this.elements.popover.hide();this.model.dispatchEvent("applyPreference")},destroy:function(){this.stopListening();this.model=null;try{this._parent()}catch(i){}}});return c});define("DS/QKMQualityMetrics/view/QKMQualityMetricsView",["UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/Core/Core","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Input/Button","DS/3DXHighcharts/3DXHighcharts","DS/UIKIT/Input/Select","DS/UIKIT/Popover","DS/Windows/Dialog","DS/QKMQualityMetrics/view/controls/popup/Popup","DS/QKMQualityMetrics/view/subviews/QualityFilterView","DS/QKMQualityMetrics/view/subviews/TreeFilterView","DS/QKMQualityMetrics/view/subviews/HistoryView","DS/QKMQualityMetrics/model/collections/HistoryCollection","i18n!DS/QKMQualityMetrics/assets/nls/QKMQualityMetrics"],function(f,r,k,u,b,j,n,s,c,m,a,p,t,i,h,o,d,q,l,e){var g=r.extend({setup:function(){this.listenTo(this.model,"modelLoaded",this.onModelLoaded);this.listenTo(this.model,"onSyncModel",this.onSync);this.listenTo(this.model,"onSyncErrorModel",this.onSyncError);this.listenTo(this.model.get("assessmentsResultsCollection"),"onRequest",this.onRequest);this.listenTo(widget,"onSearch",this.onSearch);this.listenTo(widget,"onResetSearch",this.onResetSearch)},onSearch:function(v){this.model.set("searchString",v)},onResetSearch:function(v){this.model.set("searchString","")},onRequest:function(x,v,w){u.mask(this.container)},onSync:function(x,v,w){u.unmask(this.container);this.renderTreeListView()},onSyncError:function(y,w,x){var v="error";if(f.is(w,"string")){v=w}if(f.is(w,"object")){v=JSON.stringify(w)}u.unmask(this.container);this.elements.alert.add({className:"error",message:v})},onModelLoaded:function(){},render:function(){this.container.setStyles({width:"100%",height:"100%"});this.elements.alert=new k({closable:true,visible:true,autoHide:true,hideDelay:5000,maximumVisibleMessages:8}).inject(widget.body,"top");this.renderTreeListView();return this},onPostInject:function(){if(!this.model.get("preferencesModel").get("pidCollection").isEmpty()){this.onRequest()}},renderTreeListView:function(){var A=this;var B=A.model.get("preferencesModel");var y=this.model.get("assessmentsResultsCollection").convertFromModelToTreeListView();var x='<div class="row">    <div class="col-xs-12"></div></div><div class="row">    <div class="col-xs-12"></div></div>';this.container.setContent(x);var v=this.container.getElement("div.row:nth-child(1) > div.col-xs-12");var z=this.container.getElement("div.row:nth-child(2) > div.col-xs-12");var C=this.model.get("assessmentsResultsCollection").max;var E={columns:[{text:e.get("NLS_TREE"),dataIndex:"tree",width:"30%"},{text:e.get("NLS_DEFECT"),dataIndex:"quality",width:"auto"},{text:e.get("NLS_RESPONSIBLE"),dataIndex:"responsible",width:"auto"},{text:e.get("NLS_LAST_EXECUTION"),dataIndex:"lastexecution",width:"auto"},{text:e.get("NLS_TREND"),dataIndex:"trend",width:120},{text:e.get("NLS_HISTORY"),dataIndex:"history",width:140}],roots:y,apiVersion:2,show:{rowHeaders:false,columnHeaders:true},resize:{columns:true,rows:false},defaultCellHeight:50,height:widget.getViewportDimensions().height,onDropBlank:function(J,I){var H=JSON.parse(J.dataTransfer.getData("Text"));var G=H.data.items;var F=A.model.get("preferencesModel").get("pidCollection");F.add(G,{silent:true});F.dispatchEvent("onAdd")},onDropColumnHeader:function(J,I){var H=JSON.parse(J.dataTransfer.getData("Text"));var G=H.data.items;var F=A.model.get("preferencesModel").get("pidCollection");F.add(G,{silent:true});F.dispatchEvent("onAdd")},onDropCell:function(J,I){var H=JSON.parse(J.dataTransfer.getData("Text"));var G=H.data.items;var F=A.model.get("preferencesModel").get("pidCollection");F.add(G,{silent:true});F.dispatchEvent("onAdd")},selection:{toggle:false}};E.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:40});E.onContextualMenuReady=function(G){var F=[];if(G.nodeModel){var I=this.getVirtualCoordinates();if(I.virtualRowID!==-1){var H=null;if(B.get("treeMode")==="product"){H=G.nodeModel.isRoot()||G.nodeModel.options.noResultFound}if(B.get("treeMode")==="profile"){H=(!G.nodeModel.isRoot()&&G.nodeModel.hasChildren()||G.nodeModel.options.noResultFound)}if(G.nodeModel.hasChildren()){F=[{label:"Expand All",icon:"url("+c.getWebappsAssetUrl("QKMQualityMetrics","expand.png")+")",callback:function(){G.nodeModel.expandAll()}},{label:"Collapse All",icon:"url("+c.getWebappsAssetUrl("QKMQualityMetrics","collapse.png")+")",callback:function(){G.nodeModel.collapseAll()}}]}if(H){F.push({label:"Remove from the App",icon:"url("+c.getWebappsAssetUrl("QKMQualityMetrics","trash.png")+")",callback:function(){var K=A.model.get("preferencesModel").get("pidCollection");var J=K.findWhere({objectId:G.nodeModel.options.id});K.remove(J)}})}}}return F};var D=new j(E).inject(z);var w=D.getManager();w.sortColumnContent(2,{sortOrder:"desc"});w.onCellRequest(function(O){var M=O.virtualColumnID;var N=O.cellModel.options.value;var H=O.nodeModel.options.data;var P=O.cellView.getContent();if(M!==1&&typeof N!=="undefined"){var K=null;switch(M){case 0:if(!O.nodeModel.isRoot()){K="";P.setHTML(K)}else{}break;case 1:break;case 2:var R=function(W,V){var T=V;var S="";var U="";W.nodeModel.isRoot()?U="1":U="2";W.nodeModel.hasChildren()?U:U="3";T=T+U;switch(T){case"01":S="#e9482f";break;case"02":S="#ee715d";break;case"03":S="#f3998c";break;case"11":S="#ff941a";break;case"12":S="#ffac4d";break;case"13":S="#ffc380";break;case"21":S="#57b847";break;case"22":S="#78c66c";break;case"23":S="#9ad491";break;case"41":S="#42a2da";break}return S};var L=function(T){var S=T.nodeModel.isRoot()?30:20;S=T.nodeModel.hasChildren()?S:15;return S};var Q=L(O);var J=R(O,H.state);var F=(N/C*100)+2;var I={credits:{enabled:false},exporting:{enabled:false},title:{text:null},chart:{renderTo:P,type:"bar",margin:[0,0,0,0],backgroundColor:null,height:Q,verticalAlign:"center"},xAxis:{labels:{enabled:false},title:{text:null},tickPositions:[]},yAxis:{min:0,max:102,endOnTick:false,startOnTick:false,labels:{enabled:false},title:{text:null},tickPositions:[0]},legend:{enabled:false},plotOptions:{series:{pointWidth:50,animation:false}},tooltip:{backgroundColor:null,borderWidth:0,shadow:false,useHTML:true,hideDelay:0,shared:true,padding:0,positioner:function(T,U,S){return{x:S.plotX>T?(S.plotX/2)-(T/2):S.plotX,y:-5}},pointFormat:null,headerFormat:null,formatter:function(){var S=H.quality;return"weight : <b>"+S+"</b>"}},series:[{color:J,data:[F]}]};var K=new a.Chart(I);K.container.style.verticalAlign="middle";K.container.style.display="inline-block";break;case 3:K='<img style="width: 34px;height: 34px;" src="{0}" alt="{1}" class="img-rounded">'.format(c.getWebappsAssetUrl("QKMQualityMetrics","default-profile.png"),H.responsible.fullName);K+=" "+N;P.setHTML(K);break;case 4:K=new Date(N).strftime("%d/%m/%Y %H:%M");P.setHTML(K);break;case 5:var G=null;var J=null;if(N>0){G="fonticon-up";J="#EA4F37";N="+"+N}else{if(N<0){G="fonticon-down";J="#57B847"}else{G="fonticon-right";J="#00B8DE"}}K='<span class="fonticon fonticon-2x {0}" style="color:{1};"></span><span style="color:{1};">{2}</span>'.format(G,J,N);P.setHTML(K);break;case 6:K=new m({value:e.get("NLS_SEE_HISTORY"),className:O.nodeModel.isRoot()?"primary centerIconBtn":"default centerIconBtn",icon:"chart-line"});if(!O.cellModel.historyCollection){A.model.set("historyCollection",new l({url:A.model.get("WsBaseUrl"),contextCollection:A.model.get("contextCollection")}));O.cellModel.historyCollection=A.model.get("historyCollection")}K.addEvent("onClick",function(){new q({max:C,collection:O.cellModel.historyCollection,mode:H.history.mode,context:H.history.context,profile:H.history.profile,}).render().inject(A.container,"top")});P.setHTML(K);break;default:K=N;P.setHTML(K)}}});w.onColumnHeaderRequest(function(O){var J=O.virtualColumnID;var M=O.cellView.getCellInfos().cellModel.options.value;var P=O.cellView.getContent();var I=null;switch(J){case 1:var G=A.model.get("preferencesModel");var F=A.model.get("searchString");var H=G.get("treeProducts").length||G.get("treeProfiles").length||G.get("treeChecks").length||F;I=f.createElement("div",{html:M});var L=f.createElement("span",{"class":"fonticon fonticon-filter",styles:{color:H?"#368ec4":"initial"}});L.inject(I);var N=new d({model:A.model,target:L});N.render();break;case 2:var G=A.model.get("preferencesModel");var H=G.get("qualityRange");var Q=A.model.get("preferencesModel").get("qualityCalculationMode");I=f.createElement("div",{html:M+" ({0})".format(Q)});var L=f.createElement("span",{"class":"fonticon fonticon-filter",styles:{color:H?"#368ec4":"initial"}});L.inject(I);var K=new o({model:A.model,target:L});K.render();break;default:I=M}if(J!==0){P.setHTML(I)}});w.onPreUpdateView(function(){w.getRows().forEach(function(H,G){var F=w.getRowModel(G).tree.options;if(F.noResultFound){H.forEach(function(I,J){I.addClass("noContent")})}})})},showMessage:function(v,w){this.elements.alert.add({className:v,message:w})},destroy:function(){this.stopListening();this.model=null;this._parent()}});return g});