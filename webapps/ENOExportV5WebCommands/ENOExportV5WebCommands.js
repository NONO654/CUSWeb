define("DS/ENOExportV5WebCommands/utils/FileNameChecker",["UWA/Core","UWA/Class"],function(c,a){var b=a.singleton({init:function(d){this._parent(d)},checkWindowsCompatibility:function(d,e){var g=/[\\\/:\*\?"<>\|]+/;e=e.replace(g,"_");var f;f=d.replace(g,e);g=/^\./;if(e!=="."){f=f.replace(g,e)}else{f=f.replace(g,"_")}g=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;if(g.test(f)){if(e.length==0){f+="_"}else{f+=e}}return f},checkSize:function(d){if(d.length>260){d=d.slice(0,260)}return d},fullWindowsCheck:function(e,d){e=this.checkWindowsCompatibility(e,d);e=this.checkSize(e);return e}});return b});define("DS/ENOExportV5WebCommands/commands/ExportV5PSECmd",["DS/ApplicationFrame/Command","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages"],function(f,a,h,g,e,c,d){var b=f.extend({_check_roots:function(){var i=h.get().getPADTreeDocument().getRoots().length>0;if(i){this.enable()}else{this.disable()}},_check_added_roots:function(k){var j=h.get();var i=j.getPADTreeDocument();if(k.data.nb_root===0){this.disable()}else{this.enable()}},init:function(j){this._parent(j);var m=this,l=h.get(),i=l.options.model?l.options.model:l.getPADTreeDocument();if(UWA.Utils.Client.Platform.ios){this.disable()}else{this._check_roots();var k=this._check_roots.bind(this);i.addEventListener("addChild",k);i.addEventListener("removeChild",k);this._check_roots();l.addEvent("onRootsVisibility",this._check_roots.bind(this));l.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}},execute:function(){var k=this,j=h.get(),i=j.options.model?j.options.model:j.getPADTreeDocument();require(["DS/PADUtils/PADDataTransform","DS/ENOExportV5WebCommands/views/_EV5CustomizeView"],function(o,p){var n="";var l=i.getSelectedNodesForOFW();var m=true;o.buildDataForSetTypes(l,i,function(r,t){if(t.results.length>0){var q=new p({_command_id:k.options.ID,render_div:".xnav_body",open_message:t})}else{window.notifs=d;c.setNotificationManager(window.notifs);var s={level:"error",title:a.error.title,message:a.error.noSelection,sticky:false};window.notifs.addNotif(s)}},m)})}});return b});define("DS/ENOExportV5WebCommands/views/_EV5CustomizeView",["css!DS/UIKIT/UIKIT","css!DS/ENOExportV5WebCommands/ENOExportV5WebCommands","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","text!DS/ENOExportV5WebCommands/assets/catrsc/ExportV5Locations.json","DS/ENOExportV5WebCommands/utils/FileNameChecker","UWA/Controls/Abstract","UWA/Class/Events","UWA/Promise","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/Windows/Panel","DS/UIKIT/Modal","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/ProgressBar","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/ComboBox","DS/Controls/Expander","DS/Core/PointerEvents","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/Utilities/UUID","DS/i3DXCompassServices/i3DXCompassPubSub"],function(A,e,h,B,z,y,v,f,c,r,o,d,a,x,i,D,j,p,t,n,q,l,k,m,b,g){const C=999;var s="";var w="DS/ENOFloatingPanel/ENOFloatingPanel";var u=y.extend(v,{name:"ev5customizeview",_command_id:"",_applyOnlyToThisApp:false,init:function(E){this._parent(E);var F=this;require([w],function(G){F.render_div=document.querySelector(F.options.render_div);F._command_id=E._command_id;F.message_batch=E.open_message;F.elements.useDLNames=false;F.elements.container=F._createContent();F.elements.floatingpanel=new G({className:F.name,body:F.elements.container,footer:F._buildFooter(),title:h.title,overlay:true,closable:true,animate:true,resizable:true,visible:true,events:{onClose:function(){F.elements.floatingpanel.destroy()}}});F.elements.floatingpanel.inject(F.render_div);F._retrieveFilenames(F.message_batch)})},_isLineEditorPathValid:function(){var E=this.elements.lineEditor.getContent().getChildren()[0].value;return this._isPathValid(E)},_isSelectionValid:function(){if(this.elements.useDLNames==true){if(this.elements.combobox.selectedIndex==-1){return false}else{return true}}else{return this._isLineEditorPathValid()}},_isPathValid:function(E){if(E){E=E.trim();if(navigator.platform.indexOf("Win")>-1){var F=/^(?:[a-z]:|\\\\[a-z0-9_.$‚óè-]+)\\(?:[^\\\/:*?"<>|\r\n]+\\)*[^\\\/:*?"<>|\r\n]*$/;if(F.test(E.toLowerCase())){return true}return false}else{if(/[^\0]+/.test(E)){return true}else{return false}}}else{return false}},_onPathChange:function(){this.elements.launchbutton.disabled=!this._isLineEditorPathValid()},_createContent:function(){var I=this;var ab=UWA.createElement("div",{"class":"ev5customizeview_content"});var M=UWA.createElement("div",{"class":"ev5customizeview_body"}).inject(ab);M.setAttribute("id","ev5customizeview_body");var aa=UWA.createElement("h5",{content:h.option_path.label});M.appendChild(aa);B=UWA.is(B,"string")?JSON.parse(B):B;var af=0;var O=B.paths.length;var H=B.manual;var Q=localStorage.getItem("ExportV5path");if(O===0){if(H===true){var G="";if(Q&&this._isPathValid(Q)){G=Q}else{G=B.defaultLocation}I.elements.lineEditor=new D({placeholder:h.option_path.option_text,requiredFlag:true,value:G});I.elements.lineEditor.addEventListener("uncommittedChange",I._onPathChange.bind(this));M.appendChild(I.elements.lineEditor.getContent())}else{I._displayNotification("error",h.error.title,h.error.emptyDefinedPath);I.elements.floatingpanel.destroy()}}else{var F=[];var U=[];var P=[];var ag=false;var ah,S;var T=new p({shouldBeSelected:function(ai){return ai.options.comboBoxSemantics!=="section"}});var Z=new t({label:h.option_path.predefined_paths,comboBoxSemantics:"section"});T.addRoot(Z);var ae=-1;var ad=1;var W=0;B.paths.forEach(function(ai){ah=ai.name;S=ai.path;if(typeof ai.name==="undefined"||ah===""){if(typeof ai.path!=="undefined"&&S!==""){I._displayNotification("error",h.error.title,h.error.emptyPathIdentifier);I.elements.floatingpanel.destroy()}else{W++}}else{if(UWA.Array.detect(F,function(ak,aj){return ak==ah})){P.push(ah);ag=true}else{if(!I._isPathValid(S)){U.push(ah);ag=true}else{if(ah==Q){ae=ad}else{if(S==Q&&ae==-1){ae=ad}}Z.addChild(new t({label:ah,comboBoxSemantics:"subsection"}));ad++;F.push(ah);af++}}}});var Y;if(F.length==0){Y=h.error.emptyDefinedPath;ag=true}else{if(W>0){Y=h.error.emptyobject;ag=true}else{if(P.length>0){Y=h.replace(h.error.identifierUnicity,{namesList:P})}else{if(U.length>0){Y=h.replace(h.error.pathInvalid,{namesList:U})}else{var E=1;if(ae!==-1){E=ae}if(H){var K=new t({label:h.option_path.added_path,comboBoxSemantics:"section"});T.addRoot(K);if(this._isPathValid(Q)){K.addChild(new t({label:Q,comboBoxSemantics:"subsection"}));E=T.getAllDescendants().length-1}}var X=new UWA.Element("div",{"class":"ev5-path-container"}).inject(M);T.expandAll();I.elements.combobox=new n({elementsTree:T,selectedIndex:E});X.appendChild(I.elements.combobox.getContent());I.elements.useDLNames=true;I.elements.combobox.addEventListener("change",function(){I.elements.launchbutton.disabled=false});if(H){var N=new UWA.Element("div",{"class":"expander-container"});var ac=new D({placeholder:h.option_path.option_text,value:B.defaultLocation}).inject(N);var R=!this._isPathValid(B.defaultLocation);var V=new x({domId:"ev5-add-button",label:h.option_path.button_add,emphasize:"primary",touchMode:true,disabled:R}).inject(N);ac.addEventListener("uncommittedChange",function(){if(I._isPathValid(ac.getContent().getChildren()[0].value)){V.disabled=false}else{V.disabled=true}});var L=new q({orientation:"horizontal",height:"22px",body:N}).inject(X);V.addEventListener("buttonclick",function(){T.getRoots()[1].addChild(new t({label:ac.value,comboBoxSemantics:"subsection"}));T.expandAll();I.elements.combobox.selectedIndex=I.elements.combobox.elementsTree.getAllDescendants().length-1;L.getContent().collapse})}}}}}if(ag){I._displayNotification("error",h.error.title,Y);I.elements.floatingpanel.destroy()}}var J=true;if(localStorage.getItem("ExportV5copy")){J=(localStorage.getItem("ExportV5copy")=="false")?false:true}I.elements.toggleCopy=new i({label:h.option_conflict.option_copy,checkFlag:J});M.appendChild(I.elements.toggleCopy.getContent());return ab},_getSelectedPath:function(){if(this.elements.useDLNames==true){var E=this.elements.combobox.value;var F;if(this._isPathValid(E)){F=E}B.paths.forEach(function(H){var G=H.name;if(G==E){F=H.path}});F=F.trim();return F}else{var E=this.elements.lineEditor.value;E=E.trim();return E}},_displayNotification:function(H,F,E){window.notifs=m;k.setNotificationManager(window.notifs);var G={level:H,title:F,message:E,sticky:false};window.notifs.addNotif(G)},_buildFooter:function(){var E=this;var H=UWA.createElement("div",{"class":"footerModal"});var G=!E._isSelectionValid();E.elements.launchbutton=new x({label:h.buttonLaunch,emphasize:"primary",touchMode:true,disabled:G});E.elements.launchbutton.addEventListener("buttonclick",function(){E._LaunchExport()});H.appendChild(E.elements.launchbutton.getContent());var F=new x({label:h.buttonCancel,emphasize:"secondary",touchMode:true});F.addEventListener("click",function(){E.elements.floatingpanel.destroy()});F.inject(H);return H},_LaunchExport:function(){var E=this;if(!E._isSelectionValid()){E._displayNotification("warning",h.warning.title_path,h.warning.empty_path)}else{document.getElementById("ev5customizeview_body").style.display="none";document.getElementById("ev5customizeview_progress").style.display="inline";localStorage.setItem("ExportV5copy",E.elements.toggleCopy.checkFlag);this.elements.launchbutton.disabled=true;f.all(E.generationPromises).then(function(){document.getElementById("ev5customizeview_progress").empty();new UWA.Element("h5",{text:h.launch_batch}).inject(document.getElementById("ev5customizeview_progress"));var G={path:E._getSelectedPath(),copy_if_conflict:E.elements.toggleCopy.checkFlag,data:E.message_batch};if(E.elements.useDLNames==false){localStorage.setItem("ExportV5path",G.path)}else{localStorage.setItem("ExportV5path",E.elements.combobox.value)}var F={widgetId:E._command_id,appId:"ENOEXV5_AP",fileName:"-file",fileContent:JSON.stringify(G)};g.subscribe("launchAppCallback",function(H){if(H&&H.widgetId===E._command_id){var I;if(H.response==="COMPLETE"){E._displayNotification("info",h.info.title,h.info.message)}else{E._displayNotification("error",h.error.title,h.error.launchApp+h.replace(h.error.errorType,{errorID:H.response}))}g.unsubscribe("launchAppCallback");E.elements.floatingpanel.destroy();E.destroy()}});g.publish("launchApp",F)})["catch"](function(F){E._displayNotification("error",h.error,h.error.launchApp+F);E.elements.floatingpanel.destroy();E.destroy()})}},checkFilename:function(F){if(typeof F!=="undefined"){var E=F;E=z.fullWindowsCheck(F,"_");return E}else{return fileName}},_fetchInformations:function(J,E,K,H,G){var I=this;var L=[];var F=[];L=E.slice(0,C);F=E.slice(C);var M=new f(function(O,N){require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert"],function(R,S,P){var Q={intent:"explore_2D",debug:R.getSetting("enopad_webapis_debug")};I._fetchIdList({ids:L,onComplete:function(V){var T=UWA.is(V,"string")?JSON.parse(V):V;if(!T.results||T.results.length===0){N(h.error.fetchFailed);return}else{if(T.results.length!==L.length){var W=L.length-T.results.length;G+=W;I._displayNotification("warning",h.warning.title,h.warning.invalid_fetchanswer)}}T.results.forEach(function(aj){var ae;var Z,ag,Y,ah;for(ae=0;ae<aj.attributes.length;ae++){var aa=aj.attributes[ae];if(aa.name==="physicalid"||aa.name==="resourceid"){ah=aa.value}if(aa.name==="ds6w:label"){Y=aa.value;if(Y.length===0){I._displayNotification("error",h.error.title,h.error.empty);N(errorMessage);I.elements.launchbutton.disabled=true;break}}else{if(aa.name==="ds6w:type"){Z=aa.value}else{if(aa.name==="ds6w:cadMaster"){ag=aa.value}}}}if(typeof Y!=="undefined"&&Y.length>0){Y=I.checkFilename(Y);if(Z==="VPMReference"){if(K.length>0&&UWA.Array.detect(K,function(al,ak){return al==Y})){var ab=b.v4();Y=Y+"_"+ab}K.push(Y)}if(J.results[G].phid===ah){J.results[G].filename=Y}else{var ad=UWA.Array.detect(J.results,function(ak,al){return ak.phid==ah});ad.filename=Y}}var ac=Math.floor(100*(parseInt(G)+1)/H);I.elements.progressbar.value=ac;G++;var ai=false;var af;if(ag===null&&(Z!=="VPMInstance"&&Z!=="VPMRepInstance")){ai=true;af=h.replace(h.error.type,{title:Y,objType:Z})}else{if((typeof ag!=="undefined")&&(ag!=="CATIAV5"&&ag!=="3DEXPERIENCE")){ai=true;af=h.replace(h.error.CADMaster,{title:Y,cadmaster:ag})}else{if(ag==="3DEXPERIENCE"&&!(Z==="VPMReference"||Z==="VPMInstance")){ai=true;af=h.replace(h.error.type,{title:Y,objType:Z})}}}if(ai==true){N(af);I.elements.floatingpanel.destroy();I._displayNotification("error",h.error.title,af)}});if(F.length){var U=I.generationPromises.length;I._fetchInformations(J,F,K,H,G);var X=setInterval(function(){if(U<I.generationPromises.length){O(true);clearInterval(X)}},500)}else{O(true)}},onFailure:function(){I._displayNotification("error",h.error.title,h.error.fetchFailed);N(h.error.fetchFailed);I.elements.floatingpanel.destroy()}})})});I.generationPromises.push(M)},_retrieveFilenames:function(L){var K=this;K.generationPromises=[];var N=UWA.createElement("div",{"class":"EV5progressDiv"}).inject(K.elements.container);N.style.display="none";N.setAttribute("id","ev5customizeview_progress");new UWA.Element("h5",{text:h.generatingfilename}).inject(N);K.elements.progressbar=new j({shape:"circular",emphasize:"success"}).inject(N);var M=[];var F=[];for(var H=0;H<L.results.length;H++){var E=L.results[H].phid;F.push(E)}var I=F.length;var G=0;K.elements.progressbar.value=G;var J=0;K._fetchInformations(L,F,M,I,J)},getCurrentSecurityContext:function(){var F="";var E=window.widget;if(E.getPreference("pad_security_ctx")){F=E.getPreference("pad_security_ctx").value}if(F.contains("ctx::")){return F.split("::")[1]}else{return F}},_fetchIdList:function(G){var H=this;var E={};E.method="POST";E.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:"ctx::"+H.getCurrentSecurityContext()};E.type="json";E.proxy="passport";E.timeout=600000;E.onComplete=function(J){var I=UWA.is(J,"string")?JSON.parse(J):J;G.onComplete(I)};E.onFailure=function(I){G.onFailure(I)};var F={label:"ExportV5_Fetch",nresults:G.ids.length,physicalid:G.ids,start:0,tenant:"OnPremise",select_predicate:["physicalid","resourceid","ds6w:label","ds6w:type","ds6w:cadMaster"]};E.data=JSON.stringify(F);c.authenticatedRequest(r.get3DSpaceUrl()+"/cvservlet/fetch/v2",E)}});return u});