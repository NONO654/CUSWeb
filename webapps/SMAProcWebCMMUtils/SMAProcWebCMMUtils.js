define("DS/SMAProcWebCMMUtils/SMAJSCMMUtils",["DS/JSCMM/SMAJSCMMUtils","module"],function(b,a){console.warn("Please migrate from "+a.id+" to DS/JSCMM/SMAJSCMMUtils");return b});define("DS/SMAProcWebCMMUtils/SMAJSCMMCommonServices",["DS/JSCMM/SMAJSCMMProcess","DS/JSCMM/SMAJSCMMActivity","DS/JSCMM/SMAJSCMMGateway","DS/JSCMM/SMAJSCMMSeqFlow","DS/JSCMM/SMAJSCMMParameter","DS/JSCMM/SMAJSCMMDataFlow","DS/JSCMM/SMAJSCMMSimulationDocument","DS/JSCMM/SMAJSCMMSimulationContents","DS/JSCMM/SMAJSCMMFile","DS/JSCMM/SMAJSCMMCategory","DS/JSCMM/SMAJSCMMSimulationFolder","DS/JSCMM/SMAJSCMMUtils","DS/JSCMM/SMAJSCMMPLMObject","DS/JSCMM/SMAJSCMMTemplate","DS/JSCMM/SMAJSCMMContent","DS/JSCMM/SMAJSCMMAttributeGroup"],function(n,o,i,h,k,m,f,p,q,j,e,c,l,g,b,a){var d={loadProcess:function(u){if(u===undefined||u===null){return null}var v=null;if("datarecords" in u){var t=u.datarecords;if("datagroups" in t){v=t.datagroups}}var r=null,C=[],w,A,s;for(w=0;v!==null&&w<v.length;w++){A=v[w];s=null;if("busType" in A){s=A.busType}if(s==="Simulation"){r=new n(A);C.push(r)}}for(w=0;v!==null&&w<v.length&&r!==null;w++){A=v[w];s=null;if("busType" in A){s=A.busType}if(s==="Simulation Activity"){var x=new o(A);r.addActivity(x);C.push(x)}}for(w=0;w<C.length;w++){var B=u.datarecords.datagroups[w].dataelements;var z=B.parent&&B.parent.value[0];var y;if(z){if(z.value===r.getPhysicalId()){y=r}else{y=r.getActivityById(z.value)}y.addChild(C[w])}}for(w=0;w<C.length;w++){this.parseGateways(r,C[w]);this.parseSeqFlows(r,C[w])}return r},loadActivity:function(t){if(t===undefined||t===null){return null}var s=null;if("datarecords" in t){var r=t.datarecords;if("datagroups" in r){s=r.datagroups}}var u=new o(s[0]);return u},loadTemplate:function(u){if(u===undefined||u===null){return null}var t=null;if("datarecords" in u){var r=u.datarecords;if("datagroups" in r){t=r.datagroups}}var s=new g(t[0]);return s},loadContent:function(w){var u=null;if("datarecords" in w){var s=w.datarecords;if("datagroups" in s){u=s.datagroups}}var x,r;for(var v=0;u!==null&&v<u.length;v++){r=u[v];x=null;if("busType" in r){x=r.busType}if(x==="Document"){var t=new b(r);return t}}},loadFIContent:function(u,t){var v=null,r=null;if("busType" in u){v=u.busType}if(/Simulation Category/.test(v)){r=new j(u)}else{if(/Simulation Folder/.test(v)){r=new e(u)}else{if(/Simulation Document/.test(v)){if(t instanceof f){r=new q(u)}else{r=new f(u)}}else{r=new p(u)}}}if(u.children.length!==0){for(var s=0;s<u.children.length;s++){this.loadFIContent(u.children[s],r)}}if(t){if(t instanceof f){t.addFile(r);return r}r.setParent(t);t.addChildContent(r)}return r},getIdUnderTemplate:function(w,s){if(w===undefined||w===null){return null}var u=null;if("datarecords" in w){var t=w.datarecords;if("datagroups" in t){u=t.datagroups}}var x,r;for(var v=0;u!==null&&v<u.length;v++){r=u[v];x=null;if("busType" in r){x=r.busType}if(x===s){return r.objectId}}return null},parseGateways:function(u,s){var r=s.getFieldValue("gateways");if(r===null){return}var x=c.getJSON(r);for(var v=0;x!==null&&v<x.length;v++){var t=new i(x[v]);var w=[];w.connected=true;t.setPosition(w);s.addChild(t);u.addActivity(t)}},parseSeqFlows:function(s,t){var v=t.getFieldValue("sequenceFlows");t.setFirstChild(null);t.setLastChild(null);if(v===null){return}var u=c.getJSON(v).Outerflow;for(var w=0;u!==null&&w<u.length;w++){var A=u[w];if("fromFlowItemID" in A||"toFlowItemID" in A){var x=null,y=null;if("fromFlowItemID" in A){x=s.getActivityFromId(A.fromFlowItemID);var r=t.getChild(A.fromFlowItemID);if(x!==null&&r===null){t.addChild(x)}}if("toFlowItemID" in A){y=s.getActivityFromId(A.toFlowItemID);var r=t.getChild(A.toFlowItemID);if(y!==null&&r===null){t.addChild(y)}}if(x!==null&&y!==null){var z=new h(A);z.setParent(t);t.addSeqFlow(z)}else{if(x!==null){t.setLastChild(x)}}}else{if("firstChildID" in A){t.setFirstChild(A.firstChildID)}}}},loadParameters:function(u,t){var v=[];var r=t.datarecords.datagroups;if(r!==undefined&&r!==null){for(var s=0;r!==null&&s<r.length;s++){v[s]=new k(r[s])}}u.setParameters(v);u.updateCEStamp("PARAMETERS",u.getCEStamp())},loadSimulationData:function(v,s){v.removeAllSimulationData();var r=s.datarecords.datagroups;for(var u=0;u<r.length;u++){var w=r[u];var t=new l(w);v.addSimulationData(t)}v.updateCEStamp("SIMULATION_DATA",v.getCEStamp())},loadDataflows:function(x,v){var u=function(K,D,H,P){var C=function(S,Q){var R;if(S!==undefined&&S[Q]!==undefined&&S[Q].value[0]!==undefined&&S[Q].value[0].value!==undefined){R=S[Q].value[0].value}return R};var E=D.getDataContainer?D.getDataContainer():D;K.setParent(E);var F=P.dataelements;var L=C(F,"fromFlowItemID");var N=(H.getId()===L)?H:H.getActivityFromId(L);if(N){var G=C(F,"fromParameterID");var B=N.findParameterById(G);K.setFromParameter(B)}var I=C(F,"fromSlice");if(I){var M="["+I+"]";K.setFromSlice(M)}var A=C(F,"toFlowItemID");var O=(H.getId()===A)?H:H.getActivityFromId(A);if(O){var z=C(F,"toParameterID");var J=O.findParameterById(z);K.setToParameter(J)}var y=C(F,"toSlice");if(y){var M="["+y+"]";K.setToSlice(M)}};var w=(x.isProcess())?x:x.getProcess();var r=[];var s=v.datarecords.datagroups;if(s!==undefined&&s!==null){for(var t=0;s!==null&&t<s.length;t++){r[t]=new m(s[t]);u(r[t],x,w,s[t])}}x.setDataFlows(r);x.updateCEStamp("DATAFLOWS",x.getCEStamp())},loadAttributeGroups:function(s){var r=[];s.forEach(function(t){r.push(new a(t))});return r}};return d});
/*! Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils",["DS/SMAProcWebFetchUtils/requests","DS/WAFData/WAFData"],function(e,b){var a=null;var c=null;var d={activeWS:[],defferedWS:[],Context:"",setCsrfToken:function(f){a=f},getCsrfToken:function(){return a},setCsrfTokenName:function(f){c=f},getCsrfTokenName:function(){return c||e.ENO_CSRF_TOKEN_DEFAULT_HEADER_NAME},callWebService:function(h,f,k,l,i){if(h!==null&&h in this.activeWS){this._cacheFunction(this.post,this,[h,f,k,l])}else{if(h!==null){this.activeWS.push(h)}var j=l;var g=this;this._request(f,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:i,data:k,type:"json",cache:3600,onComplete:function(n){g.activeWS.pop();g._cacheFunctionCall();if(e.isErrorResponseBody(n)){var m=e.extractErrorReason(n);j.onError(m)}else{j.onComplete(n)}},onFailure:function(n){g.activeWS.pop();g._cacheFunctionCall();var m=e.extractErrorReason(n);j.onError(m)}})}},post:function(g,f,h,i){this.callWebService(g,f,h,i,"POST")},put:function(g,f,h,i){this.callWebService(g,f,h,i,"PUT")},"delete":function(g,f,h,i){this.callWebService(g,f,h,i,"DELETE")},get:function(h,f,j){if(h in this.activeWS){this._cacheFunction(this.get,this,[h,f,j])}else{this.activeWS.push(h);var i=j;var g=this;this._request(f,{method:"GET",type:"json",cache:3600,responseType:"json",onComplete:function(l){g.activeWS.pop();g._cacheFunctionCall();if(e.isErrorResponseBody(l)){var k=e.extractErrorReason(l);i.onError(k)}else{i.onComplete(l)}},onFailure:function(l){g.activeWS.pop();g._cacheFunctionCall();var k=e.extractErrorReason(l);i.onError(k)}})}},fetch:function(f){return new Promise(function(i,h){var g={method:"GET",type:"json",cache:3600,responseType:"json"};e.fetchAuthenticatedRequest(f,g).then(function(j){i(j&&j.body)})["catch"](function(j){h(j)})})},getText:function(h,f,j){if(h in this.activeWS){this._cacheFunction(this.get,this,[h,f,j])}else{this.activeWS.push(h);var i=j;var g=this;this._request(f,{method:"GET",type:"text",cache:3600,responseType:"text",onComplete:function(k){g.activeWS.pop();g._cacheFunctionCall();i.onComplete(k)},onFailure:function(k){g.activeWS.pop();g._cacheFunctionCall();i.onError(k)}})}},_request:function(g,h){var f=h||{};var j=f.method&&f.method!=="GET";if(j&&this.getCsrfToken()){var k=f.headers||{};k[this.getCsrfTokenName()]=this.getCsrfToken();f.headers=k}g=e.addSecurityContextQueryParam(g,this.Context);var i=f.onComplete;f.onComplete=function(l,o,n){var m=l&&l.datarecords&&l.datarecords.csrf||null;if(m&&m.name&&m.value){d.setCsrfTokenName(m.name);d.setCsrfToken(m.value)}i(l,o,n)};b.authenticatedRequest(g,f)},normalRequest:function(f,g){b.request(f,g)},_cacheFunction:function(h,f,g){var i={_fn:h,_this:f,_args:g};this.defferedWS.push(i)},_cacheFunctionCall:function(){if(this.defferedWS.length>0){var f=this.defferedWS.pop();f._fn.apply(f._this,f._args)}},isInDashboard:function(){var g=window,f=g.UWA&&g.UWA.hosts&&g.UWA.hosts.exposition;return f&&(["http://uwa.netvibes.com","https://uwa.netvibes.com"].indexOf(f)===-1)}};return d});define("DS/SMAProcWebCMMUtils/PubSub",["UWA/Class","UWA/Class/Events"],function(d,a){var e=d.extend(a,{}),c=new e(),b;b={add:function(f,h,g){c.addEvent(f,h,g)},remove:function(f,g){c.removeEvent(f,g)},dispatch:function(g,f){c.dispatchEvent(g,f)},has:function(f){return c.hasEvent(f)}};return b});
/*! Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebCMMUtils/SMAJSCMMDeprecateUtils",["DS/Logger/Logger","module"],function(b,e){var a={},f=new Function("return this")(),d=Object.create(null),c=b.getLogger(e);a.deprecateModule=function(g){d[g]=Object.create(null);c.info('Module "'+g+'" is deprecated, please use "DS/'+g+'" instead')};a.listDeprecated=function(){var j=f.requirejs&&f.requirejs.s&&f.requirejs.s.contexts&&f.requirejs.s.contexts._&&f.requirejs.s.contexts._.registry||{};function h(m,n){if(n&&n.forEach){n.forEach(function(o){if(d[o]){d[o][m]=true}})}}function i(m){return"\n  * "+m}for(var k in j){if(j.hasOwnProperty(k)&&j[k]&&j[k].depMaps&&j[k].depMaps.forEach){h(k,j[k].depMaps)}}var g="";for(var l in d){g+="\n* "+l;g+=Object.keys(d[l]).map(i).join("")}c.log("Deprecated dependencies:"+g)};return a});
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebCMMUtils/SMAProcWebAuthoringNLSUtils",["require","exports","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAProcWebAuthoringNLS.json"],function(c,b,a){var d={translate:function(i){var g=i;var h=a[i];if(h===null||typeof h==="undefined"||h.length<1){i=i.replace("...","ellipsis");i=i.replace(new RegExp(" ","g"),"_");h=a[i];if(h===null||typeof h==="undefined"||h.length<1){console.log("No NLS entry for '"+g+"'");h=g}}if(arguments.length>1){var e={};for(var f=1;f<arguments.length;f++){e["val"+f]=arguments[f]}h=a.replace(h,e)}return h},parseHTMLLabels:function(g,f,e){f.map(function(h){var i=new RegExp(h,"g");g=g.replace(i,e[h])});return g}};return d});define("DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtilsNLSUtils",["i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAJSCMMDataFlowUtilsNLS"],function(a){var b={translate:function(g){var e=g;var f=a[g];if(f===null||typeof f==="undefined"||f.length<1){g=g.replace("...","ellipsis");g=g.replace(new RegExp(" ","g"),"_");f=a[g];if(f===null||typeof f==="undefined"||f.length<1){console.log("No NLS entry for '"+e+"'");f=e}}if(arguments.length>1){var c={};for(var d=1;d<arguments.length;d++){c["val"+d]=arguments[d]}f=a.replace(f,c)}return f}};return b});define("DS/SMAProcWebCMMUtils/SMAJSCMMContentsUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMUtils"],function(b){var a={saveContent:function(f,g){var e=this;var d=function(h){return new Promise(function(j,i){e.processTemporaryContent(f,h,{onSuccess:j,onFailure:i})})};var c=[d(b.State.Deleted),d(b.State.Modified),d(b.State.Created)];Promise.all(c).then(function(){if(g&&g.onSuccess){g.onSuccess("saveContent() successful")}},function(h){if(g&&g.onFailure){g.onFailure(h)}else{console.log("saveContent() error")}})},processTemporaryContent:function(i,h,j){if(typeof i==="undefined"){if(j&&j.onFailure){j.onFailure(null);return}}var d=i;var g=i.getTemporaryContent(h);if((!(Array.isArray(g)))||(g.length<=0)){if(j&&j.onSuccess){j.onSuccess(null);return}}var e=[{activity:i,contents:g}];var c=require("DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils");var f=require("DS/SMAProcWebCMMUtils/SMAJSCMMUtils");if(h===f.State.Created){c.CreateContentCategory(e,{onSuccess:function(n){var m=d.getTemporaryContent(h);for(var l=0,k=0;l<n.datarecords.datagroups.length,k<m.length;l++,k++){if((typeof m!=="undefined")&&(m!==null)){if((typeof n.datarecords.datagroups[l].dataelements!=="undefined")){m[k]._data.physicalId=n.datarecords.datagroups[l].dataelements.contentId.value[0].value;m[k].setParent(d);d.addChildContent(m[k])}}}d._tempCreatedContentsArray=[];console.log("Category created successfully");if(j&&j.onSuccess){j.onSuccess(n)}},onFailure:function(k){if(j&&j.onFailure){j.onFailure(k)}}})}else{if(h===f.State.Deleted){c.deleteContentCategory(e,{onSuccess:function(l){for(var k=0;k<=g.length;k++){d.removeChildContent(g[k])}d._tempDeletedContentsArray=[];console.log("Category deleted successfully");if(j&&j.onSuccess){j.onSuccess(l)}},onFailure:function(k){if(j&&j.onFailure){j.onFailure(k)}}})}}}};return a});define("DS/SMAProcWebCMMUtils/SMAJSCMMConfig",["DS/Logger/Logger","module","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/SMAProcWebFetchUtils/requests"],function(e,d,g,k,c,f,b){var m=e.getLogger(d);var a={};var j="threeDSpaceUrl";var l="ODTServerEnv";var n="dscef";var h="widget";var i={initialized:false,getConnectionParameters:function(){return{spaceUrl:i.get3DSpaceUrl(),tenant:i.getCurrentTenant(),securityContext:i.getSecurityContexts()}},set3DSpaceUrl:function(o){a[j]=o},get3DSpaceUrl:function(){if(a[j]){return a[j]}if(window[l]&&window[l].url){a[j]=window[l].url}else{a[j]=k.getApplicationConfiguration("apps.urls.myapps")}if(a[j]){return a[j]}else{return g.getWebappsBaseUrl()+".."}},setCurrentTenant:function(o){a.tenant=o},getCurrentTenant:function(){return a.tenant},setCurrentSecurityContext:function(o){f.Context=o},getCurrentSecurityContext:function(){return f.Context},setSecurityContexts:function(o){a.securityCtxs=o},getSecurityContexts:function(){if(!a.securityCtxs){return undefined}var p=i.getCurrentSecurityContext();if(!p){return a.securityCtxs}for(var o=0;o<a.securityCtxs.length;o++){if(a.securityCtxs[o].name===p){a.securityCtxs[o].isSelected=true}else{a.securityCtxs[o].isSelected=undefined}}return a.securityCtxs},isAuthorized:function(){return a.authorized},fetch3DSpaceUrl:function(){return new Promise(function(p,o){i.get3DSpaceUrl();if(a[j]){p(i.get3DSpaceUrl());return}c.getServiceUrl({serviceName:"3DSpace",platformId:i.getCurrentTenant(),onComplete:function(r){var q=(typeof r==="string")?r:r[0].url;a[j]=q;p(a[j])},onFailure:o})})},fetchMyAppsUri:function(){return new Promise(function(q,p){if(window[n]&&window[n].getMyAppsURL){window[n].getMyAppsURL().then(function(s){q(s.replace(/\/resources\/AppsMngt$/,""))},p)}else{var o=k.getApplicationConfiguration("app.urls.myapps");if(o){q(o)}else{try{o=window.top&&window.top.myAppsURL}catch(r){o=null}if(o){q(o)}else{i.fetch3DSpaceUrl().then(q,p)}}}})},fetchCsrfToken:function(){var o=i.get3DSpaceUrl()+"/resources/slmservices/token/CSRF";var p=i.getCurrentTenant();if(p){o+="?tenant="+p}return b.fetchAuthenticatedRequest(o,{type:"json",headers:{Accept:"application/json"}})},fetchAuthorization:function(o){return new Promise(function(s,r){if(a.authorized!==undefined){s(a.authorized);return}if(!o||o.length===0){a.authorized=true;s(true);return}var q=i.get3DSpaceUrl();var u=i.getCurrentTenant();var t="Widget_Process_Composer";if(o.indexOf("Process_Composer")!==-1&&o.indexOf(t)===-1){o.push(t)}var p=q+"/resources/slmservices/license?appNames="+o.join(",")+(u?"&tenant="+u:"");f.get(null,p,{onComplete:function(w){for(var v=0;v<o.length;v++){if(!w||w[o[v]]!=="true"){a.authorized=false;r(w);return}}a.authorized=true;s(w)},onError:r})})},fetchSecurityContexts:function(o){return new Promise(function(u,t){if(window[l]&&window[l].ticket){var p=window[l].ticket;var r=p.split?p.split("|").pop():null;if(r){i.setCurrentSecurityContext(r);u(i.getSecurityContexts());return}}if(i.getSecurityContexts()&&i.getCurrentSecurityContext()){u(i.getSecurityContexts());return}var s=i.get3DSpaceUrl();var q=s+"/resources/bps/cspaces";f.get(null,q,{onComplete:function(x){var v=x&&x.cspaces||[];var w={name:"collabspaces",label:"Collaborative Space",type:"list"};w.options=v.map(function(z,y){if(z.isDefault||y===0){w.defaultValue=z.name;i.setCurrentSecurityContext(z.name)}return{value:z.name,label:z.displayName}});i.setSecurityContexts(v);if(window[h]&&window[h].getValue("collabspaces")){i.setCurrentSecurityContext(window[h].getValue("collabspaces"))}if(window[h]&&o){window[h].addPreference(w)}u(v)},onError:t})})},fetchTenantId:function(o){return new Promise(function(s,r){if(a.tenant){s(a.tenant);return}var p="x3dPlatformId";var q=window[h]||{getValue:function(u){},setValue:function(u,v){}};var t=q.getValue(p);if(t){s(t)}else{i.fetchMyAppsUri().then(function(v){var u="/resources/AppsMngt/environment/list";return b.fetchAuthenticatedRequest(v+u,{type:"json",headers:{Accept:"application/json"}})}).then(function(w){var z=w&&w.body;var x=z&&z.environments||[];var v=x[0]&&x[0].id||"";q.setValue(p,v);if(x.length>1&&o){var u=x.map(function(A){return{value:A.id,name:A.displayName}});if(o){var y={name:p,type:"list",label:"Platform",options:u,defaultValue:v};q.addPreference(y);if(q.isEdit){q.dispatchEvent("onEdit")}}}s(v)})["catch"](function(){console.warn("Failed to get tenant ID, fallbacking to empty string");s("")})}})},initialize:function(o){var p=Object.assign({licenses:[],addTenantPreference:true,addCollabspacePreference:true,currentPlatformId:undefined},o);return new Promise(function(r,q){if(i.initialized){r(i.getConnectionParameters());return}if(p.currentPlatformId){a.tenant=p.currentPlatformId}i.fetch3DSpaceUrl().then(function(s){i.fetchTenantId(p.addTenantPreference).then(function(t){i.fetchAuthorization(p.licenses).then(function(u){if(!u){q("Not authorized");return}i.fetchSecurityContexts(p.addCollabspacePreference).then(function(v){i.initialized=true;i.fetchCsrfToken().then(function(w){f.setCsrfToken(w.body.csrf.CSRFToken);f.setCsrfTokenName(w.body.csrf.name);r(i.getConnectionParameters())},function(w){m.warn("Failed to get CSRF token:",w);f.setCsrfToken(null);r(i.getConnectionParameters())})},q)},q)},q)},q)})},};return i})
/*! Copyright 2016 Dassault Systemes. All rights reserved. */
;define("DS/SMAProcWebCMMUtils/SMAProcWebCMM3DXContentUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMConfig"],function(a){var b={get3DXContentItem:function(c){c=c||{objectId:null};c.envId=c.envId||a.getCurrentTenant();c.serviceId=c.serviceId||"3DSpace";c.objectType=c.objectType||"Simulation";return c},get3DXContent:function(d){var e=window&&window.widget&&window.widget.id;if(!d){d=[]}if(!d.map){d=[d]}var c=d.map(b.get3DXContentItem);return{protocol:"3DXContent",version:"2.0",source:"SIMPRCW_AP",widgetId:e,data:{items:c}}}};return b});define("DS/SMAProcWebCMMUtils/SMAJSCMMJobAuthoringUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMConfig","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/JSCMM/SMAJSCMMSimulationJob","DS/JSCMM/SMAJSCMMUtils"],function(c,a,b,d){var e={initConfiguration:function(){c.initialize()},getAllSimulationJobIds:function(h){var i=c.get3DSpaceUrl();var f=h.owner;var g=h.limit;i=i+"/resources/e6w/service/SMA_JobIds?owner="+f+"&limit="+g;a.get("SMA_JobIds",i,{onComplete:function(j){console.log(j);if(h.onSuccess){h.onSuccess(j)}},onError:function(j){console.log(j);if(h.onFailure){h.onFailure(j)}}})},getAllSimulationJobsFromMCS:function(h,g){var f=c.get3DSpaceUrl();f=f+"/resources/slmservices/simulations/"+h+"/jobs";var i=g;a.get(h,f,{onComplete:function(j){console.log(j);if(i&&i.onSuccess){i.onSuccess(j)}},onError:function(j){console.log(j);if(i&&i.onFailure){i.onFailure(j)}}})},getSimulationJobsDetailsFromMCS:function(f,h){var g=c.get3DSpaceUrl();g=g+"/resources/e6w/service/SMA_JobDetails?jobId="+f.toString();var i=h;a.get("SMA_JobDetails",g,{onComplete:function(l){var m=[],k;for(var j=0;j<l.datarecords.datagroups.length;j++){k=new b(l.datarecords.datagroups[j]);m.push(k)}if(i&&i.onSuccess){i.onSuccess(m)}},onError:function(j){if(i&&i.onFailure){i.onFailure(j)}}})}};return e});
/*! Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils",["DS/Logger/Logger","module","DS/SMAProcWebCMMUtils/SMAJSCMMConfig","DS/SMAProcWebCMMUtils/SMAJSCMMWebServicesUtils","DS/SMAProcWebFetchUtils/requests","DS/JSCMM/SMAJSCMMUtils","DS/WebappsUtils/WebappsUtils","DS/SMAProcWebCMMUtils/SMAJSCMMCommonServices","DS/JSCMM/SMAJSCMMProcess","DS/JSCMM/SMAJSCMMActivity","DS/JSCMM/SMAJSCMMSeqFlow","DS/JSCMM/SMAJSCMMGateway","DS/JSCMM/SMAJSCMMStep","DS/JSCMM/SMAJSCMMExtensionManager","DS/JSCMM/SMAJSCMMContent","DS/JSCMM/SMAJSCMMPLMObject","DS/JSCMM/SMAJSCMMFile","DS/JSCMM/SMAJSCMMOccPath","DS/JSCMM/SMAJSCMMExtensionDescriptor","DS/JSCMM/SMAJSCMMExecutionOptions","UWA/Data","UWA/Ajax","DS/JSCMM/SMAJSCMMTemplateView"],function(y,c,j,r,h,d,i,n,s,l,t,e,b,p,v,g,u,m,k,a,x,o,w){var z=y.getLogger(c);var q=function(A){if(!A){return false}if((A.isActivity&&A.isActivity())||(A.isProcess&&A.isProcess())){return true}return false};var f={currentProcess:null,extensionsDescriptorP:{},setCurrentContext:function(A){z.warn("SMAJSCMMAuthoringUtils.setCurrentContext is deprecated, please migrate to SMAJSCMMConfig.setCurrentSecurityContext");j.setCurrentSecurityContext(A)},getCurrentContext:function(){z.warn("SMAJSCMMAuthoringUtils.getCurrentContext is deprecated, please migrate to SMAJSCMMConfig.getCurrentSecurityContext");return j.getCurrentSecurityContext()},getEncodedContext:function(){return encodeURIComponent(r.Context)},get3DSpaceUrl:function(){z.warn("SMAJSCMMAuthoringUtils.get3DSpaceUrl is deprecated, please migrate to SMAJSCMMConfig.get3DSpaceUrl");return j.get3DSpaceUrl()},toQueryString:function(C){var A="",B;for(B in C){if(C.hasOwnProperty(B)){A+=(A?"&":"")+encodeURIComponent(B)+"="+encodeURIComponent(C[B])}}return A},getAuthenticatedJspUri:function(A){var B=j.getCurrentSecurityContext(),C=A;if(B){C="/common/emxFrameworkContextManager.jsp?"+this.toQueryString({SecurityContext:B,forwardUrl:A})}return j.get3DSpaceUrl()+C},isAuthorized:function(A,B){z.warn("SMAJSCMMAuthoringUtils.isAuthorized is deprecated, please migrate to SMAJSCMMConfig.fetchAuthorization");j.fetchAuthorization([A]).then(B.onSuccess.bind(B),B.onFailure.bind(B))},getListSecurityContext:function(A){z.warn("SMAJSCMMAuthoringUtils.getListSecurityContext is deprecated, please migrate to SMAJSCMMConfig.fetchSecurityContexts");j.fetchSecurityContexts().then(A.onSuccess.bind(A),A.onFailure.bind(A))},fetchTenantId:function(){z.warn("SMAJSCMMAuthoringUtils.fetchTenantId is deprecated, please migrate to SMAJSCMMConfig.fetchTenantId");return j.fetchTenantId()},getEEDUrl:function(C){var B=new Error("empty error for stack");if(!C||!(C.onSuccess)||!(C.onFailure)){B.message="Missing required argument: {onSuccess: ()=>{}, onFailure: ()=>{}}";throw B}var A=j.get3DSpaceUrl()+"/resources/eepservices/cos/urls";r.get(null,A,{onComplete:function(F){var D=null;if(F){var E=F.COSConfiguration||F.configurations||F||[];E.some(function(G){if(G.isDefault){D=G.eedUrl;return true}else{return false}})}if(D){C.onSuccess(D)}else{B.message="Could not get default EED url";C.onFailure(B)}},onError:function(D){B.message="Could not get EED urls";B.originalError=D;C.onFailure(B)}})},fetchCsrfToken:function(){var A=j.get3DSpaceUrl()+"/resources/slmservices/token/CSRF";var B=j.getCurrentTenant();if(B){A+="?tenant="+B}return h.fetchAuthenticatedRequest(A,{type:"json",headers:{Accept:"application/json"}})},initialize:function(A,B){z.warn("SMAJSCMMAuthoringUtils.initialize is deprecated, please migrate to SMAJSCMMConfig.initialize");j.initialize({currentPlatformId:A}).then(function(C){B.onSuccess(C.spaceUrl)},B.onFailure.bind(B))},getFileContent:function(D,C){var B=i.getWebappsBaseUrl()+D;var A=o;if(i.getWebappsBaseUrl()!=="../"){A=x}A.request(B,{isAsync:true,onComplete:function(E){C.onSuccess(E)},onFailure:function(F){var E="[!]\tError loading file:"+B+" with message: "+F;C.onError(E)}})},createProcess:function(E,I){var H=I||{};var G={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:"SMA_Process"},name:"SMA_Process"};var D=G.datarecords.datagroups[0].dataelements;D.title={value:[{value:E}]};var C=H.simulationKind||"method";D["Simulation Kind"]={value:[{value:C}]};if(H.description){D.description={value:[{value:H.description}]}}var F="updateWidget="+encodeURIComponent(JSON.stringify(G));var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_Process";r.post("process",A,F,{onComplete:function(J){var K=new s(J.datarecords.datagroups[0]);H.onSuccess(K)},onError:function(J){z.error("createProcess",J);if(H.onFailure){H.onFailure(J)}}})},deleteProcess:function(F,G){var E={datarecords:{datagroups:[{updateAction:"DELETE",objectId:F}],name:"SMA_Process"},name:"SMA_Process"};var A="updateWidget="+encodeURIComponent(JSON.stringify(E));var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Process?_processid="+F;var D=G;r.post("process",B,A,{onComplete:function(H){D.onSuccess(H)},onError:function(H){z.error("deleteProcess",H);if(D.onFailure){D.onFailure(H)}}})},getStackOfProcessNumbers:function(){return new Promise(function(D,C){var B=f.get3DSpaceUrl();var A=B+"/resources/slmservices/busObj/autonaming?type=Simulation&range=5";r.get(null,A,{onComplete:function(F){var G=F.index0;var E=F.index4;if(G===0){G++;E++}window.localStorage.setItem("lastStackEntry",E);window.localStorage.setItem("processNumber",G);D(G)},onError:function(E){C()}})})},createActivity:function(M,I,J,K,D,N){var L={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:"SMA_Activity"},name:"SMA_Activity"};var F=L.datarecords.datagroups[0].dataelements;F.parentId={value:[{value:M.getoid()}]};F.title={value:[{value:I}]};var H="updateWidget="+encodeURIComponent(JSON.stringify(L));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Activity";var E=N;var B=this.currentProcess;var G=this;r.post(M.getPhysicalId(),A,H,{onComplete:function(P){M.setCEStamp(P.datarecords.datagroups[0].dataelements.parentCEStamp.value[0].value);var Q=new l(P.datarecords.datagroups[0]);Q.setPosition({connected:D});Q.setProcess(B);Q.setParent(M);Q.setPosition({connected:D});B.addActivity(Q);M.addChild(Q);var O=E;G.updateSeqFlows(M,Q,J,K,D,{onSuccess:function(){O.onSuccess(Q)},onFailure:function(R){if(R instanceof String){z.error(R)}if(O.onFailure){O.onFailure(R)}}})},onError:function(O){z.error("createActivity",O);if(E.onFailure){E.onFailure(O)}}})},getCurrentProcess:function(){return this.currentProcess},setCurrentProcess:function(A){this.currentProcess=A},openProcess:function(D,E){if(D===undefined||D===null){return}var C=E;var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_Process?objectId="+D;r.get(D,A,{onComplete:function(F){var G=n.loadProcess(F);C.onSuccess(G)},onError:function(F){z.error("openProcess",F);if(C.onFailure){C.onFailure(F)}}})},createTemplate:function(D,G){var F={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:""},name:""};F.name="SMA_Template";F.datarecords.name="SMA_Template";var B=F.datarecords.datagroups[0].dataelements;B.title={value:[{value:D.title}]};B.description={value:[{value:D.description}]};B.sourceId={value:[{value:D.sourceId}]};B.templateView={value:[{value:D.templateView}]};B.simulationKind={value:[{value:D.simulationKind}]};B.attributeGroupId={value:[{value:D.attributeGroupId}]};B.instructionDocId={value:[{value:D.instructionDocId}]};var A="updateWidget="+encodeURIComponent(JSON.stringify(F));var E=j.get3DSpaceUrl();var C=E+"/resources/e6w/service/SMA_Template";r.post("template",C,A,{onComplete:function(H){z.error("createTemplate",H);f.openTemplate(H.datarecords.datagroups[0].physicalId,G)},onError:function(H){z.error("createTemplate",H);if(G.onFailure){G.onFailure(H)}}})},openTemplate:function(B,E){if(B===undefined||B===null){return}var D=E;var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Template?objectId="+B;r.get(B,A,{onComplete:function(G){var F=n.loadTemplate(G);D.onSuccess(F)},onError:function(F){z.error("openTemplate",F);if(D.onFailure){D.onFailure(F)}}})},expandTemplate:function(C,F){var B=C.getoid();if(B===undefined||B===null){return}var E=F;var D=j.get3DSpaceUrl();var A=D+"/resources/e6w/service/SMA_TemplateRelation?objectId="+B;r.get(B,A,{onComplete:function(N){var H=N;var M=n.getIdUnderTemplate(H,"Simulation");var L,J,I=[];if(!M){var G=n.getIdUnderTemplate(H,"Simulation Activity");L=this.openActivityAsPromise(G,C);I.push(L)}else{L=this.openProcessAsPromise(M,C);I.push(L)}var K=n.getIdUnderTemplate(H,"Simulation Template View");if(K){J=this.getTemplateViews(K,C);I.push(J)}Promise.all(I).then(function(O){var P=n.loadContent(H);C.addChildContent(P);O.forEach(function(Q){if(Q.getObjectType()==="Template View"){C.setTemplateView(Q)}else{C.addChildContent(Q)}});E.onSuccess(C)})}.bind(this),onError:function(G){z.error("expandTemplate",G);if(E.onFailure){E.onFailure(G)}}})},openProcessAsPromise:function(A){return new Promise(function(C,B){var D={onSuccess:function(E){C(E)},onFailure:function(E){console.log("Unable to load underlying template content",E);B(E)}};this.openProcess(A,D)}.bind(this))},openActivityAsPromise:function(A){return new Promise(function(E,D){if(A===undefined||A===null){return}var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Activity?objectId="+A;r.get(A,B,{onComplete:function(F){var G=n.loadActivity(F);E(G)},onError:function(F){z.error("openProcess",F);D(F)}})}.bind(this))},getTemplateViews:function(A){return new Promise(function(E,D){if(A===undefined||A===null){return}var C=j.get3DSpaceUrl();var B=C+"/resources/slmservices/templateviews/"+A;r.get(A,B,{onComplete:function(G){var F=new w(G);E(F)},onError:function(F){z.error("openTemplate",F);D(F)}})}.bind(this))},updateData:function(D,G){var A=D;var F=G;if(A!==undefined&&A!==null){var C="";if(A.isActivity()){C="SMA_Activity"}else{if(A.isProcess()){C="SMA_Process"}}var E=j.get3DSpaceUrl();var B=E+"/resources/e6w/service/"+C+"?objectId="+A.getPhysicalId();r.get(A.getPhysicalId(),B,{onComplete:function(H){D.init(H.datarecords.datagroups[0]);D.setCEStamp(H.datarecords.datagroups[0].dataelements.cestamp.value[0].value);D.updateCEStamp("DATA");F.onSuccess(A)},onError:function(H){z.error("updateData",H);if(F.onFailure){F.onFailure(H)}}})}},refreshCEStamp:function(D,G){var A=D;var F=G;if(A!==undefined&&A!==null){var C="";if(A.isActivity()){C="SMA_Activity"}else{if(A.isProcess()){C="SMA_Process"}}var E=j.get3DSpaceUrl();var B=E+"/resources/e6w/service/"+C+"?objectId="+A.getPhysicalId();r.get(A.getPhysicalId(),B,{onComplete:function(H){D.setCEStamp(H.datarecords.datagroups[0].dataelements.cestamp.value[0].value);if(F&&F.onSuccess){F&&F.onSuccess(H)}},onError:function(H){if(F&&F.onFailure){F.onFailure(H)}}})}},createSeqFlow:function(M,K,L,P){if(!M||!P||K===undefined||L===undefined){return}if(K===null||L===null){P.onFailure(null);return}var E=M.getSeqFlows();var H=M.getFirstChild();var B=M.getLastChild();var G=P;var O={Outerflow:[]};if(H&&H.getId){O.Outerflow.push({firstChildID:H.getId()})}for(var F=0;F<E.length;F++){var N=E[F];if(N===undefined||N===null){continue}O.Outerflow.push(N._getData())}var D=new t({executionMode:"always",fromFlowItemID:K.getId(),toFlowItemID:L.getId()});O.Outerflow.push(D._getData());if(B===null&&M.getFirstChild()===null&&H!==null&&H.getId()===M.getId()){B=H}if(B!==null){O.Outerflow.push({executionMode:"always",fromFlowItemID:B.getId()})}var J={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:M.getoid(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(O)}]},cestamp:{value:[{value:M.getCEStamp()}]}}}],name:"SMA_Process"},name:"SMA_Process"};var I="updateWidget="+encodeURIComponent(JSON.stringify(J));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Process";r.post(M.getPhysicalId(),A,I,{onComplete:function(Q){M.addSeqFlow(D);M.setCEStamp(Q.datarecords.datagroups[0].dataelements.cestamp.value[0].value);f.openProcess(M.getProcess().getPhysicalId(),{onSuccess:function(R){M.getProcess().setCEStamp(R.getCEStamp());G.onSuccess(M)},onFailure:function(R){z.log("Failed to create sequenceflow - update process"+R)}})},onError:function(Q){z.error("createSeqFlow",Q);if(G.onFailure){G.onFailure(Q)}}})},updateSeqFlows:function(J,P,R,B,V,E){if(J===undefined||P===undefined||R===undefined||B===undefined||E===undefined){return}if(J===null||P===null||E===null){return}var N;var L=J.getSeqFlows();var A=J.getFirstChild();var T=J.getLastChild();var M=null,O=[];var K=E;var H={Outerflow:[]};if(V===true){if(R===null){H.Outerflow.push({firstChildID:P.getId()});A=P;if(B!==null){N=new t({executionMode:"always",fromFlowItemID:P.getId(),toFlowItemID:B.getId()});N.setParent(J);H.Outerflow.push(N._getData());O.push(N)}}else{if(B===null){if(A!==null){H.Outerflow.push({firstChildID:A.getId()})}if(R!==null){N=new t({executionMode:"always",fromFlowItemID:R.getId(),toFlowItemID:P.getId()});N.setParent(J);H.Outerflow.push(N._getData());O.push(N);T=P}}else{if(A!==null){H.Outerflow.push({firstChildID:A.getId()})}}}}else{if(A!==undefined&&A!==null){H.Outerflow.push({firstChildID:A.getId()})}}for(var I=0;I<L.length;I++){N=L[I];if(N===undefined||N===null){continue}var U=N.getFromFlowItem();var W=N.getToFlowItem();if(R!==null&&B!==null&&M===null&&U.getId()===R.getId()&&W.getId()===B.getId()&&V===true){M=N;var S=new t({executionMode:"always",fromFlowItemID:R.getId(),toFlowItemID:P.getId()});var G=new t({executionMode:"always",fromFlowItemID:P.getId(),toFlowItemID:B.getId()});H.Outerflow.push(S._getData());H.Outerflow.push(G._getData());S.setParent(J);G.setParent(J);O.push(S);O.push(G)}else{H.Outerflow.push(N._getData())}}if(T===null&&J.getFirstChild()===null&&A!==null&&A.getId()===P.getId()){T=A}if(T!==null){H.Outerflow.push({executionMode:"always",fromFlowItemID:T.getId()})}var Q={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:J.getoid(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(H)}]},cestamp:{value:[{value:J.getCEStamp()}]}}}],name:"SMA_Process"},name:"SMA_Process"};var C="updateWidget="+encodeURIComponent(JSON.stringify(Q));var F=j.get3DSpaceUrl();var D=F+"/resources/e6w/service/SMA_Process";r.post(J.getPhysicalId(),D,C,{onComplete:function(Y){J.setCEStamp(Y.datarecords.datagroups[0].dataelements.cestamp.value[0].value);if(A!==null){J.setFirstChild(A)}if(T!==null){J.setLastChild(T)}if(M!==null){J.removeSeqFlow(M)}for(var X=0;X<O.length;X++){J.addSeqFlow(O[X])}K.onSuccess(J)},onError:function(X){z.error("updateSeqFlows",X);if(K.onFailure){K.onFailure(X)}}})},saveSeqFlows:function(E,K){if(E===undefined||K===undefined){return}var D=E.getSeqFlows();var H=E.getFirstChild();var B=E.getLastChild();var F=K;var L={Outerflow:[]};L.Outerflow.push({firstChildID:H.getId()});for(var G=0;G<D.length;G++){L.Outerflow.push(D[G]._getData())}L.Outerflow.push({executionMode:"always",fromFlowItemID:B.getId()});var J={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:E.getoid(),dataelements:{sequenceFlows:{value:[{value:JSON.stringify(L)}]},cestamp:{value:[{value:E.getCEStamp()}]}}}],name:"SMA_Process"},name:"SMA_Process"};var I="updateWidget="+encodeURIComponent(JSON.stringify(J));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Process";r.post(E.getPhysicalId(),A,I,{onComplete:function(M){E.setCEStamp(M.datarecords.datagroups[0].dataelements.cestamp.value[0].value);F.onSuccess(E)},onError:function(M){if(F.onFailure){F.onFailure(M)}}})},createStep:function(E,M,N,K,I,O){var B=null,F="add",H=null;if(M!==null){B=M.getId();H=M;F="addBelow"}else{if(N!==null){B=N.getId();H=N;F="addAbove"}}var L={datarecords:{datagroups:[{updateAction:"CREATE",objectId:E.getPhysicalId(),dataelements:{stepName:{value:[{value:K}]},extensionName:{value:[{value:I}]},createAction:{value:[{value:F}]},cestamp:{value:[{value:E.getCEStamp()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var D=L.datarecords.datagroups[0].dataelements;if(B!==null){D.refStepId={value:[{value:B}]}}var J="updateWidget="+encodeURIComponent(JSON.stringify(L));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Step";var G=O;r.post(E.getPhysicalId(),A,J,{onComplete:function(S){E.setCEStamp(S.datarecords.datagroups[0].dataelements.cestamp.value[0].value);var P=E.getSteps();var Q={FlowItem:d.getJSON(S.datarecords.datagroups[0].dataelements.StepFlowItem.value[0].value)};var R=new b(Q);R.setParent(E);if(P.length===0){E.setFieldValue("mainStepID",R.getId())}E.addStep(R,H,F);G.onSuccess(R)},onError:function(P){z.error("createStep",P);G.onFailure(P)}})},deleteActivity:function(D,J){if(D===undefined||D===null){J.onFailure(null);return false}var I=D.getParent();var B=D.getProcess();if(B===undefined||B===null){J.onFailure(null);return false}var H={datarecords:{datagroups:[{updateAction:"DELETE",objectId:D.getPhysicalId(),dataelements:{cestamp:{value:[{value:D.getCEStamp()}]}}}],name:"SMA_Activity"},name:"SMA_Activity"};var G="updateWidget="+encodeURIComponent(JSON.stringify(H));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Activity";var E=J;var F=this;r.post(D.getPhysicalId(),A,G,{onComplete:function(){if(I===undefined||I===null){E.onSuccess(B);return false}F.updateData(I,{onSuccess:function(K){E.onSuccess(K)},onFailure:function(K){E.onFailure(K)}})},onError:function(K){E.onFailure(K)}})},deleteStep:function(B,I){if(B===undefined||B===null){I.onFailure(null);return false}var F=B.getId();var D=B.getParent();if(D===undefined||D===null){I.onFailure(null);return false}var H={datarecords:{datagroups:[{updateAction:"DELETE",objectId:D.getoid(),dataelements:{deleteStepId:{value:[{value:F}]},cestamp:{value:[{value:D.getCEStamp()}]}}}],name:"SMA_Step"},name:"SMA_Step"};var G="updateWidget="+encodeURIComponent(JSON.stringify(H));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Step";var E=I;r.post(D.getPhysicalId(),A,G,{onComplete:function(J){D.setCEStamp(J.datarecords.datagroups[0].dataelements.cestamp.value[0].value);D.removeStep(B);E.onSuccess(D)},onError:function(J){E.onFailure(J)}})},updateStep:function(D,G){if(D===undefined||D===null){return}var F=D.getId();var A=D.getParent();if(A.isUpToDate("STEP_"+F)===true){G.onSuccess(D);return}var E=G;var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Step?objectId="+A.getPhysicalId()+"&stepId="+F;r.get(A.getPhysicalId(),B,{onComplete:function(I){var H={FlowItem:d.getJSON(I.datarecords.datagroups[0].dataelements.StepFlowItem.value[0].value)};D.initialize(H);A.updateCEStamp("STEP_"+F,A.getCEStamp());E.onSuccess(D)},onError:function(H){z.error("updateStep",H);if(E.onFailure){E.onFailure(H)}}})},clearMainStep:function(D,G){var F=D.getParent();var E={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:F.getPhysicalId(),dataelements:{cestamp:{value:[{value:F.getCEStamp()}]},StepId:{value:[{value:D.getId()}]},mainStepId:{value:[{value:" "}]}}}],name:"SMA_Step"},name:"SMA_Step"};var A="updateWidget="+encodeURIComponent(JSON.stringify(E));var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Step";r.post(F.getPhysicalId(),B,A,{onComplete:function(I){F.setCEStamp(I.datarecords.datagroups[0].dataelements.cestamp.value[0].value);var H=F.getMainStep();F.setMainStep("");G.onSuccess(H)},onError:function(H){G.onFail(H)}})},updatePLMObject:function(C,D,L){var K={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:C.getPhysicalId(),dataelements:{}}],name:""},name:""};var H="";var J=C.getCEStamp();if(J){K.datarecords.datagroups[0].dataelements.cestamp={value:[{value:J}]}}if(C.isProcess()){K.name="SMA_Process";K.datarecords.name="SMA_Process";H="/resources/e6w/service/SMA_Process"}else{K.name="SMA_Activity";K.datarecords.name="SMA_Activity";H="/resources/e6w/service/SMA_Activity"}for(var F=0;F<D.length;F++){var G=C.getFieldValue(D[F]);if(G!==null&&G!==undefined){K.datarecords.datagroups[0].dataelements[D[F]]={value:[{value:G}]}}}var I="updateWidget="+encodeURIComponent(JSON.stringify(K));var E=L;var B=j.get3DSpaceUrl();var A=B+H;r.post(C.getPhysicalId(),A,I,{onComplete:function(M){C.setCEStamp(M.datarecords.datagroups[0].dataelements.cestamp.value[0].value);E.onSuccess(M)},onError:function(M){z.error("updatePLMObject",M);if(E.onFailure){E.onFailure(M)}}})},saveStep:function(B,I){var D=B.getParent();var E=B._getData().FlowItem;var H={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:D.getPhysicalId(),dataelements:{cestamp:{value:[{value:D.getCEStamp()}]},StepId:{value:[{value:B.getId()}]},StepFlowItem:{value:[{value:JSON.stringify(E)}]}}}],name:"SMA_Step"},name:"SMA_Step"};var G="updateWidget="+encodeURIComponent(JSON.stringify(H));var F=I;var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Step";r.post(D.getPhysicalId(),A,G,{onComplete:function(J){D.setCEStamp(J.datarecords.datagroups[0].dataelements.cestamp.value[0].value);D.updateCEStamp("STEP_"+B.getId(),D.getCEStamp());F.onSuccess(B)},onError:function(J){D.updateCEStamp("STEP_"+B.getId(),D.getCEStamp()+"dummy");z.error("saveStep",J);if(F.onFailure){F.onFailure(J)}}})},getExtensionDescriptor:function(C,G){var D=G;var F=f.extensionsDescriptorP[C];if(!F){var E=p.getExtension(C);if(E){F=Promise.resolve(E)}else{var B=f.get3DSpaceUrl();var A=B+"/resources/slmservices/activity/"+C+"/getExtensionDescriptor";F=new Promise(function(I,H){r.get(null,A,{onComplete:function(J){var K=new k(J);p.addExtension(K);I(K)},onError:function(J){H(J)}})})}}f.extensionsDescriptorP[C]=F;F.then(function(H){if(D&&D.onSuccess){D.onSuccess(H)}},function(H){z.error("getExtensionDescriptor",H);if(D&&D.onFailure){D.onFailure(H)}});return F},fetchAccess:function(D,E){D=this.getFIfromDataContainer(D);if(D===undefined||D===null){return}var C=E;var B=f.get3DSpaceUrl()+"/resources/e6w/service/SMA_Access";var A=B+"?id="+D.getoid();r.get(D.getoid(),A,{onComplete:function(F){C.onSuccess(F)},onError:function(F){z.error("fetchAccess",F);if(C.onFailure){C.onFailure(F)}}})},fetchCustomExtensionDescriptors:function(){return new Promise(function(C,B){var A="DS/SMAProcWebExtensions/assets/library/CustomLibRec.xml";require(["text!"+A],function(E){var K=new DOMParser();var G=K.parseFromString(E,"text/xml");var D=G.getElementsByTagName("librec");var H=[];for(var F=0;F<D.length;F++){var J=D[F].attributes.name.nodeValue;var I=D[F].attributes.path.nodeValue;if(J){p.addCustomExtensionPath(J,I);H.push(f.getExtensionDescriptor(J))}}Promise.all(H).then(C,B)},B)})},getBullettinBoardMessage:function(F,C,E,B,H){var D=H;var G=E+"/job/"+F+"/monitor?Topic="+B+"&Timestamp=0";var A={method:"GET",headers:{EEDTicket:C},onComplete:function(I){D.onSuccess(I)},onFailure:function(I){if(D.onFailure){D.onFailure(I)}}};r.normalRequest(G,A)},getStationList:function(E,C,G){var D=G;var B=E+"/admin/station/query";if(C!==null){var F=C.replace(/,/g,"&");B+="?"+F}var A={method:"GET",headers:{},onComplete:function(H){D.onSuccess(H)},onFailure:function(H){if(D.onFailure){D.onFailure(H)}}};r.normalRequest(B,A)},getFileContentsFromStation:function(C,F,E){var D=E;var A=C+"/SMAExeStation-REST/tail/"+F;var B={method:"GET",onComplete:function(G){D.onSuccess(G)},onFailure:function(G){if(D.onFailure){D.onFailure(G)}}};r.normalRequest(A,B)},stopStationRestService:function(C,E){var D=E;var A=C+"/SMAExeStation-REST/stop/";var B={method:"POST",onComplete:function(F){D.onSuccess(F)},onFailure:function(F){D.onFailure(F)}};r.normalRequest(A,B)},getContent:function(C,B,F){if(B.isUpToDate("CONTENT")){F.onSuccess(B);return}var E=F;var D=j.get3DSpaceUrl();var A=D+"/resources/e6w/service/SMA_Content?containerId="+B.getPhysicalId()+"&SIMULATIONId="+C.getPhysicalId()+"&expandLevel=0";r.get(B,A,{onComplete:function(I){B.removeAllChildContent();var G=I.datarecords.datagroups;if(G===undefined||G===null){E.onFailure(I);return}for(var H=0;H<G.length;H++){n.loadFIContent(G[H],B)}B.updateCEStamp("CONTENT",B.getCEStamp());E.onSuccess(B)},onError:function(G){z.error("getContent",G);if(E.onFailure){E.onFailure(G)}}})},deleteContentCategory:function(I,M){var D=null;var L={datarecords:{datagroups:[],name:""},name:""};var A=function A(P,N){var O={updateAction:"DISCONNECT",objectId:"",dataelements:{}};O.objectId=P.getPhysicalId();O.dataelements.contentId={value:[{value:N.getPhysicalId()}]};return O};var J=0;for(var H=0;I!==null&&H<I.length;H++){var E=I[H].contents;D=this.getFIfromDataContainer(I[H].activity);for(var F=0;E!==null&&F<E.length;F++){L.datarecords.datagroups[J]=A(D,E[F]);++J}}L.name="SMA_Content";L.datarecords.name="SMA_Content";var K="updateWidget="+encodeURIComponent(JSON.stringify(L));var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Content";var G=M;r.post(D,B,K,{onComplete:function(N){if(N!==undefined&&N.datarecords!==undefined&&N.datarecords.datagroups!==undefined&&Array.isArray(N.datarecords.datagroups)&&N.datarecords.datagroups[0]!==undefined&&N.datarecords.datagroups[0].dataelements!==undefined&&N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp!==undefined&&N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value!==undefined&&Array.isArray(N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value)&&N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0]!==undefined&&N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0].value!==undefined){D.setCEStamp(N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0].value);D.updateCEStamp("CONTENT",N.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0].value)}z.log("deleteContentCategory()::success");G.onSuccess(N)},onError:function(N){if(G.onFailure){G.onFailure(N)}z.warn("deleteContentCategory()::error")}})},CreateContentCategory:function(J,N){var E=null;var M={datarecords:{datagroups:[],name:""},name:""};var F=function A(S,O){var Q={updateAction:"CREATE",objectId:"",dataelements:{}};Q.objectId=S.getPhysicalId();var P=O._data.dataelements.name.value[0].value;P=P.replace(/ +/g,"");var R="type_SimulationCategory_"+P;Q.dataelements.type={value:[{value:"Simulation Category"}]};Q.dataelements.title={value:[{value:R}]};return Q};var K=0;for(var I=0;J!==null&&I<J.length;I++){var D=J[I].contents;E=this.getFIfromDataContainer(J[I].activity);for(var G=0;D!==null&&G<D.length;G++){M.datarecords.datagroups[K]=F(E,D[G]);++K}}M.name="SMA_Content";M.datarecords.name="SMA_Content";var L="updateWidget="+encodeURIComponent(JSON.stringify(M));var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Content";var H=N;r.post(E,B,L,{onComplete:function(O){if(O!==undefined&&O.datarecords!==undefined&&O.datarecords.datagroups!==undefined&&Array.isArray(O.datarecords.datagroups)&&O.datarecords.datagroups[0]!==undefined&&O.datarecords.datagroups[0].dataelements!==undefined&&O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp!==undefined&&O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value!==undefined&&Array.isArray(O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value)&&O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0]!==undefined&&O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0].value!==undefined){E.setCEStamp(O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0].value);E.updateCEStamp("CONTENT",O.datarecords.datagroups[0].dataelements.SIMULATIONCEStamp.value[0].value)}z.log("CreateContentCategory()::success");H.onSuccess(O)},onError:function(O){if(H.onFailure){H.onFailure(O)}z.warn("CreateContentCategory():: Error")}})},addReferencedContent:function(H,D,I,J){var G={datarecords:{datagroups:[{updateAction:"CONNECT",objectId:H.getPhysicalId(),dataelements:{containerId:{value:[{value:D.getPhysicalId()}]},contentId:{value:[{value:I}]}}}],name:"SMA_Content"},name:"SMA_Content"};var F="updateWidget="+encodeURIComponent(JSON.stringify(G));var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_Content";var C=J;var E=this;r.post(H.getPhysicalId(),A,F,{onComplete:function(N){D.setCEStamp(N.datarecords.datagroups[0].dataelements.containerCEStamp.value[0].value);var L=I;if(L&&L!==null){var M=E.get3DSpaceUrl();var K=M+"/resources/e6w/service/SMA_Content?containerId="+D.getPhysicalId()+"&SIMULATIONId="+H.getPhysicalId()+"&expandLevel=2";r.get(D,K,{onComplete:function(S){var O=S.datarecords.datagroups;if(O===undefined||O===null){C.onFailure(S);return}for(var P=0;P<O.length;P++){var R=new v(O[P]);var T=R.getPhysicalId();var Q=R.getoid();if(L===T||L===Q){R.setParent(D);D.addChildContent(R);C.onSuccess(R);return}}D.updateCEStamp("CONTENT",D.getCEStamp());C.onSuccess(D)},onError:function(O){z.error("addReferencedContent",O);if(C.onFailure){C.onFailure(O)}}})}},onError:function(K){z.error("addReferencedContent",K);if(C.onFailure){C.onFailure(K)}}})},createOwnedDocument:function(K,F,D,H,L){if(!K||!F){if(L&&L.onFailure){L.onFailure(new Error("Missing parent or container"))}z.error("createOwnedDocument: missing parent ("+K+") or content container ("+F+")");return}var B="Simulation Document - NonVersioned";if(true===Boolean(D)){B="Simulation Document - Versioned"}var J={datarecords:{datagroups:[{updateAction:"CREATE",objectId:K.getPhysicalId(),dataelements:{containerId:{value:[{value:F.getPhysicalId()}]},type:{value:[{value:B}]},title:{value:[{value:H}]}}}],name:"SMA_Content"},name:"SMA_Content"};var I="updateWidget="+encodeURIComponent(JSON.stringify(J));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Content";var E=L;var G=this;r.post(K.getPhysicalId(),A,I,{onComplete:function(P){F.setCEStamp(P.datarecords.datagroups[0].dataelements.containerCEStamp.value[0].value);var N=P.datarecords.datagroups[0].dataelements.contentId.value[0].value;if(N&&N!==null){var O=G.get3DSpaceUrl();var M=O+"/resources/e6w/service/SMA_Content?containerId="+F.getPhysicalId()+"&SIMULATIONId="+K.getPhysicalId();r.get(F,M,{onComplete:function(U){var Q=U.datarecords.datagroups;if(Q===undefined||Q===null){E.onFailure(U);return}for(var R=0;R<Q.length;R++){var T=new v(Q[R]);var V=T.getPhysicalId();var S=T.getoid();if(N===V||N===S){T.setParent(F);F.addChildContent(T);E.onSuccess(T);return}}F.updateCEStamp("CONTENT",F.getCEStamp());E.onSuccess(F)},onError:function(Q){z.error("createOwnedDocument",Q);if(E.onFailure){E.onFailure(Q)}}})}},onError:function(M){z.error("createOwnedDocument",M);E.onFailure(M)}})},createSimulationFolder:function(J,E,G,K){var B="Simulation Folder";var I={datarecords:{datagroups:[{updateAction:"CREATE",objectId:J.getPhysicalId(),dataelements:{containerId:{value:[{value:E.getPhysicalId()}]},type:{value:[{value:B}]},title:{value:[{value:G}]}}}],name:"SMA_Content"},name:"SMA_Content"};var H="updateWidget="+encodeURIComponent(JSON.stringify(I));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Content";var D=K;var F=this;r.post(J.getPhysicalId(),A,H,{onComplete:function(O){E.setCEStamp(O.datarecords.datagroups[0].dataelements.containerCEStamp.value[0].value);var M=O.datarecords.datagroups[0].dataelements.contentId.value[0].value;if(M&&M!==null){var N=F.get3DSpaceUrl();var L=N+"/resources/e6w/service/SMA_Content?containerId="+E.getPhysicalId()+"&SIMULATIONId="+J.getPhysicalId();r.get(E,L,{onComplete:function(T){var P=T.datarecords.datagroups;if(P===undefined||P===null){D.onFailure(T);return}for(var Q=0;Q<P.length;Q++){var S=new v(P[Q]);var U=S.getPhysicalId();var R=S.getoid();if(M===U||M===R){S.setParent(E);E.addChildContent(S);D.onSuccess(S);return}}E.updateCEStamp("CONTENT",E.getCEStamp());D.onSuccess(E)},onError:function(P){z.error("createSimulationFolder",P);if(D.onFailure){D.onFailure(P)}}})}},onError:function(L){z.error("createSimulationFolder",L);if(D.onFailure){D.onFailure(L)}}})},makeJsonForParam2:function(C,D){var B=[{Parameters:[],Id:C.getPhysicalId(),cestamp:C.getCEStamp()}];for(var A=0;D!==null&&A<D.length;A++){B[0].Parameters.push(f.getParameterObject(D[A]))}return B},getParameterObject:function(I){var F={};var E=I.getStructure();if(I.getId()){F.Id=I.getId()}F.Name=I.getName();F.Type=d.DataType.server.properties[I.getDataType()].name;F.Mode=d.Mode.server.properties[I.getMode()].name;var V=I.getAppDataArray();F.AppData=[];if(Array.isArray(V)){for(var U=0;U<V.length;U++){var R={};R.Key=V[U].appDataName+"."+V[U].appDataKey;R.Value=String(V[U].appDataValue);R.Index=V[U].appDataIndex;F.AppData.push(R)}}var O=d.Structure.server.properties[I.getStructure()].name;F.ValueType=O;var N=I.getDataSubType();if((typeof N==="number")&&N>-1){var S=d.DataSubType.server.properties[I.getDataSubType()].name;if(S){if(N===0){F.SubType=S}else{F.SubType=""}}}var W=I.getDescription();if(W||W===""){F.Description=W}if(E===d.Structure.client.Scalar){var J=I.getExpression();if(J||J===""){F.Expression=J}var Y=I.getValueAsString();if((Y==="")||Y){if(I._dataType===d.DataType.PLMObject){var B="";var L="";var K=I.getValue();if(K&&(typeof(K)==="object")){B=K.getoid();L=K.getFieldValue("simDataRelationshipUUID")}else{if(I.getParent&&I.getParent()){var D=I.getParent().getSimulationData(Y);if(D){B=D.getoid();L=Y}}}F.Value=L;F.SimDataId=B}else{F.Value=Y}}var G=I.getLimitType();if(G!==undefined&&G!==null&&G===d.LimitType.properties[0].value){var P=I.getLimits().slice(0);var Q=[];for(var H=0;H<P.length;H++){Q.push({Choice:P[H]})}F.Choices=Q}}else{if(E===d.Structure.client.Array){F.SizeOfArray=I.getDimensions().toString().replace(/,/g,"X");F.Dimension=I.getNumberOfDimensions().toString();F.Sizable=I.isSizable();if(I.getValues()!==undefined&&I.getValues()!==null){var T=I.getValues();var C=[];if(T){for(var M=0;M<T.length;M++){var A=I._valueHelperFunctions.indexToSubscript_RowMajor(I.getDimensions(),M).toString();C[M]={Index:A,Value:T[M].toString()}}F.Value=C}C=[];var X=I.getExpressions();if(X&&X.length>0){for(H=0;H<X.length;H++){C[H]={Value:X[H]?X[H]:""}}F.Expression=C}}}else{if(E===d.Structure.Aggregate){}}}return F},createParametersInPLM:function(A,H){var C=null,G=null,B,E,I,F;if(A&&A.length>0){C=this.getFIfromDataContainer(A[0].activity)}for(E=0;A!==null&&E<A.length;E++){I=A[E].parameters;G=f.makeJsonForParam2(C,I)}F="updateWidget="+encodeURIComponent(JSON.stringify(G));B=f.get3DSpaceUrl()+"/resources/slmservices/Parameters2";var D=H;r.post(C,B,F,{onComplete:function(K){var J=K&&K[0]&&K[0].cestamp;if(J){C.setCEStamp(J);C.updateCEStamp("PARAMETERS",J)}D.onSuccess(K)},onError:function(J){z.error("createParametersInPLM",J);if(D.onFailure){D.onFailure(J)}}})},refreshDataFlows:function(B,D){var A=this;var C=D&&D.onFailure||z.warn.bind(z);B.updateCEStamp("DATAFLOWS",null);this._getDataFlowsInPLM(B,{onSuccess:function(){var E=B.getParent();if(E){E.updateCEStamp("DATAFLOWS",null);A._getDataFlowsInPLM(E,{onSuccess:function(){A.refreshCEStamp(B,{onSuccess:function(){A.refreshCEStamp(E,D)},onFailure:function(F){z.error("refreshDataFlows",F);C(F)}})},onFailure:function(F){z.error("updateDataFlows",F);C(F)}})}else{A.refreshCEStamp(B,D)}},onFailure:function(E){z.error("updateDataFlows",E);C(E)}})},deleteParametersInPLM:function(C,M){var F=null;var L;var I;var G;var N;var B="";if(C&&C.length>0){F=this.getFIfromDataContainer(C[0].activity)}L={Id:F.getPhysicalId(),cestamp:F.getCEStamp(),paramIds:""};for(I=0;C!==null&&I<C.length;I++){N=C[I].parameters;for(G=0;N!==null&&G<N.length;G++){B=B+N[G].getId()+","}}B=B.substr(0,B.length-1);L.paramIds=B;var K="updateWidget="+encodeURIComponent(JSON.stringify(L));var D=f.get3DSpaceUrl()+"/resources/slmservices/Parameters2";var H=M;var E=function(P){var O=P&&P.cestamp;if(O){F.setCEStamp(O);F.updateCEStamp("PARAMETERS",O);f.refreshDataFlows(F,{onSuccess:function(){H.onSuccess(P)},onFailure:function(){z.log("CEStamp update failed")}})}else{H.onSuccess(P)}};var J=function(O){z.error("Failure for deleteParametersInPLM:",O,"\n  flowItem:",F,"\n  parameters",N);if(H.onFailure){H.onFailure(O)}};var A="delete";r[A](F,D,K,{onComplete:E,onError:J})},modifyParametersInPLM:function(B,K){var E=null;var J=null;var C,G,L,I;if(B&&B.length>0){E=this.getFIfromDataContainer(B[0].activity)}for(G=0;B!==null&&G<B.length;G++){L=B[G].parameters;J=f.makeJsonForParam2(E,L)}I="updateWidget="+encodeURIComponent(JSON.stringify(J));C=f.get3DSpaceUrl()+"/resources/slmservices/Parameters2";var F=K;var D=function(N){var M=N&&N[0]&&N[0].cestamp;if(M){E.setCEStamp(M);E.updateCEStamp("PARAMETERS",M);f.refreshDataFlows(E,{onSuccess:function(){F.onSuccess(N)},onFailure:function(){z.log("CEStamp update failed")}})}else{F.onSuccess(N)}};var H=function(M){z.error("modifyParametersInPLM",M);if(F.onFailure){F.onFailure(M)}};var A="put";r[A](E,C,I,{onComplete:D,onError:H})},getParametersInPLM:function(E,F){var D=this.getFIfromDataContainer(E);if(D===undefined||D===null){return}if(D.isUpToDate("PARAMETERS")){F.onSuccess(E);return}var C=F;var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_Parameter?objectId="+D.getoid();r.get(D.getoid(),A,{onComplete:function(G){try{n.loadParameters(D,d.getJSON(JSON.stringify(G)));C.onSuccess(D)}catch(H){if(C.onFailure){C.onFailure(H)}}},onError:function(G){z.error("getParametersInPLM",G);if(C.onFailure){C.onFailure(G)}}})},getParametersInPLM_Promise:function(A){return new Promise(function(E,D){if(A===undefined||A===null){D(new Error("Activity is not defined."))}else{var C=f.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_Parameter?objectId="+A.getoid();r.fetch(B).then(function(F){n.loadParameters(A,d.getJSON(JSON.stringify(F)));E(F)})["catch"](function(F){D(F)})}})},getConnectorsInPLM:function(D,C){var B=j.get3DSpaceUrl();var A=B+"/resources/slmservices/connectors/options";r.get(D.getoid(),A,{onComplete:function(E){if(C&&C.onSuccess){C.onSuccess(E)}},onError:function(){if(C&&C.onFailure){C.onFailure()}}})},createActivityConnectorRelationship:function(D,B){var C=this.get3DSpaceUrl();var A=C+"/resources/slmservices/connectors/relationship/"+D+"/"+B;return new Promise(function(F,E){r.post(D,A,"",{onComplete:F,onError:E})})},modifyActivityConnectorRelationship:function(E,C,A){var D=this.get3DSpaceUrl();var B=D+"/resources/slmservices/connectors/relationship/"+E+"/"+C+"?relUUID="+A;return new Promise(function(G,F){r.put(E,B,"",{onComplete:G,onError:F})})},deleteActivityConnectorRelationship:function(D,A){var C=this.get3DSpaceUrl();var B=C+"/resources/slmservices/connectors/relationship/"+D+"?relUUID="+A;return new Promise(function(F,E){r["delete"](D,B,"",{onComplete:F,onError:E})})},getParametersInPLMForAllNeighbours:function(D,E){if(!q(D)){return}var C=j.get3DSpaceUrl();var B=d.getAllNeighbouringActivities(D);var A=function(F){return new Promise(function(H,G){f.getParametersInPLM(F,{onSuccess:H,onFailure:G})})};Promise.all(B.map(A)).then(function(){var F=C+"/resources/e6w/service/SMA_ParameterMapping?simulationId="+D.getoid();r.get(D.getoid(),F,{onComplete:function(G){try{n.loadDataflows(D,G);E.onSuccess(D)}catch(H){z.error("getParametersInPLMForAllNeighbours loadDataflows",G);if(E.onFailure){E.onFailure(H)}}},onError:function(G){z.error("getParametersInPLMForAllNeighbours SMA_ParameterMapping",G);if(E.onFailure){E.onFailure(G)}}})},function(F){z.warn(F)})},getImpactedFIForDataflow:function(F){var E=[];for(var C=0;C<F.length;C+=1){var G=this.getFIfromDataContainer(F[C]);var B=G.getChildren();for(var D=0,A=B.length;D<A;D++){if(q(B[D])){E.push(B[D])}}}return E},getDataFlowsInPLM:function(I,J){var E=J&&J.onSuccess||z.info.bind(z);var D=this.getFIfromDataContainer(I);if(!q(D)){E();return}var G=this;if(D.isUpToDate("DATAFLOWS")){var H=f.getParentFIsDataContainer(I);if(H){var F=this.getFIfromDataContainer(H);if(F.isUpToDate("DATAFLOWS")){E(D);return}}else{E(D);return}}var B=this.getImpactedFIForDataflow([D]);B.push(D);var C=function(K){return new Promise(function(M,L){f.getParametersInPLM(K,{onSuccess:function(N){z.info(": parameters are loaded from PLM");return M(N)},onFailure:function(N){z.warn("parameters could not be loaded from PLM");return L(N)}})})};var A=Promise.resolve(null);B.forEach(function(K){A=A.then(C.bind(G,K))});A.then(function(){G._getDataFlowsInPLM(D,J)})},_getDataFlowsInPLM:function(E,F){var C=F&&F.onSuccess||z.info.bind(z);var D=F&&F.onFailure||z.warn.bind(z);var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_ParameterMapping?simulationId="+E.getoid();r.get(E.getoid(),A,{onComplete:function(G){try{n.loadDataflows(E,G);C(E)}catch(H){D(H)}},onError:function(G){z.error("_getDataFlowsInPLM",G);D(G)}},D)},getDataFlowsInPLM_Promise:function(A,B){return new Promise(function(F,E){var C=function(G,H){G.push(f.getParametersInPLM_Promise.call(undefined,H));return G};if(A===undefined||A===null){E(new Error("Input flow item  is not defined."))}else{if((typeof A.isActivity==="undefined")&&(typeof A.isProcess==="undefined")){E(new Error("Input flow item  should be an Activity or Process."))}else{if(!A.isActivity()&&!A.isProcess()){E(new Error("Input flow item  should be an Activity or Process."))}else{var D=f.getImpactedFIForDataflow([A]);D.push(A);Promise.all(D.reduce(C,[]).map(function(G){return G["catch"](function(H){return H})})).then(function(G){var J=B;var I=f.get3DSpaceUrl();var H=I+"/resources/e6w/service/SMA_ParameterMapping?simulationId="+A.getoid();r.get(A.getoid(),H,{onComplete:function(K){try{n.loadDataflows(A,K);if(J&&J.onSuccess){J.onSuccess(A)}F(A)}catch(L){if(J&&J.onFailure){J.onFailure(L)}E(L)}},onError:function(K){if(J&&J.onFailure){J.onFailure(K)}E(K)}})})["catch"](function(G){if(B&&B.onFailure){B.onFailure(G)}E(G)})}}}})},_JSONForDF:function(B){var F=[];for(var D=0;D<B.length;D+=1){var C=this.getFIfromDataContainer(B[D].getFromParameter().getParent());var A=this.getFIfromDataContainer(B[D].getToParameter().getParent());var E={fromParameterID:B[D].getFromParameter().getId(),fromFlowItemID:C.getId(),toParameterID:B[D].getToParameter().getId(),toFlowItemID:A.getId()};var H=B[D].getFromSlice();var G=2;if(H&&H.length>G){E.fromSlice=H.substring(1,H.length-1)}H=B[D].getToSlice();if(H&&H.length>G){E.toSlice=H.substring(1,H.length-1)}F.push(E)}return F},_createJSONFromDF2:function(C,A){var B=[{parameterMappings:[],id:C.getPhysicalId(),cestamp:C.getCEStamp()}];B[0].parameterMappings=B[0].parameterMappings.concat(this._JSONForDF(A));return B},_updateDataFlowsInPLM:function(C,K,F,J){var G=this.getFIfromDataContainer(C);if((!G)||(G===null)){return}var I=f._createJSONFromDF2(G,K);var A=f.get3DSpaceUrl()+"/resources/slmservices/Parameters2/mappings";var H="updateWidget="+encodeURIComponent(JSON.stringify(I));var D=J;var B=function(M){var L=M&&M[0]&&M[0].cestamp;if(L){G.setCEStamp(L);G.updateCEStamp("DATAFLOWS",L);G.updateCEStamp("PARAMETERS",L)}D.onSuccess(M)};var E=function(L){z.error("_updateDataFlowsInPLM",L);if(D.onFailure){D.onFailure(L)}};r[F](G,A,H,{onComplete:B,onError:E})},createDataFlowsInPLM:function(A,B,C){if(A&&B.length>0){this._updateDataFlowsInPLM(A,B,"post",{onSuccess:function(D){C.onSuccess(D)},onFailure:function(D){C.onFailure(D)}})}else{C.onSuccess()}},deleteDataFlowsInPLM:function(A,B,C){if(A&&B.length>0){this._updateDataFlowsInPLM(A,B,"delete",{onSuccess:function(F){for(var E=0,D=B.length;E<D;++E){A.removeDataFlow(B[E])}C.onSuccess(F)},onFailure:function(D){C.onFailure(D)}})}else{C.onSuccess()}},createGateway:function(M,I,J,K,D,N){var L={datarecords:{datagroups:[{updateAction:"CREATE",dataelements:{}}],name:""},name:""};L.name="SMA_Gateway";L.datarecords.name="SMA_Gateway";var F=L.datarecords.datagroups[0].dataelements;F.parentId={value:[{value:M.getPhysicalId()}]};F.title={value:[{value:I}]};F.createAction={value:[{value:"addAbove"}]};var H="updateWidget="+encodeURIComponent(JSON.stringify(L));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Gateway";var E=N;var G=this;var B=this.currentProcess;r.post(M.getPhysicalId(),A,H,{onComplete:function(P){var R={};R.id=P.datarecords.datagroups[0].dataelements.id.value[0].value;R.name=P.datarecords.datagroups[0].dataelements.title.value[0].value;M.setCEStamp(P.datarecords.datagroups[0].dataelements.cestamp.value[0].value);var Q=new e(R);Q.setProcess({connected:true});Q.setParent(M);M.addChild(Q);B.addActivity(Q);Q.setProcess(B);var O=E;G.updateSeqFlows(M,Q,J,K,D,{onSuccess:function(){O.onSuccess(Q)},onFailure:function(S){z.error("createGateway",S);if(O.onFailure){O.onFailure(S)}}})},onError:function(O){z.error("createGateway",O);if(E.onFailure){E.onFailure(O)}}})},getActivityExecOptions:function(D,E){if(D===undefined||D===null){return}if(D.isUpToDate("EXECOPTIONS")){E.onSuccess(D);return}var C=E;var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_ActExeOption?objectId="+D.getoid();r.get(D.getPhysicalId(),A,{onComplete:function(F){var G=new a(F.datarecords.datagroups[0].dataelements);D.setExecutionOptions(G);D.updateCEStamp("EXECOPTIONS",D.getCEStamp());C.onSuccess(D)},onError:function(F){z.error("getActivityExecOptions",F);if(C.onFailure){C.onFailure(F)}}})},modifyActivityExecOptions:function(F,H){if(F===undefined||F===null){return}var E={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:F.getPhysicalId(),dataelements:{}}],name:""},name:""};E.name="SMA_ActExeOption";E.datarecords.name="SMA_ActExeOption";var G=F.getExecutionOptions();G.setPropertyValue("cestamp",F.getCEStamp());E.datarecords.datagroups[0].dataelements=G.getProperties();var A="updateWidget="+encodeURIComponent(JSON.stringify(E));var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_ActExeOption";var D=H;r.post(F.getPhysicalId(),B,A,{onComplete:function(I){var J=new a(I.datarecords.datagroups[0].dataelements);F.setExecutionOptions(J);F.setCEStamp(I.datarecords.datagroups[0].dataelements.cestamp.value[0].value);F.updateCEStamp("EXECOPTIONS",F.getCEStamp());D.onSuccess(F)},onError:function(I){F.updateCEStamp("EXECOPTIONS",F.getCEStamp()+"dummy");z.error("modifyActivityExecOptions",I);if(D.onFailure){D.onFailure(I)}}})},getProcessExecOptions:function(D,E){if(D===undefined||D===null){return}if(D.isUpToDate("EXECOPTIONS")){E.onSuccess(D);return}var C=E;var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_SimExeOption?objectId="+D.getoid();r.get(D.getPhysicalId(),A,{onComplete:function(F){var G=new a(F.datarecords.datagroups[0].dataelements);D.setExecutionOptions(G);D.updateCEStamp("EXECOPTIONS",D.getCEStamp());C.onSuccess(D)},onError:function(F){z.error("getProcessExecOptions",F);if(C.onFailure){C.onFailure(F)}}})},modifyProcessExecOptions:function(F,H){if(F===undefined||F===null){return}var E={datarecords:{datagroups:[{updateAction:"MODIFY",objectId:F.getPhysicalId(),dataelements:{}}],name:""},name:""};E.name="SMA_SimExeOption";E.datarecords.name="SMA_SimExeOption";var G=F.getExecutionOptions();G.setPropertyValue("cestamp",F.getCEStamp());E.datarecords.datagroups[0].dataelements=G.getProperties();var A="updateWidget="+encodeURIComponent(JSON.stringify(E));var C=j.get3DSpaceUrl();var B=C+"/resources/e6w/service/SMA_SimExeOption";var D=H;r.post(F.getPhysicalId(),B,A,{onComplete:function(I){var J=new a(I.datarecords.datagroups[0].dataelements);F.setExecutionOptions(J);F.setCEStamp(I.datarecords.datagroups[0].dataelements.cestamp.value[0].value);F.updateCEStamp("EXECOPTIONS",F.getCEStamp());D.onSuccess(F)},onError:function(I){F.updateCEStamp("EXECOPTIONS",F.getCEStamp()+"dummy");z.error("modifyProcessExecOptions",I);if(D.onFailure){D.onFailure(I)}}})},getAllSimulationData:function(E,F){var D=this.getFIfromDataContainer(E);if(D===undefined||D===null){return}if(D.isUpToDate("SIMULATION_DATA")){F.onSuccess(E);return}var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_SimulationData?dataContainerId="+D.getPhysicalId()+"&getAllSimulationData=true";var C=F;r.get(D.getPhysicalId(),A,{onComplete:function(G){n.loadSimulationData(D,G);C.onSuccess(D)},onError:function(G){z.error("getAllSimulationData",G);if(C.onFailure){C.onFailure(G)}}})},addSimulationData:function(G,A,H){if(G===undefined||G===null||A===undefined||A===null){return}var F={datarecords:{datagroups:[{updateAction:"CONNECT",dataelements:{dataContainerId:{value:[{value:G.getPhysicalId()}]},simulationDataId:{value:[{value:A}]}}}],name:"SMA_SimulationData"},name:"SMA_SimulationData"};var B="updateWidget="+encodeURIComponent(JSON.stringify(F));var D=j.get3DSpaceUrl();var C=D+"/resources/e6w/service/SMA_SimulationData";var E=H;r.post(G.getPhysicalId(),C,B,{onComplete:function(K){var J=K.datarecords.datagroups[0].dataelements.simDataRelationshipUUID.value[0].value;var I=D+"/resources/e6w/service/SMA_SimulationData?dataContainerId="+G.getPhysicalId()+"&simDataRelationshipUUID="+J;r.get(G.getPhysicalId(),I,{onComplete:function(L){var N=L.datarecords.datagroups[0];var M=new g(N);G.addSimulationData(M);E.onSuccess(G)},onError:function(L){z.error("addSimulationData",L);if(E.onFailure){E.onFailure(L)}}})},onError:function(I){z.error("addSimulationData",I);if(E.onFailure){E.onFailure(I)}}})},removeSimulationData:function(C,I,H){if(C===undefined||C===null||I===undefined||I===null){return}var E=(I instanceof String)?I:I.getFieldValue("simDataRelationshipUUID");var G={datarecords:{datagroups:[{updateAction:"DISCONNECT",dataelements:{dataContainerId:{value:[{value:C.getPhysicalId()}]},simDataRelationshipUUID:{value:[{value:E}]}}}],name:"SMA_SimulationData"},name:"SMA_SimulationData"};var F="updateWidget="+encodeURIComponent(JSON.stringify(G));var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_SimulationData";var D=H;r.post(C.getPhysicalId(),A,F,{onComplete:function(){C.removeSimulationData(E);D.onSuccess(C)},onError:function(J){z.error("removeSimulationData",J);if(D.onFailure){D.onFailure(J)}}})},saveTempSimulationData_Promise:function(C){var B=this;var D=function(G,E){var F=(E||[]).map(function(H){return new Promise(function(N,M){var K=H.getFieldValue("simDataRelationshipUUID");var O={datarecords:{datagroups:[{updateAction:G,dataelements:{dataContainerId:{value:[{value:C.getPhysicalId()}]},simulationDataId:{value:[{value:H.getPhysicalId()||H.getoid()}]},simDataRelationshipUUID:{value:[{value:K}]}}}],name:"SMA_SimulationData"},name:"SMA_SimulationData"};var I="updateWidget="+encodeURIComponent(JSON.stringify(O));var L=B.get3DSpaceUrl();var J=L+"/resources/e6w/service/SMA_SimulationData";r.post(C.getPhysicalId(),J,I,{onComplete:function(P){N(P)},onError:function(P){M(new Error("Error occured in updating the simulation data relationship, reason:"+P))}})})});return F};var A=function(E){return new Promise(function(H,G){if(!E){G(new Error("Activity is not defined"))}if((typeof E.isActivity==="undefined")){G(new Error("Input activity item in should be an Activity."))}var I=E.getAllTempSimulationDataToRemove();var F=D("DISCONNECT",I);Promise.all(F).then(function(J){J.map(function(K){return E.removeSimulationData(K.datarecords.datagroups[0].dataelements.simDataRelationshipUUID.value[0].value)});H(E)})["catch"](function(J){G(new Error("Web service to remove simulationd data failed"+J))})})};return new Promise(function(H,G){if(!C){G(new Error("Activity is not defined"))}if((typeof C.isActivity==="undefined")){G(new Error("Input activity item in should be an Activity."))}var E=C.getAllTempSimulationData();var F=D("CONNECT",E);Promise.all(F).then(function(I){I.forEach(function(J){var K=C.getTempSimulationData(J.datarecords.datagroups[0].dataelements.simDataRelationshipUUID.value[0].value);C.addSimulationData(K)});C.removeAllTempSimulationData()}).then(function(){return A(C)}).then(function(){H(C)})["catch"](function(I){G(new Error("Error occureed in updating simulation data relationship, reson:"+I))})})},saveTempSimulationData:function(C,J){if(!C){return}var G=C.getAllTempSimulationData();var F=C.getAllTempSimulationDataToRemove();var D=J;var K;if(G.length>0){K=G[0];var E=K.getFieldValue("simDataRelationshipUUID");var I={datarecords:{datagroups:[{updateAction:"CONNECT",dataelements:{dataContainerId:{value:[{value:C.getPhysicalId()}]},simulationDataId:{value:[{value:K.getPhysicalId()||K.getoid()}]},simDataRelationshipUUID:{value:[{value:E}]}}}],name:"SMA_SimulationData"},name:"SMA_SimulationData"};var H="updateWidget="+encodeURIComponent(JSON.stringify(I));var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_SimulationData";r.post(C.getPhysicalId(),A,H,{onComplete:function(M){var N=C.getTempSimulationData(M.datarecords.datagroups[0].dataelements.simDataRelationshipUUID.value[0].value);C.addSimulationData(N);C.removeAllTempSimulationData();if(F.length>0){var L=F[0];this.removeSimulationData(C,L,{onSuccess:function(O){var P=C.getTempSimulationData(O.datarecords.datagroups[0].dataelements.simDataRelationshipUUID.value[0].value);C.removeSimulationData(P);C.removeAllTempSimulationDataToRemove();D.onSuccess(C)},onFailure:function(O){D.onFailure(O)}})}else{D.onSuccess(C)}},onError:function(L){z.error("saveTempSimulationData",L);if(D.onFailure){D.onFailure(L)}}})}else{if(F.length>0){K=F[0];this.removeSimulationData(C,K,{onSuccess:function(){C.removeSimulationData(K);C.removeAllTempSimulationDataToRemove();D.onSuccess(C)},onFailure:function(L){D.onFailure(L)}})}else{D.onSuccess(C)}}},getOccurencePath:function(E,B,F){if(E===undefined||E===null||B===undefined||B===null){return}var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Path?ownerId="+E.getPhysicalId()+"&referenceId="+B;var D=F;r.get(E.getPhysicalId(),A,{onComplete:function(G){var I=G.datarecords.datagroups;var H=E.getPathObject(B);if(H!==null){H.initialize(I)}else{H=new m(I);if(B&&B!==null){H.setId(B)}E.addPathObject(H)}D.onSuccess(H)},onError:function(G){z.error("getOccurencePath",G);if(D.onFailure){D.onFailure(G)}}})},addOccurencePath:function(C,H,E,I){if(C===undefined||C===null||H===undefined||H===null){return}var G={datarecords:{datagroups:[{updateAction:"CREATE",objectId:C.getPhysicalId(),dataelements:{pathElementsInOrder:{value:[{value:H}]},referenceId:{value:[{value:(E&&E!==null)?E:""}]}}}],name:"SMA_Path"},name:"SMA_Path"};var F="updateWidget="+encodeURIComponent(JSON.stringify(G));var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_Path";var D=I;r.post(C.getPhysicalId(),A,F,{onComplete:function(K){E=K.datarecords.datagroups[0].dataelements.referenceId.value[0].value;var J=B+"/resources/e6w/service/SMA_Path?ownerId="+C.getPhysicalId()+"&referenceId="+E;r.get(C.getPhysicalId(),J,{onComplete:function(L){var N=L.datarecords.datagroups;var M=new m(N);if(E&&E!==null){M.setId(E)}C.addPathObject(M);D.onSuccess(C)},onError:function(L){z.error("addOccurencePath",L);if(D.onFailure){D.onFailure(L)}}})},onError:function(J){z.error("addOccurencePath",J);if(D.onFailure){D.onFailure(J)}}})},removeOccurencePath:function(D,B,I){if(D===undefined||D===null||B===undefined||B===null){return}var F=(B instanceof String)?B:B.getId();var H={datarecords:{datagroups:[{updateAction:"DELETE",dataelements:{referenceId:{value:[{value:F}]}}}],name:"SMA_Path"},name:"SMA_Path"};var G="updateWidget="+encodeURIComponent(JSON.stringify(H));var C=j.get3DSpaceUrl();var A=C+"/resources/e6w/service/SMA_Path";var E=I;r.post(D.getPhysicalId(),A,G,{onComplete:function(){D.removePathObject(F);E.onSuccess(D)},onError:function(J){z.error("removeOccurencePath",J);if(E.onFailure){E.onFailure(J)}}})},saveTempOccurencePath:function(E,G){if(E===undefined||E===null){return}var C=E.getAllTempPathObject();var B=E.getAllTempPathObjectToRemove();var D=G;var F;if(C.length>0){F=C[0];var A=F.getOccPath();this.addOccurencePath(E,A,F.getId(),{onSuccess:function(){E.removeAllTempPathObject();D.onSuccess(E)},onFailure:function(H){z.error("saveTempOccurencePath",H);if(D.onFailure){D.onFailure(H)}}})}else{if(B.length>0){F=B[0];this.removeOccurencePath(E,F,{onSuccess:function(){E.removeAllTempPathObjectToRemove();D.onSuccess(E)},onFailure:function(H){D.onFailure(H)}})}}},downloadFileFromDocument:function(F,A,G,H){var D=H;var E=this;var C=function(K){var M,S,L,N;S=d.parseXML(K,"text/xml");N=S.getElementsByTagName("Ticket")[0].textContent;M=S.getElementsByTagName("FileName")[0].textContent;L=S.getElementsByTagName("FcsUrl")[0].textContent;if(G!==null){var Q=/(?:\.([^./]+))?$/;var J=M.split(/\.[^.]+$/)[0];J=J+" (ver"+G+")";var T=Q.exec(M)[1];if(T){M=J+"."+T}else{M=J}}var P=L+"/"+M;var O=function(V){var U=new Blob([V],{type:"text/plain"});z.info('file "'+M+'" downloaded from FCS');D.onSuccess(U)};var R={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"***"},data:{__fcs__jobTicket:N},responseType:"text",onComplete:O,onError:function(U){z.warn('file "'+M+'" failed to download from FCS');D.onFailure(U)}};r.normalRequest(P,R)};var I={method:"GET",responseType:"text",headers:{"Content-Type":"text/plain",Accept:"*/*"},allowCrossOriginRequest:true,onComplete:C,onError:function(J){if(J instanceof String){z.warn(J)}D.onFailure(J)}};var B=E.get3DSpaceUrl()+"/resources/slmservices/fcs/ticket?action=download&oid="+F+"&fname="+A;r._request(B,I)},uploadFileToDocument:function(F,C,A,H){var D=H;var E=this;var G=function(O){var M,L,N;var K=JSON.parse(O);M=d.parseXML(K.fcsTicket,"text/xml");L=M.getElementsByTagName("Ticket")[0].textContent;N=M.getElementsByTagName("FcsUrl")[0].textContent;delete K.fcsTicket;var P=new FormData();P.append("csrfTokenName",r.getCsrfTokenName());P.append("noOfFiles","1");P.append("__fcs__jobTicket",L);P.append("bfile0",C,A);P.append("fileName0",A);P.append("format0","generic");var J=function(S){var R=E.get3DSpaceUrl()+"/resources/slmservices/fcs/commit";var T={method:"PUT",headers:{Accept:"text/plain"},data:S,onComplete:function(){var U={dataelements:{name:{value:[{value:A}]}}};var V=new u(U);F.addFile(V);D.onSuccess(K)},onFailure:function(U){z.error("uploadFileToDocument",U);if(D.onFailure){D.onFailure(U)}}};r._request(R,T)};var Q={method:"POST",headers:{Accept:"text/plain"},data:P,responseType:"text",onComplete:J,onFailure:D.onFailure,timeout:0};r.normalRequest(N,Q)};var I={method:"PUT",responseType:"text",onComplete:G,onFailure:D.onFailure};var B=j.get3DSpaceUrl()+"/resources/slmservices/fcs/checkin?oid="+F.getoid()+"&dname="+A;r._request(B,I)},getExtensionsByPluginType:function(D,E){if(!D){return}var B=j.get3DSpaceUrl();var A=B+"/resources/e6w/service/SMA_ExtnSearch?tag=Attribute&attribute=name&attrValue=PluginType&value="+D;var C=E;r.get(null,A,{onComplete:function(I){z.log("Extension information using plugin type: ",I);var G=I.datarecords.datagroups;if(G===undefined||G===null){C.onFailure(I);return}var F=[];for(var H=0;H<G.length;H++){F.push(G[H].dataelements.value.value[0].value)}C.onSuccess(F)},onError:function(F){z.error("getExtensionsByPluginType SMA_ExtnSearch failed",F);if(C.onFailure){C.onFailure(F)}}})},substituteExpression:function(D,F){var E=/\$\{PARAMETER\[(\w+)\]\}/g;var B=D&&D.getPotentialParameters&&D.getPotentialParameters();var C=B&&B.self||[];var A=(F||"").replace(E,function(G,I){for(var H=0;H<C.length;H++){if(C[H]&&C[H].getName()===I){return C[H].getValue()}}return G});return A},getFIfromDataContainer:function(D){var B=null;var C=D&&D.isActivity&&D.isActivity();var A=D&&D.isProcess&&D.isProcess();if(C||A){B=D}else{if(this.getCurrentProcess()){B=this.getCurrentProcess().getFIfromDataContainer(D)}}return B},getParentFIsDataContainer:function(A){var B;B=f.getFIfromDataContainer(A);if(B&&B.getParent&&B.getParent()){return B.getParent().getDataContainer()}return undefined},getAttributeGroups:function(A,E){if(A===undefined||A===null){return}var D=E;var C=j.get3DSpaceUrl();var B=C+"/resources/slmservices/simulations/getAttributeDetails?simId="+A;r.get(A,B,{onComplete:function(F){var G=n.loadAttributeGroups(F);D.onSuccess(G)},onError:function(F){z.error("getAttributeGroup ",F);if(D.onFailure){D.onFailure(F)}}})},getFIFromId:function(C){var A=this.currentProcess;var B;if(A.getId()===C||A.getPhysicalId()===C||A.getoid()===C){B=A}else{B=A.getActivityFromId(C)}return B}};Object.defineProperty(f,"ThreeDSpaceUrl",{get:function(){return j.get3DSpaceUrl()},set:function(A){j.set3DSpaceUrl(A)}});Object.defineProperty(f,"isInit",{get:function(){return j.initialized},set:function(){console.warn("SMAJSCMMAuthoringUtils.isInit is deprecated, please use SMAJSCMMConfig.initialized instead")}});return f});define("DS/SMAProcWebCMMUtils/SMAProcWebEventHandler",["DS/SMAProcWebCMMUtils/PubSub","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/PlatformAPI/PlatformAPI"],function(a,c,b){var d={subscribeToInternalEvents:function(){console.log("subscribe to internal events")},subscribeToExternalEvents:function(e){b.subscribe(e,function(h){var g=h.data.authored.modified[0];var f=c.getFIFromId(g);if(f){c.refreshCEStamp(f,{onSuccess:function(i){d.updateFI(f,i.datarecords.datagroups[0])},onFailure:function(i){console.warn("SMAProcWebEventHandler error:",i)}})}})},subscribeToPSEvents:function(e){b.subscribe(e,function(i){var h=i.physicalId;if(!h){h=i.processId}var f="";if(i.status){f=i.status}if(f){d.publishEvents("jobStatusChanged",f)}var g=c.getFIFromId(h);if(g){c.refreshCEStamp(g,{onSuccess:function(j){j.datarecords.datagroups.forEach(function(k){var l=c.getFIFromId(k.physicalId);d.updateFI(l,k)})},onFailure:function(j){console.warn("SMAProcWebEventHandler error:",j)}})}})},publishEvents:function(e,f){a.dispatch(e,f)},addListenerToEvents:function(e,g,f){a.add(e,g,f)},removeListenerFromEvents:function(e,f){a.remove(e,f)},hasListener:function(e){return a.has(e)},updateFI:function(g,f){var e={};e.title=f.dataelements.title.value[0].value;e.description=f.dataelements.description.value[0].value;g.setFieldValue("title",e.title);g.setFieldValue("description",e.description);g.setFieldValue("state",f.dataelements.state.value[0].value);g.setCEStamp(f.cestamp);if(!g.isActivity()){g.setFieldValue("kind",f.dataelements.kind.value[0].value);e.plmobject=g;d.publishEvents("processChanged",e)}else{e.plmobject=g;d.publishEvents("activityChanged",e)}}};return d});define("DS/SMAProcWebCMMUtils/SMAJSCMMDataContainerUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/JSCMM/SMAJSCMMUtils","DS/Logger/Logger","module"],function(d,f,b,e){var c=b.getLogger(e);var a={getFIfromDataContainer:function(h){var g=null;if(h){if(d&&d.getCurrentProcess&&d.getCurrentProcess()){return d.getFIfromDataContainer(h)}}return g},getFI:function(g){var h=null;if(g.isActivity||g.isProcess){h=g}else{h=a.getFIfromDataContainer(g)}return h},getDataContainer:function(g){var h=null;if(g&&(g.isActivity||g.isProcess)){h=g.getDataContainer()}else{h=g}return h},getOwningFI:function(h){var i=null;if(h){var g=h.getParent();if(g){if(g.isActivity||g.isProcess){i=g}else{i=a.getFIfromDataContainer(g)}}}return i},getParentDataContainer:function(i){var h=this.getFI(i);var g=h.getParent()&&h.getParent().getDataContainer();return g},getChildDataContainers:function(l){var j=[];var k=this.getFI(l);var g=k.getChildren();for(var h=0;h<g.length;h++){if(!g[h].isGateway()){j.push(g[h].getDataContainer())}}return j},getDownStreamDataContainers:function(n){var j=[];var m=this.getFI(n);var l=this.getFI(n).getParent();var g=f.getChildrenInOrder(l);var k=g.indexOf(m);for(var h=k+1;h<g.length;h++){if(!g[h].isGateway()){j.push(g[h].getDataContainer())}}return j},getUpStreamDataContainers:function(n){var j=[];var m=this.getFI(n);var l=this.getFI(n).getParent();var g=f.getChildrenInOrder(l);var k=g.indexOf(m);for(var h=0;h<k;h++){if(!g[h].isGateway()){j.push(g[h].getDataContainer())}}return j},getAllSiblingDataContainers:function(n){var m=[];var l=this.getFI(n);var k=this.getFI(n).getParent();var g=f.getChildrenInOrder(k);var j=g.indexOf(l);for(var h=0;h<g.length;h++){if(h!==j&&!g[h].isGateway()){m.push(g[h].getDataContainer())}}return m},getAffectedDataContainers:function(k){var h={unsavedChanges:false,dataContainerArray:[]};h.dataContainerArray.push(k);h.unsavedChanges=this.hasTemporaryData(k);var g=this.getParentDataContainer(k);if(g){h.dataContainerArray.push(g);if(!h.unsavedChanges){h.unsavedChanges=this.hasTemporaryData(g)}}var i=this.getChildDataContainers(k);if(i.length>0){i.forEach(function(l){h.dataContainerArray.push(l);if(!h.unsavedChanges){h.unsavedChanges=this.hasTemporaryData(l)}}.bind(this))}var j=this.getAllSiblingDataContainers(k);if(j.length>0){j.forEach(function(l){h.dataContainerArray.push(l);if(!h.unsavedChanges){h.unsavedChanges=this.hasTemporaryData(l)}}.bind(this))}return h},hasTemporaryData:function(g){if(g._tempCreatedDataflowsArray&&g._tempCreatedDataflowsArray.length>0){return true}if(g._tempCreatedParametersArray&&g._tempCreatedParametersArray.length>0){return true}if(g._tempDeletedDataflowsArray&&g._tempDeletedDataflowsArray.length>0){return true}if(g._tempDeletedParametersArray&&g._tempDeletedParametersArray.length>0){return true}if(g._tempModifiedParametersArray&&g._tempModifiedParametersArray.length>0){return true}return false}};return a});define("DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMCommonServices","DS/SMAProcWebCMMUtils/SMAJSCMMUtils","DS/JSCMM/SMAJSCMMActivity","DS/JSCMM/SMAJSCMMPLMObject","DS/JSCMM/SMAJSCMMParameter","DS/JSCMM/SMAJSCMMContent","DS/SMAProcWebCMMUtils/SMAJSCMMDataContainerUtils"],function(i,d,b,h,f,e,a,c){var g={getExtensionConfigXmlDOMDoc:function(k){var j=null;var m="StepConfig";var l=k.getElementsByTagName(m);if(l.length>0){j=l[0]}return j},getActivitySelection:function(m){var n=(new DOMParser()).parseFromString(m,"text/xml");var l=n.getElementsByTagName("Request")[0];var p=l.getAttribute("id");var k={source:"",destination:""};if(p==="ActivitySelection"){var o=n.getElementsByTagName("Activity")[0];var j=o.getAttribute("selectState");if(j!=="DESTINATION"){k.source=o.getAttribute("id")}else{k.destination=o.getAttribute("id")}if(n.getElementsByTagName("Activity").length>1){o=n.getElementsByTagName("Activity")[1];j=o.getAttribute("selectState");if(j!=="DESTINATION"){k.source=o.getAttribute("id")}else{k.destination=o.getAttribute("id")}}}return k},_getParametersXmlDOMDoc:function(k,m){var j=null;var l=k.getElementsByTagName(m);if(l.length>0){j=l[0]}return j},_dataflowXMLtoJSON:function(q){var t={};t.datarecords={};t.datarecords.datagroups=[];var k=q.getElementsByTagName("DataFlow");for(var p=0;p<k.length;p++){var s={};s.dataelements={};var m=k[p];var o=m.attributes;if(o!==undefined&&o!==null&&o.length>0){for(var n=0;n<o.length;n++){var r=o[n];var l={value:[{value:r.value}]};s.dataelements[r.name]=l}}t.datarecords.datagroups.push(s)}return t},_parameterXMLtoJSON:function(q){var w={};w.datarecords={};w.datarecords.datagroups=[];var v=q.getElementsByTagName("Parameter");for(var p=0;p<v.length;p++){var l={};l.dataelements={};var x=v[p];var o=x.attributes;var k,n;if(o!==undefined&&o!==null&&o.length>0){for(n=0;n<o.length;n++){var r=o[n];k={value:[{value:r.value}]};l.dataelements[r.name]=k;if(r.name==="id"){l.objectId=r.value}}}var t="0";var u=x.getElementsByTagName("Value");if(u.length>0){var m=x.getAttribute("valuetype");var s=[];if(m==="array"){for(n=0;n<u.length;n+=1){t=u[n].textContent;s.push({value:t})}}else{t=u[0].textContent;s.push({value:t})}k={value:s}}l.dataelements.Value=k;w.datarecords.datagroups.push(l)}return w},JSCMMPropertyToXML:function(l,q,p){p.setAttribute("name",q.name);if("valuetype" in q){p.setAttribute("valuetype",q.valuetype)}if("type" in q){p.setAttribute("type",q.type||"string")}if("subtype" in q){p.setAttribute("subtype",q.type)}if(q.mode!==undefined&&q.mode!==null){p.setAttribute("mode",q.mode)}var n=q.Value;if(n!==undefined&&n!==null){if("<![CDATA]>" in n){var j=n["<![CDATA]>"];var o=l.createElement("Value");p.appendChild(o);var k=l.createCDATASection(j);o.appendChild(k)}else{if("<TEXT>" in n){var j=n["<TEXT>"];var o=l.createElement("Value");p.appendChild(o);var m=l.createTextNode(j);o.appendChild(m)}}}},JSCMMAggregatePropToXML:function(m,q,o){var p=m.createElement("Property");p.setAttribute("name",q.name);p.setAttribute("type","aggregate");o.appendChild(p);var j;if("Property" in q){j=q.Property}for(var k=0;k<j.length;k++){var n=j[k];if("type" in n&&n.type.toUpperCase()==="AGGREGATE"){this.JSCMMAggregatePropToXML(m,n,p)}else{if("type" in n&&n.valuetype.toUpperCase()==="ARRAY"){this.JSCMMArrayPropertyToXML(m,n,p)}else{var l=m.createElement("Property");p.appendChild(l);l.setAttribute("name",q.name);this.JSCMMPropertyToXML(m,n,l)}}}},JSCMMArrayPropertyToXML:function(r,j,q){var m=r.createElement("Property");m.setAttribute("name",j.name);m.setAttribute("valuetype","array");if(j.arraydim===""){m.setAttribute("arraydim","[0]")}else{m.setAttribute("arraydim",j.arraydim)}q.appendChild(m);var l=j.Value;for(var k=0;k<l.length;k++){var n=l[k];var p=r.createElement("Value");p.setAttribute("index",n.index);var o=r.createTextNode(n["<TEXT>"]);p.appendChild(o);m.appendChild(p)}},createSubRequestTag:function(l,k){var m=(new DOMParser()).parseFromString("<SubRequest/>","text/xml");var j=m.documentElement;j.setAttribute("id",k);j.setAttribute("result","");var n=m.createElement("Payload");j.appendChild(n);l.appendChild(j);return j},createParametersXML:function(o,n){var l=(new DOMParser()).parseFromString("<Activity/>","text/xml");var k=l.documentElement;k.setAttribute("id",o.getId());var m=this.createSubRequestTag(k,"Parameters");if(n==="POST"){var j=this.WriteParametersToXML(o);this.addDataToPayloadTag(m,j)}return(new XMLSerializer()).serializeToString(k)},createDataFlowsXML:function(o,n){var m=(new DOMParser()).parseFromString("<Activity/>","text/xml");var l=m.documentElement;l.setAttribute("id",o.getId());var k=this.createSubRequestTag(l,"DataFlow");if(n==="POST"){var j=this.WriteDataflowsToXML(o);this.addDataToPayloadTag(k,j)}return(new XMLSerializer()).serializeToString(l)},createSimulationDataXML:function(o,n){var m=(new DOMParser()).parseFromString("<Activity/>","text/xml");var l=m.documentElement;l.setAttribute("id",o.getId());var k=this.createSubRequestTag(l,"SimulationData");if(n==="POST"){var j=this.WriteDataflowsToXML(o);this.addDataToPayloadTag(k,j)}return(new XMLSerializer()).serializeToString(l)},createHighlightDataPathsXML:function(o){if(o){var n=(new DOMParser()).parseFromString("<ActivityList/>","text/xml");var j=n.documentElement;for(var l=0;l<o.length;l+=1){var m=n.createElement("Activity");m.setAttribute("id",o[l].activity.getId());j.appendChild(m);var k=n.createElement("DataFlowList");m.appendChild(k);this.addDataflowsToXML(n,k,o[l].dataflows)}}else{if(o===null){var n=(new DOMParser()).parseFromString("<SelectionMode/>","text/xml");var j=n.documentElement}}return(new XMLSerializer()).serializeToString(j)},createHighlightDataFlowXML:function(o,n,p){var s=(new DOMParser()).parseFromString("<Activity/>","text/xml");var j=s.documentElement;var q=s.createElement("Highlight");j.appendChild(q);var r=s.createElement("UnHighlight");j.appendChild(r);if(n==="parameter"){j.setAttribute("id",o.getId());var l=s.createElement("ParameterList");q.appendChild(l);this.addParameterToXML(s,l,p.selectedParameters);l=s.createElement("ParameterList");r.appendChild(l);this.addParameterToXML(s,l,p.unSelectedParameters)}else{if(n==="dataflow"){if(p.selectedDataflows.length>0||p.unSelectedDataflows.length>0){var m;if(p.selectedDataflows.length>0){m=p.selectedDataflows[0].getParent().getId()}else{m=p.unSelectedDataflows[0].getParent().getId()}j.setAttribute("id",m)}var k=s.createElement("DataFlowList");q.appendChild(k);this.addDataflowsToXML(s,k,p.selectedDataflows);k=s.createElement("DataFlowList");r.appendChild(k);this.addDataflowsToXML(s,k,p.unSelectedDataflows)}}return(new XMLSerializer()).serializeToString(j)},createHighlightActivitiesXML:function(j,l,p){var o=(new DOMParser()).parseFromString("<ActivitySelect/>","text/xml");var n=o.documentElement;n.setAttribute("ImmersiveView","ON");n.setAttribute("MappingMode",p);var q=o.createElement("ActivityList");n.appendChild(q);var k;if(j){k=o.createElement("Activity");k.setAttribute("id",j.getId());k.setAttribute("selectState","SOURCE");q.appendChild(k)}if(l&&l.length>0){for(var m=0;m<l.length;m+=1){k=o.createElement("Activity");k.setAttribute("id",l[m].getId());k.setAttribute("selectState","DESTINATION");q.appendChild(k)}}return(new XMLSerializer()).serializeToString(n)},createInvalidSelectionXML:function(n,l){var m=(new DOMParser()).parseFromString("<InvalidSelect/>","text/xml");var k=m.documentElement;var o=m.createElement("ActivityList");k.appendChild(o);var j;if(n){j=m.createElement("Activity");j.setAttribute("id",n.getId());j.setAttribute("message",l);o.appendChild(j)}return(new XMLSerializer()).serializeToString(k)},addDataToPayloadTag:function(l,j){var m=(new DOMParser()).parseFromString(j,"text/xml");var k=l.getElementsByTagName("Payload")[0];k.appendChild(m.childNodes[0]);return l},getResponseXML:function(o,n){var l=(new DOMParser()).parseFromString("<Message/>","text/xml");var k=l.documentElement;k.setAttribute("origin","Web");k.setAttribute("messageType",n);k.setAttribute("result","");var j=l.createElement("Request");j.setAttribute("id",o);j.setAttribute("result","");k.appendChild(j);var m=l.createElement("Payload");j.appendChild(m);return l},WriteParametersToXML:function(k){var r=(new DOMParser()).parseFromString("<ParameterList/>","text/xml");var p=r.documentElement;var q=r.createElement("Modified");p.appendChild(q);var o=k.getTemporaryParameters(b.State.Modified);this.addParameterToXML(r,q,o);var m=r.createElement("Created");p.appendChild(m);var l=k.getTemporaryParameters(b.State.Created);this.addParameterToXML(r,m,l);var n=r.createElement("Deleted");p.appendChild(n);var j=k.getTemporaryParameters(b.State.Deleted);this.addParameterToXML(r,n,j);return(new XMLSerializer()).serializeToString(r)},WriteDataflowsToXML:function(p){var n=(new DOMParser()).parseFromString("<DataFlowList/>","text/xml");var j=n.documentElement;var k=n.createElement("Created");j.appendChild(k);var m=p.getTemporaryDataflows(b.State.Created);this.addDataflowsToXML(n,k,m);var l=n.createElement("Deleted");j.appendChild(l);var o=p.getTemporaryDataflows(b.State.Deleted);this.addDataflowsToXML(n,l,o);return(new XMLSerializer()).serializeToString(n)},addParameterToXML:function(w,q,r){for(var B=0;B<r.length;B++){var s=r[B];var n=w.createElement("Parameter");q.appendChild(n);if(s.getId()!==null){n.setAttribute("id",s.getId())}n.setAttribute("name",s.getName());n.setAttribute("mode",b.Mode.server.properties[s.getMode()].name);n.setAttribute("type",b.DataType.server.properties[s.getDataType()].name);if(s.getDataType()===b.DataType.server.plmobject){var k="";var D=s.getValueAsString();var x=s.getValue();if(x&&(typeof(x)==="object")){k=x.getoid()}else{if(s.getParent&&s.getParent()){var m=s.getParent().getSimulationData(D);if(m){k=m.getoid()}}}n.setAttribute("SimDataId",k)}n.setAttribute("valuetype",s._getStructureName());if(s.getParent()!==null){n.setAttribute("activityID",c.getFI(s.getParent()).getId())}var y=w.createElement("Value");var u;if(s._getStructureName()==="Array"){n.setAttribute("sizable",s.isSizable().toString());n.setAttribute("arraydim",s.getDimensionAsString());this.createXMLForArrayParameter(s,w,n)}else{u=w.createTextNode(s.getValueAsString());y.appendChild(u);n.appendChild(y);if(s.getLimitType()!==undefined){var C=w.createElement("Limit");C.setAttribute("type",b.LimitType.server.properties[s.getLimitType()].name);var v="";for(var A=0;A<s.getLimits().length;A++){v+=s.getLimits()[A]+"\n"}var z=w.createTextNode(v);C.appendChild(z);n.appendChild(C)}}if(s.getDescription()!==""&&s.getDescription()!==undefined){var p=w.createElement("Description");var l=w.createTextNode(s.getDescription());p.appendChild(l);n.appendChild(p)}if(s.getExpression()!==""&&s.getExpression()!==undefined){var t=w.createElement("Expression");var o=w.createTextNode(s.getExpression());t.appendChild(o);n.appendChild(t)}}},addDataflowsToXML:function(o,k,n){var m,j,l;for(m=0;m<n.length;m++){j=n[m];l=o.createElement("DataFlow");k.appendChild(l);l.setAttribute("fromFlowItemID",j.getFromParameter().getParent().getId());l.setAttribute("fromParameterID",j.getFromParameter().getId());l.setAttribute("toFlowItemID",j.getToParameter().getParent().getId());l.setAttribute("toParameterID",j.getToParameter().getId())}},createXMLForArrayParameter:function(o,n,l){for(var m=0;m<o.getValues().length;m++){var k=n.createElement("Value");k.setAttribute("index",o._valueHelperFunctions.indexToSubscript_RowMajor(o.getDimensions(),m).toString());var j=n.createTextNode(o.getValues()[m]);k.appendChild(j);l.appendChild(k)}},setProcess:function(z,F){F=F.replace(/xsi:type/g,"xsitype");var x=(new DOMParser()).parseFromString(F,"text/xml");var q=x.getElementsByTagName("datagroups");var Q={datarecords:{datagroups:[]}};for(var O=0;O<q.length;O+=1){var m=q[O];var t={dataelements:{}};var w=m.attributes;var H,M;if(w!==undefined&&w!==null&&w.length>0){for(M=0;M<w.length;M++){H=w[M];t[H.name]=H.value}}var A=m.getElementsByTagName("dataelements")[0];var r=A.children;for(var K=0;K<r.length;K+=1){var E;var R;var I;var p=A.children[K].tagName;if(p==="firstChildID"){E=A.children[K].textContent}else{if(p==="steps"){var D=[];var P=A.children[K].getElementsByTagName("step");for(I=0;I<P.length;I+=1){var s=P[I];w=s.attributes;var B={};if(w!==undefined&&w!==null&&w.length>0){for(M=0;M<w.length;M++){H=w[M];B[H.name==="xsitype"?"xsi:type":H.name]=H.value}}D.push(B)}R={value:[{value:JSON.stringify(D)}]};t.dataelements.steps=R}else{if(p==="Gateways"){var v=A.children[K].getElementsByTagName("Gateway");var G=[];for(I=0;I<v.length;I+=1){var o=v[I];w=o.attributes;var L={};if(w!==undefined&&w!==null&&w.length>0){for(M=0;M<w.length;M++){H=w[M];L[H.name==="xsitype"?"xsi:type":H.name]=H.value}}G.push(L)}R={value:[{value:JSON.stringify(G)}]};t.dataelements.gateways=R}else{if(p==="sequenceFlows"){var J=A.children[K].getElementsByTagName("Outerflow")[0];var N=J.getElementsByTagName("SequenceFlow");var y={Outerflow:[],Innerflow:[]};for(I=0;I<N.length;I+=1){var n=N[I];w=n.attributes;var u={};if(w!==undefined&&w!==null&&w.length>0){for(M=0;M<w.length;M++){H=w[M];u[H.name]=H.value}y.Outerflow.push(u)}}y.Outerflow.push({firstChildID:E});R={value:[{value:JSON.stringify(y)}]};t.dataelements.sequenceFlows=R}else{R={value:[{value:A.children[K].textContent}]};t.dataelements[p]=R}}}}}Q.datarecords.datagroups.push(t)}var C=d.loadProcess(Q);return C},setParameters:function(q,r){var t=(new DOMParser()).parseFromString(r,"text/xml");var m=t.getElementsByTagName("Activity");for(var p=0;p<m.length;p+=1){var k=m[p];var l=k.getAttribute("id");var s=null;for(var o=0;o<q.length;o+=1){if(q[o].getId()===l){s=q[o];break}}if(s){var n=i.getFIfromDataContainer(s);g.ReadParametersFromXML(n,k)}}},setDataFlows:function(q,r){var t=(new DOMParser()).parseFromString(r,"text/xml");var m=t.getElementsByTagName("Activity");for(var p=0;p<m.length;p+=1){var k=m[p];var l=k.getAttribute("id");var s=null;for(var o=0;o<q.length;o+=1){if(q[o].getId()===l){s=q[o];break}}if(s){var n=i.getFIfromDataContainer(s);g.ReadDataFlowsFromXML(n,k)}}},setSimulationData:function(q,r){var u=(new DOMParser()).parseFromString(r,"text/xml");var m=u.getElementsByTagName("Activity");for(var p=0;p<m.length;p+=1){var k=m[p];var l=k.getAttribute("id");var t=null;for(var o=0;o<q.length;o+=1){if(q[o].getId()===l){t=q[o];break}}if(t){var s=k.getElementsByTagName("datarecords")[0];var n=i.getFIfromDataContainer(t);g.addSimulationDataToActivity(n,s)}}},ReadDataFlowsFromXML:function(m,k){var l=k.getElementsByTagName("DataFlowList")[0];var j=g._dataflowXMLtoJSON(l);d.loadDataflows(m,j)},ReadParametersFromXML:function(m,k){var j=g._getParametersXmlDOMDoc(k,"ParameterData");var l=g._parameterXMLtoJSON(j);d.loadParameters(m,l)},ReadPotentialParametersFromXML:function(k,r){var n={};var p=g._getParametersXmlDOMDoc(r,"ParentParameters");if(p){var l=g._parameterXMLtoJSON(p);var o=this.loadWebInWinPotentialParameters(k,l);n.parent=o;p=g._getParametersXmlDOMDoc(r,"ChildParameters");l=g._parameterXMLtoJSON(p);var q=this.loadWebInWinPotentialParameters(k,l);n.children=q;p=g._getParametersXmlDOMDoc(r,"SiblingParameters");l=g._parameterXMLtoJSON(p);var m=this.loadWebInWinPotentialParameters(k,l);n.siblings=m;var j=k.getParameters();n.self=j;k.setPotentialParameters(n);k.setPotentialParametersUpdateFlag(true)}},addSimulationDataToActivity:function(n,l){var m=this.xmlToJson(l);if(m&&m.datagroups){var j=m.datagroups;var o;if(j.length){for(var k=0;k<j.length;k++){o=new f(j[k]);n.addSimulationData(o)}}else{o=new f(j);n.addSimulationData(o)}}},getCreatedSimulationDataXML:function(p){var j=p.getAllTempSimulationData();var o=(new DOMParser()).parseFromString("<CreatedSimulationData/>","text/xml");var k=o.documentElement;for(var n=0;n<j.length;n++){var m=j[n];var l=o.createElement("SimulationData");l.setAttribute("simDataRelationshipUUID",m.getFieldValue("simDataRelationshipUUID"));l.setAttribute("physicalId",m.getPhysicalId());k.appendChild(l)}return(new XMLSerializer()).serializeToString(o)},getRemovedDataSimulationXML:function(p){var n=p.getAllTempSimulationDataToRemove();var o=(new DOMParser()).parseFromString("<DeletedSimulationData/>","text/xml");var j=o.documentElement;for(var m=0;m<n.length;m++){var l=n[m];var k=o.createElement("SimulationData");k.setAttribute("simDataRelationshipUUID",l.getFieldValue("simDataRelationshipUUID"));k.setAttribute("physicalId",l.getPhysicalId());j.appendChild(k)}return(new XMLSerializer()).serializeToString(o)},loadContents:function(l,j){var k=this.xmlToJson(j);this.createContentOnActivity(l,k)},createContentOnActivity:function(p,k){var o,q;var m=k&&k.datagroups?k.datagroups:[k];for(var n=0;n<m.length;n++){q=new a(m[n]);q.setParent(p);p.addChildContent(q);if(m[n]&&m[n].children&&q.isContentContainer()){o=m[n].children;if(o.length===undefined){this.createContentOnActivity(q,o)}else{for(var l=0;l<o.length;l++){this.createContentOnActivity(q,o[l])}}}}},encodeString:function(j){j.replace("+","@fdn@2B")},loadWebInWinPotentialParameters:function(m,n){var k=[];var r=n.datarecords.datagroups;if(r!==undefined&&r!==null){for(var o=0;r!==null&&o<r.length;o++){k[o]=new e(r[o]);var p=r[o];var j=p.dataelements.activityId.value[0].value;var l=p.dataelements.activityName.value[0].value;var q=new h();q.setId(j);q.setName(l);k[o].setParent(q)}}return k},createRequestXML:function(n){var m=(new DOMParser()).parseFromString("<Request/>","text/xml");var j=m.getElementsByTagName("Request")[0];var l=m.createElement("Payload");var k=m.createElement("Response");j.setAttribute("id",n);j.setAttribute("result","OK");j.appendChild(l);j.appendChild(k);return j},createMessageXML:function(l,o,j){var n=(new DOMParser()).parseFromString("<Message/>","text/xml");var m=n.getElementsByTagName("Message")[0];m.setAttribute("origin","Web");m.setAttribute("messageType",l);m.setAttribute("jsCallback",o);m.setAttribute("result","OK");if(j.length===undefined){m.appendChild(j)}for(var k=0;k<j.length;k++){m.appendChild(j[k])}return n},addResponseToRequestXML:function(l,j){var m=(new DOMParser()).parseFromString(j,"text/xml");var k=l.getElementsByTagName("Response")[0];k.appendChild(m.childNodes[0]);return l},createContentMessage:function(j,m,q,p,l){var o=this.createRequestXML(j);var n=this.updateContentRequestXML(o,q,p,l);var k=this.createMessageXML("POST","updateContentUI",n);return k},updateContentRequestXML:function(o,n,l,j){var s=(new DOMParser()).parseFromString("<root></root>","text/xml");var r=o.getElementsByTagName("Payload")[0];var m=s.createElement("Data");r.appendChild(m);var k=s.createElement("HTMLElemId");k.setAttribute("name",j);m.appendChild(k);var q=s.createElement("datarecords");q.setAttribute("name","SMA_Content_WebInWin");q.setAttribute("ignoreLevel","false");m.appendChild(q);var p=s.createElement("datagroups");p.setAttribute("parentId",n);p.setAttribute("busType",l);q.appendChild(p);return o},addContentObjectToContainer:function(n,q){var s=q.getElementsByTagName("datagroups");var m=[];var t="";var j;var r;if(s.length===undefined){m[0]=s}else{m=s}for(var o=0;o<m.length;o++){var k=m[o];var p=k.getAttribute("parentId");if(p.localeCompare(t)!==0){t=p;j=n.getChildContent(t);var l=this.xmlToJson(k);r=new a(l);r.setParent(j);j.addChildContent(r)}}return r},updateExtensionDescriptorReqXML:function(m){var n=(new DOMParser()).parseFromString("<root></root>","text/xml");var o=m.getElementsByTagName("Payload")[0];var l=n.createElement("Data");var k=n.createElement("WebComponent");l.appendChild(k);var j=n.createElement("WebEditor");l.appendChild(j);o.appendChild(l);return m},xmlToJson:function(m){if(!m){return null}var q={};var l=m.attributes;if(l&&l.length>0){for(var n=0;n<l.length;n++){var j=l[n];q[j.name]=j.value}}if(m.children&&m.children.length>0){for(var n=0;n<m.children.length;n++){var o=m.children.item(n);var p=o.nodeName;if(typeof(q[p])==="undefined"){q[p]=this.xmlToJson(o)}else{if(typeof(q[p].push)==="undefined"){var k=q[p];q[p]=[];q[p].push(k)}q[p].push(this.xmlToJson(o))}}}else{q["<TEXT>"]=m.textContent}return q},stepConfigToXML:function(o){var n=(new DOMParser()).parseFromString("<StepConfig/>","text/xml");var k=n.documentElement;this.JsonToXml(n,o,k);var j=o.getPluginConfigurations();var m;if(j.length>0){m=n.createElement("ChildConfigurations");k.appendChild(m)}for(var l=0;l<j.length;l++){var q=j[0];var p=n.createElement("Configuration");p.setAttribute("extensionLoadVersion",q._data.extensionLoadVersion);p.setAttribute("extensionName",q.getExtensionName());p.setAttribute("extensionWrittenVersion",q._data.extensionWrittenVersion);m.appendChild(p);this.JsonToXml(n,q,p)}return(new XMLSerializer()).serializeToString(n)},JsonToXml:function(v,r,p){var t=v.createElement("Properties");p.appendChild(t);var u=r._getData().Properties.Property;for(var m=0;m<u.length;m++){var k=u[m];if(r.isArrayProperty(k.name)){g.JSCMMArrayPropertyToXML(v,k,t)}else{if(r.isAggregrateProperty(k.name)){g.JSCMMAggregatePropToXML(v,k,t)}else{var s=v.createElement("Property");t.appendChild(s);s.setAttribute("name",k.name);if("valuetype" in k){s.setAttribute("valuetype",k.valuetype)}if("type" in k){s.setAttribute("type",k.type)}if("subtype" in k){s.setAttribute("subtype",k.subtype)}if(k.mode!==undefined&&k.mode!==null){s.setAttribute("mode",k.mode)}var l=k.Value;if(l!==undefined&&l!==null){if("<![CDATA]>" in l){var q=l["<![CDATA]>"];var j=v.createElement("Value");s.appendChild(j);var n=v.createCDATASection(q);j.appendChild(n)}else{if("<TEXT>" in l){var q=l["<TEXT>"];var j=v.createElement("Value");s.appendChild(j);var o=v.createTextNode(q);j.appendChild(o)}}}}}}return(new XMLSerializer()).serializeToString(v)}};return g});
/*! Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils",["DS/Logger/Logger","module","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/SMAProcWebCMMUtils/PubSub"],function(c,e,h,b){var d=c.getLogger(e);var a={};var g=function(n){var i,q;i=new DOMParser();q=i.parseFromString(n,"text/xml");var j=q.getElementsByTagName("Message")[0];var k=j.getAttribute("requestId");var m=a[k];if(m){var r=j.getAttribute("result");var p=j.getAttribute("messageType");var o=m.onSuccess||d.info.bind(d);var l=m.onFailure||d.warn.bind(d);delete a[k];if(p==="POST"||p==="GET"){if(r==="404 Not Found"){l(n)}else{if(r==="200 OK"){o(n)}}}}};b.add("Win_Response",g);var f={isWebInWin:function(){var i=Boolean(window.dscef&&window.dscef.sendString);return i},sendMessage:function(j){var i=(typeof j==="string")?j:(new XMLSerializer()).serializeToString(j);var k=window.dscef&&window.dscef.sendString;if(k){k(i)}else{d.error("dscef.sendString is not available")}},sendRequest:function(i,k){var j=new Date().getTime();a[j]=k;i.setAttribute("requestId",j);f.sendMessage(i)},getProcess:function(j,k){var i=h.getResponseXML("ProcessStructure","GET");f.sendRequest(i.documentElement,k)},getParameters:function(k,n){var j,m=h.getResponseXML("MultiActivity","GET");if(k.length>0){for(var l=0;l<k.length;l++){j=h.createParametersXML(k[l],"GET");m=h.addDataToPayloadTag(m,j)}}f.sendRequest(m.documentElement,n)},getDataFlows:function(k,n){var j,m=h.getResponseXML("MultiActivity","GET");if(k.length>0){for(var l=0;l<k.length;l++){j=h.createDataFlowsXML(k[l],"GET");m=h.addDataToPayloadTag(m,j)}}f.sendRequest(m.documentElement,n)},getSimulationData:function(k,n){var j,m=h.getResponseXML("MultiActivity","GET");if(k.length>0){for(var l=0;l<k.length;l++){j=h.createSimulationDataXML(k[l],"GET");m=h.addDataToPayloadTag(m,j)}}f.sendRequest(m.documentElement,n)},saveParameters:function(k,n){var j,m=h.getResponseXML("MultiActivity","POST");if(k.length>0){for(var l=0;l<k.length;l++){j=h.createParametersXML(k[l],"POST");m=h.addDataToPayloadTag(m,j)}}f.sendRequest(m.documentElement,n)},saveDataFlows:function(k,n){var j,m=h.getResponseXML("MultiActivity","POST");if(k.length>0){for(var l=0;l<k.length;l++){j=h.createDataFlowsXML(k[l],"POST");m=h.addDataToPayloadTag(m,j)}}f.sendRequest(m.documentElement,n)},highlightDataFlows:function(l,j){var i,k=h.getResponseXML("ImmersiveView","POST");i=h.createHighlightDataFlowXML(l,"dataflow",j);k=h.addDataToPayloadTag(k,i);f.sendMessage(k)},highlightParametersDataFlows:function(l,k){var i,j=h.getResponseXML("ImmersiveView","POST");i=h.createHighlightDataFlowXML(l,"parameter",k);j=h.addDataToPayloadTag(j,i);f.sendMessage(j)},highlightParameterDataPaths:function(k){var i,j=h.getResponseXML("ParameterDataPaths","POST");i=h.createHighlightDataPathsXML(k);j=h.addDataToPayloadTag(j,i);f.sendMessage(j)},updateGraphNodesStyle:function(j,k,m){var i,l=h.getResponseXML("ActivitySelection","POST");i=h.createHighlightActivitiesXML(j,k,m);l=h.addDataToPayloadTag(l,i);f.sendMessage(l)},showInvalidSelectionError:function(l,k){var i,j=h.getResponseXML("ActivitySelection","POST");i=h.createInvalidSelectionXML(l,k);j=h.addDataToPayloadTag(j,i);f.sendMessage(j)}};return f});define("DS/SMAProcWebCMMUtils/SMAJSCMMAccessUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/Logger/Logger","module"],function(d,g,f,b,e){var c=b.getLogger(e);var a={access:{processId:null,hasDeleteAccess:false,hasFromConnectAccess:false,hasFromDisconnectAccess:false,hasLockAccess:false,hasModifyAccess:false,hasReadAccess:false,hasShowAccess:false},fetchAccess:function(i,k){var h=k&&k.onSuccess||c.info.bind(c);var j=k&&k.onFailure||c.warn.bind(c);d.fetchAccess(i,{onSuccess:function(m){this.access.processId=i.getId();var l=m.datarecords.datagroups[0].dataelements;this.access.hasDeleteAccess=l.hasDeleteAccess.value[0].value.toLowerCase()==="true"?true:false;this.access.hasFromConnectAccess=l.hasFromConnectAccess.value[0].value.toLowerCase()==="true"?true:false;this.access.hasFromDisconnectAccess=l.hasFromDisconnectAccess.value[0].value.toLowerCase()==="true"?true:false;this.access.hasLockAccess=l.hasLockAccess.value[0].value.toLowerCase()==="true"?true:false;this.access.hasModifyAccess=l.hasModifyAccess.value[0].value.toLowerCase()==="true"?true:false;this.access.hasReadAccess=l.hasReadAccess.value[0].value.toLowerCase()==="true"?true:false;this.access.hasShowAccess=l.hasShowAccess.value[0].value.toLowerCase()==="true"?true:false;h()}.bind(this),onFailure:j})},hasDeleteAccess:function(){if(g.isWebInWin()){return true}return this.access.hasDeleteAccess},hasFromConnectAccess:function(){if(g.isWebInWin()){return true}return this.access.hasFromConnectAccess},hasFromDisconnectAccess:function(){if(g.isWebInWin()){return true}return this.access.hasFromDisconnectAccess},hasLockAccess:function(){if(g.isWebInWin()){return true}return this.access.hasLockAccess},hasModifyAccess:function(){if(g.isWebInWin()){return true}return this.access.hasModifyAccess},hasReadAccess:function(){if(g.isWebInWin()){return true}return this.access.hasReadAccess},hasShowAccess:function(){if(g.isWebInWin()){return true}return this.access.hasShowAccess}};return a});define("DS/SMAProcWebCMMUtils/SMAJSCMMSimulationDataUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/Logger/Logger","module"],function(c,g,f,a,d){var b=a.getLogger(d);var e={_callGetSimulationDataWS:function(h){return new Promise(function(j,i){c.getAllSimulationData(h,{onSuccess:j,onFailure:i})})},getAllSimulationDataInPLM:function(h,l){var j=l&&l.onSuccess||b.info.bind(b);var k=l&&l.onFailure||b.warn.bind(b);if(g.isWebInWin()){g.getSimulationData(h,{onSuccess:function(m){f.setSimulationData(h,m);j()},onFailure:function(){k()}})}else{var i=[];if(h instanceof Array){h.forEach(function(m){if(m){i.push(e._callGetSimulationDataWS(m))}})}Promise.all(i).then(function(){j()})["catch"](function(){k()})}}};return e});define("DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils",["DS/JSCMM/SMAJSCMMDataFlow","DS/JSCMM/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataContainerUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtilsNLSUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/Logger/Logger","module"],function(e,a,k,b,i,h,f,d,c){var j=d.getLogger(c);var g={VALUE:"value",INFO:"info",WARNING:"warning",ERROR:"error",DATA:"data",NLSID:{INPUT_NOT_DEFINED_OR_NULL:"Dataflow.InputNotDefinedOrNull",DF_CANNOT_BE_CREATED:"Dataflow.DFCanNotBeCreated",DF_CANNOT_BE_CREATED_INSELECTED_DIRECTION:"Dataflow.DFCanNotBeCreatedInSelectedDirection",DF_CANNOT_BE_CREATED_ALREADY_EXISTS:"Dataflow.DFCanNotBeCreatedAsItAlreadyExists",DF_CANNOT_BE_CREATED_NORELATION:"Dataflow.DFCanNotBeCreatedNoRelation",DF_CANNOT_BE_CREATED_MISMATCH_DATATYPE:"Dataflow.DFCanNotBeCreatedMismatchDataType",DF_MISMATCH_DATATYPE_WARNING:"Dataflow.DFMismatchDataTypeWarning",MISMATCH_STRUCTURE:"Dataflow.DFCanNotBeCreatedMismatchStructure",MISMATCH_ARRAY_SIZE:"Dataflow.DFCanNotBeCreatedMismatchArraySizeSameStructure",MISMATCH_ARRAY_SIZABLE:"Dataflow.DFCanNotBeCreatedMismatchArraySizable",MISMATCH_DIMENSION:"Dataflow.DFCanNotBeCreatedMismatchDimensionSameStructure",DF_CANNOT_BE_CREATED_MODENEUTRAL:"Dataflow.DFCanNotBeCreatedNeutralMode",DF_CANNOT_BE_CREATED_PARENT_IN_TO_CHILD_OUT:"Dataflow.DFCanNotBeCreatedParentInToChildOut",DF_CANNOT_BE_CREATED_UPSTREAM_IN_TO_DOWNSTREAM:"Dataflow.DFCanNotBeCreatedUpstreamInToDownstream",DF_CANNOT_BE_CREATED_UPSTREAM_TO_DOWNSTREAM_OUT:"Dataflow.DFCanNotBeCreatedUpstreamToDownstreamOut",DF_CAN_BE_CREATED_SIBLINGS_UNDETERMINED_ORDER:"Dataflow.DFCanBeCreatedSiblingsUndeterminedOrder",SIBLINGS_UNDETERMINED_ORDER:"Dataflow.SiblingsUndeterminedOrder",DF_CAN_BE_CREATED_BOTH:"Dataflow.DFCanBeCreatedInBoth",DF_CANNOT_BE_CREATED_DOWNSTREAM_TO_UPSTREAM:"Dataflow.DFCanNotBeCreatedDownstreamToUpstream",NORELATION:"Dataflow.NoRelation",INCOMPATIBLEMODE:"IncompatibleMode"},ERROR_CODES:{DF_INVALID_RELATION:"Dataflow.NoValidRelationBetweenDataContainer"},getNLSMessage:function(l){return(typeof i!=="undefined"&&i)?i.translate(l):l},createReturnObj:function(n,m,p,l,o){return{value:n,info:m,warning:p,error:l,data:o}},MappingDirection:{None:0,FirstToSecond:1,SecondToFirst:2,Both:3,properties:{0:{name:"None",value:0},1:{name:"FirstToSecond",value:1},2:{name:"SecondToFirst",value:2},3:{name:"Both",value:3}}},Relation:{None:0,Parent:1,Child:2,Sibling:3,SiblingDownstream:4,SiblingUpstream:5,Unknown:6,properties:{0:{name:"None",value:0},1:{name:"Parent",value:1},2:{name:"Child",value:2},3:{name:"Sibling",value:3},4:{name:"SiblingDownstream",value:4},5:{name:"SiblingUpstream",value:5},8:{name:"Unknown",value:6}}},DataFlowError:{None:0,Unknown:1,InvalidArgument:2,properties:{0:{name:"None",message:"None"},1:{name:"Unknown",message:"Unknown"},2:{name:"InvalidArgument",message:"InvalidArgument"}}},createDataFlowObject:function(o,l){var n,p,m=new e();if(o.getState()===a.State.Modified){n=o.getReference()}else{n=o}if(l.getState()===a.State.Modified){p=l.getReference()}else{p=l}m.setFromParameter(n);m.setToParameter(p);return m},addDataflow:function(n,l){var o=n;if(!n){return o}n.setState(a.State.Created);if(!(n.getParent())){n.setParent(l)}var m=n.getParent();m.addTemporaryDataflow(n);return o},deleteDataflow:function(o,l){var p=o;var n;if(!o){return p}var m=o.getState();if(m===a.State.None){if(!(o.getParent())){o.setParent(l)}n=o.getParent();n.addTemporaryDataflow(o)}else{if(m===a.State.Created){if(!(o.getParent())){o.setParent(l)}n=o.getParent();n.removeTemporaryDataflow(o)}}return p},clearTemporaryDataflows:function(l){if(l){l.clearTemporaryDataflows(a.State.Created);l.clearTemporaryDataflows(a.State.Deleted)}},saveAllDataFlows:function(n,q){var m=q&&q.onSuccess||j.info.bind(j);var p=q&&q.onFailure||j.warn.bind(j);if(h.isWebInWin()){h.saveDataFlows(n,{onSuccess:function(t){for(var r=0;r<n.length;r+=1){var s=n[r].getTemporaryDataflows(a.State.Created);g._dataFlowsCreatedWSCB(n[r],s,a.State.Created);s=n[r].getTemporaryDataflows(a.State.Deleted);g._dataFlowsDeletedWSCB(n[r],s,a.State.Deleted)}m()},onFailure:function(r){p()}})}else{var o=Promise.resolve(null);for(var l=0;l<n.length;l+=1){o=o.then(this.getPromiseForSaveDataFlow.bind(this,n[l]))}o=o.then(m,p)}},getPromiseForSaveDataFlow:function(l){return new Promise(function(n,m){g.saveDataflows(l,{onSuccess:function(o){n(o)},onFailure:function(p){var o="Dataflows could not be saved in PLM. There was an issue while saving dataflows to database.";m(o)}})})},saveDataflows:function(l,o){var m=o&&o.onSuccess||j.info.bind(j);var n=o&&o.onFailure||j.warn.bind(j);Promise.resolve(null).then(this._processTemporaryDataflows.bind(this,l,a.State.Deleted)).then(this._processTemporaryDataflows.bind(this,l,a.State.Created)).then(m,n)},getRelationship:function(m,l){try{g._throwErrorIfNotDefined(m);g._throwErrorIfNotDefined(l);return g._getRelationship(m,l)}catch(n){throw n}},getDataFlowDataContainerForDataContainers:function(o,n,m){var l=m||this._getRelationship(o,n).value;if(l===g.Relation.Parent){return o}else{if(l===g.Relation.Child){return n}else{if(l===g.Relation.Sibling||l===g.Relation.SiblingDownstream||l===g.Relation.SiblingUpstream){return k.getParentFIsDataContainer(o)}else{return undefined}}}},filterDFForParameters:function(n,m){var l={fromSide:[],toSide:[]};if(m&&n&&m.length>0&&n.length>0){n.forEach(function(o){m.forEach(function(p){if(o.getFromParameter()===p){l.fromSide.push(o)}else{if(o.getToParameter()===p){l.toSide.push(o)}}})})}return l},filterDFBetweenTwoActivities:function(m,o,n){var l=[];if(m&&o&&n&&m.length>0){m.forEach(function(p){if((p.getFromParameter().getParent()===o&&p.getToParameter().getParent()===n)||(p.getToParameter().getParent()===o&&p.getFromParameter().getParent()===n)){l.push(p)}})}return l},getMappableParameterFromFI:function(n,l){var m=[];l.forEach(function(p){var o=g.isToParameterAlreadyMapped(n,p);if(!o.isAlreadyMapped&&(g.isMappingPossibleBetweenParameters(n,p,true)||g.isMappingPossibleBetweenParameters(p,n,true))){m.push(p)}});return m},isMappingPossibleBetweenParameters:function(r,n,q){var s,o,p,l,m;m=g.getRelationship(r.getParent(),n.getParent()).value;if(m===g.Relation.Parent||m===g.Relation.Child||m===g.Relation.SiblingUpstream){s=g.structureCompatiblityCheck(r,undefined,n,undefined).value;o=g.dataTypeCompatiblityCheck(r,n,g.MappingDirection.FirstToSecond).value;p=q?true:g.havingValidFromSideMode(r.getMode(),m);l=q?true:g.havingValidToSideMode(n.getMode(),m);return s&&o&&p&&l}return false},isToParameterAlreadyMapped:function(p,n){var m={isAlreadyMapped:false,dataflow:null};var s=g.getDataFlowsForParameters([n]);var r=s.toSide;if(r&&r.length>0){for(var o=0;o<r.length;o+=1){var l=r[o];var q=l.getFromParameter();if(p.getParent().getId()===q.getParent().getId()){if(p.getId()!==q.getId()){m.isAlreadyMapped=true;m.dataflow=l;break}}}}return m},isFromParameterAlreadyMapped:function(r,l,m){var n={isAlreadyMapped:false,dataflow:null};var p=g.getDataFlowsForParameters([r]);var q=p.fromSide;if(q&&q.length>0){for(var o=0;o<q.length;o+=1){var s=q[o];var t=s.getToParameter();if(l.getId()===t.getParent().getId()){if(m){if(!(r.getId()===s.getFromParameter().getId()&&m.getId()===t.getId())){n.isAlreadyMapped=true;n.dataflow=s;break}}else{n.isAlreadyMapped=true;n.dataflow=s;break}}}}return n},isDataFlowAvailableBetweenParameters:function(m,r,q,p){var l=false,o,n;if(r&&r.getState()===a.State.Modified){o=r.getReference()}else{o=r}if(q&&q.getState()===a.State.Modified){n=q.getReference()}else{n=q}if(o&&n&&m&&m.length>0){m.forEach(function(s){if(!l&&p===g.MappingDirection.FirstToSecond){l=s.getFromParameter()===o&&s.getToParameter()===n}else{if(!l&&p===g.MappingDirection.SecondToFirst){l=s.getFromParameter()===n&&s.getToParameter()===o}else{if(!l){l=(s.getFromParameter()===o&&s.getToParameter()===n)||(s.getFromParameter()===n&&s.getToParameter()===o)}}}})}return l},_getDFSpaceForDataContainer:function(l){var p,m=[],o=[];if(l){m.push.apply(m,l.getDataFlows());m.push.apply(m,l.getTemporaryDataflows(a.State.Created));o=l.getTemporaryDataflows(a.State.Deleted);if(o.length>0){for(var n=0;n<o.length;n++){m.splice(m.indexOf(o[n]),1)}}}p=k.getParentFIsDataContainer(l);if(p){m.push.apply(m,p.getDataFlows());m.push.apply(m,p.getTemporaryDataflows(a.State.Created));o=p.getTemporaryDataflows(a.State.Deleted);if(o.length>0){for(var n=0;n<o.length;n++){m.splice(m.indexOf(o[n]),1)}}}return m},getDataFlowSpaceForDataContainer:function(l){try{g._throwErrorIfNotDefined(l);var m=g._getDFSpaceForDataContainer(l);return g.createReturnObj(m)}catch(n){return n}},getDataFlowsForDataContainer:function(m){var n=[];var l=g.getDataFlowSpaceForDataContainer(m).value;if(l.length>0){l.forEach(function(q){if(q.getFromParameter()&&q.getToParameter()){var o=q.getFromParameter().getParent();var p=q.getToParameter().getParent();if(o===m||p===m){n.push(q)}}})}return g.createReturnObj(n)},_callGetDataFlowsWS:function(l){return new Promise(function(n,m){k.getDataFlowsInPLM(l,{onSuccess:n,onFailure:m})})},getAllDataFlowsInPLM:function(l,q){var o=q&&q.onSuccess||j.info.bind(j);var p=q&&q.onFailure||j.warn.bind(j);if(h.isWebInWin()){var n=k.getImpactedFIForDataflow(l);n=n.concat(l);n=n.filter(function(r,s){return n.indexOf(r)===s});h.getParameters(n,{onSuccess:function(r){f.setParameters(n,r);h.getDataFlows(l,{onSuccess:function(s){f.setDataFlows(l,s);o()},onFailure:function(){p()}})},onFailure:function(){p()}})}else{var m=[];if(l instanceof Array){l.forEach(function(r){if(r){m.push(g._callGetDataFlowsWS(r))}})}Promise.all(m).then(function(){o()})["catch"](function(){p()})}},getDataFlowsForParameters:function(p,l){try{var o,n=[],m=[];p&&p.forEach&&p.forEach(function(r){o=r.getState();if(o===a.State.Modified){r=r.getReference()}n.push(r)});if(!l&&n.length>0){m=g.getDataFlowSpaceForDataContainer(n[0].getParent())}return g.filterDFForParameters(m.value,n)}catch(q){return q}},_processTemporaryDataflows:function(l,m){return new Promise(function(p,o){var n;if(typeof l==="undefined"){o(new Error("Missing flow item"))}else{n=l.getTemporaryDataflows(m);if((!(Array.isArray(n)))||(n.length<=0)){p(null)}else{switch(m){case a.State.Created:k.createDataFlowsInPLM(l,n,{onSuccess:function(q){g._dataFlowsCreatedWSCB(l,n,m);j.info("create dataflow - success",q);p(q)},onFailure:function(q){j.warn("create dataflow - failed",q);o(q)}});break;case a.State.Deleted:k.deleteDataFlowsInPLM(l,n,{onSuccess:function(q){g._dataFlowsDeletedWSCB(l,n,m);j.info("delete dataflow - success",q);p(q)},onFailure:function(q){j.warn("delete dataflow - failed",q);o(q)}});break;default:j.warn("_processTemporaryDataflows invalid state: "+m);o(new Error("_processTemporaryDataflows invalid state: "+m))}}}})},_dataFlowsCreatedWSCB:function(l,m,n){l.addDataFlows(m);l.clearTemporaryDataflows(n)},_dataFlowsDeletedWSCB:function(l,m,n){l.removeDataFlows(m);l.clearTemporaryDataflows(n)},_throwErrorIfNotDefined:function(l){if((typeof l==="undefined")||(!l)){throw new Error(g.getNLSMessage(g.NLSID.INPUT_NOT_DEFINED_OR_NULL))}},_getRelationship:function(q,p){try{var o=b.getFI(q);var m=b.getFI(p);var r=g.Relation.None;var B="",v="",w="";var z=0,y=0,x=0;if(m.getParent()===o){r=g.Relation.Parent}else{if(o.getParent()===m){r=g.Relation.Child}else{if(o.getParent()===m.getParent()){r=g.Relation.Sibling;var C=o.getIncomingFlowItems();while(C.length>0){var t=[];for(z=0;z<C.length;z++){if(C[z]===m){r=g.Relation.SiblingDownstream;break}var u=C[z].getIncomingFlowItems();for(y=0;y<u.length;y++){t.push(u[y])}}C=[];for(x=0;x<t.length;x++){C.push(t[x])}}if(r===g.Relation.Sibling){var s=o.getOutgoingFlowItems();while(s.length>0){var l=[];for(z=0;z<s.length;z++){if(s[z]===m){r=g.Relation.SiblingUpstream;break}var n=s[z].getOutgoingFlowItems();for(y=0;y<n.length;y++){l.push(n[y])}}s=[];for(x=0;x<l.length;x++){s.push(l[x])}}}}}}return g.createReturnObj(r,B,v,w)}catch(A){throw A}},_getSiblings:function(r,m){var l=[];var p=[];if(m===0){p=r.getIncomingFlowItems().slice(0)}else{p=r.getOutgoingFlowItems().slice(0)}if((p)&&(p.length)&&(p.length>0)){for(var o=0;o<p.length;o++){if(!(p[o].isGateway())&&(l.indexOf(p[o])<0)){l.push(p[o])}var q=g._getSiblings(p[o],m);for(var n=0;n<q.length;n++){if(l.indexOf(q[n])<0){l.push(q[n])}}}}return l},getSiblings:function(n){var m={downstream:[],upstream:[],unknown:[]};var o=g._getSiblings(n,1).slice(0);var l=g._getSiblings(n,0).slice(0);var s=o.concat(l);var q=[];var r=n.getParent();if(r){q=r.getChildren().slice(0);q.splice(q.indexOf(n),1)}var t=[];for(var p=0;p<q.length;p++){if(!(q[p].isGateway())&&(s.indexOf(q[p])===-1)){t.push(q[p])}}m.downstream=o;m.upstream=l;m.unknown=t;return m},_getPossibleMappingDirectionBetweenFIs:function(n,m,p){try{var t=g.MappingDirection.None;var l="",s="",r="";if(typeof p==="undefined"||(!p)){var o=g._getRelationship(n,m);p=o[g.VALUE];l=o[g.INFO];s=o[g.WARNING];r=o[g.ERROR]}if(p===g.Relation.None){t=g.MappingDirection.None;l=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_NORELATION)}else{if(p===g.Relation.Parent){t=g.MappingDirection.Both}else{if(p===g.Relation.Child){t=g.MappingDirection.Both}else{if(p===g.Relation.Sibling){t=g.MappingDirection.Both;s=s+g.getNLSMessage(g.NLSID.DF_CAN_BE_CREATED_BOTH)}else{if(p===g.Relation.SiblingDownstream){t=g.MappingDirection.SecondToFirst}else{if(p===g.Relation.SiblingUpstream){t=g.MappingDirection.FirstToSecond}}}}}}return g.createReturnObj(t,l,s,r)}catch(q){return q}},isValidFromParameterMode:function(o,m){var l,n=false;switch(m){case g.Relation.Parent:switch(o){case a.Mode.Neutral:l=a.Mode.In;break;default:n=true}break;case g.Relation.Child:switch(o){case a.Mode.Neutral:l=a.Mode.Out;break;case a.Mode.In:l=a.Mode.InOut;break;default:n=true}break;case g.Relation.SiblingUpstream:switch(o){case a.Mode.Neutral:l=a.Mode.Out;break;case a.Mode.In:l=a.Mode.InOut;break;default:n=true}break;case g.Relation.SiblingDownstream:switch(o){case a.Mode.Neutral:l=a.Mode.In;break;case a.Mode.Out:l=a.Mode.InOut;break;default:n=true}break;default:n=false}return{isValid:n,details:{from:o,to:l}}},isValidToParameterMode:function(o,m){var l,n=false;switch(m){case g.Relation.Parent:switch(o){case a.Mode.Neutral:l=a.Mode.In;break;case a.Mode.Out:l=a.Mode.InOut;break;default:n=true}break;case g.Relation.Child:switch(o){case a.Mode.Neutral:l=a.Mode.Out;break;case a.Mode.In:l=a.Mode.InOut;break;default:n=true}break;case g.Relation.SiblingUpstream:switch(o){case a.Mode.Neutral:l=a.Mode.In;break;case a.Mode.Out:l=a.Mode.InOut;break;default:n=true}break;case g.Relation.SiblingDownstream:switch(o){case a.Mode.Neutral:l=a.Mode.Out;break;case a.Mode.In:l=a.Mode.InOut;break;default:n=true}break;default:n=false}return{isValid:n,details:{from:o,to:l}}},getPossibleMappingDirectionBetweenFIs:function(n,m,l){try{g._throwErrorIfNotDefined(n);g._throwErrorIfNotDefined(m);return g._getPossibleMappingDirectionBetweenFIs(n,m,l)}catch(o){throw o}},_dataTypeCompatiblityCheck:function(m,l,t){var r={};var q=false;var s="";var p="";var o=m.getDataType();var n=l.getDataType();if(o===n){q=true}else{if(o===a.DataType.client.Real&&n===a.DataType.client.Integer){q=true}else{if(o===a.DataType.client.Integer&&n===a.DataType.client.Real){q=true}else{if(t===g.MappingDirection.FirstToSecond){if(o!==a.DataType.client.Object&&n===a.DataType.client.String){q=true}else{if(o===a.DataType.client.String&&(n===a.DataType.client.Integer||n===a.DataType.client.Real)){q=true;p=g.getNLSMessage(g.NLSID.DF_MISMATCH_DATATYPE_WARNING)}else{s=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_MISMATCH_DATATYPE)}}}else{if(t===g.MappingDirection.SecondToFirst){if(n!==a.DataType.client.Object&&o===a.DataType.client.String){q=true}else{if(n===a.DataType.client.String&&(o===a.DataType.client.Integer||o===a.DataType.client.Real)){q=true;p=g.getNLSMessage(g.NLSID.DF_MISMATCH_DATATYPE_WARNING)}else{s=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_MISMATCH_DATATYPE)}}}else{s=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_MISMATCH_DATATYPE)}}}}}r.value=q;r.errorCode=s;r.warningStr=p;return r},dataTypeCompatiblityCheck:function(n,m,l){try{g._throwErrorIfNotDefined(n);g._throwErrorIfNotDefined(m);return g._dataTypeCompatiblityCheck(n,m,l)}catch(o){throw o}},_structureCompatiblityCheck:function(q,z,p,y,o,t){var x={},m=false;var w=false;var A="";var s=q.getStructure();var r=p.getStructure();if(s===r){if(s===a.Structure.client.Scalar){w=true}else{if(s===a.Structure.client.Array){if(z&&y){w=true}else{if(z||y){if((z&&r!==a.Structure.client.Scalar)||(y&&s!==a.Structure.client.Scalar)){w=false;A=g.getNLSMessage(g.NLSID.MISMATCH_STRUCTURE)}}else{if(!q.isSizable()&&!p.isSizable()){var n=q.getNumberOfDimensions();var l=p.getNumberOfDimensions();if(n===l){var v=o||q.getDimensionAsString(true);var u=t||p.getDimensionAsString(true);if(v===u){w=true}else{w=false;A=g.getNLSMessage(g.NLSID.MISMATCH_ARRAY_SIZE)}}else{w=false;A=g.getNLSMessage(g.NLSID.MISMATCH_DIMENSION)}}else{if(q.isSizable()&&!p.isSizable()){w=false;A=g.getNLSMessage(g.NLSID.MISMATCH_ARRAY_SIZABLE)}else{if(q.getNumberOfDimensions()!==p.getNumberOfDimensions()){w=false;A=g.getNLSMessage(g.NLSID.MISMATCH_DIMENSION)}else{w=true}}}}}}}}else{if((s===a.Structure.client.Scalar&&r===a.Structure.client.Array&&y)||(r===a.Structure.client.Scalar&&s===a.Structure.client.Array&&z)){w=true}else{w=false;A=g.getNLSMessage(g.NLSID.MISMATCH_STRUCTURE)}}x.value=w;x.errorCode=A;return x},structureCompatiblityCheck:function(q,p,o,n,l,m){try{g._throwErrorIfNotDefined(q);g._throwErrorIfNotDefined(o);return g._structureCompatiblityCheck(q,p,o,n,l,m)}catch(r){throw r}},_getPossibleMappingDirectionBetweenParameters:function(F,m,E,l,p){try{var t=g.MappingDirection.None;var D="",A="",B="";var r="";var o="";if(typeof p==="undefined"||(!p)){var x=F.getParent();g._throwErrorIfNotDefined(x);var w=E.getParent();g._throwErrorIfNotDefined(w);r=g._getRelationship(x,w);p=r[g.VALUE];D=r[g.INFO];A=r[g.WARNING];B=r[g.ERROR]}if(p===g.Relation.None){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_NORELATION)}else{var v=F.getMode();var s=E.getMode();r=null;r=g.structureCompatiblityCheck(F,m,E,l);var n=r.value;var u=r.errorCode;if(n===false){t=g.MappingDirection.None;D=u}else{if((v===a.Mode.client.Neutral)||(s===a.Mode.client.Neutral)){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_MODENEUTRAL)}else{if(p===g.Relation.Parent){if(v===a.Mode.client.In){if(s===a.Mode.client.In){t=g.MappingDirection.FirstToSecond}else{if(s===a.Mode.client.Out){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_PARENT_IN_TO_CHILD_OUT)}else{if(s===a.Mode.InOut){t=g.MappingDirection.FirstToSecond}}}}else{if(v===a.Mode.client.Out){if(s===a.Mode.In){t=g.MappingDirection.FirstToSecond}else{if(s===a.Mode.client.Out){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.InOut){t=g.MappingDirection.Both}}}}else{if(v===a.Mode.InOut){if(s===a.Mode.In){t=g.MappingDirection.FirstToSecond}else{if(s===a.Mode.client.Out){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.InOut){t=g.MappingDirection.Both}}}}}}}else{if(p===g.Relation.Child){if(v===a.Mode.client.In){if(s===a.Mode.client.In){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.client.Out){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.InOut){t=g.MappingDirection.SecondToFirst}}}}else{if(v===a.Mode.client.Out){if(s===a.Mode.client.In){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_PARENT_IN_TO_CHILD_OUT)}else{if(s===a.Mode.Out){t=g.MappingDirection.FirstToSecond}else{if(s===a.Mode.InOut){t=g.MappingDirection.FirstToSecond}}}}else{if(v===a.Mode.InOut){if(s===a.Mode.In){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.Out){t=g.MappingDirection.Both}else{if(s===a.Mode.InOut){t=g.MappingDirection.Both}}}}}}}else{if(p===g.Relation.SiblingUpstream){if(v===a.Mode.client.In){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_IN_TO_DOWNSTREAM)}else{if(v===a.Mode.client.Out){if(s===a.Mode.In){t=g.MappingDirection.FirstToSecond}else{if(s===a.Mode.client.Out){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_TO_DOWNSTREAM_OUT)}else{if(s===a.Mode.InOut){t=g.MappingDirection.FirstToSecond}}}}else{if(v===a.Mode.InOut){if(s===a.Mode.In){t=g.MappingDirection.FirstToSecond}else{if(s===a.Mode.client.Out){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_TO_DOWNSTREAM_OUT)}else{if(s===a.Mode.InOut){t=g.MappingDirection.FirstToSecond}}}}}}}else{if(p===g.Relation.SiblingDownstream){if(v===a.Mode.client.In){if(s===a.Mode.client.In){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_IN_TO_DOWNSTREAM)}else{if(s===a.Mode.client.Out){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.InOut){t=g.MappingDirection.SecondToFirst}}}}else{if(v===a.Mode.client.Out){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_TO_DOWNSTREAM_OUT)}else{if(v===a.Mode.InOut){if(s===a.Mode.In){t=g.MappingDirection.None;D=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_IN_TO_DOWNSTREAM)}else{if(s===a.Mode.Out){t=g.MappingDirection.SecondToFirst}else{if(s===a.Mode.InOut){t=g.MappingDirection.SecondToFirst}}}}}}}else{if(p===g.Relation.Sibling){t=g.MappingDirection.Both;A=A+g.getNLSMessage(g.NLSID.DF_CAN_BE_CREATED_SIBLINGS_UNDETERMINED_ORDER)}}}}}}}}if((t===g.MappingDirection.SecondToFirst)||(t===g.MappingDirection.FirstToSecond)){r=null;r=g.dataTypeCompatiblityCheck(F,E,t);var q=r.value;o=r.errorCode;A=r.warningStr;if(q===false){t=g.MappingDirection.None;D=o}}else{if(t===g.MappingDirection.Both){var z=false;r=null;r=g.dataTypeCompatiblityCheck(F,E,g.MappingDirection.FirstToSecond);z=r.value;A=r.warningStr;r=null;r=g.dataTypeCompatiblityCheck(F,E,g.MappingDirection.SecondToFirst);var y=r.value;if(z===true&&y===true){t===g.MappingDirection.Both}else{if(z===true){t===g.MappingDirection.FirstToSecond}else{if(y===true){t===g.MappingDirection.SecondToFirst}else{o=r.errorCode;t=g.MappingDirection.None;D=o}}}}}return g.createReturnObj(t,D,A,B)}catch(C){throw C}},getPossibleMappingDirectionBetweenParameters:function(p,o,n,m,l){try{g._throwErrorIfNotDefined(p);g._throwErrorIfNotDefined(n);return g._getPossibleMappingDirectionBetweenParameters(p,o,n,m,l)}catch(q){throw q}},_getPossibleMappingDirectionBetweenParameterAndFI:function(o,B,n,r,u){try{var A=g.MappingDirection.None;var m="",z="",y="";var q=null;var t;if(typeof r==="undefined"||(!r)){var x=o.getParent();g._throwErrorIfNotDefined(x);g._throwErrorIfNotDefined(n);var p=g._getRelationship(x,n);r=p[g.VALUE];m=p[g.INFO];z=p[g.WARNING];y=p[g.ERROR]}if(r===g.Relation.None){A=g.MappingDirection.None;m=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_NORELATION)}else{var l=o.getMode();q=u.newParameter;q.setParent(n);if(r===g.Relation.Parent){if(l===a.Mode.client.In){A=g.MappingDirection.FirstToSecond;t=a.Mode.client.In;if(q){q.setMode(t)}}else{if(l===a.Mode.client.Out){A=g.MappingDirection.SecondToFirst;t=a.Mode.client.Out;if(q){q.setMode(t)}}else{if(l===a.Mode.InOut){A=g.MappingDirection.Both;t=a.Mode.InOut;if(q){q.setMode(t)}}}}}else{if(r===g.Relation.Child){if(l===a.Mode.client.In){A=g.MappingDirection.SecondToFirst;t=a.Mode.client.In;if(q){q.setMode(t)}}else{if(l===a.Mode.client.Out){A=g.MappingDirection.FirstToSecond;t=a.Mode.client.Out;if(q){q.setMode(t)}}else{if(l===a.Mode.InOut){A=g.MappingDirection.Both;t=a.Mode.InOut;if(q){q.setMode(t)}}}}}else{if(r===g.Relation.SiblingUpstream){if(l===a.Mode.client.In){A=g.MappingDirection.None;y=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_IN_TO_DOWNSTREAM)}else{if(l===a.Mode.client.Out){A=g.MappingDirection.FirstToSecond;t=a.Mode.In;if(q){q.setMode(t)}}else{if(l===a.Mode.InOut){A=g.MappingDirection.FirstToSecond;t=a.Mode.InOut;if(q){q.setMode(t)}}}}}else{if(r===g.Relation.SiblingDownstream){if(l===a.Mode.client.In){A=g.MappingDirection.SecondToFirst;t=a.Mode.client.Out;if(q){q.setMode(t)}}else{if(l===a.Mode.client.Out){A=g.MappingDirection.None;y=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_UPSTREAM_TO_DOWNSTREAM_OUT)}else{if(l===a.Mode.InOut){A=g.MappingDirection.SecondToFirst;t=a.Mode.InOut;if(q){q.setMode(t)}}}}}else{if(r===g.Relation.Sibling){y=g.getNLSMessage(g.NLSID.DF_CAN_BE_CREATED_SIBLINGS_UNDETERMINED_ORDER)}}}}}}var w;var s={newParameter:q,slice:w};return g.createReturnObj(A,m,z,y,s)}catch(v){throw v}},isCreatingUpstreamDf:function(l,m){if(l===g.Relation.SiblingUpstream){if(m===g.MappingDirection.SecondToFirst){return true}}else{if(l===g.Relation.SiblingDownstream){if(m===g.MappingDirection.FirstToSecond){return true}}}return false},_createMappingBetweenParameters:function(o,s,n,r,t){try{var q=[];var m;if(t===g.MappingDirection.FirstToSecond){m=new e();m.setFromParameter(o);if(s){m.setFromSlice(o.offsetToIndexString(s))}m.setToParameter(n);if(r){m.setToSlice(n.offsetToIndexString(r))}q.push(m)}else{if(t===g.MappingDirection.SecondToFirst){m=new e();m.setFromParameter(n);if(r){m.setFromSlice(n.offsetToIndexString(r))}m.setToParameter(o);if(s){m.setToSlice(o.offsetToIndexString(s))}q.push(m)}else{if(t===g.MappingDirection.Both){m=new e();m.setFromParameter(o);if(s){m.setFromSlice(o.offsetToIndexString(s))}m.setToParameter(n);if(r){m.setToSlice(n.offsetToIndexString(r))}q.push(m);var l=new e();l.setFromParameter(n);if(r){l.setFromSlice(n.offsetToIndexString(r))}l.setToParameter(o);if(s){l.setToSlice(o.offsetToIndexString(s))}q.push(l)}}}return q}catch(p){return p}},checkIfTempDataFlowExists:function(n,l){if(n){for(var m=0;m<n.length;m++){if(JSON.stringify(n[m])===JSON.stringify(l[0])){return true}}}return false},createMappingBetweenParameters:function(C,p,B,n,D,r){try{var E=[];var A="",w="",x="";var s=null;var F=null;var v=null;g._throwErrorIfNotDefined(C);g._throwErrorIfNotDefined(B);g._throwErrorIfNotDefined(D);var q=C.getParent();var o=B.getParent();g._throwErrorIfNotDefined(q);g._throwErrorIfNotDefined(o);var m=b.getFI(q);var l=b.getFI(o);q=m;o=l;g._throwErrorIfNotDefined(q);g._throwErrorIfNotDefined(o);if(typeof D==="undefined"||(!D)){D=g.MappingDirection.Both}if(typeof r==="undefined"||(!r)){s=g._getRelationship(q,o);r=s[g.VALUE];A=s[g.INFO];w=s[g.WARNING];x=s[g.ERROR]}if(r===g.Relation.None){x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_NORELATION)}else{if(g.isCreatingUpstreamDf(r,D)){x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_DOWNSTREAM_TO_UPSTREAM)}else{var t=g.Relation.None;s=g._getPossibleMappingDirectionBetweenParameters(C,p,B,n,r);t=s[g.VALUE];A=s[g.INFO];w=s[g.WARNING];x=s[g.ERROR];if(t===g.MappingDirection.None){x=A}else{if(D!==g.MappingDirection.Both){if((t===D)||(t===g.MappingDirection.Both)){F=g.getDataFlowsBetweenParameters(C,B,D,r)[g.VALUE];v=g._searchInDataFlows(F,C.getParent(),C,p,B.getParent(),B,n,D);if(v===true){x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_ALREADY_EXISTS)}else{E=g._createMappingBetweenParameters(C,p,B,n,D)}}else{x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_INSELECTED_DIRECTION)}}else{if(t!==D){F=g.getDataFlowsBetweenParameters(C,B,t,r)[g.VALUE];v=g._searchInDataFlows(F,C.getParent(),C,p,B.getParent(),B,n,t);if(v===true){x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_ALREADY_EXISTS)}else{E=g._createMappingBetweenParameters(C,p,B,n,t)}}else{F=[];var y=[],u=[];F=g.getDataFlowsBetweenParameters(C,B,g.MappingDirection.FirstToSecond,r)[g.VALUE];v=g._searchInDataFlows(F,C.getParent(),C,p,B.getParent(),B,n,g.MappingDirection.FirstToSecond);if(v===true){x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_ALREADY_EXISTS)}else{y=g._createMappingBetweenParameters(C,p,B,n,g.MappingDirection.FirstToSecond)}F=g.getDataFlowsBetweenParameters(C,B,g.MappingDirection.SecondToFirst,r)[g.VALUE];v=g._searchInDataFlows(F,C.getParent(),C,p,B.getParent(),B,n,g.MappingDirection.SecondToFirst);if(v===true){x=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_ALREADY_EXISTS)}else{u=g._createMappingBetweenParameters(C,p,B,n,g.MappingDirection.SecondToFirst)}E=y.concat(u)}}}}}if(q&&this.checkIfTempDataFlowExists(q.getTemporaryDataflows(a.State.Created),E)){x=x+g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_ALREADY_EXISTS)}else{if(q.getParent()&&this.checkIfTempDataFlowExists(q.getParent(a.State.Created).getTemporaryDataflows(),E)){x=x+g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_ALREADY_EXISTS)}}return g.createReturnObj(E,A,w,x)}catch(z){throw z}},_searchInDataFlows:function(A,o,r,z,n,p,x,B){var y=false;if(A.length>0){var v=null,t=null,m=null,q=null,l=null,u=null;if(B===g.MappingDirection.FirstToSecond){v=o;t=r;m=z;if(t&&m){m=t.offsetToIndexString(m)}q=n;l=p;u=x;if(l&&u){u=l.offsetToIndexString(u)}}else{if(B===g.MappingDirection.SecondToFirst){v=n;t=p;m=x;if(t&&m){m=t.offsetToIndexString(m)}q=o;l=r;u=z;if(l&&u){u=l.offsetToIndexString(u)}}}for(var s=0;s<A.length;s++){var w=A[s];if(w.getFromParameter().getParent()===v&&w.getFromParameter()===t&&(typeof w.getFromSlice()==="undefined"||w.getFromSlice()===m)&&w.getToParameter().getParent()===q&&w.getToParameter()===l&&(typeof w.getToSlice()==="undefined"||w.getToSlice()===u)){y=true;break}}}return y},_filterDFs:function(o,m){var p=2;var l=[];if(m&&(m instanceof Array)){for(var n=0;n<m.length;n++){if(o){if((o.FI)&&(o.FI instanceof Array)&&(o.FI.length===1)&&(!o.Parameter)){if((m[n].getFromParameter().getParent()===o.FI[0])||(m[n].getToParameter().getParent()===o.FI[0])){l.push(m[n])}}else{if((o.FI)&&(o.FI instanceof Array)&&(o.FI.length===p)&&(!o.Parameter)){if((!o.Direction)||(o.Direction===g.MappingDirection.Both)){if(((m[n].getFromParameter().getParent()===o.FI[0])&&(m[n].getToParameter().getParent()===o.FI[1]))||((m[n].getToParameter().getParent()===o.FI[0])&&(m[n].getFromParameter().getParent()===o.FI[1]))){l.push(m[n])}}else{if(o.Direction===g.MappingDirection.FirstToSecond){if((m[n].getFromParameter().getParent()===o.FI[0])&&(m[n].getToParameter().getParent()===o.FI[1])){l.push(m[n])}}else{if(o.Direction===g.MappingDirection.SecondToFirst){if((m[n].getToParameter().getParent()===o.FI[0])&&(m[n].getFromParameter().getParent()===o.FI[1])){l.push(m[n])}}}}}else{if((o.Parameter)&&(o.Parameter instanceof Array)&&(o.Parameter.length===1)&&(!o.FI)){if((m[n].getFromParameter()===o.Parameter[0])||(m[n].getToParameter()===o.Parameter[0])){l.push(m[n])}}else{if((o.Parameter)&&(o.Parameter instanceof Array)&&(o.Parameter.length===p)&&(!o.FI)){if((!o.Direction)||(o.Direction===g.MappingDirection.Both)){if(((m[n].getFromParameter()===o.Parameter[0])&&(m[n].getToParameter()===o.Parameter[1]))||((m[n].getToParameter()===o.Parameter[0])&&(m[n].getFromParameter()===o.Parameter[1]))){l.push(m[n])}}else{if(o.Direction===g.MappingDirection.FirstToSecond){if((m[n].getFromParameter()===o.Parameter[0])&&(m[n].getToParameter()===o.Parameter[1])){l.push(m[n])}}else{if(o.Direction===g.MappingDirection.SecondToFirst){if((m[n].getToParameter()===o.Parameter[0])&&(m[n].getFromParameter()===o.Parameter[1])){l.push(m[n])}}}}}else{if((o.FI)&&(o.FI instanceof Array)&&(o.FI.length===1)&&(o.Parameter)&&(o.Parameter instanceof Array)&&(o.Parameter.length===1)){if((!o.Direction)||(o.Direction===g.MappingDirection.Both)){if(((m[n].getFromParameter()===o.Parameter[0])&&(m[n].getToParameter().getParent()===o.FI[0]))||((m[n].getToParameter()===o.Parameter[0])&&(m[n].getFromParameter().getParent()===o.FI[0]))){l.push(m[n])}}else{if(o.Direction===g.MappingDirection.FirstToSecond){if((m[n].getFromParameter()===o.Parameter[0])&&(m[n].getToParameter().getParent()===o.FI[0])){l.push(m[n])}}else{if(o.Direction===g.MappingDirection.SecondToFirst){if((m[n].getToParameter()===o.Parameter[0])&&(m[n].getFromParameter().getParent()===o.FI[0])){l.push(m[n])}}}}}}}}}}}}return l},_getDFSpaceForFI:function(m){var l=[];if(m){if(m.getDataFlows){l.push.apply(l,m.getDataFlows())}if(m.getTemporaryDataflows){l.push.apply(l,m.getTemporaryDataflows(a.State.Created))}}if(m&&m.getParent&&m.getParent()){if(m.getParent().getDataFlows){l.push.apply(l,m.getParent().getDataFlows())}if(m.getParent().getTemporaryDataflows){l.push.apply(l,m.getParent().getTemporaryDataflows(a.State.Created))}}return l},getDataFlowsForFI:function(r){try{var l=[];var q="",o="",m="";g._throwErrorIfNotDefined(r);var n=g._getDFSpaceForFI(r);if(n){l=g._filterDFs({FI:[r]},n)}return g.createReturnObj(l,q,o,m)}catch(p){return p}},_getDataFlowsForParameter:function(l){try{var m=[];var q=l.getParent();g._throwErrorIfNotDefined(q);var o=g.getDataFlowsForFI(q);var n=o[g.VALUE];m.push.apply(m,g._filterDFs({Parameter:[l]},n));return m}catch(p){return p}},getDataFlowsForParameter:function(l){try{g._throwErrorIfNotDefined(l);var m=[];var q="",o="",n="";if(l&&l.getParent&&l.getParent()){m=g._getDataFlowsForParameter(l)}return g.createReturnObj(m,q,o,n)}catch(p){return p}},havingValidFromSideMode:function(n,l){if(l===g.Relation.SiblingDownstream){return false}var m=n===a.Mode.Out||n===a.Mode.InOut;if(!m&&l===g.Relation.Parent&&n===a.Mode.In){return true}return m},getMinValidModeToCreateMapping:function(l){if(l===g.Relation.Parent){return a.Mode.In}else{if(l===g.Relation.Child||l===g.Relation.SiblingDownstream){return a.Mode.Out}}return a.Mode.In},havingValidToSideMode:function(n,l){var m=n===a.Mode.InOut;if(!m&&l===g.Relation.Child&&n===a.Mode.Out){return true}else{if(!m&&l!==g.Relation.Child&&n===a.Mode.In){return true}}return m},getInValidDataFlowsForParameters:function(s,o,u,m){var p,l;try{var n={toSide:{error:[],warning:[]},fromSide:{error:[],warning:[]}};if(!u&&o.length>0){u=g.getDataFlowsForParameters(o,u)}if(s&&s.name){if(s.name==="arraySize"){u.fromSide.forEach(function(v){l=this.getUpdatedParameter(v.getToParameter());var w=l.getDimensions()[s.index]===s.value;if(!w&&!l.isSizable()){n.fromSide.error.push(v)}}.bind(this));u.toSide.forEach(function(v){p=this.getUpdatedParameter(v.getFromParameter());var w=p.getDimensions()[s.index]===s.value;if(!w&&!p.isSizable()){n.toSide.error.push(v)}}.bind(this))}else{if(s.name==="resizableDims"){u.fromSide.forEach(function(v){var w=this.getUpdatedParameter(v.getFromParameter());var x=this.getUpdatedParameter(v.getToParameter());var y=g.structureCompatiblityCheck(w,undefined,x,undefined,m).value;if(!y){n.fromSide.error.push(v)}}.bind(this));u.toSide.forEach(function(v){var w=g.structureCompatiblityCheck(this.getUpdatedParameter(v.getFromParameter()),undefined,this.getUpdatedParameter(v.getToParameter()),undefined,undefined,m).value;if(!w){n.toSide.error.push(v)}}.bind(this))}else{if(s.name==="Mode"){var q=a.Mode.client[s.value];u.fromSide.forEach(function(v){var y=v.getFromParameter().getParent();var x=v.getToParameter().getParent();var w=g.getRelationship(y,x).value;var z=g.havingValidFromSideMode(q,w);if(!z){n.fromSide.error.push(v)}});u.toSide.forEach(function(v){var y=v.getFromParameter().getParent();var x=v.getToParameter().getParent();var w=g.getRelationship(y,x).value;var z=g.havingValidToSideMode(q,w);if(!z){n.toSide.error.push(v)}})}else{if(s.name==="Type"){var t={};u.fromSide.forEach(function(v){var w=v._fromParameter;o&&o.forEach&&o.forEach(function(x){var z=x.getState();var y;if(z===a.State.Modified){y=x.getReference()}if(v._fromParameter===x||v._fromParameter===y){w=x}});t=g.dataTypeCompatiblityCheck(w,v._toParameter,g.MappingDirection.FirstToSecond);if(!t.value){n.fromSide.error.push(v)}else{if(t.warningStr.length>0){n.fromSide.warning.push(v)}}});u.toSide.forEach(function(v){var w=v._toParameter;o&&o.forEach&&o.forEach(function(x){var z=x.getState();var y;if(z===a.State.Modified){y=x.getReference()}if(v._toParameter===x||v._toParameter===y){w=x}});t=g.dataTypeCompatiblityCheck(w,v._fromParameter,g.MappingDirection.SecondToFirst);if(!t.value){n.toSide.error.push(v)}else{if(t.warningStr.length>0){n.toSide.warning.push(v)}}})}else{if(s.name==="dataSubType"){var t={};u.fromSide.forEach(function(v){var w=v._fromParameter;var x;o&&o.forEach&&o.forEach(function(y){w=this.getUpdatedParameter(v.getFromParameter());x=w.getDataSubType()===s.value}.bind(this));if(!x){n.fromSide.error.push(v)}}.bind(this));u.toSide.forEach(function(v){var w=v._toParameter;var x;o&&o.forEach&&o.forEach(function(y){w=this.getUpdatedParameter(v.getToParameter());x=w.getDataSubType()===s.value}.bind(this));if(!x){n.toSide.error.push(v)}}.bind(this))}}}}}}return n}catch(r){return r}},getUpdatedParameter:function(l){if(l.getState()===a.State.Modified){return l.getReference()}return l},getContainerForDataFlow:function(m,l){if(m.isProcess()){return m}else{if(l.isProcess()){return l}else{if(m.getParent()===l.getParent()){return m.getParent()}else{if(m===l.getParent()){return m}else{if(m.getParent()===l){return l}}}}}return m},_getDFSpaceBetweenFIs:function(o,n,l){var m=[];if(l===g.Relation.Parent){if(o&&o.getDataFlows){m.push.apply(m,o.getDataFlows())}if(o&&o.getTemporaryDataflows){m.push.apply(m,o.getTemporaryDataflows(a.State.Created))}}else{if(l===g.Relation.Child){if(n&&n.getDataFlows){m.push.apply(m,n.getDataFlows())}if(n&&n.getTemporaryDataflows){m.push.apply(m,n.getTemporaryDataflows(a.State.Created))}}else{if((l===g.Relation.Sibling)||(l===g.Relation.SiblingUpstream)||(l===g.Relation.SiblingDownstream)){if(o.getParent&&o.getParent()){if(o.getParent().getDataFlows){m.push.apply(m,o.getParent().getDataFlows())}if(o&&o.getParent().getTemporaryDataflows){m.push.apply(m,o.getParent().getTemporaryDataflows(a.State.Created))}}else{var p=b.getParentDataContainer(o);if(p){if(p.getDataFlows()){m.push.apply(m,p.getDataFlows())}if(o&&p.getTemporaryDataflows()){m.push.apply(m,p.getTemporaryDataflows(a.State.Created))}}}}}}return m},getDataFlowCountBetweenFIs:function(o,n,m,l){var p=g.getDataFlowsBetweenFIs(o,n,m,l);return p.value?p.value.length:0},getDataFlowsBetweenFIs:function(n,m,v,p){try{var s=[];var l="",u="",t="";g._throwErrorIfNotDefined(n);g._throwErrorIfNotDefined(m);if(typeof p==="undefined"||(!p)){var o=g._getRelationship(n,m);p=o[g.VALUE];l=o[g.INFO];u=o[g.WARNING];t=o[g.ERROR]}if(p!==g.Relation.None){var q=g._getDFSpaceBetweenFIs(n,m,p);if(q){s=g._filterDFs({FI:[n,m],Direction:v},q)}}return g.createReturnObj(s,l,u,t)}catch(r){return r}},getDataFlowsBetweenParameterAndFI:function(o,m,w,q){try{var t=[];var l="",v="",u="";g._throwErrorIfNotDefined(o);g._throwErrorIfNotDefined(m);var n=o.getParent();g._throwErrorIfNotDefined(n);if(typeof q==="undefined"||(!q)){var p=g._getRelationship(n,m);q=p[g.VALUE];l=p[g.INFO];v=p[g.WARNING];u=p[g.ERROR]}if(q!==g.Relation.None){var r=g._getDFSpaceBetweenFIs(n,m,q);if(r){t=g._filterDFs({Parameter:[o],FI:[m],Direction:w},r)}}return g.createReturnObj(t,l,v,u)}catch(s){return s}},getDataFlowsBetweenParameters:function(p,o,x,r){try{var u=[];var l="",w="",v="";g._throwErrorIfNotDefined(p);g._throwErrorIfNotDefined(o);var n=p.getParent();var m=o.getParent();g._throwErrorIfNotDefined(n);g._throwErrorIfNotDefined(m);if(typeof r==="undefined"||(!r)){var q=g._getRelationship(n,m);r=q[g.VALUE];l=q[g.INFO];w=q[g.WARNING];v=q[g.ERROR]}if(r!==g.Relation.None){var s=g._getDFSpaceBetweenFIs(n,m,r);if(s){u=g._filterDFs({Parameter:[p,o],Direction:x},s)}}return g.createReturnObj(u,l,w,v)}catch(t){return t}},autoMapBetweenFIs:function(n,m,r){try{var v=[];var l="",x="",w="";var q=null;g._throwErrorIfNotDefined(n);g._throwErrorIfNotDefined(m);if(typeof r==="undefined"||(!r)){q=g._getRelationship(n,m);r=q[g.VALUE];l=q[g.INFO];x=q[g.WARNING];w=q[g.ERROR]}if(r===g.Relation.None){w=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_NORELATION)}else{var o=n.getParameters();for(var t=0;t<o.length;t++){var y=m.findParameterByName(o[t].getName());if(y){q=g._autoMapBetweenParameterAndFI(o[t],m,r);var s=q[g.VALUE];l=q[g.INFO];x=q[g.WARNING];w=w+q[g.ERROR];for(var p=0;p<s.length;p++){v.push(s[p])}}}}return g.createReturnObj(v,l,x,w)}catch(u){throw u}},_autoMapBetweenParameterAndFI:function(n,m,q){try{var t=[];var l="",v="",u="";var p=null;if(!m.isGateway()){if(q===g.Relation.None){u=g.getNLSMessage(g.NLSID.DF_CANNOT_BE_CREATED_NORELATION)}else{var w=m.findParameterByName(n.getName());if(typeof w!=="undefined"&&(w)){p=g.createMappingBetweenParameters(n,null,w,null,g.MappingDirection.Both,q);var r=p[g.VALUE];l=p[g.INFO];v=p[g.WARNING];u=p[g.ERROR];for(var o=0;o<r.length;o++){t.push(r[o])}}}}return g.createReturnObj(t,l,v,u)}catch(s){throw s}},autoMapBetweenParameterAndFI:function(o,m,l){try{g._throwErrorIfNotDefined(o);var n=o.getParent();g._throwErrorIfNotDefined(n);g._throwErrorIfNotDefined(m);n=o.getParent();g._throwErrorIfNotDefined(n);return g._autoMapBetweenParameterAndFI(o,m,l)}catch(p){throw p}},autoMapForParameter:function(B){try{var C=[];var l=[];var A="",v="",w="";var t=null;var p=null;var y=0,x=0;g._throwErrorIfNotDefined(B);var m=b.getOwningFI(B);g._throwErrorIfNotDefined(m);var q=m.getParent();var r=g.Relation.Child;if(q){t=g._autoMapBetweenParameterAndFI(B,q,r);l=t.value;for(x=0;x<l.length;x++){l[x].setParent(q);C.push(l[x])}var s=a.getChildrenInOrder(q);var n=s.indexOf(m);for(y=0;y<s.length;y++){p=s[y];if((p)&&(!(p.isGateway()))&&(p!==m)){var u=s.indexOf(p);if(u>-1&&n>-1){if(u>n){t=g._autoMapBetweenParameterAndFI(B,p,g.Relation.SiblingUpstream)}else{if(u<n){t=g._autoMapBetweenParameterAndFI(B,p,g.Relation.SiblingDownstream)}else{t=g._autoMapBetweenParameterAndFI(B,p,g.Relation.Sibling)}}l=t.value;for(x=0;x<l.length;x++){l[x].setParent(q);C.push(l[x])}}}}}var o=m.getChildren();for(y=0;y<o.length;y++){p=o[y];r=g.Relation.Parent;if(p){t=g._autoMapBetweenParameterAndFI(B,p,r);l=t.value;for(x=0;x<l.length;x++){l[x].setParent(m);C.push(l[x])}}}return g.createReturnObj(C,A,v,w)}catch(z){throw z}},getRouteMapping:function(m,l,o){var n=1,p=[];if(o&&o.length>0){p.push(this.getAutoMappingMetaInfo(m,l,o[0],o[0].getParameters()));while(n<o.length){p.push(this.getAutoMappingMetaInfo(o[n-1],o[n-1].getParameters(),o[n],o[n].getParameters()));n+=1}}},getAutoMappingMetaInfo:function(r,q,n,m){var p=g.getRelationship(r,n).value;var l={fromSideFlowItem:r,toSideFlowItem:n,dataFlowContainer:g.getDataFlowDataContainerForDataContainers(r,n,p),validAutoMappings:[],validAutoMappingsAfterCreate:[],impossibleMappings:[]};var s=this.getNameParameterMap(m);var o=g.getDataFlowSpaceForDataContainer(r).value;q.forEach(function(u){var y=u.parameter;var A=false,x=false,w=false,z=false,t=false,v=s[y.getName()];if(v){A=g.structureCompatiblityCheck(y,undefined,v,undefined).value;w=g.dataTypeCompatiblityCheck(y,v,g.MappingDirection.FirstToSecond).value;z=g.havingValidFromSideMode(y.getMode(),p);t=g.havingValidToSideMode(v.getMode(),p);x=this.hasValidRelation(p);if(A&&w&&z&&t&&x){if(!g.isDataFlowAvailableBetweenParameters(o,y,v,g.MappingDirection.FirstToSecond)){l.validAutoMappings.push({fromSideParameter:y,toSideParameter:v})}else{l.impossibleMappings.push({fromSideParameter:y,toSideParameter:v,error:{mappingAlreadyAvailable:true}})}}else{l.impossibleMappings.push({fromSideParameter:y,toSideParameter:v,error:{inValidStructure:!A,inValidType:!w,inValidFromSideMode:!z,inValidToSideMode:!t,inValidRelation:!x}})}}else{z=g.havingValidFromSideMode(y.getMode(),p);x=this.hasValidRelation(p);if(z&&x){l.validAutoMappingsAfterCreate.push({fromSideParameter:y})}else{l.impossibleMappings.push({fromSideParameter:y,error:{inValidFromSideMode:!z,inValidRelation:!x}})}}}.bind(this));return l},createAutoMappings:function(q,p){for(var m=0;m<q.length;m++){var o=this.autoMapForParameter(q[m]);for(var l=0;l<o.value.length;l++){var n=o.value[l]._parent.getDataContainer();this.addDataflow(o.value[l],n)}}},suggestAutoMappings:function(q,p){var l=[];var r=false;for(var n=0;n<q.length;n++){var o=this.autoMapForParameter(q[n]);for(var m=0;m<o.value.length;m++){l.push(o.value[0])}}return l},getValidFIForOneToMany:function(l){var m=[];m.parent=b.getParentDataContainer(l);m.downstreamFIs=b.getDownStreamDataContainers(l);m.childFIs=b.getChildDataContainers(l);return m},_getDataFlowPathForParameter:function(s,l){var m=g.getDataFlowsForParameters([s]);var o=s.getParent();var q=k.getParentFIsDataContainer(o);var r=false;var n=false;for(var p=0;p<l.length;p+=1){if(l[p].activity===o.getId()){l[p].parameters.push(s.getId());n=true}if(q){if(l[p].activity===q.getId()){l[p].parameters.push(s.getId());r=true}}}if(!n){l.push({activity:o.getId(),parameters:[s.getId()]})}if(q){if(!r){l.push({activity:q.getId(),parameters:[s.getId()]})}}return m},getDataFlowPathForParameters:function(z,o,u){o=o?o:[];var v;var s;var p;u=u?u:[];var n=[];if(z){var w=z.getParent();var y=k.getParentFIsDataContainer(w);var r=false;for(var t=0;t<u.length;t+=1){if(u[t].activity===w.getId()){n=u[t].parameters;for(s=0;s<n.length;s+=1){if(n[s]===z.getId()){r=true;break}}}if(y){if(u[t].activity===y.getId()){n=u[t].parameters;for(s=0;s<n.length;s+=1){if(n[s]===z.getId()){r=true;break}}}}}if(!r){var q=g._getDataFlowPathForParameter(z,u);var m=false;var x;var l;for(v=0;v<q.fromSide.length;v+=1){x=q.fromSide[v];if(x){m=false;for(p=0;p<o.length;p+=1){if(x===o[p]){m=true;break}}if(!m){o.push(x)}l=x.getToParameter();g.getDataFlowPathForParameters(l,o,u)}}for(v=0;v<q.toSide.length;v+=1){x=q.toSide[v];if(x){m=false;for(p=0;p<o.length;p+=1){if(x===o[p]){m=true;break}}if(!m){o.push(x)}l=x.getFromParameter();g.getDataFlowPathForParameters(l,o,u)}}}}return o},getDataFlowPathForParameterPerActivity:function(s){var r=g.getDataFlowPathForParameters(s);var o=[];for(var q=0;q<r.length;q+=1){var m=r[q].getFromParameter().getParent();var l=false;for(var p=0;p<o.length;p+=1){var n=o[p].activity;if(m===n){l=true;o[p].dataflows.push(r[q]);break}}if(!l){o.push({activity:m,dataflows:[r[q]]})}}return o}};return g});define("DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils",["UWA/Utils","DS/JSCMM/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataContainerUtils","DS/JSCMM/SMAJSCMMPLMObject","DS/JSCMM/SMAJSCMMParameter","DS/JSCMM/SMAJSCMMContainerUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/Logger/Logger","module","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAJSCMMDataFlowUtilsNLS","i18n!DS/SMAProcWebCMMUtils/assets/nls/SMAProcWebAuthoringNLS"],function(h,b,l,p,c,k,i,f,m,e,d,j,a){var n=e.getLogger(d);var g=/[\\."#$@%*,?<>[\]{}|:=']/g;var o={addParametersToDataContainer:function(t,v,r,q){var u=false,s=[],w=[];u=t instanceof Array;if((!t)||(!v)){return u?[]:undefined}if(!u){w.push(t)}t.forEach(function(x){var y;if((x.getParent())&&(x.getParent()!==v)){y=o.cloneParameter(x);y.setParent(v);y.setState(b.State.Created);s.push(y)}else{x.setState(b.State.Created);x.setParent(v);s.push(x)}});if(!u){v.addTemporaryParameters(s[0]);if(r){l.createAutoMappings(s,v)}if(q){l.suggestAutoMappings(s,v)}}else{v.addTemporaryParameters(s);if(r){l.createAutoMappings(s,v)}if(q){l.suggestAutoMappings(s,v)}}return s},addParameterToDataContainer:function(q,t){var s=q;if((!q)||(!t)){return s}if((q.getParent())&&(q.getParent()!==t)){var r=o.cloneParameter(q);r.setParent(t);r.setState(b.State.Created);t.addTemporaryParameter(r);s=r}else{q.setState(b.State.Created);q.setParent(t);t.addTemporaryParameter(q);s=q}return s},addParameter:function(q,w,s,r){var v=q;var t;if((typeof q==="undefined")||(typeof w==="undefined")){return v}var u=c.getDataContainer(w);if(u){v=o.addParameterToDataContainer(q,u,s,r)}return v},addParameters:function(t,v,r,q){var s=[];if((typeof t==="undefined")||(typeof v==="undefined")){return[]}var u=c.getDataContainer(v);if(u){s=o.addParametersToDataContainer(t,u,r,q)}return s},modifyParameter:function(q,t){var v=q;if(!q){return v}var s=q.getState();if(s===b.State.None){var u=null;if(t){u=t}else{u=o.cloneParameter(q)}u.setReference(q);u.setState(b.State.Modified);var r=q.getParent();if(r){r.addTemporaryParameter(u)}v=u}return v},deleteParameter:function(q){var u=q;var t;var v=[];if(!q){return u}var s=q.getState();if(s===b.State.None){t=q.getParent();if(t){t.addTemporaryParameter(q)}u=q}else{if(s===b.State.Modified){var r=q.getReference();q.setReference();t=r.getParent();if(t){t.removeTemporaryParameter(q);t.addTemporaryParameter(r);v=l.getDataFlowsForParameter(r);v.value.forEach(function(w){l.deleteDataflow(w,w.getParent())})}u=r}else{if(s===b.State.Created){t=q.getParent();if(t){t.removeTemporaryParameter(q)}u=q}}}return u},getPLMObjectByContentChooserObject:function(s){var q=s;q.physicalId=s.objectId;q.busType=s.objectTypeValue||s.objectType;var r=new k(q);r.setName(s.displayName);return r},hasPendingParameterUpdates:function(r){var q=false;if(r.getTemporaryParameters(b.State.Deleted).length||r.getTemporaryParameters(b.State.Created).length||r.getTemporaryParameters(b.State.Modified).length){q=true}return q},clearTemporaryParameters:function(q){if((typeof q==="undefined")||(q===null)){return}q.clearTemporaryParameters(b.State.Created);q.clearTemporaryParameters(b.State.Modified);q.clearTemporaryParameters(b.State.Deleted)},getPromiseForSaveParameter:function(q){return new Promise(function(s,r){o.saveParameters(q,{onSuccess:function(t){s(t)},onFailure:function(t){r(t)}})})},saveAllParameters:function(s,v){var r=v&&v.onSuccess||n.info.bind(n);var u=v&&v.onFailure||n.warn.bind(n);if(m.isWebInWin()){m.saveParameters(s,{onSuccess:function(y){for(var w=0;w<s.length;w+=1){var x=s[w].getTemporaryParameters(b.State.Deleted);o._parameterDeletedWSCB(s[w],x,b.State.Deleted);x=s[w].getTemporaryParameters(b.State.Created);o._parameterCreatedWSCB(s[w],x,b.State.Created,y);x=s[w].getTemporaryParameters(b.State.Modified);o._parameterModifiedWSCB(s[w],x,b.State.Modified)}r()},onFailure:function(w){u()}})}else{var t=Promise.resolve(null);for(var q=0;q<s.length;q+=1){t=t.then(o.getPromiseForSaveParameter.bind(this,s[q]))}t=t.then(r,u)}},saveParameters:function(t,u){var r=this;var q=u&&u.onSuccess||n.info.bind(n);var s=u&&u.onFailure||n.warn.bind(n);Promise.resolve(null).then(r._processTemporaryParameters.bind(r,t,b.State.Deleted)).then(r._processTemporaryParameters.bind(r,t,b.State.Modified)).then(r._processTemporaryParameters.bind(r,t,b.State.Created)).then(q,s)},_processTemporaryParameters:function(r,q){return new Promise(function(v,u){if(typeof r==="undefined"){return u(new Error(a["Missing.FlowItem"]))}var s=j["Parameter.AccessMessage"];var t=r.getTemporaryParameters(q);if((!(Array.isArray(t)))||(t.length<=0)){return v(null)}var w=[{activity:r,parameters:t}];switch(q){case b.State.Created:p.createParametersInPLM(w,{onSuccess:function(x){o._parameterCreatedWSCB(r,t,q,x);n.info("_processTemporaryParameters createParametersInPLM create parameter - success");v(x)},onFailure:function(y){n.warn("_processTemporaryParameters createParametersInPLM create parameter - failed",y);var x=y;if(y.length>0&&y.indexOf("access")>-1){x=s.replace("{val1}","create")}u(x)}});break;case b.State.Modified:p.modifyParametersInPLM(w,{onSuccess:function(x){o._parameterModifiedWSCB(r,t,q);n.info("_processTemporaryParameters createParametersInPLM  modify parameter - success",x);v(x)},onFailure:function(y){n.warn("_processTemporaryParameters createParametersInPLM  modify parameter - failed",y);var x=y;if(y.length>0&&y.indexOf("access")>-1){x=s.replace("{val1}","modify")}u(x)}});break;case b.State.Deleted:p.deleteParametersInPLM(w,{onSuccess:function(x){o._parameterDeletedWSCB(r,t,q);n.info("_processTemporaryParameters createParametersInPLM delete parameter - success",x);v(x)},onFailure:function(y){n.warn("_processTemporaryParameters createParametersInPLM delete parameter - failed",y);var x=y;if(y.length>0&&y.indexOf("access")>-1){x=s.replace("{val1}","delete")}u(x)}});break;default:n.warn("_processTemporaryParameters invalid state: "+q)}})},_parameterCreatedWSCB:function(x,v,w,u){var r=0;if(u[0]&&u[0].Parameters){var s=u[0].Parameters;for(r=0;r<s.length;r++){var t=null;if(v[r].getName()===s[r].Name){t=v[r]}if(!t){for(var q=0;q<v.length;q+=1){if(v[q].getName()===s[r].Name){t=v[q];break}}}if(t&&t.setId){t.setId(s[r].Id)}}}for(r=0;r<v.length;r++){if(v[r].getDataType()===b.DataType.client.Object){x.addSimulationData(v[r].getValue())}}x.addParameters(v);x.clearTemporaryParameters(w)},_parameterModifiedWSCB:function(v,s,u){var q=0;var t;var r;for(q=0;q<s.length;q++){if(s[q].getDataType()===b.DataType.client.Object){t=s[q].getReference();if(t&&t.getValue()){if(t.getValue().getFieldValue){r=t.getValue().getFieldValue("simDataRelationshipUUID");if(r){v.removeSimulationData(r)}}}if(s[q].getValue()){r=s[q].getValue().getFieldValue("simDataRelationshipUUID");v.addSimulationData(s[q].getValue())}}}for(q=0;q<s.length;q++){if(typeof s[q]!=="undefined"){t=s[q].getReference();if(typeof t!=="undefined"){s[q].setReference();o._copyParameterCMMData(s[q],t)}}}v.clearTemporaryParameters(u)},_parameterDeletedWSCB:function(u,s,t){u.removeParameters(s);u.clearTemporaryParameters(t);for(var q=0;q<s.length;q++){if(s[q].getDataType()===b.DataType.client.Object){var r=s[q].getValueAsString();if(r){u.removeSimulationData(r);u.removeTempSimulationData(r)}}}},cloneParameter_OLD:function(q,r){if(typeof q==="undefined"){return q}var s=r;o._copyParameterCMMData(q,s);return s},cloneParameter:function(q){if(typeof q==="undefined"){return q}var r=new i();o._copyParameterCMMData(q,r);return r},getPotentialParameters:function(y){var C={};var E;var B;var w;var G,F;var z=null;if(y){E=o.getAllParameters(y);C.self=E;z=c.getFI(y)}if(z&&(z.getPotentialParametersUpdateFlag()===false)){E=o.getAllParameters(z);C.self=E;var u=[];var v=z.getParent();if(v){u=[];var r=v.getParameters();for(G=0;G<r.length;G++){B=r[G].getMode();if(B!==b.Mode.client.Neutral){w=z.findParameterByName(r[G].getName());if(!w){u.push(r[G])}}}}C.parent=u;var q=[];var t=z.getChildren();for(G=0;G<t.length;G++){if(!(t[G].isGateway())){var s=t[G].getParameters();for(F=0;F<s.length;F++){B=s[F].getMode();if(B!==b.Mode.client.Neutral){w=z.findParameterByName(s[F].getName());if(!w){q.push(s[F])}}}}}C.children=q;var x=b.getSiblings(z);var D=[];for(G=0;G<x.upStream.length;G++){if(!(x.upStream[G].isGateway())){var H=x.upStream[G].getParameters();for(F=0;F<H.length;F++){B=H[F].getMode();if((B===b.Mode.client.Out)||(B===b.Mode.InOut)){w=z.findParameterByName(H[F].getName());if(!w){D.push(H[F])}}}}}for(G=0;G<x.downStream.length;G++){if(!(x.downStream[G].isGateway())){var A=x.downStream[G].getParameters();for(F=0;F<A.length;F++){B=A[F].getMode();if((B===b.Mode.client.In)||(B===b.Mode.InOut)){w=z.findParameterByName(A[F].getName());if(!w){D.push(A[F])}}}}}C.siblings=D}return C},getAllParameters:function(s){var z=[];if(s!==undefined){var u=s.getParameters();var x=s.getTemporaryParameters(b.State.Created);var A=s.getTemporaryParameters(b.State.Modified);var E=s.getTemporaryParameters(b.State.Deleted);var y=x.length;var B=A.length;var q=E.length;var C=u.length;var v;var r;for(var w=0;w<C;++w){var t=u[w].getName().toLowerCase();var D=false;for(v=0;v<q;v++){r=E[v].getName().toLowerCase();if(r===t){D=true;break}}if(!D){for(v=0;v<B;v++){if(A[v].getReference()===u[w]){D=true;z.push(A[v]);break}}}if(!D){z.push(u[w])}}for(v=0;v<y;v++){z.push(x[v])}}return z},getPotentialParameterNames:function(r){var u=[];var t=this.getPotentialParameters(r);if(t){var q=t.self.length;for(var s=0;s<q;++s){u.push(t.self[s].getName())}}return u},isParameterWithNameExists:function(v,t){var s=false;var u=this.getPotentialParameters(v);if(u){var q=u.self.length;for(var r=0;r<q;++r){if(!s&&u.self[r].getName()===t){s=true}}}return s},nextParameterName:function(r,s){var q=this.getPrefix(s);return q+this.getNextParameterNameIndex(r,q)},getNextParameterNameIndex:function(s,u){var B=this.getPrefix(u);var z=new RegExp("^"+B+"\\d+","i");var x=/\d+$/;var y=0;var A=s.getPotentialParametersUpdateFlag();s.setPotentialParametersUpdateFlag(true);var q=this.getPotentialParameterNames(s);s.setPotentialParametersUpdateFlag(A);if(q){for(var t=0;t<q.length;++t){var v=z.exec(q[t]);if(v){var w=x.exec(v);var r=parseInt(w,10);if(!isNaN(r)&&isFinite(r)){if(r>y){if(!isNaN(u)&&isFinite(u)){y=r.toString().substr(u.toString().length,r.toString().length);y=parseInt(y,10)}else{y=r}}}}}}return y+1},getPrefix:function(r){var q="Parameter";if(r&&r.trim().length>0){q=r}return q},_copyParameterCMMData:function(s,r){if((typeof s==="undefined")||(typeof r==="undefined")){return}if(typeof s.getName()!=="undefined"){r.setName(s.getName())}if(typeof s.getId()!=="undefined"){r.setId(s.getId())}if(typeof s.getParent()!=="undefined"){r.setParent(s.getParent())}if(typeof s.getDescription()!=="undefined"){r.setDescription(s.getDescription())}if(typeof s.getLongDescription()!=="undefined"){r.setLongDescription(s.getLongDescription())}if(typeof s.getShortDescription()!=="undefined"){r.setShortDescription(s.getShortDescription())}if(typeof s.getDisplayName()!=="undefined"){r.setDisplayName(s.getDisplayName())}if(typeof s.getMode()!=="undefined"){r.setMode(s.getMode())}var q=s.getStructure();if(typeof q!=="undefined"){r.setStructure(q)}if(q===b.Structure.client.None){}else{if(q===b.Structure.client.Scalar){if(typeof s.getTag()!=="undefined"){r.setTag(s.getTag())}if(typeof s.getUnit()!=="undefined"){r.setUnit(s.getUnit())}if(typeof s.getDataType()!=="undefined"){r.setDataType(s.getDataType())}if(typeof s.getDataSubType()!=="undefined"){r.setDataSubType(s.getDataSubType())}if(typeof s.getAppDataArray()!=="undefined"){r.setAppDataArray(s.getAppDataArray().slice(0))}if(s._valueArray!==undefined){r._valueArray=s._valueArray.slice(0);if(typeof s.getValue()!=="undefined"){r.setValue(s.getValue());if(s.getDataType()===b.DataType.client.Object){r.setValue(s.getValue())}}}if(typeof s.getLimits()!=="undefined"){r.setLimits(s.getLimits().slice(0))}if(typeof s.getLimitType()!=="undefined"){r.setLimitType(s.getLimitType())}if(typeof s.getExpression()!=="undefined"){r.setExpression(s.getExpression())}}else{if(q===b.Structure.client.Array){if(typeof s.getTag()!=="undefined"){r.setTag(s.getTag())}if(typeof s.getUnit()!=="undefined"){r.setUnit(s.getUnit())}if(typeof s.getDataType()!=="undefined"){r.setDataType(s.getDataType())}if(typeof s.getDataSubType()!=="undefined"){r.setDataSubType(s.getDataSubType())}r.setSizable(true);r.resize(s.getDimensions(),true);r.setSizable(s.isSizable());if(typeof s.getAppDataArray()!=="undefined"){r.setAppDataArray(s.getAppDataArray().slice(0))}if(typeof s.getValues()!=="undefined"){r.setValues(s.getValues().slice(0))}if(typeof s.getExpressions()!=="undefined"){r.setExpressions(s.getExpressions().slice(0))}}else{if(q===b.Structure.client.Aggregate){if(typeof s.getValues()!=="undefined"){r.setParameters(s.getParameters().slice(0))}}}}}},checkParamNameAllowed:function(q){g.lastIndex=0;return !(g.test(q))},getValidatedParamName:function(r){g.lastIndex=0;var q=r.replace(/\./g,"_");q=q.replace(/\\/g,"/");q=q.replace(g,"");return q},initializeValuesForArrayParam:function(x){var v=x.getDimensions();var q=v.length;var s=x.getDataType();var r=1;var t;for(t=0;t<q;t++){var w=v[t]>=1?v[t]:1;r*=w}var u=[];for(t=0;t<r;t++){u.push(x._valueHelperFunctions.getDefaultValue(s))}x.setValues(u)},setKeepHistoryOfFileInUploadRule:function(y,r,w,A,s){var v=w.getId();var z=A.getName();var x=v+"_KeepHistory_"+z;var u=false;var q=r.findParameterByName(x);if(q&&q.getDataType()===b.DataType.File){u=true}else{q=r.findTemporaryParameterByName(x);if(q&&q.getDataType()===b.DataType.File){u=true}}if(y===true){var t=A.getSourceFileName();if((u===true)&&q){q.addAppData("fileset","patternString","",t);q.addAppData("Automap","Up","","true")}else{q=s;q.setName(x);q.setStructure(b.Structure.client.Array);q.setDimensions("[1]");q.setDataType(b.DataType.client.File);q.setValue("<rawFN>{rundir}</rawFN><toOption>11</toOption><del>N</del><type>application/octet-stream</type><rwEnc>(Automatic Local)</rwEnc><dataEnc></dataEnc><handlerType>com.dassault_systemes.plugin.DataHandlerFileMgr</handlerType><hconfig><origFname>{rundir}</origFname></hconfig>",0);q.setValueKey("<![CDATA]>");q.addAppData("fileset","patternString","",t);q.addAppData("Automap","Up","","true");q.addAppData("fileset","patternString","",t);q.addAppData("Automap","Up","","true");o.addParameter(q,r)}}else{if((u===true)&&q){o.deleteParameter(q)}}},exportParametersToXml:function(r,t,s){if(!r){throw new Error("Missing container to export parameters from")}var q=o.exportParametersToXmlString(r);o.downloadXmlFile(q,t);if(s){s()}},exportParametersToXmlString:function(u){var w=new DOMParser();var q=w.parseFromString("<ParameterData><ParameterList> </ParameterList></ParameterData>","text/xml");var v=q.querySelector("ParameterList");var t=o.getAllParameters(u);var r=t.length;if(r>0){v.setAttribute("count",String(r));o.exportParametersArrayToXmlElement(t,q,v)}var s='<?xml version="1.0" encoding="UTF-8"?>\n'+h.xmlToString(q,true)+"\n";return s.replace(/\r?\n/g,"\r\n")},exportParametersArrayToXmlElement:function(r,s,q){(r||[]).forEach(function(u){var t=o._exportParameterToXmlElement(u,s);if(t){q.appendChild(t)}})},_exportParameterToXmlElement:function(B,E){var r=function(H,O,L){var I=H.getStructure();var G=H._valueHelperFunctions;if(I===b.Structure.client.Scalar){var M=O.createElement("Value");var J=H.getValue();if(b.DataType.PLMObject===H.getDataType()){J=H.getValueAsString()}M.textContent=J;L.appendChild(M)}else{if(I===b.Structure.client.Array){var G=H._valueHelperFunctions;var K=H.getValues();var N=H.getDimensions();(K||[]).forEach(function(R,Q){var P="";if(G){P="["+G.indexToSubscript_RowMajor(N,Q).toString()+"]"}else{P=H.offsetToIndexString(Q)}var S=O.createElement("Value");S.setAttribute("index",P);S.textContent=K[Q];L.appendChild(S)})}}};var t=E.createElement("Parameter");t.setAttribute("name",B.getName());var w=b.Mode.server.properties[B.getMode()].name;t.setAttribute("mode",w);var A=b.DataType.server.properties[B.getDataType()].name;t.setAttribute("type",A);var F=b.Structure.server.properties[B.getStructure()].name;t.setAttribute("valuetype",F);if((B.getStructure()===b.Structure.client.Array)){t.setAttribute("arraydim","["+B.getDimensions()+"]");t.setAttribute("sizable",B._sizable)}if((B.getDataType()===b.DataType.client.String)&&(B.getStructure()===b.Structure.client.Scalar)){if(B.getDataSubType()===0){var x=b.DataSubType.client.properties[B.getDataSubType()].name;t.setAttribute("subtype",x)}}r(B,E,t);if(B.getAppDataArray()){if(B.getAppDataArray().length>0){for(var s=0;s<B.getAppDataArray().length;s++){var D=E.createElement("AppData");D.textContent=B.getAppDataArray()[s].appDataValue;D.setAttribute("index",B.getAppDataArray()[s].appDataIndex);D.setAttribute("key",B.getAppDataArray()[s].appDataName+"."+B.getAppDataArray()[s].appDataKey);t.appendChild(D)}}}if(B._description){var C=E.createElement("Description");C.textContent=B.getDescription();t.appendChild(C)}var q=(B.getLimits)?B.getLimits():[];if(Array.isArray(q)&&q.length>0){var v=E.createElement("Limit");v.setAttribute("type","choice");var u=" ";for(var z=0;z<q.length;z++){u=u+q[z]+"\n"}v.textContent=u;t.appendChild(v)}if(B.hasOwnProperty("_expressionArray")&&B._expressionArray.length>0){var y=E.createElement("Expression");y.textContent=B._expressionArray[0];t.appendChild(y)}return t},downloadXmlFile:function(s,t){var q=new Blob(["\ufeff",s]);if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(q,t)}else{var r=document.createElement("a");r.style.display="none";r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(s));r.setAttribute("download",t);document.body.appendChild(r);r.click();document.body.removeChild(r)}},importParametersFromXml:function(t,x,w,y){var v=function(B){var C="";var F=false;var E;var G=new DOMParser();try{if(!B){C=j["Parameter.Import.EmptyFile"];F=true}if(!F){var D=G.parseFromString(B,"text/xml");if(D.getElementsByTagName("parsererror").length!==0){C=j["Parameter.Import.InvalidFormat"];F=true}else{E=D.getElementsByTagName("Parameter")}}if((!F)&&E.length==0){C=j["Parameter.Import.NoParameter"];F=true}}catch(A){F=true;C=j["Parameter.Import.InvalidFormat"]}finally{if(F){return C}else{return E}}};if(!t){throw new Error(j["Parameter.Import.MissingContainer"])}if(!w){w=false}var u=v(x);if(typeof u==="string"){return u}var q=o.getAllParameters(t);var z=o.importParametersFromDOMElements(q,u,w);if(z.cloned_params.length>0){for(var s=0;s<z.cloned_params.length;s++){var r=o.modifyParameter(z.existing_params[s],z.cloned_params[s])}}if(z.newlyCreated_params.length>0){for(var s=0;s<z.newlyCreated_params.length;s++){o.addParameter(z.newlyCreated_params[s],t)}}if(y){y(z)}},importParametersFromDOMElements:function(r,A,s){var G="\r\n";var z=[];var I=[];var w=[];var K=[];var H=[];var t=[];var M=[];var v={};var F=j["Parameter.Import.Created"]+G,q=j["Parameter.Import.Overwritten"]+G,P=j["Parameter.Import.Skipped"]+G,u=j["Parameter.Import.Failed"]+G;var B="";for(var L=0;L<A.length;L++){try{var O=A[L].getAttribute("name");var E=A[L].getAttribute("valuetype");if(E===null){E=b.Structure.server.properties[0].name}else{E=E.toLowerCase();var D=b.Structure.server[E];if(D!==undefined){E=b.Structure.server.properties[D].name}else{E=D}}var x=null;var C=null;var y=f.findMethod(r,"getName",O,true);if(y){if(s===true){if(E!==undefined&&(b.Structure.server.properties[y._structure].name!==E)){H.push(O);P=P+O+G;continue}var N=y.getState();if(N===b.State.None){x=o.cloneParameter(y)}else{x=y}C=o._updateParameter(x,A[L],true);if(C!==null){z.push(O);w.push(C);q=q+O+G;if(N===b.State.None){K.push(y);I.push(C)}}}else{H.push(O);P=P+O+G}}else{x=new i();C=o._updateParameter(x,A[L],false);if(C!==null){F=F+O+G;t.push(C)}}}catch(J){M.push(O);u=u+"Parameter: "+O+" ,  Error message: "+J.message+G;n.log(J)}}B=j["Parameter.Import.TotalParameters"]+String(A.length)+G+String(t.length)+j["Parameter.Import.ParametersCreated"]+G+String(z.length)+j["Parameter.Import.ParametersOverwritten"]+G+String(H.length)+j["Parameter.Import.ParametersSkipped"]+G+String(M.length)+j["Parameter.Import.ParametersErroes"]+G+G+G+F+G+G+q+G+G+P+G+G+u;v.newlyCreated_params=t;v.discarded_params=H;v.cloned_params=I;v.modified_params=w;v.existing_params=K;v.overriden_params_names=z;v.failed_params=M;v.endMessage=B;return v},_updateParameter:function(u,y,r){try{var w=1;var O,t,q;o.setUUIDToParameter(u);u.setName(y.getAttribute("name"));var C=y.getAttribute("mode");if(C===null){O=b.Mode.client.properties[3].name}else{C=C.toLowerCase();var A=b.Mode.server[C];if(A!==undefined){O=b.Mode.client.properties[A].name}else{O=C}}u.setMode(b.Mode.client[O]);var H=y.getAttribute("valuetype");if(H===null){q=b.Structure.client.properties[0].name}else{H=H.toLowerCase();var E=b.Structure.server[H];if(E!==undefined){q=b.Structure.client.properties[E].name}else{q=H}}u.setStructure(b.Structure.client[q]);var s=y.getAttribute("type");if(s===null){t=b.DataType.client.properties[0].name}else{s=s.toLowerCase();var P=b.DataType.server[s];if(P!==undefined){t=b.DataType.client.properties[P].name}else{t=s}}u.setDataType(b.DataType.client[t]);if(H===b.Structure.server.properties[0].name||H===null){var N=y.getAttribute("subtype");if(t==="String"){if(N!==""&&N!==null){N=N.toLowerCase();if(N==="multiline"){u.setDataSubType(b.DataSubType.client.Multiline)}else{u.setDataSubType(b.DataSubType.client.None)}}else{u.setDataSubType(b.DataSubType.client.None)}}if(y.getElementsByTagName("Expression")[0]){u.setExpression(y.getElementsByTagName("Expression")[0].textContent)}if(y.getElementsByTagName("Limit")[0]&&y.getElementsByTagName("Limit")[0].textContent!==""){u.setLimits(y.getElementsByTagName("Limit")[0].textContent.split(/\n/));u.setLimitType(b.LimitType.Choice)}var I=y.getElementsByTagName("Value")[0].textContent;if(t===b.DataType.client.properties[4].name){if(!I){jscmmParam.setValue(new Date())}else{var z=Date.parse(I);if(!isNaN(z)){I=z;I=I.toString()}}}else{if(t===b.DataType.client.properties[1].name){if(I){I=I.toLowerCase()}}}if(t===b.DataType.client.properties[8].name){u.setValue(null)}else{var B=u._valueHelperFunctions.castStringToValue(b.DataType.client[t],I,u);u.setValue(B)}}else{if(H===b.Structure.server.properties[1].name){var K=y.getAttribute("arraydim");var D=JSON.parse(K);if(y.getAttribute("sizable")){var L=(y.getAttribute("sizable").toLowerCase()==="true")}if(r){if(u.getDimensions()!==D){u.setSizable(true);u.resize(D);u.setSizable(L);var G=u._valueArray;o.initializeValuesForArrayParam(u);u.setValues(G)}else{u.setSizable(L);u.setDimensions(D)}}else{u.setSizable(L);u.setDimensions(D);o.initializeValuesForArrayParam(u)}var x=y.getElementsByTagName("Value");if(x.length>0){for(var F=0;F<x.length;F++){var I=x[F].textContent;if(t===b.DataType.client.properties[1].name){if(I){I=I.toLowerCase()}}var M=x[F].getAttribute("index");var B=u._valueHelperFunctions.castStringToValue(b.DataType.client[t],I,u);u.setValue(B,M)}}}}if(y.getElementsByTagName("Description")[0]){u.setDescription(y.getElementsByTagName("Description")[0].textContent)}var R=y.getElementsByTagName("AppData");if(R.length>0){for(var F=0;F<R.length;F++){var S=R[F].getAttribute("key");var Q=S.split(".");var v=R[F].getAttribute("index");if(v){v=(Number(v))}var I=R[F].textContent;u.addAppData(Q[0],Q[1],v,I)}}}catch(J){w=w-1;if(typeof J.getErrorData()==="string"){throw new Error(J.getErrorData())}else{throw new Error(J.message)}}if(w!=0){return u}},findParaemterByName:function(q,r){var t=q.getParameters();for(var s=0;s<t.length;s++){if(t[s].getName()===r){return t[s]}}},findParaemterById:function(r,q){var t=r.getParameters();for(var s=0;s<t.length;s++){if(t[s].getId()===q){return t[s]}}},setUUIDToParameter:function(q){if(!q.getId()){q.setId(h.getUUID())}}};return o});define("DS/SMAProcWebCMMUtils/SMAProcWebNativeEditorHandler",["UWA/Core","DS/JSCMM/SMAJSCMMActivity","DS/JSCMM/SMAJSCMMProcess","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","UWA/Class/Promise"],function(f,c,b,e){var a={};function d(){this.commandExecution={status:0,workingDir:null};this.parametersImportResult=null;this.extensionConfig=null;this.uploadDetail={uploaded:[],failed:[],skipped:[],documentCreated:[],folderCreated:[]};this.failedToReadFiles=[];this.logs=[]}d.prototype.getLastError=function(){for(var g=this.logs.length-1;g>=0;--g){if(this.log[g].type==="error"){return this.logs[g]}}};d.prototype.getFirstError=function(){for(var g=0;g<this.logs.length;++g){if(this.log[g].type==="error"){return this.logs[g]}}};a.JobDetails=d;a.FILES={PARAM_FILE:"parameters.xml",PROP_FILE:"properties.xml",UPLOAD_FILE:"uploadContent.xml"};a.baseHandler={_LOG:function(h,i,g){this.jobDetails.logs.push({time:new Date().toGMTString(),type:h,message:i,data:g||""});if(this.request.debug){if(g){console[h](i,g)}else{console[h](i)}}},log:function(g,h){this._LOG("log",g,h)},error:function(g,h){this._LOG("error",g,h)},warn:function(g,h){this._LOG("warn",g,h)},reject:function(h,g){this.error(h,g);return Promise.reject(h)},extractRule:function(h){if(!h){return""}var l="<hconfig>";var k="</hconfig>";var i=h.indexOf(l);var g=h.indexOf(k);if(i>=0&&g>=0){var j=h.substring(i+l.length,g);if(j){return j}}return h},getParametersAsXml:function(g){return e.exportParametersToXmlString(g)||""},importParametersAsXML:function(g,h,i,j){return e.importParametersFromXml(g,h,i,j)||""},getShellScriptForSavingContent:function(j,k){var i=["echo. > "+k];var g=j.replace(/(>)(<)/g,"$1\n$2").replace(/\^/g,"^^").replace(/>/g,"^>").replace(/</g,"^<").replace(/&/g,"^&").split(/[\r\n]/).filter(function(l){return !!(l.trim())});Array.prototype.push.apply(i,g.map(function(l){return"echo "+l+" >> "+k}));var h=i.join("\n");return h},getProcessId:function(g){var h=this;var i=h.getProcess(g);if(i){return i.getPhysicalId()}},getProcess:function(g){var i=this;if(g instanceof b){return g}else{if(g instanceof c){var h=g.getParent();return i.getProcess(h)}}},analyzePromiseAll:function(h){var g=h.every(function(i){return i.status});h=h.map(function(i){return i.data});if(g){return h}else{return Promise.reject(h)}},reflectPromise:function(g){return g.then(function(h){return{status:true,data:h}},function(h){return{status:false,data:h}})}};return a});define("DS/SMAProcWebCMMUtils/SMAProcWebNativeEditor",["UWA/Core","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/JSCMM/SMAJSCMMExtensionConfig","DS/SMAProcWebCMMUtils/SMAProcWebNativeEditorHandler","UWA/Class/Promise"],function(b,h,i,e,a,c){var f=c.FILES;function g(k,j){this.request=k;this.editor=j;this.jobDetails=new c.JobDetails()}function d(j){return function(k){return j+k}}Object.assign(g.prototype,c.baseHandler,{uploadDoc:function(j,l,k){var n=this;var m=d("[uploadDoc]:");n.log(m("begin uploading file: "+k+" under plm doc: "+j.getName()));return new Promise(function(p,o){i.uploadFileToDocument(j,l,k,{onSuccess:function(q){n.log(m("finish uploading file: "+k+" under plm doc: "+j.getName()));n.jobDetails.uploadDetail.uploaded.push(k);p(q)},onError:function(q){n.jobDetails.uploadDetail.failed.push(k);n.error(m("Failed to upload file: "+k+" under plm doc: "+j.getName()),q);o(q)}})})},createDoc:function(j,m,o,n){var l=d("[createDoc]:");var k=this;k.log(l("begin creating doc: "+n+" under catgeory "+m));return new Promise(function(q,p){i.createOwnedDocument(j,m,o,n,{onSuccess:function(r){k.log(l("end document creation: "+n+" under category"+m));k.jobDetails.uploadDetail.documentCreated.push(n);q(r)},onError:function(r){k.error(l("Fail to create "+n+" under category"+m),r);p(r)}})})},createFolder:function(k,j,n){var m=d("[createFolder]:");var l=this;l.log(m("begin creating folder: "+n));return new Promise(function(p,o){i.createSimulationFolder(k,j,n,{onSuccess:function(q){l.log(m("end folder creation: "+n));l.jobDetails.uploadDetail.folderCreated.push(n);p(q)},onError:function(q){l.error(m("Fail to create folder"+n),q);o(q)}})})},readFile:function(k,j){var m=d("[readFile]:");var l=this;var n=j.workingDirectory+"/"+k;l.log(m("Reading file "+n));return this.editor.runner.tail({filePath:n,start:0,numLines:10000},j).then(function(o){if(o&&o.contents){return o.contents}l.jobDetails.failedToReadFiles.push(n);return l.reject(m("error reading file "+n))})},importParameters:function(j){var l=d("[importParameters]:");var k=this;k.log(l("begin importing parameters"));return k.readFile(f.PARAM_FILE,j).then(function(o){try{var m;h.importParametersFromXml(k.request.activity,o,true,function(p){m=p});if(m){k.log(l("finish importing parameters successfully"));k.jobDetails.parametersImportResult=m;return m}else{return k.reject(l("Importing parameter failed"))}}catch(n){k.reject(l("error importing parameters file"),n)}})},importProperties:function(j){var l=d("[importProperties]:");var k=this;k.log(l("begin importing properties"));return k.readFile(f.PROP_FILE,j).then(function(q){try{var s=new DOMParser();var r=s.parseFromString(q,"text/xml");var n=r.querySelector("StepConfig");var m=e.xmlToJson(n);var p=new a(m);k.jobDetails.extensionConfig=p;k.log(l("finish importing properties successfully"));return p}catch(o){k.reject(l("error importing property file"),o)}})},uploadFile:function(n,j,k){var m=d("[uploadFile]:");var l=this;l.log(m("uploading file:"+n));return l.readFile(n,k).then(function(p){var o=new File([p],n,{type:"text/plain"});return l.uploadDoc(j,o,n)})},handleUpload:function(o,r,v){var s=this;var p=d("[uploadFile]:");var k=o.getAttribute("filePath");var u=o.getAttribute("documentPath")||"";var w=u.split("/");if(w.length<2){s.warn(p("invalid documentPath attribute, skipping upload"));s.jobDetails.uploadDetail.skipped.push(k);return v}else{var q=s.request.activity.getContentChildren();var m=w[0];var l=q.find(function(x){return x.getName().toLocaleLowerCase()===m.toLocaleLowerCase()});if(!l){s.warn(p("invalid catgeory: "+m+" for upload action, skipping upload"));s.jobDetails.uploadDetail.skipped.push(k);return v}else{var n=w.slice(1,w.length-1);var v=v.then(function(){return l});if(n.length>0){s.log("scanning folders in "+u);v=n.reduce(function(y,x){return y.then(function(A){var z=A.getContentChildren().find(function(B){return B.getName().toLocaleLowerCase()===x.toLocaleLowerCase()});if(z){return Promise.resolve(z)}else{return s.createFolder(s.request.activity,A,x)}})},v)}var j=w[w.length-1];var t=(o.getAttribute("documentVersioned")||"false").toLocaleLowerCase()==="true";v=v.then(function(y){var x=y.getContentChildren().find(function(z){return z.getName().toLocaleLowerCase()===j});if(x){return s.uploadFile(k,x,r)}else{return s.createDoc(s.request.activity,y,t,j).then(function(z){return s.uploadFile(k,z,r)})}});return v}}},importUploadFile:function(j){var l=d("[uploadFile]:");var k=this;k.log(l("Begin reading and parsing upload file"));return k.readFile(f.UPLOAD_FILE,j).then(function(o){k.log(l("parsing upload file"));try{var m=new DOMParser();var t=m.parseFromString(o,"text/xml");var n=t.getElementsByTagName("File");var s=Promise.resolve(true);for(var q=0;q<n.length;++q){var p=n[q];s=k.reflectPromise(k.handleUpload(p,j,s))}k.log(l("End parsing upload file"));if(k.jobDetails.uploadDetail.skipped.length===n.length){var u=l("No files to upload");k.warn(u);return u}return s}catch(r){return k.reject(l("Runtime error while parsing and uploading files"),r)}})},run:function(q){var o=d("[run]:");var n=this;var m=n.request;var p={code:m.code,processId:n.getProcessId(m.activity),activityId:m.activity.getPhysicalId(),downloadString:n.extractRule(m.downloadString),uploadString:n.extractRule(m.uploadString)};var k=[];var l=n.getParametersAsXml(m.activity)||"<ParameterData><ParameterList/></ParameterData>";k.push(n.getShellScriptForSavingContent(l,f.PARAM_FILE));var j=e.stepConfigToXML(m.extensionConfig)||"<StepConfig><Properties/></StepConfig>";k.push(n.getShellScriptForSavingContent(j,f.PROP_FILE));k.push(m.code);p.code=k.join("\n");n.log(o("Final command : \n "+p.code));n.log(o("saving activity with temp relationship UUID"));return i.saveTempSimulationData_Promise(m.activity).then(function(){n.log(o("running EXML"));return n.editor.runner.runWithUploadDownload(p,{os:"windows",monitorFiles:true,onLog:function(r){n.log(o(r))}})}).then(function(r){n.jobDetails.commandExecution.status=1;n.log(o("Finished EXML execution"));n.log(o("Reading local directory"));p.options=r;return n.editor.runner.listFiles("",r)}).then(function(s){var w=s.directoryList;if(w&&w.length>0){var v=w[0];p.options.workingDirectory=v.name;n.jobDetails.commandExecution.workingDir=v.name;var u=[0,0,0];var x=0,y=1,r=2;v.fileList.forEach(function(z){if(z.name===f.PARAM_FILE){u[x]=1}else{if(z.name===f.PROP_FILE){u[y]=1}else{if(z.name===f.UPLOAD_FILE){u[r]=1}}}});var t=[];if(u[x]){t.push(n.reflectPromise(n.importParameters(p.options)))}else{n.warn(o("skip parameter import"))}if(u[y]){t.push(n.reflectPromise(n.importProperties(p.options)))}else{n.warn(o("skip property import"))}if(u[r]){t.push(n.reflectPromise(n.importUploadFile(p.options)))}else{n.warn(o("skip upload"))}if(t.length===0){n.warn(o("nothing to do after command execution"));return true}return Promise.all(t).then(function(z){return n.analyzePromiseAll(z)})}return Promise.reject(o("cannot get execution folder"))}).then(function(){n.log(o("Execution ends normally"));q(n.jobDetails)},function(r){n.error(o("Something went wrong while execution"),r);q(n.jobDetails)})}});return g});define("DS/SMAProcWebCMMUtils/SMAProcWebinWinNativeEditor",["UWA/Core","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/JSCMM/SMAJSCMMExtensionConfig","DS/SMAProcWebCMMUtils/PubSub","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/SMAProcWebCMMUtils/SMAProcWebNativeEditorHandler","UWA/Class/Promise","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils"],function(b,h,a,i,e,c,f,g){function d(j){this.request=j;this.jobDetails=new c.JobDetails()}Object.assign(d.prototype,c.baseHandler,{collectSimData:function(n,k){var j=[];var m=n.querySelector(k);if(!m){return j}var o=m.getElementsByTagName("SimulationData");for(var l=0;l<o.length;++l){j.push(o[l].getAttribute("simDataRelationshipUUID"))}return j},handleReponse:function(E){var D=this;var j=D.request;D.log("Message from Win",E);try{D.jobDetails.commandExecution.status=1;var o;var A;for(var z=0;z<E.requestList.length;++z){if(E.requestList[z].id==="LocalExecution"){A=E.requestList[z]}if(E.requestList[z].id==="SimulationData"){o=E.requestList[z]}}if(o){var m=D.collectSimData(o,"CreatedSimulationData");var r=D.collectSimData(o,"DeletedSimulationData");if(m.length!==j.activity.getAllTempSimulationData().length){D.warn("inconsistent behavior in added sim data")}m.forEach(function(F){var k=D.request.activity.getTempSimulationData(F);D.request.activity.addSimulationData(k)});j.activity.removeAllTempSimulationData();if(r.length!==j.activity.getAllTempSimulationDataToRemove().length){D.warn("inconsistent behavior in deleted sim data")}r.forEach(function(k){j.activity.removeSimulationData(k)});j.activity.removeAllTempSimulationDataToRemove()}else{D.warn("cannot find simulationDataRequest from win")}if(A){var w=A.querySelector("Response");if(w){var q=w.querySelector("ParameterData");var y=q?q.innerHTML:null;try{var s;D.log("importing parameters");h.importParametersFromXml(j.activity,y,true,function(k){s=k});D.log("parameters imported");D.jobDetails.parametersImportResult=s}catch(B){console.error(B);D.error("Error while importing parameters",B)}D.log("importing property");try{var v=w.querySelector("StepConfig");var n=e.xmlToJson(v);var p=new a(n);D.jobDetails.extensionConfig=p}catch(B){console.error(B);D.error("Error while importing properties",B)}try{var t=w.querySelector("ContentUpdate");if(t){var l=t.getElementsByTagName("File");for(var x=0;x<l.length;++x){var C=l[x];var u=C.getAttribute("filePath");D.jobDetails.uploadDetail.uploaded.push(u)}}}catch(B){console.error(B);D.error("Error while reading upload status",B)}}else{D.error("cannot find response from win")}}else{D.error("cannot find localExecutionRequest from win")}D.log("All execution done");D.callback(D.jobDetails)}catch(B){console.error(B);D.callback(D.jobDetails)}},run:function(t){var r=this;r.callback=t;i.add("ExecutionResult",r.handleReponse.bind(r));try{var m=r.request;var l={code:m.code,processId:r.getProcessId(m.activity),activityId:m.activity.getPhysicalId(),downloadString:r.extractRule(m.downloadString),uploadString:r.extractRule(m.uploadString)};var u=h.exportParametersToXmlString(m.activity)||"";var n='<?xml version="1.0" encoding="UTF-8"?>';if(u.indexOf(n)>=0){u=u.substring(n.length)}else{u="<ParameterData><ParameterList/></ParameterData>"}var o=(m.activity.getAllTempSimulationData()||[]).map(function(w){return'<SimulationData simDataRelationshipUUID="'+w.getFieldValue("simDataRelationshipUUID")+'" physicalId="'+(w.getPhysicalId()||w.getoid())+'" />'}).join("\n");var p=(m.activity.getAllTempSimulationDataToRemove()||[]).map(function(w){return'<SimulationData simDataRelationshipUUID="'+w.getFieldValue("simDataRelationshipUUID")+'" physicalId="'+(w.getPhysicalId()||w.getoid())+'" />'}).join("\n");var k=m.extensionConfig;var j=k._data.Properties.Property.pop();var s=e.stepConfigToXML(k)||"";k._data.Properties.Property.push(j);var v='<Message origin="Web" messageType="POST" jsCallback="ExecutionResult" result=""><Request id="SimulationData" result=""><Payload/><Response><CreatedSimulationData>'+o+"</CreatedSimulationData><DeletedSimulationData>"+p+'</DeletedSimulationData></Response></Request><Request id="LocalExecution" result=""><Payload><Data><BatchCommand><![CDATA['+l.code+"]]></BatchCommand><Content><DownloadRule><![CDATA["+l.downloadString+"]]></DownloadRule><UploadRule><![CDATA["+l.uploadString+"]]></UploadRule></Content>"+s+u+"</Data></Payload><Response/></Request></Message>";r.log("sending messgae to wintop",v);g.sendMessage(v)}catch(q){console.error(q);r.error("error sending message to wintop",q);t(r.jobDetails)}}});return d});define("DS/SMAProcWebCMMUtils/SMAProcWebInWinMixinSearchHandler",["DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils"],function(b){var a;document.addEventListener("winsearchcallback",function(d){a=d.detail});var c={searchResultsReady:function(l){var n=l.requestList;for(var m=0;m<n.length;m++){var p=n[m];var h=p.querySelector("Response");var g=h.getElementsByTagName("object");var o=[];for(var k=0;k<g.length;k++){var q=b.xmlToJson(g[k]);o.push(q)}var f=function(r){var j={};var i=r;Object.keys(r).forEach(function(s){j[s]=i[s]["<TEXT>"]});return j};var e=[];o.forEach(function(i){var j=f(i);e.push(j)});if(a){a(e)}var d=new CustomEvent("winsearchcallbackodt",{detail:{finalObjects:e}});document.dispatchEvent(d)}}};return c});define("DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/Logger/Logger","module"],function(c,f,e,a,d){var b=a.getLogger(d);var g={loadProcess:function(j,k){var h=k&&k.onSuccess||b.info.bind(b);var i=k&&k.onFailure||b.warn.bind(b);if(f.isWebInWin()){f.getProcess(j,{onSuccess:function(l){var m=e.setProcess(j,l);h(m)},onFailure:function(){i()}})}else{c.openProcess(j,{onSuccess:h,onFailure:i})}}};return g});define("DS/SMAProcWebCMMUtils/SMAProcWebCMMParser",["DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCMMUtils/SMAJSCMMConfig","DS/SMAProcWebCMMUtils/SMAJSCMMUtils","DS/JSCMM/SMAJSCMMParameter","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/SMAProcWebCMMUtils/SMAJSCMMDataFlowUtils","DS/SMAProcWebCMMUtils/SMAJSCMMProcessUtils"],function(c,e,g,a,d,b,h){var f={JSCMMProcess:null,JSCMMActivity:null,JSONData:null,actId:null,procId:null,getDynamicParameters:function(m,i,j,l){var k=this;k.JSONData=j;k.actId=i;k.procId=m;return new Promise(function(o,n){if(l&&l.setMessage){l.setMessage("Initializing ...")}k.initialize().then(function(){return k.loadProcess(k.procId,false)}).then(function(p){k.JSCMMProcess=p;return k.getActivity(p,k.actId)}).then(function(p){k.JSCMMActivity=p;if(l&&l.setMessage){l.setMessage("Reading parameters ...")}return k.getDynamicParams(p,k.JSONData)}).then(function(){if(l&&l.setMessage){l.setMessage("Reading configuration ...")}return k.handleSteps(k.JSCMMActivity,k.JSONData,true)}).then(function(){o(k.JSONData)})["catch"](function(p){if(l&&l.setMessage){l.setMessage("Failed to read parameters configuration ...")}console.warn("Failed to read parameters configuration");n(p)})})},parseJSON:function(j,m,i,l){var k=this;k.JSONData=j;k.actId=i;k.procId=m;return new Promise(function(o,n){if(l&&l.setMessage){l.setMessage("Initializing ...")}k.initialize().then(function(){return k.loadProcess(k.procId,true)}).then(function(p){k.JSCMMProcess=p;return k.getActivity(p,k.actId)}).then(function(p){if(l&&l.setMessage){l.setMessage("Saving parameters ...")}k.JSCMMActivity=p;return k.handleParameters(p,j)}).then(function(){if(l&&l.setMessage){l.setMessage("Saving configuration ...")}return k.handleSteps(k.JSCMMActivity,j,false)}).then(function(){if(l&&l.setMessage){l.setMessage("Successful saving all changes ...")}o(k.JSCMMProcess)})["catch"](function(p){if(l&&l.setMessage){l.setMessage("Failed to modify the process ...")}console.warn("Failed to modify process");n(p)})})},getDynamicParams:function(j,i){return new Promise(function(v,z){try{var n=j.getParameters();if(!i){i={}}var x=(i)?i:{};x.parameters=[];for(var w=0;w<n.length;w++){var l=n[w];var r=l.findAppData("","PES","dynamicParam");if(r!==undefined&&r!==null&&r.length>0){var u={};u.name=l.getName();u.mode=(l.getMode()===g.Mode.client.In||l.getMode()===g.Mode.client.InOut)?"In":"Out";u.value=l.getValue();var y="Real";var o=l.getDataType();if(o===g.DataType.String){y="String"}else{if(o===g.DataType.Integer){y="Integer"}else{if(o===g.DataType.Boolean){y="Boolean"}}}u.datatype=y;var s=l.findAppData("","Formulation","LowerBound");if(s!==undefined&&s!==null&&s.length>0){u.lower=parseFloat(s[0].appDataValue)}var q=l.findAppData("","Formulation","UpperBound");if(q!==undefined&&q!==null&&q.length>0){u.upper=parseFloat(q[0].appDataValue)}var k=l.findAppData("","Formulation","Objective");if(k!==undefined&&k!==null&&k.length>0){u.objective=k[0].appDataValue}var t=l.findAppData("","Formulation","ObjectiveWeight");if(t!==undefined&&t!==null&&t.length>0){u.scale=parseFloat(t[0].appDataValue)}var p=l.findAppData("","Formulation","Target");if(p!==undefined&&p!==null&&p.length>0&&u.mode==="Out"&&u.objective==="target"){u.value=parseFloat(p[0].appDataValue)}x.parameters.push(u)}}v(x)}catch(m){z(m)}})},fetchTenantId:function(i){return new Promise(function(l,k){var j;if(i){j=i.getCurrentPlatform()}if(!j){e.fetchTenantId(false).then(function(m){if(m!==undefined&&(m===""||m==="")&&!window.widget){m=undefined}l(m)})["catch"](function(m){k(m+"\nFailed to get tenant id")})}else{if(j!==undefined&&(j===""||j==="")&&!window.widget){j=undefined}else{l(j)}}})},getSecurityContext:function(i){return new Promise(function(k,j){var l;if(i){l=i.getCurrentSecurityContext()}if(!l){c.getListSecurityContext({onSuccess:function(n){var m=n&&n.cspaces||[];l=m.length>0&&m[0]||null;k(l.name)},onFailure:function(m){j(m)}})}else{k(l)}})},initialize:function(){return new Promise(function(j,i){e.initialize().then(j,function(k){i(k+"\nFailed during initialization")})})},loadProcess:function(i,j){return new Promise(function(l,k){if(j){c.currentProcess=null}if(c.currentProcess&&c.currentProcess!==null&&c.currentProcess.getoid()===i){l(c.currentProcess);return}h.loadProcess(i,{onSuccess:function(m){c.currentProcess=m;l(m)},onFailure:function(m){k(m)}})})},getActivity:function(j,k){var i=this;return new Promise(function(q,p){var o=j.getActivityFromId(k);if(o===undefined||null===o){p("No activity found with act id: "+k);return}var l=o.getChildren();var n=[];n.push(o);for(var m=0;m<l.length;m++){if(l[m].isActivity()===true){n.push(l[m])}}Promise.all(n.map(i.getParameters))["catch"](function(r){p(r+"\nFailed during getting parameters for activities")});c.getDataFlowsInPLM_Promise(o).then(function(r){q(r)})})},updateStepData:function(i){return new Promise(function(k,j){c.updateStep(i,{onSuccess:function(l){k(l)},onFailure:function(l){j(l)}})})},getParameters:function(i){return new Promise(function(k,j){c.getParametersInPLM(i,{onSuccess:function(l){k(l)},onFailure:function(l){j(l)}})})},handleParameters:function(i,k){var j=this;return new Promise(function(n,m){var l;j.getDynamicParams(i,l).then(function(q){var z=i.getChildren();var r=[];r.push(i);var x=0;for(x=0;x<z.length;x++){if(z[x].isActivity()===true){r.push(z[x])}}var o=[];try{o=j.createParameters(r,k.parameters)}catch(u){m(u)}var p=(k.removeparameters)?k.removeparameters.slice():[];var w=(k.removeparameters)?k.removeparameters.slice():[];for(var v=0;v<p.length&&k.parameters&&k.parameters.length;v++){var s=p[v].toLowerCase();for(var y=0;y<k.parameters.length;y++){var t=k.parameters[y].name.toLowerCase();if(t===s){w.splice(v,1)}}}j.removeUnusedParameters(r,w,q.parameters);j.processSequentially(r,j.saveParameters).then(function(){j.createDataFlows(r,o);j.processSequentially(r,j.saveDataFlows).then(function(){n()})["catch"](function(A){m(A+"\nFailed during data flow creation")})})["catch"](function(A){m(A+"\nFailed during parameter creation")})})})},createDataFlows:function(l,i){var r=0,q=0;var p=l[0];for(r=0;r<i.length;r++){var o=i[r];var m=p.findParameterByName(o,false);if(m===undefined||m===null){continue}for(q=1;q<l.length;q++){var k=l[q];var n;var j=k.findParameterByName(o,false);if(j!==undefined&&j!==null){if(m.getMode()===g.Mode.client.In||m.getMode()===g.Mode.client.InOut){n=b.createDataFlowObject(m,j);b.addDataflow(n,p)}else{n=b.createDataFlowObject(j,m);b.addDataflow(n,p)}}}}},createParameters:function(n,u){var k=[];var l=[];var p=0,y=0;var D=n[0];var o;for(p=0;p<u.length;p++){var j=u[p];var s=j.name;if(l.includes(s)){o="Parameter: "+s+" already exists, please provide a different name";throw o}l.push(s);if(false===g.isValidTitle(s)){o="Parameter name: "+s+" is not allowed";throw o}var x=g.Mode.client.In;if(j.mode&&(j.mode!=="In"&&j.mode!=="in")){x=g.Mode.client.Out}var v=g.DataType.Real;var C=(j.dataType)?j.dataType:"Real";if(C.toLowerCase()==="string"){v=g.DataType.String}else{if(C.toLowerCase()==="integer"){v=g.DataType.Integer}else{if(C.toLowerCase()==="boolean"){v=g.DataType.Boolean}}}var w=D.findParameterByName(s,false);var r=false;var m,z;if(w===undefined||w===null){z=new a();m=d.addParameter(z,D);k.push(s);r=true}else{m=d.modifyParameter(w);var i=g.Mode.client.In;if(w.getMode()===g.Mode.client.In||w.getMode()===g.Mode.client.InOut){i=g.Mode.client.In}else{i=g.Mode.client.Out}if(i!==x){o="Parameter: "+s+" already exists with different mode, please provide a different name or delete existing parameter";throw o}var B=m.findAppData("","PES","dynamicParam");if(!B||B.length<1){o="Parameter: "+s+" already exists, please provide a different name";throw o}}m.setName(s);m.setDisplayName(s);m.setStructure(g.Structure.client.Scalar);m.setMode(x);m.setDataType(v);m.setValue(j.value);m.addAppData("PES","dynamicParam","","1");if(j.lower!==undefined&&j.lower!==null){m.addAppData("Formulation","LowerBound","",j.lower)}if(j.upper!==undefined&&j.upper!==null){m.addAppData("Formulation","UpperBound","",j.upper)}if(j.objective!==undefined&&j.objective!==null){m.addAppData("Formulation","Objective","",j.objective)}if(j.scale!==undefined&&j.scale!==null){m.addAppData("Formulation","ObjectiveWeight","",j.scale)}if(j.value!==undefined&&j.value!==null&&j.objective==="target"){m.addAppData("Formulation","Target","",j.value)}for(y=1;y<n.length&&r;y++){var q=n[y];var t=q.findParameterByName(s,false);if(t){o="Parameter: "+s+" already exists, please provide a different name";throw o}z=new a();var A=d.addParameter(z,q);A.setName(s);A.setDisplayName(s);A.setStructure(g.Structure.client.Scalar);A.setMode(x);A.setDataType(v);A.setValue(j.value);A.addAppData("PES","dynamicParam","","1")}}return k},removeUnusedParameters:function(j,s,v){if(!v||v.length<1||!j||j.length<1){return}var k=0,x=0;var A=j[0];var w=A.getDataFlows();for(k=0;k<v.length;k++){var i=v[k];var l=i.name;var t=false;if(s){for(var u=0;u<s.length&&false===t;u++){var y=s[u].toLowerCase();if(y===l.toLowerCase()){t=true}}}if(t){var o=A.findParameterByName(l,false);if(o){d.deleteParameter(o);var r=b.getDataFlowsForParameter(o);w=r.value;if(w&&w.length>0){for(var p=0;p<w.length;p++){var z=w[p];b.deleteDataflow(z,A)}}}for(x=1;x<j.length;x++){var m=j[x];var q=m.findParameterByName(l,false);if(q){d.deleteParameter(q)}}}}},saveParameters:function(i){return new Promise(function(k,j){console.log("Updating parameters from activity: "+i.getName());d.saveParameters(i,{onSuccess:function(){d.clearTemporaryParameters(i);k(i)},onFailure:function(l){d.clearTemporaryParameters(i);j(l)}})})},saveDataFlows:function(i){return new Promise(function(k,j){b.saveDataflows(i,{onSuccess:function(l){k(l)},onFailure:function(l){j(l)}})})},getExtensionDescriptor:function(i){return new Promise(function(k,j){c.getExtensionDescriptor(i,{onSuccess:function(l){k(l)},onFailure:function(l){j(l)}})})},saveStepConfig:function(i){return new Promise(function(l,k){var m=i.getExtensionConfig();if(m===undefined||m===null){k("Not able to get step config");return}try{m.propertiesToJSON()}catch(j){k(j);return}c.saveStep(i,{onSuccess:function(n){l(n)},onFailure:function(n){k(n)}})})},processStep:function(i,j,k,m){var l=this;return new Promise(function(y,A){var u=i.getSteps();var z=i.getChildren();var w=k.split(",");var s=0;var p="";for(var r=0;r<w.length;r++){var v=w[r];var o=undefined;for(s=0;u&&s<u.length&&!o;s++){p=u[s].getName();if(p.toLowerCase().trim()===v.toLowerCase().trim()){o=u[s]}}for(var x=0;!o&&x<z.length;x++){var t=z[x].getSteps();for(s=0;t&&s<t.length&&!o;s++){p=t[s].getName();if(p.toLowerCase().trim()===v.toLowerCase().trim()){o=t[s]}}}if(!o){o=i.getMainStep()}if(!o){var q="Not able to find step with name: "+v;throw q}l.handleStep(o,j,m).then(function(n){y(n)})["catch"](function(n){A(n+"\nFailed during processing step data for "+v)})}})},handleSteps:function(i,l,k){var j=this;return new Promise(function(q,p){if(l.steps===undefined||l.steps===null){q(j.JSCMMProcess);return}var m=l.steps;var o=Object.keys(m);console.info(o);var n=null;var r=function(s){return new Promise(function(v,u){var t=function(x){if(x>=s.length){v()}else{var w=s[x];n=m[w];j.processStep(i,n,w,k).then(function(){t(x+1)})["catch"](function(y){u(y)})}};t(0)})["catch"](function(t){p(t+"\nFailed during processing step data")})};r(o).then(function(){q()})["catch"](function(s){p(s)})})},handleStep:function(l,j,m,i){var k=this;return new Promise(function(o,n){if(!l||!j){n("No step or step data to modify")}k.updateStepData(l).then(function(q){var p=q.getExtensionName();if(p===undefined||null===p){n("No extension defined for step: "+q.getName());return}k.getExtensionDescriptor(p).then(function(v){var t=v.getInterfaces();var s=null;var u=0;for(u=0;u<t.length;u++){if(t[u]&&t[u].interfaceKind==="ExtensionAPI"){s=t[u];break}}if(s===undefined||null===s){console.log("Adapter does not support APIs to modify the step");o(q);return}var w=v.getImplementations(s);var r=null;for(u=0;u<w.length;u++){if(w[u]&&w[u].language==="web"){r=w[u].LateType["<TEXT>"]}}if(r===undefined||null===r){console.log("Adapter does not support APIs to modify the step");o(q);return}require([r],function(y){if(y===undefined||null===y){console.log("Adapter does not support APIs to modify the step");o(q);return}try{if(m&&m===true){y.readConfiguration(q.getExtensionConfig(),j);o(q)}else{if(p==="com.dassault_systemes.sma.adapter.Doe"&&j.constraints&&j.constraints.length>0){var x="DOE adapter does not support constraints, please use either Design Parameters or Responses";n(x)}y.modifyConfiguration(q.getExtensionConfig(),j);k.saveStepConfig(q).then(function(z){o(z)})["catch"](function(z){if(i===undefined){k.handleStep(q,j,m,false).then(function(A){o(A)})["catch"](function(A){n(A+"\nError during saving step: "+q.getName())})}else{n(z+"\nError during saving step: "+q.getName())}})}}catch(x){if(m&&m===true){o(q)}else{n(x)}}})})["catch"](function(r){n(r+"\nError during processing step: "+q.getName())})})["catch"](function(p){n(p+"\nFailed during updating step data for step: "+l.getName())})})},processSequentially:function(i,j){var k=this;return new Promise(function(m,l){var n=function(o){if(o>=i.length){m()}else{j.call(k,i[o]).then(function(){n(o+1)})["catch"](function(p){l(p)})}};n(0)})}};return f});define("DS/SMAProcWebCMMUtils/SMAProcWebInWinMixinMessageHandler",["DS/SMAProcWebCMMUtils/PubSub"],function(a){var b={UpdateUI:function(g){var l=this;var j=g.requestList;var k=g.stepConfig;a.add("stepConfigCreated",function(i){l.stepConfig=i.stepConfig});a.add("extensionQueryCompleted",function(i){g.webComp=i.webCompName;g.webEditor=i.webEditor});for(var h=0;h<j.length;h++){var f=j[h];var d=f.getAttribute("id");var c=g.requestType+d;var e={activity:g.activity,step:g.step,stepConfig:k,requestXML:f};a.dispatch(c,e)}g.stepConfig=l.stepConfig;a.dispatch("UpdateUI_Completed",g)},Apply:function(j){var e=[];var l=j.requestList;var m=j.stepConfig;a.add("stepConfigXMLCreated",function(i){e.push(i.updatedRequest)});a.add("parametersXMLCreated",function(i){e.push(i.updatedRequest)});a.add("dataflowsXMLCreated",function(i){e.push(i.updatedRequest)});a.add("simDataXMLCreated",function(i){e.push(i.updatedRequest)});var n={stepConfig:m};a.dispatch("Apply_started",n);for(var k=0;k<l.length;k++){var h=l[k];var d=h.getAttribute("id");var c=j.requestType+d;var f={activity:j.activity,step:j.step,stepConfig:m,requestXML:h};a.dispatch(c,f)}var g={message:j.message};a.dispatch("Apply_Completed",g)},updateContentUI:function(h){var e=h.requestList;for(var f=0;f<e.length;f++){var g=e[f];var j=g.getAttribute("id");var c=h.requestType+j;var d={activity:h.activity,requestXML:g};a.dispatch(c,d)}},ApplyComplete:function(j){console.log("<Apply Completed on>"+j);var f=j.requestList;for(var g=0;g<f.length;g++){var h=f[g];var k=h.getAttribute("id");var d="save"+k;var c=h.getAttribute("result");if(c==="200 OK"){var e={activity:j.activity,requestXML:h};a.dispatch(d,e)}else{console.log("Failed to save "+h)}}}};return b});define("DS/SMAProcWebCMMUtils/SMAProcWebInWinMixinRequestHandler",["DS/SMAProcWebCMMUtils/SMAJSCMMWebInWinUtils","DS/JSCMM/SMAJSCMMExtensionConfig","DS/SMAProcWebCMMUtils/PubSub","DS/JSCMM/SMAJSCMMUtils"],function(c,e,a,d){var b={getExtensionConfig:function(i){i.stepConfig.propertiesToJSON();var f=c.stepConfigToXML(i.stepConfig);var g=c.addResponseToRequestXML(i.requestXML,f);var h={updatedRequest:g};a.dispatch("stepConfigXMLCreated",h)},getParameters:function(h){var i=c.WriteParametersToXML(h.activity);var f=c.addResponseToRequestXML(h.requestXML,i);var g={updatedRequest:f};a.dispatch("parametersXMLCreated",g)},getDataFlow:function(i){var f=c.WriteDataflowsToXML(i.activity);var g=c.addResponseToRequestXML(i.requestXML,f);var h={updatedRequest:g};a.dispatch("dataflowsXMLCreated",h)},getSimulationData:function(j){var g=c.getCreatedSimulationDataXML(j.activity);var f=c.getRemovedDataSimulationXML(j.activity);var h=c.addResponseToRequestXML(j.requestXML,g);h=c.addResponseToRequestXML(j.requestXML,f);var i={updatedRequest:h};a.dispatch("simDataXMLCreated",i)},setExtensionConfig:function(i){var h=c.getExtensionConfigXmlDOMDoc(i.requestXML);var f=c.xmlToJson(h);var j=new e(f);var g={stepConfig:j};a.dispatch("stepConfigCreated",g)},setParameters:function(g){if(g){var f=g.requestXML.getElementsByTagName("ActivityID")[0];var h=f.textContent;g.activity.setId(h);c.ReadParametersFromXML(g.activity,g.requestXML);c.ReadPotentialParametersFromXML(g.activity,g.requestXML)}},setContent:function(g){if(g){var f=g.requestXML.querySelector("Response");var h=f.children?f.children[0]:null;c.loadContents(g.activity,h)}},setSimulationData:function(h){if(h){var g=h.requestXML.querySelector("Response");var f=g&&g.children?g.children[0]:null;c.addSimulationDataToActivity(h.activity,f)}},setExtensionDescriptor:function(f){var g={};if(f){g.webCompName=f.requestXML.getElementsByTagName("WebComponent")[0].innerHTML;g.webEditor=f.requestXML.getElementsByTagName("WebEditor")[0].innerHTML}a.dispatch("extensionQueryCompleted",g)},getOwnedContent:function(g){var k=g.requestXML;var m=g.activity;var h=k.querySelector("HTMLElemId");var n=h?h.getAttribute("name"):null;var f=k.querySelector("Response");var i=f.querySelector("datarecords");var l=c.addContentObjectToContainer(m,i);var j={content:l,contentElemName:n};a.dispatch("contentAdded",j)},getReferencedContent:function(g){var k=g.requestXML;var m=g.activity;var h=k.querySelector("HTMLElemId");var n=h?h.getAttribute("name"):null;var f=k.querySelector("Response");var i=f.querySelector("datarecords");var l=c.addContentObjectToContainer(m,i);var j={content:l,contentElemName:n};a.dispatch("contentAdded",j)},saveParameters:function(g){var h=g.activity;var f=h._tempCreatedParametersArray;h.addParameters(f);h.clearTemporaryParameters(d.State.Created);console.log("Saving temp parameters to the activity")},saveSimulationData:function(h){var j=h.activity;for(var f=0;f<j._TEMPsimDataList;f++){var g=j._TEMPsimDataList[f];j.addSimulationData(g)}j.removeAllTempSimulationData();console.log("Saving temp Simulation Data to the activity")}};return b});define("DS/SMAProcWebCMMUtils/SMAProcWebInWinEventHandler",["DS/SMAProcWebCMMUtils/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAProcWebInWinMixinMessageHandler","DS/SMAProcWebCMMUtils/SMAProcWebInWinMixinRequestHandler","DS/SMAProcWebCMMUtils/SMAProcWebInWinMixinSearchHandler"],function(d,c,b,e){var a={eventHandlersList:{},searchEventHandlersList:{},getEventHandlersList:function(){if(Object.getOwnPropertyNames(a.eventHandlersList).length===0){d.addMixin(a.eventHandlersList,c);d.addMixin(a.eventHandlersList,b);d.addMixin(a.eventHandlersList,e)}return a.eventHandlersList},getSearchEventHandlersList:function(){if(Object.getOwnPropertyNames(a.searchEventHandlersList).length===0){d.addMixin(a.searchEventHandlersList,e)}return a.searchEventHandlersList}};return a});