function FolderEditor(b){var a={widget:null,folderContent_Cont:null,folderTree_div:null,folderTreeDoc_div:null,folderTree_Cont:null,folderIdCard_div:null,folderIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,_commandProxy:null,folderTree_W_NotLinked:false,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:false,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:false,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null,},init:function(c){var d=this;this.widget=c.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onDestroy",this.onDestroy.bind(this));this.widget.addEvent("onResize",this.onResize.bind(this))},onRefresh:function(d){var c=this;require(["DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt"],function(e,h,i,g){c.folderContent_Cont.addEvent("onCompleteRefreshNodes",function(j){this.removeEvent("onCompleteRefreshNodes");h.displayNotification({message:i.msg_info_refresh,className:"primary"})});if(d&&UWA.is(d.authored.deleted,"array")){var f=e.getCurrentFolder();if(f.getID()===d.authored.deleted[0]){f.getParent().select(true)}}c.folderTree_Cont.refreshFolderTreeAndContent();require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/LifecycleServicesSettings"],function(m,j,l){var k=false;l.getEnforceFolderLinkSettingAsync(function(o,n){if(!o){k=n}});if(k||m.isCustomizedEnv()||m.isActiveBookmarkActivated()){j.publish("FolderEditor.ActiveFolderCheck",{})}})})},onDestroy:function(){},onResize:function(){var c=this;setTimeout(function(){var d;if(c.folderGlobal_div&&c.folderIdCard_Cont){d=c.folderGlobal_div.clientWidth;if(d!==0){c.folderIdCard_Cont.updateDisplayPath()}}},500)},onLoad:function(){var f=this;this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_";window.top.performance.mark("onLoad_begin");window.top.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var d=1;var g=true;var e=widget.getValue("pad_security_ctx")===undefined||widget.getValue("pad_security_ctx")===null;if(e){widget.setValue("vMigration",d)}else{var c=widget.getValue("vMigration");c=c?c:0;if(c<d){g=false;console.log("Bookmark migration needed");require(["DS/FolderMigration/FolderMigration"],function(i,k,j){var h=new i(d);h.migrateExpandPreferences(function(){widget.migrated=true;f._onLoad()})})}}if(g){f._onLoad()}},_onLoad:function(){var c=this;require(["DS/PADUtils/Configuration","text!DS/FolderEditor/assets/FolderEditorConf.json","DS/PADServices/utils/AttributesMgt",],function(g,f,e){var d=JSON.parse(f);g.mergeConfig(d);e.useIntent();require(["UWA/Core","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/FolderEditor/FolderComponent","DS/FolderEditor/FolderIdCardCont","DS/FolderEditor/FolderTreeCont","DS/FolderEditor/Folder_CSO","DS/FolderEditor/ActionBar/FolderActionBar","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommunication","DS/PADUtils/PADProbes","text!DS/FolderEditor/assets/folder_settings.json"],function(h,u,o,z,v,q,y,t,G,A,E,w,r,D,x,i,F,p,m,k,s){window.top.performance.mark("loadRequire_end");window.top.performance.measure(c.probeHeader+"loadRequire","createWidget_begin","loadRequire_end");var j=JSON.parse(s);o.setApp(j.padsettings,"enopad");k.initialize({padid:widget.id,padtitle:widget.getTitle()});o.addEventOnce("onNoSecurityContext",function(){i._isSecurityCTXInitialized=false;widget.setBody(" ");var H=UWA.createElement("div",{text:w.get("authentication_error")});H.set("styles",{position:"absolute",top:"40%",bottom:"30%",left:"30%",right:"30%"});H.inject(widget.body)});widget.mergePreferences(o.getSpecificWidgetPreference("drag-and-drop"));widget.mergePreferences(o.getSpecificWidgetPreference("filtered-content"));widget.mergePreferences(o.getSpecificWidgetPreference("allow-products-expand"));widget.mergePreferences(o.getSpecificWidgetPreference("show-sub-folders"));widget.mergePreferences(o.getSpecificWidgetPreference("activateBIFilter"));widget.mergePreferences(o.getSpecificWidgetPreference("useIndexAccleration"));z.addSharedSettings(widget,["x3dPlatformId","pad_security_ctx"]);if(widget.getValue("debug_me")==="1"){widget.mergePreferences(o.getSpecificWidgetPreference("activateOpenWith18xFD01"));widget.mergePreferences(o.getSpecificWidgetPreference("expandSaveLimitation"));widget.mergePreferences(o.getSpecificWidgetPreference("resetCustomization"));widget.mergePreferences(o.getSpecificWidgetPreference("compactModeForLeftSidebar"));widget.mergePreferences(o.getSpecificWidgetPreference("CandABookmark"))}widget.mergePreferences(o.getSpecificWidgetPreference("activeIsLastVersionColumn"));c.widget.addEvent("endEdit",o.updateWidgetPreferences.bind(o));o.updateWidgetPreferences();o.setSetting("activate_autodownload",false);o.setSetting("EditModeActivated",true);o.setSetting("compactMode",true);if(
/*!self.widget.getValue('x3dSharedId') && */
!c.widget.getValue("x3dAppId")){c.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOFOL3_AP"})}c.widget.addEvent("onPlatformIdChange",function(H,I){if(H=="x3dPlatformId"){o.updateTenantSecPreference(I,true)}});E.onCurrentFolderChange(function(H){widget.setTitle(this.getLabel())});E.onFolderRename(function(H){if(H.getID()===G.getCurrentFolderID()&&UWA.is(widget)){widget.setTitle(H.getLabel())}});c.getEditMode=function(){var H=i.getContent();return H?H.getEditMode():false};c._onRefreshFolder=function(I){var M=false;var K=[];if(UWA.is(I.authored.connected,"array")){var H=G.getCurrentFolder();var L=H.getID();var P=I.authored.connected;if(P.length>0){for(var J=0;J<P.length;J++){var N=P[J];if(UWA.is(N,"array")){var O=N[0];if(N.length>1){K.push(N[1])}if(O==L){M=true;break}}}}}if(M){c.folderContent_Cont.loadContentAndSelect(G.getCurrentFolder(),K)}};m.subscribe("FolderEditor.refresh",c._onRefreshFolder.bind(c));c._commandProxy=u.create({events:{onRefresh:c._onRefreshFolder.bind(c)}});if(c.folderTree_Cont===null||c.folderTree_Cont===undefined){c.core=h;c.widget.body.empty();c._buildSkeleton();var n=function(){c.widget.getPreferences().forEach(function(H){var I=H.type==="boolean"&&UWA.is(H.value,"string")?c.convertToBool(H.value):H.value;c.widget.setValue(H.name,I)})};c.widget.addEvent("endEdit",function(){n()});c.folderGlobal_div=c.widget.body.container;c.folderTree_div=c.widget.body.left_side_div;c.folderSlide_div=c.widget.body.slide_div;c.folderTreeDoc_div=c.widget.body.right_side_div;c.folderIdCard_div=c.widget.body.top_right_side_div;c.folderContent_div=c.widget.body.bottom_right_side_div;var C=c.folderGlobal_div.clientWidth;var B=c._initializeFolderEditorComponent.bind(c);if(c.folderContent_Cont===null){var l={x3dAppId:c.widget.getValue("x3dAppId"),lang:c.widget.lang?c.widget.lang:c.widget.getValue("lang"),layout:{view_customization:null,css_view_class:c.css_view_class,store_roots_in_pref:true,padshell:true},authorize_setStructure:true,settings:j};if(o.getSetting("resetCustomization")===true){localStorage.removeItem("PADTreeListDefinition."+c.widget.getValue("x3dAppId")+"_"+widget.getValue("x3dPlatformId"));B(l)}else{if(c.widget.getValue("FolderCusto_treelistview")){l.layout.view_customization=JSON.parse(decodeURIComponent(c.widget.getValue("FolderCusto_treelistview")));B(l)}else{v.app_initialization(function(){require(["DS/PADUtils/PADWSAccess"],function(H){H.getMyAppsTemplate({preference_name:c.widget.getValue("x3dAppId")+"_template",onComplete:function(J){var I=null;if(J.length>0){I=JSON.parse(decodeURIComponent(J))}l.layout.view_customization=I;B(l)},onFailure:function(I){B(l)}})})})}}c.getSelectedNodes=function(){var L=G.getSelectedNodes();var I=Array.isArray(L)?L.length:0;if(I===1){var J=L[0];if(J){if(J.plmType==="FolderSection_Trash"){var K=i.getTrashCont();if(K){var H=K.getSelectedNodes();if(Array.isArray(H)&&H.length>0){L=H}}}}}return L};c.getCurrentFolder=function(){var J=true;var I=p.getCurrentSecurityContextAndFolderData(J);var H=JSON.stringify(I);return H};c.getSecurityContext=function(){var H=p.getTenant();return{SecurityContext:o.getSetting("pad_security_ctx"),tenant:H}};c.RefreshView=function(aa){var Q=false;var N=false;var P=aa.created;var ab=aa.modified;var Y=aa.deleted;var ac=[];var X=[];P.forEach(function(ad){if(ad.operation==="Duplicate"||ad.operation==="Revise"){Q=true}else{console.log("  unknown operation :",ad.operation)}});if(ab.length>0){Q=false;var U={};U.modified=ab;i.getContent().getPADTreeDocument().refreshNodeById(U)}if(Y.length>0){Q=true;Y.forEach(function(ad){if(ad.operation==="Delete"){if(ad.physicalid.length>0){X.push(ad.physicalid)}}})}var M=G.getCurrentFolder();var T=M.getID();var O=false;var Z;for(var S=0;S<X.length;S++){var V=X[S];if(V===T){O=true;break}if(M.isExpanded()&&M.hasChildren()){var I=M.getChildren();for(var R=0;R<I.length;R++){var J=I[R];if(J.id===V){i.getTreeCont().removeFromTree(J)}}}}if(O===true){var L=M.getParent();if(L){i.getTreeCont().removeFromTree(M);L.select(true);Q=false}}else{if(X.length>0){var K=M.getType();if(D.inFamilyFolder(K)&&UWA.is(i.getContent())){for(var S=0;S<X.length;S++){i.getContent().removeNodeInContent(X[S])}Q=false}}}var H=ac.length;if(Q===true&&ac.length>0){r.AddContent({IDs:ac,callbacks:{onComplete:function(af){var ad=G.getCurrentFolder();i.getContent().RefreshProductStructure=true;c.folderContent_Cont.loadContentAndSelect(ad,ac[0]);var ae="";if(af){var ag=JSON.parse(af);H=ag.added?ag.added.length:H;ae=ag.information?" ("+ag.information+")":ae}x.displayNotification({message:w.replace(w.msg_info_Addinfolder,{number:numberAdded,foldername:ad.options.label})+ae,className:"primary"})},onFailure:function(ad){x.displayNotification({message:ad?(w.msg_error_Addinfolder+"<br>"+ad):w.msg_error_Addinfolder,className:"error"})}}})}else{if(Q===true&&ac.length===0){var W=G.getCurrentFolder();i.getContent().RefreshProductStructure=true;c.folderContent_Cont.loadContentAndSelect(W)}}return aa};c.beginBlockingTransaction=function(H){require(["DS/UIKIT/Mask"],function(I){I.mask(c.folderContent_div,H)})};c.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],function(H){H.unmask(c.folderContent_div)})};c.author=function(H){};c.insertNodes=function(L){var I=[];function K(M){if(I.indexOf(M.resourceid)===-1){I.push(M.resourceid)}}for(var J in L){if(L.hasOwnProperty(J)){L[J].forEach(K)}}var H=I[0];c._insertOrAdd(H,"insert")};c.addRoots=function(I){if(I.pids.length>0){var H=I.pids[0];c._insertOrAdd(H,"add")}};c._insertOrAdd=function(H,L){var K=G.getCurrentFolder();var O=true;if(K!==null){var J=K.getType();if(D.inFamilyFolder(J)||J=="FolderSection_AllFolders"){O=false;var N=null;if(UWA.is(i.getContent())){N=i.getContent().loadContentAndSelect(K,H)}if(UWA.is(i.getTreeCont())){var M=(!K.isFavorite)?K:i.getTreeCont()._getVisibleNodeById(K.getID());if(M!==null&&M.isExpanded()){i.getTreeCont().updateTreeWithNewFolder(M)}else{if(!K.isExpanded()&&i.getTreeCont().NodeToExpandAfterNewFolder){K.expand();i.getTreeCont().NodeToExpandAfterNewFolder=false}}}if(N!==null&&L==="add"){N.then(function(P){c.probeEnableEdit=k.createProbe("setEnable_name");c.defaultEnableNameEdit(P,true)})}}}if(O){var I=[];if(UWA.is(i.getTreeCont())){I=i.getTreeCont()._folders_TreeDocument.getRoots()}I.forEach(function(P){if(P.plmType=="FolderSection_AllFolders"){if(K!==null){K.unselect()}P.select();if(UWA.is(i.getContent())){i.getContent().loadContentAndSelect(P,H)}if(P.isExpanded()){i.getTreeCont().updateTreeWithNewFolder(P)}else{if(i.getTreeCont().NodeToExpandAfterNewFolder){P.expand();i.getTreeCont().NodeToExpandAfterNewFolder=false}}}})}};c.defaultEnableNameEdit=function(I,H){var J=i.getContent().options.views.treelistview.getManager();setTimeout(function(){try{if(H===true){var K=k.createProbe("scrollTo_folder");J.scrollToNode(I,"middle");K.end()}setTimeout(function(){var O=k.createProbe("switchToEdit_name");var R=I._computeRowID();var M=J.getRow(R);var Q=null;for(var P=0;P<M.length;P++){var N=M[P];if(N._view&&"tree"===(N._view.getCellInfos()).dataIndex){Q=N.getView();break}}if(null!==Q){Q.switchToWriteView();O.end();c.probeEnableEdit.end()}},100)}catch(L){}},1000)};c.displayNotification=function(H){x.displayNotification({message:H.msg,className:H.eventID})};c.getPADTreeDocument=function(){return i.getContent()?i.getContent().getPADTreeDocument():null};c.toggleView=function(H){if(UWA.is(i.getContent().toggleView(H))){i.getContent().toggleView(H)}};c.getPADTreeListView=function(){return i.getContent().getPADTreeListView()};c.compactMode=function(H){return i.getContent().compactMode(H)}}}})})},_slidderMoveEndCallback:function(){if(this.folderIdCard_Cont){this.folderIdCard_Cont.updateDisplayPath()}},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){this.widget.body.container=UWA.createElement("div",{"class":"FolderEditor_global_container"}).inject(this.widget.body,"top");this.widget.body.left_side_div=UWA.createElement("div",{"class":"FolderEditor_left_side_div"}).inject(this.widget.body.container);this.widget.body.right_side_div=UWA.createElement("div",{"class":"FolderEditor_right_side_div"}).inject(this.widget.body.container);this.widget.body.top_right_side_div=UWA.createElement("div",{"class":"FolderEditor_top_right_side_div",}).inject(this.widget.body.right_side_div);this.widget.body.bottom_right_side_div=UWA.createElement("div",{"class":"FolderEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},loadActionBar:function(c,d){this._actionbar.loadActionBar(c,d)},convertToBool:function(c){return(c.toLowerCase()==="true")},_initializeFolderEditorComponent:function(q){var p=this;var f=require("DS/FolderEditor/utils/FolderAlert");var c=require("DS/FolderEditor/FolderTreeCont");var h=require("DS/FolderEditor/utils/FolderEditorcontrol");var m=require("DS/FolderEditor/FolderIdCardCont");var l=require("DS/FolderEditor/FolderComponent");var n=require("DS/FolderEditor/utils/FolderEditorKeyboardListener");var k=require("DS/FolderEditor/ActionBar/FolderActionBar");var g=require("DS/PADUtils/PADUtilsServices");var j=require("DS/PADUtils/PADProbes");f.setContainer(p.folderIdCard_div);var e=p.folderTree_Cont;if(!p.folderTree_Cont){e=new c({lang:p.widget.lang?p.widget.lang:p.widget.getValue("lang"),css_view_class:p.css_view_class,events:{onReady:function(){h.setTreeCont(this);p.folderTree_Cont=this;if(p.folderContent_Cont!==null){p.folderTree_Cont.setOption("_folderContentView",p.folderContent_Cont)}else{if(p.folderTree_W_NotLinked===true){throw"FolderTree are not linked !!!"}else{p.folderTree_W_NotLinked=true}}p.folderTree_Cont.getSortingContainer().inject(this.elements.container,0);var v=p.widget.getValue("X3DContentId");if(v){var s=UWA.is(v,"string")?JSON.parse(v):v;if(s.data.items.length>0){var r=s.data.items[0].objectId;var u={pids:r};var t=h.getTreeCont();p.widget.setValue("X3DContentId","");t.expandTreeAndSelectFolder({folderToFindAndSelect:{id:r},onComplete:function(w){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(w){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(w){f.displayNotification({message:(w instanceof Error)?w.message:w,className:"error"})}})}}p.widget.dispatchEvent("onFolderEditorReady")}}})}var i=p._retrieveinitializationOpts(),o=UWA.extend(q,i);var k=require("DS/FolderEditor/ActionBar/FolderActionBar");p._actionbar=new k({context:p,events:{onActionBarReady:function(){p.widget.dispatchEvent("onFolderEditorActionBarReady");var r=window.top.performance.getEntriesByName("createWidget_begin");if(r&&r.length>0){window.top.performance.mark("createWidget_end");window.top.performance.measure(p.probeHeader+"createWidget","createWidget_begin","createWidget_end")}}}});var d=new l(o,e);if(p.folderIdCard_Cont===null){new m({lang:p.widget.lang?p.widget.lang:p.widget.getValue("lang"),css_view_class:p.css_view_class,events:{onReady:function(){h.setIdCardCont(this);p.folderIdCard_Cont=this;p.folderIdCard_Cont.render().inject(p.folderIdCard_div)}}})}if(!p._keyboardListener){p._keyboardListener=new n();p._keyboardListener.startObservingKeyboard()}},_retrieveinitializationOpts:function(){var c=this;return{renderTo:c.folderContent_div,events:{onActionBarReadyToBuild:function(){c.elements=this.elements;c.options=this.options;c.togglePanel=this.togglePanel;c._actionbar.create();c._actionbar.render().inject(c.folderGlobal_div)},onReady:function(){c.folderContent_Cont=this;c.addEvent=c.folderContent_Cont.addEvent.bind(c.folderContent_Cont);if(c.folderContent_Cont.dropInvitContainer){c.folderContent_Cont._dropInvitContainer=c.folderContent_Cont.dropInvitContainer}var d=require("DS/PADUtils/PADSettingsMgt");if(c.folderTree_Cont!==null){c.folderTree_Cont.setOption("_folderContentView",c.folderContent_Cont)}else{if(c.folderTree_W_NotLinked===true){throw"FolderTree are not linked !!!"}else{c.folderTree_W_NotLinked=true}}if(c.folderContent_Cont.options.renderTo){c.folderContent_Cont._dropInvitContainer.hide();c.folderContent_Cont.render().inject(c.folderContent_Cont.options.renderTo)}c.folderContent_Cont._OnPADComponentReady();c.widget.dispatchEvent("onFolderComponentReady")},onCustoViewChange:function(d){c.widget.setValue("FolderCusto_treelistview",encodeURIComponent(JSON.stringify(d)))},onSaveAsTemplate:function(d){c.widget.setValue("FolderCusto_treelistview",encodeURIComponent(JSON.stringify(d)));require(["DS/PADUtils/PADWSAccess"],function(e){e.saveMyAppsTemplate({preference_name:c.widget.getValue("x3dAppId")+"_template",value:encodeURIComponent(JSON.stringify(d)),onComplete:function(f){console.log("Saved as template")},onFailure:function(f){console.warn("Cannot save customization template")}})})},onToggleView:function(){if(c._actionbar){c._actionbar.syncState()}},}}},};a.init(b);return a}define("DS/FolderEditor/service/FolderEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","UWA/Utils/Client"],function(i,j,d,h,e,l,f,g,a){function k(m){return UWA.is(m,"array")?m.toString():m}var b=function(){var n=l.getWidgetValue("appId");n=n?n:l.getWidgetValue("x3dAppId");var m=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return n+"-"+m+"-"+(new Date()).getTime()};var c={searchInFolder:function(w){var p={};UWA.extend(p,w);if(!UWA.is(p,"object")){throw new Error("Invalid inputs for FolderEditorWebService.content")}var r="";var o="";var v=null;if(w.pid){if(w.searchQuery&&w.searchQuery.length<2){p.onFailure("warning",{error:{errorCode:"innerError",errorMessage:d.replace(d.SearchEnterMoreThan,{minNumber:2})}});return}var u=w.searchQuery+' AND NOT(type:Workspace) AND NOT(type:"Workspace Vault")';var t=u;var q=e.get3DSearchUrl()+"/search";var n=widget.lang?widget.lang:widget.getValue("lang");p.payload=f.getSearchInfo();p.payload.locale=n;p.payload.query=t;p.payload.tenant=e.getPlatformId();p.payload.next_start=undefined;p.payload.start=undefined;p.payload.source=["3dspace"];p.payload.label=b();p.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:w.pid,type_filter_rel:["Data Vaults","Sub Vaults","Vaulted Objects"]}}}};var s=f.getInfoIndex();var m=0;if(s!=null){p.payload.next_start=s.next_start}else{p.payload.start=0}p.method="POST";p.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n};p.type="json";p.data=UWA.Json.encode(p.payload);p.withoutSC=true;p.timeout=120000;v=this._executeRequest(q,p,"searchInFolder")}return v},loadThumbnails:function(w){var o={};UWA.extend(o,w);if(!UWA.is(o,"object")){throw new Error("Invalid inputs for FolderEditorWebService.content")}var q=w.ids;var p="/cvservlet/fetch/v2";var r=q.length;var v=null;if(r){var s=e.get3DSpaceUrl();var t="passport";var m=s+p;var n=l.getLanguage();var u={physicalid:q,select_file:["thumbnail_2d"],label:b()};o.query={SecurityContext:h.getSetting("pad_security_ctx"),tenant:w.tenant};o.method="POST";o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n};o.type="json";o.data=UWA.Json.encode(u);v=this._executeRequest(m,o,"loadThumbnails")}return v},content:function(m){if(!UWA.is(m,"object")){throw new Error("Invalid inputs for FolderEditorWebService.content")}var o={};UWA.extend(o,m);var n=null;if(m.searchQuery){n=this.searchInFolder(m)}else{var p=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+o.pid+"/content";o.query={Content:o.content==="All"?"All":undefined,FilterChildren:o.filterChildren==="Yes"?"Yes":undefined};o.method="GET";o.timeout=120000;n=this._executeRequest(p,o,"content")}return n},roots:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.roots")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/roots";n.query={Type:n.type,CollabSpace:n.collabSpace};n.method="GET";return this._executeRequest(o,n,"roots")},getActionBar:function(m){var n=m;var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/commands";n.query={touch:a.Features.touchEvents&&!a.Features.pointerEvents,activeFolder:g.isActiveBookmarkActivated(),importCSV:g.isImportCSVActivated(),customizedEnv:g.isCustomizedEnv()};n.method="GET";n.headers={Accept:"text/xml,application/json"};return this._executeRequest(o,n,"roots")},folders:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.folders")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/folders";n.query={Level:n.level};n.method="GET";this._executeRequest(o,n,"folders")},folderTree:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.folders")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+(n.pid||"root")+"/folderTree";n.headers={"content-type":"application/json"};if(n.expandList||n.level||n.isRoot){n.data={expandList:k(n.expandList),level:n.level&&n.level+"",isRoot:n.isRoot?"true":""};n.data=UWA.Json.encode(n.data)}n.method="POST";n.timeout=120000;this._executeRequest(o,n,"folderTree")},removecontent:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.removecontent")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/removecontent";n.headers={"content-type":"application/json"};if(n.IDs){n.data={IDs:k(n.IDs)};n.data=UWA.Json.encode(n.data)}n.method="POST";n.timeout=120000;this._executeRequest(o,n,"removeContent")},addcontent:function(n){var o=n;if(!UWA.is(o,"object")){throw new Error("Invalid inputs for FolderEditorWebService.addcontent")}var p=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+o.pid+"/content";o.headers={"content-type":"application/json"};if(o.IDs){var m=this._deduplicateContentId(o.IDs);o.data={IDs:k(m)};o.data=UWA.Json.encode(o.data)}o.method="POST";o.timeout=120000;this._executeRequest(p,o,"addContent")},movecontent:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.movecontent")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/content";n.headers={"content-type":"application/json"};if(n.IDs&&n.SourceFolderId){n.data={IDs:k(n.IDs),SourceFolderId:n.SourceFolderId};n.data=UWA.Json.encode(n.data)}n.method="PUT";n.timeout=120000;this._executeRequest(o,n,"moveContent")},copyfolder:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.copyfolder")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";n.headers={"content-type":"application/json"};if(n.TargetPhysicalId&&n.PhysicalId){o+="/"+n.TargetPhysicalId;n.data={physicalIds:k(n.PhysicalId)};n.data=UWA.Json.encode(n.data)}n.method="POST";n.timeout=120000;this._executeRequest(o,n,"copyFolder")},getFolderProperties:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.getFolderProperties")}if(!UWA.is(n.pid,"string")){throw new Error("Invalid inputs for FolderEditorWebService.getFolderProperties")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/properties";n.method="GET";this._executeRequest(o,n,"getFolderProperties")},getContentProperties:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.getContentProperties")}if(!UWA.is(n.pid,"string")){throw new Error("Invalid inputs for FolderEditorWebService.getContentProperties")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/ContentProperties";n.method="GET";this._executeRequest(o,n,"getContentProperties")},setFolderProperties:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.setFolderProperties")}if(!UWA.is(n.pid,"string")){throw new Error("Invalid inputs for FolderEditorWebService.setFolderProperties")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/update";n.method="POST";n.headers={"content-type":"application/json",};n.type="json";n.data=UWA.Json.encode(n.properties);this._executeRequest(o,n,"setFolderProperties")},movefolder:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.movefolder")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";n.headers={"content-type":"application/json"};if(n.TargetPhysicalId&&n.PhysicalId){o+="/"+n.TargetPhysicalId;n.data={physicalIds:k(n.PhysicalId)};n.data=UWA.Json.encode(n.data)}n.method="PUT";n.timeout=120000;this._executeRequest(o,n,"moveFolder")},getFolderPath:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.getFolderPath")}var o=e.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+n.pid+"/path";n.method="GET";this._executeRequest(o,n,"getFolderPath")},newFolder:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.newFolder")}var p=e.get3DSpaceUrl()+"/resources/v1/collabServices/authoring/op/createContent";n.query={select:"type&select=physicalid&select=cestamp",folderID:(m.parentBookmarkId&&m.parentBookmarkId!=="")?m.parentBookmarkId:undefined};n.method="POST";n.headers={"content-type":"application/json"};var o={type:"folder"};n.data=JSON.stringify(o);if(n.forcedSecurityContext){if(n.forcedSecurityContext.indexOf("ctx::")!=0){n.forcedSecurityContext="ctx::"+n.forcedSecurityContext}n.headers.SecurityContext=encodeURIComponent(n.forcedSecurityContext)}this._executeRequest(p,n,"newFolder")},deleteFolder:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.deleteFolder")}if(!UWA.is(n.pid,"string")){throw new Error("Invalid inputs for FolderEditorWebService.deleteFolder")}var p=e.get3DSpaceUrl()+"/resources/lifecycle/Delete/structure";n.method="POST";n.headers={"content-type":"application/json"};var o={data:[{physicalid:n.pid}]};n.data=JSON.stringify(o);if(n.forcedSecurityContext){if(n.forcedSecurityContext.indexOf("ctx::")!=0){n.forcedSecurityContext="ctx::"+n.forcedSecurityContext}n.headers.SecurityContext=encodeURIComponent(n.forcedSecurityContext)}this._executeRequest(p,n,"deleteFolder")},personSearch:function(m){var n=m;if(!UWA.is(n,"object")){throw new Error("Invalid inputs for FolderEditorWebService.personSearch")}if(!UWA.is(n.name,"string")){throw new Error("Invalid inputs for FolderEditorWebService.personSearch")}var o=e.get3DSpaceUrl()+"/resources/v2/e6w/service/PersonSearch";n.query={searchStr:n.name};n.method="GET";this._executeRequest(o,n,"personSearch")},getUserPreferences:function(m){var p=m;if(!UWA.is(p,"object")){throw new Error("Invalid inputs for FolderEditorWebService.getUserPreferences")}var o=this;var n=null;n=l.getCompassUrlAsync({onComplete:function(q){var s=q+"/resources/AppsMngt/user/getPreferences";p.query={name:p.name};p.method="GET";p.headers={Accept:"application/json",SecurityContext:undefined};p.withoutTenant=true;var r=o._executeRequest(s,p,"getUserPreferences");if(n){n.cancel=r.cancel}else{n=r}}});return n},setUserPreferences:function(m){this.saveUserPreferences(m)},saveUserPreferences:function(m){var n=this;var o=m;if(!UWA.is(o,"object")){throw new Error("Invalid inputs for FolderEditorWebService.saveUserPreferences")}if(!this._lastPrefToSave){this._lastPrefToSave={}}this._lastPrefToSave[m.name]=m;if(!this._lastRequests){this._lastRequests={}}if(this._lastRequests[m.name]){this._lastRequests[m.name].cancel()}this._lastRequests[m.name]=null;l.getCompassUrlAsync({onComplete:function(p){var q=n._lastPrefToSave[m.name];if(q){var r=p+"/resources/AppsMngt/user/preference";o.method="PUT";o.headers={Accept:"application/json",SecurityContext:undefined,"Content-Type":"application/x-www-form-urlencoded"};o.data={name:q.name,value:q.value};o.withoutTenant=true;if(n._lastRequests[m.name]){n._lastRequests[m.name].cancel()}n._lastRequests[m.name]=n._executeRequest(r,o,"saveUserPreferences");delete n._lastPrefToSave[m.name]}}})},_deduplicateContentId:function(n){var m=[];var o=[];if(n!=null&&Array.isArray(n)){n.forEach(function(p){if(o.indexOf(p)<0){o.push(p);m.push(p)}})}return m},_executeRequest:function(t,p,n){var q=(Math.round(Math.random()*1000)).toString();var r=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("folderRequest_begin"+q);var s={};UWA.extend(s,p);if(!UWA.is(s.onTimeout,"function")){s.onTimeout=function(){var u={type:"timeout",toString:function(){return d.msg_InfoAction_Timeout}};s.onFailure(u)};s.onComplete=function(v){window.top.performance.mark("folderRequest_end"+q);var u=window.top.performance.getEntriesByName("folderRequest_begin"+q);if(u&&u.length===1){window.top.performance.measure(r+"_Request"+n,"folderRequest_begin"+q,"folderRequest_end"+q);window.top.performance.clearMarks("folderRequest_end"+q);window.top.performance.clearMarks("folderRequest_begin"+q)}p.onComplete(v)}}var m={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};if(!p.withoutSC){m.SecurityContext=encodeURIComponent(h.getSetting("pad_security_ctx"))}if(p.headers){s.headers=UWA.extend(m,p.headers)}else{s.headers=m}if(!UWA.is(s.query)){s.query={}}if(!s.query.tenant&&p.withoutTenant!==true){s.query.tenant=e.getPlatformId()}var o=t;o+="?"+UWA.Utils.toQueryString(s.query);return j.authenticatedRequest(o,s)}};return c});define("DS/FolderEditor/commands/ActionBar_PropertySidePanelCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","UWA/Promise","DS/PADUtils/PADContext","DS/Utilities/Utils","UWA/Class/Model","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(d,j,h,f,g,o,e,n){var m="DS/EditPropWidget/EditPropWidget",c="DS/EditPropWidget/utils/EditPropUtils",b="DS/EditPropWidget/constants/EditPropConstants",k="DS/EditPropWidget/models/EditPropModel";var l=[];var i="3DSpace";var a=j.extend({_context:null,_propertiesWdg:null,_callbackAdd:false,init:function(q){this._parent(q,{});this._context=f.get();this.addCallback();var r=this;this._propertiesWdg=null;if(this._context.elements.padshell){var p=new h(function(s){if(r._propertiesWdg==null){require([m,b,c],function(w,u,t){r.EditPropUtils=t;if(r._propertiesWdg==null){r._propertiesWdg=new w({className:"enxpropertiestab",setEditButton:true,readOnly:false,typeOfDisplay:u.ALL,selectionType:u.RESTRICTED_SELECTION,multiselection:false,collapseTabs:false,context:r._context,actions:[{name:"action_close_panel",text:n.PADFind_close,icon:"close",handler:function(){r.setState(false)}}]});r._propertiesWdg.addFacets([{id:u.FACET_RELATIONS,position:1}]);r._propertiesWdg.removeFacets([u.FACET_VIEWS]);var v=r._context.elements.padshell.getRightPanelContent();r._propertiesWdg.inject(v);if(r.getState()===true){r._selectionChange()}}r._propertiesWdg.stopSelection(!r.getState());s()})}else{s()}});l.push(p);this.onStateChange(function(){r._propertiesWdg.stopSelection(!r.getState());if(r.getState()===true){r._selectionChange()}var s=r._context.elements.padshell.getRightOpen();if((this.getState()===true&&!s)||(this.getState()===false&&s)){r._context.togglePanel("right")}})}},addCallback:function(){var p=this;if(this._callbackAdd===false){if(this._context.elements.padshell&&this._context.elements.padshell._modelEvents){this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},function(q){if(q==="right"){p.setState(false,false)}});this._callbackAdd=true}}},_selectionChange:function(r){if(!this.EditPropUtils){return}var s=this;var p=this._context.getSelectedNodes();var t=[];if(p.length){p.forEach(function(v){var u=s.EditPropUtils.getModelFromSelectedNode(v);if(u){t.push(u)}})}var s=this;var q=new h(function(u){h.all(l).then(function(){s._propertiesWdg.initDatas(t);u()})});l.push(q)}});return a});define("DS/FolderEditor/utils/FolderAlert",["UWA/Class","DS/PADUtils/views/PADAlert",],function(b,a){var c=b.singleton({name:"Folder Alert",_alert:null,_debounceTimeout:{},init:function(){},setContainer:function(d){},displayNotification:function(e){var f=this;if(!!e.id&&this._debounceTimeout[e.id]){clearTimeout(this._debounceTimeout[e.id])}else{a.displayNotification({msg:e.message,eventID:e.className})}if(!!e.id){var d=setTimeout(function(){delete f._debounceTimeout[e.id]},100);this._debounceTimeout[e.id]=d}}});return c});define("DS/FolderEditor/utils/FolderCommunication",["DS/PlatformAPI/PlatformAPI"],function(b){var c="webinwin:win:notification";var a="webinwin:web:notification";var d={publish:function(e,g,f){b.publish(e,g);if(f!==false){b.publish(a,JSON.stringify({event:e,content:g}))}},subscribe:function(e,i,f){var g=window;var h=function(){if(g===top||!!g.parent){return i.apply(this,arguments)}throw new Exception("widget has been destroyed")};b.subscribe(e,h);if(f!==false){b.subscribe(c,function(j){if(typeof j==="string"){j=JSON.parse(j)}if(j&&j.event===e){h(j.content)}})}}};return d});define("DS/FolderEditor/utils/UserPreference",["UWA/Core","UWA/Class","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/WidgetServices/WidgetServices","DS/FolderEditor/service/FolderEditorWebService"],function(g,b,e,i,c){var f=b.extend({init:function(j){this._callbacks=[];if(j.value){this._state="hasValue";this.setValue(j.value)}else{if(j.name){this._state="pending";var k=this;this._pendingRequest=c.getUserPreferences({name:j.name,onComplete:function(m){var l;try{l=UWA.Json.decode(m)}catch(n){console.warn("Failed to decode",j.name,m,n)}k._state="hasValue";k.setValue(l)},onFailure:function(l){console.error(new Error(e.msg_error_nopreferences));k._state="hasValue";k.setValue("")}})}}},addCallback:function(k){if(this._state==="hasValue"&&this._callbacks.length===0){var j=UWA.clone(this._value);k.call(window,j)}else{this._callbacks.push(k);this._purgeCallbacks()}},setValue:function(j){if(this._state==="pending"){this._pendingRequest.cancel();this._state="hasValue"}this._value=UWA.clone(j);this._purgeCallbacks()},hasValue:function(j){return(this._state==="pending"?false:UWA.equals(this._value,j))},_purgeCallbacks:function(){if(this._state==="hasValue"){var k;while(k=this._callbacks.pop()){var j=UWA.clone(this._value);k.call(window,j)}}},});var d=function(){var j=null;if(i.isSolidworksEnvironment()){j="solidworks"}else{if(i.isCatiaV5Environment()){j="catiav5"}else{if(i.isNatifEnvironnement()){j="catia"}}}j=j!==null?widget.getValue("appId")+"_"+j:widget.id;return j};var h={_preferences:{},_pendingRequestsAndCallbacks:{},get:function(j,l,k){if(k===true){j=d()+"_"+j}if(!this._preferences[j]){this._preferences[j]=new f({name:j})}this._preferences[j].addCallback(l)},set:function(j,l,n){if(n===true){j=d()+"_"+j}var m=true;if(!this._preferences[j]){this._preferences[j]=new f({value:l})}else{if(!this._preferences[j].hasValue(l)){this._preferences[j].setValue(l)}else{m=false}}if(m&&widget.id!="enopad_odt_wgd"&&widget.id.indexOf("preview")===-1){var k=UWA.Json.encode(l);c.saveUserPreferences({name:j,value:k,onComplete:function(){},onFailure:function(o){throw new Error("Error while saving userpreferences for ",j,o)}})}}};if(i.isReplayedODT()){h.getPrefixName=d}var a=b.singleton(h);return a});define("DS/FolderEditor/commands/ActionBar_SearchInContext",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({init:function(d){this._parent(d,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var d=this;require(["DS/FolderEditor/commands/FolderCommands"],function(e){e.SearchInFolderCmd()})},endExecute:function(){}});return b});define("DS/FolderEditor/utils/FolderEditorcontrol",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/FolderEditorOpenness/FolderEditorSecurityContextCustomization","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","UWA/Controls/Abstract","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,g,d,a,f,c){var b=f.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_isDebugMode:false,init:function(){this.checkRolesAvailability()},getContent:function(){return this._Content},getTreeCont:function(){return this._TreeCont},getIdCardCont:function(){return this._IdCardCont},getTrashCont:function(){return this._TrashCont},setContent:function(h){this._Content=h},setTreeCont:function(h){this._TreeCont=h},setIdCardCont:function(h){this._IdCardCont=h},setTrashCont:function(h){this._TrashCont=h},getActiveFolder:function(){return{origin:widget.id,id:this._activeFolderId!==undefined?this._activeFolderId:null,label:this._activeFolderLabel,sc:this._activeFolderSc,disabledId:this._activeFolderDisabledId}},setActiveFolder:function(k,i,j,h){this._activeFolderId=k;this._activeFolderLabel=i;this._activeFolderSc=j;this._activeFolderDisabledId=h},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(h){this._isDebugMode=h},isCustomizedEnv:function(){if(this._isCustomizedEnv===undefined){this._isCustomizedEnv=g.useComputedSecurityContext();this._isCustomizedEnv=false}return this._isCustomizedEnv},isActiveBookmarkActivated:function(){if(this._isActiveBookmarkActivated===undefined){this._isActiveBookmarkActivated=g.isActiveBookmarkActivated()}return this._isActiveBookmarkActivated},isImportCSVActivated:function(){if(this._isImportCSVActivated===undefined){this._isImportCSVActivated=g.isImportCSVActivated()}return this._isImportCSVActivated},checkRolesAvailability:function(i){var h=this;if(h._isPAUroleAvailable===undefined||h._isPARroleAvailable===undefined||h._isCSVroleAvailable===undefined){e.getGrantedRoles(function(l){h._isPAUroleAvailable=false;h._isPARroleAvailable=false;h._isCSVroleAvailable=false;for(var k=0;k<l.length;k++){var j=l[k]?l[k].id:"";if(j==="CSV"){h._isCSVroleAvailable=true}else{if(j==="PAU"||j==="CDR"||j==="EXL"||j==="InternalDS"){h._isPAUroleAvailable=true;h._isCSVroleAvailable=true}else{if(j==="PAR"){h._isPARroleAvailable=true;h._isCSVroleAvailable=true}}}}if(i){i(h._isPAUroleAvailable,h._isPARroleAvailable,h._isCSVroleAvailable)}})}else{if(i){i(h._isPAUroleAvailable,h._isPARroleAvailable,h._isCSVroleAvailable)}}},checkSecurityCTXandTenantInitialization:function(l){var j=this;if(typeof l==="function"){function h(){if(j._isSecurityCTXInitialized&&j._isTenantInitialized){l.call()}}if(j._isSecurityCTXInitialized===undefined){var i=a.getSetting("pad_security_ctx");j._isSecurityCTXInitialized=i?true:false;if(!j._isSecurityCTXInitialized){a.addEventOnce("onPad_security_ctx",function(m){j._isSecurityCTXInitialized=m?true:false;h()})}}if(j._isTenantInitialized===undefined){var k=d.getPlatformId();j._isTenantInitialized=k?true:false;if(!j._isTenantInitialized){a.addEventOnce("onPad_tenant",function(m){j._isTenantInitialized=m?true:false;h()})}}h()}}});return b});define("DS/FolderEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({labelTopBar:c.i18n("Remove Content"),isInsert:true,datas:{},init:function(d){this._parent(d,{mode:"exclusive",isAsynchronous:false});require(["DS/FolderEditor/commands/FolderCommands"],function(e){})},beginExecute:function(){},execute:function(){var d=require("DS/FolderEditor/commands/FolderCommands");d.RemoveContentCmd()},endExecute:function(){}});return b});define("DS/FolderEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({labelTopBar:c.i18n("Expand N levels"),isInsert:true,datas:{},init:function(d){this._parent(d,{mode:"exclusive",isAsynchronous:false});require(["DS/FolderEditor/utils/FolderAlert","DS/PADUtils/views/PADLevelSel","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol"],function(g,f,j,i,h){})},beginExecute:function(){},execute:function(){var g=require("DS/FolderEditor/utils/FolderAlert");var j=require("DS/PADUtils/views/PADLevelSel");var e=require("DS/FolderEditor/Folder_CSO");var h=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");var i=require("DS/FolderEditor/utils/FolderEditorcontrol");var d=i.getContent().getSelectedNodes();var f=null;f=e.getCurrentFolder();if(d.length){new j({events:{onApply:function(k){d.forEach(function(l){if(l.options.children===null){}else{l.expandNLevels({numberOfLevelsToExpand:parseInt(k),initialLevel:l.getNodeDepth()})}})}}})}else{if(f===null){g.displayNotification({message:h.msg_warning_noselection,className:"warning"})}else{new j({events:{onApply:function(k){f.expand({expandLevel:parseInt(k),clearLast:true,initialLevel:f.getNodeDepth()})}}})}}},endExecute:function(){}});return b});define("DS/FolderEditor/commands/tools/ImportCSVFilesUtils",["UWA/Core"],function(b){var a={formatBytes:function(d,c){if(d===0){return"0 Byte"}var f=1000;var e=c+1||3;var h=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];var g=Math.floor(Math.log(d)/Math.log(f));return(d/Math.pow(f,g)).toPrecision(e)+" "+h[g]},getStringByte4UTF8:function(f){var e=[0,1,1,1,2,3,2,3,4,3];var c=0;for(var d=0;d<f.length;d++){c+=e[encodeURIComponent(f.charAt(d)).length]}return c},Sanitize:{encode:function(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},removeControllCode:function(c){return c.replace(/[\t\r\n]/g,"")},escapeControllCode:function(c){return c.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}};return a});define("DS/FolderEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(c,a){var b=a.extend({labelTopBar:c.i18n("Add Content"),isInsert:true,datas:{},_modalChooser:null,init:function(d){this._parent(d,{mode:"exclusive",isAsynchronous:false});require(["DS/FolderEditor/Folder_CSO","DS/PADUtils/views/PADModalChooser","DS/FolderEditor/utils/FolderAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/PADUtils/PADUtilsServices","DS/UIKIT/Mask"],function(i,h,n,m,l,k,j){});var e=this;widget.addEvent("onRefresh",function(){if(UWA.is(e._modalChooser)){e._modalChooser.close();e._modalChooser=null}})},beginExecute:function(){this._buildCellSkeleton()},execute:function(){var g=this;var d=require("DS/FolderEditor/Folder_CSO");var e=require("DS/PADUtils/views/PADModalChooser");var f=require("DS/FolderEditor/utils/FolderAlert");var i=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");var h="";if(d.getCurrentFolder()){h=d.getCurrentFolder().getID()}if(!h.length){f.displayNotification({message:i.msg_warning_nocurrentfolder,className:"warning"})}else{if(UWA.is(this._modalChooser)){this._modalChooser.close()}setTimeout(function(){g._modalChooser=new e({renderTo:document.body,position:"above_action_bar",in_apps_search:{source:["3dspace"],in_apps_callback:g._objects_selected.bind(g)}})})}},_objects_selected:function(q){var f=require("DS/FolderEditor/Folder_CSO");var e=require("DS/FolderEditor/utils/FolderAlert");var j=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");var i=require("DS/FolderEditor/utils/FolderEditorcontrol");var p=require("DS/FolderEditor/commands/FolderCommands");var m=require("DS/FolderEditor/service/FolderServices");var g=require("DS/UIKIT/Mask");var h=require("DS/PADUtils/PADUtilsServices");var o=[];var n=this;var l=f.getCurrentFolder();var k=h.getPlatformId();var d=false;q.forEach(function(u){var v=u.resourceid;var t=u.sourceid;var r=null;if(t){var s=t.split(":");if(s.length>0){r=s[1]}}if(!!r&&r!==k){d=true}else{o.push(v)}});if(d===true){e.displayNotification({message:j.msg_warning_addnotsupported_from_different_tenant,className:"warning"})}if(o.length>0){p._startProgressBar(j.AddExisting_content_loading);if(c.is(i.getContent()._contentDiv)){g.mask(i.getContent()._contentDiv)}m.AddContent({IDs:o,callbacks:{onComplete:function(t){p._endProgressBarListener();if(c.is(i.getContent())){if(o.length===1){i.getContent().loadContentAndSelect(l,o[0])}else{i.getContent().loadContent(l)}if(c.is(i.getContent()._contentDiv)){g.unmask(i.getContent()._contentDiv)}}var s="";var r=o.length;if(t){var u=JSON.parse(t);r=u.added?u.added.length:r;s=u.information?" ("+u.information+")":s}e.displayNotification({message:j.replace(j.msg_info_Addinfolder,{number:r,foldername:l.options.label})+s,className:"primary"})},onFailure:function(r){p._offProgressBar();if(c.is(i.getContent()._contentDiv)){g.unmask(i.getContent()._contentDiv)}e.displayNotification({message:r?(j.msg_error_Addinfolder+"<br>"+r):j.msg_error_Addinfolder,className:"error"})}}})}},_buildCellSkeleton:function(){var d=require("DS/FolderEditor/utils/FolderEditorcontrol");if(!c.is(d.getContent().elements.container)){d.getContent().elements.container=c.createElement("span",{"class":"fonticon fonticon-1x fonticon-search",title:"Find in Context"})}},endExecute:function(){},});return b});define("DS/FolderEditor/utils/FolderConfirmation",["UWA/Class","DS/ENOFloatingPanel/ENOFloatingPanel","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/UIKIT/Input/Button"],function(d,c,e,b){var a=d.singleton({name:"Folder Confirmation",confirmModal:null,launch:function(o,n,m){var f=o.title;var i=o.content;var k=this;var j=i||"Are you sure?";var g=document.createElement("div");var l=new b({value:e.confirmation_ok,className:"primary"}).inject(g);var h=new b({value:e.confirmation_cancel}).inject(g);h.addEvent("onClick",function(p){k.confirmModal._close()});l.addEvent("onClick",function(p){n&&n(p);k.confirmModal._close()});k.confirmModal=new c({className:"command_dialog move",title:f,footer:g,body:j,overlay:true,closable:true,animate:true,resizable:false,autocenter:true,visible:true,events:{onClose:function(){m&&m(event);this.destroy()}},limitParent:true});k.confirmModal.inject(widget.body)},});return a});define("DS/FolderEditor/commands/ActionBar_LeftTreePanelCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/Core/ModelEvents"],function(e,d,c,b){var a=d.extend({_context:null,_callbackAdd:false,init:function(f){this._parent(f,{});this._context=c.get();this.setState(this._context.elements.padshell.getLeftOpen(),false);this.addCallback();var g=this;this.onStateChange(function(){var h=g._context.elements.padshell.getLeftOpen();if((this.getState()===true&&!h)||(this.getState()===false&&h)){g._context.togglePanel("left")}})},addCallback:function(){var f=this;if(this._callbackAdd===false){if(this._context.elements.padshell&&this._context.elements.padshell._modelEvents){this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},function(g){if(g==="left"){f.setState(false,false)}});this._callbackAdd=true}}}});return a});define("DS/FolderEditor/service/FolderTypeService",["UWA/Controls/Abstract"],function(b){var a=b.singleton({TYPE_ROOT_FOLDER_1:"Workspace",TYPE_ROOT_FOLDER_2:"RootFolder",TYPE_FOLDER_1:"Workspace Vault",TYPE_FOLDER_2:"Folder",TYPE_FOLDER_3:"Workspace Folder",TYPE_PERSONAL_FOLDER_1:"Personal Workspace",TYPE_FOLDERS_SECTION:"FolderSection_AllFolders",TYPE_FAVORITES_SECTION:"FolderSection_favorite",init:function(){},isRootFolder:function(c){return c===this.TYPE_ROOT_FOLDER_1||c===this.TYPE_ROOT_FOLDER_2},isFolder:function(c){return(c===this.TYPE_FOLDER_1||c===this.TYPE_FOLDER_2||c===this.TYPE_FOLDER_3)},isPersonalFolder:function(c){return c===this.TYPE_PERSONAL_FOLDER_1},inFamilyFolder:function(c){return(this.isRootFolder(c)||this.isFolder(c)||this.isPersonalFolder(c))},isSection:function(c){return(c===this.TYPE_FOLDERS_SECTION||c===this.TYPE_FAVORITES_SECTION)}});return a});define("DS/FolderEditor/FolderXNavComponent",["DS/ENXNav/XNavComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/mixins/xNavChangeAction"],function(d,a,e,c){a.softInit();var f=d.extend(c,{name:"pad_component",init:function(h){var g=b(h);var i=this._parent.bind(this);this.setFolderCommunicationChannel();require(["UWA/Utils/Client"],function(j){i(g)})},render:function(){return this},getPADTreeListView:function(){return this.options.views.treelistview},getPADTreeGraph:function(){return this.options?this.options.views.graphview:null},getEditMode:function(){var g=require("DS/PADUtils/PADSettingsMgt");return g.getSetting("EditModeActivated")},addRootNodes:function(g){if(!UWA.is(g,"array")){throw new Error("nodes parameter must be an array")}var j=this,k=[];this.dropInvitContainer.hide();var h=j.options.model;if(h){h.wrapInTransaction(function(){h.withTransactionUpdate(function(){h.addRoot(g);for(var l=0;l<g.length;l++){k.push(g[l].getID())}var m=h.getRoots().length;if(UWA.is(h.detachedRoots,"array")){m=m+h.detachedRoots.length}h.getModelEvents().publish({event:"onRootAdded",data:{nb_root:h.getRoots().length,added_node:g[h.getRoots().length-1]}})})})}var i={pids:k};j._commandProxy.drop(i)},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"treelistview"},_dispatchReady:function(){if((this.options.isReady.model===true)&&(this.options.isReady.PADmodel!==true)){this.options.isReady.PADmodel=true}if(this.options.isReady.model===true){this._probes.probe_model.end()}if(this.options.isReady[this.options.active_view]===true){this._probes.probe_view.end()}if(this.options.isReady.actionbar===true&&this._probes.probe_actionbar){this._probes.probe_actionbar.end()}if(this._dispatchReady_NotDone===true&&this.options.isReady.model===true&&this.options.isReady.actionbar===true&&this.options.isReady[this.options.active_view]===true){this.dispatchEvent.call(this,"onReady");this.dispatchEvent("onActionBarReadyToBuild");this._probes.probe_init.end();this._dispatchReady_NotDone=false}},});function b(h){var g={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",TreeListView:"DS/FolderEditor/views/FolderTreeListView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},layout:{}};g.layout=UWA.clone(h.layout_opts);g=UWA.extend(g,h,true);delete g.layout_opts;return g}return f});define("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization",["UWA/Core","UWA/Class","DS/FolderEditorOpenness/FolderEditorSecurityContextCustomization","DS/PADUtils/PADSettingsMgt","DS/Logger/Logger"],function(f,b,g,e,a){var d=a.getLogger("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization");var c=b.singleton({name:"FolderEditorManageSecurityContextCustomization",init:function(h){this._parent(h);this._isSecurityContextComputedByOpening=g.useComputedSecurityContext()},adaptSecurityContextToCurrentFolder:function(i){if(!i){return}if(this._isSecurityContextComputedByOpening){var k=[];var j=widget.getPreference("pad_security_ctx");if(j){var m=j.options;if(Array.isArray(m)){m.forEach(function(n){if(n.value){k.push(n.value)}})}else{d.warn("The widget has no options for pad_security_ctx preference")}}else{d.warn("The widget has no pad_security_ctx preference")}var h;if(k.length>0){try{h=g.computeSecurityContext(i,k)}catch(l){d.warn("FolderEditorSecurityContextCustomization throws exception",l)}}if(h&&k.indexOf(h)!==-1){widget.setValue("pad_security_ctx",h);e.setSetting("pad_security_ctx",h)}else{d.warn('SecurityContext "'+h+'" returned by FolderEditorSecurityContextCustomization is not valid')}}}});return c});define("DS/FolderEditor/commands/ActionBar_RelationIPExplorer",["DS/ApplicationFrame/Command"],function(a){var b=a.extend({labelTopBar:UWA.i18n("Where used"),isInsert:true,datas:{},init:function(c){c.isEnabled=false;this._parent(c,{mode:"exclusive",isAsynchronous:false});require(["DS/FolderEditor/utils/FolderAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor",],function(e,d){})},beginExecute:function(){},execute:function(){require(["DS/PADUtils/PADUtilsServices"],function(c){c.open_app({appId:"ENORIPE_AP"},function(e){if(e.response==="no_app"){var d=require("DS/FolderEditor/utils/FolderAlert");var f=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");d.displayNotification({message:f.msg_error_appWhereUsedNotFound,className:"error"})}})})},endExecute:function(){},});return b});define("DS/FolderEditor/ActionBar/Actionbar",["DS/ApplicationFrame/ActionBar"],function(b){var a=b.extend({init:function(){this._parent.apply(this,arguments)},_postProcess:function(){this.options.file=this.options.filename;this._parent.apply(this,arguments)}});return a});define("DS/FolderEditor/commands/ActionBar_AddFileCmd",["UWA/Core","UWA/Controls/Input","DS/ApplicationFrame/Command"],function(d,c,a){var b=a.extend({labelTopBar:d.i18n("Add New Document"),isInsert:true,input_file:null,datas:{},init:function(e){this._parent(e,{isAsynchronous:false,isEnabled:true});require(["DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/commands/FolderCommands","DS/PADUtils/PADContext","DS/FolderEditor/utils/FolderEditorUtil"],function(g,f,i,h){})},beginExecute:function(){},execute:function(){var h=require("DS/PADUtils/PADContext");var e=require("DS/FolderEditor/utils/FolderAlert");var f=require("DS/FolderEditor/utils/FolderEditorUtil");var g=h.get();if(!(window.File&&window.FileReader&&window.FileList&&window.Blob)){e.displayNotification({message:Nls.msg_error_FileAPI,className:"error"});return}this.clearInput();this.input_file=new c.File("Input.File",{visibility:"hidden",style:{display:"none"}}).inject(g.folderGlobal_div);this.input_file.elements.container.setStyle("display","none");this.input_file.elements.input.multiple=true;if(f.isTouchDevice()){this.input_file.elements.input.accept="image/*;capture=camera"}this.input_file.elements.input.addEventListener("change",this.onFileSelect.bind(this),false);this.input_file.elements.input.addEventListener("click",function(i){i.stopPropagation()});this.input_file.elements.input.click()},endExecute:function(){},onFileSelect:function(g){var f=g.target.files;var e=require("DS/FolderEditor/commands/FolderCommands");e.uploadFileCmd(f);this.clearInput()},clearInput:function(){if(this.input_file){this.input_file.destroy();this.input_file=null}}});return b});define("DS/FolderEditor/popup/AddCommentPopup",["UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/UIKIT/Input/File","DS/ENOFloatingPanel/ENOFloatingPanel","i18n!DS/FolderEditor/assets/nls/AddCommentPopup"],function(g,c,d,b,f,e){var a=g.extend({file:null,comment:"",modal:null,onResize:function(){if(this.ARWidget!=null){this.ARWidget.onResize()}},init:function(p,h,r,k,s){var o=this;this.modal=new f({className:"site-reset",title:r,footer:UWA.createElement("div",{"class":"AddCommentPopup_footer"}),animate:false,overlay:true,resizable:true,closable:true}).inject(p);var l=new c({value:e.OK,className:"primary checkinButton",disabled:true});l.addEvent("onClick",function(){k(o.file,o.comment);o.modal.destroy()});l.inject(this.modal.elements.footer);var m=new c({value:e.Cancel});m.addEvent("onClick",function(){o.modal.destroy()});m.inject(this.modal.elements.footer);var j=new b({buttonPosition:"right",buttonClassName:"btn-primary",placeholder:e.SelectFile_PlaceHolder,buttonText:e.SelectFile_Button});var n=function(){(o.file!==null?l.enable():l.disable())};j.elements.container.addEvent("change",function(t){var u=t.srcElement?t.srcElement.files:t.target.files;if(u.length==0){u=t.detail.files}if(u.length>1){throw"Cannot select more than one file"}if(u.length==1){o.file=u[0]}else{o.file=null}n()});var q=new d({fields:[{type:"text",label:e.Comment_Title,pattern:"[a-zA-Z]+",placeholder:e.Comment_PlaceHolder,multiline:true,rows:4,required:false}]});var i=function(t){var u=t.srcElement.value;if(u.length>0){o.comment=u}else{o.comment=null}n()};q.elements.container.addEvent("change",i);q.elements.container[0].addEvent("keyup",i);j.inject(this.modal.elements.body);q.inject(this.modal.elements.body);this.modal.show()},show:function(){var h=this},close:function(){this.container.hide();if(this.options.removeAtClose===true){this.container.destroy()}this.dispatchEvent("onClose")},});return a});define("DS/FolderEditor/utils/FolderSearch",["UWA/Class","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(c,b){var a={tree:"ds6w:label"};var d=c.singleton({init:function(e){this._parent(e);this._currentSearch=null;this._searchInfo=null;this._indexInfo=null;this._lListener=[];this._lListenerResult=[];this._refine=null;this._originFolder=null;this._previousViewCommand=null;this._defaultPredicates=["ds6w:label","ds6w:reservedBy","relcount","taxonomies"];var g=this._defaultPredicates;var f=["icon","thumbnail_2d"];this._searchInfo={with_indexing_date:true,select_predicate:g,select_file:f,order_field:"ds6w:modified",order_by:"desc",nresults:25}},setNumberResults:function(e){this._searchInfo.nresults=e},setPreviousView:function(e){this._previousViewCommand=e},getPreviousView:function(){return this._previousViewCommand},setPredicates:function(e){var f=this;this._searchInfo.select_predicate=this._defaultPredicates;if(Array.isArray(e)){e.forEach(function(g){f._searchInfo.select_predicate.push(g)})}},onSearchChange:function(e){if(typeof e==="function"){this._lListener.push(e)}},onSearchResult:function(e){if(typeof e==="function"){this._lListenerResult.push(e)}},_notifyChange:function(e){if(this.isSearchActive()||e){var f=this;if(!e){e=f._currentSearch}this._lListener.forEach(function(g){g.call(null,f._currentSearch)})}},changeSortField:function(h,f){var g=this._getDS6WFromColumnIndex(h);var e=this._getColumnPredicate(g);if(e&&e.startsWith("ds6w")){if(this._searchInfo.order_field!==e){this._searchInfo.order_field=e;this.setInfoIndex(null,false)}if(f){this._notifyChange()}}else{return{message:b.get("msg_info_SortNonAvailable"),className:"primary"}}},changeOrderSort:function(e,f){if(e!=null&&this._searchInfo.order_by!=e){this._searchInfo.order_by=e;this.setInfoIndex(null,false)}if(f){this._notifyChange()}},changeSearch:function(g,f){if(g===""){g=null}if(this._currentSearch!==g||!g){this.setInfoIndex(null,!g);var e=this._currentSearch;this._currentSearch=g;this._notifyChange(e)}},columnIsAvailable:function(e){return this._getColumnPredicate(e)!=null},_getColumnPredicate:function(f){var e=this._getDS6WFromColumnIndex(f);var g=this.getSearchInfo().select_predicate.indexOf(e)>=0?e:null;g=!g&&this.getSearchInfo().select_predicate.indexOf(e)>=0?e.toLowerCase():g;return g},_getDS6WFromColumnIndex:function(f){var e=a[f];if(!e){e=f}return e},getSearchInfo:function(){return this._searchInfo},setInfoIndex:function(g,e){var f=this;this._indexInfo=g;if(e!==false){this._lListenerResult.forEach(function(h){h.call(f,g)})}},getOrderFieldForTree:function(){var f=this.getOrderField();for(var e in a){if(a[e]===f){f=e}}return f},getOrderField:function(){return this.getSearchInfo()?this.getSearchInfo().order_field:null},getOrderBy:function(){return this.getSearchInfo()?this.getSearchInfo().order_by:null},getInfoIndex:function(){return this._indexInfo},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},getNumberHits:function(){return this._indexInfo?this._indexInfo.nhits:0},getDateLastIndexation:function(){var e=null;var f=this.getInfoIndex();if(f&&f.sources){var g=null;f.sources.forEach(function(j){if(j.indexingDate){var h=j.indexingDate}for(var i in h){if(h[i]&&h[i]!==-1){if(!g){g=h[i]}else{if(h[i]<g){g=h[i]}}}}});if(g){e=new Date(g*1000)}}return e},setRefine:function(e){var f=this.getRefine();if(JSON.stringify(f)!==JSON.stringify(e)){this._searchInfo.refine=e;this.setInfoIndex(null,false);this._notifyChange()}},getRefine:function(){return this._searchInfo.refine},clearRefine:function(){delete this._searchInfo.refine},isSearchActive:function(){return this.getSearchValue()?true:false},isSearchInProgress:function(){return this._indexInfo&&this._currentSearch},getSearchValue:function(){return this._currentSearch},getOriginFolder:function(){return this._originFolder},setOriginFolder:function(e){this._originFolder=e},clearSearch:function(){this.changeSearch("",true)}});return d});define("DS/FolderEditor/Folder_Clipboard",["UWA/Class"],function(a){var b=a.singleton({name:"folder_clipboard",_currentFolder:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:true,_IsExternalDrop:true,init:function(c){this._parent(c);var d=this},addInFolderClipboard:function(e,c,d){if(!UWA.is(c)){throw new Error("No folderNode specified")}if(!UWA.is(e)){throw new Error("No selected nodes specified")}d=d.toUpperCase();this._Mode=d;this._IsEmpty=false;this._currentFolder=c;this._currentSelectedNodes=UWA.extend([],e)},IsEmpty:function(){return this._IsEmpty},ClearClipboard:function(){this._IsEmpty=true},getTreeNode:function(){return this._currentFolder},getSelectedNodes:function(){return this._currentSelectedNodes},getMode:function(){return this._Mode},SetAsExternalDrop:function(c){this._IsExternalDrop=c},IsExternalDrop:function(){return this._IsExternalDrop},});return b});define("DS/FolderEditor/commands/ActionBar_FitAllInCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/utils/FolderEditorcontrol",],function(d,a,c){var b=a.extend({labelTopBar:d.i18n("Fit All In"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){c.getContent().getPADTreeGraph().reframeAll()},endExecute:function(){}});return b});define("DS/FolderEditor/commands/ActionBar_ToggleLayout",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/utils/FolderEditorcontrol",],function(d,a,c){var b=a.extend({labelTopBar:d.i18n("Toggle Layout"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){if(d.is(c.getContent().getPADTreeGraph().toggleLayout)){c.getContent().getPADTreeGraph().toggleLayout(this._id)}},endExecute:function(){}});return b});define("DS/FolderEditor/commands/ActionBar_SwapThumbState",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/utils/FolderEditorcontrol","DS/etree/syncwidget",],function(e,a,d,b){var c=a.extend({labelTopBar:e.i18n("Swap thumbnail"),isInsert:true,datas:{},defaultOptions:{state:b.ThumbnailState.EXPANDED},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var f=false;if(this.options.state===b.ThumbnailState.EXPANDED){this.options.state=b.ThumbnailState.COLLAPSED;f=true}else{if(this.options.state===b.ThumbnailState.COLLAPSED){this.options.state=b.ThumbnailState.EXPANDED;f=true}}if(f===true){d.getContent().getPADTreeGraph().setAllThumbnailsState(this.options.state)}},endExecute:function(){}});return c});define("DS/FolderEditor/commands/ActionBar_ReframeOnCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/utils/FolderEditorcontrol",],function(d,a,c){var b=a.extend({labelTopBar:d.i18n("Reframe On"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){c.getContent().getPADTreeGraph().reframeOn()},endExecute:function(){}});return b});define("DS/FolderEditor/commands/ActionBar_ExportCSVCmd",["DS/ApplicationFrame/Command","DS/FolderEditor/utils/FolderEditorcontrol","DS/ENXNav/commands/tools/xNavExporter","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(b,e,a,d){var c=b.extend({labelTopBar:UWA.i18n("Export View to CSV"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){a.generateCsv({context:e.getContent(),csv_base_file_name:d.csv_base_file_name})},endExecute:function(){},});return c});define("DS/FolderEditor/commands/ActionBar_ToggleOverview",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/utils/FolderEditorcontrol",],function(d,a,c){var b=a.extend({labelTopBar:d.i18n("Toggle Overview"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){if(d.is(c.getContent().getPADTreeGraph().toggleOverview)){c.getContent().getPADTreeGraph().toggleOverview()}},endExecute:function(){}});return b});define("DS/FolderEditor/utils/FolderEditorEvents",["UWA/Class","DS/Core/ModelEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/service/FolderTypeService"],function(e,d,c,f){var g=e.singleton({EVT_CURRENT_FOLDER_CHANGE:"/FOLDER_EDITOR/CURRENTFOLDER_CHANGE",EVT_NODEMODEL_MODIFY:"/FOLDER_EDITOR/NODEMODEL_MODIFY",_modelEvents:null,init:function(a){this._parent(a);this._modelEvents=new d()},createBookmarkForPublication:function(i,j){var h=i;var a={From:"FolderEditor",FolderID:null,FolderLabel:null,FolderType:null,IsInDeletedItems:false,IsFavorite:!!h&&h.isFavorite===true,Timestamp:Date.now()};if(h&&(f.inFamilyFolder(h.plmType)||j)){a.FolderID=h.getID();a.FolderLabel=h.getLabel();a.FolderType=h.getType()}if(h&&h.plmType==="FolderSection_Trash"){a.IsInDeletedItems=true}return a},notifyFolderRename:function(h){if(!UWA.is(h,"array")){throw new Error("input parameter should be array")}var a=this;h.forEach(function(i){var j=a.createBookmarkForPublication(i);c.publish("FolderEditor.FolderUpdated",JSON.stringify(j),true);a._modelEvents.publish({event:a.EVT_NODEMODEL_MODIFY,context:i,data:i})})},notifyFolderLoadingEnd:function(a){if(!UWA.is(a)){throw new Error("input parameter should be a TreeNodeModel")}this._modelEvents.publish({event:this.EVT_FOLDER_LOADINGEND,context:a,data:a})},onFolderLoadingEnd:function(h){if(!UWA.is(h,"function")){throw new Error("input parameter should be function")}var a=this;this._modelEvents.subscribe({event:a.EVT_FOLDER_LOADINGEND,},h)},onFolderRename:function(h){if(!UWA.is(h,"function")){throw new Error("input parameter should be function")}var a=this;this._modelEvents.subscribe({event:a.EVT_NODEMODEL_MODIFY,},h)},notifyCurrentFolderChange:function(h){if(!UWA.is(h,"object")){throw new Error("input parameter should be object")}if(!h.currentNode){throw new Error("input object should have currentNode")}var a=this;this._modelEvents.publish({event:a.EVT_CURRENT_FOLDER_CHANGE,context:h.currentNode,data:h})},onCurrentFolderChange:function(h){if(!UWA.is(h,"function")){throw new Error("input parameter should be function")}var a=this;this._modelEvents.subscribe({event:a.EVT_CURRENT_FOLDER_CHANGE,},h)},});var b={};return g});define("DS/FolderEditor/Folder_CSO",["UWA/Core","DS/Selection/XSO","DS/Logger/Logger","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization","DS/PADUtils/PADProbes"],function(g,j,b,k,c,e,d,l,f){var i="FOLDER_CSO/SELECT";var h=function(n){var m="";if(n){var o=n.plmType;if(o=="Folder"){m="Workspace Vault"}else{if(o=="RootFolder"){if(n.isPersonal){m="Personal Workspace"}else{m="Workspace"}}else{m=o}}}return m};var a=j.singleton({name:"folder_cso",_logger:null,_currentFolder:null,init:function(m){var o={areEquals:function(q,p){return q===p}};UWA.extend(o,m);this._parent(o);this._logger=b.getLogger(a);var n=this;this.onPostAdd(function(p){var q="CONTENT";if(UWA.is(p,"array")){p=p[0]}if(p&&UWA.is(p.getID,"function")&&p.getID()==n.getCurrentFolderID()){q="TREE"}if(UWA.is(p)){n._modelEvents.publish({event:i,data:{context:q,selectedNode:p}})}});e.onFolderRename(function(q){if(n._currentFolderPath){var p=q.getID();var s=q.getLabel();var r=n.getCurrentFolderID();n._currentFolderPath.forEach(function(t){if(t.id===p){t.label=s}});if(p===r){d.getIdCardCont().setCurrentLocation()}}})},addInFolderCSO:function(q,m){if(!UWA.is(q)){throw new Error("No folderNode specified")}if(!UWA.is(m)){throw new Error("No context specified")}var w=f.createProbe("folder_addInFolderCSO");m=m.toUpperCase();if(m=="TREE"){var s=this;this.empty(false);var r=this._currentFolder;this._currentFolder=q;var p=function(y,x){if(k.inFamilyFolder(x.plmType)&&x.id){if(d.isCustomizedEnv()){l.adaptSecurityContextToCurrentFolder(x.id)}}e.notifyCurrentFolderChange({previousNode:y,currentNode:x});s.add(x);w.end()};this._currentFolderPath=[{id:q.id,type:h(q),label:q.getLabel(),mxid:q.options.mxid}];var v=false;if(k.inFamilyFolder(q.plmType)){if(q.isVisible&&q.isVisible()&&q.getPath){var t=q.getPath();if(Array.isArray(t)&&t.length>=2&&t[0]&&t[0].plmType==="FolderSection_AllFolders"){this._currentFolderPath=[];for(var n=1;n<t.length;n++){var u=t[n];this._currentFolderPath.push({id:u.id,type:h(u),label:u.getLabel(),mxid:u.options.mxid})}v=true}}}else{v=true}if(v){p(r,q)}else{c.getFolderPath({pid:q.id,onComplete:function(z){z=JSON.parse(z);var y=z.folders;var x=y?y.length:0;if(!y&&z.error){s._logger.warn("Unable to retrieve FolderPath using WebService");p(r,s._currentFolder)}if(x>=1&&y[x-1]){if(s._currentFolder&&y[x-1].id==s._currentFolder.id){s._currentFolderPath=[];y.forEach(function(A){s._currentFolderPath.push({id:A.id,type:A.type,label:A.label,mxid:A.mxid})});p(r,s._currentFolder)}else{s._logger.log("FolderPath returned by WebService do not corresponds to the current Folder")}}else{s._logger.warn("Empty FolderPath returned by WebService")}},onFailure:function(x){s._logger.warn("Unable to retrieve FolderPath using WebService");p(r,s._currentFolder)}})}}else{this.empty(false);var o=null;if(UWA.typeOf(q)=="array"){o=q}else{o=[q]}if(o.length===0){this.add(this._currentFolder);w.end()}else{this.add(o);w.end()}}},removeFromFolderCSO:function(m){if(!UWA.is(m)){throw new Error("No folderNode specified")}this.remove(m);if(this.getSelectedNodes().length===0&&m!=this._currentFolder){this.add(this._currentFolder)}},removeAllFromFolderCSO:function(){this.empty(true)},getCurrentFolder:function(){return this._currentFolder},updateLabelCurrentFolderPath:function(){if(this._currentFolderPath){var m=this._currentFolderPath.length;var n=this._currentFolder.getLabel();if(this._currentFolderPath[m-1].label!==n){this._currentFolderPath[m-1].label=n}}},getCurrentFolderID:function(){var m=null;if(this._currentFolder&&this._currentFolder.getID){m=this._currentFolder.getID()}return m},getCurrentFolderPath:function(){var m=[];if(this._currentFolderPath){this._currentFolderPath.forEach(function(n){m.push({id:n.id,type:n.type,label:n.label,mxid:n.mxid})})}return m},getSelectedNodes:function(){var m=[];if(this.get()){this.get().forEach(function(n){m.push(n)})}return m},getSelectedNodesID:function(){var m=[];if(this.get()){this.get().forEach(function(n){m.push(n.getID())})}return m},onFolderSelected:function(m){return this._modelEvents.subscribe({event:i},m)}});return a});define("DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","UWA/Class/Promise","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderAlert","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/UIKIT/Popover","DS/Tree/Tree","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Foundation/CsvParser","i18n!DS/FolderEditor/assets/nls/ImportCSVBookmarkPanel","DS/FolderEditor/utils/FolderEditorcontrol","DS/Controls/ProgressBar","DS/UIKIT/Input/Text","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/PADProbes","DS/PlatformAPI/PlatformAPI","css!DS/FolderEditor/FolderEditor.css","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/commands/tools/ImportCSVFilesUtils","DS/WidgetServices/WidgetServices",],function(e,L,J,o,b,x,B,M,g,d,F,z,E,v,u,j,s,C,G,k,h,w,l,y,r,q,D,i,p,c){var A=1000;var K="323px";var I="570px";var f="435px";var a=['"',"#","$","@","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"];var m=['"',"#","$","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"];var t=5;var n=function(O,N){N===true?O.addClassName("withBorder"):O.removeClassName("withBorder")};var H=L.extend(o,J,{name:"ImportCSVBookmark",_logger:null,defaultOptions:{parent:null,renderTo:null,data:{level:0,name:1,description:2,aclOwner:3,aclSecurityContext:4,toModel:function(N){return{level:N[0].trim(),label:N[1].trim(),description:N[2].trim(),acl:{owner:N[3].trim()===""?"@BLANK@":N[3].trim(),securityContext:N[4].trim()===""?"@BLANK@":N[4].trim()}}}}},_droppableType:{"application/vnd.ms-excel":"csv","text/csv":"csv"},_isClosing:true,_checkErrorRef:[],_currentFolderType:"",_currentFolder:null,_cancel:false,_lv1SecCtxEmpty:false,_browserLanguage:"",_mapSecurityContext:null,_errorTips:[],_errorReasons:null,init:function(N){var P=this;var O=e.merge(N||{},P.defaultOptions);P._browserLanguage=P.utils.getBrowserLanguage();P._mapSecurityContext=P.mapSecurityContext();return new x(function(R,Q){P._logger=b.getLogger(H);P._logger.log("init");P._parent(N);P._currentFolder=B.getCurrentFolder();P._currentFolderType=P._currentFolder?P._currentFolder.getType():undefined;P.inject(widget.body);R(P)})},closeDialog:function(){var N=this;if(N.dialog){N.dialog.destroy()}},_destroyErrorTips:function(){this._errorTips.forEach(function(N){N.destroy()});this._errorTips=[]},clickCancelButton:function(){var N=this;if(N._isClosing){N._cancel=true;this._destroyErrorTips();N.closeDialog()}},inject:function(W){var T=this;T._logger.log("inject");var S=r.createProbe("ImportCSV_inject");var V=new y({closable:true,resizable:true,autocenter:true,overlay:true,header:null,className:"importCSVDialog",limitParent:true,body:'<div class="drop-csv"><input class="drop-csv-input" type="file" /><span class="drop-csv-label"><span class="fonticon fonticon-publish fonticon fonticon-2x"></span><p class="drop-csv-label-p"><span class="icon-label">'+k.Drop_Csv_File+'</span></p></span></div><div class="preview-csv"><div class="prev-csv-read"></div><div class="preview-csv-tree"><div class="preview-csv-tree-msg"></div></div></div>',footer:'<div class="csvstatus"></div>',events:{onHide:function(){if(T._isClosing){U.destroy()}T.clickCancelButton.call(T)}}}).inject(W);var O=e.Element.getElement.call(V.getHeader(),".floatingPanel_title span");window.top.dbg=V.getHeader();var Z=T._currentFolder?T._currentFolder.getLabel():"";O.setHTML("<span class='csv-title'>"+k.Dialog_Title+Z+"</span><span class='csv-title-icon'></span>");var N=e.Element.getElements.call(O,"span")[0];var X=e.Element.getElements.call(O,"span")[1];var P=B.getCurrentFolderPath();var aa=" ";if(P&&P.length>0){var ac="";var Y=P.length;for(var Q=0;Q<Y;Q++){aa+=ac+P[Q].label;ac="\\"}}var U=new v({position:"bottom",target:N,body:aa});V.getContent().setStyle("min-width","450px");V.getContent().setStyle("width","450px");V.getContent().setStyle("min-height","215px");V.getContent().setStyle("height","215px");T.csvStatusArea=e.Element.getElement.call(V.getFooter(),".csvstatus");T.notifyArea=new l({className:"detailmsg",value:"",disabled:true}).inject(V.getFooter());var R=new E({value:k.Label_Import,className:"primary",disabled:true}).inject(V.getFooter());R.addEvent("onClick",function(){this.disable();T.execImportCSV()});var ab=new E({value:k.Cancel,className:"default",title:k.Cancel_Tooltip}).inject(V.getFooter());ab.addEvent("onClick",function(){T.clickCancelButton.call(T)});V.show();T.dialog=V;T.importButton=R;T.cancelButton=ab;T.dropZone=e.Element.getElement.call(T.dialog.getBody(),".drop-csv");T.dropInput=e.Element.getElement.call(T.dialog.getBody(),".drop-csv-input");T.dropLabel=e.Element.getElement.call(T.dialog.getBody(),".drop-csv-label");T.dropLabelPara=e.Element.getElement.call(T.dialog.getBody(),".drop-csv-label-p");T.dialog.getBody().addClassName("dialog-csv");T.dialog.getBody().setStyle("height","100px");T.droppable(T.dropZone);S.end();return T},reset:function(){var N=this;N._logger.log("reset");if(N.filePreview){N.filePreview.destroy()}N.tree=undefined;N.filePreview=undefined},_initProgress:function(N){if(this.progress){this.progress.destroy()}this.csvStatusArea.empty();this.progress=new w({shape:"circular",statusFlag:false,emphasize:N,dislpayFlag:false,displayStyle:"lite"});this.progress.inject(this.csvStatusArea);this.progress.value=0},droppable:function(Q){var P=this;var N=0;P.dropInput.addEventListener("click",function(S){this.value=null;if(c.isReplayedODT()){S.preventDefault()}},false);P.dropInput.addEventListener("change",O,false);P.listeners={};P.listeners.clickable=P.dropInput.click.bind(P.dropInput);Q.addEventListener("click",P.listeners.clickable);P.listeners.dragenter=function(S){n(this,true);N++};Q.addEventListener("dragenter",P.listeners.dragenter);P.listeners.dragleave=function(S){N--;if(N===0){n(this,false)}};Q.addEventListener("dragleave",P.listeners.dragleave);P.listeners.dragover=function(S){S.preventDefault()};document.addEventListener("dragover",P.listeners.dragover);P.listeners.drop=function(U){U.preventDefault();var T=U.dataTransfer.types;if(!!T){var S=T.indexOf?T.indexOf("Files")!=-1:T.contains("Files");if(S){O(U)}}};Q.addEventListener("drop",P.listeners.drop);function R(S){z.unmask(Q);M.displayNotification({message:S,className:"error"});Q.addClassName("error");setTimeout(function(){Q.removeClassName("error")},A)}function O(V){var U=V.dataTransfer?V.dataTransfer.files:V.target.files;if(U.length===0){return true}if(U.length>1){R(k.ErrorMsg_Drop_Multiple_File);return}var T=U[0].name.split(".");if(T.length<=1||"csv"!==T[T.length-1].toLowerCase()){console.warn("drop file:"+T[T.length-1].toLowerCase());R(k.ErrorMsg_Drop_File_Not_CSV);return}else{if(U[0].size===0){R(k.ErrorMsg_Drop_File_Empty);return true}else{if(U[0].size>1024*25){var W=k.ConfirmMsg_Drop_File_Size_Large+" ("+p.formatBytes(U[0].size,2)+")";var S=new d({renderTo:P.options.renderTo,events:{onShow:function(){P._isClosing=false;P.dialog.hide()},onHide:function(){P._isClosing=true;P.dialog.show()}}});S.confirm(W,k.Label_Confirm_Title,function(X){if(X){P._loadCsv(Q,U[0])}})}else{P._loadCsv(Q,U[0])}}}}},_getOrCreateTreeContent:function(){var N=e.Element.getElement.call(this.dialog.getBody(),".preview-csv-tree");if(!N.getElement(".tree-content")){e.createElement("div",{"class":"tree-content"}).inject(N)}},_loadCsv:function(Q,O){var P=this;z.mask(Q);var N=function(S){z.unmask(Q);P.updateDroppedFile({name:O.name,size:O.size})};P._destroyErrorTips();P._errorReasons=[];P.importButton.setValue(k.Label_Import);P.importButton.disable();P.reset();n(Q,false);var R=e.Element.getElement.call(P.dialog.getBody(),".preview-csv-tree");R.setStyle("height","0px").setStyle("border","solid 0px");R.empty();this._getOrCreateTreeContent();x.all([P._readFile(O)]).then(function(S){var W=[];try{P._initProgress("info");P.csvStatusArea.addClassName("active");var U=G.parse(S[0]+"\r\n");if(U.length>0){var T=U[0];if(T.length>0&&isNaN(T[0])){U.splice(0,1)}}x.all([P.checkLines(U),P.checkRemoteStatus(U)]).then(function(X){var Y=X[0].concat(X[1]).sort(function(aa,Z){if(Math.abs(aa.linePos)!==Math.abs(Z.linePos)){return(Math.abs(aa.linePos)<Math.abs(Z.linePos))?-1:1}else{return(Math.abs(aa.pos)<Math.abs(Z.pos))?-1:1}}).filter(function(Z){return Z.reason!==""});P._errorReasons=Y;P._prepareImportData(U,Y,N)})}catch(V){handleError(V.message)}})},_prepareImportData:function(P,Q,U){var V=this;var R;var W=Q.length===0;if(!W){R=[]}else{R=P}V.tree&&V.tree.destroy();var Y=V._createTreeView();var O=V._createTreeModel(R);Y.getDocument().addRoot(O);V.tree=Y;V.root=O;x.all([V.resolveSecurityContextOfSelectedFolder(V.root),V._showPreview(Y),V._getStructure(O.options.id,O.options.label,0,O),]).then(function(ad){var ac=ad[0],Z=ad[1],ab=ad[2];O.options.appData.acl.securityContext=ac;var aa=V.root.getAllDescendants().filter(function(af){return(af.options.appData.hasId)});if(W){var ae=P.length-aa.length;if(ae===0){V.notifyMessage("info",k.InfoMsg_Create_Target_Size_Zero);V.cancelButton.setValue(k.Close);V.importButton.setValue(k.Label_Import+"(0)");V.importButton.disable();return}else{if(ac===null&&V._lv1SecCtxEmpty){M.displayNotification({message:k.WarnMsg_SecurityContext_MissMatch,className:"warning"});V.cancelButton.setValue(k.Close);V.importButton.setValue(k.Label_Import+"(0)");V.importButton.disable();return}else{V.importButton.enable();V.importButton.setValue(k.Label_Import+"("+(ae)+")")}}}})["catch"](function(Z){M.displayNotification({message:k.ErrorMsg_Rest_Error+(Z&&Z.message?" "+Z.message:""),className:"error"})});U(Y);var N=Q.map(function(Z){return Math.abs(Z.linePos)}).filter(function(ab,Z,aa){return aa.indexOf(ab)===Z}).length;var T=P.length-N;var X=e.Element.getElement.call(V.dialog.getBody(),".tree-content");if(W){V.notifyMessage("info","["+T+"/"+P.length+"] "+k.InfoMsg_Load_Csv_Success);V.csvStatusArea.removeClassName("active")}else{V.notifyMessage("error","["+T+"/"+P.length+"]"+k.InfoMsg_Load_Csv_Error);V.progress.emphasize="high-attention";X.addClassName("csverror");var S=[k.Label_Column_Level,k.Label_Column_Name,k.Label_Column_Description,k.Label_Column_Owner,k.Label_Column_SecurityContext];Q.forEach(function(ac){var ab=Math.abs(ac.linePos);var ae=V.options.data;var aa=e.createElement("div",{text:" ("+k.Label_LineNumber+":"+(ab+1)+") "+ac.reason,"class":"errorline icon"+ac.pos});X.appendChild(aa);if(ac.pos){var ad="";ad=S[ac.pos]+" : "+P[ab][ac.pos];var Z=new v({position:"bottom",target:aa,body:p.Sanitize.encode(ad)});V._errorTips.push(Z)}})}new F({element:X});X.addClassName("csvshow")},undroppable:function(N){if(this.listeners){N.removeEventListener("click",this.listeners.clickable);N.removeEventListener("dragenter",this.listeners.dragenter);N.removeEventListener("dragleave",this.listeners.dragleave);N.removeEventListener("dragover",this.listeners.dragover);N.removeEventListener("drop",this.listeners.drop);this.listeners=null}N.setStyle("cursor","default");this.dropLabel.setStyle("cursor","default");N.addClassName("drop-disabled")},updateDroppedFile:function(O){var P=this;P.dialog.getContent().setStyle("min-width",I);P.dialog.getContent().setStyle("min-height",f);P.dialog.getContent().setStyle("width",I);P.dialog.getContent().setStyle("height",f);var N=e.createElement("span",{"class":"csv-file",html:'<span class="csv-file-image"></span><span class="csv-file-name">'+O.name+" ("+p.formatBytes(O.size,2)+")</span>"});P.filePreview=N;P.dropLabel.setStyle("font-size","10px").setStyle("top","-5px").setStyle("float","right").setStyle("text-align","center");P.dropZone.setStyle("height","40px").setStyle("border","initial").setStyle("cursor","pointer");var Q=e.Element.getElement.call(P.dropLabelPara,".icon-label");Q.textContent=k.Change_Csv_File;var R=e.Element.getElement.call(P.dialog.getBody(),".preview-csv-tree");R.setStyle("height","calc(100% - (56px + 66px + 66px) )");R.setStyle("border","1px solid #e2e4e3").setStyle("top","100px");this._getOrCreateTreeContent();setTimeout(function(){N.inject(P.dropLabel,"before");P.undroppable(P.dropZone);if(!P.iconZone){P.iconZone=e.Element.getElement.call(P.dropZone,".fonticon");if(P.iconZone){P.iconZone.setStyle("cursor","pointer");var S=P.dropInput.click.bind(P.dropInput);P.iconZone.addEventListener("click",S,false);var T=Q;T.setStyle("cursor","pointer");T.addEventListener("click",S,false)}}},A/3)},_readFile:function(O){if(!!O.dontRead){return}var P=this;var N=new FileReader();return new x(function(R,Q){N.onload=(function(){return function(S){R(S.target.result)}})(O);N.readAsText(O,P._browserLanguage==="ja"?"Shift-JIS":"WINDOWS-1252")})},checkLines:function(N){var O=this;return new x(function(ac,S){var aa=r.createProbe("ImportCSV_checklines");var R=O.options.data;var U=0;var Q=0;var al="";var ai=[{}];var Z={};var ag={};var ah=[];var T=new RegExp("^-*[0-9]+$");O._checkErrorRef=ah;var W=c.isReplayedODT()?1:-1;for(var ad=0;ad<N.length;ad++){var X={reason:"",data:[],linePos:-1,pos:-1};var Y=N[ad];if(Y.length<t){X.reason=k.ErrorMsg_Column_Count;X.linePos=ad;X.pos=null;ah.push(X);continue}if(Q>=0){X.pos=R.level;var P=Y[R.level];if(T.test(P)){P=parseInt(P)}else{X.reason=k.ErrorMsg_Level_Is_Not_Number;X.linePos=ad*W;ah.push(X);Q=X.linePos;continue}if(P<=0){X.reason=k.ErrorMsg_Level_Origin;X.linePos=ad*W;ah.push(X);Q=X.linePos;continue}if(Q>=P||Q+1===P){if(Q>=P){var aj=Q-P;for(var ab=0;ab<aj;ab++){ai.pop()}}al=Y[R.name];if(ai.length+1===P){ai.push({})}Z=ai[P-1];if(Z){if(Z[al]){X.pos=R.name;X.reason=k.ErrorMsg_Name_Duplicate;X.linePos=ad;Q=P;ah.push(X);continue}Z[al]=true}Q=P}else{X.pos=R.level;X.reason=k.ErrorMsg_Level_Is_Not_Sequencial;X.linePos=ad*W;ah.push(X);Q=X.linePos;continue}}X.pos=R.name;al=Y[R.name];if(al.trim()===""){X.reason=k.ErrorMsg_Name_Required;X.linePos=ad;ah.push(X);continue}if(p.getStringByte4UTF8(al)>=127){X.reason=k.ErrorMsg_Name_Max_Over;X.linePos=ad;ah.push(X);continue}var af=a.join("");var ak=new RegExp("["+af+"]");var V=ak.exec(al);if(V){X.reason=k.ErrorMsg_Avoid_Char+"("+V.map(function(am){return am}).join("&nbsp;")+")";X.linePos=ad;ah.push(X);continue}al=p.removeControllCode(al);Y[R.name]=al;X.pos=R.description;var ae=Y[R.description];if(ae.length>1024){X.reason=k.ErrorMsg_Desc_Max_Over;X.linePos=ad;ah.push(X);continue}V=ak.exec(ae);if(V){X.reason=k.ErrorMsg_Avoid_Char+"("+V.map(function(am){return am}).join("&nbsp;")+")";X.linePos=ad;ah.push(X);continue}ae=p.escapeControllCode(ae);Y[R.description]=ae}aa.end();ac(ah)})},checkRemoteStatus:function(N){var O=this;return new x(function(ac,ad){var Q=r.createProbe("ImportCSV_checkRemoteStatus");var P=O.options.data;var ae={listeners:{}};var W;var R=[];O.csvStatusArea.addClassName("active");O._lv1SecCtxEmpty=false;var X=a.join("");var Y=m.join("");var U=new RegExp("["+X+"]");var T=new RegExp("["+Y+"]");var ab=0;var aa=0;var Z=O.listSecurityContext();var S=-1;function V(){return{reason:"",data:[],linePos:-1,pos:-1}}N.forEach(function(an,al){if(an.length<t){for(var ah=an.length;ah<t;ah++){an.push("")}}var ao=V();aa++;var af=an[P.aclOwner];af=af.trim();var ak=[];var ag=null;ag=x.resolve(true);if(af.length!==0){var ai=T.exec(af);switch(true){case p.getStringByte4UTF8(af)!==af.length:ao.pos=P.aclOwner;ao.reason=k.ErrorMsg_Owner_Is_Not_Ascii;ao.linePos=al;R.push(ao);ag=x.resolve("NOCHECK");break;case ai!==null:ao.pos=P.aclOwner;ao.reason=k.ErrorMsg_Avoid_Char+"("+ai.map(function(ap){return ap}).join("&nbsp;")+")";ao.linePos=al;R.push(ao);ag=x.resolve("NOCHECK");break;default:ao.pos=P.aclOwner;ag=O._checkOwner(al,af,ae);break}}ak.push(ag);ao=V();var aj=an[P.aclSecurityContext].trim();ag=x.resolve(true);if(aj.length!==0){ai=U.exec(aj);switch(true){case aj.split(".").length!==3:ao.pos=P.aclSecurityContext;ao.reason=k.ErrorMsg_SecCtx_Is_Invalid;ao.linePos=al;R.push(ao);ag=x.resolve("NOCHECK");break;case ai!==null:ao.pos=P.aclSecurityContext;ao.reason=k.ErrorMsg_Avoid_Char+"("+ai.map(function(ap){return ap}).join("&nbsp;")+")";ao.linePos=al;R.push(ao);ag=x.resolve("NOCHECK");break;default:ao.pos=P.aclSecurityContext;ag=O._checkSecurityContext(al,aj,Z);break}}else{if(an[P.level].trim()==="1"){O._lv1SecCtxEmpty=true}}ak.push(ag);var am=al+"";x.all(ak).then(function(ap){if(ap[0]===true&&ap[1]===true){if(O._checkErrorRef.filter(function(ar){return Math.abs(ar.linePos)===parseInt(am)}).length===0){ab++;var aq=(ab/N.length)*100;if(S!==aq){O.progress.value=aq;S=aq}}}return ap}).then(function(ap){var ar=null;var aq=null;if(!ap[0]){ar=k.ErrorMsg_Rest_Error;if(ap[0]===false){ar=k.ErrorMsg_Owner_Does_Not_Exist}}if(ar){aq={reason:ar,data:an,linePos:al,pos:P.aclOwner};R.push(aq)}ar=null;if(ap[1]===false){ar=k.ErrorMsg_SecCtx_Does_Not_Exist}if(ar){aq={reason:ar,data:an,linePos:al,pos:P.aclSecurityContext};R.push(aq)}aa--;if(aa===0){Q.end();ac(R)}})})})},_createTreeModel:function(R){var Q=this,S=Q.options.data;var P=[];var O=r.createProbe("ImportCSV_createTreeModel");var N=new s({id:Q._currentFolder.id,label:Q._currentFolder.getLabel(),level:0,appData:{acl:{}},icons:[C.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")]});P.push(N);R.forEach(function(V){var T=S.toModel(V);T.hasId=false;var U=new s({level:T.level,label:T.label,appData:T,icons:[C.getWebappsAssetUrl("FolderEditor","icons/folder.png")]});var W=T.level;P[W]=U;P[W-1].addChild(U)});O.end();return N},_createTreeView:function(){var P=this;var O={apiVersion:2,height:"auto",position:"relative",width:"auto",isEditable:false,isSortable:false,manageHeight:false};O.selection={toggle:false,canMultiSelect:false,unselectAllOnEmptyArea:false,nodes:false,rowHeaders:false};P.dialog.getBody().setStyle("height",K);var N=new j(O).inject(e.Element.getElement.call(P.dialog.getContent(),".preview-csv-tree"));return N},notifyMessage:function(N,O){this.notifyArea.setValue(O);this.notifyArea.setClassName("detailmsg show "+N)},_showPreview:function(N){var O=this;return new x(function(R,Q){function P(){if(e.Element.getElement.call(O.dialog.getBody(),".wux-scroller")!==null){setTimeout(function(){N.getDocument().expandAll();z.unmask(e.Element.getElement.call(O.dialog.getContent(),".preview-csv-tree"))},A/10);R(N)}else{setTimeout(function(){P()},A/10)}}P()})},_getStructure:function(R,N,Q,P){var O=this;return new x(function(W,V){var T=r.createProbe("ImportCSV_getStructure");var S=function(X){X.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];X.updateOptions("icons")};var U={onComplete:function(ac){var aa={};var ag=[];ac=JSON.parse(ac);var Y=ac.folders;var ai=P.getChildren()||[];var Z=ai.map(function(aj){return aj.getLabel()});for(var ae=0;ae<Y.length;ae++){var X=Y[ae],af=Q+1;var ad={id:X.id,label:X.name,level:Q+1};aa[X.name]=ad;var ah=Z.indexOf(X.name);if(ah!=-1){var ab=ai[ah];ab.options.id=X.id;ab.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")];ab.options.appData.hasId=true;ab.options.appData.modified=new Date(Date.parse(X.modified));ab.options.appData.acl.securityContext=O.resolveCurrentSecurityContextBy(X.organizationResponsible,X.project);ab.updateOptions("icons");ag.push(O._getStructure(X.id,X.name,af,ab))}}x.all(ag).then(function(aj){W(aa);T.end()})},onFailure:function(X){S(P);V(P.options.label);T.end()}};if(Q===0&&O._currentFolderType==="FolderSection_AllFolders"){U.isRoot=true;i.folderTree(U)}else{U.pid=R;i.folderTree(U)}})},resolveSecurityContextOfSelectedFolder:function(N){var O=this;return new x(function(R,Q){var P=r.createProbe("ImportCSV_resolveSecurityContextOfSelectedFolder");if(N.options.id!==""){i.getFolderProperties({pid:N.options.id,onComplete:function(S){if(e.is(S,"string")){S=JSON.parse(S)}N.options.appData.acl.securityContext=O.resolveCurrentSecurityContextBy(S.organizationResponsible,S.project);R(N.options.appData.acl.securityContext);P.end()},onFailure:function(S){N.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];N.updateOptions("icons");Q({type:"check",message:"("+N.options.label+")",raw:S});P.end()}})}else{N.options.appData.acl.securityContext=O.utils.getCurrentSecurityContext();R(N.options.appData.acl.securityContext);P.end()}})},resolveCurrentSecurityContextBy:function(T,O){var R=this;var Q=R.utils.getCurrentSecurityContext();var N=Q.split(".");var P=N[1];var S=N[2];if(P===T&&S===O){return Q}else{R._logger.warn("can't resolve securityContext : "+T+"."+O);return null}},execImportCSV:function(){var S=this;var N=r.createProbe("ImportCSV_execImportCSV");S._cancel=false;S._initProgress("success");S.csvStatusArea.addClassName("active");var O=S.root.getAllDescendants();var V=[];var X=0;for(var Q=0;Q<O.length;Q++){var T=O[Q];var U;if(T.options.appData.hasId){U=S.getFolder(T);X++}else{U=S.createFolder(T)}V.push(U)}var W=0;var R=null;var P=V.length-X;V.reduce(function(Y,Z){return Y.then(function(aa){S.progress.value=(W/P)*100;S.notifyMessage("info","["+(W)+"/"+P+"] "+k.InfoMsg_Folder_Creating);if(aa.type==="create"){W++}}).then(Z)},x.resolve({type:"dummy"}))["catch"](function(Y){R=Y.message||Y}).then(function(Y){S.cancelButton.setValue(k.Close);h.getContent().loadContentAndSelect(S._currentFolder);h.getTreeCont().updateTreeWithNewFolder(S._currentFolder);if(R===null){S.progress.value=100;S.notifyMessage("info","["+P+"/"+P+"] "+k.InfoMsg_Folder_Create_Success);S.csvStatusArea.removeClassName("active");M.displayNotification({message:k.InfoMsg_Folder_Create_Success,className:"info"})}else{S.notifyMessage("error","["+W+"/"+P+"] "+k.ErrorMsg_Folder_Create_Stoped);S.progress.emphasize="high-attention";M.displayNotification({message:R,className:"error"})}N.end()})},createFolder:function(O){var N=this;return function(){var P=new x(function(S,R){if(N._cancel){N._logger.log("Import operation canceled");R({type:"create",message:k.ErrorMsg_Folder_Create_Stoped,raw:""});return}var Q;if(O.options.appData.acl.securityContext!=="@BLANK@"){Q=O.options.appData.acl.securityContext}else{Q=O.getParent().options.appData.acl.securityContext}if(Q!==null){if(N._mapSecurityContext[Q]){Q=N._mapSecurityContext[Q]}O.options.appData.acl.securityContext=Q}if(widget.odtWrongCtx||Q===null){O.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];O.updateOptions("icons");R({type:"create",message:k.WarnMsg_SecurityContext_MissMatch,raw:""});return}i.newFolder({parentBookmarkId:O.getParent().options.id,forcedSecurityContext:Q,onComplete:function(U){var X=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ok.png")];if(U){U=JSON.parse(U)}if(U===null||U.result!=="SUCCESS"){O.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];O.updateOptions("icons");var W=!!U&&U.message?U.message:k.ErrorMsg_Folder_Create_Stoped;R({type:"create",message:W,raw:U});return}var T={name:O.options.appData.label,description:O.options.appData.description};if(O.options.appData.acl.owner!=="@BLANK@"){T.owner=O.options.appData.acl.owner}var V=U.id;i.setFolderProperties({pid:V,properties:T,onComplete:function(Z){var Y=Z;O.options.id=V;O.options.icons=X;O.updateOptions("icons");S({type:"create",message:null,raw:Z})},onFailure:function(Z){var Y=function(){O.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];O.updateOptions("icons");R({type:"create",message:k.ErrorMsg_Bookmark_Create_Stoped_SetProperties,raw:Z})};i.deleteFolder({pid:V,forcedSecurityContext:widget.getPreference("pad_security_ctx").value,onComplete:Y,onFailure:Y})}})},onFailure:function(T){O.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];O.updateOptions("icons");R({type:"create",message:k.ErrorMsg_Rest_Error+"("+O.options.label+")",raw:T})}})});return P}},getFolder:function(O){var N=this;return function(){var P=new x(function(R,Q){i.getFolderProperties({pid:O.options.id,onComplete:function(S){if(e.is(S,"string")){S=JSON.parse(S)}var T=new Date(Date.parse(S.modified));if(T.getTime()!==O.options.appData.modified.getTime()){O.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];O.updateOptions("icons");Q({type:"check",message:k.ErrorMsg_Exist_Folder_Modified+"("+O.options.label+")",raw:S})}else{R({type:"check",message:null,raw:S})}},onFailure:function(S){O.options.icons=[C.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")];O.updateOptions("icons");Q({type:"check",message:k.ErrorMsg_Rest_Error+"("+O.options.label+")",raw:S})}})});return P}},_checkOwner:function(O,N,P){var Q=this;var R=false;return new x(function(W,V){var S=N===""?true:P[N];if(S){W(S);return}var T=(P.listeners[N]!==undefined);var U=P.listeners[N]||[];U.push(W);P.listeners[N]=U;if(T){return}i.personSearch({name:N,onComplete:function(X){X=e.is(X,"string")?JSON.parse(X):X;if(X.data.length===1){var Z=X.data[0].dataelements.name;var Y=N===Z;U.forEach(function(aa){aa(Y)});P[N]=Y}else{U.forEach(function(aa){aa(false)});P[N]=false}},onFailure:function(X){R=true;Q._logger.log("response error personSearch ");U.forEach(function(Y){Y(null)})}})})},listSecurityContext:function(){var O=[];var N=widget.getPreference("pad_security_ctx");if(N){var P=N.options;if(Array.isArray(P)){P.forEach(function(Q){if(Q.value){O.push(Q.value.split("::")[1])}})}}return O},mapSecurityContext:function(){var P={};var N=widget.getPreference("pad_security_ctx");if(N){var O=N.options;if(Array.isArray(O)){O.forEach(function(Q){if(Q.value){P[Q.label]=(Q.value.split("::")[1])}})}}return P},_checkSecurityContext:function(N,Q,O){var P=this;return new x(function(T,S){var R=null;if(Q===""||P._mapSecurityContext[Q]){T(true);return}else{R=O.indexOf(Q)!==-1;T(R);return}})},utils:{getCurrentSecurityContext:function(){var N=widget.getPreference("pad_security_ctx").value;if(N.contains("ctx::")){N=N.split("::")[1]}return N},getBrowserLanguage:function(){return c.getLanguage()}}});return H});define("DS/FolderEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderTypeService"],function(g,f,a,c,e,d){var b=f.extend({labelTopBar:c.label_ActionBar_AddToFavorites,isInsert:true,datas:{},init:function(h){this._parent(h,{});var i=this;a.onChange(function(){i._adaptStateToCurrentFolder()});this.onStateChange(function(){if(!i.getState()){var l=a.getCurrentFolder();if(l){var s=l.getID();var n=l.getType();var r=l.options.label;var q=l.isPersonal;if(s&&d.inFamilyFolder(n)){if(g.is(e.getTreeCont())){var j={id:s,name:r,type:n,isPersonal:q};var o=e.getTreeCont().isFolderAmongFavoriteFolders(j);if(o==true){var m=e.getTreeCont().removeFavorite(j);if(false===m){i.setState(true,false)}}}}}i.labelTopBar=c.label_ActionBar_AddToFavorites}else{var l=a.getCurrentFolder();if(l){var s=l.getID();var n=l.getType();var r=l.options.label;var p=l.options.mxid;var q=l.isPersonal;if(s&&d.inFamilyFolder(n)){if(g.is(e.getTreeCont())){var k={id:s,name:r,type:n,isPersonal:q,mxid:p};var o=e.getTreeCont().isFolderAmongFavoriteFolders(k);if(o==false){e.getTreeCont().addFavorite(k)}}}}i.labelTopBar=c.label_ActionBar_RemoveFromFavorites}})},_adaptStateToCurrentFolder:function(){var j=a.getCurrentFolder();if(j&&j.getID){var k=j.getID();var h=j.options.label;if(g.is(e.getTreeCont())){var l={id:k,name:h};var i=e.getTreeCont().isFolderAmongFavoriteFolders(l);var m=false;if(i){m=true}this.setState(m,false)}}},});return b});define("DS/FolderEditor/utils/FolderEditorUtil",["UWA/Utils","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/Folder_CSO","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/AttributesMgt","DS/ZipJS/deflate","DS/ZipJS/inflate"],function(d,e,k,q,n,l,b,r,g,s,p,i,m,o,c,a){var h=null;getStatusPref=function(){if(!h){var t=widget.getValue("view_status");h={};if(t){var u=j.jsonUnzip(t);try{h=JSON.parse(u)}catch(v){h={}}}}return h};saveStatus=function(t,v){var u=getStatusPref();u[t]=v;widget.setValue("view_status",j.jsonZip(JSON.stringify(u)))};getStatus=function(t){var u=getStatusPref();return u[t]};getTreeListSort=function(t){var u=getStatus("treeSort");return u?u:t};var f=function(u){var w=u.toLowerCase();var t=a.getAvailableColumns();var v=null;if(Array.isArray(t)){t.every(function(x){if(w==x.toLowerCase()){v=x}return v===null})}v=v?v:u;return v};var j={nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":","'",";"],maxLength:127},jsonZip:function(z){if(z.length>0&&z[0]!=="{"&&z[0]!=="["){return z}var v=new ArrayBuffer(z.length);var t=new Uint8Array(v);for(var w=0;w<z.length;w++){t[w]=z.charCodeAt(w)}var y=new Deflater();y.append(t);var u=y.flush();var x=String.fromCharCode.apply(null,u);return d.base64Encode(x)},jsonUnzip:function(u){if(u.length>0&&(u[0]==="{"||u[0]==="[")){return u}if(u.length>0&&u.indexOf("root,")===0){return"{}"}var z=u;try{z=d.base64Decode(u)}catch(x){}var w=new ArrayBuffer(z.length);var t=new Uint8Array(w);for(var v=0;v<z.length;v++){t[v]=z.charCodeAt(v)}var y=new Inflater();var A=y.append(t);y.flush();return String.fromCharCode.apply(null,A)},convertToExaleadDataFormatFederated:function(u){var x={};x.children=null;var t=u.attributes;var w={"ds6w:type":"type","ds6w:label":"label"};var v={};t.forEach(function(C){if(C.name=="resourceid"){x.resourceid=C.value}else{if(C.name==="type_icon_url"){x.icons=[C.value]}else{if(C.name==="preview_url"){x.thumbnail=C.value}else{if(C.name.startsWith("ds6w")){var B=C.name.split("/");var A=B[B.length-1];A=A==="ds6wg:plmreference.v_islastversion"?"ds6wg:PLMReference.V_isLastVersion":A;var D=C.object?C.object:C.value;D=D?D:C.dispValue;var y=C.dispValue?C.dispValue:C.value;if(!y){y=D}v[A]=y;v[C.name]=D;var z=w[A];if(z){x[z]=D}}else{if(C.name==="relcount"){if(C.value!=="0"){x.children=[]}}else{if(C.name==="taxonomies"){if(C.value.indexOf("types/DOCUMENTS")===0){x.isDownloadable=true}}else{v[f(C.name)]=C.value}}}}}}});if(!u.id){u.id=x.resourceid}x.isSearchWithinData=true;x.grid=v;x.padgrid={"ds6w:leaf":"False","ds6w:root":"True"};return x},convertToExaleadDataFormat:function(z){if(Array.isArray(z.attributes)){return this.convertToExaleadDataFormatFederated(z)}var y={};y.resourceid=z.id;y.label=z.label;y.type=z.type;y.isDownloadable=z.isDownloadable||(b.isCustomizedEnv()&&q.inFamilyFolder(z.type));if(UWA.is(z.mxid)){y.mxid=z.mxid}if(UWA.is(z.publishOnConnect)){y.publishOnConnect=z.publishOnConnect}var w=z.icon;var v=z.largeicon;var x=(z.thumbnail)?z.thumbnail:null;if(b.isCustomizedEnv()&&q.isRootFolder(z.type)){w=e.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png");v=e.getWebappsAssetUrl("FolderEditor","icons/largefolder_shared.png")}else{if(b.isCustomizedEnv()&&q.isPersonalFolder(z.type)){w=e.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");v=e.getWebappsAssetUrl("FolderEditor","icons/largefolder_perso.png")}}y.icons=[w];y.thumbnail=(x!==null)?x:(v!==null)?v:w;z.revision=q.inFamilyFolder(z.type)?"":z.revision;if(UWA.is(z.description)&&UWA.is(z.description.replace,"function")){z.description=z.description.replace(/\\n/g," ")}y.grid={};y.padgrid={};y.grid["ds6wg:revision"]=z.revision;y.grid["ds6w:identifier"]=z.name;y.grid["ds6w:description"]=z.description?z.description:"";y.grid["ds6w:modified"]=z.modified;y.grid["ds6w:created"]=z.created;y.grid["ds6w:type"]=z.displayType?z.displayType:z.type;y.grid["ds6w:policy"]=z.policy?z.policy:"";y.grid["ds6w:organizationResponsible"]=z.organizationResponsible?z.organizationResponsible:"";y.grid["ds6w:project"]=z.project?z.project:"";y.grid["ds6w:status"]=z.status?z.status:"";for(var u in z){y.grid[u]=z[u]}if(UWA.is(z.locker)){y.grid["ds6w:reservedBy"]=z.locker}if(UWA.is(z.locked)){y.grid["ds6w:reserved"]=z.locked}if(UWA.is(z.isDuplicated)){y.grid.isDuplicated=z.isDuplicated}if(UWA.is(z.isLastMinorRevision)){y.grid.isLastMinorRevision=z.isLastMinorRevision}if(UWA.is(z.isLastVersion)){y.grid["ds6wg:PLMReference.V_isLastVersion"]=z.isLastVersion}if(UWA.is(z.svg)){var t=[{id:z.svg,format:"svg",}];y.grid.derivedOutputs=t}y.padgrid["ds6w:leaf"]="False";y.padgrid["ds6w:root"]="True";y.grid["ds6w:responsible"]=z.responsible;if(UWA.is(z.logicalDeleteBy)){y.grid.logicalDeleteBy=z.logicalDeleteBy}if(UWA.is(z.logicalDeleteStamp)){y.grid.logicalDeleteStamp=z.logicalDeleteStamp}if(UWA.is(y.thumbnail)){y.grid.thumbnail="url("+y.thumbnail+")"}if(UWA.is(z.expandable)&&z.expandable==="TRUE"){y.children=[]}else{y.children=null;y.isNotManagedByPS=true}return y},convertToArray:function(u){var t=[{name:"ds6wg:revision",value:u.grid["ds6wg:revision"]},{name:"ds6w:description",value:u.grid["ds6w:description"]},{name:"ds6w:modified",value:u.grid["ds6w:modified"]},{name:"ds6w:created",value:u.grid["ds6w:created"]},{name:"ds6w:type",value:u.grid["ds6w:type"]},{name:"ds6w:policy",value:u.grid["ds6w:policy"]},{name:"ds6w:organizationResponsible",value:u.grid["ds6w:organizationResponsible"]},{name:"ds6w:project",value:u.grid["ds6w:project"]},{name:"ds6w:reservedby",value:u.grid["ds6w:reservedby"]},{name:"ds6w:reserved",value:u.grid["ds6w:reserved"]},{name:"isDuplicated",value:u.grid.isDuplicated},{name:"isLastMinorRevision",value:u.grid.isLastMinorRevision},{name:"derivedOutputs",value:u.grid.derivedOutputs},{name:"ds6w:leaf",value:u.padgrid["ds6w:leaf"]},{name:"ds6w:root",value:u.padgrid["ds6w:root"]},{name:"ds6w:responsible",value:u.grid["ds6w:responsible"]}];return t},generateJSON:function(v){var u,x,w,t=v.length,y={};for(u=0;u<t;++u){w=v[u];x={label:w.label,created:w.created,icon:w.icon,mxid:w.mxid,folderClassification:w.folderClassification};y[w.id]=x}return y},shouldBeEditable:function(t){return q.inFamilyFolder(this.plmType)},onNodeModelUpdate:function(z){var v=z.data.nodeModel;if(!q.inFamilyFolder(v.plmType)){return}var C=v._lastUpdateTime?v._lastUpdateTime:0;var F=Date.now()-C;v._lastUpdateTime=Date.now();console.log("lastUpdateTime : "+C+", elapsedTime : "+F);if(C!==0&&F<300){return}if(v._resetting){v._resetting=false;return}var A=v.getID();var t=v.options.label;var E=v.options.oldLabel;if(E===undefined){E=""}if(t===E){return}if(t&&t.trim){t=t.trim()}var u=true;if(t.length>j.nameRules.maxLength){var D=t.substring(0,j.nameRules.maxLength);if(t.length>j.nameRules.maxLength){D+="..."}n.displayNotification({message:l.replace(l.get("msg_error_name_maxlength"),{name:D,maxLength:j.nameRules.maxLength}),className:"error"});u=false}if(t.trim().length==0){n.displayNotification({message:l.get("msg_error_name_empty"),className:"error"});u=false}var w=j.nameRules.notAllowedChars;for(var x=0;x<w.length;x++){var y=w[x];if(t.indexOf(y)!=-1){n.displayNotification({message:l.replace(l.get("msg_error_name_badchars"),{name:t,badChars:j.nameRules.notAllowedChars.join(", ")}),className:"error"});u=false;break}}if(!u){setTimeout(function(){v.withTransactionUpdate(function(){this.setLabel(E)})})}else{if(v.isFavorite){if(UWA.is(b.getTreeCont())){var B={id:A,name:E};b.getTreeCont().renameFavorite(B,t,v)}}else{k.setFolderProperties({pid:A,properties:{name:t},onComplete:function(){v.options.oldLabel=t;r.notifyFolderRename([v]);n.displayNotification({message:l.replace(l.get("msg_info_rename"),{name1:E,name2:t}),className:"primary"})},onFailure:function(G){n.displayNotification({message:l.replace(l.get("msg_error_rename"),{name1:E}),className:"error"});v._resetting=true;setTimeout(function(){v.withTransactionUpdate(function(){this.setLabel(E)});v._resetting=false})}})}}},checkMoveOrCopyAcrossSharedAndPersonal:function(x,y,t){if(!x||!y){return true}var w=0;var A="shared";if(x.isPersonal){w++;A="personal"}if(y.isPersonal){w++}if(w==1){var z=l.get("Move_label");if(t){z=l.get("Copy_label")}var u="";var v="";if(A=="personal"){u=l.get("Personal_label");v=l.get("Shared_label")}else{u=l.get("Shared_label");v=l.get("Personal_label")}n.displayNotification({message:l.replace(l.get("msg_error_MoveOrCopyAcrossSharedAndPersonal"),{move_copy:z,personal_shared:u,shared_personal:v}),className:"error"});return false}return true},getTenant:function(){var u=m.getPlatformId();var v=null;if(u){try{var w=m.getTenantsPreference();w.every(function(x){if(x.value===u){v=x}return v===null})}catch(t){v=null}if(v===null){v={label:u,value:u}}}return v},getCurrentSecurityContextAndFolderData:function(x){var u=s.getCurrentFolder();var t=i.getSetting("pad_security_ctx");var w=this.getTenant();var v=r.createBookmarkForPublication(u,x);v.Tenant=w;v.SecurityContext=t;return v},dipatchSecurityContextAndFolder:function(){var v={current:null,active:null};var u=this.getCurrentSecurityContextAndFolderData();v.current=u;var t=JSON.stringify(u);g.publish("FolderEditor.CurrentFolder",t);var w=false;p.getEnforceFolderLinkSettingAsync(function(z,y){if(!z){w=y}});if(w||b.isCustomizedEnv()||b.isActiveBookmarkActivated()){var x=b.getActiveFolder();v.active={origin:widget.id,id:x.id!=="!"?x.id:null,label:x.label,sc:x.sc};g.publish("FolderEditor.ActiveFolder",v.active)}g.publish("FolderEditor.Bookmark",v)},_sortTreeColumn:function(w,u){var v=q.inFamilyFolder(w.plmType);var t=q.inFamilyFolder(u.plmType);if(v&&!t){if(this.sortOrder==="asc"){return -1}else{return 1}}else{if(!v&&t){if(this.sortOrder==="asc"){return 1}else{return -1}}else{return j.compareLabels(w.options.label,u.options.label)}}},sortingNodes:function(u){var t=this;if(u.columns){u.columns.forEach(function(w){var v=w.dataIndex;if(v==="tree"){w.sortFunction=t._sortTreeColumn}else{if(v==="ds6w:created"||v==="ds6w:modified"||v==="logicalDeleteStamp"||(w.xnav_options&&w.xnav_options.kind==="date")){w.sortFunction=function(C,A){var x;var B=q.inFamilyFolder(C.plmType);var z=q.inFamilyFolder(A.plmType);if(B&&!z){if(this.sortOrder==="asc"){return -1}else{return 1}}else{if(!B&&z){if(this.sortOrder==="asc"){return 1}else{return -1}}else{try{x=new Date(C.options.grid[v])>new Date(A.options.grid[v])?1:(new Date(C.options.grid[v])<new Date(A.options.grid[v]))?-1:0}catch(y){x=C.options.grid[v]<A.options.grid[v]?-1:1}finally{return x}}}}}else{w.sortFunction=function(D,B){var x;var C=q.inFamilyFolder(D.plmType);var A=q.inFamilyFolder(B.plmType);if(C&&!A){if(this.sortOrder==="asc"){return -1}else{return 1}}else{if(!C&&A){if(this.sortOrder==="asc"){return 1}else{return -1}}else{var z=D.options.grid[v]?D.options.grid[v]:"";var y=B.options.grid[v]?B.options.grid[v]:"";return j.compareLabels(z,y)}}}}}})}return u},downloadFcs:function(t){if(UWA.is(t,"string")){var u=d.parseUrl(t);var x=d.parseQuery(u.query);x.__fcs__attachment=true;delete u.query;var w=d.composeUrl(u);var v=document.createElement("form");v.style.display="none";v.method="POST";v.action=w;Object.keys(x).map(function(z){var y=document.createElement("input");y.setAttribute("name",z);y.setAttribute("value",x[z]);v.appendChild(y)});document.body.appendChild(v);v.submit();document.body.removeChild(v)}},downloadForTouchDevices:function(u){if(UWA.is(u,"string")){u=u+"&__fcs__attachment=true";var t=b.getContent();var v=UWA.createElement("a",{href:u,styles:{display:"hidden"}}).inject(t.elements.container);v.click()}},isTouchDevice:function(){if("ontouchstart" in document.documentElement){return true}else{return false}},compareLabels:function(u,t){if(!u){u=""}if(!t){t=""}return o.compareValue(t,u)},getDefaultView:function(){var t=getStatus("default_view");return t?t:"treelistview"},getTreeListSortColumn:function(){var t=getTreeListSort();return t?t.id:null},getTreeListSortParam:function(){var t=getTreeListSort();return t?t.param:null},setDefaultView:function(t){saveStatus("default_view",t)},setTreeListSortColumn:function(t){var u=getTreeListSort({});u.id=t;saveStatus("treeSort",u)},setTreeListSortParam:function(t){var u=getTreeListSort({});u.param=t;saveStatus("treeSort",u)}};return j});define("DS/FolderEditor/service/FolderServices",["DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderEditorWebService","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/DocumentManagement/DocumentManagement","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/utils/FolderEditorcontrol"],function(b,c,f,g,h,i,a,e){var d={AddContent:function(k){if(!UWA.is(k.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(k.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(k.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var n=k.IDs.length;if(n>0){var j=k.folder;var l;if(j){l=j}else{l=b.getCurrentFolder()}var m=l?l.id||l.getID():"";if(m&&m.length){c.addcontent({pid:m,IDs:k.IDs,onComplete:function(p){var q=p?JSON.parse(p):undefined;if(q&&q.error){var o=q.error;console.log("AddContent WebService Err : "+o);if(o.length>200){o=null}if(q.information){a.displayNotification({message:q.information,className:"primary"})}k.callbacks.onFailure(o)}else{k.callbacks.onComplete(p)}},onFailure:k.callbacks.onFailure})}else{k.callbacks.onFailure(k)}}else{k.callbacks.onFailure(k)}},RemoveContent:function(k){if(!UWA.is(k.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(k.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(k.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var n=k.IDs.length;if(n>0){var j=k.folder;var l;if(j){l=j}else{l=b.getCurrentFolder()}var m=l?l.id||l.getID():"";if(m&&m.length){c.removecontent({pid:m,IDs:k.IDs,onComplete:function(p){var q=p?JSON.parse(p):undefined;if(q&&q.error){var o=q.error;console.log("Remove WebService Err : "+o);if(o.length>200){o=null}k.callbacks.onFailure(o)}else{k.callbacks.onComplete(p)}},onFailure:k.callbacks.onFailure})}else{k.callbacks.onFailure(k)}}else{k.callbacks.onFailure(k)}},MoveContent:function(l){if(!UWA.is(l.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(l.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(l.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var o=l.IDs.length;if(o>0){var n=l.targetfolder;var k=l.sourcefolder;var m;if(k){m=k}else{m=b.getCurrentFolder()}var j=n?n.id||n.getID():"";var p=m?m.id||n.getID():"";if(j&&j.length&&p&&p.length){c.movecontent({pid:j,IDs:l.IDs,SourceFolderId:p,onComplete:function(r){var s=r?JSON.parse(r):undefined;if(s&&s.error){var q=s.error;console.log("MoveContent WebService Err : "+q);if(q.length>200){q=null}l.callbacks.onFailure(q)}else{l.callbacks.onComplete(r)}},onFailure:l.callbacks.onFailure})}else{l.callbacks.onFailure(l)}}else{l.callbacks.onFailure(l)}},MoveFolder:function(k){if(!UWA.is(k.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(k.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(k.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var m=k.targetfolder;var l=k.sourcefolder;var j=m?m.id:"";var n=l?l.id:"";if(j.length&&k.IDs.length){c.movefolder({PhysicalId:k.IDs,TargetPhysicalId:j,onComplete:function(p){var q=p?JSON.parse(p):undefined;if(q&&q.error){var o=q.error;console.log("MoveFolder WebService Err : "+o);if(o.length>200){o=null}k.callbacks.onFailure(o)}else{k.callbacks.onComplete(p)}},onFailure:k.callbacks.onFailure})}else{k.callbacks.onFailure(k)}},CopyFolder:function(k){if(!UWA.is(k.callbacks,"object")){throw new Error("No callbacks function defined")}if(!UWA.is(k.callbacks.onComplete,"function")){throw new Error("No onComplete callback function defined")}if(!UWA.is(k.callbacks.onFailure,"function")){throw new Error("No onFailure callback function defined")}var m=k.targetfolder;var l=k.sourcefolder;var j=m?m.id:"";var o=l?l.id:"";var n=g.getSetting("pad_security_ctx");if(j.length&&k.IDs.length){c.copyfolder({PhysicalId:k.IDs,TargetPhysicalId:j,SecurityContext:n,onComplete:function(q){var r=q?JSON.parse(q):undefined;if(r&&r.error){var p=r.error;console.log("CopyFolder WebService Err : "+p);if(p.length>200){p=null}k.callbacks.onFailure(p)}else{k.callbacks.onComplete(q)}},onFailure:k.callbacks.onFailure})}else{k.callbacks.onFailure(k)}},uploadFiles:function(w){var s=this,k,p,q;var o=w.callbacks.onComplete;var m=w.callbacks.onFailure;var j="";var u=g.getSetting("pad_security_ctx");var t=u.split(".");j=t[(t.length)-1];var l={tenant:f.getPlatformId(),securityContext:g.getSetting("pad_security_ctx"),tenantUrl:f.get3DSpaceUrl(),onComplete:w.callbacks.onComplete,onFailure:w.callbacks.onFailure};var r={file:w.file};if(w.file.name){r.fileName=w.file.name}var n={tempId:w.tempId,fileInfo:r,relInfo:{parentId:w.FolderTreeNode.id,parentRelName:"Vaulted Objects",parentDirection:"from"}};var m=l.onFailure;l.onFailure=function(x){m(x,w)};var o=l.onComplete;l.onComplete=function(x){o(x,w)};var v=h.createDocument(n,l);return v},downloadFiles:function(t){var q=this,k,o,p,n;var n=t.callbacks.onComplete;var m=t.callbacks.onFailure;var j="";var s=g.getSetting("pad_security_ctx");var r=s.split(".");j=r[(r.length)-1];var l={tenant:f.getPlatformId(),securityContext:g.getSetting("pad_security_ctx"),tenantUrl:f.get3DSpaceUrl()};var m=t.callbacks.onFailure;l.onFailure=function(u){m(u,t)};var n=t.callbacks.onComplete;l.onComplete=function(u){n(u,t)};return h.downloadDocument(t.ID,null,t.CheckOut?t.CheckOut:false,l)},checkinFile:function(r){var n=r.callbacks.onComplete;var l=r.callbacks.onFailure;var j="";var q=g.getSetting("pad_security_ctx");var p=q.split(".");j=p[(p.length)-1];var k={tenant:f.getPlatformId(),securityContext:g.getSetting("pad_security_ctx"),tenantUrl:f.get3DSpaceUrl()};var l=r.callbacks.onFailure;k.onFailure=function(s){l(s,r)};var n=r.callbacks.onComplete;k.onComplete=function(s){n(s,r)};var o={comments:r.comments,file:r.file};if(r.file.name){o.fileName=r.file.name}var m={id:r.node[0].id,fileInfo:o};h.modifyDocument(m,k)},activateFolderEditorItem:function(j,k,m){if(i.isFolder(k)){k="Folder"}else{if(i.isRootFolder(k)||i.isPersonalFolder(k)){k="RootFolder"}}if(j&&i.inFamilyFolder(k)){var l=e.getTreeCont();if(l){l.expandTreeAndSelectFolder({folderToFindAndSelect:{id:j,type:k,name:m},onComplete:function(n){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(n){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(n){a.displayNotification({message:Nls.replace(Nls.get("msg_error_FolderActivate"),{name1:m}),className:"error"})}})}}else{console.log("Selected (Double Clicked) object is not folder")}}};return d});define("DS/FolderEditor/views/FolderTileView",["DS/ENXNav/views/xNavResponsiveTilesView","DS/FolderEditor/service/FolderServices"],function(a,c){var b=a.extend({init:function(d){this._parent(d);if(UWA.is(this.options.grid.onCellDoubleClick,"function")){this.options.grid.onCellDoubleClick(function(f){var e=f.nodeModel;c.activateFolderEditorItem(e.options.resourceid,e.options.type,e.options.label)})}}});return b});define("DS/FolderEditor/views/FolderThumbnailView",["DS/ENXNav/views/xNavResponsiveThumbnailsView","DS/FolderEditor/service/FolderServices"],function(c,b){var a=c.extend({init:function(d){this._parent(d);if(UWA.is(this.options.grid.onCellDoubleClick,"function")){this.options.grid.onCellDoubleClick(function(f){var e=f.nodeModel;b.activateFolderEditorItem(e.options.resourceid,e.options.type,e.options.label)})}}});return a});define("DS/FolderEditor/FolderTreeGraphView",["DS/ENXNav/views/xNavGraphView","DS/FolderEditor/service/FolderServices"],function(c,b){var a=c.extend({init:function(d){if(!UWA.is(d.doubleClickCallback)){d.doubleClickCallback=function(f){var e=f.data;b.activateFolderEditorItem(e.options.resourceid,e.options.type,e.options.label)}}this._parent(d)}});return a});define("DS/FolderEditor/FolderTreeListView",["DS/Logger/Logger","UWA/Class/Listener","DS/ENXNav/views/xNavTreeListView","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderServices","DS/WidgetServices/WidgetServices","DS/Tree/TreeNodeView","DS/FolderEditor/utils/FolderSearch"],function(b,m,k,c,l,d,h,a,j,f,n,i,e){var g=k.extend(m,{name:"FolderTreeListView",padtreelst_def_file:{module:"FolderEditor",asset:"padtreelst_def.json"},init:function(p){var q=this;p.apiVersion=2;p.infiniteScrolling=true;p.not_attr_column=[];var o={};o={0:"bi_color",end:"thumbnail"};p.specific_columns=o;p.allowUnsafeHTMLContent=false;p.isEditable=true;p.cellClass=i.extend({init:function(r){this._parent(r)},updateInternalParameters:function(){this._parent();var r=this.getCellInfos();if(!r.isHeader){if(r.nodeModel&&r.nodeModel.options.isBeingCut){r.cellView.getContent().addClassName("pad-state-is-being-cut")}else{r.cellView.getContent().removeClassName("pad-state-is-being-cut")}}}});this._logger=b.getLogger(g);this._logger.log("init");this.listenTo(this,"onComplete",function(){var t=q.getManager();t.onInfiniteScrollAsync(function(){var v=e.getNumberLastResult();if(e.getSearchValue()&&v>0){var w=c.getContent();w.loadContentAndSelect()}else{t.infiniteScrollAsyncProcessDone()}});t.onEndResizeOrOnReadyModelRequestAsync(function(v){e.setNumberResults(v.RowMaxNumber+5);t.EndResizeOrOnReadyModelRequestAsyncDone()});t.folder_currentSortFonction=t.sortColumnContent;t.sortColumnContent=function(v,A){var x=v;if(typeof v!=="string"){x=t.getDataIndexFromColumnID(v)}if(x==="tree"){x="ds6w:label"}var y=e.changeSortField(x,A?false:true);if(!y){var z=null;if(A){e.changeOrderSort(A.sortOrder,true)}}if(e.isSearchInProgress()){if(y){a.displayNotification(y)}else{z={};for(var w in A){z[w]=A[w]}z.sortFunction=function(){return 0};arguments[1]=z;t.folder_currentSortFonction.apply(t,arguments)}}else{l.setTreeListSortParam(A);l.setTreeListSortColumn(v);t.folder_currentSortFonction.apply(t,arguments)}};var r=t.getNumberOfColumns();for(var s=0;s<r;s++){var u=t.getColumnOptions(s);if(u&&u.dataIndex!=="tree"){t.setColumnOptions(s,{isEditable:false})}}q.onNodeDblClick(function(z){var y=z.nodeModel;var x=y.options.resourceid;var v=y.options.label;var w=y.options.type;f.activateFolderEditorItem(x,w,v)})});p.selection={enableListSelection:true,toggle:n.isTouchDevice()};this._parent(p)},buildTreeListOpts:function(p,q){this._parent(p,function(s){if(s.columns){for(var t=(s.columns.length-1);t>=0;t--){var r=(s.columns[t]).dataIndex;if((r==="ds6w:cadMaster")||(r==="ds6w:xcadFileName")||(r==="ds6wg:EnterpriseExtension.V_PartNumber")||(widget.getValue("activeIsLastVersionColumn")===false&&r==="ds6wg:PLMReference.V_isLastVersion")){s.columns.splice(t,1)}}}q.apply(this,arguments)});var o=p.view_customization&&p.view_customization;o&&c._TreeCont&&c._TreeCont.modeChange(o)},provideDisplayTooltip:function(p){var o="";if(p){if(!p.isHeader&&p.dataIndex==="tree"){o=p.nodeModel.options.display||p.nodeModel.options.label;return{longHelp:o}}else{return this._parent(p)}}},compactMode:function(o){c._TreeCont.modeChange(o);this._parent(o)},_enrichViews:function(o){o=this._parent(o);return l.sortingNodes(o)}});return g});define("DS/FolderEditor/commands/FolderCommands",["UWA/Core","UWA/Utils","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/utils/FolderConfirmation","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/popup/AddCommentPopup","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/service/FolderEditorWebService","DS/PADServices/utils/AttributesMgt","DS/FolderEditor/utils/FolderSearch","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/WidgetServices","DS/PADUtils/PADSettingsMgt"],function(b,e,n,w,x,m,l,t,y,d,g,c,q,p,u,j,i,k,a,r,s,o,h){function f(B,z,A){console.error(B,A);var C=z;if(UWA.is(A)&&!(A instanceof Error)){C+="<br>"+A}n.displayNotification({message:C,className:"error"})}var v={_endProgressBarListener:function(){var z=this;d.getContent().addEvent("onCompleteRefreshNodes",function(A){this.removeEvent("onCompleteRefreshNodes");z._offProgressBar()})},_offProgressBar:function(){if(i._counter===0){return null}i.off()},_startProgressBar:function(z){if(i._counter===1){i.off()}i.on(z)},_nbItemsNotNull:function(C){var B,z=C.length,A=0;for(B=0;B<z;++B){if(C){A++}}return A},_activeCuttingNodes:false,_setStateCuttingNodes:function(C){var A=0,z=C.length,B;if(this._activeCuttingNodes){this._setStaUncuttingNodes()}if(z===0){return null}for(A=0;A<z;++A){B=C[A];B.updateOptions({isBeingCut:true})}this._activeCuttingNodes=true},_setStaUncuttingNodes:function(){var B=0,A,z,C;if(this._activeCuttingNodes){A=q.getSelectedNodes();z=A.length;if(z===0){return null}for(B=0;B<z;++B){C=A[B];if(C.options.isBeingCut){C.updateOptions({isBeingCut:false})}}this._activeCuttingNodes=false}},escapCmd:function(){if(this._activeCuttingNodes){this._setStaUncuttingNodes();q.ClearClipboard()}},RenameCmd:function(D,B){var C=D.virtualRowID;var A=D.manager.getCell(C,"tree");var z=A.getView();z.switchToWriteView()},CopyCmd:function(C,D){var z=[];z=x.getSelectedNodes();var B=x.getCurrentFolder();var A=B.plmType;this._setStaUncuttingNodes();q.addInFolderClipboard(z,B,"COPY")},CutCmd:function(C,D){var z=[];z=x.getSelectedNodes();var B=x.getCurrentFolder();var A=B.plmType;var E;if(z.length===1&&z[0].getID()===B.getID()){E=d.getTreeCont()._folders_TreeView}else{if(z.length>0){E=d.getContent().getPADTreeListView()}}this._setStateCuttingNodes(z);E.getManager()._lostFocus();q.addInFolderClipboard(z,B,"CUT")},PasteCmd:function(Q,E){var L=this;var F=x.getCurrentFolder();var D=q.getTreeNode();var A=q.getSelectedNodes();var B=q.getMode();var P=(Q&&t.inFamilyFolder(Q.plmType))?Q:null;if(!P){P=x.getCurrentFolder()}function G(W,V,Y,T){if(Y.id===V.id){if(UWA.is(T,"array")){for(var U=0;U<T.length;U++){if(W!=="CUT"){var R=d.getContent().getPADTreeDocument();var Z=R.searchRootById(T[U].getID());if(UWA.is(Z)){return false}}else{if(T[U].plmType){return false}}}}}else{if(W==="CUT"&&!t.isRootFolder(V.getType())){var S=(UWA.is(T,"array")&&T.length===1&&T[0]===V);if(S){var X=V.getParent();if(X&&X.id===Y.id){return false}}}}return true}if(!A){return}this._startProgressBar(m.Paste_content_loading);this._setStaUncuttingNodes();if(t.inFamilyFolder(P.plmType)){for(var N=0;N<A.length;N++){if(t.inFamilyFolder(A[N].plmType)){if(j.checkMoveOrCopyAcrossSharedAndPersonal(A[N],P,B=="COPY")===false){this._offProgressBar();return}}}}var O=P.getParent();var I=[];var K=[];var M=[];var H=[];var C=A.length;if(C>0){A.forEach(function(R){I.push(UWA.is(R.id)?R.id:R.options.resourceid);if(t.isFolder(R.plmType)){K.push(UWA.is(R.id)?R.id:R.options.resourceid);M.push(R)}else{if(!t.isRootFolder(R.plmType)){H.push(UWA.is(R.id)?R.id:R.options.resourceid)}}})}else{I.push(A);if(node.plmType=="Folder"){K.push(A.id);M.push(A)}else{if(!t.isRootFolder(node.plmType)){H.push(A.id)}}}var J=K.length;var z=H.length;if(!P){this._offProgressBar();n.displayNotification({message:m.msg_warning_nocurrentfolder,className:"warning"})}else{if(B=="CUT"){if(K.length>0){if(!G(B,D,P,A)){this._offProgressBar();n.displayNotification({message:m.msg_error_MoveInSamefolder,className:"error"})}else{l.MoveFolder({IDs:K,targetfolder:P,callbacks:{onComplete:function(U){L._endProgressBarListener();d.getContent().loadContentAndSelect(F);n.displayNotification({message:m.replace(m.msg_info_foldermoved,{number:J,foldername:P.options.label}),className:"primary"});for(var T=0;T<M.length;T++){var W=null;var V=M[T];var R=V.getParent();if(R===null){var S=d.getTreeCont();W=S._getVisibleNodeById(V.id,null);if(W===null){W=V;R=D}else{R=W.getParent()}}else{W=V}d.getTreeCont().removeFromTree(W)}if(P!==null){if(UWA.is(d.getTreeCont())){d.getTreeCont().updateTreeWithNewFolder(P)}}q.ClearClipboard()},onFailure:function(R){L._offProgressBar();f("PasteCmd",m.msg_error_MoveFolder,R)}}})}}if(H.length>0){if(!G(B,D,P,A)){this._offProgressBar();n.displayNotification({message:m.msg_error_MoveInSamefolder,className:"error"})}else{l.MoveContent({IDs:H,targetfolder:P,sourcefolder:D,callbacks:{onComplete:function(R){L._endProgressBarListener();d.getContent().loadContentAndSelect(F,I[C-1]);n.displayNotification({message:z+" "+m.msg_info_objetmoved+" "+P.options.label,className:"primary"});q.ClearClipboard()},onFailure:function(R){L._offProgressBar();f("PasteCmd",m.msg_error_MoveInfolder,R)}}})}}}else{if(B=="COPY"){if(K.length>0){l.CopyFolder({IDs:K,targetfolder:P,callbacks:{onComplete:function(R){L._endProgressBarListener();d.getContent().loadContentAndSelect(F);n.displayNotification({message:m.replace(m.msg_info_foldercopied,{number:J,foldername:P.options.label}),className:"primary"});if(F!==null&&F.isExpanded()){if(UWA.is(d.getTreeCont())){d.getTreeCont().updateTreeWithNewFolder(F)}}},onFailure:function(R){L._offProgressBar();f("PasteCmd",m.msg_error_CopyFolder,R)}}})}if(H.length>0){if(!G(B,D,P,A)){this._offProgressBar();n.displayNotification({message:m.msg_error_MoveInSamefolder,className:"error"})}else{l.AddContent({IDs:H,folder:P,callbacks:{onComplete:function(S){L._endProgressBarListener();d.getContent().loadContentAndSelect(P,I[C-1]);var R="";if(S){var T=JSON.parse(S);z=T.added?T.added.length:z;R=T.information?" ("+T.information+")":R}n.displayNotification({message:m.replace(m.msg_info_Addinfolder,{number:z,foldername:P.options.label})+R,className:"primary"})},onFailure:function(R){L._offProgressBar();f("PasteCmd",m.msg_error_Addinfolder,R)}}})}}}}}},RemoveContentCmd:function(z,A){var B=this;var C=x.getCurrentFolder();if(!C){n.displayNotification({message:m.msg_warning_nocurrentfolder,className:"warning"})}else{w.launch({title:m.confirmation_remove_title,content:m.confirmation_remove_message,},function(){var G=C.getType();var E=x.getSelectedNodes();var I=E.length;if(I>0){B._startProgressBar(m.Remove_content_loading);var F=c.getCommand("RemoveContent",d.getContent());F.disable();var D=[];var H=null;E.forEach(function(J){if(H===null){if(J._expandState!=="noExpandState"&&widget.getBool("filtered-content")===true){H=true}}if(UWA.is(J.id)){if(D.indexOf(J.id)===-1){D.push(J.id)}}else{if(D.indexOf(J.options.resourceid)===-1){D.push(J.options.resourceid)}}});l.RemoveContent({IDs:D,callbacks:{onComplete:function(K){if(H||D.length>10){d.getContent().RefreshProductStructure=true;d.getContent().loadContentAndSelect(C)}else{for(var J=0;J<D.length;J++){var L=D[J];d.getContent().removeNodeInContent(L)}}B._offProgressBar();n.displayNotification({message:m.replace(m.msg_info_objetremoved,{number:D.length,foldername:C.options.label}),className:"primary"})},onFailure:function(J){B._offProgressBar();F.enable();f("RemoveContentCmd",m.msg_error_Removefromfolder,J)}}})}else{n.displayNotification({message:m.msg_warning_nocontent,className:"warning"})}})}},ExpandAllCmd:function(C,D){var B=C.plmType;var z=[];if(D==="TREE"&&C){z.push(C)}else{z=x.getSelectedNodes()}var A=null;A=x.getCurrentFolder();if(z.length){z.forEach(function(E){if(E.options.children===null){}else{if(D==="TREE"||E.plmType==="Folder"||E.plmType==="FolderSection_AllFolders"){E.expand({expandLevel:"All"})}else{E.expandAll()}}})}else{if(A===null){n.displayNotification({message:m.msg_warning_nocurrentfolder,className:"warning"})}else{A.expandAll()}}},CollapseAllCmd:function(C,D){var B=C.plmType;var z=[];var A=x.getCurrentFolder();if(D==="TREE"&&C){z.push(C)}else{z=x.getSelectedNodes()}if(z.length){z.forEach(function(E){E.collapseAll()})}else{if(A===null){n.displayNotification({message:m.msg_warning_noselection,className:"warning"})}else{A.collapseAll()}}},AccessRightCmd:function(z,A){var B=c.getCommand("ActionBar_AccessRightCmd",d.getContent());if(B){B.begin()}},EditPropertiesCmd:function(z,A){var B=c.getCommand("ActionBar_Attributes",d.getContent());if(B){B.begin()}},OpenWithCV5Cmd:function(){var z=x.getSelectedNodes();require(["DS/PADUtils/PADDataTransform","DS/PADUtils/PADUtilsServices","DS/i3DXCompassServices/i3DXCompassPubSub"],function(D,F,A){if(z.length===1&&z[0].isRoot()&&!(UWA.is(z[0].options.config_filter)||UWA.is(z[0].options.sequence_filter))){var C={objectId:z[0].getID(),envId:F.getPlatformId(),serviceId:"3DSpace",contextId:h.getSetting("pad_security_ctx")};A.publish("setObject",C);var E={appId:"MAP-CATCDVEAP",widgetId:F.getWidgetId()};A.publish("launchApp",E)}else{var B=d.getContent().getPADTreeDocument();D.buildDataForSetTypes(z,B,function(G,I){var J=JSON.stringify(I);var H={appId:"MAP-CATCDVEAP",widgetId:F.getWidgetId(),fileName:"-file",fileContent:J};A.publish("launchApp",H)},true)}})},OpenInCADCmd:function(A,B){var z=this.getOpenInCADCmd();if(z){z.begin()}},getOpenInCADCmd:function(){return c.getCommand("OpenInCADHdr",d.getContent())},DeleteCmd:function(z,A){var B=c.getCommand("DeleteHdr",d.getContent());if(B){B.begin()}},AddNewFileCmd:function(z,A){var B=c.getCommand("AddFile",d.getContent());if(B){B.begin()}},AddExistingCmd:function(z,A){var B=c.getCommand("AddExistingContent",d.getContent());if(B){B.begin()}},RemoveFavoriteCmd:function(C,E){var B=C;console.log("  RemoveFavoriteCmd currentFavoriteTreeNode : ",B);if(B&&B.isFavorite){var z=B.getID();var D=B.options.label;var F=B.getType();console.log("  currentFolder Name : ",D,", Id : ",z);if(z){if(UWA.is(d.getTreeCont())){var A={id:z,name:D,type:F};d.getTreeCont().removeFavorite(A)}}}},uploadFileCmd:function(B,C){if(B.length>0){var H=B.length;var z=this._nbItemsNotNull(B);var E=UWA.is(C)?C:x.getCurrentFolder();var A=0;var J;var K=[];var G=this;var L=x.getCurrentFolder().getLabel()+" - "+m.upload+" ";this._startProgressBar(L+"0/"+H);for(var F=0;F<H;F++){var D=B[F];if(D){if(!UWA.is(C)){J=e.getUUID();var I={tempId:J,label:D.name};K.push(I)}l.uploadFiles({file:D,tempId:J,FolderTreeNode:E,callbacks:{onComplete:function(N,P){if(!UWA.is(C)){var O=d.getContent().getPADTreeDocument();var R=O.searchRootById(P.tempId);var Q=N.data[0];if(Q){Q.isDownloadable=true}d.getContent().updateRootNode(N.data[0],P.tempId);if(R){var M=N.data[0].id;k.getContentProperties({pid:M,onComplete:function(S){if(UWA.is(S,"string")){S=JSON.parse(S)}var T=j.convertToExaleadDataFormat(S);O.wrapInTransaction(function(){R.updateOptions(T)})},onFailure:function(){console.error("Unable to update Document node, Error in getting content Properties")}})}}u.notifyFolderLoadingEnd(P.FolderTreeNode);++A;i.setText(L+A+"/"+H);if(A===z){G._offProgressBar()}n.displayNotification({message:m.replace(m.get("msg_info_objetadded"),{filename:P.file.name,foldername:P.FolderTreeNode.options.label}),className:"primary"})},onFailure:function(M,N){d.getContent().removeNodeInContent(N.tempId);u.notifyFolderLoadingEnd(N.FolderTreeNode);++A;i.setText(L+A+"/"+H);if(A===z){G._offProgressBar()}var O=M.error;if(O){O=N.file.name+" - "+O}else{O=m.replace(m.get("msg_error_FileUpload"),{filename:N.file.name,foldername:N.FolderTreeNode.options.label})}n.displayNotification({message:O,className:"error"})}}})}}d.getContent().addDummyRootNodes(K)}else{console.log("No file!")}},DownloadFileCmd:function(B,D){var z=x.getSelectedNodes();var A=j.isTouchDevice();var F=this;if(z.length===0){n.displayNotification({message:m.msg_warning_nocontent,className:"warning"})}else{var G=z[0].getType();var C=z[0].options.type;if(z.length===1){if(!A&&d.isCustomizedEnv()&&C!=="Document"&&C!=="CATAnalysisResults"&&C!=="CATIA Design Table"&&C!=="CATIA CGR"&&C!=="CATAnalysisComputations"){require(["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol"],function(H,I){H.getCommand("BulkDownload",I.getContent()).begin()})}else{var E=z[0].getID();l.downloadFiles({ID:E,callbacks:{onComplete:function(H){if(!A){j.downloadFcs(H)}else{j.downloadForTouchDevices(H)}},onFailure:function(H){n.displayNotification({message:m.msg_error_FileDownload+" "+H.data[0].updateMessage,className:"error"})}}})}}else{if(!A&&d.isCustomizedEnv()){require(["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol"],function(H,I){H.getCommand("BulkDownload",I.getContent()).begin()})}else{n.displayNotification({message:m.msg_warning_MultipleSelection,className:"warning"})}}}},ActiveFolderCmd:function(A,B){var z=c.getCommand("ActiveFolder",d.getContent());if(z){z.begin()}},NewFolderCmd:function(A,B){if(d.getTreeCont()&&!A.isFavorite){d.getTreeCont().NodeToExpandAfterNewFolder=true}var z=c.getCommand("ActionBar_NewFolderCmd",d.getContent());if(z){z.begin()}},_objects_selected_searchInFolder:function(z){console.log("oki")},SearchInFolderCmd:function(z){var A=this;require(["DS/PADUtils/views/PADModalChooser"],function(C){var G=x.getCurrentFolder();var D=[];if(G){if(G.isRoot()){var F=G.getChildren();if(F){F.forEach(function(J){D.push(J.options.mxid)})}}else{D.push(G.options.mxid)}}var B="";var E="";if(D){B+="(";D.forEach(function(J){B+=E+'flattenedtaxonomies:"workspaces/'+J+'"';E=" OR "});B+=")";var I={position:"above_action_bar",renderTo:document.body,in_apps_search:{mode:"",precond:B,in_apps_callback:A._objects_selected_searchInFolder.bind(A)}};var H=z?z:"*Doc*";k.searchInFolder({pattern:H+" "+B,onComplete:function(J){console.log(JSON.stringify(J))},onFailure:function(){console.log("failed")}})}else{n.displayNotification({message:UWA.i18n("NoFolderSelected"),className:"error"})}})},GetContextualMenu:function(A,C){var K=this;var Y=[];var ac;var W=A.white_Click?A.white_Click:false;ac=W===true?ac=x.getCurrentFolder():A.nodeModel;if(ac===undefined){ac=A}var G=ac.plmType;var aa=ac.isFavorite;var S={label:m.CMDInsertNewFolder,icon:"url("+g.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_PLMNewFolderWV.png")+")",callback:function(){K.NewFolderCmd(ac,C)}};var Q={label:m.CMDRename,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_RenameFolder.png")+")",callback:function(){K.RenameCmd(A,C)},searchAvailability:true};var ae={label:m.CMDCopy,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_Copy.png")+")",callback:function(){K.CopyCmd(ac,C)},searchAvailability:true};var N={label:m.CMDCut,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_Cut.png")+")",callback:function(){K.CutCmd(ac,C)}};var X={label:m.CMDPaste,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_Paste.png")+")",callback:function(){K.PasteCmd(ac,C)}};var U={label:m.CMDAccessRightCmd,icon:"url("+g.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_AppPrjUI.png")+")",callback:function(){K.AccessRightCmd(ac,C)},searchAvailability:true};var J={label:m.CMDProperties,icon:"url("+g.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",callback:function(){K.EditPropertiesCmd(ac,C)},searchAvailability:true};var ad={label:m.CMDExpandAll,icon:"url("+g.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",callback:function(){K.ExpandAllCmd(ac,C)},searchAvailability:true};var M={label:m.CMDCollapseAll,icon:"url("+g.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",callback:function(){K.CollapseAllCmd(ac,C)},searchAvailability:true};var I={label:m.CMDDelete,icon:"url("+g.getWebappsAssetUrl("LifecycleWidget","icons/32/I_PLMDelete.png")+")",callback:function(){K.DeleteCmd(ac,C)},searchAvailability:true};var P={label:m.CMDRemove,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_RemoveFavorite.png")+")",callback:function(){K.RemoveFavoriteCmd(ac,C)},searchAvailability:true};var F={label:m.CMDRemoveContent,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_RemoveItem.png")+")",callback:function(){K.RemoveContentCmd(ac,C)}};var T={label:m.CMDDownloadFile,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_DownloadFileCmd.png")+")",callback:function(){K.DownloadFileCmd(ac,C)},check:function(ag){return ag&&ag.options?ag.options.isDownloadable===true:false},searchAvailability:true};var R={label:m.CMDCheckOutFile,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_CheckOutFileCmd.png")+")",callback:function(){K.CheckOutFileCmd(ac,C)}};var V={label:m.CMDCheckInFile,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_CheckInFileCmd.png")+")",callback:function(){K.CheckInFileCmd(ac,C)}};var af={label:m.CMDAddFile,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_AddFileCmd.png")+")",callback:function(){K.AddNewFileCmd(ac,C)}};var z={label:m.CMDAddExistingContent,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_PLMAddExistingObjectToFolder.png")+")",callback:function(){K.AddExistingCmd(ac,C)}};var B={label:m.CMDActiveFolder,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_ActiveFolder.png")+")",callback:function(){K.ActiveFolderCmd(ac,C)}};var L={label:m.CMDSizeColumnToFit,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/I_FitToColumn.png")+")",callback:function(){A.manager.sizeColumnToFit(A.dataIndex)}};var ab=[];if(o.isCatiaV5Environment()){ab=["VPMReference","Drawing","XCADNonPSBaseRepReference","3DShape"]}else{if(o.isSolidworksEnvironment()){ab=["XCADModelRepReference","VPMReference","Drawing"]}}var O={label:m.CMDOpen,icon:"url("+g.getWebappsAssetUrl("PADUtils","icons/32/I_OpenInCAD.png")+")",callback:function(){K.OpenInCADCmd(ac,C)},managedTypes:ab,searchAvailability:true,dashboardAvailability:false};var Z={label:m.CMDOpenWithCV5,icon:"url("+g.getWebappsAssetUrl("FolderEditor","icons/32/ENOV5MA_AP_AppIcon.png")+")",callback:function(){K.OpenWithCV5Cmd(ac,C)},setting:{key:"activateOpenWith18xFD01",value:true},webInWinAvailability:false};var H={type:"separator"};if(C==="TREE"){if(aa){this._addCtxCmd(C,Y,Q);this._addCtxCmd(C,Y,P)}else{if(t.isFolder(G)){this._addCtxCmd(C,Y,S);this._addCtxCmd(C,Y,Q);this._addCtxCmd(C,Y,I);this._addCtxCmd(C,Y,ad,H);this._addCtxCmd(C,Y,M);var D=false;s.getEnforceFolderLinkSettingAsync(function(ah,ag){if(!ah){D=ag}});if(D||d.isCustomizedEnv()||d.isActiveBookmarkActivated()){this._addCtxCmd(C,Y,B)}this._addCtxCmd(C,Y,ae,H);this._addCtxCmd(C,Y,N);if(!q.IsEmpty()){this._addCtxCmd(C,Y,X)}this._addCtxCmd(C,Y,J,H);if(d.isCustomizedEnv()){this._addCtxCmd(C,Y,T)}this._addCtxCmd(C,Y,U)}else{if(t.isRootFolder(G)){this._addCtxCmd(C,Y,S);this._addCtxCmd(C,Y,Q);if(!ac.isPersonal){this._addCtxCmd(C,Y,I)}this._addCtxCmd(C,Y,ad,H);this._addCtxCmd(C,Y,M);var D=false;s.getEnforceFolderLinkSettingAsync(function(ah,ag){if(!ah){D=ag}});if(D||d.isCustomizedEnv()||d.isActiveBookmarkActivated()){this._addCtxCmd(C,Y,B)}if(!q.IsEmpty()){this._addCtxCmd(C,Y,X,H)}this._addCtxCmd(C,Y,J,H);if(d.isCustomizedEnv()){this._addCtxCmd(C,Y,T)}this._addCtxCmd(C,Y,U)}else{if(G==="FolderSection_AllFolders"){this._addCtxCmd(C,Y,S);this._addCtxCmd(C,Y,ad,H);this._addCtxCmd(C,Y,M)}else{if(G==="FolderSection_favorite"){this._addCtxCmd(C,Y,ad);this._addCtxCmd(C,Y,M)}}}}}}else{if(C==="CONTENT"){if(A.cellView&&typeof A.cellView.getVirtualCoordinates==="function"&&A.cellView.getVirtualCoordinates().virtualRowID===-1){Y.push(L)}else{if(W){if(t.inFamilyFolder(G)){this._addCtxCmd(C,Y,S);this._addCtxCmd(C,Y,z,H);this._addCtxCmd(C,Y,af);if(!q.IsEmpty()){this._addCtxCmd(C,Y,X,H)}}else{if(G==="FolderSection_AllFolders"){this._addCtxCmd(C,Y,S)}}}else{var E=d.getContent().getSelectedNodes();if(E.length==1){G=ac.plmType;if(aa){if(d.getContent().getActiveView()==="treelistview"){this._addCtxCmd(C,Y,Q)}this._addCtxCmd(C,Y,P)}else{if(t.isFolder(G)){if(d.getContent().getActiveView()==="treelistview"){this._addCtxCmd(C,Y,Q)}this._addCtxCmd(C,Y,I);this._addCtxCmd(C,Y,ae,H);this._addCtxCmd(C,Y,N);if(!q.IsEmpty()){this._addCtxCmd(C,Y,X)}this._addCtxCmd(C,Y,J,H);if(d.isCustomizedEnv()){this._addCtxCmd(C,Y,T)}this._addCtxCmd(C,Y,U)}else{if(t.isRootFolder(G)){if(d.getContent().getActiveView()==="treelistview"){this._addCtxCmd(C,Y,Q)}if(!ac.isPersonal){this._addCtxCmd(C,Y,I)}if(!q.IsEmpty()){this._addCtxCmd(C,Y,X,H)}this._addCtxCmd(C,Y,J,H);if(d.isCustomizedEnv()){this._addCtxCmd(C,Y,T)}this._addCtxCmd(C,Y,U)}else{if(G==="Content"){this._addCtxCmd(C,Y,Z);this._addCtxCmd(C,Y,O);this._addCtxCmd(C,Y,F);this._addCtxCmd(C,Y,I);if(ac.options.children!==null){this._addCtxCmd(C,Y,ad,H);this._addCtxCmd(C,Y,M)}this._addCtxCmd(C,Y,ae,H);this._addCtxCmd(C,Y,N);if(!q.IsEmpty()){this._addCtxCmd(C,Y,X)}this._addCtxCmd(C,Y,J,H);if(ac.options.type==="Document"){if(ac._ischeckout==="TRUE"){this._addCtxCmd(C,Y,V)}else{this._addCtxCmd(C,Y,R)}}this._addCtxCmd(C,Y,T);this._addCtxCmd(C,Y,U)}else{this._addCtxCmd(C,Y,Z);this._addCtxCmd(C,Y,O);this._addCtxCmd(C,Y,F);this._addCtxCmd(C,Y,I);this._addCtxCmd(C,Y,ad,H);this._addCtxCmd(C,Y,M);this._addCtxCmd(C,Y,ae,H);this._addCtxCmd(C,Y,N);if(!q.IsEmpty()){this._addCtxCmd(C,Y,X)}this._addCtxCmd(C,Y,J,H);this._addCtxCmd(C,Y,T);this._addCtxCmd(C,Y,U)}}}}}else{if(!aa){if(!this._selectedNodesContainsFolder(E)){this._addCtxCmd(C,Y,Z);this._addCtxCmd(C,Y,O);this._addCtxCmd(C,Y,F);this._addCtxCmd(C,Y,I);this._addCtxCmd(C,Y,ae,H);this._addCtxCmd(C,Y,N)}else{if(!this._selectedNodesContainsRootFolder(E)){this._addCtxCmd(C,Y,ae);this._addCtxCmd(C,Y,N)}}if(!q.IsEmpty()){this._addCtxCmd(C,Y,X)}this._addCtxCmd(C,Y,J,H);if(d.isCustomizedEnv()){this._addCtxCmd(C,Y,T,H)}this._addCtxCmd(C,Y,U)}}}}}}return Y},_checkTypeAvailability:function(z,D){if(D){var A=D.managedTypes;var C=D.check;if(A||C){var E=null;if(z==="TREE"){E=x.getCurrentFolder();E=E?[E]:[]}else{E=d.getContent().getSelectedNodes()}if(E){var B=false;E.every(function(F){B=A&&F.options&&F.options.type?A.indexOf(F.options.type)>=0:!A;B=B&&(!C||C(F));return !B});return B}}}return true},_addCtxCmd:function(B,z,D,C){var A=false;if(D.type==="separator"){A=true}else{if(D.spaceAvailability!==false){A=true}}if(A&&B==="CONTENT"&&r.isSearchActive()&&D.searchAvailability!==true){A=false}if(A){if(o.isWebInWinEnvironment()){if(D.webInWinAvailability===false){A=false}}if(!o.isWebInWinEnvironment()&&D.dashboardAvailability===false){A=false}}if(A&&D.setting&&h.getSetting(D.setting.key)!==D.setting.value){A=false}A=A&&this._checkTypeAvailability(B,D);if(A){if(C&&(C.type!=="separator"||z.length>0)){z.push(C)}z.push(D)}},MultiFilesCheck:function(A){var z=A._ischeckout;if(z&&z.indexOf(",")>-1){return true}return false},CheckOutFileCmd:function(){var z=x.getSelectedNodes();var A=j.isTouchDevice();if(z.length===0){n.displayNotification({message:m.msg_warning_nocontent,className:"warning"})}else{if(z.length===1){var B=z[0].getID();var C=v.MultiFilesCheck(z[0]);if(C===true){n.displayNotification({message:m.msg_error_FileCheckOut_MultiFiles,className:"error"});return}l.downloadFiles({ID:B,CheckOut:true,callbacks:{onComplete:function(H,G){if(!A){j.downloadFcs(H)}else{j.downloadForTouchDevices(H)}var D=d.getContent().getPADTreeDocument();var F=D.getNodesById(G.ID);var E=[{name:"isLastMinorRevision",value:"TRUE"}];F[0].updateAttributes(E,a.getAvailableColumns());F[0]._ischeckout="TRUE";var I=g.getWebappsAssetUrl("FolderEditor","icons/32/I_CheckOutDocument.png");F[0].updateOptions({badges:{bottomRight:I}});var J={modified:[G.ID]};D.refreshNodeById(J);if(F[0]._isSelected===true){x.addInFolderCSO(F[0],"CONTENT")}},onFailure:function(E,D){console.log("get url for download KO");n.displayNotification({message:m.msg_error_FileCheckOut,className:"error"})}}})}else{n.displayNotification({message:m.msg_warning_MultipleSelection,className:"warning"})}}},CheckInFileCmd:function(A){var B=function(E,H){var D=x.getSelectedNodes();if(D.length!=1){throw"Cannot check in several nodes !"}d.getContent().addDummyRootNodes([D[0]]);var F=D[0].getID();var G=v.MultiFilesCheck(D[0]);if(G===true){this._offProgressBar();n.displayNotification({message:m.msg_error_FileCheckIn_MultiFiles,className:"error"});return}l.checkinFile({file:E,comments:H,ID:F,node:D,callbacks:{onComplete:function(N,L){var J=[];var I=d.getContent().getPADTreeDocument();var K=I.getNodesById(L.ID);K[0]._ischeckout="FALSE";K[0].updateOptions({badges:null});d.getContent().updateRootNode(K[0]);var M={modified:[L.ID]};I.refreshNodeById(M);n.displayNotification({message:m.msg_info_filecheckedin,className:"primary"})},onFailure:function(I){n.displayNotification({message:m.msg_error_FileCheckIn,className:"error"});d.getContent().updateRootNode(D[0])}}})};var C=function(){console.log("onCancel Add Comment")};var z=x.getSelectedNodes();if(z.length!=1){throw"Cannot check in several nodes !"}return new p(document.body,A,z[0].options.label,B,C)},_selectedNodesContainsFolder:function(D){var A,C,z=D.length;for(A=0;A<z;++A){C=D[A];var B=UWA.is(C.getType,"function")?C.getType():C.options.type;if(t.inFamilyFolder(B)){return true}}return false},_selectedNodesContainsRootFolder:function(A){for(var z=0;z<A.length;z++){if(t.isRootFolder(A[z].plmType)){return true}}return false}};return v});define("DS/FolderEditor/commands/ActionBar_DownloadFileCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(d,b,a){var c=b.extend({labelTopBar:d.i18n("Download "),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){a.DownloadFileCmd()},endExecute:function(){},});return c});define("DS/FolderEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO"],function(e,c,b,a){var d=c.extend({labelTopBar:e.i18n("Collase All"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var g=a.getSelectedNodes();if(g.length){var f=g[0];b.CollapseAllCmd(f,"CONTENT")}else{var h=a.getCurrentFolder();b.CollapseAllCmd(h,"TREE")}},endExecute:function(){}});return d});define("DS/FolderEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO"],function(e,c,b,a){var d=c.extend({labelTopBar:e.i18n("Expand All"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var g=a.getSelectedNodes();if(g.length&&g[0]&&(!g[0].plmType||g[0].plmType==="Content")){var f=g[0];b.ExpandAllCmd(f,"CONTENT")}else{var h=a.getCurrentFolder();b.ExpandAllCmd(h,"TREE")}},endExecute:function(){}});return d});define("DS/FolderEditor/commands/ActionBar_CopyCmd",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,b,d,a){var c=b.extend({labelTopBar:e.i18n("Copy"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var f=this;a.CopyCmd()},endExecute:function(){}});return c});define("DS/FolderEditor/commands/ActionBar_CutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(d,b,a){var c=b.extend({labelTopBar:d.i18n("Copy"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var e=this;a.CutCmd()},endExecute:function(){}});return c});define("DS/FolderEditor/commands/ActionBar_ImportCSVBookmarkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands",],function(d,b,a){var c=b.extend({labelTopBar:d.i18n("Import CVS Bookmark Structure"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false});require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel"],function(f){})},beginExecute:function(){},execute:function(){require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel"],function(e){new e()})},endExecute:function(){}});return c});define("DS/FolderEditor/commands/ActionBar_PasteCmd",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,b,d,a){var c=b.extend({labelTopBar:e.i18n("Copy"),isInsert:true,datas:{},init:function(f){this._parent(f,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){var f=this;a.PasteCmd()},endExecute:function(){}});return c});define("DS/FolderEditor/commands/ActionBar_CheckOutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(d,b,a){var c=b.extend({labelTopBar:d.i18n("Check Out"),isInsert:true,datas:{},init:function(e){e.isEnabled=false;this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){a.CheckOutFileCmd();this.end()},endExecute:function(){}});return c});define("DS/FolderEditor/commands/ActionBar_CheckInCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands",],function(d,b,a){var c=b.extend({labelTopBar:d.i18n("Check In"),isInsert:true,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:false})},beginExecute:function(){},execute:function(){a.CheckInFileCmd(this);this.end()},endExecute:function(){}});return c});define("DS/FolderEditor/utils/FolderCommandManager",["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderSearch"],function(a,c,b,e,i,d){var g=["CreateSnapshotHdr","RevisionHdr","NewBranchHdr","ReviseFromHdr","DeleteHdr","DuplicateHdr","IterationsHdr","IterationsHdr","HistoryHdr","SubscribeHdr","UnSubscribeHdr","EditSubscribeHdr","MySubscriptionsHdr"];var h={AddExistingContent:{search:false,TREE:{Sections:false}},AddFile:{search:false,TREE:{Sections:false}},AddToFavorites:{type:"check",TREE:{Sections:false}},RemoveContent:{search:false,CONTENT:{Bookmarks:false}},CheckOutFile:{search:false,multisel:false,CONTENT:{check:function(j){return j.options.type==="Document"&&j._ischeckout!=="TRUE"}}},CheckInFile:{search:false,multisel:false,CONTENT:{check:function(j){return j.options.type==="Document"&&j._ischeckout==="TRUE"}}},SelectChildren:{search:false,CONTENT:true},SelectParent:{search:false,CONTENT:true},SelectAll:{search:false,TREE:true},SelectInversion:{search:false,TREE:true},SelectSiblings:{search:false,CONTENT:true},SelectLeaves:{search:false,CONTENT:true},DownloadFile:{TREE:{Sections:false,custo:true},CONTENT:{check:function(j){return j.options.isDownloadable}}},Copy:{TREE:{Bookmark:true},CONTENT:{Root:false}},Cut:{search:false,TREE:{Bookmark:true},CONTENT:{Root:false}},Paste:{search:false,clipboard:true,TREE:{Sections:false}},ActionBar_Attributes:{TREE:{Sections:false},CONTENT:true},ActionBar_AccessRightCmd:{TREE:{Sections:false}},CompareHdr:{CONTENT:true},ActionBar_ChangeOwner:{TREE:{Sections:false},CONTENT:true},ActionBar_ReserveCmd:{TREE:{Sections:false},CONTENT:true},ActionBar_UnreserveCmd:{TREE:{Sections:false},CONTENT:true},ActionBar_NewFolderCmd:{search:false,TREE:{FavSection:false}},treelistview:{TREE:true},graphview:{search:false,TREE:true},tileview:{search:false,TREE:true},thumbnailview:{search:false,TREE:true},ExpandAll:{TREE:true},ExpandN:{TREE:true},CollapseAll:{TREE:true},ReframeOn:{views:["graph_view","graphview"],CONTENT:true},FitAllIn:{views:["graph_view","graphview"]},ToggleOverview:{views:["graph_view","graphview"]},SwapThumbState:{views:["graph_view","graphview"]},LayoutUp:{views:["graph_view","graphview"]},LayoutDown:{views:["graph_view","graphview"]},LayoutRight:{views:["graph_view","graphview"]},LayoutLeft:{views:["graph_view","graphview"]},ColumnVisibility:true,Print:{search:false},PrintOptions:{search:false},ExportCSV:{search:false},ExportCSVOptions:{search:false},ImportCSVBookmark:{search:false,TREE:{FavSection:false}},ImportCSV:{search:false,TREE:{FavSection:false}},ActiveFolder:{search:false,check:function(){var k=null;var j=false;b.getEnforceFolderLinkSettingAsync(function(m,l){if(!m){j=l}});k=j||c.isCustomizedEnv()||c.isActiveBookmarkActivated();return k},TREE:{Sections:false,}},WhereUsed:{multisel:false,CONTENT:{Root:false}}};var f={enableAllCommands:function(k){var l;var j=a.getCommands();for(l in j){var m=a.getCommand(l,c.getContent());if(UWA.is(m)&&g.indexOf(l)<0){if(k){m.enable()}else{if(l!=="ListSnapshotsHdr"){m.disable()}}}}},_manageSwitchOfCommands:function(q,v){var y=q.isFavorite;var s=false;var k=false;var o=e.IsEmpty();var z=false;var n=false;var l=false;var r=false;if(q){l=q.plmType=="FolderSection_favorite";r=q.plmType=="FolderSection_AllFolders";z=!y&&(i.isRootFolder(q.plmType)||i.isPersonalFolder(q.plmType));n=!y&&i.isFolder(q.plmType)}var x=l||r;var w=false;if(v){v.every(function(B){s=s||(!y&&(i.isRootFolder(B.plmType)||i.isPersonalFolder(B.plmType)));k=k||(!y&&i.isFolder(B.plmType));w=w||B.plmType==="Busy";return !s||!k||!w})}var p=true;if(l||w||((r||!q)&&v.length===0)){p=false}this.enableAllCommands(p);if(w){return}for(var j in h){var m=h[j];var A=null;var u=null;var t=true;if(typeof m==="object"){if(t&&m.clipboard!==undefined){t=!o}if(t&&m.multisel!==undefined){t=v.length<=1}if(t&&m.search!==undefined&&d.isSearchActive()){t=m.search}if(t&&m.custo!==undefined){t=c.isCustomizedEnv()}if(t&&m.check){t=m.check({oneIsRoot:s,oneIsBookmark:k,treeIsRoot:z,treeIsBookmark:n})}if(t&&m.views){t=m.views.indexOf(c.getContent().getActiveView())>=0}if(t&&m.TREE){A=!!q;if(A){if(m.TREE===true){A=true}else{if(A&&m.TREE.custo){A=c.isCustomizedEnv()}if(A!==false){if(m.TREE.Root===true){A=z}else{if(m.TREE.Root===false){A=!z}}}if(A!==false){if(m.TREE.Bookmark===true){A=n}else{if(m.TREE.Bookmark===false){A=!n}}}if(A!==false){if(m.TREE.Bookmarks===true){A=n&&z}else{if(m.TREE.Bookmarks===false){A=!n&&!z}}}if(A!==false){if(m.TREE.Sections===true){A=x}else{if(m.TREE.Sections===false){A=!x}}}if(A!==false){if(m.TREE.FavSection===true){A=l}else{if(m.TREE.FavSection===false){A=!l}}}if(A!==false&&m.TREE.check){A=m.TREE.check(q)}}}}if(t&&m.CONTENT){u=!!v&&v.length>0;if(u){if(m.CONTENT===true){u=true}else{if(u&&m.CONTENT.custo){u=c.isCustomizedEnv()}if(u!==false){if(m.CONTENT.Root===true){u=s}else{if(m.CONTENT.Root===false){u=!s}}}if(u!==false){if(m.CONTENT.Bookmark===true){u=k}else{if(m.CONTENT.Bookmark===false){u=!k}}}if(u!==false){if(m.CONTENT.Bookmarks===true){u=k&&s}else{if(m.CONTENT.Bookmarks===false){u=!k&&!s}}}if(u!==false&&m.CONTENT.check){v.every(function(B){u=m.CONTENT.check(B);return u})}}}}t=t&&(u===true||A===true||(u===null&&A===null))}this._switchCommand(j,t,m.type)}},ItemSelected:function(m,k,l){if(!!c.getContent()){var j=c.getContent().getSelectedNodes();j=j?j:[m];this._manageSwitchOfCommands(l,j)}},getCommand:function(j){return a.getCommand(j,c.getContent())},getCommandChk:function(j){return a.getCommandCheckHeader(j)},_switchCommand:function(j,n,k){var m=k==="check"?this.getCommandChk(j):this.getCommand(j);if(!m){console.log("Can't find command "+j)}else{try{if(n){m.enable()}else{m.disable()}}catch(l){console.error("Error "+(n?"enabling":"disabling"),j,l)}}}};return f});define("DS/FolderEditor/ActionBar/FolderActionBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","DS/FolderEditor/utils/FolderCommandManager","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/ActionBar/Actionbar","DS/Core/ModelEvents","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/RuntimeView/NLSManager","DS/PADUtils/PADContext","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/WidgetServices","DS/FolderEditor/service/FolderEditorWebService","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADProbes","DS/PADUtils/views/PADAlert","UWA/Utils/Client","DS/PADUtils/PADSettingsMgt",],function(b,p,k,q,u,f,c,a,m,l,v,i,n,s,j,g,h,d,t,o,e){var r=p.extend(q,k,{name:"folder_actionbar",_logger:null,_actionBar:null,_language:"en",_context:null,_isReady:false,_modelEvents:null,init:function(w){this._probeLoadElmt=d.createProbe("loadActionBar");var x=this;if(w.language){this._language=widget.lang?widget.lang:widget.getValue("lang")}if(w.context){this._context=w.context}else{this._context=this}this._modelEvents=new m();this._parent(w);this._logger=u.getLogger(r);this.onReady(function(){x.syncState();v.onFolderSelected(function(C){var B=v.getCurrentFolder();f.ItemSelected(C.selectedNode,C.context,B)});v.onEmpty(function(){f.enableAllCommands(false)});var z=false;s.getEnforceFolderLinkSettingAsync(function(C,B){if(!C){z=B}});if(z||l.isCustomizedEnv()||l.isActiveBookmarkActivated()){try{var y=c.getCommand("ActiveFolder",l.getContent());if(y){y.begin()}}catch(A){console.error("Error trying to execute command","ActiveFolder",A)}}if(UWA.is(w.events)&&UWA.is(w.events.onActionBarReady,"function")){w.events.onActionBarReady()}x._probeLoadElmt.end()});this.onLoad(w);if(this.getOption("renderTo")){this.render().inject(this.getOption("renderTo"))}},render:function(){return this},loadActionBar:function(w){this._actionBar.loadModel(w)},destroy:function(){this._logger.log("destroy");if(this._actionBar){delete this._actionBar;this._actionBar=null}this._parent()},create:function(w){var x=this;this.loadXML(function(z){x._actionBar=new a({context:null,file:z,filename:"ENOFolder",module:"FolderEditor",language:widget.lang?widget.lang:widget.getValue("lang")});var y=x._actionBar.onActionBarReady(function(){x._actionBar.inject(x.elements.container);x._actionBar._modelEvents.unsubscribe(y);x._isReady=true;x._modelEvents.publish({event:"READY",context:x})})})},loadXML:function(y){var x=this;if(!this.xmlDoc){this.xmlDoc="loading";var w={onComplete:function(z){var B=new DOMParser();var A=B.parseFromString(z,"text/xml");x.xmlDoc=A;x.dispatchEvent("xmlLoaded",x.xmlDoc)},onFailure:function(C,B,A){if(typeof B==="string"){try{var z=JSON.parse(B);if(z.error){t.displayNotification({msg:z.error,eventID:"error"})}}catch(D){}}x._modelEvents.publish({event:"READY",context:x})}};g.getActionBar(w)}if(y){if(x.xmlDoc!=="loading"){y(x.xmlDoc)}else{x.addEvent("xmlLoaded",function(){y(x.xmlDoc)})}}},onLoad:function(w){var x=this;x._context.options=x._context.options||{};UWA.extend(x._context.options,{custo_view_title:h.name_Widget_Title});x._context.getFolderXSO=function(){return v};n.set(x._context);if(!b.is(this.elements.container)){i.DEFAULT_LANGUAGE=widget.lang?widget.lang:widget.getValue("lang");this.elements.container=UWA.createElement("div",{"class":this.getClassNames()});this.loadXML()}},onReady:function(x){var w=this._modelEvents.subscribe({event:"READY"},x);return w},syncState:function(){var y=v.getCurrentFolder();var w=v.get();if(y&&w&&w.length>0){var x="CONTENT";if(y.getID()==w[0].getID()){x="TREE"}f.ItemSelected(w[0],x,y)}else{f.enableAllCommands(false)}}});return r});define("DS/FolderEditor/utils/FolderEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderTypeService","DS/Logger/Logger"],function(d,a,f,e,h,g,c,j,b){var i=a.extend({name:"FolderEditorKeyboardListener",init:function(k){var l=this;this._parent(k);this._logger=b.getLogger(i);this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(){d.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(l){var r=this;var v=f.whichKey(l);var s=function(){var w=document.activeElement;if(w&&(w.tagName==="INPUT"||w.tagName==="TEXTAREA")){return true}else{return false}};var k=function(x,z,w){var y=g.getCommand(z);if(y&&y.isEnabled()){if(!s()){y.begin();if(w!==false){f.stop(l)}}else{r._logger.log("Info : '"+x+"' key pressed in INPUT field, no command launched")}}else{r._logger.log("Info : '"+x+"' key pressed, but command '"+z+"' is disabled")}};switch(v){case"ctrl+a":k(v,"SelectAll");break;case"del":k(v,"DeleteHdr");break;case"ctrl+c":k(v,"Copy",false);break;case"ctrl+x":k(v,"Cut");break;case"ctrl+v":k(v,"Paste");break;case"ctrl+f":var t=e.getIdCardCont();if(t.isSearchAvailable()){t.switchSearch(true);f.stop(l)}break;case"alt+return":k(v,"ActionBar_Attributes");break;case"f2":if(!s()){var o=c.getSelectedNodes();var u=c.getCurrentFolder();var n=Array.isArray(o)?o.length:0;if(n>=1){var m=o[0];if(m&&j.inFamilyFolder(m.plmType)){if(u.getID()==m.getID()){var p=e.getTreeCont();if(p&&p.switchFolderTreeNodeLabelToWriteView){p.switchFolderTreeNodeLabelToWriteView(u)}}else{var q=e.getContent();if(q&&q.switchFolderTreeNodeLabelToWriteView){q.switchFolderTreeNodeLabelToWriteView(m)}}}else{r._logger.log("Info : '"+v+"' key pressed but selected element is not a Folder, no command launched")}}else{r._logger.log("Info : '"+v+"' key pressed when no element selected, no command launched")}}else{r._logger.log("Info : '"+v+"' key pressed in INPUT field, no command launched")}break;case"esc":h.escapCmd();break;default:break}},});return i});define("DS/FolderEditor/service/FolderDnDServices",["DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/utils/FolderConfirmation","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderEditorWebService","DS/Tree/TreeNodeModel","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderSearch","DS/WidgetServices/WidgetServices"],function(j,s,t,h,e,q,u,a,b,i,c,m,f,l,n,d,o,k){var g=false;var p="";var r={setStartDrag:function(v){g=v===true},isDragging:function(){return g},setDragFrom:function(v){p=v},getDragFrom:function(v){return p},retrieveDroppedDataFromDropEvent:function(C){var B={};var z;var x=UWA.is(C.dataTransfer.types.indexOf,"function")?"indexOf":"contains",w="";var y=["text/searchitems","text/plain","Text"];for(var v=0;v<y.length&&w==="";v++){var A=C.dataTransfer.types[x](y[v]);if((UWA.is(A,"number")&&A>=0)||(UWA.is(A,"boolean")&&A===true)){w=y[v]}}if(w===""){throw new Error("Unknown type in DnD")}else{z=C.dataTransfer.getData(w)}B=JSON.parse(z);return B},hasFilesInEvent:function(y){var v;var w;var x=y.dataTransfer?y.dataTransfer:y.detail?y.detail:null;if(x){if(!x.items&&x.types&&x.types[0]&&(x.types[0]==="application/x-moz-file"||x.types[0]==="Files")){w="file"}else{v=x.items;if(v&&v.length>=1){w=v[0].kind}}}return(w==="file")},isExternalDroppedDataOnFolderEditor:function(w){var v=true;if(w&&w.widget_id&&w.widget_id==this.getWidgetId()){v=false}return v},getSortedDroppedDataByType:function(F,z){var E=[];var M=[];var w=[];if(!F||!F.data||!F.data.items||!(Array.isArray(F.data.items))){return}for(var H=0;H<F.data.items.length;H++){var J=F.data.items[H];var G=J.objectId;var x=J.objectType_Internal;if(!x){x=J.objectType}if(Array.isArray(x)){var y=x.length;var A=(y>0)?x[y-1]:undefined;for(var C=0;C<y;++C){if(q.inFamilyFolder(x[C])){A=x[C];break}}x=A}var K=J.displayName;if(!K){K=x}if(!K){K=G}var L=J.folderId;var I=q.isPersonalFolder(x)||J.isPersonalFolder;var B=J.envId;var v=J.serviceId;var D={droppedItem_id:G,droppedItem_type:x,droppedItem_name:K,droppedSourceFolder_id:L,droppedItem_isPersonal:I,droppedItem_serviceId:v,droppedItem_tenantId:B};if(q.isRootFolder(x)||(q.isPersonalFolder(x))){E.push(D)}else{if(q.isFolder(x)){M.push(D)}else{w.push(D)}}}z.RootFolder_itemList=E;z.Folder_itemList=M;z.Content_itemList=w},getWidgetId:function(){return(self.widget.id)},isMoveDnDSetting:function(){return(self.widget.getValue("drag-and-drop")==="Move"&&!o.isSearchActive())?true:false},getDragDataForSelectedNodesInCurrentFolderContent:function(){var z=this;var F=null;var C=t.getCurrentFolder();if(C&&!C.isRoot()&&q.inFamilyFolder(C.plmType)){F=C.getID()}var x=t.getCurrentFolderPath();var A=[];var E=Array.isArray(x)?x.length:0;for(var y=0;y<E;y++){var D=x[y];if(q.inFamilyFolder(D.type)){A.push({resourceid:D.id,type:D.type})}else{break}}var B=[];var w=a.getContent().getSelectedNodes();w.forEach(function(I){if(I){var H=I.options.type;var G={envId:i.getPlatformId(),serviceId:"3DSpace",contextId:c.getSetting("pad_security_ctx")?c.getSetting("pad_security_ctx"):undefined,objectId:I.getID(),objectType:H,displayName:I.getLabel(),displayType:I.options.grid["ds6w:type"],folderId:F,isPersonalFolder:I.isPersonal};if(!q.inFamilyFolder(H)){G.path=I.getOccurencePathWithType?I.getOccurencePathWithType():undefined}if(!(q.inFamilyFolder(H)&&I.isFavorite)){G.folderPath=A}B.push(G)}});var v={protocol:"3DXContent",version:"1.1",source:"ENOFOL3_AP",widget_id:z.getWidgetId(),data:{items:B}};return v},uploadFilesInFolder:function(x,w){if(x&&x.plmType&&q.inFamilyFolder(x.plmType)){var v=t.getCurrentFolder();if(v&&(v.id===x.id)){m.uploadFileCmd(w)}else{m.uploadFileCmd(w,x)}}else{console.log("  Error in FolderDnDServices.uploadFilesInFolder, dropTarget_FolderNodeModel is not a Folder")}},addContentInFolder:function(w,y,E,F){var D=this;m._startProgressBar(h.Paste_content_loading);if(w&&w.plmType&&q.inFamilyFolder(w.plmType)&&E){if((w.id===y)){m._offProgressBar();j.displayNotification({message:h.msg_error_MoveInSamefolder,className:"error"});return}var z=E;var A=z.length;if(A<1){console.log("  Error in FolderDnDServices.addContentInFolder, lContentId list is empty");return}var x=false;var C=null;var v=D.isMoveDnDSetting();if(v===true&&F!==true){if(y){var B=t.getCurrentFolder();if(B&&(B.id===y)){C=B;x=true}}}if(x&&C){e.MoveContent({IDs:z,targetfolder:w,sourcefolder:C,callbacks:{onComplete:function(J){var I=a.getContent();var G=t.getCurrentFolder();if(I&&G){m._endProgressBarListener();if(G.id===y){var H=I.getPADTreeDocument();if(H){H.keepExpandedState()}I.loadContentAndSelect(G)}if(G.id===w.id){var H=I.getPADTreeDocument();if(H){H.keepExpandedState()}I.loadContentAndSelect(G,z[A-1]);u.unmask(I._contentDiv)}}j.displayNotification({message:A+" "+h.msg_info_objetmoved+" "+w.options.label,className:"primary"})},onFailure:function(H){var I=a.getContent();var G=t.getCurrentFolder();m._offProgressBar();if(I&&G){if(G.id===w.id){u.unmask(I._contentDiv)}}j.displayNotification({message:H?(h.msg_error_MoveInfolder+"<br>"+H):h.msg_error_MoveInfolder,className:"error"})}}})}else{e.AddContent({IDs:z,folder:w,callbacks:{onComplete:function(L){var K=a.getContent();var G=t.getCurrentFolder();if(K&&G){if(G.id===w.id){m._endProgressBarListener();var H=K.getPADTreeDocument();if(H){H.keepExpandedState()}K.loadContentAndSelect(G,z[A-1]);u.unmask(K._contentDiv)}else{m._offProgressBar()}}else{m._offProgressBar()}var J="";var I=z.length;if(L){var M=JSON.parse(L);I=M.added?M.added.length:I;J=M.information?" ("+M.information+")":J}j.displayNotification({message:h.replace(h.msg_info_Addinfolder,{number:I,foldername:w.options.label})+J,className:"primary"})},onFailure:function(H){var I=a.getContent();var G=t.getCurrentFolder();m._offProgressBar();if(I&&G){if(G.id===w.id){u.unmask(I._contentDiv)}}j.displayNotification({message:H?(h.msg_error_Addinfolder+"<br>"+H):h.msg_error_Addinfolder,className:"error"})}}})}}else{m._offProgressBar();console.log("  Error in FolderDnDServices.addContentInFolder, dropTarget_FolderNodeModel is not a Folder")}},addFoldersInFolder:function(w,z,D,G){var F=this;if(w&&w.plmType&&q.inFamilyFolder(w.plmType)&&D){m._startProgressBar(h.Paste_content_loading);var A=D;var B=A.length;if(B<1){console.warn("  Error in FolderDnDServices.addFoldersInFolder, lContentId list is empty");return}var x=false;var E=null;var v=F.isMoveDnDSetting();if(v===true&&G!==true){x=true}if(x){if((w.id===z)){m._offProgressBar();j.displayNotification({message:h.msg_error_MoveInSamefolder,className:"error"});return}for(var C=0;C<A.length;C++){var I=A[C];if(w.id===I){m._offProgressBar();j.displayNotification({message:h.msg_error_MoveInSamefolder,className:"error"});return}var H;var y=a.getTreeCont();if(y){H=y._getVisibleNodeById(I,null)}if(H&&H.isAscendantOf(w)){m._offProgressBar();j.displayNotification({message:h.msg_error_MoveFolder,className:"error"});return}}e.MoveFolder({IDs:A,targetfolder:w,selectedIds:A,callbacks:{onComplete:function(O){var N=t.getCurrentFolder();var T=false;var M=false;if(N){var Q=A.indexOf(N.id);if(Q!=-1){T=true;M=true}}var K=a.getTreeCont();if(K){var R=K._getVisibleNodeById(z,null);A.forEach(function(V){var U=K._getVisibleNodeById(V,R);if(U){a.getTreeCont().removeFromTree(U)}});var J=K._getVisibleNodeById(w.id,null);if(J&&J.isExpanded()){var S;if(T&&M){S=N.id}J.collapse();J.expand();S=null;if(S){M=false}}}var P=a.getContent();if(P&&N){if(N.id===z){m._endProgressBarListener();var L=P.getPADTreeDocument();if(L){L.keepExpandedState()}P.loadContentAndSelect(N)}else{if(N.id===w.id){m._endProgressBarListener();var L=P.getPADTreeDocument();if(L){L.keepExpandedState()}P.loadContentAndSelect(N,A[B-1]);u.unmask(P._contentDiv)}else{m._offProgressBar();if(T&&M){N.unselect();w.select();N=null;M=false}}}}else{m._offProgressBar()}j.displayNotification({message:h.replace(h.msg_info_foldermoved,{number:A.length,foldername:w.options.label}),className:"primary"})},onFailure:function(K){var L=a.getContent();var J=t.getCurrentFolder();if(L&&J){if(J.id===w.id){u.unmask(L._contentDiv)}}m._offProgressBar();j.displayNotification({message:K?(h.msg_error_MoveFolder+"<br>"+K):h.msg_error_MoveFolder,className:"error"})}}})}else{e.CopyFolder({IDs:A,targetfolder:w,selectedIds:A,callbacks:{onComplete:function(O){var J=a.getTreeCont();if(J){var L=J._getVisibleNodeById(w.id,null);if(L&&L.isExpanded()){J.updateTreeWithNewFolder(L)}}var N=a.getContent();var K=t.getCurrentFolder();if(N&&K){if(K.id===w.id){m._endProgressBarListener();var M=N.getPADTreeDocument();if(M){M.keepExpandedState()}N.loadContentAndSelect(K,A[B-1]);u.unmask(N._contentDiv)}else{m._offProgressBar()}}else{m._offProgressBar()}j.displayNotification({message:h.replace(h.msg_info_foldercopied,{number:A.length,foldername:w.options.label}),className:"primary"})},onFailure:function(K){var L=a.getContent();var J=t.getCurrentFolder();m._offProgressBar();if(L&&J){if(J.id===w.id){u.unmask(L._contentDiv)}}j.displayNotification({message:K?(h.msg_error_CopyFolder+"<br>"+K):h.msg_error_CopyFolder,className:"error"})}}})}}else{console.warn("  Error in FolderDnDServices.addFoldersInFolder, dropTarget_FolderNodeModel is not a Folder or RootFolder")}},processDroppedDataOnFolderEditorNode:function(F,C){var D=this;function I(M){if(Array.isArray(M)&&M.length>0){var O=i.getPlatformId();for(var N=M.length-1;N>=0;N--){var P=M[N];if(P&&P.droppedItem_tenantId!==O){return false}}}return true}function L(M){if(Array.isArray(M)&&M.length>0){var N="3DSpace";for(var O=M.length-1;O>=0;O--){var P=M[O];if(P&&P.droppedItem_serviceId!==N){return false}}}return true}if(C&&F){var H=D.isExternalDroppedDataOnFolderEditor(C);var J={};D.getSortedDroppedDataByType(C,J);var E=J.RootFolder_itemList;var B=J.Folder_itemList;var y=J.Content_itemList;if(!I(E)||!I(B)||!I(y)){j.displayNotification({message:h.msg_warning_dndnotsupported_from_different_tenant,className:"warning"});return}if(!L(y)){j.displayNotification({message:h.msg_warning_dndnotsupported_from_different_source,className:"warning"});return}if(q.inFamilyFolder(F.plmType)){if(Array.isArray(E)&&E.length>0){j.displayNotification({message:h.msg_warning_dndnotsupported,className:"warning"})}if(Array.isArray(B)&&B.length>0){while(B.length>0&&B[0]){var w=B[0];var v=w.droppedSourceFolder_id;var K=[];for(var A=B.length-1;A>=0;A--){var x=B[A];if(x){if(x.droppedSourceFolder_id===v){K.push(x.droppedItem_id);B.splice(A,1)}}else{B.splice(A,1)}}if(!H){if(!d.checkMoveOrCopyAcrossSharedAndPersonal({isPersonal:w.droppedItem_isPersonal},F,!D.isMoveDnDSetting())){return}}D.addFoldersInFolder(F,v,K,H)}}if(Array.isArray(y)&&y.length>0){while(y.length>0&&y[0]){var w=y[0];var v=w.droppedSourceFolder_id;var K=[];for(var A=y.length-1;A>=0;A--){var x=y[A];if(x){if(x.droppedSourceFolder_id===v){K.push(x.droppedItem_id);y.splice(A,1)}}else{y.splice(A,1)}}D.addContentInFolder(F,v,K,H)}}}else{if(F.plmType=="FolderSection_favorite"){if(Array.isArray(E)&&E.length>0){var G=[];var z=a.getTreeCont();if(z){E.forEach(function(O){var M={id:O.droppedItem_id,name:O.droppedItem_name,type:"RootFolder",isPersonal:O.droppedItem_isPersonal};var N=z.isFolderAmongFavoriteFolders(M);if(!N){G.push(M)}else{j.displayNotification({message:h.replace(h.get("msg_warning_FolderAlreadyAmongFavorites"),{foldername:O.droppedItem_name}),className:"warning"})}});if(G&&G.length>0){z.addFavorite(G)}}else{console.warn("  FolderDnDServices performDropOnFolderEditorNode FolderTreeCont is undefined")}}if(Array.isArray(B)&&B.length>0){if(H){j.displayNotification({message:h.msg_warning_dndnotsupported_external_on_Section_FavoriteFolders,className:"warning"})}else{var G=[];var z=a.getTreeCont();if(z){B.forEach(function(O){var M={id:O.droppedItem_id,name:O.droppedItem_name,type:"Folder",isPersonal:O.droppedItem_isPersonal};var N=z.isFolderAmongFavoriteFolders(M);if(!N){G.push(M)}else{j.displayNotification({message:h.replace(h.get("msg_warning_FolderAlreadyAmongFavorites"),{foldername:O.droppedItem_name}),className:"warning"})}});if(G&&G.length>0){z.addFavorite(G)}}else{console.warn("  FolderDnDServices performDropOnFolderEditorNode FolderTreeCont is undefined")}}}if(Array.isArray(y)&&y.length>0){j.displayNotification({message:h.msg_warning_dndnotsupported,className:"warning"})}}else{console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode dropTarget_NodeModel type is not in Folder family")}}}else{console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode invalid argument(s)")}},performDropOnFolderEditorNode:function(z,A){var x=this;var C=true;if(!z){console.log("  Error in FolderDnDServices.performDropOnFolderEditorNode, dropTarget_NodeModel is undefined")}var v=z.plmType=="FolderSection_favorite";var D=D?D:!z?h.msg_warning_dndnotsupported:null;if(D){j.displayNotification({message:D,className:"warning"});C=false}else{if(q.inFamilyFolder(z.plmType)){var E=x.hasFilesInEvent(A);if(E){var F=A.dataTransfer?A.dataTransfer.files:A.detail.files;x.uploadFilesInFolder(z,F);C=false}}else{if(v){var y=x.hasFilesInEvent(A);if(y){j.displayNotification({message:h.msg_warning_dndnotsupported,className:"warning"});C=false}}else{j.displayNotification({message:h.msg_warning_dndnotsupported,className:"warning"});C=false}}}var w=null;if(C){try{w=x.retrieveDroppedDataFromDropEvent(A)}catch(B){w=null;C=false;j.displayNotification({message:h.msg_warning_dndnotsupported,className:"warning"})}}if(self.widget&&self.widget.getValue("drag-and-drop")==="Move"&&C&&w&&z&&this.getDragFrom()==="bookmark"&&t.getCurrentFolder()!==z){s.launch({title:h.confirmation_move_title,content:h.replace(h.confirmation_move_message,{target:z._options.label})},function(){x.processDroppedDataOnFolderEditorNode(z,w)});x.setDragFrom("")}else{if(C&&w&&z){x.processDroppedDataOnFolderEditorNode(z,w)}}},};return r});define("DS/FolderEditor/FolderTreeDocument",["DS/Logger/Logger","DS/ENXNav/models/xNavDocument","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommandManager","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADProbes","DS/PADUtils/PADUtilsServices","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/FolderEditor/utils/FolderEditorcontrol"],function(a,k,b,m,n,c,o,l,e,j,h,d,i,g){var f=k.extend({name:"FolderTreeDocument",_doNotAddFolder:false,init:function(p){p.shouldAcceptDrag=this.shouldAcceptDrag.bind(this);p.shouldAcceptDrop=this.shouldAcceptDrop.bind(this);p.allowUnsafeHTMLContent=false;p.insert=this.insert.bind(this);p.authorize_setStructure=true;p.shouldBeEditable=o.shouldBeEditable;this._parent(p);this.onNodeModelUpdate(o.onNodeModelUpdate);var q=this;if(this._commandProxy){this._commandProxy.addProxyEvents({onRefresh:function(s){if(UWA.is(s.authored.created,"array")||UWA.is(s.authored.modified,"array")){q.refreshNodeById({created:s.authored.created,modified:s.authored.modified})}if(UWA.is(s.authored.deleted,"array")){var r=[];s.authored.deleted.forEach(function(t){r=r.concat(q.getNodesById(t))});q.deleteNodes(r,true)}}})}this._logger=a.getLogger(f);this._logger.log("init");var q=this;this.avoidIntermediateExecution=function(s,u){var t;var r;return function(){var x=this,w=arguments;var v=function(){t=null;if(r){s.apply(x,w);r=false}};if(!t){s.apply(x,w);r=false}else{r=true}clearTimeout(t);t=setTimeout(v,u)}};this.selection_broadcast_fn=this.avoidIntermediateExecution(function(){if(!q._doNotAddFolder){var r=q.getXSO().get();if(r&&r.length>0){var s=r[0];if(!s.getID){s.getID=function(){return this.id}}if(!s.getType){s.getType=function(){return this.plmType}}}b.addInFolderCSO(r,"CONTENT")}},100,true);this.getXSO().onChange(q.selection_broadcast_fn);this.getXSO().onEmpty(function(){q._doNotAddFolder=false;q.selection_broadcast_fn()});this.getXSO().onPreEmpty(function(){q._doNotAddFolder=true})},_buildSelectData:function(){var v=this._parent();if(v){var q=b.getCurrentFolder();if(Array.isArray(v.paths)&&v.paths.length>=1){if(q&&n.inFamilyFolder(q.plmType)){var r=b.getCurrentFolderPath();var p=[];var x=Array.isArray(r)?r.length:0;for(var s=0;s<x;s++){p.push({resourceid:r[s].id,type:r[s].type})}v.folderPath=p}}else{if(q&&n.inFamilyFolder(q.plmType)){var r=b.getCurrentFolderPath();var u=[];var x=Array.isArray(r)?r.length:0;for(var s=0;s<x-1;s++){u.push({resourceid:r[s].id,type:r[s].type})}var t={};if(x>=1){var w=x-1;if(r[w].id){t[r[w].id]={type:r[w].type,label:r[w].label}}}v.paths=[[q.id]];v.attributes=t;v.folderPath=u}}}return v},withBroadcastSelect:function(p){this.prepareBroadcastSelect();p();this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotAddFolder=true;this._parent()},pushBroadcastSelect:function(){this._doNotAddFolder=false;this.selection_broadcast_fn();this._parent()},shouldAcceptDrag:function(q){var p=[];p=b.getSelectedNodes();if(p.length>0){var r=p[0].getType();if(n.isRootFolder(r)||n.isPersonalFolder(r)||r=="Busy"){return false}}return true},shouldAcceptDrop:function(p){if(p&&p.parentTreeNodeModel&&p.draggedTreeNodeModel){return n.isFolder(p.parentTreeNodeModel.plmType)}return true},insert:function(r,q,p){if(r&&q){var s=m.getDragDataForSelectedNodesInCurrentFolderContent();m.processDroppedDataOnFolderEditorNode(q,s)}return false},keepExpandedState:function(){var t=g.getContent().getPADTreeDocument();if(t){var q=t.getRoots();var r=0;var p=q.length;for(r=0;r<p;r++){var s=q[r].options.type;if(q[r].isExpanded()){g.getContent().RefreshProductStructure=true;break}}}},deleteNodes:function(q){var s,p=q.length,t=false;for(s=0;s<p;++s){var u=q[s];if(u._expandState!=="noExpandState"&&widget.getBool("filtered-content")===true){t=true;break}}if(t){var v=b.getSelectedNodesID();var r=b.getCurrentFolder();g.getContent().RefreshProductStructure=true;g.getContent().loadContentAndSelect(r,v)}else{this._parent(q)}},refreshNodeById:function(D){var x=this;var q=D.modified;var B=[];var F=[];var t=false;var z=function(G){var H=false;if(G.options.isSearchWithinData==true){t=true}if(G.options.isNotManagedByPS){H=G.options.isNotManagedByPS}return H};var s=this.getRoots();var v,w=s.length;for(v=0;v<w;++v){var A=s[v];var u=A.getID();if(n.inFamilyFolder(A.plmType)){var p=q.indexOf(u);if(p!==-1){q.splice(p,1);B.push(u)}else{var E=D.modified;E.forEach(function(K){console.log("  modified :",K);var H=K.physicalid;var G=K.operation;if(H===u){var J=K.key;if(J&&J==="ownerChanged"){t=true}B.push(u);var I=q.indexOf(K);if(I!==-1){q.splice(I,1)}}})}}else{if(z(A)){var p=q.indexOf(u);if(p!==-1){q.splice(p,1);F.push(u)}else{var E=D.modified;E.forEach(function(K){var H=K.physicalid;var G=K.operation;if(H===u){var J=K.key;if(J&&J==="ownerChanged"){t=true}F.push(u);var I=q.indexOf(K);if(I!==-1){q.splice(I,1)}}})}}}}D.modified=q;if(t){var r=b.getCurrentFolder();this.keepExpandedState();var C=b.getSelectedNodes();var y=[];C.forEach(function(G){y.push(G.getID())});g.getContent().loadContentAndSelect(r,y)}else{if(B.length>0){B.forEach(function(G){c.getFolderProperties({pid:G,onComplete:function(M){if(UWA.is(M,"string")){M=JSON.parse(M)}var N=o.convertToExaleadDataFormat(M);var J=x.searchRootById(G);if(J){J._resetting=true;J.options.oldLabel=N.label;if(J.options.publishOnConnect!==M.publishOnConnect){var I=(M.publishOnConnect==="TRUE")?d.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";J.setBadges({bottomRight:I})}var K=false;e.getEnforceFolderLinkSettingAsync(function(Q,P){if(!Q){K=P}});if(K||g.isCustomizedEnv()||g.isActiveBookmarkActivated()){var L=g.getActiveFolder(),O=L.id,H=L.disabledId;if(O===G){var I=d.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active.png");J.setBadges({bottomLeft:I})}else{if(H===G){var I=d.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active_disabled.png");J.setBadges({bottomLeft:I})}}}x.wrapInTransaction(function(){J.updateOptions(N)})}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting folder Properties")}})})}if(F.length>0){F.forEach(function(G){c.getContentProperties({pid:G,onComplete:function(J){if(UWA.is(J,"string")){J=JSON.parse(J);var K=o.convertToExaleadDataFormat(J);var I=x.searchRootById(G);if(I){var H=null;I._ischeckout=((J.Documentlocked==="TRUE")||(J.Documentlocked==="[TRUE]"))?"TRUE":"FALSE";if(I._ischeckout==="TRUE"){H=d.getWebappsAssetUrl("FolderEditor","icons/32/I_CheckOutDocument.png")}K.badges={bottomRight:H};x.wrapInTransaction(function(){I.updateOptions(K)})}}},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})})}this._parent(D)}}});return f});define("DS/FolderEditor/views/FolderSearchInContext",["UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/FolderEditor/utils/FolderAlert","DS/PADUtils/PADUtilsServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(f,j,g,h,a,d,e,i,c){var b=f.extend({_timerLastKey:null,switchSearch:function(k){if(k){this._showSearchInput()}else{this._hideSearchInput(true)}},_hideSearchInput:function(k){if(k&&this.getValue()){this.clearValue()}if(!this.getValue()){this.elements.inputHolder.show();this.elements.input.hide();this.dispatchEvent("onSearchSwitch",false)}},_showSearchInput:function(){this.elements.input.show();this.elements.input.focus();this.elements.inputHolder.hide();this.dispatchEvent("onSearchSwitch",true)},init:function(k){var l=this;this._parent(k);this._timerLastKey=null;this._selectedFolders=null;this.elements.container=UWA.createElement("div",{"class":"searchInContext_container"});this.elements.inputHolder=new UWA.createElement("div",{"class":"searchInContext_holder fonticon fonticon-search",attributes:{title:c.get("searchInFolder_search")},events:{click:function(){l._showSearchInput()}}}).inject(this.elements.container);new h({position:"left",target:this.elements.inputHolder});this.elements.input=new j({className:"searchInContext_input",events:{onKeyDown:function(n){var m=this;if(n.which===13){l._launchSearch()}else{if(n.which===27){l.clearValue();l._hideSearchInput()}else{if(l._timerLastKey!=null){clearTimeout(l._timerLastKey)}l._timerLastKey=setTimeout(function(){l._launchSearch()},500)}}}}}).inject(this.elements.container).hide();this.elements.input.elements.input.addEvent("blur",function(){l._hideSearchInput()});e.onSearchChange(function(m){l.elements.input.setValue(m)});if(widget){widget.addEvent("onSearch",function(m){e.changeSearch(m,true);l.switchSearch(true)});widget.addEvent("onResetSearch",function(){e.clearSearch();l.switchSearch(false)})}},changeFolderPlaceholder:function(l){var k=c.replace(c.SearchInFolder,{folderName:l});this._changePlaceholder(k)},_changePlaceholder:function(k){if(this.elements.input.elements.input){this.elements.input.elements.input.setAttribute("placeholder",k)}},_launchSearch:function(){this._timerLastKey=null;var k=this.getValue();k=k.trim();e.changeSearch(k,true)},getValue:function(){return this.elements.input.getValue()},clearValue:function(){e.clearSearch()},});return b});define("DS/FolderEditor/views/FolderOrderCmd",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol"],function(g,b,a,c,d,e){var f=g.extend(b,a,{_name:"folder_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function(h){this._parent(h);this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode;this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder;this._buildSkeleton()},_buildSkeleton:function(){var h=this,i;this.elements.container=UWA.createElement("div",{id:"folder_orderTools"});i="sprite_az sprite";i+=this.sortMode==="alpha"?(this.sortOrder==="desc"?" desc active":" active"):"";this._alphaElmt=UWA.createElement("span",{"class":i,title:d.alpha_sorting,events:{click:function(j){h.toggleButton(j.target)}}}).inject(this.elements.container);i="sprite_nb sprite";i+=this.sortMode!=="alpha"?(this.sortOrder==="desc"?" desc active":" active"):"";this._dateElmt=UWA.createElement("span",{"class":i,title:d.date_sorting,events:{click:function(j){h.toggleButton(j.target)}}}).inject(this.elements.container)},toggleButton:function(h){if(h.hasClassName("active")){h.toggleClassName("desc")}else{var i=this.elements.container.getElement(".active");if(i){i.removeClassName("active")}h.addClassName("active")}this.sortOrder=h.hasClassName("desc")?"desc":"asc";this.sortMode=h.hasClassName("sprite_nb")?"date":"alpha";this.sortingNodesUnsensitiveCase();widget.setValue("sortMode",this.sortMode);widget.setValue("order",this.sortOrder)},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){var j=this,h=e.getTreeCont();if(h&&h._folders_TreeView){var i=e.getTreeCont()._folders_TreeView.getManager();i.sortColumnContent("tree",{sortOrder:j.sortOrder==="asc"?"asc":"desc",sortMode:j.sortMode,sortFunction:j.mySortFunction})}},sortingChildrenNodes:function(h){var j=this,i=e.getTreeCont()._folders_TreeView.getManager();i.prepareUpdateView();h.sortChildren({isRecursive:true,sortFunction:function(m,l){var k=(j.sortOrder==="asc")?1:-1;return k*j.mySortFunction(m,l)}});i.pushUpdateView()},mySortFunction:function(m,l){var j=this.sortOrder==="asc"?-1:1;var k=m.getParent().plmType==="FolderSection_favorite";if(k){return null}if(m.isRoot()&&l.isRoot()||k){return null}else{if(this.sortMode==="date"){var h;try{h=new Date(m.options.created)>new Date(l.options.created)?1:(new Date(m.options.created)<new Date(l.options.created))?-1:0}catch(i){h=m.options.created<l.options.created?-1:1}finally{return h}}else{return c.compareLabels(m.options.label,l.options.label)}}}});return f});define("DS/FolderEditor/FolderTrashDocument",["DS/Logger/Logger","DS/Tree/TreeDocument","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADUtilsServices","DS/Tree/TreeNodeModel","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServices"],function(d,a,b,h,f,c,j,g,e){var i=a.extend({name:"FolderTrashDocument",_logger:null,_isActive:false,_commandProxy:null,init:function(l){var k=l||{};if(!UWA.is(k.shouldAcceptDrag)){k.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)}this._parent(k);this._logger=d.getLogger(i);this._isActive=true;this._buildCommandProxy()},_buildCommandProxy:function(){var k=this;this._commandProxy=b.create({events:{onRefresh:k._onRefreshTrash.bind(k)}})},_shouldAcceptDrag:function(){return false},activateEventProxy:function(k){this._isActive=k},_onRefreshTrash:function(m){var l=this;if(this._isActive){if(UWA.is(m.authored.physicaldeleteafterlogical,"array")){var k=[];m.authored.physicaldeleteafterlogical.forEach(function(n){k=k.concat(l._getNodesById(n))});this._deleteNodes(k)}if(UWA.is(m.authored.restored,"array")){var k=[];m.authored.restored.forEach(function(n){k=k.concat(l._getNodesById(n))});this._deleteNodes(k)}if(UWA.is(m.authored.deleted,"array")){this.refreshContent()}}},_getNodesById:function(m){var l=[];var k=this.getChildren();k.forEach(function(n){var o=n.getID()===m?n:null;if(o){l=l.concat(o)}});return l},_deleteNodes:function(k){var l=this;this.prepareUpdate();k.forEach(function(m){if(m.isRoot()){l.removeRoot(m)}else{m.remove()}});this.pushUpdate()},refreshContent:function(){var k=g.getTrashCont();if(k){k.setMask()}var o=this;try{e.getDeletedItems(function n(p){var q;if(p){q=p.content}o.empty();o.prepareUpdate();if(Array.isArray(q)){q.forEach(function(t){var s=j.convertToExaleadDataFormat(t);s.children=null;s.useAsyncPreExpand=false;var r=new f(s);r.id=t.id;r.getID=function(){return this.id};o.addRoot(r)})}if(k){k.endloadingNodeEvent()}o.pushUpdate()},function l(p){c.displayNotification({message:p,className:"error"});o._logger.warn("LifecycleServices.getDeletedItems returns errorMsg : "+p);o.empty();if(k){k.unsetMask()}})}catch(m){o._logger.error("Error when calling LifecycleServices.getDeletedItems",m);o.empty();if(k){k.unsetMask()}}}});return i});define("DS/FolderEditor/views/FolderPathSeparator",["UWA/Controls/Abstract","UWA/Class/Options","DS/FolderEditor/utils/FolderEditorcontrol","DS/UIKIT/DropdownMenu","DS/FolderEditor/utils/FolderAlert"],function(f,a,e,b,c){var d=f.extend(a,{_dropDownCreated:false,_dropdownElmt:null,_separator:null,_folderInfo:null,_subFolders:null,_activeIconFont:"",_unactiveIconFont:"",init:function(g){this._parent(g);this._folderInfo=g.folderInfo||null;this._activeIconFont=g.activeIconFont||"fonticon-down-dir";this._unactiveIconFont=g.unactiveIconFont||"fonticon-right-dir"},getSubFolder:function(g){if(this._subFolders===null||g>=this._subFolders.length){return null}return this._subFolders[g]},addSubFolder:function(h,g){if(this._subFolders===null){this._subFolders=[]}if(g){this._subFolders.splice(0,0,h)}else{this._subFolders.push(h)}this._dropDownCreated=false},removeSubFolder:function(g){if(this._subFolders===null||g>=this._subFolders.length){return false}var h=this._subFolders.splice(g,1);this._dropDownCreated=false;if(this._dropdownElmt&&this._dropdownElmt.isVisible){this._dropdownElmt.hide()}return true},hide:function(){if(this._dropdownElmt&&this._dropdownElmt.isVisible){this._dropdownElmt.hide();this._dropDownCreated=false}if(this._separator){this._separator.hide()}},show:function(){if(this._separator){this._separator.show()}},isVisible:function(){var g=this._separator.getStyle("display");return g!=="none"},buildPathSeparatorElement:function(){var g=this;this._separator=UWA.createElement("div",{"class":"separatorIdCard fonticon "+this._unactiveIconFont,styles:{cursor:"pointer"},events:{click:function(h){if(!g._dropDownCreated){g._buildDropDownPath()}},}});return this._separator},flush:function(){this._clearDropDown;this._dropDownCreated=false;this._subFolders=null},_clearDropDown:function(){if(this._dropdownElmt){this._dropdownElmt.destroy();this._dropdownElmt=null}},_buildDropDownPath:function(){var g=this;if(this._subFolders===null&&this._folderInfo===null){return null}this._clearDropDown();if(this._subFolders){g._dropDownCreated=true;this._buildDomDropdownElmt(this._subFolders)}else{this._folderInfo.getChildrenInfos({onComplete:function(h){g._dropDownCreated=true;g._buildDomDropdownElmt(h)},onFailure:function(h){g._dropDownCreated=false;c.displayNotification({message:Nls.replace(Nls.get("msg_error_FolderActivate"),{name1:name}),className:"error"})}})}},_buildDomDropdownElmt:function(i){var h=this,g=[];if(i.length>0){i.forEach(function(j){g.push({text:j.getLabel(),title:j.getLabel(),handler:function(){h._callExpandAndSelectRequest(j.getID(),j.getType(),j.getLabel())}})});this._dropdownElmt=new b({target:this._separator,className:"folder_ctx_menu",items:g,position:"bottom left",events:{onShow:function(){h._separator.removeClassName(h._unactiveIconFont);h._separator.addClassName(h._activeIconFont)},onHide:function(){h._separator.removeClassName(h._activeIconFont);h._separator.addClassName(h._unactiveIconFont)},}});this._checkSizeOverflowDropdownMenu();this._dropdownElmt.show()}},resizeWidgetCallback:function(){if(this._dropdownElmt&&this._dropDownCreated){this._dropDownCreated=false;if(this.isVisible()){this._dropdownElmt.hide()}}},_checkSizeOverflowDropdownMenu:function(){var l,g,i,m,k,h,q,p,o,j,n;if(!this._dropdownElmt){return false}h=this._dropdownElmt.elements.container;q=this._dropdownElmt.options;l=q.target;i=document.documentElement.clientHeight||window.innerHeight;k=document.documentElement.clientWidth||window.innerWidth;if(!h.isInjected()){this._dropdownElmt.inject(q.renderTo?q.renderTo:document.body);h.setStyle("display","")}g=h.offsetHeight;m=h.offsetWidth;j=l.getOffsets().y+l.offsetHeight;p=(i-j-20)>0?(i-j-20):(i-j);if(g>p){h.setStyle("height",p);h.setStyle("overflow-y","auto");m+=20;h.setStyle("width",m)}n=l.getOffsets().x+l.offsetWidth;o=(k-n-20)>0?(k-n-20):(k-n);if(m>o){h.setStyle("width",o)}},_callExpandAndSelectRequest:function(j,h,g){var i=e.getTreeCont();i.expandTreeAndSelectFolder({folderToFindAndSelect:{id:j,type:h,name:g},onComplete:function(k){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(k){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(k){c.displayNotification({message:Nls.replace(Nls.get("msg_error_FolderActivate"),{name1:g}),className:"error"})}})},});return d});define("DS/FolderEditor/FolderTrashCont",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/Logger/Logger","DS/PADUtils/PADProbes","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADSettingsMgt","DS/Tree/TreeListView","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/FolderEditor/service/FolderTypeService","DS/Utilities/Dom","DS/PADUtils/views/PADStatusInfos","DS/FolderEditor/utils/FolderCommandManager","DS/FolderEditor/FolderTrashDocument","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorUtil","DS/UIKIT/Mask","DS/PADUtils/PADUtilsServices",],function(a,f,q,s,o,u,e,r,h,j,m,d,c,v,t,n,k,p,b,i,w,l){var g=q.extend(s,o,{name:"FolderTrash_Cont",_logger:null,init:function(x){this._parent(x);this._logger=u.getLogger(g);var y=this;y._buildSkeleton();this.dispatchEvent.call(this,"onReady")},render:function(){return this},onViewChange:function(x){this.elements.container.removeClassName(x.previous.type);this.elements.container.addClassName(x.type)},destroy:function(){this._logger.log("destroy");this._parent()},_buildSkeleton:function(){var z=this;if(!a.is(this.elements.container)){this.elements.container=UWA.createElement("div",{"class":this.getClassNames()+"_container"});if(this.getOption("css_view_class")){this.elements.container.addClassName(this.getOption("css_view_class"))}this.elements.listOfDeleteItems_container=UWA.createElement("div",{"class":this.getClassNames()+"_listOfDeleteItems_container"}).inject(this.elements.container);var y={apiVersion:2,height:"auto",defaultCellHeight:80,iconsSize:20,headersDimensions:{height:38},resize:{rows:false,columns:true},selection:{canMultiSelect:false},columns:[{text:FolderEditor["ds6w:label"]?FolderEditor["ds6w:label"]:"ds6w:label",width:"auto",dataIndex:"tree",isDraggable:false,isEditable:false,xnav_options:{name:"ds6w:label"}},{text:FolderEditor["ds6wg:revision"]?FolderEditor["ds6wg:revision"]:"ds6wg:revision",dataIndex:"ds6wg:revision",isDraggable:false,isEditable:false,xnav_options:{name:"ds6wg:revision"}},{text:FolderEditor["ds6w:responsible"]?FolderEditor["ds6w:responsible"]:"ds6w:responsible",dataIndex:"ds6w:responsible",isDraggable:false,isEditable:false,xnav_options:{name:"ds6w:responsible"}},{text:FolderEditor["ds6w:type"]?FolderEditor["ds6w:type"]:"ds6w:type",dataIndex:"ds6w:type",isDraggable:false,isEditable:false,xnav_options:{name:"ds6w:type"}},{text:m.HeaderDeletionDate,dataIndex:"logicalDeleteStamp",isDraggable:false,isEditable:false},{text:m.HeaderDeleteBy,dataIndex:"logicalDeleteBy",isDraggable:false,isEditable:false},{text:FolderEditor["ds6w:organizationResponsible"]?FolderEditor["ds6w:organizationResponsible"]:"ds6w:organizationResponsible",dataIndex:"ds6w:organizationResponsible",isDraggable:false,isEditable:false,xnav_options:{name:"ds6w:organizationResponsible"}},{text:FolderEditor["ds6w:project"]?FolderEditor["ds6w:project"]:"ds6w:project",dataIndex:"ds6w:project",width:"auto",isDraggable:false,isEditable:false,xnav_options:{name:"ds6w:project"}},{text:"",dataIndex:"thumbnail",isHidden:false,width:80,isDraggable:false,isEditable:false}],roots:[]};y.onContextualMenuReady=function(F){function B(G){try{var H=k.getCommand(G);H.begin()}catch(I){_logger.error("Error trying to execute command",G,I,I.stack)}}var E=[];if(F.virtualRowID===-1){return[{label:m.CMDSizeColumnToFit,icon:"url("+d.getWebappsAssetUrl("FolderEditor","icons/32/I_FitToColumn.png")+")",callback:function(){F.manager.sizeColumnToFit(F.dataIndex)}}]}else{if(F.nodeModel){var D=F.nodeModel;var C={label:m.CMDRestore,icon:"url("+d.getWebappsAssetUrl("LifecycleCmd","icons/32/I_Restore.png")+")",callback:function(){B("RestoreDeletedItemsHdr")}};var A={label:m.CMDDeleteDefinitively,icon:"url("+d.getWebappsAssetUrl("LifecycleCmd","icons/32/I_Delete.png")+")",callback:function(){B("DeleteDeletedItemsHdr")}};E.push(C,A);if(D.isSelected()===false){D.select(true)}}}return E};y.shouldDisplayTooltip=function(B){var A="";if(B.isHeader){switch(B.dataIndex){case"thumbnail":A=m.HeaderThumbnail;break;default:if(typeof B.cellModel.options.value==="string"){A=B.cellModel.options.value}break}}else{switch(B.dataIndex){case"tree":A=B.nodeModel.options.label;break;case"thumbnail":A="";break;case"logicalDeleteStamp":A="";break;default:if(typeof B.cellModel.options.value==="string"){A=B.cellModel.options.value}break}}return{longHelp:A}};y.onDragOverCell=function(B,A){if(B&&B.dataTransfer){B.dataTransfer.dropEffect="none"}if(A){A.dropPosition="middle"}return true};y.onDragOverBlank=function(B,A){if(B&&B.dataTransfer){B.dataTransfer.dropEffect="none"}};y.onDragOverColumnHeader=function(B,A){if(B&&B.dataTransfer){B.dataTransfer.dropEffect="none"}};var z=this;r.updateColumnsWithNLS(y.columns,function(A){if(A.state==="success"){z._trashCont_TreeListView.loadColumns(A.columns)}});y=z._enrichViews(y);y.treeDocument=new p();var x=new j(y).inject(z.elements.listOfDeleteItems_container);z._trashCont_TreeListView=x;z._registerReusableCellContent();z._trashCont_TreeListView.getManager().onCellClick(z._onCellClick.bind(z));z.elements.padstatus=new n({renderTo:z.elements.container,events:{onShow:function(){var A=z._getFolderTrashDocument();z.elements.padstatus.setStatus(n.buildStatus({tree_content:{nbObjectsInTree:A.getAllDescendants().length,nbObjectsSelected:A.getSelectedNodes().length}}))}}})}},endloadingNodeEvent:function(){var x=this;this._trashCont_TreeListView.getManager().onPostUpdateViewOnce(function(){var y=this.getOrderedColumnState();if(y){this.sortColumnContent(y.columnID,{sortOrder:y.sortOrder})}x.unsetMask()})},setMask:function(){w.mask(this.elements.container)},unsetMask:function(){w.unmask(this.elements.container)},_getFolderTrashDocument:function(){if(this._trashCont_TreeListView&&this._trashCont_TreeListView.getManager()){return this._trashCont_TreeListView.getManager().getDocument()}else{return null}},hideFolderTrash:function(){var y=b.getTrashCont();y.hide();var x=this._getFolderTrashDocument();x.empty();x.activateEventProxy(false)},showFolderTrash:function(){var y=b.getTrashCont();y.show();var x=this._getFolderTrashDocument();x.refreshContent();x.activateEventProxy(true)},getSelectedNodes:function(){var y=[],x=this._getFolderTrashDocument();if(x){y=x.getSelectedNodes()}return y},_onCellClick:function(y){if(y.cellModel&&y.cellModel.options&&y.cellModel.options.isHeader){return}this.dispatchEvent("onNodeCellClick",y);var x=this._padCustoColumn.getOnCellClickCB(y.dataIndex);if(UWA.is(x,"function")){x.call(this,y)}},_registerReusableCellContent:function(){this._trashCont_TreeListView.getManager().registerReusableCellContent({id:"padresuable_thumbnail",buildContent:function(){return t.createElement("div",{"class":"padthumbnail_cell",styles:{height:"80px","background-repeat":"no-repeat","background-size":"contain","background-position":"center center"}})}})},_enrichViews:function(y){var x=this;if(y.columns){y=i.sortingNodes(y);y.columns.forEach(function(A){var z=A.dataIndex;var B=x._getColumnViewCusto(z);if(UWA.is(B,"function")){A.onCellRequest=B}})}return y},_getColumnViewCusto:function(x){this._logger.log("getColumnViewCusto "+x);return this._column_views[x]},_column_views:{thumbnail:function(y){if(y.manager.getColumnOptions("thumbnail").isHidden===false){if(!y.isHeader&&y.nodeModel.options.thumbnail){var x=y.cellView.reuseCellContent("padresuable_thumbnail");if(x){x.style.backgroundImage="url("+y.nodeModel.options.thumbnail+")"}}}else{return""}},logicalDeleteStamp:function(z){if(!z.isHeader){var y=z.cellModel.options.value;var x=Date.parse(y);if(!isNaN(x)){y=new Date(x).toLocaleString(h.getSetting("lang"))}z.cellView.getContent().setHTML(y)}}}});return g});define("DS/FolderEditor/service/FolderLogicalDeleteServices",["DS/FolderEditor/FolderTrashCont","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings"],function(d,c,b){var a={IsLogicalDeleteActivated:function(f){try{b.isLogicalDeleteActive(function(e){if(f&&f.onComplete){var h=(e===true)?true:false;f.onComplete(h)}})}catch(g){console.error("Error when calling LifecycleServicesSettings.isLogicalDeleteActive",g,g.stack)}},DisplayFolderTrashCont:function(){var e=c.getContent();var f=c.getTrashCont();if(e){e.hide()}if(!f){f=new d({css_view_class:"windowed",events:{onReady:function(){var h=this;c.setTrashCont(h);if(e&&e.options){var g=e.options.renderTo;if(g){g.addContent(h.render())}}h.showFolderTrash()}}})}else{f.showFolderTrash()}},HideFolderTrashCont:function(){var e=c.getContent();var f=c.getTrashCont();if(f){f.hideFolderTrash()}if(e){e.show()}},};return a});define("DS/FolderEditor/FolderComponent",["UWA/Core","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/FolderXNavComponent","DS/ENXNav/models/xNavNodeModel","DS/Tree/TreeNodeModel","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderCommandManager","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/SNResultUX/assets/nls/SNResultUX","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/service/FolderLogicalDeleteServices","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderSearch","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/UIInfra/UIInfra","DS/WidgetServices/WidgetServices","DS/UIKIT/Mask","DS/PADUtils/PADProbes","DS/PADServices/utils/AttributesMgt"],function(b,A,f,e,h,t,n,k,o,B,u,m,i,p,D,r,q,z,d,v,x,C,w,y,l,s,E,g,a){var c=function(F,G){var H=F.dataelements[G];if(b.is(H,"array")){H=H[0]}return H};var j=e.extend({name:"FolderComponent",defaultOptions:{x3dAppId:"FolderEditor",amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",TreeListView:"DS/FolderEditor/FolderTreeListView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView",TreeGraph:"DS/FolderEditor/FolderTreeGraphView"},active_view:k.getDefaultView(),layout:{keyboard_inputs:false,root_panel:false,action_bar:false,statusInfo:false,slidder:false,title_update:false,drop_invite:"none",triptychOpts:{borderLeft:true,withtransition:!s.isReplayedODT(),left:{resizable:true}}}},_contentDiv:null,_cancelContentHandler:function(){if(this._contentHandleRequest){this._contentHandleRequest.cancel()}this._contentHandleRequest=null},init:function(G,F){this._probeLoadElmt=g.createProbe("loadComponent");var H=this;this._maskedElement=null;this._contentDiv=G.renderTo;this._contentHandleRequest=null;this._handlerThumbnails=null;this._treeCont=F;this.setOptions(G);this._parent(this.options);if(!this.elements){this.elements={}}this.elements.tempLeftContent=null;this._logger=A.getLogger(j);require(["DS/PADUtils/views/PADStatusInfos"],function(I){H.elements.padstatus=new I({renderTo:H._contentDiv,events:{onShow:function(){H.elements.padstatus.setStatus(I.buildStatus({tree_content:{nbObjectsInTree:H.getObjectsInTree(),nbObjectsSelected:H.options.model.getSelectedNodes().length}}))}}})});C.onFolderRename(function(I){H._sortingNodesContent(I)})},createRootListSlidder2:function(){return this._treeCont.elements.container},onSetPathTags:function(){if(!w.getSearchValue()){this._parent()}else{this.unColorizeChildren()}},getObjectsInTree:function(){if(!w.getSearchValue()){return this.options.model.getAllDescendants().length}else{return w.getNumberHits()}},onFilterFilteringEvent:function(F){this._onFilterChange(F);if(!w.getSearchValue()){this._parent(F)}},unColorizeChildren:function(){var F=this;F.options.model.withTransactionUpdate(function(){F.options.model.getRoots().forEach(function(H){var G={grid:{bi_color:"rgba(0, 0, 0, 0)"}};H.getAllDescendants().forEach(function(I){delete I.options.color;I.updateOptions(G)})})})},onFilterBIColorize:function(J){var H=J.coloredSubjects;var F=[];if(J.coloredSubjects&&!UWA.is(J.coloredSubjects,"array")){H=[];var I=0;for(var G in J.coloredSubjects){F.push(G);H.push({color:J.coloredSubjects[G],path:[I]});I++}J.nodes=F;J.coloredSubjects=H}this._parent(J)},_onFilterChange:function(F){var G=F.allfilters;if(G){w.setRefine(G)}},_addStyleOnTreeCont:function(F){var G=this.elements.padshell._getLeftWidth();G=!!F&&F>G?F:G;s.addNewStyles("treeContResize",{".FolderTree_Cont-root_container":{overflow:"hidden"},".FolderTree_Cont-root_treeview_container":{width:G+"px !important"}},true)},_OnPADComponentReady:function(){var J=this;this.addEvent("onToggleView",k.setDefaultView);this.elements.padshell.togglePanel("left");var I=k.getTreeListSortColumn();var H=J.getPADTreeListView();if(H&&I){var G=H.getManager();G.sortColumnContent(I,k.getTreeListSortParam())}var K=widget.getValue("customLeftWidth");this._addStyleOnTreeCont(K);this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-show-started"},function(L){if(L==="left"){J._addStyleOnTreeCont()}});this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},function(L){if(L==="left"){s.clearJSStylesheet("treeContResize")}});if(K!=null){this.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:K}})}this.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},function(L){if(L.side==="left"){widget.setValue("customLeftWidth",L.width)}});d.setContent(this);w.setPredicates(a.getAvailableColumns());w.onSearchChange(function(O,L){var U=false;if(!w.isSearchInProgress()&&w.isSearchActive()){var P=J.getPADTreeListView();var S=P?P.getManager():null;var Q=w.getOrderFieldForTree();var V=w.getOrderBy();var M=S.getColumnIDFromDataIndex(Q);U=M&&V;var R=S.getOrderedColumnState();if(R&&(!w.columnIsAvailable(R.dataIndex)||R.columnID!==M)){S.setColumnOrderState(R.columnID,"none")}if(U){S.setColumnOrderState(M,V)}}var T=D.getCurrentFolder();if(T){var N="TREE";m.ItemSelected(T,N,T)}J.loadContentAndSelect()});C.onCurrentFolderChange(function(N){var L=d.getIdCardCont();var M=w.getSearchValue();L.switchSearch(false);if(!M){J.loadContentAndSelect(this)}});var F=D.getCurrentFolder();if(F){this.loadContentAndSelect(F)}this._probeLoadElmt.end()},setFolderCommunicationChannel:function(){},onDragStartCell:function(I,G){v.SetAsExternalDrop(false);var F=o.getDragDataForSelectedNodesInCurrentFolderContent();try{I.dataTransfer.setData("text/searchitems",JSON.stringify(F))}catch(H){}I.dataTransfer.setData("Text",JSON.stringify(F));if(this.getActiveView()!=="graphview"){l.createGhostDnD(I,{number:F.data.items.length})}I.dataTransfer.effectAllowed="copyMove";o.setStartDrag(true);o.setDragFrom("bookmark");I.stopPropagation()},onDragEndCell:function(G,F){o.setStartDrag(false)},onDragEnterCell:function(H,F){if(H&&H.dataTransfer){H.dataTransfer.dropEffect=(o.isDragging()&&o.isMoveDnDSetting()&&!o.hasFilesInEvent(H))?"move":"copy"}var G=F.nodeModel;var I=(G&&G.options)?G.options.type:undefined;if(B.inFamilyFolder(I)){return true}else{this.onDragEnterBlank(H,F);return false}},onDragLeaveCell:function(H,F){if(H&&H.dataTransfer){H.dataTransfer.dropEffect="none"}var G=F.nodeModel;var I=(G&&G.options)?G.options.type:undefined;if(B.inFamilyFolder(I)){return true}else{this.onDragLeaveBlank(H,F);return false}},onDragOverCell:function(H,F){if(H&&H.dataTransfer){H.dataTransfer.dropEffect=(o.isDragging()&&o.isMoveDnDSetting()&&!o.hasFilesInEvent(H))?"move":"copy"}H.preventDefault();var G=F.nodeModel;var I=(G&&G.options)?G.options.type:undefined;if(B.inFamilyFolder(I)){if(F){F.dropPosition="middle"}return true}else{this.onDragOverBlank(H,F);return false}},onDropCell:function(I,F){var H=this;v.SetAsExternalDrop(false);var G=F.nodeModel;var J=(G&&G.options)?G.options.type:undefined;if(B.inFamilyFolder(J)){o.performDropOnFolderEditorNode(G,I);I.preventDefault()}else{H.onDropBlank(I,F)}o.setDragFrom("")},onDragEnterBlank:function(I,G){if(I&&I.dataTransfer){I.dataTransfer.dropEffect=(o.isDragging()&&o.isMoveDnDSetting()&&!o.hasFilesInEvent(I))?"move":"copy"}var F=this.getActiveView();var H=this.getOption("views")[F];if(H&&H.options&&H.options.onDragEnterBlankDefault){H.options.onDragEnterBlankDefault(I,G)}return true},onDragLeaveBlank:function(I,G){if(I&&I.dataTransfer){I.dataTransfer.dropEffect="none"}var F=this.getActiveView();var H=this.getOption("views")[F];if(H&&H.options&&H.options.onDragLeaveBlankDefault){H.options.onDragLeaveBlankDefault(I,G)}return true},onDragOverBlank:function(I,G){if(I&&I.dataTransfer){I.dataTransfer.dropEffect=(o.isDragging()&&o.isMoveDnDSetting()&&!o.hasFilesInEvent(I))?"move":"copy"}var F=this.getActiveView();var H=this.getOption("views")[F];if(H&&H.options&&H.options.onDragOverBlankDefault){H.options.onDragOverBlankDefault(I,G)}return true},onDropBlank:function(H,F){v.SetAsExternalDrop(false);var G=D.getCurrentFolder();o.performDropOnFolderEditorNode(G,H);H.preventDefault();o.setDragFrom("")},onDropColumnHeader:function(G,F){o.setDragFrom("");return true},getOnContextualEvent:function(){return{"this":this,callback:function(F){return this.__onContextualMenuReady(F)}}},__onContextualMenuReady:function(L){var H=null;var K=null;var I=false;if(L.graphview){K=L.graphview;H=K.node}else{if(L.treeview){K=L.treeview;H=K.nodeModel?K.nodeModel:K.cellModel;I=K.isHeader}else{K=L.cellInfos;H=K?K.nodeModel?K.nodeModel:K.cellModel:null}}var G;var M;var J=true;if(K===null||K===undefined){K=D.getCurrentFolder()}if(K.cellView){if(typeof K.cellView.getVirtualCoordinates==="function"){M=K.cellView.getVirtualCoordinates()}else{M={virtualRowID:1}}}else{M={};if(!L.graphview||!H){K.white_Click=J}}if(K.white_Click&&L.treeview){var F=L.treeview?L.treeview.manager.getScroller():null;if(F&&(L.data.target!=F.getContent())){return}}if(H&&H.plmType==="Busy"){return G}if(K.white_Click||M.virtualRowID===-1){G=u.GetContextualMenu(K,"CONTENT")}else{if(H){if(H.isSelected()===false){H.select(true)}if(H.isSelected()===true){if(L.graphview){G=u.GetContextualMenu(H,"CONTENT")}else{G=u.GetContextualMenu(K,"CONTENT")}}}}if(G){G.forEach(function(N){if(N.type==="separator"||N.type==="SeparatorItem"){N.type="SeparatorItem"}else{N.title=N.label;N.action={callback:N.callback};N.type="PushItem"}})}return G},doDnDDragStart:function(G,F,H){this.onDragStartCell(this._createSimulatedEvent(G));return true},doDnDDrop:function(J,H,G,I){this.getPADTreeGraph().getContainer().removeClassName("bordered");var F={nodeModel:H};this.onDropCell(this._createSimulatedEvent(J),F)},shouldAcceptDnDDrop:function(I,G,F,H){return G.plmType!=undefined?B.inFamilyFolder(G.plmType):true},_createSimulatedEvent:function(G){function F(){}return{dataTransfer:G,preventDefault:F,stopPropagation:F}},contextCallback:function(G){var H=G;if(G===null){H=D.getCurrentFolder();H.white_Click=true}if(G){if(G.isSelected()===false){G.select(true)}}var F={context:this,nodes:u.GetContextualMenu(H,"CONTENT")};return F},getActiveView:function(){return this._parent()},loadContent:function(G,F){console.error(new Error("Deprecated function, use loadContentAndSelect instead"));this.loadContentAndSelect(G,F)},removeNodesInContent:function(){var F=this.getPADTreeDocument();if(F){var G=F.getRoots(true).slice(0);F.wrapInTransaction(function(){F.withTransactionUpdate(function(){var I,H=G.length;for(I=0;I<H;++I){G[I].filterIn(true)}F.unselectAll();for(I=0;I<H;++I){F.removeRoot(G[I],true,false)}})});this.cleanProxy()}},_getElementToMask:function(){var G=this._contentDiv;var F=null;if(G){F=G.getElement(".xnav_viewmain")}return F?F:G},_mask:function(){if(this._maskedElement===null){this._maskedElement=this._getElementToMask();E.mask(this._maskedElement)}},_unmask:function(){if(this._maskedElement&&E.isMasked(this._maskedElement)){E.unmask(this._maskedElement)}this._maskedElement=null},loadContentAndSelect:function(M,G){this.probeUpdateUI=g.createProbe("component_updateUI");if(this._handlerThumbnails){this._handlerThumbnails.cancel()}this._handlerThumbnails=null;var K=this;var L;var I;var H;var J=this.getActiveView()==="treelistview"&&this.getPADTreeListView()!==null;if(!M){M=D.getCurrentFolder()}if(M){if(M.getType){L=M.getType()}if(M.getID){I=M.getID()}}if(L==="FolderSection_Trash"){x.DisplayFolderTrashCont()}else{x.HideFolderTrashCont()}var P=w.isSearchActive();if(B.inFamilyFolder(L)&&I){var F="";if(widget.getBool("show-sub-folders")===true){F="All"}var Q="";if(widget.getBool("filtered-content")===true){Q="Yes"}var O=false;if(widget.getBool("allow-products-expand")===true){O="Yes"}this._mask();H=g.createProbe("loadContent_serverCall");var N=w.getSearchValue();this._cancelContentHandler();return new UWA.Class.Promise(function(S,R){d.checkRolesAvailability(function(U,V,T){K._contentHandleRequest=n.content({pid:I,content:F,searchQuery:N,filterChildren:Q,onComplete:function(X){var W=K.getPADTreeDocument();W.wrapInTransaction(function(){M.options.contentAvailable=true;var ay=X.infos;var Z=w.isSearchInProgress();var Y=K.getPADTreeListView();var ai=Y?Y.getManager():null;var af=i.getSetting("activateBIFilter");if(N){w.setInfoIndex(ay)}K._endContentSelect();H.end();K.probeListContent=g.createProbe("listContent");var aj=null;if(D.getCurrentFolder()){aj=D.getCurrentFolder().getID()}if(aj===I){X=typeof X==="string"?JSON.parse(X):X;i.setSetting("settypes",X.modelerName==="UPS");var au=[];var ar=X.content;ar=ar?ar:X.results;if(ar===undefined){if(!Z){K.removeNodesInContent()}if(!N){r.displayNotification({message:q.msg_error_contentnotavailable,className:"error"})}K._unmask();K.probeUpdateUI.end();if(!Z&&af){var ac={nodes:[],paths:[]};K._biFilter.setPathTags(ac);K._biFilter.setTags({},{})}K._endRefreshView()}else{var aw=X.facets;if(!Z){K._currentTags={}}var ax=[];var an=[];var at=0;if(aw!=null&&af){var ab={};ar.forEach(function(aB){var aC=aB.attributes;var aA=null;var az=[];aC.forEach(function(aD){var aF=aD.name;if(aF==="resourceid"){aA=aD.value}else{if(aF.startsWith("ds6w")&&aF.indexOf("/")>0){var aE={object:aD.value,sixw:aF,dispValue:aD.dispValue};if(aD.type){aE.type=aD.type}if(aD.format){aE.format=aD.format}az.push(aE)}}});if(aA){ax.push(aA);an.push([at]);at++;K._currentTags[aA]=az}});var ac={nodes:[],paths:[]};K._biFilter.setPathTags(ac);K._biFilter.setTags(K._currentTags,aw)}var al=[];if(K.RefreshProductStructure&&O){var ae=K.getPADTreeDocument().getRoots();var aq=0;var ag=ae.length;for(aq=0;aq<ag;aq++){var ao=ae[aq];var aa=ao.options.type;if(ae[aq].isExpanded()){al.push(ao)}}}var am=[];if(!Z){var ah=g.createProbe("loadContent_cleanNodes");K.removeNodesInContent();ah.end()}var ad=[];ax=[ad];var av=[];var ap=null;ar.forEach(function(aH){var aG=k.convertToExaleadDataFormat(aH);if(!((V===true)||(U===true)||(T===true))){aG.children=null}if(!O){aG.children=null}var aF=null;al.forEach(function(aL){var aM=aL.id||aL.getID();if(aM===aH.id){aF=aL}});if(ad.length>=1000){ad=[];ax.push(ad)}if(aG.thumbnail&&aG.thumbnail.indexOf("snresources")>=0){ad.push(aH.id)}if(aF==null){if(aG.grid){aG.grid.bi_color="rgba(0, 0, 0, 0)"}var aD=new h(aG);ap=ap?ap:aD;aD.options.grid.thumbnail="url("+aG.thumbnail+")";if(B.isFolder(aH.type)){aD.plmType="Folder"}else{aD.plmType="Content"}aD.id=aH.id;aD._ischeckout=aH.Documentlocked;if(aD._ischeckout==="TRUE"){var aE=f.getWebappsAssetUrl("FolderEditor","icons/32/I_CheckOutDocument.png");aD.updateOptions({badges:{bottomRight:aE}})}if(aH.publishOnConnect==="TRUE"){var aB=f.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");aD.setBadges({bottomRight:aB})}aD.options.oldLabel=aG.label;if(M.isPersonal){aD.isPersonal=true}var az=false;y.getEnforceFolderLinkSettingAsync(function(aM,aL){if(!aM){az=aL}});if(az||d.isCustomizedEnv()||d.isActiveBookmarkActivated()){var aJ=d.getActiveFolder(),aA=aJ.id,aI=aJ.disabledId;if(aA===aD.id){var aK=f.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active.png");aD.setBadges({bottomLeft:aK})}else{if(aI===aD.id){var aK=f.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active_disabled.png");aD.setBadges({bottomLeft:aK})}}}if(UWA.is(G,"array")?G.indexOf(aH.id)>=0:aH.id===G){au.push(aD)}av.push(aD)}else{av.push(aF);am.push(aF);var aC=aF.id||aF.getID();if(UWA.is(G,"array")?G.indexOf(aC)>=0:aC===G){au.push(aF)}}});if(av&&!N){av.sort(K._ascendingSortingRootNodeByTitle)}K.probeAddNode=g.createProbe("loadContent_addNodes");if(J){K._listenEndUIRefreshEvent()}K.addRootNodes(av);if(!J){K._endRefreshView()}if(K.RefreshProductStructure&&al.length>0){K.RefreshProductStructure=false;var ak=K.getPADTreeListView();K.getPADTreeDocument().refresh({treelist:ak,roots:am,cb:function(az){K._logger.log("Refresh PS : "+az.msg)}})}if(ax.length>0){K._loadThumbnails(av,ax,0)}}if(au.length>0){au.forEach(function(az){az.select()});S(au[au.length-1])}}else{K._endRefreshView()}K._endLoadAndSelect()})},onFailure:function(X,W,Z){K._logger.log("WebService content, Err : "+X);K._endContentSelect();K.removeNodesInContent();var Y;if(X.type==="timeout"){Y=q.msg_error_timeout}else{if(P&&W&&typeof W==="object"&&W.error&&W.error.errorCode){Y=W.error.errorCode==="innerError"?W.error.errorMessage:z.get(W.error.errorCode)}else{M.options.contentAvailable=false;Y=q.msg_error_contentnotavailable}}r.displayNotification({message:Y,className:"error"});K._unmask();K._endLoadAndSelect()}})})})}else{if((L=="FolderSection_AllFolders")&&!P){K._mask();H=g.createProbe("loadContent_serverCall");return new UWA.Class.Promise(function(S,R){K._cancelContentHandler();K._contentHandleRequest=n.roots({onComplete:function(Y){H.end();K.probeListContent=g.createProbe("listContent");var W="";if(D.getCurrentFolder()){W=D.getCurrentFolder().getType()}if(W=="FolderSection_AllFolders"){var V=g.createProbe("loadContent_cleanNodes");K.removeNodesInContent();V.end();Y=JSON.parse(Y);var U=Y.folders;var X=[];var T=[];U.forEach(function(ae){var ad=k.convertToExaleadDataFormat(ae);var ac=new h(ad);ac.plmType="RootFolder";ac.id=ae.id;ac.options.oldLabel=ad.label;if(B.isPersonalFolder(ad.type)){ac.isPersonal=true}if(ae.publishOnConnect==="TRUE"){var ab=f.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");ac.setBadges({bottomRight:ab})}var Z=false;y.getEnforceFolderLinkSettingAsync(function(aj,ai){if(!aj){Z=ai}});if(Z||d.isCustomizedEnv()||d.isActiveBookmarkActivated()){var ag=d.getActiveFolder(),aa=ag.id,af=ag.disabledId;if(aa===ac.id){var ah=f.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active.png");ac.setBadges({bottomLeft:ah})}else{if(af===ac.id){var ah=f.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active_disabled.png");ac.setBadges({bottomLeft:ah})}}}if(UWA.is(G,"array")?G.indexOf(ae.id)>=0:ae.id===G){T.push(ac)}X.push(ac)});if(X){X.sort(K._ascendingSortingRootNodeByTitle)}K.probeAddNode=g.createProbe("loadContent_addNodes");if(J){K._listenEndUIRefreshEvent()}K.addRootNodes(X);if(!J){K._endRefreshView()}if(T.length>0){T.forEach(function(Z){Z.select()});S(T[T.length-1])}}else{K._endRefreshView()}K._endLoadAndSelect()},onFailure:function(T){K._logger.log("WebService roots, Err : "+T);K._manageError(arguments[0],arguments[1],arguments[2],q.get("Can't retrieve the roots"));K.removeNodesInContent();K._endRefreshView();K._endLoadAndSelect()}})})}else{if((L=="FolderSection_favorite")&&!P){K._mask();if(UWA.is(d.getTreeCont())){H=g.createProbe("loadContent_serverCall");K._cancelContentHandler();K._contentHandleRequest=d.getTreeCont().getFavorites({onComplete:function(X){H.end();K.probeListContent=g.createProbe("listContent");var V="";if(D.getCurrentFolder()){V=D.getCurrentFolder().getType()}if(V=="FolderSection_favorite"){var S=g.createProbe("loadContent_cleanNodes");K.removeNodesInContent();S.end();var T=X;var U=f.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var Y=f.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark108x144.png");var W=[];var R=[];T.forEach(function(ab){var ae=(ab.type)?ab.type:"Folder";var Z=(ae=="RootFolder")?q.name_RootFolder_type:q.name_Folder_type;var aa={id:ab.id,type:ae,displayType:Z,label:ab.name,name:ab.name,description:"",created:"",modified:"",owner:"",responsible:"",organizationResponsible:"",project:"",revision:"",status:"",policy:"",icon:U,largeicon:Y};var ad=k.convertToExaleadDataFormat(aa);var ac=new h(ad);ac.plmType=ae;ac.id=ab.id;ac.isFavorite=true;ac.options.oldLabel=ad.label;ac.isPersonal=ab.isPersonal;if(UWA.is(G,"array")?G.indexOf(ab.id)>=0:ab.id===G){R.push(node)}W.push(ac)});K.probeAddNode=g.createProbe("loadContent_addNodes");if(J){K._listenEndUIRefreshEvent()}K.addRootNodes(W);if(!J){K._endRefreshView()}if(R.length>0){R.forEach(function(Z){Z.select()})}}else{K._endRefreshView()}K._endLoadAndSelect()},onFailure:function(R){K._logger.log("getFavorites, Err : "+R);K._manageError(arguments[0],arguments[1],arguments[2]);K.removeNodesInContent();K._endRefreshView();K._endLoadAndSelect()}})}}else{if(P){w.clearSearch()}K.removeNodesInContent();K._unmask();K.probeUpdateUI.end();K._endLoadAndSelect()}}}},_manageError:function(M,K,F,J){var I=null;try{I=JSON.parse(K)}catch(L){I=null}var H=I&&I.error?I.error:J;var G=d._isSecurityCTXInitialized;if(G){if(H){r.displayNotification({message:H,className:"error"})}}},_loadThumbnails:function(G,I,F){var H=this;H._handlerThumbnails=n.loadThumbnails({ids:I[F],onComplete:function(L){if(!L){return}H._handlerThumbnails=null;if(I.length>F+1){H._loadThumbnails(G,I,F+1)}var J=L.results;var K={};if(J){J.forEach(function(M){var N=M.attributes;var P=null;var O=null;N.every(function(Q){if(Q.name==="preview_url"){O=Q.value;O=O.indexOf("snresources")<0?O:null;if(P||!O){return false}}else{if(Q.name==="resourceid"){P=Q.value;if(O){return false}}}return true});if(P&&O){K[P]=O}});G.forEach(function(M){var O=M.getID();var N=K[O];if(N){M.updateOptions({thumbnail:N,grid:{thumbnail:"url("+N+")"}})}})}},onFailure:function(){H._handlerThumbnails=null;console.log("Failure during thumbnail retrieval")}})},_endLoadAndSelect:function(){var I=D.getCurrentFolder();var H=d.getIdCardCont();H.manageSearchVisibility(I);var G=this.getPADTreeListView();var F=G?G.getManager():null;if(F){if(this._componentScrollerPosition){F.setScrollerPosition(this._componentScrollerPosition)}else{F.setScrollerPosition({x:0,y:0},false)}this._componentScrollerPosition=null}},_endContentSelect:function(){var H=this.getPADTreeListView();var G=H?H.getManager():null;var F=w.getNumberLastResult();if(G){G.infiniteScrollAsyncProcessDone()}},_listenEndUIRefreshEvent:function(){var G=this,F=this.getPADTreeListView();var H=new Promise(function(K,J){if(G.getActiveView()!=="treelistview"){K()}else{var I=function(){G.removeEvent("onToggleView",I);K()};G.addEvent("onToggleView",I);if(F){F.getManager().onPostUpdateViewOnce(function(){if(!w.isSearchInProgress()){var L=this.getOrderedColumnState();if(L){this.sortColumnContent(L.columnID,{sortOrder:L.sortOrder})}}I()})}}});H.then(function(){G._endRefreshView()})},_endRefreshView:function(){this._unmask();this.dispatchEvent("onCompleteRefreshNodes",D.getCurrentFolder().getID());var I=null;var H=w.getPreviousView();var F=d.getContent().getActiveView();if(w.isSearchActive()){if("treelistview"!==F){I="treelistview"}w.setPreviousView(F)}else{var H=w.getPreviousView();if(H&&H!==F){I=H}w.setPreviousView(null)}if(I){var G=m.getCommand(I);G.begin()}if(this.probeAddNode){this.probeAddNode.end()}if(this.probeUpdateUI){this.probeUpdateUI.end()}if(this.probeListContent){this.probeListContent.end()}},removeNodeInContent:function(G){var F=this.getPADTreeDocument();F.getRoots().forEach(function(H){var I=H.id||H.getID();if(I===G){F.removeRoot(H)}})},addDummyRootNodes:function(N){var L=[];for(var M=0;M<N.length;M++){var I=N[M];var F;if(I instanceof h){I.options.display=I.options.label;F=I;var H=f.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif");F.setBadges({topRight:H})}else{var G={};F=new h(G);F.setState({state:"noChildren"});F.childComputed=true;F.options.children=null;F.options.label=I.label;F.options.oldLabel=I.label;F.options.display=I.label;F.options.resourceid=I.tempId;F.options.id=I.tempId;F.options.isNotManagedByPS=true;F.id=I.tempId;F.options.tempId=I.tempId;var K=f.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif");F.options.icons=[K]}F.plmType="Busy";if(!(I instanceof h)){L.push(F)}else{var J=[];F.updateAttributes(J,a.getAvailableColumns())}}this.addRootNodes(L)},updateRootNode:function(F,J){var H=this.getPADTreeDocument();if(F instanceof h){F.plmType="Content";F.setBadges({topRight:""});F.options.label=F.options.display;var I=[];F.updateAttributes(I,a.getAvailableColumns());if(F._isSelected===true){D.addInFolderCSO(F,"CONTENT")}}else{var G;var K=[];H.getRoots().forEach(function(L){if(L.options.label.indexOf(c(F,"title"))>-1&&L.id===F.tempId&&L.plmType==="Busy"){G=K.concat(L)}else{if(L.id===F.id&&L.plmType==="Busy"){G=K.concat(L)}else{if(L.tempId===J&&L.plmType==="Busy"){G=K.concat(L)}}}});if(G){G.forEach(function(N){var M={id:F.id,label:c(F,"title"),type:"Document",revision:c(F,"revision"),description:c(F,"description"),modified:c(F,"modified"),created:c(F,"originated"),policy:"",organizationResponsible:"",project:"",responsible:"",locked:"FALSE",locker:"",isLastMinorRevision:"TRUE"};N.id=F.id;var O=k.convertToExaleadDataFormat(M);var L=k.convertToArray(O);if(F.isDownloadable){N.options.isDownloadable=true}N.options.label=c(F,"title");N.options.icons=[p.get3DSpaceUrl()+"/snresources/images/icons/small/I_CDM_Document.png"];N.options.thumbnail=p.get3DSpaceUrl()+"/snresources/images/icons/large/I_CDM_Document108x144.png";N.plmType="Content";N.options.resourceid=F.id;N._ischeckout="FALSE";N.updateOptions({badges:null});N.updateAttributes(L,a.getAvailableColumns());if(N._isSelected===true){D.addInFolderCSO(N,"CONTENT")}})}}},expandBranches:function(I){if(I<=0){return null}var G=this.getPADTreeDocument(),H={onComplete:function(){if(I.length){var K=I[I.length-1];var J=G.getNodesById(K);if(J&&J.length===1){J[0].select(true)}}}};if(G.searchRootById(I[0])){G.insertBranches([I],H)}else{var F=widget.getBool("filtered-content")?q.msg_warning_notProductRootInFilteredContext:q.msg_warning_notProductRoot;r.displayNotification({message:F,className:"warning"})}},switchFolderTreeNodeLabelToWriteView:function(G){var H=false;if((G instanceof t)&&(B.inFamilyFolder(G.plmType))&&(this.getPADTreeDocument())&&(G.getTreeDocument()===this.getPADTreeDocument())){var F;if(this.getActiveView()==="treelistview"){F=this.getPADTreeListView()}var K=F?F.getManager():undefined;if(K){var J=K.getCell(G._getRowID(),"tree");var I=J?J.getView():undefined;if(I){I.switchToWriteView();H=true}}}return H},_sortingNodesContent:function(H){var F=this.getPADTreeListView();if(F&&H){var G=F.getManager();var I=G.getOrderedColumnState();if(I){G.sortColumnContent(I.columnID,I)}else{G.sortColumnContent("tree");G.setColumnOrderState("tree","none")}G.scrollToNode(H,"middle")}},_ascendingSortingRootNodeByTitle:function(I,G){var H=B.inFamilyFolder(I.plmType);var F=B.inFamilyFolder(G.plmType);if(H&&!F){return -1}else{if(!H&&F){return 1}else{return k.compareLabels(I.options.label,G.options.label)}}}});return j});define("DS/FolderEditor/PersonalFolderManager",["DS/FolderEditor/service/FolderEditorWebService","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderTypeService"],function(b,c,i){var f=null;var d=undefined;var a=d;var e=false;function j(k){if(k){return{id:k.id,name:k.name,type:k.type,isPersonal:k.isPersonal}}else{return undefined}}function h(k){if(undefined!==k){a=k}}var g={getPersonalFolder:function(){return a},isInitialized:function(){return e===true},resetToPreInitializedState:function(){a=d;e=false},getPersonalRootFolderInFavoriteFormat:function(){return j(a)},isPersonalFolderToBeKept:function(l){var k=false;if(l&&(i.isPersonalFolder(l.type)||(i.isRootFolder(l.type)&&l.isPersonal))){k=true}return k},setupPersonalFolder:function(){var k=this;return new UWA.Class.Promise(function(m,l){if(e===true){l()}else{b.roots({type:"Personal",collabSpace:"All",onComplete:function(t){t=JSON.parse(t);var o=t.folders;h(f);var q=o?o.length:0;for(var p=0;p<q;p++){var s=o[p];if(i.isPersonalFolder(s.type)){var r={useAsyncPreExpand:true};var n=c.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");r.label=s.label;r.icons=[n];r.children=[];r.id=s.id;r.plmType="RootFolder";r.type=s.type;r.name=r.label;r.isPersonal=true;h(r);e=true;break}}m()},onFailure:function(n){h(f);e=true;l(n)}})}})}};return g});define("DS/FolderEditor/FolderTreeCont",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Logger/Logger","DS/Tree/Tree","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Tree/TreeNodeView","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/Folder_CSO","DS/PADUtils/PADCommandProxy","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/commands/FolderCommands","DS/PlatformAPI/PlatformAPI","DS/FolderEditor/utils/UserPreference","DS/FolderEditor/Folder_Clipboard","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/FolderEditor/PersonalFolderManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/views/FolderOrderCmd","DS/FolderEditor/service/FolderLogicalDeleteServices","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADProbes","DS/Utilities/Utils"],function(o,e,O,q,N,C,a,j,B,v,l,J,h,I,F,P,K,E,w,m,y,s,t,r,k,A,n,M,f,x,Q,c,p,u,G){var D="favorites";var d="subFolders";var b=J.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var g=J.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png");var i=J.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");var z=J.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");function L(R){return R._modelEvents}var H=O.extend(q,N,{name:"FolderTree_Cont",time_to_expand_node:1500,_folders_TreeDocument:null,_folders_TreeView:null,_logger:null,_folderContentView:null,_commandProxy:null,_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_folders_SortElmt:null,_probeLoadElmt:null,_currentDragEnterFolder:null,_timerDragEnter:null,propIDCard:"not initialized!",defaultOptions:{limitExpand:2000},init:function(R){var S=this;this._probeLoadElmt=u.createProbe("loadTreeCont");this._parent(R);this._folderStructurePreference.options=this.options;this.elements.container=UWA.createElement("div",{"class":this.getClassNames()+"_container"});n.app_initialization(function(){S._buildUI()})},_buildUI:function(){this._rootServiceHandler=null;this._logger=a.getLogger(H);var S=this;this._commandProxy=F.create({events:{onRefresh:S._onRefresh.bind(S)}});E.onFolderRename(function(W){var U=W.getID();var V=W.getLabel();S.updateNodeLabel(U,V)});var R=x.subscribe("FolderEditor.RequestCurrentFolder",function(){K.dipatchSecurityContextAndFolder()});E.onCurrentFolderChange(function(Y){var ab=u.createProbe("treeCont_updateUI");S._folderStructurePreference.select(this.pathId);if(this.id&&this.id!==""&&y.inFamilyFolder(this.plmType)){var U=I.getCurrentFolderPath();var Z=[];var ac=Array.isArray(U)?U.length:0;for(var V=0;V<ac-1;V++){Z.push({resourceid:U[V].id,type:U[V].type})}var X={};if(ac>=1){var aa=ac-1;if(U[aa].id){X[U[aa].id]={type:U[aa].type,label:U[aa].label}}}var W=[];if(Y.currentNode&&!y.isSection(Y.currentNode.getType())){W=[Y.currentNode]}n.setObject_on_compass({nodes_2_open:W});S._commandProxy.select({paths:[[this.id]],attributes:X,folderPath:Z,doNotSetOnCompass:true})}else{if(this.plmType==="FolderSection_Trash"||this.plmType==="FolderSection_AllFolders"||this.plmType==="FolderSection_favorite"){S._commandProxy.select({paths:[],attributes:{},folderPath:[],doNotSetOnCompass:true})}}S._scrollOnPostUpdateView(Y.currentNode);K.dipatchSecurityContextAndFolder();ab.end()});S._buildSkeleton();S._folders_SortElmt=new Q();var T=this._folders_TreeView?this._folders_TreeView.getDocument():undefined;this._folders_TreeDocument=T;if(T){T.options.shouldBeEditable=K.shouldBeEditable;T.onNodeModelUpdate(K.onNodeModelUpdate);T.options.shouldAcceptDrag=this._shouldAcceptDrag.bind(this);T.options.shouldAcceptDrop=this._shouldAcceptDrop.bind(this);T.onPreExpand(this._onPreExpandTreeNode.bind(this));T.getXSO().onChange(function(X){var U=S._folders_TreeDocument.getXSO().get();if(U&&U.length>0){var W=U[U.length-1];if(!W.getID){W.getID=function(){return this.id}}if(!W.getType){W.getType=function(){return this.plmType}}var V=I.getCurrentFolder();if(V!==W){I.addInFolderCSO(W,"TREE")}}})}f.checkSecurityCTXandTenantInitialization(function(){p.app_initialization(function(){p.getEnforceFolderLinkSettingAsync(function(Z,V){if(!S._rootNodeFavorite){var Y=J.getWebappsAssetUrl("FolderEditor","icons/starBlue_v2.png");var X={useAsyncPreExpand:true};X.label=w.name_Section_FavoriteFolders;X.icons=[Y];X.children=[];X.id="";X.plmType="FolderSection_favorite";S._rootNodeFavorite=S._createTreeNodeModel(X,S._folders_TreeDocument);var W=J.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png");var U={useAsyncPreExpand:true};U.label=w.name_Section_AllFolders;U.icons=[W];U.children=[];U.id="";U.plmType="FolderSection_AllFolders";S._rootNodeFolders=S._createTreeNodeModel(U,S._folders_TreeDocument);c.IsLogicalDeleteActivated({onComplete:function(aa){if(aa){var ac=J.getWebappsAssetUrl("FolderEditor","icons/trash.png");var ab={useAsyncPreExpand:true};ab.label=w.name_Section_Trash;ab.icons=[ac];ab.children=null;ab.id="";ab.plmType="FolderSection_Trash";S._rootNodeTrash=S._createTreeNodeModel(ab,S._folders_TreeDocument)}},onFailure:function(aa){}});S.dispatchEvent.call(S,"onReady");S._probeLoadElmt.end()}})})})},_getIcon:function(S,T){var R=T!==d&&f.isCustomizedEnv();var V=S.icon;V=z;var U=null;if(S.type&&y.isPersonalFolder(S.type)){U=R||!V?i:V}else{if(T===D){U=b}else{U=R||!V?g:V}}return U},_refreshNodes:function(S){for(var R=0;R<S.length;R++){this.updateNodeLabel(S[R])}},_getAllRoots:function(){var S=this._folders_TreeDocument.getRoots();var R=[];S.forEach(function(T){if(T.plmType==="FolderSection_AllFolders"){R=T.getChildren()}});return R},_onRefresh:function(U){var T=this;if(U&&U.authored){if(U.authored.modified&&UWA.is(U.authored.modified,"array")){this._refreshNodes(U.authored.modified)}if(U.authored.deleted&&UWA.is(U.authored.deleted,"array")&&U.authored.deleted.length>0){var R=this._getAllRoots();var S=false;R.every(function(V){S=!!V&&U.authored.deleted.indexOf(V.id)>=0;return !S});if(S){this.refreshFolderTreeAndContent(U.authored.deleted)}else{this._refreshNodes(U.authored.deleted)}}}},render:function(){return this},onViewChange:function(R){this.elements.container.removeClassName(R.previous.type);this.elements.container.addClassName(R.type)},destroy:function(){this._logger.log("destroy");this._parent()},_buildSkeleton:function(){var S=this;this.elements.container=UWA.createElement("div",{"class":this.getClassNames()+"_container"});if(this.getOption("css_view_class")){this.elements.container.addClassName(this.getOption("css_view_class"))}this.elements.folderTreeView_container=UWA.createElement("div",{"class":this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var R={apiVersion:2,useAsyncPreExpand:true,allowUnsafeHTMLContent:false,height:"auto",defaultCellHeight:38,onContextualEvent:{"this":this,callback:function(U){return this.__onContextualMenuReady(U)}},columns:[{dataIndex:"tree"}],onDragStartCell:this._onDragStartCell.bind(this),onDragEndCell:this._onDragEndCell.bind(this),onDragLeaveCell:this._onDragLeaveCell.bind(this),onDragOverCell:this._onDragOverCell.bind(this),onDropCell:this._onDropCell.bind(this),onDragEnterBlank:this._onDragEnterBlank.bind(this),onDragLeaveBlank:this._onDragLeaveBlank.bind(this),onDragOverBlank:this._onDragOverBlank.bind(this),onDropBlank:this._onDropBlank.bind(this),isEditable:true,enableScrollOnDrag:true};R.selection={toggle:false,canMultiSelect:false,unselectAllOnEmptyArea:false,};R.cellClass=l.extend({init:function(U){this._parent(U)},updateInternalParameters:function(){this._parent();var U=this.getCellInfos();if(!U.isHeader){if(U.nodeModel.options.isBeingCut){U.cellView.getContent().addClassName("folder-state-is-being-cut")}else{U.cellView.getContent().removeClassName("folder-state-is-being-cut")}}}});var T=new j(R).inject(this.elements.folderTreeView_container);this._folders_TreeView=T;T.onNodeDblClick(function(U){if(U.nodeModel._isExpanded===true){U.nodeModel.collapse()}else{U.nodeModel.expand()}})},_populateFavoriteSection:function(R){var S=this;if(!S._rootNodeFavorite){if(R&&R.onFailure){R.onFailure(new Error("FolderSection_favorite node does not yet exist"))}return}else{if(S._rootNodeFavorite._isPopulated){if(R&&R.onComplete){R.onComplete()}return}}S.getFavorites({onComplete:function(V){var T=V;var U={useAsyncPreExpand:false};T.forEach(function(W){U.label=W.name;U.isPersonal=W.isPersonal;var X=S._getIcon(W,D);if(y.isPersonalFolder(W.type)){U.isPersonal=true}U.icons=[X];U.children=null;U.id=W.id;U.mxid=W.mxid;if(W.type){U.plmType=W.type}else{U.plmType="Folder"}U.isFavorite=true;var Y=S._createTreeNodeModel(U,S._rootNodeFavorite);Y.setState({state:"noChildren"})});S._rootNodeFavorite._isPopulated=true;if(R&&R.onComplete){R.onComplete()}},onFailure:function(T){S._logger.warn("FolderTreeCont : unable to initialize list of Favorite Folders",T);if(R&&R.onFailure){R.onFailure(T)}}})},_refreshFavoriteSection:function(R){var S=this;if(!S._rootNodeFavorite){S._logger.log("FolderTreeCont : FolderSection_favorite node does not yet exist");if(R&&R.onFailure){R.onFailure(new Error("FolderSection_favorite node does not yet exist"))}}else{S._rootNodeFavorite.removeChildren();S._rootNodeFavorite._isPopulated=false;M.resetToPreInitializedState();S._populateFavoriteSection(R)}},_onPreExpandTreeNode:function(U){var S=U.data.nodeModel;if(U.data.onlyUI){S.preExpandDone();return}var T=this;f.isCustomizedEnv();var V;T._folderStructurePreference.getExpandedChildren(U.parent.pathId,function(W){V=W});if(S.plmType!=="FolderSection_favorite"){S.removeChildren();if(S.plmType=="FolderSection_AllFolders"){if(this._rootServiceHandler){this._rootServiceHandler.cancel()}}var R=S.getNodeDepth();h.folderTree({pid:S.id,level:U.data.expandLevel,expandList:V,isRoot:S.plmType==="FolderSection_AllFolders",onComplete:function(aa){aa=JSON.parse(aa);if(aa.error){P.displayNotification({message:aa.error.message,className:"error"});S.loadHasFailed=true;S.preExpandDone();S.collapse();return}S.removeChildren();var W=aa.folders;var Z={0:S};var X=false;W.forEach(function(ac){var ab={useAsyncPreExpand:true};ab.label=ac.label;ab.icons=[T._getIcon(ac,d)];ab.children=[];ab.id=ac.id;ab.mxid=ac.mxid;ab.plmType="Folder";ab.created=ac.created;if(UWA.is(ac.publishOnConnect)){ab.publishOnConnect=ac.publishOnConnect}ab.folderClassification=ac.folderClassification;var ae=(ac&&ac.level)?parseInt(ac.level):1;if(ae===1&&S.plmType=="FolderSection_AllFolders"){if(y.isPersonalFolder(ac.type)){ab.isPersonal=true}var ad=T._getIcon(ac);ab.icons=[ad];ab.plmType="RootFolder";if(UWA.is(ac.publishOnConnect)){ab.publishOnConnect=ac.publishOnConnect}}Z[ae]=T._createTreeNodeModel(ab,Z[ae-1]);if(!U.data.expandLevel){if(V.indexOf(ab.id)!==-1){Z[ae].expand({onlyUI:true})}}});S.loadHasFailed=false;if(!X){S.preExpandDone()}if(U.data.expandLevel&&W.length>0){var Y={onlyUI:true,initialLevel:R,expandLevel:U.data.expandLevel,clearLast:U.data.clearLast};if(U.data.expandLevel==="All"){Y.expandAll=true;S.prepareUpdate();S.expandNLevels(Y)}else{Y.numberOfLevelsToExpand=U.data.expandLevel;S.expandNLevels(Y)}}T._folders_SortElmt.sortingNodesUnsensitiveCase();if(S.options.children===null){S.options.children=[]}},onFailure:function(W){S.loadHasFailed=true;S.preExpandDone();T._logger.log("WebService folders Err : "+W)}})}else{if(S.plmType==="FolderSection_favorite"){T._refreshFavoriteSection({onComplete:function(){S.preExpandDone()}})}else{S.preExpandDone()}}},_onDragStartCell:function(Y,ac){k.SetAsExternalDrop(false);var U=ac.nodeModel;var aa=U.getID();var R=U.plmType;var Z="";if(R=="Folder"){Z="Workspace Vault"}else{if(R=="RootFolder"){if(U.isPersonal){Z="Personal Workspace"}else{Z="Workspace"}}else{Z=R}}var ae=R;var ad=null;var X=U.getParent();if(X&&!X.isRoot()&&y.inFamilyFolder(X.plmType)){ad=X.getID()}var W=undefined;if(!U.isFavorite){W=[];while(X&&!X.isRoot()){var V=X.plmType;if(V=="Folder"){V="Workspace Vault"}else{if(V=="RootFolder"){if(X.isPersonal){V="Personal Workspace"}else{V="Workspace"}}}if(y.inFamilyFolder(V)){W.push({resourceid:X.getID(),type:V});X=X.getParent()}else{X=null}}W.reverse()}var S={envId:n.getPlatformId(),serviceId:"3DSpace",contextId:A.getSetting("pad_security_ctx")?A.getSetting("pad_security_ctx"):undefined,objectId:aa,objectType:Z,displayName:U.getLabel(),folderId:ad,isPersonalFolder:U.isPersonal};if(W){S.folderPath=W}var T={protocol:"3DXContent",version:"1.1",source:"ENOFOL3_AP",widget_id:m.getWidgetId(),data:{items:[S]}};try{Y.dataTransfer.setData("text/searchitems",JSON.stringify(T))}catch(ab){}Y.dataTransfer.setData("Text",JSON.stringify(T));Y.dataTransfer.effectAllowed="copyMove";m.setStartDrag(true);m.setDragFrom("bookmark");Y.stopPropagation()},_onDragEndCell:function(S,R){m.setStartDrag(false);m.setDragFrom("")},_onDragLeaveCell:function(T,R){var S=this;if(S._timerDragEnter){clearTimeout(S._timerDragEnter);S._timerDragEnter=null}S._currentDragEnterFolder=null;return true},_onDragOverCell:function(U,R){var T=this;var S=R.nodeModel;if(U&&U.dataTransfer){if(S.plmType==="FolderSection_Trash"){U.dataTransfer.dropEffect="none"}else{U.dataTransfer.dropEffect=(m.isDragging()&&m.isMoveDnDSetting()&&!m.hasFilesInEvent(U))?"move":"copy"}}if(R){R.dropPosition="middle"}if(T._currentDragEnterFolder&&T._timerDragEnter&&T._currentDragEnterFolder!==R.nodeModel.getID()){clearTimeout(T._timerDragEnter);T._timerDragEnter=null}if(T._currentDragEnterFolder!==R.nodeModel.getID()&&!R.nodeModel.isExpanded()&&R.nodeModel.getState()!=="expanding"){T._timerDragEnter=setTimeout(function(){R.nodeModel.expand()},T.time_to_expand_node)}T._currentDragEnterFolder=R.nodeModel.getID();return true},_onDropCell:function(U,R){var T=this;k.SetAsExternalDrop(true);if(T._timerDragEnter){clearTimeout(T._timerDragEnter);T._timerDragEnter=null}T._currentDragEnterFolder=null;var S=R.nodeModel;m.performDropOnFolderEditorNode(S,U);m.setDragFrom("")},_onDragEnterBlank:function(S,R){if(S&&S.dataTransfer){S.dataTransfer.dropEffect="none"}},_onDragLeaveBlank:function(T,R){var S=f.getTreeCont();if(S._timerDragEnter){clearTimeout(S._timerDragEnter);S._timerDragEnter=null}S._currentDragEnterFolder=null},_onDragOverBlank:function(S,R){},_onDropBlank:function(S,R){m.setDragFrom("")},_shouldAcceptDrag:function(R){var S=I.getCurrentFolder();if(S){if(y.isFolder(S.getType())){return true}}return false},_shouldAcceptDrop:function(R){return true},isFolderAmongFavoriteFolders:function(V){var U=false;if(V&&V.id){var T=this._rootNodeFavorite.getChildren();if(T){for(var S=0;S<T.length;S++){var R=T[S];if(V.id==R.id){U=true;break}}}}return U},addFavorite:function(R){if(!R){S._logger.log("FolderTreeCont unable to addFavorite, newFavoriteFolder(s) is not define");return}var S=this;var T=Array.isArray(R)?R:[R];this.getFavorites({onComplete:function(Y){var aa=Y;var W,V,Z;for(W=0;W<T.length;++W){Z=false;var X=T[W];for(V=0;V<aa.length&&!Z;++V){var U=aa[V];if(X.id===U.id){S._logger.log("newFavoriteFolder "+X.id+"  is already in Favorite Folders list");delete T[W];Z=true}}}for(W=0;W<T.length;++W){if(T[W]){aa.push(T[W])}}S._setFavorites({favoriteFolders:aa,onComplete:function(ab){ab.forEach(function(af){var ae=S.isFolderAmongFavoriteFolders(af);if(ae===false){var ac={useAsyncPreExpand:false};ac.label=af.name;ac.isPersonal=af.isPersonal;ac.children=null;ac.id=af.id;ac.mxid=af.mxid;if(af.type&&y.isPersonalFolder(af.type)){ac.isPersonal=true}var ad=S._getIcon(af,D);ac.icons=[ad];if(af.type){ac.plmType=af.type}else{ac.plmType="Folder"}ac.isFavorite=true;var ag=S._createTreeNodeModel(ac,S._rootNodeFavorite);ag.setState({state:"noChildren"});P.displayNotification({message:w.replace(w.get("msg_info_favoriteadded"),{name1:af.name}),className:"primary"})}})},onFailure:function(ab){S._logger.warn("WebService _setFavorites Err : "+ab)}})},onFailure:function(U){S._logger.warn("WebService getFavorites Err : "+U)}})},removeFavorite:function(X){var V=this;if(M.isPersonalFolderToBeKept(X)){P.displayNotification({message:w.get("msg_error_personalFolderFavRemoval"),className:"primary"});return false}var W=false;var U=V._rootNodeFavorite.getChildren();var Y=Array.isArray(U)?U.length:0;for(var T=0;T<Y;T++){var R=U[T];if(X.id==R.id){W=R.isSelected();V._rootNodeFavorite.removeChild(R);if(V._rootNodeFavorite.hasChildren()===false){V._rootNodeFavorite.withTransactionUpdate(function(){V._rootNodeFavorite.removeChildren();V._rootNodeFavorite.setState({state:"collapsed"})})}break}}var S="";if(I.getCurrentFolder()){S=I.getCurrentFolder().getType()}if(S=="FolderSection_favorite"){V.getOption("_folderContentView").removeNodeInContent(X.id)}V.getFavorites({onComplete:function(ac){var ad=ac;var Z=0;for(var ab=0;ab<ad.length;ab++){var aa=ad[ab];if(X.id==aa.id){ad.splice(ab,1);Z=1;break}}if(Z){V._setFavorites({favoriteFolders:ad,onComplete:function(af){var ae=X.name?X.name:"";P.displayNotification({message:w.replace(w.get("msg_info_favoriteremoved"),{name1:ae}),className:"primary"});if(W){V._rootNodeFavorite.select()}},onFailure:function(ae){V._logger.warn("WebService _setFavorites Err : "+ae)}})}else{V._logger.log("FolderTreeCont favorite folder to remove, not found in list")}},onFailure:function(Z){V._logger.warn("WebService getFavorites Err : "+Z)}})},renameFavorite:function(R,U,T){var W=this;function V(Y,X){Y.prepareUpdate();Y.setLabel(X);Y.pushUpdate()}function S(){if(T){V(T,R.name)}P.displayNotification({message:w.replace(w.get("msg_error_rename"),{name1:R.name}),className:"error"})}this.getFavorites({onComplete:function(Z){var ab=Z;var aa=0;for(var Y=0;Y<ab.length;Y++){var X=ab[Y];if(R.id==X.id){X.name=U;aa=1;break}}if(aa){W._setFavorites({favoriteFolders:ab,onComplete:function(ad){if(!T||!T._instanceType||T._instanceType!="FolderEditor/TreeNodeModel"){var ac=W._rootNodeFavorite.getChildren();ac.forEach(function(ae){if(ae&&R.id==ae.id&&R.name==ae.getLabel()){V(ae,U)}})}P.displayNotification({message:w.replace(w.get("msg_info_favoriterenamed"),{name1:R.name,name2:U}),className:"primary"})},onFailure:function(ac){W._logger.warn("WebService _setFavorites Err : "+ac);S()}})}else{W._logger.warn("FolderTreeCont favorite folder to rename, not found in list");S()}},onFailure:function(X){W._logger.warn("WebService getFavorites Err : "+X);S()}})},getFavorites:function(R){var S=this;return h.getUserPreferences({name:"FolderEditorFavoriteFolderList"+n.getPlatformId(),onComplete:function(V){var U=[];if(V.length>0){var W=e.base64Decode(V);W=JSON.parse(W);if(W.data&&W.data.data&&W.data.data.favorite_folders){U=W.data.data.favorite_folders}}if((Array.isArray(U)&&U.length===0)&&!M.isInitialized()){var T=M.setupPersonalFolder();T.then(function(){var Y=M.getPersonalRootFolderInFavoriteFormat();if(Y){var aa=[];var Z=U.length;var X=Z;while(X--){aa[X]=U[X]}aa.push(Y);S._setFavorites({favoriteFolders:aa,onComplete:function(ac){var ab=Y.name?Y.name:"";P.displayNotification({message:w.replace(w.get("msg_info_favoriteadded"),{name1:ab}),className:"primary"});if(R.onComplete){R.onComplete(aa)}},onFailure:function(ab){P.displayNotification({message:w.msg_error_nopreferences,className:"error"});if(R.onComplete){R.onComplete(U)}S._logger.warn("WebService _setFavorites Err : "+ab)}})}else{S._logger.warn("FolderTreeCont Personal Root Folder to to add to favorite(s), not found in list");if(R.onComplete){R.onComplete(U)}}})["catch"](function(){S._logger.warn("FolderTreeCont Personal Root Folder to to add to favorite(s), not found");if(R.onComplete){R.onComplete(U)}})}else{if(R.onComplete){R.onComplete(U)}}},onFailure:function(T){P.displayNotification({message:w.msg_error_nopreferences,className:"error"});S._logger.warn("WebService setPreference Err : "+T);if(R.onFailure){R.onFailure(T)}}})},_setFavorites:function(S){var W=this;var X=S.favoriteFolders;if(Array.isArray(X)){var U={};U.data={protocol:"3DXContent",version:"1.0",source:"ENOFOL3_AP",data:{favorite_folders:[]}};for(var T=0;T<X.length;T++){var R=X[T];if(R.id&&R.name){var V={id:R.id,name:R.name};if(R.type&&!y.isFolder(R.type)){V.type=R.type}if(R.mxid){V.mxid=R.mxid}if(R.isPersonal){V.isPersonal=true}U.data.data.favorite_folders.push(V)}}h.setUserPreferences({name:"FolderEditorFavoriteFolderList"+n.getPlatformId(),value:e.base64Encode(JSON.stringify(U)),onComplete:function(Y){if(S.onComplete){S.onComplete(U.data.data.favorite_folders)}},onFailure:function(Y){P.displayNotification({message:w.msg_error_preferencessnotsaved,className:"error"});W._logger.warn("WebService setPreference Err : "+Y);if(S.onFailure){S.onFailure(Y)}}})}else{W._logger.warn("Error : FolderTreeCont _setFavorites, options.favoriteFolders is not an array");if(S.onFailure){S.onFailure(new Error("options.favoriteFolders is not an array"))}}},updateTreeWithNewFolder:function(U){var S=this;var T=this._rootNodeFolders;var R;if(T&&T.isAscendantOf(U)){if(U.isVisible()){R=U}}else{if(T===U){R=U}else{R=S._getVisibleNodeById(U.id,null)}}if(R){h.folderTree({isRoot:R.plmType=="FolderSection_AllFolders",pid:R.id,onComplete:function(V){V=JSON.parse(V);if(R.plmType=="FolderSection_AllFolders"){S.refreshTreeWithServerData(V.folders,"RootFolder",R)}else{S.refreshTreeWithServerData(V.folders,"Folder",R)}},onFailure:function(V){S._logger.log("WebService folders Err : "+V)}})}},refreshTreeWithServerData:function(Y,W,ac){var S=K.generateJSON(Y);var ab=(ac.getChildren()).slice(0);var V=0;if(UWA.is(ab)){V=ab.length}var T,ad,U;for(T=0;T<V;++T){ad=ab[T];if(!S[ad.id]){this.removeFromTree(ad)}delete S[ad.id]}var R=y.isRootFolder(W)?undefined:d;for(var aa in S){ad=S[aa];var Z={useAsyncPreExpand:true};var X=this._getIcon(ad,R);Z.label=ad.label;Z.icons=[X];Z.children=[];Z.id=aa;Z.mxid=ad.mxid;Z.plmType=W;Z.created=ad.created;Z.folderClassification=ad.folderClassification;U=this._createTreeNodeModel(Z,ac)}this._folders_SortElmt.sortingNodesUnsensitiveCase()},removeFromTree:function(V){if(!V){return}var T=this;var S;var R;var U=this._rootNodeFolders;if(U&&U.isAscendantOf(V)){if(V.isVisible()){S=V;R=V.getParent()}}else{S=T._getVisibleNodeById(V.id,null);if(S){R=S.getParent()}}if(R&&S){if(R.hasChildren()===true){R.removeChild(S)}if(R.hasChildren()===false){R.withTransactionUpdate(function(){R.setState({state:"collapsed"})});R.options.children=[]}}},updateNodeLabel:function(U,R){var V=this;var Y=[];var S=UWA.is(U,"string")?U:U.physicalid?U.physicalid:null;if(S){Y=this._getNodesById(S)}else{Y=[U]}var X=function(ab){var ac=I.getCurrentFolderID();Y.forEach(function(ae){var af=ae.getLabel();if(af!==ab){ae._lastUpdateTime=Date.now();var ad=UWA.extend(ae.options,{label:ab,oldLabel:ab},true);ae.withTransactionUpdate(function(){ae.updateOptions(ad)})}if(Y.length===1&&ac===Y[0].getID()){I.updateLabelCurrentFolderPath();f.getIdCardCont().setCurrentLocation();if(UWA.is(widget)){widget.setTitle(ae.getLabel())}}})};var Z=function(ad){if(Y.length===1){var ac=Y[0];var ab=(ad==="TRUE")?J.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";ac.setBadges({bottomRight:ab})}};var aa=function(ad){if(!!widget.getValue("CandABookmark")&&Y.length===1){var ac=Y[0];var ab=(ad&&ad.toUpperCase()==="SHARED")?J.getWebappsAssetUrl("FolderEditor","icons/approvals.png"):"";ac.setBadges({topRight:ab})}};var T=function(af){var ae=f.getActiveFolder(),ab=ae.id,ad=ae.disabledId;if(ab===af){var ac=J.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active.png");U.setBadges({bottomLeft:ac})}else{if(ad===af){var ac=J.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active_disabled.png");U.setBadges({bottomLeft:ac})}}};if(Y.length>0){if(R){X(R);this._folders_SortElmt.sortingChildrenNodes(Y[0].getParent())}else{if(UWA.is(Y[0].getID,"function")){var W=Y[0].getID();h.getFolderProperties({pid:W,onComplete:function(ad){if(UWA.is(ad,"string")){ad=JSON.parse(ad)}var ab=ad.label;X(ab);Z(ad.publishOnConnect);aa(ad.folderClassification);var ac=false;p.getEnforceFolderLinkSettingAsync(function(af,ae){if(!af){ac=ae}});if(ac||f.isCustomizedEnv()||f.isActiveBookmarkActivated()){T(W)}if(V._folders_SortElmt){V._folders_SortElmt.sortingChildrenNodes(Y[0].getParent())}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting folder Properties")}})}}}},expandTreeAndSelectFolder:function(T){var Y=(T&&T.folderToFindAndSelect)?T.folderToFindAndSelect.id:undefined;var U=this;if(Y){var X=U._getVisibleNodeById(Y,null);if(X){var R=I.getCurrentFolder();if(!T.doNotSelectInTree){U._scrollToVisibleNode(X);X.select(true)}else{I.addInFolderCSO(X,"TREE")}if(T.onComplete){var W={folderToFindAndSelect:T.folderToFindAndSelect,correspondingTreeNodeModel:X};T.onComplete(W)}}else{var S=I.getCurrentFolder();var V=function(Z){var ac=false;var aa=I.getCurrentFolder();if(aa!==S){ac=true;if(Z.onGiveUp){var ab={folderToFindAndSelect:Z.folderToFindAndSelect};Z.onGiveUp(ab)}}return ac};h.getFolderPath({pid:Y,onComplete:function(ae){ae=JSON.parse(ae);var am=ae.folders;if(!am&&ae.error){U._logger.warn("Unable to retrieve FolderPath using WebService");if(T.onFailure){T.onFailure(ae.error)}}if(!V(T)){if(U._rootNodeFolders){var ak=null;var ab=null;var an=U._rootNodeFolders;var ac=an.pathId;for(var ad=0;ad<am.length;ad++){var ag=am[ad];var Z=ag.id;var aa="";if(y.isFolder(ag.type)){aa="Folder"}else{if(y.isRootFolder(ag.type)||y.isPersonalFolder(ag.type)){aa="RootFolder";ab=Z}}var af=ag.label;var ah={id:Z,name:af,type:aa};if(Z){if(!ak){var aj=U._getVisibleNodeById(Z,an);if(aj&&aj.isVisible()){an=aj;ac=aj.pathId}else{ak=an}}if(ak){var ai=ac;U._folderStructurePreference.add(ai);an=null;ac=ac+","+Z}}else{U._logger.log("unexpected undefined parentObjectId")}}if(!ab){if(T.onFailure){T.onFailure(new Error(w.msg_error_NoVisibleRootFolder))}}else{if(ak){var al=ai+","+Y;if(!T.doNotSelectInTree){U._folderStructurePreference.select(al);U._folderStructurePreference.scrollAfterSelect(Y)}else{U._folderStructurePreference.select("");U._folderStructurePreference.scrollAfterSelect("");U._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=al}U._folderStructurePreference.remove(al);if(ak.getState()!=="expanding"){ak.expand()}if(T.onComplete){var ae={folderToFindAndSelect:T.folderToFindAndSelect};T.onComplete(ae)}}else{console.log("   Damnation, no firstUnexpandedTreeNodeModelParentFound");if(T.onFailure){T.onFailure(new Error(w.msg_error_TreeExpandCancelledInternalError))}}}}else{U._logger.log("  No FolderSection_AllFolders to start expandTreeAndSelectFolder");if(T.onFailure){T.onFailure(new Error(w.msg_error_TreeExpandCancelledNotReady))}}}},onFailure:function(Z){U._logger.log("WebService getFolderPath Err : "+Z);if(T.onFailure){T.onFailure(Z)}}})}}else{U._logger.log("expandTreeAndSelectFolder error : folderToFindAndSelect is undefined");if(T.onFailure){T.onFailure(new Error("Tree exploration stopped, folderToFindAndSelect is undefined"))}}},_getNodesById:function(W,S){var R=[];var V=[];var U=this;if(S){R=[S]}else{var T=U._folders_TreeDocument.getRoots();T.forEach(function(X){if(X&&X.plmType!="FolderSection_favorite"){R.push(X)}})}R.forEach(function(Y){if(Y.getID()==W){V.push(Y)}var X=Y.getChildren();if(UWA.is(X,"array")){X.forEach(function(Z){var aa=U._getNodesById(W,Z);aa.forEach(function(ab){V.push(ab)})})}});return V},_getVisibleNodeById:function(S,R){var X=(R)?R:this._rootNodeFolders;var U=null;var V=this;if(X&&X.isVisible()){if(X.getID()===S){U=X}else{if(X.isExpanded()){var W=X.getChildren();if(Array.isArray(W)&&W.length>=1){for(var T=0;T<W.length;T++){var Z=W[T];if(Z){if(Z.id==S){U=Z;break}else{var Y=V._getVisibleNodeById(S,Z);if(Y&&Y.isVisible()){U=Y;break}}}}}}}}return U},_folderStructurePreference:{_scrollToNode:function(){return"scrollToNode - "+n.getPlatformId()},_getPreferenceTree:function(R){if(!R){R={}}return R},_getStoredFolderTreeStructure:function(){var S=widget.getValue("folderTreeStructure");try{S=S?JSON.parse(K.jsonUnzip(S)):{}}catch(R){S={}}return this._getPreferenceTree(S)},add:function(W,S,U){if(!U||U.isFailure!==true){var V=this;var X=this._getStoredFolderTreeStructure();var R=W.split(",");var T=X;R.forEach(function(Z,Y){if(!T[Z]){if(!T["_X_"+Z]){T[Z]={}}else{T[Z]=T["_X_"+Z];delete T["_X_"+Z]}}else{if(!S){T[Z]={}}}T=T[Z]});V.saveFolderStruture(X)}},remove:function(V,U){var T=this;var W=this._getStoredFolderTreeStructure();var R=V.split(",");var S=W;R.forEach(function(Y,X){if(S){if(X<R.length-1){S=S[Y]||S["_X_"+Y]}else{if(!U&&S[Y]&&Object.keys(S[Y]).length>0){S["_X_"+Y]=S[Y]}delete S[Y]}}});T.saveFolderStruture(W)},isExpanded:function(U,W){var V=this._getStoredFolderTreeStructure();var R=U.split(",");var T=false;var S=V;R.forEach(function(Y,X){if(S&&X<R.length-1){S=S[Y]||S["_X_"+Y]}else{if(S){T=S[Y]!==undefined}}});W.call(window,T)},recursive:function(S,T){for(var R in S){if(S[R]&&R.indexOf("_X_")===-1){T.push(R);this.recursive(S[R],T)}}},getExpandedChildren:function(U,X){var T=this;var V=this._getStoredFolderTreeStructure();var R=U.split(",");var W=[];var S=V;R.forEach(function(aa,Y){if(S&&Y<R.length-1){S=S[aa]||S["_X_"+aa]}else{if(S){var Z=S[aa]||S["_X_"+aa];T.recursive(Z,W)}}});X.call(window,W)},saveFolderStruture:function(R){if(R&&R.root&&R.root.e){R={}}R=JSON.stringify(R);R=K.jsonZip(R);if(widget.getValue("expandSaveLimitation")!==false&&R.length>this.options.limitExpand){P.displayNotification({message:w.get("msg_warning_expandSaveLimitation"),className:"warning",id:"expandLimitation"})}else{widget.setValue("folderTreeStructure",R)}},select:function(S){var R=K.jsonUnzip(widget.getValue("folderTreeSelectedNode")||"{}");R=JSON.parse(R);var T=n.getPlatformId();R[T]=S;R=JSON.stringify(R);widget.setValue("folderTreeSelectedNode",K.jsonZip(R))},isSelected:function(R){var S=this.getSelection();if(S!=R){return false}return true},isSelectValuated:function(){var R=this.getSelection();if(!R){return false}return true},getSelection:function(){var R=K.jsonUnzip(widget.getValue("folderTreeSelectedNode")||"{}");R=JSON.parse(R);var S=n.getPlatformId();return R[S]},scrollAfterSelect:function(R){widget.setValue(this._scrollToNode(),R)},doScrollAfterSelect:function(R){var S=widget.getValue(this._scrollToNode());if(S===R){return true}return false}},_scrollOnPostUpdateView:function(T){var S=this;var U=this._folders_TreeView?this._folders_TreeView.getManager():null;var R=S._folderStructurePreference.doScrollAfterSelect(T.getID());if(U&&R){U.onPostUpdateViewOnce(function(){if(S._folderStructurePreference.doScrollAfterSelect(T.getID())){S._scrollToVisibleNode(T);S._folderStructurePreference.scrollAfterSelect("")}})}},_createTreeNodeModel:function(X,ad,Z){var Y=this;var W=ad instanceof B;var aa=X.publishOnConnect;var U=X.folderClassification;delete X.publishOnConnect;delete X.folderClassification;var ab=new v(X);ab.id=X.id;ab.plmType=X.plmType;if(X.isFavorite){ab.isFavorite=true}if(X.isPersonal||(!W&&ad.isPersonal)){ab.isPersonal=true}if(X.created){ab.created=X.created}ab._instanceType="FolderEditor/TreeNodeModel";ab._loadingcounter=0;ab.getID=function(){var ah=this.id;if(!ah||ah===""){ah=this.plmType}return ah};ab.options.oldLabel=X.label;ab.pathId=(W?"root":ad.pathId)+","+ab.getID();if(aa==="TRUE"){var T=J.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");ab.setBadges({bottomRight:T})}if(!!widget.getValue("CandABookmark")&&U==="SHARED"){var T=J.getWebappsAssetUrl("FolderEditor","icons/approvals.png");ab.setBadges({topRight:T})}var R=false;p.getEnforceFolderLinkSettingAsync(function(ai,ah){if(!ai){R=ah}});if(R||f.isCustomizedEnv()||f.isActiveBookmarkActivated()){var af=f.getActiveFolder(),S=af.id,ae=af.disabledId;if(S===ab.id&&X.isFavorite!==true){var ag=J.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active.png");ab.setBadges({bottomLeft:ag})}else{if(ae===ab.id&&X.isFavorite!==true){var ag=J.getWebappsAssetUrl("FolderEditorCustomization","icons/folder_active_disabled.png");ab.setBadges({bottomLeft:ag})}}}ab.onPostExpand(function(ai){var ah=false;if(ai.data.clearLast===false||(ai.data.nodeModel.getNodeDepth()-ai.data.initialLevel)!==(ai.data.expandLevel-1)){ah=true}Y._folderStructurePreference.add(this.pathId,ah,{isFailure:this.loadHasFailed===true})});ab.addEventListener("preCollapseAll",function(){Y.deactivatePostCollapse=true});ab.addEventListener("postCollapseAll",function(){Y.deactivatePostCollapse=false;Y._folderStructurePreference.remove(this.pathId,true)});ab.onPostCollapse(function(ah){if(Y.deactivatePostCollapse!==true){Y._folderStructurePreference.remove(this.pathId)}});L(ab).subscribe({event:"removeChild",},function(ah){if(ab.isExpanded()&&ab.isVisible()){var ai=ah.nodeModel;if(!ai&&ah.data){ai=ah.data.nodeModel}if(ai){Y._folderStructurePreference.remove(ai.pathId)}}});L(ab).subscribe({event:"addChild",},function(ah){if(ab.isExpanded()&&ab.isVisible()){var ai=ah.nodeModel;if(!ai&&ah.data){ai=ah.data.nodeModel}if(ai&&ai._isExpanded){Y._folderStructurePreference.add(ai.pathId)}}});if(W){ad.addRoot(ab)}else{ad.addChild(ab,Z)}var ac=function(ah){if(W){ab[ah]()}else{if(ad.isExpanded()){if(ah!=="expand"||(!ab.isExpanded()&&ab.getState()!=="expanding")){ab[ah]({onlyUI:true})}}else{L(ad).subscribeOnce({event:"postExpand"},function(ai){if(ab.getState()!=="expanding"){ab[ah]({onlyUI:true})}})}}};Y._folderStructurePreference.isExpanded(ab.pathId,function(ah){if(ah){if(ab.plmType==="FolderSection_favorite"&&!Y._rootNodeFavorite){Y._rootNodeFavorite=ab}ac("expand")}});if(X.plmType=="FolderSection_AllFolders"){if(!Y._folderStructurePreference.isSelectValuated()){Y._folderStructurePreference.select(ab.pathId)}}if(Y._folderStructurePreference.isSelected(ab.pathId)){var V=ab;while(V!=null){if(V.isVisible()){break}V=V.getParent()}if(V===ab){ab.select()}else{L(V).subscribeOnce({event:"postExpand"},function(ah){Y._folders_TreeDocument.getXSO().empty();ab.select()})}}else{if(ab.pathId===Y._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId){I.addInFolderCSO(ab,"TREE");Y._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=undefined}}return ab},__onContextualMenuReady:function(W){var U;var V=W.treeview;var T=V.nodeModel?V.nodeModel:V.cellModel;if(T){var S=I.getSelectedNodes();var R=[];if(S.length){S.forEach(function(X){R.push(X)})}if(R.length){R.forEach(function(X){X.unselect()})}if(V.cellModel){if(V.cellModel._isSelected===false){V.cellModel._isSelected=true;V.nodeModel.select(true)}if(V.cellModel._isSelected===true){if(T){U=s.GetContextualMenu(V,"TREE")}}}if(U){U.forEach(function(X){if(X.type==="separator"||X.type==="SeparatorItem"){X.type="SeparatorItem"}else{X.title=X.label;X.action={callback:X.callback};X.type="PushItem"}})}}return U},refreshFolderTreeAndContent:function(V){var Y=this;var U=f.getContent().getPADTreeListView();var T=U?U.getManager():null;if(T){f.getContent()._componentScrollerPosition=T.getScrollerPosition()}var X=f.getContent().getPADTreeDocument();if(X){X.keepExpandedState()}if(Y._rootNodeFavorite.isExpanded()){Y._rootNodeFavorite.expand()}var S=I.getCurrentFolder();var W=S.getType();if(!this._folderStructurePreference.isSelectValuated()||(S&&V&&V.indexOf(S.id)>=0)){var R="root,FolderSection_AllFolders";if(S){S.unselect()}this._folderStructurePreference.select(R);this._rootNodeFolders.select()}if((!S.isVisible()&&!S.isFavorite)||W=="FolderSection_AllFolders"||W=="FolderSection_favorite"||W=="FolderSection_Trash"){f.getContent().loadContent(S)}if(Y._rootNodeFolders.isExpanded()){Y._rootNodeFolders.expand()}},switchFolderTreeNodeLabelToWriteView:function(R){var S=false;if((R instanceof v)&&(y.inFamilyFolder(R.plmType))&&(R.getTreeDocument()===this._folders_TreeDocument)&&this._folders_TreeView){var V=this._folders_TreeView.getManager();if(V){var U=V.getCell(R._getRowID(),"tree");var T=U?U.getView():undefined;if(T){T.switchToWriteView();S=true}}}return S},getSortingContainer:function(){return this._folders_SortElmt.elements.container},_scrollToVisibleNode:function(R){var S=f.getTreeCont()?f.getTreeCont()._folders_TreeView.getManager():null;if(S&&(!S.isNodeInVisibleViewport(R)||!S.isNodeInVisibleViewport(R.getParent()))){S.scrollToNode(R,"middle")}},modeChange:function(U){var T=this._folders_TreeView&&this._folders_TreeView.getManager();var V=widget.getValue("compactModeForLeftSidebar");if(T&&V!==false){var W=T.options.defaultCellHeight;var R=W;if(U.viewMode==="comfortable"){R=38}else{if(U.viewMode==="compact"){R=26}else{return}}var S=R!==W;T.options.defaultCellHeight=R;S&&this.toUpdateView()}},toUpdateView:function(){var S=this._folders_TreeView&&this._folders_TreeView.getManager();if(S){var R=S.getDocument();var U=S._isPreparingView;var T=S._updateCounter;S.unloadDocument();S._syncRowIndexes(true);S.loadDocument(R);S._isPreparingView=U;S._updateCounter=T;S.updateView(true)}},});return H});define("DS/FolderEditor/views/FolderPathNavigator",["UWA/Controls/Abstract","UWA/Class/Options","DS/UIKIT/Input/Text","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/views/FolderPathSeparator"],function(g,b,f,a,e,c){var d=g.extend(b,{_ctxMenu:null,_ctxMenuWidth:14,_breadcrumb:null,_pathCont:null,_divPathSegmented:null,_divPathFullText:null,init:function(h){this._parent(h);this._pathCont=h.pathCont;var i=this;this._divPathSegmented=UWA.createElement("div",{"class":"containerPathSegmented"}).inject(this._pathCont);this._divPathFullText=UWA.createElement("div",{"class":"containerPathFullText"}).hide().inject(this._pathCont);this._pathFullText=new f({className:"pathFullText",attributes:{multiline:false,readonly:true}}).inject(this._divPathFullText);this._pathFullText.elements.input.addEvent("blur",function(){i._divPathFullText.hide();i._divPathSegmented.show()});this._buildCtxMenu();this._breadcrumb=UWA.createElement("div",{"class":"containerPathIdCard"}).inject(this._divPathSegmented);if(h.pathNodes&&h.pathNodes.length>0){this._buildPathNavigator(h.pathNodes)}this._pathCont.addEventListener("click",this._onClickDivPathCont.bind(this),true)},flush:function(){this._ctxMenu.hide();while(this._breadcrumb.firstChild){this._breadcrumb.removeChild(this._breadcrumb.firstChild)}this._ctxMenu.flush()},_buildPathNavigator:function(h){if(!UWA.is(h)){return}this._divPathFullText.hide();this._divPathSegmented.show();var q=this._pathCont.offsetWidth-this._ctxMenuWidth-50,j=false;for(var p=0;p<h.length;p++){var m=null,i=null,n=0,o=0;var l=this._createFolderInfoPathElement(h[p]);o=l.getDimensions().outerWidth;if(p<h.length-1){i=new c({folderInfo:h[p+1]});m=i.buildPathSeparatorElement();m.FolderSeparator=i;m.inject(this._breadcrumb,"top");n=m.getDimensions().outerWidth}if((o+n<q)&&!j){q=q-o-n}else{j=true;if(!this._ctxMenu.isVisible()){this._ctxMenu.show()}if(m){m.destroy()}var k=l.nextSibling;if(k&&k.hasClassName("separatorIdCard")){k.destroy()}l.remove();this._ctxMenu.addSubFolder(h[p])}}},_buildCtxMenu:function(){this._ctxMenu=new c({folderInfo:null,activeIconFont:"fonticon-menu",unactiveIconFont:"fonticon-menu"});var h=this._ctxMenu.buildPathSeparatorElement();h.inject(this._divPathSegmented,"top");this._ctxMenuWidth=h.getDimensions().outerWidth;this._ctxMenu.hide()},_resize:function(){var j=null,p;if(this._isOverflowed(this._pathCont)){if(!this._ctxMenu.isVisible()){this._ctxMenu.show()}while(this._isOverflowed(this._pathCont)&&this._breadcrumb.hasChildNodes()){j=this._breadcrumb.firstChild;if(!j){break}if(j.FolderInfo){this._ctxMenu.addSubFolder(j.FolderInfo,true);p=j.nextSibling;if(p&&p.hasClassName("separatorIdCard")){p.destroy()}j.remove()}}}else{var q=true;var o=this._breadcrumb.getElementsByClassName("subLabelTextIdCard").length>0;while(q){if(!this._ctxMenu.isVisible()){q=false}j=this._ctxMenu.getSubFolder(0);if(j){if(o){var h=new c({folderInfo:j});p=h.buildPathSeparatorElement();p.FolderSeparator=h;p.inject(this._breadcrumb,"top");var r=p.getDimensions().outerWidth}var l=this._createFolderInfoPathElement(j);var s=l.getDimensions().outerWidth;o=true;if(this._isOverflowed(this._pathCont)){if(p){p.destroy()}l.remove();q=false}else{this._ctxMenu.removeSubFolder(0)}}else{this._ctxMenu.hide();q=false}}}if(this._ctxMenu.isVisible()){this._ctxMenu.resizeWidgetCallback()}var k,t,n,m=this._breadcrumb.getElementsByClassName("separatorIdCard");n=m.length;for(k=0;k<n;++k){t=m[k].FolderSeparator;if(t){t.resizeWidgetCallback()}}return true},_isOverflowed:function(h){return(this._breadcrumb.clientHeight>h.clientHeight)||(this._breadcrumb.clientWidth+this._ctxMenuWidth>(h.clientWidth-50))},_createFolderInfoPathElement:function(h){var l=null,j=this,i=h.getID()===a.getCurrentFolderID();var k=UWA.createElement("div",{"class":"subLabelTextIdCard",styles:{cursor:"pointer"},events:{click:function(m){j._callExpandAndSelectRequest(this.FolderInfo.getID(),this.FolderInfo.getType(),this.FolderInfo.getLabel())},}}).inject(this._breadcrumb,"top");k.FolderInfo=h;k.setAttribute("current",i);k.setText(h.getLabel());return k},_callExpandAndSelectRequest:function(k,i,h){var j=e.getTreeCont();j.expandTreeAndSelectFolder({folderToFindAndSelect:{id:k,type:i,name:h},onComplete:function(l){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(l){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(l){FolderAlert.displayNotification({message:Nls.replace(Nls.get("msg_error_FolderActivate"),{name1:h}),className:"error"})}})},_onClickDivPathCont:function(i){var j=i.currentTarget;var m=i.target;if(j===m){if(this._divPathFullText&&this._divPathFullText.isHidden()){var o=a.getCurrentFolderPath();var h=" ";if(o&&o.length>0){h=o[0].label;var l=o.length;for(var k=1;k<l;k++){h+="\\"+o[k].label}}this._pathFullText.setValue(h);this._divPathFullText.show();this._divPathSegmented.hide();var n=this._pathFullText.elements.input;n.focus();n.select()}}return false},});return d});define("DS/FolderEditor/models/FolderInfo",["UWA/Controls/Abstract","UWA/Class/Options","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderEditorWebService"],function(e,a,c,b){var d=e.extend(a,{_id:null,_type:null,_label:null,init:function(f){this._parent(f);this._id=f.id;this._type=f.type;this._label=f.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label},getChildrenInfos:function(g){var j=this,i,h=[],k=c.getTreeCont();i=k._getVisibleNodeById(this._id);if(!i){b.folders({pid:j._id,onComplete:function(m){m=JSON.parse(m);var l=m.folders;l.forEach(function(n){h.push(new d({id:n.id,type:n.type||"Folder",label:n.label}))});g.onComplete(h)},onFailure:function(l){console.warn("WebService folders Err : "+l);g.onFailure(l)}})}else{var f=i.getChildren();f.forEach(function(l){h.push(new d({id:l.getID(),type:l.plmType||"Folder",label:l.getLabel()}))});g.onComplete(h)}},});return d});define("DS/FolderEditor/FolderIdCardCont",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderAlert","DS/FolderEditor/Folder_CSO","DS/FolderEditor/views/FolderPathNavigator","DS/FolderEditor/models/FolderInfo","DS/FolderEditor/views/FolderSearchInContext","DS/FolderEditor/utils/FolderSearch","DS/PADUtils/PADProbes"],function(l,i,m,n,j,e,f,b,a,o,c,d,g,k){var h=i.extend(m,{name:"enoFolderIdCard_Container",_currentPathNodes:null,_dropFolder:null,_dropPartIDs:null,_counter:0,_probeLoadElmt:null,init:function(p){this._probeLoadElmt=k.createProbe("loadIdCard");var q=this;this._parent(p);this._buildSkeleton();j.onCurrentFolderChange(function(s){var r=k.createProbe("idcard_updateUI");q.setCurrentLocation();r.end()});this.dispatchEvent.call(this,"onReady");this._probeLoadElmt.end()},isSearchAvailable:function(q){if(!q){q=a.getCurrentFolder()}var p=n.isSection(q.getType());return !p&&q.options.mxid&&q.options.contentAvailable!==false},render:function(){return this},setCurrentLocation:function(){var u=this,t,s,r,p;this._currentPathNodes=[];r=a.getCurrentFolderPath();if(r&&r.length>0){p=r.length-1;for(t=p;t>=0;--t){s=r[t];this._currentPathNodes.push(new c({id:s.id,mxid:s.mxid,type:s.type,label:s.label}))}var v=this._currentPathNodes[0];var q=a.getCurrentFolder();if(q&&q.getID()===v.getID()&&!q.options.mxid){q.options.mxid=v.options.mxid}u.manageSearchVisibility(q)}this._buildFolderPath(this._currentPathNodes)},manageSearchVisibility:function(q){var p=this;if(!p.isSearchAvailable(q)){p.elements.searchInContext.hide()}else{p.elements.searchInContext.show()}},_buildFolderPath:function(p){if(!this._FolderPathNavigator){this._FolderPathNavigator=new o({pathCont:this.elements.titleIdCard_container,pathNodes:p})}else{this._FolderPathNavigator.flush();this._FolderPathNavigator._buildPathNavigator(p)}if(p.length>0){this.elements.searchInContext?this.elements.searchInContext.changeFolderPlaceholder(p[0].getLabel()):null}},updateDisplayPath:function(){if(this._FolderPathNavigator){this._FolderPathNavigator._resize(this._currentPathNodes)}},_buildSkeleton:function(){var r=this;this.topRightSideDiv=document.getElementsByClassName("FolderEditor_top_right_side_div");this.topRightSideDiv=document.getElementsByClassName("FolderEditor_top_right_side_div");if(!l.is(this.elements.container)){this.elements.container=UWA.createElement("div",{"class":this.getClassNames()});if(this.getOption("css_view_class")){this.elements.container.addClassName(this.getOption("css_view_class"))}this.elements.titleIdCard_container=UWA.createElement("div",{"class":"FolderEditor_title_IdCard"}).inject(this.elements.container);this.elements.searchSumIdCard_container=UWA.createElement("div",{"class":"FolderEditor_title_IdCard FolderEditor_sumSearch"}).hide().inject(this.elements.container);var q=UWA.createElement("span",{"class":"FolderEditor_title_titleSearch"}).inject(this.elements.searchSumIdCard_container);var p=UWA.createElement("span",{"class":"FolderEditor_title_DateSearch"}).inject(this.elements.searchSumIdCard_container);g.onSearchResult(function(w){if(w){var v=this.getNumberHits();r.elements.titleIdCard_container.hide();r.elements.searchSumIdCard_container.show();var u=f.replace(f.searchResultSum,{numberHits:v,s:v>1?"s":""});q.setText(u);var s=g.getDateLastIndexation();var x="";if(s){var t=new Date();var y=(t-s)/1000/3600;if(y>24||s.getDay()!=t.getDay()){x=s.toLocaleString()}else{x=s.toLocaleTimeString()}var x=f["Last index:"]+" "+x}p.setText(x)}else{r.elements.titleIdCard_container.show();r.elements.searchSumIdCard_container.hide();r.updateDisplayPath()}});this.elements.searchInContext=new d({events:{onSearch:function(t){var s=e.getContent();var u=a.getCurrentFolder();if(u){s.loadContentAndSelect(u)}},onSearchSwitch:function(s){if(s){UWA.extendElement(document.body).addClassName("FolderEditor_SearchActive")}else{UWA.extendElement(document.body).removeClassName("FolderEditor_SearchActive")}}}}).hide();this.elements.searchInContext.inject(this.elements.container);this.topRightSideDiv[0].addEventListener("dragover",this._onDragOver,true);this.topRightSideDiv[0].addEventListener("drop",this._onDrop,true);this.topRightSideDiv[0].addEventListener("dragenter",this._onDragEnter,true);this.topRightSideDiv[0].addEventListener("dragleave",this._onDragLeave,true);this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick)}},getSearchValue:function(){return this.elements.searchInContext?this.elements.searchInContext.getValue():null},switchSearch:function(p){this.elements.searchInContext?this.elements.searchInContext.switchSearch(p):null},change:function(p){this.elements.searchInContext?this.elements.searchInContext.switchSearch(p):null},clearSearch:function(){return this.elements.searchInContext?this.elements.searchInContext.clearValue():null},_rightClick:function(p){var q=p?p.target:null;if(q&&(q.tagName==="INPUT"||q.tagName==="TEXTAREA")){}else{if(p.stopPropagation){p.stopPropagation()}if(p.preventDefault){p.preventDefault()}}return false},_onDragOver:function(p,s,r,q){if(p.preventDefault){p.preventDefault()}return false},_onDragEnter:function(t,x,y,v){var r=e.getIdCardCont(),p=null,u=null,q=-1,z,w=false;if(t.stopPropagation){t.stopPropagation()}if(t.preventDefault){t.preventDefault()}var s=t.target?t.target:t.detail.target;e.getIdCardCont()._updateBorderDnD(s,true);return true},_onDragLeave:function(p,s,r,q){if(p.stopPropagation){p.stopPropagation()}if(p.preventDefault){p.preventDefault()}e.getIdCardCont()._updateBorderDnD(p.target,false);return true},_onDrop:function(s,v,u,t){var p=false,r,q=e.getIdCardCont();if(s.stopPropagation){s.stopPropagation()}if(s.preventDefault){s.preventDefault()}e.getIdCardCont()._updateBorderDnD(s.target,false);if(a.getCurrentFolder()&&a.getCurrentFolder().plmType==="FolderSection_Trash"){b.displayNotification({message:f.msg_warning_dndnotsupported,className:"error"});return false}if(!g.isSearchActive()){r=q._getSerializedData(s);if(r){p=q._performDropAction(r)}}return p},_updateBorderDnD:function(r,q){var p=this.elements.titleIdCard_container;if(r){if(q){this._counter=this._counter+1;p.addClassName("dropallowed_elem")}else{this._counter=this._counter-1;if(this._counter===0){p.removeClassName("dropallowed_elem")}}}},_performDropAction:function(r){var q,s,p=null;q=r.data.items.length;if(q===1){s=r.data.items[q-1];if(s.path){p=this._expandDroppedPath(s)}else{p=this._expandDroppedItem(s)}}else{p={isDropped:false,msg:(q>1)?f.msg_warning_MultipleSelection:f.msg_warning_dndnotsupported}}if(!p.isDropped){b.displayNotification({message:p.msg,className:"error"})}return p.isDropped},_expandDroppedItem:function(p){var r=false,t=null,w=null,s=null,q=null,v;w=p.objectId;q=p.displayName||"";s=this._getObjectDroppedType(p);if(!w||!s){r=false;t=f.msg_warning_notProductRoot}else{v=e.getTreeCont();r=true;var u=a.getCurrentFolderID();if(w!==u){v.expandTreeAndSelectFolder({folderToFindAndSelect:{id:w,type:s,name:q},onComplete:function(x){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(x){console.log(" expandTreeAndSelectFolder:onGiveUp")},onFailure:function(x){b.displayNotification({message:f.replace(f.get("msg_error_FolderActivate"),{name1:q}),className:"error"})}})}}return{isDropped:r,msg:t}},_getObjectDroppedType:function(t){var r=null,s=null,p,q;r=t.objectType_Internal||t.objectType;if(Array.isArray(r)&&r.length>0){p=r.length;for(q=0;q<p;++q){if(n.inFamilyFolder(r[q])){s=r[q];break}}}else{if(n.inFamilyFolder(r)){s=r}}return s},_expandDroppedPath:function(s){var y=false,v=null,E=null,D=null,x,u,w,z,t,r,q=[],C,A=0,B=false;this._dropFolder=null;this._dropPartIDs=[];E=s.path;if(E&&E.length>0){w=E.length;C=this._getLastIndexOfFolder(E);t=a.getCurrentFolder();r=a.getCurrentFolderID();x=this._getObjectDroppedType(s);if(C===-1&&!t&&!x){return{isDropped:false,msg:f.msg_warning_nocurrentfolder}}if(C>=0){this._dropFolder={id:E[C].resourceid,type:E[C].type,displayName:E[C].displayName||""};if(C+1<w){A=E[C+1].type==="Vaulted Objects"?C+2:C+1;this._setProductsIDsPath(A,E)}B=(r!==this._dropFolder.id)?true:false}else{if(x){this._dropFolder={id:s.objectId,type:x,displayName:s.displayName||""}}else{this._dropFolder={id:r,type:t.getType(),displayName:t.getLabel()||""}}B=(r!==this._dropFolder.id)?true:false;this._setProductsIDsPath(A,E)}y=true;if(B){this._expandNodeOfPath(this._dropFolder)}else{if(this._dropPartIDs.length>0){var p=e.getContent();p.expandBranches(this._dropPartIDs)}}}else{y=false;v=f.msg_warning_dndnotsupported}return{isDropped:y,msg:v}},_getLastIndexOfFolder:function(q){var r=-1,p=q.length,s;for(s=0;s<p;++s){if(n.inFamilyFolder(q[s].type)){r=s}}return r},_setProductsIDsPath:function(r,q){var s,p=q.length;r=r>-1?r:0;for(s=r;s<p;++s){this._dropPartIDs.push(q[s].resourceid)}},_getSerializedData:function(w){var q,v,r,t,p="",s;v=w.dataTransfer?w.dataTransfer:w.detail?w.detail:null;r=UWA.is(v.types.indexOf,"function")?"indexOf":"contains";t=["text/searchitems","text/plain","Text"];for(q=0;q<t.length&&p==="";q++){var u=v.types[r](t[q]);if((UWA.is(u,"number")&&u>=0)||(UWA.is(u,"boolean")&&u===true)){p=t[q]}}if(p!==""){s=v.getData(p)}if(s&&s.length){return JSON.parse(s)}return null},_expandNodeOfPath:function(p){var q=this,r;r=e.getTreeCont();if(r&&p){r.expandTreeAndSelectFolder({folderToFindAndSelect:{id:p.id,type:p.type,name:p.displayName},onComplete:function(t){var s=e.getContent();if(q._dropPartIDs.length>0){s.addEvent("onCompleteRefreshNodes",function(u){this.removeEvent("onCompleteRefreshNodes");if(q._dropFolder.id===u){this.expandBranches(q._dropPartIDs)}})}},onGiveUp:function(s){console.log("expandTreeAndSelectFolder: onGiveUp")},onFailure:function(s){b.displayNotification({message:f.replace(f.get("msg_error_FolderActivate"),{name1:p.displayName}),className:"error"})}});return true}return false}});return h});