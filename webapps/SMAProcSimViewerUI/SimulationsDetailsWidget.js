define("SMAProcSimViewerUI/SimulationsDetailsWidget",["UWA/Core","DS/TransientWidget/TransientWidget","DS/Usage/UsageManager","DS/Usage/TrackerAPI"],function(j,b,c,e){var h,a,i,d={CREATE_PROCESS:"create",VIEW_ONDROP:"viewondrop",COMPARE_PROCESSES:"compare"},g={unauthorized:"You are not authorized for this widget.<br>Please contact your system administrator for access and re-login to ensure latest assigned licenses are taken into account.",failedLicenseCheck:"Failed to check license. Please reload the browser tab.",invalidMode:"Unable to load Performance Study widget. Invalid Mode.",invalidTenant:"Unable to fetch Process data. Process dropped from different tenant.",dataNotAvail:"Unable to fetch Process data. Please contact your system administrator."};try{c.init({service:"SIMDISB_AP",uploadPath:""})}catch(f){console.log(f)}window.onbeforeunload=function(){if(h.psDetailedView&&h.psDetailedView.stopJobMonitor){h.psDetailedView.stopJobMonitor()}};i=function(){var k;h.spDashboard=document.createElement("sp-dashboard");k=widget.getValue("mode")?widget.getValue("mode"):d.VIEW_ONDROP;h.spDashboard.addWUTenantPreference();h.spDashboard.addReadOnlyWAPreference();h.spDashboard.addSecurityContextPreference().then(function(){require(["DS/WAFData/WAFData"],function(n){h.spDashboard.fetchMyappsUri().then(function(o){n.authenticatedRequest(o+"/resources/AppsMngt/user/startup",{type:"json",onComplete:function(p){window.widget.performanceStudy={};window.widget.performanceStudy.cStorage=p.cstorage},onError:function(){console.log("Unable to set cspaces")}})})});if(k&&k===d.COMPARE_PROCESSES){var m=document.querySelector("link[href*='ps-detailed-view']");if(m){if(m["import"]&&m["import"].readyState==="complete"){h.createCompareLayout()}else{m.addEventListener("load",h.createCompareLayout())}}}else{if(k&&(k===d.VIEW_ONDROP||k===d.CREATE_PROCESS)){h.createDefaultLayout()}else{h.displayError(g.invalidMode)}}});var l=e.getTracker("counter","PS_USAGE_COUNTER");l.inc()};a=function(){var l=document.createElement("sp-mcsservice");var k=l.$.dashboard.getMcsUri()+"/resources/slmservices/license?appNames=Performance_Study,Results_Analytics,Simulation_Companion,Process_Composer";widget.body.empty();l.sendRequest({verb:"GET",uri:k,onComplete:function(n){widget.license=JSON.parse(n.response);var m=widget.license&&widget.license.Performance_Study==="true";if(m){i()}else{h.displayError(g.unauthorized)}},onError:function(){h.displayError(g.failedLicenseCheck)}})};h={psDetailedView:null,xsInstantiator:null,spDrop:null,onLoad:function(){c.init({service:"SIMDISB_AP",uploadPath:"/upload"});e.init();h.cleanLayout();a()},cleanLayout:function(){widget.body.empty()},createCompareLayout:function(){var k=widget.getValue("simulations");h.psDetailedView=j.createElement("ps-detailed-view");h.psDetailedView.licenseDataCmn=h.license;h.psDetailedView.compareOIDs=k;h.psDetailedView.inject(widget.body);h.psDetailedView.setStyle("backgroundColor","white")},createDefaultLayout:function(k){var o,n,l;o=h.getSpDropInstance();if(k){h.spDashboard.addSecurityContextPreference()}n=widget.getValue("processData")||widget.getValue("templateData");if(n){o.isRefresh=true;h.assignDataToWidget(o,n)}else{o.$.objectSearch.newSearchContextAlways=true;o.style.padding="10px 0 0 0";h.xsInstantiator=h.removeInstance(h.xsInstantiator);h.psDetailedView=h.removeInstance(h.psDetailedView)}o.$.objectSearch.newSearchContextAlways=true;l=h.spDashboard.getWidgetId();var m="preview-";if(l&&(l.substr(0,m.length)===m)){o.$.searchContainer.hidden=true}else{o.$.searchContainer.hidden=false;o.$.searchNote.classList.remove("hidden");o.$.separatorTextSearch.classList.remove("hidden")}},assignDataToWidget:function(l,k){l.style.padding="0";if(k.objectType==="Simulation Template"){h.setTemplateData(k);h.assignTemplateData(l,k)}else{h.setProcessData(k);h.assignProcData(l,k)}},assignProcData:function(k,m){h.spDashboard.addWUTenantPreference();h.spDashboard.addSecurityContextPreference();if(!h.psDetailedView||(h.psDetailedView&&!h.psDetailedView.isAttached)){var l=document.querySelector("link[href*='ps-detailed-view']");if(l){if(l["import"]&&l["import"].readyState==="complete"){h.createPSDetailView(k,m)}else{l.addEventListener("load",h.createPSDetailView(k,m))}}}else{h.psDetailedView.procData=m;k.isRefresh=false}},createPSDetailView:function(k,l){h.xsInstantiator=h.removeInstance(h.xsInstantiator);h.psDetailedView=j.createElement("ps-detailed-view");h.psDetailedView.addEventListener("detailedviewready",function(){h.psDetailedView.procData=l;k.isRefresh=false;h.psDetailedView.setStyle("backgroundColor","white")});h.psDetailedView.licenseDataCmn=h.license;h.psDetailedView.addEventListener("simulationdeleted",function(){var m={type:"error",autoRemove:true,text:g.dataNotAvail};if(l.envId!==window.widget.getValue("x3dPlatformId")){m.text=g.invalidTenant}h.spDrop.$.notificationMessages.logMessage(m);h.clearwidgetData();h.createDefaultLayout()});k.injectContent(h.psDetailedView)},assignTemplateData:function(k,l){if(!h.xsInstantiator||(h.xsInstantiator&&!h.xsInstantiator.isAttached)){h.createXSInstantiatorView(k,l)}else{h.xsInstantiator.proceedPlayOnLoad=widget.getValue("isPlaying");h.xsInstantiator.templateData=l;k.isRefresh=false}},createXSInstantiatorView:function(k,m){var l;h.psDetailedView=h.removeInstance(h.psDetailedView);h.hideSecurityContext();l=h.spDashboard.resolveUrl("../../SMAProcXSUI/xs-instantiator/xs-instantiator.html");Polymer.Base.importHref([l],function(){h.xsInstantiator=j.createElement("xs-instantiator");h.xsInstantiator.setAttribute("id","xsplayer");h.xsInstantiator.templateData=m;h.xsInstantiator.proceedPlayOnLoad=widget.getValue("isPlaying");h.xsInstantiator.addEventListener("instantiated",function(n){n.preventDefault();n.stopPropagation();h.setProcessData(n.detail);h.createDefaultLayout(true)});h.xsInstantiator.addEventListener("closeWidget",function(n){n.preventDefault();n.stopPropagation();h.clearwidgetData();if(n.detail.closeWindow){b.closeWidget();h.createDefaultLayout(true)}});h.xsInstantiator.addEventListener("proceedPlayOnLoad",function(n){n.preventDefault();n.stopPropagation();widget.setValue("isPlaying",true)});k.injectContent(h.xsInstantiator)})},getSpDropInstance:function(){if(!h.spDrop||(h.spDrop&&!h.spDrop.isAttached)){h.spDrop=j.createElement("sp-drop");h.spDrop.openObject=true;h.spDrop.dropNoteText="Simulation Process or Template";h.spDrop.accepts=["Simulation Template","Simulation","Simulation Process","Simulation Job"];h.spDrop.customSearch='((flattenedtaxonomies:"types/Simulation") OR (flattenedtaxonomies:"types/Simulation Process") OR [ds6w:status]:"Simulation Template.Released") AND (NOT policy:"Simulation Template Content")';h.cleanLayout();h.spDrop.inject(widget.body);h.spDrop.style.margin="0px";h.spDrop.style.height="100%";h.spDrop.style.padding="10px 0 0 0";h.spDrop.showSearch=true;h.spWebservice=j.createElement("sp-webservice");h.spDrop.addEventListener("setdefaultlayout",function(k){k.stopPropagation();h.removeInstance(h.xsInstantiator);h.clearwidgetData();h.createDefaultLayout()});h.spDrop.addEventListener("onObjectDrop",function(l){var m,n;l.preventDefault();l.stopPropagation();m=h.spDrop.objectData;widget.setValue("isPlaying",undefined);appData.simData.isJobQueued=m&&m.objectData&&m.objectData.isJobQueued;n={objectId:m.objectId,id:m.objectId,objectType:m.objectType,displayName:m.displayName,contextId:m.contextId,isJobQueued:m&&m.objectData&&m.objectData.isJobQueued,envId:m.envId};if(m.objectType==="Simulation Job"){var k=h.spWebservice.$.dashboard.getMcsUri()+"/resources/slmservices/jobs/simulationInfo?jobId="+m.objectId;h.spWebservice.sendRequest({verb:"GET",uri:k,onComplete:function(p){var o=JSON.parse(p.response)[0];n.id=o.physicalid;n.objectId=o.physicalid;n.displayName=o.SimulationName;n.objectType="Simulation Process";h.assignDataToWidget(h.spDrop,n)}})}else{h.assignDataToWidget(h.spDrop,n)}})}return h.spDrop},removeInstance:function(k){if(k&&k.isAttached){Polymer.dom(Polymer.dom(k).parentNode).removeChild(k)}return null},hideSecurityContext:function(){widget.addPreference({name:"collabspaces",type:"hidden"})},displayError:function(k){var l=document.createElement("div");l.className="errorDiv";var m=document.createElement("p");m.className="errorText";m.innerHTML=k;l.setAttribute("id","errorDiv");m.setAttribute("id","errorText");l.appendChild(m);widget.body.appendChild(l);widget.readOnly=true},setTemplateData:function(k){widget.setValue("processData",undefined);widget.setValue("templateData",k);widget.setValue("mode",d.CREATE_PROCESS);widget.setTitle("Template - "+k.displayName)},setProcessData:function(m){var l={};for(var k in m){if(m.hasOwnProperty(k)){if(k!=="operation"){l[k]=m[k]}}}widget.setValue("processData",l);widget.setValue("templateData",undefined);widget.setValue("mode",d.VIEW_ONDROP);widget.setValue("isPlaying",undefined)},clearwidgetData:function(){widget.setValue("processData",undefined);widget.setValue("templateData",undefined);widget.setValue("mode",d.VIEW_ONDROP);widget.setValue("isPlaying",undefined);widget.setTitle("")},refreshWidget:function(){if(h.psDetailedView){h.psDetailedView.refreshData()}else{if(h.xsInstantiator){h.xsInstantiator.proceedPlayOnLoad=true;h.xsInstantiator.templateDataChanged()}}},endEdit:function(){h.psDetailedView.refreshData()}};widget.addEvents({onLoad:h.onLoad,onRefresh:h.refreshWidget,endEdit:h.endEdit});return h});