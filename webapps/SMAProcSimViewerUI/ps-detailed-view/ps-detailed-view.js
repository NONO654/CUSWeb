/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
(function(a){a.Polymer({is:"ps-detailed-view",behaviors:[a.DS.SMAProcSP.SPBase,a.DS.SMAProcSP.SPVariableHelper],properties:{activeSim:{type:Object},compareItems:{type:Array,value:function(){return[]}},compareOIDs:{notify:true},procData:{type:Object,notify:true,observer:"procDataChanged"},licenseDataCmn:{type:Object,value:function(){return{}}},session:{type:Object,value:function(){return{}}}},stopJobMonitor:function(){if(this.session&&this.session.clearAllExecutionDirectories){this.session.clearAllExecutionDirectories()}},attached:function(){this.$.licenseData.setValue(this.licenseDataCmn);this.async(function(){a.onbeforeunload=function(){if(this.$.dashboardWs.hasPendingUpdates()){this.$.dashboardWs.flushAll();return"Your changes are still being saved(this should only take a moment longer).\n\nIf you leave now, your recent changes may be lost."}}.bind(this)})},ready:function(){var c,b;c=this.$.spdashboard.getMcsUri();this.$.mcsBaseURL.setValue(c);b=c+"/resources/slmservices";this.$.mcsWSBaseURL.setValue(b);this.$.inDashBoard.setValue(this.$.dashboardWs.isInDashboard());a.DS.SMAProcSP.SPVariableHelper.ready.call(this)},procDataChanged:function(){if(this.procData){this.$.simulationProp.uri="/simulations/"+this.procData.id;this.$.simulationProp.getData();if(this.procData.operation==="run"){var b=this.procData.activityId;if(b.length>0){this.$.runActivity.setValue({runActivity:"True",id:b,title:this.procData.activityTitle})}else{this.$.runSimulation.setValue("True")}}}},onUpdateResponse:function(b){this.$.securityContext.setValue(this.$.spdashboard.getSecurityContext());this.activeSim=b.detail.response;var c=this.activeSim.attributes.title;if(c&&widget){c=c.unescapeHTML();widget.setTitle(c)}var d=Polymer.dom(Polymer.dom(this.root).querySelector("#simcontent"));if(d){d.classList.add("active")}},onUpdateError:function(){this.fire("simulationdeleted")},onSimContentReady:function(){if(this.procData){Polymer.dom(Polymer.dom(this.root).querySelector("#simcontent")).classList.add("active")}this.fire("detailedviewready")},onCompareViewAttached:function(){if(this.compareOIDs&&this.compareOIDs.length>0){this.compareItems=this.compareOIDs;Polymer.dom(Polymer.dom(this.root).querySelector("#psCompView")).classList.add("active");Polymer.dom(Polymer.dom(this.root).querySelector("#simdetail")).classList.add("simCompare")}},refreshData:function(){if(this.procData){Polymer.dom(this.root).querySelector("#simcontent").refreshData()}}})}(this));