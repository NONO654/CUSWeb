define("DS/SMAExeDrmInfraUI/Views/CustomDRMUI",["UWA/Core","DS/Controls/Abstract","DS/SMAExeJsAPI/CosAPI","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/SpinBox","DS/UIKIT/Spinner","css!DS/SMAExeDrmInfraUI/Views/CustomDRMUI.css"],function(c,e,j,f,i,b,k,a){var h=["Operating System","Station Name","Custom","Location Group"],d=["Co-Simulation Group","Job Name","Job Group","Hosts","CPU's","Resources","Begin Time","End Time","Run Time Limit","Additional Bsub Arguments","Exclusive Execution"];var g=e.extend({destroy:function(){if(this.drmOptContainer){this.drmOptContainer.destroy()}if(this.drmModeContainer){this.drmModeContainer.destroy()}if(this.emptyMessage){this.emptyMessage.destroy()}},init:function(m){this.customExeOpt=[];this.fiperOpt=[];this.lsfOpt=[];var n=this;this.drmMode=m.drmMode;this.drmModeAccessFromTemplate="edit";this.isDrmModeAccessFromTempView=false;this.showLoadingIndicator=m.showLoadingIndicator;this.container=m.container;if(this.showLoadingIndicator){this.spinner=new a({className:"large"}).inject(this.container);this.spinner.show()}if(this.emptyMessage){this.emptyMessage.destroy()}var o=m.drmOptions;for(var l=0;l<o.length;l+=1){if(m.drmOptions[l].title==="drmMode"){this.drmModeAccessFromTemplate=m.drmOptions[l].action;if(this.drmModeAccessFromTemplate==="view"){this.isDrmModeAccessFromTempView=true}else{this.isDrmModeAccessFromTempView=false}}var p=o[l].title_display;if(o[l].hasOwnProperty("drm")){this.customExeOpt.push(o[l])}else{if(h.indexOf(p)>-1){this.fiperOpt.push(o[l])}else{if(d.indexOf(p)>-1){this.lsfOpt.push(o[l])}}}}if(this.drmMode===null||this.drmMode===undefined||this.drmMode===""){this.drmMode="fiper";this.processDRMOptionUI(this.fiperOpt);if(n.spinner){n.spinner.hide()}return}setTimeout(function(){j.listAllInstalledDRMsJson({onComplete:function(q,r,s){if(!q&&s){q=s.response}n.processDrmList(q);if(n.spinner){n.spinner.hide()}},onFailure:function(q){alert("ERROR in CosAPI.listAllInstalledDRMsJson(); "+q);if(n.spinner){n.spinner.hide()}}})},1500);return this._parent.apply(this,arguments)},processDrmList:function(r){var u=this,y=JSON.parse(r),z=y.Drms.Drm,v=[],p;var m=new DOMParser;var n='Lsf <span style="font-size:22px">&reg;</span>';var q=m.parseFromString(n,"text/html");var x=q.body.textContent;if(Array.isArray(z)){for(var t=0;t<z.length;t++){var l=z[t]["@name"],w=z[t]["@name"];if(l==="fiper"){w="Built-in"}else{if(l==="Lsf"){w=x;p=w}}if(l!=="Cloud"){v[t]={labelItem:w,name:l,isConfigured:true}}}}else{var l=z["@name"],w=z["@name"];if(l==="fiper"){w="Built-in"}v[0]={labelItem:w,name:l,isConfigured:true}}this.drmModeContainer=new c.Element("div",{"class":"wux-controls-lineeditor",styles:{display:"block"}});this.drmModeContainer.inject(u.container);var o=false;for(var t=0;t<v.length;t++){var l=v[t].name;if(l===this.drmMode){o=true}}if(!o){v[v.length]={labelItem:this.drmMode,name:this.drmMode,isConfigured:false}}if(this.drmModeAccessFromTemplate!=="hide"){new c.Element("span",{"class":"customHeader",text:"DRM mode "}).inject(this.drmModeContainer);var s=new i({elementsList:v,selectedIndex:"0",currentValue:u.drmMode==="Lsf"?p:u.drmMode,enableSearchFlag:false,disabled:this.isDrmModeAccessFromTempView}).inject(this.drmModeContainer);s.addEventListener("change",function(D){D.preventDefault();D.stopPropagation();var F=D.dsModel.currentValue;this.resetFlag(this.inValidCount);this.customExeOpt=[];var B=false,E="";for(var C=0;C<v.length;C++){var A=v[C].labelItem;if(A===F){B=v[C].isConfigured;E=v[C].name}}if(B){this.drmMode=E;this.loadSelectedDrmOptions(this.drmMode);if(this.emptyMessage){this.emptyMessage.removeClassName("show")}}else{if(this.emptyMessage){this.emptyMessage.addClassName("show")}if(this.drmOptContainer){this.drmOptContainer.destroy()}}}.bind(this))}if(!o){if(this.emptyMessage){this.emptyMessage.destroy()}this.emptyMessage=new c.Element("span",{"class":"emptyMessage show",text:this.drmMode+" DRM mode is not configured on default COS.\n To continue please change default COS or change DRM mode."}).inject(this.container);return}this.loadSelectedDrmOptions(this.drmMode)},loadSelectedDrmOptions:function(l){if(l==="fiper"){this.processDRMOptionUI(this.fiperOpt)}else{if(l==="Lsf"){this.processDRMOptionUI(this.lsfOpt)}else{if(l===null||l===undefined||l===""){return}j.getDRMConfigOptionsJson(l,{onComplete:function(m,n,u){if(!m&&u){m=u.response}var o=this,p=JSON.parse(m);this.customOptions=p["wfext.Extension"].Properties.Property;if(this.customOptions&&this.customOptions.length>0){for(var s=0;s<this.customOptions.length;s++){var q=false;this.customOptions[s].title_display=this.customOptions[s].DisplayName.$||this.customOptions[s].DisplayName;this.customOptions[s].title=this.customOptions[s]["@name"];this.customOptions[s].type=this.customOptions[s]["@type"]?this.customOptions[s]["@type"]:"string";for(var r=0;r<this.customExeOpt.length;r++){if(this.customOptions[s].title===this.customExeOpt[r].title){this.customOptions[s].value=this.customExeOpt[r].value;q=true;break}}if(q){this.customOptions[s].value=this.customExeOpt[r].value}else{if(this.customExeOpt.length===0){this.customOptions[s].value=this.customOptions[s].Value}else{this.customOptions[s].value=""}}if(this.customOptions[s].hasOwnProperty("@ReadOnlyFlag")){if(this.customOptions[s]["@ReadOnlyFlag"]==="true"){this.customOptions[s].readonly=true}else{this.customOptions[s].readonly=false}}if(this.customOptions[s].hasOwnProperty("@required")){if(this.customOptions[s]["@required"]==="true"){this.customOptions[s].required=true}else{this.customOptions[s].required=false}}var t=this.customOptions[s]["@VisibleFlag"];if(t!==undefined&&t!==null&&t!==""){if(t.toLocaleLowerCase()==="false"){this.customOptions[s].visible=false}else{this.customOptions[s].visible=true}}else{this.customOptions[s].visible=true}this.customOptions[s].drm=l;delete this.customOptions[s].DisplayName;delete this.customOptions[s]["@type"];delete this.customOptions[s].Value}}else{this.customOptions=[]}o.processDRMOptionUI(this.customOptions)}.bind(this),onFailure:function(m){alert("ERROR in CosAPI.getDRMConfigOptionsJson(); "+m)}})}}},processDRMOptionUI:function(q){this.inValidCount=0;var t=this,u=[];if(this.drmOptContainer){this.drmOptContainer.destroy()}this.drmOptContainer=new c.Element("div",{"class":"wux-control-inline-container",styles:{display:"block","margin-left":"-5px"}});this.drmOptContainer.inject(this.container);for(var H=0;H<q.length;H++){var x=q[H].title_display,A=q[H].value,y=false,v=false;if(q[H].hasOwnProperty("action")){var C=false;var s=false;if(q[H].action==="view"){C=true}if(q[H].editableInPS==="true"){y=false}else{y=C}if(q[H].action==="edit compulsory"){s=true}if(s||q[H].required){v=true}}else{y=q[H].readonly;v=q[H].required}var D,m;if(q[H].visible!==undefined&&q[H].visible!==null&&q[H].visible!==""){m=q[H].visible}else{if(q[H].action==="hide"&&q[H].editableInPS==="false"){m=false}else{m=true}}if(v===true){D="wux-controls-lineeditor required-field"}else{D="wux-controls-lineeditor no-required-field"}if(m){if(q[H].Limit){var o=0;var N=q[H].Limit.$,E=N.toString().split("\n"),K=[{labelItem:""}];for(var F=0;F<E.length;F++){K[F+1]={labelItem:E[F]}}for(var L=0;L<K.length;L++){if((K[L].labelItem).trim()===A){o=L;break}}var p=new c.Element("div",{"class":D,styles:{display:"block"}}).inject(this.drmOptContainer);p.name=x;new c.Element("span",{"class":"customHeader",text:x}).inject(p);var r=new i({elementsList:K,selectedIndex:o,enableSearchFlag:false,disabled:y}).inject(p);if(v===true){if((r.selectedIndex===0)){this.inValidFlagCheck();t.inValidCount++;p.setAttribute("class","wux-controls-lineeditor required-field")}else{p.setAttribute("class","wux-controls-lineeditor no-required-field")}}r.setOption("name",x);r.setOption("required",v);r.addEventListener("change",function(O){O.preventDefault();O.stopPropagation();t.setDrmOption(t.drmMode,O.dsModel.getOption("name"),O.dsModel.currentValue);if(O.dsModel.getOption("required")===true){if((O.dsModel.selectedIndex===0)){t.inValidFlagCheck();t.inValidCount++;O.target.getParent().setAttribute("class","wux-controls-lineeditor required-field")}else{t.validFlagCheck();if(t.inValidCount>0){t.inValidCount--}O.target.getParent().setAttribute("class","wux-controls-lineeditor no-required-field")}}})}else{if(q[H].type==="boolean"){var o=0;var l=["","true","false"];q[H].Limit={$:l};for(var G=0;G<l.length;G++){u[G]={labelItem:l[G]}}for(var L=0;L<u.length;L++){if((u[L].labelItem).trim()===(A).toString()){o=L;break}}var J=new c.Element("div",{"class":D,styles:{display:"block"}});J.inject(this.drmOptContainer);new c.Element("span",{"class":"customHeader",text:x}).inject(J);var z=new i({elementsList:u,selectedIndex:o,disabled:y,enableSearchFlag:false}).inject(J);if(v===true){if((z.selectedIndex===0)){this.inValidFlagCheck();t.inValidCount++;J.setAttribute("class","wux-controls-lineeditor required-field")}else{J.setAttribute("class","wux-controls-lineeditor no-required-field")}}z.setOption("name",x);z.setOption("required",v);z.addEventListener("change",function(O){O.preventDefault();O.stopPropagation();if(O.dsModel.getOption("required")===true){if((O.dsModel.selectedIndex===0)){t.inValidFlagCheck();t.inValidCount++;O.target.getParent().setAttribute("class","wux-controls-lineeditor required-field")}else{t.validFlagCheck();if(t.inValidCount>0){t.inValidCount--}O.target.getParent().setAttribute("class","wux-controls-lineeditor no-required-field")}}t.setDrmOption(t.drmMode,O.dsModel.getOption("name"),O.dsModel.currentValue)})}else{if(q[H].type==="integer"){var I=false;var M=new c.Element("div",{"class":D,styles:{display:"block"}});M.inject(this.drmOptContainer);new c.Element("span",{"class":"customHeader",text:x}).inject(M);var w=new c.Element("INPUT",{"class":"numberDiv",type:"text",value:A,min:"0",required:v}).inject(M);if(y){w.set({readOnly:"readonly",disabled:"true"})}w.set({name:x});if(v===true){if(w.value===""){t.inValidFlagCheck();t.inValidCount++;M.setAttribute("class","wux-controls-lineeditor required-field")}else{M.setAttribute("class","wux-controls-lineeditor no-required-field")}}w.addEventListener("keypress",function(P){var O=0;if(!P){P=window.event}if(P.keyCode){O=P.keyCode}if(P.which){O=P.which}if(O===8||O===37||O===39||P.key==="Delete"){I=false;return true}else{if(O===45&&this.value.indexOf("-")===-1){if(this.value.contains("-")&&this.value.charAt("-")!==0){I=false;P.preventDefault();return false}}else{if(O===46&&!isNaN(this.value)&&this.value.indexOf(".")===-1){if(this.value.contains(".")&&this.value.indexOf(".")===1){I=false;P.preventDefault();return false}}else{if(O>=48&&O<=57){I=true}else{P.preventDefault();I=false}}}}});w.addEventListener("keyup",function(S){var O=false;var P="";if(S.target.value.contains("-")&&S.target.value.indexOf("-")!==0){S.target.value=S.target.value.slice(0,-1)}for(var Q=0;Q<t.customOptions.length;Q++){if(t.customOptions[Q].title_display===S.target.name){var R=S.target.value;P=t.customOptions[Q].value;if(R===""&&P===""){O=true}if(S.key==="Backspace"&&R===""&&P!==""){I=true}if(S.key==="Backspace"&&R===""&&P===""){I=false}if(S.key==="Delete"&&R===""&&P!==""){I=true}if(S.key==="Delete"&&R===""&&P===""){I=false}if(!(P.toString().length===0||R.toString().length===0)){O=true}break}}if(I&&S.target.getAttribute("required")==="true"){if(S.target.value===""){t.setDrmOption(t.drmMode,S.target.name,S.target.value);t.inValidFlagCheck();t.inValidCount++;S.target.parentElement.setAttribute("class","wux-controls-lineeditor required-field")}else{if(O){t.setDrmOption(t.drmMode,S.target.name,S.target.value)}else{t.setDrmOption(t.drmMode,S.target.name,S.target.value);t.validFlagCheck();if(t.inValidCount>0){t.inValidCount--}S.target.parentElement.setAttribute("class","wux-controls-lineeditor no-required-field")}}}else{S.preventDefault();S.stopPropagation();t.setDrmOption(t.drmMode,S.target.name,S.target.value)}w.addEventListener("change",function(T){T.preventDefault();T.stopPropagation();t.setDrmOption(t.drmMode,T.target.name,T.target.value)})})}else{var n=new c.Element("div",{"class":D,styles:{display:"block"}});n.inject(this.drmOptContainer);new c.Element("span",{"class":"customHeader",text:x}).inject(n);var B=new b({value:A,disabled:y,requiredFlag:v,title:A}).inject(n);B.setOption("name",x);if(B.requiredFlag===true){if(B.value===""||B.value===undefined){this.inValidFlagCheck();t.inValidCount++;n.setAttribute("class","wux-controls-lineeditor required-field")}else{n.setAttribute("class","wux-controls-lineeditor no-required-field")}}B.addEventListener("validFlagChange",function(O){if(!O.target.querySelector("input").validity.valid){this.inValidFlagCheck();t.inValidCount++;O.target.getParent().setAttribute("class","wux-controls-lineeditor required-field")}else{this.validFlagCheck();if(t.inValidCount>0){t.inValidCount--}O.target.getParent().setAttribute("class","wux-controls-lineeditor no-required-field")}}.bind(this));B.addEventListener("change",function(O){O.preventDefault();O.stopPropagation();t.setDrmOption(t.drmMode,O.dsModel.getOption("name"),O.dsModel.value)})}}}}}},setDrmOption:function(m,l,n){if(m==="fiper"){this.setOption(this.fiperOpt,l,n)}else{if(m==="Lsf"){this.setOption(this.lsfOpt,l,n)}else{this.setOption(this.customOptions,l,n)}}},setOption:function(n,m,o){for(var l=0;l<n.length;l++){if(n[l].title_display===m){n[l].value=o;break}}},getSelectedDrmMode:function(){return this.drmMode},getDrmOptions:function(){if(this.drmMode==="fiper"){return this.fiperOpt}else{if(this.drmMode==="Lsf"){return this.lsfOpt}else{return this.customOptions}}},inValidFlagCheck:function(){var l=new CustomEvent("drmoptionsinvalid");this.container.dispatchEvent(l)},validFlagCheck:function(){var l=new CustomEvent("drmoptionsvalid");this.container.dispatchEvent(l)},resetFlag:function(){var l=new CustomEvent("resetrequiredcount");this.container.dispatchEvent(l)}});return g});