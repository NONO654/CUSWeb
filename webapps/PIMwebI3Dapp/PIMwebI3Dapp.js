window.top.performance.mark("PIM_jsAppLoad");
/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebI3Dapp/PIMwebI3DappInit",["DS/WAfrContainer/App"],function(b){var a;function c(e,d){return e.extend({setUp:function(f){if(!f.sourceApp){var h=this;require(["DS/PIMwebI3Dapp/PIMwebI3DappMain"],function(i){a=i.getApp({widget:window.widget,viewerAttachment:function(j){h.pad3DViewer=j.pad3DViewer;f.done(j.pad3DViewer.render())},modelerType:d})});return}if(!f.sourceApp.pad3DViewer){window.console.log("pad3DViewer property must be valuated");f.done();return}this.pad3DViewer=f.sourceApp.pad3DViewer;function g(i){if(i.sourceApp&&!i.sourceApp.isDisposeCalled()){i.sourceApp.dispose(i)}a.setUp(i)}if(!a){require(["DS/PIMwebI3Dapp/PIMwebI3DappMain"],function(i){a=i.getApp({widget:window.widget,pad3DViewer:f.sourceApp.pad3DViewer});g(f)})}else{g(f)}},dispose:function(f){a.dispose(f);this._parent(f)}})}return c(b,"VPM")});define("DS/PIMwebI3Dapp/PIMwebI3DappMain",[],function(){var b;function a(g){if(b||null===b){return b}var A,D,u=g.widget,x=g.pad3DViewer,e,l,z,B,r=x?x.getCommandContext():null,m={module:"PIMwebI3Dapp",file:"PIMwebI3DappWkb.xml"};function p(G,F,E){window.top.performance.measure(u.id+G,E?u.id+F:F)}function C(E){window.top.performance.mark(u.id+E)}function w(){if(x){x.getContentName({callbacks:{onComplete:function(E){u.setTitle(E.contentName)},onFailure:function(){}}})}}var h,v,s;function k(F){if(!D){window.console.log("No interference controller available. This should not happen at this point!!");return}function E(G){if(!u.hasPreference("ItfSimuInSession")){u.addPreference({name:"ItfSimuInSession",type:"hidden"})}u.setValue("ItfSimuInSession",JSON.stringify(G.isrLog))}if(F&&h===undefined){h=D.subscribe("onIsrAdded",E);v=D.subscribe("onItfAdded",E)}else{if(!F&&h>=0){D.unsubscribe(h);h=undefined;D.unsubscribe(v);v=undefined}}if(!s){s=D.subscribe("onIsrRemoved",function(G){u.setValue("ItfSimuInSession",JSON.stringify(G.isrLog))})}}function i(I){if(!D||!A||l){return}e({pad3DViewer:I});e=null;require(["DS/ENOPAD3DViewer/utils/PAD3DViewerRestoreSession"],function(J){J.restoreSession()});k(true);var H=u.getValue("ItfSimuInSession");H=H?JSON.parse(H):null;if(H&&!Array.isArray(H)&&typeof H==="object"){var G=Object.keys(H);if(G.length===1){var F={},E=G[0];if(Array.isArray(H[E])&&H[E].length){F.metricID=H[E]}else{F.isrID=E}D.load(F)}}p("_PIM_Global widget creation time","PIM_jsAppLoad",false);u.dispatchEvent("onWidgetAndAppReady",u.getValue("widgetForODTReplay")==="1"?[{pad3DViewer:I}]:undefined)}function f(E){E.unsubscribe(z);z=null;E.getController()._model._modelLoader.setCGRWithSG(true);C("_PIM_beforeAppComponentLoad");require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(F){p("_PIM_AppComponentLoading","_PIM_beforeAppComponentLoad",true);D=F.getItfCtrl({pad3DViewer:E});D.activate({readOnly:false});i(E)})}function q(E){E.unsubscribe(B);B=null;var F=E.subscribe({event:"onActionBarReady"},function(){p("_PIM_Action Bar merge app commands","_PIM_ownCommands",true);C("_PIM_beforeDefaultCmdLoad");E.unsubscribe(F);F=null;r=x.getCommandContext();A=require("DS/ApplicationFrame/CommandsManager");p("_PIM_Default Cmd Init","_PIM_beforeDefaultCmdLoad",true);i(E)});C("_PIM_ownCommands");E.loadActionBar({merge:true,file:m.file,module:m.module})}function t(E){p("_PIM_PAD3DViewer creation","_PIM_PAD3DViewerReady",true);E.unsubscribe(l);l=null;i(E)}var o=function(E){o=function(){};var G,H=[],J=[],F=require("DS/PADUtils/PADSettingsMgt"),I=require("DS/PADUtils/PADCommandProxy");require(["DS/PIMwebViewModel/PIMwebUnits","i18n!DS/PIMwebI3Dapp/assets/nls/PIMwebI3Dapp","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(P,L,K,O,M){function Q(){H.forEach(function(R){var T=R.preference.name;var U=u.getValue(T),S=F.getSetting(T);U=R.preference.type==="boolean"&&(typeof U!=="boolean")?"true"===U:U;if(U!==S){F.setSetting(T,U)}if(R.fct){R.fct(U)}});F.updateWidgetPreferences();if(!G&&H.length){G=I.create({events:{onPreferenceModification:function(R){H.some(function(S){if(R.name===S.preference.name){if(typeof R.value!=="boolean"&&typeof R.value!=="string"){throw new Error("Value must be a string or a boolean")}if(F.getSetting(R.name)!==R.value){if(S.preference.type==="boolean"&&typeof R.value!=="boolean"){throw new Error("Preference is a boolean type so value must be a boolean")}S.debounce=true;u.setValue(R.name,S.preference.type==="boolean"?(R.value?"true":"false"):R.value);F.setSetting(R.name,R.value)}if(S.fct){S.fct(R.value)}return true}return false})}}});H.forEach(function(R){if(R.cb){F.addEvent(R.cb,function(S){if(!R.debounce){G.preferenceModification({name:R.preference.name,value:S})}else{R.debounce=false}})}})}}function N(){var U=K.listAvailableSharedSettings(),T=K.usedSharedSettings,S=[],R;R=U.indexOf("useIndexAccleration");if(R!==-1){U.splice(R,1);if(T.indexOf("useIndexAccleration")===-1){S.push("useIndexAccleration")}}K.addSharedSettings(u,S);J.forEach(function(V){u.deleteValue(V)});J.length=0;H.forEach(function(V){u.mergePreferences([V.preference])});U.forEach(function(V){if(T.indexOf(V)===-1){S.push(V)}});K.addSharedSettings(u,S);if(!u.hasPreference(P.Types.Length.name)){u.addPreference({name:P.Types.Length.name,type:"list",label:L.UnitsLengthText,defaultValue:P.Types.Length.defaultValue,options:[{label:L.Millimeter,value:P.Length.mm.name},{label:L.Centimeter,value:P.Length.cm.name},{label:L.Meter,value:P.Length.m.name},{label:L.Kilometer,value:P.Length.km.name},{label:L.Inch,value:P.Length.inch.name},{label:L.Foot,value:P.Length.foot.name}]});u.addPreference({name:P.Types.Angle.name,type:"list",label:L.UnitsAngleText,defaultValue:P.Types.Angle.defaultValue,options:[{label:L.Degree,value:P.Angle.deg.name},{label:L.Radian,value:P.Angle.rad.name}]});u.addPreference({name:P.Types.Area.name,type:"list",label:L.UnitsAreaText,defaultValue:P.Types.Area.defaultValue,options:[{label:L.SquareMillimeter,value:P.Area.mm2.name},{label:L.SquareCentimeter,value:P.Area.cm2.name},{label:L.SquareMeter,value:P.Area.m2.name},{label:L.SquareKilometer,value:P.Area.km2.name},{label:L.SquareInch,value:P.Area.inch2.name},{label:L.SquareFoot,value:P.Area.foot2.name}]});u.addPreference({name:P.Types.Volume.name,type:"list",label:L.UnitsVolumeText,defaultValue:P.Types.Volume.defaultValue,options:[{label:L.CubicMillimeter,value:P.Volume.mm3.name},{label:L.CubicCentimeter,value:P.Volume.cm3.name},{label:L.CubicMeter,value:P.Volume.m3.name},{label:L.CubicKilometer,value:P.Volume.km3.name},{label:L.CubicInch,value:P.Volume.inch3.name},{label:L.CubicFoot,value:P.Volume.foot3.name}]})}if(H.length||S.length){Q();u.addEvent("endEdit",Q)}}if(!u.hasPreference("changeControlActivation")){M.initialize2(E.getFrameWindow().getViewerFrame(),I.appId(),"hide","top-right",function(R){if(R&&R.isLicenseValid===true){H.push({preference:{name:"changeControlActivation",type:"boolean",label:O.changeControlActivation_label,defaultValue:"false"},fct:function(S){M[S?"show":"hide"]()},cb:"onChangeControlActivation",debounce:false});H.push({preference:{name:"changeControlPosition",type:"list",label:O.changeControlPosition_label,defaultValue:"top-right",options:[{label:O["top-right_label"],value:"top-right"},{label:O["top-left_label"],value:"top-left"},{label:O["bottom-left_label"],value:"bottom-left"},{label:O["bottom-right_label"],value:"bottom-right"}]},fct:function(S){M.setPosition(S)}});F.setSetting("authorizeChangeControl",true)}else{J.push("changeControlActivation");J.push("changeControlPosition")}N()})}else{N()}})};function c(){if(!x){p("_PIM_UWA widget loading","_PIM_widgetLoad",true);C("_PIM_LoadJSPAD3DViewer");require(["DS/ENOPAD3DViewer/PAD3DViewer","DS/ENOPAD3DViewer/utils/PAD3DViewerRestoreSession","text!DS/PIMwebI3Dapp/assets/json/PIMwebI3DWindowOptions.json"],function(E,H,F){p("_PIM_PAD3DViewer load JS","_PIM_LoadJSPAD3DViewer",true);C("_PIM_PAD3DViewerReady");var I=JSON.parse(F);I.context="Default";x=new E({widget:u,windowOptions:I,actionbar_corrected:true});var G=require("DS/PADUtils/PADSettingsMgt");G.setSetting("appModelerType","VPM");G.setSetting("settypes",true);x.setAuthorizedRootTypes(G.getSetting("ups_authorized_root_types"));z=x.subscribe({event:"onViewerReady"},f);B=x.subscribe({event:"onActionBarReady"},q);l=x.subscribe({event:"onReady"},t);H.init({widget:u,pad3DViewer:x});x.subscribe({event:"onRootAdded"},w);x.subscribe({event:"onRootRemoved"},w);x.subscribe({event:"onRootAttached"},w);x.subscribe({event:"onRootDetached"},w);x.subscribe({event:"onContentNameModified"},w);o(x)})}}function n(){if(x){x.refresh()}}function d(){if(D){D.dereference()}b=u=x=e=A=D=null}function y(){var E=x;d();if(E){E.destroy()}}function j(E){if(x){x.search({searchQuery:E})}}if(!x){p("_PIM_JS dependencies loading","PIM_jsAppLoad",false);C("_PIM_widgetLoad");if(g.viewerAttachment){e=g.viewerAttachment;c()}else{e=function(E){u.setBody(E.pad3DViewer.render())};u.addEvent("onLoad",c)}u.addEvent("onRefresh",n);u.addEvent("onDestroy",y);u.addEvent("onSearch",j);u.setMetas({helpPath:"PIMwebI3Dapp/assets/help"})}else{o(x);u.addEvent("onDestroy",d)}return(b=Object.freeze({setUp:function(H){if(!A){require(["DS/ApplicationFrame/CommandsManager"],function(I){A=I;b.setUp(H)});return}var G={lastCommand:[],currentCommand:null,defaultCommand:null};if(r){A._commandsState[r]=G}else{A._commandsState=G}A.resetDefaultCommand(r);A._isCommandEnding=false;A._ignoreCommandBeginWhileEndingCommand=false;["_commands","_cmdCheckHeader"].forEach(function(J){var I=r?A[J][r]:A[J];Object.keys(I).forEach(function(K){var L=I[K];if(L&&L._destroy){L._destroy()}delete I[K]})});if(H.sourceApp&&H.sourceApp.pad3DViewer!==x){if(D){D.dereference()}D=null;x=H.sourceApp.pad3DViewer}u.setMetas({helpPath:"PIMwebI3Dapp/assets/help"});x.setDefaultContextualBarVisibility(true);x.setDefaultContextualMenuVisibility(true);var F=0;var E=x.subscribe({event:"onActionBarReady"},function(){F++;if(F===1){x.loadActionBar({merge:true,file:m.file,module:m.module})}else{x.unsubscribe(E);H.done()}});x.loadActionBar({merge:false,file:"ENOPAD3DViewer.xml",module:"ENOPAD3DViewer"});if(!D){require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(I){D=I.giveItfCtrl({pad3DViewer:x});if(!D){u.deleteValue("ItfSimuInSession");D=I.getItfCtrl({pad3DViewer:x})}k(true);D.activate({readOnly:false})})}else{k(true);D.activate({readOnly:false})}},dispose:function(G){if(D){k(false);D.deactivate()}if(G){var F=u.getValue("ItfSimuInSession");F=F?JSON.parse(F):null;if(F&&!Array.isArray(F)&&typeof F==="object"){var E=Object.keys(F);if(E.length===1){G.preferredType="SIMItfSimulation"}}}}}))}return Object.freeze({getApp:a})});