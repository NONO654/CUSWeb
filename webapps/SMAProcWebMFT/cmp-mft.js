require(["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/SMAProcWebCMMUtils/SMAJSCMMUtils","DS/SMAProcWebCMMUtils/SMAJSCMMParameterUtils","DS/JSCMM/SMAJSCMMParameter","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAProcWebCommonControls/NativeEditor","DS/UIKIT/Spinner","DS/JSCMM/SMAJSCMMFactory","DS/SMAProcWebContents/SMAProcWebContentSDK"],function(a,f,b,h,e,i,c,d,g){window.Polymer({is:"pcw-mft-adapter",properties:{ExtensionEditorImpl:{type:Object},mftUrl:{type:String,value:null},mftUsername:{type:String,value:null},mftPassword:{type:String,value:null},mftProcesses:{type:Object,value:null},mftSelectedProcess:{type:Object,value:null},processLoaded:{type:Boolean,value:false},processChangedCallbackClass:{type:Object,value:null},processChangedCallbackMethod:{type:Object,value:null}},ready:function(){this.ExtensionEditorImpl=this;this.$.mftMessage.style.display="none";this.$.processValidation.style.display="none";this.$.mftLogin.style.display="none";this.listen(this.$.processTitlePaneExpand,"click","_expandProcessChooser");this.listen(this.$.processTitlePaneValidate,"click","_validateProcess");this.listen(this.$.mftMessageClose,"click","_closeMessage");this.$.processChooser.addProcessListener(this);this.$.processChooser.setMftElement(this);this.$.processValidation.setMftElement(this)},getMftUrl:function(){return this.mftUrl},getMftUsername:function(){return this.mftUsername},setMftUsername:function(j){this.mftUsername=j},getMftPassword:function(){return this.mftPassword},setMftPassword:function(j){this.mftPassword=j},showLogin:function(k,n,l,m,j){this.$.mftLogin.setMftUrl(k);this.$.mftLogin.setOkCallback(n,l);this.$.mftLogin.setCancelCallback(m,j);this.$.mftLogin.style.display=""},processChanged:function(k,l,j){this.mftSelectedProcess=k;this.processChangedCallbackClass=l;this.processChangedCallbackMethod=j;if(this.mftSelectedProcess&&this.mftSelectedProcess.id){this._loadProcess()}},_loadProcess:function(){this.processLoaded=false;this.$.processTitlePaneText.innerText="Loading ...";this._loadProcessSuccess(this.mftSelectedProcess);if(this.processChangedCallbackClass&&this.processChangedCallbackMethod){this.processChangedCallbackMethod.call(this,this.processChangedCallbackClass)}if(event){event.stopPropagation()}},_loadProcessSuccess:function(j){this.mftUrl=this.$.processChooser.getMftUrl();this.mftProcesses=this.$.processChooser.getProcesses();this.mftSelectedProcess=j;this.$.processTabs.setProcess(this.mftSelectedProcess,this.activity);this.processLoaded=true;this._updateProcessLoadedState()},_expandProcessChooser:function(j){this.$.processChooser.setMftUrl(this.mftUrl);this.$.processChooser.setProcesses(this.mftProcesses);this.$.processChooser.setInitialProcess(this.mftSelectedProcess);this.$.processChooser.style.display="";if(j){j.stopPropagation()}},_collapseProcessChooser:function(j){this.$.processChooser.style.display="none"},_updateProcessLoadedState:function(){if(this.processLoaded&&this.mftSelectedProcess){this.$.processTitlePaneText.innerText="Process Successfully Loaded";if(this.mftSelectedProcess.name){this.$.processTitlePaneText.innerText=this.mftSelectedProcess.name;if(this.mftSelectedProcess.publisherName){this.$.processTitlePaneText.innerText=this.mftSelectedProcess.name+", "+this.mftSelectedProcess.publisherName}}if(this.mftSelectedProcess.shortDescription){this.$.processTitlePaneText.setAttribute("title",this.mftSelectedProcess.shortDescription)}else{this.$.processTitlePaneText.setAttribute("title","")}this.$.processChooser.style.display="none"}else{this.$.processTitlePaneText.innerText="No Remote Process Selected";this.$.processChooser.style.display=""}},_validate:function(j){if(this.mftElement.getMftUsername()&&this.mftElement.getMftPassword()&&this.getMftUrl()==this.mftElement.getMftUrl()){}},_validateProcess:function(j){this.$.processTitlePane.style.display="none";this.$.processTabs.style.display="none";this.$.processValidation.style.display="";this.$.processValidation.setCloseCallbackClass(this);this.$.processValidation.setCloseCallback(this._validateProcessClosed);this.$.processValidation.setProcess(this.mftSelectedProcess);this.$.processChooser.getMftPluginElement(function(k){this.$.processValidation.validate(k,this.mftSelectedProcess.id)}.bind(this));if(j){j.stopPropagation()}},_validateProcessClosed:function(j){j.$.processTitlePane.style.display="";j.$.processTabs.style.display="";j.$.processValidation.style.display="none"},showMessage:function(j){this.$.mftMessageText.innerText=j;this.$.mftMessage.style.display="";if(!this.$.processChooser.classList.contains("mftDisabled")){this.$.processChooser.classList.add("mftDisabled")}if(!this.$.processTitlePane.classList.contains("mftDisabled")){this.$.processTitlePane.classList.add("mftDisabled")}if(!this.$.processTabs.classList.contains("mftDisabled")){this.$.processTabs.classList.add("mftDisabled")}if(!this.$.processValidation.classList.contains("mftDisabled")){this.$.processValidation.classList.add("mftDisabled")}if(!this.$.mftLogin.classList.contains("mftDisabled")){this.$.mftLogin.classList.add("mftDisabled")}if(event){event.stopPropagation()}},_closeMessage:function(j){this.$.mftMessageText.innerText="No Messages";this.$.mftMessage.style.display="none";if(this.$.processChooser.classList.contains("mftDisabled")){this.$.processChooser.classList.remove("mftDisabled")}if(this.$.processTitlePane.classList.contains("mftDisabled")){this.$.processTitlePane.classList.remove("mftDisabled")}if(this.$.processTabs.classList.contains("mftDisabled")){this.$.processTabs.classList.remove("mftDisabled")}if(this.$.processValidation.classList.contains("mftDisabled")){this.$.processValidation.classList.remove("mftDisabled")}if(this.$.mftLogin.classList.contains("mftDisabled")){this.$.mftLogin.classList.remove("mftDisabled")}if(j){j.stopPropagation()}},UpdateUI:function(k,l,t){var r=this;this.activity=k;this.step=l;this.extensionConfig=t;this.processLoaded=false;this._expandProcessChooser();var n=this.extensionConfig.getPropertyByName("mftPlugin");if(n&&n.getValue()&&n.getValue().trim()!=""&&n.getValue().trim()!="undefined"){var n=n.getValue().trim();console.log("mft plugin:",n);var p=t.getPluginConfigurations()||[];var q=null;if(p.length>0){q=p[0]}this.$.processChooser.setMftPlugin(n,q)}var m=this.extensionConfig.getPropertyByName("mftUrl");if(m&&m.getValue()&&m.getValue().trim()!=""&&m.getValue().trim()!="undefined"){this.mftUrl=m.getValue();this.$.processChooser.setMftUrl(this.mftUrl)}else{this.mftUrl="";this.$.processChooser.setMftUrl(this.mftUrl)}var o=this.extensionConfig.getPropertyByName("mftAdvancedOptions");if(o){}var j=this.extensionConfig.getPropertyByName("remoteProcesses");if(j&&j.getValue()&&j.getValue().trim()!=""&&j.getValue().trim()!="undefined"){this.mftProcesses=JSON.parse(j.getValue().trim());this.$.processChooser.setProcesses(this.mftProcesses)}else{this.mftProcesses=null;this.$.processChooser.setProcesses()}var s=this.extensionConfig.getPropertyByName("selectedRemoteProcess");if(s&&s.getValue()&&s.getValue().trim()!=""&&s.getValue().trim()!="undefined"){this.processChanged(JSON.parse(s.getValue().trim()));this.processLoaded=true;this._updateProcessLoadedState()}else{this.processChanged()}var v=this.extensionConfig.getPropertyByName("parameterMappings");if(v&&v.getValue()&&v.getValue().trim()!=""&&v.getValue().trim()!="undefined"){if(this.processLoaded){this.$.processTabs.setParameterMappings(JSON.parse(v.getValue().trim()))}else{this.$.processTabs.setParameterMappings()}}else{this.$.processTabs.setParameterMappings()}var u=this.extensionConfig.getPropertyByName("fileMappings");if(u&&u.getValue()&&u.getValue().trim()!=""&&u.getValue().trim()!="undefined"){if(this.processLoaded){this.$.processTabs.setFileMappings(JSON.parse(u.getValue().trim()))}else{this.$.processTabs.setFileMappings()}}else{this.$.processTabs.setFileMappings()}if(this.processLoaded){this._collapseProcessChooser()}},Apply:function(){var m=this.extensionConfig.getPropertyByName("mftPlugin");if(m){var p=this.$.processChooser.getMftPluginElement().getPluginName();this.extensionConfig.setPropertyValue(m,p)}var k=this.extensionConfig.getPropertyByName("mftUrl");if(k){this.extensionConfig.setPropertyValue(k,this.mftUrl)}var o=this.extensionConfig.getPropertyByName("mftAdvancedOptions");if(o){}var j=this.extensionConfig.getPropertyByName("remoteProcesses");if(j){if(this.mftProcesses){this.extensionConfig.setPropertyValue(j,JSON.stringify(this.mftProcesses))}else{this.extensionConfig.setPropertyValue(j,"[]")}}var r=this.extensionConfig.getPropertyByName("selectedRemoteProcess");if(r){if(this.mftSelectedProcess){this.extensionConfig.setPropertyValue(r,JSON.stringify(this.mftSelectedProcess))}else{this.extensionConfig.setPropertyValue(r,"")}}var t=this.extensionConfig.getPropertyByName("parameterMappings");if(t){var l=this.$.processTabs.getParameterMappings();if(l){this.extensionConfig.setPropertyValue(t,JSON.stringify(l))}else{this.extensionConfig.setPropertyValue(t,"")}}var s=this.extensionConfig.getPropertyByName("fileMappings");if(s){var l=this.$.processTabs.getFileMappings();if(l){this.extensionConfig.setPropertyValue(s,JSON.stringify(l))}else{this.extensionConfig.setPropertyValue(s,"")}}var m=this.$.processChooser.getMftPluginElement();if(m){var n=this.extensionConfig.getPluginConfigurations()[0];if(n){this.extensionConfig.removePluginConfiguration(n)}m.apply();var q=m.getExtensionConfig();this.extensionConfig.addPluginConfiguration(q)}}})});