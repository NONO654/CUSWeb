require(["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebContents/PolyUtils","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/JSCMM/SMAJSCMMExtensionConfig","DS/SMAProcWebCommonControls/ExtensionChooser"],function(c,d,a,b){c({is:"mft-process-chooser",properties:{mftElement:{type:Object,value:null},mftUsername:{type:String,value:null},mftPassword:{type:String,value:null},mftPluginElement:{type:Object,value:null},initialProcess:{type:Object,value:null},selectedProcess:{type:Object,value:null},processListeners:{type:Object,value:[]},selectedExtension:{type:String,observer:"onPluginChange",}},ready:function(){this.$.processControlPaneCollapse.style.display="none";if(this.$.mftMessageCloseImage){this.$.mftMessageCloseImage.style.width="16px";this.$.mftMessageCloseImage.style.height="16px"}this.$.processChooserMftLoadButtonImage.style.width="16px";this.$.processChooserMftLoadButtonImage.style.height="16px";this.$.processControlPaneCollapseImage.style.width="16px";this.$.processControlPaneCollapseImage.style.height="16px";this.listen(this.$.processChooserMftUrl,"input","updateMftSelectedState");this.listen(this.$.processChooserMftLoadButton,"click","_mftLoadButtonClicked");this.listen(this.$.processControlPaneCollapseImage,"click","_collapseProcessChooser");this.listen(this.$.processControlPaneSelectButton,"click","_selectButtonClicked");this.$.processChooserProcessList.addProcessListener(this);this.updateMftSelectedState();this.updateProcessSelectedState()},onPluginChange:function(g){var f=this;var e=c.dom(f.$.mftPlugin).querySelector('[data-plugin-name="'+g+'"]');if(e){f.mftPluginElement=e}else{f.fetchMftPluginElement(g,function(h){h.update(f.mftElement.activity,f.mftElement.step,h.getExtensionConfig())})}},fetchMftPluginElement:function(g,f){var e=this;f=f||function(){};e.mftPluginElement=null;e.$.mftUrlContainer.classList.add("disabled");a.getExtensionDescriptor(g).then(function(j){var h=j.getWebComponent();var i=j.getWebpageUrl();d.resolveComponent(h,i,"isReady",function(k){e.$.mftUrlContainer.classList.remove("disabled");var m=j.createExtensionConfigData();var l=new b(m);k.setExtensionConfig(l);k.setProcessChooserElement(e);k.setMftElement(e.getMftElement());e.mftPluginElement=k;c.dom(e.$.mftPlugin).appendChild(k);f(k)})})},setMftPlugin:function(g,f){var e=this;d.whenComponentReady(this.$.pluginchooser).then(function(h){e.fetchMftPluginElement(g,function(i){i.update(e.mftElement.activity,e.mftElement.step,f||i.getExtensionConfig());h.selectedExtension=g})})},_mftAdvancedButtonClicked:function(e){e.stopPropagation()},_mftLoadButtonClicked:function(e){if(!this.$.processChooserMftLoadButton.classList.contains("processChooserDisabled")){this.$.processChooserMftLoadButton.classList.add("processChooserDisabled")}if(this.mftElement.getMftUsername()&&this.mftElement.getMftPassword()&&this.getMftUrl()==this.mftElement.getMftUrl()){this._approveLogin(this,this.mftElement.getMftUsername(),this.mftElement.getMftPassword())}else{this.mftElement.showLogin(this.getMftUrl(),this,this._approveLogin,this,this._cancelLogin)}e.stopPropagation()},_approveLogin:function(e,f,g){e.mftUsername=f;e.mftPassword=g;e.setProcesses();e._mftGetRemoteProcesses()},_cancelLogin:function(e){e.mftElement.setMftUsername(null);e.mftElement.setMftPassword(null);if(e.$.processChooserMftLoadButton.classList.contains("processChooserDisabled")){e.$.processChooserMftLoadButton.classList.remove("processChooserDisabled")}},_collapseProcessChooser:function(e){this.style.display="none";if(e){e.stopPropagation()}},_selectButtonClicked:function(e){if(!this.$.processMftChooser.classList.contains("processChooserDisabled")){this.$.processMftChooser.classList.add("processChooserDisabled")}this.$.processControlPaneCollapse.style.display="none";if(!this.$.processControlPaneSelectButton.classList.contains("processChooserDisabled")){this.$.processControlPaneSelectButton.classList.add("processChooserDisabled")}this._fireProcessListeners(this.selectedProcess);e.stopPropagation()},_clearProcessSelectionPane:function(){this._clearProcessSelectionPaneDetails()},_clearProcessSelectionPaneDetails:function(){this.$.processChooserProcessPublisher.value="";this.$.processChooserProcessPublishDate.value="";this.$.processChooserProcessDescription.value=""},_fireProcessListeners:function(f){for(var e=0;e<this.processListeners.length;e++){this.processListeners[e].processChanged(f,this,this._processChangedComplete)}},_processChangedComplete:function(e){if(e.$.processMftChooser.classList.contains("processChooserDisabled")){e.$.processMftChooser.classList.remove("processChooserDisabled")}if(e.initialProcess){e.$.processControlPaneCollapse.style.display=""}if(e.$.processControlPaneSelectButton.classList.contains("processChooserDisabled")){e.$.processControlPaneSelectButton.classList.remove("processChooserDisabled")}},processChanged:function(e){this.selectedProcess=e;this.updateProcessSelectedState()},setMftElement:function(e){this.mftElement=e},getMftElement:function(){return this.mftElement},getMftPluginElement:function(){return this.mftPluginElement},getMftUrl:function(){if(this.$.processChooserMftUrl.value.trim().endsWith("/")){this.$.processChooserMftUrl.value=this.$.processChooserMftUrl.value.trim().substring(0,this.$.processChooserMftUrl.value.trim().length-1)}return this.$.processChooserMftUrl.value.trim()},setMftUrl:function(e){this.$.processChooserMftUrl.value=e;this.updateMftSelectedState()},getProcesses:function(){return this.$.processChooserProcessList.getProcesses()},setProcesses:function(e){this.selectedProcess=null;this._clearProcessSelectionPaneDetails();this.$.processChooserProcessList.setProcesses(e)},addProcessListener:function(e){this.processListeners.push(e)},getSelectedProcess:function(){return this.selectedProcess},setInitialProcess:function(e){this.initialProcess=e;this._clearProcessSelectionPaneDetails();this.$.processChooserProcessList.setSelectedProcess(e);this.processChanged(this.initialProcess)},updateMftSelectedState:function(e){if(this.$.processChooserMftUrl.value&&this.$.processChooserMftUrl.value.trim()!=""){if(this.$.processChooserMftLoadButton.classList.contains("processChooserDisabled")){this.$.processChooserMftLoadButton.classList.remove("processChooserDisabled")}if(this.$.processChooserSelectionPane.classList.contains("processChooserDisabled")){this.$.processChooserSelectionPane.classList.remove("processChooserDisabled")}}else{if(!this.$.processChooserMftLoadButton.classList.contains("processChooserDisabled")){this.$.processChooserMftLoadButton.classList.add("processChooserDisabled")}if(!this.$.processChooserSelectionPane.classList.contains("processChooserDisabled")){this._clearProcessSelectionPane();this.updateProcessSelectedState();this.$.processChooserSelectionPane.classList.add("processChooserDisabled")}}if(e){e.stopPropagation()}},updateProcessSelectedState:function(e){this._clearProcessSelectionPaneDetails();if(this.selectedProcess){if(this.$.processSelectionDetailsPane.classList.contains("processChooserDisabled")){this.$.processSelectionDetailsPane.classList.remove("processChooserDisabled")}if(this.$.processControlPaneSelectButton.classList.contains("processChooserDisabled")){this.$.processControlPaneSelectButton.classList.remove("processChooserDisabled")}if(this.initialProcess){this.$.processControlPaneCollapse.style.display=""}if(this.selectedProcess.publisherName){this.$.processChooserProcessPublisher.value=this.selectedProcess.publisherName}if(this.selectedProcess.publisherDate){this.$.processChooserProcessPublishDate.value=this.selectedProcess.publisherDate}if(this.selectedProcess.longDescription){this.$.processChooserProcessDescription.value=this.selectedProcess.longDescription}}else{if(!this.$.processSelectionDetailsPane.classList.contains("processChooserDisabled")){this.$.processSelectionDetailsPane.classList.add("processChooserDisabled")}if(!this.$.processControlPaneSelectButton.classList.contains("processChooserDisabled")){this.$.processControlPaneSelectButton.classList.add("processChooserDisabled")}if(!this.initialProcess){this.$.processControlPaneCollapse.style.display="none"}else{this.$.processControlPaneCollapse.style.display=""}}if(e){e.stopPropagation()}},_mftGetRemoteProcesses:function(){this.mftPluginElement.getRemoteProcesses(this.getMftUrl(),this.mftUsername,this.mftPassword)},setRemoteProcessesSuccess:function(e){this.setProcesses(e);this.mftElement.setMftUsername(this.mftUsername);this.mftElement.setMftPassword(this.mftPassword);if(this.$.processChooserMftLoadButton.classList.contains("processChooserDisabled")){this.$.processChooserMftLoadButton.classList.remove("processChooserDisabled")}this.processChanged(this.selectedProcess)},setRemoteProcessesError:function(){this.setProcesses();this.mftElement.setMftUsername(null);this.mftElement.setMftPassword(null);console.log("MFT: Error getting the remote processes");if(this.$.processChooserMftLoadButton.classList.contains("processChooserDisabled")){this.$.processChooserMftLoadButton.classList.remove("processChooserDisabled")}this.processChanged(null)}})});