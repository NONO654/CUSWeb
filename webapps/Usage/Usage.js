define("DS/Usage/Events",function(){return{counter:{increment:"counter:increment"},timer:{start:"timer:start",stop:"timer:stop"},tracker:{creation:"tracker:creation",update:"tracker:update",getContent:"tracker:get-content",gotContent:"tracker:got-content"},page:{view:"page:view",event:"page:event"},data:{register:"data:register"}}});define("DS/Usage/UsageManager",["UWA/Utils","DS/WebappsUtils/Inherit","DS/WebappsUtils/Utils","DS/Usage/Events"],function(e,f,c,k){var r="_dsut";var y="_dsus";var l="_dsu";var j="_dss";var b=(function(){var A=window.location;return A.protocol+"//"+A.hostname+(A.port?":"+A.port:"")}());var n=30;var q=5000;var d=5000;var m=1000;var v=500;var p={themKey:"webapp",user:null,newVisitor:null};var u=(function(){var A=document.createElement("a");return function(B){A.href=B;return A.href}}());function w(){var D=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/g,B=e.parseUrl(window.location).domain,C,A="";if(!D.test(B)&&B!=="localhost"){C=B.split(".");if(C.length>2){C.shift()}A=C.join(".")}return A}function o(){var D=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/g,B=e.parseUrl(window.location).domain,C,A="";if(!D.test(B)&&B!=="localhost"){C=B.split(".");while(C.length>2){C.shift()}A=C.join(".")}return A}function h(){return{version:"1.27",r_schemaName:"WAPUsage",r_schemaVersion:"1.27",r_service:p.service,r_timestamp:Date.now(),them:p.themKey,sessionID:p.sessionID,user:p.user,casUser:p.authUser?c.sha256(p.authUser):"",newVisitor:p.newVisitor,service:p.service,referrer:p.referrer,serverhostname:window.location.hostname,context:{engine:c.clientEngine,platform:c.clientPlatform,navigation:{type:c.navigationType,startTime:p.navigationStart,browseTime:Date.now()-p.navigationStart},locale:navigator.language||"en-US"}}}function t(){var E,B=false,F=c.getCookie(y),A=c.getCookie(r),C=o(),D=w();if(F){c.setCookie(j,F,C,p.sessionDuration)}if(A){c.setPersistantCookie(l,A,C)}E=c.getCookie(j);if(!E){E=c.uuid();this.clearHeaderData();this.clearData()}c.setCookie(j,E,C,p.sessionDuration);p.sessionID=E;p.user=c.getCookie(l);if(!p.user){p.user=c.uuid();p.newVisitor=true}else{p.newVisitor=false}c.setPersistantCookie(l,p.user,C)}function s(D,B){var A,C;if(B.findIndex){A=B.findIndex(function(E){return E.name===D.name})}else{A=-1;for(C=0;C<B.length;C++){if(B[C].name===D.name){A=C;break}}}return A}function g(D,A,B,C){var E=s(D.data,C),F=D.origin,G=f.clone(D);G.topic=B;G.data=C[E];G.origin=b;G.forAPI=true;A.source.postMessage(JSON.stringify(G),F)}function a(){var A=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],C={},B=e.parseQuery(window.location.search);if(!B){return C}A.forEach(function(D){if(B.hasOwnProperty(D)){C[D]=B[D]}});return C}function x(J,C){var E=[],A,B,D,G,F,I,H;J.forEach(function(K){G=K.name&&K.name.split(":");B="legacy_category";D="legacy_action";if(G&&G.length>=2){B=G.shift();D=G.join(":")}if(G&&G.length==1){D=G[0]}K.timestamps&&K.timestamps.forEach(function(L){A={id:c.uuid(),category:B,action:D,timestamp:L,persDimPageEvents:[{pd1:"Legacy",}]};if(K.appID){A.appID=K.appID}if(K.tenant){A.tenant=K.tenant}E.push(A)})});if(E.length){if(C.length==1){C[0].events=C[0].events&&C[0].events.concat&&C[0].events.concat(E)}else{E.forEach(function(K){for(H=0;H<C.length;H++){F=C[H];I=(H==C.length-1)?{timestamp:K.timestamp+1}:C[H+1];if(F.timestamp-K.timestamp<=0&&I.timestamp-K.timestamp>0){F.events.push(K);F.events.sort(function(M,L){return M.timestamp-L.timestamp})}}})}}}var i={scrollable:function(A){return A.clientWidth<A.offsetWidth||A.style.overflowY=="scroll"||A.style.overflowY=="auto"},getAppScrollableContainer:function(B){var A=B,C;while(A){if(A.clientHeight<A.scrollHeight&&this.scrollable(A)){C=A}A=A.parentNode}return C?C:document.body},containerHeight:function(B){var C=Math.max(B.scrollHeight,B.offsetHeight,B.clientHeight);var A=B.getBoundingClientRect().top;return A+C},containerWidth:function(A){var C=Math.max(A.scrollWidth,A.offsetWidth,A.clientWidth);var B=A.getBoundingClientRect().left;return B+C},viewportTop:function(A){return A.scrollTop},viewportBottom:function(A){return this.viewportTop(A)+(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)},viewportLeft:function(A){return A.scrollLeft},viewportRight:function(A){return this.viewportLeft(A)+(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)}};var z={pages:[],interactions:[],data:{},trackers:[],getTrackers:function(A){return this.trackers.filter(function(B){return B.type===A})},clearData:function(){this.interactions=[];if(this.pages.length){this.pages=this.pages.slice(-1);this.pages[this.pages.length-1].events=[]}this.trackers=this.trackers.filter(function(A){return A.type!=="counter"})},clearHeaderData:function(){this.setConfiguration({navigationStart:Date.now(),newVisitor:null,sessionID:null,})},send:function(){var C=this,D=h(),E=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"xhr";if(D.context.navigation.browseTime<0){return}x(this.getTrackers("counter"),this.pages);D.context.navigation.pages=this.pages&&this.pages.map(function(G){var F={};["id","url","title","timestamp","tenant","appID","events","persDimPages","persValPages","pagelg"].forEach(function(H){if(G[H]){F[H]=G[H]}});F.events=F.events&&F.events.map(function(H){var I={};["id","category","action","timestamp","label","value","tenant","appID","persDimPageEvents","persValPageEvents"].forEach(function(J){if(H[J]){I[J]=H[J]}});return I});return F});var A={};["authUser","campaignId","utm_campaign","utm_content","utm_medium","utm_source","utm_term","pd1","pd2","pd3","pd4","pd5","pd6","pd7","pd8","pd9","pd10","pd11","pd12","pd13","pd14","pd15","pd16","pd17","pd18","pd19","pd20","pv1","pv2","pv3","pv4","pv5","pv6","pv7","pv8","pv9","pv10","pv11","pv12","pv13","pv14","pv15","pv16","pv17","pv18","pv19","pv20"].forEach(function(F){if(C.data[F]){A[F]=C.data[F]}});D.data=A;D.stats={};D.stats.counters=[];D.stats.timers=this.getTrackers("timer")&&this.getTrackers("timer").map(function(F){return f.extend({id:F.name,value:F.duration?F.duration:-1},F)}).filter(function(F){return F.value>-1});D.stats.interactions=this.interactions&&this.interactions.map(function(F){var G={};["id","className","tagName","clientX","clientY","action","timestamp","tenant","appID","viewportTop","viewportBottom","viewportLeft","viewportRight","pageWitdh","pageHeight","pageid"].forEach(function(H){if(typeof F[H]!=="undefined"){G[H]=F[H]}});return G});D=JSON.stringify(D);this.clearData();if(E==="beacon"){if(!navigator.sendBeacon){return c.beaconPolyfill(p.uploadPath,D)}else{return navigator.sendBeacon(p.uploadPath,D)}}else{var B=new XMLHttpRequest();B.open("POST",p.uploadPath);B.setRequestHeader("Content-Type","application/json");return B.send(D)}},updateTracker:function(B,D){var A=s(D,this.trackers),C=this.trackers[A];switch(B){case k.tracker.update:f.extend(C,D);break;case k.counter.increment:if(!C.timestamps){C.timestamps=[]}C.timestamps.push(Date.now());break;case k.timer.start:C.start<0&&(C.start=D.start);break;case k.timer.stop:if((C.start>=0&&C.stop<0)){C.stop=D.stop;C.duration=C.stop-C.start}break;default:break}},setUserInteraction:function(B){var D=B&&B.target,A,C;if(!D){return}C=i.getAppScrollableContainer(D);if(B.type==="scroll"&&C!==D){return}A={action:B.type,timestamp:Date.now(),pageid:this.pages[this.pages.length-1].id,viewportTop:i.viewportTop(C),viewportBottom:i.viewportBottom(C),viewportLeft:i.viewportLeft(C),viewportRight:i.viewportRight(C),pageWitdh:i.containerWidth(C),pageHeight:i.containerHeight(C)};["id","className","tagName"].forEach(function(F){var E=D[F];if(E&&(typeof E==="string"||E instanceof String)){A[F]=D[F]}});["clientX","clientY"].forEach(function(E){if(B[E]){A[E]=B[E]}if(B.touches&&B.touches[0]&&B.touches[0][E]){A[E]=B.touches[0][E]}});this.interactions.push(A);this.interactions=this.interactions.slice(0,100);this.sendDebounced()},readMessage:function(A){var G={},F,B,E=true,C;try{G=JSON.parse(A.data)}catch(D){}if(G.forAPI||!G.topic){return}A.stopPropagation();B=G.topic.split(":");B=B.length>2?B.slice(0,2):B;B=B.join(":");switch(B){case k.tracker.creation:(s(G.data,this.trackers)===-1)&&this.trackers.push(G.data);break;case k.page.view:G.data.events=[];G.data.id=c.uuid();this.pages.push(G.data);this.pages=this.pages.slice(0,100);this.pages.sort(function(H,I){return H.timestamp-I.timestamp});break;case k.page.event:C=this.pages[this.pages.length-1];G.data.id=c.uuid();C?C.events.push(G.data):console.log("UsageManager > You need to track page view before tracking a page event.");C.events=C.events.slice(0,100);break;case k.data.register:f.extend(this.data,G.data);break;case k.tracker.getContent:E=false;F=G.topic.split(k.tracker.getContent+":")[1];F&&g(G,A,k.tracker.gotContent+":"+F,this.trackers);break;default:this.updateTracker(G.topic,G.data,this.trackers);break}E&&this.sendDebounced()},setConfiguration:function(B){var A=f.clone(B||{});if(A.uploadPath){A.uploadPath=u(A.uploadPath)}if(A.sendDebounceRate){this.sendDebounced=c.debounce(this.send.bind(this),A.sendDebounceRate)}f.extend(p,A)},init:function(){var A,B=this,D=false;if(typeof arguments[0]==="string"){A={uploadPath:arguments[0],service:arguments[1],user:arguments[2]}}else{A=arguments[0]||{}}try{window.top.location.protocol}catch(C){D=true}if(D){return}p.uploadPath=u(A.uploadPath);p.service=A.service;p.authUser=A.user&&A.user.login||"";p.sessionDuration=A.sessionDuration||n;p.sendDebounceRate=A.sendDebounceRate||q;p.userActivityThrottleRate=A.userActivityThrottleRate||d;p.userInteractionThrottleRate=A.userInteractionThrottleRate||m;p.userInteractionDebounceRate=A.userInteractionDebounceRate||v;p.navigationStart=(!window.performance||(window.performance&&!window.performance.timing))?Date.now():window.performance.timing.navigationStart;window.addEventListener("beforeunload",B.send.bind(B,"beacon"));window.addEventListener("message",B.readMessage.bind(B));window.addEventListener("mousemove",c.throttle(t.bind(B),p.userActivityThrottleRate,false,true));["click","dblclick","contextmenu","touchstart","touchend"].forEach(function(E){window.addEventListener(E,c.throttle(B.setUserInteraction.bind(B),p.userInteractionThrottleRate,true),true)});["scroll","mousemove","touchmove"].forEach(function(E){window.addEventListener(E,c.debounce(B.setUserInteraction.bind(B),p.userInteractionDebounceRate),true)});B.sendDebounced=c.debounce(B.send.bind(B),p.sendDebounceRate);setTimeout(function(){t.call(B);f.extend(B.data,a());p.referrer=document.referrer;B.send();p.referrer=""},0)}};return z});define("DS/Usage/AbstractTracker",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Promise","DS/WebappsUtils/Emitter","DS/Usage/Events"],function(b,e,d,a){function c(f){this.name=f}b.inherit(c,{set:function(f,h){var g;if(typeof f==="object"){g=f;h=undefined}else{g={};g[f]=h}if(Object.keys(g).length>0){g.name=this.name;g.type=this.type;d.trigger(a.tracker.update,g)}},get:function(){var f=this;return new e(function(i){var h=a.tracker.gotContent+":"+f.name;var g=a.tracker.getContent+":"+f.name;d.on(h,function(j){d.off(h);if(j&&j.data){if(j.data.name===f.name){i(j.data)}}});d.trigger(g,{name:f.name})})}});return c});define("DS/Usage/CounterTracker",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Emitter","DS/Usage/AbstractTracker","DS/Usage/Events","DS/WebappsUtils/Promise","DS/WebappsUtils/Console"],function(c,e,d,b,f,a){function g(h){a.warn("Module DS/Usage/CounterTracker is deprecated. Use DS/Usage/TrackerAPI#trackPageEvent instead");d.call(this,h);this.type="counter"}c.inherit(g,d,{inc:function(){e.trigger(b.counter.increment,{name:this.name,type:this.type})},getCounter:function(){return this.get().then(function(h){if(typeof h.counter==="number"){return f.resolve(h.counter)}throw new Error("no counter")})}});return g});define("DS/Usage/ActionTracker",["DS/WebappsUtils/Inherit","DS/Usage/AbstractTracker","DS/WebappsUtils/Console"],function(b,d,a){function c(e){a.warn("Module DS/Usage/ActionTracker is deprecated. Use DS/Usage/TrackerAPI#trackPageEvent instead");d.call(this,e);this.type="action"}b.inherit(c,d);return c});define("DS/Usage/TimerTracker",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Promise","DS/WebappsUtils/Console","DS/WebappsUtils/Emitter","DS/WebappsUtils/Performance","DS/Usage/AbstractTracker","DS/Usage/Events"],function(c,h,a,f,d,e,b){function g(i){a.warn("Module DS/Usage/TimerTracker is deprecated. Use DS/Usage/TrackerAPI#trackPageEvent instead");e.call(this,i);this.type="timer"}c.inherit(g,e,{start:function(){f.trigger(b.timer.start,{name:this.name,type:this.type,start:d.now()})},stop:function(){f.trigger(b.timer.stop,{name:this.name,type:this.type,stop:d.now()})},getStart:function(){return this.get().then(function(i){if(typeof i.start==="number"&&i.start>=0){return i.start}else{throw new Error("timer not started")}})},getStop:function(){return this.get().then(function(i){if(typeof i.stop==="number"&&i.stop>=0){return i.stop}else{throw new Error("timer not stopped")}})},getDuration:function(){return this.get().then(function(i){if(typeof i.duration==="number"&&i.duration>=0){return i.duration}else{throw new Error("timer neither started nor stopped")}})}});return g});define("DS/Usage/TrackerAPI",["DS/WebappsUtils/Inherit","DS/WebappsUtils/Emitter","DS/Usage/CounterTracker","DS/Usage/TimerTracker","DS/Usage/ActionTracker","DS/Usage/Events"],function(c,l,i,e,n,q){var a=false,j=(function(){var r=window.location,s=window.top.location;try{s.protocol}catch(t){a=true}if(a){return{}}return{current:r.protocol+"//"+r.hostname+(r.port?":"+r.port:""),parent:s.protocol+"//"+s.hostname+(s.port?":"+s.port:"")}}()),h=window.top;function k(s,r){var t;if(typeof s==="object"){t=s}else{if(typeof s==="string"&&!r){t={name:s}}else{if(typeof s==="string"&&typeof r==="object"){t=r;t.name=s}else{throw new TypeError("Invalid Tracker paramaters")}}}return t}function b(r){return typeof r==="string"||r instanceof String}function p(r){return typeof r==="number"&&isFinite(r)}function d(r){return typeof r==="boolean"}function o(r){return r&&typeof r==="object"&&r.constructor===Object}function m(s){var r=true,t;if(!o(s)){return false}if(Object.keys(s).length==0){return false}if(Object.keys(s).length>=20){return false}for(var u in s){if(!s.hasOwnProperty(u)){continue}if(!/^(pd|pv)[0-9]+$/.test(u)){r=false}t=s[u];if(!b(t)){r=false}}return r}function g(s){var r=true,t;if(!o(s)){return false}if(Object.keys(s).length==0){return false}if(Object.keys(s).length>=20){return false}for(var u in s){if(!s.hasOwnProperty(u)){continue}if(!/^(pd|pv)[0-9]+$/.test(u)){r=false}t=s[u];if(!p(t)){r=false}}return r}var f={getCounter:function(s,r){r=k(s,r);r.type="counter";this.notify(r,q.tracker.creation);return new i(s)},getTimer:function(s,r){r=k(s,r);r.type="timer";r.start=-1;r.stop=-1;this.notify(r,q.tracker.creation);return new e(s)},getTracker:function(){var t=arguments,u=t[0],s=t[1],r=t[2],v,x;if(r===undefined&&typeof s==="object"){r=s;s=u;u="action"}else{if(r===undefined&&typeof s==="string"){r={}}else{if(s===undefined&&r===undefined){if(typeof u==="string"){s=u;u="action";r={}}else{x=c.clone(u);s=x.name;u=x.type;r=x.options||{}}}}}if(s===undefined){throw new TypeError("No tracker name specified")}switch(u){case"counter":v=this.getCounter(s,r);break;case"timer":v=this.getTimer(s,r);break;case"action":var w=r;w.name=s;this.notify(w,q.tracker.creation);v=new n(s);break;default:break}return v},trackPageView:function(v,s,x,t,r){var w=arguments[0];if(o(w)){v=w.pageURL;s=w.pageTitle;x=w.persDim;t=w.pageLanguage;r={persVal:w.persVal,appID:w.appID,tenant:w.tenant}}if(a||!v||!b(v)){return}var u={origin:j.current,topic:q.page.view,data:{url:v,timestamp:Date.now(),persDimPages:[],pagelg:(t)?t:(window.dsLang)?window.dsLang:""}};if(s&&b(s)){u.data.title=s}if(x&&m(x)){u.data.persDimPages=[x]}if(r&&o(r)&&g(r.persVal)){u.data.persValPages=[r.persVal]}if(r&&o(r)&&r.appID){u.data.appID=r.appID}if(r&&o(r)&&r.tenant){u.data.tenant=r.tenant}h.postMessage&&h.postMessage(JSON.stringify(u),j.parent)},trackPageEvent:function(r,u,t,x,y,s){var w=arguments[0];if(o(w)){r=w.eventCategory;u=w.eventAction;t=w.eventLabel;x=w.eventValue;y=w.persDim;s={persVal:w.persVal,appID:w.appID,tenant:w.tenant}}if(a||!r||!b(r)||!u||!b(u)){return}var v={origin:j.current,topic:q.page.event,data:{category:r,action:u,timestamp:Date.now(),persDimPageEvents:[]}};if(t&&b(t)){v.data.label=t}if(x&&p(x)){v.data.value=x}if(y&&m(y)){v.data.persDimPageEvents=[y]}if(s&&o(s)&&g(s.persVal)){v.data.persValPageEvents=[s.persVal]}if(s&&o(s)&&s.appID){v.data.appID=s.appID}if(s&&o(s)&&s.tenant){v.data.tenant=s.tenant}h.postMessage&&h.postMessage(JSON.stringify(v),j.parent)},registerData:function(){var r=arguments,s,t;if(a||!r.length){return}if(r.length===1&&typeof r[0]==="object"){s=r[0]}else{if(r.length>1){s={};s[r[0]]=r[1]}}if(!s){return}t={origin:j.current,topic:q.data.register,data:s};h.postMessage&&h.postMessage(JSON.stringify(t),j.parent)},notify:function(s,r){if(a){return}var t={origin:j.current,topic:r,data:s};h.postMessage&&h.postMessage(JSON.stringify(t),j.parent)},init:function(){if(a){return}var r=this;if(!this._initiated){this._initiated=true;l.on("*",function(s,t){if(!t.forAPI){r.notify(c.clone(t),s)}});window.addEventListener("message",function(s){var u={};try{u=JSON.parse(s.data)}catch(t){}if(!u.forAPI){return}s.stopPropagation();l.trigger(u.topic,u)})}}};f.init();return f});