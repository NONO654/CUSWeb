/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance",["DS/CAT3DAnnotationController/CAT3DAnnotBaseControllerInstance","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader","DS/CATWebUXSlideShow/CATWebUXSlideShowController"],function(g,c,e,d,b,a){var f=g.extend({init:function(o){var j=o||{};this._parent(j);var l=j.workbenchName||"CAT3DAnnotationWidgetWkb";var z=j.moduleName||"CAT3DAnnotationWidget";var t=j.ctxViewer;var s=this;var i;var y;var w,k;var v=this.setActiveState;this.setActiveState=function(B){v(B);if(B&&!i){var A=setInterval(function(){i=b.giveAnnotationModelLoader({context:t});if(i){clearInterval(A);s.setActiveState(B);return}},10);return}if(B&&!y){y={};w=t.isDefaultContextualBarVisible();if(w){t.setDefaultContextualBarVisibility(false)}k=t.isRobotVisible();if(k){t.setRobotVisibility(false)}y.onAddHSO=e.onAdd(s.onAddHSOCB);y.onRemoveHSO=e.onRemove(s.onRemoveHSOCB);t.getFrameWindow().getContextualUIManager().register({onContextualBarReady:function(){var D=s.getContextualCommandList();return D.length?{cmdList:D}:undefined},context:t.getCommandContext?t.getCommandContext():null,workbenchName:l,module:z,cmdPrefix:"",subscriberId:z,merge:true});var C=a.giveSlideShowController({context:t.getFrameWindow(),id:"CAT3DAnnotationSlideShow"});if(C){C.setListOfCommandsAllowed(["CAT3DAnnotationWidgetDefaultHdr"])}}else{if(!B&&y){if(w!==undefined){t.setDefaultContextualBarVisibility(w)}w=undefined;if(k!==undefined){t.setRobotVisibility(k)}k=undefined;if(y.onAddHSO){e.unsubscribe(y.onAddHSO)}if(y.onRemoveHSO){e.unsubscribe(y.onRemoveHSO)}if(t.getFrameWindow()){t.getFrameWindow().getContextualUIManager().unregister(z)}y=null}}};var u=this.clearController;this.clearController=function(){u();t=s=i=null};var n=this.onAdditionalInfosRequired;this.onAdditionalInfosRequired=function(A){if(A.controller==="AnnotFilter"){require(["DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController"],function(C){var B=C.give3DAnnotFilterController({context:t});if(B&&B.setDataModelMethod){B.setDataModelMethod(s._getJSONModel)}A.cb()})}else{n(A)}};var p=this.getAnnotControllerPrototype;this.getAnnotControllerPrototype=function(){var A=p();A.getAssociatedInformations=function(B){if(s){return s.getAssociatedInformations(B)}return undefined};return A};this.getAnnotationControllerType=function(){return"3DAnnotationExperience"};var m=this._disableAnnotUI,q=false;this._disableAnnotUI=function(){m();require(["DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController"],function(B){var A=B.give3DAnnotFilterController({context:t});if(A&&A.getActiveState()){q=A.getPanelVisibilityFlag();A.setPanelVisibilityFlag(false)}})};var h=this._enableAnnotUI;this._enableAnnotUI=function(){h();require(["DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController"],function(B){var A=B.give3DAnnotFilterController({context:t});if(A){A.setPanelVisibilityFlag(q)}})};var r=this._onCommandStartCB;this._onCommandStartCB=function(A){r(A)};var x=this.getAssociatedInformations;this.getAssociatedInformations=function(A,C){var B=C;if(!B){B=d.give3DAnnotFilterController({context:t})}return x(A,B)};this.getContextualCommandList=function(){var C=[],J;if(!t){return C}var K=[];var E=c.get();var G=t.getRootBagPath();for(J=0;J<E.length;J++){if(E[J].pathElement&&G.isAParentOf(E[J].pathElement)){K.push(E[J].pathElement)}}if(K.length===0){return C}var A=false,F=false;for(J=0;J<K.length;J++){if(!A){var H=s._getSelectedAnnotationsVisibilityFlag();if(H===true||H===false||H===undefined){var D;if(E.length===1&&((E[0].pathElement.getLastElement(true).getAnnotationClassType&&E[0].pathElement.getLastElement(true).getAnnotationClassType()==="tpsAnnotationSet")||!E[0].pathElement.getLastElement(true).getAnnotationClassType)){D=H?"CAT3DAnnotationSetHideHdr":"CAT3DAnnotationSetShowHdr"}else{D=H?"CAT3DAnnotationHideHdr":"CAT3DAnnotationShowHdr"}C.push({line:1,name:H?"CAT3DAnnotationHideStr":"CAT3DAnnotationShowStr",hdr_list:[D]});A=true}}var I=K[J].getParentPath();var B=K[J].getLastElement(true);if(((B.getAnnotationClassType&&B.getAnnotationClassType()!=="tpsAnnotationSet")||!B.getAnnotationClassType)&&K.length===1){if(!F){if(I&&I.getLastElement(true).name!=="RootBag"){C.push({line:1,name:"CAT3DAnnotationLevelSelectorStr",hdr_list:["CAT3DAnnotationLevelSelectorHdr"]});F=true}}}if(K.length===1&&I.getLastElement(true).name==="RootBag"){C.push({name:"CAT3DAnnotationRemoveRootStr",line:1,hdr_list:["RemoveRootHdr"]})}}return C};this.onAddHSOCB=function(){};this.onRemoveHSOCB=function(){}}});return f});define("DS/CAT3DAnnotationExpController/CAT3DAnnotationExpController",[],function(){});