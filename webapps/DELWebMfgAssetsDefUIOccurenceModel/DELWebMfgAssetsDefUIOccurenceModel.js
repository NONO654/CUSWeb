define("DS/DELWebMfgAssetsDefUIOccurenceModel/AbstractTreeNodeModel",["UWA/Core","UWA/Controls/Abstract","DS/Logger/Logger","DS/Tree/TreeNodeModel","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences"],function(d,S,c,w,A,K,Q,r){var F={BOTTOM_LEFT:"bottomLeft",BOTTOM_RIGHT:"bottomRight",TOP_LEFT:"topLeft",TOP_RIGHT:"topRight",};var D=function D(V){V=V||{};this._logger=c.getLogger(D);this._isPopulated=false;this._isFiltered=false;this._referencePID=null;this._instancePID=null;this._type=null;this.options={label:"",badges:this._badges,icons:[],grid:{},thumbnail:null,useAsyncPreExpand:true};this.setReferencePID(V.referencePID);this.setReferenceType(V.referenceType);this.options=d.extend(this.options,V);if(V.instancePID){this.setInstancePID(V.instancePID)}w.call(this,this.options);this.onHighlight(this._onHighlight);this.onUnhighlight(this._onUnhighlight);this.object={};this.options.grid["ds6w:type"]=this.getReferenceType();this.object.type=this.getReferenceType()};function g(V){if(!V._getFilterInfo){V._getFilterInfo=D.prototype._getFilterInfo.bind(V);V._getChildrenFilterInfo=D.prototype._getChildrenFilterInfo.bind(V);V._removeChildrenFilterInfo=D.prototype._removeChildrenFilterInfo.bind(V);V.filterInChild=D.prototype.filterInChild.bind(V);V.filterOutChild=D.prototype.filterOutChild.bind(V)}}D.prototype=Object.create(w.prototype);D.prototype.constructor=D;D.prototype.name="AbstractTreeNodeModel";D.prototype.getID=function n(){return this.getReferencePID()};D.prototype.isPopulated=function U(){return this._isPopulated};D.prototype.setPopulated=function s(V){if(!d.is(V,"boolean")){return null}this._isPopulated=V;return this.isPopulated()};D.prototype.setReferencePID=function o(V){if(!d.is(V,"string")){return null}this._referencePID=V;return this.getReferencePID()};D.prototype.setInstancePID=function x(V){if(!d.is(V,"string")){return null}this._instancePID=V;return this.getInstancePID()};D.prototype.setReferenceType=function p(V){if(!d.is(V,"string")){return null}this._type=V;return this.getReferenceType()};D.prototype.getReferencePID=function T(){return this._referencePID};D.prototype.getInstancePID=function G(){return this._instancePID};D.prototype.getReferenceType=function L(){return this._type};D.prototype.checkChildren=function y(Z,W){var X,Y,V;W=W||{};if(!d.is(Z,"function")){return false}X=this.getChildren();if(!d.is(X,"array")){return false}Y=X.length;if(0>=Y){return false}if("every"===W.type){V=X.every(Z)}else{V=X.some(Z)}return V};D.prototype.pushRelatedObject=function P(V,W){var X=this.options.grid[W];W=W||"R_Name.relation";X=X||[];X.push(V);this.setAttribute(W,X)};D.prototype.getScopes=function k(Y){var X,W,Z;Y=Y||{};X=Q.connections.where({from:this.getReferencePID(),type:"ProductImplementLink"}).map(function V(aa){return aa._attributes},this);W=Q.connections.where({to:this.getReferencePID(),type:"ProductImplementLink"}).map(function V(aa){return aa._attributes},this);if(Y.from&&Y.to){Z=X.concat(W)}else{if(Y.to){Z=W}else{Z=X}}return Z};D.prototype.getImplementLinks=function l(){var W=this.getInstancePID(),X=this.getPathToScope();return Q.connections.filter(function(ab){var aa="ProductImplementLinkOcc"===ab.get("type")||"ProcessImplementLinkOcc"===ab.get("type"),Y=ab.get("from"),Z=ab.get("to"),ac;if(d.is(Y,"array")){Y=Y[Y.length-1]}ac=W===Y||d.Json.encode(X)===d.Json.encode(Z);return aa&&ac}).map(function V(Y){return Y._attributes})};D.prototype.isScoped=function I(){return Q.connections.some(function V(X){var W="ProductImplementLink"===X.get("type"),Y=this.getReferencePID()===X.get("from")||this.getReferencePID()===X.get("to");return W&&Y},this)};D.prototype.setIsFiltered=function H(V){if(d.is(V,"boolean")){this._isFiltered=V}};D.prototype.getIsFiltered=function t(){return this._isFiltered};D.prototype.updateFilterBadge=function z(){if(this._isFiltered){this.setBadges({bottomRight:"filter"})}else{this.setBadges({bottomRight:""})}};D.prototype.isImplemented=function J(){var V=this.getInstancePID(),X=this.getPathToScope();return Q.connections.some(function W(ab){var aa="ProductImplementLinkOcc"===ab.get("type")||"ProcessImplementLinkOcc"===ab.get("type"),Y=ab.get("from"),Z=ab.get("to"),ac;if(d.is(Y,"array")){Y=Y[Y.length-1]}ac=V===Y||d.Json.encode(X)===d.Json.encode(Z);return aa&&ac})};D.prototype.hasLink=function N(){return this.isScoped()||this.isImplemented()};D.prototype.isUnderScope=function C(){var V=this.isRoot(),W;if(V){return false}W=this.getParent();if(!W){this._logger.warn("ERROR: No parent");return false}return W.isScopedOrUnderScope()};D.prototype.isScopedOrUnderScope=function j(){var W=false,V=this.isRoot(),X;if(this.isScoped()){W=true}else{if(V){W=false}else{X=this.getParent();if(X){W=X.isScopedOrUnderScope()}}}return W};D.prototype.getRootPID=function v(){var W=this.getRoot(),V=d.is(W)?W.getReferencePID():null;return V};D.prototype.getAbsolutePath=function B(){var V=this.getParents().reverse(),W=V.map(function X(Y){return Y.getInstancePID()}).concat([this.getInstancePID()]).slice(1);return W};D.prototype.getSiblingsPID=function O(){var V=this.getParent(),W,X=[];if(d.is(V)){W=V.getChildren();if(d.is(W,"array")){X=W.map(function Y(Z){return Z.getInstancePID()})}}return X};D.prototype.getUpperScopePath=function b(){var V=this.getFirstParentWithAScopeNode(),W=d.is(V)?V.getAbsolutePath():[];return W};D.prototype.getPathToScope=function a(){var W=this.getUpperScopePath();var V=[];if(d.is(W,"array")){V=this.getAbsolutePath().slice();V.splice(0,W.length)}return V};D.prototype.getFirstParentWithAScopeNode=function m(){var W,V=null,X;if(this.isRoot()){return null}W=this;do{V=W.getParent();if(V){X=d.is(V.isScoped)&&V.isScoped()}W=V}while(!X&&W);return V};D.prototype.getImplementForScope=function f(){var V;if(!this.isScoped()){this._logger.warn("No implement for scope as node is not scoped");return null}if(!this.isUnderScope()){this._logger.warn("No implement for scope as node is not under a scope");return null}V=this.getImplementLinks();if(!d.is(V,"array")){this._logger.warn("No implement for scope found");return null}if(1>V.length){this._logger.warn("No implement for scope found");return null}return V};D.prototype.getScopedNodeAbsolutePath=function u(V){var ad,ac,Y,ab,X,W,Z=this,aa=[];if(!this.isScoped()){return null}if(!this.isUnderScope()){ad=Z.getScopes()[0];ac=ad.to;if(!d.is(V.getNodeModel,"function")){return}Y=V.getNodeModel(ac,{searchReferencePID:true,});X=Y[0];ab=X.getAbsolutePath()}else{Z=this;aa=[];do{ad=Z.getScopes()[0];if(!Z.isUnderScope()){break}W=Z.getImplementForScope(ad,V);if(!d.is(W)){aa=null;break}aa=W[0].to.concat(aa);Z=Z.getFirstParentWithAScopeNode()}while(d.is(Z));ab=aa}return ab};D.prototype.getScopedNode=function M(){var Y,W,ab,X,aa,Z=null,V;if(!this.isScoped()){return null}Y=this.getTreeDocument();if(!Y){return null}ab=this.getBodyTreeListView().getDocument();W=this;if(!this.isUnderScope()){X=W.getScopes()[0];if(X){aa=X.to;if(d.is(ab.getNodeModel,"function")){Z=ab.getNodeModel(aa,{searchReferencePID:true});return Z}}}else{V=this.getScopedNodeAbsolutePath(ab);if(!d.is(V,"array")){X=W.getScopes()[0];aa=X.to;if(d.is(ab.getNodeModel,"function")){Z=ab.getNodeModel(aa,{searchReferencePID:true});return Z}}if(d.is(ab.getNodeModel,"function")){Z=ab.getNodeModel(V,{searchAbsolutePath:true,returnFirstOne:true,});return Z}}};D.prototype.getBodyTreeListView=function R(){var V=this.getTreeDocument(),W=V._context;return W.getBodyTreeListView()};D.prototype.updateBI=function e(){var W=this,X=this.getReferenceType(),V=r.PPRTypes[X],Y=function Y(){var Z=A.getIconURLFromKey("Scope"),aa={bottomLeft:Z,};if(W.isScoped()){W.setBadges(aa)}else{W.setBadges({bottomLeft:""})}};if(V==="PROCESS"){Y()}};D.prototype._getFilterInfo=function(V){if(!this.options._filterInfo&&Boolean(V)){this.options._filterInfo={}}return this.options._filterInfo};D.prototype._getChildrenFilterInfo=function(V){if(!this.options._childrenFilterInfo&&Boolean(V)){this.options._childrenFilterInfo={}}return this.options._childrenFilterInfo};D.prototype._removeFilterInfo=function(){delete this.options._filterInfo};D.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo};D.prototype.filterInChild=function(W){var ad=this._getChildrenFilterInfo(),ab,X,aa,ae,Z,V,ac;if(ad){ab=ad.childrenBeforeFiltering;if(ab){X=ab.indexOf(W);if(X>=0){aa=W._getFilterInfo();if(aa&&aa.parentBeforeFiltering===this){ae=this.getChildren();if(d.is(ae,"array")){ae.every(function Y(af){var ag=true;V=ab.indexOf(af);if(V>X){Z=af;ag=false}return ag})}delete aa.parentBeforeFiltering;if(d.is(W.options.isRootAttached)){if(W.options.isRootAttached===true){this.insertBefore(W,Z)}}else{this.insertBefore(W,Z)}if(d.is(this.setState,"function")){this.setState({state:ad.expandStateBeforeFiltering})}W._removeFilterInfo();ac=ad.filteredOutChildren.indexOf(W);ad.filteredOutChildren.splice(ac,1);if(ad.filteredOutChildren.length===0){this._removeChildrenFilterInfo()}}}}}};D.prototype.filterOutChild=function(Z){var V=this.getChildren(),Y,W,X;if(V.indexOf(Z)<0){throw"Not a child"}Y=this._getChildrenFilterInfo(true);if(!Y.childrenBeforeFiltering){Y.childrenBeforeFiltering=V&&V.length>0?V.slice(0):[];X={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"};if(d.is(this._expandState)){Y.expandStateBeforeFiltering=X[this._expandState]}}W=Z._getFilterInfo(true);W.parentBeforeFiltering=this;if(d.is(this.removeChild,"function")){this.removeChild(Z)}else{this.removeRoot(Z,true,true)}if(d.is(this.setState,"function")){this.setState({state:Y.expandStateBeforeFiltering})}if(!Y.filteredOutChildren){Y.filteredOutChildren=[]}Y.filteredOutChildren.push(Z)};D.prototype.filterOut=function(){var V=this.isRoot()?this.getTreeDocument():this.getParent();if(V!==null){g(V);V.filterOutChild(this)}};D.prototype.filterIn=function(V){var Z=this._getFilterInfo(),X,W,Y;if(Z&&Z.parentBeforeFiltering){X=Z.parentBeforeFiltering;g(X);X.filterInChild(this)}if(V){Y=this._getChildrenFilterInfo();if(Y&&Y.childrenBeforeFiltering){W=Y.childrenBeforeFiltering}else{W=this.getChildren()}if(W){W.forEach(function(aa){aa.filterIn(V)})}}};D.prototype.displayStatus=function h(Y,V,Z,X){var W=d.is(Z)?Z:"transparent",aa=d.is(X)?X:"";this.setAttribute(Y,{colorCode:W,tooltip:aa,status:V})};D.prototype.getDescendantNode=function i(ac){var ab=null,V=this,Z,W,Y,X,aa;if(Array.isArray(ac)&&(ac.length>0)){Y=V;for(Z=0;Z<ac.length;Z++){X=Y.getChildren();aa=false;for(W=0;W<X.length;W++){if(X[W].getInstancePID()===ac[Z]){Y=X[W];aa=true;break}}if(!aa){break}}if(aa){ab=Y}}return ab};D.prototype.setNodePartiallyExpandedState=function E(){this.setState({state:"partiallyExpanded"})};D.prototype.unsetNodePartiallyExpandedState=function q(){var V;if(this.getState()!=="expanding"){if(this.hasChildren()){V=(this.isExpanded())?"expanded":"collapsed"}else{V="noChildren"}this.setState({state:V})}};return D});define("DS/DELWebMfgAssetsDefUIOccurenceModel/AbstractTreeDocument",["UWA/Core","DS/Logger/Logger","UWA/Class/Options","DS/Tree/TreeDocument","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefUIServices/UXComponentUtil"],function(g,e,j,a,i,h,d,m){var k=a.extend(j,{name:"AbstractTreeDocument",_logger:null,_context:null,_treelistview:null,init:function n(o){this._parent(o);this._logger=e.getLogger(k);this._context=this.getOption("context");this._treelistview=this.getOption("treelistview");this.onPreExpand(this._onPreExpand.bind(this))},getTreeListView:function f(){return this._treelistview},areRelationsLoaded:function c(o){var p=true;if(d.isNavigateOn()==="indexOndemand"){p=!(o.some(function(s){var v,r,u,q,t;u=g.is(s.referencePID)?s.referencePID:s.getReferencePID();r=i.getReferenceFromCollection(u);if(r.isProcess()){if(!i.isRoot(r)){t=g.is(s.instancePID)?s.instancePID:s.getInstancePID();q=i.getInstanceFromCollection(t)}v=i.needToQueryForConnections(r)||i.needToQueryForConnections(q)}return v}))}return p},getNodeModel:function l(r,p){var q=null;p=p||{};if(!r){this._logger.warn("No value to search for");return null}q=this.search({match:function o(w){var t=false,s=null,v=null,u=w.nodeModel;if(true===p.searchInstancePID){s=u.getInstancePID();if(p.searchReferencePID){v=g.is(s,"string")?s:null;s=u.getReferencePID()}}else{if(true===p.searchAbsolutePath){s=u.getAbsolutePath().toString();r=r.toString()}else{if(true===p.searchPathToScope){s=u.getPathToScope().toString();r=r.toString()}else{s=u.getReferencePID()}}}if((r===s)||((g.is(v,"string")&&(v!=="")&&(r===v)))){t=true}return t},useTransaction:false});if(p.returnFirstOne){if(0<q.length){q=q[0]}else{q=null}}return q},_onPreExpand:function b(x){var A,z,t,v,s,y=this,p=this._context,w=this.alertManager,o,r=function r(C){s.preExpandDone();s.pushUpdate();if(""!==C){s.setState({state:C})}},u=function u(){var C="";if(!s.hasChildren()||!t){y._treelistview.utils.fillReferenceTreeNode(s)}if(!s.hasChildren()){C="noChildren"}r(C)},q=function q(){w.add({className:"error",message:h.getNLSValue("Error.ExpandFailed.Title")});z.set("queriedForChildren",false);r("collapsed")};if(g.is(x)&&g.is(x.data)&&g.is(x.data.nodeModel)){s=x.data.nodeModel;if(g.is(s)){v=s.getReferencePID();if(g.is(v,"string")&&(""!==v)){z=i.references.get(v);if(g.is(z)){s.prepareUpdate();o=s.getRoot().getIsFiltered();if(o){t=true;u(s)}else{t=z.get("queriedForChildren");if(t){u(s)}else{A={ordered:false,context:this,doNotExpand:true,onFailure:q,onTimeout:q,onCancel:q,timeOutExtensionPromise:function B(){return new Promise(function C(E,D){m.buildExtendTimeoutDialog(E,D,[z],{message:h.getNLSValue("TimeoutExtension.FetchItem.Title")})})}};i.getDescendantsFromServer(z.id,u,A)}}}}}}}});return k});