define("DS/IssueManagement/commands/ExportCSV",["UWA/Class","DS/ApplicationFrame/Command"],function(a,b){var c=a.extend(b,{init:function(d){var e=this;e._parent(d,{isAsynchronous:true})},execute:function(){var d=this;require(["DS/IssueManagement/export/ExportCSV"],function(e){e.exportation()["finally"](function(){d.end()})})}});return c});define("DS/IssueManagement/commands/ExportPPTX",["UWA/Class","DS/ApplicationFrame/Command"],function(a,b){var c=a.extend(b,{init:function(d){var e=this;e._parent(d,{isAsynchronous:true})},execute:function(){var d=this;require(["DS/IssueManagement/export/ExportPPTX"],function(e){e.exportation()["finally"](function(){d.end()})})}});return c});define("DS/IssueManagement/export/Print",["UWA/Class/Promise","UWA/Core","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(h,e,d,b,c,g,j,k){var a="DS/IssueManagement/export/Print";var f={PRINT_INTERVAL:200};var i={exportation:function(l){if(!e.is(l,"object")||!e.is(l.context)){throw new Error("Invalid input parameters: context is undefined")}c.start(a+" exportation");var o=this,n=l.context;var m=o._createHTMLTextTable(n);return o._print(m).then(function(){c.end(a+" exportation")})},_printWindow:undefined,_createHTMLTextTable:function(n){c.start(a+" _createHTMLTextTable");var l=n.getTreeListView().getManager().getColumns().slice();var A=n.getTreeListView().getManager().getRoots();var B=[];var G=[];for(var q=0;q<l.length;q++){var r=l[q];if(r.text&&r.isHidden!==true){B.push(r)}}for(var L=0;L<A.length;L++){var I=A[L];if(I.isVisible()&&I.isRoot()){G.push(I)}}var D=e.createElement("div",{"class":"issue-list-print"});var s=e.createElement("div",{"class":"issue-list-print-summary"});s.inject(D);var t=e.createElement("div",{"class":"issue-list-print-summary-sub-ctn issue-list-print-summary-total-ctn"});t.inject(s);var Q=e.createElement("div",{"class":"issue-list-print-summary-label issue-list-print-summary-total-label",html:j["export"].printTotalLabel});Q.inject(t);var u=e.createElement("div",{"class":"issue-list-print-summary-value issue-list-print-summary-total-value",html:G.length});u.inject(t);var x={Create:0,Assign:0,Active:0,Review:0,Closed:0};for(var K=0;K<G.length;K++){x[G[K].options.state]++}Object.keys(x).forEach(function(W){var U=g.getIconByState(W);var T=e.createElement("div",{"class":"issue-list-print-summary-sub-ctn"});T.inject(s);var S=e.createElement("div",{"class":"issue-list-print-summary-label"});S.inject(T);var V=e.createElement("span",{"class":"issue-list-print-summary-label-nls",html:k.maturity[W.toLowerCase()]});V.inject(S);var X=e.createElement("img",{"class":"issue-list-print-summary-icon",src:U});X.inject(S);var Y=e.createElement("div",{"class":"issue-list-print-summary-value",html:x[W].toString()});Y.inject(T)});var P=new Date().toLocaleString(d.get("widget").lang);var J=e.createElement("div",{"class":"issue-list-print-summary-sub-ctn issue-list-print-summary-date-ctn"});J.inject(s);var O=e.createElement("div",{"class":"issue-list-print-summary-value issue-list-print-summary-date-value",html:P});O.inject(J);var H=e.createElement("div",{"class":"issue-list-print-table"});H.inject(D);var N=e.createElement("table");N.inject(H);var M=e.createElement("tr",{"class":"table-header-row"});M.inject(N);var E=e.createElement("tr",{"class":"table-spacer-row"});E.inject(N);B.forEach(function(S){var V="";switch(S.dataIndex){case"ds6w:reportedAgainst":V="wux-ui-3ds wux-ui-3ds-location";break;case"ds6w:resolvedBy":V="fonticon fonticon-docs";break;case"ds6w:contexts":V="wux-ui-3ds wux-ui-3ds-3d-object";break;case"default":V="";break;default:V="";break}var U=e.createElement("th",{"class":"table-headercol",html:S.text});U.setStyle("max-width",S.width);if(V.length){U.innerHTML="";var T=e.createElement("span",{"class":"issue-list-cell-header-icon "+V,title:j.columns[S.dataIndex+"Column"]});T.inject(U)}U.inject(M)});for(var p=0;p<G.length;p++){var C=G[p];var o=e.createElement("tr",{"class":"table-root-row"});o.inject(N);for(var z=0;z<B.length;z++){var w=B[z];var y=e.createElement("th",{"class":"table-root-col"});var F=e.createElement("div",{});if(w.dataIndex==="tree"){var v=g.getIconByState(C.options.state);var m=e.createElement("img",{"class":"tree-icon",src:v});m.inject(F);var R=e.createElement("span",{"class":"tree-title"});R.innerHTML=C.options.title;R.inject(F)}else{F.innerHTML=C.options.grid[w.dataIndex]}F.inject(y);y.setStyle("max-width",w.width);if(["ds6w:reportedAgainst","ds6w:resolvedBy","ds6w:context"].indexOf(w.dataIndex)!==-1){y.setStyle("text-align","center")}y.inject(o)}}c.end(a+" _createHTMLTextTable");return D},_isPrintWindowOpened:function(){var l=this;return(typeof l._printWindow!=="undefined"&&null!==l._printWindow&&l._printWindow.closed===false)},_print:function(l){var m=this;c.start(a+" _print");var n=new h(function(p,o){if(m._isPrintWindowOpened()){m._printWindow.close()}m._printWindow=window.open(b.get3DDashboardUrl(),"PrintWindow","width=1024, height=768");if(typeof m._printWindow==="undefined"){p();c.end(a+" _print")}m._printWindow.addEventListener("load",function(){m._onPrintWindowLoaded(l,p,o)},false)});return n},_onPrintWindowLoaded:function(n,r,q){var p=this;p._printWindow.document.write("<html><head></head><body></body></html>");p._printWindow.document.close();var m=[];var s=function(t){return new h(function(u){t.addEventListener("load",function(){u()},false)})};for(var l in document.styleSheets){if(document.styleSheets.hasOwnProperty(l)){var o=e.createElement("link",{rel:"stylesheet",type:"text/css",media:"all",href:document.styleSheets[l].href});if(document.styleSheets[l].href!==null){m.push(s(o))}p._printWindow.document.head.appendChild(o)}}h.all(m).then(function(){p._printWindow.document.body.innerHTML=n.outerHTML;var t=p._printWindow.document.querySelectorAll("img");c.end(a+" _print");var u=setInterval(function(){var v=true;for(var w=0;w<t.length;w++){if(t[w].complete!==true){v=false}}if(v===true){clearInterval(u);r();setTimeout(function(){p._printWindow.focus();p._printWindow.print();p._printWindow.close()},0)}},f.PRINT_INTERVAL)},function(t){q(t);c.end(a+" _print")})}};return i});define("DS/IssueManagement/components/footer/Status",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Loader","DS/IssueComponents/helper/Helper","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(b,e,j,f,a,h,d,c,k){var g={ISSUE_TYPE:"Issue",TIMEOUT_LOADER:1000};var i=b.extend({name:"DS/IssueManagement/components/footer/Status",tagName:"div",className:"status-container",_logger:null,isVisible:true,_pin:null,setup:function(l){var m=this;c.start(m.name+" setup");m._parent(l);m.isVisible=true;m.loading.init();c.end(m.name+" setup")},render:function(){var l=this;c.start(l.name+" render");l.helper().inject(l.container);l.info().inject(l.container);l.loading.container.inject(l.container);c.end(l.name+" render");return l},refresh:function(){var l=this;l.destroy();l.render()},destroy:function(){var l=this;l.container.empty()},loading:{container:e.createElement("div",{"class":"status-loader"}),_loader:new a({text:"Loading...",fadeDuration:500,showButtonFlag:false}),init:function(){var l=this;l._loader.inject(l.container)},start:function(){var l=this;l._loader.height=20;l._loader.on()},update:function(l){var m=this;m._loader.text=l},stop:function(l){var m=this;m._loader.text=l;setTimeout(function(){var n=new e.Fx(m._loader.elements.container,{duration:g.TIMEOUT_LOADER,transition:"linear",events:{onStart:function(){},onComplete:function(){if(e.is(m._loader,"object")){m._loader.off()}}}});n.start({opacity:[1,0]})},0)},open:function(){}},helper:function(){var n=d.get("widget");var l=e.createElement("span",{"class":"issue-status-left-helper fonticon fonticon-help-circled"});var m=new j({className:"helper-tooltip",position:"top",target:l,body:k.tooltips.helper});l.addEventListener("click",function(){m.hide();h.show(n.body)});return l},info:function(){var l=this;var m=e.createElement("span",{"class":"issue-status-right fonticon fonticon-info"});new j({className:"im-status-tooltip",trigger:"touch",target:m,events:{onShow:function(){var o=this;c.start(l.name+" render status");var r=d.get("component");var t=r.getSelectedNodes(),q=r.getTreeDocument().getRoots(false).length,s=0;for(var p=0;p<t.length;p++){if(t[p].options.type===g.ISSUE_TYPE){s+=1}}var n=e.createElement("div",{"class":"im-status-msg"});e.createElement("div",{"class":"im-status-msg-issues",text:k.replace(k.titles.issues,{number:q})}).inject(n);e.createElement("div",{"class":"im-status-msg-selection",text:k.replace(k.tooltips.selectedIssues,{number:s})}).inject(n);o.setBody(n);c.end(l.name+" render status")}}});return m},utils:{}});return i});define("DS/IssueManagement/views/facets/Placeholder",["UWA/Class/View","UWA/Core","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(c,d,b){var a={ATTACHMENTS:"attachments",COMMENTS:"comments",HISTORY:"history"};return c.extend({name:"DS/IssueManagement/views/facets/Placeholder",tag:"div",className:"placeholder-view fade-in-element",setup:function(){},render:function(f){var g=this;g.empty();var i="",e="";switch(f){case a.ATTACHMENTS:i="attach";e=b.facets.attachments.placeholder;break;case a.COMMENTS:i="chat";e=b.facets.comments.placeholder;break;case a.HISTORY:i="navigation-history";e=b.facets.history.placeholder;break;default:break}var h=d.createElement("div",{"class":"placeholder-content",html:[d.createElement("span",{"class":"fonticon fonticon-5x fonticon-"+i}),d.createElement("span",{"class":"placeholder-label",html:e})]});g.container.setContent(h);return g},empty:function(){var e=this;e.container.empty()}})});define("DS/IssueManagement/components/header/Filter",["UWA/Class/View","UWA/Core","DS/UIKIT/DropdownMenu","DS/UIKIT/Iconbar","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(g,h,d,b,a,e,f){var c=g.extend({name:"DS/IssueManagement/components/header/Filter",tagName:"div",className:"filter-container",_logger:null,elements:{bar:null,menu:null},filter:{},setup:function(i){var j=this;e.start(j.name+" setup");j._parent(i);j.elements={bar:null,menu:null};e.end(j.name+" setup")},render:function(){var k=this;e.start(k.name+" render");var l=a.get("widget");k.elements.bar=new b({renderTo:k.container,items:[{name:"Filter",fonticon:"search-filter",text:f.filter.title,handler:function(){}}]});var j=JSON.parse(l.getValue("filter"));var i=l.getValue("roots");if(Array.isArray(i)===false){i=[]}k.elements.menu=new d({target:k.elements.bar.getItem("Filter").elements.icon,multiSelect:true,closeOnClick:false,items:[{text:f.filter.session.header,className:"header"},{name:"session",text:i.length>0?f.replace(f.filter.session.title,{number:i.length}):f.filter.session.nothing,selectable:true,selected:j.session===true,disabled:i.length===0},{className:"divider"},{name:"owned",text:f.filter.owned,selectable:true,selected:j.owned===true},{name:"assigned",text:f.filter.assigned,selectable:true,selected:j.assigned===true},{className:"divider"},{name:"others",text:f.filter.others.title,fonticon:"menu",multiSelect:true,items:[{name:"reported",text:f.filter.others.reported,selectable:true,selected:j.reported===true,disabled:j.synchronize===true},{name:"responsible",text:f.filter.others.responsible,selectable:true,selected:j.responsible===true},{name:"participated",text:f.filter.others.participated,selectable:true,selected:j.participated===true},{className:"divider"},{name:"closed",text:f.filter.others.closed,selectable:true,selected:j.closed===true}]}],events:{onClick:function(o,n){var p={};if(n.name==="others"){return}if(n.name==="session"){k.elements.menu.items.forEach(function(q){if(q.name!=="session"&&q.name!=="others"&&q.name!=="closed"){q.selected===true?k.elements.menu.toggleSelection(q):(function(){}())}})}else{if(n.name!=="closed"){var m=k.elements.menu.getItem("session");if(m.selected===true){k.elements.menu.toggleSelection(m)}}}k.elements.menu.getSelectedItems().forEach(function(q){p[q.name]=true});k.elements.menu.hide();l.setValue("filter",JSON.stringify(p));l.dispatchEvent("onRefresh");l.dispatchEvent("endEdit")}}});e.end(k.name+" render");return k},refresh:function(){var i=this;i.destroy();i.render()},destroy:function(){var i=this;i.elements.menu.hide();i.elements={bar:null,menu:null};i.container.empty()},utils:{debounce:function(j,l,i){var k;return function(){var p=this,o=arguments;var n=function(){k=null;if(!i){j.apply(p,o)}};var m=i&&!k;clearTimeout(k);k=setTimeout(n,l);if(m){j.apply(p,o)}}}}});return c});define("DS/IssueManagement/commands/SelectAllRelatedObjects",["UWA/Class","DS/ApplicationFrame/Command"],function(a,b){var c=a.extend(b,{name:"DS/IssueManagement/commands/SelectAllRelatedObjects",execute:function(){var d=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(h,f,g){var e=f.get("component").getTreeDocument();g.start(d.name+" execute");e.withBroadcastSelect(new h(function(i){e.withTransactionUpdate(function(){e.unselectAll();var j=e.getRoots(false);for(var k=0;k<j.length;k++){j[k].processDescendants({processNode:function(l){l.nodeModel.select()}})}g.end(d.name+" execute");i()})}))})}});return c});define("DS/IssueManagement/commands/Print",["UWA/Class","DS/ApplicationFrame/Command"],function(a,b){var c=a.extend(b,{init:function(d){var e=this;e._parent(d,{isAsynchronous:true})},execute:function(){var d=this;require(["DS/IssueManagement/export/Print","DS/IssueServices/Contexts"],function(f,e){f.exportation({context:e.get("component")}).then(d.end.bind(d),d.end.bind(d))})}});return c});define("DS/IssueManagement/commands/ExportZIP",["UWA/Class","DS/ApplicationFrame/Command"],function(a,c){var b=a.extend(c,{init:function(d){var e=this;e._parent(d,{isAsynchronous:true})},execute:function(){var d=this;require(["DS/IssueManagement/export/ExportZIP"],function(e){e.exportation()["finally"](function(){d.end()})})}});return b});define("DS/IssueManagement/commands/SwitchView",["UWA/Class","DS/ApplicationFrame/Command"],function(a,c){var b=a.extend(c,{name:"DS/IssueManagement/commands/SwitchView",begin:function(d){var e=this;e.execute(d)},execute:function(d){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(h,f,g){g.start(e.name+" execute");f.get("component").switchView(d);g.end(e.name+" execute")})}});return b});define("DS/IssueManagement/utils/EventsHandler",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/Contexts","DS/PlatformAPI/PlatformAPI","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(f,e,h,g,a,d){var c={INTERNAL_APPLICATIONS:["ENXISSU_AP","ENX3DIR_AP"],SUPPORTED_EVENTS:["DS/IssueManagementTask/add","DS/IssueManagementTask/ready","DS/IssueManagementTask/exec","DS/IssueManagementTask/done","DS/IssueManagementTask/cancel","DS/Object/create","DS/Object/delete","DS/Object/update","DS/Object/select"]};var b=h.extend(f,{name:"DS/IssueManagement/utils/EventsHandler",_logger:null,init:function(j){var k=this;k._parent(j);k._id=Math.random().toString(36).substr(2,9);k._subscriptions={"DS/Object/update":{"*":[],issue:{"*":[]}}};k._tokens={};var l=function(n){return function(o){if(g.is(o.metadata,"object")){if(g.is(o.metadata.options,"object")&&g.is(o.metadata.options.isuEventsHandlerId,"string")&&o.metadata.options.isuEventsHandlerId===k._id){return}if(n==="DS/Object/select"&&o.metadata.appId!==a.get("widget").id&&o.metadata.appName==="ENXISSU_AP"){return}}k.publish(k._id,n,o,true)}};k._platformAPIListeners=c.SUPPORTED_EVENTS.map(function(n){return{event:n,listener:l(n)}});for(var m=0;m<k._platformAPIListeners.length;m++){var i=k._platformAPIListeners[m];i.token=d.subscribe(i.event,i.listener)}},destroy:function(){var i=this;i._subscriptions={}},subscribe:function(n,l,o,m){var k=this;var i={id:Math.random().toString(36).substr(2,9),subscriberId:n,event:l,callback:o,conditions:g.is(m,"object")?m:null,subscriptions:[]};if(k._subscriptions[l]===undefined){k._subscriptions[l]={"*":[]}}if(g.is(m,"object")&&g.is(m.type,"string")){var j=m.type;if(k._subscriptions[l][j]===undefined){k._subscriptions[l][j]={"*":[]}}if(Array.isArray(m.attributes)&&m.attributes.length>0){m.attributes.forEach(function(p){if(k._subscriptions[l][j][p]===undefined){k._subscriptions[l][j][p]=[]}k._subscriptions[l][j][p].push(i.id);i.subscriptions.push({callback:o,event:l,type:j,attribute:p})})}else{k._subscriptions[l][j]["*"].push(i.id);i.subscriptions.push({callback:o,event:l,type:j})}}else{k._subscriptions[l]["*"].push(i.id);i.subscriptions.push({callback:o,event:l,type:"*"})}k._tokens[i.id]=i;return i.id},unsubscribe:function(m){var k=this;if(k._tokens.hasOwnProperty(m)){var i=k._tokens[m];if(i.conditions===null||i.conditions===undefined){if(k._subscriptions[i.event]["*"].indexOf(m)!==-1){var j=k._subscriptions[i.event]["*"].indexOf(m);k._subscriptions[i.event]["*"].splice(j,1)}}else{if(g.is(i.conditions.type,"string")&&g.is(k._subscriptions[i.event][i.conditions.type],"object")){if(Array.isArray(i.conditions.attributes)){i.conditions.attributes.forEach(function(n){if(k._subscriptions[i.event][i.conditions.type][n].indexOf(m)!==-1){var o=k._subscriptions[i.event][i.conditions.type][n].indexOf(m);k._subscriptions[i.event][i.conditions.type][n].splice(o,1)}})}else{if(k._subscriptions[i.event][i.conditions.type]["*"].indexOf(m)!==-1){var l=k._subscriptions[i.event][i.conditions.type]["*"].indexOf(m);k._subscriptions[i.event][i.conditions.type]["*"].splice(l,1)}}}}delete k._tokens[m]}},publish:function(o,i,r,m){var n=this;if(n._subscriptions[i]!==undefined){if(g.is(r.data,"object")&&Array.isArray(r.data.paths)&&g.is(r.data.attributes,"object")){var p={};var s=r.data.paths;s.forEach(function(u){if(g.is(r.data.attributes[u],"object")&&g.is(r.data.attributes[u].type,"string")){var t=r.data.attributes[u].type.toLowerCase();if(!Array.isArray(p[t])){p[t]=[]}p[t].push(r.data.attributes[u])}});var j=Object.keys(p);if(c.INTERNAL_APPLICATIONS.indexOf(r.metadata.appName)===-1){var q=Object.keys(n._tokens);q.forEach(function(u){var t=n._tokens[u];if(t.event===i){t.callback(g.clone(r))}})}else{var l=[];n._subscriptions[i]["*"].forEach(function(u){var t=n._tokens[u];if(l.indexOf(u)===-1&&t.subscriberId!==o){l.push(u);t.callback(g.clone(r))}});j.forEach(function(v){if(g.is(n._subscriptions[i][v],"object")){n._subscriptions[i][v]["*"].forEach(function(z){var y=n._tokens[z];if(l.indexOf(z)===-1&&y.subscriberId!==o){l.push(z);y.callback(g.clone(r))}});var x=p[v][0].modifiedAttributes;var u=Object.keys(n._subscriptions[i][v]);if(Array.isArray(x)){for(var t=0;t<u.length;t++){var w=u[t];if(x.indexOf("*")!==-1||x.indexOf(w)!==-1){n._subscriptions[i][v][w].forEach(function(z){var y=n._tokens[z];if(l.indexOf(z)===-1&&y.subscriberId!==o){l.push(z);y.callback(g.clone(r))}})}}}}})}}}if(m!==true){var k=g.clone(r);if(!g.is(k.metadata.options,"object")){k.metadata.options={}}k.metadata.options.isuEventsHandlerId=n._id;d.publish(i,k)}}});return b});define("DS/IssueManagement/commands/ColumnCustomization",["UWA/Class","DS/ApplicationFrame/Command"],function(a,b){var c=a.extend(b,{_padCustomizeView:null,init:function(d){var e=this;e._isDisplayed=false;e._parent(d)},execute:function(){var d=this;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/_PADCustomizeView","DS/IssueServices/Contexts"],function(j,l,e){var h=e.get("component"),k=h.getTreeListView();var g=k.options.columns.slice();for(var f=0;f<g.length;f++){if(g[f].dataIndex==="biColor"){g.splice(f,1)}}g.forEach(function(i){i.xnav_options={layout:{hidden:i.isHidden===true,removable:i.isRemovable!==false,styles:i.styles?i.styles:{}}}});if(d._isDisplayed!==true){j.setSetting("compactMode",true);d._padCustomizeView=new l({id:"ColumnVisibility",columns:g,render_div:".im-body",viewMode:k.preferences.getViewModePreference(),thumbnails:false,events:{modifyColumRendering:function(i){k.modifyColumnRendering(i).then(function(){k.preferences.savePreferences({columns:true})})},custoViewChange:function(){},saveAsTemplate:function(){},compactMode:function(o){var n=k.getManager();k.preferences.savePreferences({view:o.viewMode});if(o.viewMode==="comfortable"){n.options.defaultCellHeight=38}else{if(o.viewMode==="compact"){n.options.defaultCellHeight=26}else{return}}var i=h.getTreeDocument();var p=n._isPreparingView,m=n._updateCounter;n.unloadDocument();n._syncRowIndexes(true);n.loadDocument(i);n._isPreparingView=p;n._updateCounter=m;n.updateView(true)},reset:function(){k.resetColumnRendering();k.preferences.resetPreferences({columns:true})}}})}})}});return c});define("DS/IssueManagement/utils/Synchronizer",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,d,g,f,b){var a={SELECT_DEBOUNCE_TIMEOUT:1,FIRST_ELEMENT_NODE:0};var c=g.extend(e,{name:"DS/IssueManagement/utils/Synchronizer",list:null,kanban:null,_selectEventFromKanbanAcked:-1,_selectEventFromListAcked:-1,init:function(h){var i=this;i._parent(h);i.list=h.list;i.kanban=h.kanban;i._selectEventFromKanbanAcked=-1;i._selectEventFromListAcked=-1},destroy:function(){var h=this;h.list=null;h.kanban=null;h._selectEventFromKanbanAcked=-1;h._selectEventFromListAcked=-1},start:function(){var h=this;return new d(function(i){h._subscribeToList();h._subscribeToKanban();i()})},_refreshKanban:function(){var h=this;h.kanban.refresh()},_selectInKanban:function(){var u=this;if(u._selectEventFromListAcked===0){u._selectEventFromListAcked=1;return}u._selectEventFromKanbanAcked=0;b.start(u.name+" _selectInKanban");var v=u.list.document.getSelectedNodes().map(function(i){return i.getID()});var s=Object.keys(u.kanban._issuesNodesMapping);var h={};for(var r=0;r<s.length;r++){var l=s[r];if(v.indexOf(l)!==-1){for(var q=0;q<u.kanban._issuesNodesMapping[l].length;q++){var m=u.kanban._issuesNodesMapping[l][q];if(!h.hasOwnProperty(m.getTreeDocument()._id)){h[m.getTreeDocument()._id]={tree:m.getTreeDocument(),toSelect:[],toUnselect:[]}}h[m.getTreeDocument()._id].toSelect.push(m)}}else{for(var p=0;p<u.kanban._issuesNodesMapping[l].length;p++){var o=u.kanban._issuesNodesMapping[l][p];if(!h.hasOwnProperty(o.getTreeDocument()._id)){h[o.getTreeDocument()._id]={tree:o.getTreeDocument(),toSelect:[],toUnselect:[]}}h[o.getTreeDocument()._id].toUnselect.push(o)}}}var n=Object.keys(h);u.kanban.preventUnselectColumns=true;for(var x=0;x<n.length;x++){var w=h[n[x]];if(u.kanban.currentView!==w.tree._currentKanbanView||!u.kanban._preventCurrentViewSelection){if(w.toSelect.length>0||w.tree.getSelectedNodes().length>0){w.tree.withTransactionUpdate(function(){for(var j=0;j<w.toSelect.length;j++){w.toSelect[j].select()}for(var i=0;i<w.toUnselect.length;i++){w.toUnselect[i].unselect()}})}}}u.list.dispatchEvent("onSelectAcked");u.kanban.dispatchEvent("onSelectAcked");b.end(u.name+" _selectInKanban")},_selectInList:function(){var i=this;if(i._selectEventFromKanbanAcked===0){i._selectEventFromKanbanAcked=1;return}i._selectEventFromListAcked=0;var h=i.kanban.getSelectedIssues();i.list.document.prepareBroadcastSelect();i.list.document.withTransactionUpdate(function(){i.list.document.unselectAll();var k=Object.keys(i.kanban._issuesNodesMapping);for(var j=0;j<k.length;j++){var l=k[j];if(h.indexOf(l)===-1){}else{i.list.document.getNodesById(l)[a.FIRST_ELEMENT_NODE].select()}}});i.list.document.pushBroadcastSelect();i.list.dispatchEvent("onSelectAcked");i.kanban.dispatchEvent("onSelectAcked")},_subscribeToList:function(){var i=this;var j=i.utils.debounce(i._refreshKanban.bind(i),a.SELECT_DEBOUNCE_TIMEOUT);i.list.document.getModelEvents().subscribe({event:"setPathTags"},j);i.list.document.addEventListener("nodeModelUpdate",j);var h=i.utils.debounce(i._selectInKanban.bind(i),a.SELECT_DEBOUNCE_TIMEOUT);i.list.document.getModelEvents().subscribe({event:"select"},h);i.list.document.getModelEvents().subscribe({event:"unselect"},h)},_subscribeToKanban:function(){var i=this;var h=i.utils.debounce(i._selectInList.bind(i),a.SELECT_DEBOUNCE_TIMEOUT);i.listenTo(i.kanban,"onSelect",h)},utils:{_debounceTimeouts:[],debounce:function(j,l,h){var i=this;var k;return function(){var q=this,p=arguments;var n=function(){k=null;if(!h){j.apply(q,p)}};var m=h&&!k;clearTimeout(k);var o=i._debounceTimeouts.indexOf(k);if(o!==-1){i._debounceTimeouts.splice(o,1)}k=setTimeout(n,l);i._debounceTimeouts.push(k);if(m){j.apply(q,p)}}}}});return c});define("DS/IssueManagement/utils/ModelParser",["UWA/Core","DS/Logger/Logger","DS/IssueCommon/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(f,c,i,b,j,k){var h={validation:function(){var l=this;if(l.activated!==true){return j.validation.none}if(!l.status){return j.validation.loading}return j.validation[l.status]}};var g={NODE:{id:"",physicalId:"",type:"",name:"",title:"",actionTaken:"",actualEndDate:"",actualStartDate:"",validation:{activated:false,fetched:false,toString:h.validation},assignees:[],participants:[],contexts:[],created:"",description:"",estimatedEndDate:"",estimatedStartDate:"",modified:"",originator:{},owner:{},coOwners:[],priority:"",reportedAgainst:[],reportingOrganization:"",resolutionDate:"",resolutionRecommendation:"",resolutionStatement:"",resolvedBy:[],responsibleOrganization:"",revision:"",isLastRevision:"",state:"",waitingOn:"",custom:{}},MAPPING:{id:"",physicalId:"",type:"ds6w:type",name:"ds6w:name",title:"ds6w:title",actionTaken:"ds6w:actionTaken",actualEndDate:"ds6w:actualEndDate",actualStartDate:"ds6w:actualStartDate",validation:"ds6w:validation",assignees:"ds6w:assignees",participants:"ds6w:participants",contexts:"ds6w:contexts",created:"ds6w:created",description:"ds6w:description",estimatedEndDate:"ds6w:estimatedEndDate",estimatedStartDate:"ds6w:estimatedStartDate",modified:"ds6w:modified",originator:"ds6w:originator",owner:"ds6w:owner",coOwners:"ds6w:coOwners",priority:"ds6w:priority",reportedAgainst:"ds6w:reportedAgainst",reportingOrganization:"ds6w:reportingOrganization",resolutionDate:"ds6w:resolutionDate",resolutionRecommendation:"ds6w:resolutionRecommendation",resolutionStatement:"ds6w:resolutionStatement",resolvedBy:"ds6w:resolvedBy",responsibleOrganization:"ds6w:responsibleOrganization",revision:"ds6w:revision",isLastRevision:"ds6w:isLastRevision",state:"ds6w:state",waitingOn:"ds6w:waitingOn"},NO_VALIDATION:"Unassigned"};var d=function(l){var p=f.clone(g.NODE);p.grid={};p.icons=[];for(var m in g.NODE){if(g.NODE.hasOwnProperty(m)){p[m]=l[m]?l[m]:f.clone(g.NODE[m])}}p.id=l.physicalId?l.physicalId:p.id;p.physicalId=p.id;p.resourceid=p.id;var n=i.getIconByState(p.state);p.icons.push(n);for(var o in g.MAPPING){if(g.MAPPING.hasOwnProperty(o)){p.grid[g.MAPPING[o]]=p[o]}}p.label=p.display=p.title!==""?p.title:p.name;p.grid[g.MAPPING.assignees]=p.assignees.reduce(function(s,r){return s+r.fullName+", "},"");if(p.grid[g.MAPPING.assignees].length>0){p.grid[g.MAPPING.assignees]=p.grid[g.MAPPING.assignees].trim();p.grid[g.MAPPING.assignees]=p.grid[g.MAPPING.assignees].substring(0,p.grid[g.MAPPING.assignees].length-1)}p.grid[g.MAPPING.participants]=p.participants.reduce(function(s,r){return s+r.fullName+", "},"");if(p.grid[g.MAPPING.participants].length>0){p.grid[g.MAPPING.participants]=p.grid[g.MAPPING.participants].trim();p.grid[g.MAPPING.participants]=p.grid[g.MAPPING.participants].substring(0,p.grid[g.MAPPING.participants].length-1)}p.grid[g.MAPPING.coOwners]=p.coOwners.reduce(function(s,r){return s+r.fullName+", "},"");if(p.grid[g.MAPPING.coOwners].length>0){p.grid[g.MAPPING.coOwners]=p.grid[g.MAPPING.coOwners].trim();p.grid[g.MAPPING.coOwners]=p.grid[g.MAPPING.coOwners].substring(0,p.grid[g.MAPPING.coOwners].length-1)}p.grid[g.MAPPING.contexts]=String(p.contexts.length);p.grid[g.MAPPING.originator]=p.originator.fullName?p.originator.fullName:"";p.grid[g.MAPPING.owner]=p.owner.fullName?p.owner.fullName:"";p.grid[g.MAPPING.priority]=k.priorities[p.priority.toLowerCase()];p.grid[g.MAPPING.reportedAgainst]=String(p.reportedAgainst.length);p.grid[g.MAPPING.resolvedBy]=String(p.resolvedBy.length);p.grid[g.MAPPING.state]=k.maturity[p.state.toLowerCase()];if(p.waitingOn!==g.NO_VALIDATION){p.validation.activated=true}for(var q in p.custom){if(p.custom.hasOwnProperty(q)){p.grid[q]=p.custom[q]}}return p};var a=function(o,n){var r=f.clone(g.NODE);r.grid={};r.icons=[];var m=o.attributes;for(var p=0;p<m.length;p++){var q=m[p];switch(q.name){case"resourceid":r.id=q.value;break;case"ds6w:identifier":r.name=q.value;break;case"ds6w:label":r.title=q.value;break;case"ds6w:status":r.state=q.value;r.grid["ds6w:state"]=q.dispValue;break;case"ds6w:type":r.type=q.value;r.grid["ds6w:type"]=q.dispValue;break;case"ds6w:responsible":r.owner.fullName=q.value;break;case"owner":r.owner.user=q.value;break;case"type_icon_url":r.icons.push(q.value);break;case"ds6w:modified":r.modified=q.value;break;case"ds6w:created":r.created=q.value;break;case"ds6wg:revision":r.revision=q.value;break;case"ds6wg:PLMReference.V_isLastVersion":var s=q.value;if(s&&s!==""){r.isLastRevision=s.toLowerCase()==="true"}break;case"lastrevision":var l=q.value;if(r.isLastRevision===""&&l&&l!==""){r.isLastRevision=l.toLowerCase()==="true"}break;default:if(n.indexOf(q.name)!==-1){r.grid[q.name]=q.value}break}}r.resourceid=r.id;r.physicalId=r.id;r.label=r.display=r.title!==""?r.title:r.name;r.grid["ds6w:owner"]=r.owner;r.grid["ds6w:modified"]=r.modified;r.grid["ds6w:created"]=r.created;r.grid["ds6w:revision"]=r.revision;r.grid["ds6w:isLastRevision"]=r.isLastRevision;r.grid["ds6w:originator"]=r.owner;r.originator=r.owner;return r};var e={name:"DS/IssueManagement/utils/ModelParser",parse:function(q,n){var p=this,l=[];b.start(p.name+" parse");n=n?n:{};if(!Array.isArray(n.predicates)){n.predicates=[]}if(Array.isArray(q)){if(n.useIndex===true){for(var o=0;o<q.length;o++){l.push(a(q[o],n.predicates))}}else{for(var m=0;m<q.length;m++){l.push(d(q[m]))}}}else{if(n.useIndex===true){l=a(q,n.predicates)}else{l=d(q)}}b.end(p.name+" parse");return l},update:function(m,l){m.context=l.context}};return e});define("DS/IssueManagement/components/ContextualMenu",["UWA/Class/Promise","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(i,a,e,d,c,f,k){var h={ISSUE_TYPE:"Issue",LIST_VIEW:"ListView",LABEL:{REPORTED_AGAINST:"reportedAgainst",RESOLVED_BY:"resolvedBy",CONTEXTS:"contexts",OPEN_WITH:"Open with",OPEN:"Open"},ICON:{REPORTED_AGAINST:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-location",RESOLVED_BY:"wux-ui-3ds wux-ui-3ds-1x fonticon-docs",CONTEXTS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",OPEN_WITH:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export"},TIMEOUT_SUSPEND_KEYBOARD:100};var b="DS/IssueManagement/components/ContextualMenu";var j=function(){var n=d.get("component").getTreeListView().getManager().getKeymapManager();n.wait();setTimeout(function(){n.listen()},h.TIMEOUT_SUSPEND_KEYBOARD);var l=d.get("component").getKanbanView(),m=l.columns[l.currentView];m.forEach(function(p){var o=p.grid._keymapManager;o.wait();setTimeout(function(){o.listen()},h.TIMEOUT_SUSPEND_KEYBOARD)})};var g={getContextualMenuHeader:function(n){var l=[],m=d.get("component").getTreeListView().getManager();l.push({title:k.commands.sizeColumnToFit,type:"PushItem",icon:"url("+e.getWebappsAssetUrl("IssueManagement","icons/32/iconSizeColumnToFit.png")+")",action:{callback:function(){j();m.sizeColumnToFit(n)}}});var o=m.getColumnIDFromDataIndex(n);if(m.getColumnOrderState(o)!=="none"){l.push({title:k.commands.clearSortOrder,type:"PushItem",icon:"url("+e.getWebappsAssetUrl("IssueManagement","icons/32/iconClearSortOrder.png")+")",action:{callback:function(){j();m.setColumnOrderState(o,"none");d.get("component").getTreeListView().preferences.resetPreferences({sort:true})}}})}return i.resolve(l)},getContextualMenu:function(){var l=this;var n=d.get("component").getTreeDocument().getSelectedNodes();if(n.length===0){return i.resolve([])}var m=n.reduce(function(s,q){var o=[],p=[],r=[];q.options.reportedAgainst.forEach(function(t){o.push({physicalId:t.physicalId,type:t.type,name:t.name,title:t.title?t.title:t.name})});q.options.resolvedBy.forEach(function(t){p.push({physicalId:t.physicalId,type:t.type,name:t.name,title:t.title?t.title:t.name})});q.options.contexts.forEach(function(t){r.push({physicalId:t.physicalId,type:t.type,name:t.name,title:t.title?t.title:t.name})});s.push({physicalId:q.options.id,type:q.options.type,name:q.options.name,title:q.options.title,reportedAgainst:o,resolvedBy:p,contexts:r});return s},[]);return l._getMenu({objects:m,isList:d.get("component").getCurrentView()===h.LIST_VIEW})},_getMenu:function(m){var n=this;var l=[],o=Array.isArray(m.objects)?m.objects:[];if(o.length===0){return i.resolve([])}c.start(b+" _getMenu");return n._getOpenWithMenu(m).then(function(p){l=l.concat(p)}).then(function(){return n._getBasicMenu(m)}).then(function(p){l=l.concat(p);c.end(b+" _getMenu");return l})},_getBasicMenu:function(m){var n=this;c.start(b+" _getBasicMenu");var l=[],o=Array.isArray(m.objects)?m.objects:[];if(o.length===0){return l}if(m.allObjectsAreIssues===true){if(o.length===1){l.push({name:"Attachments",title:k.commands.attachments,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-attach"},data:null,action:{callback:function(){j();a.getCommand("AttachmentManager").begin()}}});l.push({type:"SeparatorItem"})}l.push({name:"Duplicate",title:k.commands.duplicate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-duplicate"},data:null,action:{callback:function(){j();a.getCommand("Duplicate").begin()}}});l.push({name:"Close",title:k.commands.close,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-close"},data:null,action:{callback:function(){j();a.getCommand("Close").begin()}}});l.push({name:"Delete",title:k.commands["delete"],type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},data:null,action:{callback:function(){j();a.getCommand("Delete").begin()}}});if(m.isList===true){l.push({type:"SeparatorItem"});l.push({name:"More",title:k.commands.more,type:"PushItem",data:null,submenu:n._getListMenu()})}else{l.push({type:"SeparatorItem"});l.push({name:"More",title:k.commands.more,type:"PushItem",data:null,submenu:n.getKanbanMenu()})}}else{if(m.allObjectsAreNotIssues===true){if(o.length===1){l.push({name:"History",title:k.commands.history,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compass"},data:null,action:{callback:function(){j();a.getCommand("History").begin()}}})}l.push({name:"WhereUsed",title:k.commands.whereUsed,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-path-related"},data:null,action:{callback:function(){j();a.getCommand("WhereUsed").begin()}}});if(o.length<=2){l.push({name:"Compare",title:k.commands.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:null,action:{callback:function(){j();a.getCommand("Compare").begin()}}});l.push({type:"SeparatorItem"})}l.push({name:"Detach",title:k.commands.detach,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-branch-delete"},data:null,action:{callback:function(){j();a.getCommand("Detach").begin()}}})}else{if(m.isList===true){l.push({name:"More",title:k.commands.more,type:"PushItem",data:null,submenu:n._getListMenu()})}else{l.push({type:"SeparatorItem"});l.push({name:"More",title:k.commands.more,type:"PushItem",data:null,submenu:n.getKanbanMenu()})}}}c.end(b+" _getBasicMenu");return l},_getOpenWithMenu:function(n){var p=this;var m=[],q=Array.isArray(n.objects)?n.objects:[];if(q.length===0){return i.resolve([])}n.allObjectsAreIssues=q.every(function(t){return t.type===h.ISSUE_TYPE});n.allObjectsAreNotIssues=q.every(function(t){return t.type!==h.ISSUE_TYPE});if(n.allObjectsAreIssues===true){var l=[],r=[],s=[];n.objects.forEach(function(t){l=l.concat(t.contexts);r=r.concat(t.reportedAgainst);s=s.concat(t.resolvedBy)});var o=[];return i.all([p._getOpenWithSubMenu({name:h.LABEL.CONTEXTS,label:k.commands.open.contexts,objects:l,icon:h.ICON.CONTEXTS}),p._getOpenWithSubMenu({name:h.LABEL.REPORTED_AGAINST,label:k.commands.open.reportedAgainst,objects:r,icon:h.ICON.REPORTED_AGAINST}),p._getOpenWithSubMenu({name:h.LABEL.RESOLVED_BY,label:k.commands.open.resolvedBy,objects:s,icon:h.ICON.RESOLVED_BY})]).then(function(t){o=t.reduce(function(v,u){return v.concat(u)},[]);if(o.length>0){m.push({name:h.LABEL.OPEN,title:k.commands.open.multiple,type:"PushItem",data:null,fonticon:{content:h.ICON.OPEN_WITH},submenu:o})}return m})}else{if(n.allObjectsAreNotIssues===true){return p._getOpenWithSubMenu({name:h.LABEL.OPEN_WITH,label:k.commands.open.single,objects:n.objects,icon:h.ICON.OPEN_WITH})}else{return i.resolve([])}}},_getListMenu:function(){var p=[];p.push({name:"Share",title:k.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-share-alt"},data:null,action:{callback:function(){a.getCommand("Share").begin()}}});p.push({type:"SeparatorItem"});var l=d.get("component").getTreeDocument();var m=l.getIssuesFromSelectedNodes();var o=m.every(function(r){if(Array.isArray(r.getChildren())){return r.isExpanded()===true}else{return true}});var n=m.every(function(r){if(Array.isArray(r.getChildren())){return r.isExpanded()===false}else{return true}});var q=m.every(function(r){return !Array.isArray(r.getChildren())});if(q===false&&(n===true||(o===false&&n===false))){p.push({name:"Expand",title:k.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){j();var r=d.get("component").getTreeDocument();r.withTransactionUpdate(function(){var s=r.getSelectedNodes();for(var t=0;t<s.length;t++){s[t].expand()}})}}})}if(q===false&&(o===true||(o===false&&n===false))){p.push({name:"Collapse",title:k.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){j();var r=d.get("component").getTreeDocument();r.withTransactionUpdate(function(){var s=r.getSelectedNodes();for(var t=0;t<s.length;t++){s[t].collapse()}})}}})}if(p[p.length-1].type==="SeparatorItem"){p.pop()}return p},getKanbanMenu:function(){var l=[];l.push({name:"Share",title:k.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-share-alt"},data:null,action:{callback:function(){a.getCommand("Share").begin()}}});return l},_getOpenWithSubMenu:function(n){if(!n||!Array.isArray(n.objects)||n.objects.length===0){return i.resolve([])}var m=[],l=[],o=n.objects;c.start(b+" _getOpenWithSubMenu");return new i(function(s){for(var p=0;p<o.length;p++){var t=o[p];l.push({serviceId:"3DSpace",objectId:t.physicalId,objectType:t.type,displayName:t.title?t.title:t.name})}if(l.length===0){c.end(b+" _getOpenWithSubMenu");s(m);return}var r=d.get("widget");var q=f.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:r.name,widgetId:r.id,data:{items:l}},true);q.retrieveCompatibleApps(function(v){if(v&&v.length>0){var u=[];v.forEach(function(x){u.push({name:x.text.replace(/ /g,""),type:"PushItem",title:x.text,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+x.fonticon},action:{callback:function(z){j();var y=o.reduce(function(B,A){B.push(A.physicalId);return B},[]);d.get("component").utils.setTypesCallbackForOFW(y);x.handler.call(z)}}})});if(u.length>0){var w={name:n.name,type:"PushItem",fonticon:{content:n.icon},title:n.label,submenu:u};m.push(w)}}c.end(b+" _getOpenWithSubMenu");s(m)})})}};return g});define("DS/IssueManagement/export/Utils",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Input/Button","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(j,g,i,h,c,b,e,d,a,k){var f={confirmation:function(l){var m=d.get("widget");return new j(function(p){var o=g.createElement("div",{"class":"confirmation-export-issues-content",html:l.content});var n=new h({animate:true,autocenter:true,closable:true,limitParent:false,overlay:true,resizable:true,visible:true,className:"confirmation-export-issues-dialog",title:l.title,header:null,body:o,footer:[new i({value:k["export"].confirmation.confirm,className:"primary confirmation-export-issues-dialog-confirm",events:{onClick:function(){n.destroy();p(true)}}}),new i({value:k["export"].confirmation.cancel,className:"default confirmation-export-issues-dialog-cancel",events:{onClick:function(){n.destroy();p(false)}}})],events:{onClose:function(){n.destroy();p(false)}}}).inject(m.body);n.show()})},getIssuesToExport:function(){var m=d.get("component");var l=m.getSelectedNodes();if(l.length===0){l=m.getTreeDocument().getRoots(false)}return l},notifications:{exporting:function(){b.displayNotification({msg:k["export"].exporting,eventID:"info"})},nothing:function(){b.displayNotification({msg:k["export"].nothingToExport,eventID:"error"})},failure:function(l){b.displayNotification({msg:g.is(l,"string")?l:k["export"].failure,eventID:"error"})}},download:{csv:function(o,p){var n=document.createElement("a");var m="\uFEFF";var l=n.href=URL.createObjectURL(new Blob([m+o],{encoding:"UTF-8",type:"text/csv;charset=UTF-8"}));n.setAttribute("download",p);document.body.appendChild(n);n.click();setTimeout(function(){document.body.removeChild(n);URL.revokeObjectURL(l)},0)}}};return f});define("DS/IssueManagement/utils/DragAndDrop",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/Catalog","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(i,g,o,r,z,u,p,w,t,e,x,c,n,v,f,k,m,d,a,h,b,s){var q={ISSUE_TYPE:"Issue"};var y="DS/IssueManagement/utils/DragAndDrop";var l=w.getLogger(y);var j={setDroppableData:function(A,J){var F=k.get("widget");var B={protocol:"3DXContent",version:"1.1",source:F.name,widgetId:F.id,data:{items:[],issues:[]}};if(J!==null&&J!==undefined){B.data.options=J}for(var D=0;D<A.length;D++){var C=A[D];if(C.options.type===q.ISSUE_TYPE){B.data.issues.push({id:C.options.id,type:C.options.type,name:C.options.name,title:C.options.title});var I=C.options.reportedAgainst;for(var E=0;E<I.length;E++){B.data.items.push({envId:m.getTenant(),serviceId:"3DSpace",contextId:"",objectId:I[E].physicalId,objectType:I[E].type,displayName:I[E].name,displayType:I[E].type,isIssue:true})}}else{B.data.items.push({envId:m.getTenant(),serviceId:"3DSpace",contextId:"",objectId:C.options.physicalId,objectType:C.options.type,displayName:C.options.display,displayType:C.options.type})}}var H="text/plain";try{if(window.navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){H="text"}}catch(G){}return{type:H,data:JSON.stringify(B),hasReportedAgainst:(B.data.items.length!==0)}},getDroppableData:function(A){var C=null;var I=i.is(A.dataTransfer.types.indexOf,"function")?"indexOf":"contains",F="";var D=["text/searchitems","text/plain","Text","Files"];for(var H=0;H<D.length&&F==="";H++){var G=A.dataTransfer.types[I](D[H]);if((i.is(G,"number")&&G>=0)||(i.is(G,"boolean")&&G===true)){F=D[H]}}var B={};if(F==="Files"){C={files:A.dataTransfer.files}}else{if(F!==""){B=A.dataTransfer.getData(F);try{C=JSON.parse(B)}catch(E){}}}return C},related:{whereToAddRelatedObjects:function(L,I,C){var G=this;var F=k.get("widget");var J=null;J=new r({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",events:{onChange:function(){}}});var K=new r({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:true,events:{onChange:function(){}}});var N=new r({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",events:{onChange:function(){}}});var M=new r({className:"primary attachments-chooser",name:"typeChooser",value:"attachments",label:"",events:{onChange:function(){}}});J.elements.label.setContent([i.createElement("i",{"class":"where-to-drop-icon where-to-drop-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),h.columns.contextsColumn]);K.elements.label.setContent([i.createElement("i",{"class":"where-to-drop-icon where-to-drop-reported-against wux-ui-3ds wux-ui-3ds-location"}),h.columns.reportedAgainstColumn]);N.elements.label.setContent([i.createElement("i",{"class":"where-to-drop-icon where-to-drop-contexts-resolved-by fonticon fonticon-docs"}),h.columns.resolvedByColumn]);M.elements.label.setContent([i.createElement("i",{"class":"where-to-drop-icon where-to-drop-contexts-attachments fonticon fonticon-attach"}),h.columns.attachmentsColumn]);var E=i.createElement("div",{"class":"where-to-drop-main-label",html:h.dnd.whereToDrop});I=j.getDroppableData(C).data.items;var D=I.every(function(O){return !(O.isIssue===true||O.objectType===q.ISSUE_TYPE)});var B=I.map(function(O){return O.objectId});B=B.sort().filter(function(P,Q,O){return !Q||P!==O[Q-1]});var A=[E];if(D===true){A.push(J);A.push(K);A.push(N);A.push(M)}else{t.displayNotification({msg:h.dnd.partiallyNotSupported,eventID:"error"});return g.resolve(null)}var H=i.createElement("div",{html:A});return new g(function(Q,P){var O=new p({animate:true,autocenter:true,closable:true,limitParent:false,overlay:true,resizable:true,visible:true,className:"drop-objects-issue-dialog",title:h.replace(h.dnd.dialogTitle,{number:B.length,issue:L.title+" ("+L.name+")"}),header:null,body:H,footer:[new o({value:h.dnd.attach,className:"primary drop-objects-issue-dialog-add",events:{onClick:function(){O.destroy();Q({ids:B,type:K.isChecked()===true?K.getValue():N.isChecked()===true?N.getValue():M.isChecked()===true?M.getValue():J.getValue()})}}}),new o({value:h.dnd.cancel,className:"default drop-objects-issue-dialog-cancel",events:{onClick:function(){O.destroy();G.utils.whereToAddModal=null;P(new Error("The dialog has been closed by the end user"))}}})],events:{onShow:function(){G.utils.whereToAddModal=O},onClose:function(){O.destroy();G.utils.whereToAddModal=null;P(new Error("The dialog has been closed by the end user"))}}}).inject(F.body);new u({element:H}).inject(O.getBody());O.show()})},addRelatedObjects:function(A,B,E){var D=this;var F=k.get("widget");var C=k.get("component");j.related.whereToAddRelatedObjects.call(D,A,B,E).then(function(K){if(K===null){return g.resolve(null)}var J=K.type,I=K.ids,G={};z.mask(F.body);G[A.id]={physicalId:A.id};if(J==="attachments"){var M=A.id;var L=I;return n.connectDocumentsToParent(I,A.id).then(function(N){if(L.length===1&&N.length===1&&N[N.length-1].response.success){return n.fetch(L).then(function(O){if(i.is(O.results,"array")){var P=O.results.map(function(R){return n.parseFromFetch(R)});if(P.length===1&&P[P.length-1].documentType==="image"){var Q=P[P.length-1];return n.setAsPrimary(Q.id,M).then(function(R){var S=JSON.parse(R);if(Q.id===S.documentId){t.displayNotification({msg:b.notifications.SetAsPrimary.success,eventID:"info"})}})["catch"](function(R){t.displayNotification({msg:b.notifications.SetAsPrimary.failure,eventID:"error"});D._logger.error(R)})}return g.resolve()}else{throw new Error("Unexpected empty fetch results for setAsPrimary.")}})["catch"](function(){D._logger.error(new Error("Unexpected fetch error for setAsPrimary."))})}return g.resolve()}).then(function(){var N={paths:[[M]],attributes:{}};N.attributes[M]={id:A.id,name:A.name,title:A.title,type:A.type,modifiedAttributes:["attachments"]};C.publishUpdate(N);C.document.refreshNodesById({modified:[A.id]})}).then(function(){z.unmask(F.body);t.displayNotification({msg:h.notifications.attachSuccess,eventID:"success"})})["catch"](function(N){l.error("Could not add attachment(s): %s",N);z.unmask(F.body);t.displayNotification({msg:h.notifications.serverError,eventID:"error"})})}else{var H=[];if(!Array.isArray(A.node.options[K.type])){if(A.node.options[K.type]&&"physicalId" in A.node.options[K.type]){H.push(A.node.options[K.type])}}else{H=H.concat(A.node.options[K.type])}H.forEach(function(O){var N=I.indexOf(O.physicalId);if(N>-1){I.splice(N,1);t.displayNotification({msg:h.dnd.alreadyAttached,eventID:"info"})}});if(I.length===0){z.unmask(F.body);return false}switch(J){case"contexts":G[A.id].contexts=I.map(function(N){return{physicalId:N}});break;case"reportedAgainst":G[A.id].reportedAgainst=I.sort().filter(function(O,P,N){return !P||O!==N[P-1]}).map(function(N){return{physicalId:N}});break;case"resolvedBy":G[A.id].resolvedBy=I.sort().filter(function(O,P,N){return !P||O!==N[P-1]}).map(function(N){return{physicalId:N}});break;default:break}return D.document.addContextsOrReportedAgainstOrResolvedBy(G).then(function(){z.unmask(F.body);t.displayNotification({msg:h.notifications.attachSuccess,eventID:"success"})},function(N){l.error("Could not add related object(s): %s",N);z.unmask(F.body);t.displayNotification({msg:h.notifications.serverError,eventID:"error"})})}})},uploadFilesAsAttachments:function(E,P){var H=this;var F=k.get("widget");var J=k.get("component");var W=function(X){this.set("isCancelable",true);this.set("request",X)};var I=function(Y){if(Y.lengthComputable){var X=Y.loaded/Y.total;this.set("requestProgress",X)}};var N=function(){this.set("isCancelable",false);this.set("request",null)};var R=E.id;var L=new x({id:R});var B=[];var S=[];for(var O=0;O<P.length;O++){var V=P[O];var K="temporary_"+Math.floor(Date.now())+"_"+O;var C=V.type;var D={id:K,title:V.name,type:"Document",owner:{firstName:e.getUser().firstName,fullName:e.getUser().firstName.trim()+" "+e.getUser().lastName.trim(),lastName:e.getUser().lastName,user:e.getUser().login},relOwner:{firstName:e.getUser().firstName,fullName:e.getUser().firstName.trim()+" "+e.getUser().lastName.trim(),lastName:e.getUser().lastName,user:e.getUser().login},relOriginated:(new Date()).toString()};if(V.hasOwnProperty("lastModifiedDate")){if(V.lastModifiedDate instanceof Date){D.modified=V.lastModifiedDate.toString();D.created=V.lastModifiedDate.toString()}else{D.modified=(new Date(V.lastModifiedDate)).toString();D.created=(new Date(V.lastModifiedDate)).toString()}}else{D.modified=(new Date()).toString();D.created=(new Date()).toString()}var U=new c(D);U.set("isProcessing",true);U.setDocumentTypeByMIME(C);B.push(U);var A=function(Y){var X=this;return{file:{tempId:X.tempId,type:X.type},response:Y}};var T=n.uploadFile(V,L.id,{onCheckinStart:W.bind(U),onCheckinProgress:I.bind(U),onCheckinComplete:N.bind(U)});S.push(T.then(A.bind({tempId:K,type:C}))["catch"](A.bind({tempId:K,type:C})))}L.add(B,{sort:false});var G=new v({collection:L,layout:2}).render();var Q=new p({animate:true,autocenter:true,closable:true,limitParent:false,overlay:false,resizable:true,visible:true,className:"drop-files-issue-upload-dialog",title:s.replace(s.create.attachments.uploadDialog.title,{number:P.length}),header:null,body:G,events:{onClose:function(){Q.destroy()}}}).inject(F.body);var M=g.all(S).then(function(Y){var aa=[];var ae=0;for(var Z=0;Z<Y.length;Z++){var ag=Y[Z].file.tempId;var ai=Y[Z].file.type;var X=Y[Z].response;if(X.success){ae+=1;L.remove(ag);var ab=X.data[0];var ah=n.parseDocument(ab);ah.relOwner={firstName:e.getUser().firstName,fullName:e.getUser().firstName.trim()+" "+e.getUser().lastName.trim(),lastName:e.getUser().lastName,user:e.getUser().login};ah.relOriginated=(new Date()).toString();var af=new c(ah);af.set("iconUrl",af.get("thumbnailUrl"));af.setDocumentTypeByMIME(ai);L.add(af);aa.push(af.id)}else{L.get(ag).set("isFailed",true);L.get(ag).set("isProcessing",false);L.get(ag).set("isCancelable",false);L.get(ag).set("request",null);if(X instanceof Error){l.error(X)}}}var ad=g.resolve();if(ae>0){if(L.size()===1&&L.at(0).get("documentType")==="image"){var ac=L.at(0);ad=n.setAsPrimary(ac.id,R).then(function(aj){var ak=JSON.parse(aj);if(ac.id===ak.documentId){t.displayNotification({msg:b.notifications.SetAsPrimary.success,eventID:"info"})}})["catch"](function(aj){t.displayNotification({msg:b.notifications.SetAsPrimary.failure,eventID:"error"});H._logger.error(aj)})}t.displayNotification({msg:h.replace(b.notifications.Upload.success,{count:ae}),eventID:"info"})}if(ae!==Y.length){t.displayNotification({msg:h.replace(b.notifications.Upload.failure,{count:Y.length-ae}),eventID:"error"})}Q.setTitle(s.replace(s.create.attachments.uploadDialog.uploadCompleted,{success:ae,total:Y.length}));return ad}).then(function(){var X={paths:[[E.id]],attributes:{}};X.attributes[E.id]={id:E.id,name:E.name,title:E.title,type:E.type,modifiedAttributes:["attachments"]};J.publishUpdate(X);J.document.refreshNodesById({modified:[E.id]})})["catch"](function(X){l.error(X)});return{collection:L,promise:M}}},events:{onDropCell:function(A,D){A.preventDefault();var G=this;var E=null;if(D.nodeModel.options.type!==q.ISSUE_TYPE){E=D.nodeModel.getParent()}else{E=D.nodeModel}var C=E.options.id;var H=E.options.type;var B=E.options.name;var I=E.options.title;var F=j.getDroppableData(A);if(F.hasOwnProperty("files")&&(F.files instanceof FileList)){j.related.uploadFilesAsAttachments.call(G,{node:E,id:C,type:H,name:B,title:I},F.files)}else{if(f.isValid3DXContent(F)&&F.data.items.length){j.related.addRelatedObjects.call(G,{node:E,id:C,type:H,name:B,title:I},F.data.items,A)}else{t.displayNotification({msg:h.dnd.notSupported,eventID:"info"});return false}}return true}}};return j});define("DS/IssueManagement/commands/InlineCreate",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader"],function(b,d){var a={TIMEOUT_TOOLTIP:200,INPUT_WIDTH:300,ANIMATION_TIME:100};var c=b.extend(d,{view:null,activated:false,mini:null,init:function(f){var h=this;h._parent(f,{});var g=false;var i=h.onStateChange(function(){if(g===true){g=false;return}if(h.activated===h.getState()){return}h.activated=h.getState();if(h.activated===true){h.execute()}else{h.hide()}});var e=h._destroy;h._destroy=function(){h._modelEvents.unsubscribe(i);e.call(h)};g=true;h.setState(false,true)},execute:function(){var e=this;require(["UWA/Core","DS/IssueCommon/utils/Utils","DS/IssueManagement/components/header/InlineCreate","DS/IssueServices/Contexts"],function(i,k,j,h){var m=h.get("actionBar");e.mini=null;var l=new j(),f=h.get("actionBar").getIconBar().getItem("InlineCreate");f.tooltip.getContent().hide();e.view=l;var g=f.elements.container,n=f.elements.icon;if((g.getBoundingClientRect().left-m.container.getBoundingClientRect().left)<a.INPUT_WIDTH){e.mini=i.createElement("div",{"class":"mini-inline-create",html:[{tag:"div","class":"mini-inline-create-placeholder"},l.render()]});e.mini.inject(h.get("actionBar").container.parentElement);setTimeout(function(){l.focus()},a.ANIMATION_TIME)}else{g.addEventListener("transitionend",function(){setTimeout(function(){l.focus()},a.ANIMATION_TIME)},{once:true});g.setStyles({transition:"width 0.2s",width:a.INPUT_WIDTH});n.setStyle("float","left");l.render().inject(g)}})},hide:function(){var e=this;require(["DS/IssueServices/Contexts"],function(f){e.view.destroy();e.view=null;if(e.mini!==null){e.mini.destroy();e.mini=null}var h=f.get("actionBar").getIconBar().getItem("InlineCreate");setTimeout(function(){h.tooltip.getContent().show();h.tooltip.hide()},a.TIMEOUT_TOOLTIP);var g=h.elements.container,i=h.elements.icon;g.setStyle("width","38px");i.setStyle("float","initial")})}});return c});define("DS/IssueManagement/views/facets/Team",["UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/IssueComponents/team/Team","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(f,g,c,b,a,e,d){return f.extend({name:"DS/IssueManagement/views/facets/Team",tag:"div",className:"team-view fade-in-element",defaultOptions:{physicalIds:[]},team:null,_subscriberId:"",_eventListeners:[],setup:function(i){var j=this;d.start(j.name+" setup");j._parent(i);j.team=new b({physicalIds:j.getOption("physicalIds")});j._subscriberId=Math.random().toString(36).substr(2,9);j.listenTo(j.team,"onReady",function(l){j.dispatchEvent("onReady",l)});j.listenTo(j.team,"onFailure",function(l){j.dispatchEvent("onFailure",l)});j.listenTo(j.team,"onUpdate",function(p){var q=[],n={};var o=Object.keys(p.issues);for(var m=0;m<o.length;m++){q.push([p.issues[o[m]].id]);n[p.issues[o[m]].id]={id:p.issues[o[m]].id,type:p.issues[o[m]].type,name:p.issues[o[m]].name,title:p.issues[o[m]].title,modifiedAttributes:["assignees"]}}a.get("eventsHandler").publish(j._subscriberId,"DS/Object/update",{metadata:{appId:a.get("widget").id,appName:a.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:q,attributes:n},version:"1.0"})});j._eventListeners=[{event:"DS/Object/update",listener:function(m){if(j.team&&j.team.physicalIds){var n=m.data.paths;var l=n.some(function(o){return(j.team.physicalIds.indexOf(o[0])!==-1)});if(l){j.team.refresh()}}},conditions:{type:"issue",attributes:["owner","assignees"]}}];for(var k=0;k<j._eventListeners.length;k++){var h=j._eventListeners[k];h.token=a.get("eventsHandler").subscribe(j._subscriberId,h.event,h.listener.bind(j),h.conditions)}d.end(j.name+" setup")},render:function(){var h=this;d.start(h.name+" render");h.team.render().inject(h.container);d.end(h.name+" render");return h},refresh:function(i){var h=this;h.setOption("physicalIds",i);return h.team.refresh(i)},destroy:function(){var i=this;i.stopListening(i.team,"onReady");i.stopListening(i.team,"onFailure");i.stopListening(i.team,"onUpdate");if(Array.isArray(i._eventListeners)){for(var j=0;j<i._eventListeners.length;j++){var h=i._eventListeners[j];a.get("eventsHandler").unsubscribe(h.token)}}i._eventListeners=[];i._subcriberId="";i.team.destroy();i.team=null;i.container.empty()}})});define("DS/IssueManagement/commands/CommandsManager",["UWA/Class","UWA/Class/Events","DS/IssueServices/Contexts","DS/ApplicationFrame/CommandsManager","DS/Logger/Logger"],function(e,b,a,f,d){var c={ISSUE_TYPE:"Issue"};var g=e.singleton(b,{_logger:null,init:function(){var h=this;h._logger=d.getLogger("DS/IssueManagement/View")},commands:{Issue:{single:[],multi:["Dynamic"]},Other:{single:[],multi:["Dynamic"]},Empty:{single:[],multi:["InlineCreate","Create","Templates","Find","Print","ColumnCustomization"]},Common:{single:[],multi:["Find","Print","ColumnCustomization"]}},all:["InlineCreate","Create","Templates","Find","Print","ColumnCustomization","Dynamic"],special:["Selection","Export","Dynamic","SwitchLayout","ToggleInformationPanel"],idling:function(){var i=this;var h=i.all,j=["InlineCreate","Create","Templates"];i.disable(h.filter(function(k){return !this.has(k)},new Set(j)));i.dispatchEvent("onDisable",{commands:i.special});i.enable(["InlineCreate","Create","Templates"])},select:function(h){var l=this;l._logger.debug("Selecting elements in the list...");l.dispatchEvent("onEnable",{commands:l.special});var i=[],j=[];var n=[];if(!h||h.length===0){i=l.all;j=l.commands.Empty.multi;l.disable(i.filter(function(q){return !this.has(q)},new Set(j)));l.enable(l.commands.Empty.multi);return}var o=h.every(function(q){return q.options.type===c.ISSUE_TYPE});var m=h.every(function(q){return q.options.type!==c.ISSUE_TYPE});if(h.length===1){for(var p in l.commands){if(l.commands.hasOwnProperty(p)){if(p===c.ISSUE_TYPE&&!o){continue}n=n.concat(l.commands[p].single).concat(l.commands[p].multi)}}i=l.all;j=n;l.disable(i.filter(function(q){return !this.has(q)},new Set(j)));l.enable(n)}else{for(var k in l.commands){if(l.commands.hasOwnProperty(k)){if(k===c.ISSUE_TYPE&&m){continue}n=n.concat(l.commands[k].multi)}}i=l.all;j=n;l.disable(i.filter(function(q){return !this.has(q)},new Set(j)));l.enable(n)}},getCommand:function(h){return f.getCommand(h)},getCommandCheckHeader:function(h){return f.getCommandCheckHeader(h)},enable:function(h){var i=this;if(!Array.isArray(h)){return}i._switchCommands(h,true);i.dispatchEvent("onEnable",{commands:h})},disable:function(h){var i=this;if(!Array.isArray(h)){return}i._switchCommands(h,false);i.dispatchEvent("onDisable",{commands:h})},_switchCommands:function(n,m){var k=this;for(var j=0;j<n.length;j++){var l=k.getCommand(n[j]);if(l===undefined){l=k.getCommandCheckHeader(n[j])}try{if(m===true){l.enable()}else{l.disable()}}catch(h){k._logger.debug("Cannot set the command %s to %s",n[j],m)}}}});return g});define("DS/IssueManagement/models/TreeNodeModel",["UWA/Core","DS/Tree/TreeNodeModel"],function(d,b){function c(e){var g=this;var f={id:"",physicalId:"",label:"",icons:[],grid:{},type:"",children:[],useAsyncPreExpand:true,matchSearchNavigation:false};e=d.extend(f,e);b.call(g,e)}function a(e){if(!e._getFilterInfo){e.filterInChild=c.prototype.filterInChild.bind(e);e.filterOutChild=c.prototype.filterOutChild.bind(e);e._getFilterInfo=c.prototype._getFilterInfo.bind(e);e._getChildrenFilterInfo=c.prototype._getChildrenFilterInfo.bind(e);e._removeChildrenFilterInfo=c.prototype._removeChildrenFilterInfo.bind(e)}}c.prototype=Object.create(b.prototype);c.prototype.getOccurrencePath=function(h){var g=this;if(d.is(h,"function")){h(this)}if(!g.isRoot()&&g.getParent()){var e=g.getParent();var f=e.getOccurrencePath(h);f.push(g.options.id);f.push(g.options.data.relationToIssue);return f}else{return[g.options.id]}};c.prototype.getNodesById=function(g){var f=this;var e={listOfNodesFound:[]};f._getNodesById(g,e);return e.listOfNodesFound};c.prototype._getNodesById=function(l,j){var h=this;var k=false,e=h.options.id;if(e===l){j.listOfNodesFound.push(h);k=true}else{var g=h.getChildren();if(g){for(var f=0;f<g.length;f++){k=g[f]._getNodesById(l,j)||k}}}return k};c.prototype.matchSearchNavigation=function(){var e=this;e.options.matchSearchNavigation=true};c.prototype.unmatchSearchNavigation=function(){var e=this;e.options.matchSearchNavigation=false};c.prototype.getID=function(){var e=this;return e.options.id};c.prototype.filterOut=function(){var f=this;var e=f.isRoot()?f.getTreeDocument():f.getParent();if(e!==null){a(e);e.filterOutChild(f)}};c.prototype.filterOutChild=function(j){var g=this;var e=g.getChildren();if(e.indexOf(j)<0){throw new Error("This is not a child")}var i=g._getChildrenFilterInfo(true);if(!i.childrenBeforeFiltering){i.childrenBeforeFiltering=e&&e.length>0?e.slice(0):[];var h={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"};if(d.is(g._expandState)){i.expandStateBeforeFiltering=h[g._expandState]}}var f=j._getFilterInfo(true);f.parentBeforeFiltering=g;if(d.is(g.removeChild,"function")){g.removeChild(j)}else{g.removeRoot(j,true,true)}if(d.is(g.setState,"function")){g.setState({state:i.expandStateBeforeFiltering})}if(!i.filteredOutChildren){i.filteredOutChildren=[]}i.filteredOutChildren.push(j)};c.prototype.filterIn=function(e){var h=this;var j=h._getFilterInfo();if(j&&j.parentBeforeFiltering){var g=j.parentBeforeFiltering;a(g);g.filterInChild(h)}if(e===true){var f=null,i=h._getChildrenFilterInfo();if(i&&i.childrenBeforeFiltering){f=i.childrenBeforeFiltering}else{f=h.getChildren()}if(f&&Array.isArray(f)){f.forEach(function(k){k.filterIn(e)})}}};c.prototype.filterInChild=function(f){var l=this;var o=l._getChildrenFilterInfo();if(o&&o.childrenBeforeFiltering){var g=o.childrenBeforeFiltering.indexOf(f);if(g>=0){var m=f._getFilterInfo();if(m&&m.parentBeforeFiltering===l){var p=l.getChildren();var k=null;if(p&&Array.isArray(p)){for(var j=0;j<p.length;j++){var h=p[j];var e=o.childrenBeforeFiltering.indexOf(h);if(e>g){k=h;break}}}delete m.parentBeforeFiltering;if(f.options&&f.options.isRootAttached){if(f.options.isRootAttached===true){l.insertBefore(f,k)}}else{l.insertBefore(f,k)}if(d.is(l.setState,"function")){l.setState({state:o.expandStateBeforeFiltering})}f._removeFilterInfo();var n=o.filteredOutChildren.indexOf(f);o.filteredOutChildren.splice(n,1);if(o.filteredOutChildren.length===0){l._removeChildrenFilterInfo()}}}}};c.prototype._removeFilterInfo=function(){var e=this;delete e.options._filterInfo};c.prototype._removeChildrenFilterInfo=function(){var e=this;delete e.options._childrenFilterInfo};c.prototype._getFilterInfo=function(e){var f=this;if(!f.options._filterInfo&&e){f.options._filterInfo={}}return f.options._filterInfo};c.prototype._getChildrenFilterInfo=function(e){var f=this;if(!f.options._childrenFilterInfo&&e){f.options._childrenFilterInfo={}}return f.options._childrenFilterInfo};return c});define("DS/IssueManagement/components/information/Content",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/Logger/Logger","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(a,f,j,h,k,c,i,d,b,l){var g={CSS:{ELEMENTS:{VIEW_CONTAINER:"im-information-content-view",COMPACT:"compact"},DIMENSIONS:{MIN_WIDTH:420}},DEFAULT_VIEW:"properties"};var e=a.extend({name:"DS/IssueManagement/components/information/Content",tagName:"div",className:"im-information-content",_logger:null,views:{facets:{},current:"",indexes:{}},physicalIds:[],tabs:null,elements:{view:null},setup:function(m){var n=this;b.start(n.name+" setup");n._parent(m);n._logger=c.getLogger(n.name);n.views={facets:{},current:g.DEFAULT_VIEW,indexes:{}};n.views.facets={properties:{index:0,name:"properties",label:l.information.views.properties,icon:"newspaper",module:"DS/IssueManagement/views/facets/Properties",instance:null,isInstantiating:false,toBeRefreshed:false},related:{index:1,name:"related",label:l.information.views.relatedObjects,icon:"location",module:"DS/IssueManagement/views/facets/Related",instance:null,isInstantiating:false,toBeRefreshed:false},team:{index:2,name:"team",label:l.information.views.team,icon:"users",module:"DS/IssueManagement/views/facets/Team",instance:null,isInstantiating:false,toBeRefreshed:false},attachments:{index:3,name:"attachments",label:l.information.views.attachments,icon:"attach",module:"DS/IssueManagement/views/facets/Attachments",instance:null,isInstantiating:false,toBeRefreshed:false},comments:{index:4,name:"comments",label:l.information.views.comments,icon:"chat",module:"DS/IssueManagement/views/facets/Comments",instance:null,isInstantiating:false,toBeRefreshed:false},history:{index:5,name:"history",label:l.information.views.history,icon:"navigation-history",module:"DS/IssueManagement/views/facets/History",instance:null,isInstantiating:false,toBeRefreshed:false}};n.physicalIds=[];n.tabs=null;n.elements={view:null};b.end(n.name+" setup")},render:function(){var o=this;b.start(o.name+" render");var n=o.tabs=new h({displayStyle:"strip",showComboBoxFlag:true,editableFlag:false,multiSelFlag:false,reindexFlag:true,touchMode:true,centeredFlag:false,allowUnsafeHTMLOnTabButton:true});var m=Object.keys(o.views.facets);m.forEach(function(r){var q=o.views.facets[r];var p=new k({shortHelp:q.label});n.add({index:q.index,isSelected:(r===o.views.current),label:q.label,icon:{iconName:q.icon,fontIconFamily:1},showTitleFlag:false,tooltipInfos:p});o.views.indexes[q.index]=r});n.inject(o.container);n.addEventListener("change",function(){var p=n.value[n.value.length-1];if(f.is(o.views.indexes)&&f.is(o.views.indexes[p])){o.views.current=o.views.indexes[p];o.refresh(o.physicalIds,{force:false})}});m.forEach(function(r){var q=o.views.facets[r].index;var p=n.buttonGroup.getButton(q).elements.container;p.addEventListener("dragover",function(){if(n.value[n.value.length-1]!==q){n.buttonGroup.selectIndex(q)}})});o.elements.view=f.createElement("div",{"class":g.CSS.ELEMENTS.VIEW_CONTAINER});o.elements.view.inject(o.container);b.end(o.name+" render");return o},destroy:function(){var m=this;m.views={facets:{},current:"",indexes:{}};m.physicalIds=[];m.tabs.destroy();m.tabs=null;m.elements={view:null};m.container.empty()},refresh:function(s,o){var p=this;var r=j.resolve();var n=p.views.current;if(!Array.isArray(s)||s.length===0){return r}p.physicalIds=s;var m=Object.keys(p.views.facets);m.forEach(function(u){var t=p.views.facets[u];if(t.instance!==null){t.instance.container.addClassName("hidden")}});i.Mask.mask(p.elements.view);var q=p.views.facets[[p.views.current]];if(q.instance===null){if(q.isInstantiating!==true){q.isInstantiating=true;r=new j(function(u,t){require([q.module],function(v){q.instance=new v({physicalIds:p.physicalIds});p.listenToOnce(q.instance,"onReady",function(){u()});p.listenToOnce(q.instance,"onFailure",function(w){p._logger.error("Refresh has failed: %o",w.error);t(w.error)});q.isInstantiating=false;q.instance.render().inject(p.elements.view);q.instance.container.addClassName("visible");i.Mask.unmask(p.elements.view)})})}}else{q.instance.container.addClassName("visible");q.instance.container.removeClassName("hidden");if(o&&o.force===true){r=q.instance.refresh(p.physicalIds).then(function(){if(f.is(q.instance.resize,"function")){q.instance.resize()}i.Mask.unmask(p.elements.view)});m.forEach(function(u){var t=p.views.facets[u];if(t&&t!==q&&t.instance!==null){t.toBeRefreshed=true}})}else{if(q.toBeRefreshed===true){r=q.instance.refresh(p.physicalIds).then(function(){if(f.is(q.instance.resize,"function")){q.instance.resize()}i.Mask.unmask(p.elements.view);q.toBeRefreshed=false})}else{if(f.is(q.instance.resize,"function")){q.instance.resize()}i.Mask.unmask(p.elements.view)}}}return r.then(function(){p.dispatchEvent("onReady",{view:n})})},resize:function(){var n=this;n.container.toggleClassName(g.CSS.ELEMENTS.COMPACT,n.container.getParent()&&n.container.getParent().offsetWidth<g.CSS.DIMENSIONS.MIN_WIDTH);var m=Object.keys(n.views.facets);m.forEach(function(p){var o=n.views.facets[p];if(o.instance!==null&&f.is(o.instance.resize,"function")){o.instance.resize()}})},switchFacet:function(m){var o=this;var n=o.tabs;if(o.views.current===m){return j.resolve(o.views.facets[m].instance)}return new j(function(p){o.listenToOnce(o,"onReady",function(q){p(o.views.facets[q.view].instance)});n.buttonGroup.selectIndex(o.views.facets[m].index)})},getFacet:function(m){var n=this;return n.views.facets[m]},getCurrentFacet:function(){var m=this;return m.views.facets[m.views.current]},getTabs:function(){var m=this;return m.tabs}});return e});define("DS/IssueManagement/commands/SelectAllIssues",["UWA/Class","DS/ApplicationFrame/Command"],function(b,c){var a=b.extend(c,{name:"DS/IssueManagement/commands/SelectAllIssues",execute:function(){var d=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(h,f,g){var e=f.get("component").getTreeDocument();g.start(d.name+" execute");e.withBroadcastSelect(new h(function(i){e.withTransactionUpdate(function(){e.unselectAll();var j=e.getRoots(false);for(var k=0;k<j.length;k++){j[k].select()}g.end(d.name+" execute");i()})}))})}});return a});define("DS/IssueManagement/components/information/Header",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/SocialToolbar/SocialToolbar","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/lifecycle/Lifecycle","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,p,i,a,q,r,l,m,b,c,h,j,f,k,d,g){var n={ISSUE_TYPE:"Issue",CSS:{ELEMENTS:{COMPACT:"compact",MULTIPLE_SELECTION:"multiple-selection",PLACEHOLDER:"im-information-header-placeholder",PLACEHOLDER_IMAGE:"im-information-header-placeholder-image",PLACEHOLDER_CONTENT:"im-information-header-placeholder-content",IMAGE_CONTAINER:"im-information-header-image-ctn",TITLE_CONTAINER:"im-information-header-info-title",TITLE_CONTENT:"im-information-header-info-title-content",PREV_BUTTON:"im-information-header-info-title-prev-btn fonticon fonticon-2x fonticon-chevron-left",NEXT_BUTTON:"im-information-header-info-title-next-btn fonticon fonticon-2x fonticon-chevron-right",SUMMARY_CONTAINER:"im-information-header-info-summary",OWNER_CONTAINER:"im-information-header-info-owner",INFO_CONTAINER:"im-information-header-info-ctn",INFO_ELEMENT:"im-information-header-info-element",INFO_CONTEXTS:"im-information-header-info-contexts",INFO_REPORTEDAGAINST:"im-information-header-info-reportedagainst",INFO_RESOLVEDBY:"im-information-header-info-resolvedby",INFO_ASSIGNEES:"im-information-header-info-assignees",INFO_COMMENTS:"im-information-header-info-comments",INFO_ATTACHMENTS:"im-information-header-info-attachments",INFO_RESOLUTIONDATE:"im-information-header-info-resolutiondate",IMAGE:"im-information-header-image",STACK_IMAGES:"im-information-header-stack-images",STACK_ELEMENT:"im-information-header-stack-element"},DIMENSIONS:{MIN_WIDTH:420}},MAXIMUM_STACK_ELEMENTS_FOR_IMAGES:3};var o=p.extend({name:"DS/IssueManagement/components/information/Header",tagName:"div",className:"im-information-header",_logger:null,setup:function(s){var t=this;d.start(t.name+" setup");t._parent(s);t._logger=r.getLogger(t.name);t.elements={image:null,info:null,buttons:null,tooltips:[]};t._deferred={};t.isLoaded=new e(function(v,u){t._deferred.resolve=v;t._deferred.reject=u});t.physicalIds=[];t._eventListeners=[];d.end(t.name+" setup")},render:function(){var B=this;d.start(B.name+" render");var w=B.elements.placeholder=i.createElement("div",{"class":n.CSS.ELEMENTS.PLACEHOLDER,html:[i.createElement("div",{"class":n.CSS.ELEMENTS.PLACEHOLDER_IMAGE,html:[i.createElement("div",{})]}),i.createElement("div",{"class":n.CSS.ELEMENTS.PLACEHOLDER_CONTENT,html:[i.createElement("div",{}),i.createElement("div",{}),i.createElement("div",{}),i.createElement("div",{})]})]});w.inject(B.container);var E=B.elements.imageContainer=i.createElement("div",{"class":n.CSS.ELEMENTS.IMAGE_CONTAINER,html:[(B.elements.image=i.createElement("div",{"class":n.CSS.ELEMENTS.IMAGE,html:i.createElement("span",{"class":"fonticon fonticon-5x fonticon-camera"})})),(B.elements.stackImages=i.createElement("div",{"class":n.CSS.ELEMENTS.STACK_IMAGES}))],events:{click:function(){b.getCommand("AttachmentManager").begin()}}});E.inject(B.container);var M=B.elements.title=i.createElement("div",{"class":n.CSS.ELEMENTS.TITLE_CONTAINER});M.inject(B.container);var I=B.elements.prevButton=i.createElement("span",{"class":n.CSS.ELEMENTS.PREV_BUTTON,events:{click:function(){var O=j.get("component").getTreeListView();if(i.is(O,"object")){var N=O.getManager();if(i.is(N,"object")){var P=N.getActiveNode();B._scrollToPreviousNode(P)}}}}});I.inject(M);B.elements.prevButtonTooltip=new q({position:"bottom",target:I,body:g.information.header.goToPrevious});var v=B.elements.titleContent=i.createElement("div",{"class":n.CSS.ELEMENTS.TITLE_CONTENT});v.inject(M);var D=B.elements.nextButton=i.createElement("span",{"class":n.CSS.ELEMENTS.NEXT_BUTTON,events:{click:function(){var O=j.get("component").getTreeListView();if(i.is(O,"object")){var N=O.getManager();if(i.is(N,"object")){var P=N.getActiveNode();B._scrollToNextNode(P)}}}}});B.elements.nextButtonTooltip=new q({position:"bottom",target:D,body:g.information.header.goToNext});D.inject(M);var x=B.elements.summary=i.createElement("div",{"class":n.CSS.ELEMENTS.SUMMARY_CONTAINER});x.inject(B.container);var s=B.elements.owner=i.createElement("div",{"class":n.CSS.ELEMENTS.OWNER_CONTAINER});s.inject(B.container);var u=B.lifecycle=new h();u.render().inject(B.container);B.listenTo(B.lifecycle,"request:openRoute",function(N){var O={facetName:"history"};if(i.is(N,"object")&&N.issueId&&N.route){O.callback=function(P){if(P.routes){P.routes.selectRoute(N.route)}}}B.dispatchEvent("request:switchFacet",O)});B.listenTo(B.lifecycle,"onPromotionCompleted",function(N){B._publishUpdate(N.issues)});B.listenTo(B.lifecycle,"onDemotionCompleted",function(N){B._publishUpdate(N.issues)});B.listenTo(B.lifecycle,"onApprovalCompleted",function(N){B._publishUpdate(N.issues)});B.listenTo(B.lifecycle,"onRejectionCompleted",function(N){B._publishUpdate(N.issues)});B.listenTo(B.lifecycle,"onAttachmentsConnected",function(N){B._publishUpdate(N.issues)});var H=B.elements.info=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_CONTAINER});H.inject(B.container);var y=B.elements.infoContexts=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_CONTEXTS,html:[i.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-3d-object"}),i.createElement("span",{"class":"value"})]});y.inject(H);var L=B.elements.infoReportedAgainst=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_REPORTEDAGAINST,html:[i.createElement("span",{"class":"wux-ui-3ds wux-ui-3ds-location"}),i.createElement("span",{"class":"value"})]});L.inject(H);var F=B.elements.infoResolvedBy=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_RESOLVEDBY,html:[i.createElement("span",{"class":"fonticon fonticon-docs"}),i.createElement("span",{"class":"value"})]});F.inject(H);var G=B.elements.infoAssignees=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_ASSIGNEES,html:[i.createElement("span",{"class":"fonticon fonticon-users"}),i.createElement("span",{"class":"value"})]});G.inject(H);var A=B.elements.infoComments=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_COMMENTS,html:[i.createElement("span",{"class":"fonticon fonticon-chat"}),i.createElement("span",{"class":"value"})]});A.inject(H);var J=B.elements.infoAttachments=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_ATTACHMENTS,html:[i.createElement("span",{"class":"fonticon fonticon-attach"}),i.createElement("span",{"class":"value"})]});J.inject(H);var z=B.elements.infoResolutionDate=i.createElement("div",{"class":n.CSS.ELEMENTS.INFO_ELEMENT+" "+n.CSS.ELEMENTS.INFO_RESOLUTIONDATE,html:[i.createElement("span",{"class":"fonticon fonticon-calendar"}),i.createElement("span",{"class":"value"})]});z.inject(H);var K=j.get("eventsHandler");B._subscriberId=Math.random().toString(36).substr(2,9);B._eventListeners=[{event:"DS/Object/update",listener:function(O){var P=O.data.paths.reduce(function(R,Q){R.push(Q.pop());return R});var N=P.some(function(Q){return B.physicalIds.indexOf(Q)!==-1});if(N){B.refresh(B.physicalIds)}},conditions:{type:"issue",attributes:["owner","contexts","reportedAgainst","resolvedBy","assignees","attachments","state"]}}];for(var C=0;C<B._eventListeners.length;C++){var t=B._eventListeners[C];t.token=K.subscribe(B._subscriberId,t.event,t.listener.bind(B),t.conditions)}d.end(B.name+" render");return B},refresh:function(v){var t=this;var s=[];t._deferred={};t.isLoaded=new e(function(x,w){t._deferred.resolve=x;t._deferred.reject=w});t.elements.placeholder.show();t.container.toggleClassName(n.CSS.ELEMENTS.MULTIPLE_SELECTION,v.length>1);t.elements.tooltips.forEach(function(w){w.destroy()});t.elements.tooltips=[];t.physicalIds=v;if(v.length===1){var u=v[v.length-1];s.push(t._refreshPrimaryImage(v));s.push(t._refreshInfo(u));s.push(t.lifecycle.refresh(v))}else{if(v.length>1){s.push(t._refreshPrimaryImage(v));t.elements.titleContent.setContent(g.replace(g.information.header.multipleSelection.title,{number:v.length}));t.elements.summary.setContent(g.information.header.multipleSelection.summary);s.push(t.lifecycle.refresh(v))}else{if(v.length===0){t.elements.image.setStyle("background-image","none");t.elements.image.setContent(i.createElement("span",{"class":"fonticon fonticon-5x fonticon-camera"}))}}}return e.all(s).then(function(){t.elements.placeholder.hide();t.dispatchEvent("onRefresh");t._deferred.resolve()})["catch"](function(w){t._logger.error("Cannot refresh information header %o",w);t._deferred.reject(w)})},_refreshPrimaryImage:function(t){var s=this;return f.images.retrieve({data:{objects:t.map(function(u){return{physicalId:u}})}}).then(function(v){if(Array.isArray(v)){if(v.length===1){var w=v[0].body;if(i.is(w,"object")&&i.is(w.url,"string")&&w.url!==""){var y=i.createElement("div");y.setStyle("background-image",'url("'+w.url+'")');s.elements.image.setContent(y)}else{s.elements.image.setStyle("background-image","none");s.elements.image.setContent(i.createElement("span",{"class":"fonticon fonticon-5x fonticon-camera"}))}}else{if(v.length>1){s.elements.owner.empty();s.elements.stackImages.empty();for(var x=0;x<v.length;x++){if(x>=n.MAXIMUM_STACK_ELEMENTS_FOR_IMAGES){return}var B=v[x].body;var u=i.createElement("div",{"class":n.CSS.ELEMENTS.STACK_ELEMENT});if(i.is(B,"object")&&i.is(B.url,"string")&&B.url!==""){u.setContent("");u.setStyle("background-image",'url("'+B.url+'")')}else{u.setStyle("background-image","none");u.setContent(i.createElement("span",{"class":"fonticon fonticon-5x fonticon-camera"}))}var z=v.length>n.MAXIMUM_STACK_ELEMENTS_FOR_IMAGES?n.MAXIMUM_STACK_ELEMENTS_FOR_IMAGES:v.length;var A=x*4-z+1,C=100-x;if(A<0){u.setStyle("transform","translate(-"+(A*-1)+"px,"+(A*-1)+"px)")}else{u.setStyle("transform","translate("+A+"px,-"+A+"px)")}u.setStyle("z-index",C);s.elements.stackImages.appendChild(u)}}}}else{throw new Error("Unexpected response when retrieving images.")}})["catch"](function(u){s._logger.error("Cannot retrieve the images: %o",u)})},_refreshInfo:function(t){var v=this;var u=[];var s=f.issues.retrieve({data:{objects:[{physicalId:t}]}}).then(function(z){if(Array.isArray(z)&&z.length===1){var A=z[0].body;var B=c.getTextFromHTML(A.title)+" ("+c.getTextFromHTML(A.name)+")";v.elements.titleContent.setContent("<span>"+B+"</span>");v.elements.tooltips.push(new q({position:"bottom",target:v.elements.titleContent.getElement("span"),body:B,trigger:"touch"}));var w='<span class="created-date">'+c.timeSince(new Date(A.created))+"</span>";var x='<span class="owner-fullname">'+A.owner.fullName+"</span>";var y=g.replace(g.information.header.summary,{timeSince:w,owner:x});v.elements.summary.setContent(y);v.elements.summary.getElement("span.created-date").addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"properties"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.summary.getElement("span.created-date"),body:g.replace(g.tooltips.creationDate,{date:(new Date(A.created)).toLocaleString(j.get("widget").lang)})}));v.elements.tooltips.push(new q({position:"bottom",target:v.elements.summary.getElement("span.owner-fullname"),body:A.owner.fullName+" ("+A.owner.user+")"}));v.elements.summary.getElement("span.owner-fullname").addEventListener("click",function(){k.getUserProfile(A.owner.user)});var C=i.createElement("img",{src:k.getUserImage(A.owner.user)});v.elements.tooltips.push(new q({position:"left",target:C,body:A.owner.fullName+" ("+A.owner.user+")"}));C.addEventListener("click",function(){k.getUserProfile(A.owner.user)});v.elements.owner.setContent(C);v.elements.infoContexts.getElement("span.value").setContent(String(A.contexts.length));v.elements.infoContexts.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"related"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoContexts,body:A.contexts.length?g.replace(g.tooltips.contexts,{number:A.contexts.length}):g.tooltips.noContext}));v.elements.infoReportedAgainst.getElement("span.value").setContent(String(A.reportedAgainst.length));v.elements.infoReportedAgainst.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"related"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoReportedAgainst,body:A.reportedAgainst.length?g.replace(g.tooltips.reportedAgainst,{number:A.reportedAgainst.length}):g.tooltips.noReportedAgainst}));v.elements.infoResolvedBy.getElement("span.value").setContent(String(A.resolvedBy.length));v.elements.infoResolvedBy.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"related"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoResolvedBy,body:A.resolvedBy.length?g.replace(g.tooltips.resolvedBy,{number:A.resolvedBy.length}):g.tooltips.noResolvedBy}));v.elements.infoAssignees.getElement("span.value").setContent(String(A.assignees.length));v.elements.infoAssignees.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"team"})});var E="";if(A.assignees.length>0){E=A.assignees.reduce(function(F,G){F=F+"<br>"+G.fullName;return F},g.replace(g.tooltips.assignees,{number:A.assignees.length}))}else{E=g.tooltips.noAssignee}v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoAssignees,body:E}));var D=(new Date(A.resolutionDate)).toLocaleString(j.get("widget").lang);v.elements.infoResolutionDate.getElement("span.value").setContent(D);v.elements.infoResolutionDate.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"properties"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoResolutionDate,body:g.replace(g.tooltips.resolutionDate,{date:D})}))}else{throw new Error("Unexpected response when retrieving issues.")}})["catch"](function(w){v._logger.error("Cannot retrieve the info: %o",w)});u.push(s);f.comments.retrieve({data:{physicalId:t}}).then(function(x){var w=0;try{w=x.body.result.nbComments}catch(y){w=0}if(!c.isInteger(w)){w=0}v.elements.infoComments.getElement("span.value").setContent(String(w));v.elements.infoComments.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"comments"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoComments,body:g.replace(g.tooltips.comments,{number:w})}))});m.getDocumentsFrom(t).then(function(w){var y=0;try{y=w.attachments.length}catch(x){y=0}if(!c.isInteger(y)){y=0}v.elements.infoAttachments.getElement("span.value").setContent(String(y));v.elements.infoAttachments.addEventListener("click",function(){v.dispatchEvent("request:switchFacet",{facetName:"attachments"})});v.elements.tooltips.push(new q({position:"bottom",target:v.elements.infoAttachments,body:g.replace(g.tooltips.attachments,{number:y})}))});return e.all(u)},resize:function(){var s=this;s.container.toggleClassName(n.CSS.ELEMENTS.COMPACT,s.container.getParent()&&s.container.getParent().offsetWidth<n.CSS.DIMENSIONS.MIN_WIDTH);s.lifecycle.resize()},destroy:function(){var t=this;t.elements.tooltips.forEach(function(v){v.destroy()});if(t.elements.prevButtonTooltip){t.elements.prevButtonTooltip.destroy()}if(t.elements.nextButtonTooltip){t.elements.nextButtonTooltip.destroy()}t.elements={image:null,info:null,buttons:null,tooltips:[]};t.physicalIds=[];if(Array.isArray(t._eventListeners)){for(var u=0;u<t._eventListeners.length;u++){var s=t._eventListeners[u];j.get("eventsHandler").unsubscribe(s.token)}}t._eventListeners=[];t.container.empty()},_publishUpdate:function(u){var v=this;var w=[];var t={};for(var s=0;s<u.length;s++){w.push([u[s].physicalId]);t[u[s].physicalId]={id:u[s].id,type:"Issue",modifiedAttributes:["state"]}}j.get("eventsHandler").publish(v._subscriberId,"DS/Object/update",{metadata:{appId:j.get("widget").id,appName:j.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:w,attributes:t},version:"1.0"})},_scrollToNextNode:function(v){var w=this;var x=j.get("component").getTreeListView();if(i.is(x,"object")){var u=x.getManager();if(i.is(u,"object")){var t=v.getNextVisibleNode();if(t){if(t.options.type===n.ISSUE_TYPE){u._goToNode(v,+1);var s=j.get("component").getTreeDocument();s.prepareBroadcastSelect();s.pushBroadcastSelect()}else{w._scrollToNextNode(t)}}}}},_scrollToPreviousNode:function(v){var w=this;var x=j.get("component").getTreeListView();if(i.is(x,"object")){var u=x.getManager();if(i.is(u,"object")){var t=v.getPreviousVisibleNode();if(t){if(t.options.type===n.ISSUE_TYPE){u._goToNode(v,-1);var s=j.get("component").getTreeDocument();s.prepareBroadcastSelect();s.pushBroadcastSelect()}else{w._scrollToPreviousNode(t)}}}}}});return o});define("DS/IssueManagement/commands/Find",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader"],function(b,d){var a={TIMEOUT_TOOLTIP:200,INPUT_WIDTH:300};var c=b.extend(d,{view:null,activated:false,_query:"",mini:null,init:function(e){var g=this;g._parent(e,{});var f=false;var h=g.onStateChange(function(){if(f===true){f=false;return}if(g.activated===g.getState()){return}g.activated=g.getState();if(g.activated===true){g.execute()}else{g.hide()}});g._destroy=function(){g._modelEvents.unsubscribe(h)};f=true;g.setState(false,true)},execute:function(){var e=this;require(["UWA/Core","DS/IssueManagement/components/header/Find","DS/IssueServices/Contexts"],function(m,j,g){var l=g.get("actionBar");e.mini=null;var k=new j();var i=g.get("actionBar").getIconBar().getItem("Find");i.tooltip.getContent().hide();e.view=k;var f=i.elements.container,h=i.elements.icon;if((f.getBoundingClientRect().left-l.container.getBoundingClientRect().left)<a.INPUT_WIDTH){e.mini=m.createElement("div",{"class":"mini-inline-find",html:[{tag:"div","class":"mini-inline-find-placeholder"},k.render()]});e.mini.inject(g.get("actionBar").container.parentElement)}else{f.setStyles({transition:"width 0.2s",width:a.INPUT_WIDTH});h.setStyle("float","left");k.render().inject(f)}if(e._query!==""){e.view.input.setValue(e._query);e.view.find(e._query)}})},find:function(f){var e=this;e._query=f;if(e.getState()===true){e.view.input.setValue(e._query);e.view.find(e._query)}else{e.toggleState()}},hide:function(){var e=this;require(["DS/IssueServices/Contexts"],function(g){e.view.destroy();e.view=null;e._query="";if(e.mini!==null){e.mini.destroy();e.mini=null}var i=g.get("actionBar").getIconBar().getItem("Find");setTimeout(function(){i.tooltip.getContent().show();i.tooltip.hide()},a.TIMEOUT_TOOLTIP);var f=i.elements.container,h=i.elements.icon;f.setStyle("width","38px");h.setStyle("float","initial")})}});return c});define("DS/IssueManagement/views/facets/Related",["UWA/Core","UWA/Class/View","DS/IssueComponents/related/Related","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,d,c,a,b){return d.extend({name:"DS/IssueManagement/views/facets/Related",tagName:"div",className:"related-view fade-in-element",defaultOptions:{physicalIds:[]},related:null,_subscriberId:"",_eventListeners:[],setup:function(g){var h=this;b.start(h.name+" setup");h._parent(g);h.related=new c({ids:h.getOption("physicalIds"),intercom:true});h._subscriberId=Math.random().toString(36).substr(2,9);h.listenTo(h.related,"onReady",function(j){h.dispatchEvent("onReady",j)});h.listenTo(h.related,"onFailure",function(j){h.dispatchEvent("onFailure",j)});h.listenTo(h.related,"onUpdate",function(n){var o=[],k={};var m=Object.keys(n.issues);for(var j=0;j<m.length;j++){o.push([n.issues[m[j]].id]);k[n.issues[m[j]].id]={id:n.issues[m[j]].id,type:n.issues[m[j]].type,name:n.issues[m[j]].name,title:n.issues[m[j]].title,modifiedAttributes:[n.relation]}}a.get("eventsHandler").publish(h._subscriberId,"DS/Object/update",{metadata:{appId:a.get("widget").id,appName:a.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:o,attributes:k},version:"1.0"})});h._eventListeners=[{event:"DS/Object/update",listener:function(k){if(h.related&&h.related.options.ids){var l=k.data.paths;var j=l.some(function(m){return(h.related.options.ids.indexOf(m[0])!==-1)});if(j){h.related.refresh(h.related.options.ids)}}},conditions:{type:"issue",attributes:["reportedAgainst","resolvedBy","contexts"]}}];for(var i=0;i<h._eventListeners.length;i++){var f=h._eventListeners[i];f.token=a.get("eventsHandler").subscribe(h._subscriberId,f.event,f.listener.bind(h),f.conditions)}b.end(h.name+" setup")},render:function(){var f=this;b.start(f.name+" render");f.related.render().inject(f.container);b.end(f.name+" render");return f},refresh:function(g){var f=this;f.setOption("physicalIds",g);return f.related.refresh(g)},destroy:function(){var g=this;g.stopListening(g.related,"onReady");g.stopListening(g.related,"onFailure");g.stopListening(g.related,"onUpdate");if(Array.isArray(g._eventListeners)){for(var h=0;h<g._eventListeners.length;h++){var f=g._eventListeners[h];a.get("eventsHandler").unsubscribe(f.token)}}g._eventListeners=[];g._subcriberId="";g.related.destroy();g.related=null;g.container.empty()}})});define("DS/IssueManagement/IssueManagement",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Migration","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Support","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(d,k,i,g,c,b,f,h,l){var j={ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_TYPE:"Issue",CONTENT_ID_SEARCH:"X3DContentId",CONTENT_ID_NOTIF:"XNotifContentId",CONTENT_ID_TEMPLATE:"XTemplateContentId",CONTENT_ID_SHARE:"XSharedContentId",ON_PREMISE_TENANT:"OnPremise",CLOUD_TENANT:"Cloud",CSS:{DIMENSIONS:{MINIMUM_INFORMATION_WIDTH:430,MINIMUM_COMPONENT_WIDTH:260}}};var a={placeholder:function(){var o="";o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action-divider"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action-divider"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-action-divider"></div>';o+='<div class="issue-list-placeholder-action"></div>';o+='<div class="issue-list-placeholder-button"></div>';var m='<div class="issue-list-placeholder-header"></div>';for(var n=0;n<=50;n++){m+='<div class="issue-list-placeholder-line"></div>'}return i.createElement("div",{"class":"issue-list-placeholder fade-out-element",html:[i.createElement("div",{"class":"issue-list-placeholder-actions",html:o}),i.createElement("div",{"class":"issue-list-placeholder-lines",html:m})]})},error:function(){return i.createElement("div",{"class":"loading-error-container",html:i.createElement("div",{"class":"loading-error",html:[i.createElement("div",{"class":"loading-error-icon",html:i.createElement("span",{"class":"fonticon fonticon-5x fonticon-attention"})}),i.createElement("div",{"class":"loading-error-label",html:l.error.label}),i.createElement("div",{"class":"loading-error-sub-label",html:l.error.sub})]})})}};var e=d.extend({name:"DS/IssueManagement/IssueManagement",actionBar:null,filter:null,status:null,component:null,elements:{container:null,header:null,body:null,footer:null},isLoaded:null,isStandalone:false,_deferred:{resolve:null,reject:null},_isDOMLoaded:false,_placeholder:null,_isResizing:false,init:function(m){var n=this;g.add("widget",window.widget);g.get("widget").name=j.ISSUE_MANAGEMENT;g.add("application",n);n.component=null;n.actionBar=null;n.filter=null;n.status=null;n.elements={container:null,header:null,body:null,footer:null};n.isStandalone=false;if(i.is(m,"object")){n.isStandalone=m.standalone||false}n.isLoaded=new k(function(p,o){n._deferred.resolve=p;n._deferred.reject=o});n._isDOMLoaded=false;n._placeholder=a.placeholder();n._isResizing=false;n._subscribers()},onLoad:function(){var n=this;f.start(n.name+" onLoad");g.get("widget").body.setContent(n._placeholder);n._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element");try{h.checkBrowserSupport()}catch(m){}if(!b.isUpToDate()){b.upgrade();return}g.get("widget").body.addEventListener("drop",function(o){o.preventDefault();o.stopPropagation()});c.initPlatformServices().then(function(){try{h.checkSwymSupport()}catch(o){}var p=c.getSecurityContexts(),q=c.getTenants();return n._setPreferences({securityContexts:p,tenants:q})}).then(function(){return n._initializeComponent({})}).then(function(){f.end(n.name+" onLoad");n._deferred.resolve()},function(o){f.end(n.name+" onLoad");n._deferred.reject(o);g.get("widget").body.appendChild(a.error());n.utils.error(o)})},onRefresh:function(){var m=this;var n=g.get("widget");n.setTitle(m.getTitle()+" - "+l.titles.refreshing);if(m.component!==null){m.component.refresh()}if(m.information!==null){m.information.refresh()}},onResize:function(){var m=this;m._isResizing=false;if(m._isDOMLoaded===false){return}m._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element");m._placeholder.removeClassName("resizing");m.elements.container.removeClassName("fade-out-element").addClassName("fade-in-element");m.resize()},endEdit:function(){var m=this;m.component.publishPreferences()},onDestroy:function(){var m=this;if(m.actionBar!==null){m.actionBar.destroy()}m.actionBar=null;g.remove("actionBar");if(m.filter!==null){m.filter.destroy()}m.filter=null;g.remove("filter");if(m.status!==null){m.status.destroy()}m.status=null;g.remove("status");if(m.component!==null){m.component.destroy()}m.component=null;g.remove("component");if(m.information!==null){m.information.destroy()}m.information=null;g.remove("information");m.elements.container.destroy();m.elements.header.destroy();m.elements.body.destroy();m.elements.footer.destroy();m.elements={container:null,header:null,body:null,footer:null};g.remove("application");g.remove("widget");m._isDOMLoaded=false},onTitleChange:function(){var n=this;var o=g.get("widget"),p=n.getTitle();var m=n.component.getTreeDocument().getRoots(false);if(m.length===0){p+=" - "+l.titles.placeholder.title}else{p+=" ("+m.length+")"}if(o.getTitle()!==p){o.setTitle(p)}},onSetPathTags:function(){var m=this;m.component.setLocalPathTags()},resize:function(){var m=this;var n=g.get("widget");if(m.actionBar!==null){m.actionBar.resize()}if(n.body.offsetWidth>(j.CSS.DIMENSIONS.MINIMUM_INFORMATION_WIDTH+j.CSS.DIMENSIONS.MINIMUM_COMPONENT_WIDTH)){if(m.information!==null){m.information.fullscreenWidth=false;m.information.resize()}if(m.component!==null){m.component.container.show();m.component.resize()}}else{if(m.information!==null){m.information.fullscreenWidth=true;m.information.resize()}}if(m.component!==null){m.component.resize()}},getTitle:function(){var o=g.get("widget");var m=o.getValue("title"),n=o.getPreference("title");if(o&&n){m=m&&m.trim();m=m||n.defaultValue;return m}return l.preferences.name["default"]},getActions:function(){var m=this;return m.actionBar},getInformation:function(){var m=this;return m.information},getComponent:function(){var m=this;return m.component},_initializeComponent:function(w){var r=this;var q=g.get("widget");var p=null,m=null,v=null,u=null,n=null,o=null,s=null,t=null;return new k(function(x){require(["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/Component","DS/IssueManagement/components/footer/Status","DS/IssueManagement/components/header/ActionBar","DS/IssueManagement/components/header/Filter","DS/IssueManagement/components/information/Information","DS/IssueManagement/utils/EventsHandler"],function(E,y,D,F,B,C,z,A){p=E;m=y;v=D;s=F;u=B;n=C;o=z;t=A;x()})}).then(function(){return new k(function(y,x){r.eventsHandler=new t();g.add("eventsHandler",r.eventsHandler);r.information=new o().render();g.add("information",r.information);r.actionBar=new u().render();g.add("actionBar",r.actionBar);r.filter=new n().render();g.add("filter",r.filter);r.status=new s().render();g.add("status",r.status);r.component=new v(p.extend(w,{events:{onReady:function(z){y(z)},onRootsAdded:function(){r.onTitleChange();if(r.component.getSelectedNodes().length===0){m.select()}},onRootsRemoved:function(){var z=r.component.getTreeDocument().getRoots(false);if(z.length===0){m.idling()}else{if(r.component.getSelectedNodes().length===0){m.select()}}r.onTitleChange()},setPathTags:function(){r.onTitleChange()}}}));g.add("component",r.component);return r.component.build()["catch"](x)})}).then(function(x){return new k(function(B){r.elements.header=p.createElement("div",{"class":"im-header"});r.elements.body=p.createElement("div",{"class":"im-body"});r.elements.footer=p.createElement("div",{"class":"im-footer"});r.filter.inject(r.elements.header);r.actionBar.inject(r.elements.header);r.component.inject(r.elements.body);r.information.inject(r.elements.body);r.status.inject(r.elements.footer);var y=r.elements.container=p.createElement("div",{"class":"issue-list"});r.elements.header.inject(y);r.elements.body.inject(y);r.elements.footer.inject(y);y.inject(q.body);if(x.roots.length===0){r.onTitleChange();m.idling()}else{m.select()}r._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element");var A=q.getValue("infoIsOpened");var z=p.is(A,"boolean")?A:A==="true";r.information.toggle(z,false);r._isDOMLoaded=true;B()})}).then(function(){return r.component.onPostInitialize()})},_setPreferences:function(m){var n=this,o=g.get("widget");if(i.is(m.securityContexts,"object")){o.addPreference({name:"securityContext",type:"list",label:l.preferences.securityContext,options:m.securityContexts.cspaces,defaultValue:m.securityContexts.securityContext})}if(c.isCloudEnvironment()===true&&i.is(m.tenants,"object")){o.addPreference({name:"x3dPlatformId",type:"list",label:l.preferences.tenant,options:m.tenants.platforms,defaultValue:m.tenants.tenant})}o.addPreference({name:"title",type:"text",label:l.preferences.name.title,onchange:"onTitleChange",defaultValue:l.preferences.name["default"]});o.addPreference({name:"validation",type:"boolean",label:l.preferences.validation,defaultValue:"false"});o.addPreference({name:"approaching",type:"range",min:"0",max:"100",label:l.preferences.highlights.soon,defaultValue:"3"});o.addPreference({name:"activateBIFilter",type:"boolean",label:l.preferences.tagger,defaultValue:"true"});o.addPreference({name:"filter",type:"hidden",defaultValue:JSON.stringify({owned:true,assigned:true,reported:false,responsible:false,participated:false,closed:false,session:false})});o.addPreference({name:"roots",type:"hidden",defaultValue:[]});n._computeFilter();n._computePreferences();return o.getPreferences()},_computeFilter:function(){var q=g.get("widget");try{var o=JSON.parse(q.getValue("filter"));var s=(q.getValue(j.CONTENT_ID_SHARE))?JSON.parse(q.getValue(j.CONTENT_ID_SHARE)):null;var p=(q.getValue(j.CONTENT_ID_NOTIF))?JSON.parse(q.getValue(j.CONTENT_ID_NOTIF)):null;var r=(q.getValue(j.CONTENT_ID_SEARCH))?JSON.parse(q.getValue(j.CONTENT_ID_SEARCH)):null;var m=[];if(s!==null){m=m.concat(s.issues)}else{if(p!==null){m=m.concat(p.issues)}else{if(r!==null){r.data.items.forEach(function(t){if(t.objectType===j.ISSUE_TYPE){m.push(t.objectId)}})}}}if(m.length===0&&o.session===true){m=q.getValue("roots")}if(m.length>0){o={owned:false,assigned:false,reported:false,responsible:false,participated:false,closed:false,session:true};q.setValue("filter",JSON.stringify(o));q.setValue("roots",m)}else{q.setValue("roots",[])}}catch(n){}},_computePreferences:function(){var m=g.get("widget");return new k(function(r,q){try{var p=(m.getValue(j.CONTENT_ID_TEMPLATE))?JSON.parse(m.getValue(j.CONTENT_ID_TEMPLATE)):null;if(p!==null){var o=p.template;if(o&&o!==""){r(o)}}}catch(n){q(new Error("An error occurred while adding a shared template "+n))}}).then(function(n){return new k(function(o){require(["DS/PADUtils/views/PADAlert","DS/IssueComponents/templates/Templates","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(p,r,s){var q=new r(g.get("widget"),{editMode:true,onClose:function(){},onEnd:function(){}});q.addSharedTemplateToPreferences(n).then(o)["catch"](function(){p.displayNotification({msg:s.templates.notifications.sharedTemplateNotAdded,eventID:"error"});o()})})})})},_subscribers:function(){var m=this;var n=g.get("widget");n.addEvent("onLoad",m.onLoad.bind(m));n.addEvent("onRefresh",m.onRefresh.bind(m));n.addEvent("onResize",m.onResize.bind(m));n.addEvent("endEdit",m.endEdit.bind(m));n.addEvent("onDestroy",m.onDestroy.bind(m));n.addEvent("onTitleChange",m.onTitleChange.bind(m));n.addEventOnce("onSetPathTags",m.onSetPathTags.bind(m));n.body.addEventListener("contextmenu",function(o){o.preventDefault()},m);m._isResizing=false;window.addEventListener("resize",function(){if(m._isDOMLoaded===false){return}if(m._isResizing===true){return}m._isResizing=true;m._placeholder.addClassName("resizing");m._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element");m.elements.container.removeClassName("fade-in-element").addClassName("fade-out-element")},false)},utils:{error:function(m){if(i.is(m,"object")&&i.is(m.error,"object")&&i.is(m.error.message,"string")){require(["DS/PADUtils/views/PADAlert"],function(n){n.displayNotification({msg:m.error.message,eventID:"error"})})}}}});return e});define("DS/IssueManagement/commands/SwitchLayout",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],function(d,a,c){var b=a.extend(c,{name:"DS/IssueManagement/commands/SwitchLayout",begin:function(e){var f=this;f.execute(e)},execute:function(e){var f=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(g,h){h.start(f.name+" execute");g.get("information").setLayout(e.layout);g.get("actionBar").updateLayoutSwitcher();h.end(f.name+" execute")})}});return b});define("DS/IssueManagement/components/header/Find",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(a,e,d,g,c,b,i){var f={ISSUE_TYPE:"Issue",TIMEOUT_INPUT:250,REFRESH_DEBOUNCE_TIMEOUT:100,FIRST_INDEX:0};var h=function(l,n,k){var m;return function(){var r=this,q=arguments;var p=function(){m=null;if(!k){l.apply(r,q)}};var o=k&&!m;clearTimeout(m);m=setTimeout(p,n);if(o){l.apply(r,q)}}};var j=a.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"find-container",_logger:null,domEvents:{"keyup input.find-input":"_onSearch","paste input.find-input":"_onSearch","click div.clear-cont":"_onCancel","click div.fonticon-down-open":"_onNext","click div.fonticon-up-open":"_onPrevious","click div.fonticon-check":"_onSelect"},list:null,document:null,input:null,value:"",matches:[],advancedSearch:false,index:-1,cancel:null,nav:null,next:null,previous:null,select:null,cancelTooltip:null,nextTooltip:null,previousTooltip:null,selectTooltip:null,_isSorted:false,_sortToken:null,_tokens:{subscribe:null,listener:null},setup:function(l){var m=this;b.start(m.name+" setup");m._parent(l);m.list=null;m.document=null;m.input=null;m.value="";m.matches=[];m.advancedSearch=false;m.index=-1;m.cancel=null;m.navigation=null;m.next=null;m.previous=null;m.select=null;m.cancelTooltip=null;m.nextTooltip=null;m.previousTooltip=null;m.selectTooltip=null;m._isSorted=false;m._sortToken=null;m._tokens={subscribe:null,listener:null};var k=c.get("component");m.list=k.getTreeListView();m.document=k.getTreeDocument();m._subscribers();b.end(m.name+" setup")},render:function(){var k=this;b.start(k.name+" render");k.input=new d({className:"find-input",placeholder:i.actions.find.placeholder});k.input.inject(k.container);k.cancel=e.createElement("div",{"class":"clear-cont fonticon fonticon-cancel-circled"}).inject(k.container);k.cancelTooltip=new g({target:k.cancel,body:i.actions.find.cancel});k.navigation=e.createElement("div",{"class":"nav-cont hidden"}).inject(k.container);k.select=e.createElement("div",{"class":"fonticon fonticon-check fonticon-1x"}).inject(k.navigation);k.selectTooltip=new g({target:k.select});k.previous=e.createElement("div",{"class":"fonticon fonticon-up-open"}).inject(k.navigation);k.previousTooltip=new g({target:k.previous,position:"bottom"});k.next=e.createElement("div",{"class":"fonticon fonticon-down-open"}).inject(k.navigation);k.nextTooltip=new g({target:k.next,position:"top"});k.cancel.setAttribute("style","font-size: 18px !important");k.previous.setAttribute("style","font-size: 18px !important");k.next.setAttribute("style","font-size: 18px !important");k.select.setAttribute("style","font-size: 18px !important");setTimeout(function(){k.focus()},0);b.end(k.name+" render");return k},destroy:function(){var k=this;k.reset();k.document.getModelEvents().unsubscribe(k._tokens.subscribe);k._tokens.subscribe=null;k.document.removeEventListener("nodeModelUpdate",k._tokens.listener);k._tokens.listener=null;k.list=null;k.document=null;k.input.destroy();k.input=null;k.value="";k.matches=[];k.advancedSearch=false;k.index=-1;k.cancel.destroy();k.cancel=null;k.navigation.destroy();k.navigation=null;k.next.destroy();k.next=null;k.previous.destroy();k.previous=null;k.select.destroy();k.select=null;k.cancelTooltip.destroy();k.cancelTooltip=null;k.nextTooltip.destroy();k.nextTooltip=null;k.previousTooltip.destroy();k.previousTooltip=null;k.selectTooltip.destroy();k.selectTooltip=null;k._isSorted=false;k._sortToken=null;k.container.destroy()},find:h(function(v){var r=this;if(r.document===null){return[]}b.start(r.name+" find");r.clear();r.matches=[];r.value=v;var t=false;var y=[];var w=v.split(";");t=w.length>1;for(var n=0;n<w.length;n++){var u=w[n];u=u.trim();if(u.length===0){continue}var o=u.split(":");var k=null,s=null;var q=u.indexOf(":");k=u.substring(q+1,u.length);k=k.trim();var m=r.list.getManager().getColumns();if(k.length>0){for(var p=0;p<m.length;p++){var l=m[p];if(l.text&&l.text.toLowerCase().valueOf()===o[f.FIRST_INDEX].toLowerCase().valueOf()){if(l.dataIndex==="tree"){s="ds6w:title"}else{s=l.dataIndex}break}}}if(s!==null){y=r.search({attribute:s,value:k})}else{y=r.search({value:u})}if(t===true){if(y.length===0){return[]}else{if(r.matches.length===0){r.matches=r.matches.concat(y)}}}else{r.matches=r.matches.concat(y)}}if(t===true){var x=[];x=x.concat(r.matches);r.matches=x.filter(function(z){return z._isMatchingSearch});r.matches.sort(function(A,z){return A._getNodeInfos().virtualRowID-z._getNodeInfos().virtualRowID})}r.list.getManager().prepareUpdateView();r.list.getManager().pushUpdateView(true);r.index=0;r.navigate(-1);b.end(r.name+" find");return r.matches},f.TIMEOUT_INPUT),search:function(w){var q=this;b.start(q.name+" search");var u=w.value;var k=false;var p=[];if(w.hasOwnProperty("attribute")){p.push(w.attribute);k=true}else{var o=q.list.getManager().getColumns();o.forEach(function(x){if(x.dataIndex==="tree"){p.push("ds6w:title")}else{p.push(x.dataIndex)}})}var r=false;if(q.matches.length>0){r=true}var n=u;n=n.replace(/[-[\]{}()*+?\\^$]/g,"\\$&");var m=n.concat("|",u);var t=null;try{t=new RegExp(m,"i")}catch(s){t=new RegExp(n,"i")}var v=[];var l=false;b.start(q.name+" search match");v=q.document.search({match:function(y){var B=y.nodeModel.options.type===f.ISSUE_TYPE;if(!B&&y.nodeModel.isVisible()!==true){return false}var C=B?y.nodeModel.isMatchingSearch():y.nodeModel.getParent().isMatchingSearch();if((r&&!C)||(!r&&C)){return false}if(!k){if((u&&t.test(y.nodeModel.options.title))||(u&&t.test(y.nodeModel.options.name))){if(B===false){q.matches.push(y.nodeModel.getParent());y.nodeModel.getParent()._isMatchingSearch=true;return false}y.nodeModel._isMatchingSearch=true;return true}}for(var x=0;x<p.length;x++){var A=p[x];if(y.nodeModel.options.grid.hasOwnProperty(A)){var z=y.nodeModel.options.grid[A];if(z&&t.test(z)){if(B===false){q.matches.push(y.nodeModel.getParent());y.nodeModel.getParent()._isMatchingSearch=true;return false}y.nodeModel._isMatchingSearch=true;return true}}}if(r===true){y.nodeModel._isMatchingSearch=false}return false},shouldStop:function(){if(q.value!==q.input.getValue()){q.clear();l=true}return l}});b.end(q.name+" search match");b.end(q.name+" search");if(l===true){return[]}else{return v}},clear:function(){var k=this;if(k.document===null){return}b.start(k.name+" clear");if(k.matches.length>0){k.document.withTransactionUpdate(function(){for(var l=0;l<k.matches.length;l++){k.matches[l].unmatchSearch();k.matches[l].unmatchSearchNavigation()}});k.list.getManager().prepareUpdateView();k.list.getManager().pushUpdateView(true)}b.end(k.name+" clear")},focus:function(){var k=this;k.input.focus()},navigate:function(n){var o=this;b.start(o.name+" navigate");if(o.matches.length>=1){if(o.navigation.hasClassName("hidden")){o.navigation.removeClassName("hidden")}}else{if(!o.navigation.hasClassName("hidden")){o.navigation.addClassName("hidden");o.index=0}}if(n>=0){o.matches[n].unmatchSearchNavigation();var l=o.matches[n]._getNodeInfos().virtualRowID;var r=o.list.getManager().getCell(l,"tree");var k=r.getView();if(k!==undefined){o.list.getManager().updateCellView(o.matches[n],"tree")}}if(o._isSorted===true){o._isSorted=false;o.index=0;o.matches.sort(function(t,s){return t._getNodeInfos().virtualRowID-s._getNodeInfos().virtualRowID})}if(o.matches.length>0){o.matches[o.index].matchSearchNavigation();var q=o.matches[o.index]._getNodeInfos().virtualRowID;var m=o.list.getManager().getCell(q,"tree");var p=m.getView();if(p!==undefined){o.list.getManager().updateCellView(o.matches[o.index],"tree")}if(!o.list.getManager().isNodeInVisibleViewport(o.matches[o.index])){o.list.getManager().scrollToNode(o.matches[o.index],"middle",true)}o.nextTooltip.setBody(i.replace(i.actions.find.next,{number1:o.index+1,number2:o.matches.length}));o.previousTooltip.setBody(i.replace(i.actions.find.previous,{number1:o.index+1,number2:o.matches.length}));o.selectTooltip.setBody(i.replace(i.actions.find.select,{number:o.matches.length}));if(o._sortToken===null){o._sortToken=o.list.getManager()._modelEvents.subscribe({event:"sort"},function(){o._isSorted=true;o.list.getManager()._modelEvents.subscribeOnce({event:"UPDATE_VIEW_COMPLETED"},function(){o.navigate(o.index)})})}}b.end(o.name+" navigate")},reset:function(){var k=this;k.index=-1;k.navigation.addClassName("hidden");if(k._sortToken!==null){k.list.getManager()._modelEvents.unsubscribe(k._sortToken);k._sortToken=null}k.clear();k.input.setValue("");k.value=""},_onSearch:function(l){var k=this;if(l.keyCode===13&&k.matches.length>1){if(l.shiftKey){k._onPrevious()}else{k._onNext()}return}if(l.code==="ShiftLeft"||l.code==="ShiftRight"){return}var n=k.input.getValue();if(n===""&&l.type==="paste"){n=l.clipboardData.getData("text")}if(n===""){k.reset()}else{k.find(n);if(l.keyCode===13&&n==="do a barrel roll"){var m=c.get("widget");m.body.addClassName("do-a-barrel-roll");setTimeout(function(){m.body.removeClassName("do-a-barrel-roll")},(40+2)*100)}}},_onCancel:function(){require(["DS/IssueManagement/commands/CommandsManager"],function(k){k.getCommandCheckHeader("Find").toggleState()})},_onNext:function(){var k=this;var l=k.index;if(k.index===k.matches.length-1){k.index=0}else{k.index++}k.navigate(l)},_onPrevious:function(){var k=this;var l=k.index;if(k.index===0){k.index=k.matches.length-1}else{k.index--}k.navigate(l)},_onSelect:function(){var k=this;k.document.prepareBroadcastSelect();k.document.withTransactionUpdate(function(){k.document.unselectAll();k.matches.forEach(function(l){l.select()});k.document.pushBroadcastSelect()})},_subscribers:function(){var k=this;var l=h(function(){k.matches=[];k.index=-1;k.navigation.addClassName("hidden");k._onSearch({})},f.REFRESH_DEBOUNCE_TIMEOUT);var m=h(function(){k.clear();k.matches=[];k.index=-1;k.navigation.addClassName("hidden");k._onSearch({})},f.REFRESH_DEBOUNCE_TIMEOUT);k._tokens.subscribe=k.document.getModelEvents().subscribe({event:"setPathTags"},l);k._tokens.listener=k.document.addEventListener("nodeModelUpdate",m)}});return j});define("DS/IssueManagement/views/facets/Properties",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","css!DS/IssueCommon/IssueCommon.css"],function(h,g,a,i,f,d,e,b,c){return a.extend({name:"DS/IssueCommon/views/PropertiesView",tag:"div",className:"properties-view fade-in-element",defaultOptions:{physicalIds:[]},properties:{component:"",selection:[],promises:[]},_timestampUpdate:0,_subscriberTokens:[],_subscriberId:"",_eventListeners:[],setup:function(j){var k=this;c.start(k.name+" setup");k._parent(j);k.properties={component:null,selection:[],promises:[]};k._timestampUpdate=0;k._subscriberTokens=[];k.properties.component=new f({setEditButton:true,readOnly:false,selectionType:i.NO_SELECTION,typeOfDisplay:i.ONLY_EDIT_PROPERTIES,securityContext:b.getSecurityContext()});k._subscribers();c.end(k.name+" setup")},render:function(){var j=this;c.start(j.name+" render");j.properties.component.inject(j.container);j.refresh(j.getOption("physicalIds"));c.end(j.name+" render");return j},refresh:function(m){var j=this;j.setOption("physicalIds",m);j.properties.selection.forEach(function(n){n.destroy()});j.properties.selection=[];j.properties.promises=[];m.forEach(function(n){var o=new d({metatype:"businessobject",tenant:b.getTenant(),objectId:n});j.properties.promises.push(new h(function(p){o.listenToOnce(o,"onSave",function(){p(this)})}));j.properties.selection.push(o)});j.properties.component.initDatas(j.properties.selection);h.all(j.properties.promises).then(function(n){j._onSave(n)});var k=null;var l=j.properties.component.getListModel();if(l.length>0){k=new h(function(n){j.listenTo(l[l.length-1],"onChange",function(p){var o=p.getAllAttributes().name;if(o&&g.is(o,"object")){j.stopListening(l[l.length-1],"onChange");n()}})})}else{k=h.resolve()}return k.then(function(){j.dispatchEvent("onReady",{})})},destroy:function(){var k=this;k._subscriberTokens.forEach(function(l){e.get("eventsHandler").unsubscribe(l)});k._subscriberTokens=[];k._timestampUpdate=0;try{k.properties.selection.forEach(function(l){l.destroy()})}catch(j){}try{k.properties.component.destroyComponent()}catch(j){}k.properties={component:null,selection:[],promises:[]};k.container.empty()},_onSave:function(n){var m=this;c.start(m.name+" _onSave");m.properties.promises=[];m.properties.selection.forEach(function(p){m.properties.promises.push(new h(function(q){p.listenToOnce(p,"onSave",function(){q(this)})}))});if(m.properties.promises.length===0){return}h.all(m.properties.promises).then(function(p){m._onSave(p)});var o=[],j={};for(var l=0;l<n.length;l++){var k=n[l].get("objectId");o.push([k]);j[k]={id:k,type:n[l].get("type"),name:n[l].get("name").value,title:n[l].get("Title").value,modifiedAttributes:["*"]}}e.get("eventsHandler").publish(m._subscriberId,"DS/Object/update",{metadata:{appId:e.get("widget").id,appName:e.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:o,attributes:j},version:"1.0"});c.end(m.name+" _onSave")},_subscribers:function(){var k=this;var m=e.get("eventsHandler");k._subscriberId=Math.random().toString(36).substr(2,9);k._eventListeners=[{event:"DS/Object/update",listener:function(p){c.start(k.name+" DS/Object/update");var o=k.properties.selection.reduce(function(s,r){s.push(r.get("objectId"));return s},[]);var n=p.data.paths.reduce(function(s,r){s.push(r.pop());return s},[]),q=n.filter(function(r){return o.includes(r)});if(q.length>0){k.properties.promises=[];k.properties.component.onRefresh()}c.end(k.name+" DS/Object/update")},conditions:{type:"issue"}}];for(var l=0;l<k._eventListeners.length;l++){var j=k._eventListeners[l];j.token=m.subscribe(k._subscriberId,j.event,j.listener.bind(k),j.conditions)}}})});define("DS/IssueManagement/commands/Detach",["UWA/Class","DS/ApplicationFrame/Command"],function(a,c){var b=a.extend(c,{dialog:null,execute:function(){var d=this;require(["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(k,f,n,w,u,o,t,m,j){var h=m.get("widget");if(h.body.getElement(".detach-objects-issue-dialog")){return}var e=m.get("component"),r=e.getSelectedNodes(),p={};var v=[];for(var s=0;s<r.length;s++){var q=r[s].options.id,g=r[s].options.data.issue,l=r[s].options.data.relationToIssue;v.push(r[s].options.title+" ("+r[s].options.name+")");if(p[g]===undefined){p[g]={physicalId:g}}if(p[g][l]===undefined){p[g][l]=[]}p[g][l].push({physicalId:q})}new f(function(B,A){var z=[];v.forEach(function(C){z.push(k.createElement("li",{html:C,title:C}))});var x=k.createElement("div",{html:[j.related.confirmDetach,k.createElement("ul",{"class":"detach-objects-issue-dialog-ul",html:z})]});var i=null;var y=d.dialog=new o({animate:true,autocenter:true,closable:true,limitParent:false,overlay:true,resizable:true,visible:true,className:"detach-objects-issue-dialog",title:j.replace(j.related.dialogTitle,{number:r.length,issues:Object.keys(p).length}),header:null,body:x,footer:[i=new n({value:j.related.detach,className:"primary detach-objects-issue-dialog-add",events:{onClick:function(){y.destroy();d.dialog=null;B()}}}),new n({value:j.related.cancel,className:"default detach-objects-issue-dialog-cancel",events:{onClick:function(){y.destroy();d.dialog=null;A(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){y.destroy();d.dialog=null;A(new Error("The dialog has been closed by the end user"))}}}).inject(h.body);new u({element:x}).inject(y.getBody());y.show();i.focus()}).then(function(){w.mask(h.body);e.getTreeDocument().removeContextsOrReportedAgainstOrResolvedBy(p).then(function(){w.unmask(h.body);t.displayNotification({msg:j.notifications.detachSuccess,eventID:"success"})},function(){w.unmask(h.body);t.displayNotification({msg:j.notifications.serverError,eventID:"error"})})})})}});return b});define("DS/IssueManagement/utils/BIFilter",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(a,g,e,c,d,b,h){var f={FLAG_FILTER_IN:"IN"};var i=a.extend({name:"DS/IssueManagement/utils/BIFilter",_loggerBIFilter:null,_biFilter:null,_isBIFilterInitialized:false,_initializationPromiseBIFilter:null,_isBIFilterActivated:false,_persistence:{filter:false,dialog:null},initializeBIFilter:function(){var j=this;var k=d.get("widget");b.start(j.name+" initializeBI");j._loggerBIFilter=c.getLogger("DS/IssueManagement/View");k.addEvent("endEdit",j._onModifyPreferences.bind(j));j.document.addEventListener("setPathTags",j._onSetPathTags.bind(j));j._initializationPromiseBIFilter=j._createBIFilterProxy();j._isBIFilterActivated=j.utils.isActivateBIFilter()===true;b.end(j.name+" initializeBI")},focusOnSubjects:function(j){var l=this;var n=l._biFilter;if(n&&n._biFilter){if(j.length===0){n._biFilter.unfocus();return}var m={};var o=[];for(var k=0;k<j.length;k++){m[j[k].options.physicalId]="3DSpace";o.push("pid://"+j[k].options.physicalId)}n._biFilter.myTagProxy.focusOnSubjects(o,true,m)}},_onSetPathTags:function(){var j=this;var k=d.get("widget");if(j._isBIFilterInitialized===false){j._initializationPromiseBIFilter.then(function(){j._onSetPathTags()});return}j._loggerBIFilter.info("Setting the path tags for %s %s",k.name,k.id);if(j.utils.isActivateBIFilter()===true){setTimeout(function(){b.start(j.name+" _onSetPathTags");var n={nodes:[],paths:[]},l={};var m=j.document.getRoots();m.forEach(function(o){if(!o.isHidden()){var p=o.getPath();var q=p.map(function(s){var r=s.options.id;if(!l.hasOwnProperty(r)){n.nodes.push(r);l[r]=n.nodes.length-1}return l[r]});n.paths.push(q)}});j._biFilter.setPathTags(n,function(){d.get("widget").dispatchEvent("onSetPathTags")});b.end(j.name+" _onSetPathTags")},0)}},setLocalPathTags:function(){var k=this;if(k._persistence.dialog!==null){k._persistence.dialog.destroy()}var j=d.get("widget").getValue("pathTags");if(k._persistence.filter&&e.is(j,"object")){k._biFilter._biFilter.myTagProxy.setLocalFilter(j)}},loadBIFilterPreference:function(){var k=this;var l=d.get("widget");var j=l.getValue("pathTags");if(k.utils.isActivateBIFilter()&&e.is(j,"object")){k._persistence.filter=true;require(["DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/ENOFloatingPanel/ENOFloatingPanel"],function(m,o,n){k._persistence.dialog=new n({animate:true,autocenter:true,closable:false,limitParent:false,overlay:true,resizable:true,visible:true,className:"tagger-issues-dialog",title:h.tagger.waiting.title,header:null,body:null,footer:[new m({value:h.tagger.cancel,className:"primary",events:{onClick:function(){k._persistence.filter=false;k._persistence.dialog.destroy();k._persistence.dialog=null;l.deleteValue("pathTags")}}})]}).inject(l.body);o.mask(k._persistence.dialog.getBody(),h.tagger.waiting.label)})}},_createBIFilterProxy:function(){var j=this;b.start(j.name+" _createBIFilterProxy");var k=d.get("widget");return new g(function(m,l){require(["DS/ENOFilterBIUX/FilterBIComponentProxy","DS/IssueServices/services/PlatformServices"],function(o,q){var n={tenant:q.getTenant(),processingMode:"appProcessing",colorize:true,widgetId:k.id};try{j._biFilter=new o(n);j._biFilter.addEvent("FilterBIColorize",j._onFilterBIColorize,j);j._biFilter.addEvent("FilterBIUnColorize",j._onFilterBIUnColorize,j);j._biFilter.addEvent("FilterBIFilteringEvent",j._onFilterBIFilteringEvent,j)}catch(p){l(new Error("The BIFilter proxy could not be initialized: "+p))}j._isBIFilterInitialized=true;m();b.start(j.name+" _createBIFilterProxy")})})},_cleanBIFilterProxy:function(){var j=this;b.start(j.name+" cleanProxy");if(j._biFilter&&j._biFilter.cleanProxy){j._biFilter.cleanProxy()}b.end(j.name+" cleanProxy")},_onModifyPreferences:function(){var j=this;if(j._isBIFilterInitialized===false){j._initializationPromiseBIFilter.then(function(){j._onSetPathTags()});return}b.start(j.name+" _onModifyPreferences");if(j.utils.isActivateBIFilter()===true&&j._isBIFilterActivated===false){j._isBIFilterActivated=true;if(j._isBIFilterInitialized===false){j._initializationPromiseBIFilter=j._createBIFilterProxy()}else{j._biFilter.addEvent("FilterBIColorize",j._onFilterBIColorize,j);j._biFilter.addEvent("FilterBIUnColorize",j._onFilterBIUnColorize,j);j._biFilter.addEvent("FilterBIFilteringEvent",j._onFilterBIFilteringEvent,j);j._onSetPathTags()}}else{if(j._isBIFilterInitialized===true&&j.utils.isActivateBIFilter()===false){j._isBIFilterActivated=false;j._cleanBIFilterProxy();j._biFilter.setPathTags({nodes:[],paths:[]});j._biFilter.removeEvent("FilterBIColorize",j._onFilterBIColorize,j);j._biFilter.removeEvent("FilterBIUnColorize",j._onFilterBIUnColorize,j);j._biFilter.removeEvent("FilterBIFilteringEvent",j._onFilterBIFilteringEvent,j)}}b.end(j.name+" _onModifyPreferences")},_onFilterBIColorize:function(l){var j=this;b.start(j.name+" _onFilterBIColorize");function k(m,n){if(e.is(m.coloredSubjects,"array")){m.coloredSubjects.forEach(function(p){var o=p.color;var q=p.path.map(function(r){return m.nodes[r]});n(o,q)})}else{j._loggerBIFilter.error("Invalid Argument : %o",l)}}if(j.document.getComponent().getTreeListView().getManager().isColumnHidden("biColor")===true){j.document.getComponent().getTreeListView().getManager().showColumn("biColor")}j.document.withTransactionUpdate(function(){var n=j.document.getRoots(false);for(var p=0;p<n.length;p++){var m={grid:{biColor:"rgba(0, 0, 0, 0)"}};n[p].updateOptions(m);var q=n[p].getAllDescendants();for(var o=0;o<q.length;o++){q[o].updateOptions(m)}}k(l,function(r,s){j.document.getNodesByPath(s).forEach(function(u){var t={grid:{biColor:r}};u.updateOptions(t)})});b.end(j.name+" _onFilterBIColorize")})},_onFilterBIUnColorize:function(){var j=this;j.document.withTransactionUpdate(function(){var l=j.document.getRoots(false);for(var n=0;n<l.length;n++){var k={grid:{biColor:"rgba(0, 0, 0, 0)"}};l[n].updateOptions(k);var o=l[n].getAllDescendants();for(var m=0;m<o.length;m++){o[m].updateOptions(k)}}});if(j.document.getComponent().getTreeListView().getManager().isColumnHidden("biColor")!==true){j.document.getComponent().getTreeListView().getManager().hideColumn("biColor")}},_onFilterBIFilteringEvent:function(k){var j=this;j.document.withTransactionUpdate(function(){var u=j.document.getRoots(true).slice(0);u.forEach(function(v){v.filterIn(true)});var r=k.filteredSubjectList;if(r&&Array.isArray(r)){var l=k.nodes,m=[],n={};var o=function o(v){return l[v]};for(var p=0;p<r.length;p++){var t=r[p];if(!n.hasOwnProperty(t)){m.push(t.map(o))}}m.forEach(function(v){j.document.getNodesByPath(v).forEach(function(w){w._filterStatus=f.FLAG_FILTER_IN;w.getParents().forEach(function(x){x._filterStatus=f.FLAG_FILTER_IN})})});var s=function s(v,w){if(v._filterStatus===f.FLAG_FILTER_IN){}else{v.filterOut();if(w){w.push(v)}}delete v._filterStatus};u.forEach(function(v){s(v)})}else{j._loggerBIFilter.error("The filtering argument is invalid: %o",k)}j.document.getModelEvents().publish({event:"setPathTags",context:j.document});j.dispatchEvent("setPathTags",{});var q=d.get("widget");if(k&&e.is(k.localfilters,"object")&&Object.keys(k.localfilters).length>0){q.setValue("pathTags",k.localfilters)}else{q.deleteValue("pathTags")}})},utils:{isActivateBIFilter:function(){var k=d.get("widget");var l=false;if(e.is(k.getPreference("activateBIFilter"),"object")){var j=k.getValue("activateBIFilter");l=e.is(j,"boolean")?j:j==="true"}return l}}});return i});define("DS/IssueManagement/commands/ToggleInformationPanel",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],function(d,b,c){var a=b.extend(c,{name:"DS/IssueManagement/commands/ToggleInformationPanel",begin:function(e){var f=this;f.execute(e)},execute:function(e){var f=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(g,h){h.start(f.name+" execute");g.get("information").toggle(e.open,e.save);g.get("actionBar").updatePanelToggle();h.end(f.name+" execute")})}});return a});define("DS/IssueManagement/views/facets/Comments",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/SocialToolbar/SocialToolbar","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","css!DS/IssueCommon/IssueCommon.css"],function(e,g,h,a,f,b,d,c){return g.extend({name:"DS/IssueManagement/views/facets/Comments",tag:"div",className:"comments-view fade-in-element",defaultOptions:{physicalIds:[]},comments:null,elements:{target:null,scroller:null},setup:function(i){var j=this;c.start(j.name+" setup");j._parent(i);j.elements.target=h.createElement("div",{"class":"comments-content"});j.container.setContent(j.elements.target);j.elements.scroller=new a({element:j.elements.target}).inject(j.container);j.comments=null;c.end(j.name+" setup")},render:function(){var i=this;if(i.isValidSelection()===false){i.elements.target.hide();i.placeholder.show(i.container);setTimeout(function(){i.dispatchEvent("onReady",{})},0);return i}else{i.placeholder.hide(i.container);i.elements.target.show()}c.start(i.name+" render");var j=i.getOption("physicalIds");i.comments=new f({subjectURI:"pid:"+j[j.length-1],enableShare:false,enableComment:true,enableLike:false,tenantId:d.getTenant(),serviceURL:d.get3DSpaceUrl()+"/resources/issues/","3DSwymUrl":d.get3DSwymUrl(),commentsNumberAtInit:8,enableUpload:false});i.listenToOnce(i.comments,"onPopulate",function(){i.dispatchEvent("onReady",{})});i.comments.inject(i.elements.scroller.getInnerElement());c.end(i.name+" render");return i},refresh:function(j){var i=this;if(i.comments!==null){i.comments.destroy();i.comments=null}i.setOption("physicalIds",j);i.render();return new e(function(k){i.listenToOnce(i,"onReady",k)})},destroy:function(){var i=this;i.stopListening(i,"onReady");if(i.comments!==null){i.comments.destroy();i.comments=null}i.container.empty()},isValidSelection:function(){var i=this;var j=i.getOption("physicalIds");return Array.isArray(j)&&j.length===1},placeholder:{_view:new b(),show:function(i){var j=this;j._view.render("comments").inject(i);j._view.show()},hide:function(){var i=this;i._view.hide();i._view.empty()}}})});define("DS/IssueManagement/components/header/ActionBar",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/ApplicationFrame/ActionBar","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(f,b,i,k,e,l,m,a,d,h,c,j,o){var g={LIST_VIEW:"ListView",KANBAN_VIEW:"KanbanView",ISSUE_FROM_BLANK:"IFB",ISSUE_FROM_TEMPLATE:"IFT",DUMMY_MENU:"DUMMY_MENU",LAYOUT:{RIGHT:"right",BOTTOM:"bottom"}};var n=b.extend({name:"DS/IssueManagement/components/header/ActionBar",tagName:"div",className:"action-bar",_iconBar:null,_switchers:{layout:null,information:null,tooltips:{layout:null,information:null}},setup:function(p){var q=this;q._parent(p);q._iconBar=null;q._switchers={layout:null,information:null,tooltips:{layout:null,information:null}};q._abar=new m({file:"IssueManagement.xml",module:"IssueManagement"});q._subscribers()},render:function(){var v=this;var r=c.get("widget");v.container.addClassName("disabled");var w=v.utils.getCurrentView(),q="",u="";if(w===g.LIST_VIEW){q="view-small-tile";u=o.actions.kanbanView}else{q="view-list";u=o.actions.listView}var p=r.getValue("kanbanViewBy")||"state";v._iconBar=new e({renderTo:v.container,items:[{name:"InlineCreate",fonticon:"plus",text:o.actions.create.title,handler:function(){a.getCommandCheckHeader("InlineCreate").toggleState()}},{name:"Templates",fonticon:"newspaper",text:o.actions.templates,handler:function(){a.getCommand("Templates").begin()}},{className:"divider"},{name:"Find",fonticon:"search-similar",text:o.actions.find.title,handler:function(){a.getCommandCheckHeader("Find").toggleState()}},{name:"Selection",fonticon:"select-on",text:o.actions.select.title,content:{type:"dropdownmenu",options:{items:[{name:"SelectAllIssues",fonticon:"flow-cascade",text:o.actions.select.selectIssues,handler:function(){a.getCommand("SelectAllIssues").begin()}},{name:"SelectAllRelatedObjects",fonticon:"flow-tree",text:o.actions.select.selectChildren,handler:function(){a.getCommand("SelectAllRelatedObjects").begin()}}]}}},{name:"Export",fonticon:"export",text:o.actions["export"],content:{type:"dropdownmenu",options:{items:[{name:"ExportCSV",fonticon:"doc-log",text:o.actions.exportCSV,handler:function(){a.getCommand("ExportCSV").begin()}},{name:"ExportPPTX",fonticon:"newspaper",text:o.actions.exportPPTX,handler:function(){a.getCommand("ExportPPTX").begin()}},{name:"ExportZIP",fonticon:"archive",text:o.actions.exportZIP,handler:function(){a.getCommand("ExportZIP").begin()}}]}}},{name:"Print",fonticon:"print",text:o.actions.print,handler:function(){a.getCommand("Print").begin()}},{className:"divider"},{name:"ColumnCustomization",fonticon:"cog",text:o.actions.customizeView,handler:function(){a.getCommand("ColumnCustomization").begin()}},{name:"KanbanCustomization",fonticon:"cog",text:o.actions.customizeView,content:{type:"dropdownmenu",options:{multiSelect:false,closeOnClick:true,items:[{name:"state",text:o.columns.stateColumn,selectable:true,selected:p==="state"},{name:"priority",text:o.columns.priorityColumn,selectable:true,selected:p==="priority"},{name:"resolutionDate",text:o.columns.resolutionDateColumn,selectable:true,selected:p==="resolutionDate"},{name:"all",text:o.columns.allColumn,selectable:true,selected:p==="all"}],events:{onClick:function(){var z=this;var A=z.getSelectedItems();if(A.length===1){var y=A[A.length-1].name;c.get("component").kanban.switchView(y);r.setValue("kanbanViewBy",y);r.dispatchEvent("endEdit")}}}}}},{name:"SwitchView",fonticon:q,text:u,handler:function(){var z=v._iconBar.getItem("SwitchView"),y=z.elements.icon,A=z.tooltip;if(y.hasClassName("fonticon-view-list")===true){y.removeClassName("fonticon-view-list").addClassName("fonticon-view-small-tile");z.fonticon="fonticon-view-small-tile";z.text=o.actions.kanbanView;A.setBody(o.actions.kanbanView);v._iconBar.getItem("KanbanCustomization").elements.container.hide();v._iconBar.getItem("ColumnCustomization").elements.container.show();a.getCommand("SwitchView").begin("ListView")}else{y.removeClassName("fonticon-view-small-tile").addClassName("fonticon-view-list");z.fonticon="fonticon-view-list";z.text=o.actions.listView;A.setBody(o.actions.listView);v._iconBar.getItem("ColumnCustomization").elements.container.hide();v._iconBar.getItem("KanbanCustomization").elements.container.show();a.getCommand("SwitchView").begin("KanbanView")}}},{className:"divider"},{name:"Dynamic",fonticon:"menu-dot",text:o.actions.more,content:{type:"dropdownmenu",options:{items:[{name:g.DUMMY_MENU,fonticon:"attention",text:o.actions.dummy,handler:function(){}}],events:{onShow:function(){var y=this;v.utils.setMoreActions(y)}}}}}]});v.listenTo(v._iconBar.overflowMenu,"onShow",function(){v._iconBar.overflowMenu.menus.forEach(function(B){if(B.parentItem&&B.parentItem.name==="Dynamic"){var A=B.items.reduce(function(E,D){E.push(D.name);return E},[]);var C=function(E){if(E&&Array.isArray(E.items)){for(var D=0;D<E.items.length;D++){C(E.items[D])}}if(E&&E.name){v._iconBar.overflowMenu.removeItem(E.name)}};A.forEach(function(D){var E=v._iconBar.overflowMenu.getItem(D);C(E)});var z=B.items.reduce(function(E,D){E.push(D.id);return E},[]);z.forEach(function(D){B.removeItem(D)})}});var y=v._iconBar.overflowMenu.getItem("Dynamic").id;v.utils.getMoreActions().then(function(z){var A=f.clone(z);A.forEach(function(B){B.parentItemId=y;v._iconBar.overflowMenu.addItem(B)})})});if(w===g.LIST_VIEW){v._iconBar.getItem("KanbanCustomization").elements.container.hide();v._iconBar.getItem("ColumnCustomization").elements.container.show()}else{v._iconBar.getItem("KanbanCustomization").elements.container.show();v._iconBar.getItem("ColumnCustomization").elements.container.hide()}v._getLayoutSwitcher().inject(v.container);var x=c.get("information");var s=x.getPreferences();var t=s.current||g.LAYOUT.RIGHT;if(x.getLayout().current!==t&&a.getCommand("SwitchLayout")){a.getCommand("SwitchLayout").begin({layout:t})}return v},destroy:function(){var p=this;p.stopListening(a,"onEnable");p.stopListening(a,"onDisable");p._iconBar.destroy();p._iconBar=null;p._switchers.tooltips.information.destroy();p._switchers.tooltips.information=null;p._switchers.information.destroy();p._switchers.information=null;p._switchers.tooltips.layout.destroy();p._switchers.tooltips.layout=null;p._switchers.layout.destroy();p._switchers.layout=null},resize:function(){var p=this;requestAnimationFrame(function(){p._iconBar.resize()})},enable:function(p){var q=this;p.forEach(function(t){switch(t){case"ToggleInformationPanel":q._switchers.information.enable();if(a.getCommand("ToggleInformationPanel")){var s=c.get("widget").getValue("infoIsOpened");var r=f.is(s,"boolean")?s:s==="true";a.getCommand("ToggleInformationPanel").begin({open:r,save:false})}break;case"SwitchLayout":q._switchers.layout.enable();break;default:q._iconBar.enableItem(t);break}})},disable:function(p){var q=this;p.forEach(function(r){switch(r){case"ToggleInformationPanel":q._switchers.information.setActive(false);q._switchers.information.disable();if(a.getCommand("ToggleInformationPanel")){a.getCommand("ToggleInformationPanel").begin({open:false,save:false})}break;case"SwitchLayout":q._switchers.layout.disable();break;default:q._iconBar.disableItem(r);break}})},getIconBar:function(){var p=this;return p._iconBar},getLayoutSwitcher:function(){var p=this;return p._switchers.layout},getApplicationFrameActionBar:function(){var p=this;return p._abar},_getLayoutSwitcher:function(){var t=this;var v=c.get("widget");var u=v.getValue("infoIsOpened");var s=f.is(u,"boolean")?u:u==="true";var r=f.clone(v.getValue("infoLayout"))||g.LAYOUT.RIGHT;var p=t._switchers.information=new i({active:s,icon:"info"}).addEvent("onClick",function(){var y=this;y.toggleActive();var x=y.isActive();a.getCommand("ToggleInformationPanel").begin({open:x,save:true})});t._switchers.tooltips.information=new l({target:p.getContent(),body:o.information.toggleTooltip});var w=t._switchers.layout=new i({dropdown:{items:[{name:g.LAYOUT.RIGHT,text:o.information.right,selected:r===g.LAYOUT.RIGHT,selectable:true},{name:g.LAYOUT.BOTTOM,text:o.information.bottom,selected:r===g.LAYOUT.BOTTOM,selectable:true}]},events:{onDropdownClick:function(y,x){a.getCommand("SwitchLayout").begin({layout:x.name,save:true})}}});t._switchers.tooltips.layout=new l({target:w.getContent(),body:o.information.layoutSwitcherTooltip});var q=new k({buttons:[p,w]});return f.createElement("div",{"class":"button-panel-container",html:q})},updatePanelToggle:function(){var q=this;if(!q._switchers.information.isDisabled()){var s=c.get("widget");var r=s.getValue("infoIsOpened");var p=f.is(r,"boolean")?r:r==="true";q._switchers.information.setActive(p)}},_getDropdownLayoutSwitcher:function(p){return{items:[{name:g.LAYOUT.RIGHT,text:o.information.right,selected:p===g.LAYOUT.RIGHT,selectable:true},{name:g.LAYOUT.BOTTOM,text:o.information.bottom,selected:p===g.LAYOUT.BOTTOM,selectable:true}]}},updateLayoutSwitcher:function(t){var q=this;var r=c.get("widget");var p=f.is(t,"string")?t:(f.clone(r.getValue("infoLayout"))||g.LAYOUT.RIGHT);var s=q._switchers.layout;s.dropdown.removeItem(g.LAYOUT.RIGHT);s.dropdown.removeItem(g.LAYOUT.BOTTOM);q._getDropdownLayoutSwitcher(p).items.forEach(function(u){s.dropdown.addItem(u)})},_subscribers:function(){var p=this;var q=c.get("widget");p.listenTo(a,"onEnable",function(r){p.enable(r.commands);if(p.utils.getCurrentView()===g.KANBAN_VIEW){a.disable(["Selection","Find"])}});p.listenTo(a,"onDisable",function(r){p.disable(r.commands)});p._abar.onActionBarReady(function(){var s=a.getCommandCheckHeader("InlineCreate");s.onStateChange(function(){if(p._iconBar===null){return}var t=p._iconBar.getItem("InlineCreate").elements.container;if(s.getState()===true){t.addClassName("active")}else{t.removeClassName("active")}});var r=a.getCommandCheckHeader("Find");r.onStateChange(function(){if(p._iconBar===null){return}var t=p._iconBar.getItem("Find").elements.container;if(r.getState()===true){t.addClassName("active")}else{t.removeClassName("active")}});q.addEvent("onSearch",function(t){if(r.isEnabled()===true){r.find(t)}});q.addEvent("onResetSearch",function(){if(r.isEnabled()===true){if(r.getState()===true){r.toggleState()}else{}}});p.container.removeClassName("disabled")})},utils:{getCurrentView:function(){var p=j.getItem("view");if(!p||!p.name){j.setItem("view",{name:g.LIST_VIEW});return g.LIST_VIEW}return p.name},setMoreActions:function(r){var q=this;var p=r.items.reduce(function(t,s){t.push(s.id);return t},[]);p.forEach(function(s){r.removeItem(s)});if(Array.isArray(r.menus)){r.menus.length=1}return q.getMoreActions().then(function(s){s.forEach(function(t){r.addItem(t)});return s})},getMoreActions:function(){var p=this;return h.getContextualMenu().then(function(r){var q=[];r.forEach(function(s){var t=p.convert(s);if(t!==null){q.push(t)}});if(q.length>0&&q[q.length-1].className==="divider"){q.pop()}return q})},convert:function(s){var r=this;var p=[],q={};if(s.type==="SeparatorItem"){return{className:"divider"}}if(s.submenu&&s.submenu.length>0){s.submenu.forEach(function(t){p.push(r.convert(t))});q={name:s.title.replace(/ /g,""),fonticon:s.fonticon&&s.fonticon.content&&s.fonticon.content.trim!==""?s.fonticon.content:null,text:s.title};if(p.length>0){q.items=p}}else{q={name:s.title.replace(/ /g,""),fonticon:s.fonticon&&s.fonticon.content&&s.fonticon.content.trim!==""?s.fonticon.content:null,text:s.title,handler:s.action.callback}}return q}}});return n});define("DS/IssueManagement/views/facets/Attachments",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/IssueAttachmentManager/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueCommon/IssueCommon.css","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(j,h,c,d,a,g,f,e,b,k){var i={ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_3D_REVIEW:"ENX3DIR_AP"};return c.extend({name:"DS/IssueManagement/views/facets/Attachments",tag:"div",className:"attachments-view fade-in-element",manager:null,_subscriberId:"",_eventListeners:[],setup:function(n){var q=this;e.start(q.name+" setup");q._parent(n);q._deferred={};q.isLoaded=new j(function(u,t){q._deferred.resolve=u;q._deferred.reject=t});q.target=h.createElement("div",{"class":"attachments-content"});q.container.setContent(q.target);var r=f.get("widget"),m=f.get("component");var p=r.body.getDimensions();var o={mode:2,catalogLayout:1,catalogVisibility:true,sliderVisibility:false,annotationPreLaunchCallback:function(){var t=this;if(q.hasOwnProperty("modal")){q.modal.hide()}if(r.name===i.ISSUE_3D_REVIEW){try{t.annotationCanvasTarget=h.Element.getElement.call(m.get3DContext().root.getFrameWindow().elements.viewerFrame,"canvas")}catch(u){}}else{t.annotationCanvasDefaultDimensions={width:p.width-50,height:p.height-50}}}};var l=f.get("widget").getValue("attachmentManagerPreferences");o=h.merge(o,l||{});var s=q.getOption("physicalIds");o.id=s[s.length-1];q.manager=new d(o);q._subscriberId=Math.random().toString(36).substr(2,9);e.end(q.name+" setup")},render:function(){var m=this;if(m.isValidSelection()===false){m.target.hide();m.placeholder.show(m.container)}else{m.placeholder.hide(m.container);m.target.show()}e.start(m.name+" render");var l=f.get("component");m.manager.render().inject(m.target);m.manager.isLoaded.then(function(){m.utils._addCustomCommands.apply(m);m.manager.container.setAttribute("tabindex","0");m.manager.container.focus();m.manager.resize();m.listenTo(m.manager,"onRefresh",m.utils._addCustomCommands.bind(m));m.listenTo(l,"onResize",function(){m.manager.resize()});m.listenTo(m.manager,"onUpdate",function(s){var t=[],q={};var r=Object.keys(s.objects);for(var p=0;p<r.length;p++){t.push([s.objects[r[p]].physicalId]);q[s.objects[r[p]].physicalId]={id:s.objects[r[p]].physicalId,type:s.objects[r[p]].type||"Issue",modifiedAttributes:["attachments"]}}f.get("eventsHandler").publish(m._subscriberId,"DS/Object/update",{metadata:{appId:f.get("widget").id,appName:f.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:t,attributes:q},version:"1.0"})});m._eventListeners=[{event:"DS/Object/update",listener:function(q){if(m.manager&&m.manager.id){var r=q.data.paths;var p=r.some(function(s){return(m.manager.id===s[0])});if(p){m.manager.refresh()}}},conditions:{type:"issue",attributes:["attachments"]}}];for(var o=0;o<m._eventListeners.length;o++){var n=m._eventListeners[o];n.token=f.get("eventsHandler").subscribe(m._subscriberId,n.event,n.listener.bind(m),n.conditions)}m._deferred.resolve();m.dispatchEvent("onReady",{})});e.end(m.name+" render");return m},refresh:function(m){var l=this;l.setOption("physicalIds",m);l.isLoaded=new j(function(o,n){l._deferred.resolve=o;l._deferred.reject=n});if(l.isValidSelection()===false){l.target.hide();l.placeholder.show(l.container);setTimeout(function(){l._deferred.resolve();l.dispatchEvent("onReady",{})},0);return l.isLoaded}else{l.placeholder.hide(l.container);l.target.show()}l.options.physicalIds=m;l.manager.refresh(l.options.physicalIds[l.options.physicalIds.length-1]).then(function(){l._deferred.resolve()});return l.isLoaded},resize:function(){var l=this;l.manager.resize()},destroy:function(){var n=this;var m=f.get("component");n.stopListening(m,"onResize");n.stopListening(n.manager,"onUpdate");n.stopListening(n.manager,"onRefresh");if(Array.isArray(n._eventListeners)){for(var o=0;o<n._eventListeners.length;o++){var l=n._eventListeners[o];f.get("eventsHandler").unsubscribe(l.token)}}n._eventListeners=[];n._subcriberId="";if(n.manager!==null){n.manager.destroy();n.manager=null}n.destroy()},isValidSelection:function(){var l=this;var m=l.getOption("physicalIds");return Array.isArray(m)&&m.length===1},placeholder:{_view:new g(),show:function(l){var m=this;m._view.render("attachments").inject(l);m._view.show()},hide:function(){var l=this;l._view.hide();l._view.empty()}},utils:{_addCustomCommands:function(){var n=this;var m=function(){a.getCommand("AttachmentManager").begin({authoring:n.manager.authoring})};n.manager.views.header.iconBar.addItem({id:"hold-issue-divider",className:"divider btn-hidden"});n.manager.views.header.iconBar.addItem({id:"popup",fonticon:"popup",text:k.attachments.popup,selectable:true,handler:m});if(this.manager&&this.manager.contextualMenu&&this.manager.contextualMenu.customCommands){var l=this.manager.contextualMenu.customCommands.some(function(o){return o.name==="popup"});if(!l){this.manager.contextualMenu.customCommands.push({name:"popup",title:k.attachments.popup,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-popup"},data:null,action:{callback:m}})}}}}})});define("DS/IssueManagement/components/header/InlineCreate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,m,h,n,l,s,p,r,q,c,b,i,f,j,a,d,g){var k={ONE_WEEK:7,ENTER_KEY:13,ESCAPE_KEY:27,ARROW_DOWN_KEY:40,ARROW_UP_KEY:38,ISSUE_FROM_BLANK:"IFB",ISSUE_FROM_TEMPLATE:"IFT",ISSUE_FROM_RECENT_TEMPLATE:"IFRT",ISSUE_FROM_RECENT_TEMPLATE_HEADER:"RECENT_TEMPLATES_HEADER",ISSUE_LOADING_TEMPLATES_PLACEHOLDER:"LOADING_TEMPLATES_PLACEHOLDER",SIMILAR_ISSUES:"SIMILAR_ISSUES",ENABLE_VALIDATION_WAITING_ON:"Analyst",TIMEOUT_FOR_LOST_FOCUS:250,ANIMATION_TIME:100,FIRST_MENU:0,SEARCH_DEBOUNCE_TIMEOUT:1000};var o=m.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"create-container",_logger:null,domEvents:{"keyup input.create-input":"_onKeyUp","click .cancel-create":"_onCancel","click .validate-create":"_onValidate"},input:null,dropdown:null,icons:null,cancel:null,validate:{button:null,tooltip:null},_onCreating:false,_similarities:{issues:[],search:null},setup:function(t){var u=this;d.start(u.name+" setup");u._parent(t);u._logger=r.getLogger(u.name);u.input=null;u.dropdown=null;u.icons=null;u.cancel=null;u.validate={button:null,tooltip:null};u._subscriberId=Math.random().toString(36).substr(2,9);u._onCreating=false;u._similarities={issues:[],search:c.debounce(u._searchSimilarIssues.bind(u),k.SEARCH_DEBOUNCE_TIMEOUT)};d.end(u.name+" setup")},render:function(){var u=this;d.start(u.name+" render");u.input=new n({className:"create-input",placeholder:g.actions.create.placeholder});u.dropdown=new l({className:"im-inline-create-dropdown",target:u.input.elements.container,bound:false,closeOnClick:false,items:[{id:k.ISSUE_FROM_BLANK,text:g.actions.create.issue.blank,fonticon:"issue"},{id:k.ISSUE_FROM_TEMPLATE,text:g.actions.create.issue.template,fonticon:"newspaper"},{id:k.ISSUE_FROM_RECENT_TEMPLATE_HEADER,text:g.actions.create.issue.recentTemplate,className:"im-inline-create-recent-template-header"},{id:k.ISSUE_LOADING_TEMPLATES_PLACEHOLDER,text:" "}],events:{onShow:function(){var w=u.input.elements.container.offsetWidth;u.dropdown.elements.container.setStyle("width",w);var v=u.dropdown.getItem(k.ISSUE_LOADING_TEMPLATES_PLACEHOLDER);c.Mask.mask(v.elements.container);require(["DS/IssueComponents/templates/Templates","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(y,z){var x=new y(i.get("widget"),{editMode:true,onClose:function(){},onEnd:function(){}});x.getAndFetchTemplates().then(function(D){if(u.dropdown!==null){u.dropdown.removeItem(k.ISSUE_LOADING_TEMPLATES_PLACEHOLDER);if(D.length===0){u.dropdown.addItem({id:"empty",text:z.templates.treeList.placeholder,title:z.templates.treeList.placeholder,data:null,fonticon:"clock",disabled:true});return null}var B=D.sort(function(F,E){var H=Number.isInteger(F.info.lastUsed)?F.info.lastUsed:0;var G=Number.isInteger(E.info.lastUsed)?E.info.lastUsed:0;return(G-H)});var A=Math.min(B.length,3);for(var C=0;C<A;C++){u.dropdown.addItem({id:k.ISSUE_FROM_RECENT_TEMPLATE+":::"+B[C].id,text:c.getTextFromHTML(B[C].info.name),title:c.getTextFromHTML(B[C].info.name),data:B[C],fonticon:"clock"})}return B}return null},function(A){u._logger.error("Could not fetch the templates: %o",A);u.dropdown.removeItem(k.ISSUE_LOADING_TEMPLATES_PLACEHOLDER);u.dropdown.addItem({id:"empty",text:z.templates.errors.get,title:z.templates.errors.get,data:null,fonticon:"attention ",disabled:true})})["finally"](function(){x.destroy();x=null;if(h.is(u.dropdown,"object")){u.dropdown.removeItem(k.SIMILAR_ISSUES);if(u._similarities.issues.length){u.dropdown.addItem({id:k.SIMILAR_ISSUES,text:g.replace(g.actions.create.issue.similarIssues,{count:u._similarities.issues.length}),title:g.replace(g.actions.create.issue.similarIssues,{count:u._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"})}}})})},onClick:function(x,v){var A=b.getCommand("Create");var z=u.input.getValue().trim();if(z.length>0){A.autoFillData={title:z}}else{A.autoFillData=null}var w=true;switch(v.id){case k.ISSUE_FROM_BLANK:A.mode=k.ISSUE_FROM_BLANK;A.begin();break;case k.ISSUE_FROM_TEMPLATE:A.mode=k.ISSUE_FROM_TEMPLATE;A.begin();break;case k.SIMILAR_ISSUES:w=false;var y=c.computeSharedIssuesURL(u._similarities.issues.map(function(B){return B.physicalId}));window.open(y,"_blank");break;case k.ISSUE_LOADING_TEMPLATES_PLACEHOLDER:case k.ISSUE_FROM_RECENT_TEMPLATE_HEADER:return;default:if(v.id.indexOf(k.ISSUE_FROM_RECENT_TEMPLATE)===0){A.mode=k.ISSUE_FROM_TEMPLATE;A.template=v.data;A.begin();break}break}if(w){u._onCancel()}}}});var t=null;u.icons=h.createElement("div",{"class":"icons-create",html:[t=h.createElement("div",{"class":"cancel-create fonticon fonticon-cancel-circled"})]});t.setAttribute("style","font-size: 18px !important");u.input.inject(u.container);u.icons.inject(u.container);u.cancel=new p({position:"bottom",target:t,body:g.actions.create.cancel});d.end(u.name+" render");return u},destroy:function(){var t=this;t.dropdown.destroy();t.dropdown=null;t.input.destroy();t.input=null;t.icons=null;t.cancel.destroy();t.cancel=null;if(t.validate.button!==null){t.validate.button.destroy();t.validate.tooltip.destroy();t.validate={button:null,tooltip:null}}t._onCreating=false;t._similarities={issues:[],search:null};t.container.destroy()},focus:function(){var t=this;if(!t.dropdown||!t.input){return}t.dropdown.show();t.input.focus();var u=function(){setTimeout(function(){if(t.input&&t.input.getValue().trim()!==""){return}if(h.is(t.dropdown)&&Array.isArray(t.dropdown.menus)&&t.dropdown.menus.length>0&&document.activeElement===t.dropdown.menus[k.FIRST_MENU].elements.wrapper){return}t.input.elements.container.removeEventListener("focusout",u);setTimeout(function(){t._onCancel()},k.TIMEOUT_FOR_LOST_FOCUS)},k.ANIMATION_TIME/10)};t.input.elements.container.addEventListener("focusout",u)},_onKeyUp:function(v){var u=this;if(u._onCreating===true){return}if(v.keyCode===k.ESCAPE_KEY&&document.activeElement===v.target&&(v.target===u.input.elements.container)){u._onCancel();return}if(v.keyCode===k.ARROW_DOWN_KEY&&document.activeElement===v.target&&v.target===u.input.elements.container){u.dropdown.menus[k.FIRST_MENU].focusIt();var t=document.createEvent("Events");t.initEvent("keydown",true,true);t.which=40;u.dropdown.menus[k.FIRST_MENU].elements.container.dispatchEvent(t);return}var w=function(){if(u.validate.button instanceof HTMLElement){u.validate.button.destroy();u.validate.tooltip.destroy();u.validate={button:null,tooltip:null}}};var x=u.input.getValue().trim();if(document.activeElement===v.target&&v.target===u.input.elements.container){if(x.length>0){if(u.validate.button===null){u.validate.button=h.createElement("div",{"class":"validate-create fonticon fonticon-check"});u.validate.button.inject(u.icons);u.validate.button.setAttribute("style","font-size: 18px !important");u.validate.tooltip=new p({position:"bottom",target:u.validate.button,body:g.actions.create.title})}if(h.is(u._similarities.search,"function")){u._similarities.search()}}else{w()}}if(v.keyCode===k.ENTER_KEY&&document.activeElement===v.target&&v.target===u.input.elements.container){if(x.length===0){u.input.elements.container.addClassName("has-error");u.input.setValue("");return}u._onCreating=true;u._onValidate({doNotClose:true}).then(function(){w()})["finally"](function(){u._onCreating=false})}},_onValidate:function(v){var x=this;var A=i.get("widget");s.mask(A.body);x.input.elements.container.removeClassName("has-error");var u=new Date(),z=new Date(u.getFullYear(),u.getMonth(),u.getDate()+k.ONE_WEEK);var w={title:x.input.getValue(),resolutionDate:(z.getMonth()+1)+"/"+z.getDate()+"/"+z.getFullYear(),estimatedStartDate:(u.getMonth()+1)+"/"+u.getDate()+"/"+u.getFullYear(),estimatedEndDate:(z.getMonth()+1)+"/"+z.getDate()+"/"+z.getFullYear(),responsibleOrganization:j.getCurrentCredentials().organization,reportingOrganization:j.getCurrentCredentials().organization};var t=false;if(h.is(A.getPreference("validation"),"object")){var y=A.getValue("validation");t=h.is(y,"boolean")?y:y==="true"}if(t===true){w.waitingOn=k.ENABLE_VALIDATION_WAITING_ON}return f.issues.create({data:w}).then(function(C){var E=C.body;q.displayNotification({msg:g.actions.create.success,eventID:"success"});s.unmask(A.body);var F=i.get("eventsHandler");var G=[],B={};G.push([E.physicalId]);B[E.physicalId]={id:E.physicalId,type:"Issue"};var D={metadata:{appId:A.id,appName:A.name,timestamp:Math.floor(Date.now())},data:{paths:G,attributes:B},version:"1.0"};F.publish(x._subscriberId,"DS/Object/create",D);setTimeout(function(){x.input.setValue("");if(v&&v.doNotClose!==true){x._onCancel()}},0)})["catch"](function(){s.unmask(A.body);q.displayNotification({msg:g.actions.create.failure,eventID:"error"})})},_onCancel:function(){var t=this;if(t.input===null){return}t.input.setValue("");b.getCommandCheckHeader("InlineCreate").setState(false,false)},_searchSimilarIssues:function(){var t=this;if(h.is(t.input)&&h.is(t.dropdown)){var u=t.input.getValue().trim();if(u.length>0){f.search({data:{query:"([ds6w:type]:Issue) "+u,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then(function(v){if(Array.isArray(v.body.results)){t._similarities.issues=v.body.results.map(function(w){return a.parseFetchResponse(w).value})}else{t._similarities.issues=[]}t.dropdown.removeItem(k.SIMILAR_ISSUES);if(t._similarities.issues.length>0){t.dropdown.addItem({id:k.SIMILAR_ISSUES,text:g.replace(g.actions.create.issue.similarIssues,{count:t._similarities.issues.length}),title:g.replace(g.actions.create.issue.similarIssues,{count:t._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"})}})}else{t._similarities.issues=[];t.dropdown.removeItem(k.SIMILAR_ISSUES)}}}});return o});define("DS/IssueManagement/export/ExportPPTX",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(g,e,f,c,d,b,i){var a="DS/IssueManagement/export/ExportPPTX";var h={exportation:function(){var l=this;b.start(a+" exportation");var k=c.get("component"),j=c.get("status");return new g(function(o,n){var m=k.getSelectedNodes();if(m.length===0){m=k.getTreeDocument().getRoots(false);if(m.length===0){f.notifications.nothing();n(new Error("Nothing to export as PPTX"))}f.confirmation({title:i["export"].pptx.title,content:i.replace(i["export"].pptx.content,{number:m.length})}).then(function(p){p===true?o(m):n(new Error("Export PPTX canceled by user"))})}else{o(m)}}).then(function(m){f.notifications.exporting();j.loading.start();j.loading.update(i["export"].pptx.exporting);var o=[];for(var n=0;n<m.length;n++){o.push({physicalId:m[n].options.physicalId})}return d["export"].pptx({data:{objects:o}}).then(function(p){l.utils.saveByteArray(p,i["export"].pptx.name+(new Date()).toString().split(" ").splice(1,4).join(" ")+".pptx");j.loading.stop(i["export"].pptx.done)},function(p){var r=new TextDecoder("utf-8");var q=JSON.parse(r.decode(p));f.notifications.failure(q.error.message);j.loading.stop(i["export"].pptx.failure)})["finally"](function(){b.end(a+" exportation")})})},utils:{saveByteArray:function(n,m){var j=e.createElement("a");document.body.appendChild(j);j.style="display: none";var k=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}),l=window.URL.createObjectURL(k);j.href=l;j.download=m;j.click();setTimeout(function(){document.body.removeChild(j);window.URL.revokeObjectURL(l)},0)}}};return h});define("DS/IssueManagement/views/facets/History",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/routes/Routes","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueTimeline/IssueTimeline","css!DS/IssueCommon/IssueCommon.css"],function(f,g,h,b,c,a,d,e){return g.extend({name:"DS/IssueManagement/views/facets/History",tagName:"div",className:"history-view fade-in-element",defaultOptions:{physicalIds:[]},timeline:null,_subscriberId:"",_eventListeners:[],setup:function(q){var n=this;d.start(n.name+" setup");n._parent(q);n.target=h.createElement("div",{"class":"history-content"});n.container.setContent(n.target);var j=n.getOption("physicalIds");n.timeline=new e({physicalId:j[j.length-1]});n.routes=new b({physicalId:j[j.length-1]});var m=new f(function(s,r){n.listenTo(n.timeline,"onReady",function(t){s(t)});n.listenTo(n.timeline,"onFailure",function(t){r(t)})});var k=new f(function(s,r){n.listenTo(n.routes,"onReady",function(t){n.container.toggleClassName("history-view-timeline-only",n.routes.isEmpty);s(t)});n.listenTo(n.routes,"onFailure",function(t){r(t)})});f.all([m,k]).then(function(r){n.container.toggleClassName("history-view-wide",n.container.offsetWidth>n.container.offsetHeight*1.4);n.container.toggleClassName("history-view-timeline-only",n.routes===null||n.routes.isEmpty);n.dispatchEvent("onReady",r)})["catch"](function(r){n.dispatchEvent("onFailure",r)});n._subscriberId=Math.random().toString(36).substr(2,9);n._eventListeners=[{event:"DS/Object/update",listener:function l(r){if(n.routes&&n.routes.getOption("physicalId")){var s=r.data.paths.reduce(function(u,t){u.push(t.pop());return u},[]);if(s.indexOf(n.routes.getOption("physicalId"))>-1){n.routes.refresh(n.routes.getOption("physicalId")).then(function(){n.container.toggleClassName("history-view-timeline-only",n.routes===null||n.routes.isEmpty)})}}},conditions:{type:"issue",attributes:["state","assignees"]}},{event:"DS/Object/update",listener:function o(r){if(n.timeline&&n.timeline.getOption("physicalId")){var s=r.data.paths.reduce(function(u,t){u.push(t.pop());return u},[]);if(s.indexOf(n.timeline.getOption("physicalId"))>-1){n.timeline.refresh(n.timeline.getOption("physicalId"))}}},conditions:{type:"issue"}}];for(var p=0;p<n._eventListeners.length;p++){var i=n._eventListeners[p];i.token=a.get("eventsHandler").subscribe(n._subscriberId,i.event,i.listener.bind(n),i.conditions)}d.end(n.name+" setup")},render:function(){var i=this;if(i.isValidSelection()===false){i.elements.target.hide();i.placeholder.show(i.container)}else{i.placeholder.hide(i.container);i.target.show()}d.start(i.name+" render");i.timeline.render().inject(i.target);i.routes.render().inject(i.target);i.container.toggleClassName("history-view-wide",i.container.offsetWidth>i.container.offsetHeight*1.4);i.container.toggleClassName("history-view-timeline-only",true);d.end(i.name+" render");return i},refresh:function(j){var i=this;i.setOption("physicalIds",j);if(i.isValidSelection()===false){i.target.hide();i.placeholder.show(i.container);setTimeout(function(){i.dispatchEvent("onReady",{})},0);return f.resolve()}else{i.placeholder.hide(i.container);i.target.show()}return f.all([i.timeline.refresh(j[j.length-1]),i.routes.refresh(j[j.length-1])]).then(function(){i.container.toggleClassName("history-view-timeline-only",i.routes===null||i.routes.isEmpty);i.dispatchEvent("onReady",{})})},resize:function(){var i=this;if(i.timeline!==null){i.timeline.resize()}if(i.routes!==null){i.routes.resize()}i.container.toggleClassName("history-view-wide",i.container.offsetWidth>i.container.offsetHeight*1.4)},destroy:function(){var j=this;j.stopListening(j.timeline,"onReady");j.stopListening(j.timeline,"onFailure");if(Array.isArray(j._eventListeners)){for(var k=0;k<j._eventListeners.length;k++){var i=j._eventListeners[k];a.get("eventsHandler").unsubscribe(i.token)}}j._eventListeners=[];j._subcriberId="";j.timeline.destroy();j.timeline=null;j.container.empty()},isValidSelection:function(){var i=this;var j=i.getOption("physicalIds");return Array.isArray(j)&&j.length===1},placeholder:{_view:new c(),show:function(i){var j=this;j._view.render("history").inject(i);j._view.show()},hide:function(){var i=this;i._view.hide();i._view.empty()}}})});define("DS/IssueManagement/components/information/Information",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENO6WPlugins/jQuery","DS/ExternalComponents/jQueryUI","DS/Logger/Logger","DS/IssueManagement/components/information/Content","DS/IssueManagement/components/information/Header","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(i,a,g,m,l,d,f,j,c,b,k){var h={LAYOUTS:{RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},CSS:{ELEMENTS:{INNER:"im-information-inner",NO_SELECTION_PLACEHOLDER:"im-information-no-selection-placeholder",FULLSCREEN_INDICATOR_RESIZING:"im-information-fullscreen-indicator-resizing"},LAYOUTS:{RIGHT:"layout-right",BOTTOM:"layout-bottom",CLOSED:"layout-closed"},DIMENSIONS:{RIGHT_LAYOUT:{DEFAULT_WIDTH:430,MIN_WIDTH:430},BOTTOM_LAYOUT:{DEFAULT_HEIGHT:400,MIN_HEIGHT:400},MINIMUM_REMAINING_HEIGHT:75,MINIMUM_REMAINING_WIDTH:260,MVHAW:260},STATUS:{NO_SELECTION:"no-selection",MULTI_SELECTION:"multi-selection"}}};var e=a.extend({name:"DS/IssueManagement/components/information/Information",tagName:"div",className:"im-information-component",_logger:null,layout:{current:h.LAYOUTS.RIGHT,width:h.CSS.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:h.CSS.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},elements:{inner:null,placeholder:null},physicalIds:[],resizer:null,header:null,content:null,fullscreenWidth:false,_isOpened:false,_subscriberId:"",_subscriberTokens:[],setup:function(o){var p=this;b.start(p.name+" setup");p._parent(o);p._logger=d.getLogger(p.name);var n=p.getPreferences();if(n.current!==h.LAYOUTS.RIGHT&&n.current!==h.LAYOUTS.BOTTOM){n.current=h.LAYOUTS.RIGHT;p.setPreferences({current:n.current})}p._isOpened=n.isOpened||false;p.layout={current:n.current||h.LAYOUTS.RIGHT,isOpened:p.isOpened,width:n.width||h.CSS.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:n.height||h.CSS.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT};p.elements={inner:null,placeholder:null};p.physicalIds=[];p.resizer=null;p._subscriberId=Math.random().toString(36).substr(2,9);p._subscriberTokens=[];p._subscribers();b.end(p.name+" setup")},render:function(){var n=this;b.start(n.name+" render");n.elements.inner=g.createElement("div",{"class":h.CSS.ELEMENTS.INNER});n.elements.inner.inject(n.container);n.elements.placeholder=n.utils.placeholder();n.elements.placeholder.inject(n.elements.inner);n.header=new j();n.header.render().inject(n.elements.inner);n._listenToHeader();n.content=new f();n.content.render().inject(n.elements.inner);n.container.toggleClassName(h.CSS.STATUS.NO_SELECTION,true);n.container.toggleClassName(h.CSS.STATUS.MULTI_SELECTION,false);n._resizable();b.end(n.name+" render");return n},refresh:function(p){var o=this;if(Array.isArray(p)){o.physicalIds=p}o.container.toggleClassName(h.CSS.STATUS.NO_SELECTION,o.physicalIds.length===0);o.container.toggleClassName(h.CSS.STATUS.MULTI_SELECTION,o.physicalIds.length>1);var n=[o.header.refresh(o.physicalIds),o.content.refresh(o.physicalIds,{force:true})];return i.all(n).then(function(){o.dispatchEvent("onRefresh")})},resize:function(){var s=this;var t=c.get("widget");var q=s.container.getParent();if(!s.container||!q){return}if(s.layout.current===h.LAYOUTS.RIGHT){var p=s.container.offsetWidth;var o=q.offsetWidth;if(s.fullscreenWidth===true){s.container.setStyle("width",o)}else{if(t.body.offsetWidth>=h.CSS.DIMENSIONS.MVHAW&&p>(o-h.CSS.DIMENSIONS.MINIMUM_REMAINING_WIDTH)){s.container.setStyle("width",o-h.CSS.DIMENSIONS.MINIMUM_REMAINING_WIDTH)}else{s.container.setStyle("width",s.layout.width)}}}else{if(s.layout.current===h.LAYOUTS.BOTTOM){var n=s.container.offsetHeight;var r=q.offsetHeight;if(t.body.offsetHeight>=h.CSS.DIMENSIONS.MVHAW&&n>(r-h.CSS.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)){s.container.setStyle("height",r-h.CSS.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)}}}s.header.resize();s.content.resize();c.get("component").resize()},destroy:function(){var n=this;n._subscriberTokens.forEach(function(o){c.get("eventsHandler").unsubscribe(o)});n._subscriberTokens=[];n._subscriberId="";n.layout={current:h.LAYOUTS.RIGHT,isOpened:false,width:h.CSS.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:h.CSS.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT};n.elements={inner:null,placeholder:null};n.physicalIds=[];m(n.container).resizable("destroy");n.resizer=null;n.header.destroy();n.header=null;n.content.destroy();n.content=null;n.container.empty()},setLayout:function(o){var n=this;if(o===h.LAYOUTS.RIGHT||o===h.LAYOUTS.BOTTOM){n.layout.current=o;n.setPreferences({current:o});if(n.getPreferences().isOpened){n.open()}}},open:function(q){var p=this;var o=p.container.getParent();o.removeClassName(h.CSS.LAYOUTS.CLOSED);o.removeClassName(h.CSS.LAYOUTS.RIGHT);o.removeClassName(h.CSS.LAYOUTS.BOTTOM);var n=p.getPreferences();if(p.layout.current===h.LAYOUTS.RIGHT){p.layout.width=n.width||h.CSS.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH;p.container.setStyles({width:p.layout.width,height:"100%"});o.addClassName(h.CSS.LAYOUTS.RIGHT)}else{if(p.layout.current===h.LAYOUTS.BOTTOM){p.layout.height=n.height||h.CSS.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT;p.container.setStyles({width:"100%",height:p.layout.height});o.addClassName(h.CSS.LAYOUTS.BOTTOM)}}p._isOpened=true;p.resize();if(q===true){p.setPreferences({isOpened:true})}},close:function(p){var o=this;var n=o.container.getParent();o.container.setStyles({width:0,height:0});n.addClassName(h.CSS.LAYOUTS.CLOSED);n.removeClassName(h.CSS.LAYOUTS.RIGHT);n.removeClassName(h.CSS.LAYOUTS.BOTTOM);o.layout.width=0;o.layout.height=0;o._isOpened=false;c.get("component").resize();if(p===true){o.setPreferences({isOpened:false})}},toggle:function(q,p){var o=this;var n=g.is(q,"boolean")?q:!o.getPreferences().isOpened;if(n===true){o.open(p)}else{o.close(p)}},switchFacet:function(n){var o=this;return o.content.switchFacet(n)},setPreferences:function(n){var o=c.get("widget");if(n&&g.is(n.isOpened,"boolean")){o.setValue("infoIsOpened",n.isOpened)}if(n&&g.is(n.current,"string")){o.setValue("infoLayout",n.current)}if(n&&g.is(n.width,"number")){o.setValue("infoLayoutRightWidth",n.width)}if(n&&g.is(n.height,"number")){o.setValue("infoLayoutBottomHeight",n.height)}},getPreferences:function(){var n=c.get("widget");return{current:g.is(n.getValue("infoLayout"),"string")?n.getValue("infoLayout"):h.LAYOUTS.RIGHT,isOpened:g.is(n.getValue("infoIsOpened"),"boolean")?n.getValue("infoIsOpened"):false,width:n.getValue("infoLayoutRightWidth"),height:n.getValue("infoLayoutBottomHeight")}},getLayout:function(){var n=this;return n.layout},getInformationHeader:function(){var n=this;return n.header},getInformationContent:function(){var n=this;return n.content},isOpened:function(){var n=this;return n._isOpened},_resizable:function(){var n=this;n.resizer=m(n.container).resizable({handles:"n, w",helper:"ui-resizable-helper-information-left",minWidth:h.CSS.DIMENSIONS.RIGHT_LAYOUT.MIN_WIDTH,minHeight:h.CSS.DIMENSIONS.BOTTOM_LAYOUT.MIN_HEIGHT,start:function(q,r){if(n.layout.current===h.LAYOUTS.RIGHT){var s=document.querySelector(".ui-resizable-helper-information-left");if(s){if(!s.getElementsByClassName(h.CSS.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING).length){n.elements.fullscreenIndicator=g.createElement("div",{"class":h.CSS.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING});g.createElement("span",{"class":"fonticon fonticon-2x fonticon-move-to-start"}).inject(n.elements.fullscreenIndicator);n.elements.fullscreenIndicator.inject(s)}}r.helper[r.helper.length-1].setAttribute("class","ui-resizable-helper-information-left");var o=n.container.getParent().offsetWidth;m(n.container).resizable("option","maxWidth",o)}else{if(n.layout.current===h.LAYOUTS.BOTTOM){r.helper[r.helper.length-1].setAttribute("class","ui-resizable-helper-information-top");var p=n.container.getParent().offsetHeight;m(n.container).resizable("option","maxHeight",p-h.CSS.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)}}n.container.getParent().addClassName("information-panel-resizing")},resize:function(o){if(n.layout.current===h.LAYOUTS.RIGHT){n.fullscreenWidth=o.clientX>=0&&o.clientX<=260;var p=document.querySelector("."+h.CSS.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING);if(p){p.toggleClassName("visible",n.fullscreenWidth)}}},stop:function(o,p){n.container.getParent().removeClassName("information-panel-resizing");if(n.layout.current===h.LAYOUTS.RIGHT){n.layout.width=p.size.width;n.setPreferences({width:n.layout.width})}else{if(n.layout.current===h.LAYOUTS.BOTTOM){n.layout.height=p.size.height;n.setPreferences({height:n.layout.height})}}n.resize()}})},_subscribers:function(){var n=this;var o=c.get("eventsHandler");n._subscriberTokens.push(o.subscribe(n._subscriberId,"DS/Object/select",function(q){var r=Object.keys(q.data.attributes);var p=function(){if(r.length!==n.physicalIds.length){return false}for(var s=0;s<r.length;s++){if(n.physicalIds.includes(r[s])===false){return false}}return true};if(p()===false){n.refresh(r)}}));n._subscriberTokens.push(o.subscribe(n._subscriberId,"DS/Object/delete",function(r){var t=Object.keys(r.data.attributes);var s=g.clone(n.physicalIds);for(var q=0;q<t.length;q++){var p=s.indexOf(t[q]);if(p!==-1){s.splice(p,1)}}if(n.physicalIds.length!==s.length){n.refresh(s)}}))},_listenToHeader:function(){var n=this;n.listenTo(n.header,"request:switchFacet",function(o){var p=n.switchFacet(o.facetName);if(g.is(o.callback,"function")){p.then(o.callback)}})},utils:{placeholder:function(){return g.createElement("div",{"class":h.CSS.ELEMENTS.NO_SELECTION_PLACEHOLDER,html:[g.createElement("span",{"class":"fonticon fonticon-5x fonticon-info"}),g.createElement("span",{"class":"no-selection-placeholder-label",html:k.information.views.noSelection})]})}}});return e});define("DS/IssueManagement/export/ExportCSV",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueComponents/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(f,d,g,c,e,b,h){var a="DS/IssueManagement/export/ExportCSV";var i={exportation:function(){var k=this;b.start(a+" exportation");g.notifications.exporting();var j=k.getCSV({type:"string"});var l=h["export"].csv.name+(new Date()).toString().split(" ").splice(1,4).join(" ")+".csv";g.download.csv(j,l,"text/csv;encoding:utf-8");return f.resolve()},getCSV:function(u){var o=this;var p="string";if(u&&d.is(u.type,"string")){switch(u.type){case"string":p="string";break;case"array":p="array";break;default:p="string";break}}b.start(a+" exportation");var q=c.get("component");var k=q.getTreeListView().utils.getOriginalColumns();var m=[];m.push(o.utils.getCSVHeader({columns:k}));var r=q.getTreeDocument().getRoots(false);for(var l=0;l<r.length;l++){m.push(o.utils.getCSVRow({node:r[l],columns:k}))}b.end(a+" exportation");if(p==="array"){return m}else{if(p==="string"){var t=[];for(var n=0;n<m.length;n++){var s=m[n].join(",");t.push(s)}return t.join("\n")}}return m},utils:{getCSVHeader:function(j){b.start(a+" getCSVHeader");var m=[];for(var k=0;k<j.columns.length;k++){if(j.columns[k].dataIndex!=="selection"){var l=j.columns[k].text;m.push(l)}}b.end(a+" getCSVHeader");return m},getCSVRow:function(l){b.start(a+" getCSVRow");var o=[];var G=l.node;for(var J=0;J<l.columns.length;J++){var p=l.columns[J].dataIndex;switch(p){case"selection":break;case"tree":o.push(l.node.getLabel());break;case"ds6w:reportedAgainst":var O=G.options.reportedAgainst,x=[];for(var s=0;s<O.length;s++){x.push(O[s].title+" ("+O[s].name+") "+O[s].type+" "+O[s].revision)}o.push(x.join(" "));break;case"ds6w:resolvedBy":var K=G.options.resolvedBy,C=[];for(var B=0;B<K.length;B++){C.push(K[B].title+" ("+K[B].name+") "+K[B].type+" "+K[B].revision)}o.push(C.join(" "));break;case"ds6w:contexts":var q=G.options.contexts,y=[];for(var u=0;u<q.length;u++){y.push(q[u].title+" ("+q[u].name+") "+q[u].type+" "+q[u].revision)}o.push(y.join(" "));break;case"ds6w:assignees":var L=G.options.assignees,m=[];for(var j=0;j<L.length;j++){m.push(L[j].fullName+" ("+L[j].user+")")}o.push(m.join(" "));break;case"ds6w:coOwners":var r=G.options.coOwners,z=[];for(var w=0;w<r.length;w++){z.push(r[w].fullName+" ("+r[w].user+")")}o.push(z.join(" "));break;case"ds6w:participants":var k=G.options.participants,F=[];for(var D=0;D<k.length;D++){F.push(k[D].fullName+" ("+k[D].user+")")}o.push(F.join(" "));break;case"ds6w:validation":o.push(G.options.validation.toString());break;case"ds6w:description":var H=G.options.description;H=e.getTextFromHTML(H).replace(/"/g,'""');H='"'+H+'"';o.push(H);break;case"ds6w:created":case"ds6w:modified":case"ds6w:actualStartDate":case"ds6w:actualEndDate":var M=p.slice(5);var v={};if(d.is(G.options[M],"string")&&G.options[M].length>0){v[M]=G.options[M];var t=e.getFormattedDate(v,{});o.push('"'+t[M]+'"')}else{o.push("")}break;case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:resolutionDate":var I=p.slice(5);var n={};if(d.is(G.options[I],"string")&&G.options[I].length>0){n[I]=G.options[I];var A=e.getFormattedDate(n,{});o.push('"'+A[I]+'"')}else{o.push("")}break;default:var N=l.columns[J].dataIndex;if(d.is(G.options.grid[N],"string")){var E=G.options.grid[N];E=E.replace(/"/g,'""');E='"'+E+'"';o.push(E)}break}}b.end(a+" getCSVRow");return o}}};return i});define("DS/IssueManagement/export/ExportZIP",["UWA/Core","UWA/Promise","DS/Logger/Logger","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueManagement/export/ExportCSV","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/ExternalComponents/JSZip","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(g,j,d,h,m,i,e,f,c,b,l){var a="DS/IssueManagement/export/ExportZIP";var k={exportation:function(){var r=this;c.start(a+" exportation");var o=e.get("status");var p=[];var n={};var q=new b();return r.getNodes().then(function(s){p=s;i.notifications.exporting();o.loading.start();o.loading.update(l["export"].zip.images);return r.getImages({nodes:p})}).then(function(t){n=t;var s=[];p.forEach(function(v){var u=q.folder(v.options.name);var w=n[v.options.physicalId];if(g.is(w,"object")){s.push(fetch(w.url).then(function(x){if(x.status===200||x.status===0){return j.resolve(x.blob())}else{return j.reject(new Error(x))}}).then(function(x){u.file(l["export"].zip.primary,x)}))}});return j.all(s)}).then(function(){o.loading.update(l["export"].zip.documents);return r.getFiles({nodes:p})}).then(function(t){var s=[];t.forEach(function(w){var v=q.folder(w.name);var u={};u[w.name+"-"+l["export"].zip.primary]=0;w.response.forEach(function(x){if(!g.is(x,"object")||x.errorMessage){return}s.push(fetch(x.downloadUrl).then(function(y){if(y.status===200||y.status===0){return j.resolve(y.blob())}else{return j.reject(new Error(y.statusText))}}).then(function(y){var D=x.fileName,B=v.file(D);if(B!==null){var A=/(?:\.([^.]+))?$/;var C=A.exec(D)[1];if(!g.is(C,"string")){C=""}var z=D.replace(/\.[^/.]+$/,"");u[w.name+"-"+D]+=1;D=z+" ("+u[w.name+"-"+D]+")."+C}if(!Number.isInteger(u[w.name+"-"+D])){u[w.name+"-"+D]=0}v.file(D,y)}))})});return j.all(s).then(function(){o.loading.update(l["export"].zip.zipping);var u=m.getCSV({type:"string"});var v="\uFEFF";q.file(l["export"].csv.name+(new Date()).toString().split(" ").splice(1,4).join(" ")+".csv",v+u);return q.generateAsync({type:"blob"}).then(function(w){o.loading.stop(l["export"].zip.done);var y=document.createElement("a");var x=y.href=URL.createObjectURL(w);y.setAttribute("download",a);document.body.appendChild(y);y.click();setTimeout(function(){document.body.removeChild(y);URL.revokeObjectURL(x)},0)})},function(){i.notifications.failure()})})},getNodes:function(){var n=e.get("component");return new j(function(q,p){var o=n.getSelectedNodes();if(o.length===0){o=n.getTreeDocument().getRoots(false);if(o.length===0){i.notifications.nothing();p(new Error("Nothing to export as ZIP"))}i.confirmation({title:l["export"].zip.title,content:l.replace(l["export"].zip.content,{number:o.length})}).then(function(r){r===true?q(o):p(new Error("Export ZIP canceled by user"))})}else{q(o)}})},getFiles:function(o){var n=o.nodes;var p=[];n.forEach(function(q){p.push(h.getDocumentsFrom(q.options.physicalId).then(function(r){return{response:r,name:q.options.name}}))});return j.all(p).then(function(q){var r=[];q.forEach(function(s){var t=s.response.attachments.reduce(function(v,u){v.push(u.id);return v},[]);r.push(h.downloadDocuments(t).then(function(u){return{response:u,name:s.name}}))});return j.all(r)})},getImages:function(p){var o=p.nodes;var n={};return f.images.retrieve({data:{objects:o.map(function(q){return{physicalId:q.options.physicalId}})}}).then(function(r){for(var s=0;s<r.length;s++){var q=r[s].body;if(g.is(q,"object")&&g.is(q.fileName,"string")&&q.fileName!==""&&g.is(q.url,"string")&&q.url!==""){n[q.physicalId]=q}}return n},function(r){var q=d.getLogger(a);q.error("Cannot fetch the primary images %o",r);return n})}};return k});define("DS/IssueManagement/views/list/TreeList",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Mask","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/IssueCommon/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(g,d,t,i,r,q,e,b,p,a,h,n,j,l,c,f,o){var m={ISSUE_TYPE:"Issue",CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed",STATE_ENUM:{CREATE:1,ASSIGN:2,ACTIVE:3,REVIEW:4,CLOSED:5},LOW_PRIORITY:"Low",MEDIUM_PRIORITY:"Medium",HIGH_PRIORITY:"High",URGENT_PRIORITY:"Urgent",PRIORITY_ENUM:{LOW:1,MEDIUM:2,HIGH:3,URGENT:4},RENDERING_LIMIT_ARRAY:10,TIMEOUT_UPDATE_COLUMN_WITH:250,DS6W:"ds6w:",VIEW_MODES:{COMPACT:"compact",COMFORTABLE:"comfortable",COMPACT_HEIGHT:26,COMFORTABLE_HEIGHT:38}};var s=this;var k=e.extend({name:"DS/IssueManagement/views/list/TreeList",_logger:null,component:null,document:null,settings:{},_predicates:[],_ghost:null,init:function(u){var w=this;c.start(w.name+" init");s=w;w._logger=r.getLogger("DS/IssueManagement/View");w.component=u.component;w.document=null;w.settings=u.settings;w._predicates=[];u.list=g.merge(u.list||{},w.getEventOptions());u.list.columns.forEach(function(x){x.text=w.getHeader(x.dataIndex)});u.list.allowUnsafeHTMLContent=false;w.utils._originalColumns=u.list.columns.slice();u.list.columns=w.preferences.getColumnsPreference(u.list.columns);for(var v=0;v<u.list.columns.length;v++){if(u.list.columns[v].isIndexed===true){w._predicates.push(u.list.columns[v].dataIndex)}}u.list.specificColumns.forEach(function(x){u.list.columns.splice(x.colIndex,0,{width:x.width,maxWidth:x.maxWidth,minWidth:x.minWidth,dataIndex:x.dataIndex,isDraggable:x.isDraggable,isHidden:x.isHidden})});if(w.preferences.getViewModePreference()===m.VIEW_MODES.COMFORTABLE){u.list.defaultCellHeight=m.VIEW_MODES.COMFORTABLE_HEIGHT}else{u.list.defaultCellHeight=m.VIEW_MODES.COMPACT_HEIGHT}w._parent(u.list);w._registerReusableCellContent();w._customizeColumnSorting(u.list.columns);w._customizeColumnRendering(u.list.columns);w._manageKeyboard();w._subscribers();c.end(w.name+" init");return w},load:function(u){var w=this;c.start(w.name+" load");var v=w.getManager();v.loadDocument(u);w.document=u;w.preferences.loadSortPreference();c.end(w.name+" load");return w},destroy:function(){var u=this;u.utils._debounceTimeouts.forEach(function(v){clearTimeout(v)});u.utils._debounceTimeouts=[];u._parent()},modifyColumnRendering:function(v){var u=this;return new d(function(w){setTimeout(function(){c.start(u.name+" modifyColumnRendering");var z=g.is(v,"string")?JSON.parse(v):v,A=u.getManager().getColumnOptions(z.dataIndex);var x=false;if(A!==undefined){var B=A.text;if(z.headerName&&z.headerName!==B){A.text=z.headerName;x=true}A.isHidden=A.isHidden===true;if(z.isHidden!==undefined&&z.isHidden!==A.isHidden){if(A.isHidden){u.getManager().showColumn(A.dataIndex)}else{u.getManager().hideColumn(A.dataIndex)}}if(z.column_color){A.styles=z.column_color;if(!A.styles){A.styles={}}A.styles.color=z.column_color.color.replace(";","");A.styles["background-color"]=z.column_color["background-color"].replace(";","");try{u.rendering.updateColumnStyles(A.dataIndex,A.styles)}catch(y){s._logger.warn("Could not set the column styles because %",y)}}}if(x===true){u.getManager().updateView(true)}c.end(u.name+" modifyColumnRendering");w()},0)})},resetColumnRendering:function(){var u=this;c.start(u.name+" resetColumnRendering");require(["text!DS/IssueManagement/assets/IssueManagement.2D.json"],function(v){var y=JSON.parse(v),x=y.columns;try{u.rendering.resetColumnStyles()}catch(w){s._logger.warn("Could not set the column styles because %",w)}x.forEach(function(z){z.text=u.getHeader(z.dataIndex)});y.specificColumns.forEach(function(z){x.splice(z.colIndex,0,{width:z.width,maxWidth:z.maxWidth,minWidth:z.minWidth,dataIndex:z.dataIndex,isDraggable:z.isDraggable,isHidden:z.isHidden})});u._customizeColumnSorting(x);u._customizeColumnRendering(x);u.loadColumns(x);u.getManager().prepareUpdateView();u.getManager().pushUpdateView(true);u.getManager().updateView(true);c.end(u.name+" resetColumnRendering")})},getEventOptions:function(){var u=this;return{shouldDisplayTooltip:function(x){c.start(u.name+" shouldDisplayTooltip");var y="";if(x.isHeader){switch(x.dataIndex){default:if(typeof x.cellModel.options.value==="string"){y=x.cellModel.options.value}break}}else{switch(x.dataIndex){case"tree":y=x.nodeModel.options.label;break;case"ds6w:reportedAgainst":y=x.nodeModel.options.reportedAgainst.length>0?f.replace(f.tooltips.reportedAgainst,{number:x.nodeModel.options.reportedAgainst.length}):f.tooltips.noReportedAgainst;break;case"ds6w:resolvedBy":y=x.nodeModel.options.resolvedBy.length>0?f.replace(f.tooltips.resolvedBy,{number:x.nodeModel.options.resolvedBy.length}):f.tooltips.noResolvedBy;break;case"ds6w:contexts":y=x.nodeModel.options.contexts.length>0?f.replace(f.tooltips.contexts,{number:x.nodeModel.options.contexts.length}):f.tooltips.noContext;break;case"ds6w:assignees":y=x.nodeModel.options.assignees.reduce(function(C,B){return C+B.fullName+" ("+B.user+"), "},"");if(y.length>0){y=y.trim();y=y.substring(0,y.length-1)}break;case"ds6w:participants":y=x.nodeModel.options.participants.reduce(function(C,B){return C+B.fullName+" ("+B.user+"), "},"");if(y.length>0){y=y.trim();y=y.substring(0,y.length-1)}break;case"ds6w:coOwners":y=x.nodeModel.options.coOwners.reduce(function(C,B){return C+B.fullName+" ("+B.user+"), "},"");if(y.length>0){y=y.trim();y=y.substring(0,y.length-1)}break;case"ds6w:validation":y=x.nodeModel.options.validation.toString();break;case"ds6w:description":y=b.getTextFromHTML(x.nodeModel.options.description);break;case"ds6w:created":case"ds6w:modified":case"ds6w:actualStartDate":case"ds6w:actualEndDate":var A=x.dataIndex.replace(m.DS6W,""),v={};v[A]=x.nodeModel.options[A];y=b.getFormattedDate(v,{})[A];break;case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:resolutionDate":var w=x.dataIndex.replace(m.DS6W,""),z={};z[w]=x.nodeModel.options[w];y=b.getFormattedDate(z,{year:"numeric",month:"numeric",day:"numeric"})[w];break;case"ds6w:isLastRevision":if(x.nodeModel.options.isLastRevision===true){y=f.tooltips.isLastRevision}else{if(x.nodeModel.options.isLastRevision===false){y=f.tooltips.isNotLastRevision}else{y=f.tooltips.noIsLastRevision}}break;default:if(typeof x.cellModel.options.value==="string"){y=x.cellModel.options.value}break}}c.end(u.name+" shouldDisplayTooltip");return{title:x.isHeader===true?"":u.getHeader(x.dataIndex),shortHelp:y}},onDragStartCell:function(y,z){var w=u.document.getSelectedNodes(),x=h.setDroppableData(w);if(!x.hasReportedAgainst){q.displayNotification({msg:f.dnd.nothingToDrag,eventID:"info"});return false}y.dataTransfer.setData(x.type,x.data);var v=z.nodeModel.options;if(u._ghost!==null){u._ghost.destroy();u._ghost=null}u._ghost=g.createElement("div",{"class":"issue-ghost-container",html:[g.createElement("div",{"class":"issue-ghost-panel",html:[g.createElement("img",{"class":"issue-ghost-image",src:z.nodeModel.options.icons[z.nodeModel.options.icons.length-1]}),g.createElement("div",{"class":"issue-ghost-title",html:b.getTextFromHTML(v.title)+" ("+b.getTextFromHTML(v.name)+")"})]}),g.createElement("span",{"class":"issue-ghost-counter",html:w.length})]});u._ghost.setStyle("transform","translate3d(0,0,0)");document.body.appendChild(u._ghost);y.dataTransfer.setDragImage(u._ghost,y.offsetX,y.offsetY);return true},onDragOverCell:function(v,w){v.dataTransfer.dropEffect="copy";v.dataTransfer.effectAllowed="copy";if(w!==undefined){w.dropPosition="middle"}return true},onDropCell:h.events.onDropCell.bind(u),onDropBlank:function(){},onContextualEvent:{callback:function(w){if(w&&w.treeview){var v=w.treeview;if(v.virtualRowID===-1){return n.getContextualMenuHeader(w.treeview.dataIndex)}else{if(v.nodeModel){if(v.nodeModel.isSelected()===false){v.nodeModel.select(true);u.document.prepareBroadcastSelect();u.document.pushBroadcastSelect()}return n.getContextualMenu(v.nodeModel)}}return d.resolve()}else{return d.resolve()}}}}},getHeader:function(u){var w=this;var x=j.get("widget");var y="",v=w.settings.list.columns;if(v&&v["default"]&&v["default"][u]){y=f.columns[v["default"][u]]}else{if(v&&v.custom&&v.custom[u]){y=v.custom[u][x.lang]}else{y=u}}return y},getTreeDocument:function(){var u=this;return u.document},getPredicates:function(){var u=this;return u._predicates},_registerReusableCellContent:function(){var x=this;x.getManager().registerReusableCellContent({id:"biColorCell",buildContent:function(){return g.createElement("div",{"class":"bi-color-cell"})}});x.getManager().registerReusableCellContent({id:"arrayLengthEmpty",buildContent:function(){return g.createElement("div",{"class":"issue-list-cell-related",html:f.list.noRelated})}});for(var w=0;w<m.RENDERING_LIMIT_ARRAY;w++){(function(y){x.getManager().registerReusableCellContent({id:"arrayLengthIs"+y,buildContent:function(){return g.createElement("div",{"class":"issue-list-cell-related",html:f.replace(f.list.hasRelated,{number:y})})}})})(w)}var u=[m.CREATE_STATE,m.ASSIGN_STATE,m.ACTIVE_STATE,m.REVIEW_STATE,m.CLOSED_STATE];for(var v=0;v<u.length;v++){(function(y){var z=u[y].toLowerCase();x.getManager().registerReusableCellContent({id:"state"+u[y],buildContent:function(){return g.createElement("span",{"class":"issue-list-cell-state "+u[y].toLowerCase(),html:g.createElement("span",{"class":"cell-state-content",html:o.maturity[z]})})}})})(v)}x.getManager().registerReusableCellContent({id:"isLastRevision",buildContent:function(){return g.createElement("div",{"class":"is-last-revision wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"})}});x.getManager().registerReusableCellContent({id:"isNotLastRevision",buildContent:function(){return g.createElement("span",{"class":"is-not-last-revision wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-wrong"})}});x.getManager().registerReusableCellContent({id:"validation",buildContent:function(){return g.createElement("div",{"class":"container-validation-none-cell",html:g.createElement("span",{"class":""})})}});x.getManager().registerReusableCellContent({id:"validationloading",buildContent:function(){return g.createElement("div",{"class":"container-loading-ring-cell",html:g.createElement("div",{"class":"loading-ring-cell",html:"<div></div><div></div><div></div><div></div>"})})}});x.getManager().registerReusableCellContent({id:"validationactive",buildContent:function(){return g.createElement("div",{"class":"container-validation-active-cell",html:g.createElement("span",{"class":"fonticon fonticon-route-start"})})}})},_customizeColumnRendering:function(u){var v=this;u.forEach(function(w){var x=w.dataIndex.replace(m.DS6W,"");switch(w.dataIndex){case"biColor":w.onCellRequest=v.rendering.biColor;break;case"tree":w.onCellRequest=v.rendering.title;break;case"ds6w:state":w.onCellRequest=v.rendering.state;break;case"ds6w:validation":w.onCellRequest=v.rendering.validation;break;case"ds6w:priority":w.onCellRequest=v.rendering.priority;break;case"ds6w:assignees":w.onCellRequest=v.rendering.assignees;break;case"ds6w:participants":w.onCellRequest=v.rendering.participants;break;case"ds6w:originator":w.onCellRequest=v.rendering.originator;break;case"ds6w:owner":w.onCellRequest=v.rendering.owner;break;case"ds6w:coOwners":w.onCellRequest=v.rendering.coOwners;break;case"ds6w:reportedAgainst":case"ds6w:resolvedBy":case"ds6w:contexts":w.onCellRequest=v.rendering.array(x);break;case"ds6w:created":case"ds6w:modified":case"ds6w:actualStartDate":case"ds6w:actualEndDate":w.onCellRequest=v.rendering.date(x,{});break;case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:resolutionDate":w.onCellRequest=v.rendering.date(x,{year:"numeric",month:"numeric",day:"numeric"});break;case"ds6w:isLastRevision":w.onCellRequest=v.rendering.isLastRevision;break;default:break}})},_customizeColumnSorting:function(u){var v=this;u.forEach(function(w){var x=w.dataIndex.replace(m.DS6W,"");switch(w.dataIndex){case"tree":w.sortFunction=v.sorting.title;break;case"ds6w:name":w.sortFunction=v.sorting.name(false);break;case"ds6w:description":w.sortFunction=v.sorting.description(false);break;case"ds6w:reportedAgainst":case"ds6w:resolvedBy":case"ds6w:contexts":w.sortFunction=v.sorting.array(x);break;case"ds6w:created":case"ds6w:modified":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:resolutionDate":w.sortFunction=v.sorting.date(x);break;case"ds6w:priority":case"ds6w:state":w.sortFunction=v.sorting.enumeration(x);break;case"ds6w:validation":w.sortFunction=v.sorting.validation(x);break;case"ds6w:assignees":w.sortFunction=v.sorting.assignees;break;case"ds6w:participants":w.sortFunction=v.sorting.participants;break;case"ds6w:originator":w.sortFunction=v.sorting.originator;break;case"ds6w:owner":w.sortFunction=v.sorting.owner;break;case"ds6w:coOwners":w.sortFunction=v.sorting.coOwners;break;default:if(w.custom===true){w.sortFunction=v.sorting.custom(x)}break}})},_manageKeyboard:function(){var v=this;var u=v.getManager();require(["DS/IssueManagement/views/list/Keyboard"],function(x){var y=u.getKeymapManager(),w=u.getCommandRegistry();if(!y||!w){return}y.registerKeymap("return","treelistview:edit-mode");y.registerKeymap("ctrl+a","treelistview:select-all");y.registerKeymap("ctrl+c","treelistview:copy-node");y.registerKeymap("del","treelistview:delete-node");for(var z in x){if(x.hasOwnProperty(z)){w.registerCommand(z,x[z])}}})},_subscribers:function(){var v=this;var u=v.getManager();u.onNodeClick(function(x,w){if(x&&x.isHeader===false&&w!==undefined){v.getTreeDocument().prepareBroadcastSelect();v.getTreeDocument().pushBroadcastSelect()}});v.onNodeClick(function(x,w){if(x&&x.dataIndex==="selection"&&w!==undefined){v.getTreeDocument().prepareBroadcastSelect();v.getTreeDocument().pushBroadcastSelect()}});v.onNodeDblClick(function(){if(a.getCommand("ToggleInformationPanel")){a.getCommand("ToggleInformationPanel").begin({save:true})}});u.onColumnWidthUpdate(v.utils.debounce(function(){v.preferences.savePreferences({columns:true})},m.TIMEOUT_UPDATE_COLUMN_WITH));u.onMoveColumn(function(){v.preferences.savePreferences({columns:true})});u.onSortColumnContent(function(){v.preferences.savePreferences({sort:true})})},rendering:{biColor:function(u){if(u.manager.getColumnOptions("biColor").isHidden===false){if(!u.isHeader){var v=u.cellView.reuseCellContent("biColorCell");v.style["background-color"]=u.nodeModel.options.grid.biColor}}},title:function(x){c.start(s.name+" rendering title");var E=x.cellView,w=x.nodeModel;if(!x.isHeader){if(w.options.type===m.ISSUE_TYPE){E.setLabel(x.nodeModel.getLabel());E.elements.labelContainer.setAttribute("match-search-navigation",x.nodeModel.options.matchSearchNavigation);E.setIcons(x.nodeModel.getIcons());E.setBadges(x.nodeModel.options.badges);E._setExpanderState(x.nodeModel._expandState);E._setDepth(x.nodeModel.getNodeDepth());E.elements.expanderContainer.setAttribute("title",f.list.expandOrCollapse);x.cellView.getContent().setContent(x.cellView.elements.layout)}else{if("relationToIssue" in w.options.data){var y=w.options.data.relationToIssue,F=w.getParent();var u=g.createElement("div",{"class":"issue-list-cell-title"});var z=null,D=null;if(w.options.data.position===1){var v="";switch(y){case"contexts":v="wux-ui-3ds wux-ui-3ds-3d-object";break;case"reportedAgainst":v="wux-ui-3ds wux-ui-3ds-location";break;case"resolvedBy":v="fonticon fonticon-docs";break;case"default":v="wux-ui-3ds wux-ui-3ds-3d-object";break;default:break}z=g.createElement("div",{"class":"issue-list-cell-title-relation-icon "+v,title:f.columns[w.options.data.relationToIssue+"Column"]});if(F&&y in F.options&&F.options[y].length>1){var A=g.createElement("span",{"class":"issue-list-cell-title-relation-number",html:F.options[y].length.toString()});A.inject(z)}D=g.createElement("div",{"class":"issue-list-cell-title-relation-dash"})}else{z=g.createElement("div",{"class":"issue-list-cell-title-relation-icon no-icon",title:f.columns[w.options.data.relationToIssue+"Column"]});D=g.createElement("div",{"class":"issue-list-cell-title-relation-dash no-icon"});if(F.options[y].length===w.options.data.position){z.addClassName("last")}}z.inject(u);D.inject(u);var C=g.createElement("div",{"class":"issue-list-cell-title-type-icon-container"});C.inject(u);w.options.icons.forEach(function(H){var G=g.createElement("div",{"class":"issue-list-cell-title-type-icon",styles:{"background-image":'url("'+H+'")'},title:w.options.grid["ds6w:type"]});G.inject(C)});var B=g.createElement("div",{"class":"issue-list-cell-title-label",html:b.getTextFromHTML(w.options.title),title:b.getTextFromHTML(w.options.title)});B.inject(u);x.cellView.getContent().setContent(u)}}c.end(s.name+" rendering title")}},state:function(u){c.start(s.name+" rendering state");if(!u.isHeader){var w=u.nodeModel.options.state;if(m[w.toUpperCase()+"_STATE"]!==undefined){u.cellView.reuseCellContent("state"+w)}else{var v=u.nodeModel.options.grid["ds6w:state"];if(v&&v!==""){w=v}u.cellView.getContent().setContent(w)}}c.end(s.name+" rendering state")},validation:function(v){if(v.isHeader===true){return}c.start(s.name+" rendering state");var w=v.nodeModel.options.validation;if(w.activated!==true){v.cellView.reuseCellContent("validation")}else{var u=g.createElement("div",{"class":"validation-cell-container"});var C=function(D){var E=g.createElement("div",{"class":"issue-reviewers-image",html:g.createElement("img",{src:l.getUserImage(D)})});E.addEventListener("click",function(){var F=this;p.getUserProfile({user:D,target:F})});return E};if(w.fetched===true){var A=null;switch(w.status){case"inProgress":u.append(g.createElement("div",{"class":"im-routes-cell-status",html:g.createElement("div",{"class":"fonticon fonticon-clock in-progress"})}));break;case"approved":A=g.createElement("div",{"class":"fonticon fonticon-check approved"});case"rejected":A=A?A:g.createElement("div",{"class":"fonticon fonticon-wrong rejected"});u.append(g.createElement("div",{"class":"im-routes-cell-status",html:A}));break;case"notStarted":v.cellView.reuseCellContent("validationactive");return;default:break}var B=g.createElement("div",{"class":"issue-reviewers-list"});var x=v.nodeModel.options.validation.decisions;for(var z=0;z<x.length;z++){var y=x[z].reviewer;if(w.status===x[z].status){C(y.user).inject(B)}}u.append(B);v.cellView.getContent().setContent(u)}else{v.cellView.reuseCellContent("validationloading");s.getDocument().autoFill.validation(v.nodeModel.options.physicalId)}}c.end(s.name+" rendering state")},priority:function(u){c.start(s.name+" rendering priority");if(!u.isHeader){var v=u.nodeModel.options.priority,x="";switch(v){case m.LOW_PRIORITY:x="low wux-ui-3ds wux-ui-3ds-level-low";break;case m.MEDIUM_PRIORITY:x="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case m.HIGH_PRIORITY:x="high wux-ui-3ds wux-ui-3ds-level-high";break;case m.URGENT_PRIORITY:x="urgent wux-ui-3ds wux-ui-3ds-alert ";break;default:break}var w=g.createElement("div",{"class":"issue-list-priority",html:[g.createElement("span",{"class":"issue-list-priority-icon "+x}),o.priorities[v.toLowerCase()]]});u.cellView.getContent().setContent(w)}c.end(s.name+" rendering priority")},assignees:function(u){c.start(s.name+" rendering assignees");if(!u.isHeader){var v=u.nodeModel.options;if(v.assignees&&v.assignees.length){var x=v.assignees.map(function(y){return y.user});var w=p.create({users:x});u.cellView.getContent().setContent(w)}}c.end(s.name+" rendering assignees")},participants:function(u){c.start(s.name+" rendering participants");if(!u.isHeader){var v=u.nodeModel.options;if(v.participants&&v.participants.length){var x=v.participants.map(function(y){return y.user});var w=p.create({users:x});u.cellView.getContent().setContent(w)}}c.end(s.name+" rendering participants")},originator:function(u){c.start(s.name+" rendering originator");if(!u.isHeader){var v=u.nodeModel.options;var w=p.create({users:[v.originator.user]}).addClassName("issue-owner-container");u.cellView.getContent().setContent([w,{"class":"issue-owner-full-name",html:v.originator.fullName}])}c.end(s.name+" rendering originator")},owner:function(u){c.start(s.name+" rendering owner");if(!u.isHeader){var v=u.nodeModel.options;var w=p.create({users:[v.owner.user]}).addClassName("issue-owner-container");u.cellView.getContent().setContent([w,{"class":"issue-owner-full-name",html:v.owner.fullName}])}c.end(s.name+" rendering owner")},coOwners:function(u){c.start(s.name+" rendering coOwners");if(!u.isHeader){var v=u.nodeModel.options;if(v.coOwners&&v.coOwners.length){var x=v.coOwners.map(function(y){return y.user});var w=p.create({users:x});u.cellView.getContent().setContent(w)}}c.end(s.name+" rendering coOwners")},array:function(u){return function(w){c.start(s.name+" rendering array");if(w.isHeader){var A="";switch(u){case"reportedAgainst":A="wux-ui-3ds wux-ui-3ds-location";break;case"resolvedBy":A="fonticon fonticon-docs";break;case"contexts":A="wux-ui-3ds wux-ui-3ds-3d-object";break;default:A="";break}var z=g.createElement("span",{"class":"issue-list-cell-header-icon "+A});z.inject(w.cellView.getContent(),"top")}else{if(w.nodeModel.options.type===m.ISSUE_TYPE){var y=w.nodeModel.options[u],v=u in w.nodeModel.options&&y.length>0;if(v===true){if(y.length<m.RENDERING_LIMIT_ARRAY){w.cellView.reuseCellContent("arrayLengthIs"+y.length)}else{var x=g.createElement("div",{"class":"issue-list-cell-related",html:f.replace(f.list.hasRelated,{number:y.length})});w.cellView.getContent().setContent(x)}}else{w.cellView.reuseCellContent("arrayLengthEmpty")}}}c.end(s.name+" rendering array")}},date:function(v,u){return function(y){c.start(s.name+" rendering date");if(y.isHeader===true){}else{var A=j.get("widget");var D={};D[v]=y.nodeModel.options[v];var x=b.getFormattedDate(D,u)[v];if(v==="resolutionDate"){y.cellView.getContent().removeAttribute("target","overdue");y.cellView.getContent().removeAttribute("target","approaching");var w=new Date(y.nodeModel.options[v]);var C=parseInt(A.getValue("approaching"),10);var B="";var z=Math.ceil(Math.abs(w-new Date())/(1000*60*60*24));B=z<=C&&w>new Date()?"approaching":"";B=B===""&&w<=new Date()?"overdue":B;if(g.is(B,"string")&&B!==""){y.cellView.getContent().setAttribute("target",B);x=g.createElement("div",{"class":"target-approaching-overdue",html:[{"class":B==="approaching"?"fonticon fonticon-clock":"fonticon fonticon-attention"},{html:x}]})}}y.cellView.getContent().setContent(x)}c.end(s.name+" rendering date")}},isLastRevision:function(u){c.start(s.name+" rendering isLastRevision");if(!u.isHeader){if(u.nodeModel.options.isLastRevision===true){u.cellView.reuseCellContent("isLastRevision")}else{if(u.nodeModel.options.isLastRevision===false){u.cellView.reuseCellContent("isNotLastRevision")}else{}}}c.end(s.name+" rendering isLastRevision")},updateColumnStyles:function(x,D){var A=this;var w={};if(D.color!==undefined){w.color=D.color+";"}if(D["background-color"]!==undefined){w["background-color"]=D["background-color"]+";"}var v=[],B=document.styleSheets[0];if(B.cssRules){v=B.cssRules}else{if(B.rules){v=B.rules}}function y(J,G,H){var F=J.length;while(--F){var I=J[F];if(H(G,I)){return{item:I,index:F}}}return null}var u='.issue-list-container .wux-datagrid-cell[data-index="'+x+'"]:not(.wux-datagrid-header)';var z=A._getBrowserSelector(u);var E=y(v,z,function(G,F){return(F.selectorText===G)});if(E!==null){B.deleteRule(E.index)}var C="{}";if(g.is(D,"object")){C=JSON.stringify(w);C=C.replace(/"/g,"");C=C.replace(/,/g,"")}if(C!=="{}"){B.insertRule(z+C,v.length)}},resetColumnStyles:function(){var x=this,w=s.getManager();var u=[],v=document.styleSheets[0];if(v.cssRules){u=v.cssRules}else{if(v.rules){u=v.rules}}w.getColumns().forEach(function(z){function y(H,E,F){var D=H.length;while(--D){var G=H[D];if(F(E,G)){return{item:G,index:D}}}return null}var B='.issue-list-container .wux-datagrid-cell[data-index="'+z.dataIndex+'"]:not(.wux-datagrid-header)';var C=x._getBrowserSelector(B);var A=y(u,C,function(E,D){return(D.selectorText===E)});if(A!==null){v.deleteRule(A.index)}})},_getBrowserSelector:function(v){var x=document.styleSheets,z=x[x.length-1];var w=-1,u=null;try{w=z.insertRule(v+"{}",z.cssRules.length);var y=z.cssRules||z.rules;u=y[w].selectorText}finally{if(w>=0){z.deleteRule(w)}}return u}},sorting:{custom:function(u){return function(z,y){var A=(!(u in z.options.custom)||z.options.custom[u]===null);var x=(!(u in y.options.custom)||y.options.custom[u]===null);if(!A&&!x){var w=z.options.custom[u],v=y.options.custom[u];if(!isNaN(w)&&!isNaN(v)){w=parseFloat(w);v=parseFloat(v);if(w>v){return 1}else{if(w<v){return -1}else{return 0}}}if(w>v){return 1}else{if(w<v){return -1}else{return 0}}}else{if(A&&!x){return -1}else{if(!A&&x){return 1}else{return 0}}}}},title:function(v,u){if(v.options.type!==m.ISSUE_TYPE||u.options.type!==m.ISSUE_TYPE){if(v.options.label<u.options.label){return -1}else{if(v.options.label>u.options.label){return 1}else{return 0}}}else{if(v.options.label<u.options.label){return -1}else{if(v.options.label>u.options.label){return 1}else{return 0}}}},name:function(u){return function(w,v){if(w.options.name<v.options.name){return u?1:-1}else{if(w.options.name>v.options.name){return u?-1:1}else{return 0}}}},description:function(u){return function(y,w){var x=b.getTextFromHTML(y.options.description);var v=b.getTextFromHTML(w.options.description);if(x<v){return u?1:-1}else{if(x>v){return u?-1:1}else{return 0}}}},array:function(u){return function(w,v){return w.options[u].length-v.options[u].length}},date:function(u){return function(A,z){if(A.options[u]&&z.options[u]){var v=A.options[u]<z.options[u]?-1:1;try{var y=new Date(A.options[u]);var w=new Date(z.options[u]);if(y>w){v=1}else{if(y<w){v=-1}else{v=0}}}catch(x){}return v}else{if(!A.options[u]&&z.options[u]){return -1}else{if(!z.options[u]&&A.options[u]){return 1}else{return 0}}}}},enumeration:function(v){var u={};switch(v){case"state":u=m.STATE_ENUM;break;case"priority":u=m.PRIORITY_ENUM;break;default:u=m.STATE_ENUM;break}return function(B,z){var A,y,w=0;try{if(v in B.options&&v in z.options){A=B.options[v].toUpperCase();y=z.options[v].toUpperCase();w=(u[A]-u[y])}}catch(x){}return w}},validation:function(){return function(v,u){if(v.options.validation.status<u.options.validation.status){return -1}else{if(v.options.validation.status>u.options.validation.status){return 1}else{return 0}}}},assignees:function(y,x){var u=0;if("assignees" in y.options&&"assignees" in x.options){var w=y.options.assignees;var v=x.options.assignees;if(w.length>=v.length){u=1}else{u=-1}}return u},participants:function(y,x){var u=0;if("participants" in y.options&&"participants" in x.options){var w=y.options.participants;var v=x.options.participants;if(w.length>=v.length){u=1}else{u=-1}}return u},originator:function(v,u){if(v.options.originator.lastName<u.options.originator.lastName){return -1}else{if(v.options.originator.lastName>u.options.originator.lastName){return 1}else{return 0}}},owner:function(v,u){if(v.options.owner.lastName<u.options.owner.lastName){return -1}else{if(v.options.owner.lastName>u.options.owner.lastName){return 1}else{return 0}}},coOwners:function(y,w){var u=0;if("coOwners" in y.options&&"coOwners" in w.options){var x=y.options.coOwners;var v=w.options.coOwners;if(x.length>=v.length){u=1}else{u=-1}}return u}},preferences:{savePreferences:function(u){var w=s.getManager();var x=j.get("widget");if(u.sort===true){w.getColumns().forEach(function(y){var z=w.getColumnIDFromDataIndex(y.dataIndex);if(w.getColumnOrderState(z)!=="none"){x.setValue("IssueManagementTableSorting",JSON.stringify({columnID:z,order:w.getColumnOrderState(z)}))}})}if(u.columns===true){var v=[];w.getColumns().forEach(function(y){v.push({dataIndex:y.dataIndex,text:y.text,originalText:s.getHeader(y.dataIndex),width:y.width,isHidden:y.isHidden===true,styles:y.styles?y.styles:{}})});x.setValue("IssueManagementTableDefinition",JSON.stringify(v))}if(u.hasOwnProperty("view")){x.setValue("IssueManagementTableView",u.view)}},resetPreferences:function(u){var v=j.get("widget");if(u.sort===true){v.setValue("IssueManagementTableSorting","")}if(u.columns===true){v.setValue("IssueManagementTableDefinition",null)}},loadSortPreference:function(){var y=j.get("widget");c.start(s.name+" preferences loadSortPreference");var x=s.getManager();var u=y.getValue("IssueManagementTableSorting");try{var w=JSON.parse(u);if(!Number.isInteger(w.columnID)||!w.order){throw new Error("The sort preference has an incorrect format")}x.sortColumnContent(w.columnID,{sortOrder:w.order})}catch(v){y.setValue("IssueManagementTableSorting",null)}c.end(s.name+" preferences loadSortPreference")},getColumnsPreference:function(B){var z=j.get("widget");c.start(s.name+" preferences getColumnsPreference");var H=[];try{H=JSON.parse(z.getValue("IssueManagementTableDefinition"));if(!Array.isArray(H)){throw new Error("The columns preference has an incorrect format")}}catch(C){z.setValue("IssueManagementTableDefinition",null);H=[]}var u=B.slice(0),E=H.slice(0);var D=u.reduce(function(J,K){J[K.dataIndex]=K;return J},{}),w=E.reduce(function(J,K){J[K.dataIndex]=K;return J},{});var v=[];var I=Math.max(u.length,E.length);for(var y=0;y<I;y++){var G=E[y],F=G!==undefined?D[G.dataIndex]:undefined;if(F===undefined){}else{F.width=G.width;F.isHidden=G.isHidden;if(F.text!==G.originalText){if(G.originalText===G.text){}else{F.text=G.text}}F.styles=G.styles?G.styles:{};try{s.rendering.updateColumnStyles(G.dataIndex,F.styles)}catch(C){s._logger.warn("Could not set the column styles because %",C)}v.push(F)}}for(var x=0;x<u.length;x++){var A=u[x].dataIndex;if(w[A]===undefined){v.push(u[x])}}c.end(s.name+" preferences getColumnsPreference");return v},getViewModePreference:function(){var w=j.get("widget");c.start(s.name+" preferences getViewModePreference");var u=m.VIEW_MODES.COMPACT;try{u=w.getValue("IssueManagementTableView");if(u!==m.VIEW_MODES.COMPACT&&u!==m.VIEW_MODES.COMFORTABLE){throw new Error("The columns preference has an incorrect format")}}catch(v){w.setValue("IssueManagementTableView",u);u=m.VIEW_MODES.COMPACT}c.end(s.name+" preferences getViewModePreference");return u}},utils:{whereToAddModal:null,_originalColumns:[],_debounceTimeouts:[],getOriginalColumns:function(){var u=this;return u._originalColumns},debounce:function(w,y,u){var v=this;var x;return function(){var D=this,C=arguments;var A=function(){x=null;if(!u){w.apply(D,C)}};var z=u&&!x;clearTimeout(x);var B=v._debounceTimeouts.indexOf(x);if(B!==-1){v._debounceTimeouts.splice(B,1)}x=setTimeout(A,y);v._debounceTimeouts.push(x);if(z){w.apply(D,C)}}}}});return k});define("DS/IssueManagement/models/TreeDocument",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeDocument","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeNodeModel","DS/IssueManagement/utils/ModelParser","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(k,o,f,c,g,b,l,i,e,j,d,q){var m={ISSUE_TYPE:"Issue",EMPTY_SELECTION_TIMEOUT:10,FIRST_ROOT:0,BROADCAST_SELECT_DEBOUNCE_TIMEOUT:100,FETCH_DYNAMIC_ATTRIBUTES_DEBOUNCE_TIMEOUT:100};var p=function(s,u,r){var t;return function(){var y=this,x=arguments;var w=function(){t=null;if(!r){s.apply(y,x)}};var v=r&&!t;clearTimeout(t);t=setTimeout(w,u);if(v){s.apply(y,x)}}};var h=this;var a=g.extend({name:"DS/IssueManagement/models/TreeDocument",_logger:null,component:null,settings:{},_publishSelection:false,init:function(r){var s=this;h=s;s._logger=f.getLogger("DS/IssueManagement/Model");s.component=r.component;s.settings=r.settings;r.list=k.merge(r.document||{},s.getEventOptions());s._parent(r.document);s._publishSelection=false;s._subscribers()},getEventOptions:function(){var r=this;return{shouldAcceptDrag:function(){var w=r.getSelectedNodes(),s=[],v=[];for(var t=0;t<w.length;t++){var x=w[t];if(x.options.type===m.ISSUE_TYPE&&x.options.reportedAgainst.length===0){v.push(x)}else{s.push(x)}}if(s.length>0){for(var u=0;u<v.length;u++){v[u].unselect()}return true}return false},shouldAcceptDrop:function(){return true}}},addRoots:function(s,t){var r=this;if(s.length===0){return o.resolve([])}return new o(function(u){r.withTransactionUpdate(function(){var C=r.component.list;var v=[];for(var A=0;A<s.length;A++){var B=new l(s[A]);if(B.options.reportedAgainst.length===0&&B.options.resolvedBy.length===0&&B.options.contexts.length===0){B.options.children=null;B.setState({state:"noChildren"})}v.push(B)}for(var x=0;x<v.length;x++){r.addRoot(v[x])}var w=e.get("widget").getValue("IssueManagementTableSorting");try{var z=JSON.parse(w);if(!Number.isInteger(z.columnID)||!z.order){throw new Error("The sort preference has an incorrect format")}C.getManager().sortColumnContent(z.columnID,{sortOrder:z.order})}catch(y){r.getRoots().sort(C.sorting.name(true))}if(t===true){setTimeout(function(){var H=C.getManager();if(v.length===1){if(!H.isNodeInVisibleViewport(v[m.FIRST_ROOT])){H.scrollToNode(v[m.FIRST_ROOT],"top",false)}}else{if(v.length>1){var J=v.every(function(L){return !H.isNodeInVisibleViewport(L)});if(J===true){var G=H.getScroller().getPosition().y,K=0;var F=null;for(var D=0;D<v.length;D++){var E=H.getRowPosition(v[D]._getRowID(true));var I=Math.abs(G-E);if(D===0){K=I;F=v[D]}if(I<K){K=I;F=v[D]}}H.scrollToNode(F,"top",false)}}}},0)}r.getModelEvents().publish({event:"onRootsAdded",data:{roots:v}});u(v)})},function(){r._logger.error('An error occurred during "%s"',"addRoots")})},updatePredicates:function(){var t=this;var s=t.component.list.getPredicates();var r=t.getRoots(false);if(s.length===0||r.length===0){return o.resolve()}var u=r.map(function(v){return{physicalId:v.options.physicalId}});return j.fetch({data:{objects:u,predicates:s}}).then(function(v){return new o(function(w){t.withTransactionUpdate(function(){for(var z=0;z<v.body.results.length;z++){var x=v.body.results[z].attributes;var B={};for(var y=0;y<x.length;y++){var A=x[y];if(s.indexOf(A.name)!==-1){B[A.name]=A.value}}r[z].updateOptions({grid:B})}w()})})})},removeRootsById:function(r){var s=this;if(r.length===0){return o.resolve()}return new o(function(t){s.withTransactionUpdate(function(){var u=[];r.forEach(function(w){var v=s.searchRootById(w);if(v!==null){u.push(v);s.removeRoot(v)}});s.getModelEvents().publish({event:"onRootsRemoved",data:{roots:u}});t({roots:u})})})},prepareBroadcastSelect:function(){var r=this;r._publishSelection=true},buildBroadcastSelect:function(){var v=this;d.start(v.name+" buildBroadcastSelect");var w=[],s={};var r=v.getSelectedNodes();for(var t=0;t<r.length;t++){var u=r[t];if(u.options.type===m.ISSUE_TYPE){w.push([u.options.id]);s[u.options.id]={id:u.options.id,type:u.options.type,name:u.options.name,title:u.options.title}}}d.end(v.name+" buildBroadcastSelect");return{paths:w,attributes:s}},pushBroadcastSelect:p(function n(){var r=this;d.start(r.name+" pushBroadcastSelect");var s=r.buildBroadcastSelect();b.select(r.getSelectedNodes());r.component.publishSelect(s);r.component.publishCompass();r._publishSelection=false;d.end(r.name+" pushBroadcastSelect")},m.BROADCAST_SELECT_DEBOUNCE_TIMEOUT),withBroadcastSelect:function(s){var r=this;r.prepareBroadcastSelect();s.then(function(){r.pushBroadcastSelect()},function(){r._publishSelection=false})},refresh:function(){var u=this;var v=e.get("widget");d.start(u.name+" refresh");var x=[];var r=[],s=[];var t=v.getValue("filter");if(u.utils.isJson(t)===true){t=JSON.parse(t)}else{t={}}return j.issues.filter({version:"1.0",data:{filter:t}}).then(function(z){var y=u.getRoots(true).slice(0);return new o(function(A){u.withTransactionUpdate(function(){if(y.length>0){for(var D=0;D<y.length;D++){var B=y[D],C=B.options.physicalId;x.push(C);if(B.isSelected()===true){r.push(C)}if(B.isExpanded()===true){s.push(C)}}u.removeRoots(y)}var E=i.parse(z.body);u.addRoots(E).then(function(){A(E)})})})}).then(function(z){var y=u.getRoots(true).slice(0);return new o(function(A){u.withTransactionUpdate(function(){if(y.length>0){for(var D=0;D<y.length;D++){var B=y[D],C=B.options.physicalId;x.push(C);if(B.isSelected()===true){r.push(C)}if(B.isExpanded()===true){s.push(C)}}u.removeRoots(y)}var E=i.parse(z);u.addRoots(E).then(function(){A()})})})}).then(function(){s.forEach(function(y){var z=u.getNodesById(y);z.forEach(function(A){A.expand()})});r.forEach(function(y){var z=u.getNodesById(y);z.forEach(function(A){A.select()})});c.displayNotification({msg:q.notifications.refresh})})["catch"](function w(y){u._logger.error("Refresh has failed: %o",y);c.displayNotification({msg:q.notifications.serverError,eventID:"error"})})["finally"](function(){d.end(u.name+" refresh")})},addChildren:function(u,r){var t=this;var s=r.results;t.withTransactionUpdate(function(){d.start(t.name+" addChildren");u.sortChildren=function(){return false};var w=[],I=[],E=[];var B=u.options.contexts.reduce(function(K,J){K[J.physicalId]=J;J.isAdded=false;return K},{});var H=u.options.reportedAgainst.reduce(function(K,J){K[J.physicalId]=J;J.isAdded=false;return K},{});var x=u.options.resolvedBy.reduce(function(K,J){K[J.physicalId]=J;J.isAdded=false;return K},{});var G=1,v=1,A=1;for(var z=0;z<s.length;z++){var F=i.parse(s[z],{useIndex:true,predicates:t.component.list.getPredicates()});F.useAsyncPreExpand=false;F.asyncChildren=[];F.children=null;F.label=F.title;F.display=F.title;F.grid.biColor="rgba(0, 0, 0, 0)";if(B[F.physicalId]!==undefined&&!B[F.physicalId].isAdded){B[F.id].isAdded=true;F.grid["ds6w:name"]=B[F.physicalId].name;var C=new l(F);C.setState({state:"noChildren"});C.options.data.relationToIssue="contexts";C.options.data.issue=u.options.physicalId;C.options.data.position=G;w.push(C);G+=1}if(H[F.physicalId]!==undefined&&!H[F.id].isAdded){H[F.physicalId].isAdded=true;F.grid["ds6w:name"]=H[F.physicalId].name;var y=new l(F);y.setState({state:"noChildren"});y.options.data.relationToIssue="reportedAgainst";y.options.data.issue=u.options.physicalId;y.options.data.position=v;I.push(y);v+=1}if(x[F.physicalId]!==undefined&&!x[F.physicalId].isAdded){x[F.physicalId].isAdded=true;F.grid["ds6w:name"]=x[F.physicalId].name;var D=new l(F);D.setState({state:"noChildren"});D.options.data.relationToIssue="resolvedBy";D.options.data.issue=u.options.physicalId;D.options.data.position=A;E.push(D);A+=1}}w.forEach(function(J){u.addChild(J)});I.forEach(function(J){u.addChild(J)});E.forEach(function(J){u.addChild(J)});d.end(t.name+" addChildren")})},addContextsOrReportedAgainstOrResolvedBy:function(r){var t=this;d.start(t.name+" addContextsOrReportedAgainstOrResolvedBy");var v=Object.keys(r);var u=[];for(var s=0;s<v.length;s++){u.push(r[v[s]])}return j.related.update({data:{objects:u}}).then(function(){d.end(t.name+" addContextsOrReportedAgainstOrResolvedBy");var x={paths:[],attributes:{}};for(var w in r){x.paths.push([w]);x.attributes[w]={id:w,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","contexts"]}}e.get("component").publishUpdate(x);return t.refreshNodesById({modified:v})})},removeContextsOrReportedAgainstOrResolvedBy:function(r){var u=this;d.start(u.name+" removeContextsOrReportedAgainstOrResolvedBy");var t=Object.keys(r);var v=[];for(var s=0;s<t.length;s++){v.push(r[t[s]])}return j.related["delete"]({data:{objects:v}}).then(function(){d.end(u.name+" removeContextsOrReportedAgainstOrResolvedBy");var x={paths:[],attributes:{}};for(var w in r){x.paths.push([w]);x.attributes[w]={id:w,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","contexts"]}}e.get("component").publishUpdate(x);return u.refreshNodesById({modified:t})})},refreshNodesById:function(s){var u=this;d.start(u.name+" refreshNodesById");var t=[],r=[],v=[];return new o(function(x,w){if(k.is(s.created)&&k.is(s.created,"array")){s.created.forEach(function(y){if(t.indexOf(y)===-1){t.push(y);v.push(y)}})}if(k.is(s.modified)&&k.is(s.modified,"array")){s.modified.forEach(function(y){if(t.indexOf(y)===-1){t.push(y);r.push(y)}})}if(t.length>0){j.issues.retrieve({timestamp:s.timestamp?s.timestamp:null,data:{objects:t.map(function(y){return{physicalId:y}})},onComplete:function(y){var z=i.parse(y.map(function(A){return A.body}));x(z)},onFailure:function(y){w(y)}})}}).then(function(z){var y=[],x=[];var A=[],w={};z.forEach(function(B){if(v.indexOf(B.id)!==-1){y.push(B)}if(r.indexOf(B.id)!==-1){x.push(B);A.push([B.id]);w[B.id]={id:B.id,type:B.type,name:B.name,title:B.title}}});return u.addRoots(y,true).then(function(B){var C=[];u.withTransactionUpdate(function(){x.forEach(function(D){var E=u.searchRootById(D.id);if(E!==null){i.update(E.options,D);E.updateOptions(D);u.refreshChildrenNodeById(D.id);C.push(E)}})});d.end(u.name+" refreshNodesById");return{created:B,modified:C}})})},refreshChildrenNodeById:function(u){var t=this;var s=t.searchRootById(u);d.start(t.name+" refreshChildrenNodeById");if(s.options.reportedAgainst.length===0&&s.options.resolvedBy.length===0&&s.options.contexts.length===0){s.removeChildren();s.setState({state:"noChildren"})}else{if(s.isExpanded()){s.expand()}else{var r=s.getChildren();if(!Array.isArray(r)||r.length===0){s.addChild(new l())}}}d.end(t.name+" refreshChildrenNodeById")},searchRootById:function(v){var u=this,s=null;d.start(u.name+" searchRootById");var t=u.getRoots();for(var r=0;r<t.length;r++){if(t[r].options.id===v){s=t[r];break}}d.end(u.name+" searchRootById");return s},autoFill:{_physicalIdsForValidation:{},validation:function(r){var s=this;s._physicalIdsForValidation[r]=r;s._autoFillValidation(Object.keys(s._physicalIdsForValidation))},_autoFillValidation:p(function(t){var r=this;var s=t.reduce(function(v,u){v.push({physicalId:u});return v},[]);r._physicalIdsForValidation={};j.routes.retrieve({data:{objects:s}}).then(function(v){var x={};for(var y=0;y<v.length;y++){var z=v[y].body;var u={};if(k.is(z.current.status,"string")){u=k.clone(z.current)}else{if(Array.isArray(z.history)&&z.history.length>0){var A=z.history.sort(function(F,E){var D=0;if(!F.date){D=-1}else{if(!E.date){D=1}else{var H=new Date(F.date);var G=new Date(E.date);D=H-G}}return D*-1});u=k.clone(A[m.FIRST_ROOT])}else{u={status:"notStarted",approveTo:"",decisions:[]}}}x[z.physicalId]={activated:true,fetched:true,status:u.status,approveTo:u.approveTo,decisions:u.decisions}}var C=h.getRoots(false);for(var w=0;w<C.length;w++){var B=C[w];if(x[B.options.physicalId]){B.updateOptions({validation:x[B.options.physicalId]})}}})},m.FETCH_DYNAMIC_ATTRIBUTES_DEBOUNCE_TIMEOUT)},getComponent:function(){var r=this;return r.component},getRoots:function(r){var u=this;var t=u._parent();if(r===true){if(k.is(u._getChildrenFilterInfo,"function")){var v=u._getChildrenFilterInfo();if(v&&k.is(v.childrenBeforeFiltering,"array")){var s=t;t=v.childrenBeforeFiltering.slice(0);s.forEach(function(w){if(t.indexOf(w)<0){t.push(w)}})}}}return t},getNodesById:function(v){var u=this,s=[];d.start(u.name+" getNodesById");var r=u.getRoots(false);for(var t=0;t<r.length;t++){s=s.concat(r[t].getNodesById(v))}d.end(u.name+" getNodesById");return s},getNodesByPath:function(v){var u=this;d.start(u.name+" getNodesByPath");function t(z,A,x,B){if(z.options.id===A[x]){if(x===A.length-1){B.push(z)}else{var y=z.getChildren();if(y&&y.length>0){x+=1;y.forEach(function(C){t(C,A,x,B)})}}}}var w=[];var r=u.getRoots(false);for(var s=0;s<r.length;s++){t(r[s],v,0,w)}d.end(u.name+" getNodesByPath");return w},getReportedAgainstFromSelectedNodes:function(){var u=this;var s=u.getSelectedNodes(),r=[];for(var t=0;t<s.length;t++){var v=s[t];if(v.options.type===m.ISSUE_TYPE){v.options.reportedAgainst.forEach(function(w){r.push(w.physicalId)})}else{r.push(v.options.id)}}return r},getIssuesFromSelectedNodes:function(){var u=this;var r=u.getSelectedNodes(),s=[];for(var t=0;t<r.length;t++){var v=r[t];if(v.options.type===m.ISSUE_TYPE){s.push(v)}}return s},isBIFiltered:function(){var s=this;var r=false;if(k.is(s._getChildrenFilterInfo,"function")){var t=s._getChildrenFilterInfo();if(t&&k.is(t.childrenBeforeFiltering,"array")){r=t.childrenBeforeFiltering.length>0}}return r},_onPreExpand:function(u){var t=this;d.start(t.name+" _onPreExpand");var v=u.data,s=v.nodeModel;var w=function(x,y){if(y===true){t._logger.warn("Expand request has failed: %o",x);c.displayNotification({msg:q.notifications.serverWarning,eventID:"warning"})}else{t._logger.error("Expand request has failed: %o",x);c.displayNotification({msg:q.notifications.serverError,eventID:"error"})}s.options.children=[];u.target.preExpandDone({state:"collapsed"})};s.removeChildren();var r=[];s.options.reportedAgainst.forEach(function(x){r.push(x.physicalId)});s.options.resolvedBy.forEach(function(x){r.push(x.physicalId)});s.options.contexts.forEach(function(x){r.push(x.physicalId)});r=r.sort().filter(function(y,z,x){return !z||y!==x[z-1]});j.fetch({data:{objects:r.map(function(x){return{physicalId:x}}),predicates:t.component.list.getPredicates()}}).then(function(x){var z=x.body;if(z.hasOwnProperty("results")&&z.results.length===r.length){try{t.addChildren(s,{results:z.results});u.target.preExpandDone({state:"expanded"})}catch(y){w(y.toString(),false)}}else{w("Unexpected fetch response (empty or incomplete)",true)}},function(x){w(x,false)})["finally"](function(){d.end(t.name+" _onPreExpand")})},_onPostExpand:function(u){var t=this;d.start(t.name+" _onPostExpand");var w=u.data,s=w.nodeModel;var v=e.get("widget");var r=k.clone(v.getValue("expandedIds"));if(Array.isArray(r)===false){r=[]}if(!r.includes(s.options.physicalId)){r.push(s.options.physicalId)}v.setValue("expandedIds",r);v.dispatchEvent("endEdit");d.end(t.name+" _onPreExpand")},_onPostCollapse:function(v){var u=this;d.start(u.name+" _onPostCollapse");var x=v.data,t=x.nodeModel;var w=e.get("widget");var s=k.clone(w.getValue("expandedIds"));if(Array.isArray(s)===false){s=[]}var r=s.indexOf(t.options.physicalId);if(r!==-1){s.splice(r,1);w.setValue("expandedIds",s);w.dispatchEvent("endEdit")}d.end(u.name+" _onPreCollapse")},_subscribers:function(){var r=this;r.getXSO().onEmpty(function(){r.prepareBroadcastSelect();setTimeout(function(){var s=r.getSelectedNodes();if(s.length===0){r.pushBroadcastSelect()}},m.EMPTY_SELECTION_TIMEOUT)});r.onPreExpand(function(s){r._onPreExpand(s)});r.onPostExpand(function(s){r._onPostExpand(s)});r.onPostCollapse(function(s){r._onPostCollapse(s)})},utils:{isJson:function(s){try{JSON.parse(s)}catch(r){return false}return true}}});return a});define("DS/IssueManagement/views/list/Keyboard",["UWA/Class/Promise","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(h,g,e,a,d){var c="DS/IssueManagement/views/list/Keyboard";var b={ISSUE_TYPE:"Issue"};var f=function(){if(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0){return false}return true};return{"treelistview:go-to-next-node":function(){if(f()===false){return}d.start(c+" go-to-next-node");var k=this;var i=a.get("component").getTreeDocument();var m=i.getSelectedNodes();var j=[];var l=function(n){return new h(function(o){n.onPostExpand(function(){o()});n.expand()})};i.withTransactionUpdate(function(){var n=k.getKeymapManager();for(var o=0;o<m.length;o++){if(!m[o].isExpanded()&&m[o].getChildren()){j.push(l(m[o]))}}if(j.length>0){n.wait()}h.all(j).then(function(){n.listen();var p=k.getActiveNode();if(p){if(!j.length>0){k._goToNode(p,+1)}}})});d.end(c+" go-to-next-node")},"treelistview:go-to-previous-parent-node":function(){if(f()===false){return}d.start(c+" go-to-previous-parent-node");var k=this;var i=a.get("component").getTreeDocument();var m=i.getSelectedNodes();var j=[];var l=function(n){return new h(function(o){n.onPostCollapse(function(){o()});n.collapse()})};i.withTransactionUpdate(function(){var n=k.getKeymapManager();for(var o=0;o<m.length;o++){if(m[o].isExpanded()){j.push(l(m[o]))}}if(j.length>0){n.wait()}h.all(j).then(function(){n.listen();var p=k.getActiveNode();if(p){if(!j.length>0){k._goToNode(p,-1)}}})});d.end(c+" go-to-previous-parent-node")},"treelistview:go-to-previous-visible-node":function(){if(f()===false){return}d.start(c+" go-to-previous-visible-node");var j=this;var k=j.getActiveNode();var i=j.getKeymapManager();function l(o){if(!o){return}var n=o.getPreviousVisibleNode();if(n){if(n.options.type===b.ISSUE_TYPE){i.wait();j._goToNode(o,-1);var m=a.get("component").getTreeDocument();m.prepareBroadcastSelect();m.pushBroadcastSelect()}else{l(n)}}}l(k);d.end(c+" go-to-previous-visible-node")},"treelistview:go-to-next-visible-node":function(){if(f()===false){return}d.start(c+" go-to-next-visible-node");var j=this;var k=j.getActiveNode();var i=j.getKeymapManager();function l(o){if(!o){return}var n=o.getNextVisibleNode();if(n){if(n.options.type===b.ISSUE_TYPE){i.wait();j._goToNode(o,+1);var m=a.get("component").getTreeDocument();m.prepareBroadcastSelect();m.pushBroadcastSelect()}else{l(n)}}}l(k);d.end(c+" go-to-next-visible-node")},"treelistview:edit-mode":function(){if(f()===false){return}d.start(c+" edit-mode");var i=a.get("component").getTreeDocument();var j=i.getSelectedNodes();if(j.length>0){if(e.getCommand("ToggleInformationPanel")){e.getCommand("ToggleInformationPanel").begin({open:true,save:true})}}d.end(c+" edit-mode")},"treelistview:edit-cancel":function(){if(f()===false){return}d.start(c+" edit-cancel");var i=a.get("component").getTreeDocument();i.withTransactionUpdate(function(){i.unselectAll();if(e.getCommand("ToggleInformationPanel")){e.getCommand("ToggleInformationPanel").begin({open:false,save:true})}});d.end(c+" edit-cancel")},"treelistview:select-all":function(){if(f()===false){return}d.start(c+" select-all");e.getCommand("SelectAllIssues").begin();d.end(c+" select-all")},"treelistview:copy-node":function(){if(f()===false){return}d.start(c+" copy-node");var i=a.get("component").getTreeDocument().getSelectedNodes(),j=[];i.forEach(function(k){j.push(k.options.type+" "+k.options.name+" "+k.options.revision)});g.copyTextToClipboard(j.join(", "));d.end(c+" copy-node")},"treelistview:delete-node":function(){if(f()===false){return}d.start(c+" delete-node");var j=a.get("component").getSelectedNodes();if(j.length===0){return}var l=false;for(var k=0;k<j.length;k++){if(j[k].options.type===b.ISSUE_TYPE){l=true}}if(l===true){e.getCommand("Delete").begin()}else{e.getCommand("Detach").begin()}d.end(c+" delete-node")}}});define("DS/IssueManagement/views/kanban/Keyboard",["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/views/list/Keyboard","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(g,d,f,a,c){var b="DS/IssueManagement/views/kanban/Keyboard";var e=function(){if(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0){return false}return true};return{override:function(h){var j=this;var k=j._addShouldWeProcessThisInputTrigger(h);var i=g.extend(k,j.commands);return i},_addShouldWeProcessThisInputTrigger:function(h){c.start(b+" _addShouldWeProcessThisInputTrigger");var i=g.clone(h);for(var j in h){(function(){if(h.hasOwnProperty(j)){var k=h[j];i[j]=function(){if(e()===false){return null}return k.apply(this,arguments)}}}())}c.end(b+" _addShouldWeProcessThisInputTrigger");return i},commands:{rightMove:function(){if(e()===false){return}c.start(b+" right");var i=a.get("component").getKanbanView();if(g.is(i.siblings.right,"object")){i.siblings.right.grid.elements.container.focus();var h=i.siblings.right.getTreeDocument().getRoots(false);if(g.is(h[i.verticalLevelSelector],"object")){h[i.verticalLevelSelector].select()}else{if(h.length>0){h[h.length-1].select()}}}c.end(b+" right")},leftMove:function(){if(e()===false){return}c.start(b+" left");var i=a.get("component").getKanbanView();if(g.is(i.siblings.left,"object")){i.siblings.left.grid.elements.container.focus();var h=i.siblings.left.getTreeDocument().getRoots(false);if(g.is(h[i.verticalLevelSelector],"object")){h[i.verticalLevelSelector].select()}else{if(h.length>0){h[h.length-1].select()}}}c.end(b+" left")},enter:g.clone(f["treelistview:edit-mode"]),escape:g.clone(f["treelistview:edit-cancel"]),copy:g.clone(f["treelistview:copy-node"]),deleteKeyPressed:g.clone(f["treelistview:delete-node"])}}});define("DS/IssueManagement/views/kanban/TileList",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/IssueManagement/views/kanban/Keyboard"],function(d,c,b){var a=c.inherit({_manageKeyboard:function(){var e=this;e._parent();var f=b.override(e.commands);d.extend(e.commands,f)}});return a});define("DS/IssueManagement/views/kanban/Column",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/IssueManagement/views/kanban/TileList","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(c,q,g,x,r,s,i,v,u,l,e,t,a,h,n,j,d,k,b,f,o){var m={ATTRIBUTES_MAPPING:{STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate"},CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed",STATE_VALUES:{Create:0,Assign:1,Active:2,Review:3,Closed:4},LOW_PRIORITY:"Low",MEDIUM_PRIORITY:"Medium",HIGH_PRIORITY:"High",URGENT_PRIORITY:"Urgent",OVERDUE_DUE_DATE:"Overdue",NO_DATE_DUE_DATE:"None",TODAY_DUE_DATE:"Today",TOMORROW_DUE_DATE:"Tomorrow",THIS_WEEK_DUE_DATE:"Week",FUTURE_DUE_DATE:"Future",FIRST_ELEMENT:0,ON_POST_CELL_REQUEST_DEBOUNCE_TIMEOUT:500,SELECT_UNSELECT_DEBOUNCE_TIMEOUT:1,SCROLLER_WIDTH:18};var w={header:function(y){return g.createElement("div",{"class":"column-header",html:[g.createElement("div",{"class":"column-header-label",html:y.title}),g.createElement("div",{"class":"column-header-count",html:"("+y.count+")"})]})},content:function(){return g.createElement("div",{"class":"column-content",html:""})},overlay:function(){return g.createElement("div",{"class":"column-overlay",html:[{tag:"div","class":"column-overlay-label",html:f.kanban.dnd.placeholder},{tag:"span","class":"column-overlay-icon fonticon fonticon-drag-drop"}]})}};var p=q.extend({name:"DS/IssueManagement/views/kanban/Column",tagName:"div",className:"kanban-container-column",_logger:null,defaultOptions:{title:{},defaultImage:e.getWebappsAssetUrl("Issue3DReview","icons/defaultImage.png")},kanban:null,document:null,models:[],grid:null,attributeKeyValue:{key:null,value:null},_dnd:{dragged:false},_cellsAwaitingPostRendering:[],setup:function(y){var B=this;b.start(B.name+" setup");B._parent(y);B._logger=v.getLogger("DS/IssueManagement/View");B.kanban=y.kanban;B.document=new l();B.document._id=B.id;B.document._currentKanbanView=y.attributeKeyValue.key;B.models=[];for(var z=0;z<y.models.length;z++){var C=Object.keys(y.models[z]).reduce(function(D,E){if(E!=="children"){D[E]=y.models[z][E]}return D},{});C.contextualMenu=[{}];B.models.push(C)}var A=B.getEventOptions();A.allowUnsafeHTMLContent=false;B.grid=new s(A);B.setEventOptions(B.grid);B.attributeKeyValue={key:y.attributeKeyValue.key,value:y.attributeKeyValue.value};B._dnd={dragged:false};B._cellsAwaitingPostRendering=[];B._subscribers();b.end(B.name+" setup")},render:function(){var B=this;b.start(B.name+" render");var D=w.header({title:B.getOption("title"),count:B.models.length}),A=w.content();D.inject(B.container);A.inject(B.container);D.addEventListener("drop",function(E){B._onDrop(E)},false);D.addEventListener("dragover",function(E){E.preventDefault()},false);if(B.attributeKeyValue.key===m.ATTRIBUTES_MAPPING.STATE&&B.attributeKeyValue.value===m.CLOSED_STATE){var C=j.get("widget"),z=JSON.parse(C.getValue("filter"));if(z.closed!==true){B.container.addClassName("not-filtered");var y=g.createElement("div",{"class":"not-filtered-warning",html:{tag:"span","class":"fonticon fonticon-attention"}});new r({target:y,body:f.kanban.warning.closed});y.inject(D)}}B.grid.inject(A);w.overlay().inject(B.container);B.load();b.end(B.name+" render");return B},load:function(){var z=this;b.start(z.name+" load");for(var y=0;y<z.models.length;y++){z._populate(z.models[y])}z.document.withTransactionUpdate(function(){for(var A=0;A<z.models.length;A++){var B=z.document.addRoot(z.models[A]);z.kanban._issuesNodesMapping[z.models[A].id].push(B);if(z.models[A].isSelected){B.select()}}z.document.getRoots().sort(function(D,C){if(D.name<C.name){return 1}else{if(D.name>C.name){return -1}else{return 0}}})});z.grid.model=z.document;b.end(z.name+" load")},destroy:function(){var y=this;y._logger=null;y.document=null;y.models=[];y.grid=null;y.attributeKeyValue={key:null,value:null};y._dnd={dragged:false};y._cellsAwaitingPostRendering=[]},getTreeDocument:function(){var y=this;return y.document},getSelectedNodes:function(){var y=this;return y.document.getSelectedNodes()},unselectAll:function(){var y=this;y.document.unselectAll()},getEventOptions:function(){var y=this;return{useDragAndDrop:true,onDragStartCell:function(E){E.stopPropagation();var A=y.kanban.getSelectedNodes();var B={isKanbanView:true,columnKeyValue:{key:y.attributeKeyValue.key,value:y.attributeKeyValue.value},models:A.map(function(F){return F.options})};var D=h.setDroppableData(A,B);E.dataTransfer.setData(D.type,D.data);E.dataTransfer.effectAllowed="move";y._dnd.dragged=true;var z=y.container.getElements(".wux-ui-state-highlighted");if(z!==null){for(var C=0;C<z.length;C++){z[C].getParent().addClassName("kanban-dragged-tile")}}return false},onDropCell:function(z,A){y.utils.clean(y.kanban.container,{dragged:true,hovered:true,placeholder:true});h.events.onDropCell.call(y.kanban,z,A)},onDropBlank:y._onDrop.bind(y),onDragEnterBlank:function(z){z.preventDefault();y.utils.clean(y.kanban.container,{hovered:true,placeholder:true});if(y._dnd.dragged===true){}else{y.container.addClassName("drop-authorized")}},onDragOverCell:function(z,A){z.preventDefault();y.utils.clean(y.kanban.container,{hovered:true,placeholder:true});A.cellView.elements.container.addClassName("kanban-hovered-tile");return true}}},setEventOptions:function(z){var A=this;z.onCellDoubleClick(function(){if(a.getCommand("ToggleInformationPanel")){a.getCommand("ToggleInformationPanel").begin({save:true})}});z.onContextualEvent={callback:function(D){if(D&&D.cellInfos){return new c(function(F){var E=D.cellInfos;if(E.nodeModel.isSelected()===false){A.listenTo(A.kanban,"onSelectAcked",function(){A.stopListening(A.kanban,"onSelectAcked");n.getContextualMenu(E.nodeModel).then(function(G){F(G)})});E.nodeModel.select(true);A.kanban.document.prepareBroadcastSelect();A.kanban.document.pushBroadcastSelect()}else{n.getContextualMenu(E.nodeModel).then(function(G){F(G)})}})}else{return false}}};z.onDragEndCell=function(){A.utils.clean(A.kanban.container,{dragged:true,placeholder:true});A._dnd.dragged=false};z.onStatusbarIconPointerDown=function(G){var E=G.cellInfos,H=G.clickedIconIndex;var J=E?E.cellView:undefined;var K=J?J.contentView:undefined;var D=E?E.cellModel:undefined;if(K&&D&&H>=0&&H<K.statusbarIcons.length){var I=[],L=[];for(var F=0;F<K.statusbarIcons.length;F++){I.push(K.statusbarIcons[F]);L.push(K.statusbarIconsTooltips[F])}A.document.unselectAll();D.select();switch(I[H]){case"attach":a.getCommand("AttachmentManager").begin();break;default:break}}};var y=function(){var E=this;var D=new c(function(G,F){if(E._cellsAwaitingPostRendering.length>0){var H=E._cellsAwaitingPostRendering.map(function(I){return{physicalId:I.nodeModel.options.physicalId}}).filter(function(K,J,I){return I.indexOf(K)===J});d.images.retrieve({data:{objects:H},onComplete:function(I){for(var K=0;K<I.length;K++){var M=I[K].body;if(g.is(M,"object")&&g.is(M.url,"string")&&M.url!==""){var J=E._cellsAwaitingPostRendering[K];var L=J.nodeModel;L.updateOptions({thumbnail:M.url})}}G()},onFailure:function(I){E._logger.error("Cannot retrieve the images: %s",I);F(new Error(I))}})}else{G()}});D["finally"](function(){E._cellsAwaitingPostRendering=[]})};var B=A.kanban.utils.debounce(y.bind(A),m.ON_POST_CELL_REQUEST_DEBOUNCE_TIMEOUT);z.onPostCellRequest(function C(D){var G=D.cellView.elements.container;if(G&&G.getStyle("visibility")!=="hidden"){var F=D.nodeModel,E=D.cellView.contentView;E.setProperties({description:F.options.description||"",subtitle:g.createElement("div",{"class":"sub-label-container",html:[A.utils.getHTMLPriority(F.options.priority),F.options.name,{tag:"span","class":"fonticon fonticon-user"},A.utils.getHTMLOwner(F.options.owner),{tag:"span","class":"fonticon fonticon-users"},A.utils.getHTMLAssignees(F.options.assignees)]})});A._cellsAwaitingPostRendering.push(D);B()}})},_populate:function(y){var z=this;y.thumbnail=z.getOption("defaultImage");y.statusbarIcons=["attach"];y.statusbarIconsTooltips=[f.commands.attachments]},_subscribers:function(){var B=this;var A=function(D){B.dispatchEvent("onSelect",{column:B,node:D,event:"select"})};var C=B.kanban.utils.debounce(A.bind(B),m.SELECT_UNSELECT_DEBOUNCE_TIMEOUT);B.document.getModelEvents().subscribe({event:"select"},C);var y=function(D){B.dispatchEvent("onSelect",{column:B,node:D,event:"unselect"})};var z=B.kanban.utils.debounce(y.bind(B),m.SELECT_UNSELECT_DEBOUNCE_TIMEOUT);B.document.getModelEvents().subscribe({event:"unselect"},z);B.grid.addEventListener(i.POINTERDOWN,function(J,E){var I=B.grid;if(I.selectionBehavior.unselectAllOnEmptyArea===true&&(!E||!E.cellView)){var H=I.getViewportDimensions(),K=I.layout.getContentDimensions();var G=0;if(J.target===I.elements.scroller.getContent()){if(I.layout.direction==="vertical"){G=H.height<K.height?m.SCROLLER_WIDTH:0}else{if(I.layout.direction==="horizontal"){G=H.width<K.width?m.SCROLLER_WIDTH:0}}}var F=Math.max(K.width,H.width-G);var D=Math.max(K.height,H.height-G);if(J.offsetX<F&&J.offsetY<D){B.dispatchEvent("onUnselectAll",{column:B})}}},false)},_onDrop:function(C){var B=this;C.preventDefault();C.stopPropagation();var D=null;B.utils.clean(B.kanban.container,{dragged:true,hovered:true,placeholder:true});try{D=h.getDroppableData(C)}catch(A){u.displayNotification({msg:f.dnd.notSupported,eventID:"info"});return false}if(D&&D.data){if(D.widgetId===j.get("widget").id&&D.data.options&&D.data.options.isKanbanView){var z=D.data.issues,y=D.data.options.models;var E=null;if(B.attributeKeyValue.key===D.data.options.columnKeyValue.key&&B.attributeKeyValue.value===D.data.options.columnKeyValue.value){return true}x.mask(B.kanban.container);if(B.attributeKeyValue.key==="state"){E=B._onDropUpdateState(y,D.data.options.columnKeyValue.value)}else{E=B._onDropUpdateIssues(y)}E.then(function(G){if(G!==false){var H={paths:[],attributes:{}};for(var F=0;F<z.length;F++){H.paths.push([z[F].id]);H.attributes[z[F].id]={id:z[F].id,name:z[F].name,title:z[F].title,type:z[F].type,modifiedAttributes:["state"]}}j.get("component").publishUpdate(H);return B.kanban.document.refreshNodesById({modified:z.map(function(I){return I.id}),timestamp:Math.floor(Date.now())})}else{return c.resolve()}})["catch"](function(F){B._logger.error(F)})["finally"](function(){x.unmask(B.kanban.container)})}else{u.displayNotification({msg:f.dnd.notSupported,eventID:"info"})}}return true},_onDropUpdateState:function(C,E){var D=this;var A=C.every(function(H){return H.state===C[m.FIRST_ELEMENT].state});if(!A){u.displayNotification({msg:f.kanban.dnd.notAllSameStatePromote,eventID:"error"});return c.reject(new Error("Not supported dnd, all issues must be in the same state"))}var z=function(H){var I=f.notifications.serverError;if(H&&H.error&&g.is(H.error.message,"string")){I=H.error.message}u.displayNotification({msg:I,eventID:"error"});D._logger.error(H)};var B=-1;if(D.attributeKeyValue.value===m.CLOSED_STATE){B=0}else{B=m.STATE_VALUES[D.attributeKeyValue.value]-m.STATE_VALUES[E]}switch(B){case 0:var G=C.map(function(H){return{physicalId:H.physicalId,resolutionStatement:H.resolutionStatement}});return d.issues.close({data:{objects:G}})["catch"](function(H){z(H)});case 1:var F=C.map(function(H){return{physicalId:H.physicalId,state:D.attributeKeyValue.value}});return d.issues.promote({data:{objects:F}})["catch"](function(H){z(H)});case -1:var y=C.map(function(H){return{physicalId:H.physicalId,state:D.attributeKeyValue.value}});return d.issues.demote({data:{objects:y}})["catch"](function(H){z(H)});default:u.displayNotification({msg:f.replace((B>0)?f.kanban.dnd.unsupportedPromote:f.kanban.dnd.unsupportedDemote,{currState:E,state:D.attributeKeyValue.value}),eventID:"error"});return c.reject(new Error("Unexpected dropped data, cannot update state of issue(s)"))}},_onDropUpdateIssues:function(B){var D=this;var F=B.filter(function(G){return G.state!==m.CLOSED_STATE});if(F.length!==B.length){u.displayNotification({msg:f.kanban.dnd.cannotEditClosedIssues,eventID:"warning"})}if(F.length>0){var E="";if(D.attributeKeyValue.key===m.ATTRIBUTES_MAPPING.DUE_DATE){if(D.attributeKeyValue.value===m.NO_DATE_DUE_DATE){E=""}else{var z=new Date();z.setHours(0,0,0,0);var C=new Date(z);C.setDate(C.getDate()-C.getDay()+8);var A=new Date(z);switch(D.attributeKeyValue.value){case m.OVERDUE_DUE_DATE:A.setDate(z.getDate()-1);break;case m.TODAY_DUE_DATE:break;case m.TOMORROW_DUE_DATE:A.setDate(z.getDate()+1);break;case m.THIS_WEEK_DUE_DATE:A.setDate(z.getDate()+2);if((A-C)>=0){A.setDate(z.getDate()+1);if((A-C)>=0){A.setDate(z.getDate()-z.getDay())}}break;case m.FUTURE_DUE_DATE:A.setDate(z.getDate()+30);break;default:break}E=(A.getMonth()+1)+"/"+A.getDate()+"/"+A.getFullYear()}}else{E=D.attributeKeyValue.value}var y=F.map(function(G){var H={physicalId:G.physicalId};H[D.attributeKeyValue.key]=E;return H});return d.issues.update({data:{objects:y}})["catch"](function(G){u.displayNotification({msg:f.notifications.serverError,eventID:"error"});D._logger(G)})}else{return c.resolve(false)}},utils:{whereToAddModal:null,getHTMLPriority:function(y){var z="";switch(y){case m.LOW_PRIORITY:z="low wux-ui-3ds wux-ui-3ds-level-low";break;case m.MEDIUM_PRIORITY:z="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case m.HIGH_PRIORITY:z="high wux-ui-3ds wux-ui-3ds-level-high";break;case m.URGENT_PRIORITY:z="urgent wux-ui-3ds wux-ui-3ds-alert ";break;default:break}return g.createElement("div",{"class":"issue-list-priority",html:[g.createElement("span",{"class":"issue-list-priority-icon "+z,title:o.priorities[y.toLowerCase()]})]})},getHTMLOwner:function(y){return t.create({users:[y.user]})},getHTMLAssignees:function(y){var z=y.map(function(A){return A.user});return t.create({users:z})},clean:function(z,B){if(B.dragged===true){var A=z.getElements(".kanban-dragged-tile");for(var C=0;C<A.length;C++){A[C].getParent().removeClassName("kanban-dragged-tile")}}if(B.hovered===true){var E=z.getElements(".kanban-hovered-tile");for(var y=0;y<E.length;y++){E[y].removeClassName("kanban-hovered-tile")}}if(B.placeholder===true){var D=z.getElement(".drop-authorized");if(D!==null){D.removeClassName("drop-authorized")}}}}});return p});define("DS/IssueManagement/views/kanban/Kanban",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/IssueManagement/views/kanban/Column","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(a,f,i,c,e,d,b,k,j){var h={MINIMUM_WIDTH_COLUMN:260,ATTRIBUTES_MAPPING:{STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate",ALL:"all"},CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed",LOW_PRIORITY:"Low",MEDIUM_PRIORITY:"Medium",HIGH_PRIORITY:"High",URGENT_PRIORITY:"Urgent",OVERDUE_DUE_DATE:"Overdue",NO_DATE_DUE_DATE:"None",TODAY_DUE_DATE:"Today",TOMORROW_DUE_DATE:"Tomorrow",THIS_WEEK_DUE_DATE:"Week",FUTURE_DUE_DATE:"Future",ALL_STATE:"All",LAYOUTS:{RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},SELECT_DEBOUNCE_TIMEOUT:1,FIRST_ELEMENT:0};var g=a.extend({name:"DS/IssueManagement/views/kanban/Kanban",tagName:"div",className:"kanban-container",_logger:null,component:null,document:null,settings:{},columns:{state:[],priority:[],resolutionDate:[],all:[]},chizu:{container:null,tooltips:[]},currentView:null,columnsListeners:[],siblings:{right:null,left:null},verticalLevelSelector:-1,_issuesNodesMapping:{},preventUnselectColumns:false,_ctrlKey:false,_subscribed:false,setup:function(l){var m=this;b.start(m.name+" setup");m._parent(l);m._logger=c.getLogger("DS/IssueManagement/View");m.component=l.component;m.document=null;m.settings=l.settings;m.columns={state:[],priority:[],resolutionDate:[],all:[]};m.chizu={container:null,tooltips:[]};m.currentView=null;m.columnsListeners=[];m.siblings={right:null,left:null};m.verticalLevelSelector=-1;m._issuesNodesMapping={};m.preventUnselectColumns=false;m._ctrlKey=false;m._subscribed=false;b.end(m.name+" setup")},render:function(){var m=this;b.start(m.name+" render");m.columns.state.forEach(function(n){n.render().inject(m.container)});m.columns.priority.forEach(function(n){n.render().inject(m.container)});m.columns.resolutionDate.forEach(function(n){n.render().inject(m.container)});m.columns.all.forEach(function(n){n.render().inject(m.container)});var l=d.get("widget").getValue("kanbanViewBy")||"state";m.switchView(l);b.end(m.name+" render");return m},load:function(C){var x=this;b.start(x.name+" load");if(C!==undefined&&C!==null){x.document=C}var u=x.document.getRoots(false);var t={};t[h.CREATE_STATE]=[];t[h.ASSIGN_STATE]=[];t[h.ACTIVE_STATE]=[];t[h.REVIEW_STATE]=[];t[h.CLOSED_STATE]=[];var H={};H[h.LOW_PRIORITY]=[];H[h.MEDIUM_PRIORITY]=[];H[h.HIGH_PRIORITY]=[];H[h.URGENT_PRIORITY]=[];var y={};y[h.OVERDUE_DUE_DATE]=[];y[h.NO_DATE_DUE_DATE]=[];y[h.TODAY_DUE_DATE]=[];y[h.TOMORROW_DUE_DATE]=[];y[h.THIS_WEEK_DUE_DATE]=[];y[h.FUTURE_DUE_DATE]=[];var n={};n[h.ALL_STATE]=[];var F=new Date();F.setHours(0,0,0,0);var z=new Date(F);z.setDate(z.getDate()-z.getDay()+8);x._issuesNodesMapping={};for(var E=0;E<u.length;E++){var v=u[E].options;x._issuesNodesMapping[u[E].options.id]=[];v.isSelected=u[E].isSelected();if(!t[v.state]||!H[v.priority]||!n[h.ALL_STATE]){continue}t[v.state].push(v);H[v.priority].push(v);n[h.ALL_STATE].push(v);if(v.resolutionDate!==undefined&&v.resolutionDate!==null&&v.resolutionDate!==""){var l=new Date(v.resolutionDate),A=l-F;if(!isNaN(A)){var o=A/1000/60/60/24;if(o<0){y[h.OVERDUE_DUE_DATE].push(v)}else{if(0<=o&&o<1){y[h.TODAY_DUE_DATE].push(v)}else{if(1<=o&&o<2){y[h.TOMORROW_DUE_DATE].push(v)}else{if(2<=o){var r=(l-z)<0;if(r){y[h.THIS_WEEK_DUE_DATE].push(v)}else{y[h.FUTURE_DUE_DATE].push(v)}}}}}}else{y[h.NO_DATE_DUE_DATE].push(v)}}else{y[h.NO_DATE_DUE_DATE].push(v)}}for(var s in t){if(t.hasOwnProperty(s)){var p=new e({id:h.ATTRIBUTES_MAPPING.STATE+s.replace(/ /g,"+").toLowerCase(),kanban:x,title:j.maturity[s.toLowerCase()],models:t[s],attributeKeyValue:{key:h.ATTRIBUTES_MAPPING.STATE,value:s}});x.columns.state.push(p)}}for(var G in H){if(H.hasOwnProperty(G)){var B=new e({id:h.ATTRIBUTES_MAPPING.PRIORITY+G.replace(/ /g,"+").toLowerCase(),kanban:x,title:j.priorities[G.toLowerCase()],models:H[G],attributeKeyValue:{key:h.ATTRIBUTES_MAPPING.PRIORITY,value:G}});x.columns.priority.push(B)}}for(var w in y){if(y.hasOwnProperty(w)){var m=new e({id:h.ATTRIBUTES_MAPPING.DUE_DATE+w.replace(/ /g,"+").toLowerCase(),kanban:x,title:k.kanban.resolutionDate[w.toLowerCase()],models:y[w],attributeKeyValue:{key:h.ATTRIBUTES_MAPPING.DUE_DATE,value:w}});x.columns.resolutionDate.push(m)}}for(var D in n){if(n.hasOwnProperty(D)){var q=new e({id:h.ATTRIBUTES_MAPPING.ALL,kanban:x,title:k.kanban.all,models:n[D],attributeKeyValue:{key:h.ATTRIBUTES_MAPPING.ALL,value:D}});x.columns.all.push(q)}}x._subscribers();b.end(x.name+" load");return x},refresh:function(){var m=this;b.start(m.name+" refresh");m.preventUnselectColumns=true;m.container.empty();for(var l in m.columns){if(m.columns.hasOwnProperty(l)){m.columns[l].forEach(function(n){n.destroy()});m.columns[l]=[]}}m.chizu.tooltips.forEach(function(n){n.destroy();n=null});m.chizu.container.destroy();m.chizu={container:null,tooltips:[]};m.load();m.render();b.end(m.name+" refresh")},destroy:function(){var l=this;l._stopListeningToColumns();l._logger=null;l.component=null;l.document=null;l.settings={};l.columns={state:[],priority:[],resolutionDate:[],all:[]};l.chizu.tooltips.forEach(function(m){m.destroy();m=null});l.chizu.container.destroy();l.chizu={container:null,tooltips:[]};l.currentView=null;l.columnsListeners=[];l.siblings={right:null,left:null};l.verticalLevelSelector=-1;l._issuesNodesMapping={};l.preventUnselectColumns=false;l._ctrlKey=false;l._subscribed=false},resize:function(){var r=this;if(!r.container||!r.container.getParent()){return}var s=d.get("application"),q=s.elements.body,t=s.information.container;var n=q.offsetWidth,u=q.offsetHeight;var l=d.get("information");if(l.isOpened()&&l.getLayout().current===h.LAYOUTS.RIGHT){n=n-t.offsetWidth}if(l.isOpened()&&l.getLayout().current===h.LAYOUTS.BOTTOM){u=u-t.offsetHeight}var v={width:n,height:u},p=r.container.getElements(".kanban-container-column.visible");if(p.length===0){return}var m=p[h.FIRST_ELEMENT].offsetWidth;m=(m>h.MINIMUM_WIDTH_COLUMN?h.MINIMUM_WIDTH_COLUMN:m);m=(m<h.MINIMUM_WIDTH_COLUMN?h.MINIMUM_WIDTH_COLUMN:m);var o=v.width/m;o=Math.floor(o);p.forEach(function(x,w){x.setStyle("max-height",u);if(w<o){x.show();x.setStyle("width",m)}else{x.hide()}});r._setChizu(p,o,0)},switchView:function(l){var n=this;for(var m in n.columns){if(n.columns.hasOwnProperty(m)){if(m!==l){n.columns[m].forEach(function(o){o.hide();o.container.removeClassName("visible")})}else{n.currentView=m;n._stopListeningToColumns();n._listenToColumns();n.columns[m].forEach(function(p,o){p.show();if(o===0){p.container.addClassName("visible first")}p.container.addClassName("visible")})}}}n.resize()},getSelectedNodes:function(){var n=this;var l=[];for(var m=0;m<n.columns[n.currentView].length;m++){l=l.concat(n.columns[n.currentView][m].getSelectedNodes())}return l},getSelectedIssues:function(){var o=this;var l=[];for(var m=0;m<o.columns[o.currentView].length;m++){var n=o.columns[o.currentView][m].getSelectedNodes().map(function(p){return p.options.id});l=l.concat(n)}return l},_setChizu:function(n,r,l){var q=this;var m=[],p=[],o=0;n.forEach(function(u,s){var t="";if(s<l){}else{if(o<r){t="displayed";o+=1}}var v=f.createElement("div",{"class":"chizu-placeholder-column "+t,events:{click:function(){var x=q.container.getElements(".kanban-container-column.visible"),y=0;for(var w=0;w<x.length;w++){if(w<s){x[w].hide()}else{if(y<r){x[w].show();x[w].setStyle("width",(100/r)+"%");y+=1}else{x[w].hide()}}}q._setChizu(x,r,s)}}});p.push(new i({position:"top",target:v,body:k.replace(k.kanban.tooltips.chizu,{title:q.columns[q.currentView][s].getOption("title")+" ("+q.columns[q.currentView][s].getTreeDocument().getRoots(false).length+")"})}));m.push(v)});if(q.chizu.container===null){q.chizu.container=f.createElement("div",{"class":"chizu",html:[{tag:"div","class":"chizu-placeholder-columns",html:m}]});q.chizu.tooltips=p;q.chizu.container.inject(q.container)}else{q.chizu.tooltips.forEach(function(s){s.destroy();s=null});q.chizu.tooltips=p;q.chizu.container.getElement(".chizu-placeholder-columns").setContent(m)}if(n.length===1){if(q.chizu.container&&!q.chizu.container.hasClassName("chizu-hidden")){q.chizu.container.addClassName("chizu-hidden")}}else{if(q.chizu.container&&q.chizu.container.hasClassName("chizu-hidden")){q.chizu.container.removeClassName("chizu-hidden")}}},_listenToColumns:function(){var l=this;var m=function(r){if(r.event==="select"){l.verticalLevelSelector=r.node.data.virtualRowID;var q=l.columns[r.column.attributeKeyValue.key];for(var o=0;o<q.length;o++){if(r.column.id===q[o].id){l.siblings.right=f.is(q[o+1],"object")?q[o+1]:null;l.siblings.left=f.is(q[o-1],"object")?q[o-1]:null}}}if(l.preventUnselectColumns){l.preventUnselectColumns=false}else{if(!l._ctrlKey&&r.event==="select"){for(var p=0;p<l.columns[l.currentView].length;p++){if(l.columns[l.currentView][p]!==r.column){l.columns[l.currentView][p].unselectAll()}}}}l.dispatchEvent("onSelect")};var n=l.utils.debounce(m.bind(l),h.SELECT_DEBOUNCE_TIMEOUT);l.columns[l.currentView].forEach(function(o){l.listenTo(o,"onSelect",n);l.columnsListeners.push({component:o,event:"onSelect"});l.listenTo(o,"onUnselectAll",function(){for(var p=0;p<l.columns[l.currentView].length;p++){l.columns[l.currentView][p].unselectAll()}});l.columnsListeners.push({component:o,event:"onUnselectAll"})})},_stopListeningToColumns:function(){var l=this;l.columnsListeners.forEach(function(m){l.stopListening(m.component,m.event)});l.columnsListeners=[]},_subscribers:function(){var l=this;if(l._subscribed===false){var m=d.get("widget");m.body.addEventListener("keydown",function(n){if(!l.container.getParent().isHidden()){if(n.keyCode===17){l._ctrlKey=true}}});m.body.addEventListener("keyup",function(n){if(!l.container.getParent().isHidden()){if(n.keyCode===17){l._ctrlKey=false}}});l._subscribed=true}},utils:{_debounceTimeouts:[],debounce:function(n,p,l){var m=this;var o;return function(){var u=this,t=arguments;var r=function(){o=null;if(!l){n.apply(u,t)}};var q=l&&!o;clearTimeout(o);var s=m._debounceTimeouts.indexOf(o);if(s!==-1){m._debounceTimeouts.splice(s,1)}o=setTimeout(r,p);m._debounceTimeouts.push(o);if(q){n.apply(u,t)}}}}});return g});define("DS/IssueManagement/Component",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/IssueComponents/open/Open","DS/IssueCommon/utils/TaskManager","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeDocument","DS/IssueManagement/utils/BIFilter","DS/IssueManagement/utils/ModelParser","DS/IssueManagement/utils/Synchronizer","DS/IssueManagement/views/kanban/Kanban","DS/IssueManagement/views/list/TreeList","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","text!DS/IssueManagement/assets/Settings.json","text!DS/IssueManagement/assets/IssueManagement.1D.json","text!DS/IssueManagement/assets/IssueManagement.2D.json","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,w,j,a,r,C,y,B,h,x,m,d,b,o,f,u,v,n,l,k,g,q,c,A,p,z,i){var s={ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_TYPE:"Issue",FIRST_ELEMENT_IN_PATH:0,INDEX_FOR_PHYSICAL_IDS_FILTER:0,LIST_VIEW:"ListView",KANBAN_VIEW:"KanbanView",ISSUE_FROM_BLANK:"IFB",METADATA:{ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},TASKS:{FILTER:"FILTER",PREFERENCES:"PREFERENCES"}};var t=w.extend(f,{name:"DS/IssueManagement/Component",tag:"div",className:"im-main-component",_logger:null,defaultOptions:{document:{},list:JSON.parse(z),kanban:JSON.parse(p),settings:JSON.parse(A)},containers:{list:null,kanban:null},document:null,list:null,kanban:null,synchronizer:null,taskManager:null,_subscriberTokens:[],_tasks:{subscriberTokens:[],current:null},_timestampUpdate:0,_subscriberId:"",setup:function(D){var E=this;E._logger=B.getLogger("DS/IssueManagement/Component");E._parent(D);E.document=new o({component:E,settings:E.getOption("settings"),document:E.getOption("document")});E.list=new l({component:E,settings:E.getOption("settings"),list:E.getOption("list")});E.kanban=new n({component:E,settings:E.getOption("settings"),kanban:E.getOption("kanban")});E.synchronizer=new v({list:E.list,kanban:E.kanban});E._subscriberId=Math.random().toString(36).substr(2,9);E.taskManager=m;E._subscriberTokens=[];E._tasks={subscriberTokens:[],current:null};E._timestampUpdate=0;E.utils._setTypesCallbackSubscribe=false;E.initializeBIFilter();E._subscribers();E._subscribersTaskManager();E.setPADContext()},render:function(){var E=this;c.start(E.name+" render");E.container.empty();E.containers.list=j.createElement("div",{"class":"issue-list-container"});E.containers.kanban=j.createElement("div",{"class":"issue-kanban-container"});E.containers.list.inject(E.container);E.containers.kanban.inject(E.container);if(E.getCurrentView()===s.KANBAN_VIEW){E.containers.list.addClassName("hidden");E.containers.kanban.removeClassName("hidden")}else{E.containers.list.removeClassName("hidden");E.containers.kanban.addClassName("hidden")}E.containers.list.setContent(E.list.getContent());E.containers.kanban.setContent(E.kanban.render());var D=E.document.getRoots();if(D.length===0){E.placeholder.show(E.container)}c.end(E.name+" render");E.dispatchEvent("onReady",{roots:D});return E},build:function(){var D=this;c.start(D.name+" build");return D.load().then(function(){return D.list.load(D.document)}).then(function(){return D.kanban.load(D.document)}).then(function(){return D.synchronizer.start()}).then(function(){D.render();c.end(D.name+" build")})},load:function(){var E=this;c.start(E.name+" load");var F=k.get("widget");var D=F.getValue("filter");if(E.utils.isJson(D)===true){D=JSON.parse(D)}else{D={}}return g.issues.filter({version:"1.0",data:{filter:D}}).then(function(G){var H=u.parse(G.body);return E.document.addRoots(H)}).then(function(){E.document.updatePredicates()["finally"](function(){E.dispatchEvent("onPredicatesUpdate",{})})})["finally"](function(){c.end(E.name+" load")})},onPostInitialize:function(){var I=this;var J=k.get("widget");var H=J.getValue("expandedIds");if(Array.isArray(H)===true){for(var G=0;G<H.length;G++){var D=I.getNodesById(H[G]);for(var E=0;E<D.length;E++){D[E].expand()}}}I.loadBIFilterPreference();try{require(["DS/WebappsUtils/WebappsUtils","DS/IssueComponents/konami/Konami"],function(K,L){L.kojima()})}catch(F){}},destroy:function(){var D=this;D._subscriberTokens.forEach(function(E){k.get("eventsHandler").unsubscribe(E)});D._tasks.subscriberTokens.forEach(function(E){k.get("eventsHandler").unsubscribe(E)});D.document.removeEventListener("onRootsAdded");D.document.removeEventListener("onRootsRemoved");D.document.empty();D.document=null;D.synchronizer=null;D.list.destroy();D.list=null;D.kanban.destroy();D.kanban=null;D.containers={list:null,kanban:null};D._timestampUpdate=0;D._subscriberTokens=[];D.utils._setTypesCallbackSubscribe=false;D._tasks={subscriberTokens:[],current:null};D.taskManager.destroy();D.taskManager=null;D._subscriberId=""},refresh:function(){var D=this;var E=k.get("widget");C.mask(E.body);D.document.refresh().then(function(){if(D.document.getRoots().length===0){D.placeholder.show(D.container);D.dispatchEvent("onRootsRemoved",{})}else{D.placeholder.hide(D.container)}D.list.preferences.loadSortPreference();k.get("filter").refresh();D.document.getModelEvents().publish({event:"setPathTags"});D.dispatchEvent("onRefreshComplete");C.unmask(E.body)})},resize:function(){var D=this;if(D.kanban!==null){D.kanban.resize()}},switchView:function(E){var F=this;q.setItem("view",{name:E});if(E===s.KANBAN_VIEW){F.containers.list.addClassName("hidden");F.containers.kanban.removeClassName("hidden");b.disable(["Selection","Find"])}else{F.containers.list.removeClassName("hidden");F.containers.kanban.addClassName("hidden");var D=F.getTreeDocument().getRoots(false);if(D.length===0){b.idling()}else{b.enable(["Selection","Find"])}}},publishSelect:function(F){var D=this;var E=k.get("widget");var G=k.get("eventsHandler");G.publish(D._subscriberId,"DS/Object/select",{metadata:{appId:E.id,appName:E.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:F.paths,attributes:F.attributes},version:"1.0"})},publishUpdate:function(G,D){var E=this;var F=k.get("widget");var H=k.get("eventsHandler");H.publish(E._subscriberId,"DS/Object/update",{metadata:{appId:F.id,appName:F.name,timestamp:Math.floor(Date.now()),options:j.is(D,"object")?D:{}},data:{paths:G.paths,attributes:G.attributes},version:"1.0"})},publishPreferences:function(){var D=this;var E=k.get("widget");k.get("eventsHandler").publish(D._subscriberId,"DS/Widget/preferences",{metadata:{appId:E.id,appName:E.name,timestamp:Math.floor(Date.now())},data:{preferences:JSON.stringify(E.getPreferences())},version:"1.0"})},publishCompass:function(){var D=this;D.utils.setTypesCallbackForOFW(D.document.getReportedAgainstFromSelectedNodes())},getSelectedNodes:function(){var D=this;return D.document.getSelectedNodes()},getNodesById:function(E){var D=this;return D.document.getNodesById(E)},getTreeDocument:function(){var D=this;return D.document},getTreeListView:function(){var D=this;return D.list},getKanbanView:function(){var D=this;return D.kanban},getCurrentView:function(){var D=q.getItem("view");if(D===null||!D.name){q.setItem("view",{name:s.LIST_VIEW});return s.LIST_VIEW}return D.name},getSessionOrFilteredRoots:function(){var I=this;var E=[];var D=I.getTreeDocument();if(D.isBIFiltered()===true){var F=D.getRoots(false);for(var G=0;G<F.length;G++){E.push(F[G].options.physicalId)}}else{var J=k.get("widget"),H=J.getValue("filter");if(D.utils.isJson(H)===true){H=JSON.parse(H);if(H.session===true){E=J.getValue("roots")}}}return E},_subscribers:function(){var D=this;var E=k.get("widget");var F=k.get("eventsHandler");D.document.addEventListener("onRootsAdded",function(G){D.placeholder.hide(D.container);D.dispatchEvent("onRootsAdded",G);D.document.getModelEvents().publish({event:"setPathTags"})});D.document.addEventListener("onRootsRemoved",function(H){var G=D.document.getRoots();if(G.length===0){D.placeholder.show(D.container)}D.dispatchEvent("onRootsRemoved",H);D.document.getModelEvents().publish({event:"setPathTags"})});D.listenTo(D,"onResize",function(){k.get("application").resize()});D._subscriberTokens.push(F.subscribe(D._subscriberId,"DS/Object/create",function(H){c.start(D.name+" DS/Object/create");var G=H.data.attributes;D.document.refreshNodesById({timestamp:H.metadata.timestamp,created:Object.keys(G)}).then(function(I){D.document.withBroadcastSelect(new e(function(J){D.document.withTransactionUpdate(function(){D.document.unselectAll();var L=I.created;for(var K=0;K<L.length;K++){L[K].select()}J()})}));c.end(D.name+" DS/Object/create")})}));D._subscriberTokens.push(F.subscribe(D._subscriberId,"DS/Object/update",function(I){var H=I.data.attributes,G=D.document;G.refreshNodesById({timestamp:I.metadata.timestamp,modified:Object.keys(H)}).then(function(){c.end(D.name+" DS/Object/update")})}));D._subscriberTokens.push(F.subscribe(D._subscriberId,"DS/Object/delete",function(I){c.start(D.name+" DS/Object/delete");var G=D.document,H=[];I.data.paths.forEach(function(J){H.push(J.pop())});G.removeRootsById(H).then(function(){c.end(D.name+" DS/Object/delete")})}));D._subscriberTokens.push(F.subscribe(D._subscriberId,"DS/Object/select",function(I){var J=I.data.paths,H=[];if(I.metadata.appId===E.id){return}c.start(D.name+" DS/Object/select");var G=D.document;G.withTransactionUpdate(function(){D.getSelectedNodes().forEach(function(O){O.unselect()});var N=D.getTreeListView();for(var K=0;K<J.length;K++){var M=G.getNodesById(J[K][s.FIRST_ELEMENT_IN_PATH]);if(M.length>0){var L=M[s.FIRST_ELEMENT_IN_PATH];c.start(D.name+" scrollToNode");if(K===0&&!N.getManager().isNodeInVisibleViewport(L)){N.getManager().scrollToNode(L,"top",false)}c.end(D.name+" scrollToNode");H.push(J[K][s.FIRST_ELEMENT_IN_PATH]);L.select()}}b.select(D.getSelectedNodes());c.end(D.name+" DS/Object/select")})}))},_subscribersTaskManager:function(){var G=this;var I=k.get("widget");var J=k.get("eventsHandler");var H=function(){var K=I.body.getDimensions().height,L=window.getComputedStyle(I.body);if(K===0||L.display==="none"){return false}return true};G._tasks.subscriberTokens.push(J.subscribe(G._subscriberId,"DS/IssueManagementTask/add",function D(M){c.start(G.name+" DS/IssueManagementTask/add");if(j.is(M.metadata,"object")&&j.is(M.metadata.options,"object")&&j.equals(M.metadata.options[s.METADATA.ISU_TASK_MANAGER],s.METADATA.ISU_TASK_MANAGER)&&Array.isArray(M.data.paths)&&M.data.paths.length>0){var O=M.data.paths[s.FIRST_ELEMENT_IN_PATH][s.FIRST_ELEMENT_IN_PATH],L=M.data.attributes[O];if(!j.is(G._tasks.current)){if(H()){if(Object.keys(s.TASKS).indexOf(L.taskType)!==-1){var N=[],K={};N.push([O]);K[O]={taskType:L.taskType,widgetIdIM:L.widgetIdIM,widgetId3D:I.id};k.get("eventsHandler").publish(G._subscriberId,"DS/IssueManagementTask/ready",{metadata:{appId:I.id,appName:I.name,timestamp:Math.floor(Date.now()),options:j.clone(M.metadata.options)},data:{paths:N,attributes:K},version:"1.0"})}else{}}else{}}else{}}else{}c.end(G.name+" DS/IssueManagementTask/add")}));G._tasks.subscriberTokens.push(J.subscribe(G._subscriberId,"DS/IssueManagementTask/exec",function F(L){c.start(G.name+" DS/IssueManagementTask/exec");if(j.is(L.metadata,"object")&&j.is(L.metadata.options,"object")&&j.equals(L.metadata.options[s.METADATA.ISU_TASK_MANAGER],s.METADATA.ISU_TASK_MANAGER)&&Array.isArray(L.data.paths)&&L.data.paths.length>0){var M=L.data.paths[s.FIRST_ELEMENT_IN_PATH][s.FIRST_ELEMENT_IN_PATH],K=L.data.attributes[M];if(I.name===s.ISSUE_MANAGEMENT&&K.widgetId3D===I.id){new e(function(N){N()}).then(function(){G._tasks.current={taskId:M,taskType:K.taskType,widgetIdIM:K.widgetIdIM,widgetId3D:I.id}}).then(function(){if(j.is(G._taskHandlers[K.taskType],"function")){return G._taskHandlers[K.taskType].call(G,K.args)}else{return e.resolve()}}).then(function(N){if(j.is(N,"object")){G._tasks.current.cancel=N}})["catch"](function(N){G._tasks.current=null;G._logger.error(N)})}}c.end(G.name+" DS/IssueManagementTask/exec")}));G._tasks.subscriberTokens.push(J.subscribe(G._subscriberId,"DS/IssueManagementTask/cancel",function E(L){c.start(G.name+" DS/IssueManagementTask/cancel");if(j.is(L.metadata,"object")&&j.is(L.metadata.options,"object")&&j.equals(L.metadata.options[s.METADATA.ISU_TASK_MANAGER],s.METADATA.ISU_TASK_MANAGER)&&Array.isArray(L.data.paths)&&L.data.paths.length>0){var M=L.data.paths[s.FIRST_ELEMENT_IN_PATH][s.FIRST_ELEMENT_IN_PATH],K=L.data.attributes[M];if(K.taskId===G._tasks.current.taskId&&K.widgetId3D===I.id&&K.widgetIdIM===G._tasks.current.widgetIdIM){if(j.is(G._tasks.current.cancel,"function")){G._tasks.current.cancel()}G._tasks.current=null}else{}}else{}c.end(G.name+" DS/IssueManagementTask/cancel")}))},_taskHandlers:{FILTER:function(D){var E=this;var F=k.get("widget");return new e(function(H){E.listenTo(E,"onRefreshComplete",function(){var J=[],I={};J.push([E._tasks.current.taskId]);I[E._tasks.current.taskId]={taskType:E._tasks.current.taskType,widgetIdIM:E._tasks.current.widgetIdIM,widgetId3D:E._tasks.current.widgetId3D};k.get("eventsHandler").publish(E._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:F.id,appName:F.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:J,attributes:I},version:"1.0"});E._tasks.current=null;E.stopListening(E,"onRefreshComplete")});var G={session:true};F.setValue("filter",JSON.stringify(G));F.setValue("roots",D[s.INDEX_FOR_PHYSICAL_IDS_FILTER]);F.dispatchEvent("onRefresh");H(null)})},PREFERENCES:function(){var D=this;var E=k.get("widget");return new e(function(G){var H=[],F={};H.push([D._tasks.current.taskId]);F[D._tasks.current.taskId]={taskType:D._tasks.current.taskType,widgetIdIM:D._tasks.current.widgetIdIM,widgetId3D:D._tasks.current.widgetId3D,response:{preferences:JSON.stringify(E.getPreferences())}};k.get("eventsHandler").publish(D._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:E.id,appName:E.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:H,attributes:F},version:"1.0"});D._tasks.current=null;G(null)})}},getPADTreeDocument:function(){var D=this;return D.getTreeDocument()},setPADContext:function(){var D=this;require(["DS/PADUtils/PADContext"],function(E){E.set(D)})},maskForTask:function(E,G){var F=this;var H=k.get("widget");F._tasks.current={taskId:E.taskId,taskType:E.taskType,widgetIdIM:H.id,widgetId3D:""};var I=H.body;I.addClassName("masked masked-task");var D=j.createElement("div",{"class":"mask mask-for-task"});j.createElement("div",{"class":"mask-wrapper",html:j.createElement("div",{"class":"task-mask-cancel",html:[j.createElement("div",{"class":"task-select-message",html:G||i.tasks.cancelLabel}),new r({value:i.tasks.cancel,className:"default task-cancel-button",id:"task-cancel",events:{onClick:function(){if(F._tasks.current!==null){F.taskManager.cancel(F._tasks.current.taskId)}else{I.removeClassName("masked masked-task");D.destroy()}}}})]})}).inject(D);F._mask=D;D.inject(I)},unmaskForTask:function(D){var E=this;var F=k.get("widget");if(D.widgetIdIM===F.id){var G=F.body;G.removeClassName("masked masked-task");if(j.is(E._mask)){E._mask.destroy();E._mask=null}E._tasks.current=null}},placeholder:{show:function(D){var G=this;var F=D.getElement(".no-issues-to-show-container");if(F!==null){return F}D.getChildren().forEach(function(J){J.setStyle("display","none")});var H=j.createElement("span",{"class":"no-issues-to-show-filter-shortcut fonticon fonticon-search-filter"}),E=j.createElement("span",{"class":"no-issues-to-show-create-shortcut fonticon fonticon-plus"});var I=j.createElement("div",{"class":"no-issues-to-show-container",html:[j.createElement("div",{"class":"no-issues-to-show",html:[j.createElement("div",{"class":"pin",html:'<span class="fonticon fonticon-5x fonticon-location"></span>'}),j.createElement("div",{"class":"pulse"}),j.createElement("span",{"class":"no-issues-to-show-label",html:i.titles.placeholder.label}),j.createElement("div",{"class":"no-issues-to-show-sub-container",html:j.createElement("span",{html:i.replace(i.titles.placeholder.sub,{filter:H.outerHTML,create:E.outerHTML})})})]})]});D.appendChild(I);G._filterTooltip=new y({position:"top",target:I.getElement(".no-issues-to-show-filter-shortcut"),body:i.filter.title});G._createTooltip=new y({position:"top",target:I.getElement(".no-issues-to-show-create-shortcut"),body:i.actions.create.title});I.getElement(".no-issues-to-show-filter-shortcut").addEventListener("click",function(){k.get("application").filter.elements.bar.getItem("Filter").elements.icon.click()});I.getElement(".no-issues-to-show-create-shortcut").addEventListener("click",function(){var J=b.getCommand("Create");J.mode=s.ISSUE_FROM_BLANK;J.begin()});return I},hide:function(D){var E=this;var F=D.getElement(".no-issues-to-show-container");if(F===null){return}D.getChildren().forEach(function(G){G.setStyle("display","initial")});if(F!==null){F.destroy()}if(E._filterTooltip){E._filterTooltip.destroy();E._filterTooltip=null}if(E._createTooltip){E._createTooltip.destroy();E._createTooltip=null}}},utils:{_iconBarForPlaceHolder:null,_setTypesCallbackSubscribe:false,setTypesCallbackForOFW:function(E){var D=this;x.setTypesCallbackForOFW(E,{setTypesCallbackSubscribe:D._setTypesCallbackSubscribe});D._setTypesCallbackSubscribe=true},isJson:function(E){try{JSON.parse(E)}catch(D){return false}return true}}});return t});