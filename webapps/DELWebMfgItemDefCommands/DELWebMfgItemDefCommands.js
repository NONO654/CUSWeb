define("DS/DELWebMfgItemDefCommands/CreateOrUpdateMfgItemCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIControls/CreateMfgItemDialogUI","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefUIControls/UpdateMfgItemDialogUI","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel"],function(g,b,d,m,h,e,i,l,k,a,p,f){var c=b.extend(m,{name:"CreateOrUpdateMfgItemCommand",_logger:null,_context:null,_createOrUpdateCmd:null,mbomTreeListView:null,init:function q(r){this._logger=d.getLogger(c);this._parent(r,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function o(){var r=this.getArguments();this._logger.log("beginExecute");if(!this._context){this._logger.warn("ERROR: No context.");return}if(g.is(r,"array")){if(0<r.length){r.forEach(function(s){if(!g.is(s)){return}if(!g.is(s.ID,"string")){return}if(!g.is(s.Value,"string")){return}if("ReferenceType"===s.ID){this._createOrUpdateCmd=s.Value}},this)}}this._selectedMBOM=[];this._selectedBODY=[];this.mbomTreeListView=this._context.getMBOMTreeListView();this.bodyTreeListView=this._context.getBodyTreeListView();if(!this.mbomTreeListView||!this.bodyTreeListView){this._logger.warn("ERROR: Could not retrieve treelistviews");return}this._mbomTree=this.mbomTreeListView.getDocument();this._bodyTree=this.bodyTreeListView.getDocument();if(!this._mbomTree||!this._bodyTree){this._logger.warn("ERROR: Could not retrieve trees");return}this._selectedMBOM=this._mbomTree.getSelectedNodes();this._selectedBODY=this._bodyTree.getSelectedNodes();if(!g.is(this._selectedMBOM,"array")||!g.is(this._selectedBODY,"array")){this._logger.warn("ERROR: Bad selection.");this._selectedMBOM=this._selectedMBOM||[];this._selectedBODY=this._selectedBODY||[]}},execute:function n(){var r=this,u,s,t=function(D,y,w){var H=[],B,z,F,A,C,x,E,G;if(g.is(w)){B=l.references.get(w);if(g.is(B)){C=r.bodyTreeListView.utils.isInTreeList(w);if(!C){e.addToTreeList(B,{elementUI:"LeftUI",displayMdlRootAttr:"asRootInBodyView"})}}else{A=new f({PID:w});A.fetch({proxy:"passport",type:"json",headers:a.getHeaders(),wait:true,onComplete:function v(J){var I=l.references.add(J);e.addToTreeList(I,{elementUI:"LeftUI",displayMdlRootAttr:"asRootInBodyView"})}})}}if(g.is(y)){E=l.references.get(y);if(g.is(E)){x=r.mbomTreeListView.utils.isInTreeList(y);if(!x){H.forceDBMode=true;H.elementUI="TableUI";H.displayMdlRootAttr="asRootInTableView";e.addToTreeList(E,H)}else{H.returnFirstOne=true;G=r.mbomTreeListView.getDocument().getNodeModel(y,H);k.buildConnectionModelInfo(E);r.mbomTreeListView.utils.fillReferenceTreeNode(G);if(!G.isExpanded()){G.expand()}}}}else{if(g.is(D)){H.returnFirstOne=true;F=r.mbomTreeListView.getDocument().getNodeModel(D,H);if(g.is(F)){z=l.references.get(D);if(z){k.buildConnectionModelInfo(z)}H.updateLoadedChild=true;r.mbomTreeListView.utils.fillReferenceTreeNode(F,H);if(!F.isExpanded()){F.expand()}}}}if(r._createOrUpdateCmd==="CreateMfgItem"){e.AlertManager.add({className:"success",message:h.getNLSValue("Success.CreateMfg.Title")})}else{if(r._createOrUpdateCmd==="UpdateMfgItem"){e.AlertManager.add({className:"success",message:h.getNLSValue("Success.UpdateMfg.Title")})}}};this._logger.log("execute");u=this._mbomTree.getXSO();s=this._bodyTree.getXSO();if(this._createOrUpdateCmd==="CreateMfgItem"){i.createDialog(this._createOrUpdateCmd,s,u,t)}else{if(this._createOrUpdateCmd==="UpdateMfgItem"){p.showMBOMUpdateDilaog(u,t)}}},endExecute:function j(){this._logger.log("endExecute")},});return c});define("DS/DELWebMfgItemDefCommands/ToggleOrientationCommand",["UWA/Core","DS/Logger/Logger","DS/ApplicationFrame/Command","UWA/Class/Options",],function(d,c,b,f){var a=b.extend(f,{name:"ToggleOrientationCommand",_logger:null,init:function i(j){if(c){this._logger=c.getLogger(a)}this._parent(j,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function h(){if(this._logger){this._logger.log("beginExecute")}if(!this._context){this._logger.warn("ERROR: No context.");return}this._view=this._context.getCurrentView()},execute:function g(){if(this._logger){this._logger.log("execute")}if(!this._context){this._logger.warn("ERROR: No context.");return}var k=null;var j=this._view;if("MBOM"===j){k=this._context.getMBOMGraphView()}else{if("BODY"===j){k=this._context.getBodyGraphView()}}if(k){k.toggleOrientation()}},endExecute:function e(){if(this._logger){this._logger.log("endExecute")}},});return a});define("DS/DELWebMfgItemDefCommands/ReconnectOrRevReconnectScopeCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/RelObjAttributesUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","DS/DELWebMfgAssetsDefUIControls/ReconnectOrRevReconnectScopeDialogUI"],function(g,b,c,k,d,j,i,a,f,e){var o=b.extend(k,{name:"ReconnectOrRevReconnectScopeCommand",_logger:null,_context:null,_reviseOrReconnectScopeCmd:null,mbomTreeListView:null,bodyTreeListView:null,init:function n(p){this._logger=c.getLogger(o);this._logger.log("ReconnectOrRevReconnectScopeCmd - init");this._parent(p,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function m(){var p=this.getArguments();this._logger.log("ReconnectOrRevReconnectScopeCmd - beginExecute");if(!this._context){this._logger.warn("ERROR: No context.");return}if(g.is(p,"array")){if(0<p.length){p.forEach(function(q){if(!g.is(q)){return}if(!g.is(q.ID,"string")){return}if(!g.is(q.Value,"string")){return}if("LinkType"===q.ID){this._reviseOrReconnectScopeCmd=q.Value}},this)}}this._selectedMBOM=[];this.mbomTreeListView=this._context.getMBOMTreeListView();this.bodyTreeListView=this._context.getBodyTreeListView();if(!this.mbomTreeListView||!this.bodyTreeListView){this._logger.warn("ERROR: Could not retrieve treelistviews");return}this._mbomTree=this.mbomTreeListView.getDocument();if(!this._mbomTree){this._logger.warn("ERROR: Could not retrieve trees");return}this._selectedMBOM=this._mbomTree.getSelectedNodes();if(!g.is(this._selectedMBOM,"array")){this._logger.warn("ERROR: Bad selection.");this._selectedMBOM=this._selectedMBOM||[]}},execute:function l(){var p=this,r,q=function(A,u,t){var C=[],y,v,B,w,z,x;if(g.is(t)){y=j.references.get(t);if(g.is(y)){z=(p._reviseOrReconnectScopeCmd==="ReconnectScope")?p.bodyTreeListView.utils.isInTreeList(t):p.bodyTreeListView.utils.isInTreeList(t,true);if(!z){d.addToTreeList(y,{elementUI:"LeftUI",displayMdlRootAttr:"asRootInBodyView"})}}else{w=new f({PID:t});w.fetch({proxy:"passport",type:"json",headers:a.getHeaders(),wait:true,onComplete:function s(E){var D;D=j.references.add(E);d.addToTreeList(D,{elementUI:"LeftUI",displayMdlRootAttr:"asRootInBodyView"})}})}}if(g.is(u)){x=j.references.get(u);if(g.is(x)){C.forceDBMode=true;C.elementUI="TableUI";C.displayMdlRootAttr="asRootInTableView";d.addToTreeList(x,C)}}else{if(g.is(A)){C.returnFirstOne=true;B=p.mbomTreeListView.getDocument().getNodeModel(A,C);if(g.is(B)){v=j.references.get(A);if(v){i.buildConnectionModelInfo(v)}}}}};this._logger.log("ReconnectOrRevReconnectScopeCmd - execute");r=this._mbomTree.getXSO();e.showReconnectScopeDialog(this._reviseOrReconnectScopeCmd,r,q)},endExecute:function h(){this._logger.log("endExecute")},});return o});define("DS/DELWebMfgItemDefCommands/OriginAddCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/ModelUtils",],function(a,e,c,d,h,b){var f=c.extend(h,{name:"OriginAddCommand",_logger:null,_context:null,init:function k(l){var m=this;this._logger=d.getLogger(f);this._parent(l,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function j(){this._logger.log("beginExecute")},execute:function i(){this._logger.log("execute");if(false!==e.is(a._view)){a._view._search.activate("Origin search",null,null)}},endExecute:function g(){this._logger.log("endExecute")},});return f});define("DS/DELWebMfgItemDefCommands/ActionViewFilterCommand",["UWA/Core","DS/Core/Events","DS/ApplicationFrame/Command","DS/Logger/Logger","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/PlatformAPI/PlatformAPI","DS/DELWebMfgItemDefUIPanel/ActionViewManager","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils",],function(d,m,j,q,l,c,g,f,k,a,e,b,p,r){var h=j.extend({name:"ActionViewFilterCommand",init:function n(s){this._logger=q.getLogger(h);this._parent(s,{mode:"exclusive",isAsynchronous:false})},beginExecute:function o(s){var t;this.columnDataIndex=s.columnDataIndex;this.columnId=s.columnId;this.actionViewRows=e._context._rightBloc.treeListView.getRoots();if(!d.is(e._context._rightBloc.treeListView.filters)){e._context._rightBloc.treeListView.filters=[];for(t=0;t<this.actionViewRows.length;t++){e._context._rightBloc.treeListView.filters[t]=[]}}this._showDialog()},_showDialog:function i(){var E=this,x,s={},w=e._context._rightBloc.treeListView,A,B=w._datagrid.getManager().getColumns()[this.columnId].text,C=B+" "+p.getNLSValue("Cmd.ActionViewFilter.DialogTitle"),D=p.getNLSValue("Cmd.ActionViewFilter.EMPTY"),v,z,y,t,F=r.getMGAElement("UIContainer").getSize();if(d.is(E.dialog)){E.dialog.destroy();E.dialog=null}t=a.subscribe("DS."+b.getWidgetTrigram()+".Selection.SelectionModified",function u(G){var H;if(G.modifiedObjectSelectionState&&G.selectedObjectsPID.length===1){a.unsubscribe(t);E.actionViewRows=e._context._rightBloc.treeListView.getRoots();if(!d.is(e._context._rightBloc.treeListView.filters)){e._context._rightBloc.treeListView.filters=[];for(H=0;H<E.actionViewRows.length;H++){e._context._rightBloc.treeListView.filters[H]=[]}}E._showDialog()}});E._ctx.getBlocLayout().getContent().addEvent("onBlocLayoutResizeEnd",function(G){if(!e._context.isActionViewOpen()){E._ctx.getBlocLayout().getContent().removeEvent("onBlocLayoutResizeEnd");E.dialog.destroy();E.dialog=null}});y=r.getMGAElement("FrameWindow").getImmersiveFrame();this.filterToggles=[];this.actionViewRows.forEach(function(H,G){A=H.options.grid[this.columnDataIndex]!==""?H.options.grid[this.columnDataIndex]:D;if(this.columnDataIndex==="Alternate"||this.columnDataIndex==="Origin"){A=H.options.label}else{if(d.is(A,"array")){A=A.map(function(I){return I.Value}).toString()}else{if(!d.is(A,"string")&&!d.is(A,"boolean")){A=""}}}if(!s.hasOwnProperty(A)){s[A]={};s[A]["rowsId"]=[]}s[A]["rowsId"].push(G);if(!d.is(s[A]["isVisible"])){s[A]["isVisible"]=H.isVisible()}else{if(d.is(s[A]["isVisible"])&&s[A]["isVisible"]!==H.isVisible()){s[A]["isVisible"]=true;s[A]["mixedState"]=true}}}.bind(this));x=new d.Element("div",{styles:{"max-height":(F.height)*0.6,}});Object.keys(s).forEach(function(G){var K,I=G.split(","),H,J=true;if(!s[G]["isVisible"]){s[G]["rowsId"].forEach(function(L){if(w.filters[L].indexOf(E.columnId)===-1){J=false}})}if(J){K=new d.Element("div");new d.Element("label",{text:I[0]}).inject(K);if(I.length>1){new d.Element("i",{"class":"wux-ui-3ds wux-ui-3ds-menu-dot",id:"multiValueCellMoreIndicator"}).inject(K)}H=new c({label:K,checkFlag:s[G]["isVisible"],mixedState:d.is(s[G]["mixedState"])?s[G]["mixedState"]:false,value:s[G]["rowsId"].toString()});E.filterToggles.push(H);if(I.length>1){H.tooltipInfos=new g({shortHelp:I.join("<br/>")})}H.inject(x)}});v=function v(){var O=w.getRoots(),G,N,H,I,M,K,L,J;E.filterToggles.forEach(function(P){P.value.split(",").forEach(function(Q){if(P.checkFlag){w.filters[Q]=w.filters[Q].filter(function(R){return R!==E.columnId})}else{w.filters[Q].push(E.columnId)}if(w.filters[Q].length>0){O[Q].hide()}else{O[Q].show()}})});N=e._view._toolBar;H=N.container.getElement(".toolBarBody");I=N.container.getElement(".toolBarBodySmall").getElement(".toolBarBodySmallUl");G=O.filter(function(P){return P.isVisible()});if(O.length!==G.length&&!d.is(H.getElement("#remove_filters"))){K={icon:"ActionRemoveFilter",toolTip:"Cmd.ActionViewFilter.Remove",};M=d.createElement("il",{"class":"toolBarBodySmallIl",}).inject(I);L=new l({});L.tooltipInfos=new g({shortHelp:p.getNLSValue(K.toolTip)});L.inject(H);L.getContent().id="remove_filters";L.addEventListener("click",function(){w.getRoots().forEach(function(P){P.show()});L.destroy();M.destroy();w.filters=null});p.getIconFromKey(K.icon).inject(L.getContent());J=new l({});J.tooltipInfos=new g({shortHelp:p.getNLSValue(K.toolTip)});J.inject(M);J.getContent().id="remove_filters";J.addEventListener("click",function(){w.getRoots().forEach(function(P){P.show()});I.hide();M.destroy();L.destroy();w.filters=null});p.getIconFromKey(K.icon).inject(J.getContent())}else{if(O.length===G.length&&d.is(H.getElement("#remove_filters"))){H.getElement("#remove_filters").destroy();I.getElement("#remove_filters").destroy()}}a.unsubscribe(t);E._ctx.getBlocLayout().getContent().removeEvent("onBlocLayoutResizeEnd");E.dialog.hide()};z=function z(){a.unsubscribe(t);E._ctx.getBlocLayout().getContent().removeEvent("onBlocLayoutResizeEnd");E.dialog.hide()};this.dialog=new f({title:C,content:x,immersiveFrame:y,buttons:{Cancel:new l({onClick:z}),Ok:new l({onClick:v})}});this.dialog.addEventListener("close",function(){z()});this.dialog.addEventListener("keydown",function(G){if(G.keyCode===13){if(G.target.type==="button"){G.target.triggerEvent("click")}else{v()}}else{if(G.keyCode===27){z()}}});this.dialog.show()},});return h});define("DS/DELWebMfgItemDefCommands/AlternateBLCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/DELWebMfgAssetsDefModelServices/Resources","DS/Logger/Logger","DS/DELWebMfgAssetsDefUIServices/UIUtils","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/ModelUtils",],function(a,f,c,g,d,e,l,b){var i=c.extend(l,{name:"AlternateBLCommand",_logger:null,_context:null,init:function o(p){var q=this;q._logger=d.getLogger(i);q._parent(p,{mode:"exclusive",isAsynchronous:false,});q._context=q.getOption("context")},beginExecute:function n(){this._logger.log("beginExecute")},execute:function m(){this._logger.log("execute");if(false!==f.is(a._view)){var p=a._fromPID;b.webServiceRequest({url:"modeler/ppr/getalternatefrombl",method:"POST",context:this,onComplete:this.getAlternateComplete,onFailure:this.getAlternateFailure,data:f.Json.encode({pid:p}),})}},endExecute:function h(){this._logger.log("endExecute")},getAlternateComplete:function k(p){if(0===p.referenceIDS.length){e.AlertManager.add({className:"info",message:g.getNLSValue("Info.AlternateBL.Empty"),})}else{if(false!==f.is(a._view)){a._view._search.activate("Alternate search",null,p.referenceIDS)}}},getAlternateFailure:function j(p){this._logger.warn("ERROR: AlternateBL failed");this._logger.log(p);e.AlertManager.add({className:"error",message:g.getNLSValue("Error.AlternateBL.Failure"),})},});return i});define("DS/DELWebMfgItemDefCommands/CapableResourceAddCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/ModelUtils",],function(a,e,c,d,h,b){var g=c.extend(h,{name:"CapableResourceAddCommand",_logger:null,_context:null,init:function k(l){var m=this;this._logger=d.getLogger(g);this._parent(l,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function j(){this._logger.log("beginExecute")},execute:function i(){this._logger.log("execute");if(false!==e.is(a._view)){a._view._search.activate("Capable resource search",null,null)}},endExecute:function f(){this._logger.log("endExecute")},});return g});define("DS/DELWebMfgItemDefCommands/CapableResourceRemoveCommand",["DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils",],function(d,c,h,e,f,k,i,g){var a=e.extend(k,{name:"CapableResourceRemoveCommand",_logger:null,_context:null,_beforeUnMask:0,init:function n(o){this._logger=f.getLogger(a);this._parent(o,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function m(){this._logger.log("beginExecute")},execute:function l(){var r=this;this._logger.log("execute");if(false!==h.is(c._view)){var o=c._view;var q=o._context.getConnectionCollection();var p=o._actionView.getTreeListView().getDocument().getSelectedNodes();p.forEach(function(s){var u=s.getReferencePID();var t=q.findWhere({from:o._fromPID,to:u,type:"DELAsmProcessCanUseCnx",});if(h.is(t)){t.destroy({proxy:"passport",headers:d.getHeaders(),wait:true,onComplete:function(){},onFailure:r._onFailure.bind(r),})}})}},endExecute:function j(){this._logger.log("endExecute")},_onFailure:function b(o,p){g.AlertManager.add({className:"info",message:i.getNLSValue("Info.ElementNotRemoved.Title"),})},});return a});define("DS/DELWebMfgItemDefCommands/DeleteScopeCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils",],function(e,b,c,k,f,d,a,j){var h=b.extend(k,{name:"DeleteScopeCommand",_logger:null,_context:null,_mbomTreeDocument:null,init:function o(p){var q;this._parent(p,{mode:"exclusive",isAsynchronous:false});this._logger=c.getLogger(h);this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context given");return}q=this._context.getMBOMTreeListView();if(!q){this._logger.warn("No mbom treelistview");return}this._mbomTreeDocument=q.getDocument();if(!this._mbomTreeDocument){this._logger.awrn("No mbom tree document");return}},_displayError:function i(p){this._logger.warn("ERROR: "+p);d.AlertManager.add({className:"error",message:f.getNLSValue(p),})},beginExecute:function m(){this._logger.log("beginExecute")},execute:function l(){var t=this,w=e.Class.Promise.deferred(),v=e.Class.Promise.deferred(),u,r,s,x,q;this._logger.log("execute");if(!this._mbomTreeDocument){this._logger.warn("No treedocument found for mbom !");return}u=this._mbomTreeDocument.getSelectedNodes();if(!e.is(u,"array")){this._displayError("Error.SelectionNotScoped.Title");return}if(0>=u.length){this._displayError("Error.SelectionNotScoped.Title");return}u.forEach(function p(B){r=B.getReferencePID();s=B.getInstancePID();if(!r){t._logger.warn("ERROR: Could not get referencePID");return}if(!s&&!B.isRoot()){t._logger.warn("ERROR: Could not get instancePID");return}q=j.connections.findWhere({from:s,type:"ProductImplementLinkOcc"});x=j.connections.findWhere({from:r,type:"ProductImplementLink",});if(!x){t._displayError("Error.SelectionNotScoped.Title");return}if(q){q.destroy({proxy:"passport",headers:a.getHeaders(),wait:true,onComplete:function A(){v.resolve()},onFailre:function y(){v.reject()},onTimeout:function C(){v.reject()},onCancel:function F(){v.reject()}})}else{v.resolve()}v.promise.then(function G(){x.destroy({proxy:"passport",headers:a.getHeaders(),wait:true,onComplete:function I(){w.resolve()},onFailre:function H(){w.reject()},onTimeout:function K(){w.reject()},onCancel:function J(){w.reject()}})},function E(){t._displayError("Error.ScopeDeletionFailed.Title")});w.promise.then(function z(){t._logger.log("Scope deletion successful");d.AlertManager.add({className:"success",message:f.getNLSValue("Success.ScopedDeleted.Title"),});t._recursiveDestroy(B)},function D(){t._displayError("Error.ScopeDeletionFailed.Title")})},this);a.setForceDBMode(true)},_recursiveDestroy:function n(t){var s,r,q,z,u,p,A,y,x,w,v;if(!t){return}s=t.getChildren();if(!e.is(s,"array")){return}r=s.length;if(0>=r){return}for(w=0;w<r;w++){q=s[w];if(!q){continue}z=q.getReferencePID();if(!z){continue}y=a.connections.where({from:z,type:"ProductImplementLink",});if(e.is(y,"array")){x=y.length;if(0<x){return}this._recursiveDestroy(q)}else{this._recursiveDestroy(q)}u=q.getInstancePID();if(!z){continue}if(!u){continue}p=a.connections.where({from:u,type:"ProductImplementLinkOcc",});if(e.is(p,"array")){A=p.length;if(0<A){for(v=0;v<A;v++){p[v].destroy({proxy:"passport",headers:a.getHeaders(),wait:true,})}}}}return},endExecute:function g(){this._logger.log("endExecute")}});return h});define("DS/DELWebMfgItemDefCommands/HideAllCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils"],function(f,c,d,i,e,b){var h=c.extend(i,{name:"HideAllCommand",_logger:null,init:function l(m){this._logger=d.getLogger(h);this._parent(m,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context");this._widgetTrigram=b.getWidgetTrigram()},_resetFilterUI:function a(m){m.forEach(function n(o){var q,p;p=e.getMGAElement(o);if(f.is(p)){q=p.utils._filterProxy;if(f.is(q)){q.resetFilterUI()}}})},beginExecute:function k(){this._logger.log("beginExecute");this._references=this._context.getReferenceCollection()},execute:function j(){var m;this._logger.log("execute");e.CommandsCheckHeaderManager.getCmd("AlternateCommand").setState(false);e.CommandsCheckHeaderManager.getCmd("OriginCommand").setState(false);e.CommandsCheckHeaderManager.getCmd("CapableResourceCommand").setState(false);this._references.forEach(function(n){n.setDisplayModel({asRootInTableView:false,asRootInBodyView:false,asRootInActionView:false,selectedInActionView:false,selectedInTableView:false,selectedFor3DView:false},{silent:false})},this);if(this._widgetTrigram==="MFN"){m=["LeftUI","TableUI"]}else{m=["TableUI"]}this._resetFilterUI(m)},endExecute:function g(){this._logger.log("endExecute");this._context.getBodyDropView().show()},});return h});define("DS/DELWebMfgItemDefCommands/MBOMAddCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefUIServices/Search","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel",],function(i,b,c,m,d,e,a,l,h,g){var k=b.extend(m,{name:"MBOMAddCommand",_logger:null,_context:null,init:function q(s){var t=this;this._logger=c.getLogger(k);this._parent(s,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context");this._search=new e(this._searchCallBack.bind(this));a.getXMLValues("DELWebMfgItemDefUI/DELWebMfgItemDefDropTypeConfig",function r(u){t._dropTypes=u})},beginExecute:function p(){this._logger.log("beginExecute")},execute:function n(){var r=this._context.getMBOMView().getAcceptedTypes();this._logger.log("execute");this._search.activate("MBOM search",r,null)},endExecute:function j(){this._logger.log("endExecute")},_searchCallBack:function f(t){var s=this,r;t.forEach(function(v){var u=v.id,w=l.references.get(u);if(w){s._searchCallBackAddSuccess(w)}else{r=new g({PID:v.id});r.fetch({proxy:"passport",headers:a.getHeaders(),wait:true,onComplete:function(x){l.references.add(x);s._searchCallBackAddSuccess(x)}})}})},_searchCallBackAddSuccess:function o(r){if(this._context.getMBOMView().isAcceptedType(r)){r.setDisplayModel({asRootInTableView:true})}else{d.AlertManager.add({className:"info",message:h.getNLSValue("Info.ElementNotAdded.Title"),})}},});return k});define("DS/DELWebMfgItemDefCommands/ExpandAllCommand",["UWA/Core","DS/Logger/Logger","UWA/Class/Options","DS/ApplicationFrame/Command","DS/DELWebMfgAssetsDefModelServices/CollectionUtils"],function(c,b,g,a,f){var e=a.extend(g,{name:"ExpandAllCommand",_logger:null,init:function j(k){this._parent(k,{mode:"exclusive",isAsynchronous:false});this._logger=b.getLogger(e);this._logger.log("init");this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function i(){var k,l;this._logger.log("beginExecute");if(!this._context){this._logger.warn("ERROR: No context.");return}this._view=this._context.getCurrentView();this._references=this._context.getReferenceCollection();this._instances=this._context.getInstanceCollection();k=this._context.getMBOMTreeListView();l=this._context.getBodyTreeListView();if(!k||!l){this._logger.warn("ERROR: No treelistview");return}this._selectedMBOM=k.getDocument().getSelectedNodes();this._selectedBODY=l.getDocument().getSelectedNodes();if(f.VIEWS.MBOM===this._view){this._selected=this._selectedMBOM;this._selectedTLV=k}else{if(f.VIEWS.BODY===this._view){this._selected=this._selectedBODY;this._selectedTLV=l}else{this._logger.warn("ERROR: No view defined");return}}},execute:function h(){this._logger.log("execute");if(!c.is(this._selected,"array")){return}this._selectedTLV.utils.prepareUpdate();this._selected.forEach(function(k){k.expandAll()},this);this._selectedTLV.utils.pushUpdate()},endExecute:function d(){this._logger.log("endExecute")},});return e});define("DS/DELWebMfgItemDefCommands/CreateAssemblyAndScopeCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","DS/Core/Events","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","DS/DELWebMfgAssetsDefModelServices/ModelUtils","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ExternalEventsUtils"],function(f,b,c,d,g,a,k,j,e){var i=b.extend(k,{name:"CreateAssemblyAndScopeCommand",_logger:null,_context:null,init:function n(o){this._logger=c.getLogger(i);this._parent(o,{mode:"exclusive",isAsynchronous:false,})},beginExecute:function m(){var o;this._logger.log("beginExecute");this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context given");return}this.connections=this._context.getConnectionCollection();this.references=this._context.getReferenceCollection();this.instances=this._context.getInstanceCollection();o=this._context.getBodyTreeListView();if(!o){this._logger.warn("ERROR: Could not retrieve body treelist view");return}this.selectedNodes=o.getDocument().getSelectedNodes()},execute:function l(){var o=this;this._logger.log("execute");if(!f.is(o.selectedNodes,"array")){this._logger.warn("ERROR: selected nodes is not an array");return}if(0>=o.selectedNodes.length){this._logger.info("No nodes selected");return}this.selectedNodes.forEach(function p(r){var u=r.getReferencePID(),t={productID:r.getReferencePID(),name:r.getLabel()};if(!f.is(u,"string")){o._logger.warn("ERROR: Could not get pid");return}a.webServiceRequest({url:"modeler/ppr/createassemblyandscope",method:"POST",context:o,headers:a.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),data:f.Json.encode(t),onFailure:function q(){},onComplete:function s(v){if(f.is(v,"object")){v=f.merge(v,{instancesAndReferences:[],connections:[]});v.instancesAndReferences.forEach(function(y){var w=f.is(y.attributesValue)?y.attributesValue:y,x,z;if(w.hasOwnProperty("isInstanceOf")){x=o.instances.get(w.PID);if(!f.is(x)){}else{x.set(w)}}else{z=o.references.get(w.PID);if(!f.is(z)){z=new g(f.merge(w,{queriedForChildren:true,queriedForDocuments:true}));if(f.is(z)){o.references.add(z);z.setDisplayModel({asRootInTableView:true})}}else{z.set(w)}}});v.connections.forEach(function(x){var w=j.parseConnection(x);o.connections.add(w)});e.emitCreateInstanceEvent(v.instancesAndReferences);e.emitCreateConnectionEvent(v.connections)}}})},this)},endExecute:function h(){this._logger.log("endExecute")}});return i});define("DS/DELWebMfgItemDefCommands/OriginRemoveCommand",["DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils",],function(c,b,h,d,e,k,i,f){var g=d.extend(k,{name:"OriginRemoveCommand",_logger:null,_context:null,init:function n(o){this._logger=e.getLogger(g);this._parent(o,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function m(){this._logger.log("beginExecute")},execute:function l(){var r=this;this._logger.log("execute");if(false!==h.is(b._view)){var o=b._view;var q=o._context.getConnectionCollection();var p=o._actionView.getTreeListView().getDocument().getSelectedNodes();p.forEach(function(s){var u=s.getReferencePID();var t=q.findWhere({from:o._fromPID,to:u,type:"HistorizationLinkRefRef",});if(h.is(t)){t.destroy({proxy:"passport",headers:c.getHeaders(),wait:true,onComplete:function(){},onFailure:r._onFailure.bind(r),})}})}},endExecute:function j(){this._logger.log("endExecute")},_onFailure:function a(o,p){f.AlertManager.add({className:"info",message:i.getNLSValue("Info.ElementNotRemoved.Title"),})},});return g});define("DS/DELWebMfgItemDefCommands/CapableResourceBLCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/DELWebMfgAssetsDefModelServices/Resources","DS/Logger/Logger","DS/DELWebMfgAssetsDefUIServices/UIUtils","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/ModelUtils",],function(a,g,c,h,d,e,l,b){var f=c.extend(l,{name:"CapableResourceBLCommand",_logger:null,_context:null,init:function o(p){var q=this;q._logger=d.getLogger(f);q._parent(p,{mode:"exclusive",isAsynchronous:false,});q._context=q.getOption("context")},beginExecute:function n(){this._logger.log("beginExecute")},execute:function m(){this._logger.log("execute");if(false!==g.is(a._view)){var p=a._fromPID;b.webServiceRequest({url:"modeler/ppr/getResourcesFromBL",method:"POST",context:this,onComplete:this.getCapableResourceComplete,onFailure:this.getCapableResourceFailure,data:g.Json.encode({pid:p}),})}},endExecute:function i(){this._logger.log("endExecute")},getCapableResourceComplete:function k(p){if(0===p.resourceIDS.length){e.AlertManager.add({className:"info",message:h.getNLSValue("Info.CapableResourceBL.Empty"),})}else{if(false!==g.is(a._view)){a._view._search.activate("Capable Resource search",null,p.resourceIDS)}}},getCapableResourceFailure:function j(p){this._logger.warn("ERROR: CapableResourceBL failed");this._logger.log(p);e.AlertManager.add({className:"error",message:h.getNLSValue("Error.CapableResourceBL.Failure"),})},});return f});define("DS/DELWebMfgItemDefCommands/CreateScopeCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/Core/Events","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefConnectionModel/ConnectionModel","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ExternalEventsUtils"],function(b,h,r,l,j,p,q,s,a,g,k){var c=h.extend(l,{name:"CreateScopeCommand",_logger:null,init:function m(t){this._logger=r.getLogger(c);this._parent(t,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function n(){var t,u;this._logger.log("beginExecute");if(!this._context){this._logger.warn("ERROR: No context.");return}this._selectedMBOM=[];this._selectedBODY=[];t=this._context.getMBOMTreeListView();u=this._context.getBodyTreeListView();if(!t||!u){this._logger.warn("ERROR: Could not retrieve treelistviews");return}this._mbomTree=t.getDocument();this._bodyTree=u.getDocument();if(!this._mbomTree||!this._bodyTree){this._logger.warn("ERROR: Could not retrieve trees");return}this._selectedMBOM=this._mbomTree.getSelectedNodes();this._selectedBODY=this._bodyTree.getSelectedNodes();if(!b.is(this._selectedMBOM,"array")||!b.is(this._selectedBODY,"array")){this._logger.warn("ERROR: Bad selection.");this._selectedMBOM=this._selectedMBOM||[];this._selectedBODY=this._selectedBODY||[]}},execute:function e(){var w=this,v,u,y,x,t=null;this._logger.log("execute");v=this._selectedMBOM.length;u=this._selectedBODY.length;y=this._mbomTree.getXSO();x=this._bodyTree.getXSO();if(!w._mbomTree.areRelationsLoaded(this._selectedMBOM)){q.AlertManager.add({className:"error",message:p.getNLSValue("Error.RelationsNotLoaded.Title")});return}if(0===v&&0===u){q.AlertManager.add({className:"info",message:p.getNLSValue("Info.SelectAssembly.Title"),});t=y.onPostAdd(function(z){y.unsubscribe(t);if(!w._mbomTree.areRelationsLoaded(z)){q.AlertManager.add({className:"error",message:p.getNLSValue("Error.RelationsNotLoaded.Title")});return}q.AlertManager.add({className:"info",message:p.getNLSValue("Info.SelectProductOrPart.Title"),});t=x.onPostAdd(function(A){x.unsubscribe(t);w._createScope(z,A)});widget.body.removeEvent("keydown");widget.body.addEvent("keydown",function(A){w._onEscapePressed(A,t,x)})});widget.body.addEvent("keydown",function(z){w._onEscapePressed(z,t,y)})}else{if(0===u){q.AlertManager.add({className:"info",message:p.getNLSValue("Info.SelectProductOrPart.Title"),});t=x.onPostAdd(function(z){x.unsubscribe(t);w._createScope(w._selectedMBOM[0],z)});widget.body.addEvent("keydown",function(z){w._onEscapePressed(z,t,x)})}else{if(0===v){q.AlertManager.add({className:"info",message:p.getNLSValue("Info.SelectAssembly.Title"),});t=y.onPostAdd(function(z){y.unsubscribe(t);w._createScope(z,w._selectedBODY[0])});widget.body.addEvent("keydown",function(z){w._onEscapePressed(z,t,y)})}}}},_onEscapePressed:function f(v,u,t){var w;if(!v){return}if(!t){return}if(!u){return}w=v.keyCode;if(27===w){t.unsubscribe(u)}q.AlertManager.add({className:"info",message:p.getNLSValue("Info.ExitScope.Title")});widget.body.removeEvent("keydown")},_createScope:function d(M,v){var B=this,z,G,u=g.references,x=g.instances,E=g.connections,t,y,A,F,H,L,C,w=false,N=b.Class.Promise.deferred();widget.body.removeEvent("keydown");if(!M||!v){t("ERROR: Nodes are not valid.");return N.promise}if(Array.isArray(M)&&(M.length>0)){M=M[0]}if(Array.isArray(v)&&(v.length>0)){v=v[0]}z=M.getReferencePID();G=v.getReferencePID();t=function t(O){var P=p.getNLSValue("Error.ScopeFailed.Title");if(b.is(O)&&b.is(O.message,"string")){P=P+"<br>"+O.message}B._logger.warn("ERROR: Scope creation failed");B._logger.warn(O);q.AlertManager.add({className:"error",message:P});N.reject()};if(false===this._canCreateScope(z,G)){t("ERROR: Can create Scope");return N.promise}if(!b.is(z,"string")||!b.is(G,"string")){t("ERROR: Could not get PIDs");return N.promise}if(!E){t("ERROR: Could not get connections");return N.promise}if(M.isUnderScope()&&v.isUnderScope()){H=M.getFirstParentWithAScopeNode();L=H.getScopedNode();L=(b.is(L,"array"))?L[0]:L;C=v.getFirstParentWithAScopeNode();w=(C.getID()===L.getID())}if(w){y=M.getInstancePID();A=v.getPathToScope();a.webServiceRequest({url:"modeler/ppr/createscopeandimplementlink",method:"POST",headers:a.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),data:b.Json.encode({productID:G,processID:z,processInstancePID:y,productPath:JSON.stringify(A),}),context:this,onFailure:function K(O){t(O)},onTimeout:function I(O){t(O)},onCancel:function D(O){t(O)},onComplete:function J(O){if(b.is(O,"object")){O=b.merge(O,{instancesAndReferences:[],connections:[]});if(O.connections.length===0){t("ERROR: modeler/ppr/createscopeandimplementlink returned nothing")}else{O.instancesAndReferences.forEach(function(R){var P=b.is(R.attributesValue)?R.attributesValue:R,Q,S;if(P.hasOwnProperty("isInstanceOf")){Q=x.get(P.PID);if(!b.is(Q)){}else{Q.set(P)}}else{S=u.get(P.PID);if(!b.is(S)){}else{S.set(P)}}});O.connections.forEach(function(Q){var P=g.parseConnection(Q);E.add(P)});a.setForceDBMode(true);N.resolve()}k.emitCreateInstanceEvent({attributesValue:O.instancesAndReferences[0]});k.emitCreateConnectionEvent(O.connections)}else{t("ERROR: modeler/ppr/createscopeandimplementlink returned nothing")}}})}else{F={type:"PROCESS_ProductImplementLink",IDFrom:z,IDTo:G,};E.create(null,{proxy:"passport",wait:true,type:"json",headers:a.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),data:b.Json.encode(F),onFailure:function K(O,P){t(P)},onTimeout:function I(O,P){t(P)},onCancel:function D(O,P){t(P)},onComplete:function(){B._logger.log("scope creation successful");q.AlertManager.add({className:"success",message:p.getNLSValue("Success.ScopeCreated.Title"),});N.resolve()}})}return N.promise},endExecute:function i(){this._logger.log("endExecute")},_canCreateScope:function o(w,x){var v=false,t,u=g.connections.findWhere({from:w,type:"ProductImplementLink",});if(b.is(u)){v=true;q.AlertManager.add({className:"error",message:p.getNLSValue("Error.ScopeFailed.Title")+" : "+p.getNLSValue("Error.ScopeFailed.scopeFromMFGItem"),})}t=g.connections.findWhere({to:x,from:w,type:"ProductImplementLink",});if(b.is(t)){v=true;q.AlertManager.add({className:"error",message:p.getNLSValue("Error.ScopeFailed.Title")+" : "+p.getNLSValue("Error.ScopeFailed.scopeToProd"),})}if(true===v){this._logger.warn("ERROR: Scope creation failed");return false}return true}});return c});define("DS/DELWebMfgItemDefCommands/AlternateAddCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/ModelUtils",],function(a,e,c,d,g,b){var j=c.extend(g,{name:"AlternateAddCommand",_logger:null,_context:null,init:function k(l){var m=this;this._logger=d.getLogger(j);this._parent(l,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function i(){this._logger.log("beginExecute")},execute:function h(){this._logger.log("execute");if(false!==e.is(a._view)){a._view._search.activate("Alternate search",null,null)}},endExecute:function f(){this._logger.log("endExecute")},});return j});define("DS/DELWebMfgItemDefCommands/ReframeOnCommand",["UWA/Core","DS/Logger/Logger","UWA/Class/Options","DS/ApplicationFrame/Command",],function(c,b,e,a){var i=a.extend(e,{name:"ReframeOnCommand",_logger:null,_context:null,_view:null,_selected:null,_graph:null,init:function h(j){if(b){this._logger=b.getLogger(i)}this._parent(j,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function g(){if(this._logger){this._logger.log("beginExecute")}if(!this._context){this._logger.warn("ERROR: No context.");return}this._view=null;this._selected=null;this._graph=null;this._view=this._context.getCurrentView();if("MBOM"===this._view){this._graph=this._context.getMBOMGraphView()}else{if("BODY"===this._view){this._graph=this._context.getBodyGraphView()}else{this._logger.warn("No focus");return}}var k=this._graph.getModel();if(!k){this._logger.warn("ERROR: No model");return}var j=k.getXSO();if(!j){this._logger.warn("ERROR: No XSO");return}var l=j.get();if(!c.is(l,"array")){this._logger.warn("ERROR: selected is not an array");return}this._selected=l},execute:function f(){if(this._logger){this._logger.log("execute")}if(!c.is(this._selected,"array")){this._logger.warn("ERROR: selected is not an array");return}if(!this._graph){this._logger.warn("ERROR: No Graph");return}if(0>=this._selected.length){this._logger.log("ERROR: No selected nodes");return}this._graph.reframeOn()},endExecute:function d(){if(this._logger){this._logger.log("endExecute")}},});return i});define("DS/DELWebMfgItemDefCommands/UnassignProductCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefUIServices/UIUtils"],function(f,b,d,j,i,a,g,e,c){var h=b.extend(j,{name:"UnassignProductCommand",_selectedMBOMInst:[],init:function m(n){this._parent(n,{mode:"exclusive",isAsynchronous:false,})},beginExecute:function l(){this._selectedMBOMInst=i.getSelectedInsts({views:i.VIEWS.MBOM})},execute:function k(){var o=[];this._selectedMBOMInst.forEach(function n(q){var s=i.getImplementLinks(q.id);o.push(i.getReferenceFromInstancePID(q.id).id);if(f.is(s,"array")){s.forEach(function r(u){u.destroy({proxy:"passport",headers:a.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),wait:true,onFailure:function t(){c.AlertManager.add({className:"error",message:g.getNLSValue("LinksUI.DeleteFailure")})},onComplete:function v(){c.AlertManager.add({className:"success",message:g.getNLSValue("LinksUI.DeleteSuccess")})},logMessage:g.getNLSValue("LinksUI.LogMessage")})})}});o=a.unique(o);o.forEach(function p(q){var s=i.getScopeLinks(q);if(f.is(s,"array")){s.forEach(function r(u){u.destroy({proxy:"passport",headers:a.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),wait:true,onFailure:function t(){c.AlertManager.add({className:"error",message:g.getNLSValue("LinksUI.DeleteFailure")})},onComplete:function v(){c.AlertManager.add({className:"success",message:g.getNLSValue("LinksUI.DeleteSuccess")})},logMessage:g.getNLSValue("LinksUI.LogMessage")})})}})}});return h});define("DS/DELWebMfgItemDefCommands/AssignProductCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/Core/Events","DS/DELWebMfgAssetsDefUIControls/AssignProductMfgItemDialogUI","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefConnectionModel/ConnectionModel","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ExternalEventsUtils"],function(d,g,s,n,i,j,a,r,t,u,f,l){var m=g.extend(n,{name:"AssignProductCommand",_logger:null,_context:null,_assignMfgType:null,init:function o(v){this._logger=s.getLogger(m);this._parent(v,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function p(){var w,z,y,x;var v=this.getArguments();this._logger.log("beginExecute");if(!this._context){this._logger.warn("ERROR: No context.");return}if(d.is(v,"array")){if(0<v.length){v.forEach(function(A){if(!d.is(A)||!d.is(A.ID,"string")||!d.is(A.Value,"string")){return}if("ReferenceType"===A.ID){this._assignMfgType=A.Value}},this)}}w=this._context.getMBOMTreeListView();x=this._context.getBodyTreeListView();if(!w||!x){this._logger.warn("ERROR: Could not retrieve treelistviews");return}this._mbomTree=w.getDocument();this._bodyTree=x.getDocument();if(!this._mbomTree||!this._bodyTree){this._logger.warn("ERROR: Could not retrieve trees");return}this._selectedMBOM=this._mbomTree.getSelectedNodes();this._selectedBODY=this._bodyTree.getSelectedNodes();if(!d.is(this._selectedMBOM,"array")||!d.is(this._selectedBODY,"array")){this._logger.warn("ERROR: Bad selection.");this._selectedMBOM=this._selectedMBOM||[];this._selectedBODY=this._selectedBODY||[]}},_assignProduct:function b(w,x,v){w=(d.is(w,"array")&&(w.length>0))?w[0]:w;x=d.is(x,"array")?x:[x];if(a.isAKindOf(w.getReferenceType(),"Provide")){this.createImplementLink(w,x)}else{this._createProvideAndImplementLink(w,x,v)}},execute:function e(){var v=this,x,w;this._logger.log("execute");x=this._mbomTree.getXSO();w=this._bodyTree.getXSO();if(!this._mbomTree.areRelationsLoaded(this._selectedMBOM)){t.AlertManager.add({className:"error",message:r.getNLSValue("Error.RelationsNotLoaded.Title")});return}j.createAssignProductUI(this._assignMfgType,w,x,function(z,A,y){v._assignProduct(z,A,y)})},_onFailure:function c(v){t.AlertManager.add({className:"error",message:r.getNLSValue("Error.ErrorLinkCreation.Title"),})},_createProvideAndImplementLink:function k(y,C,w){var v=d.Class.Promise.deferred(),A=widget.getValue("oneDelmiaAggregationMode"),B,z;y.setState({state:"expandingState"});if(C[0].isRoot()){t.AlertManager.add({className:"error",message:r.getNLSValue("Error.CannotCreateImplementLink.Title"),})}B=function B(G){var F={stackedReferences:[],stackedInstances:[],stackedConnections:[]},E,D=function D(){var H={instancePID:E};i.publish({event:"DELWebMfgAssetsDefUI/CreateInstanceAndLink",data:H});l.emitCreateInstanceEvent(G.instancesAndReferences);l.emitCreateConnectionEvent(G.connections);t.AlertManager.add({className:"success",message:r.getNLSValue("Success.ProductAssigned.Title"),})};if(d.is(G,"object")){G=d.merge(G,{instancesAndReferences:[],connections:[]});G.instancesAndReferences.forEach(function(J){var H=J.attributesValue,I,L;if(H.hasOwnProperty("isInstanceOf")){I=f.instances.get(H.PID);if(!d.is(I)){var K=d.merge({queriedForConnections:true},H);F.stackedInstances.push(K);E=H.PID;if(J["to.attributesValue"]){var M=d.merge({queriedForChildren:true,queriedForConnections:true,queriedForDocuments:false},J["to.attributesValue"]);F.stackedReferences.push(M)}}else{F.stackedInstances.push(H)}}else{L=f.references.get(H.PID);if(!d.is(L)){var M=d.merge({queriedForChildren:true,queriedForConnections:true,queriedForDocuments:false},H);F.stackedReferences.push(M)}else{L.set(H)}}});G.connections.forEach(function(I){var H=f.parseConnection(I);F.stackedConnections.push(H)});F.onComplete=D;F.context=this;f.addToCollections(F)}a.setForceDBMode(true);v.resolve()};z={processID:y.getReferencePID(),type:w.V_Type,oneDelmiaAggregationMode:A==="true"};C.forEach(function x(E){var F=d.clone(z);F.productPath=d.Json.encode(E.getPathToScope());F.productRefPID=E.getReferencePID();F.attributes=w;if(!w.hasOwnProperty("PLMEntity.V_Name")){w["PLMEntity.V_Name"]="Mfg_"+E.getLabel()}a.webServiceRequest({url:"modeler/ppr/assignproduct",method:"POST",context:this,data:d.Json.encode(F),onComplete:B,onFailure:function D(){this._onFailure();v.reject()},onTimeout:function H(){this._onFailure();v.reject()},onCancel:function G(){this._onFailure();v.reject()},})},this);return v.promise},createImplementLink:function q(y,A){var w=this,v=d.Class.Promise.deferred(),z;y.setState({state:"expandingState"});if(y.getInstancePID()===null){t.AlertManager.add({className:"error",message:r.getNLSValue("Error.ProvidedReferenceNode.Title"),});return}z={IDFrom:y.getInstancePID(),type:"PROCESS_ProductImplementLinkOcc",};A.forEach(function x(E){var C=d.Json.encode(d.extend(z,{IDTo:d.Json.encode(E.getPathToScope()),})),B=new u();if(!E.isScopedOrUnderScope()){t.AlertManager.add({className:"error",message:r.getNLSValue("Error.NotScoped.Title"),})}else{B.save(null,{proxy:"passport",wait:true,type:"json",headers:a.getHeaders(),data:C,onFailure:function D(I,J){w._onFailure(J);v.reject()},onTimeout:function H(I,J){w._onFailure(J);v.reject()},onCancel:function G(I,J){w._onFailure(J);v.reject()},onComplete:function F(I){f.connections.add(I);t.AlertManager.add({className:"success",message:r.getNLSValue("Success.ProductAssigned.Title"),});y.setState({state:"noChildren"});y.updateBI();a.setForceDBMode(true);v.resolve()}})}},this);return v},endExecute:function h(){this._logger.log("endExecute")},});return m});define("DS/DELWebMfgItemDefCommands/ManageInconsistentLinksCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/DELWebMfgAssetsDefUIControls/ManageInconsistentLinksUI","DS/DELWebMfgAssetsDefUIServices/UIUtils"],function(g,f,d,b){var a=f.extend({name:"ManageInconsistentLinksCmd",init:function e(h){b.CommandsCheckHeaderManager.registerCmd(h.ID,this);this._parent(h,{mode:"exclusive",isAsynchronous:false,});if(!g.is(d._context)){d.init(h)}this.onStateChange(this._stateChanged)},_stateChanged:function c(){d.toggle(this)}});return a});define("DS/DELWebMfgItemDefCommands/ReframeCommand",["UWA/Core","DS/Logger/Logger","UWA/Class/Options","DS/ApplicationFrame/Command",],function(d,b,f,a){var c=a.extend(f,{name:"ReframeCommand",_logger:null,_context:null,_view:null,_selected:null,_graph:null,init:function i(j){if(b){this._logger=b.getLogger(c)}this._parent(j,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function h(){if(this._logger){this._logger.log("beginExecute")}if(!this._context){this._logger.warn("ERROR: No context.");return}this._view=null;this._selected=null;this._graph=null;this._view=this._context.getCurrentView();if("MBOM"===this._view){this._graph=this._context.getMBOMGraphView()}else{if("BODY"===this._view){this._graph=this._context.getBodyGraphView()}else{this._logger.warn("No focus");return}}},execute:function g(){if(this._logger){this._logger.log("execute")}if(!this._graph){this._logger.warn("ERROR: No Graph");return}this._graph.reframeAll()},endExecute:function e(){if(this._logger){this._logger.log("endExecute")}},});return c});define("DS/DELWebMfgItemDefCommands/MFNViewCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil"],function(a,h,l,b,d,k,e,g){var j=l.extend({name:"MFNViewCommand",_logger:null,_context:null,init:function m(n){var o;e.CommandsCheckHeaderManager.registerCmd(n.ID,this);this._parent(n);this._context=n.context;if(h.is(d)){this._logger=d.getLogger(j)}this.viewName="Unknown";if(h.is(n.arguments)){if(n.arguments.length>0){if(n.arguments[0].ID==="Name"){this.viewName=n.arguments[0].Value}}}if(g.isViewPersistanceOn()){o=(widget.getValue("MFNView"+this.viewName)==="true")?true:false;this.setState(o);e.BlocksViewCmdManager.registerCmdState(this.viewName,o)}else{this.setState(true);e.BlocksViewCmdManager.registerCmdState(this.viewName,true)}this.onStateChange(this._stateChanged)},_stateChanged:function i(){var n;this._logger.log(this.viewName+" view Command State Changed");n=this.getState();e.BlocksViewCmdManager.registerCmdState(this.viewName,n);if(n){widget.setValue("MFNView"+this.viewName,"true");this._check()}else{widget.setValue("MFNView"+this.viewName,"false");this._uncheck()}},_check:function f(){var n=e.BlocksViewCmdManager.getActiveCmdNames(this.viewName);var o=n.length;if(o===1){this._context.openMFNView(this.viewName)}},_uncheck:function c(){var n=e.BlocksViewCmdManager.getActiveCmdNames(this.viewName);var o=n.length;if(o===0){this.setState(true)}else{this._context.closeMFNView(this.viewName)}}});return j});define("DS/DELWebMfgItemDefCommands/HideCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefUIServices/UIUtils",],function(d,a,b,h,g,c){var f=a.extend(h,{name:"HideCommand",_logger:null,init:function k(l){this._logger=b.getLogger(f);this._parent(l,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function j(){this._logger.log("beginExecute");this._mbomNodes=this._context.getMBOMTreeListView().getDocument().getSelectedNodes();this._bodyNodes=this._context.getBodyTreeListView().getDocument().getSelectedNodes()},execute:function i(){var q=this._context.getBodyTreeListView().getRoots().filter(function(r){return !r._isHidden}),n,l,m=q.length,o=this._bodyNodes.length,p=g.getSelectedRefs({views:g.VIEWS.AUXILIARY});this._logger.log("execute");c.CommandsCheckHeaderManager.getCmd("AlternateCommand").setState(false);c.CommandsCheckHeaderManager.getCmd("OriginCommand").setState(false);c.CommandsCheckHeaderManager.getCmd("CapableResourceCommand").setState(false);this._mbomNodes.forEach(function(r){if(!r.isRoot()){this._logger.warn("Tried to hide a non root node");return}n=r.getReferencePID();l=g.references.get(n);l.setDisplayModel({asRootInTableView:false})},this);this._bodyNodes.forEach(function(r){if(!r.isRoot()){this._logger.warn("Tried to hide a non root node");return}n=r.getReferencePID();l=g.references.get(n);l.setDisplayModel({asRootInBodyView:false})},this);p.forEach(function(r){r.setDisplayModel({selectedInAuxiliaryView:false,asRootInAuxiliaryView:false})});if(o>=m){this._context.getBodyDropView().show()}},endExecute:function e(){this._logger.log("endExecute")},});return f});define("DS/DELWebMfgItemDefCommands/ToggleOverviewCommand",["UWA/Core","DS/Logger/Logger","DS/ApplicationFrame/Command","UWA/Class/Options",],function(c,b,a,e){var h=a.extend(e,{name:"ToggleOverviewCommand",_logger:null,init:function i(j){if(b){this._logger=b.getLogger(h)}this._parent(j,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function g(){if(this._logger){this._logger.log("beginExecute")}if(!this._context){this._logger.warn("ERROR: No context.");return}this._view=this._context.getCurrentView()},execute:function f(){if(this._logger){this._logger.log("execute")}if(!this._context){this._logger.warn("ERROR: No context.");return}var k=null;var j=this._view;if("MBOM"===j){k=this._context.getMBOMGraphView()}else{if("BODY"===j){k=this._context.getBodyGraphView()}}if(k){k.toggleOverview()}},endExecute:function d(){if(this._logger){this._logger.log("endExecute")}},});return h});define("DS/DELWebMfgItemDefCommands/AlternateRemoveCommand",["DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils"],function(c,b,g,d,e,k,h,f){var j=d.extend(k,{name:"AlternateRemoveCommand",_logger:null,_context:null,init:function n(o){this._logger=e.getLogger(j);this._parent(o,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context")},beginExecute:function m(){this._logger.log("beginExecute")},execute:function l(){var r=this;this._logger.log("execute");if(false!==g.is(b._view)){var o=b._view;var q=o._context.getConnectionCollection();var p=o._actionView.getTreeListView().getDocument().getSelectedNodes();p.forEach(function(s){var u=s.getReferencePID();var t=q.findWhere({from:o._fromPID,to:u,type:"MfgProcessAlternate",});if(g.is(t)){t.destroy({proxy:"passport",headers:c.getHeaders(),wait:true,onComplete:function(){},onFailure:r._onFailure.bind(r),})}})}},endExecute:function i(){this._logger.log("endExecute")},_onFailure:function a(o,q,t,s){var r=h.getNLSValue("Info.ElementNotRemoved.Title");var p="info";if(q){if("BL"===q.errorType&&q.errorMessage){p="error";r=q.errorMessage}}f.AlertManager.add({className:p,message:r})},});return j});define("DS/DELWebMfgItemDefCommands/RemoveCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefUIServices/UIUtils",],function(e,b,c,j,h,a,f,d){var i=b.extend(j,{name:"RemoveCommand",_logger:null,init:function m(n){this._logger=c.getLogger(i);this._parent(n,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context");if(!this._context){this._logger.warn("No context given");return}},beginExecute:function l(){this._logger.log("beginExecute");this._mbomTree=null;var n=this._context.getMBOMTreeListView();if(!n){this._logger.warn("Could not get mbom tlv");return}this._mbomTree=n.getDocument();if(!this._mbomTree){this._logger.warn("Could not get mbom tree");return}},execute:function k(){this._logger.log("execute");if(!this._mbomTree){this._logger.warn("Could not get mbom tree");return}var o=this._mbomTree.getSelectedNodes();if(!e.is(o,"array")){this._logger.warn("Selected nodes should be an array");return}if(1>o.length){this._logger.warn("No selected Nodes");return}var n=this;o.forEach(function(s){var q=s.getInstancePID();var p=h.instances.get(q);if(!p){this._logger.log("remove on reference. select instance");d.AlertManager.add({className:"info",message:f.getNLSValue("Info.SelectInstance.Title"),});return}p.destroy({proxy:"passport",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",SecurityContext:a.getSecurityContext()},wait:true,onFailure:function r(u,v){n._logger.warn("ERROR: Remove failed : "+v);d.AlertManager.add({className:"error",message:f.getNLSValue("Error.RemoveFailed.Title"),})},onComplete:function t(){n._logger.log("Remove successful");d.AlertManager.add({className:"success",message:f.getNLSValue("Success.Removed.Title"),})},})},this)},endExecute:function g(){this._logger.log("endExecute")},});return i});define("DS/DELWebMfgItemDefCommands/CommandsManager",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","UWA/Class/Options","UWA/Class/Listener","DS/Core/Events","DS/ApplicationFrame/CommandsManager","DS/DELWebMfgAssetsDefModelServices/BehaviorUtil","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefModelServices/ModelPreferences","DS/DELWebMfgAssetsDefUIServices/UIUtils","text!DS/DELWebMfgItemDefUI/assets/config/CommandsAvailability.json",],function(h,z,D,e,v,g,s,c,r,n,f,t,E,w){var a=z.singleton(v,g,{name:"CommandsManager",uninitializedCalls:"ignore",_logger:null,_context:null,_mbomTree:null,_bodyTree:null,_commands:null,_validChildTypesMap:null,_typeCommandMap:{},init:function x(J){var O,N,L,M,K;J=J||{};this._parent(J);this._logger=D.getLogger(a);this._context=J.context;this._mbomTree=this._context.getMBOMTreeListView().getDocument();this._bodyTree=this._context.getBodyTreeListView().getDocument();this._auxViewTree=E.getMGAElement("TreeUI").getDocument();w=h.Json.decode(w);this._commands=w.managedCommands;this._notOnCloud=w.notOnCloud;O=this._mbomTree.getXSO();N=this._bodyTree.getXSO();L=this._auxViewTree.getXSO();O.onAdd(this.onSelectionChanged.bind(this));O.onRemove(this.onSelectionChanged.bind(this));N.onAdd(this.onSelectionChanged.bind(this));N.onRemove(this.onSelectionChanged.bind(this));L.onAdd(this.onSelectionChanged.bind(this));L.onRemove(this.onSelectionChanged.bind(this));this.listenTo(n.references,"onChange:displayModel",this.onReferenceChange.bind(this));s.subscribe({event:"/DELWebMfgItemDefUI/RootCreationEnabled/"},this.enableRootCreation.bind(this));s.subscribe({event:"/DELWebMfgItemDefUI/RootCreationDisabled/"},this.disableRootCreation.bind(this));K=this;this._initState();this._generateCommandsMap();this.onGetChildTypesComplete=function(P){K._validChildTypesMap=P;K._processCustomInstanceConfig()};M=widget.getValue("oneDelmiaAggregationMode");f.webServiceRequest({url:"modeler/ppr/getChildTypes",method:"GET",data:{oneDelmiaAggregationMode:M},onComplete:this.onGetChildTypesComplete})},rebindXSO:function j(){var L,K,J;a._mbomTree=a._context.getMBOMTreeListView().getDocument();a._bodyTree=a._context.getBodyTreeListView().getDocument();a._auxViewTree=E.getMGAElement("TreeUI").getDocument();L=a._mbomTree.getXSO();K=a._bodyTree.getXSO();J=a._auxViewTree.getXSO();L.onAdd(a.onSelectionChanged.bind(a));L.onRemove(a.onSelectionChanged.bind(a));K.onAdd(a.onSelectionChanged.bind(a));K.onRemove(a.onSelectionChanged.bind(a));J.onAdd(a.onSelectionChanged.bind(a));J.onRemove(a.onSelectionChanged.bind(a))},_processCustomInstanceConfig:function m(){var P,O,M,J,N,L,K=t.CustomInstanceList;if(h.is(K)){for(P in K){if(K.hasOwnProperty(P)){for(O in K[P]){if(K[P].hasOwnProperty(O)){M=K[P][O];N=a._validChildTypesMap;L=a._validChildTypesMap[P];if(h.is(L)){J=L.indexOf(O);if(J>=0){if(!M){L.splice(J,1)}}else{if(M){L.push(O)}}}else{if(M){N[P]=[O]}}}}}}}},_generateCommandsMap:function F(){var M=c.getCommands(this._context),K=null,L,N,J,O;for(L in M){if(h.is(L)){N=c.getCommand(L,this._context);if(h.is(N)){J=N.getArguments();if(h.typeOf(J)==="array"){if(J.length>0){O=J[0];if(h.is(O)){if(h.is(O.ID)){if(O.ID==="ReferenceType"){if(h.is(O.Value)){K=O.Value}}}}}}if(h.is(K)){this._typeCommandMap[K.split("/")[1]]=L;K=null}}}}},_onFocusChange:function o(J){this.onSelectionChanged();if(this._context.VIEWS.ACTION===J){this._setCommandStates(w.action);this._manageGraphCommandsAvailability(this._context.VIEWS.ACTION)}else{if(this._context.VIEWS.BODY===J){this._manageGraphCommandsAvailability(this._context.VIEWS.BODY)}else{if(this._context.VIEWS.MBOM===J){this._manageGraphCommandsAvailability(this._context.VIEWS.MBOM)}}}},_manageGraphCommandsAvailability:function l(J){this._setState("Reframe",this._context.isInGraphMode(J));this._setState("ReframeOn",this._context.isInGraphMode(J));this._setState("ToggleOrientation",this._context.isInGraphMode(J));this._setState("ToggleOverview",this._context.isInGraphMode(J))},_initState:function u(){this._setCommandStates(w.initial)},onReferenceChange:function I(M){var J,N,L,K;J=M.get("displayModel");if(!J){return}N=J.changedAttributes();if(!N){return}L=N.asRootInTableView;if(false===L){K=this._mbomTree.getRoots();if(1>K.length){this._setState("InsertCreateAssembly",true)}}},convertFromNodeToModel:function b(L){var K=null,J;J=n.references.where({PID:L._referencePID});if(h.is(J,"array")){if(1===J.length){K=J[0]}}if(!h.is(K)){J=n.instances.where({PID:L._referencePID});if(h.is(J,"array")){if(1===J.length){K=J[0]}}}return K},_getValidChildTypeCommands:function G(K){var M,J=[],L=h.is(this._validChildTypesMap[K])?this._validChildTypesMap[K]:[];for(M in this._typeCommandMap){if(L.indexOf(M)>=0){J.push(this._typeCommandMap[M])}}return J},onSelectionChanged:function A(){var Z=0,N=0,W=0,R=0,aa=0,M,T,Q,U,ac=[],K,X=[],ad,V=[],ab,J,L,P,ae,O,S,Y;Q=this._mbomTree.getSelectedNodes();if(!h.is(Q,"array")){this._logger.warn("Selected Nodes is not an array");return}Z=Q.length;if(Z===1){U=Q[0];P=U.getReferenceType()}M=this._bodyTree.getSelectedNodes();if(!h.is(M,"array")){this._logger.warn("Selected Nodes is not an array");return}N=M.length;J=this._auxViewTree.getSelectedNodes();if(h.is(J,"array")){J.forEach(function(af){L=a.convertFromNodeToModel(af);if(h.is(L)){P=L.get("PPRTYPE");if(P==="PART"||P==="PRODUCT"){N++;T=af}else{if(P==="PROCESS"){Z++;U=af}else{if(P==="SYSTEM"){W++;ac.push(af)}else{if(P==="RESOURCE"){R++;X.push(af)}else{if(P==="OPERATION"){aa++;V.push(af)}}}}}}})}ae=Z+N+W+R+aa;if(1>ae){return this._setCommandStates(w.none)}else{if(1===ae){if(1===Z){O=this._getValidChildTypeCommands(P);S=h.clone(w.one.mbom);S.enabled=S.enabled.concat(O);this._setCommandStates(S);this._manageDocumentCommand(U)}if(1===N){T=M[0];this._setCommandStates(w.one.body);this._manageDocumentCommand(T)}if(1===W){K=ac[0];this._setCommandStates(w.one.system);this._manageDocumentCommand(K)}if(1===R){ad=X[0];this._setCommandStates(w.one.resource);this._manageDocumentCommand(ad)}if(1===aa){ab=V[0];this._setCommandStates(w.one.operation);this._manageDocumentCommand(ab)}}else{if(1<ae){if(ae===N){this._setCommandStates(w.multiple.body)}else{if(ae===Z){this._setCommandStates(w.multiple.mbom)}else{if(ae===W){this._setCommandStates(w.multiple.system)}else{if(ae===R){this._setCommandStates(w.multiple.resource)}else{if(ae===aa){this._setCommandStates(w.multiple.operation)}else{this._setCommandStates(w.multiple.mixed)}}}}}}}}Y=this._isRootSelected(M,Q,J);this._setState("Hide",Y);this._setState("RemoveInstance",(!Y&&(N<1)));this._setState("PPRReplaceByLatestRevision",(!Y&&(N<1)));this._setState("PPRReplaceByNewRevision",(!Y&&(N<1)));this._setState("PPRReplaceByExistingRevision",(!Y&&(Z===1)));if(ae===1){this._manageConfigurationCommands(Y,J.length,N)}if(Z>0&&J.length<=0&&M.length<=0){this._manageLoadRelationsCommand()}},_manageConfigurationCommands:function d(K,J,L){var O=(J>0),N=(L>0),M=(!O&&!N);this._setState("DefineFilter",(K&&!O));this._setState("EditConfigurationContext",M);this._setEffectivityCmdState("EditVariant",(!K&&M));this._setEffectivityCmdState("EditEvolution",(!K&&M))},_manageDocumentCommand:function k(L){var J,K;if(!L){this._logger.warn("node is undefined");return}J=L.getReferencePID();if(!J){this._logger.warn("referencePID is undefined");return}K=n.documentsConnection.where({irpcID:J});if(!K){this._logger.warn("documents is undefined");return}else{if(0<K.length){this._setState("ManageDocuments",true)}}},_manageLoadRelationsCommand:function p(){var J=true;if(J&&(t.getNavigateOn()==="indexOndemand")){this._setState("LoadRelations",true);return}this._setState("LoadRelations",false)},_isRootSelected:function H(L,N,J){var M=false,K;for(K=0;K<L.length;K++){if(L[K].isRoot()){M=true;break}}for(K=0;!M&&K<N.length;K++){if(N[K].isRoot()){M=true;break}}for(K=0;!M&&K<J.length;K++){if(J[K].isRoot()){M=true;break}}return M},_setCommandStates:function q(K){var J;K=K||{};J=K.enabled;this._commands.forEach(function M(N){this._setState(N,false)},this);if(!h.is(J,"array")){this._logger.warn("enabled param should be an array")}else{J.forEach(function(N){this._setState(N,true)},this)}if(r.isCloud()){this._notOnCloud.forEach(function L(N){this._setState(N,false)},this)}},_setState:function B(J,K){var L;if(!h.is(J,"string")){this._logger.warn("commandName should be a string");return null}if(!h.is(K,"boolean")){this._logger.warn("isActive should be a boolean");return null}L=c.getCommand(J,this._context);if(!L){L=E.CommandsCheckHeaderManager.getCmd(J)}if(!L){L=c.getCommandCheckHeader(J,this._context)}if(!L){this._logger.warn("No command found for %s",J);return null}if("Refresh"!==J||E.getRefreshCmdAvailability()){if(K){L.enable()}else{L.disable()}}return L},_setEffectivityCmdState:function C(J,L){var K=L;if(K===true){if(h.is(window)&&h.is(window.cfgCmdWidgetData)&&h.is(window.cfgCmdWidgetData._isDecouplingActivated,"boolean")){if(window.cfgCmdWidgetData._isDecouplingActivated===false){K=false}}else{K=false}}this._setState(J,K)},disableRootCreation:function i(){var J=w.none.enabled.indexOf("InsertCreateAssembly");if(-1<J){w.none.enabled.splice(J,1)}this.onSelectionChanged()},enableRootCreation:function y(){w.none.enabled.push("InsertCreateAssembly");this.onSelectionChanged()},});return a});define("DS/DELWebMfgItemDefCommands/ProductAddCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefModelServices/ModelUtils","DS/DELWebMfgAssetsDefUIServices/Search","DS/DELWebMfgAssetsDefModelServices/CollectionUtils","DS/DELWebMfgAssetsDefModelServices/Resources","DS/DELWebMfgAssetsDefReferenceModel/ReferenceModel","DS/DELWebMfgAssetsDefUIServices/UIUtils"],function(i,b,e,m,a,f,l,j,h,d){var c=b.extend(m,{name:"ProductAddCommand",_logger:null,_context:null,init:function q(r){this._logger=e.getLogger(c);this._parent(r,{mode:"exclusive",isAsynchronous:false,});this._context=this.getOption("context");this._search=new f(this._searchCallBack.bind(this))},beginExecute:function p(){this._logger.log("beginExecute")},execute:function n(){var r=this._context.getBodyView().getAcceptedTypes();this._logger.log("execute");this._search.activate("Product search",r,null)},endExecute:function k(){this._logger.log("endExecute")},_searchCallBack:function g(s){var r=this;s.forEach(function(u){var t=u.id,v;var w=l.references.get(t);if(w){r._searchCallBackAddSuccess(w)}else{v=new h({PID:u.id});v.fetch({proxy:"passport",headers:a.getHeaders(),wait:true,onComplete:function(x){l.references.add(x);r._searchCallBackAddSuccess(x)}})}})},_searchCallBackAddSuccess:function o(r){if(this._context.getBodyView().isAcceptedType(r)){r.setDisplayModel({asRootInBodyView:true})}else{d.AlertManager.add({className:"info",message:j.getNLSValue("Info.ElementNotAdded.Title"),})}}});return c});define("DS/DELWebMfgItemDefCommands/OriginCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgItemDefCommands/CommandsManager"],function(b,i,m,c,e,l,f,a){var g=m.extend({name:"OriginCommand",_logger:null,_context:null,init:function n(o){f.CommandsCheckHeaderManager.registerCmd("OriginCommand",this);this._parent(o);this._context=o.context;if(i.is(e)){this._logger=e.getLogger(g)}this.onStateChange(this._stateChanged)},_stateChanged:function j(){var o;this._logger.log("Origin Command State Changed");o=this.getState();if(o){this._check()}else{this._uncheck()}},_check:function h(){this._logger.log("Origin Command Check");this._uncheckOtherCmd();this._context.closeActionView();if(false===b.initView({type:"HistorizationLinkRefRef"})){this.toggleState()}else{this._context.openActionView()}},_uncheck:function d(){this._logger.log("Origin Command Uncheck");b.clearSelection();a.onSelectionChanged();this._context.closeActionView()},_uncheckOtherCmd:function k(){var o=f.CommandsCheckHeaderManager.getCmd("AlternateCommand");var p=f.CommandsCheckHeaderManager.getCmd("CapableResourceCommand");if(o.getState()===true){o.setState(false)}if(p.getState()===true){p.setState(false)}}});return g});define("DS/DELWebMfgItemDefCommands/ToggleGraphViewCommand",["UWA/Core","DS/Logger/Logger","DS/ApplicationFrame/Command","UWA/Class/Options","DS/DELWebMfgItemDefUtils/DOMNaming","DS/DELWebMfgItemDefCommands/CommandsManager",],function(g,e,d,i,b,c){var l=d.extend(i,{name:"ToggleGraphViewCommand",_logger:null,init:function m(n){if(e){this._logger=e.getLogger(l)}this._parent(n,{mode:"exclusive",isAsynchronous:false});this._context=this.getOption("context");if(!this._context){this._logger.warn("ERROR: No context.");return}},beginExecute:function k(){if(this._logger){this._logger.log("beginExecute")}if(!this._context){this._logger.warn("ERROR: No context.");return}this._view=this._context.getCurrentView()},execute:function j(){if(this._logger){this._logger.log("execute")}if(!this._context){this._logger.warn("ERROR: No context.");return}var o=null,q=null,p=null;var n=this._view;if("MBOM"===n){o=widget.getElement(b.selectors.mbomContainer);q=this._context.getMBOMTreeListView();p=this._context.getMBOMGraphView()}else{if("BODY"===n){o=widget.getElement(b.selectors.bodyContainer);q=this._context.getBodyTreeListView();p=this._context.getBodyGraphView()}}if(o&&q&&p){var r=o.hasClassName(b.classes.showGraphView);if(r){this._graphViewToTreeList(q,p)}else{this._treeListToGraphView(q,p)}o.toggleClassName(b.classes.showGraphView);c._manageGraphCommandsAvailability(n)}},endExecute:function h(){if(this._logger){this._logger.log("endExecute")}},_treeListToGraphView:function f(o,q){if(!o||!q){this._logger.warn("ERROR: No graph or treelist");return}var p=o.getManager();if(!p){this._logger.warn("ERROR: No manager on treelist");return}var n=o.getDocument();if(!n){this._logger.warn("ERROR: Could not get tree document");return}q.setModel(n)},_graphViewToTreeList:function a(o,q){if(!o||!q){this._logger.warn("ERROR: No graph or treelist");return}var p=o.getManager();if(!p){this._logger.warn("ERROR: No manager on treelist");return}var n=q.getModel();if(!n){this._logger.warn("ERROR: Could not get graph model");return}p.loadDocument(n)},});return l});define("DS/DELWebMfgItemDefCommands/AlternateCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgItemDefCommands/CommandsManager"],function(b,i,m,c,e,l,f,a){var h=m.extend({name:"AlternateCommand",_logger:null,_context:null,init:function n(o){f.CommandsCheckHeaderManager.registerCmd("AlternateCommand",this);this._parent(o);this._context=o.context;if(i.is(e)){this._logger=e.getLogger(h)}this.onStateChange(this._stateChanged)},_stateChanged:function j(){var o;this._logger.log("Alternate Command State Changed");o=this.getState();if(o){this._check()}else{this._uncheck()}},_check:function g(){this._logger.log("Alternate Command Check");this._uncheckOtherCmd();this._context.closeActionView();if(false===b.initView({type:"MfgProcessAlternate"})){this.toggleState()}else{this._context.openActionView()}},_uncheck:function d(){this._logger.log("Alternate Command Uncheck");b.clearSelection();a.onSelectionChanged();this._context.closeActionView()},_uncheckOtherCmd:function k(){var p=f.CommandsCheckHeaderManager.getCmd("OriginCommand");var o=f.CommandsCheckHeaderManager.getCmd("CapableResourceCommand");if(p.getState()===true){p.setState(false)}if(o.getState()===true){o.setState(false)}}});return h});define("DS/DELWebMfgItemDefCommands/CapableResourceCommand",["DS/DELWebMfgItemDefUIPanel/ActionViewManager","UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/Command","DS/Logger/Logger","UWA/Class/Options","DS/DELWebMfgAssetsDefUIServices/UIUtils","DS/DELWebMfgItemDefCommands/CommandsManager"],function(b,h,m,c,e,k,f,a){var l=m.extend({name:"CapableResourceCommand",_logger:null,_context:null,init:function n(o){f.CommandsCheckHeaderManager.registerCmd("CapableResourceCommand",this);this._parent(o);this._context=o.context;if(h.is(e)){this._logger=e.getLogger(l)}this.onStateChange(this._stateChanged)},_stateChanged:function i(){var o;this._logger.log("Capable Ressource Command State Changed");o=this.getState();if(o){this._check()}else{this._uncheck()}},_check:function g(){this._logger.log("Capable Ressource Command Check");this._uncheckOtherCmd();this._context.closeActionView();if(false===b.initView({type:"DELAsmProcessCanUseCnx"})){this.toggleState()}else{this._context.openActionView()}},_uncheck:function d(){this._logger.log("Capable Ressource Command Uncheck");b.clearSelection();a.onSelectionChanged();this._context.closeActionView()},_uncheckOtherCmd:function j(){var p=f.CommandsCheckHeaderManager.getCmd("OriginCommand");var o=f.CommandsCheckHeaderManager.getCmd("AlternateCommand");if(p.getState()===true){p.setState(false)}if(o.getState()===true){o.setState(false)}}});return l});