define("DS/CompareCmd/CompareCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData"],function(c,g,f,a){var e=false;var b=function(){};if(e==true){b=function(j){var i=new Date();var h=i.getTime();console.log("@ "+h+", "+j)}}b("compareCmd module is loading");var d=c.extend({name:"compare_command",context:null,init:function(h){var i=this;this._parent(h,{mode:"exclusive",isAsynchronous:false});this.context=h.context;if(this._id=="CompareJSONHdr"){this.baseEnable=this.enable;this.baseDisable=this.disable;this.enable=function(j){if(j!=null&&j.by=="SnapshotsWidget"){this.baseEnable()}};this.disable=function(j){if(j!=null&&j.by=="SnapshotsWidget"){this.baseDisable()}}}if(i.context==null){require(["DS/PADUtils/PADContext"],function(k){var j=k.get();if((j!==undefined)&&(j!==null)){i.context=j;i.context.getPADTreeDocument().getXSO().onChange(i.checkSelect.bind(i));i._isEnabled=i.getEnableCmd()}else{}})}this.setCommandAvailability(this.getEnableCmd())},setCommandAvailability:function(h){var i=g.getCommand(this._id,this);if(i){if(h===true){i.enable()}else{i.disable()}}},getEnableCmd:function(){var h=this;var i=false;f.hasRole(function(k){if((k===true)&&(h.context!=null)&&(h.context.getPADTreeDocument||(h.context.widgetType==="LifecycleWidget"))){var j=0;if(h.context.getPADTreeDocument){j=h.context.getPADTreeDocument().getXSO().get().length}else{j=h.context.getSelectedNodes().length}i=(j>0)?true:false}},["InternalDS","PAR","PAU","CSV"]);return i},checkSelect:function(){var h=this.getEnableCmd();this.setCommandAvailability(h)},beginExecute:function(){b("BEGIN EXECUTE of compareCmd")},execute:function(){var i=this;var h=this._id;switch(h){case"CompareHdr":i.execute_CompareHdr(i.context);break;case"CompareJSONHdr":i.execute_CompareSnapshots();break;default:this.NLS_showMessage("cmdNotImplented","compare-alert-error")}},endExecute:function(){},execute_CompareSnapshots:function(){var h=this;require(["DS/ListSnapshots/CmdCtx"],function(n){var i=n.ctx;var m=true;if(m){console.log("Performing 'CompareSnapshot' using physical IDs");if((i!=null)&&(i.getCompareIDs!=null)&&(typeof i.getCompareIDs=="function")){i.getCompareIDs(function l(p){h.processCompareIDs(p)},function k(p){this.NLS_showMessage("requestError","compare-alert-error")})}else{if(i===undefined){var j=[];var o=h.options.CompareIds;if(o!=null){o.forEach(function(p){j.push({ID:p,TYPE:"snapshotID"})})}h.processCompareIDs(j)}}}})},processCompareIDs:function(m){var n=this;if((m!=null)&&(m.length>=2)){var k=[];for(var l=0;l<m.length;l++){var h=m[l].ID;var j=m[l].TYPE;k.push({envId:"",serviceId:"",contextId:"",objectId:h,idType:j,objectType:"",displayName:""})}n.setupThenLaunchCompare(k)}else{this.NLS_showMessage("requestRequiresTwoObj","compare-alert-warning")}},execute_CompareHdr:function(i){var j=[];if((i!=null)&&(i.getSelectedNodes!=null)&&(typeof i.getSelectedNodes=="function")){var h=i.getSelectedNodes();h.forEach(function(m){var l=m.getID();j.push(l)})}else{var k=this.options.CompareIds;if(k!=null){k.forEach(function(l){j.push(l)})}}if(j.length==0){this.NLS_showMessage("objectNotSelected","compare-alert-warning")}else{this.validateIDs(j)}},validateIDs:function(i){var h=this;require(["UWA/Core"],function(n){var j=i.join();var m=(typeof(widget)!=="undefined"&&widget)?widget.getValue("x3dPlatformId"):null;if(m==null||m==""){m="OnPremise"}var l=f.get3DSpaceWSUrl(m,"/resources/compare/getObjState","objectIds="+j);try{a.authenticatedRequest(l,{proxy:"passport",timeout:120000,method:"GET",headers:{Accept:"application/json"},onComplete:function(o){h.processValidatedReturn(o)}})}catch(k){h.NLS_showMessage("requestError","compare-alert-error")}})},processValidatedReturn:function(k){var j=this;var i=0;var n=0;JSON.parse(k).results.forEach(function(p){if(p.exists==false){n++}else{i++}});var o=null;var h=null;if(n>0){o=(n>0)?"OBJ_NOT_FOUND":"objNotModel";h="compare-alert-error"}else{if(i==0){o="objectNotSelected";h="compare-alert-warning"}else{if(i>5){o="selectFiveOrFewer";h="compare-alert-warning"}}}if(h!=null){this.NLS_showMessage(o,h)}else{var m=(widget!=null)?widget.getValue("x3dPlatformId"):"";if((m==null)||(m=="")){m="OnPremise"}var l=[];JSON.parse(k).results.forEach(function(p){var q=p.envId;var r=(q!=null)?q:m;l.push({envId:r,serviceId:"",contextId:"",objectId:p.physID,idType:"modelID",ObjsIDArray:"",displayName:""})});this.setupThenLaunchCompare(l)}},setupThenLaunchCompare:function(i){var h=this;require(["UWA/Utils/InterCom"],function(j){var k=new j.Socket("compassPageSocket");k.subscribeServer("com.ds.compass",window.parent);h.dispatchCompareWithContent(k,i)})},dispatchCompareWithContent:function(l,m){var i=true;var h=widget.getPreference("useIndexAccleration");if(h!=null){i=h.value}var k=m[0].envId;var j={envId:k,protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",useIndexing:i,data:{items:m}};l.dispatchEvent("onSetX3DContent",j,"compassPageSocket");b("Dispatch launch request to compass");var n={appId:"ENOCOMP_AP"};l.dispatchEvent("onLaunchApp",n,"compassPageSocket")},NLS_showMessage:function(h,i){require(["DS/CompareWidget/CompareAlert","i18n!DS/CompareCmd/assets/nls/CompareCmd"],function(k,l){var j=(l[h]!=null)?l[h]:h;k.doAlert({msg:j,alertStyle:i});return},function(j){console.log("%%%% CompareWidget:: Failed to show "+i+": '"+h+"', error:"+j)})}});return d});