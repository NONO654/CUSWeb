define("DS/DELPPWModelServices/ModelUtils",["UWA/Core","UWA/Class","UWA/Date","UWA/Class/Promise"],function(h,q,r,d){var f=q.singleton({name:"ModelUtils",_widgetTrigram:"NOT_DEFINED",init:function p(u){var s=this;var t="uwa";if(h.is(widget.environment)&&h.is(widget.environment.name)){t=widget.environment.name}if(t==="uwa"){this.setStandAlone(true)}else{this.setStandAlone(false)}s._parent(u)},getWidgetTrigram:function l(){return f._widgetTrigram},setWidgetTrigram:function o(s){f._widgetTrigram=s},getNavigateOnIndex:function n(){var s=widget.getValue("navigateOnIndex"),t=widget.getValue("forceDBModePreferences");if(!h.is(s)||s!=="Index"||t==="true"){return false}return true},getNavigateOnIndexedDB:function a(){return widget.getBool("navigateOnIndexedDB")},getOneDelmiaAggregationMode:function k(){return widget.getBool("oneDelmiaAggregationMode")},getPrefSeparator:function i(){return widget.getValue("separator")},getPrefExpandLevel:function c(){return widget.getBool("fetchAllLevel")?-1:2},getCVServletLabel:function m(){return this.getWidgetTrigram()+"-"+(new r()).toISOString()},getTimeoutPreference:function j(){var t=widget.getInt("timeout"),s=(t!==0)?t:600;return s*1000},isStandAlone:function g(){return f._standalone},setStandAlone:function e(s){f._standalone=s},getExecuteByBlockPromise:function b(D){var B=null,v=500,x=5,s=D||{},G=h.is(s.callback,"function")?s.callback:function E(){},t=h.is(s.context)?s.context:B,H=h.is(s.globalArray,"array")?s.globalArray:[],C=h.is(s.blockSize,"number")?((Math.abs(Math.floor(s.blockSize))>0)?Math.abs(Math.floor(s.blockSize)):v):v,A=h.is(s.delay,"number")?Math.abs(Math.floor(s.delay)):x,u=Math.floor(H.length/C)+1,y=null,z=0,F=function F(J,K){var I=function I(O,M){var L=function L(){O(K+1)},N=function N(){G.call(t,J,L,M)};if(J.length>0){setTimeout(N,A)}else{O(K+1)}};return new d(I)},w=function w(I){return F(H.slice(I*C,(I+1)*C),I)};for(z=0;z<u;z++){if(h.is(y)){y=y.then(w)}else{y=w(0)}}return y}});return f});define("DS/DELPPWModelServices/BehaviorUtil",["UWA/Core","UWA/Class","DS/DELPPWLoggerModel/LoggerUtils","DS/PlatformAPI/PlatformAPI"],function(h,c,d,l){var g=c.singleton({name:"BehaviorUtil",init:function o(r){r=r||{};this._parent(r)},_getVariable:function q(B,y){var w="app.MFN.default",u="boolean",t=false,r=t,A=h.is(y,"string")?((y.length>0)?y:u):u,v=h.is(B,"string")?((B.length>0)?B:w):w,s=l.getApplicationConfiguration(v),z=localStorage.getItem(v),x=false;if(h.is(s,"string")){r=s;x=true;d.debug(this.name,"From server ("+v+", "+A+"): "+r)}else{if(h.is(z,"string")){r=z;x=true;d.debug(this.name,"From client ("+v+", "+A+"): "+r)}}if(x){switch(A){case"boolean":r=("true"===r);break;default:break}}return r},isNewDragNDrop:function a(){var r=g._getVariable("app.MFN.isOldDragNDrop");return !r},shouldLoadRootOnly:function i(){return g._getVariable("app.feature.loadRootOnly")},isCloud:function f(){return g._getVariable("app.build.isCloud")},isNewArchi:function j(){return g._getVariable("app.Archi.isNewArchi")},useRootStorage:function b(){return g._getVariable("app.feature.useRootStorage")},getDefaultTimeout:function m(){return g._getVariable("app.feature.defaultTimeout","string")},isSwipeableMenuPrefDisplayed:function n(){return g._getVariable("app.MFNMGA.isSwipeableMenuPrefDisplayed")},isNavigateOnIndexedDBPrefDisplayed:function k(){return g._getVariable("app.MFNMGA.isNavigateOnIndexedDBPrefDisplayed")},isDialogDisplayedAtDDinCaseOfMove:function p(){return g._getVariable("app.MFNMGA.isDialogDisplayedAtDDinCaseOfMove")},showEffectivityColumns:function e(){return g._getVariable("app.feature.showEffectivityColumns")}});return g});define("DS/DELPPWModelServices/Navigation/NavigateOnLocalStore",["UWA/Core","DS/DELPPWModelServices/Navigation/NavigationBase","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWIRPCModel/Model/ConnectionModel","DS/DELPPWIRPCModel/Model/InstanceModel"],function(h,a,f,d,e){var c=a.extend({init:function g(i){this._parent(i)},getDescendants:function b(l,j){var o=[l],i=[l.PID],n,m,k;k=function k(){var u,v,r,q,t=0,p,s;i.forEach(function(x){u=self.references.get(x);if(h.is(u)){v=[];r=self.connections.where({to:u.id});q=self.connections.where({from:u.id});r.forEach(function(z){v.push({modelID:z.get("from"),connectionID:z.id,connectionTypeName:z.get("type")})});q.forEach(function(z){v.push({modelID:z.get("to"),connectionID:z.id,connectionTypeName:z.get("type")})});u.setDisplayModel({connectionModelInfo:v},{silent:true});s=function y(){t++;if(t===i.length){if(h.is(j.callback,"function")){j.callback()}}};w=function w(A){var C=[],B,z;A.forEach(function(E){var D=h.Json.decode(E);B=D.irpcID;C.push(D.docID)});z=self.references.get(B);self._addDocuments(C,z,s)};self.IndexedDBUtils.where(self.IndexedDBUtils.documentsConnectionsStore,"irpcID",u.get("PID"),w,s)}})};n=function n(v){var x,p,r,u,t=[],s=0,y=function y(){o=o.filter(function(z){return z.PID!==v.PID});if(h.is(j.callback,"function")&&o.length===0){k()}else{if(h.is(j.callback,"function")){m(o[0])}}},w=function w(z){s++;r=z.displayModel;delete z.displayModel;x=new f(z);i.push(x.id);if(!self.references.get(x.get("PID"))){self.references.add(x)}x.setDisplayModel(r,{silent:true});o.push(x._attributes);u=t[x.id];if(h.is(u)){p=u.model;if(!self.instances.get(p.get("PID"))){self.instances.add(p,{silent:true})}p.setDisplayModel(u.displayAttributes,{silent:true})}if(s===Object.keys(t).length){y()}},q=function q(B){var z,A;B.forEach(function(D){var C=h.Json.decode(D);A=C.displayModel;delete C.displayModel;z=new e(C);z.setAdditionalInfo({queriedForConnections:true});t[z.get("isInstanceOf")]={model:z,displayAttributes:A};self.IndexedDBUtils.get(self.IndexedDBUtils.referencesStore,z.get("isInstanceOf"),w)})};self.IndexedDBUtils.where(self.IndexedDBUtils.instancesStore,"isAggregatedBy",v.PID,q,y)};m=function m(t){var w,p,u,r=[],q=function q(x){u=x.displayModel;delete x.displayModel;w=new f(x);i.push(w.id);if(!self.references.get(w.get("PID"))){self.references.add(w)}w.setDisplayModel(u,{silent:true});r.forEach(function(y){if(y.get("to")===w.id){self.connections.add(y)}});o.push(w._attributes)},s=function s(x){x.forEach(function(y){p=new d(h.Json.decode(y));r.push(p);self.IndexedDBUtils.get(self.IndexedDBUtils.referencesStore,p.get("to"),q)});n(t)},v=function v(){n(t)};self.IndexedDBUtils.where(self.IndexedDBUtils.connectionsStore,"from",t.PID,s,v)};m(l)}});return c});define("DS/DELPPWModelServices/BIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],function(d,o,a,h){var b=o.singleton({name:"BIUtils",init:function n(t){this._parent(t);this.biModelCollection=new a();this._mbomArray=[];this._embomArray=[]},getBrokenMfgItemStatus:function m(t,w){var v=this,u;t=t||{};t.silent=true;v._fetchStatus(t,function(x){if(d.is(x)){u=x.where({type:"MfgItemsUpdateStatus",isBroken:true});w(u)}})},getProductAssignmentStatus:function k(){var t;if(d.is(this.biModelCollection)){t=this.biModelCollection.where({type:"ProductsAssignmentStatus"})}return t},getMfgItemUpdateStatus:function s(){var t;if(d.is(this.biModelCollection)){t=this.biModelCollection.where({type:"MfgItemsUpdateStatus"})}return t},_fetchStatus:function j(v,x){var w=this;new Promise(function(y){if(!w.isBIComputed()){w.fetchBIComputation(v,function(){y()})}else{y()}}).then(function t(){x(w.biModelCollection)},function u(){x([])})},fetchBIComputation:function l(t,z){var w=this,x,u,v=function v(A){if(d.is(t.onFailure,"function")){t.onFailure.call(A)}};t=t||{};u=d.is(t.silent,"boolean")?t.silent:true;w._mbomArray=d.is(t.rootMBOM)?t.rootMBOM:w._mbomArray;w._embomArray=d.is(t.rootEBOM)?t.rootEBOM:w._embomArray;if(w._mbomArray.length<=0||w._embomArray.length<=0){v();return}this._engConfigFilter="";this._mfgConfigFilter="";x={expandLevel:-1,ordered:true,mbomIds:w._mbomArray,ebomIds:w._embomArray,engConfigFilter:this._engConfigFilter,mfgConfigFilter:this._mfgConfigFilter};h.webServiceRequest({url:"modeler/ppr/BI",method:"POST",onComplete:function y(A){w._addToBIModelCollection(A,{silent:u});if(z instanceof Function){z()}},onFailure:v,onTimeout:v,data:d.Json.encode(x),headers:{Accept:"application/json",SecurityContext:h.getSecurityContext(),"Content-Type":"application/ds-json"}})},_addToBIModelCollection:function i(t,y){var x=this,w,v,u,z;for(w in t){if(t.hasOwnProperty(w)){v=t[w];for(u in v){if(v.hasOwnProperty(u)){z=v[u];z.id=u;z.type=w;x.biModelCollection.add(z,y)}}}}},isBIComputed:function e(){var t=this;if(t.biModelCollection.size()>0){return true}return false},resetBIModelCollection:function(){if(true===this.isBIComputed()){this.biModelCollection.reset()}},onConnectionAdd:function g(w,B){var z,t,x,u,y,C={},A={},v=[];if(false===this.isBIComputed()){return}B=B||{};z=w.get("type");if(!d.is(z,"string")){this._logger.debug("Connection type is not defined");return}if("ProductImplementLink"===z){this.resetBIModelCollection();this.fetchBIComputation({});return}if("ProductImplementLinkOcc"===z){t=w.get("from");if(!d.is(t,"string")){this._logger.debug("Model from referencepid not found");return}x=w.get("to");x=x.toString();if(!d.is(x,"string")){return}u=this.biModelCollection.findWhere({id:t});if(d.is(u)){u.set({pointedPaths:x,status:this._getProcessStatus(z,x)},B)}else{C.id=t;C.pointedPaths=x;C.status=this._getProcessStatus(z,x);C.type="MfgItemsUpdateStatus";this.biModelCollection.add(C,B)}y=this.biModelCollection.findWhere({id:x});if(d.is(y)){v=y.get("implementingPIDs");if(d.is(v,"array")){if(-1===v.indexOf(t)){v.push(t);y.set({implementingPIDs:v,status:this._getProductStatus(v,z)},B)}}else{y.set({implementingPIDs:[t],status:this._getProductStatus([t],z)},B)}}else{A.id=x;A.implementingPIDs=[t];A.status=this._getProductStatus([t],z);A.type="ProductsAssignmentStatus";this.biModelCollection.add(A,B)}}},onConnectionRemove:function f(w,B){var A,t,y,u,z,v=[],x;if(false===this.isBIComputed()){return}B=B||{};if(!w){this._logger.debug("ERROR: No model defined");return}A=w.get("type");if(!d.is(A,"string")){this._logger.debug("Could not get connection type");return}if("ProductImplementLink"===A){this.resetBIModelCollection();this.fetchBIComputation({});return}if("ProductImplementLinkOcc"===A){t=w.get("from");if(!d.is(t,"string")){this._logger.debug("Model from referencepid not found");return}y=w.get("to");y=y.toString();if(!d.is(y,"string")){return}u=this.biModelCollection.findWhere({id:t});if(d.is(u)){u.set({pointedPaths:"",status:this._getProcessStatus(A)},B)}z=this.biModelCollection.findWhere({id:y});if(d.is(z)){v=z.get("implementingPIDs");if(d.is(v,"array")){x=v.indexOf(t);if(-1!==x){v.splice(x,1);z.set({implementingPIDs:v,status:this._getProductStatus(v,A)},B)}else{z.set({status:"NotAssigned"},B)}}}}},_getProductStatus:function r(u,t){if("ProductImplementLinkOcc"===t){if(0===u.length){return"NotAssigned"}else{if(1===u.length){return"AssignedDirectly"}else{if(1<u.length){return"AssignedMoreThanOnce"}}}}else{if("ProductImplementLink"===t){if(0===u.length){return"NotAssigned"}else{if(1===u.length){return"AssociatedWithScope"}else{if(1<u.length){return"AssignedMoreThanOnce"}}}}}},_getProcessStatus:function q(t,u){if(d.is(u)){if("ProductImplementLinkOcc"===t){return"ImplGood"}else{if("ProductImplementLink"===t){return"ScopeGood"}}}return"NotApplicable"},setBIModelEvents:function p(t){this.biModelCollection.addEvents(t)},removeBIModelEvents:function c(){this.biModelCollection.removeEvents()}});return b});define("DS/DELPPWModelServices/DocumentObjAttributesUtils",["UWA/Core","UWA/Class"],function(e,b){var d=b.singleton({name:"DocumentObjAttributesUtils",_logger:null,init:function(f){f=f||{};if(!f.webServiceUtils||!f.logger){throw new Error("webServiceUtils or logger options not defined")}this._webServiceUtils=f.webServiceUtils;this._logger=f.logger;this._iUIConfigDocValuesURL="DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIDocumentDisplayAttributeConfig";this._readXMLConfiguration();this.attrDisplayMap={}},_readXMLConfiguration:function c(){var g=function g(j){var h,i;if(e.is(j.DisplayAttributeDescriptionList)){if(Array.isArray(j.DisplayAttributeDescriptionList["Document"])){h=j.DisplayAttributeDescriptionList["Document"]}else{h=[j.DisplayAttributeDescriptionList["Document"]]}for(i=0;i<h.length;i++){d.attrDisplayMap[h[i].coloumnName]=h[i].Attribute}}},f=function f(h){d._logger.log(h.message)};d._webServiceUtils.getXMLValues(this._iUIConfigDocValuesURL,g,f)},getDocumentAttributes:function a(k,f){var i=d.attrDisplayMap[f],g=k[0].get("dataelements"),h,j="";if(!e.is(i)){j=g.title}else{if(!Array.isArray(i)){i=[i]}for(h=0;h<i.length;h++){if(e.is(g[i[h].name])&&g[i[h].name]!==""){j=j+g[i[h].name]+" "}}}return j}});return d});define("DS/DELPPWModelServices/Navigation/IndexedDBUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils"],function(h,c,d,e){var f=c.singleton({name:"IndexedDBUtils",referencesStore:"references",instancesStore:"instances",connectionsStore:"connections",documentsStore:"documents",documentsConnectionsStore:"documentsConnections",_db:null,_version:1,_storeNames:["references","instances","connections","documents","documentsConnections"],_keyPath:"pid",_columns:{references:["data"],instances:["isInstanceOf","isAggregatedBy","data"],connections:["from","to","data"],documents:["data"],documentsConnections:["docID","irpcID","data"]},init:function n(o){var p,q;o=o||{};this._parent(o);if(!h.is(f._db)){p=indexedDB.open(d.getWidgetTrigram(),f._version);p.onupgradeneeded=function(r){f._db=r.target.result;f._storeNames.forEach(function(s){q=f._db.createObjectStore(s,{keyPath:f._keyPath});f._columns[s].forEach(function(t){q.createIndex(t,t,{unique:(t==="data")})})})};p.onsuccess=function(r){f._db=r.target.result}}},get:function g(o,p,q,t){var r,u="indexedDB/get",s;r=e.printCurrentDateTime(u+" start - ");s=this._db.transaction([o]).objectStore(o).get(p);s.onsuccess=function(v){e.printDuration(r,u);if(h.is(v.target.result)){if(h.is(q)){q(h.Json.decode(v.target.result.data))}}else{if(h.is(t)){t()}}};s.onerror=function(v){e.printDuration(r,u);if(h.is(t)){t()}}},put:function l(q,v,u,w){var r,t,s,p,o="indexedDB/put";r={pid:v,data:h.Json.encode(u)};t=h.is(u._attributes)?u._attributes:u;if(t.hasOwnProperty("isInstanceOf")){r.isInstanceOf=t.isInstanceOf;if(t.hasOwnProperty("isAggregatedBy")){r.isAggregatedBy=t.isAggregatedBy}}else{if(t.hasOwnProperty("from")&&t.hasOwnProperty("to")){r.from=t.from;r.to=t.to}else{if(t.hasOwnProperty("docID")&&t.hasOwnProperty("irpcID")){r.docID=t.docID;r.irpcID=t.irpcID}}}if(h.is(f._db)){p=e.printCurrentDateTime(o+" start - ");s=f._db.transaction([q],"readwrite").objectStore(q).put(r);s.onsuccess=function(x){e.printDuration(p,o);if(h.is(w)){w(u)}};s.onerror=function(x){e.printDuration(p,o)}}},remove:function j(o,p,s){var q,t="indexedDB/delete",r;q=e.printCurrentDateTime(t+" start - ");r=f._db.transaction([o],"readwrite").objectStore(o)["delete"](p);r.onsuccess=function(u){e.printDuration(q,t);if(h.is(s,"function")){s()}};r.onerror=function(u){e.printDuration(q,t)}},where:function i(o,t,w,v,q){var u=this._db.transaction([o]).objectStore(o).index(t),r=[],p=false,s;u.openCursor(IDBKeyRange.only(w)).onsuccess=function(x){var y=x.target.result;if(h.is(y)){p=true;r.push(x.target.result.value);y["continue"]()}else{if(p){if(h.is(v,"function")){s=r.map(function(z){return z.data});v(s)}}else{if(h.is(q,"function")){q()}}}}},setStoreName:function m(p){var o;if(p.name==="DocumentConnectionModel"){o=f.documentsConnectionsStore}else{if(p.get("type")==="Document"){o=f.documentsStore}else{if(p.isReference()){o=f.referencesStore}else{if(p.isInstance()){o=f.instancesStore}else{if(p.isConnection()){o=f.connectionsStore}}}}}return o},getModel:function b(q,r,o){var p=f.setStoreName(q);if(h.is(p)){f.get(p,q.id,r,o)}else{o()}},storeModel:function k(p,q){var o=f.setStoreName(p);if(h.is(p.get("attributesValue"))){delete p._attributes.attributesValue}if(h.is(o)){f.put(o,p.id,p,q)}},removeModel:function a(p,q){var o=f.setStoreName(p);if(h.is(o)){f.remove(o,p.id,q)}}});return f});define("DS/DELPPWModelServices/CollectionUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWModelServices/ModelUtils","DS/DELPPWIRPCModel/Collections/ReferenceCollection","DS/DELPPWIRPCModel/Collections/InstanceCollection","DS/DELPPWIRPCModel/Collections/ConnectionCollection","DS/DELPPWDocumentModel/DocumentCollection","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWIRPCModel/Model/InstanceModel","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWLoggerModel/LoggerUtils"],function(g,b,I,aa,aq,D,o,s,n,ae,N,a){var al=b.singleton({name:"CollectionUtils",pprTypes:{system:"SYSTEM",operation:"OPERATION",process:"PROCESS",resource:"RESOURCE",product:"PRODUCT",part:"PART"},_init:function ag(at){this.references=new aq();this.instances=new D();this.connections=new o();this.documents=new s();this.instances.referenceCollection=this.references;this.connections.referenceCollection=this.references;this.connections.instanceCollection=this.instances;if(g.is(at)){if(g.is(at.useER,"boolean")){this.useERObjects(at.useER)}}},init:function af(at){at=at||{};this._parent(at);this._init(at)},reset:function U(au){var av=au||{},ax=true,at=g.is(av.silent,"boolean")?av.silent:ax,aw;if(g.is(this.references)){aw=this.references.reset({},{silent:at});if(g.is(aw)){this.references.remove(aw,{silent:at})}}if(g.is(this.instances)){aw=this.instances.reset({},{silent:at});if(g.is(aw)){this.instances.remove(aw,{silent:at})}}if(g.is(this.connections)){aw=this.connections.reset({},{silent:at});if(g.is(aw)){this.connections.remove(aw,{silent:at})}}if(g.is(this.documents)){aw=this.documents.reset({},{silent:at});if(g.is(aw)){this.documents.remove(aw,{silent:at})}}},setReferenceCollectionEvents:function v(at){this.references.addEvents(at)},setConnectionsCollectionEvents:function ar(at){this.connections.addEvents(at)},setInstanceCollectionEvents:function v(at){this.instances.addEvents(at)},setDocumentCollectionEvents:function ab(at){this.documents.addEvents(at)},removeCollectionEvents:function y(){this.references.removeEvents();this.connections.removeEvents();this.instances.removeEvents()},removeDocumentCollectionEvents:function y(){this.documents.removeEvents()},updateModel:function Y(au,av){var at=this;av=av||{};av.onCompleteMsg=g.is(av.onCompleteMsg)?av.onCompleteMsg:"Updated Model succesfully";av.onFailureMsg=g.is(av.onFailureMsg)?av.onFailureMsg:"Updating Model failed";au.save(null,{proxy:"passport",headers:N.getHeaders(),data:g.Json.encode(av.data),onComplete:function(aw){a.debug(at.name,av.onCompleteMsg+" : %s",JSON.stringify(aw));if(g.is(av.onComplete,"function")){av.onComplete.call(null,aw)}},onFailure:function(){a.debug(at.name,av.onFailureMsg+" : %s",JSON.stringify(au));if(g.is(av.onFailure,"function")){av.onFailure.call(null,au)}},wait:true,parse:true,})},massUpdateModels:function ak(aw,au,av){var at=this;av=av||{};av.onCompleteMsg=g.is(av.onCompleteMsg)?av.onCompleteMsg:"MassUpdate: Model has been updated successfully";av.onFailureMsg=g.is(av.onFailureMsg)?av.onFailureMsg:"MassUpdate has failed";if(!g.is(av.data)&&(!g.is(av.data.keyValues)||!g.is(av.data.pids,"array"))){a.debug(at.name,av.onFailureMsg+" as keyValues or pids have not been provided");if(g.is(av.onFailure,"function")){av.onFailure.call(null);return}}N.webServiceRequest({url:"modeler/pprirpc/"+aw,method:"PUT",data:g.Json.encode(av.data),onComplete:function(ax){var ay;ax.forEach(function(az){az=az.attributesValue;if(aw==="instance"){ay=al.instances.get(az.PID)}else{ay=al.references.get(az.PID)}if(ay._attributes.hasOwnProperty(au)){ay.set(au,az[au]);a.debug(at.name,av.onCompleteMsg+": %o",ay)}});if(g.is(av.onComplete,"function")){av.onComplete.call(null,ax)}},onFailure:function(){a.debug(at.name,av.onFailureMsg);if(g.is(av.onFailure,"function")){av.onFailure.call(null)}},})},fetch:function Q(ax,az){var aB=this,aw,aA,av;if(g.is(ax)){az=az||{};aA=g.is(az.silent,"boolean")?az.silent:false,av=g.is(az.parse,"boolean")?az.parse:true,aw={proxy:"passport",type:"json",headers:N.getHeaders(),onComplete:function au(aE,aC,aD){a.debug(aB.name,"fetch completed: %o",aC);if(g.is(az.onComplete,"function")){az.onComplete.apply(null,[aE,aD])}},onFailure:function at(aE,aF,aD){var aC=g.is(aF)?(g.Json.isJson(aF)?g.Json.decode(aF):aF):{};a.debug(aB.name,"fetch failed with error: %o",aC);if(g.is(az.onFailure,"function")){az.onFailure.apply(null,[aC,aD])}},onTimeout:function ay(aE,aF,aD){var aC=g.is(aF)?(g.Json.isJson(aF)?g.Json.decode(aF):aF):{};a.debug(aB.name,"fetch timed out with error: %o",aC);if(g.is(az.onTimeout,"function")){az.onTimeout.apply(null,[aC,aD])}},parse:av,silent:aA,};ax.fetch(aw)}else{a.debug(aB.name,"Invalid model object to fetch.")}},createRef:function H(au,av){var at=this,aw;if(!g.is(av)){av={}}aw=g.extend({proxy:"passport",headers:N.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),queriedForDocuments:true,queriedForChildren:true,queriedForConnections:true,data:g.Json.encode(au),onComplete:function(ax){a.debug(at.name,"Creation completed: %o",ax);if(g.is(av.onComplete,"function")){av.onComplete.call(null,ax)}},onFailure:function(az,ay){var ax=g.is(ay)?(g.Json.isJson(ay)?g.Json.decode(ay):ay):{};a.debug(at.name,"Creation failed: %o",az);if(g.is(av.onFailure,"function")){av.onFailure.call(null,az,ax.error)}},wait:true,parse:true,},av,true);return this.references.create(null,aw)},fetchReferences:function m(ax,ay){var aB=this,aw,az,av,aA;ay=ay||{};az=g.is(ay.silent,"boolean")?ay.silent:true,av=g.is(ay.parse,"boolean")?ay.parse:true,aA=g.is(ay.remove,"boolean")?ay.remove:false;aw={data:ax,proxy:"passport",headers:N.getHeaders(),onComplete:function au(aF,aD,aE){var aC=[];a.debug(aB.name,"fetch references completed: %o",aD);if(g.is(aD,"array")){aD.forEach(function(aG){aC.push(aF.get(aG.PID))})}if(g.is(ay.onComplete,"function")){ay.onComplete.apply(null,[aC,aE])}},onFailure:function at(aE,aF,aD){var aC=g.is(aF)?(g.Json.isJson(aF)?g.Json.decode(aF):aF):{};a.debug(aB.name,"fetch references failed with error: %o",aC);if(g.is(ay.onFailure,"function")){ay.onFailure.apply(null,[aC,aD])}},wait:true,parse:av,silent:az,remove:aA};aB.references.fetch(aw)},addRef:function r(av,aw){var au,at=aw||{};if(av){at=g.merge(aw,{merge:true,parse:true});au=al.references.add(av,at)}return au},fetchRef:function(av,aw){var au=this,at=new n(av);at.fetch({proxy:"passport",headers:N.getHeaders(),onComplete:function(ax){a.debug(au.name,"Fetch completed: %o",ax);au.references.add(ax,{silent:g.is(aw.silent)?aw.silent:false,merge:true});if(g.is(aw.onComplete,"function")){aw.onComplete.call(null,ax)}},onFailure:function(ax){a.debug(au.name,"Fetch failed: %o",ax);if(g.is(aw.onFailure,"function")){aw.onFailure.call(null,ax)}},wait:true,parse:true,});return at},updateRef:function l(av,au){var at=al.references.get(av);au=au||{};au.onCompleteMsg="Updated Reference succesfully";au.onFailureMsg="Updating Reference failed";this.updateModel(at,au)},updateRefs:function V(at,au){au=au||{};au.onCompleteMsg="MassUpdate: Reference has been updated successfully";au.onFailureMsg="MassUpdate of References has failed";this.massUpdateModels("reference",at,au)},deleteRef:function f(aw,av){var au=this,at,ax=al.references.get(aw);av=av||{};at=g.is(av.deep)?av.deep:false;if(!g.is(ax)){a.debug(this.name,"Refrence does not exists");if(g.is(av.onFailure)){av.onFailure()}return}ax.destroy({proxy:"passport",data:g.Json.encode({deep:at}),headers:N.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),wait:true,onFailure:function(aA,az){var ay=g.is(az)?az:{};a.debug(au.name,"Deleting of Refrence failed: %s with error:",aw,JSON.stringify(ay));if(g.is(av.onFailure)){av.onFailure(aA,ay)}},onComplete:function(aC,aD){var aA,aB,ay,az=g.is(aD)?aD:{},aE=g.is(az.deletedObjects)?az.deletedObjects:[];if(at&&g.is(aE)){for(aB=0;aB<aE.length;aB++){aA=aE[aB];ay=al.instances.get(aA);if(g.is(ay)){al.instances.remove(aA)}ay=al.references.get(aA);if(g.is(ay)){al.references.remove(aA)}}}a.debug(au.name,"Deleting of Refrence completed: %s ",aw);if(g.is(av.onComplete)){av.onComplete(aC,az)}}})},removeRef:function J(at){this.references.remove(at)},addInst:function an(at,au){if(!g.is(at)){a.debug(this.name,"refData is not defined");return}if(!g.is(au)){au={}}au=g.merge(au,{merge:true,parse:true});return al.instances.add(at,au)},createInst:function ao(au,av){var at=this,aw;if(!g.is(av)){av={}}if(!g.is(au)){au={}}au.oneDelmiaAggregationMode=aa.getOneDelmiaAggregationMode();aw=g.extend({proxy:"passport",headers:N.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),queriedForDocuments:false,queriedForChildren:false,queriedForConnections:true,data:g.Json.encode(au),onComplete:function(ax){a.debug(at.name,"Instance Creation completed: %o",ax);if(g.is(av.onComplete,"function")){av.onComplete.call(null,ax)}},onFailure:function(az,ay){var ax=g.is(ay)?(g.Json.isJson(ay)?g.Json.decode(ay):ay):{};a.debug(at.name,"Instance Creation failed: %o",az);if(g.is(av.onFailure,"function")){av.onFailure.call(null,az,ax.error)}},wait:true,parse:true,},av,true);return this.instances.create(null,aw)},fetchInst:function W(av,aw){var au=this,at=new ae(av);if(!g.is(aw)){aw={}}at.fetch({proxy:"passport",headers:N.getHeaders(),queriedForDocuments:false,queriedForChildren:false,queriedForConnections:false,onComplete:function(ax){a.debug(au.name,"Fetch completed: %o",ax);au.instances.add(ax,{silent:g.is(aw.silent)?aw.silent:false,merge:true});if(g.is(aw.onComplete,"function")){aw.onComplete.call(null,ax)}},onFailure:function(ax){a.debug(au.name,"Fetch failed: %o",ax);if(g.is(aw.onFailure,"function")){aw.onFailure.call(null,ax)}},wait:true,parse:true,});return at},updateInst:function X(au,av){var at=al.instances.get(au);av=av||{};av.onCompleteMsg="Updated Instance succesfully";av.onFailureMsg="Updating Instance failed";this.updateModel(at,av)},updateInsts:function S(at,au){au=au||{};au.onCompleteMsg="MassUpdate: Instance has been updated successfully";au.onFailureMsg="MassUpdate of Instances has failed";this.massUpdateModels("instance",at,au)},deleteInst:function q(au,av){var at=this,aw=al.instances.get(au);av=av||{};if(!g.is(aw)){a.debug(this.name,"Instance does not exists");if(g.is(av.onFailure)){av.onFailure()}return}aw.destroy({proxy:"passport",headers:N.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),wait:true,onFailure:function(az,ay){var ax=g.is(ay)?(g.Json.isJson(ay)?g.Json.decode(ay):ay):{};a.debug(at.name,"Deleting of Instance failed: %s with error:",au,ax);if(g.is(av.onFailure)){av.onFailure(az,ax.error)}},onComplete:function(){a.debug(at.name,"Deleting of instance completed: %s ",au);if(g.is(av.onComplete)){av.onComplete()}}})},removeInstance:function ap(at){this.instances.remove(at)},removeConnection:function F(au,at){this.connections.remove(au,at)},createConn:function j(az,av){var at=this,ay,aw="2.0";if(!g.is(av)){av={}}ay=g.extend({proxy:"passport",headers:N.getHeaders({isAuthoringCtx:true,isJsonOnly:true,minorVersion:aw}),data:g.Json.encode(az),onComplete:function ax(aA){a.debug(at.name,"Creation completed: %o",aA);if(g.is(av.onComplete,"function")){av.onComplete.call(null,aA)}},onFailure:function au(aB,aA){var aC;a.debug(at.name,"Creation failed: %o",aB);if(g.is(aA)){if(g.is(aA.message,"string")){aC=aA.message;a.debug(at.name,aC)}}if(g.is(av.onFailure,"function")){av.onFailure.call(null,aB,aC)}},wait:true,parse:true,},av,true);return this.connections.create(null,ay)},addConn:function e(au,at){if(!g.is(au)){a.debug(self.name,"connData is not defined");return}if(!g.is(at)){at={}}at=g.merge(at,{merge:true,parse:true});return al.connections.add(au,at)},updateConn:function ai(av,au){var at=al.connections.get(av);au=au||{};au.onCompleteMsg="Updated Connection succesfully";au.onFailureMsg="Updating Connection failed";this.updateModel(at,au)},deleteConn:function w(ay,av){var at=this,ax=al.connections.get(ay);av=av||{};if(!g.is(ax)){a.debug(this.name,"Connection does not exists");if(g.is(av.onFailure)){av.onFailure()}return}ax.destroy({proxy:"passport",headers:N.getHeaders({isAuthoringCtx:true,isJsonOnly:true}),wait:true,onFailure:function au(aA,az){var aB;a.debug(at.name,"Deleting of connection failed: %s ",ay);if(g.is(az)){if(g.is(az.message,"string")){aB=az.message;a.debug(at.name,aB)}}if(g.is(av.onFailure)){av.onFailure(aA,az)}},onComplete:function aw(){a.debug(at.name,"Deleting of connection completed: %s ",ay);if(g.is(av.onComplete)){av.onComplete()}}})},addDocument:function x(at){return this.documents.add(at)},getDocument:function(at){return this.documents.get(at)},removeDocument:function u(at){return this.documents.remove(at)},getTypes:function P(){return this.pprTypes},getInstancesFromCollection:function T(at){return this.instances.where({isAggregatedBy:at})},getInstanceFromCollection:function d(at){return this.instances.get(at)},isReference:function k(at){return g.is(this.references.get(at))},isInstance:function i(at){return g.is(this.instances.get(at))},getParentInstancesFromCollection:function R(at){return this.instances.where({isInstanceOf:at})},getReferenceFromCollection:function ac(at){return this.references.get(at)},getReferencesArrayFromCollection:function c(av){var au=[];if(g.is(av,"array")){av.forEach(function at(aw){var ax=al.getReferenceFromCollection(aw);au.push(ax)})}return au},getReferenceModel:function z(at){var av,au=this.getReferenceFromCollection(at);if(!g.is(au)){av=this.getInstanceFromCollection(at);if(g.is(av)){au=this.getReferenceModelFromInstance(av)}}return au},getConnectionFromCollection:function ah(at){return this.connections.get(at)},findSomeConnection:function K(au,at){return this.connections.filter(au,at)},hasConnection:function G(au){var at=false,av=this.connections.findWhere(au);if(g.is(av)){at=true}return at},findConnections:function B(at){return this.connections.where(at)},getReferenceModelFromInstance:function ad(av){var au=av.get("isInstanceOf");var at=this.references.get(au);return at},getAggregatingReferenceModelFromInstance:function aj(av){var au=av.get("isAggregatedBy"),at=this.references.get(au);return at},getImpactedConnections:function h(at,au,ax){var aw;ax=ax||{};ax=g.merge(ax,{from:true,to:true});aw=this.connections.filter(function av(aB){var aC=aB.get("type"),aA=aB.getAttribute("to"),az=aB.getAttribute("from"),ay=false,aD;aD=function aD(aE){if(ax.relationTypes){ay=(ax.relationTypes.indexOf(aE)>=0)}else{if(ax.excludeRelationTypes){ay=(ax.excludeRelationTypes.indexOf(aE)===-1)}else{ay=true}}};if(ax.from&&(az===at||az===au)){aD(aC)}if(ax.to&&(aA===at||aA===au)){aD(aC+"_inverse")}return ay});return aw},needToQueryForConnections:function M(au,aw){var at=false,av;if(g.is(aw,"string")){av=au?au.get(aw):this.getInstanceFromCollection(aw);av=av?av:this.getReferenceFromCollection(aw)}else{av=aw}if(g.is(av)){if(!av.getAdditionalInfo("queriedForConnections")){at=true}}return at},needToQueryForChildren:function L(av){var au=false,at=g.is(av,"string")?this.references.get(av):av;if(g.is(at)){if(!at.getAdditionalInfo("queriedForChildren")){au=true}}return au},refreshAll:function A(aC,ay,au,aA){var at=aA||{},aE=g.is(at.context)?at.context:null,az=ay.concat(au,aC),aG=[],aB=0,aw=0,aF=function aF(aI){if(az.length!==0){az.forEach(function aH(aM){var aK,aL=function aL(){if((aB+aw)===az.length){aI()}},aN=function aN(aO){aB++;al.references.add(aO);aL()},aJ=function aJ(){aw++;aL()};aK=new n({PID:aM});aK.fetch({proxy:"passport",type:"json",headers:N.getHeaders(),onComplete:aN,onFailure:aJ});aG.push(aK)})}else{aI()}},ax,aD;a.log(this.name,"refreshAll, Body roots PID: "+aC);a.log(this.name,"refreshAll, Table roots PID: "+ay);a.log(this.name,"refreshAll, Auxiliary view roots PID: "+au);new I(aF).then(function av(){al.references.reset(aG,{silent:true});ax=al.instances.reset({},{silent:true});if(g.is(ax)){al.instances.remove(ax,{silent:true})}aD=al.connections.reset({},{silent:true});if(g.is(aD)){al.connections.remove(aD,{silent:true})}if(g.is(at.onComplete,"function")){at.onComplete.call(aE,aB,aw)}})},_removeDuplicate:function t(at){var au=function au(aw,ax,av){return !ax||aw!==av[ax-1]};if(g.is(at,"array")){at.sort();at=at.filter(au)}return at},expandOnBackbone:function am(aw,ay){var au=al.getInstancesFromCollection(aw),ax=[];if(g.is(au,"array")&&g.is(ay)){au.forEach(function at(aA){var az=aA.get("isInstanceOf");if(g.is(ay.referencesPID,"array")&&(ay.referencesPID.indexOf(az)===-1)){ay.referencesPID.push(az)}if(g.is(ay.instancesPID,"array")&&(ay.instancesPID.indexOf(aA.id)===-1)){ay.instancesPID.push(aA.id)}if(ax.indexOf(az)===-1){ax.push(az)}})}ax.forEach(function av(az){am(az,ay)})},addToCollections:function E(ax){var av=ax||{},aP={instancesAndReferences:[],connections:[],documents:g.is(av.documentIdMap)?av.documentIdMap:{}},aB=av.stackedReferences?av.stackedReferences:[],aJ=av.stackedInstances?av.stackedInstances:[],aS=av.stackedConnections?av.stackedConnections:[],aw=av.deletedObjects?av.deletedObjects:[],aT=av.references?av.references:al.references,aM=av.instances?av.instances:al.instances,aD=av.connections?av.connections:al.connections,aN=g.is(av.onComplete,"function")?av.onComplete:null,aQ=g.is(av.onFailure,"function")?av.onFailure:null,aI=g.is(av.onTimeout,"function")?av.onTimeout:null,at=g.is(av.silentMode,"boolean")?av.silentMode:true,aA=g.is(av.mergeMode,"boolean")?av.mergeMode:true,aE=g.is(av.parseMode,"boolean")?av.parseMode:true,au=g.is(av.context)?av.context:this,ay=function ay(aV,aY){var aX,aU;aV.forEach(function aW(aZ){aX=g.is(aZ.PID)?aZ.PID:aZ.attributesValue.PID;aU=al.getConnectionFromCollection(aX);if(!g.is(aU)){aP.connections.push(al.addConn(aZ,{silent:at,merge:aA,parse:aE}))}});aY()},aH=function aH(aV,aY){var aW,aX={};aV.forEach(function aU(aZ){aX={};if(g.is(aZ.queriedForChildren)){aX.queriedForChildren=aZ.queriedForChildren;delete aZ.queriedForChildren}if(g.is(aZ.queriedForConnections)){aX.queriedForConnections=aZ.queriedForConnections;delete aZ.queriedForConnections}if(g.is(aZ.queriedForDocuments)){aX.queriedForDocuments=aZ.queriedForDocuments;delete aZ.queriedForDocuments}if(g.is(aZ.ds6w)){aX.ds6w=aZ.ds6w;delete aZ.ds6w}aW=al.references.add(aZ,{silent:at,merge:aA,parse:aE});aP.instancesAndReferences.push(aW);aW.setAdditionalInfo(aX)});aY()},aR=function aR(aV,aY){var aW,aX;aV.forEach(function aU(aZ){aX={};if(g.is(aZ.queriedForConnections)){aX.queriedForConnections=aZ.queriedForConnections;delete aZ.queriedForConnections}if(g.is(aZ.filterQuery)){aX.filterQuery=aZ.filterQuery;delete aZ.filterQuery}aW=al.addInst(aZ,{silent:at,merge:aA,parse:aE});aP.instancesAndReferences.push(aW);aW.setAdditionalInfo(aX)});aY()},aG=function aG(aV,aX){var aU;aV.forEach(function aW(aY){aU=al.getInstanceFromCollection(aY);if(g.is(aU)){al.removeInstance(aY)}});aX()},aC=function aC(){if(g.is(aN,"function")){aN.call(au,aP)}else{if(g.is(aQ,"function")){aQ.call(au)}else{if(g.is(aI,"function")){aI.call(au)}}}},aK=function aK(){var aU={callback:ay,globalArray:aS,context:aD};return aa.getExecuteByBlockPromise(aU)},aO=function aO(){var aU={callback:aH,globalArray:aB,context:aT};return aa.getExecuteByBlockPromise(aU)},aL=function aL(){var aU={callback:aR,globalArray:aJ,context:aM};return aa.getExecuteByBlockPromise(aU)},aF=function aF(){var aU={callback:aG,globalArray:aw,context:aM};return aa.getExecuteByBlockPromise(aU)};aK().then(function az(){aO().then(function aU(){aL().then(function aV(){aF().then(aC)})})})},getFilteredInstancesFromCollection:function C(au,aw){var av;av=this.getInstancesFromCollection(au);if(g.is(aw)){av=av.filter(function at(az){var ay=false,ax=az.getAdditionalInfo("filterQuery");if(g.is(ax)){ay=(aw===ax)}return ay})}return av},traverseInstanceModels:function p(av,ay){var at,ax,au,aw=function aw(aB,az){var aA=al.getInstancesFromCollection(aB);aA.forEach(function(aC){az.push(aC)})};if(g.is(ay,"function")){at=[];aw(av,at);while(at.length>0){ax=at.pop();ay(ax);au=ax.get("isInstanceOf");aw(au,at)}}else{a.log(this.name,"callback cbProcessModel not provided")}},removeFilterFromCollection:function O(at,ax){var av=["union","intersection","minus"],aw=ax.root_physicalid;al.traverseInstanceModels(at,function au(aA){var aB=aA.getAdditionalInfo("filterQuery"),aD,az,ay,aC;if(g.is(aB)){for(az in aB){if(aB.hasOwnProperty(az)){if(av.indexOf(az)!==-1){aD=az;break}}}if(g.is(aD)){ay=aB[aD].expand;if(g.is(ay,"array")){aC=ay.some(function(aF){var aE;aE=aF.root_path_physicalid.reduce(function(aG,aH){return aG.concat(aH)},[]);return aE.indexOf(aw)!==-1});if(aC===true){aA.setAdditionalInfo({filterQuery:null})}}}}})},transformToOccPathWithRefDetail:function Z(aw){var au=[],av,at,ax=[];if(Array.isArray(aw)){au=aw;if(au.length>0){at=al.getInstanceFromCollection(au[0]);if(g.is(at)){av=at.get("isAggregatedBy")}}}else{av=aw}ax=g.is(av)?[av]:[];au.forEach(function(ay){ax.push(ay);at=al.getInstanceFromCollection(ay);if(g.is(at)){ax.push(at.get("isInstanceOf"))}});return ax}});return al});define("DS/DELPPWModelServices/EGraphUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWGraphModel/GraphCollection"],function(f,c,i,k){var e=c.singleton({name:"EGraphUtils",init:function o(){this.linkTypeName=new f.Class.Collection([],{});this.linkTypeName.add({name:"implement",typeAssociated:"ProductImplementLink"});this.linkTypeName.add({name:"implement",typeAssociated:"ProcessImplementLink"});this.linkTypeName.add({name:"implement",typeAssociated:"ProcessImplementLink_inverse"});this.linkTypeName.add({name:"implement",typeAssociated:"SystemImplementLink_inverse"});this.linkTypeName.add({name:"origin",typeAssociated:"HistorizationLinkRefRef"});this.linkTypeName.add({name:"origin",typeAssociated:"HistorizationLinkRefRef_inverse"});this.linkTypeName.add({name:"alternate",typeAssociated:"MfgProcessAlternate"});this.linkTypeName.add({name:"alternate",typeAssociated:"MfgProcessAlternate_inverse"});this.linkTypeName.add({name:"output",typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM"});this.linkTypeName.add({name:"output",typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM_inverse"});this.linkTypeName.add({name:"capableResources",typeAssociated:"DELAsmProcessCanUseCnx"});this.linkTypeName.add({name:"productFlow",typeAssociated:"DELLmiTimeConstraintCnx"});this.linkTypeName.add({name:"productFlow",typeAssociated:"DELLmiTimeConstraintCnx_inverse"});this.linkTypeName.add({name:"productFlow",typeAssociated:"DELLmiMaterialPathCnxCust"});this.linkTypeName.add({name:"productFlow",typeAssociated:"DELLmiMaterialPathCnxCust_inverse"});this.creatableTypesOfLink=new f.Class.Collection([],{});this.creatableTypesOfLink.add({img:"ProductImplementLink",linkType:"implement",displayed:true});this.creatableTypesOfLink.add({img:"DELLmiProductionSystemOutputCnxToMBOM",linkType:"output",displayed:true});this.creatableTypesOfLink.add({img:"MfgProcessAlternate",linkType:"alternate",displayed:true});this.creatableTypesOfLink.add({img:"HistorizationLinkRefRef",linkType:"origin",displayed:true});this.creatableTypesOfLink.add({img:"DELAsmProcessCanUseCnx",linkType:"capableResources",displayed:true});this.creatableTypesOfLink.add({img:"DELLmiTimeConstraintCnx",linkType:"productFlow",displayed:true})},addInstances:function l(u,A,q,v){var t=null,r=null,y=0,z=null,C=null,x=null,B=null,s,w;if(f.is(A)){t=A;r=A;y=u.findWhere({referencePID:A.get("PID")}).get("X")+1;if(f.is(A.id)){B=i.getInstancesFromCollection(A.id);B.forEach(function(D){x=i.getReferenceModelFromInstance(D);if(f.is(x)){s=f.is(v)?v+","+D.id:D.id;q.unshift([x,y,t.id,s,D.id])}})}if(f.is(q[0],"array")){if(q[0].length>=5){if(f.is(q[0][0])){z=f.is(q[0][0].id)?q[0][0].id:null;C=q[0][3]}u.add({PID:C,X:q[0][1],Type:this.getType(r.get("PPRTYPE")),isAggregatedBy:q[0][2],childOccurencePath:q[0][3],instancePID:q[0][4],referencePID:z,LINKS:this.getReferenceReferenceLinks(z)});r=q[0][0];w=q[0][3];q.shift();this.addInstances(u,r,q,w)}}}},getInstanceInstanceLink:function g(u){var q=[],w,v,s,r,t=this;Array.prototype.push.apply(q,i.connections.where({type:"DELLmiTimeConstraintCnx_inverse"}));Array.prototype.push.apply(q,i.connections.where({type:"DELLmiMaterialPathCnxCust"}));Array.prototype.push.apply(q,i.connections.where({type:"DELLmiTimeConstraintCnx"}));Array.prototype.push.apply(q,i.connections.where({type:"DELLmiMaterialPathCnxCust_inverse"}));Array.prototype.push.apply(q,i.connections.where({type:"DEFAULT"}));q.forEach(function(x){w=i.instances.where({PID:x.get("from")});v=i.instances.where({PID:x.get("to")});if(v.length!==0&&w.length!==0){s=u.where({instancePID:w[0].get("PID")});if(s.length!==0){w=i.references.where({PID:w[0].get("isInstanceOf")});v=i.references.where({PID:v[0].get("isInstanceOf")});r=new f.Class.Collection([],{});r.add({PID:x.get("PID"),from:w[0].get("PID"),to:v[0].get("PID"),type:x.get("type")});if(f.is(s[0].get("LINKS")._models)){Array.prototype.push.apply(r._models,s[0].get("LINKS")._models)}else{Array.prototype.push.apply(r._models,s[0].get("LINKS"))}if(t.isConnectionTypeAllowed(r._models[0]._attributes.type)){s[0].set({LINKS:r})}}}})},getReferenceReferenceLinks:function m(q){var t=[],r=i.connections.where({from:q}),s=this;r.forEach(function(v){var u;if(s.isConnectionTypeAllowed(v.get("type"))){u=i.references.where({PID:v.get("to")});if(u.length>0){t.push(v)}}});return t},getType:function j(q){switch(q){case"PROCESS":return 0;case"SYSTEM":return 1;case"OPERATION":return 1;case"RESOURCE":return 2;case"PRODUCT":return 3;default:return -1}},isConnectionTypeAllowed:function h(r){var q,s;s=this.linkTypeName.findWhere({typeAssociated:r});if(s){q=this.creatableTypesOfLink.findWhere({linkType:s._attributes.name})}if(f.is(q)){return q._attributes.displayed}return false},setLinkDisplayStatus:function n(r,q){var s=this.creatableTypesOfLink.findWhere({linkType:r});s.set("displayed",q)},getCreatableTypesOfLink:function p(){return this.creatableTypesOfLink},getEGraphData:function b(u){var t=new k(),r=[],s=this,q;u.forEach(function(v){q=i.getReferenceFromCollection(v);t.add({PID:q.id,X:0,Type:s.getType(q.get("PPRTYPE")),isAggregatedBy:null,referencePID:q.id,LINKS:s.getReferenceReferenceLinks(q.id)});s.addInstances(t,q,r)});this.getInstanceInstanceLink(t);return t},getProductFlowData:function d(x){var w=i.references,u=i.connections,t=i.instances,y=t.where({isAggregatedBy:x}),q=new f.Class.Collection([],{}),r,v,z,s;y.forEach(function(A){var B;v={PID:"",links:[],index:0};v.PID=A.get("isInstanceOf");z=u.where({from:A.get("PID")});z.forEach(function(C){r=t.findWhere({PID:C.get("to")});B=C.get("PID");if(f.is(r)){s=w.where({PID:r.get("isInstanceOf")});s.forEach(function(D){v.links.push([D.get("PID"),B])})}});q.push(v)});return q},isProductFlowLooped:function a(w){var r,x,y=[],u,v=new f.Class.Collection([],{}),t,q=new f.Class.Collection([],{}),s;x=function(z){return z.get("links").length>0};r=w.filter(x);y=r;while(y.length>0){u=y[0];v.add(u);u.get("links").forEach(function(z){w.findWhere({PID:z[0]}).set({index:(u.get("index")+1)});t=v.findWhere({PID:z[0]});q.add({from:u.get("PID"),to:z[0]});s=q.where({from:u.get("PID"),to:z[0]}).length;if(t!=="undefined"){y.push(w.findWhere({PID:z[0]}))}if(s>w.length*5){y=[];s=true}else{s=false}});y.shift()}return s}});return e});