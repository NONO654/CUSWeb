define("DS/ENOCharacteristicsWebApp/views/CharacteristicsView",["DS/Tree/TreeListView","DS/Spreadsheet/CellModel","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Utilities/KeyboardUtils","DS/UIKIT/Input/Select","DS/Tree/TreeNodeModel","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/ENOCharacteristicsWebApp/utils/UIUtil","DS/ENOCharacteristicsWebApp/utils/DnDUtil","DS/ENOCharacteristicsWebApp/utils/Constants","DS/UIKIT/Modal","DS/ENOCharacteristicsWebApp/controls/CharacteristicTestMethod","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/UIKIT/Mask","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS","DS/UIKIT/Tooltip","DS/Core/PointerEvents"],function(i,j,r,q,n,l,k,p,m,h,c,b,e,a,s,f,o,g){var d=i.extend({mContainer:null,mDimensionModel:null,mPrevCellnodeModel:null,mLineEditor:null,init:function(t){var u=this;this.charControl=t.charControl;t.apiVersion=2;t.useAsyncPreExpand=true;t.isEditable={switchToWriteView:{event:g.POINTERHIT,view:function(v){if(!v.isHeader){var E=false;var O=v.cellModel.getCellContent();var T=v.dataIndex;var w=v.cellView;var K=v.nodeModel;var y=K.options.grid;var N=[];var Q=[];if(y.id===undefined||y.id===""){return}var U=y.relationship;var R=y.overwriteAllowedOnChild;var J=y.overwriteAllowedOnChildFromMaster;var L=y.characteristicMasterName;var x=y.isDescriptionEditable==="TRUE";var S=(y.isTitleEditable==="TRUE");var C=y.valuationType;if(U==="ParameterUsage"||J==="FALSE"){if(T!=="sequenceOrder"){return}}switch(T){case"tree":return;case"Title":if(L!==""&&S===false){return}break;case"minimal":if(y.dimensionName==="BooleanParameter"||y.dimensionName==="StringParameter"){return}break;case"nominal":if(C===0){return}var D=y.multipleValues;if(y.dimensionName==="BooleanParameter"){N=[f.TRUE,f.FALSE];Q=["TRUE","FALSE"]}else{if(D!==undefined&&D.length>0){N=D;Q=D}}break;case"maximal":if(y.dimensionName==="BooleanParameter"||y.dimensionName==="StringParameter"){return}break;case"displayUnit":if(y.dimensionName==="BooleanParameter"||y.dimensionName==="StringParameter"){return}var P=y.dimensionName;if(P!=="IntegerParameter"&&P!=="RealParameter"){var z=u.mDimensionModel.getDisplayUnitForDiemension(P);var G=z.map(function(X,W){var V=X[W];return V[0]});var M=z.map(function(X,W){var V=X[W];return V[1]});N=G.length>0?G:[""];Q=M.length>0?M:[""]}break;case"precision":if(y.dimensionName==="BooleanParameter"||y.dimensionName==="StringParameter"){return}N=["","0.1","0.01","0.001","0.0001","0.00001"];Q=["","0.1","0.01","0.001","0.0001","0.00001"];break;case"priority":break;case"description":if(L!==""&&x===false){return}break;case"notes":break;case"missedTargetAction":N=[f.NoActionRequired,f.HoldandRetest,f.ShipandMonitor];Q=["No Action Required","Hold and Retest","Ship and Monitor"];break;case"overwriteAllowedOnChild":if(R==="FALSE"){return}case"appliesToBulk":case"appliesToInProcess":case"appliesToFinalPackage":N=[f.TRUE,f.FALSE];Q=["TRUE","FALSE"];break;case"testMethods":u.showTestMethods(K);break;default:}if(N.length>0){var B=new r({elementList:["dummy"]});var F=y[T];var I=Q.map(function(V){return(typeof V.toUpperCase==="function")?V.toUpperCase():V});var A=N.map(function(V){return(typeof V.toUpperCase==="function")?V.toUpperCase():V});F=(typeof F.toUpperCase==="function")?F.toUpperCase():F;var H=I.indexOf(F);if(H===-1){H=A.indexOf(F)}B.actionOnClickFlag=false;B.mainElementVisibleFlag=true;B.expanderVisibleFlag=false;if(H===-1&&N.indexOf("")===-1){N.splice(0,0,"")}B.elementsList=N;B.elementsListActual=Q;B.selectedIndex=H;B.enableSearchFlag=false;B.elements.container.addClassName("cellDropDownComboBox");B.addEventListener("change",function(V){B.selectedIndex=B.elementsList.indexOf(B.currentValue);K.setAttributeWithLabel(T,B.elementsListActual[B.selectedIndex]);v.cellModel.setCellContent(B.currentValue);v.cellModel.options.value=B.elementsListActual[B.selectedIndex];if(T==="displayUnit"&&!u.options.charControl.isInstantiatedIn3DD){u.updateValuesForDisplayUnit(v)}w.getGridEngine()._modelEvents.publish({event:"cell:read-only",data:v});V.stopPropagation()});B.addEventListener("click",function(V){V.preventDefault();V.stopPropagation()});B.addEventListener("DSpointerdown",function(V){V.preventDefault();V.stopPropagation()});B.addEventListener("DSpointerup",function(V){V.preventDefault();V.stopPropagation()});B.focus=function(){if(this.disabled){return}if(this._popupOpened){this._hidePopup(1)}else{this._showPopup()}};w.getContent().addClassName("cellZeroPadding");return B}else{var w=v.cellView;if(!!u.mPrevCellnodeModel&&u.mPrevCellnodeModel===v.cellModel._getID()){u.mLineEditor=new q({displayStyle:"text",sizeInCharNumber:40,selectAllOnFocus:true,value:v.cellModel.getCellContent().toString()});if(w.isInEditionMode()){u.mLineEditor.focus=function(){var V=this;V._myInput.removeClassName("wux-controls-lineeditor-hideCursor");if(!V.disabled&&V.selectAllOnFocus){V._myInput.select()}}}}else{u.mPrevCellnodeModel=v.cellModel._getID();u.mLineEditor=[];u.mLineEditor=new q({displayStyle:"text",sizeInCharNumber:40,selectAllOnFocus:true});u.mLineEditor.selectAllOnFocus=true;u.mLineEditor.value=v.cellModel.getCellContent().toString();w.getContent().setContent(u.mLineEditor)}w.getContent().addClassName("cellCharctsFont");w.getContent().addClassName("cellZeroPadding");u.mLineEditor.addEventListener("click",function(V){u.mLineEditor=w.reuseCellContent("_lineEditor");V.preventDefault();V.stopPropagation()});u.mLineEditor.addEventListener("change",function(V){v.cellModel.options.value=V.dsModel.value;v.nodeModel.setAttributeWithLabel(T,V.dsModel.value);u.mLineEditor=null;V.stopPropagation()});u.mLineEditor.focus=function(){var V=this;V._myInput.removeClassName("wux-controls-lineeditor-hideCursor");if(!V.disabled&&V.selectAllOnFocus){V._myInput.select()}};return u.mLineEditor}}},},};t.onDragStartColumnHeader=function(w,v){if(v.dataIndex==="charCategory"||v.dataIndex==="tree"){return}v.manager.__draggedColumnID=v.virtualColumnID;return true},t.onDragStartCell=function(x,y){if(!h.authorizeDrag(y,t.charControl)){return false}var v=[];var w=y.nodeModel.options.grid.modelType;if(!y.nodeModel.isSelected()){y.nodeModel.select()}y.manager.getDocument().getXSO().get().forEach(function(z){if(z.options.grid.modelType===w){v.push(z.dump())}});this.serializeDragAndDropEvent(x,{data:{"dswebux/x-tree.treenodemodel+json":v,"dswebux/x-tree.treenodemodel+number":y.nodeModel._getID(),draggedObjModelType:w}});x.dataTransfer.effectAllowed="move"},t.onDropBlankDefault=function(w,v){p.displayAlert(t.charControl.mAlert,f.DropNotAuthorizedHere,1)},t.onDropCellDefault=function(B,D){var w=this;B.preventDefault();var x,z,v,y,A;x=this.unserializeDragAndDropEvent(B);if(x){z=x.data["dswebux/x-tree.treenodemodel+number"];v=x.data["dswebux/x-tree.treenodemodel+json"];y=x.data.draggedObjModelType;if(y===c.CHARACTERISTICS_MODEL_TYPE){v.sort(function(F,E){return(F.grid.sequenceOrder>E.grid.sequenceOrder)?1:((E.grid.sequenceOrder>F.grid.sequenceOrder)?-1:0)})}if(D.nodeModel._getID()===z){return}if(v&&D.cellView){A=h.authorizeDrop(t.charControl,v,D);if(!A.authorizeDrop){return}var C={droppedNodes:v,dndInfos:D,charControl:t.charControl,reOrderAcrossCategory:A.reOrderAcrossCategory,draggedObjModelType:y};if(A.reOrderAcrossCategory){m.getSuperModal().confirm(f.ConfirmOnDnDAcrossCategories,f.CharacteristicsReOordering,function(E){if(E){h.processDropEffect(C)}})}else{h.processDropEffect(C)}}}},t.shouldDisplayTooltip=function(z){var x=z.cellView.getContent();var w="";if(z.isHeader){w=z.cellModel.options.value}else{if(z.dataIndex==="charCategory"&&z.nodeModel.options.grid.mandatoryCharacteristic==="Yes"){w=f.Mandatory}else{w=z.nodeModel.options.label[z.dataIndex]}}if(!UWA.is(w)){w="";if(z.dataIndex==="charCategory"&&z.nodeModel.options.grid.modelType==="Characteristics Category"){w=z.nodeModel.options.label}}if(w!==""&&z.dataIndex!=="testMethods"){if(document.documentMode){var v={position:"bottom left",animate:false,delay:{},target:x,body:w};var y=new o(v);return{longHelp:""}}else{return{longHelp:w}}}},t.resize={columns:true,rows:true};this._parent(t);this.render()},render:function(){this.mContainer=UWA.createElement("div",{"class":"enogls-chrts-TableView"})},showTestMethods:function(w){var v=w.options.grid.id;var t=this;this.mTestMethodsSkeletonContainer=new b({closable:true,animate:true,className:"testMethods-Skeleton",header:w.options.grid.Title+" | "+f.TestMethodsPageHeader,events:{onHide:t.updateTestMethodsField.bind(t,w)}});this.mTestMethodsSkeletonContainer.inject(document.body).show();var u=new e(v,this.mTestMethodsSkeletonContainer.elements.body)},updateTestMethodsField:function(w){var u=this;var v=w.options.grid.id;var t=a.getGLSWebServiceURL()+c.CHARACTERISTICS_ENDPOINT+c.CHARACTERISTICS_GET_CONNECTED_TM+"?objectId="+v;a.send3DSpaceRequest(t,"GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},},function(x){w.prepareUpdate();w.setAttribute("testMethods",x);w.pushUpdate()},function(x){p.displayErrorResponse(u.charControl.mAlert,x)})},setCharacteristicsDimensionModel:function(t){this.mDimensionModel=t},updateValuesForDisplayUnit:function(v){var u=this;u.cellInfos=v;u.cellInfos.oldValues=[];u.nominal=null;u.minimal=null;u.maximal=null;var t=a.getGLSWebServiceURL()+c.CHARACTERISTICS_ENDPOINT;a.send3DSpaceRequest(t+"getValuesForDisplayUnit","GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:{displayUnit:v.nodeModel.options.grid.displayUnit,id:v.nodeModel.options.grid.id}},function(z){var x=u.mContainer;s.mask(x);var A=u.cellInfos.rowID;var w=["nominal","minimal","maximal"];w.forEach(function(C){var D=u.cellInfos.manager.getColumnIDFromDataIndex(C);var B=u.cellInfos.manager.getCellModel(A,D);u.cellInfos.oldValues[C]=B.options.value;if(z[C]!==""){B.options.value=z[C];u.cellInfos.nodeModel.setAttributeWithLabel(C,z[C]);B.addClass("cellCharctsFont");B.setCellStyle({color:"red",backgroundColor:"#FFC8B3"});var E=u.cellInfos.cellModel._manager.getCell(A,D).getView();E.updateView()}});if(u.cellInfos.nodeModel.options.grid.multipleValuesChanged===undefined){u.cellInfos.nodeModel.options.grid.multipleValuesChanged=true;var y=u.cellInfos.nodeModel.options.grid.multipleValues;u.cellInfos.nodeModel.options.grid.multipleValuesOld=y}u.cellInfos.nodeModel.setAttributeWithLabel("multipleValues",z.multipleValues)},function(w){s.unmask(u.mContainer);p.displayErrorResponse(options.charControl.mAlert,f.DisplayUnitChangeError)})}});return d});