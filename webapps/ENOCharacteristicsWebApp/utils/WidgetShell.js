define("DS/ENOCharacteristicsWebApp/utils/WidgetShell",["UWA/Core","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/ENOCharacteristicsWebApp/utils/PlatformManager","DS/ENOCharacteristicsWebApp/utils/RequestUtils"],function(f,e,a,c,d){var b=f.Class.extend({mApplication:null,mTenantList:[],mCharColumnPreferences:undefined,init:function(g){this.options=g;this.mCharColumnPreferences=g.isConsolidatedView?"consCharacteristicsColumnPreferences":"characteristicsColumnPreferences";if(!this.options.target||!this.options.app||!this.options.app.module){console.log("ERROR: Widget shell call incorrect.");return}if(!this.options.app.module){this.options.app.options={}}if(!widget){console.log("ERROR: Not in a widget environement.");return}return this},runApp:function(i){var h=this;var g=function(j){h._setTenantList(j);h._createApp(i)};this._initEvents();this._loadUrls(g)},_createApp:function(h){this.options.target.empty();this._initPreferences();var g=this;require([this.options.app.module],function(i){g.options.app.options={ObjectID:null,InstantiatedIn:"3DDashboard",isConsolidatedView:g.options.isConsolidatedView};g._updateActiveTenant(function(){g.mApplication=new i(g.options.app.options).inject(g.options.target);if(h){h(g.mApplication)}})})},_loadUrls:function(i){console.log("_loadUrls");var h=a.getApplicationConfiguration("app.urls.myapps");if(!h){return}var j={type:"CollaborativeStorage"};var g=h+"/resources/AppsMngt/environment";d.sendDataRequest(g,{timeout:15000,method:"get",data:j,type:"json",proxy:"passport",headers:{Accept:"application/json"},onComplete:function(k){i(k.cstorage)},onFailure:function(k){}})},_setTenantList:function(n){if(n.length===0){return}this.mTenantList=n;var j=widget.getValue("Tenant");var h=[];var l=n[0].id;var o=widget.getValue("x3dPlatformId");if(!j&&o){l=o}for(var k=0;k<n.length;k++){if(j&&(j.toLowerCase()===n[k].id.toLowerCase())){l=j}var g={label:n[k].displayName,value:n[k].id};h.push(g)}var m={type:"list",name:"Tenant",label:"Tenant Enovia",defaultValue:l,options:h};widget.addPreference(m);widget.addPreference({name:this.mCharColumnPreferences,type:"hidden",defaultValue:[]});widget.setValue("Tenant",l)},_updateActiveTenant:function(h){var j=widget.getValue("Tenant");for(var g=0;g<this.mTenantList.length;g++){if(this.mTenantList[g].id.toLowerCase()===j.toLowerCase()){d.m3DSpaceURL=this.mTenantList[g].url;break}}this._initContext(function(){h()})},_initContext:function(g){var h=widget.getValue("Tenant");d.send3DSpaceRequest(d.getGLSWebServiceURL()+"application/context/init?tenant="+h,"GET",{type:"json"},function(){g()},function(){g()})},_initPreferences:function(){var g=widget.getPreferences();for(var h=0;h<g.length;h++){if(g[h].name==="Tenant"){g[h].label="Enovia tenant"}}widget.setPreferences(g)},_initEvents:function(){widget.addEvent("onDataReady",function(){});widget.addEvent("onRefresh",this.onRefreshEvent.bind(this));widget.addEvent("onSearch",this.onSearchEvent.bind(this));widget.addEvent("onResetSearch",this.onResetSearchEvent.bind(this))},onRefreshEvent:function(){if(!this.mApplication){return}var j=this;var l={};var g=widget.getPreferences();for(var h=0;h<g.length;h++){var k=g[h];l[k.name]=k.value}this._updateActiveTenant(function(){j.mApplication.dispatchEvent("onContextChange",l)})},onSearchEvent:function(g){if(!this.mApplication){return}this.mApplication.dispatchEvent("onSearch",g)},onResetSearchEvent:function(){if(!this.mApplication){return}this.mApplication.dispatchEvent("onSearch","")}});return b});