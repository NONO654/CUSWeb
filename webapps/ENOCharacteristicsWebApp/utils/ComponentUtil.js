define("DS/ENOCharacteristicsWebApp/utils/ComponentUtil",["UWA/Core","UWA/Class","DS/Tree/TreeNodeModel","DS/ENOCharacteristicsWebApp/models/CompositeItemModel","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/ENOCharacteristicsWebApp/utils/Constants","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS"],function(h,b,g,e,i,c,d,f,j,k){var a=b.singleton({urlRoot:i.getGLSWebServiceURL()+c.CHARACTERISTICS_ENDPOINT,init:function(){return this},getItemModel:function(l){var m=new e({id:l.M1ObjectId,pid:l.pid,title:l.title,current:l.current});return m},fetchCharacteristicStructure:function(q,p){var n=this;var m=c.CHARACTERISTICS_LIST_ENDPOINT;var l=q.mObjectId;if(p){l=q.mPID}var o={objectId:l,isPID:p};if(q.mIsConsolidatedView){m=c.CHARACTERISTICS_LIST_STRUCT_ENDPOINT;o={objectId:q.mPID,isPID:true,iExpandLevel:0,iOrdered:true}}i.send3DSpaceRequest(this.urlRoot+m,"GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:o},function(r){var t=r[0];var s={ownerItemRootId:t.M1ObjectId};if(p){q.dispatchEvent("DS.GLS.itemIDUpdated",s);j.publish("DS.GLS.UpdateWindowTitle",{title:r[0].Title})}n.getCharacteristicsFromJSON(t,true,q)},function(s,r){d.displayErrorResponse(null,r)})},getCharacteristicsFromJSON:function(l,o,n){if(o===true){n.emptyTreeDocument()}n.dispatchEvent("onCharacteristicsLoad");n.mTreeNodeModel.setLabel(l.Title);n.mTreeNodeModel.options.grid.current=l.current;n.mTreeNodeModel.options.grid.Title=l.Title;n.loadCharacteristics(l.Characteristics);if(l.Item_Childrens!==undefined){for(var m=0;m<l.Item_Childrens.length;m++){this.addChildItemRecursively(l.Item_Childrens[m],n)}}n.dispatchEvent("onCharacteristicsLoadFinished")},addChildItemRecursively:function(m,l){var q=this;var n={id:m.M1ObjectId,pid:m.PID,title:m.Title,current:m.current};var p=a.getItemModel(n);p.loadCharacteristics(m.Characteristics);l.addChildItem(p);if(m.Item_Childrens===undefined){return}for(var o=0;o<m.Item_Childrens.length;o++){this.addChildItemRecursively(m.Item_Childrens[o],p)}},evaluateCriteria:function(n){var l=this;var m=n.mRootItem;i.send3DSpaceRequest(this.urlRoot+c.CHARACTERISTICS_EVALUATE_CRITERIA,"POST",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:{objectId:m.mObjectId}},function(p,o){l.getCharacteristicsFromEvaluateCriteria(p,n)},function(q,p){var o=m.mWebAppViewContainer;f.unmask(o);d.displayErrorResponse(n.mAlert,p)})},getCharacteristicsFromEvaluateCriteria:function(l,p){var o=p.mRootItem;var m=o.mWebAppViewContainer;f.unmask(m);if(l===null){d.displayAlert(p.mAlert,k.NoCriteriaMatchedMessage,1);return}else{if(l.NewCharacteristics){o.loadCharacteristics(l.NewCharacteristics);d.displayAlert(p.mAlert,l.NewCharacteristicsCount+" "+k.NewCharacteristicsCreated,3)}else{l.Title=o.mTreeNodeModel.getLabel();this.getCharacteristicsFromJSON(l,true,o);d.displayAlert(p.mAlert,k.EvaluationComplete,3)}}var n={rootNode:o.mTreeNodeModel,reOrderAcrossCategory:false};p.updateSequenceOrder(n)},});return a});