define("DS/ENOCharacteristicsWebApp/controls/EditColumnSettings",["DS/UIKIT/Input/Text","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/UIKIT/Modal","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Controls/Toggle","DS/Controls/LineEditor","DS/ENOCharacteristicsWebApp/utils/TableViewPreference"],function(b,g,e,f,h,k,d,c,i,a,j){EditColumnSettings=e.extend({mEditColumnViewPreferences:null,mEditColumnViewModal:null,init:function(l){this.charControl=l;this.mCharColumnPreferences=l.mCharColumnPreferences;this.elements=this.elements||{};this.elements.container=g.createElement("div",{"class":"GLS-EditViewColumnSettings"});this.pushFormContent(this.charControl)},createBody:function(l){var m=this;var t=l.isInstantiatedIn3DD?"view-preferences-toggle":"view-preferences-toggle view-preferences-toggle-3DSpace";var o=l.isInstantiatedIn3DD?"view-preferences-linecontrol":"view-preferences-linecontrol view-preferences-linecontrol-3DSpace";var u={columns:[{dataIndex:"dataIndex",width:0,isHidden:true},{text:k.HeaderName,dataIndex:"header",width:"auto",},{text:k.IsVisible,dataIndex:"colVisibility",width:"20%",},{text:k.ColumnWidth,dataIndex:"width",width:"20%",},{text:k.MinWidth,dataIndex:"minWidth",width:"20%",},]};u.charControl=l;u.showVerticalLines=true;u.isSortable=false;u.isDraggable=true;u.isEditable=true;u.apiVersion=2;u.defaultCellHeight=40;u.enableScrollOnDrag=true;u.selection={cells:false,canMultiSelect:false,columnHeaders:false};u.resize={columns:true,rows:true};u.isEditable={switchToWriteView:{event:"dbclick",callback:function(v){return}},switchToReadView:{callback:function s(v){this.switchToReadView()},view:function p(z){switch(z.dataIndex){case"header":z.cellView.getContent().setStyles({textAlign:"center"});return z.cellModel.getCellContent();case"colVisibility":var w,y;w=new i({type:"switch",label:""});w.elements.container.addClassName(t);w.addEventListener("buttonclick",function(A){var B=A.dsModel.value;if(UWA.typeOf(B)==="string"){B=UWA.Json.decode(B)}B.isVisible=A.dsModel._properties.checkFlag.value;z.nodeModel.updateOptions({grid:{colVisibility:{isVisible:B.isVisible}}})});y=z.cellModel.getCellContent();if(UWA.typeOf(y)==="string"){y=UWA.Json.decode(y)}if(y.isVisible===true){w.checkFlag=true}if(y.mandatory==="true"){w.disabled=true}w.value=y;return w;case"width":var x=new a({value:z.cellModel.getCellContent()});x.addEventListener("change",function(A){A.stopPropagation();z.cellModel.setCellContent(A.dsModel.value)});x.elements.container.addClassName(o);return x;case"minWidth":var v=new a({value:z.cellModel.getCellContent()});v.addEventListener("change",function(A){A.stopPropagation();z.cellModel.setCellContent(A.dsModel.value)});v.elements.container.addClassName(o);return v;default:return z.cellModel.getCellContent()}}}};u.onDragStartCell=function(w,x){var v=[];if(!x.nodeModel.isSelected()){x.nodeModel.select()}x.manager.getDocument().getXSO().get().forEach(function(y){v.push(y.dump())});this.serializeDragAndDropEvent(w,{data:{"dswebux/x-tree.treenodemodel+json":v,"dswebux/x-tree.treenodemodel+number":x.nodeModel._getID()}});w.dataTransfer.effectAllowed="move"},u.onDropCellDefault=function(B,C){var w=this;B.preventDefault();var x,A,v,E,y,z,D;x=this.unserializeDragAndDropEvent(B);if(x){A=x.data["dswebux/x-tree.treenodemodel+number"];v=x.data["dswebux/x-tree.treenodemodel+json"];if(C.nodeModel._getID()===A){return}if(v){v.forEach(function(G,F){E=new c(G);if(C.cellView){y=C.nodeModel;z=C.manager.getDocument().options.shouldAcceptDrop({parentTreeNodeModel:y,draggedTreeNodeModel:E,dropPosition:C.dropPosition});if(z){C.manager.getDocument().prepareUpdate();C.manager.getDocument().getXSO().get().forEach(function(H){H.remove()});C.manager.getDocument().pushUpdate();if(C.virtualRowID!==-1){switch(C.dropPosition){case"top":y.getParent().insertBefore(E,y);break;default:case"middle":y.getParent().addChild(E,C.virtualRowID);break;case"bottom":y.getParent().addChild(E,y.getParent().getChildren().indexOf(y)+1);break}return false}else{return true}}else{return false}}})}}},u.shouldDisplayTooltip=function(v){if(v.dataIndex==="tree"&&v.isHeader){return{longHelp:k.Order}}if(v.dataIndex==="tree"&&!v.isHeader){return{longHelp:""}}else{if(v.cellModel.options.value){if(v.dataIndex==="colVisibility"&&!v.isHeader){return{longHelp:k[v.cellModel.options.value.isVisible.toString().toUpperCase()]}}if(typeof v.cellModel.options.value==="string"){return{longHelp:v.cellModel.options.value}}else{if(v.cellModel.options.value.toString){return{longHelp:v.cellModel.options.value.toString()}}else{return{longHelp:""}}}}else{return{longHelp:""}}}return{longHelp:""}};this.preferences_grid=new d(u);this.preferences_grid.getManager().onColumnHeaderRequest(function(v){if(v.isHeader){if(v.dataIndex=="tree"){v.cellModel.options.value=k.Order}v.cellView.getContent().setText(v.cellView.getCellInfos().cellModel.options.value);v.cellView.getContent().setStyles({textAlign:"center"})}});this.preferences_grid.getManager().setColumnWidth("tree","10%");this.preferences_grid.getManager().onCellRequest(function(v){if(v.dataIndex=="tree"){v.cellView.getContent().setText(v.nodeModel.options.label);v.cellView.getContent().setStyles({textAlign:"center",paddingLeft:"0px"})}});var n;var q=m.charControl.mViewCharacteristics.options.columns;var r=1;q.forEach(function(w){if(w.dataIndex=="tree"||w.dataIndex=="selection"||w.dataIndex=="charCategory"){return}if(UWA.is(w.isVisible)){w.isVisible=((w.isVisible).toString()===true.toString())}else{w.isVisible=true}if(UWA.is(k[w.text.replace(/\s/g,"")])){w.text=k[w.text.replace(/\s/g,"")]}var v={colVisibility:{isVisible:w.isVisible,mandatory:UWA.is(w.mandatory)?w.mandatory:false},header:w.text,dataIndex:w.dataIndex,width:UWA.is(w.width)?w.width:"auto",minWidth:UWA.is(w.minWidth)?w.minWidth:"100",};n=new c({label:r++,grid:v});m.preferences_grid.addRoot(n)});return this.preferences_grid},pushFormContent:function(m){var n=this;this.mEditColumnViewModal=new h({closable:true,className:"editTableViewSettings",animate:false,header:"<h4>"+k.EditViewColumns+"</h4>",body:this,footer:[this.doneButton(),this.cancelButton()],events:{onHide:function(){}}});this.mEditColumnViewModal.inject(document.body);this.mEditColumnViewModal.show();this.mEditColumnViewPreferences=this.createBody(m);this.elements.container.setContent(this.mEditColumnViewPreferences);var l=this.elements.container.getElement("div.wux-datagrid");if(navigator.appVersion.indexOf("Mac")!=-1){l.addClassName("characteristics-view-height-in-3dspace");l.getElement("div.wux-layouts-gridengine").addClassName("characteristics-view-height-in-3dspace")}},doneButton:function(){var l=this;return new f({value:k.Done,className:"info",events:{onClick:function(){var n=l.charControl.mViewCharacteristics.options.columns;var m=j.getColumnOrder(n,l.preferences_grid.getManager(),l.charControl.mIsConsolidatedView);j.setWidgetPreferences(l.mCharColumnPreferences,m.Columns,l.charControl.isInstantiatedIn3DD);if(m.isChanged===true){j.sortViewColumns(m.Columns,l.charControl.mViewCharacteristics.getManager(),l.charControl.mIsConsolidatedView)}l.onClose()}}})},cancelButton:function(){var l=this;return new f({value:k.Cancel,className:"default",events:{onClick:function(){l.onClose()}}})},onClose:function(){this.mEditColumnViewModal.destroy();this.mEditColumnViewModal=null},});return EditColumnSettings});