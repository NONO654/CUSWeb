define("DS/ENOCharacteristicsWebApp/controls/CharacteristicsControl",["UWA/Core","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/Controls/Abstract","DS/ENOCharacteristicsWebApp/controls/CharacteristicsToolbarControl","DS/UIKIT/Spinner","DS/ENOCharacteristicsWebApp/views/CharacteristicsView","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/ENOCharacteristicsWebApp/utils/ComponentUtil","DS/ENOCharacteristicsWebApp/utils/UIUtil","DS/UIKIT/Mask","DS/ENOFrameworkPlugins/jQuery","DS/PlatformAPI/PlatformAPI","DS/ENOCharacteristicsWebApp/utils/Constants","DS/Core/PointerEvents","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/ENOCharacteristicsWebApp/models/CharacteristicsModel","DS/ENOCharacteristicsWebApp/models/CharacteristicsCategoryModel","DS/ENOCharacteristicsWebApp/models/CompositeItemModel","DS/ENOCharacteristicsWebApp/utils/TableViewPreference","DS/UIKIT/Alert","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS"],function(j,v,s,u,n,e,b,k,r,A,h,d,c,l,g,y,x,t,q,p,a,f,m,o,i){var z=s.extend({name:"CharacteristicsControl",urlRoot:b.getGLSWebServiceURL()+c.CHARACTERISTICS_ENDPOINT,mRootItem:null,mFrameWindow:null,mViewCharacteristics:null,mViewPreferences:null,mCharacteristicsApp:null,mObjectId:null,mPID:null,mRootItemModelObserver:null,isInstantiatedIn3DD:false,mArrDirtyCellList:[],mArrOldValues:[],mIsCharWindowShow:false,mIsConsolidatedView:undefined,mSelectedMGAObjectId:undefined,mIsMGAObjectSelected:undefined,mCharColumnPreferences:undefined,mAccess:{},mPrevCellnodeModel:null,mWidgetPrefData:[],mAlert:null,init:function(B){this._parent(B);this.mCharacteristicsApp=B;this.mRootItem=B.mRootModel;this.isInstantiatedIn3DD=this.mCharacteristicsApp.isInstantiatedIn3DDashboard();this.mIsConsolidatedView=this.mCharacteristicsApp.isConsolidatedView();this.mCharColumnPreferences=this.mIsConsolidatedView?"consCharacteristicsColumnPreferences":"characteristicsColumnPreferences";this._buildControlSkeleton();this._setSelectionCallbacks()},_buildControlSkeleton:function(){var C="enogls-chrsts-editor-container";var D="enogls-chrsts-CharacteristicsView";if(document.documentMode&&!(this.isInstantiatedIn3DD)){D="ie-characteristics-container"}else{if(this.isInstantiatedIn3DD){D="enogls-chrsts-CharacteristicsView_3DD"}}this.elements.container=new j.Element("div",{"class":C});var B=this.elements.container;if(this.isInstantiatedIn3DD===true){B=widget.body}else{this.elements.CharacteristicsToolbarControl=new u({objectId:this.mRootItem.mObjectId,manager:this}).inject(this.elements.container)}this.elements.containerview=j.createElement("div",{"class":D}).inject(this.elements.container)},_setSelectionCallbacks:function w(){if(this.isInstantiatedIn3DD===true){d.subscribe("DS.MGA.Selection.SelectionModified",this.onMGASelectionModified.bind(this));d.subscribe("DS.MFN.Selection.SelectionModified",this.onMGASelectionModified.bind(this));if(this.mIsConsolidatedView){d.subscribe("DS.ShowConsolidatedCharactscsCmd.CharWindowShow",this.onCharWindowShow.bind(this));d.subscribe("DS.ShowConsolidatedCharactscsCmd.CharWindowHide",this.onCharWindowHide.bind(this))}else{d.subscribe("DS.ShowCharacteristicsCmd.CharWindowShow",this.onCharWindowShow.bind(this));d.subscribe("DS.ShowCharacteristicsCmd.CharWindowHide",this.onCharWindowHide.bind(this))}}},onCharWindowShow:function(C){if(widget.id!==C.widgetId){return}this.mIsCharWindowShow=true;var B={modifiedObjectPID:C.selectedMGAObjectId,modifiedObjectSelectionState:true};this.onMGASelectionModified(B)},onCharWindowHide:function(B){if(widget.id!==B.widgetId){return}this.mIsCharWindowShow=false},setOwnerItemRootModelId:function(B){this.mRootItem.mObjectId=B.ownerItemRootId;this.mObjectId=B.ownerItemRootId;if(this.isInstantiatedIn3DD===false){this.elements.CharacteristicsToolbarControl.mObjectId=this.mObjectId;this.elements.CharacteristicsToolbarControl.render()}},setModelEventsCallback:function(){if(this.mRootItemModelObserver!==null){return}this.mRootItemModelObserver=new j.Class.Listener();this.mRootItemModelObserver.listenTo(this.mRootItem,"onCharacteristicsLoad",this.createView.bind(this));this.mRootItemModelObserver.listenTo(this.mRootItem,"onCharacteristicsLoadFinished",this.onCharacteristicsLoadFinished.bind(this));this.mRootItemModelObserver.listenTo(this.mRootItem,"DS.GLS.syncModel",this.syncModel.bind(this));this.mRootItemModelObserver.listenTo(this.mRootItem,"DS.GLS.itemIDUpdated",this.setOwnerItemRootModelId.bind(this))},syncModel:function(){var B=this.mViewCharacteristics.getManager();B.syncModel();if(!this.mIsConsolidatedView){B.hideRow(0)}},setViewPreferences:function(B){var C=this;var D=C.isInstantiatedIn3DD?c.CHARACTERISTICS_GET_COLUMN_PREFERENCES:c.CHARACTERISTICS_GET_COLUMN_PREFERENCES_IN_3DSPACE;b.send3DSpaceRequest(this.urlRoot+D,"GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:{objectId:B,isInstantiatedIn3DD:C.isInstantiatedIn3DD,preferenceName:C.mCharColumnPreferences}},function(H){var M=(H.columnPreferences);var G=H.hasCHMTLicense;var I=H.objectAccess;C.mViewPreferences=j.Json.xmlToJson(M);C.mViewPreferences.Root.ColumnDefinition.forEach(function(O){if(j.is(i[O.text.replace(/\s/g,"")])){O.text=i[O.text.replace(/\s/g,"")]}if(j.typeOf(O.isEditable)===undefined||(j.typeOf(O.isEditable)==="string"&&O.isEditable.toUpperCase()==="TRUE")){O.isEditable=true}if(G==="false"||I.hasModifyAccess==="false"){O.isEditable=false}});if(G==="true"){C.mAccess={Modify:I.hasModifyAccess==="false"?false:true,FromConnect:I.hasFromConnectAccess==="false"?false:true,FromDisconnect:I.hasFromDisconnectAccess==="false"?false:true}}if(G==="false"||I.hasFromConnectAccess==="false"||I.hasFromDisconnectAccess==="false"||I.hasModifyAccess==="false"){h("#createCharacteristicsLink").hide();h("#createFromMasterLink").hide();h("#evaluateCriteriaLink").hide();h("#deleteCharacteristicsLink").hide();h("#saveEdit").hide();h("#cancelEdit").hide();h("#updateCharacteristicsLink").hide();h("#addTestMethodLink").hide();h("#removeTestMethodLink").hide()}if((parent.Browser&&parent.Browser.MOBILE)||(navigator.maxTouchPoints>0)){h("#exportCharacteristicsLink").hide()}var F=C.mViewPreferences.Root.ColumnDefinition;var E;var N;for(var J=0;J<F.length;J++){E=F[J];E.width=r.getValidColumnWidth(E.width);E.minWidth=r.getValidColumnMinWidth(E.minWidth);if(E.dataIndex==="tree"){N=E.text;F.splice(J===0?J:J-1,1)}}if(C.mIsConsolidatedView){r.removeColumnByDataIndex(F,"charCategory")}var L={isSortable:false,text:i[N],dataIndex:"tree",width:200,minWidth:150,isVisible:true,};F.splice(0,0,L);F.splice(0,0,{isSortable:false,text:"",dataIndex:"selection",type:"selection",width:40,minWidth:30,});if(C.isInstantiatedIn3DD&&typeof widget!=="undefined"){var K=widget.getValue(C.mCharColumnPreferences);if(j.is(K)&&K.length>0){C.mWidgetPrefData=JSON.parse(K)}}else{if(j.is(H.WidgetColumnPreferencesIn3DSpace)&&H.WidgetColumnPreferencesIn3DSpace!==""){C.mWidgetPrefData=JSON.parse(H.WidgetColumnPreferencesIn3DSpace)}}},function(F,E){v.displayErrorResponse(C.mAlert,E)})},onMGASelectionModified:function(B){if(B.widgetId!==undefined&&widget.id!==B.widgetId){return}if(B.modifiedObjectSelectionState){this.mRootItem.mPID=B.modifiedObjectPID;if(this.mIsCharWindowShow){if(this.mViewCharacteristics!==null){this.mViewCharacteristics=null}this.refreshCharacteristicView(this.mRootItem,true)}}else{this.mRootItem.emptyTreeDocument()}},refreshCharacteristicView:function(D,C){if(D.mPID!==undefined){if(D.mPID===null){v.displayAlert(this.mAlert,i.SelectAnItem,2);return}this.setViewPreferences(D.mPID)}var B=this.elements.containerview;A.mask(B);k.fetchCharacteristicStructure(D,C)},injectAlertBox:function(C){var B=new o({className:"enogls-charactcs-alert",animate:true,closable:true,visible:false,autoHide:true,closeOnClick:true,hideDelay:5000,icon:true,maximumVisibleMessages:5});this.mAlert=B;this.mAlert.inject(C,"top")},createView:function(){if(this.mViewCharacteristics!==null){return}var G=this;var D="characteristics-view-height-in-3dspace";var C=G.mViewPreferences.Root.ColumnDefinition;this.mViewCharacteristics=new e({charControl:G,columns:C,defaultCellHeight:30,apiVersion:2,height:"auto",});this.injectAlertBox(this.elements.container);this.mViewCharacteristics.elements.container.inject(this.elements.containerview);var F=this.mViewCharacteristics.getManager();F.registerReusableCellContent({id:"_toggle",buildContent:function(){return new g({checkFlag:false})}});F.registerReusableCellContent({id:"_lineEditor",buildContent:function(){return new x({displayStyle:"text",sizeInCharNumber:40,selectAllOnFocus:true})}});this.mRootItem.setCharatersticsViewContainer(this.elements.containerview);this.mViewCharacteristics.setCharacteristicsDimensionModel(this.mRootItem.mDimensionModel);var E=this.mViewCharacteristics.options.columns;E.forEach(function(H){if(H.dataIndex==="tree"){return}H.onCellRequest=G.onCellRequest.bind(G)});var B=this.mViewCharacteristics.elements.container.getElement("div.wux-datagrid")},onCellRequest:function(B){var Z=B.dataIndex;var N=B.view;var G=this;var X=false;if(Z==="selection"){var L;var Y=B.manager;if(!B.isHeader){var T=B.cellView.reuseCellContent("_selection");if(T){T.checkFlag=B.nodeModel.isSelected()?true:false}B.cellView.getContent().removeClassName("cellUsageCharHighlight");B.view.setAttribute("tabindex","-1")}else{if(Y.options.selection.canMultiSelect){L=new g({checkFlag:Y.isEveryVisibleNodeSelected()||(Y.getDocument().getXSO().get().length>0&&!Y.isEveryVisibleNodeSelected()),mixedState:Y.getDocument().getXSO().get().length>0&&!Y.isEveryVisibleNodeSelected()});L.getContent().addEventListener(l.POINTERDOWN,function(ab){ab.stopPropagation()});L.getContent().addEventListener("focus",function(ab){ab.preventDefault();ab.stopPropagation()});L.getContent().addEventListener("change",function(ab){if(ab.dsModel.checkFlag||ab.dsModel.mixedState){Y.selectAllVisibleNodes()}else{Y.unselectAll()}Y._giveFocus()});B.cellView.getContent().setHTML(L)}}}else{if(!B.isHeader){var H=B.cellModel;var O=B.nodeModel;var F=O.options.grid;var R=F.id;if(H){var E=B.cellView;var S=H.getCellContent();H.addClass("cellCharctsFont");E.getContent().addClassName("cellCharctsFont");if(R){X=false;var C;var Q=H.options.columnID;var aa=F.relationship;var V=B.nodeModel.options.grid.overwriteAllowedOnChild;var M=B.nodeModel.options.grid.overwriteAllowedOnChildFromMaster;var P=B.nodeModel.options.grid.characteristicMasterName;var D=(B.nodeModel.options.grid.isDescriptionEditable==="TRUE")?true:false;var W=(B.nodeModel.options.grid.isTitleEditable==="TRUE")?true:false;var K=B.nodeModel.options.grid.valuationType;var U=B.nodeModel.options.grid.dimensionName;this.cellInfos=B;if(Z==="minIncluded"||Z==="maxIncluded"){C=new g({checkFlag:O.options.grid[Z]});C.addEventListener("click",function(ab){O.options.grid[Z]=C.checkFlag;E.getGridEngine()._modelEvents.publish({event:"cell:read-only",data:B});C.checkFlag=(O.options.grid[Z]==="true")?true:false});C.addEventListener("change",function(ab){});C.checkFlag=(O.options.grid[Z]==="true")?true:false;C.disabled=false;if(!G.mAccess.Modify){C.disabled=true}}if((aa==="ParameterUsage"||M==="FALSE")&&Z!=="sequenceOrder"&&Z!=="testMethods"){B.cellView.getContent().setContent(S);E.getContent().addClassName("cellUsageCharHighlight");X=true;if(Z==="minIncluded"||Z==="maxIncluded"){C.disabled=true;B.cellView.getContent().setHTML(C)}}else{if(Z==="testMethods"){if(H.options.value.length>0){var J=H.options.value.length-1;if(J>0){J="+"+J;E.getContent().setContent("<p title="+H.options.value[0]["name"]+",("+J+')><button id = "test-Methods" title= "Show Test Methods" value='+G.mObjectId+">...</button>"+H.options.value[0]["name"]+", ("+J+")</p>")}else{E.getContent().setContent("<p title="+H.options.value[0]["name"]+'><button id= "test-Methods" title="Show Test Methods">...</button>'+H.options.value[0]["name"]+"</p>")}B.view.setAttribute("tabindex","-1")}else{E.getContent().setContent('<p><button id= "test-Methods" title="">...</button></p>')}}else{if((V==="FALSE"&&Z==="overwriteAllowedOnChild")||(K===0&&Z==="nominal")){E.getContent().addClassName("cellRowGroupingHeader");var I=B.nodeModel.options.label[Z];E.getContent().setContent(I);H.options.value=S}else{if(P!==""&&((Z==="Title"&&W===false)||(Z==="description"&&D===false))){E.getContent().addClassName("cellRowGroupingHeader");E.getContent().setContent(S);B.view.setAttribute("tabindex","-1")}else{if(Z==="minIncluded"||Z==="maxIncluded"){if(U==="BooleanParameter"||U==="StringParameter"){C.disabled=true}B.cellView.getContent().setHTML(C);B.view.setAttribute("tabindex","-1")}else{E.getContent().removeClassName("cellRowGroupingHeader");var I=B.nodeModel.options.label[Z];B.cellView.getContent().setContent(I);B.view.setAttribute("tabindex","0");B.cellModel.options.value=S}if(B.view.addEventListener){B.view.addEventListener("keyup",G.keyHandler,true)}else{if(B.view.attachEvent){B.view.attachEvent("onkeyup",G.keyHandler)}}}}}}}else{B.cellView.getContent().setContent(S);E.getContent().addClassName("cellRowGroupingHeader");B.view.setAttribute("tabindex","-1")}if(!X){E.getContent().removeClassName("cellUsageCharHighlight")}}}}},getNLSValue:function(E,C){var B=["missedTargetAction","overwriteAllowedOnChild","displayUnit","dimension"];var D;if(B.indexOf(C)!==-1){D=E.replace(/\s/g,"");if(i[D]){return i[D]}}return E},keyHandler:function(C){var B=this;if(C.keyCode===9){if(C.shiftKey){B=B.previousSibling}if(B.dataset.index!=="minIncluded"&&B.dataset.index!=="maxIncluded"){B.click()}else{B.children[0].focus()}}},recursiveExpand:function(B){var C=this;if(B.hasChildren()){B.getChildren().forEach(function(D){if(D.options.grid.ownerModel instanceof a){if(D.hasChildren()){D.getChildren().forEach(function(E){if(!D.isExpanded()){E.reverseExpand()}})}}else{C.recursiveExpand(D)}})}},onCharacteristicsLoadFinished:function(){var E=this;this.mRootItem.mTreeDocument.getRoots().forEach(function(H){E.recursiveExpand(H)});var D=null;if(this.mViewCharacteristics!==null){D=this.mViewCharacteristics.getManager();D.sortColumnContent=function(M,I){var L=this;this.prepareUpdateView();if(typeof M!=="string"){M=this.getDataIndexFromColumnID(M)}var K=this.getColumnIDFromDataIndex(M);var N=this.getColumnOptions(K);I=j.extend({sortOrder:"asc",sortFunction:N.sortFunction||function(P,O){if(M==="tree"){return P.options.label<O.options.label?-1:1}else{if(N.dataType==="number"){return P.options.grid[M]-O.options.grid[M]>0?1:-1}else{return P.options.grid[M]<O.options.grid[M]?-1:1}}}},I);this._setColumnState(K,"sort:"+I.sortOrder);for(var J=0;J<this.getRow(-1).length;J++){if(J!==K){var H=L.getRow(-1)[J];if(H._view){H._view.getContent().removeClassName("wux-ui-sort-desc");H._view.getContent().removeClassName("wux-ui-sort-asc")}H.removeClass("wux-ui-sort-desc");H.removeClass("wux-ui-sort-asc")}}this.getCell(-1,K).removeClass("wux-ui-sort-desc");this.getCell(-1,K).removeClass("wux-ui-sort-asc");this.getCell(-1,K).addClass("wux-ui-sort-"+I.sortOrder);this.getDocument()._getTrueRoot().sortChildren({isRecursive:true,sortFunction:function(Q,P){var O=I.sortOrder==="asc"?1:-1;return O*I.sortFunction(Q,P)}});this._reflectView();this.pushUpdateView(true);this._modelEvents.publish({event:"sort",data:{columnID:K,columnDataIndex:M,sortOrder:I.sortOrder}})};D=this.mViewCharacteristics.getManager();if(D!==null){D.loadDocument(E.mRootItem.mTreeDocument);D._modelEvents.subscribe({event:"cell:read-only"},E.onCellReadOnly.bind(E));D._modelEvents.subscribe({event:"cell:write"},E.onCellWrite.bind(E));if(E.mWidgetPrefData.length>0){m.sortViewColumns(E.mWidgetPrefData,D,E.mIsConsolidatedView)}else{var G;var F=E.mViewCharacteristics.options.columns;for(var C=2;C<F.length;C++){G=F[C];if(G.isVisible===false||G.isVisible===false.toString()){D.hideColumn(G.dataIndex)}else{D.showColumn(G.dataIndex)}}}if(!E.mIsConsolidatedView){D.hideColumn("tree")}}}var B=this.elements.containerview;A.unmask(B);this.mRootItem.dispatchEvent("DS.GLS.syncModel");return},onCellReadOnly:function(B){if(B.dataIndex==="selection"||B.dataIndex==="tree"){return}var K=B.cellModel;var D=B.cellView;var P=B.nodeModel;var T=B.dataIndex;var D=B.cellView;var O=K.options.prevValue;var M=K.options.value;var H="";if(O!==M&&typeof O!=="undefined"){if((T==="description"||T==="notes")){H=c.BAD_CHARS_FOR_DESC.replace(/\s/g,"")}else{if(T==="Title"){H=c.BAD_CHARS.replace(/\s/g,"")}}if(!r.checkForBadCharacter(M,H)){K.options.prevValue=K.options.value;this.resetDirtyCellChanges(B,O);return false}}if(T==="minIncluded"||T==="maxIncluded"){var Q=new g({checkFlag:P.options.grid[T]});M=Q.checkFlag;B.value=M;if(T==="minIncluded"){P.options.grid.minIncluded=(M===true)?"true":"false"}else{if(T==="maxIncluded"){P.options.grid.maxIncluded=(M===true)?"true":"false"}}O=!M}if(O!==undefined&&O!==M&&this.validateRequiredCell(B,O,M)===true){var R=-1;this.mArrDirtyCellList.forEach(function(W,V,U){if(B.virtualRowID===W.virtualRowID&&B.virtualColumnID===W.virtualColumnID){R=V}});if(R===-1){K.setCellStyle({color:"red",backgroundColor:"#FFC8B3"});this.mArrDirtyCellList.push(B);if(T==="displayUnit"){var J=["nominal","minimal","maximal"];var G=this;var S=[];S[T]=B.cellModel.options.prevValue;J.forEach(function(V){var U=B.manager.getColumnIDFromDataIndex(V);var W=B.manager.getCellModel(B.rowID,U);S[V]=W.options.oldValue;W.options.isReset=false});B.cellModel.options.isReset=false;G.mArrOldValues.push(S)}else{this.mArrOldValues.push(O);K.options.isReset=false}var F=K._manager.getCell(B.virtualRowID,B.virtualColumnID).getView();F.updateView();this.enableEditCommands()}}else{var C=B.virtualColumnID;var N=K.options.manager;var E=N.options.columns;var L=E[C];if(L){var I=E[C].required;if(I==="true"&&O===M){h("[wux-uuid="+D._uxid+"]").css("background-color","")}}}},resetDirtyCellChanges:function(D,B){var E={color:"black",backgroundColor:""};D.nodeModel.setAttributeWithLabel(D.dataIndex,B);D.cellModel.setCellStyle(E);D.manager.updateView();var C=-1;this.mArrDirtyCellList.forEach(function(H,G,F){if(D.virtualRowID===H.virtualRowID&&D.virtualColumnID===H.virtualColumnID){C=G}});if(C!==-1){this.mArrDirtyCellList.splice(C,1)}if(this.mArrDirtyCellList.length<=0){this.disableEditCommands()}},onCellWrite:function(I){var E=this;var H=false;var D=null;var B=I.cellModel;B.options.prevValue=B.options.value;var C=B.options.manager;if(j.is(C)){if(!!E.mPrevCellnodeModel&&E.mPrevCellnodeModel===I.cellModel._getID()){}else{E.mPrevCellnodeModel=I.cellModel._getID()}D=C.options.columns}var G=I.virtualColumnID;if(D!==null){H=D[G].required}var F=I.cellView;if(H==="true"){h("[wux-uuid="+F._uxid+"]").css("background-color","#F69797")}},commitCellChanges:function(){var M=this.mArrDirtyCellList;var K=M.length;var J=new Array(K);var E=this;var O;for(var I=0;I<K;I++){var B=M[I].nodeModel.options.grid.id;var P=M[I].dataIndex;var D=M[I].nodeModel.options.grid[P];O=M[I].nodeModel.options.grid.itemId;var Q=[];if(P==="displayUnit"&&!E.isInstantiatedIn3DD){var F=M[I].nodeModel.options.grid.nominal;Q.push({id:B,attribute:"nominal",value:F});var L=M[I].nodeModel.options.grid.minimal;Q.push({id:B,attribute:"minimal",value:L});var G=M[I].nodeModel.options.grid.maximal;Q.push({id:B,attribute:"maximal",value:G})}J[I]={id:B,attribute:P,value:D};if(Q.length>0){Q.forEach(function(R){J.push(R)})}}var C={objectId:O,cellData:J};var N=JSON.stringify(C);var H=null;b.send3DSpaceRequest(this.urlRoot+c.CHARACTERISTICS_UPDATE,"POST",{type:"text",headers:{"Content-type":"application/json; charset=UTF-8"},data:N},function(V){var U=M[0].manager;var T=U.options.columns;var S=M[0].dataIndex;var W=T.filter(function(ac){return S===ac.dataIndex});var R=W[0].text;var Z=i[R];var aa=null;Z=!Z?M[0].dataIndex:Z;if(K>0){var ab={color:"black",backgroundColor:""};var X=JSON.parse(V);var Y={};X.forEach(function(ae,ad,af){var ac=ae.id;Y[ac]=ae});M.forEach(function(ag,ad,ai){var af=ag.dataIndex;var ac=ag.nodeModel.options.grid.id;if(ac!==undefined&&Y[ac]!==undefined){var ah=Y[ac];for(var ae in ah){if(ah.hasOwnProperty(ae)&&ae!=="charCategory"){ag.nodeModel.setAttributeWithLabel(ae,ah[ae])}}Y[ac]=undefined}ag.cellModel.setCellStyle(ab);if(ag.dataIndex==="displayUnit"){ag.manager.getCellModel(ag.rowID,ag.manager.getColumnIDFromDataIndex("nominal")).setCellStyle(ab);ag.manager.getCellModel(ag.rowID,ag.manager.getColumnIDFromDataIndex("minimal")).setCellStyle(ab);ag.manager.getCellModel(ag.rowID,ag.manager.getColumnIDFromDataIndex("maximal")).setCellStyle(ab)}});U.updateView();aa=M[0].nodeModel.options.grid[S];E.mArrDirtyCellList=[];E.mArrOldValues=[];E.disableEditCommands()}H=true;if(E.isInstantiatedIn3DD===true){v.displayAlert(E.mAlert,i.CommitCellChangesSuccessAlert+" : "+Z+" = "+aa,0)}else{v.displayAlert(E.mAlert,i.CommitCellChangesSuccessAlert,0)}},function(S,R){var T=JSON.parse(R);v.displayAlert(E.mAlert,T.message,2);if(E.isInstantiatedIn3DD===true){E.resetCellChanges()}H=false});return H},resetCellChanges:function(){var G=this.mArrDirtyCellList;var K=this.mArrOldValues;var F=G.length;var L={color:"black",backgroundColor:""};for(var E=0;E<F;E++){var H=G[E].dataIndex;if(H==="minIncluded"||H==="maxIncluded"){var I=G[E].cellView.reuseCellContent("_toggle");if(I){I.checkFlag=K[E];if(H==="minIncluded"){G[E].nodeModel.options.grid.minIncluded=(K[E]===true)?"true":"false"}if(H==="maxIncluded"){G[E].nodeModel.options.grid.maxIncluded=(K[E]===true)?"true":"false"}}}else{if(H==="displayUnit"){for(var J in K[E]){if(K[E].hasOwnProperty(J)){var D=G[E].rowID;var B=G[E].manager.getColumnIDFromDataIndex(J);var C=G[E].manager.getCellModel(D,B);if(!C.options.isReset){G[E].nodeModel.setAttributeWithLabel(J,K[E][J]);C.setCellStyle(L);C.options.isReset=true}}}G[E].nodeModel.setAttributeWithLabel("multipleValues",G[E].nodeModel.options.grid.multipleValuesOld)}else{if(!G[E].cellModel.options.isReset){G[E].nodeModel.setAttributeWithLabel(H,K[E])}}G[E].cellModel.options.isReset=true}G[E].cellModel.setCellStyle(L)}if(F>0){G[0].manager.updateView();if(this.isInstantiatedIn3DD===true){v.displayAlert(this.mAlert,i.SingleUpdateRevert,1)}else{v.displayAlert(this.mAlert,i.ResetCellChangesAlert,0)}}this.mArrDirtyCellList=[];this.mArrOldValues=[];this.disableEditCommands()},validateRequiredCell:function(L,B,D){var I=L.cellModel;var K=L.cellView;var J=L.dataIndex;var C=L.virtualColumnID;var G=I.options.manager;var F=G.options.columns;var M={color:"black",backgroundColor:""};var H=F[C].required;if(H==="true"){if(!D||""===D.trim()){L.nodeModel.setAttributeWithLabel(J,B);I.options.value=B;I.setCellStyle(M);var E=I._manager.getCell(L.virtualRowID,L.virtualColumnID).getView();E.updateView();v.displayAlert(this.mAlert,i.ValidateRequiredCellWarning,1);return false}}return true},enableEditCommands:function(){var C=this;if(this.isInstantiatedIn3DD===true){this.commitCellChanges()}else{var D=h(this.elements.CharacteristicsToolbarControl.elements.container).find("#saveEdit");var B=h(this.elements.CharacteristicsToolbarControl.elements.container).find("#cancelEdit");D.prop("disabled",false).removeClass("disabled");B.prop("disabled",false).removeClass("disabled")}},disableEditCommands:function(){var C=this;if(this.isInstantiatedIn3DD===false){var D=h(this.elements.CharacteristicsToolbarControl.elements.container).find("#saveEdit");var B=h(this.elements.CharacteristicsToolbarControl.elements.container).find("#cancelEdit");D.addClass("disabled").prop("disabled",true);B.addClass("disabled").prop("disabled",true)}},destroy:function(){this.stopListening();this._parent()},updateSequenceOrder:function(H){var B=this;var I=[];var E=[];var J=[];var D=B.mViewCharacteristics.getManager();var C=H.rootNode;if(H.reOrderAcrossCategory){C.getChildren().forEach(function(K){if(K.options.grid.modelType===c.CHARACTERISTICS_CATEGORY_MODEL_TYPE){K.options.grid.ownerModel.updateCategory()}})}B.mRootItem.mTreeDocument.getRoots().forEach(function(K){B.recursiveExpand(K)});if(!C.hasChildren()){return}C.getChildren().forEach(function(K){if(K.options.grid.modelType===c.CHARACTERISTICS_CATEGORY_MODEL_TYPE){if(K.hasChildren()){K.getChildren().forEach(function(L){E.push(L);I.push(L.options.grid)})}}});if(H.reOrderAcrossCategory&&j.is(H.droppedNodes)){H.droppedNodes.forEach(function(K){if(K.grid.categoryName!==H.targetCategoryNode.options.grid.ownerModel.mCharCategory){J.push(K.grid.id)}})}if(I.length===0){return}this.hideRootNodeflatView();var F={allCharsArray:I,reOrderAcrossCategory:H.reOrderAcrossCategory};if(H.reOrderAcrossCategory){F.updateCategoryOnChars=J;F.targetCategory=H.targetCategoryNode.options.grid.ownerModel.mCharCategory}var G=JSON.stringify(F);b.send3DSpaceRequest("resources/v1/characteristicmodeller/characteristics/updateCharacteristicSequence","POST",{type:"text",headers:{"Content-type":"application/json; charset=UTF-8"},data:G},function(L){var M=JSON.parse(L)[0];E.forEach(function(N){if(M.hasOwnProperty(N.options.grid.id)){N.setAttributeWithLabel("sequenceOrder",M[N.options.grid.id])}});if(H.reOrderAcrossCategory){C.getChildren().forEach(function(N){if(N.options.grid.modelType===c.CHARACTERISTICS_CATEGORY_MODEL_TYPE){N.options.grid.ownerModel.updateCategory()}})}var K=B.hideRootNodeflatView();if(!K){D.updateView()}},function(L,K){var M=JSON.parse(K);v.displayAlert(B.mAlert,i.OperationFailed+": "+M.message,2);v.displayAlert(B.mAlert,i.RefreshingCharView,2);B.refreshCharacteristicView(B.mRootItem,false)})},hideRootNodeflatView:function(){if(!this.mIsConsolidatedView){var B=j.is(this.mViewCharacteristics)?this.mViewCharacteristics.getManager():null;if(B){B.hideRow(0);B.updateView();return true}else{return false}}else{return false}}});return z});