define("DS/ENOCharacteristicsWebApp/controls/TextFilterBox",["UWA/Core","DS/UIKIT/Input/Text","DS/ENOFrameworkPlugins/jQuery","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS"],function(h,a,c,f){function b(i){var j=this;if(i.hasChildren()){i.getChildren().forEach(function(m){if(m.options.grid.ownerModel.hasOwnProperty("mCharCategory")){var l=m.getChildren().length;var k=m.options.grid.charCategory;var n=k.indexOf("(");m.options.grid.charCategory=k.substring(0,n)+"("+l+")";if(m.isHidden()===true){m.show()}m.showChildNodes()}else{b(m)}})}}function g(i,j){i.getChildren().forEach(function(l){if(l.options.grid.ownerModel.hasOwnProperty("mCharCategory")){var n=0;l.getChildren().forEach(function(o){if(c.inArray(o.options.grid.id,j)==-1){if(o.isHidden()===false){o.unmatchSearch();o.hide()}}else{if(o.isHidden()===true){o.show();o.matchSearch()}n=n+1}});if(n==0){if(l.isHidden()===false){l.hide()}}else{var k=l.options.grid.charCategory;var m=k.indexOf("(");l.options.grid.charCategory=k.substring(0,m)+"("+n+")";if(l.isHidden()===true){l.show()}}}else{g(l,j)}})}var e=a.extend({mControlContext:null,mCharWindow:null,mSearchTimer:null,mSearchPrevText:null,mWindowTitle:null,mFilterText:null,init:function d(i){this.mControlContext=i.CharacteristicsControl;this.mCharWindow=i.CharacteristicsWindow;this.mWindowTitle=this.mCharWindow?this.mCharWindow.title:null;var j=this;this._parent({name:"TextFilterBox",defaultOptions:{className:"eno-gls-TextFilterBox",},styles:{margin:"0px 0px 0px 0px",padding:"0px"},placeholder:f.Filter,id:j.mControlContext.mIsConsolidatedView?"searchConsText":"searchText",events:{onKeyDown:function(k){var l=j.mControlContext.mRootItem.mTreeDocument;clearTimeout(j.mSearchTimer);j.mSearchTimer=setTimeout(function(n){var m=j.mControlContext.mIsConsolidatedView?c("#searchConsText").val():c("#searchText").val();if(m===j.mSearchPrevText){j.mControlContext.hideRootNodeflatView();return}else{j.mSearchPrevText=m}l.withTransactionUpdate(function(){if(m.length<3){var p=j.mFilterText;if(p!=="All"){j.mFilterText="All";var o=l.getRoots();o.forEach(function(v){b(v)});j.mControlContext.hideRootNodeflatView();if(!j.mControlContext.isInstantiatedIn3DD){c("#filterText").html(j.mFilterText)}else{j.mCharWindow.title=j.mWindowTitle+" | "+f.Filter+": "+j.mFilterText}}}else{j.mFilterText=m;if(!j.mControlContext.isInstantiatedIn3DD){c("#filterText").html(m)}else{j.mCharWindow.title=j.mWindowTitle+" | "+f.Filter+": "+j.mFilterText}var s=j.mControlContext.mViewCharacteristics.getManager();var r=s.getColumns();var t=[];r.forEach(function(v){t.splice(0,0,v.dataIndex)});var q=l.search({match:function(y){var x=y.nodeModel.options.label;var v=[];var w=m.toLowerCase();for(var A in x){if(Object.prototype.hasOwnProperty.call(x,A)&&(t.indexOf(A)!=-1)){var z=s.getColumnOptions(A);if(z.isVisible!=false){v.push(x[A])}}}return v.some(function(C){var B=(typeof C!="undefined"&&typeof(C.toLowerCase)==="function"&&C.length>=m.length&&C.toLowerCase().indexOf(w)!=-1);return B})}});var u=[];q.forEach(function(v){u.push(v.options.grid.id)});l.getRoots().forEach(function(v){g(v,u)})}});j.mControlContext.hideRootNodeflatView()},50)}}});return this},setFilter:function(i){if(this.mControlContext.mIsConsolidatedView){c("#searchConsText").val(i)}else{c("#searchText").val(i)}var j=this;var k=j.mControlContext.mRootItem.mTreeDocument;k.withTransactionUpdate(function(){var l=k.getRoots();l.forEach(function(m){b(m)})});j.mControlContext.hideRootNodeflatView();j.mFilterText=f.All;j.mCharWindow.title=j.mWindowTitle+" | "+f.Filter+": "+j.mFilterText}});return e});