define("DS/SMAProcWebContents/WebContentService",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebContents/PolyUtils","DS/SMAProcWebContents/ContentUtils","DS/SMAProcWebContents/AbstractContentService","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","UWA/Promise"],function(e,f,d,b,a){var c=UWA.Promise;return b.extend({init:function(g){this._parent(g);this._cache={};f.resolveComponent("sp-file-content","SMAProcSP/sp-file-content/sp-file-content.html","getContentInfo",function(h){this.spFileContent=h}.bind(this));f.resolveComponent("sp-search","SMAProcSP/sp-search/sp-search.html","search",function(h){this.spSearch=h;this.searchHandler=this.onSearchCallback.bind(this);this.spSearch.addEventListener("change",this.searchHandler)}.bind(this))},getSpFileContent:function(){if(this.spFileContent){return c.resolve(this.spFileContent)}var g=this;return new c(function(h){f.waitTillReady(g,"spFileContent",function(){h(g.spFileContent)})})},getSpSearch:function(){if(this.spSearch){return c.resolve(this.spSearch)}var g=this;return new c(function(h){f.waitTillReady(g,"spSearch",function(){h(g.spSearch)})})},getParameterFiles:function(j){var i=this;var h=j.getValue();if(!h){return c.resolve([])}var g=h._data.objectId;if(i._cache[g]){return c.resolve(i._cache[g])}return i.getSpFileContent().then(function(k){return k.getContentInfo(h._data.objectId)}).then(function(l){var k=JSON.parse(l);k=k.map(function(m){return{getName:function(){return m.basics.name},fileDetails:m}});i._cache[g]=k;return k})},addRefContent:function(h,g,i){i=i||this.activity;return new c(function(k,j){a.addReferencedContent(i,h,g,{onSuccess:function(l){k(l)},onError:function(l){j(l)}})})},search:function(g,h){var i=this;this.getSpSearch().then(function(j){i.searchElement=h;j.plmTypes=g;j.search()})},onSearchCallback:function(k){try{var j=this;k&&k.stopPropagation();var h=j.spSearch.getSelectedObjectIds();var g=h[0];this.handleReferencedContent(g)}catch(i){console.log(i)}},handleReferencedContent:function(g){var i=this;var h=d.getDefaultCategory(this.activity);this.addRefContent(h,g).then(function(k){var j=Object.assign({},{plmobject:k,target:i.searchElement});i.publish("content-added",j)},function(j){console.error(j)})},uploadFiles:function(h,j,g,k,l){l=l||this.activity;var i=this;return new c(function(t,u){var n=j[0];var m=n.name.indexOf(".")>-1?n.name.split(".")[0]:n.name;var r=null;var q=0;var o=false;if(d.isActivityOrDataContainer(l)){r=l}else{r=l.getParent()}for(q=0;q<j.length;q++){var p=j[q].name;var s=d.checkFileTypeSupport(g,p);if(!s){o=false;u('File "'+p+'" is not supported. Document create aborting.');break}else{o=true}}if(o){i.createDocument(r,h,k,m).then(function(w){var v=[];for(q=0;q<j.length;q++){v.push(i.uploadFileToDocument(w,j[q],j[q].name))}return c.all(v)}).then(function(v){var x=v[0].doc;var w=v.filter(function(y){return y.status});t({plmobject:x,files:w})},function(v){u(v)})}})},createDocument:function(g,h,j,i){return new c(function(l,k){a.createOwnedDocument(g,h,j,i,{onSuccess:function(m){l(m)},onError:function(m){k(m)}})})},uploadFileToDocument:function(h,g,i){return new c(function(j){a.uploadFileToDocument(h,g,i,{onSuccess:function(){console.log('uploadFile service added file "'+i+'" successfully');j({status:true,doc:h,file:i})},onError:function(k){console.log("uploadFile service failed to upload "+i,k);j({status:false,doc:h,file:i})}})})}})});