define("DS/SMAProcWebContents/ContentDropdown",["DS/SMAProcWebCommonControls/Polymer","DS/SMAProcWebCommonControls/utils","DS/SMAProcWebContents/CommonBehavior","DS/SMAProcWebContents/TreeDropDown","DS/Tree/TreeNodeModel","DS/SMAProcWebCMMUtils/SMAWINAuthoringUtils","DS/DataDragAndDrop/DataDragAndDrop","DS/SMAProcWebContents/ContentUtils"],function(b,i,f,j,d,h,g,e){var k='<dom-module id="pcw-sdk-content-dropdown"><template>  <style>    :host {    display: inline-block;    width: 100%;    }    :host[disabled] { pointer-events:none;opacity:0.5;}    </style>  </template></dom-module>';i.registerDomModule(k);function c(l,n){var o=l.getObjectType();var m=e.checkTypeCompatibility(o,n);return new d({label:l.getName(),data:{object:l,selectable:m},icons:[l.getFieldValue("image","imageValue")||""]})}function a(l,n){function m(r){r=r||[];var o=[];for(var p=0;p<r.length;++p){var q=c(r[p],n);if(r[p].isContentContainer&&r[p].isContentContainer()){var s=m(r[p].getContentChildren());s.forEach(function(t){q.addChild(t)})}o.push(q)}return o}return m(l.getContentChildren(),n)}b({is:"pcw-sdk-content-dropdown",properties:{plmTypes:{type:String},subTypes:{type:String,computed:"_expandTypes(plmTypes)",reflectToAttribute:true},},behaviors:[f],created:function(){this.treeDropDown=new j()},ready:function(){b.dom(this.root).appendChild(this.treeDropDown.getContent());if(this.disabled){this.treeDropDown.getContent().classList.add("disabled")}else{if(!h.isWebInWin()){this.addDropSupport(this.treeDropDown.getContent())}}},addDropSupport:function(l){var n=this;var m=l.getStyle("border");l.addEventListener("dragover",function(o){this.setStyles({"border-style":"dotted"})});l.addEventListener("dragleave",function(o){this.setStyles({border:m})});g.droppable(l,{drop:function(t,q,p){n._stopEvent(p);l.setStyles({border:m});var s=null;var r;var y;try{s=JSON.parse(t||"")}catch(u){s=null;r=u;try{t=p.dataTransfer.getData("text/searchitems")||"";s=JSON.parse(t)}catch(v){if(p.dataTransfer.files.length){n.fire("dnd-file",{type:"content",files:p.dataTransfer.files});return}s=null;r=v}}if(s!==undefined&&s!==null&&"data" in s&&"items" in s.data){var x=s.data.items[0];var o=x.objectType;if(e.checkTypeCompatibility(o)){var w=x.objectId;n.fire("dnd-file",{type:"reference",objectId:w})}}else{console.error("Failed to parse data",r,t)}}})},_expandTypes:function(l){return e.expandTypes(l)},setContentService:function(l){var m=this;m.service=l;m.service.subscribe("content-added",function(o){var p=o.plmobject;var n=o.target===m;m.updateModel(p,n)})},setModel:function(l,o){var n=this;this.container=l;var m=a(l,this.subTypes);this.treeDropDown.setRootItems(m);this.setSelectedItem(o);if(!this.eventAdded){this.eventAdded=true;this.treeDropDown.addEvent("change",function(p){if(n.selectedItem===p.data){return}n.selectedItem=p.data;n.fire("content-change",{value:n.selectedItem})})}},updateModel:function(o,m){var p=this.treeDropDown.getTreeDoc();var n=o.getParent();var l=p.search({match:function(q){return q.nodeModel.options.data.object===n}});if(l.length>0){l[0].addChild(c(o,this.subTypes));if(m){this.setSelectedItem(o,true)}}},getDataContainer:function(){return this.container},getSelectedItem:function(){return this.getSafe("data",this.treeDropDown.getSelectedItem())},setSelectedItem:function(m,l){if(m&&this.selectedItem!==m){this.selectedItem=m;this.treeDropDown.setSelectedItem({label:m.getName(),data:m,icon:m.getFieldValue("image","imageValue")});if(l){this.fire("content-change",{value:m})}}}})});