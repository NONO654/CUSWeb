/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Connector",["UWA/Class","DS/SMAMSExperimentServices/Connector","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/SMAMSWeb/SMAMSGenerateConfigFile"],function(e,d,c,a){var b=e.extend({init:function(f){this.parent=f.parent;this.name=f.name;this.type=f.type;this.position=f.position;this.causality=f.causality;this.valueref=f.valueRef;this.mangledName=f.mangledName;this.phID=f.phID;this.typeID=f.typeID;this._cbOK=[];this._cbKO=[];this.description="";if(f.description){this.description=f.description}},getParent:function(){return this.parent},getInfo:function(){var f={};f.name=this.name;f.description=this.description;return f},setInfo:function(k){var f=this;var h=f.parent.model;var j=h.getEditor();var l=f.getInfo();if(l===k){return}delete f.parent.connectors[l.name];f.parent.connectors[k.name]=f;f.name=k.name;f.description=k.description;var g="In";if(f.causality==="O"){g="Out"}else{if(f.causality==="N"){g="InOut"}}if(j){j.setConnectorName(f.parent,l.name,k.name)}var i={};i.physicalId=f.getID();i.title=f.name;i.description=f.description;i.direction=g;i.onComplete=function(){h.addMessage("The port has been updated.","info","log");var m=h.getExperiment();if(m){var n=new a("config",h);var o=n.execute();m.setConfig(o)}};i.onFailure=function(o,n,q){if(j){j.setConnectorName(f.parent,k.name,l.name)}delete f.parent.connectors[k.name];f.parent.connectors[l.name]=f;f.name=l.name;f.description=l.description;var p=[o,n,q];var m=c.get("port_update");if(m==="port_update"){m="The port could not be updated."}h.addMessage(m,"error","notification",p)};d.update(i)},getType:function(){return this.type},getCausality:function(){return this.causality},getValueRef:function(){return this.valueref},getMangledName:function(){return this.mangledName},getID:function(g,f){if(!this.phID){if(g){this._cbOK.push(g)}if(f){this._cbKO.push(f)}}else{if(g){g(this.phID)}else{return this.phID}}},setID:function(g){this.phID=g;for(var f=0;f<this._cbOK.length;f++){this._cbOK[f].call(this,g)}this._cbOK=[];this._cbKO=[]},cancelID:function(){for(var f=0;f<this._cbKO.length;f++){this._cbKO[f].call()}this._cbOK=[];this._cbKO=[]}});return b});define("DS/RFLModelerWeb/RFL_EditorPanel",["UWA/Core","DS/Windows/Dialog","DS/Controls/Button"],function(d,c,b){var a=d.Class.extend({init:function(e){this._panel=null;this.editor=e.editor;this.title=e.title;this.content=e.content;if(!e.minWidth){this.minWidth=250}else{this.minWidth=e.minWidth}if(!e.minHeight){this.minHeight=125}else{this.minHeight=e.minHeight}this.width=e.width?e.width:this.minWidth;this.height=e.height;this.onOK=e.onOK;this.onCancel=e.onCancel;this.onReturn=e.onReturn;this.onMaximize=e.onMaximize;this.onMinimize=e.onMinimize;this.onReturnTooltip=e.onReturnTooltip;this.absolutePosition=e.absolutePosition;this.dontMaximize=e.dontMaximize;this.isResizable=true;if(typeof e.isResizable!=="undefined"){this.isResizable=e.isResizable}if(e.hideFooter){this.hideFooter=e.hideFooter}else{this.hideFooter=false}this.position={my:"top right",at:"top right"};if(typeof e.position!=="undefined"){this.position=e.position}this.modalFlag=false;if(typeof e.modalFlag!=="undefined"){this.modalFlag=e.modalFlag}this._initPanel()},_initPanel:function(){var e=this;if(e.hideFooter){e._panel=new c({title:e.title,content:e.content,closeButtonFlag:true,minWidth:e.minWidth,minHeight:e.minHeight,width:e.width,height:e.height,resizableFlag:e.isResizable,position:e.position})}else{e._panel=new c({title:e.title,content:e.content,closeButtonFlag:true,minWidth:e.minWidth,minHeight:e.minHeight,width:e.width,height:e.height,resizableFlag:e.isResizable,position:e.position,allowedDockAreas:WUXDockAreaEnum.NoneDockArea,ensureHeightDefinition:true,modalFlag:e.modalFlag,buttons:{Cancel:new b({allowUnsafeHTMLLabel:false,onClick:function(f){e.onCancel()}}),Ok:new b({allowUnsafeHTMLLabel:false,onClick:function(f){e.onOK()}})}})}if(e.absolutePosition){e._panel.setAbsolutePosition(e.absolutePosition)}e._panel.addEventListener("close",function(f){e._panel.closeButtonClicked=true;e.onCancel()})},getPanel:function(){return this._panel}});return a});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Link",["UWA/Core","UWA/Class"],function(b){var a=b.Class.extend({init:function(c){this.name=c.name;this.comp1=c.comp1;this.comp2=c.comp2;this.con1=c.con1;this.con2=c.con2;this.phID=c.phID;this.view=c.view;this._cbOK=[];this._cbKO=[];this.description=""},getInfo:function(){var c={};c.name=this.name;c.description=this.description;return c},getID:function(d,c){if(!this.phID){if(d){this._cbOK.push(d)}if(c){this._cbKO.push(c)}}else{if(d){d(this.phID)}else{return this.phID}}},setID:function(d){this.phID=d;for(var c=0;c<this._cbOK.length;c++){this._cbOK[c].call(this,d)}this._cbKO=[];this._cbOK=[]},cancelID:function(){for(var c=0;c<this._cbKO.length;c++){this._cbKO[c].call()}this._cbOK=[];this._cbKO=[]},getView:function(){return this.view},setView:function(c){this.view=c},setPosition:function(e){var f=this;var c=f.comp1.parent.getModel();var d=c.getRoot().getLayout();if(d&&d.file){d.manageLinks(f,false,e)}}});return a});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Base",[],function(){var a={ComponentShape:{shape:"rectangle",w:110,h:86},Causality:{input:"I",output:"O",neutral:"N"}};return a});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_ThemeBase",["UWA/Core","DS/egraph/core","DS/egraph/views","DS/egraph/iact","DS/egraph/utils","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Input/Text","DS/Core/Core","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(d,C,b,v,ag,D,w,m,q){var G={IN:0,OUT:1,INOUT:2,NODIRECTION:3};var Y={};var L=function(ah){Y=ah};var P={DIRECTION:G,GRAPH:Y,setGraph:L,rootState:p,newNode:o,init_interactions:n,init_handles:Z,newConnector:z,newEdge:ab,onNewEdge:R,onSelect:l,onUnselect:Q};var j=false;function K(ah,ai){var aj=ah.getAttribute("class");if(aj&&aj.indexOf(ai)!==-1){return}if(aj){aj+=" "+ai}else{aj=ai}ah.setAttribute("class",aj)}function F(ak,al){var am=ak.getAttribute("class");am=am.split(" ");var ah=am.indexOf(al);if(ah>-1){am.splice(ah,1)}var aj="";for(var ai=0;ai<am.length;ai++){aj+=" "+am[ai]}ak.setAttribute("class",aj)}function X(){b.HTMLNodeView.call(this)}ag.inherit(X,b.HTMLNodeView);X.prototype.buildNodeElement=function(ai){var ah=null;var ak=ai.data.RFLComponent;ah=ak.buildNode("DS/RFLModelerWeb/RFL_ThemeBase");ah.data={};ah.data.RFLComponent=ak;var aj=document.createElement("div");aj.setAttribute("class","node-title");aj.textContent=ak.getInfo().name;aj.setAttribute("title",ak.getInfo().name);ah.appendChild(aj);return ah};function ac(ai,ah){this.overlay=null;this.grElt=ah;this.nextSibling=null;this.previousSibling=null;this.center_x=0;this.center_y=0;this.view=ai;this.view.grElt=ah;this.view.subElt=this}ac.prototype.width=15;ac.prototype.height=15;ac.prototype.updatePosition=function T(){this.recenter();if(this.overlay){s(this.overlay.vpt,this)}};function s(al,ai){var ah,am,ak,aj;ah=ai.center_x*al[2]+al[0];am=ai.center_y*al[2]+al[1];ak=Math.round(ah-0.5*ai.width);aj=Math.round(am-0.5*ai.height);ai.view.style.left=ak+"px";ai.view.style.top=aj+"px"}function S(ah){this.firstHandle=null;this.lastHandle=null;this.view=document.createElement("div");this.view.style.display="inline-block";this.view.style.width="0";this.view.style.height="0";this.view.style.position="absolute";this.view.style.left="0";this.view.style.top="0";this.vpt=ah.animVpt.slice();ah.addListener("animviewpoint",U.bind(this));ah.domRoot.insertBefore(this.view,ah.overlayMarker)}function U(aj){var ah,ai;for(ah=0;ah<3;++ah){this.vpt[ah]=aj.vpt[ah]}for(ai=this.firstHandle;ai;ai=ai.nextSibling){s(this.vpt,ai)}}S.prototype.insertBefore=function i(ai,ah){if(ai.overlay&&ai.overlay!==this){throw new Error("handle is already in an overlay")}if(ah&&ah.overlay!==this){throw new Error("next_handle is not in this overlay")}ai.nextSibling=ah||null;ai.previousSibling=ah?ah.previousSibling:this.lastHandle;if(ai.nextSibling){ai.nextSibling.previousSibling=ai}else{this.lastHandle=ai}if(ai.previousSibling){ai.previousSibling.nextSibling=ai}else{this.firstHandle=ai}if(!ai.overlay){ai.overlay=this;ai.recenter()}this.view.insertBefore(ai.view,ah?ah.view:null);s(this.vpt,ai)};S.prototype.remove=function M(ah){if(ah.overlay!==this){throw new Error("handle is not in this overlay")}if(ah.nextSibling){ah.nextSibling.previousSibling=ah.previousSibling}else{this.lastHandle=ah.previousSibling}if(ah.previousSibling){ah.previousSibling.nextSibling=ah.nextSibling}else{this.firstHandle=ah.nextSibling}ah.overlay=null;ah.nextSibling=null;ah.previousSibling=null;this.view.removeChild(ah.view)};var E={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8};var h=document.createElement("div");h.classList.add("my-wonderful-resize");h.style.position="absolute";function ad(ai){var ah,aj;ah=h.cloneNode(true);aj="";if(ai&E.TOP){aj+="n"}else{if(ai&E.BOTTOM){aj+="s"}}if(ai&E.LEFT){aj+="w"}else{if(ai&E.RIGHT){aj+="e"}}ah.classList.add(aj+"-edge");return ah}function I(aj,ah,ai){ac.call(this,ad(ah),aj);this.edges=ah;this.nextResizeHandle=ai}ag.inherit(I,ac);I.prototype.width=29;I.prototype.height=29;I.prototype.newDrag=function y(){return new e(this.grElt,this.edges)};I.prototype.recenter=function a(){if(this.edges&E.LEFT){this.center_x=this.grElt.actualLeft+0.5}else{if(this.edges&E.RIGHT){this.center_x=this.grElt.actualLeft+this.grElt.actualWidth-0.5}else{this.center_x=this.grElt.actualLeft+0.5*this.grElt.actualWidth}}if(this.edges&E.TOP){this.center_y=this.grElt.actualTop+0.5}else{if(this.edges&E.BOTTOM){this.center_y=this.grElt.actualTop+this.grElt.actualHeight-0.5}else{this.center_y=this.grElt.actualTop+0.5*this.grElt.actualHeight}}};function g(ai,ah){this.id=String(ai);this.node=ah;this.handlesHead=null}g.prototype.toString=function r(){return this.id};g.prototype.updateHandles=function O(){var ah;for(ah=this.handlesHead;ah;ah=ah.nextResizeHandle){ah.updatePosition()}};g.prototype.showResizeHandles=function B(){function ai(ak,aj){ak.handlesHead=new I(ak.node,aj,ak.handlesHead);ah.insertBefore(ak.handlesHead,null)}var ah;if(this.handlesHead){return}ah=this.node.gr.data.handles_overlay;ai(this,E.RIGHT|E.BOTTOM)};g.prototype.hideResizeHandles=function ae(){var ah;while(ah=this.handlesHead,ah){this.handlesHead=ah.nextResizeHandle;ah.overlay.remove(ah)}};function V(ah){v.NodeDrag.call(this,ah)}ag.inherit(V,v.NodeDrag);function af(ah){ah.forEach(function ai(aj){aj.data.updateHandles()})}V.prototype.onmove=function x(){v.NodeDrag.prototype.onmove.apply(this,arguments);af(this.nodes)};V.prototype.onend=function t(ah){v.NodeDrag.prototype.onend.apply(this,arguments);if(ah){af(this.nodes)}};function e(ai,ah){v.SinglePtDrag.call(this);this.node=ai;this.edges=ah;this.start_left=ai.left;this.start_top=ai.top;this.start_width=ai.width;this.start_height=ai.height}ag.inherit(e,v.SinglePtDrag);e.prototype.onmove=function k(ak){var aj,al,ai;aj=this.node;ai=5;aj.gr.withLockedUpdate(function ah(){if(this.edges&E.LEFT){al=Math.min(ak.graphDelta[0],this.start_width-ai);aj.set("left",this.start_left+al);aj.set("width",this.start_width-al)}else{if(this.edges&E.RIGHT){al=Math.max(ak.graphDelta[0],ai-this.start_width);aj.set("left",this.start_left);aj.set("width",this.start_width+al)}}if(this.edges&E.TOP){al=Math.min(ak.graphDelta[1],this.start_height-ai);aj.set("top",this.start_top+al);aj.set("height",this.start_height-al)}else{if(this.edges&E.BOTTOM){al=Math.max(ak.graphDelta[1],ai-this.start_height);aj.set("top",this.start_top);aj.set("height",this.start_height+al)}}},this);this.node.data.updateHandles()};e.prototype.onend=function H(ah){var ai=this.node.data.RFLComponent;ai.setShape(this.node.actualWidth,this.node.actualHeight);if(ah){this.node.multiset("left",this.start_left,"top",this.start_top,"width",this.start_width,"height",this.start_height);this.node.data.updateHandles()}};function c(){b.SVGConnView.call(this)}ag.inherit(c,b.SVGConnView);c.prototype.buildConnElement=function(al){var ak="http://www.w3.org/2000/svg";var ai=document.createElementNS(ak,"g");var aj=document.createElementNS(ak,"polygon");var ah=document.createElementNS(ak,"text");if(al.data.type==="Real"||al.data.type==="Boolean"||al.data.type==="Integer"||al.data.type==="Enumeration"||al.data.type==="String"){if(al.data.direction===G.OUT){ai.setAttribute("class","my-connector my-connector-inactive my-connector-out");aj.setAttribute("points","0,-8  12,0  0,8");ah.setAttribute("x","15");ah.setAttribute("y","5");ah.setAttribute("fill","#3d3d3d");ah.setAttribute("style","visibility:hidden");ai.appendChild(aj);ai.appendChild(ah)}else{ai.setAttribute("class","my-connector my-connector-inactive my-connector-in");aj.setAttribute("points","12,-8  0,0  12,8");ah.setAttribute("x","15");ah.setAttribute("y","5");ah.setAttribute("fill","#3d3d3d");ah.setAttribute("style","visibility:hidden");ai.appendChild(aj);ai.appendChild(ah)}}else{if(al.data.type==="Region"){if(al.data.direction===G.INOUT){ai.setAttribute("class","my-connector my-connector-inactive my-connector-neutral");aj.setAttribute("points","0,-8 12,-8 12,8 0,8");ah.setAttribute("x","15");ah.setAttribute("y","5");ah.setAttribute("fill","#3d3d3d");ah.setAttribute("style","visibility:hidden");ai.appendChild(aj);ai.appendChild(ah)}}else{return}}ai.querySelector("text").textContent=al.data.name;aj.onmouseover=function(){if(j===false){K(al.views.main.display.elt,"my-connector-highlight");var an=ai.grElt.getParent();var am=an.getGraph();if(!al.children.first){for(var ar=am.nodes.first;ar;ar=ar.next){if(ar===an){continue}var at=ar.children.first;while(at){if(!at.data){at=at.next;continue}if(al.data.type&&al.data.type==="Region"){if(at.data.type===al.data.type){K(at.views.main.display.elt,"my-connector-highlight");var au=al.children.first;while(au){if(au.ref.cl1.c===at||au.ref.cl2.c===at){K(au.ref.views.main.display.elt,"highlight");K(at.views.main.display.elt,"my-connector-highlight")}au=au.nextEdge()}var ao=at.views.main.display.elt.querySelector("text");if(at.views.main.display.elt.grElt.attach===2){var aw=ao.getBBox().width/2+Number(ao.getAttribute("x"));ao.setAttribute("transform","rotate(180 "+aw+",0)")}if(at.children.first){ao.setAttribute("y","-2")}else{ao.setAttribute("y","5")}ao.style.visibility="visible"}}else{if(al.data.type&&al.data.type!=="Region"){if(at.data.type===al.data.type&&at.data.direction!==al.data.direction&&!at.children.first){K(at.views.main.display.elt,"my-connector-highlight");var aq=al.children.first;while(aq){if(aq.ref.cl1.c===at||aq.ref.cl2.c===at){K(aq.ref.views.main.display.elt,"highlight");K(at.views.main.display.elt,"my-connector-highlight")}aq=aq.nextEdge()}var az=at.views.main.display.elt.querySelector("text");if(at.views.main.display.elt.grElt.attach===2){var ax=az.getBBox().width/2+Number(az.getAttribute("x"));az.setAttribute("transform","rotate(180 "+ax+",0)")}if(at.children.first){az.setAttribute("y","-2")}else{az.setAttribute("y","5")}az.style.visibility="visible"}}}at=at.next}}}if(an.selected){return}for(var ap=an.children.first;ap;ap=ap.next){if(ap.children.first&&ap.children.first.ref.isSelected()===true){return}}var ay=ai.querySelector("text");if(ai.grElt.attach===2){var av=ay.getBBox().width/2+Number(ay.getAttribute("x"));ay.setAttribute("transform","rotate(180 "+av+",0)")}if(al.children.first){ay.setAttribute("y","-2")}else{ay.setAttribute("y","5")}ay.style.visibility="visible"}};aj.onmouseout=function(){F(al.views.main.display.elt,"my-connector-highlight");var an=ai.grElt.getParent();var am=an.getGraph();for(var ar=am.nodes.first;ar;ar=ar.next){if(ar===an){continue}var at=ar.children.first;while(at){if(!at.data){at=at.next;continue}if(al.data.type&&al.data.type==="Region"){if(at.data.type===al.data.type){F(at.views.main.display.elt,"my-connector-highlight");var au=al.children.first;while(au){if(au.ref.cl1.c===at||au.ref.cl2.c===at){F(au.ref.views.main.display.elt,"highlight");F(at.views.main.display.elt,"my-connector-highlight")}au=au.nextEdge()}if(!ar.selected){var ap=at.views.main.display.elt.querySelector("text");if(at.views.main.display.elt.grElt.attach===2){ap.removeAttribute("transform")}ap.style.visibility="hidden"}}}else{if(al.data.type&&al.data.type!=="Region"){if(at.data.type===al.data.type&&at.data.direction!==al.data.direction&&!at.children.first){F(at.views.main.display.elt,"my-connector-highlight");var aq=al.children.first;while(aq){if(aq.ref.cl1.c===at||aq.ref.cl2.c===at){F(aq.ref.views.main.display.elt,"highlight");F(at.views.main.display.elt,"my-connector-highlight")}aq=aq.nextEdge()}if(!ar.selected){var av=at.views.main.display.elt.querySelector("text");if(at.views.main.display.elt.grElt.attach===2){av.removeAttribute("transform")}av.style.visibility="hidden"}}}}at=at.next}}if(an.selected){return}for(var ao=an.children.first;ao;ao=ao.next){if(ao.children.first&&ao.children.first.ref.isSelected()===true){return}}var aw=ai.querySelector("text");if(ai.grElt.attach===2){aw.removeAttribute("transform")}aw.style.visibility="hidden"};return ai};function N(){b.SVGEdgeView.call(this)}ag.inherit(N,b.SVGEdgeView);N.prototype.onupdate=function(aT){var an=Y.edges;var ao=[];var aF=1;for(var al=an.first;al;al=al.next){if(aT!==al){for(var aQ=0;aQ<al.path.length;aQ++){if(al.path[aQ]!==0&&al.path[aQ]!==1){ao.push(al.path[aQ])}}}}var aU=aT.cl1.c.pos,aS=aT.cl2.c.pos,aA=[aU],aL=(aT.cl1.c.attach===C.BorderCstr.LEFT||aT.cl1.c.attach===C.BorderCstr.RIGHT)?0:1,aI=(aT.cl2.c.attach===C.BorderCstr.LEFT||aT.cl2.c.attach===C.BorderCstr.RIGHT)?0:1,aK=(aT.cl1.c.attach===C.BorderCstr.LEFT||aT.cl1.c.attach===C.BorderCstr.TOP)?-1:1,aH=(aT.cl2.c.attach===C.BorderCstr.LEFT||aT.cl2.c.attach===C.BorderCstr.TOP)?-1:1,av=(aL===0),aE=[C.PathCmd.M,aU[0],aU[1]];var ai=[aU[0]+(aS[0]-aU[0])/2,aU[1]+(aS[1]-aU[1])/2];if(aS[0]==aU[0]&&aS[1]==aU[1]){ai=null}var aV=Math.sqrt((aS[0]-aU[0])*(aS[0]-aU[0])+(aS[1]-aU[1])*(aS[1]-aU[1])),aq=aV<40?aV/2:20,ah=aT.cl1.c.attach!==aT.cl2.c.attach?aq:0,aG,aQ,aM=function(a1,aY,a0){aA.splice(aY,0,a1);if(!ai){return}if((aL===aI&&(aA.length%2)===0)||(aL!==aI&&(aA.length%2)!==0)){var aZ=aY+(a0?-1:1);if(aA[aZ][0]===ai[0]&&aA[aZ][1]===ai[1]){aA.splice(aZ,1)}else{aA.splice(aY+(a0?0:1),0,ai)}}};if(aT.path.length===9){aT.views.main.handlers=[];if(aT.views.main.elts.elt.parentNode.querySelectorAll(".my-handler")[0]){aT.views.main.elts.elt.parentNode.querySelectorAll(".my-handler")[0].remove()}}var al=aT;if(aT.views.main.elts.elt){if(aT.views.main.elts.elt.parentNode.querySelectorAll(".my-handler").length===0){var aP=0}else{if(aT.views.main.elts.elt.parentNode.querySelectorAll(".my-handler").length>0){var aP=aT.views.main.handlers.length}}}else{if(!aT.views.main.elts.elt){var aP=aT.views.main.handlers.length}}for(var aQ=aP;aQ<(al.path.length/3-3);aQ++){var az="http://www.w3.org/2000/svg";var aJ=document.createElementNS(az,"g");var ak=document.createElementNS(az,"circle");var aC,aB;var au=al.path.length/3;aB=0.5*(al.path[(aQ+2)*3+2]+al.path[(aQ+1)*3+2]);aC=0.5*(al.path[(aQ+2)*3+1]+al.path[(aQ+1)*3+1]);al.views.main.handlers.push([aC,aB]);al.views.main.initialHandlerPosition.push([aC,aB]);aJ.setAttribute("class","my-handler");ak.setAttribute("cx",aC);ak.setAttribute("cy",aB);ak.setAttribute("r",5);aJ.appendChild(ak);var aw=null;var ax=0;var ay=0;var am=0;var aD=0;var aR=0;var aX=0;ak.setAttribute("identifier",aQ);var aj=function(a0,aZ){if(!aZ){aZ=window.event}aZ.stopPropagation();aZ.preventDefault();am=aZ.clientX;aD=aZ.clientY;aw=a0;aR=am-aw.getAttribute("cx");aX=aD-aw.getAttribute("cy");ax=am-aR;ay=aD-aX;document.onmousemove=null;for(var aZ=Y.edges.first;aZ;aZ=aZ.next){if(aZ.views.main.structure.root===aw.parentNode.parentNode){var aY=aZ;document.onmousemove=function(a1){if(!a1){a1=window.event}am=document.all?a1.clientX:a1.pageX;aD=document.all?a1.clientY:a1.pageY;var a3=Math.round(Y.views.main.clientToViewpoint(am,aD)[0]);var a2=Math.round(Y.views.main.clientToViewpoint(am,aD)[1]);aY.views.main.handlers[aw.getAttribute("identifier")][0]=a3;aY.views.main.handlers[aw.getAttribute("identifier")][1]=a2;aw.setAttribute("cx",a3);aw.setAttribute("cy",a2);aY.geometry.onupdate(aY)}}}document.onmouseup=aN};var aN=function(){aw=null;document.onmousemove=null;document.onmouseup=null};al.views.main.structure.root.appendChild(aJ);ak.onmousedown=function(aY){aj(this,aY)}}if(aT.views.main.handlers.length>0&&Y.selection.first&&Y.selection.first.type===C.Type.EDGE||aT.views.main.handlers.length>0&&!Y.selection.first){aT.views.main.handlers.splice(1,aT.views.main.handlers.length-(aT.path.length/3-3));for(var aO=(aT.path.length/3-3);aO<(aT.views.main.handlers.length+1);aO++){if(aT.views.main.elts.elt.parentNode.querySelectorAll(".my-handler")[aO]){aT.views.main.elts.elt.parentNode.querySelectorAll(".my-handler")[aO].remove()}}for(var aQ=0;aQ<aT.views.main.handlers.length;aQ++){var aw=[aT.views.main.handlers[aQ][0],aT.views.main.handlers[aQ][1]];if(av){aE.push(C.PathCmd.L,aw[0],aE[3*aQ+2]);if((aQ+1)===aT.views.main.handlers.length){aE.push(C.PathCmd.L,aw[0],aS[1])}}else{aE.push(C.PathCmd.L,aE[3*aQ+1],aw[1]);if((aQ+1)===aT.views.main.handlers.length){aE.push(C.PathCmd.L,aS[0],aw[1])}}av=!av}}else{if(aT.views.main.handlers.length===0||!aT.views.main.handlers||Y.selection.first&&Y.selection.first.type!==C.Type.EDGE||!Y.selection.first){aM(aS,1,true);if(aU[aL]*aK>=aA[1][aL]*aK-ah){aG=[aU[0],aU[1]];aG[aL]=aU[aL]+aq*aK;aM(aG,1,false)}if(aS[aI]*aH>=aA[aA.length-2][aI]*aH-ah){aG=[aS[0],aS[1]];aG[aI]=aS[aI]+aq*aH;aM(aG,aA.length-1,true)}for(aQ=1;aQ<aA.length;++aQ){if(av){aE.push(C.PathCmd.L,aA[aQ][0],aA[aQ-1][1])}else{aE.push(C.PathCmd.L,aA[aQ-1][0],aA[aQ][1])}av=!av}if(aT.views.main.handlers.length!==0){aT.views.main.handlers=[]}}}aE.push(C.PathCmd.L,aS[0],aS[1]);for(aQ=3;aQ<aE.length-6;aQ++){for(var aO=0;aO<ao.length;aO++){if(aE[aQ]===aE[aQ+3]&&aE[aQ]===ao[aO]&&aE[aQ]===ao[aO+2]){aE[aQ]=aE[aQ]+5*aF;aE[aQ+3]=aE[aQ+3]+5*aF}}}aT.set("path",aE);if(aT.views.main.display.elt&&aT.cl1.c.data.type==="Region"){var aC,aB;var au=aT.path.length/3;if(au%2===0){var at=au/2;var ar=au/2+1;aB=0.5*(aT.path[(ar-1)*3+2]+aT.path[(at-1)*3+2]);aC=0.5*(aT.path[(ar-1)*3+1]+aT.path[(at-1)*3+1])}else{var ap=(au+1)/2;aB=aT.path[(ap-1)*3+2];aC=aT.path[(ap-1)*3+1]}var aW=aB+5;if(aT.views.main.structure.root.querySelector(".my-interaction")&&!isNaN(aC)&&!isNaN(aB)){aT.views.main.structure.root.querySelector(".my-interaction").querySelectorAll("circle")[0].setAttribute("cx",aC);aT.views.main.structure.root.querySelector(".my-interaction").querySelectorAll("circle")[0].setAttribute("cy",aB);aT.views.main.structure.root.querySelector(".my-interaction-type").setAttribute("x",aC);aT.views.main.structure.root.querySelector(".my-interaction-type").setAttribute("y",aW)}}if(aT.views.main.display.elt){for(var aQ=0;aQ<(aT.path.length/3-3);aQ++){var aC,aB;var au=aT.path.length/3;aB=0.5*(aT.path[(aQ+2)*3+2]+aT.path[(aQ+1)*3+2]);aC=0.5*(aT.path[(aQ+2)*3+1]+aT.path[(aQ+1)*3+1]);if(Y.selection.first&&Y.selection.first.type!==C.Type.EDGE){aT.views.main.handlers.push([aC,aB])}var aW=aB+5;if(aT.views.main.structure.root.querySelectorAll(".my-handler")[aQ]&&!isNaN(aC)&&!isNaN(aB)){aT.views.main.structure.root.querySelectorAll(".my-handler")[aQ].querySelector("circle").setAttribute("cx",aC);aT.views.main.structure.root.querySelectorAll(".my-handler")[aQ].querySelector("circle").setAttribute("cy",aB)}}}};function W(){b.SVGEdgeView.call(this);this.handlers=[];this.initialHandlerPosition=[]}ag.inherit(W,b.SVGEdgeView);W.prototype.oncreateDisplay=function(aA){var an="http://www.w3.org/2000/svg",av="http://www.w3.org/1999/xlink";var au;b.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments);var ao=this;var am=Y.edges.last;if(am){if(am.path.length>6){for(var az=0;az<(am.path.length/3-3);az++){var an="http://www.w3.org/2000/svg";var al=document.createElementNS(an,"g");var ah=document.createElementNS(an,"circle");var aq,ap;var aC=am.path.length/3;ap=0.5*(am.path[(az+2)*3+2]+am.path[(az+1)*3+2]);aq=0.5*(am.path[(az+2)*3+1]+am.path[(az+1)*3+1]);am.views.main.handlers.push([aq,ap]);am.views.main.initialHandlerPosition.push([aq,ap]);al.setAttribute("class","my-handler");ah.setAttribute("cx",aq);ah.setAttribute("cy",ap);ah.setAttribute("r",5);al.appendChild(ah);var aj=null;var ax=0;var ak=0;var ar=0;var aw=0;var ai=0;var at=0;ah.setAttribute("identifier",az);var aB=function(aF,aE){if(!aE){aE=window.event}aE.stopPropagation();aE.preventDefault();ar=aE.clientX;aw=aE.clientY;aj=aF;ai=ar-aj.getAttribute("cx");at=aw-aj.getAttribute("cy");ax=ar-ai;ak=aw-at;document.onmousemove=null;for(var aE=Y.edges.first;aE;aE=aE.next){if(aE.views.main.structure.root===aj.parentNode.parentNode){var aD=aE;document.onmousemove=function(aG){if(!aG){aG=window.event}ar=document.all?aG.clientX:aG.pageX;aw=document.all?aG.clientY:aG.pageY;var aI=Math.round(Y.views.main.clientToViewpoint(ar,aw)[0]);var aH=Math.round(Y.views.main.clientToViewpoint(ar,aw)[1]);aD.views.main.handlers[aj.getAttribute("identifier")][0]=aI;aD.views.main.handlers[aj.getAttribute("identifier")][1]=aH;aj.setAttribute("cx",aI);aj.setAttribute("cy",aH);aD.geometry.onupdate(aD)}}}document.onmouseup=ay};var ay=function(){aj=null;document.onmousemove=null;document.onmouseup=null};am.views.main.structure.root.appendChild(al);ah.onmousedown=function(aD){aB(this,aD)}}}}this.display.elt.id=u();au=document.createElementNS(an,"textPath");au.setAttributeNS(av,"href","#"+this.display.elt.id);au.setAttribute("startOffset","50%");au.appendChild(document.createTextNode(""));this.display.text=document.createElementNS(an,"text");this.display.text.setAttribute("dy","-5");ag.classListAdd(this.display.text,"edge-text");this.display.text.appendChild(au);this.display.text.grElt=aA;this.display.text.subElt="text";this.structure.root.appendChild(this.display.text)};var u=(function(){function ai(){return"--path"+ah++}var ah=0;return ai}());function J(aj,ai,ah,ak){v.ConnConnectDrag.call(this,aj,ai);this.firstmovecb=ah;this.cancelcb=ak}ag.inherit(J,v.ConnConnectDrag);J.prototype.newEdge=ab;J.prototype.onend=function(ak){j=false;v.ConnConnectDrag.prototype.onend.apply(this,arguments);for(var az=this.gr.nodes.first;az;az=az.next){for(var aI=az.children.first;aI;aI=aI.next){F(aI.views.main.display.elt,"my-connector-highlight");var aE=aI.view.display.elt.querySelector("text");aE.style.visibility="hidden"}}var aB=widget.editor.root;if(this.c!==null&&this.otherConnector!==null){if(this.c.data.type!=="Region"&&this.otherConnector.data.type!=="Region"&&this.otherConnector.data.type===this.c.data.type&&this.c.data.direction!==this.otherConnector.data.direction&&this.c.data.typeID===this.otherConnector.data.typeID){var ay=this.c;var ax=this.otherConnector;P.onNewEdge(ay,ax)}else{if(this.c.data.type==="Region"&&this.otherConnector.data.type==="Region"&&this.otherConnector.data.type===this.c.data.type&&this.c.data.direction===this.otherConnector.data.direction&&this.c.data.typeID===this.otherConnector.data.typeID){var at=this.c;var aC=this.otherConnector;P.onNewEdge(at,aC)}else{if(this.c.data.typeID!==this.otherConnector.data.typeID){var am=q.get("link_invalid_type");if(am==="link_invalid_type"){am="The ports cannot be connected because they have different type references."}aB.getModel().addMessage(am,"error","notification")}else{var an=q.get("link_invalid");if(an==="link_invalid"){an="Invalid connection"}aB.getModel().addMessage(an,"error","notification")}this.edge.remove()}}}if(Y.edges.last!==null){var aF=Y.edges.last.cl1.c.views.main.display.elt.getAttribute("class").split(" ");aF.splice(aF.indexOf("my-connector-inactive"),1);aF.push("my-connector-active");var ah=aF.join(" ");Y.edges.last.cl1.c.views.main.display.elt.setAttribute("class",ah);aF=Y.edges.last.cl2.c.views.main.display.elt.getAttribute("class").split(" ");aF.splice(aF.indexOf("my-connector-inactive"),1);aF.push("my-connector-active");ah=aF.join(" ");Y.edges.last.cl2.c.views.main.display.elt.setAttribute("class",ah)}var ao=this.gr.edges.last;if(ao){if(!ak&&ao.cl1.c.data.type==="Region"){if(!ao.views.main.structure.root.querySelector(".my-interaction")){var aq="http://www.w3.org/2000/svg";var al=document.createElementNS(aq,"g");var aA=document.createElementNS(aq,"circle");var aH=document.createElementNS(aq,"text");var aG=document.createElementNS(aq,"title");var av,au;var aK=ao.path.length/3;if(aK%2===0){var ar=aK/2;var ap=aK/2+1;au=0.5*(ao.path[(ap-1)*3+2]+ao.path[(ar-1)*3+2]);av=0.5*(ao.path[(ap-1)*3+1]+ao.path[(ar-1)*3+1])}else{var aJ=(aK+1)/2;au=ao.path[(aJ-1)*3+2];av=ao.path[(aJ-1)*3+1]}var aj=au+5;al.setAttribute("class","my-interaction");aA.setAttribute("cx",av);aA.setAttribute("cy",au);aA.setAttribute("r",20);aH.setAttribute("class","my-interaction-type");aH.setAttribute("x",av);aH.setAttribute("y",aj);aH.setAttribute("text-anchor","middle");aH.setAttribute("stroke-width",1);aG.setAttribute("class","my-interaction-title");al.appendChild(aA);al.appendChild(aH);al.appendChild(aG);var aw=al.querySelector(".my-interaction-type");var aD=m.AFR.CommandsManager.getCommand("SMAMultiScaleInterCmdHdr");aD.setOptions(aB.getModel(),aw,ao.data.RFLlink);aD.begin();al.onclick=function(){var aM=this.querySelector(".my-interaction-type");var aL=m.AFR.CommandsManager.getCommand("SMAMultiScaleInterCmdHdr");aL.setOptions(aB.getModel(),aM,ao.data.RFLlink);aL.begin()};if(ao.views.main.structure.root.querySelector(".my-handler")){var ai=ao.views.main.structure.root.querySelectorAll(".my-handler")[0];ao.views.main.structure.root.insertBefore(al,ai)}else{if(!ao.views.main.structure.root.querySelector(".my-handler")){ao.views.main.structure.root.appendChild(al)}}}}}if(ak&&this.cancelcb){this.cancelcb()}};J.prototype.onfirstmove=function(){j=true;var ah=this.c;if(this.firstmovecb){F(this.c.views.main.display.elt,"my-connector-active");K(this.c.views.main.display.elt,"my-connector-inactive");F(this.gr.selection.first.views.main.display.elt,"my-connector-active");K(this.gr.selection.first.views.main.display.elt,"my-connector-inactive");var ar=widget.editor.root;ar.removeEdgeDrag(ar)}K(this.c.views.main.display.elt,"my-connector-highlight");var aj=this.c.getParent();var ai=this.gr;for(var al=ai.nodes.first;al;al=al.next){if(al===aj){continue}var an=al.children.first;while(an){if(!an.data){an=an.next;continue}if(this.c.data.type&&this.c.data.type==="Region"){if(an.data.type===ah.data.type){K(an.views.main.display.elt,"my-connector-highlight");var ao=ah.children.first;while(ao){if(ao.ref.cl1.c===an||ao.ref.cl2.c===an){K(ao.ref.views.main.display.elt,"highlight");K(an.views.main.display.elt,"my-connector-highlight")}ao=ao.nextEdge()}var ak=an.views.main.display.elt.querySelector("text");if(an.views.main.display.elt.grElt.attach===2){var aq=ak.getBBox().width/2+Number(ak.getAttribute("x"));ak.setAttribute("transform","rotate(180 "+aq+",0)")}if(an.children.first){ak.setAttribute("y","-2")}else{ak.setAttribute("y","5")}ak.style.visibility="visible"}}else{if(this.c.data.type&&this.c.data.type!=="Region"){if(an.data.type===this.c.data.type&&an.data.direction!==this.c.data.direction&&!an.children.first){K(an.views.main.display.elt,"my-connector-highlight");var am=this.c.children.first;while(am){if(am.ref.cl1.c===an||am.ref.cl2.c===an){K(am.ref.views.main.display.elt,"highlight");K(an.views.main.display.elt,"my-connector-highlight")}am=am.nextEdge()}var at=an.views.main.display.elt.querySelector("text");if(an.views.main.display.elt.grElt.attach===2){var ap=at.getBBox().width/2+Number(at.getAttribute("x"));at.setAttribute("transform","rotate(180 "+ap+",0)")}if(an.children.first){at.setAttribute("y","-2")}else{at.setAttribute("y","5")}at.style.visibility="visible"}}}an=an.next}}};function aa(ah){v.NodeDrag.call(this,ah)}ag.inherit(aa,v.NodeDrag);aa.prototype.onmove=function A(){v.NodeDrag.prototype.onmove.apply(this,arguments);widget.editor.hideContextualBar()};aa.prototype.onend=function f(ai){v.NodeDrag.prototype.onend.apply(this,arguments);if(!ai){if(!(m.AFR.CommandsManager.getCommand("SMAMultiScaleEditCompCmdHdr").isRunning()||m.AFR.CommandsManager.getCommand("SMAMultiScaleParamCmdHdr").isRunning()||m.AFR.CommandsManager.getCommand("SMAMultiScaleDelCmdHdr").isRunning())){widget.editor.showContextualBar()}var ah=this.gr.selection.first;var aj=ah.data.RFLComponent;aj.setPosition([ah.left+ah.width/2,ah.top+ah.height/2])}};function p(){v.DefaultRootState.call(this)}ag.inherit(p,v.DefaultRootState);p.prototype.newDragForElement=function(aj,ai){if(ai.type===C.Type.CONNECTOR){var am=ai.node,ak,ah,al;ah=new v.ConnDrag(aj,ai);al=new J(aj,ai);ak=new v.MixDrag(ah);ak.chooseDrag=function(ap){var ao=null,ar=null;var an=ap.graphPos[0],aq=ap.graphPos[1];if(am.parent&&am.parent.type===C.Type.GROUP){an-=am.parent.left;aq-=am.parent.top}if(ag.isInNode(am,an,aq,20)){ap.graphPos[0]=an;ap.graphPos[1]=aq;return ah}if(ar&&ag.isInNode(ar,an,aq,10)){ap.graphPos[0]=an;ap.graphPos[1]=aq;return ao}ar=null;return al};return ak}else{if(ai.type===C.Type.NODE){return new aa(aj)}else{return v.DefaultRootState.prototype.newDragForElement.apply(this,arguments)}}};function o(al,ak,ai,ah,am){var aj;aj=new C.Node();aj.data=new g(am,aj);aj.views.main=new X();aj.multiset("left",ak,"top",al,"width",ai,"height",ah);return aj}function Z(){if(widget.editor){var ai=widget.editor.gr;ai.data.handles_overlay=new S(ai.views.main);ai.addChangeListener(function ah(ak){ak.forEach(function aj(al){if(al.path[0]!=="selection"||al.child.type!==C.Type.NODE){return}switch(al.type){case"added":al.child.data.showResizeHandles();break;case"removed":al.child.data.hideResizeHandles();break}})})}}function n(){if(widget.editor){var ah=widget.editor.gr;var ak,aj;aj=new v.DefaultRootState();aj.newDragForElement=function ai(am,al,an){if(an instanceof ac){return an.newDrag()}if(al.type===C.Type.NODE){return new V(am)}};ak=new v.StateMachine(ah,undefined,aj,ah.views.main)}}function z(aj,ai,aq,ap,an,al,ao,ah,am){var ak=new C.Connector();ak.data={};ak.data.direction=aq;ak.data.name=ai;ak.data.type=ap;ak.data.valueref=al;ak.data.mangledName=ao;ak.data.phID=ah;ak.data.typeID=am;ak.views.main=new c();ak.multiset(["cstr","attach"],an.attach,["cstr","offset"],an.offset);return ak}function R(ai,ah){if(!ah.children.first&&ai.node!==ah.node){if(ai.data.direction===G.IN||ai.data.direction===G.OUT){return ai.data.direction!==ah.data.direction}return true}return false}function ab(ai,ah,ak){var aj=new C.Edge();aj.set("geometry",new N());aj.views.main=new W();aj.data={};aj.data.c1=ai.data.name;aj.data.c2=ah.data.name;aj.data.RFLlink=ak;if(ai.data.type==="Region"){aj.views.main.className="egraph_views_SVGEdgeView my-region2region-edge"}else{aj.views.main.className="egraph_views_SVGEdgeView my-real2real-edge"}return aj}function l(aj){if(aj.type===C.Type.EDGE){for(var am=0;am<aj.views.main.structure.root.querySelectorAll(".my-handler").length;am++){if(aj.views.main.structure.root.querySelectorAll(".my-handler")[am]){aj.views.main.structure.root.querySelectorAll(".my-handler")[am].style.visibility="visible"}}var ap=0;var aw=Y.edges.first;while(aw){if(aw.selected){ap++}aw=aw.next}var at=aj.gr.selection.last.cl1.c;var ar=aj.gr.selection.last.cl2.c;if(aj.views.main.structure.root.querySelector(".my-interaction")){aj.views.main.structure.root.querySelector("circle").style.stroke="#42a2da"}K(at.views.main.display.elt,"my-connector-highlight");K(ar.views.main.display.elt,"my-connector-highlight");var av=at.view.display.elt.querySelector("text");var au=ar.view.display.elt.querySelector("text");if(at.attach===2){var ao=av.getBBox().width/2+Number(av.getAttribute("x"));av.setAttribute("transform","rotate(180 "+ao+" ,0)")}else{av.removeAttribute("transform")}if(at.children.first){av.setAttribute("y","-2")}else{av.setAttribute("y","5")}av.style.visibility="visible";if(ar.attach===2){var ah=au.getBBox().width/2+Number(au.getAttribute("x"));au.setAttribute("transform","rotate(180 "+ah+" ,0)")}else{au.removeAttribute("transform")}if(ar.children.first){au.setAttribute("y","-2")}else{au.setAttribute("y","5")}au.style.visibility="visible"}else{if(aj.type===C.Type.NODE){var ak=0;var aq=Y.nodes.first;while(aq){if(aq.selected){ak++}aq=aq.next}var ai=aj.children.first;while(ai){var al=ai.view.display.elt.querySelector("text");if(ai.attach===2){var an=al.getBBox().width/2+Number(al.getAttribute("x"));al.setAttribute("transform","rotate(180 "+an+",0)")}else{al.removeAttribute("transform")}if(ai.children.first){al.setAttribute("y","-2")}else{al.setAttribute("y","5")}al.style.visibility="visible";ai=ai.next}}}}function Q(al){if(al.type===C.Type.EDGE){for(var ak=0;ak<al.views.main.structure.root.querySelectorAll(".my-handler").length;ak++){if(al.views.main.structure.root.querySelectorAll(".my-handler")[ak]){al.views.main.structure.root.querySelectorAll(".my-handler")[ak].style.visibility="hidden"}}if(al.views.main.structure.root.querySelector(".my-interaction")){al.views.main.structure.root.querySelector("circle").style.stroke="#3d3d3d"}var ah=null;if(al.gr){ah=al.gr.nodes.first}else{return}while(ah){if(ah.isSelected()===false){var aj=ah.children.first;while(aj){F(aj.views.main.display.elt,"my-connector-highlight");var ao=aj.view.display.elt.querySelector("text");ao.style.visibility="hidden";aj=aj.next}}ah=ah.next}}else{if(al.type===C.Type.NODE){var an=null;if(al.gr){an=al.gr.nodes.first}else{return}while(an){if(an.isSelected()===false){var ai=an.children.first;while(ai){var am=ai.view.display.elt.querySelector("text");am.style.visibility="hidden";ai=ai.next}}an=an.next}}}}return P});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Editor",["UWA/Core","DS/ApplicationFrame/FrameWindow","DS/egraph/core","DS/egraph/views","DS/egraph/iact","DS/egraph/utils","DS/RFLModelerWeb/RFL_Base","DS/RFLModelerWeb/RFL_ThemeBase","DS/UIKIT/Alert","DS/ApplicationFrame/ContextualBar","DS/ApplicationFrame/ContextualUIManager","DS/Core/Core","DS/Controls/Loader","DS/SMAMSExperimentServices/SMAMSExperimentServices","i18n!DS/SMAMSWebUI/assets/nls/SMAMSWebUI","DS/RFLModelerWeb/RFL_EditorPanel","module","DS/Logger/Logger","DS/SMAProcWebCMMUtils/SMAJSCMMAuthoringUtils","DS/SMAMSExecutionServices/SMAMSExecutionServices","DS/SMAMSExperimentServices/Document","DS/UIKIT/Input/Button","DS/Windows/Panel","DS/Tree/TileGridView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils"],function(i,B,y,l,x,z,n,a,o,r,u,g,C,c,h,b,e,A,w,s,d,t,p,k,q,v,j){var f=i.Class.extend({init:function(H){this.selectedItem=null;this.contextualUIMgr=null;this.root=null;this.eventHandler=H.editor_event_handler;this.spinCountSys=0;this.spinner=null;this.panel=null;this.frmWindow=null;this.addFrame(H);var E=this.frmWindow.getUIFrame();var G=i.createElement("div",{id:"eGraphDiv"}).inject(E);G.setAttribute("style","height: 100%");var K=i.createElement("div",{id:"introDiv"}).inject(E);var J=i.createElement("div",{id:"recentDiv"}).inject(E);var F=i.createElement("div",{id:"debugDiv"}).inject(E);var D=i.createElement("div",{id:"spinnerDiv"}).inject(E);i.createElement("div",{id:"xyplotDiv"}).inject(E);var I=i.createElement("div",{id:"alertDiv"}).inject(E);I.setAttribute("style","position:absolute; top:0; width:100%; z-index:1000;");i.createElement("div",{id:"maskDiv"}).inject(E);this.addTheme(H,G);this.addEvents(H);this.addAlert(I);this.addIntroText(K);this.addRecentExp(J);this.registerContextualBar();this.addDebugText(F);this.createSystemSpinner(D)},addFrame:function(E){this.frmWindow=new B({workbench:E.application+".xml",workbenchModule:E.module,viewer:"none",height:"100%",width:"100%",viewerOptions:{antiAliasing:true,useShadowMap:false,infinitePlane:false,displayGrid:false,displayLines:false,control:"SIMPLE",ssao:false,debugShadowLight:false,debugBSphere:false,debugBBox:false},uiOptions:{displayActionBar:true,displayTree:false}});if(localStorage.getItem("EXPCDebugModeOn")==="true"){var F=this.frmWindow.onActionBarReady((function(){this.frmWindow.getActionBar().removeCallback(F);this.frmWindow.getActionBar().loadModel({merge:true,file:E.application+"Debug.xml",module:"SMAMSWebUI",})}).bind(this))}if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.body)){if(widget.body.querySelector("#loading_canvas")){var G=widget.body.querySelector("#loading_canvas");G.parentNode.removeChild(G)}}this.frmWindow.inject(E.container);this.frmWindow.RFLEditor=this;this.frmWindow.getViewerFrame().style.backgroundColor="#f9f9f9";var D=this.getUIFrame();D.style.height="100%";D.addEventListener("contextmenu",function(H){H.preventDefault();return false},false)},getFrame:function(){return this.frmWindow},getUIFrame:function(){return this.frmWindow.getUIFrame()},getImmersiveFrame:function(){return this.frmWindow.getImmersiveFrame()},addTheme:function(D,F){if(!D.theme){D.theme="DS/RFLModelerWeb/RFL_ThemeBase"}var E=this;require([D.theme],function(G){G.onNewEdge=E.onNewEdge.bind(E);E.gr=new y.EGraph();E.gr.data={handles_overlay:null};E.gr.addView("main",new l.HTMLGraphView(F));E.sm=new x.StateMachine(E.gr,null,new G.rootState(),E.gr.views.main);E.gr.addAllChangeListener(E.grEvents);G.setGraph(E.gr)})},addEvents:function(D){var E=function(I){if(I.querySelector(".drop-zone-active")){I.querySelector(".drop-zone-active").remove()}var H=i.createElement("div");H.setAttribute("class","drop-zone-active");H.inject(I)};var F=function(H){if(H.querySelector(".drop-zone-active")){H.querySelector(".drop-zone-active").remove()}};var G=this;D.container.addEventListener("dragover",function(H){if(H.target){H.dataTransfer.dropEffect="move";if(H.target.classList.contains("egraph_views_RootLayer")){E(H.target)}else{if(H.target.parentNode.classList.contains("my-node")){if(H.dataTransfer.types&&(H.dataTransfer.types[0]==="Files"||H.dataTransfer.types[0]==="application/x-moz-file")){E(H.target.parentNode.querySelector(".my-node-inner"))}else{H.dataTransfer.dropEffect="none"}}}}H.preventDefault()});D.container.addEventListener("dragleave",function(H){if(H.target){if(H.target.classList.contains("egraph_views_RootLayer")){F(H.target)}else{if(H.target.parentNode.classList.contains("my-node")){if(H.dataTransfer.types[0]==="Files"||H.dataTransfer.types[0]==="application/x-moz-file"){F(H.target.parentNode.querySelector(".my-node-inner"))}else{H.dataTransfer.dropEffect="move"}}}}});D.container.addEventListener("drop",function(H){var I=null;if(!H){H=window.event}if(H.target){if(H.target.classList.contains("egraph_views_RootLayer")){F(H.target)}else{if(H.target.parentNode.classList.contains("my-node")){if(H.dataTransfer.types[0]==="Files"||H.dataTransfer.types[0]==="application/x-moz-file"){F(H.target.parentNode.querySelector(".my-node-inner"));I=H.target.parentNode}else{H.dataTransfer.dropEffect="none";H.preventDefault();return false}}else{H.dataTransfer.dropEffect="none";H.preventDefault();return false}}}G.eventHandler.onDrop(H,I);H.preventDefault();return false})},addAlert:function(D){this.alert=new o({visible:true,autoHide:true,maximumVisibleMessages:4}).inject(D)},addMessage:function(E,D){if(D===false){this.alert.options.autoHide=false}else{this.alert.options.autoHide=true}if(this.alert){E.message=i.createElement("div",{text:E.message});this.alert.add(E)}},addIntroText:function(H){var E=i.createElement("div");var G=h.get("intro1");if(G==="intro1"){G="Open or create a new experiment from the action bar"}G=i.createElement("span",{text:G});var F=h.get("intro2");if(F==="intro2"){F="OR"}F=i.createElement("span",{text:F});var D=h.get("intro3");if(D==="intro3"){D="Select or drop an experiment here "}D=i.createElement("span",{text:D});E.appendChild(G);E.appendChild(i.createElement("br"));E.appendChild(F);E.appendChild(i.createElement("br"));E.appendChild(D);E.appendChild(i.createElement("i",{"class":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-drag-drop"}));E.setAttribute("class","intro-text");E.inject(H)},removeIntroText:function(){var D=this.frmWindow.getUIFrame();var E=D.querySelector(".intro-text");if(E){E.parentNode.removeChild(E)}},addRecentExp:function(E){E.style.zIndex=0;var K=this;if(widget&&widget.getValue){var I=widget.getValue("recentExp");if(I&&I.length){var J=new q({useAsyncPreExpand:true});for(var H=0;H<I.length;H++){var G=I.length-H-1;var F=I[G];var L=new v({label:F.name,subLabel:F.description,thumbnail:j.getWebappsBaseUrl()+"RFLModelerWeb/assets/experiment_tile.png",grid:{phID:F.phID}});J.addRoot(L)}var D=new k({model:J,selection:{canMultiSelect:false,enableListSelection:false},enableActiveUI:true,enableKeyboardNavigation:true,useSwipableMenu:false,onDragStartCell:function(O,M){var N={protocol:"3DXContent",data:{items:[{objectId:M.nodeModel.options.grid.phID,objectType:"Simulation",}]}};O.dataTransfer.setData("text",JSON.stringify(N))},height:"auto"});D.onCellClick(function(M){K.eventHandler.openSimulation(M.nodeModel.options.grid.phID)});D.setCheckBoxesVisible(false);D.inject(E);D.getContent().style.outline="none"}}},removeRecentExp:function(){var D=this.frmWindow.getUIFrame();var E=D.querySelector("#recentDiv");if(E){E.textContent="";E.style.zIndex=-1}},addDebugText:function(E){var D=i.createElement("div");D.appendChild(i.createElement("span",{text:"DEBUG MODE: ON"}));D.setAttribute("class","debug-div");D.inject(E)},addNode:function(J,E,G,D,M){var H=this;var K=G.getReference();var F=a.newNode(J-M/2,E-D/2,D,M,"1");G.view=F;F.data.RFLComponent=G;var I=K.getListConnectors();for(var L in I){if(I.hasOwnProperty(L)){H.addConnector(G,I[L].name,I[L].causality,I[L].type,I[L].position,I[L].valueref,I[L].mangledName,I[L].phID,I[L].typeID,I[L])}}H.gr.addNode(F);a.init_interactions();a.init_handles()},removeNode:function(J){var H=J.view;var G=this.gr;if(!H){return}var E=H.children.first;while(E){var F=E.children.first;while(F){var L=F.ref.cl1.c;var K=F.ref.cl2.c;if(L){L.view.display.elt.querySelector("text").style.visibility="hidden";m.removeClassSVG(L.views.main.display.elt,"my-connector-highlight")}if(K){K.view.display.elt.querySelector("text").style.visibility="hidden";m.removeClassSVG(K.views.main.display.elt,"my-connector-highlight")}if(F.views&&F.views.main.structure.root){var I=F.views.main.structure.root.querySelector(".my-interaction");if(I){I.parentNode.removeChild(I)}}F.ref.remove();if(!L.children.last){m.removeClassSVG(L.views.main.display.elt,"my-connector-active");m.addClassSVG(L.views.main.display.elt,"my-connector-inactive")}if(!K.children.last){m.removeClassSVG(K.views.main.display.elt,"my-connector-active");m.addClassSVG(K.views.main.display.elt,"my-connector-inactive")}F=F.next}E=E.next}G.updateLock();try{var D={onemptygroup:y.applyActualGeometry};H.remove(D)}finally{G.updateUnlock()}},addConnector:function(J,E,P,N,L,I,M,D,K,H){var G=J.view;if(!G){return}var O;if(P===n.Causality.input){O=a.DIRECTION.IN}else{if(P===n.Causality.output){O=a.DIRECTION.OUT}else{if(P===n.Causality.neutral){O=a.DIRECTION.INOUT}}}var F=a.newConnector(G,E,O,N,L,I,M,D,K);F.data.RFLConnector=H;G.appendConnector(F)},removeConnector:function(E,H){for(var F=0;F<E.instances.length;F++){var G=E.instances[F].view;var D=G.children.first;while(D){if(D.data.name===H){D.remove();break}D=D.next}}},setConnectorName:function(F,H,E){for(var G=0;G<F.instances.length;G++){var I=F.instances[G].view;var D=I.children.first;while(D){if(D.data.name===H){D.data.name=E;D.view.display.elt.querySelector("text").textContent=E;break}D=D.next}}},addEdge:function(L){if(L&&L.view){L.view.data.RFLlink=L;return}var S=this;var P=null;var O=null;try{var Q=L.comp1.view;var G=Q.children.first;while(G){if(G.data.name===L.con1){m.removeClassSVG(G.views.main.display.elt,"my-connector-inactive");m.addClassSVG(G.views.main.display.elt,"my-connector-active");P=G;break}G=G.next}Q=L.comp2.view;G=Q.children.first;while(G){if(G.data.name===L.con2){m.removeClassSVG(G.views.main.display.elt,"my-connector-inactive");m.addClassSVG(G.views.main.display.elt,"my-connector-active");O=G;break}G=G.next}}catch(T){this.model.addMessage("The connection could not be created.","error","notification")}if(!P||!O){this.model.addMessage("The connection could not be created.","error","notification")}var H=a.newEdge(P,O);L.setView(H);H.data.RFLlink=L;this.gr.addEdge(P,O,H);if(P.data.type==="Region"){if(!H.views.main.structure.root.querySelector(".my-interaction")){var J="http://www.w3.org/2000/svg";var F=document.createElementNS(J,"g");var R=document.createElementNS(J,"circle");var V=document.createElementNS(J,"text");var U=document.createElementNS(J,"title");var N,M;var X=H.path.length/3;if(X%2===0){var K=X/2;var I=X/2+1;M=0.5*(H.path[(I-1)*3+2]+H.path[(K-1)*3+2]);N=0.5*(H.path[(I-1)*3+1]+H.path[(K-1)*3+1])}else{var W=(X+1)/2;M=H.path[(W-1)*3+2];N=H.path[(W-1)*3+1]}var E=M+5;F.setAttribute("class","my-interaction");R.setAttribute("cx",N);R.setAttribute("cy",M);R.setAttribute("r",20);V.setAttribute("class","my-interaction-type");V.setAttribute("x",N);V.setAttribute("y",E);V.setAttribute("text-anchor","middle");V.setAttribute("stroke-width",1);U.setAttribute("class","my-interaction-title");F.appendChild(R);F.appendChild(V);F.appendChild(U);F.onclick=function(){var Z=this.querySelector(".my-interaction-type");var Y=g.AFR.CommandsManager.getCommand("SMAMultiScaleInterCmdHdr");Y.setOptions(S.model,Z,H.data.RFLlink);Y.begin()};if(H.views.main.structure.root.querySelector(".my-handler")){var D=H.views.main.structure.root.querySelectorAll(".my-handler")[0];H.views.main.structure.root.insertBefore(F,D)}else{if(!H.views.main.structure.root.querySelector(".my-handler")){H.views.main.structure.root.appendChild(F)}}}}},removeEdge:function(K){var J=K.getView();var G=this.gr;if(!J){var E=this.gr.edges.first;while(E){if(E.data.RFLlink&&E.data.RFLlink===K){J=E;break}E=E.next}}if(J){G.updateLock();try{var I={onemptygroup:y.applyActualGeometry};var F=J.cl1.c;var D=J.cl2.c;if(F){F.view.display.elt.querySelector("text").style.visibility="hidden";m.removeClassSVG(F.views.main.display.elt,"my-connector-highlight")}if(D){D.view.display.elt.querySelector("text").style.visibility="hidden";m.removeClassSVG(D.views.main.display.elt,"my-connector-highlight")}if(J.views.main.structure.root){var H=J.views.main.structure.root.querySelector(".my-interaction");if(H){H.parentNode.removeChild(H)}}J.remove(I);if(F&&!F.children.last){m.removeClassSVG(F.views.main.display.elt,"my-connector-active");m.addClassSVG(F.views.main.display.elt,"my-connector-inactive")}if(D&&!D.children.last){m.removeClassSVG(D.views.main.display.elt,"my-connector-active");m.addClassSVG(D.views.main.display.elt,"my-connector-inactive")}}finally{G.updateUnlock()}}},updateEdge:function(G,I){var F=G.getView();if(F&&F.views){var D=F.views.main.structure.root;if(D){var J=D.querySelector(".my-interaction-type");var E=D.querySelector(".my-interaction-title");var H="Empty";if(I==="FSI"){H="Fluid Structure Interaction"}else{if(I==="CHT"){H="Conjugate Heat Transfer"}else{if(I==="SXS"){H="Standard-Explicit Subcycle"}else{if(I==="SXL"){H="Standard-Explicit LockStep"}else{if(I==="IHT"){H="Induction Heat Transfer"}}}}}if(J){J.textContent=I}if(E){E.textContent=H}}}},grEvents:function(E){if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.body)){var I=widget.editor.model}if(!E[0].child){return}if(E[0].child.type===y.Type.NODE){if(E[0].name==="selection"){if(E[0].type==="added"){a.onSelect(E[0].child);if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.body)){widget.editor.selectedItem=E[0].child;if(I.experiment&&I.experiment.monitoring.status==="succeeded"&&widget.editor.getUIFrame().querySelector(".results-dropdiv")!==null){}}}else{if(E[0].type==="removed"){if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.body)){widget.editor.clearSelection();widget.editor.hideContextualBar();a.onUnselect(E[0].child);for(var K=E[0].child.gr.edges.first;K;K=K.next){var L=K.data.RFLlink;var G=[];for(var H=0;H<K.views.main.structure.root.querySelectorAll(".my-handler").length;H++){G.push(K.views.main.structure.root.querySelectorAll(".my-handler")[H].querySelector("circle"))}var N="";for(var H=0;H<G.length;H++){if(G[H]){N+=G[H].getAttribute("cx")+" , "+G[H].getAttribute("cy")+" ; "}}L.setPosition(N)}}}}}}else{if(E[0].child.type===y.Type.CONNECTOR){if(E[0].name==="selection"){if(E[0].type==="added"){}else{if(E[0].type==="removed"){var J=E[0].child.node.data.RFLComponent;var F=E[0].child.data.name;J.setConnectorPosition(F,[E[0].child.cstr.attach,E[0].child.cstr.offset],false,false);if(E[0].child.children.first){var L=E[0].child.children.first.ref.data.RFLlink;var G=[];for(var H=0;H<E[0].child.children.first.ref.views.main.elts.elt.parentNode.querySelectorAll(".my-handler").length;H++){G.push(E[0].child.children.first.ref.views.main.elts.elt.parentNode.querySelectorAll(".my-handler")[H].querySelector("circle"))}var N="";for(var H=0;H<G.length;H++){if(G[H]){N+=G[H].getAttribute("cx")+" , "+G[H].getAttribute("cy")+" ; "}}L.setPosition(N)}}}}}else{if(E[0].child.type===y.Type.EDGE){if(E[0].name==="selection"){if(E[0].type==="added"){if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.body)){widget.editor.selectedItem=E[0].child;if(!g.AFR.CommandsManager.getCommand("SMAMultiScaleDelCmdHdr").isRunning()){widget.editor.showContextualBar()}a.onSelect(E[0].child);var D=I.getExperiment();var M=D.services;if(D&&M&&D.monitoring.status==="running"&&widget.editor.selectedItem.cl1.c.data.type==="Real"){}else{if(D&&D.monitoring.status==="succeeded"&&widget.editor.getUIFrame().querySelector(".results-dropdiv")!==null&&widget.editor.selectedItem.cl1.c.data.type==="Real"){}}}}else{if(E[0].type==="removed"){var L=E[0].child.data.RFLlink;var G=[];for(var H=0;H<E[0].child.views.main.elts.elt.parentNode.querySelectorAll(".my-handler").length;H++){G.push(E[0].child.views.main.elts.elt.parentNode.querySelectorAll(".my-handler")[H].querySelector("circle"))}var N="";for(var H=0;H<G.length;H++){if(G[H]){N+=G[H].getAttribute("cx")+" , "+G[H].getAttribute("cy")+" ; "}}L.setPosition(N);if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.body)){widget.editor.clearSelection();widget.editor.hideContextualBar();a.onUnselect(E[0].child)}}}}}}}},onNewEdge:function(M,L){var U=M.node.data.RFLComponent;var K=M.data.name;var O=M.data.direction;var R=M.data.type;var E=0;var S=M.children.first;while(S){E++;S=S.next}var T=L.node.data.RFLComponent;var J=L.data.name;var N=L.data.direction;var Q=L.data.type;var D=0;S=L.children.first;while(S){D++;S=S.next}if(R!==Q){return false}if((O===a.DIRECTION.IN&&N!==a.DIRECTION.OUT)||(O===a.DIRECTION.OUT&&N!==a.DIRECTION.IN)||(O===a.DIRECTION.INOUT&&N!==a.DIRECTION.INOUT)){return false}for(var P=L.children.first;P;P=P.next){if(P!==L.children.last){if(L.children.last.ref.cl2.c.data.phID===P.ref.cl2.c.data.phID){L.children.last.ref.remove();m.removeClassSVG(P.ref.views.main.display.elt,"highlight");var H=h.get("link_invalid_io");if(H==="link_invalid_io"){H="The input port cannot be connected to two output ports."}this.root.getModel().addMessage(H,"warning","notification");return false}}}for(var I=M.children.first;I;I=I.next){if(I!==M.children.last&&I.c.data.type==="Region"){if(M.children.last.ref.cl1.c.data.phID===I.ref.cl1.c.data.phID){M.children.last.ref.remove();m.removeClassSVG(I.ref.views.main.display.elt,"highlight");var G=h.get("link_invalid_region");if(G==="link_invalid_region"){G="The region port can only be connected to another region port."}this.root.getModel().addMessage(G,"warning","notification");return false}}}var F={};F.comp1=U;F.comp2=T;F.con1=K;F.con2=J;F.view=this.gr.edges.last;F.phID=null;F.name="link";this.root.addLink1(F,function(){},function(){});return true},clearSelection:function(){this.selectedItem=null;if(this.gr){this.gr.clearSelection()}},registerContextualBar:function(){var F=this;var D="SMAMultiScale";var E={workbenchName:D,module:"SMAMSWebUI",cmdPrefix:"",fileName:D+".xml",merge:true,frameWindow:F.frmWindow,onContextualBarReady:function(){var J=0;var H=null;var I=[];if(F.selectedItem){if(F.selectedItem.type===y.Type.NODE){H=F.gr.nodes.first}else{if(F.selectedItem.type===y.Type.EDGE){H=F.gr.edges.first}}while(H){if(H.selected){J++}H=H.next}if(J>1){F.hideContextualBar();return}if(F.selectedItem.type===y.Type.NODE){I.push({name:"Edit",line:1,hdr_list:["SMAMultiScaleEditCompCmdHdr"]});I.push({name:"Parameters",line:1,hdr_list:["SMAMultiScaleParamCmdHdr"]});I.push({name:"Delete",line:1,hdr_list:["SMAMultiScaleDelCmdHdr"]});var K=F.selectedItem.data.RFLComponent;var G=K?K.getSelectedBehavior():null;if(G&&G.appName&&G.appName.length>0){I.push({name:"Open",line:1,hdr_list:["SMAMultiScaleOpenAuthoringCmdHdr"]})}}else{if(F.selectedItem.type===y.Type.EDGE||F.selectedItem.type===y.Type.CONNECTOR){I.push({name:"Delete",line:1,hdr_list:["SMAMultiScaleDelCmdHdr"]})}}}return{cmdList:I,}}};this.contextualUIMgr=new u(E);this.contextualUIMgr.register(E);this.contextualUIMgr.options._listOfSubscribers=this.contextualUIMgr._listOfSubscribers},showContextualBar:function(){var E=this;var D=this.frmWindow.getViewerFrame(),F=this.getUIFrame(),L=0,K=0;if(this.selectedItem&&this.selectedItem.type===y.Type.NODE){K=this.selectedItem.top;L=this.selectedItem.left+this.selectedItem.width}else{if(this.selectedItem&&this.selectedItem.type===y.Type.EDGE){if(this.selectedItem.views.main.handlers.length===0){K=0.5*(this.selectedItem.cl1.c.atop+this.selectedItem.cl2.c.atop);L=0.5*(this.selectedItem.cl1.c.aleft+this.selectedItem.cl2.c.aleft)}else{if(this.selectedItem.views.main.handlers.length===1||this.selectedItem.views.main.handlers.length===2){L=this.selectedItem.views.main.handlers[0][0];K=this.selectedItem.views.main.handlers[0][1]}else{if(this.selectedItem.views.main.handlers.length===3){L=this.selectedItem.views.main.handlers[1][0];K=this.selectedItem.views.main.handlers[1][1]}}}}}var I=this.gr.views.main.vpt;L=I[0]+I[2]*L;K=I[1]+I[2]*K;var M=[];if(E.selectedItem&&E.selectedItem.type===y.Type.NODE){M.push({name:"Edit",line:1,hdr_list:["SMAMultiScaleEditCompCmdHdr"]});M.push({name:"Parameters",line:1,hdr_list:["SMAMultiScaleParamCmdHdr"]});M.push({name:"Delete",line:1,hdr_list:["SMAMultiScaleDelCmdHdr"]});var G=E.selectedItem.data.RFLComponent;var H=G?G.getSelectedBehavior():null;if(H&&H.appName&&H.appName.length>0){M.push({name:"Open",line:1,hdr_list:["SMAMultiScaleOpenAuthoringCmdHdr"]})}}else{if(E.selectedItem&&E.selectedItem.type===y.Type.EDGE){M.push({name:"Delete",line:1,hdr_list:["SMAMultiScaleDelCmdHdr"]})}}if(D!==null&&F!==null){var J="SMAMultiScale";r.show({workbenchName:J,module:"SMAMSWebUI",cmdPrefix:"",cmdList:M,fileName:J+".xml",Yposition:K,Xposition:L,viewerFrame:D,uiFrame:F,hideWithDistance:false,subscribersOptions:this.contextualUIMgr._listOfSubscribers})}},hideContextualBar:function(){this.contextualUIMgr.getContextualBar().hide()},reframeOnComponent:function(G){var E=new z.BoundingRect();var D=G.view;E.update(D,D.actualLeft,D.actualLeft+D.actualWidth,D.actualTop,D.actualTop+D.actualHeight);var F=z.reframeViewpoint(D.gr.views.main.getSize(),E,{padding:15,minSize:50,horizontal:0,vertical:0,aliasing:0,minScale:D.gr.views.main.vpt[2],maxScale:D.gr.views.main.vpt[2],defaultVpt:D.gr.views.main.vpt});D.gr.views.main.setViewpoint(F,true)},createSystemSpinner:function(D){this.spinner=new C({fadeDuration:0}).inject(D);this.spinnerArray=[];this.spinnerArray.disableCommandsCounter=0},addSystemSpinner:function(D){if(typeof D!=="object"){console.log("bad parameter addSystemSpinner");return}this.spinnerArray.push(D);this.spinner.on();this.spinner.visibleFlag=true;this.spinner.elements.progressBar.statusFlag=false;if(D.message){this.spinner.text=D.message}if(D.exclusive===true){this.disableCommands();this.spinnerArray.disableCommandsCounter++}},removeSystemSpinner:function(G){if(typeof G!=="object"){console.log("bad parameter removeSystemSpinner");return}var I=this.spinner;var H=I.text;var D=this.spinnerArray.lastIndexOf(G);if(D===-1){return}this.spinnerArray.splice(D,1);if(G.exclusive===true){this.spinnerArray.disableCommandsCounter--;if(this.spinnerArray.disableCommandsCounter===0){this.enableCommands()}}if(D===this.spinnerArray.length){if(this.spinnerArray.length===0){H="";I.visibleFlag=false}else{var E="";for(var F=this.spinnerArray.length-1;F>=0;F--){E=this.spinnerArray[F].message;if(E!==""){break}}H=E}}I.text=H},clearSystemSpinner:function(){var E=this.spinner;var D=E.text;this.spinnerArray=[];this.spinnerArray.disableCommandsCounter=0;D="";E.visibleFlag=false},getSize:function(){var D={};D.width=this.frmWindow.getUIFrame().offsetWidth;D.height=this.frmWindow.getUIFrame().offsetHeight;return D},clear:function(){var L=this;var M=L.getUIFrame();var D=L.model.getExperiment();if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.setTitle)){widget.setTitle("")}L.clearSystemSpinner();if(L.contextualUIMgr.getContextualBar()._isShown){L.hideContextualBar()}L.selectedItem=null;L.root=null;var H=M.querySelector(".egraph_views_domroot");if(H){H.parentNode.removeChild(H)}if(L.gr){L.gr.nodes=[];L.gr.edges=[];L.gr=null}var E=M.querySelector("#eGraphDiv");if(widget&&widget.RefreshInProgress){E.show()}this.addTheme({},E);if(D&&D.services!==null&&D.services!==undefined){D.services.stopAllServices()}L.alert=new o({visible:true,autoHide:true,maximumVisibleMessages:4}).inject(M.querySelector("#alertDiv"));L.disableCommands();if(M.querySelector(".results-div")){var Q=M.querySelector(".results-div");if(Q){Q.parentNode.removeChild(Q)}}if(M.querySelector(".results-div2")){var P=M.querySelector(".results-div2");if(P){P.parentNode.removeChild(P)}}if(!M.querySelector(".intro-text")){var G=M.querySelector("#introDiv");L.addIntroText(G)}if(!M.querySelector("#recentDiv").children.length){var F=M.querySelector("#recentDiv");L.addRecentExp(F)}var N=M.querySelectorAll(".wux-windows-dialog");for(var K=0;K<N.length;K++){N[K].remove()}var O=M.querySelectorAll("xy-plot");for(var K=0;K<O.length;K++){O[K].panel.close()}if(M.querySelector("#monitoringDiv")&&M.querySelector("#monitoringDiv").firstChild){M.querySelector("#monitoringDiv").firstChild.remove()}if(typeof widget!=="undefined"&&i.is(widget)&&i.is(widget.setValue)){widget.setValue("rootID","");if(widget.getValue("RealTimeVariables")){widget.setValue("RealTimeVariables","")}}var I=M.querySelectorAll(".drop-zone-active");for(var J=0;J<I.length;J++){I[J].classList.remove("drop-zone-active")}L.locked=false},enableCommands:function(){try{this.locked=false;g.AFR.CommandsManager.enableAll()}catch(E){var D=A.getLogger(e);D.log("MS error : enableCommands failed")}},disableCommands:function(){try{this.locked=true;g.AFR.CommandsManager.disableAll();g.AFR.CommandsManager.getCommand("SMAMultiScaleExpCmdHdr").enable();g.AFR.CommandsManager.getCommand("SMAMultiScaleSearchExpCmdHdr").enable()}catch(E){var D=A.getLogger(e);D.log("MS error : disableCommands failed")}}});var m={};m.addClassSVG=function(D,E){var F=D.getAttribute("class");if(F&&F.indexOf(E)!==-1){return}if(F){F+=" "+E}else{F=E}D.setAttribute("class",F)};m.removeClassSVG=function(G,H){var I=G.getAttribute("class");I=I.split(" ");var D=I.indexOf(H);if(D>-1){I.splice(D,1)}var F="";for(var E=0;E<I.length;E++){F+=" "+I[E]}G.setAttribute("class",F)};return f});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Component",["UWA/Core","DS/SMAMSExperimentServices/Connector","DS/SMAMSExperimentServices/Behavior","DS/SMAMSExperimentServices/Link","DS/RFLModelerWeb/RFL_Connector","DS/WebappsUtils/WebappsUtils","DS/SMAMSExperimentServices/Reference","DS/SMAMSWeb/SMAMSGenerateConfigFile","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(e,h,c,d,g,f,i,k,j){var a=e.Class.extend({init:function(m,o,l,n){this.name=m;this.phID=o;this.model=l;this.type="DS/RFLModelerWeb/RFL_Component";this.connectors=[];this.behaviors=[];this.instances=[];this.thumbnail={};this.description="";if(o&&n){b.readJSon.call(this,n)}},initialize:function(l,n,m){b.readJSon.call(this,l);n()},commit:function(l){if(!this.phID){this.phID=l}},getInfo:function(){var l={};l.name=this.name;l.description=this.description;return l},setInfo:function(p,q,o){var m=this.model;var l=this;var s=l.getInfo();var r=function(t){if(t===-1){l.name=s.name;l.description=s.description;o()}else{q()}};if(s===p){r(0);return}l.name=p.name;l.description=p.description;var n={};n.physicalId=l.getID();n.title=l.name;n.description=l.description;n.onComplete=function(){m.addMessage("The reference: "+l.name+" has been updated.","info","log");r(0)};n.onFailure=function(v,u,x){var w=[v,u,x];var t=j.get("comp_update");if(t==="comp_update"){t="The component could not be updated."}m.addMessage(t,"error","notification",w);r(-1)};i.update(n)},getID:function(){return this.phID},getModel:function(){return this.model},getConnector:function(l){return this.connectors[l]},getConnectorNameFromID:function(n){var l=this.getListConnectors();for(var m in l){if(l[m].phID===n){return l[m].name}}},getListConnectors:function(){return this.connectors},addConnectors:function(G,r,H){var C=this;var o=this.getModel();var p=o.getEditor();var t=o.getExperiment();var u=function(m){if(m===0){if(t){var I=new k("config",o);var K=I.execute();t.setConfig(K)}r()}else{if(m===-1){H()}else{if(m===-2){for(var J=0;J<G.length;J++){var l=G[J];if(C.getConnector(l.name)){delete C.connectors[l.name];if(p){p.removeConnector(C,l.name)}}}H()}else{if(m===1){r()}}}}};for(var F=0;F<G.length;F++){var q=G[F];if(C.getConnector(q.name)){u(-1);return}for(var E=0;E<G.length;E++){if(F!==E&&q===G[E]){u(-1);return}}}for(var D=0;D<G.length;D++){var x=G[D];C.connectors[x.name]=x}if(p){for(var B=0;B<G.length;B++){var w=G[B];for(var y=0;y<C.instances.length;y++){p.addConnector(C.instances[y],w.name,w.causality,w.type,w.position,w.valueref,w.mangledName,w.phID,w.typeID,w)}}}if(G.length&&!G[0].phID){var s={};s.batchCreate={};s.batchCreate.referencePhysicalId=C.phID;s.batchCreate.connectors=[];s.onComplete=function(J){o.addMessage("The ports have been created.","info","log");for(var I=0;I<G.length;I++){var m=G[I];m.setID(J[I]);for(var l=0;l<C.instances.length;l++){C.instances[l].setConnectorPosition(m.name,[m.position.attach,m.position.offset],false,false)}}u(0)};s.onFailure=function(I,m,K){var J=[I,m,K];var l=j.get("port_create");if(l==="port_create"){l="The server could not create the ports."}o.addMessage(l,"error","notification",J);q.cancelID();u(-2)};for(var A=0;A<G.length;A++){var v=G[A];var z="In";if(v.causality==="O"){z="Out"}else{if(v.causality==="N"){z="InOut"}}var n={};n.title=v.name;n.description=v.description;n.typePhysicalId=v.typeID;n.direction=z;s.batchCreate.connectors.push(n)}h.batchCreate(s)}else{u(1)}},removeConnector1:function(z,r,B){var w=this;var o=w.getModel();var p=o.getEditor();var t=o.getExperiment();var s=w.connectors[z];if(!s){return}var C=function(E){if(E===0){if(t){var F=new k("config",o);var G=F.execute();t.setConfig(G)}if(o.getRoot().getLayout().file){o.getRoot().getLayout().manageConnectors(z,w,true,s)}r()}else{if(E===-1){w.connectors[z]=s;if(p){for(var D=0;D<w.instances.length;D++){p.addConnector(w.instances[D],s.name,s.causality,s.type,s.position,s.valueref,s.mangledName,s.phID,s)}}B()}}return};var m=function(){if(p){p.removeConnector(w,z)}delete w.connectors[z]};var l=0;var n=0;var v=function(){n++;if(n===l){var D=function(F){var E={};E.physicalId=F;E.onComplete=function(){o.addMessage("The port has been removed.","info","log");m();C(0)};E.onFailure=function(I,H,K){var J=[I,H,K];var G=j.get("port_remove");if(G==="port_remove"){G="The server could not remove the port."}o.addMessage(G,"error","notification",J);C(-1)};h.remove(E)};s.getID(D,function(){C(-1)})}};var A=function(){C(-1)};for(var x=0;x<w.instances.length;x++){var u=w.instances[x].connectors[z];if(!u){continue}for(var y=0;y<u.length;y++){var q=u[y];if(q){l++;o.getRoot().removeLink(q,v,A)}}}if(l===0){l++;v()}},addBehavior1:function(n,t,u,m,r,s,o){var q=this;var p=q.getModel();var l=function(x,v){if(x===-1){var A=q.behaviors.indexOf(v);if(A!==-1){q.behaviors.splice(A,1)}o()}else{if(x===0){var w=p.getExperiment();if(w){var y=new k("config",p);var z=y.execute();w.setConfig(z)}q.buildAllNodes()}s(v)}};require([t],function(y){var v=new y(n,q,m);if(r){v.description=r}q.behaviors.push(v);if(!m){var w;if(u==="fmu"){w="Fmu"}else{if(u==="sim"){w="Simulation"}else{w="Generic"}}var x={};x.title=n;x.description=v.description;x.referencePhysicalId=q.phID;x.type=w;x.onComplete=function(z){p.addMessage("The abstraction has been created.","info","log");v.phID=z;l(0,v)};x.onFailure=function(B,A,D){var C=[B,A,D];var z=j.get("beh_create");if(z==="beh_create"){z="The abstraction could not be created."}p.addMessage(z,"error","notification",C);l(-1,v)};c.create(x)}else{l(1,v)}})},listBehaviors:function(){return this.behaviors},getBehavior:function(m){for(var l=0;l<this.behaviors.length;l++){if(this.behaviors[l].getID()===m){return this.behaviors[l]}}},removeBehavior1:function(s,r,n){var q=this;var o=q.getModel();var m=o.getExperiment();var u=function(v){if(v===-1){q.behaviors.push(s);n()}else{if(v===-2){n()}else{if(m){var w=new k("config",o);var x=w.execute();m.setConfig(x)}q.buildAllNodes();r()}}};var t=q.behaviors.indexOf(s);if(t===-1){u(-2);return}var l=q.behaviors[t].getID();q.behaviors.splice(t,1);var p={};p.physicalId=l;p.onComplete=function(){o.addMessage("The abstraction has been removed.","info","log");u(0)};p.onFailure=function(x,w,z){var y=[x,w,z];var v=j.get("beh_remove");if(v==="beh_remove"){v="The abstraction could not be removed."}o.addMessage(v,"error","notification",y);u(-1)};c.remove(p)},buildAllNodes:function(){var m=this.getModel();var n=m.getEditor();if(n){for(var l=0;l<this.instances.length;l++){this.instances[l].buildNode()}}}});var b={};b.readJSon=function(H){var p=this.getModel();if(!H||typeof H!=="object"){return}if(H.description){this.description=H.description}var G=1,C=1,m=1;var I=H.connectors?H.connectors.length:0;var J=[];for(var z=0;z<I;z++){var P=H.connectors[z].title;var B=[3,10];if(H.connectors[z].direction==="Out"){B=[3,17*(C-0.5)];C++}else{if(H.connectors[z].direction==="In"){B=[2,17*(G-0.5)];G++}else{B=[0,17*(m-0.4)];m++}}var M={attach:B[0],offset:B[1]};var A=H.connectors[z].physicalId;var o;var y=(H.connectors[z].direction==="In")?"I":"O";var l=0;var F="";var K=H.connectors[z].typePhysicalId;for(var O in p.typeRefs){if(p.typeRefs.hasOwnProperty(O)){if(p.typeRefs[O].indexOf(K)!==-1){o=O}}}if(!o){continue}if(o==="Region"){y="N"}var n={};n.name=P;n.type=o;n.causality=y;n.position=M;n.mangledName=F;n.valueRef=l;n.phID=A;n.typeID=K;n.parent=this;if(H.connectors[z].description){n.description=H.connectors[z].description}var q=new g(n);J.push(q)}this.addConnectors(J,(function(S){var T=S.connectors?S.connectors.length:0;for(var Q=0;Q<T;Q++){var R=this.getConnector(S.connectors[Q].title);if(R){S.connectors[Q].physicalId=R.getID()}}}).bind(this,H),function(){});var t=function(Q,R,ag,ak,at,af,ao,aq){var U=this;p.addMessage("The modelDescription file has been downloaded.","info","log");var W=e.Utils.loadXml(af);var aj=W.getElementsByTagName("fmiModelDescription")[0];var aE=at.type;var ap="DS/SMAMSWeb/SMAFmuBehavior";var S=null;var Z=aj.getElementsByTagName("ModelVariables");if(Z.length!==1){var aa=j.get("beh_01");if(aa==="beh_01"){aa="Invalid FMU"}p.addMessage(aa,"error","notification");return}var ac=Z[0].getElementsByTagName("ScalarVariable");var av=false;if(Object.keys(U.getListConnectors()).length){av=true}for(var aA=0;aA<ac.length;aA++){var aC=ac[aA].getAttribute("causality");if(aC==="output"){var al=ac[aA].getAttribute("name");var X=ac[aA].getAttribute("valueReference");for(var ay=0;ay<p.components.length;ay++){for(var ax=0;ax<Object.keys(p.components[ay].connectors).length;ax++){if(al===p.components[ay].connectors[Object.keys(p.components[ay].connectors)[ax]].name){p.components[ay].connectors[Object.keys(p.components[ay].connectors)[ax]].valueref=X}}}}else{if(aC==="input"){var Y=ac[aA].getAttribute("name");var aD=ac[aA].getAttribute("valueReference");for(var ab=0;ab<p.components.length;ab++){for(var az=0;az<Object.keys(p.components[ab].connectors).length;az++){if(Y===p.components[ab].connectors[Object.keys(p.components[ab].connectors)[az]].name){p.components[ab].connectors[Object.keys(p.components[ab].connectors)[az]].valueref=aD}}}}}}var T=[];if(aj.getElementsByTagName("VendorAnnotations").length&&aj.getElementsByTagName("Tool").length&&aj.getElementsByTagName("Tool")[0].getAttribute("name")==="SIMULIA_CSE_3D"){ap="DS/SMAMSWeb/SMASimulationBehavior";var ai=aj.getElementsByTagName("VendorAnnotations");var ah=ai[0].getElementsByTagName("FieldVariable");var ad=ai[0].getElementsByTagName("Region");for(var au=0;au<ah.length;au++){var aB={};aB.name=ah[au].getAttribute("name");aB.causality=ah[au].getAttribute("causality");aB.MassExponent=ah[au].getAttribute("MassExponent");aB.LengthExponent=ah[au].getAttribute("LengthExponent");aB.TimeExponent=ah[au].getAttribute("TimeExponent");aB.type=ah[au].getAttribute("type");aB.position=ah[au].getAttribute("position");T.push(aB)}var am=ai[0].getElementsByTagName("Abaqus")[0];if(am){if(am.getAttribute("analysisType")==="STANDARD"){S="Abaqus/Standard"}else{if(am.getAttribute("analysisType")==="EXPLICIT"){S="Abaqus/Explicit"}else{if(am.getAttribute("analysisType")==="CFD"){S="CFD"}}}}for(var ar=0;ar<ad.length;ar++){var V=ad[ar].getAttribute("name");var an=ad[ar].getAttribute("mangled-name");if(!an){an=""}for(var aw=0;aw<p.components.length;aw++){for(var ae in p.components[aw].connectors){if(V===p.components[aw].getConnector(ae).name){p.components[aw].getConnector(ae).mangledName=an}}}}}this.addBehavior1(Q,ap,aE,R,ak,function(aF){var aH=at.physicalId?true:false;at.physicalId=aF.getID();if(ap==="DS/SMAMSWeb/SMASimulationBehavior"){aF.setFieldVariables(T);aF.codeName=S;var aG=aj.getElementsByTagName("Execution");if(aG.length!==0){aF.is3dfmu=true}}if(!aH&&ao){aF.addFile(ao,function(){},false,ag)}else{aF.addFile(af,function(){},true)}var aI={};aI.physicalId=R;aI.onComplete=function(aK){if(e.is(aK)){p.addMessage("The thumbnail has been downloaded.","info","log");var aJ={};aJ.file=aK;aF.setThumbnail(aJ,false,function(){},function(){})}};aI.onFailure=function(aL,aK,aN){var aM=[aL,aK,aN];var aJ=j.get("thumbnail_download");if(aJ==="thumbnail_download"){aJ="The thumbnail could not be downloaded."}p.addMessage(aJ,"error","notification",aM)};if(typeof(aq)==="string"){aI.onComplete(aq)}else{c.downloadThumbnail(aI)}},function(){})};var x=function(S,R,U){var T=[S,R,U];var Q=j.get("beh_04");if(Q==="beh_04"){Q="The modelDescription file could not be downloaded."}p.addMessage(Q,"error","notification",T)};var r=H.behaviors?H.behaviors.length:0;for(var E=0;E<r;E++){var v=H.behaviors[E].title;var u=H.behaviors[E].physicalId;var s=H.behaviors[E].description;var L={};if(H.behaviors[E]&&H.behaviors[E].parameters){for(var D=0;D<H.behaviors[E].parameters.length;D++){var w="Real";if(H.behaviors[E].parameters[D].dimension==="RealParameter"){w="Real"}else{if(H.behaviors[E].parameters[D].dimension==="IntegerParameter"){w="Integer"}else{if(H.behaviors[E].parameters[D].dimension==="BooleanParameter"){w="Boolean"}else{if(H.behaviors[E].parameters[D].dimension==="StringParameter"){w="String"}}}}L[H.behaviors[E].parameters[D].title]={value:H.behaviors[E].parameters[D].value,type:w}}}if(H.behaviors[E].file){t.call(this,v,u,L,s,H.behaviors[E],H.behaviors[E].file.md,H.behaviors[E].file.fileBlob,H.behaviors[E].thumbnail)}else{var N={};N.physicalId=u;N.onComplete=(t).bind(this,v,u,L,s,H.behaviors[E]);N.onFailure=x;c.downloadModelDescription(N)}}};return a});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_ComponentInstance",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/SMAMSExperimentServices/Instance","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/RFLModelerWeb/RFL_Base"],function(h,e,b,d,a,f,g){var c=h.Class.extend({init:function(j,l,k,i){this.name=j;this.phID=l;this.parent=k;this.reference=i;this.view=null;i.instances.push(this);this.spinCountInst=0;this.connectors=[];this.description="";this.ui={};this.ui.thumbnail=null;this.ui.shape={};this.ui.div=null;this.ui.shape=g.ComponentShape;this.ui.button=null;this.ui.tooltip=null;this.ui.positions={};this.type="DS/RFLModelerWeb/RFL_ComponentInstance";this._cbOK=[];this._cbKO=[]},getInfo:function(){var i={};i.name=this.name;i.description=this.description;return i},setInfo:function(q,p,l){var o=this;var m=o.getInfo();var n=o.getReference().model;var i=n.getExperiment();var r=function(u){if(u===-1){o.name=m.name;o.description=m.description;o.ui.div.querySelector(".node-title").textContent=o.name;o.ui.div.querySelector(".node-title").setAttribute("title",o.name);var t=o._getTooltipBody();o.ui.tooltip.setBody(t);l()}else{if(o.getParent().getLayout().file){o.getParent().getLayout().manageComponents(o,false)}p()}};if(m===q){p();return}o.name=q.name;o.description=q.description;o.ui.div.querySelector(".node-title").textContent=o.name;o.ui.div.querySelector(".node-title").setAttribute("title",o.name);var k=o._getTooltipBody();o.ui.tooltip.setBody(k);var s=function(){if(i&&o.getSelectedBehavior()&&i.behaviors[o.getID()]&&i.behaviors[o.getID()].activity){var t={};t.inst=o;t.name=q.name;t.description=q.description;i.setActivityName(t,function(){r(0)},function(){var u={};u.title=m.name;u.description=m.description;u.physicalId=o.getID();u.onComplete=function(){n.addMessage("The instance has been updated.","info","log");r(-1)};u.onFailure=function(x,w,z){var y=[x,w,z];var v=f.get("inst_update");if(v==="inst_update"){v="The instance could not be updated."}n.addMessage(v,"error","notification",y);r(-1)};a.update(u)})}};var j={};j.title=o.name;j.description=o.description;j.physicalId=o.getID();j.onComplete=function(){n.addMessage("The instance has been updated.","info","log");s()};j.onFailure=function(v,u,x){var w=[v,u,x];var t=f.get("inst_update");if(t==="inst_update"){t="The instance could not be updated."}n.addMessage(t,"error","notification",w);r(-1)};a.update(j)},getID:function(j,i){if(!this.phID){if(j){this._cbOK.push(j)}if(i){this._cbKO.push(i)}}else{if(j){j(this.phID)}else{return this.phID}}},setID:function(k){this.phID=k;for(var j=0;j<this._cbOK.length;j++){this._cbOK[j].call(this,k)}this._cbOK=[];this._cbKO=[]},cancelID:function(){for(var j=0;j<this._cbKO.length;j++){this._cbKO[j].call()}this._cbOK=[];this._cbKO=[]},getParent:function(){return this.parent},getReference:function(){return this.reference},getThumbnail:function(){return this.ui.thumbnail},setThumbnail:function(i){this.ui.thumbnail=i},removeThumbnail:function(){this.ui.thumbnail=null},getShape:function(){return this.ui.shape},setShape:function(k,i,j){this.ui.shape.w=k;this.ui.shape.h=i;if(j===true){return}if(this.getParent().getLayout().file){this.getParent().getLayout().manageComponents(this,false)}},buildNode:function(){var l=this;var k=null,i=null;if(l.getThumbnail()){i=URL.createObjectURL(l.getThumbnail());k=document.createElement("div");k.setAttribute("class","my-node-inner");k.appendChild(h.createElement("img",{src:i}))}else{if(!l.reference.behaviors[0]){var j=e.getWebappsBaseUrl()+"RFLModelerWeb/assets/newcomp.png";k=document.createElement("div");k.setAttribute("class","my-node-inner");k.appendChild(h.createElement("img",{src:j}))}else{k=l.reference.behaviors[0].buildNode()}}if(l.ui.div){l.ui.div.replaceChild(k,l.ui.div.firstChild)}else{l.ui.div=document.createElement("div");l.ui.div.setAttribute("class","my-node");l.ui.div.appendChild(k)}if(l.ui.button){l.ui.button.destroy()}l.ui.button=new b({value:"",className:"my-button"}).inject(k.parentNode);if(l.ui.tooltip){l.ui.tooltip.destroy()}l.ui.tooltip=new d({position:"top",target:l.ui.button.getContent(),body:l._getTooltipBody()});return l.ui.div},getPosition:function(){return this.ui.positions.inst},getConnectorPosition:function(i){return this.ui.positions[i]},setPosition:function(l,k){var j=this.parent.getModel();var i=[];i.push(parseInt(l[0]));i.push(parseInt(l[1]));this.ui.positions.inst=i;if(k===true){return}if(this.getParent().getLayout().file){this.getParent().getLayout().manageComponents(this,false)}},setConnectorPosition:function(n,p,l,o){var k=this.parent.getModel();var i=[];i.push(parseInt(p[0]));i.push(parseInt(p[1]));this.ui.positions[n]=i;if(o&&this.reference.getModel().getEditor()){var m=this.view;var j=m.children.first;while(j){if(j.data.name===n){break}j=j.next}if(j){j.multiset(["cstr","attach"],i[0],["cstr","offset"],i[1])}}if(l===true){return}if(this.getParent().getLayout().file){this.getParent().getLayout().manageConnectors(n,this.reference,false)}},registerLink:function(j,i){if(!this.connectors[i]){this.connectors[i]=[]}this.connectors[i].push(j)},unregisterLink:function(k,j){if(!this.connectors[j]){return}var i=this.connectors[j].indexOf(k);if(i===-1){return}else{this.connectors[j].splice(i,1)}if(this.connectors[j].length===0){delete this.connectors[j]}},getSelectedBehavior:function(){var k=this.reference.listBehaviors();var j=null;if(this.reference.model.experiment){var l=this.reference.model.experiment.listBehaviors();for(var i=0;i<k.length;i++){if(l[this.phID]&&l[this.phID].behavior===k[i].getID()){j=k[i];break}}}return j},_getTooltipBody:function(){var m=this;var k=m.getReference().listBehaviors().length;var j=m.getReference().model.getExperiment();var l=null;if(j){l=m.getSelectedBehavior()}var i=h.createElement("div");i.appendChild(h.createElement("span",{text:"Instance: "}));i.appendChild(h.createElement("strong",{text:m.name}));if(m.ui.div.querySelector(".node-title")){if(k===0){m.ui.div.querySelector(".node-title").style.background="#d1d4d4";m.ui.div.querySelector(".node-title").style.color="black"}else{if(k>=1){if(l){if(l.fmu){m.ui.div.querySelector(".node-title").style.background="#d5e8f2";m.ui.div.querySelector(".node-title").style.color="black";i.appendChild(h.createElement("br"));i.appendChild(h.createElement("span",{text:"Selected Abstraction: "}));i.appendChild(h.createElement("strong",{text:l.getInfo().name}));i.appendChild(h.createElement("span",{text:" (FMU)"}))}else{if(l.sim){m.ui.div.querySelector(".node-title").style.background="#368ec4";m.ui.div.querySelector(".node-title").style.color="white";i.appendChild(h.createElement("br"));i.appendChild(h.createElement("span",{text:"Selected Abstraction: "}));i.appendChild(h.createElement("strong",{text:l.getInfo().name}));i.appendChild(h.createElement("span",{text:" (SIM)"}))}}}else{m.ui.div.querySelector(".node-title").style.background="#d1d4d4";m.ui.div.querySelector(".node-title").style.color="black";i.appendChild(h.createElement("br"));i.appendChild(h.createElement("span",{text:"No Abstraction Selected"}))}}}}i.appendChild(h.createElement("br"));i.appendChild(h.createElement("span",{text:"# of Abstractions: "}));i.appendChild(h.createElement("strong",{text:k}));return i}});return c});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Layout",["UWA/Core","UWA/Class","DS/SMAMSExperimentServices/SMAMSExperimentServices","DS/SMAMSExperimentServices/Layout","DS/WAFData/WAFData","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","DS/RFLModelerWeb/RFL_Base"],function(h,e,c,b,a,d,g){var f=h.Class.extend({init:function(i){this.system=i;this.model=i.comp.getModel();this.phID=null;this.file=null},initializeLayout:function(n,j){var m=this;if(!m.phID){var k={};k.referencePhysicalId=m.system.getID();k.onComplete=function(o){m.model.addMessage("The layout has been created.","info","log");m.phID=o;var p="<RFLP><LogicalReference></LogicalReference><LogicalFlowReference></LogicalFlowReference><LogicalInstance></LogicalInstance><LogicalFlowExpositionInstance></LogicalFlowExpositionInstance><LogicalConnection></LogicalConnection></RFLP>";if(j&&j.layoutText){if(j.layoutText.substring(0,4)=="XML:"){p=j.layoutText.substring(4,j.layoutText.length)}else{if(j.layoutText.substring(0,5)=="TEXT:"){p=j.layoutText.substring(5,j.layoutText.length)}else{p=j.layoutText}}}m.file=h.Utils.loadXml(p);m.addRoot(m.system);n(j);m.saveLayout()};k.onFailure=function(q,p,s){var r=[q,p,s];var o=d.get("layout_create");if(o==="layout_create"){o="The layout could not be created."}m.model.addMessage(o,"error","notification",r)};b.create(k)}else{var i={};i.physicalId=m.phID;i.onComplete=function(o){m.model.addMessage("The layout has been downloaded.","success","log");m.file=h.Utils.loadXml(o);n(j)};i.onFailure=function(q,p,s){var r=[q,p,s];var o=d.get("layout_download");if(o==="layout_download"){o="The layout could not be downloaded."}m.model.addMessage(o,"error","notification",r)};if(j&&j.layoutText){var l=j.layoutText;if(j.layoutText.substring(0,4)=="XML:"){l=j.layoutText.substring(4,j.layoutText.length)}else{if(j.layoutText.substring(0,5)=="TEXT:"){l=j.layoutText.substring(5,j.layoutText.length)}}i.onComplete(l)}else{b.download(i)}}},saveLayout:function(){var m=this;var k=m.system;if(k){var l=new XMLSerializer().serializeToString(m.file);var i=new Blob([l],{type:"text/plain"});var j={};j.physicalId=m.phID;j.file=i;j.onComplete=function(){m.model.addMessage("The layout has been updated.","info","log")};j.onFailure=function(p,o,r){var q=[p,o,r];var n=d.get("layout_update");if(n==="layout_update"){n="The layout could not be updated."}m.model.addMessage(n,"error","notification",q)};b.change(j)}},addRoot:function(r){var m=this;var q=m.file.getElementsByTagName("LogicalReference")[0].getElementsByTagName("ID");var n=false;for(var k=0;k<q.length;k++){if(q[k].getAttribute("IDPhys")===r.phID){n=true;q[k].getElementsByTagName("BoundingBox")[0].setAttribute("XMin","0");q[k].getElementsByTagName("BoundingBox")[0].setAttribute("XMax",this.model.getEditor().getSize().width);q[k].getElementsByTagName("BoundingBox")[0].setAttribute("YMin","0");q[k].getElementsByTagName("BoundingBox")[0].setAttribute("YMax",this.model.getEditor().getSize().height);break}}if(!n){var o=m.file.createElement("ID");o.setAttribute("Value",r.getID());o.setAttribute("IDPhys",r.getID());o.setAttribute("Type","RFLVPMLogicalReference");m.file.getElementsByTagName("LogicalReference")[0].appendChild(o);var l=m.file.createElement("Mandatory");o.appendChild(l);var p=m.file.createElement("PLM_ExternalID");p.setAttribute("Type","String");l.appendChild(p);p.textContent=r.getInfo().name;var j=m.file.createElement("BoundingBox");j.setAttribute("XMin","0");j.setAttribute("XMax",this.model.getEditor().getSize().width);j.setAttribute("YMin","0");j.setAttribute("YMax",this.model.getEditor().getSize().height);l.appendChild(j)}},manageComponents:function(r,M){var L=this;var p=L.file.getElementsByTagName("LogicalReference")[0].getElementsByTagName("ID");var K=L.file.getElementsByTagName("LogicalInstance")[0].getElementsByTagName("ID");if(M){var A=L.file.getElementsByTagName("LogicalFlowExpositionInstance")[0].getElementsByTagName("ID");for(var I=0;I<K.length;I++){if(K[I].getAttribute("IDPhys")===r.phID){K[I].parentNode.removeChild(K[I])}}for(var E=0;E<A.length;E++){var v=A[E].getElementsByTagName("PositionSize");for(var D=0;D<v.length;D++){if(v[D].getAttribute("InstanceID")===r.phID){v[D].parentNode.removeChild(v[D])}}}if(r.reference.instances.length===1){for(var F=0;F<p.length;F++){if(p[F].getAttribute("IDPhys")===r.reference.phID){p[F].parentNode.removeChild(p[F]);for(var N in r.reference.connectors){var s=r.reference.getConnector(N).phID;for(var B=0;B<A.length;B++){if(A[B].getAttribute("IDPhys")===s){A[B].parentNode.removeChild(A[B])}}}}}}return}var J=false,x=false;for(var C=0;C<p.length;C++){if(p[C].getAttribute("IDPhys")===r.reference.phID){J=true;p[C].getElementsByTagName("BoundingBox")[0].setAttribute("XMin",r.ui.positions.inst[0]);p[C].getElementsByTagName("BoundingBox")[0].setAttribute("XMax",r.ui.positions.inst[0]+r.view.actualWidth);p[C].getElementsByTagName("BoundingBox")[0].setAttribute("YMin",r.ui.positions.inst[1]);p[C].getElementsByTagName("BoundingBox")[0].setAttribute("YMax",r.ui.positions.inst[1]+r.view.actualHeight);break}}for(var o=0;o<K.length;o++){if(K[o].getAttribute("IDPhys")===r.phID){x=true;K[o].getElementsByTagName("BoundingBox")[0].setAttribute("XMin",r.ui.positions.inst[0]);K[o].getElementsByTagName("BoundingBox")[0].setAttribute("XMax",r.ui.positions.inst[0]+r.view.actualWidth);K[o].getElementsByTagName("BoundingBox")[0].setAttribute("YMin",r.ui.positions.inst[1]);K[o].getElementsByTagName("BoundingBox")[0].setAttribute("YMax",r.ui.positions.inst[1]+r.view.actualHeight);break}}if(!J){var q=L.file.createElement("ID");q.setAttribute("Value",r.reference.phID);q.setAttribute("IDPhys",r.reference.phID);q.setAttribute("Type","RFLVPMLogicalReference");L.file.getElementsByTagName("LogicalReference")[0].appendChild(q);var w=L.file.createElement("Mandatory");q.appendChild(w);var y=L.file.createElement("PLM_ExternalID");y.setAttribute("Type","String");w.appendChild(y);y.textContent=r.reference.name;var u=L.file.createElement("BoundingBox");u.setAttribute("XMin",r.ui.positions.inst[0]);u.setAttribute("XMax",r.ui.positions.inst[0]+r.ui.shape.w);u.setAttribute("YMin",r.ui.positions.inst[1]);u.setAttribute("YMax",r.ui.positions.inst[1]+r.ui.shape.h);w.appendChild(u)}if(!x){var n=L.file.createElement("ID");n.setAttribute("Value",r.phID);n.setAttribute("IDPhys",r.phID);n.setAttribute("Type","RFLVPMLogicalInstance");L.file.getElementsByTagName("LogicalInstance")[0].appendChild(n);var z=L.file.createElement("Mandatory");n.appendChild(z);var H=L.file.createElement("PLM_ExternalID");H.setAttribute("Type","String");z.appendChild(H);H.textContent=r.name;var G=L.file.createElement("Relation");G.setAttribute("OwnerReference",r.parent.phID);G.setAttribute("Reference",r.reference.phID);z.appendChild(G);var t=L.file.createElement("BoundingBox");t.setAttribute("XMin",r.ui.positions.inst[0]);t.setAttribute("XMax",r.ui.positions.inst[0]+r.ui.shape.w);t.setAttribute("YMin",r.ui.positions.inst[1]);t.setAttribute("YMax",r.ui.positions.inst[1]+r.ui.shape.h);z.appendChild(t)}L.saveLayout()},manageConnectors:function(H,l,G,s){var I=this;if(!s){s=l.getConnector(H)}var J=I.file.getElementsByTagName("LogicalFlowReference")[0];var m=I.file.getElementsByTagName("LogicalFlowExpositionInstance")[0];var aa=J.getElementsByTagName("PLM_ExternalID");var x=m.getElementsByTagName("ID");var t=false,F=false;var U=null;var p=g.ComponentShape;for(var T=0;T<aa.length;T++){if(aa[T].textContent===s.type){t=true;U=aa[T].parentNode.getAttribute("IDPhys");break}}for(var S=0;S<x.length;S++){if(x[S].getAttribute("IDPhys")===s.phID){F=true;if(G){x[S].parentNode.removeChild(x[S]);return}for(var K=1;K<x[S].getElementsByTagName("PositionSize").length;K++){x[S].getElementsByTagName("PositionSize")[K].parentNode.removeChild(x[S].getElementsByTagName("PositionSize")[K])}var B;for(var V=0;V<l.instances.length;V++){if(!l.instances[V].getConnectorPosition(H)){continue}B=I.file.createElement("PositionSize");B.setAttribute("InstanceID",l.instances[V].phID);var w=l.instances[V].getConnectorPosition(H)[0];var M=l.instances[V].getConnectorPosition(H)[1];var O=0,E=0;if(w===0){E=0;O=M/p.w}else{if(w===1){E=1;O=M/p.w}else{if(w===2){O=0;E=M/p.h}else{if(w===3){O=1;E=M/p.h}}}}B.setAttribute("X",O);B.setAttribute("Y",E);B.setAttribute("Size","4");x[S].getElementsByTagName("Mandatory")[0].appendChild(B)}break}}if(!F){var P=I.file.createElement("ID");P.setAttribute("Value",s.phID);P.setAttribute("IDPhys",s.phID);P.setAttribute("Type","RFLVPMSystemTypeExpositionInstance");m.appendChild(P);var y=I.file.createElement("Mandatory");P.appendChild(y);var L=I.file.createElement("PLM_ExternalID");L.setAttribute("Type","String");y.appendChild(L);L.textContent=s.name;var u=I.file.createElement("V_Identifier");u.setAttribute("Type","String");y.appendChild(u);u.textContent=s.name;var R=I.file.createElement("V_Direction");R.setAttribute("Type","V_LPPortDirectionEnum");var W=null;if(s.causality==="I"){W="In"}else{if(s.causality==="O"){W="Out"}else{if(s.causality==="N"){W="InOut"}}}R.textContent=W;var z=I.file.createElement("Relation");z.setAttribute("OwnerReference",l.phID);z.setAttribute("Reference",U);y.appendChild(z);var C=I.file.createElement("PositionSize");var o=0,n=0;if(s.position.attach===0){n=0;o=s.position.offset/p.w}else{if(s.position.attach===1){n=1;o=s.position.offset/p.w}else{if(s.position.attach===2){o=0;n=s.position.offset/p.h}else{if(s.position.attach===3){o=1;n=s.position.offset/p.h}}}}C.setAttribute("X",o);C.setAttribute("Y",n);C.setAttribute("Size","");y.appendChild(C);var A;for(var Q=0;Q<l.instances.length;Q++){if(!l.instances[Q].getConnectorPosition(H)){continue}A=I.file.createElement("PositionSize");A.setAttribute("InstanceID",l.instances[Q].phID);var v=l.instances[Q].getConnectorPosition(H)[0];var r=l.instances[Q].getConnectorPosition(H)[1];var N=0,D=0;if(v===0){D=0;N=r/p.w}else{if(v===1){D=1;N=r/p.w}else{if(v===2){N=0;D=r/p.h}else{if(v===3){N=1;D=r/p.h}}}}A.setAttribute("X",N);A.setAttribute("Y",D);A.setAttribute("Size","4");y.appendChild(A)}}if(!t){var k=I.file.createElement("ID");k.setAttribute("Type","RFLVPMSystemTypeReference");J.appendChild(k);var q=I.file.createElement("Mandatory");k.appendChild(q);var Z=I.file.createElement("PLM_ExternalID");Z.setAttribute("Type","String");q.appendChild(Z);Z.textContent=s.type;if(I.model.typeRefs&&I.model.typeRefs[s.type]){k.setAttribute("Value",I.model.typeRefs[s.type][0]);k.setAttribute("IDPhys",I.model.typeRefs[s.type][0]);Object.keys(l.connectors).forEach(function(j){var i=l.getConnector(j);for(var X=0;X<x.length;X++){if(x[X].getAttribute("IDPhys")===i.phID&&i.type===s.type){x[X].getElementsByTagName("Relation")[0].setAttribute("Reference",I.model.typeRefs[i.type][0])}}})}}I.saveLayout()},manageLinks:function(r,F,x){var E=this;var l=E.file.getElementsByTagName("LogicalConnection")[0];var y=l.getElementsByTagName("ID");var D=false;for(var C=0;C<y.length;C++){if(y[C].getAttribute("IDPhys")===r.phID){D=true;if(x){var B=y[C].getElementsByTagName("Mandatory")[0];var w=B.getElementsByTagName("Handlers")[0];w.setAttribute("Values",x)}var k=y[C].getElementsByTagName("Mandatory")[0].getElementsByTagName("Handlers")[0].getAttribute("Values");if(r.view){if(k&&r.view.views.main.display.elt&&r.view.views.main.display.elt.parentNode.querySelector("circle")){var z=y[C].getElementsByTagName("Mandatory")[0].getElementsByTagName("Handlers")[0].getAttribute("Values").split(";");r.view.views.main.handlers=[];for(var A=0;A<(z.length-1);A++){r.view.views.main.handlers.push([parseFloat(z[A].split(",")[0].replace(/\s/g,"")),parseFloat(z[A].split(",")[1].replace(/\s/g,""))])}r.view.geometry.onupdate(r.view)}}if(F){y[C].parentNode.removeChild(y[C]);return}break}}if(!D){var m=E.file.createElement("ID");m.setAttribute("Value",r.phID);m.setAttribute("IDPhys",r.phID);m.setAttribute("Type","RFLVPMLogicalConnection");l.appendChild(m);var s=E.file.createElement("Mandatory");m.appendChild(s);var t=E.file.createElement("PLM_ExternalID");t.setAttribute("Type","String");s.appendChild(t);t.textContent=r.phID;var q=E.file.createElement("Connection_context");q.setAttribute("FirstConnectable",r.comp1.phID);q.setAttribute("SecondConnectable",r.comp2.phID);s.appendChild(q);var p=E.file.createElement("Connection");var v=null,u=null,G=null;for(G in r.comp1.reference.connectors){if(G===r.con1){v=r.comp1.reference.connectors[G].phID}}for(G in r.comp2.reference.connectors){if(G===r.con2){u=r.comp2.reference.connectors[G].phID}}p.setAttribute("FirstConnectorPath",v);p.setAttribute("SecondConnectorPath",u);s.appendChild(p);var o=E.file.createElement("Handlers");o.setAttribute("Numbers","");o.setAttribute("IsStraight","");o.setAttribute("Values","");s.appendChild(o);if(x){var n=E.file.createElement("Interaction");n.setAttribute("type",x);s.appendChild(n)}}E.saveLayout()}});return f});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_System",["UWA/Core","DS/RFLModelerWeb/RFL_Link","DS/egraph/core","DS/SMAMSExperimentServices/Instance","DS/SMAMSExperimentServices/Link","DS/SMAMSExperimentServices/Reference","DS/SMAMSWeb/SMAMSGenerateConfigFile","DS/RFLModelerWeb/RFL_Layout","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages"],function(f,d,e,g,c,h,j,a,i){var b=f.Class.extend({init:function(k){this.comp=k;this._instances=[];this._links=[];this._layout=new a(this)},getComponentView:function(){return this.comp},getInfo:function(){return this.comp.getInfo()},setInfo:function(k){return this.comp.setInfo(k,function(){},function(){})},getID:function(){return this.comp.getID()},getModel:function(){return this.comp.getModel()},getLayout:function(){return this._layout},initialize:function(k,l){var n=this;var m=function(A){var G=A.subComponents?A.subComponents.length:0;if(G===0){l();return}var r=n.comp.getModel().getEditor();if(r&&r.gr){r.gr.updateLock()}for(var z=0;z<A.subComponents.length;z++){var H=A.subComponents[z].title;var v={};v.inst=[100,100,110,86];var x=A.subComponents[z].physicalId;var s=A.subComponents[z].component.physicalId;var o=A.subComponents[z].description;var F=n._layout.file.getElementsByTagName("LogicalInstance")[0].getElementsByTagName("ID");for(var D=0;D<F.length;D++){if(F[D].getAttribute("IDPhys")===x){v.inst[0]=F[D].getElementsByTagName("BoundingBox")[0].getAttribute("XMin");v.inst[1]=F[D].getElementsByTagName("BoundingBox")[0].getAttribute("YMin");v.inst[2]=F[D].getElementsByTagName("BoundingBox")[0].getAttribute("XMax")-F[D].getElementsByTagName("BoundingBox")[0].getAttribute("XMin");v.inst[3]=F[D].getElementsByTagName("BoundingBox")[0].getAttribute("YMax")-F[D].getElementsByTagName("BoundingBox")[0].getAttribute("YMin")}}var y=n._layout.file.getElementsByTagName("LogicalFlowExpositionInstance")[0].getElementsByTagName("ID");for(var C=0;C<y.length;C++){if(y[C].getElementsByTagName("Relation")[0].getAttribute("OwnerReference")===s){var w=y[C].getElementsByTagName("PLM_ExternalID")[0].textContent;var u=y[C].getElementsByTagName("PositionSize");for(var B=0;B<u.length;B++){if(u[B].getAttribute("InstanceID")===x){var q=parseFloat(u[B].getAttribute("X"));var p=parseFloat(u[B].getAttribute("Y"));var t,E;if(q===parseInt(q,10)){t=p*v.inst[3];if(q===0){E=2}else{E=3}}else{t=q*v.inst[2];if(p===0){E=0}else{E=1}}v[w]={};v[w].attach=E;v[w].offset=t}}}}A.subComponents[z].component.type="DS/RFLModelerWeb/RFL_Component";n.comp.getModel().createComponent(A.subComponents[z].component,(function(J,I,M,K,L){return function(O){var N=O.getID();L.component.physicalId=N;n.addInstance1(J.inst[0],J.inst[1],J.inst[2],J.inst[3],M,I,N,(function(aa,V){aa.physicalId=V.getID();V.description=K;var U=V.getReference();G--;var S=U.getListConnectors();for(var Y in S){if(J[Y]){V.setConnectorPosition(Y,[J[Y].attach,J[Y].offset],true,true)}}if(G===0){var T=A.links?A.links.length:0;for(var W=0;W<T;W++){var R=n.getInstance(A.links[W].fromPath[0]);var ac=n.getInstance(A.links[W].toPath[0]);if(!R||!ac){continue}var Z=R.getReference().getConnectorNameFromID(A.links[W].fromTarget);var X=ac.getReference().getConnectorNameFromID(A.links[W].toTarget);if(!Z||!X){continue}var Q=A.links[W].title;var P=A.links[W].physicalId;var ab={};ab.comp1=R;ab.comp2=ac;ab.con1=Z;ab.con2=X;ab.view=null;ab.phID=P;ab.name=Q;n.addLink1(ab,(function(ad,ae){ad.physicalId=ae.getID()}).bind(this,A.links[W]),function(){})}if(WUX.AFR.CommandsManager.getCommand("SMAMultiScaleReframCmdHdr")){WUX.AFR.CommandsManager.getCommand("SMAMultiScaleReframCmdHdr").begin()}if(l){l()}}}).bind(this,L),function(){})}})(v,x,H,o,A.subComponents[z]),function(){})}if(r&&r.gr){r.gr.updateUnlock()}};this._layout.phID=k.layout;this._layout.initializeLayout(m,k)},addInstance1:function(z,v,A,o,l,p,s,t,m){var r=this;var n=r.getModel();var k=n.getExperiment();var u="DS/RFLModelerWeb/RFL_ComponentInstance";var q=function(C,H){if(C===-1){var F=r._instances.indexOf(H);if(F<0){var G=i.get("inst_not_found");if(G==="inst_not_found"){G="The instance could not be found."}n.addMessage(G,"error","notification")}else{var B=r._instances[F].getReference().instances.indexOf(H);r._instances[F].reference.instances.splice(B,1);r._instances.splice(F,1)}if(n.editor){n.editor.removeNode(H)}m()}else{if(C===-2){m()}else{var E=n.getComponent(s);var x=E.listBehaviors();for(var D=0;D<x.length;D++){x[D].instanceAdded(H,function(){},function(){})}if(C===0){if(k){var y=new j("config",n);var w=y.execute();k.setConfig(w)}H.setPosition([z,v],false);H.setShape(A,o)}else{H.setPosition([z,v],true);H.setShape(A,o)}t(H)}}};if(!s||typeof z===undefined||typeof v===undefined||!l){q(-2);return}require([u],function(w){var x=n.getComponent(s);var B=new w(l,p,r,x);r._instances.push(B);if(n.editor){n.editor.addNode(v,z,B,A,o)}if(!p){var y={};y.title=l;y.description=" ";y.rootReferencePhysicalId=r.getID();y.referencePhysicalId=s;y.onComplete=function(C){n.addMessage("The instance has been created.","info","log");B.setID(C);q(0,B)};y.onFailure=function(E,D,G){var F=[E,D,G];var C=i.get("inst_create");if(C==="inst_create"){C="The instance could not be created."}n.addMessage(C,"error","notification",F);B.cancelID();q(-1,B)};g.create(y)}else{q(1,B)}})},removeInstance1:function(n,s,r,F){var A=this;var o=A.getModel();var p=o.getEditor();var t=o.getExperiment();var l=[];for(var I in n.connectors){if(n.connectors.hasOwnProperty(I)){var w=n.connectors[I];for(var C=0;C<w.length;C++){l.push(w[C])}}}var k=l.length;var v=n.getPosition()[0];var u=n.getPosition()[1];var E=n.getReference();var G=n;var H=function(x){if(x===-1){G.reference.instances.push(G);A._instances.push(G);if(o.editor){o.editor.addNode(u,v,G,110,86)}F()}else{if(s){o.removeComponent(E,function(){},function(){})}if(t){var y=new j("config",o);var J=y.execute();t.setConfig(J)}if(o.getRoot().getLayout().file){A._layout.manageComponents(G,true)}r()}};var B=function(){if(o.editor){o.editor.removeNode(n)}var J=A._instances.indexOf(n);if(J<0){var y=i.get("inst_not_found");if(y==="inst_not_found"){y="The instance could not be found."}o.addMessage(y,"error","notification")}else{var x=A._instances[J].getReference().instances.indexOf(n);A._instances[J].reference.instances.splice(x,1);A._instances.splice(J,1)}};var m=0;var z=function(){m++;if(m===k){var x=function(J){var y={};y.physicalId=J;y.onComplete=function(){o.addMessage("The instance has been removed.","info","log");H(0)};y.onFailure=function(M,L,O){var N=[M,L,O];var K=i.get("inst_remove");if(K==="inst_remove"){K="The server could not remove the instance."}o.addMessage(K,"error","notification",N);H(-1)};g.remove(y)};n.getID(x,function(){H(-1)})}};var D=function(){exitRemoveConnector(-1)};if(k===0){k++;B();z()}else{for(var C=0;C<l.length;C++){var q=l[C];if(q){A.removeLink(q,z,D)}}B()}},listInstances:function(){return this._instances},getInstance:function(l){for(var k=0;k<this._instances.length;k++){if(this._instances[k].getID()===l){return this._instances[k]}}},addLink1:function(E,p,D){var y=this;var m=y.getModel();var n=m.getEditor();var r=m.getExperiment();var B=function(M,Q){if(M===0){if(r){var K=new j("config",m);var J=K.execute();r.setConfig(J)}if(y._layout.file){y._layout.manageLinks(q,false)}p(Q)}else{if(M===-1){y._links.splice(y._links.indexOf(Q));var T=y.getInstance(Q.comp1.phID);var S=y.getInstance(Q.comp2.phID);T.unregisterLink(Q,Q.con1);S.unregisterLink(Q,Q.con2);if(n){n.removeEdge(Q)}D()}else{if(M===-2){D()}else{if(M===1){var O=y._layout;var P=O.file.getElementsByTagName("LogicalConnection")[0];var H=P.getElementsByTagName("ID");for(var N=0;N<H.length;N++){if(H[N].getAttribute("IDPhys")===q.phID){var I=H[N].getElementsByTagName("Mandatory")[0].getElementsByTagName("Handlers")[0].getAttribute("Values");if(q.view){if(I&&q.view.views.main.display.elt&&q.view.views.main.display.elt.parentNode.querySelector("circle")){var R=H[N].getElementsByTagName("Mandatory")[0].getElementsByTagName("Handlers")[0].getAttribute("Values").split(";");q.view.views.main.handlers=[];for(var L=0;L<(R.length-1);L++){q.view.views.main.handlers.push([parseFloat(R[L].split(",")[0].replace(/\s/g,"")),parseFloat(R[L].split(",")[1].replace(/\s/g,""))])}q.view.geometry.onupdate(q.view)}}}}p(Q)}}}}};var x=E.comp1.connectors[E.con1];var w=E.comp2.connectors[E.con2];if(x&&w&&x.length&&w.length){for(var A=0;A<x.length;A++){for(var z=0;z<w.length;z++){if(x[A]===w[z]){B(-2);break}}}}var l={};l.comp1=E.comp1;l.comp2=E.comp2;l.con1=E.con1;l.con2=E.con2;l.view=E.view;l.phID=E.phID;l.name=E.name;var q=new d(l);y._links.push(q);var v=y.getInstance(q.comp1.phID);var u=y.getInstance(q.comp2.phID);v.registerLink(q,q.con1);u.registerLink(q,q.con2);if(n){n.addEdge(q)}if(!q.phID){var G=q.comp1;var F=q.comp2;var t=q.comp1.getReference().getConnector(q.con1);var s=q.comp2.getReference().getConnector(q.con2);var C=q.name;var k=[];var o=function(K){if(K){k.push(K)}if(k.length===2){var H=i.get("link_add_spinner");if(H==="link_add_spinner"){H="Adding Connection..."}var J={message:H,exclusive:false};n.addSystemSpinner(J);var I={};I.title=C;I.description=q.description;I.rootReferencePhysicalId=y.getID();I.componentInstanceFromPhysicalId=G.getID();I.connectorFromPhysicalId=t.getID();I.componentInstanceToPhysicalId=F.getID();I.connectorToPhysicalId=s.getID();I.onComplete=function(L){m.addMessage("The connection has been created.","info","log");m.editor.removeSystemSpinner(J);q.setID(L);B(0,q)};I.onFailure=function(N,M,P){var O=[N,M,P];var L=i.get("link_create");if(L==="link_create"){L="The connection could not be created."}m.addMessage(L,"error","notification",O);m.editor.removeSystemSpinner(J);q.cancelID();B(-1,q)};c.create(I)}};t.getID.call(t,o,function(){B(-1,q)});s.getID.call(s,o,function(){B(-1,q)})}else{B(1,q)}},removeLink:function(s,q,m){var o=this;var n=o.getModel();var p=n.getEditor();var k=n.getExperiment();var l=function(v){if(v===0){if(k){var w=new j("config",n);var B=w.execute();k.setConfig(B)}if(o._layout.file){o._layout.manageLinks(s,true)}var x=false;if(s.comp1.reference.getConnector(s.con1)&&s.comp1.reference.getConnector(s.con1).type==="Region"){x=true}if(k&&k.process&&x){k.removeInteraction1(s,function(){},function(){})}q()}else{if(v===-1){var y=s;o._links.push(y);var A=o.getInstance(y.comp1.phID);var z=o.getInstance(y.comp2.phID);A.registerLink(y,y.con1);z.registerLink(y,y.con2);if(p){p.addEdge(y)}m()}}};if(p){p.removeEdge(s)}o._links.splice(o._links.indexOf(s));var u=o.getInstance(s.comp1.getID());var r=o.getInstance(s.comp2.getID());u.unregisterLink(s,s.con1);r.unregisterLink(s,s.con2);var t=function(x){var v=i.get("link_rem_spinner");if(v==="link_rem_spinner"){v="Removing Connection..."}var y={message:v,exclusive:false};p.addSystemSpinner(y);var w={};w.physicalId=x;w.onComplete=function(){n.addMessage("The connection has been removed.","info","log");n.editor.removeSystemSpinner(y);l(0)};w.onFailure=function(B,A,D){var C=[B,A,D];var z=i.get("link_remove");if(z==="link_remove"){z="The connection could not be removed."}n.addMessage(z,"error","notification",C);p.removeSystemSpinner(y);l(-1)};c.remove(w)};s.getID(t,function(){l(-1)})},listLinks:function(){return this._links},getLink:function(l){for(var k=0;k<this._links.length;k++){if(this._links[k].getID()==l){return this._links[k];break}}}});return b});
/*! Copyright 2015 Dassault Systemes */
define("DS/RFLModelerWeb/RFL_Model",["UWA/Core","DS/RFLModelerWeb/RFL_System","DS/SMAMSExperimentServices/Reference","DS/Core/Core","DS/RFLModelerWeb/RFL_Layout","i18n!DS/SMAMSWebUI/assets/nls/SMAMSMessages","module","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils"],function(d,e,f,h,i,j,a,b,c){var g=d.Class.extend({init:function(){this.root=null;this.experiment=null;this.editor=null;this.components=[];this.systems=[];this.typeRefs={}},addToEditor:function(k){this.editor=k;k.model=this},getEditor:function(){return this.editor},getRoot:function(){return this.root},getExperiment:function(){return this.experiment},addExperiment:function(k){this.experiment=k},createComponent:function(o,r,l){var q=this;var k=this.editor;var n={message:" ",exclusive:false};if(k){k.addSystemSpinner(n)}var p=null;var m=function(t,w){if(k){k.removeSystemSpinner(n)}if(t===0){r(p)}else{if(t===-1){var u=j.get("comp_create");if(u==="comp_create"){u="The component could not be created."}q.addMessage(u,"error","notification");l(w)}else{if(t===-2){var v=j.get("comp_create");if(v==="comp_create"){v="The component could not be created."}q.addMessage(v,"error","notification");q.components.splice(q.components.indexOf(p),1);l(w)}}}};var s=function(t){p.initialize(t,function(){m(0)},function(){m(-1)})};require([o.type],function(w){for(var t=0;t<q.components.length;t++){if(typeof(o.physicalId)!==undefined&&o.physicalId&&q.components[t].getID()===o.physicalId){p=q.components[t];m(0);return}}p=new w(o.title,o.physicalId,q,o);q.components.push(p);if(!o.physicalId){var u={};u.title=o.title;u.description=" ";var v=o;u.onComplete=function(x){v.physicalId=x;p.commit(x);s.call(q,v)};u.onFailure=function(x){m(-2,x)};f.create(u)}else{m(0)}})},removeComponent:function(p,t,m){var r=-1;var q=this;var k=this.editor;var s=j.get("comp_rem_spinner");if(s==="comp_rem_spinner"){s="Removing Component..."}var o={message:s,exclusive:false};if(k){k.addSystemSpinner(o)}var l=function(v){if(k){k.removeSystemSpinner(o)}if(v===0){q.addMessage("The reference has been removed.","info","log");t()}else{if(v===-1){q.addMessage("The reference could not be removed.","info","log");m()}else{if(v===-2){q.addMessage("The reference could not be removed.","info","log");q.components.push(p);m()}}}};for(var u=0;u<q.components.length;u++){if(q.components[u].getID()===p.getID()){r=u;break}}if(r===-1){q.addMessage("Component "+p.getInfo().name+" not found","error","log");l(-1);return}else{q.components.splice(r,1)}var n={};n.physicalId=p.getID();n.onComplete=function(){q.addMessage("The reference has been removed.","info","log");q.components.splice(r,1);l(0)};n.onFailure=function(x,w,z){var y=[x,w,z];var v=j.get("comp_remove");if(v==="comp_remove"){v="The component could not be removed."}q.addMessage(v,"error","notification",y);l(-2)};f.remove(n)},getComponent:function(l){var m=this.components;for(var k=0;k<m.length;k++){if(m[k].getID()===l){return m[k]}}},listComponents:function(){return this.components},createSystem:function(k,o,n,m){var l=new e(k,o);var p=this;p.getTypes(function(){l.initialize(o,function(){p.systems.push(l);n(l)},function(q){m(q)})})},setRoot:function(k){if(this.root){return}this.root=k;if(this.editor){this.editor.removeIntroText();this.editor.removeRecentExp();this.editor.root=k}},closeModel:function(){var k=this.experiment;if(k&&k.services!==null&&k.services!==undefined){k.services.stopAllServices()}if(k&&k.monitoring.interval){clearInterval(k.monitoring.interval)}this.root=null;this.experiment=null;this.components=[];this.systems=[];if(this.editor){this.editor.clear()}},localSave:function(p,t){var s=this.root;var r=this.experiment;var z={};z.System={};z.Experiment={};if(t==true){z.Resources=[]}var v=1;var A=[];var k=function(){p(z);return};if(s){z.System.title=s.getInfo().name;z.System.description=s.getInfo().description;z.System.physicalId=s.getID();z.System.type="DS/RFLModelerWeb/RFL_Component";z.System.layout=s.getLayout().phID;z.System.layoutText=new XMLSerializer().serializeToString(s.getLayout().file);z.System.links=[];var l=s.listLinks();for(var x=0;x<l.length;x++){var q={};q.title=l[x].getInfo().name;q.description=l[x].getInfo().description;q.physicalId=l[x].getID();q.fromPath=[l[x].comp1.getID()];q.fromTarget=l[x].comp1.getReference().getConnector(l[x].con1).getID();q.fromTargetName=l[x].con1;q.toPath=[l[x].comp2.getID()];q.toTarget=l[x].comp2.getReference().getConnector(l[x].con2).getID();q.toTargetName=l[x].con2;z.System.links.push(q)}z.System.subComponents=[];var y=s.listInstances();for(x=0;x<y.length;x++){var u={};u.title=y[x].getInfo().name;u.physicalId=y[x].getID();u.description=y[x].getInfo().description;u.component={};u.component.title=y[x].getReference().getInfo().name;u.component.description=y[x].getReference().getInfo().description;u.component.physicalId=y[x].getReference().getID();u.component.connectors=[];var m=y[x].getReference().getListConnectors();for(var C in m){if(!m[C].phID){continue}var o={};o.title=m[C].getInfo().name;o.description=m[C].getInfo().description;o.physicalId=m[C].getID();o.type=m[C].getType();var B=(m[C].causality==="I")?"In":"Out";if(m[C].causality==="N"){B="InOut"}o.direction=B;u.component.connectors.push(o)}u.component.behaviors=[];for(var n=0;n<y[x].getReference().listBehaviors().length;n++){var w=y[x].getReference().listBehaviors()[n];v++;w.localSave((function(G,F,E,D){F.push(E);if(D&&G){G.push(D)}v--;if(v===0){k()}}).bind(this,z.Resources,u.component.behaviors),t)}u.component.type="DS/RFLModelerWeb/RFL_Component";z.System.subComponents.push(u)}}if(r){v++;r.localSave(function(D){z.Experiment=D;v--;if(v===0){k()}},t)}v--;if(v===0){k()}},addMessage:function(n,m,o){if(this._messagesLog){this._messagesLog.push({message:n,type:m,target:o,})}var l=b.getLogger(a);if(m==="error"){l.log("MS error : "+n)}else{if(m==="warning"){l.log("MS warning : "+n)}else{if(m==="info"){l.log("MS info : "+n)}else{if(m==="success"){l.log("MS success : "+n)}}}}if(this.editor){if(o==="notification"){var k=true;if(m==="error"){k=false}this.editor.addMessage({className:m,message:n},k)}}},getTypes:function(l){var k=this;require(["DS/SMAMSExperimentServices/Type"],function(n){var m={};m.types=["Real","Region","Integer","String","Boolean","Enumeration"];m.onComplete=function(o){k.typeRefs=o;l()};m.onFailure=function(){k.addMessage("The type references could not be retrieved.","info","log")};n.get(m)})},isValidFmu:function(l){var k=l.value;var m=this;return new d.Promise(function(p,o){var q=null;var n=function(C){var A=C.getElementsByTagName("fmiModelDescription");A=A?A[0]:null;if(!A||A.nodeName!=="fmiModelDescription"){o('The root element of the modelDescription.xml is NOT "fmiModelDescription". Invalid FMU.');return}var y=A.getElementsByTagName("CoSimulation");var w=A.getElementsByTagName("CoSimulation_StandAlone");var u=A.getElementsByTagName("CoSimulation_Tool");if(!(y.length||w.length||u.length)){if(localStorage.getItem("EC-AllowModelExchange")==="true"){var z=A.getElementsByTagName("ModelExchange");if(!z.length||z[0].getAttribute("modelIdentifier")!=="SMAApproxFMUForRSM"){o("The is neither a CoSimulation nor a RA ModelExchange FMU.");return}}else{o("The FMU is not of type CoSimulation, hence not supported.");return}}if(A.getElementsByTagName("ModelVariables").length!==1){o('The "ModelVariables" tag is absent in the modelDescription.xml. Invalid FMU.');return}var v=A.getElementsByTagName("ScalarVariable"),s=["Real","String","Boolean","Integer","Enumeration"];for(var B=0;B<v.length;B++){var x=0;for(var t=0;t<s.length;t++){var r=v[B].getElementsByTagName(s[t]);if(r.length===0){x++}if(x===5){o("There are no valid scalar variables in modelDescription.xml.Invalid FMU.");return}}}p(l)};require(["DS/ZipJS/zip-fs"],function(r){r.workerScriptsPath=c.getWebappsBaseUrl()+"ZipJS/";r.createReader(new r.BlobReader(k),function(s){s.getEntries(function(u){for(var t=0;t<u.length;t++){if(u[t].filename==="modelDescription.xml"||u[t].filename==="./modelDescription.xml"){q=u[t];break}}if(d.is(q)){q.getData(new r.TextWriter(),function(v){s.close();var w=d.Utils.loadXml(v.target.result);if(!d.is(w)){o("The modelDescription.xml file not found. Invalid FMU.")}else{n(w)}},function(){},function(){o("Error opening modelDescription.xml.")})}else{o("The modelDescription.xml file not found. Invalid FMU.")}})},function(){o("Error unzipping FMU.")})})})}});return g});