define("DS/DELMOMVQDTExperience/js/EventDispatcher",["require","exports"],function(b,a){var c=(function(){function d(){this._eventHandlers={}}d.prototype.addEventListener=function(e,f){this._eventHandlers[e]=this._eventHandlers[e]||[];this._eventHandlers[e].push(f)};d.prototype.fireEvent=function(f,e){var h=this._eventHandlers[f];if(h){for(var g=0;g<h.length;g++){h[g](e)}}};return d}());a.EventDispatcher=c});define("DS/DELMOMVQDTExperience/js/Desc2DNode",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/CSS2DNode","DS/WebSystem/DetectBrowser","DS/Mesh/Mesh"],function(c,a,h,i,g,b){function e(j){var k=document.createElement("div");k.id="defect"+j.id;k.appendChild(d(j));return k}function d(j){var l={overflow:"auto",padding:"1px",width:"auto","border-radius":"0 5px 5px 5px",textAlign:"left",backgroundColor:"rgba(241, 241, 241, 0.9)",border:"solid 2px rgba(209, 212, 212, 0.9)"};var n=new c.Element("div",{id:"desc"+j.id,styles:l});if(j.description.isVisible){n.style.display="block"}else{n.style.display="none"}var k=document.createElement("div");k.setAttribute("class","desc");k.style.cssFloat="right";k.style.display="inline";k.style.marginLeft="27px";var m=g();if(m.browser.mobile){k.style.marginLeft="52px"}if(j.description.text&&j.description.text.length>0){k.innerHTML=j.description.text}else{n.style.display="none"}n.appendChild(k);return n}var f=function(j){var l=e(j.annotation);var k=new i({html:l,name:"desc"+j.annotation.id});k.setAlwaysOnTopIndex(1);k.userData={defectNodeType:2,showDescription:function(){var m=document.getElementById(k.name);m.style.display="block"},hideDescription:function(){var m=document.getElementById(k.name);m.style.display="none"},update:function(m){var n=k.getElement();var o=n.getElementsByClassName("desc")[0];o.innerHTML=m.description.text;if(m.isVisible!==undefined){if(m.isVisible){if(m.description.isVisible){this.showDescription()}else{this.hideDescription()}}}else{this.hideDescription()}}};k.setVisibilityInTree(true);k.visible=true;k.setPickability(true);k.pickParent=false;k.setPickable(b.PICKABLE);k._excludeFromCSO=true;k._excludeFromHSO=true;return k};return f});define("DS/DELMOMVQDTExperience/js/DefectUtils",["UWA/Core","UWA/Class","DS/WebViewer/SceneGraphHelper","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/PathElement","DS/Selection/CSOManager","DS/Selection/HSOManager"],function(e,a,i,h,f,d,c,b){var g=a.extend({init:function(j){},getRootPaths:function(m){var j=m.getNodes();var l=[];var k=new d();j.forEach(function(n){var o=k.clone();o.addElement(n);l.push(o)});return l},removeSelectedNodes:function(){c.empty();b.empty()},getPathElementByNode:function(k,q){var l=this;var p=null;if(k!==null){if(k===q){p=new d([k]);return p}for(var o=0;o<k.children.length;++o){var r=k.children[o];if(r===q){p=new d([k]);p.addElement(r);return p}var n=l.getPathElementByNode(r,q);if(n!==null){p=new d([k]);for(var m=0;m<n.getLength();++m){p.addElement(n.getElement(m))}}}}return p},createIdFromPath:function(j){var m=j.pathElement;var l="";while(e.is(m)){var k=m.getLastElement(true);if(k.getPersistentId!==undefined){if(k.productType==="Instance3D"||k.getPersistentId()===1){if(l.length!==0){l="/"+l}l=k.getPersistentId()+l}}m=m.getParentOccurrencePath()}if(l===""){m=j.pathElement;while(e.is(m)){var k=m.getLastElement(true);if(k.getPersistentId!==undefined){if(k.productType==="ReferenceRep"||k.getPersistentId()===1){if(l.length!==0){l="/"+l}l=k.getPersistentId()+l}}m=m.getParentOccurrencePath()}}return l},getPathFromId:function(m,n){var k;var j=n.split("/");var l=function(p,o){if(p.length>0){p.forEach(function(t){var r=t.getLastElement();if(r.getPersistentId!==undefined){var s=r.getPersistentId();if(s===o[0]){o.splice(0,1);k=t}}var q=t.getChildrenOccurrencePathes();if(q!==undefined&&q!==null){l(q,o)}})}};l(m,j);return k},getRootDefectNode:function(m){var l=null;var k=0;var j=m.getBagNode();for(k=0;k<j.children.length;k++){if(j.children[k].name==="annotations"){return j.children[k]}}l=new f();l.name="annotations";j.addChild(l);return l},getPinNode:function(j){var l,k;for(l=0;l<j.children.length;l++){k=j.children[l].userData.defectNodeType;if(k===1){return j.children[l]}}return null},getSphereNode:function(j){var l,k;for(l=0;l<j.children.length;l++){k=j.children[l].userData.defectNodeType;if(k===4){return j.children[l].children[0]}}return null},updateColor:function(l,k,j){var m=new h.MeshPhongMaterial({color:new h.Color(k),transparent:false,opacity:1,specular:5393484,shininess:60,shading:h.SmoothShading,force:true});if(j){m.outlineColor=new h.Color().setRGB(0,1,1);m.intensity=0.5}l.setMaterial(m)},getDefectIndex:function(l,j){if(e.typeOf(j)===false){j=5}var m=null;if(l&&(l.pathElement!==undefined)){for(var k=0;k<l.pathElement.externalPath.length;k++){m=l.pathElement.externalPath[k];if(m.userData&&m.userData.defectNodeType===j){return k}}}else{return -2}return -1},setVisibility:function(o,j){var p=o._getViewer();var l=p.getBagNode();var n=this.getPathElementByNode(l,o);var m=p.createSceneGraph("VisibilitySG");var k=new i(m.SceneGraphOverrideSet,null);k.setVisibility(n,j)},setSelected:function(n,k){var j=n._getViewer().getBagNode();var m=this.getPathElementByNode(j,n);var l={pathElement:m};if(!k){b.empty();c.empty()}b.add(l);c.add(l)},setUnselected:function(m){var j=m._getViewer().getBagNode();var l=this.getPathElementByNode(j,m);var k={pathElement:l};var n=b.get();if(n.length>0){b.remove(k)}n=c.get();if(n.length>0){c.remove(k)}}});return new g()});define("DS/DELMOMVQDTExperience/DELMOMVQDTExperience",["DS/3DPlayExperienceModule/PlayExperience3D","UWA/Core"],function(a,b){return a.extend({init:function(c){this.play3DControl={};c.commandApplication=false;c.workbenchs=c.workbenchs||[];c.workbenchs.unshift({name:"VQDTShare",module:"DELMOMVQDTExperience"});this._parent(c)},onPreCreate:function(){this.args.visu={picking:false};if(this.args.options.enableSelection!==undefined&&this.args.options.enableSelection!==null){if(this.args.options.enableSelection===true||this.args.options.enableSelection==="true"){this.args.visu.picking=true;this.args.visu.displayPicking=true;this.args.visu.prePicking=true;this.args.visu.displayprePicking=true}}this.args.ui={displayTree:false}},onPostCreate:function(){var c=this.frmWindow.getViewer();c.setVisuEnv("None")},getPlay3DControl:function(){return this.play3DControl}})});define("DS/DELMOMVQDTExperience/js/Pin2DNode",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/CSS2DNode","DS/WebSystem/DetectBrowser","DS/Mesh/Mesh"],function(d,h,i,g,c){function b(j){var k=document.createElement("img");if(j.icon&&j.icon.length>0){k.src="../DELMOMVQDTExperience/assets/icons/DefectIndicators/"+j.icon}return k}function e(j){var k=document.createElement("div");k.id="pinDefect"+j.id;k.appendChild(f(j));return k}function f(j){var k={width:"32px",height:"32px","border-radius":"0 50% 50% 50%",position:"absolute",left:"50%",top:"50%",backgroundColor:"rgba(241, 241, 241, 0.9)",border:"solid 2px rgba(209, 212, 212, 0.9)"};var n=new d.Element("div",{id:"pin"+j.id,styles:k});var m=new g();if(m.browser.mobile){n.style.width="56px";n.style.height="56px"}var l=b(j);n.appendChild(l);return n}var a=function(j){var l=e(j.annotation);var k=new i({html:l,name:"pin"+j.annotation.id});if(j.annotation.description.isVisible){k.setAlwaysOnTopIndex(10)}else{k.setAlwaysOnTopIndex(0)}k.setVisibilityInTree(true);k.visible=true;k.setPickParent(true);k.setPickability(c.PICKABLE);k._excludeFromHSO=true;k.userData={defectNodeType:1,update:function(m,n){if(m.icon!==n.icon){n.icon=m.icon;var q=k.getElement();var o=q.getElementsByTagName("img")[0];o.src="../DELMOMVQDTExperience/assets/icons/DefectIndicators/"+m.icon}if(m.isSelected&&!m.description.isVisible){this.highlight(k)}else{this.unhighlight(k)}var p=document.getElementById(k.name);if(m.description.isVisible){k.setAlwaysOnTopIndex(10)}else{k.setAlwaysOnTopIndex(0)}},highlight:function(){var m=document.getElementById(k.name);if(m!==null){m.style.border="solid 2px rgba(0, 184, 222, 0.9)";m.style.backgroundColor="rgba(213, 232, 242, 0.9)"}},unhighlight:function(){var m=document.getElementById(k.name);if(m!==null){m.style.border="solid 2px rgba(209, 212, 212, 0.9)";m.style.backgroundColor="rgba(241, 241, 241, 0.9)"}},};return k};return a});define("DS/DELMOMVQDTExperience/Commands/CmdPlaceDefect",["DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Core/PointerEvents","DS/DELMOMVQDTExperience/js/DefectUtils"],function(b,d,c,a){var e=b.extend({init:function(f){this._parent(f,{isAsynchronous:true})},beginExecute:function(){var h=this;h.isMouseDown=false;h.isMouseDrag=false;var f=document.createEvent("CustomEvent");f.initCustomEvent("REPORTINGMODECHANGE",false,false,{ReportMode:"defect"});document.dispatchEvent(f);a.removeSelectedNodes();var g=this.getFrameWindow().experience;h.proxyEventTarget=g.frmWindow.getViewerFrame();h._webGLV6Viewer=g.frmWindow.getViewer();if(h._webGLV6Viewer.picking&&h._webGLV6Viewer.picking.activated===true){h._webGLV6Viewer.setPicking({activated:false},true);h.pickingOff=true}h.proxyEventTarget.addEvent(c.POINTERDOWN,function(i){if(i.button===0){h.isMouseDown=true}});h.proxyEventTarget.addEvent(c.POINTERMOVE,function(i){if(i.button===0&&h.isMouseDown){h.isMouseDrag=true}});h.proxyEventTarget.addEvent(c.POINTERUP,function(p){if(p.button===0&&h.isMouseDrag===false){var r=new d.Vector2(p.offsetX,p.offsetY);var t=h._webGLV6Viewer.getMousePosition(r);var s={ray:null};var n=h._webGLV6Viewer.computeIntersection(t,true,false,true,s);var v=h._webGLV6Viewer.pick(t,"mesh",true);if(v.path.length>0){var q={modelPartID:"",revision:"1",instancePath:"",};for(var o=v.path[0].externalPath.length-1;o>=0;o--){var m=v.path[0].externalPath[o];if(m.userData&&m.userData.defectNodeType){return}if((m.productType!==undefined)&&(m.productType==="Reference3D")){var u={};u.pathElement=v.path[0];q.modelPartID=m.name;q.instancePath=a.createIdFromPath(u);break}}var l={position:v.position,parentModelPart:q};var k={action:1,annotation:l};var j=document.createEvent("CustomEvent");j.initCustomEvent("CREATEDEFECT",false,false,{AnnotationChange:k});document.dispatchEvent(j)}}h.isMouseDrag=false;h.isMouseDown=false})},endExecute:function(){var f=document.createEvent("CustomEvent");f.initCustomEvent("REPORTINGMODECHANGE",false,false,{ReportMode:"none"});document.dispatchEvent(f);this.proxyEventTarget.removeEvent(c.POINTERUP);this.proxyEventTarget.removeEvent(c.POINTERMOVE);this.proxyEventTarget.removeEvent(c.POINTERDOWN);if(this.pickingOff){this._webGLV6Viewer.setPicking({activated:true},true)}}});return e});define("DS/DELMOMVQDTExperience/Commands/CmdMultiSelect",["DS/ApplicationFrame/Command","DS/DELMOMVQDTExperience/js/DefectUtils"],function(b,a){var c=b.extend({init:function(d){this._parent(d,{isAsynchronous:true,mode:"exclusive"})},beginExecute:function(){var f=this;var e=this.getFrameWindow().experience;f._webGLV6Viewer=e.frmWindow.getViewer();if(!f._webGLV6Viewer.forceMultiSel){f._webGLV6Viewer.forceMultiSel=true;a.removeSelectedNodes();var d=document.createEvent("CustomEvent");d.initCustomEvent("SELECTMODECHANGE",false,false,{SelectMode:"multi"});document.dispatchEvent(d)}},endExecute:function(){this._webGLV6Viewer.forceMultiSel=false;var d=document.createEvent("CustomEvent");d.initCustomEvent("SELECTMODECHANGE",false,false,{SelectMode:"single"});document.dispatchEvent(d)}});return c});define("DS/DELMOMVQDTExperience/Commands/CmdDeleteDefect",["DS/ApplicationFrame/Command","DS/Core/PointerEvents","DS/Selection/CSOManager","DS/DELMOMVQDTExperience/js/DefectUtils"],function(b,d,c,a){var e=b.extend({init:function(f){this._parent(f,{isAsynchronous:true})},beginExecute:function(){var n=this;var k=this.getFrameWindow().experience;n.proxyEventTarget=k.frmWindow.getViewerFrame();n._webGLV6Viewer=k.frmWindow.getViewer();var p=c.get();var f=[];var h=null;var g=k.getPlay3DControl();var l=0;for(var m=0;m<p.length;m++){var o=a.getDefectIndex(p[m],5);if(o>-1){h=p[m].pathElement.externalPath[o].userData.annotation;if(h.allowDelete===undefined||h.allowDelete===true){if(f.indexOf(h)===-1){f[l++]=h}}}}if(f.length>0){g.removeAnnotations(f,true)}this.disable()},endExecute:function(){this.proxyEventTarget.removeEvent(d.POINTERUP);this.proxyEventTarget.removeEvent(d.POINTERMOVE);this.proxyEventTarget.removeEvent(d.POINTERDOWN)}});return e});define("DS/DELMOMVQDTExperience/Commands/CmdAddAnnotation",["DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Core/PointerEvents","DS/DELMOMVQDTExperience/js/DefectUtils"],function(b,d,c,a){var e=b.extend({init:function(f){this._parent(f,{isAsynchronous:true,mode:"exclusive"})},beginExecute:function(){var h=this;h.isMouseDown=false;h.isMouseDrag=false;var f=document.createEvent("CustomEvent");f.initCustomEvent("REPORTINGMODECHANGE",false,false,{ReportMode:"annotation"});document.dispatchEvent(f);a.removeSelectedNodes();var g=this.getFrameWindow().experience;h.proxyEventTarget=g.frmWindow.getViewerFrame();h._webGLV6Viewer=g.frmWindow.getViewer();if(h._webGLV6Viewer.picking&&h._webGLV6Viewer.picking.activated===true){h._webGLV6Viewer.setPicking({activated:false},true);h.pickingOff=true}h.proxyEventTarget.addEvent(c.POINTERDOWN,function(i){if(i.button===0){h.isMouseDown=true}});h.proxyEventTarget.addEvent(c.POINTERMOVE,function(i){if(i.button===0&&h.isMouseDown){h.isMouseDrag=true}});h.proxyEventTarget.addEvent(c.POINTERUP,function(p){if(p.button===0&&h.isMouseDrag===false){var r=new d.Vector2(p.offsetX,p.offsetY);var t=h._webGLV6Viewer.getMousePosition(r);var s={ray:null};var n=h._webGLV6Viewer.computeIntersection(t,true,false,true,s);var v=h._webGLV6Viewer.pick(t,"mesh",true);if(v.path.length>0){var q={modelPartID:"",revision:"1",instancePath:"",};for(var o=v.path[0].externalPath.length-1;o>=0;o--){var m=v.path[0].externalPath[o];if(m.defectNodeType===0){return}if((m.productType!==undefined)&&(m.productType==="Reference3D")){var u={};u.pathElement=v.path[0];q.modelPartID=m.name;q.instancePath=a.createIdFromPath(u);break}}var l={position:v.position,parentModelPart:q};var k={action:1,annotation:l};var j=document.createEvent("CustomEvent");j.initCustomEvent("CREATEANNOTATION",false,false,{AnnotationChange:k});document.dispatchEvent(j)}}h.isMouseDrag=false;h.isMouseDown=false})},endExecute:function(){var f=document.createEvent("CustomEvent");f.initCustomEvent("REPORTINGMODECHANGE",false,false,{ReportMode:"none"});document.dispatchEvent(f);this.proxyEventTarget.removeEvent(c.POINTERUP);this.proxyEventTarget.removeEvent(c.POINTERMOVE);this.proxyEventTarget.removeEvent(c.POINTERDOWN);if(this.pickingOff){this._webGLV6Viewer.setPicking({activated:true},true)}}});return e});define("DS/DELMOMVQDTExperience/js/Sphere3DNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/DELMOMVQDTExperience/js/DefectUtils","DS/Mesh/Mesh"],function(e,d,a,g){function c(i){var h=10;var k;if(i.allowMove){k=new e.Color("rgb(234,79,55)")}else{k=new e.Color("rgb(132,65,56)")}var l=new e.MeshPhongMaterial({color:k,transparent:false,opacity:1,specular:5393484,shininess:60,shading:e.SmoothShading,force:true});var j=d.createSphereNode({radius:h,material:l});j.setShadow(false);j.excludeFromCSO(false);j.excludeFromHighlight(false,true);j.setVisibilityInTree(true);j.setPickParent(true);return j}var f=null;var b=function(h){var i=c(h.annotation);i.userData={dragObject:null,annotation:h.annotation,defectNodeType:0,experienceCtx:h.experienceCtx,update:function(k){var j=i.parents[0].parents[0];if(k.allowMove){a.updateColor(i,"rgb(234,79,55)",k.isSelected);if(k.isSelected){if(!i._getViewer().forceMultiSel){j.userData.addDrag(f)}}else{j.userData.removeDrag(f)}}else{a.updateColor(i,"rgb(132,65,56)",k.isSelected);j.userData.removeDrag(f)}if(k.isVisible!==undefined){a.setVisibility(j,k.isVisible)}var l=i._getViewer();if(k.isSelected){a.setSelected(j,l.forceMultiSel)}else{a.setUnselected(j)}this.annotation=k},unhighlight:function(){var j=i.parents[0].parents[0];a.setUnselected(j)},};i.name=h.annotation.id;i.setVisibilityInTree(true);i.setPickable(g.PICKABLE);f=h.experienceCtx;return i};return b});define("DS/DELMOMVQDTExperience/js/DragManipulator",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/WebSystem/Nls","DS/3DPlay/3DPlay","DS/Manipulators/HandlePointManipulator","DS/DELMOMVQDTExperience/js/DefectUtils","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/SceneGraphOverrides/SceneGraphOverrideSetManager","DS/WebViewer/SceneGraphHelper","DS/Mesh/Mesh","DS/WebInfraUI/Notification"],function(f,b,n,p,m,h,l,j,i,o,e,d){var g=b.extend({init:function(r,t){var q=this;this.node=r;this.experienceCtx=t;this.initPosMatrix0=null;this.isMoving=false;this.manipulator=new h();this.manipulator.setPickingDuringManipulation=true;this.manipulator.setExclusive(true);this.manipToken=this.manipulator.linkToNode(r);var s=false;this.manipulator.onBeginManipulate(function(u){s=false;q.initPosMatrix0=new n.Matrix4().copy(q.node.getMatrix())});this.manipulator.onManipulate(function(u){s=true;a(q,u)});this.manipulator.onEndManipulate(function(A){var y=q.node;var u=y;y.setPickable(e.PICKABLE);A.viewer.render();var w,B;for(w=0;w<A.paths.length;w++){B=c(A.paths[w]);if(B>-1){break}}if(A.intersection.path.length===0){var v=new n.Matrix4().copy(q.initPosMatrix0);y.setMatrix(v);A.viewer.render()}else{if(k(q,A)){var v=new n.Matrix4().copy(q.initPosMatrix0);v.setPosition(A.intersection.position);y.setMatrix(v);A.viewer.render();y.userData.annotation.position=A.intersection.position;var x=document.createEvent("CustomEvent");var z={annotation:null,action:null};z.action=3;z.annotation=y.userData.annotation;z.annotation.position=A.intersection.position;x.initCustomEvent("ANNOTATIONMOVED",false,false,{AnnotationChange:z});document.dispatchEvent(x)}else{var v=new n.Matrix4().copy(q.initPosMatrix0);u.setMatrix(v);A.viewer.render();if(s){p.nls("DELMOMVQDTExperience/VQDTShare","DefectMove",function(C){m.sendEvent(q.experienceCtx,"notif",d.info,{msg:C})});s=false}}}})},remove:function(){if(this.manipulator!==null){this.manipulator.unlink(this.manipToken);this.manipulator=null}}});function a(r,s){if(e.NODRAWHL!==r.node.getPickable()){r.node.setPickable(e.NODRAWHL)}if(k(r,s)){var q=new n.Matrix4().copy(r.initPosMatrix0);q.setPosition(s.intersection.position);r.node.setMatrix(q);s.viewer.render();r.isMoving=true}}function k(r,v){var u=r.node;if(v.intersection.path.length>0){for(var s=v.intersection.path[0].externalPath.length-1;s>=0;s--){var q=v.intersection.path[0].externalPath[s];if((q.productType!==undefined)&&(q.productType==="InstanceRep")){var w={};w.pathElement=v.intersection.path[0];var t=l.createIdFromPath(w);if(t!==u.userData.annotation.parentModelPart.instancePath){return false}else{return true}break}}}return false}function c(s,r){r=r||0;if(s.externalPath!==undefined){for(var q=0;q<s.externalPath.length;q++){if(s.externalPath[q].defectNodeType===r){return q}}}return -1}return g});define("DS/DELMOMVQDTExperience/js/DefectHandler",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Selection/CSOManager","DS/ApplicationFrame/CommandsManager","DS/WebViewer/SceneGraphHelper","DS/Core/Events","DS/DELMOMVQDTExperience/js/DefectUtils","DS/DELMOMVQDTExperience/js/DragManipulator","DS/DELMOMVQDTExperience/js/Sphere3DNode","DS/DELMOMVQDTExperience/js/Pin2DNode","DS/DELMOMVQDTExperience/js/Desc2DNode","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/Node3D"],function(h,b,m,e,a,o,d,l,n,c,j,k,q,i){var g={SPHERE:0,PIN:1,DESCRIPTION:2,FIXED:4,MAIN:5};var p=b.extend({name:"DefectHandler",viewer:null,_sceneGraphTree:null,init:function(s){this._parent({});var t=this;this.experience=s.experience;this.viewer=this.experience.frmWindow.getViewer();this._sceneGraphTree=this.experience.frmWindow._sceneGraphTree;var w=d.subscribe({event:"/"+this.experience.args.ctx+"/3DPLAY/HIDE"},function(y){var x=e.get();var z;x.forEach(function(B){z=l.getDefectIndex(B);switch(z){case -2:break;case -1:var C=l.createIdFromPath(B);t.setDefectsVisibilityOnPart(C,false);break;default:var A=B.pathElement.externalPath[z];l.setVisibility(A,false);l.removeSelectedNodes()}});t.viewer.render()});var v=d.subscribe({event:"/"+this.experience.args.ctx+"/3DPLAY/SHOW_ALL"},function(x){t.showAllDefects()});var r=d.subscribe({event:"3DPLAY/EXPLODE/START"},function(x){t.hideAllDefects()});var u=d.subscribe({event:"3DPLAY/EXPLODE/END"},function(x){t.showAllDefects()})},hideAllDefects:function(){var r=l.getRootDefectNode(this.viewer);l.setVisibility(r,false);this.viewer.render()},showAllDefects:function(){var r=l.getRootDefectNode(this.viewer);l.setVisibility(r,true);this.viewer.render()},setDefectsVisibilityOnPart:function(t,r){var s=l.getRootDefectNode(this.viewer).children;s.forEach(function(u){if(u.userData.annotation.parentModelPart.instancePath===t){l.setVisibility(u,r)}});this.viewer.render()},setPartVisibility:function(t,r){var v=l.getPathFromId(l.getRootPaths(this.viewer),t.instancePath);if(!v){return null}var u=this.viewer.createSceneGraph("VisibilitySG");var s=new o(u.SceneGraphOverrideSet,null);s.setVisibility(v,r);var x={pathElement:v};var w=l.createIdFromPath(x);if(r){this.setDefectsVisibilityOnPart(w,true)}else{this.setDefectsVisibilityOnPart(w,false)}this.viewer.render()},hidePart:function(r){this.setPartVisibility(r,false)},showPart:function(r){this.setPartVisibility(r,true)},removeDefect:function(t){var r=this.getDefectNode(t);r.userData.removeDrag();r.removeChildren();var s=l.getRootDefectNode(this.viewer);s.removeChild(r);r=null;this.viewer.render()},getDefectNode:function(w){var v=l.getRootDefectNode(this.viewer);var t=v.children;var s;var u={id:w,node:null};var r=function(y,x){if(y.userData.annotation&&y.userData.annotation.id===w){x.node=y;return true}return false};for(s=0;s<t.length;s++){t[s].traverse(r,u,false)}return u.node},updateDeleteButton:function(){var v=null;var r=0;var u=e.get();var t=true;if(u.length>0){for(r=0;r<u.length;r++){if(u[r].pathElement===undefined){t=false;break}v=l.getDefectIndex(u[r]);if(v>-1){if(!u[r].pathElement.externalPath[v].userData.annotation.allowDelete){t=u[r].pathElement.externalPath[v].userData.annotation.allowDelete;break}}else{t=false;break}}}else{t=false}var s=a.getCommand("DeleteDefect",this.experience.ctx);if(s){if(t===true){s.enable()}else{s.disable()}}},placeDefect:function(r){var w=l.getRootDefectNode(this.viewer);var t=f(r,this.experience.ctx);var s=new c({annotation:r,experienceCtx:this.experience.ctx});var v=new j({annotation:r});var u=new k({annotation:r});var x=new q({name:"fixed"+r.id,ratio:1});x.userData={defectNodeType:4};x.setPickParent(true);x.addChild(s);t.addChild(x);t.addChild(v);t.addChild(u);t.setMatrix(t.getMatrix().setPosition(r.position));w.addChild(t);if(r.isSelected&&this.viewer.picking.activated){if(!this.viewer.forceMultiSel){l.removeSelectedNodes()}l.setSelected(t,this.viewer.forceMultiSel);this.updateDeleteButton()}else{t.userData.annotation.isSelected=false}if(r.isVisible!==undefined){l.setVisibility(t,r.isVisible)}else{l.setVisibility(t,true)}this.viewer.render();return t}});function f(s,t){var r=new i("main"+s.id);r.userData={annotation:s,defectNodeType:5,dragObject:null,experienceCtx:t,removeDrag:function(){if(this.dragObject){this.dragObject.remove();this.dragObject=null}},addDrag:function(){this.removeDrag();this.dragObject=new n(r,this.experienceCtx)},update:function(u){if(u.isVisible!==undefined){l.setVisibility(r,u.isVisible)}if(u.position!==undefined){r.setMatrix(r.getMatrix().setPosition(u.position))}r.userData.annotation=u}};return r}return p});define("DS/DELMOMVQDTExperience/js/I3DControl",["require","exports","DS/DELMOMVQDTExperience/js/DefectHandler","DS/DELMOMVQDTExperience/js/DefectUtils","DS/DELMOMVQDTExperience/js/EventDispatcher","DS/3DPlayHelper/3DPlayHelper","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Utilities/KeyboardUtils"],function(f,w,c,d,t,m,b,a,r,q,g,k){var s=(function(){function y(){}return y}());w.ModelPart=s;var x=(function(){function y(A,C,B){this.x=A;this.y=C;this.z=B}return y}());w.Position=x;var v=true;var p=(function(){function y(){}return y}());w.Size=p;var u=(function(){function y(){}return y}());w.Description=u;var j=(function(){function y(){this.allowAnnotationUpdate=true;this.allowSelectModelParts=true;this.allowSelectAnnotations=true;this.allowCreateAnnotations=true}return y}());w.Permission=j;var i=(function(){function y(){}return y}());w.Annotation=i;(function(y){y[y.TextAnnotationCreating=0]="TextAnnotationCreating";y[y.DefectAnnotationCreating=1]="DefectAnnotationCreating";y[y.AnnotationChanged=2]="AnnotationChanged";y[y.AnnotationMoved=3]="AnnotationMoved";y[y.AnnotationDeleted=4]="AnnotationDeleted"})(w.ActionType||(w.ActionType={}));var n=w.ActionType;var e=(function(){function y(){}return y}());w.AnnotationChange=e;var o=(function(){function y(){}return y}());w.PartClickedArgs=o;var l=(function(){function y(){}return y}());w.AnnotationClickedArgs=l;var h=(function(){function y(A,B,z,C){var F=this;if(!A){return}A.style.zIndex=1;this.eventDispatcher=new t.EventDispatcher();if(!z){this.permission=new j()}else{this.permission=z}C=C||{};C.loading=C.loading||"autoplay";C.fullScreen=true;C.mode="review";C.enableSelection=true;C.loading="autoplay";C.loadAnimation=2;if(C.callback){this.addEventListener("ModelLoaded",C.callback,function(){return F})}var E=this;var D={asset:{LoadingFinished:function(G){E.onModelLoaded()}},experience:{ExperienceReady:function(G){}}};C.callbacks=D;this.player=new m({container:A,input:{experience:{provider:"FILE",filename:"DS/DELMOMVQDTExperience/DELMOMVQDTExperience"},asset:{provider:"FILE",filename:B}},options:C});document.addEventListener("CREATEDEFECT",function(G){F.onDefectAnnotationCreate(G)});document.addEventListener("CREATEANNOTATION",function(G){F.onTextAnnotationCreate(G)});document.addEventListener("ANNOTATIONMOVED",function(G){F.onAnnotationMoved(G)});document.addEventListener("DEFECTREMOVED",function(G){F.onAnnotationChanged(G)});document.addEventListener("SELECTMODECHANGE",function(G){F.onSelectModeChangeChanged(G)});document.addEventListener("FIRESELECTION",function(G){F.onFireSelection(G)});document.addEventListener("REPORTINGMODECHANGE",function(G){F.onReportingModeChange(G)});this.subscribeToCSOonAddEvent();q.onRemove(function(H){var G=-1;E.defectHandler.updateDeleteButton();if(!H.pathElement){return}G=d.getDefectIndex(H,5);if(G===-1){E.onPartDeselected(H)}else{if(H.pathElement.externalPath[G].userData.defectNodeType===5){E.onAnnotationDeselected(H)}}E.defectHandler.viewer.render()})}y.prototype.dispose=function(){if(this.player!==undefined){this.player.dispose()}};y.prototype.subscribeToCSOonAddEvent=function(){var z=this;this.CSOonAddToken=q.onPostAdd(function(A){z.onItemSelected(A)})};y.prototype.unsubscribeFromCSOonAddEvent=function(){q.unsubscribe(this.CSOonAddToken)};y.prototype.onModelLoaded=function(){v=false;this.player.getExperience().play3DControl=this;this.defectHandler=new c({experience:this.player.getExperience()});this.configureCommands();this.eventDispatcher.fireEvent("ModelLoaded",this);v=true};y.prototype.getModelPart=function(D){var A=new s();var C=D.pathElement.externalPath;for(var B=C.length-1;B>=0;B--){var z=C[B];if((z.productType!==undefined)&&(z.productType==="Reference3D")){A.instancePath=d.createIdFromPath(D);A.modelPartID=z.name;A.revision="";break}}return A};y.prototype.get3DPosition=function(z,F){var D=this.player.getExperience();var A=D.frmWindow.getViewer();var B=new r.Vector2(z,F);var E=A.getMousePosition(B);var C=A.pick(E,"mesh",true);return C.position};y.prototype.onItemSelected=function(B){var A=B[0];var z=d.getDefectIndex(A);this.defectHandler.updateDeleteButton();switch(z){case -2:return;case -1:this.onPartSelected(A);break;default:if(A.pathElement.externalPath[z].userData.defectNodeType===5){this.onAnnotationSelected(A.pathElement.externalPath[z])}}};y.prototype.onPartSelected=function(E){var D=new o();var C=new s();var B;C=this.getModelPart(E);if(!C.modelPartID){return}C.isVisible=true;C.isSelected=true;var A=0;var G=0;var F=0;if(E.event){B=this.get3DPosition(E.event.currentPosition.x,E.event.currentPosition.y)}else{B=new x(A,G,F)}D.position=B;D.modelPart=C;this.eventDispatcher.fireEvent("PartSelected",D)};y.prototype.onPartDeselected=function(E){var D=new o();var C=new s();var B;C=this.getModelPart(E);if(!C.modelPartID){return}C.isVisible=true;C.isSelected=true;var A=0;var G=0;var F=0;if(E.event){B=this.get3DPosition(E.event.currentPosition.x,E.event.currentPosition.y)}else{B=new x(A,G,F)}D.position=B;D.modelPart=C;this.eventDispatcher.fireEvent("PartDeselected",D)};y.prototype.onAnnotationDeselected=function(C){var D=d.getDefectIndex(C);var B=C.pathElement.externalPath[D];B.userData.removeDrag();if(B.children&&B.children.length>0){d.getPinNode(B).userData.unhighlight()}var A=new l();var z=B.userData.annotation;z.isSelected=false;A.position=z.position;A.annotation=z;if(v===true){this.eventDispatcher.fireEvent("AnnotationDeselected",A)}};y.prototype.onAnnotationSelected=function(C){var A=this.player.getCtx();var D=b.getCommand("VisibilityCommands",A);if(D._isRunning&&D._isPaused===false){return}var z=C.userData.annotation;if(!this.defectHandler.viewer.forceMultiSel){if(z.allowMove){C.userData.addDrag()}}if(C.children&&C.children.length>0){if(!C.userData.annotation.description.isVisible){d.getPinNode(C).userData.highlight()}}var B=new l();C.userData.annotation.isSelected=true;B.position=z.position;B.annotation=z;if(v===true){this.eventDispatcher.fireEvent("AnnotationSelected",B)}};y.prototype.configureCommands=function(){var B=this.player.getCtx();var A=b.getCommand("PlaceDefect",B);var C=b.getCommand("AddAnnotation",B);if(this.permission.allowCreateAnnotations===true){A.enable();C.enable()}else{A.disable();C.disable()}var z=b.getCommand("MultiSelect",B);var D=b.getCommand("DeleteDefect",B);D.disable();document.addEventListener("keydown",function(F){if(F.keyCode===k.DELETE){D.beginExecute()}else{if(F.keyCode===k.CTRL){z.beginExecute();var E=document.querySelector("div[data-command=MultiSelect]");E.className+=" wux-ui-state-active"}}});document.addEventListener("keyup",function(F){if(F.keyCode===k.CTRL){z.endExecute();var E=document.querySelector("div[data-command=MultiSelect]");E.classList.remove("wux-ui-state-active")}})};y.prototype.onDefectAnnotationCreate=function(z){if(z.detail.AnnotationChange.annotation.parentModelPart.instancePath){this.eventDispatcher.fireEvent("DefectAnnotationCreate",z.detail.AnnotationChange)}};y.prototype.onTextAnnotationCreate=function(z){if(z.detail.AnnotationChange.annotation.parentModelPart.instancePath){this.eventDispatcher.fireEvent("TextAnnotationCreate",z.detail.AnnotationChange)}};y.prototype.onAnnotationMoved=function(z){this.eventDispatcher.fireEvent("AnnotationMoved",z.detail.AnnotationChange)};y.prototype.onAnnotationChanged=function(z){this.eventDispatcher.fireEvent("AnnotationChanged",z.detail.AnnotationChange)};y.prototype.onSelectModeChangeChanged=function(z){this.eventDispatcher.fireEvent("SelectModeChange",z.detail.SelectMode)};y.prototype.onReportingModeChange=function(z){this.eventDispatcher.fireEvent("ReportingModeChange",z.detail.ReportMode)};y.prototype.onFireSelection=function(z){v=z.detail.fireSelection};y.prototype.updatePermission=function(z){this.permission=z;var B=this.player.getCtx();var A=b.getCommand("PlaceDefect",B);var C=b.getCommand("AddAnnotation",B);if(z.allowCreateAnnotations===true){A.enable();C.enable()}else{A.disable();C.disable()}};y.prototype.showTree=function(){var z=this.defectHandler._sceneGraphTree;z.tree.show()};y.prototype.hideTree=function(){var z=this.defectHandler._sceneGraphTree;z.tree.hide()};y.prototype.initialize=function(){};y.prototype.updateModelParts=function(z){this.updatePartSelection(z);this.updatePartVisiblity(z)};y.prototype.updatePartVisiblity=function(A){for(var z=0;z<A.length;z++){if(A[z].isVisible){this.defectHandler.showPart(A[z])}else{this.defectHandler.hidePart(A[z])}}};y.prototype.updatePartSelection=function(C){this.unsubscribeFromCSOonAddEvent();var B=this.player.getCurrentSelection();for(var z=B.length;z>0;z--){if(B[z-1]===""){B.splice(z-1,1)}}for(var A=0;A<C.length;A++){if(C[A].isSelected){B.push(C[A].instancePath)}else{B.pop(C[A].instancePath)}}this.player.emptySelection();this.player.selectNode(B);this.subscribeToCSOonAddEvent()};y.prototype.addAnnotations=function(z){for(var A=0;A<z.length;A++){this.defectHandler.placeDefect(z[A])}};y.prototype.updateAnnotations=function(C){var B=this.player.getCtx();var G=b.getCommand("VisibilityCommands",B);G._isPaused=true;var E=null;var D;var F;var A;v=false;for(F=0;F<C.length;F++){if(G._isRunning){C[F].isSelected=false}E=this.defectHandler.getDefectNode(C[F].id);if(E){var z=E.userData.annotation;E.userData.update(C[F]);for(D=0;D<E.children.length;D++){A=E.children[D].userData.defectNodeType;switch(A){case 4:E.children[D].children[0].userData.update(C[F]);break;default:E.children[D].userData.update(C[F],z);break}}}this.defectHandler.viewer.render()}G._isPaused=false;v=true};y.prototype.selectMode=function(){var A=this.player.getExperience();var z=A.frmWindow.getViewer();if(z.forceMultiSel){return"multi"}else{return"single"}};y.prototype.removeAnnotations=function(z,A){if(A===void 0){A=false}var D=new Array();var C;v=false;try{for(var B=0;B<z.length;B++){if(z[B].allowDelete){C=new e();C.annotation=z[B];C.action=n.AnnotationDeleted;this.defectHandler.removeDefect(z[B].id);D.push(C)}}if(A){this.eventDispatcher.fireEvent("AnnotationChanged",D)}}finally{v=true}};y.prototype.addEventListener=function(z,B,A){this.eventDispatcher.addEventListener(z,B,A)};y.prototype.fireEvent=function(A,z){this.eventDispatcher.fireEvent(A,z)};return y}());w.Play3D=h});