define("DS/ENODOManagementCmds/views/_DOGeneratorView",["css!DS/UIKIT/UIKIT","css!DS/ENODOManagementCmds/ENODOManagementCmds","i18n!DS/ENODOManagementCmds/assets/nls/DOGeneratorCmd","text!DS/ENODOUtilsServices/assets/catrsc/ENODOFormat.xml","UWA/Controls/Abstract","UWA/Class/Events","UWA/Promise","DS/Windows/Panel","DS/UIKIT/Modal","DS/Controls/Button","DS/Controls/ComboBox","DS/Core/PointerEvents","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/i3DXCompassServices/i3DXCompassPubSub","DS/ENODOUtilsServices/DOServices","DS/Utilities/UUID"],function(s,d,g,n,r,o,e,m,c,q,l,j,i,k,f,t,b){var h={generateJob:{url:"/resources/PLMDerivedOutputWSAPI/derivedoutput_services/createDerivedFormatJobs",verb:"POST"}};var p="DS/ENOFloatingPanel/ENOFloatingPanel";var a=r.extend(o,{name:"dogeneratorview",_command_id:"",_applyOnlyToThisApp:false,_nodesID:null,init:function(u){this._parent(u);var v=this;if(!UWA.is(u)||!UWA.is(u.nodesID)){v._displayNotification("error",g.error.title,g.error.noObject)}else{this._nodesID=u.nodesID}require([p],function(w){v.render_div=document.querySelector(v.options.render_div);v._command_id=u._command_id;v._selectedFormat=null;v._displayWarning=u.display_warning;v.elements.container=v._createContent();v.elements.floatingpanel=new w({className:v.name,body:v.elements.container,footer:v._buildFooter(),title:g.title,overlay:true,closable:true,animate:true,resizable:true,visible:true,events:{onClose:function(){v.elements.floatingpanel.destroy()}}});v.elements.floatingpanel.inject(v.render_div)})},_createContent:function(){var y=this;var A=UWA.createElement("div",{"class":"dogeneratorview_content"});var v=UWA.createElement("div",{"class":"dogeneratorview_format"});A.appendChild(v);var u=[];u=this._getFormatList();var D=u.length;if(D==0){y._displayNotification("warning",g.warning.title,g.warning.noFormat);y.elements.floatingpanel.destroy();y.destroy()}else{if(D==1){var w=u[0];this.selectedFormat=u[0];var B=g.replace(g.optionUniqueFormat,{oFormat:w});y._selectedFormat=w;var x=UWA.createElement("p",{content:B});v.appendChild(x)}else{var x=UWA.createElement("h5",{content:g.optionFormat});v.appendChild(x);this.selectedFormat=u[0];var z=(D>10)?true:false;this.myComboBox=new l({elementsList:u,selectedIndex:0,enableSearchFlag:z,actionOnClickFlag:false});v.appendChild(this.myComboBox.getContent());this.myComboBox.addEventListener("change",y._buildOptions.bind(this));this.myComboBox.addEventListener("preselectionChange",y._buildOptions.bind(this))}var C=UWA.createElement("div",{"class":"dogeneratorview_options"});A.appendChild(C);if(y._displayWarning==true){var x=UWA.createElement("p",{content:g.info.generationOnRep});v.appendChild(x)}y._buildOptions()}return A},_buildFooter:function(){var u=this;var w=UWA.createElement("div",{"class":"footerModal"});u.elements.generatebutton=new q({label:g.buttons.generate,emphasize:"primary",touchMode:true,allowUnsafeHTMLLabel:false});u.elements.generatebutton.addEventListener("buttonclick",function(){u._generate()});w.appendChild(u.elements.generatebutton.getContent());var v=new q({label:g.buttons.cancel,emphasize:"secondary",touchMode:true,allowUnsafeHTMLLabel:false});v.addEventListener("click",function(){u.elements.floatingpanel.destroy();u.destroy()});v.inject(w);return w},_getFormatList:function(){var y=[];var x,z,w,v;z=new DOMParser();w=z.parseFromString(n,"text/xml");var u=w.getElementsByTagName("Format");for(v=0;v<u.length;v++){x=u[v].getAttribute("ID");y.push(x)}return y},_displayNotification:function(x,v,u){window.notifs=k;i.setNotificationManager(window.notifs);var w={level:x,title:v,message:u,sticky:false};window.notifs.addNotif(w)},_buildOptions:function(){if(typeof this.myComboBox!=="undefined"){this.selectedFormat=this.myComboBox.value}},_generate:function(){var y=this;this.elements.floatingpanel.destroy();var v=[];for(var x=0;x<this._nodesID.length;x++){var w="DFGeneration"+b.v4();var z={model_identifier:{type:"3DShape",id:this._nodesID[x]},target:this.selectedFormat,title:w,batch_parameters:{version:"2.0",convinputs:[],inputs:[]}};v.push(z)}var u={data:{DoJobs:v},webService:{url:h.generateJob.url,verb:h.generateJob.verb},callback:{onComplete:function(A){y._displayNotification("info",g.info.title,g.info.generationLaunched)},onFailure:function(A){y._displayNotification("error",g.error.title,g.replace(g.error.jobFailed,{oMsg:A}))}}};t.SendServerRequest(u);this.destroy()}});return a});define("DS/ENODOManagementCmds/commands/PSEDOGenerationCommand",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","i18n!DS/ENODOManagementCmds/assets/nls/DOGeneratorCmd","DS/ENODOManagementCmds/views/_DOGeneratorView","DS/ENODOUtilsServices/DOServices","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages"],function(a,e,c,g,f,i,h){var d={expand:{url:"/cvservlet/expand",verb:"POST"}};var b=a.extend({_check_roots:function(){var j=e.get().getPADTreeDocument().getRoots().length>0;if(j){this.enable()}else{this.disable()}},_check_added_roots:function(l){var k=e.get();var j=k.getPADTreeDocument();if(l.data.nb_root===0){this.disable()}else{this.enable()}},_getSelectedNodesId:function(l){var k=[];for(idx=0;idx<l.length;idx++){var j=l[idx];k.push(j.getID())}return k},_getShapesID:function(k){var p=[];for(var l=0;l<k.length;l++){var o=k[l];if(UWA.is(o.attributes)){var m="",q="";for(var j=0;j<o.attributes.length;j++){var n=o.attributes[j];if(n.name==="physicalid"){q=n.value}else{if(n.name==="ds6w:type"){m=n.value}}}if(m==="3DShape"){p.push(q)}}}return p},_sendExpandRequest:function(k){if(!UWA.is(k)){throw new Error("## PSEDOGenerationCmd._sendExpandRequest: Invalid inputs")}var l=this;var j={data:{intent:"explore_2D",label:"PSEDOGenerationCmd",select_bo:["physicalid","ds6w:label","ds6w:type"]},webService:{url:d.expand.url,verb:d.expand.verb},callback:{onComplete:function(q){var o=l._getShapesID(q.results);var n=false;for(var m=0;m<k.length;m++){if(o.indexOf(k[m])==-1){n=true;break}}if(o.length>0){require(["DS/ENODOManagementCmds/views/_DOGeneratorView"],function(s){var r=new s({_command_id:l.options.ID,render_div:".xnav_body",nodesID:o,display_warning:n})})}else{window.notifs=h;i.setNotificationManager(window.notifs);var p={level:"error",title:c.error.title,message:c.error.noObject,sticky:false};window.notifs.addNotif(p)}},onFailure:function(m){if(m){console.error(m)}}}};if(k.length>1){j.data.multi_root_physicalid=k}else{j.data.root_physicalid=k[0]}f.SendServerRequest(j)},init:function(k){this._parent(k);var n=this,m=e.get(),j=m.options.model?m.options.model:m.getPADTreeDocument();if(UWA.Utils.Client.Platform.ios){this.disable()}else{this._check_roots();var l=this._check_roots.bind(this);j.addEventListener("addChild",l);j.addEventListener("removeChild",l);this._check_roots();m.addEvent("onRootsVisibility",this._check_roots.bind(this));m.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}},execute:function(){var o=this,l=e.get(),k=l.options.model?l.options.model:l.getPADTreeDocument();var n="";var j=k.getSelectedNodes();var m=this._getSelectedNodesId(j);this._sendExpandRequest(m)}});return b});