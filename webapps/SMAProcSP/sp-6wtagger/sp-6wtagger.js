(function(e){var h,a,c,f,b,g,d;b={"Content-Type":"application/x-www-form-urlencoded"};c=function(j){var i,k;i=j;if(j.context instanceof h){if(!j.context.idlist||j.context.idlist.length===0){i.abort();return}k=j.context.idlist.map(function(l){return l.id}).join();i.verb="POST";i.payload="oid_list="+k+'&isPhysicalIds="true"';i.headers=b;i.ignoreFlush=true}};f=function(j){var i;if(this instanceof h){i=a(this.$.bpsTagDataWS.data)}else{if(j.context instanceof h){var l=JSON.parse(j.response);i=a(l);try{j.context.proxy.setSubjectsTags(JSON.parse(JSON.stringify(i)))}catch(k){}return}}if(this&&this.proxy){this.proxy.setSubjectsTags(i)}else{if(e.console&&e.console.warn){console.warn("sp-6wtagger: onTagDataReady: no tagger proxy available")}}};a=function(i){var j,p,k,o,q,s,r,n,m,l;j=i.widgets[0].widgets[0].widgets;p=i.widgets[0].datarecords.datagroups;k={};p.forEach(function(t){o=t;q=t.dataelements;if(!q){return}k["pid://"+o.physicalId]=[];j.forEach(function(u){s=u.name;r=u.selectable.sixw;n=q[s];if(!n){return}n.value.forEach(function(w){m={};l=w.value;m.object=l;m.sixw=r;var v=s.replace("_tag_","");m.field=v;m.dispValue=l;k["pid://"+o.physicalId].push(m)})})});return k};g=function(k){var l,i;l=this.filtercallback;this.idlist=k;if(!this.$.dashboard.isInDashboard()){if(!e.getTopWindow){if(e.console&&e.console.warn){e.console.warn("sp-6wtagger: could not access tagger")}l();return}try{i=e.getTopWindow();i.topFrameTagger.get6WTagger("context1").unfocusCC();i.topFrameTagger.get6WTagger("context1").setAsCurrent();e.require(["DS/TagNavigatorProxy/TagNavigatorProxy"],function(m){var n={contextId:"context1",filteringMode:"WithFilteringServices",events:{addFilterSubjectsListener:l}};this.proxy=this.proxy||m.createProxy(n);var o=this;this.$.bpsTagDataWS.sendRequest({verb:"POST",uri:o.getBpsUri(),headers:b,context:o,beforeSend:o.onTagDataReq,onComplete:o.onTagDataReady,onError:function(){}});i.psProxy=this.proxy}.bind(this))}catch(j){console.log("Issue with tagger Initialization")}}else{e.require(["DS/TagNavigatorProxy/TagNavigatorProxy"],function(m){var n={widgetId:widget.id,filteringMode:"WithFilteringServices",events:{addFilterSubjectsListener:l}};this.proxy=this.proxy||m.createProxy(n);var o=this;this.$.bpsTagDataWS.sendRequest({verb:"POST",uri:o.getBpsUri(),headers:b,context:o,beforeSend:o.onTagDataReq,onComplete:o.onTagDataReady,onError:function(){}});widget.taggerProxy=this.proxy;widget.taggerProxy.activate()}.bind(this))}};d=function(j){this.idlist=j;var i=this;this.$.bpsTagDataWS.sendRequest({verb:"POST",uri:i.getBpsUri(),headers:b,context:i,beforeSend:i.onTagDataReq,onComplete:i.onTagDataReady,onError:function(){}})};h=Polymer({is:"sp-6wtagger",behaviors:[e.SPBase],properties:{filtercallback:{type:Function},idlist:{type:Array,value:function(){return[]}},proxy:{type:Object}},onTagDataReq:function(){return c.apply(this,arguments)},onTagDataReady:function(){return f.apply(this,arguments)},init:function(){return g.apply(this,arguments)},refresh:function(){return d.apply(this,arguments)},getBpsUri:function(){if(this.$.bpsTagDataWS.uri){}else{if(this.$.dashboard.getMcsUri()){this.$.bpsTagDataWS.uri=this.$.dashboard.getMcsUri()+"/resources/e6w/servicetagdata"}else{if(e.console&&e.console.warn){e.console.warn("sp-6wtagger: cannot get BPS URI")}}}return this.$.bpsTagDataWS.uri}})}(this));