/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
(function(j){var h,g,i,b,c,d,a="/resources/AppsMngt/environment/list",k=["x3dPlatformId"],e={"3DSwym":"swym","3DPassport":"passport","3DSpace":"cstorage","3DSearch":"search","3DMessaging":"rtc",ComputeOrchestration:"hpc","3DOrchestrate":"hpc","6WTags":"tagger"},f=null;h=function(l){return e[l]||l};g=function(l,n,m,o){if(f){setTimeout(m.bind(this,f))}else{l.fetchMyappsUri().then(function(p){n.sendRequest({uri:p+a,verb:"GET",wait:0,headers:{Accept:"application/json"},onComplete:function(r){var q=r.response;if(typeof q==="string"){try{q=JSON.parse(r.response)}catch(s){q=null}}if(q&&q.code===0&&q.environments){f=q.environments;m(f)}else{o(new Error("sp-serviceurl: invalid environment list"))}},onError:function(){o(new Error("sp-serviceurl: failed to fetch environment list"))}},function(){o(new Error("sp-serviceurl: failed to get environment list URL"))})})}};i=function(m,n,o){var l=null;m=m||[];m.some(function(p){if(!o||p.id===o){l=p[n];return true}else{return false}});return l};b=function(n){var l=n||this;var m=l.JS.toType(l.platformid)==="string"?l.platformid:null;if(!m&&j.widget&&j.widget.getValue){k.some(function(o){m=j.widget.getValue(o);return m})}return m};c=function(o,p,m,q){var l=h(o),n;n=function(s){var r=i(s,l,p);m(r)};return g.call(this,this.$.dashboard,this.$.servicesWs,n,q)};d=function(l){this.serviceurl=l};Polymer({is:"sp-serviceurl",behaviors:[j.DS.SMAProcSP.SPBase],properties:{platformid:{type:String,notify:true,observer:"platformidChanged"},serviceid:{type:String,notify:true,observer:"serviceidChanged"},serviceurl:{type:String,notify:true,reflectToAttribute:true}},platformidChanged:function(l){c.call(this,this.serviceid,l,d.bind(this),function(){})},serviceidChanged:function(l){c.call(this,l,this.platformid,d.bind(this),function(){})},getUrl:function(l){var o,n,m;m=function(){};l=l||{};l.onComplete=l.onComplete||m;l.onError=l.onError||m;n=l.serviceid||this.serviceid;if(!n){l.onError.call(this,new Error("sp-serviceurl: missing serviceid"));return}o=typeof l.platformid!=="undefined"?l.platformid:b(this);c.call(this,n,o,l.onComplete,l.onError)},fetchUrl:function(l){var m=this;return new Promise(function(o,n){m.getUrl({platformid:l&&l.platformid,serviceid:l&&l.serviceid,onComplete:o,onError:n})})},getPlatformList:function(l){var m=function(){};l=l||{};l.onComplete=l.onComplete||m;l.onError=l.onError||m;g.call(this,this.$.dashboard,this.$.servicesWs,function(n){if(Array.isArray(n)){l.onComplete(n.map(function(o){return{platformId:o.id,displayName:o.displayName}}),this)}else{l.onComplete([])}},l.onError)}})}(this));