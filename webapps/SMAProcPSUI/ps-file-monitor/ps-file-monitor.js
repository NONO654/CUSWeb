(function(q){var z="Activity",E="MonitorFiles",F="Group",i="Location Group",t={JOB_STATUS_NOT_STARTED:"NotStarted",JOB_STATUS_RUNNING:"Running",JOB_STATUS_PAUSED:"Paused",JOB_STATUS_WAITING:"Waiting",JOB_STATUS_COMPLETED:"Completed",JOB_STATUS_ABORTED:"Aborted",JOB_STATUS_FAILED:"Failed",JOB_STATUS_INITIALIZING:"Initializing"},B,v={variable:"sp-variable"},w=null,D=null,s=null,G=null,A=null,r=null,j=null,n=null,p=null,m=null,g=null,h=null,l=null,o=null,y=null,d=null,u=null,b=null,k=null,f=null,C=null,a=null,e=null,c=null,x=null;w=function(){if(Boolean(this.jobObjectId)&&this.jobObjectId!=="Initializing"){if(this.session instanceof q.DS.SMAProcPSUI.PSProcess){var H=this.DOM(this).find("#execdirView").root[0];if(H){H.setCredentialsFunction(x.bind(this))}if(!this.cosServerMap.hasOwnProperty(this.$.eedBaseURL.getValue())){j.call(this)}this.childrenMap={};this.session.clearAllActivities();this.executionOptions=appData.simData.exeOptions;appData.simData.oldSimulationId=appData.simData.simulationId;this.onExecutionOptionsReady.bind(this).call()}}if(!this.jobObjectId){g.call(this)}};c=function(){var J=new XMLHttpRequest(),I=this.$.eedBaseURL.getValue(),H=I+"/admin/runAsEnabled";J.open("GET",H,true);J.setRequestHeader("Accept","application/json, */*; q=0.01");J.setRequestHeader("EEDTicket",this.eedTicket);J.onreadystatechange=function(){if(J.readyState!==4){return}switch(J.status){case 200:this.cosServerMap[I]=J.response;break;default:break}}.bind(this);J.send()};C=function(){var H=this.DOM(this).find("#execdirView").root[0];if(H){H.session=this.session;if(this.session instanceof q.DS.SMAProcADUI.ADSession){H.setCredentialsFunction(null);this.session.addEventListener("sessionloaded",function(){this.refresh()}.bind(this))}else{H.setCredentialsFunction(x.bind(this))}}};D=function(){if(this.session instanceof q.DS.SMAProcPSUI.PSProcess&&h(this.jobExecutionStatus)){var H=this.DOM(this).find("#execdirView").root[0];if(H){H.setCredentialsFunction(x.bind(this))}}};h=function(H){var I=[t.JOB_STATUS_RUNNING,t.JOB_STATUS_PAUSED,t.JOB_STATUS_WAITING].some(function(J){return H===J});return I};l=function(H){var I=[t.JOB_STATUS_FAILED,t.JOB_STATUS_COMPLETED,t.JOB_STATUS_ABORTED].some(function(J){return H===J});return I};o=function(I){var H={},I,J;J=I["@isPrivate"];if(J==="true"){H.station="{localhost}"}else{H.station=I["@stationName"]}H.name=this.simTitle+"\n ("+I["@stationName"]+")";H.path=I["@stationTempDirectory"];return H};y=function(M,I){var L,N=false;if(M.station&&M.path){L=new I.ADExecDir();L.name=M.name;L.lastModified=new Date().toString();L.station=M.station;L.path=M.path;var H=new XMLHttpRequest(),K=this.$.eedBaseURL.getValue(),J=K+"/admin/station/"+L.station;H.open("GET",J,true);H.setRequestHeader("Accept","application/json, */*; q=0.01");H.onreadystatechange=function(){if(H.readyState!==4){return}switch(H.status){case 200:var O=JSON.parse(H.response);if(this.cosServerMap[K]==="true"){if(O.Station.GeneralInfo["@disableRunAs"]!=="disabled"){L.credentials={os:O.Station.GeneralInfo["@os"],domainName:O.Station.GeneralInfo["@domain"]}}}N=this.session.addExecutionDirectory(L);if(N){this.refresh()}break;default:N=this.session.addExecutionDirectory(L);if(N){this.refresh()}break}}.bind(this);H.send()}};d=function(H){var I=false,J=this.DOM(this).find("#execdirView").root[0];if(H.cleanup!=="Never"){if(J&&J.currentExecDir){if(J.currentExecDir.name===H.name){f.call(this)}}I=this.session.removeExecutionDirectory(H);if(I){this.refresh()}}};u=function(){var L,N,H,K,M,J={};this.$.monitorFilesNotification.style.display="block";var I=this.executionOptions.filter(function(O){return O.title==="MonitorFiles"});I.forEach(function(O){if(O.value==="true"){this.$.monitorFilesNotification.style.display="none"}}.bind(this));for(L=0;L<this.executionOptions.length;L+=1){N=this.executionOptions[L];H=N.title;if(N.level==="0"){if(N.sequence&&N.sequence!=="0"){if(M){this.session.addActivity(J);J={};M=null}J.sequence=M=N.sequence}}if(H.indexOf(z)>-1&&N.sequence){J.name=N.title_display}else{if(H.indexOf(E)!==-1){J.monitorFiles=N.value;J.monitorFiles=(J.monitorFiles==="true")}else{if(H.indexOf(F)>-1){K=N.title_display;if(K.indexOf(i)>-1){if(N.value){J.name=N.value;J.sequence=N.value}}}}}}if(M){this.session.addActivity(J)}};k=function(){var H=this.DOM(this).find("#execdirView").root;if(H.length>0){H[0].refresh()}};f=function(){try{this.DOM(this).find("#execdirView").root[0].onTailExecutionFileSidepanelCancel({stopPropagation:function(){}})}catch(H){}};G=function(){var I=new XMLHttpRequest(),H=this.$.eedBaseURL.getValue()+"/job/"+this.eedjobId+"/summary/brief/directory";I.open("GET",H,true);I.setRequestHeader("Accept","application/json, */*; q=0.01");I.setRequestHeader("EEDTicket",this.eedTicket);I.onreadystatechange=function(){if(I.readyState!==4){return}switch(I.status){case 200:this.fullSummary=JSON.parse(I.response);A.call(this);break;case 401:this.$.summaryTimer.stop();break;case 403:case 410:g.call(this);break;default:g.call(this);break}}.bind(this);I.send()};A=function(){var H=this.fullSummary.JobInfo.JobSummary.StationList,J=0,K,I;if(H instanceof Array){for(J=0;J<H.length;J+=1){I=o.call(this,H[J]);K=Boolean(this.childrenMap[I.path]);if(!K){this.childrenMap[I.path]=I;y.call(this,I,B)}}}else{I=o.call(this,H);K=Boolean(this.childrenMap[I.path]);if(!K){this.childrenMap[I.path]=I;y.call(this,I,B)}}};b=function(){var H=[],L={},M=false,K={};if(this.summary[0]){this.fetchSummaryData=true;if(this.summary[0].StationList){H=this.summary[0].StationList}else{if(this.summary.StationList){H=this.summary.StationList}}for(var J=0;J<H.length;J+=1){L=H[J];K.name=this.simTitle+"\n ("+L["Station Name"]+")";K.station=L["Station Name"];if(L.isPrivate.toLowerCase()==="true"){K.station="{localhost}"}K.path=L["Station Temp Directory"];M=Boolean(this.childrenMap[K.path]);if(!M){this.childrenMap[K.path]=K;y.call(this,K,B)}}}else{if(this.summary.length===0&&this.fetchSummaryData){this.fetchSummaryData=false;var I={onComplete:function(N){this.eedTicket=JSON.parse(N.response).ticket;this.onSummaryTick()}.bind(this)};this.$.eedTicketWs.sendRequest(I)}}};r=function(){this.globals={};var H=this;this.fullSummary={};this.childrenMap={};this.cosServerMap={};this.fetchSummaryData=true;this.DOM(this).find(v.variable).forEach(function(I){H.globals[I.name]=I.getValue()});require(["DS/SMAProcADUI/ad-execdir/ADExecDir"],function(I){B=I})};j=function(){this.$.eedTicketWs.getData()};n=function(){if(this.eedTicketData.ticket){this.eedTicket=this.eedTicketData.ticket;c.call(this);if(this.$.cosTicketTimer.state==="is-started"){this.$.summaryTimer.start()}}};g=function(){this.$.summaryTimer.stop();this.$.cosTicketTimer.stop()};m=function(){var H=this.$.execdirViewContainer;this.$.updatePanel.update();var I=this.resolveUrl("../../SMAProcADUI/ad-execdir-view/ad-execdir-view.html");Polymer.Base.importHref([I],function(){var K=document.createElement("ad-execdir-view");K.id="execdirView";K.viewMode="icon";K.session=this.session;K.showTailButton=true;K.emptyMessage="No Execution Directories are available";K.setCredentialsFunction(x.bind(this));try{K.$.tailExecutionFileSidepanel.$.tailView.style.minWidth="600px";K.$.tailExecutionFileSidepanel.$.tailView.style.width=""}catch(J){}Polymer.dom(H).appendChild(K);this.$.updatePanel.done()}.bind(this),function(){q.alert("Error loading execdir view")},true)},p=function(){var H=this.DOM(this).find("#execdirView").root[0];if(!H){m.call(this)}if(this.session instanceof q.DS.SMAProcPSUI.PSProcess){if(H){H.setCredentialsFunction(x.bind(this))}if(this.executionOptions&&!this.executionOptions.length){this.executionOptions=appData.simData.exeOptions;this.onExecutionOptionsReady.bind(this).call()}if(h(this.jobExecutionStatus)&&this.jobExecutionStatus!=="Paused"){g.call(this);this.$.cosTicketTimer.start()}else{if(this.jobExecutionStatus==="Paused"){this.onEEDTicketTimerTick();G.call(this)}else{if(l(this.jobExecutionStatus)){this.$.summaryWs.getData()}}}}else{if(H){H.setCredentialsFunction(null)}}};s=function(){var H={};H=this.$.credentials.getValue();if(H){this.querySelector("#windowsDomainRow").value=H.domainName;this.$.windowsUser.value=H.windowsUser;this.$.windowsPassword.value=H.windowsPass;this.$.linuxUser.value=H.linuxUser;this.$.linuxPassword.value=H.linuxPass}};x=function(H){var I=function(){this.$.okButton.removeEventListener("click",J);this.$.cancelButton.removeEventListener("click",K);this.$.closeButton.removeEventListener("click",K)},J=function(M){M.preventDefault();a.call(this);I.call(this);if(H.execDir.credentials.os==="WINDOWS"){H.execDir.credentials.windowsUser=this.$.windowsUser.value;H.execDir.credentials.windowsPass=this.$.windowsPassword.value}else{H.execDir.credentials.linuxUser=this.$.linuxUser.value;H.execDir.credentials.linuxPass=this.$.linuxPassword.value}var L=H.execDir.credentials;this.$.credentials.setValue(L);H.onComplete(true)},K=function(){a.call(this);I.call(this);H.onComplete(false)};this.$.okButton.addEventListener("click",J.bind(this));this.$.cancelButton.addEventListener("click",K.bind(this));this.$.closeButton.addEventListener("click",K.bind(this));this.settingStoredCredetialsFromSession();e.call(this,H.execDir)};e=function(H){this.settingStoredCredetialsFromSession();this.DOM(this.$.credentialsModal).addClass("in");this.DOM(this.$.credentialsModal).addClass("show");this.DOM(this.$.credentialsModal).removeClass("hidden");this.DOM(this.$.credentialsModalOverlay).addClass("in");this.DOM(this.$.credentialsModalOverlay).addClass("show");this.DOM(this.$.credentialsModalOverlay).removeClass("hidden");if(H.credentials&&H.credentials.os==="WINDOWS"){Polymer.dom(this.$.windowsDomain).textContent=H.credentials.domainName;this.DOM(this.$.windowsDomainRow).removeClass("hidden");this.DOM(this.$.windowsUserRow).removeClass("hidden");this.DOM(this.$.windowsPasswordRow).removeClass("hidden");this.DOM(this.$.linuxUserRow).addClass("hidden");this.DOM(this.$.linuxPasswordRow).addClass("hidden")}else{this.DOM(this.$.windowsDomainRow).addClass("hidden");this.DOM(this.$.windowsUserRow).addClass("hidden");this.DOM(this.$.windowsPasswordRow).addClass("hidden");this.DOM(this.$.linuxUserRow).removeClass("hidden");this.DOM(this.$.linuxPasswordRow).removeClass("hidden")}};a=function(){this.DOM(this.$.credentialsModal).removeClass("in");this.DOM(this.$.credentialsModal).removeClass("show");this.DOM(this.$.credentialsModal).addClass("hidden");this.DOM(this.$.credentialsModalOverlay).removeClass("in");this.DOM(this.$.credentialsModalOverlay).removeClass("show");this.DOM(this.$.credentialsModalOverlay).addClass("hidden")};Polymer({is:"ps-file-monitor",properties:{jobExecutionStatus:{notify:true,type:String,observer:"jobExecutionStatusChanged"},jobObjectId:{notify:true,type:String,observer:"jobObjectIdChanged"},session:{notify:true,observer:"sessionChanged"},simTitle:{notify:true,type:String},simOid:{notify:true}},settingStoredCredetialsFromSession:s,jobObjectIdChanged:function(){return w.apply(this,arguments)},onExeoptionsChange:function(H){this.executionOptions=H.detail;return u.apply(this,arguments)},sessionChanged:function(){return C.apply(this,arguments)},jobExecutionStatusChanged:function(){return D.apply(this,arguments)},onExecutionOptionsReady:function(){return u.apply(this,arguments)},refresh:function(){return k.apply(this,arguments)},closeTailWindow:function(){return f.apply(this,arguments)},startInterval:function(){return p.apply(this,arguments)},parseDirectoryInfoFromMCS:function(){return b.apply(this,arguments)},ready:function(){return r.apply(this,arguments)},onSummaryTick:function(){return G.apply(this,arguments)},onEEDTicketTimerTick:function(){return j.apply(this,arguments)},setEEDTicket:function(){return n.apply(this,arguments)},resetInterval:function(){return g.apply(this,arguments)},behaviors:[q.DS.SMAProcSP.SPBase],_computeUri:function(H){return"simulations/"+H+"/executionoptions"},_computeUri2:function(H){return"jobs/"+H+"/summary"},_computeUri3:function(H){if(H){return this.$.mcsWSBaseURL.getValue()+"/cos/ticket?physicalid="+H}return""}})}(this));