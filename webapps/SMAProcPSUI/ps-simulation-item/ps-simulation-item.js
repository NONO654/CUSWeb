(function(k){var n,i,e,o,c,b,j,h,m={multiselect:"multiselect",multiunselect:"multiunselect"},g={RUNNING:"RUNNING",ERROR:"ERROR",SUCCESS:"SUCCESS",WARNING:"WARNING",INIT:"INIT",PENDING:"PENDING"},d={Completed:g.SUCCESS,Failed:g.ERROR,Aborted:g.ERROR,NotStarted:g.INIT,Queued:g.WARNING,Running:g.RUNNING,Waiting:g.WARNING,Paused:g.WARNING,Initializing:g.INIT},p={DENIED:"denied",READONLY:"readonly",WRITEABLE:"writeable"},f=function(r){var q=p.DENIED;if(r.fromconnectMask==="TRUE"&&r.fromdisconnectMask==="TRUE"&&r.modifyMask==="TRUE"&&r.locked==="FALSE"){q=p.WRITEABLE}else{q=p.READONLY}return q},l;var a=function(r){var q=f(r.basics);return q!==p.WRITEABLE};e=function(){this.execStateCode=d[this.simitem.latestExecution.state];if(this.simitem.latestExecution.state&&this.simitem.latestExecution.state.replace){this.execStateText=this.simitem.latestExecution.state.replace(/([A-Z])/g," $1")}if(a(this.simitem)){this.simitem.$state="is-readonly";if(typeof(jasmine)===undefined){this.notifyPath("simitem.$state",this.simitem.$state,false)}}};i=function(q){q.stopPropagation();if(q.currentTarget.checked){this.fire(m.multiselect)}else{this.fire(m.multiunselect)}};l=function(){this.$.multiselectcheck.click()};o=function(t){var q=f(this.simitem.basics),s,r=this;if(q!==p.WRITEABLE){r.set("simitem.$state","is-failingtorun");r.set("simitem.message","The simulation cannot run as it is read-only");setTimeout(function(){if(q!==p.WRITEABLE){r.set("simitem.$state","is-readonly")}},4000);return{msg:"cannot create simulation (not writeable)"}}s=this.simulationFactory.createSimulation(this.simitem,t);s.addEvent("simulation:create",function(){r.asyncFire("event-manager",{name:"job-started",data:s});r.asyncFire("jobStarted",{jobStarted:"run-started"});r.set("simitem.latestExecution.eedJobId",s.id);r.set("simitem.latestExecution.id",s.plmid);r.set("simitem.latestExecution.state","Initializing")});s.addEvent("simulation:create:fail",function(v){r.set("simitem.$state","is-failingtorun");var u=v.result.response;if(u){r.set("simitem.message",u)}setTimeout(function(){r.set("simitem.$state","")},5000)});return{msg:"creating simulation"}};c=function(){var q=f(this.simitem.basics);if(q!==p.WRITEABLE){this.set("simitem.$state","is-failingtoabort");setTimeout(function(){this.set("simitem.$state","is-readonly")}.bind(this),5000)}else{this.$.eedTicketWs.getData()}};n=function(){k.DS.SMAProcSP.SPVariableHelper.ready.call(this);this.defaultSimIcon=this.resolveUrl("../assets/images/process.png");require(["DS/PlatformAPI/PlatformAPI"],function(q){h=q});this.addEventListener("updatecomplete",function(q){h.publish("DS/SMAProcPS/modify",{physicalId:q.detail.id})})};j=function(){var q=f(this.simitem.basics);this.set("simitem.$state","is-failing");setTimeout(function(){if(q!==p.WRITEABLE){this.set("simitem.$state","is-readonly")}}.bind(this),4000)},b=function(){var q=this,s=q.eedTicket.ticket,r=q.$.abortExeWs;r.sendRequest({verb:"PUT",headers:{EEDTicket:s,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"},context:q,onComplete:function(t){t.context.set("simitem.latestExecution.state","Aborted")},onError:function(t){var w=this;var v,u=t.context;if(!u||!u.simitem.latestExecution.id||t.xhr.status!==500){return}if(!u.simitem.latestExecution.state||u.simitem.latestExecution.state==="NotStarted"){v=u.globals.mcsWSBaseURL+"/jobinfo/job/"+u.simitem.latestExecution.id+"/Execution/state";v=v+"?State=Done&CC=Canceled&StartDate="+Date.now()+"&EndDate="+Date.now();w.$.abortExeWs.sendRequest({verb:"POST",uri:v,onComplete:function(){if(this.readyState===this.DONE&&this.status===200){u.set("simitem.latestExecution.state","Aborted")}},onError:function(){console.log("Failed to Abort")}})}}.bind(this)})};Polymer({is:"ps-simulation-item",behaviors:[k.DS.SMAProcSP.SPBase,k.DS.SMAProcSP.SPVariableHelper],EXEC_STATE_CODE:d,defaultSimIcon:"../assets/images/process.png",properties:{globals:{type:Object,value:function(){return{eedBaseURL:"",mcsWSBaseURL:""}}},simitem:{type:Object,value:function(){return{attributes:{},basics:{},latestExecution:{}}},notify:true,observer:"simitemChanged",reflectToAttribute:true},simulationFactory:{notify:true}},observers:["_computeGroupClass(simitem.attributes.Simulation Study)","_executionStatusChange(simitem.latestExecution.state)"],ready:n,simitemChanged:e,onMultiSelect:i,clearMultiselect:l,onEEDTicketReady:b,onUpdateError:j,createSimulation:o,abortSimulation:c,_computeTitle:function(r,q){return r+" ("+q+")"},_computeUri:function(r,q){return r+"/execution/"+q+"/cancel"},_computeUri2:function(q,r){return q+"/cos/ticket?physicalid="+r},_computeClass:function(q){return"stateindicator "+d[q]},_computeSrc:function(r,q){return !q.image?r:q.image},_computeGroupClass:function(q){return q?"groupinfo fonticon fonticon-th":"groupinfo"},_executionStatusChange:function(r){if(r==="Initializing"){var q=document.getElementsByTagName("ps-simulation-list")[0];this.parentElement.done();this.simitem.isJobQueued=false;q.removeDragEvent(this);q.addDragEvent(this)}},_computeRevision:function(q){return q.basics.revision==="-"?"":"("+q.basics.revision+")"},_computeReadonlyClass:function(q){return a(q)?"readonly-indicator is-active":"readonly-indicator"},_computeUri3:function(q){if(q){return"simulations/"+q}}})}(this));