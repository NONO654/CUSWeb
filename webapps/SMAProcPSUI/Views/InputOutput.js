define("DS/SMAProcPSUI/Views/InputOutput",["UWA/Core","UWA/Class","UWA/Class/Model","UWA/Utils","DS/Utilities/Dom","DS/Controls/LineEditor","DS/Controls/TooltipModel","DS/Controls/Editor","DS/Controls/Toggle","DS/SMAProcSPUI/Views/ComboBox","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/SMAProcPSUI/Utils/HttpUtil","DS/SMAProcPSUI/Collections/IOCollection","DS/SMAProcPSUI/Views/MultitextEditor","DS/SMAProcPSUI/Views/MultivalueEditor","DS/Controls/DatePicker","DS/WebappsUtils/WebappsUtils","DS/Utilities/Array","css!DS/SMAProcPSUI/Views/InputOutput.css","css!DS/UIKIT/UIKIT.css"],function(UWACore,UWAClass,UWAModel,UWAUtils,DomUtils,WUXLineEditor,WUXTooltipModel,WUXEditor,WUXToggle,WUXComboBox,WUXTooltip,WUXDropdown,TreeListView,TreeDocument,TreeNodeModel,HttpUtil,IOCollection,WUXMultitextEditor,WUXMultivalueEditor,WUXDatePicker,WebappsUtils,ArrayUtils){function stripHTMLTags(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||""}var inputOutputObj;var XControls=UWAClass.extend({_registeredControls:null,_registerControl:function(key,control){if(typeof key==="string"){if(this._registeredControls[key]){this._unregisterControl(key)}this._registeredControls[key]=control;return control}else{throw new Error("Invalid arguments!")}},_unregisterControl:function(key){if(typeof key==="string"){if(this._registeredControls[key]){if(this._registeredControls[key].destroy){this._registeredControls[key].destroy()}delete this._registeredControls[key]}}else{throw new Error("Invalid arguments!")}},_unregisterAll:function(){for(var key in this._registeredControls){if(this._registeredControls.hasOwnProperty(key)){this._unregisterControl(key)}}},init:function(){this._registeredControls={};return this._parent.apply(this,arguments)},createControl:function(id,type,value,model){var control,options=model.toJSON();this._unregisterControl(id);value=!UWACore.is(value)?model.get("value"):value;switch(type){case"lineEditor":control=new WUXLineEditor({placeholder:"edit "+options.title_display,value:value,disabled:options.readonly});control.tooltipInfos=new WUXTooltipModel({longHelp:""});if(model.validationError){control.elements.container.children[0].style.borderColor="red";control.tooltipInfos.longHelp=model.validationError}control.addEventListener("change",function(e){control.elements.container.children[0].style.borderColor="grey";control.tooltipInfos.longHelp="";e.preventDefault();e.stopPropagation();var newValue=e.dsModel.value;control.fire("onChange",{value:newValue})});break;case"toggle":if(UWACore.is(value,"string")){value=(value.toLowerCase()==="true")}control=new WUXToggle({type:"checkbox",checkFlag:value,mixedState:false,disabled:options.readonly});control.addEventListener("change",function(e){e.preventDefault();e.stopPropagation();var newValue=e.dsModel.checkFlag;control.fire("onChange",{value:newValue})});break;case"ComboBox":var choices=options.choices;if(options.value===""){options.choices.unshift("")}control=new WUXComboBox({value:options.value,choices:choices,readonly:options.readonly});control.addEventListener("change",function(e){e.preventDefault();e.stopPropagation();var newValue=e.dsModel.value;control.fire("onChange",{value:newValue})});break;case"datepicker":control=new UWACore.createElement("div",{"class":"datepicker-wrapper",style:{"vertical-align":"top"}});var datepicker=new WUXDatePicker({value:new Date(value),disabled:options.readonly,timePickerFlag:options.syncAssist==="Parameter",timePickerPrecision:options.syncAssist==="Parameter"&&"sec"}).inject(control);datepicker.addEventListener("show",function(e){var inputOutputContainer=document.getElementsByClassName(" wux-controls-input-output")[0];var inputOutputContainerHeight=inputOutputContainer.getDimensions().height;var targetYOffset=e.target.getOffsets().y;setTimeout(function(){var popUpElements=document.querySelectorAll(".wux-controls-popup");Array.prototype.forEach.call(popUpElements,function(elem){var calendarElement=elem.querySelector(".wux-controls-calendar");if(calendarElement!==null&&(inputOutputContainerHeight-targetYOffset)<calendarElement.getDimensions().height){elem.addClassName("reAlign")}})},0)});datepicker.addEventListener("hide",function(){var manager=inputOutputObj.getManager();manager.unselectAll()});datepicker.addEventListener("change",function(e){e.preventDefault();e.stopPropagation();var newValue=e.dsModel.value;var date=new Date(newValue);var newValueinSecs=date.valueOf();datepicker.fire("onChange",{value:newValueinSecs})});break;case"Multitext":control=UWACore.createElement("div",{"class":"borderDiv",value:options.value,text:options.value});new WUXMultitextEditor({target:control,icon:"test",value:options.value,disabled:options.readonly,events:{onHide:function(){var newValue=this._getMapValues();if(options.value!==newValue){control.textContent=newValue;var evt=document.createEvent("Event");evt.initEvent("onChange",true,false);evt.dsModel=this;evt.options={value:newValue};control.dispatchEvent(evt)}}}});break;case"Multivalue":control=UWACore.createElement("div",{"class":"borderDiv",value:options.value,text:options.value});new WUXMultivalueEditor({target:control,icon:"test",value:options.value,choices:options.choices,disabled:options.readonly,events:{onHide:function(){var newValue=this._getMapValues();if(options.value!==newValue){control.textContent=newValue;var evt=document.createEvent("Event");evt.initEvent("onChange",true,false);evt.dsModel=this;evt.options={value:newValue};control.dispatchEvent(evt)}}}});break;case"contentchooser":var objectId=options.chooser_physicalid||options.value,objectTitle=options.value_display||options.title,objectType=options.DummyDocType,readonly=options.readonly||options.datatype==="owned_chooser",parentType=options.type,dummyDocType=options.DummyDocType;control=UWACore.createElement("sp-content-chooser");control.classList.add("wrap");control.objectId=objectId;control.objectTitle=objectTitle;control.objectType=objectType;control.readOnly=readonly;control.disableprop=options.readonly;control.parentType=parentType;control.dummyDocType=dummyDocType;control.syncAssist=options.syncAssist;control.strictMatch=options.syncAssist!=="Parameter";control.reject=["Simulation","Simulation Activity"];if(options.syncAssist==="Parameter"){control.accept="3DShape, Chapter, DesignSight, FEM, GenerativeStress, Material,PLMCoreRepReference, PLMReference, Part, PlmParameter, Products, Requirement, SpotFastener, Test Case, Use Case, VPMReference, XRep, DOCUMENTS, Approximation, Simulation Folder, Test Execution, Workspace Vault"}else{if(options.type!=="DOCUMENTS"){control.accept="3DShape, Chapter, DesignSight, FEM, GenerativeStress, Material,PLMCoreRepReference, PLMReference, Part, PlmParameter, Products, Requirement, SpotFastener, Test Case, Use Case, VPMReference, XRep, Approximation, Test Execution"}else{control.accept="DOCUMENTS"}}control.addEventListener("change",function(e){e.preventDefault();e.stopPropagation();var newValue=e.detail.objectId;var newTitle=e.detail.objectTitle;if(control.syncAssist==="Parameter"){control.fire("onChange",{value:newValue,value_display:newTitle})}else{control.fire("onChange",{value:newValue,title:newTitle,value_display:newTitle})}});control.addEventListener("dropUnsupportedObject",function(){control.fire("onDropUnsupportedObject")});break;case"editor":control=new WUXEditor({icon:"test",maxLength:30,widthInCharNumber:30,value:options.value,disabled:options.readonly});control.addEventListener("change",function(e){e.preventDefault();e.stopPropagation();var newValue=e.dsModel.value;control.fire("onChange",{value:newValue})});break;case"string":var valueDisplay=model.get("value_display");if(UWACore.is(valueDisplay)){value=valueDisplay}control=UWACore.createElement("span",{title:options.Expression||value,text:value});break;default:}if(UWACore.is(control)&&id){this._registerControl(id,control)}return control},destroy:function(){this._unregisterAll()}});var ControlFactory=new XControls();var onValueCellRequest=function(cellInfos){var nodeModel=cellInfos.nodeModel,cellView=cellInfos.cellView,control,data,editor,id,value;cellView.elements.container.setContent(cellView.elements.layout);if(!cellInfos.isHeader){if(nodeModel!==""){data=nodeModel.options.data;editor=nodeModel.options.editor;value=nodeModel.options.grid.value;try{id=data.id+"."+JSON.parse(nodeModel.options.label).join(".")}catch(e){id=data.id}if(!data.get("isHeader")){control=ControlFactory.createControl(id,editor,value,data)}else{control=UWACore.createElement("li")}if(editor!=="contentchooser"){cellInfos.view.draggable=false}}}else{cellInfos.cellView.elements.layout.setContent(UWACore.createElement("li",{text:cellView.getGridEngine().getColumnOptions(cellInfos.virtualColumnID).text,styles:{"font-family":"Arial, Helvetica, sans-serif"}}))}if(UWACore.is(control)&&!cellInfos.isHeader){var view=UWACore.createElement("li",{html:[control],styles:{width:"100%","vertical-align":"middle","padding-left":"5px","padding-right":"5px",overflow:"hidden","text-overflow":"ellipsis"}});view.addEventListener("onDropUnsupportedObject",function(){this.state="not-supported";setTimeout(function(){this.state=""}.bind(this),3000)}.bind(this));view.addEventListener("onChange",function(e){e.preventDefault();e.stopPropagation();if(!e.options){e.options=e.detail}var _model,options;var newOptions={grid:{value:e.options.value}},hasChanged=false;_model=nodeModel.options.data;if(e.options&&UWACore.is(e.options,"object")){for(var _attr in e.options){if(_model.has(_attr)&&e.options.hasOwnProperty(_attr)){options={method:"set"};if(_attr==="value"||_attr==="Expression"){options.validate=true;options.target=e.dsModel?e.dsModel.getContent():e.target}if(_model.get("valuetype")==="array"){options.title=nodeModel.options.label}this._toolTipMap.set(_model.get("id"),"");appData.inputOutputs.errorMap=this._toolTipMap;hasChanged=_model.set(_attr,e.options[_attr],options)}}}if(hasChanged){if(_model.hasChanged("value_display")&&_model.get("syncAssist")==="Parameter"){UWACore.extend(nodeModel.options,{label:_model.get("title")})}else{if(_model.hasChanged("value_display")||_model.hasChanged("title")){UWACore.extend(nodeModel.options,{label:_model.has("value_display")?_model.get("value_display"):_model.get("title")})}}UWACore.extend(nodeModel.options,newOptions,true);cellInfos.cellModel.setCellContent(e.dsModel?e.dsModel.value:e.detail.value);cellInfos.manager.updateRowView(cellInfos.virtualRowID);this._save()}else{nodeModel.options.grid.value=e.dsModel?e.dsModel.value:e.detail.value}}.bind(this));cellInfos.cellView.elements.layout.style.width="100%";cellInfos.cellView.elements.layout.setContent(view)}else{if(cellInfos.cellView.getVirtualCoordinates().virtualRowID>-1){cellInfos.cellView.elements.layout.setContent(UWACore.createElement("li"));cellInfos.view.setAttribute("title","")}}return control};var onModeCellRequest=function(cellInfos){var nodeModel=cellInfos.nodeModel,data,view;if(!cellInfos.isHeader){cellInfos.cellView.elements.container.setContent(cellInfos.cellView.elements.layout);if(nodeModel!==""){data=nodeModel.options.data;if(!data.get("isHeader")){var mode=data.get("mode"),uri;switch(mode){case"Input":uri=WebappsUtils.getWebappsAssetUrl("SMAProcPSUI","images/smaIconInput.gif");view=UWACore.createElement("img",{src:uri});break;case"Output":uri=WebappsUtils.getWebappsAssetUrl("SMAProcPSUI","images/smaIconOutput.gif");view=UWACore.createElement("img",{src:uri});break;case"InputOutput":uri=WebappsUtils.getWebappsAssetUrl("SMAProcPSUI","images/smaIconIO.gif");view=UWACore.createElement("img",{src:uri});break;case"None":view=UWACore.createElement("li",{"class":"wux-ui-fa wux-ui wux-ui-fa-minus",title:"Neutral"});break;default:view=UWACore.createElement("li")}}else{view=UWACore.createElement("li")}}if(UWACore.is(view)){cellInfos.cellView.elements.layout.setContent(view)}}return view};var onActionCellRequest=function(cellInfos){var nodeModel=cellInfos.nodeModel,data,view;if(!cellInfos.isHeader){var cellView=cellInfos.cellView;cellView.elements.container.setContent(cellView.elements.layout);if(nodeModel!==""){data=nodeModel.options.data;if(data.get("isHeader")){var headerType=data.get("headerType");var isAdhocProcess=false;if(appData.simData.activeSimDetails.attributes&&appData.simData.activeSimDetails.attributes["Simulation Kind"]==="adhoc"){isAdhocProcess=true}if(headerType==="Activity"&&!isAdhocProcess){var uri=WebappsUtils.getWebappsAssetUrl("SMAProcPSUI","images/I_SimRun.png");view=UWACore.createElement("img",{src:uri,title:"Start a new job"});view.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();if(!e.options){e.options=e.detail}var _model=nodeModel.options.data;var actId=_model.get("objectId");var title=_model.get("title_display");var event=new CustomEvent("runactivity",{bubbles:true,composed:false,detail:{objectId:actId,title:title}});var content=this.getContent();content.dispatchEvent(event)}.bind(this))}else{view=UWACore.createElement("li")}}else{view=UWACore.createElement("li")}}if(UWACore.is(view)){cellInfos.cellView.elements.layout.setContent(view)}}return view};var nodeBuilder={Simulation:function(model){var label=model.get("title_display"),grid={mode:"",value:"",expression:"",description:""},data=model;var simulationNode=new TreeNodeModel({label:label,grid:grid,data:data});return simulationNode},Activity:function(model){var label=model.get("title_display"),grid={mode:"",value:"",expression:"",description:""},data=model;var activityNode=new TreeNodeModel({label:label,grid:grid,data:data,nodetype:"Activity"});return activityNode},HeaderTitle:function(model){var label=model.get("title_display"),grid={mode:"",value:"",expression:"",description:""},data=model;var activityNode=new TreeNodeModel({label:label,grid:grid,data:data,nodetype:"HeaderTitle"});return activityNode},Parameters:function(model){var label=model.get("title_display"),mode=model.get("mode"),description=model.get("description"),value=model.get("value"),grid={mode:mode,value:value,expression:"",description:description},data=model;var datatype=data.get("datatype"),valuetype=data.get("valuetype"),choices=data.get("choices"),readonly=data.get("readonly"),expression=data.get("Expression"),editor;switch(datatype){case"boolean":editor="toggle";break;case"timestamp":editor="datepicker";break;case"multiline":editor="editor";break;case"real":case"string":case"integer":editor="lineEditor";break;case"chooser":editor="contentchooser";break;case"owned_chooser":editor="contentchooser";break;default:editor=""}if(UWACore.is(choices)){editor="ComboBox"}if(readonly||(expression&&expression.length>0)){editor="string"}var parameterNode=new TreeNodeModel({label:label,grid:grid,data:data,editor:editor,nodetype:"Parameters"});if(valuetype==="array"){var stack=[],out=[],i,tempNode,parsedValue=JSON.parse(value);for(i=parsedValue.length-1;i>=0;i--){stack.push(parsedValue[i])}while(stack.length>0){var poppedItem=stack.pop();if(UWACore.is(poppedItem.children)){for(i=poppedItem.children.length-1;i>=0;i--){stack.push(poppedItem.children[i])}}else{tempNode=new TreeNodeModel({label:poppedItem.arrIndex,grid:{mode:"",value:poppedItem.data,expression:"",description:""},data:data,editor:editor,nodetype:"Parameters"});out.push(tempNode)}}for(i=0;i<out.length;i++){parameterNode._addChildNode(out[i])}parameterNode.options.editor=null}return parameterNode},Attributes:function(model){var label=model.get("title_display"),minimum=model.get("minimum"),maximum=model.get("maximum");if(minimum&&maximum){label=label+" ("+minimum+"-"+maximum+")"}else{if(minimum&&!maximum){label=label+" ("+minimum+" -~)"}else{if(!minimum&&maximum){label=label+" (~ - "+maximum+")"}}}var mode=model.get("mode"),description=model.get("description"),value=model.get("value"),grid={mode:mode,value:value,expression:"",description:description},data=model;var datatype=data.get("datatype"),valuetype=data.get("valuetype"),choices=data.get("choices"),editor;switch(datatype){case"boolean":editor="toggle";break;case"timestamp":editor="datepicker";break;case"multiline":editor="editor";break;case"real":case"string":case"integer":if(choices){editor="ComboBox"}else{editor="lineEditor"}break;default:editor=""}if(valuetype==="multival"){if(UWACore.is(choices)){editor="Multivalue"}else{editor="Multitext"}}var attributeNode=new TreeNodeModel({label:label,grid:grid,data:data,editor:editor,nodetype:"Attributes"});return attributeNode},OwnedContent:function(model){var label=model.get("title"),mode=model.get("mode"),description=model.get("description"),value=model.get("value"),grid={mode:mode,value:value,expression:"",description:description},data=model;var editor="contentchooser";var ownedContent=new TreeNodeModel({label:label,grid:grid,data:data,editor:editor,nodetype:"OwnedContent"});return ownedContent},Content:function(model){var label=model.get("title"),mode=model.get("mode"),description=model.get("description"),value=model.get("value"),grid={mode:mode,value:value,expression:"",description:description},data=model;var editor="contentchooser";var content=new TreeNodeModel({label:label,grid:grid,data:data,editor:editor,nodetype:"Content"});return content}};var InputOutput={name:"InputOutput",publishedProperties:{objectId:{type:String,defaultValue:"",readOnly:false},xsView:{type:Boolean,defaultValue:false,noNeedToApplyFlag:true},state:{type:"string",defaultValue:"",noNeedToApplyFlag:true}},_save:function(){var that=this;this.state="is-updating";this._collection.save({onComplete:function(){setTimeout(function(){that.state=""},2000);that._updateDocument()},onFailure:function(){setTimeout(function(){that.state="";that.refresh(false)},2000);var error=arguments[0].response;if(error){if(error==="Invalid password"){error="Insufficient Access"}}else{error="Failed to Save"}that.fire("appmessage",{level:"error",message:error})},silent:true})},_updateDocument:function(){var changedModels,changedModelIds;changedModels=this._collection.filter(function(model){return model.hasChanged()});changedModelIds=changedModels.map(function(model){return model.get("id")});var allTreeNodes=this._model.getAllDescendants();this._model.prepareUpdate();for(var i=0;i<changedModelIds.length;i++){for(var j=0;j<allTreeNodes.length;j++){if(changedModelIds[i]===allTreeNodes[j].options.data.id){var modifiedGrid=allTreeNodes[j]._options.grid;modifiedGrid.value=eval(allTreeNodes[j]._options.data._changed.value);allTreeNodes[j].updateOptions({grid:modifiedGrid})}}}this._model.pushUpdate()},refreshXSView:function(job){if(this.xsView){var xsPlayer=this.elements.container.querySelector("xs-player");if(xsPlayer){xsPlayer.reload("COS",{eedJobId:job.eedJobId})}}},refresh:function(unload){if(this.xsView){var xsPlayer=this.elements.container.querySelector("xs-player");if(xsPlayer){xsPlayer.reload()}}else{var that=this;if(unload){that._unloadDocument();that._updateView()}else{if(this._collection){this._collection.fetch({reset:true,silent:false,onComplete:function(){that.state=""},onFailure:function(){that.state="is-failing"}})}}}},_loadDocument:function(){var nodeList=[],node,i,model,type,isHeader,parentIndex,isHidden,hasChildren;this._toolTipMap=new Map();appData.inputOutputs={};var gridDocument=new TreeDocument({useAsyncPreExpand:false});this.elements.container.removeClassName("wux-ui-state-ready");this.elements.container.addClassName("wux-ui-state-busy");var collection=this._collection,currentIndex,paraHdrIndex;for(i=0;i<collection.length;i++){model=collection.at(i);isHeader=model.get("isHeader");isHidden=model.get("isHidden");var tmptype=model.get("headerType");if(tmptype){type=tmptype}if(isHeader&&type==="Simulation"){node=nodeBuilder[type](model);nodeList.push(node);gridDocument.addRoot(node);currentIndex=i}else{if(isHeader&&type==="Activity"){node=nodeBuilder[type](model);nodeList.push(node);parentIndex=0;currentIndex=nodeList.length-1;nodeList[parentIndex].addChild(node)}else{if(isHeader&&type==="HeaderTitle"){node=nodeBuilder[type](model);nodeList.push(node);parentIndex=0;nodeList[currentIndex].addChild(node);paraHdrIndex=nodeList.length-1}else{if(!isHeader&&!isHidden){if(type==="Parameters"){node=nodeBuilder[type](model);if(!(node._options.data._attributes.Expression==="")&&(node._options.data._attributes.datatype==="real"||node._options.data._attributes.datatype==="integer")){node._options.grid.value=eval(node._options.grid.value)}nodeList.push(node);nodeList[paraHdrIndex].addChild(node)}else{if(type==="Attributes"){node=nodeBuilder[type](model);nodeList.push(node);nodeList[paraHdrIndex].addChild(node)}else{if(type==="OwnedContent"){node=nodeBuilder[type](model);nodeList.push(node);nodeList[paraHdrIndex].addChild(node)}else{if(type==="Content"){node=nodeBuilder[type](model);nodeList.push(node);nodeList[paraHdrIndex].addChild(node)}}}}}}}}}for(i=nodeList.length-1;i>0;i--){node=nodeList[i];hasChildren=node.hasChildren();isHeader=node.options.data.get("isHeader");if(!hasChildren&&isHeader&&!this.haveSteps(node.options.data.get("sequence"))){node.remove()}}this._model=gridDocument;inputOutputObj=this.elements._treeListView;this.elements._treeListView.getManager().loadDocument(this._model);setTimeout(function(){this._model.expandNLevels()}.bind(this),80);setTimeout(function(){this.elements.container.removeClassName("wux-ui-state-busy");this.elements.container.addClassName("wux-ui-state-ready");DomUtils.removeResizeListener(this.elements._treeListView.getManager().elements.container,this.elements._treeListView.getManager()._endResizeCallback)}.bind(this),50)},haveSteps:function(sequence){var i;if(appData.simData.exeOptions.length===0){return false}for(i=0;i<appData.simData.exeOptions.length;i++){if(appData.simData.exeOptions[i].sequence===sequence){i++;for(i=i;i<appData.simData.exeOptions.length&&!appData.simData.exeOptions[i].hasOwnProperty("sequence");i++){if(appData.simData.exeOptions[i].hasOwnProperty("extensionName")){return true}}return false}}return false},_unloadDocument:function(){if(this.xsView){this.elements.xsPlayerContainer.remove();this.elements.xsPlayerContainer=null}else{this.elements._treeListView.getManager().unloadDocument();this._model=null;this.elements._treeListView.destroy();this.elements.topHeader.destroy();this.elements.body.destroy();ControlFactory._unregisterAll();if(this._collection){this._collection.destroy();this._collection=null}this.elements.container.empty()}},_onCollectionModify:function(){},_onValidationError:function(model,errorMessage,options){this._toolTipMap.set(model.get("id"),errorMessage);appData.inputOutputs.errorMap=this._toolTipMap;options.target.children[0].style.borderColor="red";options.target.dsModel.tooltipInfos.longHelp=errorMessage},_onCollectionReset:function(){this._loadDocument()},_updateView:function(){if(this.xsView){this._buildXStudioView()}else{this._buildStudyView()}},_buildXStudioView:function(){var spDashboard=UWACore.createElement("sp-dashboard"),xsPlayer=spDashboard.resolveUrl("../../SMAProcXSUI/xs-player/xs-player.html");Polymer.Base.importHref([xsPlayer],function(){var xsPlayer=UWACore.createElement("xs-player");this.elements.container.classList.add("xs-player-container");this.elements.xsPlayerContainer=UWACore.createElement("div",{"class":"xs-player-container"}).inject(this.elements.container);xsPlayer.simid=this.objectId;this.elements.xsPlayerContainer.addContent(xsPlayer);this.elements.xsPlayerContainer.inject(this.elements.container)}.bind(this))},_buildStudyView:function(){var that=this,elements=this.elements;if(elements.xsPlayerContainer){elements.xsPlayerContainer.destroy();elements.xsPlayerContainer=null}elements.container.addClassName("wux-controls-input-output");elements.topHeader=new UWACore.createElement("div",{"class":"wux-controls-input-output-topheader"}).inject(elements.container);this._model=new TreeDocument({useAsyncPreExpand:false});var uri=WebappsUtils.getWebappsAssetUrl("SMAProcPSUI","images/smaIconIO.gif");var columns=[{text:"Title",dataIndex:"tree",width:"40%",isDraggable:false},{text:"<img src="+uri+"></img>",dataIndex:"mode",width:24,onCellRequest:onModeCellRequest,isDraggable:false},{text:"Value",dataIndex:"value",width:"30%",onCellRequest:onValueCellRequest.bind(this),isDraggable:true},{text:"Description",dataIndex:"description",width:"auto",isDraggable:false}];var wrtieAccess=false;if(this.access){if(this.access.locked==="FALSE"||((this.access.locked==="TRUE"&&this.access.lockedByCurrentUser==="TRUE"))){if(this.access.modifyMask==="TRUE"){wrtieAccess=true}}}if(wrtieAccess){var actionColumn={text:"Run",dataIndex:"action",width:37,onCellRequest:onActionCellRequest,isDraggable:false};columns.splice(1,0,actionColumn)}this.elements._treeListView=new TreeListView({columns:columns,defaultCellHeight:40,resize:{rows:false,columns:true},showVerticalLines:false,useTransparentScroller:false,alternateRowColor:false,isEditable:false,iconsSize:22,isSortable:false,show:{rowHeaders:false,columnHeaders:true},selection:{cells:false,rowHeaders:false,columnHeaders:false,canMultiSelect:false,useUnselectAllOnEmptyArea:true},showLoaderIndicator:true,shouldAcceptDrag:function(dndInfos){var editor=dndInfos.nodeModel.options.editor;return editor==="contentchooser"},onDragStartCell:function(event,dndInfos){var cellView=dndInfos.cellView;cellView._isDragging=true;var control=cellView.getWriteView(),cellCoord=dndInfos.cellView.getVirtualCoordinates(),localOptions=dndInfos.cellView.getGridEngine().getColumnOptions(cellCoord.virtualColumnID),editor=dndInfos.nodeModel.options.editor,jsonResponse;if(localOptions.dataIndex==="value"&&editor==="contentchooser"){control.dispatchEvent("onDragStart");jsonResponse=control.getDragAndDropInfos();event.dataTransfer.effectAllowed="all";event.dataTransfer.setData("text",JSON.stringify(jsonResponse))}else{event.dataTransfer.effectAllowed="none"}return false},onDragEnterCell:function(event,dndInfos){var cellView=dndInfos.cellView;cellView._isDragging=true;var control=cellView.getWriteView(),readonly=control?control.readonly:true,cellCoord=dndInfos.cellView.getVirtualCoordinates(),localOptions=dndInfos.cellView.getGridEngine().getColumnOptions(cellCoord.virtualColumnID),editor=dndInfos.nodeModel.options.editor;if(localOptions.dataIndex!=="value"||editor!=="contentchooser"||readonly){event.dataTransfer.dropEffect="none"}return false},onDragOverCell:function(event,dndInfos){var cellView=dndInfos.cellView,control=cellView.getWriteView(),readonly=control?control.readonly:true,cellCoord=dndInfos.cellView.getVirtualCoordinates(),localOptions=dndInfos.cellView.getGridEngine().getColumnOptions(cellCoord.virtualColumnID),editor=dndInfos.nodeModel.options.editor;if(localOptions.dataIndex!=="value"||editor!=="contentchooser"||readonly){event.dataTransfer.dropEffect="none"}return false},onDropCell:function(event,dndInfos){var cellView=dndInfos.cellView,control=cellView.getWriteView(),readonly=control?control.readonly:true,cellCoord=dndInfos.cellView.getVirtualCoordinates(),localOptions=dndInfos.cellView.getGridEngine().getColumnOptions(cellCoord.virtualColumnID),editor=dndInfos.nodeModel.options.editor;if(localOptions.dataIndex==="value"&&editor==="contentchooser"&&!readonly){control.dispatchEvent("onDrop",[event])}return false},onDragEndCell:function(event,dndInfos){var cellView=dndInfos.cellView,control=cellView.getWriteView(),cellCoord=dndInfos.cellView.getVirtualCoordinates(),localOptions=dndInfos.cellView.getGridEngine().getColumnOptions(cellCoord.virtualColumnID),editor=dndInfos.nodeModel.options.editor;if(localOptions.dataIndex==="value"&&editor==="contentchooser"){control.dispatchEvent("onDragEnd")}return false},shouldDisplayTooltip:function(cellInfos){if(cellInfos.dataIndex==="tree"&&!cellInfos.isHeader){return{longHelp:stripHTMLTags(cellInfos.nodeModel.options.label)}}else{var value=cellInfos.cellModel.options.value;var options=cellInfos.nodeModel.options;if(value!==null&&value!==undefined&&options&&options.editor&&options.editor!==null){var expression=options.data?options.data.get("Expression"):undefined;if(options.editor==="datepicker"&&cellInfos.dataIndex==="value"){if(value&&value!==""){var inputTime=parseInt(value,10),inDate=new Date(inputTime),dtFormatted=inDate.toDateString();return{longHelp:dtFormatted}}else{return{longHelp:""}}}else{if(options.editor==="contentchooser"&&cellInfos.dataIndex==="value"){var title=options.data.get("title"),valueDisplay=options.data.get("value_display");return{longHelp:valueDisplay||title||""}}}if(typeof value==="string"){return{longHelp:expression||value}}else{if(value.toString){return{longHelp:expression||value.toString()}}else{return{longHelp:""}}}}else{if((cellInfos.dataIndex==="mode"||cellInfos.dataIndex==="action")&&cellInfos.isHeader){if(cellInfos.dataIndex==="action"){return{longHelp:"Run"}}else{if(cellInfos.dataIndex==="mode"){return{longHelp:"Mode"}}}}else{if(value===undefined||value===null){return{longHelp:""}}else{return{longHelp:value}}}}}return{longHelp:""}},height:"auto",apiVersion:"2"});this.elements._treeListView.elements.container.addClassName("wux-controls-input-output-treelistview");this.elements.body=new UWACore.createElement("div",{"class":"wux-controls-input-output-body",html:[{tag:"div",styles:{position:"relative",height:"100%"},html:this.elements._treeListView}]});this.elements._treeListView.onNodeClick(function(){var cellInfo=arguments[0];if(!cellInfo.isHeader){if(cellInfo.columnID===0&&cellInfo.nodeModel.hasChildren()){if(!cellInfo.nodeModel.isExpanded()){cellInfo.nodeModel.expand()}else{cellInfo.nodeModel.collapse()}}}});var searchView=document.createElement("input");searchView.setAttribute("type","text");searchView.setAttribute("placeholder","Search by title");searchView.setAttribute("id","iosearch");searchView.className="wux-controls-input-text";var matchedNodesList=[],to,searchTimeOut,menuTimeOut,TYPE=["Parameters","Attributes","Owned Content","Simulation Referenced Content"];var search=function(value,searchString){that._model.prepareUpdate();ArrayUtils.optimizedForEach(matchedNodesList,function(node){node.unmatchSearch()});matchedNodesList=that.elements._treeListView.getManager().search({shouldStop:function(){return false},match:function(nodeInfos){if(searchString){if(nodeInfos.nodeModel.options.label===searchString){return true}}else{if(value){if(nodeInfos.nodeModel.options.label.toUpperCase().indexOf(value.toUpperCase())!==-1){return true}}}return false}});ArrayUtils.optimizedForEach(matchedNodesList,function(node){node.matchSearch();node.reverseExpand()});that._model.pushUpdate();if(matchedNodesList.length>0){that.elements._treeListView.getManager().scrollToNode(matchedNodesList[0])}menuTimeOut=setTimeout(function(){if(that.menu){that.menu.destroy();that.menu=null}},2000)};var clear=function(){if(matchedNodesList.length>0){that._model.prepareUpdate();ArrayUtils.optimizedForEach(matchedNodesList,function(node){node.unmatchSearch()});that._model.pushUpdate()}};searchView.addEventListener("keyup",function(e){var value=searchView.value;clearTimeout(to);clearTimeout(menuTimeOut);if(e.keyCode===13){if(that.menu){that.menu.destroy();that.menu=null}search(value)}else{to=setTimeout(function(){if(that.menu){that.menu.destroy();that.menu=null}var items=[],searchString,collection=that._collection;if(value){searchTimeOut=setTimeout(function(){search(value)},2500);if(value.length>2){for(var i=0;i<collection.length;i++){var model=collection.at(i);var title=model.get("title_display");if(!title){title=model.get("title")}if(TYPE.indexOf(title)===-1){if(value&&title.toUpperCase().indexOf(value.toUpperCase())!==-1){var matchFound=false;for(var j=0;j<items.length;j++){if(items[j].text===title){matchFound=true;break}}if(!matchFound){items.push({text:title,name:String(i)})}}}}if(items.length>0){that.menu=new WUXDropdown({target:searchView,items:items,events:{onClick:function(e,item){clearTimeout(searchTimeOut);searchString=item.text;searchView.value=item.text;if(that.menu){that.menu.destroy();that.menu=null}search(value,searchString)}}});that.menu.show()}}}else{clear()}},1000)}});elements.topHeader.appendChild(searchView);this.elements.body.inject(this.elements.container);this._collection=new IOCollection({url:function(){return"simulations/"+that.objectId+"/iosummaryview"},events:{onReset:function(){that.dispatchEvent("_onCollectionReset",UWAUtils.toArray(arguments))},onChange:function(){that.dispatchEvent("_onCollectionModify",UWAUtils.toArray(arguments))},onValidationFailure:function(){that.dispatchEvent("_onValidationError",UWAUtils.toArray(arguments))}}});this.state="is-getting";this._collection.fetch({reset:true,silent:false,onComplete:function(){that.state=""},onFailure:function(){that.state="is-failing"}})},_applyProperties:function(oldObject){var that=this,emptyContainer,options={};var redoView=this.isDirty("objectId")&&(UWACore.is(that.objectId)&&that.objectId.length>0);if(redoView){emptyContainer=(UWACore.is(oldObject.objectId)&&oldObject.objectId.length>0);if(emptyContainer){that._unloadDocument()}options.url="simulations/"+that.objectId+"/view";options.onComplete=function(httpRequest){var resp=httpRequest.response;var status=httpRequest.status;if(status===204||typeof resp==="string"){that.xsView=false}else{if(typeof resp==="object"&&resp.templateviewdefinition){that.xsView=true}}};options.onFailure=function(){that.xsView=false};options.alwaysCallback=function(){that._updateView()};HttpUtil.get(options.url,undefined,options.onComplete,options.onFailure,options.alwaysCallback)}}};return InputOutput});