var model;define("DS/SMAProcPSUI/Views/JobsTable",["UWA/Core","UWA/Element","UWA/Controls/Abstract","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/Button","DS/Core/PointerEvents","DS/SMAProcSPUI/Views/RulesEditor","css!DS/SMAProcPSUI/Views/JobsTable.css"],function(e,b,i,g,a,f,j,h,d){var c=i.extend({className:"jobsTable",isDestroyed:false,onLoad:function(){var l=this.options;var o=this;if(l.data&&l.data.length>0){model=new a({useAsyncPreExpand:true});model.prepareUpdate();for(var k=0;k<l.data.length;k+=1){var p=new f({label:k,grid:l.data[k]});model.addRoot(p);p=null}model.pushUpdate();var q={columns:[{text:"",dataIndex:"selection",type:"selection",width:30},{dataIndex:"title",text:"Title",isFilterable:true,width:"16%"},{dataIndex:"remarks",text:"Status",isFilterable:true,width:"16%"},{dataIndex:"startDate",text:"Start Date",width:"19%"},{dataIndex:"endDate",text:"End Date",width:"19%"},{dataIndex:"owner",text:"User",isFilterable:true,width:"10%"},{dataIndex:"description",text:"Description",isFilterable:true,width:"16%"},{text:"",dataIndex:"objectId",width:0}],apiVersion:2,enableActiveUI:true,enableDragAndDrop:false,enableKeyboardNavigation:true,showLoaderIndicator:true,performances:{buildLinks:false,renderingMode:"adaptive"},height:300,showVerticalLines:true,useTransparentScroller:false,showScrollbarsOnHover:false,alternateRowColor:false,defaultCellHeight:30,isEditable:false,iconsSize:22,isSortable:true,selection:{nodes:true,cells:false,rowHeaders:true,columnHeaders:true,unselectAllOnEmptyArea:true,toggle:true,canMultiSelect:true},show:{rowHeaders:false,columnHeaders:true},resize:{rows:false,columns:true}};o.spreadsheet=new g(q);var m=this.spreadsheet.getManager();m.onReady(function(){m.loadDocument(model);var r=m.options.columns[0].dataIndex;m.hideColumn(r);o.buildToolbar(l);o.createRulesEditor(l)});o.spreadsheet.inject(l.container)}else{var n="";if(l.viewJob==="Owned"){n='No jobs started by you from this process.\n Select "Show all" to view jobs started from this process by other users.'}else{n="No jobs submitted from this process."}e.createElement("span",{text:n}).inject(l.container)}},buildToolbar:function(l){var o=this;o.toolbar=new e.Element("div",{"class":"innertoolbar"}).inject(l.toolbarDiv);var n=[{action:function(){var q=[],p=[];o.spreadsheet.getManager().getSelectedRows().forEach(function(s){var r=o.spreadsheet.getManager().getCell(s,"objectId").getCellContent();p.push(s);q.push(r)});o.dispatchEvent("JobsDeleted",[q,p])},label:"Delete",icon:{fontIconFamily:1,iconName:"list-delete",fontIconSize:"1x"}},{action:function(){var p=[];o.spreadsheet.getManager().getSelectedRows().forEach(function(r){var q=o.spreadsheet.getManager().getCell(r,"objectId").getCellContent();p.push(q)});o.dispatchEvent("OpenMonitor",[p])},label:"Log",icon:{fontIconFamily:1,iconName:"menu",fontIconSize:"1x"}},{action:function(){var p=[];o.spreadsheet.getManager().getSelectedRows().forEach(function(r){var q=o.spreadsheet.getManager().getCell(r,"objectId").getCellContent();p.push(q)});o.dispatchEvent("Download",[p])},label:"Download",icon:{fontIconFamily:1,iconName:"download",fontIconSize:"1x"}},{action:function(){var p=[];o.spreadsheet.getManager().getSelectedRows().forEach(function(r){var q=o.spreadsheet.getManager().getCell(r,"objectId").getCellContent();p.push(q)});o.dispatchEvent("RunAnalytics",[p])},label:"Run Analytics",icon:{fontIconFamily:1,iconName:"export",fontIconSize:"1x"}},{action:function(){var p=[];o.spreadsheet.getManager().getSelectedRows().forEach(function(r){var q=o.spreadsheet.getManager().getCell(r,"objectId").getCellContent();p.push(q)});o.dispatchEvent("RunAnalyticsAs",[p])},label:"Run Analytics As",icon:{fontIconFamily:1,iconName:"export",fontIconSize:"1x"}},{action:function(){var s=o.toolbar.children;var p=[];for(var r=0;r<s.length;r+=1){var q=s[r].dsModel?s[r].dsModel.label:"";if(q==="Show Owned"){p.push(l.owner);s[r].dsModel.label="Show All";break}else{if(q==="Show All"){s[r].dsModel.label="Show Owned";break}}}o.rulesEditor.buildRule("owner",p,"select",true);o.rulesEditor._applyRules(0)},label:"Show Owned",icon:{fontIconFamily:1,iconName:"user",fontIconSize:"1x"}}];n.forEach(function(r){r=e.extend({type:"button"},r);var p=r.label;if(p.indexOf("Run Analytics")>-1){if(l.haslicRA!=="true"||l.processType==="adhoc"||l.isInDashboard){return}}var q=new j({label:r.label,icon:r.icon,id:r.label,type:r.primary?"primary":""}).inject(o.toolbar);q.getContent().addEventListener(h.POINTERUP,function(){setTimeout(function(){r.action.call(q,r)},1)});r["@view"]=q});n=o.toolbar.children;for(var m=0;m<n.length;m+=1){var k=n[m].dsModel?n[m].dsModel.label:"";if(k==="Show "+l.viewJob){n[m].setStyle("display","none");break}}},createRulesEditor:function(k){var m=this;var l=new e.Element("div",{"class":"innertoolbar spreadsheet-header"}).inject(k.toolbarDiv);this.rulesEditor=new d({spreadsheet:this.spreadsheet,container:l,jobObjectId:this.options.jobObjectId,show:{download:false,tablePreferences:false,subscription:false},events:{onSearchEnd:function(s){var r=s.reset;if(r){var q=m.toolbar.children;for(var p=0;p<q.length;p+=1){var o=q[p].dsModel?q[p].dsModel.label:"";if(o==="Show All"){var n=[];n.push(k.owner);m.rulesEditor.buildRule("owner",n,"select",true);m.rulesEditor._applyRules(0);break}}}}}})},init:function(k){this._parent(k);this.onLoad()},destroy:function(){this.isDestroyed=true;if(this.spreadsheet){this.spreadsheet.getManager().unloadDocument();this.spreadsheet.destroy();this.spreadsheet=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.rulesEditor){this.rulesEditor.destroy();this.rulesEditor=null}this._parent()}});return c});