(function(j){var q={variable:"sp-variable"},i={SIMCONTENTREADY:"simcontentready",JOBSTATUSCHANGE:"jobstatuschange"},w=function(B){switch(B){case"contents":this.$.psjoblog.resetInterval();this.$.fileMonitorView.resetInterval();this.$.psparamhistory.resetInterval();this.$.pssimcontent.load();break;case"log":this.$.psparamhistory.resetInterval();this.$.fileMonitorView.resetInterval();var y=j.innerHeight-190;this.$.psjoblog.height=y;this.$.psjoblog.simId=this.objectId;var z=["Aborted","Completed","Failed","Canceled","System Failed","Initializing","NotStarted"];if(z.indexOf(this.jobExecutionStatus)>-1||this.jobExecutionStatus===null||this.jobExecutionStatus===undefined||this.jobExecutionStatus===""){if(this.cachedjobObjectId!==this.jobObjectId||this.$.psjoblog.logLength===0||this.partialLog){this.$.psjoblog.cosServerId=this.cosServerId;this.$.psjoblog.getJobLog();this.partialLog=false;this.fetchLogsWhenDone=false;this.cachedjobObjectId=this.jobObjectId}}else{var A=["Running","Waiting","Started","Queued"];if(A.indexOf(this.jobExecutionStatus)>-1){if(!this.$.psjoblog.jobLogFlag){this.partialLog=true;this.$.psjoblog.resetInterval();this.$.psjoblog.startInterval();this.fetchLogsWhenDone=true;this.cachedjobObjectId=this.jobObjectId}}else{if(this.jobExecutionStatus==="Paused"){this.$.psjoblog.refreshJobLog();this.$.psjoblog.resetInterval()}else{if(this.jobExecutionStatus==="Done"&&this.fetchLogsWhenDone){this.fetchLogsWhenDone=false;this.$.psjoblog.getJobLog();this.partialLog=false}}}}break;case"files":this.$.psjoblog.resetInterval();this.$.psparamhistory.resetInterval();this.$.fileMonitorView.startInterval();break;case"history":this.$.psjoblog.resetInterval();this.$.fileMonitorView.resetInterval();this.$.psparamhistory.startInterval();break;case"details":this.$.psjoblog.resetInterval();this.$.fileMonitorView.resetInterval();this.$.psparamhistory.resetInterval();this.$.simulationProp.getData();break;default:}},b=function(){var A=new XMLHttpRequest(),z=this.$.eedBaseURL.getValue(),y=z+"/admin/runAsEnabled";A.parent=this;if(z){A.open("GET",y,true);A.setRequestHeader("Accept","application/json, */*; q=0.01");A.setRequestHeader("EEDTicket",this.eedTicket);A.onreadystatechange=function(){if(A.readyState!==4){return}switch(A.status){case 200:appData.isRunAsEnabled=A.response;this.checkForCachedCredentials();break;default:break}}.bind(this);A.send()}},f=function(){if(this.eedTicketData.ticket){this.eedTicket=this.eedTicketData.ticket;b.call(this)}},l=function(){return new Promise(function(D,C){var z=this.$.eedBaseURL.getValue();if(z){var B=z+"/admin/station/query?ActiveOnly=true&DRMMode=fiper";var E=function(G){var I=[];var F=JSON.parse(G.response);var J=F.StationList.Station;if(J.length>1){J.forEach(function(K){var L={};L.name=K["@name"];L.status=K["@status"];L.os=K.GeneralInfo["@os"];L.disableRunAs=K.GeneralInfo["@disableRunAs"];I.push(L)})}else{var H={};H.name=J["@name"];H.status=J["@status"];H.os=J.GeneralInfo["@os"];H.disableRunAs=J.GeneralInfo["@disableRunAs"];I.push(H)}appData.stationList=I;D()};var A=function(F){console.log("unable to get Station list",F);C(F)};var y={uri:B,onComplete:E,onError:A};this.$.stationList.sendRequest(y)}}.bind(this))},s=function(z){var A=z.detail.currentTab;var y=["details","contents","log","history","files"];if(y.indexOf(A)!==-1){w.call(this,A);z.stopPropagation()}},p=function(z){var y=z.target.latestJob;if(this.tab==="log"){this.$.psjoblog.refreshJobLog()}this.jobExecutionStatus=y?y.status:null;this.jobTitle=y?y.title:"";this.$.pssimcontent.refresh(false);this.$.simulationProp.getData()},v=function(){if(this.$.xsView.data){this.templateDefinition=Boolean(this.$.xsView.data.templateviewdefinition)}},m=function(z){z.stopPropagation();var y=z.detail,A=false;this.jobExecutionTime={};this.jobExecutionTime.startTimeMillis=y.startTimeMillis;this.jobExecutionTime.endTimeMillis=y.endTimeMillis;if(z.detail.status==="Initializing"){this.$.psparamhistory.$.psXYPlot.plotData={}}this.eedjobId=y?y.eedJobId:null;this.jobExecutionStatus=y?y.status:null;this.jobObjectId=y?y.objectId:null;this.cosServerId=y?y.eedServerName:null;this.jobTitle=y?y.title:"";if(z.target.latestJob instanceof Object&&Object.keys(z.target.latestJob).length!==0&&y instanceof Object&&Object.keys(y).length!==0&&z.target.latestJob.eedJobId!==y.eedJobId){if(this.tab==="contents"||this.tab==="details"){this.$.facets.switchFacet("log")}this.$.facets.disableFacet("contents");this.$.facets.disableFacet("details");A=true}else{this.fire(i.JOBSTATUSCHANGE,y);this.$.facets.enableAllFacets()}if(this.tab==="log"||this.tab==="history"||this.tab==="files"||A){w.call(this,this.tab)}},r=function(){if(this.session&&this.session.clearAllExecutionDirectories){this.session.clearAllExecutionDirectories()}},u=function(A){var z=this.jobList&&this.jobList[0]&&this.jobList[0].eedJobId;var y=this.jobExecutionStatus==="Done"||this.jobExecutionStatus==="Running"&&z===A.detail.eedJobId;this.fetchLogsWhenDone=true;if(this.activesim&&this.activesim.attributes["Simulation Kind"]!=="adhoc"&&!y){this.stopJobMonitor();this.$.fileMonitorView.session=this.session;this.$.fileMonitorView.refresh();this.$.fileMonitorView.closeTailWindow()}this.$.psjoblog.resetInterval();m.call(this,A)},d=function(){if(this.activesim){this.refreshio=true;this.$.simulationProp.getData();this.$.xsView.success=[200,201,204];this.$.xsView.getData();this.$.psSimDesc.getJobData();this.$.psSimDesc.$.imageurl.uri=this.$.mcsBaseURL.getValue()+"/resources/e6w/service/SMA_ImageUrl?objectId="+this.simulation.id+"&imageSize=Small";this.$.psSimDesc.$.imageurl.getData();this.getStationList().then(function(){this.getPrivateStationInfo();this.$.exeOptWs.getData()}.bind(this))}},g=function(){if(this.activesim&&this.objectId!==this.activesim.id){var A=this.DOM(this).find("#execdirView").root[0];if(A){this.DOM(this).find("#execdirView").root[0].remove()}appData.simData.simulationId=this.activesim.id;appData.encryptedCredsForSelectedProcess={};var z={};z.attributes=this.activesim.attributes;z.basics=this.activesim.basics;appData.simData.activeSimDetails=z;appData.simData.exeOptions=[];appData.inputOutputs={};this.$.psSimDesc.disableRunAs();appData.simData.oldSimulationId=this.objectId;this.objectId=this.activesim.id;this.$.simulationProp.getData();this.$.xsView.success=[200,201,204];this.$.xsView.getData();this.templateDefinition=false;this.$.exeOptWs.getData();this.ioObjectId=null;this.cachedjobObjectId=undefined;this.fetchLogsWhenDone=true;this.$.fileMonitorView.closeTailWindow();this.$.fileMonitorView.resetInterval();this.stopJobMonitor();var y;if(this.activesim.attributes){if(this.activesim.attributes["Simulation Kind"]==="adhoc"){y=new j.DS.SMAProcADUI.ADSession();y.queryProcessID=this.objectId}else{y=new j.DS.SMAProcPSUI.PSProcess();y.process=this.activesim}this.session=y}}},x=function(){var y=this.$.psSimDesc;if(y.getElementsByClassName("credentialsRequired").length>0){y.getElementsByClassName("credentialsRequired")[0].classList.add("hide");y.querySelector("#runNew").disabled=false}},t=function(){var y=this.$.psSimDesc;y.getElementsByClassName("credentialsRequired")[0].classList.remove("hide");y.querySelector("#runNew").disabled=true},h=function(){x.call(this);if(appData.isRunAsEnabled==="true"){var y=appData.simData.stationNames;if(y.length>=0){y.forEach(function(A){for(var z=0;z<appData.stationList.length;z++){if(A.toUpperCase()===appData.stationList[z].name.toUpperCase()){if(appData.stationList[z].disableRunAs!=="disabled"){var B=appData.stationList[z].os;if(B.toUpperCase()==="UNIX"){B="linux"}if(sessionStorage.getItem(B.toLowerCase()+"Encrypted")===null){t.call(this);break}}}}}.bind(this))}if(appData.simData.isIsightConfigured==="true"){if(sessionStorage.getItem("isightEncrypted")===null){t.call(this)}}}},c=function(){appData.simData.exeOptions=this.exeOpt;this.asyncFire("event-manager",{name:"exeoptions-changed",data:this.exeOpt});appData.simData.stationNames=[];appData.simData.operatingStystems=[];var y=this.exeOpt&&this.exeOpt.forEach(function(z){if(z.title==="StationName"&&z.value!==""){var A=z.value;if(A.indexOf(" ")>0){var B=A.split(" ");B.forEach(function(C){if(appData.simData.stationNames.indexOf(C)<0){appData.simData.stationNames.push(C)}})}else{if(appData.simData.stationNames.indexOf(z.value)<0){appData.simData.stationNames.push(z.value)}}}if(z.title==="OperatingSystem"&&z.value!==""){if(appData.simData.operatingStystems.indexOf(z.value)<0){appData.simData.operatingStystems.push(z.value)}}});this.$.psSimDesc.enableRunAs();h.call(this)},n=function(){this.$.cosServer.getPrivateStationInfo({onComplete:function(z){for(var y=0;y<z.length;y++){if(this.$.cosServer.getUrlForServer().contains(z[y].info.cosid)){var A={name:"{localhost}",os:z[y].info.os,status:z[y].info.status,disableRunAs:"disabled"};appData.stationList.push(A)}}}.bind(this),onFailure:function(){}})},a=function(y){this.$.facets.switchFacet("log");y.stopPropagation()},e=function(y){this.$.pssimcontent.refreshXSView(y)},o=function(A){var z={},B,y;if(!A.detail){if(A.options){A.detail=A.options}else{return}}if(A.detail.level!=="clear-urgent"&&A.detail.level!=="clear-status"){z.type=A.detail.level;z.text=A.detail.message;if(A.detail.level==="success"||A.detail.level==="info"){z.autoRemove=true}B=A.detail.category;if(typeof B!=="undefined"&&B&&B.length>0){y=this._categoryMessages[B];if(y){y=this.$.notificationMessages.logMessage(z,y)}else{this.$.notificationMessages.logMessage(z)}this._categoryMessages[B]=y}else{this.$.notificationMessages.logMessage(z)}}A.stopPropagation()},k=function(){if(this.simulation){if(!this.$.inDashBoard.getValue()){this.fire("attributeschange",this.simulation.attributes)}this.$.pssimcontent.access=this.simulation.basics;this.$.pssimcontent.objectId=this.objectId;appData.simData.isIsightConfigured=this.simulation.IsightAdapterConfiguredForEE;if(this.tab==="contents"){if(this.refreshio){this.$.pssimcontent.refresh(true);this.refreshio=false}else{this.$.pssimcontent.load()}}}};Polymer({is:"ps-simulation-contents",properties:{activesim:{notify:true,observer:"activesimChanged"},eedBaseURL:{notify:true},eedjobId:{type:String,value:"",notify:true},globals:{type:Object,value:function(){return{}}},jobTitle:{type:String,value:"",notify:true},jobExecutionStatus:{type:String,value:"",notify:true},jobObjectId:{value:null,notify:true},objectId:{value:null,notify:true},session:{value:null,notify:true},simulation:{type:Object,value:function(){return{}}},updatesPending:{type:Object,notify:true,value:function(){return{}}},jobExecutionTime:{type:Object,notify:true,value:function(){return{}}}},listeners:{datadirty:"updatesPendingChanged"},attached:function(){this.async(function(){var B=this;this._categoryMessages={specialChars:"MESSAGE01",processDataFail:"MESSAGE02"};this.DOM(this).find(q.variable).forEach(function(D){B.globals[D.name]=D.getValue()});this.$.psSimDesc.addEventListener("appmessage",o.bind(this));this.$.pssimcontent.addEventListener("appmessage",o.bind(this));this.$.psSimDetails.addEventListener("appmessage",o.bind(this));this.$.psparamhistory.addEventListener("appmessage",o.bind(this));this.$.psSimDetails.addEventListener("updateSimulation",k.bind(this));this.$.fileMonitorView.addEventListener("appmessage",o.bind(this));this.$.psSimDesc.addEventListener("jobstatuschange",m.bind(this));this.$.psSimDesc.addEventListener("jobchange",u.bind(this));this.$.psSimDesc.addEventListener("jobfinished",p.bind(this));this.$.psSimDesc.addEventListener("openmonitor",a.bind(this));this.$.psSimDesc.addEventListener("newjob",e.bind(this));this.$.psSimDetails.addEventListener("exeOptionsUpdate",h.bind(this));this.$.psSimDesc.$.runAsModal.addEventListener("exeOptionsUpdate",h.bind(this));var y=document.querySelector("#simAbstractList #runAsModal");y&&y.addEventListener("exeOptionsUpdate",h.bind(this));this.fire(i.SIMCONTENTREADY);var C=function(){var D=this.$.cosServer.getUrlForDefaultServer();this.$.eedBaseURL.setValue(D);this.getStationList().then(function(){this.getPrivateStationInfo()}.bind(this));this.$.eedTicketWs.getData()}.bind(this),A=function(){console.log("unable to get eedBaseUrl")};var z=this.$.cosServer.getUrlForDefaultServer();if(!z){this.$.cosServer.getCosConfiguration({onComplete:C,onFailure:A})}else{this.$.eedBaseURL.setValue(z);this.getStationList().then(function(){this.getPrivateStationInfo()}.bind(this));this.$.eedTicketWs.getData()}})},updatesPendingChanged:function(y){this.updatesPending=y.detail},_computeUriOfExeOptions:function(y){return"simulations/"+y+"/executionoptions"},onAppMessage:function(){return o.apply(this,arguments)},onViewReady:function(){return v.apply(this,arguments)},activesimChanged:function(){return g.apply(this,arguments)},onJobStatusChange:function(){return m.apply(this,arguments)},onTabChange:function(){return s.apply(this,arguments)},onJobFinishedPostProcessing:function(){return p.apply(this,arguments)},onOpenMonitor:function(){return a.apply(this,arguments)},updateXSView:function(){return e.apply(this,arguments)},stopJobMonitor:function(){return r.apply(this,arguments)},onJobChange:function(){return u.apply(this,arguments)},onUpdateResponse:function(){return k.apply(this,arguments)},refreshData:function(){return d.apply(this,arguments)},behaviors:[j.DS.SMAProcSP.SPBase],_computeUri:function(y){return"simulations/"+y+"?fetchIsightAdapterInfo=true"},onExeOptReady:function(){return c.apply(this,arguments)},getPrivateStationInfo:function(){return n.apply(this,arguments)},_computeUri3:function(y){return"simulations/"+y+"/view"},runActivity:function(y){this.$.psSimDesc.runActivity(y)},_computeEEDTicketUri:function(){return this.$.mcsBaseURL.getValue()+"/resources/slmservices/cos/ticket"},setEEDTicket:function(){return f.apply(this,arguments)},getRunAsEnabled:function(){return b.apply(this,arguments)},getStationList:function(){return l.apply(this,arguments)},checkForCachedCredentials:function(){return h.apply(this,arguments)},enableRunButton:function(){return x.apply(this,arguments)},disableRunButton:function(){return t.apply(this,arguments)}})}(this));