/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
(function(i){var o={OPENMONITOR:"openmonitor"},c=function(){this.debounce("_formatData",function(){this.jobsData=[];var t=0,v,s={},w={};if(this.data){v=this.data.length;for(t=0;t<v;t+=1){this.data.pop()}if(this.jobList&&this.jobList.length>0){for(t=0;t<this.jobList.length;t+=1){w=this.jobList[t];s={title:w.title,remarks:w.status,actions:w.objectId,owner:w.owner,description:w.description,eedJobId:w.eedJobId,objectId:w.objectId,status:w.status,index:t};try{if(w.startTimeMillis){var x=new Date(parseInt(w.startTimeMillis));s.startDate=x.getDate()+" "+x.toLocaleString("en-us",{month:"short"})+" "+x.getFullYear()+" "+x.toLocaleTimeString()}}catch(u){s.startDate=w.startDate}try{if(w.endTimeMillis){var r=new Date(parseInt(w.endTimeMillis));s.endDate=r.getDate()+" "+r.toLocaleString("en-us",{month:"short"})+" "+r.getFullYear()+" "+r.toLocaleTimeString()}}catch(u){s.endDate=w.endDate}this.push("jobsData",s)}}if(this.reloadTable){this.drawTable()}else{this.reloadTable=true}}},500)},a=function(){this.data=[]},e=function(){var r=this.elements={};this.reloadTable=true;require(["UWA/Core","UWA/Drivers/Alone"],function(s,t){this.elements.container=t.extendElement(Polymer.dom(this.root).querySelector(".modal"));this.elements.body=r.container.getElement(".modal-body");this.elements.toolbar=r.container.getElement(".toolbarOuter");this.elements.header=r.container.getElement(".spreadsheet-header");this.elements.container.setStyle("display","none");this.querySelector("#notificationMessages").autoRemoveDelay=3000;this.fire("joblistready")}.bind(this))},g=function(s){var r=JSON.parse(s.detail.payload);this.fire("jobsdeleted",r)},n=function(){var s=this.elements;var r=this;require(["DS/SMAProcPSUI/Views/JobsTable","css!DS/UIKIT/UIKIT.css","css!DS/Core/wux.css","css!DS/SMAProcPSUI/ps-job-list/ps-job-list.css"],function(t){if(r.jobsData){r.data=JSON.parse(JSON.stringify(r.jobsData))}r.jobsTable=new t({container:s.body,toolbarDiv:s.toolbar,data:r.data,processType:r.processType,haslicRA:r.haslicRa,owner:r.self.id,isInDashboard:r.$.spDashboard.isInDashboard(),events:{JobsDeleted:function(v,u){r.deleteJobs(v,u)},OpenMonitor:function(u){r.openMonitor(u)},Download:function(u){r.downloadJobLog(u)},RunAnalytics:function(u){r.openInRA(u,false)},RunAnalyticsAs:function(u){r.openInRA(u,true)}}})})},p=function(){var r=this.elements;if(!this.isVisible){this.isVisible=true;r&&r.container&&r.container.setStyle("display","block");if(!this.jobsTable){this.createTable()}}},l=function(){var r=this.elements;if(this.isVisible){this.isVisible=false;this.destroyTable();r.container.setStyle("display","")}},d=function(){var r=this.elements;if(r!==null&&r!==undefined){if(this.jobsTable){this.jobsTable.destroy();this.jobsTable=null}if(r.body){r.body.empty()}}},h=function(t){var r,s;if(t.length>1){s={text:"Please select single simulation job only to open it in monitor",type:"error",autoRemove:true};this.querySelector("#notificationMessages").logMessage(s);return}else{if(t.length===0){s={text:"No Simulation Job selected to open in monitor",type:"error",autoRemove:true};this.querySelector("#notificationMessages").logMessage(s);return}}r=t[0];this.asyncFire(o.OPENMONITOR,r)},k=function(s,z){var B,x=false,A;if(s.length===0){B={text:"No Simulation Job selected to Run",type:"error",autoRemove:true};this.querySelector("#notificationMessages").logMessage(B);return}A=s;for(var y=0;y<A.length;y++){var w=A[y];for(var v=0;v<this.jobList.length;v++){if(w===this.jobList[v].objectId){var u=this.jobList[v].status;if(u==="Running"||u==="Paused"||u==="Waiting"){x=true}break}}if(x){B={text:"One of the job is either Running, Waiting or Paused.",type:"error",autoRemove:true};this.querySelector("#notificationMessages").logMessage(B);return}}var t=A.join("|");if(this.$.spDashboard.isInDashboard()){require(["DS/TransientWidget/TransientWidget"],function(D){var C={objectIds:t};if(z){C.runAs=true}D.showWidget("SIMREII_AP","Result Analytics",C)})}else{var r=appData.environments[0].dashboard;r=r+"#app:SIMREII_AP/content:objectIds="+t;if(z){r+="&runAs=true"}r=encodeURI(r);i.open(r,"_blank")}},m=function(){this.destroyTable();this.data=JSON.parse(JSON.stringify(this.jobsData));if(this.isVisible){if(!this.jobsTable){this.createTable()}}},q=function(t){var s,r;if(t.length>1){s={text:"Please select single simulation job to download",type:"error",autoRemove:true};this.querySelector("#notificationMessages").logMessage(s);return}else{if(t.length===0){s={text:"No Simulation Job selected to Download",type:"error",autoRemove:true};this.querySelector("#notificationMessages").logMessage(s);return}}r=t[0];Polymer.dom(this.root).querySelector("#psFileDownld").documentId=r;Polymer.dom(this.root).querySelector("#psFileDownld").creDwnUrlSmt()},f=function(){this.destroyTable()},b=function(t){var s={};var r=t.response;if(r){var u=r.contains("instantiation of a selected template exists");if(u){s.text="Result Analytics is associated with this job, it can not be deleted"}else{s.text=JSON.parse(r).errorMessage||r}}else{s.text="Failed to Delete"}s.type="error";s.autoRemove=true;this.querySelector("#notificationMessages").logMessage(s)},j=function(s,r){var u={},t="",w={},v=this;if(s.length===0){w.type="error";w.text="No Simulation Job selected to delete";w.autoRemove=true;this.querySelector("#notificationMessages").logMessage(w);return}t=this.$.mcsWSBaseURL.getValue()+"/jobs";u.uri=t;u.verb="DELETE";u.data=JSON.stringify(s);r.sort(function(y,x){return x-y});u.onComplete=function(){var z=this.getManager();var x=z.getDocument();var A=x.getSelectedNodes();for(var y=0;y<A.length;y+=1){A[y].remove()}v.reloadTable=false}.bind(this.jobsTable.spreadsheet);u.onError=b.bind(this);u.physicalId=this.simOid;this.$.deleteJob.sendRequest(u)};i.Polymer({is:"ps-job-list",behaviors:[i.DS.SMAProcSP.SPBase],properties:{haslicRa:{notify:true},jobList:{type:Array,notify:true,value:function(){return[]}},simOid:{type:String,value:"",notify:true,observer:"simOidChanged"},processType:{notify:true},self:{type:Object,notify:true,value:function(){return{}}}},observers:["jobListChanged(jobList.splices)"],simOidChanged:f,jobListChanged:c,downloadJobLog:q,openInRA:k,drawTable:m,hideJobList:l,showJobList:p,deleteJobs:j,attached:a,destroyTable:d,createTable:n,onDeleteResponse:g,onDeleteError:b,openMonitor:h,ready:e})}(this));