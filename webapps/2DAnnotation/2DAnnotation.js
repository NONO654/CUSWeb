define("DS/2DAnnotation/interface/Command",["UWA/Class","DS/Logger/Logger","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(b,a){var c=b.extend({name:"DS/2DAnnotation/interface/Command",_logger:null,init:function(d){var e=this;e._parent(d);e._logger=a.getLogger(e.name);e.imageEditor=d.imageEditor},start:function(d){throw new Error("should be implemented")},end:function(){throw new Error("should be implemented")}});return c});define("DS/2DAnnotation/views/Workspace",["UWA/Class/View","UWA/Core","DS/Logger/Logger","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(d,e,b,c){var a=d.extend({name:"DS/2DAnnotation/Workspace",tagName:"div",className:"annotation-workspace-container",_logger:null,setup:function(f){var g=this;c.start(g.name+" setup");g._parent(f);g._logger=b.getLogger(g.name);c.end(g.name+" setup")},render:function(){var f=this;c.start(f.name+" render");c.end(f.name+" render");return f},destroy:function(){var f=this;f.container.empty()}});return a});define("DS/2DAnnotation/components/ColorPicker",["UWA/Core","DS/Controls/ColorPicker"],function(c,b){var a={COLORS:{PRESELECTION:["#000000","#FEE000","#FF8A2E","#CC092F","#009DDB","#8DDEE4","#6FBC48","#FFFFFF"]}};return b.extend({buildView:function(){this._parent();var f=this;var d=c.createElement("div",{"class":"annotation-colorpicker"});var e=c.createElement("div",{"class":"annotation-colorpicker-selection"}).inject(d);a.COLORS.PRESELECTION.forEach(function(g){var h=c.createElement("div",{"class":"annotation-colorpicker-selection-button wux-controls-colorpicker-button"});h.setStyle("background",g);h.addEventListener("click",function(){f.value=g;f.currentValue=g});h.inject(e)});this.elements._colorChooser.inject(d);this.elements._popup.setBody(d);this._applyAlignment();this.currentValue=this.value;this.initialValue=undefined}})});define("DS/2DAnnotation/commands/CreateCircle",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(b,a,d){var c=window.fabric;return d.extend({name:"DS/2DAnnotation/commands/CreateCircle",init:function(e){var f=this;f._parent(e);f._handlers={mousedown:f._onMouseDown.bind(f),mouseup:f._onMouseUp.bind(f),mousemove:f._onMouseMove.bind(f)}},start:function(f){var g=this;var e=g.imageEditor.canvas;e.defaultCursor="crosshair";g._strokeWidth=f.strokeWidth||2;g._fillColor=(new c.Color(f.fillColor||"#000000")).toRgba();g._strokeColor=(new c.Color(f.strokeColor||"#000000")).toRgba();e.on({"mouse:down":g._handlers.mousedown})},end:function(){var f=this;var e=f.imageEditor.canvas;e.defaultCursor="default";e.off({"mouse:down":f._handlers.mousedown})},setStrokeWidth:function(e){var f=this;f._strokeWidth=e},setFillColor:function(e){var f=this;f._fillColor=(new c.Color(e)).toRgba()},setStrokeColor:function(e){var f=this;f._strokeColor=(new c.Color(e)).toRgba()},_onMouseDown:function(g){var f=this;var e=f.imageEditor.canvas;if(!e.getActiveObject()&&!e.getActiveGroup()){f._startPoint=e.getPointer(g.e);f._shapeObj=null;e.selection=false;e.uniScaleTransform=true;e.on({"mouse:move":f._handlers.mousemove,"mouse:up":f._handlers.mouseup})}},_onMouseUp:function(){var g=this;var f=g.imageEditor.canvas;f.selection=true;f.uniScaleTransform=false;f.off({"mouse:move":g._handlers.mousemove,"mouse:up":g._handlers.mouseup});var e=f.getActiveObject();if(e!==null&&e!==undefined){e.setCoords();e.selectable=true;f.calcOffset();f.selection=true;f.uniScaleTransform=false;f.renderAll()}},_onMouseMove:function(h){var g=this;var f=g.imageEditor.canvas;var i=f.getPointer(h.e);var e=g._shapeObj;g._shapeObj=g.updateShape(e,g._startPoint,i)},updateShape:function(m,e,l){var j=this;var f=j.imageEditor.canvas;var i=(e&&e.x)?e.x:m.initialCoords.start.x;var h=(e&&e.y)?e.y:m.initialCoords.start.y;var q=(l&&l.x)?l.x:m.initialCoords.end.x;var p=(l&&l.y)?l.y:m.initialCoords.end.y;var o=Math.min(i,q);var n=Math.min(h,p);var g=0;if(m!==null&&m!==undefined){if(m.angle!==null&&m.angle!==undefined){g=m.angle}f.remove(m)}var k=new c.Ellipse({angle:g,left:o,top:n,stroke:j._strokeColor,strokeWidth:j._strokeWidth,fill:j._fillColor,rx:Math.abs(i-q)/2,ry:Math.abs(h-p)/2,cornerSize:30,transparentCorners:false});k.annotationType="createCircle";f.add(k);f.setActiveObject(k);j._shapeObj=k;k.initialCoords={start:{x:i,y:h},end:{x:q,y:p}};k.on("modified",function(){var r=this;r.initialCoords={start:{x:r.aCoords.tl.x,y:r.aCoords.tl.y},end:{x:r.aCoords.br.x,y:r.aCoords.br.y}}});return k}})});define("DS/2DAnnotation/commands/CreateRectangle",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(b,a,d){var c=window.fabric;return d.extend({name:"DS/2DAnnotation/commands/CreateRectangle",init:function(e){var f=this;f._parent(e);f._handlers={mousedown:f._onMouseDown.bind(f),mouseup:f._onMouseUp.bind(f),mousemove:f._onMouseMove.bind(f)}},start:function(f){var g=this;var e=g.imageEditor.canvas;e.defaultCursor="crosshair";g._strokeWidth=f.strokeWidth||2;g._fillColor=(new c.Color(f.fillColor||"#000000")).toRgba();g._strokeColor=(new c.Color(f.strokeColor||"#000000")).toRgba();e.on({"mouse:down":g._handlers.mousedown})},end:function(){var f=this;var e=f.imageEditor.canvas;e.defaultCursor="default";e.off({"mouse:down":f._handlers.mousedown})},setStrokeWidth:function(e){var f=this;f._strokeWidth=e},setFillColor:function(e){var f=this;f._fillColor=(new c.Color(e)).toRgba()},setStrokeColor:function(e){var f=this;f._strokeColor=(new c.Color(e)).toRgba()},setOpacity:function(e){var f=this;f._opacity=e},_onMouseDown:function(g){var f=this;var e=f.imageEditor.canvas;if(!e.getActiveObject()&&!e.getActiveGroup()){f._startPoint=e.getPointer(g.e);f._shapeObj=null;e.selection=false;e.uniScaleTransform=true;e.on({"mouse:move":f._handlers.mousemove,"mouse:up":f._handlers.mouseup})}},_onMouseUp:function(){var g=this;var f=g.imageEditor.canvas;f.selection=true;f.uniScaleTransform=false;f.off({"mouse:move":g._handlers.mousemove,"mouse:up":g._handlers.mouseup});var e=f.getActiveObject();if(e!==null&&e!==undefined){e.setCoords();e.selectable=true;f.calcOffset();f.selection=true;f.uniScaleTransform=false;f.renderAll()}},_onMouseMove:function(f){var k=this;var h=k.imageEditor.canvas;var e=h.getPointer(f.e);var j=k._startPoint.x;var i=k._startPoint.y;var o=Math.min(j,e.x);var m=Math.min(i,e.y);var g=Math.abs(j-e.x);var n=Math.abs(i-e.y);var l=k._shapeObj;if(!l){l=new c.Rect({top:j,left:i,width:g,height:n,fill:k._fillColor,stroke:k._strokeColor,strokeWidth:k._strokeWidth,cornerSize:30,transparentCorners:false});l.annotationType="createRectangle";h.add(l);h.setActiveObject(l);k._shapeObj=l}else{l.set("width",g).set("height",n).set("top",m).set("left",o)}h.renderAll()}})});define("DS/2DAnnotation/commands/Highlight",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(b,a,d){var c=window.fabric;return d.extend({name:"DS/2DAnnotation/commands/Highlight",init:function(e){var f=this;f._parent(e);f._handlers={mousedown:f._onMouseDown.bind(f),mouseup:f._onMouseUp.bind(f),mousemove:f._onMouseMove.bind(f)}},start:function(f){var g=this;var e=g.imageEditor.canvas;e.defaultCursor="crosshair";g._color=(new c.Color(f.color||"#000000")).toRgba();g._opacity=f.opacity||0.5;e.on({"mouse:down":g._handlers.mousedown})},end:function(){var f=this;var e=f.imageEditor.canvas;e.defaultCursor="default";e.off({"mouse:down":f._handlers.mousedown})},setColor:function(e){var f=this;f._color=(new c.Color(e)).toRgba()},setOpacity:function(e){var f=this;f._opacity=e},_onMouseDown:function(g){var f=this;var e=f.imageEditor.canvas;if(!e.getActiveObject()&&!e.getActiveGroup()){f._startPoint=e.getPointer(g.e);f._shapeObj=null;e.selection=false;e.uniScaleTransform=true;e.on({"mouse:move":f._handlers.mousemove,"mouse:up":f._handlers.mouseup})}},_onMouseUp:function(){var g=this;var f=g.imageEditor.canvas;f.selection=true;f.uniScaleTransform=false;f.off({"mouse:move":g._handlers.mousemove,"mouse:up":g._handlers.mouseup});var e=f.getActiveObject();if(e!==null&&e!==undefined){e.setCoords();e.selectable=true;f.calcOffset();f.selection=true;f.uniScaleTransform=false;f.renderAll()}},_onMouseMove:function(f){var k=this;var h=k.imageEditor.canvas;var e=h.getPointer(f.e);var j=k._startPoint.x;var i=k._startPoint.y;var o=Math.min(j,e.x);var m=Math.min(i,e.y);var g=Math.abs(j-e.x);var n=Math.abs(i-e.y);var l=k._shapeObj;if(!l){l=new c.Rect({top:j,left:i,width:g,height:n,fill:k._color,color:k._color,cornerSize:30,transparentCorners:false});l.set({opacity:k._opacity});l.annotationType="highlight";h.add(l);h.setActiveObject(l);k._shapeObj=l}else{l.set("width",g).set("height",n).set("top",m).set("left",o)}h.renderAll()}})});define("DS/2DAnnotation/commands/CreateArrow",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(b,a,d){var c=window.fabric;return d.extend({name:"DS/2DAnnotation/commands/CreateArrow",init:function(e){var f=this;f._parent(e);f._handlers={mousedown:f._onMouseDown.bind(f),mouseup:f._onMouseUp.bind(f),mousemove:f._onMouseMove.bind(f)}},start:function(f){var g=this;var e=g.imageEditor.canvas;e.defaultCursor="crosshair";g._size=f.size||18;g._fillColor=(new c.Color(f.fillColor||"#000000")).toRgba();g._strokeColor=(new c.Color(f.strokeColor||"#000000")).toRgba();e.on({"mouse:down":g._handlers.mousedown})},end:function(){var f=this;var e=f.imageEditor.canvas;e.defaultCursor="default";e.off({"mouse:down":f._handlers.mousedown})},setSize:function(e){var f=this;f._size=e},setFillColor:function(e){var f=this;f._fillColor=(new c.Color(e)).toRgba()},setStrokeColor:function(e){var f=this;f._strokeColor=(new c.Color(e)).toRgba()},_onMouseDown:function(g){var f=this;var e=f.imageEditor.canvas;if(!e.getActiveObject()&&!e.getActiveGroup()){f._startPoint=e.getPointer(g.e);f._shapeObj=null;e.selection=false;e.uniScaleTransform=true;e.on({"mouse:move":f._handlers.mousemove,"mouse:up":f._handlers.mouseup})}},_onMouseUp:function(){var g=this;var f=g.imageEditor.canvas;f.selection=true;f.uniScaleTransform=false;f.off({"mouse:move":g._handlers.mousemove,"mouse:up":g._handlers.mouseup});var e=f.getActiveObject();if(e!==null&&e!==undefined){e.setCoords();e.selectable=true;f.calcOffset();f.selection=true;f.uniScaleTransform=false;f.renderAll()}},_onMouseMove:function(h){var g=this;var f=g.imageEditor.canvas;var i=f.getPointer(h.e);var e=g._shapeObj;g._shapeObj=g.updateShape(e,g._startPoint,i)},updateShape:function(p,e,o){var m=this;var f=m.imageEditor.canvas;var l=m._size;var k=(e&&e.x)?e.x:p.points[0].x;var i=(e&&e.y)?e.y:p.points[0].y;var s=(o&&o.x)?o.x:p.points[4].x;var r=(o&&o.y)?o.y:p.points[4].y;var g=Math.atan2(r-i,s-k);var j=s-(l)*Math.cos(g);var h=r-(l)*Math.sin(g);if(p!==null&&p!==undefined){f.remove(p)}var q=[{x:k,y:i},{x:k-(l/4)*Math.cos(g-Math.PI/2),y:i-(l/4)*Math.sin(g-Math.PI/2)},{x:j-(l/4)*Math.cos(g-Math.PI/2),y:h-(l/4)*Math.sin(g-Math.PI/2)},{x:j-(l)*Math.cos(g-Math.PI/2)+10*Math.sin(g-Math.PI/2),y:h-(l)*Math.sin(g-Math.PI/2)-10*Math.cos(g-Math.PI/2)},{x:j+(l)*Math.cos(g),y:h+(l)*Math.sin(g)},{x:j-(l)*Math.cos(g+Math.PI/2)+10*Math.sin(g-Math.PI/2),y:h-(l)*Math.sin(g+Math.PI/2)-10*Math.cos(g-Math.PI/2)},{x:j-(l/4)*Math.cos(g+Math.PI/2),y:h-(l/4)*Math.sin(g+Math.PI/2)},{x:k-(l/4)*Math.cos(g+Math.PI/2),y:i-(l/4)*Math.sin(g+Math.PI/2)},{x:k,y:i}];var n=new c.Polyline(q,{fill:m._fillColor,stroke:m._strokeColor,opacity:1,strokeWidth:1,originX:"left",originY:"top",selectable:true,lockScalingFlip:true,cornerSize:30,transparentCorners:false});n.annotationType="createArrow";n.arrowSize=l;n.setControlsVisibility({bl:false,br:true,tl:true,tr:false,mt:false,mb:false,ml:false,mr:false});f.add(n);f.setActiveObject(n);n.on("modified",function(){var t=this.calcTransformMatrix();n.points=this.get("points").map(function(u){return new c.Point(u.x-n.minX-n.width/2,u.y-n.minY-n.height/2)}).map(function(u){return c.util.transformPoint(u,t)});m.updateShape(n)});return n}})});define("DS/2DAnnotation/commands/FreeDrawing",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(b,a,d){var c=window.fabric;return d.extend({name:"DS/2DAnnotation/commands/FreeDrawing",init:function(e){var f=this;f._parent(e);f._onPathCreated=f._handlers.onPathCreated.bind(f)},start:function(f){var g=this;var e=g.imageEditor.canvas;e.isDrawingMode=true;g.setBrush(f);e.on("path:created",g._onPathCreated)},end:function(){var f=this;var e=f.imageEditor.canvas;e.isDrawingMode=false;e.off("path:created",f._onPathCreated)},setBrush:function(f){var g=this;var e=g.imageEditor.canvas.freeDrawingBrush;if(f.width){e.width=f.width}if(f.color){var h=new c.Color(f.color);e.color=h.toRgba()}},_handlers:{onPathCreated:function(e){e.path.annotationType="freedrawing"}}})});define("DS/2DAnnotation/commands/CreateText",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(c,b,e,f){var d=window.fabric;var a={DEFAULT:{WIDTH:200,HEIGHT:30}};return e.extend({name:"DS/2DAnnotation/commands/CreateText",init:function(g){var h=this;h._parent(g);h._handlers={mousedown:h._onMouseDown.bind(h),mouseup:h._onMouseUp.bind(h),mousemove:h._onMouseMove.bind(h)}},start:function(h){var i=this;var g=i.imageEditor.canvas;g.defaultCursor="crosshair";i._fontSize=h.fontSize||10;i._fillColor=(new d.Color(h.fillColor||"#000000")).toRgba();i._strokeColor=(new d.Color(h.strokeColor||"#000000")).toRgba();i._backgroundColor=(new d.Color(h.backgroundColor||"#ffffff")).toRgba();g.on({"mouse:down":i._handlers.mousedown})},end:function(){var h=this;var g=h.imageEditor.canvas;g.defaultCursor="default";g.off({"mouse:down":h._handlers.mousedown})},setFontSize:function(h){var g=this;g._fontSize=h},setFillColor:function(g){var h=this;h._fillColor=(new d.Color(g)).toRgba()},setStrokeColor:function(g){var h=this;h._strokeColor=(new d.Color(g)).toRgba()},setBackgroundColor:function(g){var h=this;h._backgroundColor=(new d.Color(g)).toRgba()},_onMouseDown:function(i){var h=this;var g=h.imageEditor.canvas;if(!g.getActiveObject()&&!g.getActiveGroup()){h._startPoint=g.getPointer(i.e);h._shapeObj=null;g.selection=false;g.uniScaleTransform=true;g.on({"mouse:move":h._handlers.mousemove,"mouse:up":h._handlers.mouseup})}},_onMouseUp:function(){var i=this;var h=i.imageEditor.canvas;h.selection=true;h.uniScaleTransform=false;h.off({"mouse:move":i._handlers.mousemove,"mouse:up":i._handlers.mouseup});if(i._shapeObj===null||i._shapeObj===undefined){i._createTextShape(i._startPoint.x,i._startPoint.y,i._startPoint.x+a.DEFAULT.WIDTH,i._startPoint.y+a.DEFAULT.HEIGHT)}var g=h.getActiveObject();g.setCoords();g.selectable=true;g.enterEditing();g.selectAll();h.calcOffset();h.selection=true;h.uniScaleTransform=false;h.renderAll()},_onMouseMove:function(k){var j=this;var i=j.imageEditor.canvas;var l=i.getPointer(k.e);var h=j._startPoint.x;var g=j._startPoint.y;j._createTextShape(h,g,l.x,l.y);i.renderAll()},_createTextShape:function(j,i,q,o){var k=this;var h=k.imageEditor.canvas;var p=Math.min(j,q);var m=Math.min(i,o);var g=Math.abs(j-q);var n=Math.abs(i-o);var l=k._shapeObj;if(!l){l=new d.IText(f.tools.createText.emptyText,{top:m,left:p,width:g,height:n,fill:k._fillColor,stroke:k._strokeColor,backgroundColor:k._backgroundColor,fontSize:k._fontSize,cornerSize:30,transparentCorners:false});l.set({opacity:k._opacity});l.annotationType="createText";h.add(l);h.setActiveObject(l);k._shapeObj=l}else{l.set("width",g).set("height",n).set("top",m).set("left",p)}}})});define("DS/2DAnnotation/views/Toolbar",["UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/Controls/Button","DS/Controls/Popup","DS/Controls/Slider","DS/Controls/SpinBox","DS/Logger/Logger","DS/Windows/Dialog","DS/Windows/Panel","DS/2DAnnotation/components/ColorPicker","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(j,h,e,m,d,i,l,c,o,b,k,a,n){var g={PREFERENCES:{TOOL_PREFERENCES:{KEY:"2DAnnotation.Toolbar.ToolPreferences",DEFAULT_VALUES:{freedrawing:{weight:5,colorOpacity:1,color:"CC092F"},highlight:{color:"ffff00",opacity:0.3},createText:{weight:40,colorOpacity:1,color:"CC092F",strokeColorOpacity:0,strokeColor:"000000",backgroundColorOpacity:0,backgroundColor:"ffffff"},createArrow:{weight:20,colorOpacity:1,color:"CC092F",strokeColorOpacity:1,strokeColor:"000000"},createRectangle:{weight:10,colorOpacity:0,color:"000000",strokeColorOpacity:1,strokeColor:"CC092F"},createCircle:{weight:10,colorOpacity:0,color:"000000",strokeColorOpacity:1,strokeColor:"CC092F"}}}},FONT_FAMILY:{FontAwesome:WUXManagedFontIcons.FontAwesome,Font3DS:WUXManagedFontIcons.Font3DS},TOOLS:{OPEN:"open",SELECT:"select",FREEDRAWING:"freedrawing",HIGHLIGHT:"highlight",ERASE:"erase",TEXT:"createText",ARROW:"createArrow",RECTANGLE:"createRectangle",CIRCLE:"createCircle",INSERT_IMAGE:"insertImage"},KEY_CODES:{Z:90,Y:85,DEL:46,BACKSPACE:8},FIRST_ELEMENT:0};var f=h.extend({name:"DS/2DAnnotation/views/Toolbar",isLoaded:null,_deferred:{resolve:null,reject:null},_logger:null,immersiveFrame:null,imageEditor:null,sidebar:{panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,circle:null,arrow:null},_tooltips:[],activeTool:{id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},activeObjects:[],callbacks:{saveCallback:null,exitCallback:null},preferences:{},init:function(u,r,t){var s=this;a.start(s.name+" init");s._logger=c.getLogger(s.name);s.immersiveFrame=u;s.imageEditor=r;s.sidebar={panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,circle:null,arrow:null};s._tooltips=[];s.activeTool={id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}};s.activeObjects=[];s.callbacks={saveCallback:t.saveCallback,exitCallback:t.exitCallback};try{var p=localStorage.getItem(g.PREFERENCES.TOOL_PREFERENCES.KEY);if(p===null||p===""){s.preferences=g.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES}else{s.preferences=e.merge(JSON.parse(p),g.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES)}}catch(q){s.preferences=g.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES}a.end(s.name+" init")},destroy:function(){var p=this;p.immersiveFrame=null;p.imageEditor=null;p.sidebar={panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,circle:null,arrow:null};p._tooltips.forEach(function(q){q.hide()});p.activeTool={id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}};p.activeObjects=[];p.callbacks={saveCallback:null,exitCallback:null};p.preferences={};document.removeEventListener("keydown",p._onKeyDown)},render:function(){var p=this;a.start(p.name+" render");p.isLoaded=new j(function(r,q){p._deferred.resolve=r;p._deferred.reject=q});p._createSidebar();p._createActiveToolPanel();p._onToolSelected(g.TOOLS.HIGHLIGHT);p._deferred.resolve();a.end(p.name+" render");return p},listen:function(){var p=this;p.imageEditor.canvas.on("selection:cleared",function(){p.sidebar.remove.disabled=true;p.activeObjects=[];p._onToolSelected(g.TOOLS.SELECT,true)});p.imageEditor.canvas.on("object:selected",function(t){p.sidebar.remove.disabled=false;var u=t.target;var s=null;var r={};if(u.type==="group"){p.activeObjects=p.imageEditor.canvas._activeGroup._objects;var q=p.activeObjects.every(function(v){return p.activeObjects[g.FIRST_ELEMENT].annotationType===v.annotationType});if(p.activeObjects.length&&q){s=p.activeObjects[g.FIRST_ELEMENT].annotationType}}else{p.activeObjects=[p.imageEditor.canvas.getActiveObject()];if(u.annotationType){s=u.annotationType;switch(u.annotationType){case g.TOOLS.HIGHLIGHT:r={color:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,opacity:p.activeObjects[g.FIRST_ELEMENT].get("opacity")};break;case g.TOOLS.TEXT:r={fontSize:p.activeObjects[g.FIRST_ELEMENT].get("fontSize"),fillColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity,backgroundColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("backgroundColor")).hex,backgroundOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("backgroundColor")).opacity};break;case g.TOOLS.ARROW:r={size:p.activeObjects[g.FIRST_ELEMENT].get("arrowSize"),fillColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity};break;case g.TOOLS.RECTANGLE:r={strokeWidth:p.activeObjects[g.FIRST_ELEMENT].get("strokeWidth"),fillColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity};break;case g.TOOLS.CIRCLE:r={strokeWidth:p.activeObjects[g.FIRST_ELEMENT].get("strokeWidth"),fillColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).hex,fillOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("fill")).opacity,strokeColor:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:p.imageEditor.utils.RGBAtoHex(p.activeObjects[g.FIRST_ELEMENT].get("stroke")).opacity};break;default:r=null;break}}}if(!s||s===g.TOOLS.FREEDRAWING){p._onToolSelected(g.TOOLS.SELECT,true)}else{p._onToolSelected(s,true,r)}});document.addEventListener("keydown",p._onKeyDown.bind(p));return p},_createSidebar:function(){var v=this;var y=e.createElement("div",{"class":"annotation-toolbar-sidebar"});var H=e.createElement("div",{"class":"annotation-toolbar-tools-container"}).inject(y);v.sidebar.open=new m({emphasize:"secondary",type:"button",icon:{iconName:"folder-open",fontIconFamily:g.FONT_FAMILY.Font3DS},touch:true,onClick:function(){var K=e.createElement("div",{"class":"annotation-open-confirm",html:n.toolbar.sidebar.openConfirmDialog.content});var J=new o({title:n.toolbar.sidebar.openConfirmDialog.title,content:K,immersiveFrame:v.immersiveFrame,resizableFlag:false,snappableFlag:false,modalFlag:true,buttons:{Cancel:new m({label:n.toolbar.sidebar.openConfirmDialog.cancel,onClick:function(){J.destroy()},allowUnsafeHTMLLabel:true}),Ok:new m({label:n.toolbar.sidebar.openConfirmDialog.ok,onClick:function(){J.destroy();v.imageEditor.openFile()},allowUnsafeHTMLLabel:true})}})},allowUnsafeHTMLLabel:true}).inject(H);var C=new d({target:v.sidebar.open,trigger:"hover"});C.setBody(n.toolbar.sidebar.panel.open);C.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(C);var E=function(J){return function(){v._onToolSelected(J)}};var G=e.createElement("div",{"class":"annotation-toolbar-tools-container"}).inject(y);v.sidebar[g.TOOLS.SELECT]=new m({emphasize:"secondary",type:"radio",checkFlag:true,icon:{iconName:"target",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.SELECT),allowUnsafeHTMLLabel:true}).inject(G);var w=new d({target:v.sidebar[g.TOOLS.SELECT],trigger:"hover"});w.setBody(n.tools[g.TOOLS.SELECT].title);w.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(w);v.sidebar[g.TOOLS.FREEDRAWING]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"pencil",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.FREEDRAWING),allowUnsafeHTMLLabel:true}).inject(G);var D=new d({target:v.sidebar[g.TOOLS.FREEDRAWING],trigger:"hover"});D.setBody(n.tools[g.TOOLS.FREEDRAWING].title);D.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(D);v.sidebar[g.TOOLS.HIGHLIGHT]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"highlighter",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.HIGHLIGHT),allowUnsafeHTMLLabel:true}).inject(G);var x=new d({target:v.sidebar[g.TOOLS.HIGHLIGHT],trigger:"hover"});x.setBody(n.tools[g.TOOLS.HIGHLIGHT].title);x.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(x);v.sidebar[g.TOOLS.TEXT]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"text",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.TEXT),allowUnsafeHTMLLabel:true}).inject(G);var z=new d({target:v.sidebar[g.TOOLS.TEXT],trigger:"hover"});z.setBody(n.tools[g.TOOLS.TEXT].title);z.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(z);v.sidebar[g.TOOLS.ARROW]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"right",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.ARROW),allowUnsafeHTMLLabel:true}).inject(G);var t=new d({target:v.sidebar[g.TOOLS.ARROW],trigger:"hover"});t.setBody(n.tools[g.TOOLS.ARROW].title);t.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(t);v.sidebar[g.TOOLS.RECTANGLE]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"checkbox-off",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.RECTANGLE),allowUnsafeHTMLLabel:true}).inject(G);var B=new d({target:v.sidebar[g.TOOLS.RECTANGLE],trigger:"hover"});B.setBody(n.tools[g.TOOLS.RECTANGLE].title);B.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(B);v.sidebar[g.TOOLS.CIRCLE]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"radiobutton-off",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.CIRCLE),allowUnsafeHTMLLabel:true}).inject(G);var p=new d({target:v.sidebar[g.TOOLS.CIRCLE],trigger:"hover"});p.setBody(n.tools[g.TOOLS.CIRCLE].title);p.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(p);v.sidebar[g.TOOLS.INSERT_IMAGE]=new m({emphasize:"secondary",type:"radio",icon:{iconName:"picture",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:E(g.TOOLS.INSERT_IMAGE),allowUnsafeHTMLLabel:true}).inject(G);var F=new d({target:v.sidebar[g.TOOLS.INSERT_IMAGE],trigger:"hover"});F.setBody(n.tools[g.TOOLS.INSERT_IMAGE].title);F.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(F);var r=e.createElement("div",{"class":"annotation-toolbar-tools-container"}).inject(y);v.sidebar.remove=new m({emphasize:"secondary",type:"button",icon:{iconName:"trash",fontIconFamily:g.FONT_FAMILY.Font3DS},disabled:true,onClick:v._toolsCallbacks.remove.bind(v),allowUnsafeHTMLLabel:true}).inject(r);var q=new d({target:v.sidebar.remove,trigger:"hover"});q.setBody(n.toolbar.sidebar.panel.remove);q.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(q);var I=e.createElement("div",{"class":"annotation-toolbar-tools-container"}).inject(y);v.sidebar.download=new m({emphasize:"secondary",type:"button",icon:{iconName:"download",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:function(){v.imageEditor.download()},allowUnsafeHTMLLabel:true}).inject(I);var s=new d({target:v.sidebar.download,trigger:"hover"});s.setBody(n.toolbar.sidebar.panel.download);s.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(s);v.sidebar.save=new m({emphasize:"secondary",type:"button",icon:{iconName:"floppy",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:function(){v.callbacks.saveCallback(v.imageEditor.save())},allowUnsafeHTMLLabel:true}).inject(I);var u=new d({target:v.sidebar.save,trigger:"hover"});u.setBody(n.toolbar.sidebar.panel.save);u.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(u);v.sidebar.close=new m({emphasize:"secondary",type:"button",icon:{iconName:"close",fontIconFamily:g.FONT_FAMILY.Font3DS},onClick:function(){var K=e.createElement("div",{"class":"annotation-close-confirm",html:n.toolbar.sidebar.closeConfirmDialog.content});var J=new o({title:n.toolbar.sidebar.closeConfirmDialog.title,content:K,immersiveFrame:v.immersiveFrame,resizableFlag:false,snappableFlag:false,modalFlag:true,buttons:{Cancel:new m({label:n.toolbar.sidebar.closeConfirmDialog.cancel,onClick:function(){J.destroy()},allowUnsafeHTMLLabel:true}),Ok:new m({label:n.toolbar.sidebar.closeConfirmDialog.save,onClick:function(){v.callbacks.saveCallback(v.imageEditor.save())},allowUnsafeHTMLLabel:true}),Discard:new m({label:n.toolbar.sidebar.closeConfirmDialog.discard,onClick:function(){v.callbacks.exitCallback()},allowUnsafeHTMLLabel:true})}})},allowUnsafeHTMLLabel:true}).inject(I);var A=new d({target:v.sidebar.close,trigger:"hover"});A.setBody(n.toolbar.sidebar.panel.close);A.getContent().addClassName("annotation-toolbar-tools-popup");v._tooltips.push(A);v.sidebar.panel=new b({content:y,position:{offsetX:20,offsetY:20},immersiveFrame:v.immersiveFrame,resizableFlag:false,closeButtonFlag:false,snappableFlag:false,minWidth:54,width:54,allowedDockAreas:0})},_createActiveToolPanel:function(){var q=this;var r=e.createElement("div",{"class":"annotation-toolbar-active-panel-header",html:""});var p=e.createElement("div",{"class":"annotation-toolbar-active-panel-container"});q._createSelectPanel(p);q._createFreeDrawingToolPanel(p);q._createHighlightToolPanel(p);q._createTextToolPanel(p);q._createArrowToolPanel(p);q._createRectangleToolPanel(p);q._createCircleToolPanel(p);q.activeTool.panel=new b({title:n.activeTool,header:r,content:p,position:{offsetX:90,offsetY:20},immersiveFrame:q.immersiveFrame,resizableFlag:true,closeButtonFlag:false,height:240,width:280,allowedDockAreas:0});q._onToolSelected(g.TOOLS.SELECT)},_createSelectPanel:function(p){var q=this;q.activeTool.toolsUI.select.container=e.createElement("div",{"class":"annotation-toolbar-active-panel-select"}).inject(p).hide()},_createFreeDrawingToolPanel:function(r){var v=this;var p=e.createElement("div",{"class":"annotation-toolbar-active-panel-freedrawing"}).inject(r).hide();v.activeTool.toolsUI.freedrawing.container=p;var w=e.createElement("div",{"class":"annotation-toolbar-active-panel-freedrawing-weight"}).inject(p);e.createElement("div",{"class":"annotation-toolbar-active-panel-freedrawing-weight-label",html:n.tools.freedrawing.labels.weight}).inject(w);var t=new l({value:v.preferences.freedrawing.weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(w);v.activeTool.toolsUI.freedrawing.weightSpinBox=t;var q=new i({value:v.preferences.freedrawing.weight,minValue:1,maxValue:50,stepValue:1}).inject(w);v.activeTool.toolsUI.freedrawing.weightSlider=q;t.addEventListener("change",function(x){q.value=x.dsModel.value;v.imageEditor.getCommand(g.TOOLS.FREEDRAWING).setBrush({width:x.dsModel.value});v._saveToolPreferences(g.TOOLS.FREEDRAWING,"weight",x.dsModel.value)});q.addEventListener("change",function(x){t.value=x.dsModel.value});var s=e.createElement("div",{"class":"annotation-toolbar-active-panel-freedrawing-color"}).inject(p);e.createElement("div",{"class":"annotation-toolbar-active-panel-freedrawing-color-label",html:n.tools.freedrawing.labels.color}).inject(s);var u=new i({value:v.preferences.freedrawing.colorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(s);v.activeTool.toolsUI.freedrawing.colorOpacitySlider=u;u.addEventListener("change",function(x){v.imageEditor.getCommand(g.TOOLS.FREEDRAWING).setBrush({color:v.imageEditor.utils.hexToRGBA("#"+v.activeTool.toolsUI.freedrawing.colorPicker.value,x.dsModel.value)});v._saveToolPreferences(g.TOOLS.FREEDRAWING,"colorOpacity",x.dsModel.value)});v.activeTool.toolsUI.freedrawing.colorPicker=new k();v.activeTool.toolsUI.freedrawing.colorPicker.value=v.preferences.freedrawing.color;v.activeTool.toolsUI.freedrawing.colorPicker.inject(s);v.activeTool.toolsUI.freedrawing.colorPicker.addEventListener("liveChange",function(x){v.imageEditor.getCommand(g.TOOLS.FREEDRAWING).setBrush({color:v.imageEditor.utils.hexToRGBA("#"+x.dsModel.value,v.activeTool.toolsUI.freedrawing.colorOpacitySlider.value)});v._saveToolPreferences(g.TOOLS.FREEDRAWING,"color",x.dsModel.value)})},_createHighlightToolPanel:function(p){var v=this;var q=e.createElement("div",{"class":"annotation-toolbar-active-panel-highlight"}).inject(p).hide();v.activeTool.toolsUI.highlight.container=q;var s=e.createElement("div",{"class":"annotation-toolbar-active-panel-highlight-color"}).inject(q);e.createElement("div",{"class":"annotation-toolbar-active-panel-highlight-color-label",html:n.tools.highlight.labels.color}).inject(s);v.activeTool.toolsUI.highlight.colorPicker=new k();v.activeTool.toolsUI.highlight.colorPicker.value=v.preferences[g.TOOLS.HIGHLIGHT].color;v.activeTool.toolsUI.highlight.colorPicker.inject(s);v.activeTool.toolsUI.highlight.colorPicker.addEventListener("liveChange",function(w){v.imageEditor.getCommand(g.TOOLS.HIGHLIGHT).setColor(w.dsModel.value);v.activeObjects.forEach(function(x){x.setColor("#"+w.dsModel.value)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.HIGHLIGHT,"color",w.dsModel.value)});var t=e.createElement("div",{"class":"annotation-toolbar-active-panel-highlight-opacity"}).inject(q);e.createElement("div",{"class":"annotation-toolbar-active-panel-highlight-opacity-label",html:n.tools.highlight.labels.opacity}).inject(t);var r=new l({value:v.preferences[g.TOOLS.HIGHLIGHT].opacity,units:"",minValue:0,maxValue:1,stepValue:0.01,pageStepValue:0.01}).inject(t);v.activeTool.toolsUI.highlight.opacitySpinBox=r;var u=new i({value:v.preferences[g.TOOLS.HIGHLIGHT].opacity,minValue:0,maxValue:1,stepValue:0.01}).inject(t);v.activeTool.toolsUI.highlight.opacitySlider=u;r.addEventListener("change",function(w){u.value=w.dsModel.value;v.imageEditor.getCommand(g.TOOLS.HIGHLIGHT).setOpacity(w.dsModel.value);v.activeObjects.forEach(function(x){x.set("opacity",w.dsModel.value)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.HIGHLIGHT,"opacity",w.dsModel.value)});u.addEventListener("change",function(w){r.value=w.dsModel.value})},_createTextToolPanel:function(q){var w=this;var v=e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext"}).inject(q).hide();w.activeTool.toolsUI.createText.container=v;var x=e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-weight"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-weight-label",html:n.tools.createText.labels.weight}).inject(x);var p=new l({value:w.preferences[g.TOOLS.TEXT].weight,units:"px",minValue:1,maxValue:100,stepValue:1,pageStepValue:1}).inject(x);w.activeTool.toolsUI.createText.weightSpinBox=p;var r=new i({value:w.preferences[g.TOOLS.TEXT].weight,minValue:1,maxValue:100,stepValue:1}).inject(x);w.activeTool.toolsUI.createText.weightSlider=r;p.addEventListener("change",function(B){r.value=B.dsModel.value;w.imageEditor.getCommand(g.TOOLS.TEXT).setFontSize(B.dsModel.value);w.activeObjects.forEach(function(C){C.set("fontSize",B.dsModel.value)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"weight",B.dsModel.value)});r.addEventListener("change",function(B){p.value=B.dsModel.value});var s=e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-color"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-color-label",html:n.tools.createText.labels.color}).inject(s);var y=new i({value:w.preferences[g.TOOLS.TEXT].colorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(s);w.activeTool.toolsUI.createText.colorOpacitySlider=y;y.addEventListener("change",function(C){var B=w.imageEditor.utils.hexToRGBA("#"+w.activeTool.toolsUI.createText.colorPicker.value,C.dsModel.value);w.imageEditor.getCommand(g.TOOLS.TEXT).setFillColor(B);w.activeObjects.forEach(function(D){D.setColor(B)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"colorOpacity",C.dsModel.value)});w.activeTool.toolsUI.createText.colorPicker=new k();w.activeTool.toolsUI.createText.colorPicker.value=w.preferences[g.TOOLS.TEXT].color;w.activeTool.toolsUI.createText.colorPicker.inject(s);w.activeTool.toolsUI.createText.colorPicker.addEventListener("liveChange",function(C){var B=w.imageEditor.utils.hexToRGBA("#"+C.dsModel.value,w.activeTool.toolsUI.createText.colorOpacitySlider.value);w.imageEditor.getCommand(g.TOOLS.TEXT).setFillColor(B);w.activeObjects.forEach(function(D){D.setColor(B)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"color",C.dsModel.value)});var z=e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-color"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-strokecolor-label",html:n.tools.createText.labels.strokeColor}).inject(z);var u=new i({value:w.preferences[g.TOOLS.TEXT].strokeColorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(z);w.activeTool.toolsUI.createText.strokeColorOpacitySlider=u;u.addEventListener("change",function(C){var B=w.imageEditor.utils.hexToRGBA("#"+w.activeTool.toolsUI.createText.strokeColorPicker.value,C.dsModel.value);w.imageEditor.getCommand(g.TOOLS.TEXT).setStrokeColor(B);w.activeObjects.forEach(function(D){D.set("stroke",B)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"strokeColorOpacity",C.dsModel.value)});w.activeTool.toolsUI.createText.strokeColorPicker=new k();w.activeTool.toolsUI.createText.strokeColorPicker.value=w.preferences[g.TOOLS.TEXT].strokeColor;w.activeTool.toolsUI.createText.strokeColorPicker.inject(z);w.activeTool.toolsUI.createText.strokeColorPicker.addEventListener("liveChange",function(C){var B=w.imageEditor.utils.hexToRGBA("#"+C.dsModel.value,w.activeTool.toolsUI.createText.strokeColorOpacitySlider.value);w.imageEditor.getCommand(g.TOOLS.TEXT).setStrokeColor(B);w.activeObjects.forEach(function(D){D.set("stroke",B)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"strokeColor",C.dsModel.value)});var t=e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-color"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createtext-backgroundcolor-label",html:n.tools.createText.labels.backgroundColor}).inject(t);var A=new i({value:w.preferences[g.TOOLS.TEXT].backgroundColorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(t);w.activeTool.toolsUI.createText.backgroundColorOpacitySlider=A;A.addEventListener("change",function(C){var B=w.imageEditor.utils.hexToRGBA("#"+w.activeTool.toolsUI.createText.backgroundColorPicker.value,C.dsModel.value);w.imageEditor.getCommand(g.TOOLS.TEXT).setBackgroundColor(B);w.activeObjects.forEach(function(D){D.set("backgroundColor",B)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"backgroundColorOpacity",C.dsModel.value)});w.activeTool.toolsUI.createText.backgroundColorPicker=new k();w.activeTool.toolsUI.createText.backgroundColorPicker.value=w.preferences[g.TOOLS.TEXT].backgroundColor;w.activeTool.toolsUI.createText.backgroundColorPicker.inject(t);w.activeTool.toolsUI.createText.backgroundColorPicker.addEventListener("liveChange",function(C){var B=w.imageEditor.utils.hexToRGBA("#"+C.dsModel.value,w.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value);w.imageEditor.getCommand(g.TOOLS.TEXT).setBackgroundColor(B);w.activeObjects.forEach(function(D){D.set("backgroundColor",B)});w.imageEditor.canvas.renderAll();w._saveToolPreferences(g.TOOLS.TEXT,"backgroundColor",C.dsModel.value)})},_createArrowToolPanel:function(q){var u=this;var v=e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow"}).inject(q).hide();u.activeTool.toolsUI.createArrow.container=v;var w=e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow-weight"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow-weight-label",html:n.tools.createArrow.labels.weight}).inject(w);var p=new l({value:u.preferences[g.TOOLS.ARROW].weight,units:"px",minValue:1,maxValue:100,stepValue:1,pageStepValue:1}).inject(w);u.activeTool.toolsUI.createArrow.weightSpinBox=p;var r=new i({value:u.preferences[g.TOOLS.ARROW].weight,minValue:1,maxValue:100,stepValue:1}).inject(w);u.activeTool.toolsUI.createArrow.weightSlider=r;p.addEventListener("change",function(z){r.value=z.dsModel.value;u.imageEditor.getCommand(g.TOOLS.ARROW).setSize(z.dsModel.value);u.activeObjects.forEach(function(A){u.imageEditor.getCommand(g.TOOLS.ARROW).updateShape(A)});u.imageEditor.canvas.renderAll();u._saveToolPreferences(g.TOOLS.ARROW,"weight",z.dsModel.value)});r.addEventListener("change",function(z){p.value=z.dsModel.value});var s=e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow-color"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow-color-label",html:n.tools.createArrow.labels.color}).inject(s);var x=new i({value:u.preferences[g.TOOLS.ARROW].colorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(s);u.activeTool.toolsUI.createArrow.colorOpacitySlider=x;x.addEventListener("change",function(A){var z=u.imageEditor.utils.hexToRGBA("#"+u.activeTool.toolsUI.createArrow.colorPicker.value,A.dsModel.value);u.imageEditor.getCommand(g.TOOLS.ARROW).setFillColor(z);u.activeObjects.forEach(function(B){B.setColor(z)});u.imageEditor.canvas.renderAll();u._saveToolPreferences(g.TOOLS.ARROW,"colorOpacity",A.dsModel.value)});u.activeTool.toolsUI.createArrow.colorPicker=new k();u.activeTool.toolsUI.createArrow.colorPicker.value=u.preferences[g.TOOLS.ARROW].color;u.activeTool.toolsUI.createArrow.colorPicker.inject(s);u.activeTool.toolsUI.createArrow.colorPicker.addEventListener("liveChange",function(A){var z=u.imageEditor.utils.hexToRGBA("#"+A.dsModel.value,u.activeTool.toolsUI.createArrow.colorOpacitySlider.value);u.imageEditor.getCommand(g.TOOLS.ARROW).setFillColor(z);u.activeObjects.forEach(function(B){B.setColor(z)});u.imageEditor.canvas.renderAll();u._saveToolPreferences(g.TOOLS.ARROW,"color",A.dsModel.value)});var y=e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow-color"}).inject(v);e.createElement("div",{"class":"annotation-toolbar-active-panel-createarrow-strokecolor-label",html:n.tools.createArrow.labels.strokeColor}).inject(y);var t=new i({value:u.preferences[g.TOOLS.ARROW].strokeColorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(y);u.activeTool.toolsUI.createArrow.strokeColorOpacitySlider=t;t.addEventListener("change",function(A){var z=u.imageEditor.utils.hexToRGBA("#"+u.activeTool.toolsUI.createArrow.strokeColorPicker.value,A.dsModel.value);u.imageEditor.getCommand(g.TOOLS.ARROW).setStrokeColor(z);u.activeObjects.forEach(function(B){B.set("stroke",z)});u.imageEditor.canvas.renderAll();u._saveToolPreferences(g.TOOLS.ARROW,"strokeColorOpacity",A.dsModel.value)});u.activeTool.toolsUI.createArrow.strokeColorPicker=new k();u.activeTool.toolsUI.createArrow.strokeColorPicker.value=u.preferences[g.TOOLS.ARROW].strokeColor;u.activeTool.toolsUI.createArrow.strokeColorPicker.inject(y);u.activeTool.toolsUI.createArrow.strokeColorPicker.addEventListener("liveChange",function(A){var z=u.imageEditor.utils.hexToRGBA("#"+A.dsModel.value,u.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value);u.imageEditor.getCommand(g.TOOLS.ARROW).setStrokeColor(z);u.activeObjects.forEach(function(B){B.set("stroke",z)});u.imageEditor.canvas.renderAll();u._saveToolPreferences(g.TOOLS.ARROW,"strokeColor",A.dsModel.value)})},_createRectangleToolPanel:function(q){var v=this;var s=e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle"}).inject(q).hide();v.activeTool.toolsUI.createRectangle.container=s;var w=e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle-weight"}).inject(s);e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle-weight-label",html:n.tools.createRectangle.labels.weight}).inject(w);var p=new l({value:v.preferences[g.TOOLS.RECTANGLE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(w);v.activeTool.toolsUI.createRectangle.weightSpinBox=p;var r=new i({value:v.preferences[g.TOOLS.RECTANGLE].weight,minValue:1,maxValue:50,stepValue:1}).inject(w);v.activeTool.toolsUI.createRectangle.weightSlider=r;p.addEventListener("change",function(z){r.value=z.dsModel.value;v.imageEditor.getCommand(g.TOOLS.RECTANGLE).setStrokeWidth(z.dsModel.value);v.activeObjects.forEach(function(A){A.set("strokeWidth",z.dsModel.value)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.RECTANGLE,"weight",z.dsModel.value)});r.addEventListener("change",function(z){p.value=z.dsModel.value});var t=e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle-color"}).inject(s);e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle-color-label",html:n.tools.createRectangle.labels.color}).inject(t);var x=new i({value:v.preferences[g.TOOLS.RECTANGLE].colorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(t);v.activeTool.toolsUI.createRectangle.colorOpacitySlider=x;x.addEventListener("change",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+v.activeTool.toolsUI.createRectangle.colorPicker.value,A.dsModel.value);v.imageEditor.getCommand(g.TOOLS.RECTANGLE).setFillColor(z);v.activeObjects.forEach(function(B){B.setColor(z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.RECTANGLE,"colorOpacity",A.dsModel.value)});v.activeTool.toolsUI.createRectangle.colorPicker=new k();v.activeTool.toolsUI.createRectangle.colorPicker.value=v.preferences[g.TOOLS.RECTANGLE].color;v.activeTool.toolsUI.createRectangle.colorPicker.inject(t);v.activeTool.toolsUI.createRectangle.colorPicker.addEventListener("liveChange",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+A.dsModel.value,v.activeTool.toolsUI.createRectangle.colorOpacitySlider.value);v.imageEditor.getCommand(g.TOOLS.RECTANGLE).setFillColor(z);v.activeObjects.forEach(function(B){B.setColor(z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.RECTANGLE,"color",A.dsModel.value)});var y=e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle-color"}).inject(s);e.createElement("div",{"class":"annotation-toolbar-active-panel-createrectangle-strokecolor-label",html:n.tools.createRectangle.labels.strokeColor}).inject(y);var u=new i({value:v.preferences[g.TOOLS.RECTANGLE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(y);v.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider=u;u.addEventListener("change",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+v.activeTool.toolsUI.createRectangle.strokeColorPicker.value,A.dsModel.value);v.imageEditor.getCommand(g.TOOLS.RECTANGLE).setStrokeColor(z);v.activeObjects.forEach(function(B){B.set("stroke",z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.RECTANGLE,"strokeColorOpacity",A.dsModel.value)});v.activeTool.toolsUI.createRectangle.strokeColorPicker=new k();v.activeTool.toolsUI.createRectangle.strokeColorPicker.value=v.preferences[g.TOOLS.RECTANGLE].strokeColor;v.activeTool.toolsUI.createRectangle.strokeColorPicker.inject(y);v.activeTool.toolsUI.createRectangle.strokeColorPicker.addEventListener("liveChange",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+A.dsModel.value,v.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value);v.imageEditor.getCommand(g.TOOLS.RECTANGLE).setStrokeColor(z);v.activeObjects.forEach(function(B){B.set("stroke",z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.RECTANGLE,"strokeColor",A.dsModel.value)})},_createCircleToolPanel:function(q){var v=this;var u=e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle"}).inject(q).hide();v.activeTool.toolsUI.createCircle.container=u;var w=e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle-weight"}).inject(u);e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle-weight-label",html:n.tools.createCircle.labels.weight}).inject(w);var p=new l({value:v.preferences[g.TOOLS.CIRCLE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(w);v.activeTool.toolsUI.createCircle.weightSpinBox=p;var r=new i({value:v.preferences[g.TOOLS.CIRCLE].weight,minValue:1,maxValue:50,stepValue:1}).inject(w);v.activeTool.toolsUI.createCircle.weightSlider=r;p.addEventListener("change",function(z){r.value=z.dsModel.value;v.imageEditor.getCommand(g.TOOLS.CIRCLE).setStrokeWidth(z.dsModel.value);v.activeObjects.forEach(function(A){A.set("strokeWidth",z.dsModel.value)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.CIRCLE,"weight",z.dsModel.value)});r.addEventListener("change",function(z){p.value=z.dsModel.value});var s=e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle-color"}).inject(u);e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle-color-label",html:n.tools.createCircle.labels.color}).inject(s);var x=new i({value:v.preferences[g.TOOLS.CIRCLE].colorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(s);v.activeTool.toolsUI.createCircle.colorOpacitySlider=x;x.addEventListener("change",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+v.activeTool.toolsUI.createCircle.colorPicker.value,A.dsModel.value);v.imageEditor.getCommand(g.TOOLS.CIRCLE).setFillColor(z);v.activeObjects.forEach(function(B){B.setColor(z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.CIRCLE,"colorOpacity",A.dsModel.value)});v.activeTool.toolsUI.createCircle.colorPicker=new k();v.activeTool.toolsUI.createCircle.colorPicker.value=v.preferences[g.TOOLS.CIRCLE].color;v.activeTool.toolsUI.createCircle.colorPicker.inject(s);v.activeTool.toolsUI.createCircle.colorPicker.addEventListener("liveChange",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+A.dsModel.value,v.activeTool.toolsUI.createCircle.colorOpacitySlider.value);v.imageEditor.getCommand(g.TOOLS.CIRCLE).setFillColor(z);v.activeObjects.forEach(function(B){B.setColor(z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.CIRCLE,"color",A.dsModel.value)});var y=e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle-color"}).inject(u);e.createElement("div",{"class":"annotation-toolbar-active-panel-createcircle-strokecolor-label",html:n.tools.createCircle.labels.strokeColor}).inject(y);var t=new i({value:v.preferences[g.TOOLS.CIRCLE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:0.01}).inject(y);v.activeTool.toolsUI.createCircle.strokeColorOpacitySlider=t;t.addEventListener("change",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+v.activeTool.toolsUI.createCircle.strokeColorPicker.value,A.dsModel.value);v.imageEditor.getCommand(g.TOOLS.CIRCLE).setStrokeColor(z);v.activeObjects.forEach(function(B){B.set("stroke",z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.CIRCLE,"strokeOpacity",A.dsModel.value)});v.activeTool.toolsUI.createCircle.strokeColorPicker=new k();v.activeTool.toolsUI.createCircle.strokeColorPicker.value=v.preferences[g.TOOLS.CIRCLE].strokeColor;v.activeTool.toolsUI.createCircle.strokeColorPicker.inject(y);v.activeTool.toolsUI.createCircle.strokeColorPicker.addEventListener("liveChange",function(A){var z=v.imageEditor.utils.hexToRGBA("#"+A.dsModel.value,v.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value);v.imageEditor.getCommand(g.TOOLS.CIRCLE).setStrokeColor(z);v.activeObjects.forEach(function(B){B.set("stroke",z)});v.imageEditor.canvas.renderAll();v._saveToolPreferences(g.TOOLS.CIRCLE,"strokeColor",A.dsModel.value)})},_onToolSelected:function(s,q,p){var r=this;if(!q){r.sidebar.remove.disabled=true;r.imageEditor.canvas.deactivateAll().renderAll();r.activeObjects=[]}Object.keys(r.activeTool.toolsUI).forEach(function(t){r.activeTool.toolsUI[t].container.hide()});r.sidebar[s].checkFlag=true;r.activeTool.panel.header.innerHTML=n.tools[s].title;if(s in r.activeTool.toolsUI){r.activeTool.toolsUI[s].container.show()}if(s in r._toolsCallbacks){r._toolsCallbacks[s].call(r,p)}r.activeTool.id=s},_toolsCallbacks:{remove:function(){var p=this;p.activeObjects.forEach(function(q){p.imageEditor.canvas.remove(q)});p.imageEditor.canvas.deactivateAll().renderAll()},select:function(){var p=this;p.imageEditor.stopCommand()},freedrawing:function(){var q=this;var p=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.freedrawing.colorPicker.value,q.activeTool.toolsUI.freedrawing.colorOpacitySlider.value);q.imageEditor.startCommand(g.TOOLS.FREEDRAWING,{width:q.activeTool.toolsUI.freedrawing.weightSpinBox.value,color:p})},highlight:function(p){var q=this;if(p!==null&&p!==undefined){if(p.hasOwnProperty("color")){q.activeTool.toolsUI.highlight.colorPicker.value=p.color}if(p.hasOwnProperty("opacity")){q.activeTool.toolsUI.highlight.opacitySpinBox.value=p.opacity}}q.imageEditor.startCommand(g.TOOLS.HIGHLIGHT,{color:q.activeTool.toolsUI.highlight.colorPicker.value,opacity:q.activeTool.toolsUI.highlight.opacitySpinBox.value})},createText:function(q){var r=this;if(q!==null&&q!==undefined){if(q.hasOwnProperty("fillColor")){r.activeTool.toolsUI.createText.colorPicker.value=q.fillColor}if(q.hasOwnProperty("fillOpacity")){r.activeTool.toolsUI.createText.colorOpacitySlider.value=q.fillOpacity}if(q.hasOwnProperty("strokeColor")){r.activeTool.toolsUI.createText.strokeColorPicker.value=q.strokeColor}if(q.hasOwnProperty("strokeOpacity")){r.activeTool.toolsUI.createText.strokeColorOpacitySlider.value=q.strokeOpacity}if(q.hasOwnProperty("backgroundColor")){r.activeTool.toolsUI.createText.backgroundColorPicker.value=q.backgroundColor}if(q.hasOwnProperty("backgroundOpacity")){r.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value=q.backgroundOpacity}if(q.hasOwnProperty("fontSize")){r.activeTool.toolsUI.createText.weightSpinBox.disabled=true;r.activeTool.toolsUI.createText.weightSlider.disabled=true;r.activeTool.toolsUI.createText.weightSpinBox.value=q.fontSize;r.activeTool.toolsUI.createText.weightSlider.value=q.fontSize;r.activeTool.toolsUI.createText.weightSpinBox.disabled=false;r.activeTool.toolsUI.createText.weightSlider.disabled=false}}var t=r.imageEditor.utils.hexToRGBA("#"+r.activeTool.toolsUI.createText.colorPicker.value,r.activeTool.toolsUI.createText.colorOpacitySlider.value);var s=r.imageEditor.utils.hexToRGBA("#"+r.activeTool.toolsUI.createText.strokeColorPicker.value,r.activeTool.toolsUI.createText.strokeColorOpacitySlider.value);var p=r.imageEditor.utils.hexToRGBA("#"+r.activeTool.toolsUI.createText.backgroundColorPicker.value,r.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value);r.imageEditor.startCommand(g.TOOLS.TEXT,{fontSize:r.activeTool.toolsUI.createText.weightSpinBox.value,fillColor:t,strokeColor:s,backgroundColor:p})},createArrow:function(p){var q=this;if(p!==null&&p!==undefined){if(p.hasOwnProperty("fillColor")){q.activeTool.toolsUI.createArrow.colorPicker.value=p.fillColor}if(p.hasOwnProperty("fillOpacity")){q.activeTool.toolsUI.createArrow.colorOpacitySlider.value=p.fillOpacity}if(p.hasOwnProperty("strokeColor")){q.activeTool.toolsUI.createArrow.strokeColorPicker.value=p.strokeColor}if(p.hasOwnProperty("strokeOpacity")){q.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value=p.strokeOpacity}if(p.hasOwnProperty("size")){q.activeTool.toolsUI.createArrow.weightSpinBox.disabled=true;q.activeTool.toolsUI.createArrow.weightSlider.disabled=true;q.activeTool.toolsUI.createArrow.weightSpinBox.value=p.size;q.activeTool.toolsUI.createArrow.weightSlider.value=p.size;q.activeTool.toolsUI.createArrow.weightSpinBox.disabled=false;q.activeTool.toolsUI.createArrow.weightSlider.disabled=false}}var s=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.createArrow.colorPicker.value,q.activeTool.toolsUI.createArrow.colorOpacitySlider.value);var r=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.createArrow.strokeColorPicker.value,q.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value);q.imageEditor.startCommand(g.TOOLS.ARROW,{size:q.activeTool.toolsUI.createArrow.weightSpinBox.value,fillColor:s,strokeColor:r})},createRectangle:function(p){var q=this;if(p!==null&&p!==undefined){if(p.hasOwnProperty("fillColor")){q.activeTool.toolsUI.createRectangle.colorPicker.value=p.fillColor}if(p.hasOwnProperty("fillOpacity")){q.activeTool.toolsUI.createRectangle.colorOpacitySlider.value=p.fillOpacity}if(p.hasOwnProperty("strokeColor")){q.activeTool.toolsUI.createRectangle.strokeColorPicker.value=p.strokeColor}if(p.hasOwnProperty("strokeOpacity")){q.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value=p.strokeOpacity}if(p.hasOwnProperty("strokeWidth")){q.activeTool.toolsUI.createRectangle.weightSpinBox.disabled=true;q.activeTool.toolsUI.createRectangle.weightSlider.disabled=true;q.activeTool.toolsUI.createRectangle.weightSpinBox.value=p.strokeWidth;q.activeTool.toolsUI.createRectangle.weightSlider.value=p.strokeWidth;q.activeTool.toolsUI.createRectangle.weightSpinBox.disabled=false;q.activeTool.toolsUI.createRectangle.weightSlider.disabled=false}}var s=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.createRectangle.colorPicker.value,q.activeTool.toolsUI.createRectangle.colorOpacitySlider.value);var r=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.createRectangle.strokeColorPicker.value,q.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value);q.imageEditor.startCommand(g.TOOLS.RECTANGLE,{strokeWidth:q.activeTool.toolsUI.createRectangle.weightSpinBox.value,fillColor:s,strokeColor:r})},createCircle:function(p){var q=this;if(p!==null&&p!==undefined){if(p.hasOwnProperty("fillColor")){q.activeTool.toolsUI.createCircle.colorPicker.value=p.fillColor}if(p.hasOwnProperty("fillOpacity")){q.activeTool.toolsUI.createCircle.colorOpacitySlider.value=p.fillOpacity}if(p.hasOwnProperty("strokeColor")){q.activeTool.toolsUI.createCircle.strokeColorPicker.value=p.strokeColor}if(p.hasOwnProperty("strokeOpacity")){q.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value=p.strokeOpacity}if(p.hasOwnProperty("strokeWidth")){q.activeTool.toolsUI.createCircle.weightSpinBox.disabled=true;q.activeTool.toolsUI.createCircle.weightSlider.disabled=true;q.activeTool.toolsUI.createCircle.weightSpinBox.value=p.strokeWidth;q.activeTool.toolsUI.createCircle.weightSlider.value=p.strokeWidth;q.activeTool.toolsUI.createCircle.weightSpinBox.disabled=false;q.activeTool.toolsUI.createCircle.weightSlider.disabled=false}}var s=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.createCircle.colorPicker.value,q.activeTool.toolsUI.createCircle.colorOpacitySlider.value);var r=q.imageEditor.utils.hexToRGBA("#"+q.activeTool.toolsUI.createCircle.strokeColorPicker.value,q.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value);q.imageEditor.startCommand(g.TOOLS.CIRCLE,{strokeWidth:q.activeTool.toolsUI.createCircle.weightSpinBox.value,fillColor:s,strokeColor:r})},insertImage:function(){var p=this;p.imageEditor.stopCommand();p.imageEditor.insertImage()}},_onKeyDown:function(s){var q=this;if((s.keyCode===g.KEY_CODES.BACKSPACE||s.keyCode===g.KEY_CODES.DEL)){q._toolsCallbacks.remove.call(q)}if(s.keyCode===65&&s.ctrlKey){s.preventDefault();q.imageEditor.selectAll()}if(s.keyCode===67&&s.ctrlKey){s.stopPropagation();var r=q.imageEditor.canvas.getActiveObject();if(r===null){r=q.imageEditor.canvas.getActiveGroup()}r.clone(function(t){q._clipboard=t})}if(s.keyCode===86&&s.ctrlKey){var p=q.imageEditor.canvas.getActiveObject();if(p!==null&&p.annotationType===g.TOOLS.TEXT&&p.isEditing){return}if(q._clipboard===null||q._clipboard===undefined){return}s.stopPropagation();q._clipboard.clone(function(t){q.imageEditor.canvas.deactivateAll();t.set({left:t.left+30,top:t.top+30,evented:true});if(t.type==="group"){t.forEachObject(function(u){q.imageEditor.canvas.add(u)});t.setCoords();q.imageEditor.canvas.setActiveGroup(t)}else{q.imageEditor.canvas.add(t);q.imageEditor.canvas.setActiveObject(t)}q._clipboard.top+=30;q._clipboard.left+=30});q.imageEditor.canvas.renderAll()}},_saveToolPreferences:function(p,q,s){var r=this;r.preferences[p][q]=s;localStorage.setItem(g.PREFERENCES.TOOL_PREFERENCES.KEY,JSON.stringify(r.preferences))}});return f});define("DS/2DAnnotation/components/ImageEditor",["UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/FabricJS/FabricJS","DS/Logger/Logger","DS/VENWebHtml2Canvas/Html2Canvas","DS/WAFData/WAFData","DS/2DAnnotation/commands/CreateArrow","DS/2DAnnotation/commands/CreateCircle","DS/2DAnnotation/commands/CreateRectangle","DS/2DAnnotation/commands/CreateText","DS/2DAnnotation/commands/FreeDrawing","DS/2DAnnotation/commands/Highlight","DS/IssueCommon/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(e,p,i,k,q,h,a,g,o,l,j,r,m,c,d){var b=window.fabric;var n={COMMANDS:{FREE_DRAWING:"freedrawing",HIGHLIGHT:"highlight",TEXT:"createText",ARROW:"createArrow",RECTANGLE:"createRectangle",CIRCLE:"createCircle"}};var f=p.extend({name:"DS/2DAnnotation/components/ImageEditor",_logger:null,commands:{},elements:{},canvas:null,init:function(){var t=this;d.start(t.name+" init");t._logger=q.getLogger(t.name);var s=i.createElement("canvas");t.commands={};t.commands[n.COMMANDS.FREE_DRAWING]=new r({imageEditor:t});t.commands[n.COMMANDS.HIGHLIGHT]=new m({imageEditor:t});t.commands[n.COMMANDS.TEXT]=new j({imageEditor:t});t.commands[n.COMMANDS.ARROW]=new g({imageEditor:t});t.commands[n.COMMANDS.RECTANGLE]=new l({imageEditor:t});t.commands[n.COMMANDS.CIRCLE]=new o({imageEditor:t});t.activeCommand="";t.elements={container:s};t.canvas=null;d.end(t.name+" init")},load:function(s){var t=this;return new e(function(w){if(t.canvas){t.canvas.dispose()}var x;var v;var u;if(s){t.elements.container.inject(s);var y=s.getSize();v=y.width;u=y.height}x=new b.Canvas(t.elements.container,{width:t.defaultWidth||v,height:t.defaultHeight||u,containerClass:"annotation-canvas-container"});t.canvas=x;w(t)})},destroy:function(){var s=this;s.canvas.dispose();s.canvas=null;s.commands={};s.elements.container.empty();s.elements.container.destroy();s.elements={container:null}},openURL:function(s){var t=this;return new e(function(v,u){a.authenticatedRequest(s,{method:"GET",responseType:"blob",onComplete:function(w){t.loadFile(w).then(v)["catch"](u)},onFailure:u})})},openFile:function(){var s=this;return c.uploadImages(false).then(function(t){return s.loadFile(t[0])})},loadFile:function(s){var t=this;return c.readImageURI(s).then(function(u){return t.loadURI(u)})},loadURI:function(s){var t=this;return new e(function(v,u){b.util.loadImage(s,function(w){if(w){t.canvas.clear();t.bgImage=w.src;var x=new b.Image(w);t.canvas.setBackgroundImage(x,function y(){t.canvas.setWidth(w.width);t.canvas.setHeight(w.height);t.canvas.renderAll();v()},{originX:"left",originY:"top"})}else{u(new Error("error during image loading."))}})})},insertImage:function(){var s=this;return c.uploadImages(false).then(function(t){return c.readImageURI(t[0])}).then(function(t){return new e(function(v,u){b.util.loadImage(t,function(w){if(w){var x=new b.Image(w,{left:(s.canvas.width/2)-(w.width/2),top:(s.canvas.height/2)-(w.height/2)});s.canvas.add(x);s.canvas.renderAll()}else{u(new Error("error during image loading."))}})})})},capture:function(u,s){var t=this;return t.utils.capture(u).then(function(v){return t.loadURI(v.dataURL,s)})},save:function(){var s=this;if(s.canvas){var t={dataURL:null,blob:null};t.dataURL=s.canvas.toDataURL("image/jpeg");t.blob=s.utils.b64toBlob(t.dataURL);return t}else{throw new Error("canvas not instantiated")}},download:function(y){var w=this;var x=w.save();var v;if(y){v=y}else{var t=new Date();v=t.toLocaleString().replace(",","")+".png";v=v.replace(/\s/g,"_")}if(!window.navigator.msSaveBlob){var u=i.createElement("a",{id:"download-image"});u.setAttribute("download",v);u.href=x.dataURL;var s=document.createEvent("MouseEvents");s.initEvent("click",false,true);u.dispatchEvent(s)}else{window.URL.createObjectURL(x.blob);window.navigator.msSaveBlob(x.blob,v)}},clear:function(){var s=this;return new e(function(v,u){if(s.canvas){s.canvas.clear();if(s.bgImage){s.canvas.setBackgroundImage(s.bgImage,function t(){s.canvas.renderAll();v()},{originX:"left",originY:"top"})}else{v()}}else{u(new Error("canvas not instantiated"))}})},selectAll:function(){var s=this;var t=s.canvas.getObjects().map(function(v){return v.set("active",true)});var u=new b.Group(t,{originX:"center",originY:"center"});s.canvas._activeObject=null;s.canvas.setActiveGroup(u.setCoords()).renderAll()},getCommand:function(u){var t=this;var s=null;if(u in t.commands){s=t.commands[u]}return s},startCommand:function(u,s){var t=this;if(t.activeCommand in t.commands){t.commands[t.activeCommand].end();t.activeCommand=""}if(u in t.commands){t.commands[u].start(s);t.activeCommand=u}return t},stopCommand:function(){var s=this;if(s.activeCommand in s.commands){s.commands[s.activeCommand].end();s.activeCommand=""}return s},utils:{hexToRGBA:function(t,s){var v,u;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t)){v=t.substring(1).split("");if(v.length===3){v=[v[0],v[0],v[1],v[1],v[2],v[2]]}v="0x"+v.join("");if(s===null||s===undefined){u=0}else{u=s}return"rgba("+[(v>>16)&255,(v>>8)&255,v&255].join(",")+","+u+")"}throw new Error("Bad Hex")},RGBAtoHex:function(w){var u={};if(w.startsWith("rgba(")){var t=function(A){return A.replace(/^\s+|\s+$/gm,"")};var z=w.substring(w.indexOf("(")).split(","),y=parseInt(t(z[0].substring(1)),10),x=parseInt(t(z[1]),10),s=parseInt(t(z[2]),10),v=parseFloat(t(z[3].substring(0,z[3].length-1)));u.hex=("#"+y.toString(16).padStart(2,"0")+x.toString(16).padStart(2,"0")+s.toString(16).padStart(2,"0"));u.opacity=v}else{if(w.startsWith("#")){u.hex=w}}return u},b64toBlob:function(v){var w=atob(v.split(",")[1]);var u=new ArrayBuffer(w.length);var s=new Uint8Array(u);for(var t=0;t<w.length;t++){s[t]=w.charCodeAt(t)}return new Blob([u],{type:"image/jpeg"})},capture:function(v,s){var u=this;var t;if(!s){t={timeout:100}}else{t=s}return new e(function(x){var w=new h();w.htmlToCanvas(v,t,function(y){var z={canvas:y,dataURL:y.toDataURL("image/jpeg"),blob:null};z.blob=u.b64toBlob(z.dataURL);x(z)})})}}});f.utils=f.prototype.utils;return f});define("DS/2DAnnotation/2DAnnotation",["UWA/Class/View","UWA/Core","UWA/Promise","DS/Logger/Logger","DS/UIKIT/Mask","DS/Windows/ImmersiveFrame","DS/2DAnnotation/views/Toolbar","DS/2DAnnotation/views/Workspace","DS/2DAnnotation/components/ImageEditor","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],function(a,f,k,d,e,g,i,h,j,c){var b=a.extend({name:"DS/2DAnnotation/2DAnnotation",tagName:"div",className:"annotation-container",isLoaded:null,_deferred:{resolve:null,reject:null},_logger:null,setup:function(l){var m=this;c.start(m.name+" setup");m._parent(l);m._logger=d.getLogger(m.name);m.callbacks={saveCallback:l.saveCallback,exitCallback:l.exitCallback};m.imageEditor=new j({});if(l.hasOwnProperty("defaultDimensions")){if(f.is(l.defaultDimensions.width,"number")){m.imageEditor.defaultWidth=l.defaultDimensions.width}if(f.is(l.defaultDimensions.height,"number")){m.imageEditor.defaultHeight=l.defaultDimensions.height}}m.immersiveFrame=new g();m.immersiveFrame.elements.container.addClassName("annotation-frame-container");m.workspace=new h({});m.toolbar=new i(m.immersiveFrame,m.imageEditor,m.callbacks);m.imageURL=l.imageURL;m.captureTarget=l.captureTarget;c.end(m.name+" setup")},render:function(){var l=this;c.start(l.name+" render");l.isLoaded=new k(function(n,m){l._deferred.resolve=n;l._deferred.reject=m});e.mask(l.container);l.imageEditor.load(l.workspace.container).then(function(){var m;if(l.imageURL){m=l.openURL(l.imageURL,l.workspace.container)}else{if(l.captureTarget){m=l.capture(l.captureTarget,l.workspace.container)}}return m}).then(function(){l.immersiveFrame.inject(l.container);l.workspace.render().inject(l.immersiveFrame.getFreeZone());l.toolbar.render().listen();e.unmask(l.container);l._deferred.resolve();c.end(l.name+" render")})["catch"](l._deferred.reject);return l},capture:function(m){var l=this;return l.imageEditor.capture(m,l.workspace.container)},openURL:function(l){var m=this;return m.imageEditor.openURL(l,m.workspace.container)},destroy:function(){var l=this;l.imageEditor.destroy();l.imageEditor=null;l.immersiveFrame.destroy();l.immersiveFrame=null;l.workspace.destroy();l.workspace=null;l.toolbar.destroy();l.toolbar=null;l.container.empty();l.container.destroy()}});return b});