function ENX3DScene(b){var c=function(e){var d=false;if(UWA.is(e,"boolean")){d=e}else{if(UWA.is(e,"string")){d=e.toLowerCase()==="true"}}return d};var a={widget:null,pad3DViewer:null,paddebug:false,init:function(d){this.pcsPrefix=d.widget.id+"_"+d.widget.title;this.widget=d.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onSearch",this.onSearch.bind(this))},onRefresh:function(){this.pad3DViewer.refresh()},onLoad:function(){var d=this;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","text!DS/ENX3DScene/assets/json/ENOX3DSCSettingsMgt.json","DS/ENOPAD3DViewer/PAD3DViewer","DS/Selection/CSOManager","UWA/Utils/Client"],function(k,e,m,l,h,g){function i(){if(!d.widget.getValue("x3dSharedId")&&!d.widget.getValue("x3dAppId")){d.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENXScene_appId"})}k.setSetting("lang",d.widget.lang);e.addSharedSettings(d.widget,["x3dPlatformId","storedObjectMgt","maxDashSearch"]);var n=widget.getValue("authorizeChangeControl");if(UWA.is(n,"string")&&n.toLowerCase()==="true"){k.setSetting("authorizeChangeControl",n)}d.widget.addEvent("endEdit",k.updateWidgetPreferences.bind(k));d.widget.mergePreferences(k.getWidgetPreferences());k.addEvent("onEnox3dsc_activateBI",function(o){if(d.pad3DViewer&&d.pad3DViewer.getBIController()){d.pad3DViewer.getBIController().toggleBetweenStandaloneAndSlaveMode(o===true?"STANDALONE":"SLAVE")}});k.addEvent("onEnopad3dviewer_navigate_with_wrap",function(o){if(d.pad3DViewer&&d.pad3DViewer.getController()){d.pad3DViewer.getController().setWrapUsage(o)}});k.addEvent("onEnopad3dviewer_CGRorTHB",function(o){if(d.pad3DViewer&&d.pad3DViewer.getController()){d.pad3DViewer.setDefaultStreamToLoad(o)}});k.addEvent("onDisplay_sceneGraph",function(o){if(d.pad3DViewer){d.pad3DViewer.displayTree(o)}});k.updateWidgetPreferences();if(!d.widget.getValue("ENOX3DSC_RootIds")){widget.addPreference({name:"ENOX3DSC_RootIds",type:"hidden",defaultValue:"[]"})}if(!d.widget.getValue("ENOX3DSC_DetachedRootIds")){widget.addPreference({name:"ENOX3DSC_DetachedRootIds",type:"hidden",defaultValue:"[]"})}if(!d.widget.getValue("x3dSharedId")&&!d.widget.getValue("x3dAppId")){d.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOPAD_appId"})}}function j(){d.pad3DViewer.subscribe({event:"onActionBarReady"},function(){d.widget.setBody(d.pad3DViewer.render());var n=false;if(k.getSetting("authorizeChangeControl")===true){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(p,q){var o=d.pad3DViewer.elements.triptych.getMainPanelContainer();var r="hide";if(k.getSetting("changeControlActivation")===true){r="show"}p.initialize2(o,q.appId(),r,k.getSetting("changeControlPosition"),function(t){if(t.isLicenseValid){d.debouncePrefSynchro=false;d._proxy=q.create({events:{onPreferenceModification:function(v){if(v.name==="changeControlActivation"){d.debouncePrefSynchro=true;d.widget.setValue(v.name,v.value);k.setSetting(v.name,v.value)}}}});var s=k.getSetting("changeControlActivation");if(d.widget.getValue("changeControlActivation")!==undefined){s=d.widget.getBool("changeControlActivation")}var u="top-right";if(sessionStorage.getItem("changeControlPosition")){u=sessionStorage.getItem("changeControlPosition3DNavigation")}else{u=k.getSetting("changeControlPosition")}p.setPosition(u);d.widget.addPreference({name:"changeControlActivation",defaultValue:s,type:"boolean",label:"changeControlActivation_label"});d.widget.addPreference({name:"changeControlPosition",defaultValue:u,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"}]});k.addEvent("onChangeControlActivation",function(v){if(!d.debouncePrefSynchro){d._proxy.preferenceModification({name:"changeControlActivation",value:v})}else{d.debouncePrefSynchro=false}if(v===true){p.show()}else{p.hide()}});k.addEvent("onChangeControlPosition",function(v){p.setPosition(v);sessionStorage.setItem("changeControlPosition3DNavigation",v)})}})})}if(d.widget.widgetDomain&&d.widget.widgetDomain.indexOf("debug_me")>0){console.warn("Debug mode activated");d.pad3DViewer.displayTree(k.getSetting("display_sceneGraph"));if(d.pad3DViewer.getBIController()){d.pad3DViewer.getBIController().toggleBetweenStandaloneAndSlaveMode(k.getSetting("enox3dsc_activateBI")===true?"STANDALONE":"SLAVE")}}if(d.pad3DViewer.getLevelSelectorCommand){d.pad3DViewer.getLevelSelectorCommand(function(o){if(o){o.displayLabels(true)}})}});d.pad3DViewer.subscribe({event:"onReady"},function(q){var p=JSON.parse(d.widget.getValue("ENOX3DSC_RootIds"));var n=JSON.parse(d.widget.getValue("ENOX3DSC_DetachedRootIds"));d.widget.setValue("ENOX3DSC_RootIds","[]");d.widget.setValue("ENOX3DSC_DetachedRootIds","[]");var r=d.widget.getValue("X3DContentId");d.widget.deleteValue("X3DContentId");var o=[];p.forEach(function(s){if(UWA.is(s,"array")){o.push({path:s,hidden:n.indexOf(s[0])>=0?true:false})}else{o.push({path:[s],hidden:n.indexOf(s)>=0?true:false})}});if(p.length>0){if(k.getSetting("activate_loadPopUp")===true&&c(d.widget.getValue("storedObjectMgt"))){require(["DS/PADUtils/views/PADStoredObjMgt"],function(u){var t=d.widget.getValue("ENOX3DSC_objectInfos");if(UWA.is(t,"string")){t=JSON.parse(t)}else{t={}}var s=new u({render_div:".enopad3Dviewer_mainTriptych",objects3D:o,objectInfos:t,events:{onLoadObjects:function(v){d.pad3DViewer.addRoots({objects:v.objects3D,},false);d.widget.setValue("ENOX3DSC_objectInfos",JSON.stringify(v.objectInfos));if(c(d.widget.getValue("storedObjectMgt"))!==v.showStoredObjectMgt){d.widget.setValue("storedObjectMgt",v.showStoredObjectMgt)}}}})})}else{d.pad3DViewer.addRoots({objects:o,},false)}}else{if(r){setTimeout(function(){d.pad3DViewer.addRootNodesFromContent({json3DXContent:JSON.parse(r),dispatch:false})},0)}}d.widget.dispatchEvent("onENOPADReady")});d.pad3DViewer.subscribe({event:"onRootAdded"},function(p){if(p.rootLog){var o=p.rootLog;d.widget.setValue("ENOX3DSC_RootIds",JSON.stringify(o))}if(p.id&&p.hidden){var n=JSON.parse(d.widget.getValue("ENOX3DSC_DetachedRootIds"));n.push(p.id);d.widget.setValue("ENOX3DSC_DetachedRootIds",JSON.stringify(n))}d.pad3DViewer.getContentName({callbacks:{onComplete:function(q){d.widget.setTitle(q.contentName)}}})});d.pad3DViewer.subscribe({event:"onRootRemoved"},function(q){if(q.rootLog){var p=q.rootLog;d.widget.setValue("ENOX3DSC_RootIds",JSON.stringify(p))}if(q.id){var n=JSON.parse(d.widget.getValue("ENOX3DSC_DetachedRootIds"));for(var o=0;o<n.length;o++){if(n[o]===q.id){n.splice(o,1);break}}d.widget.setValue("ENOX3DSC_DetachedRootIds",JSON.stringify(n))}d.pad3DViewer.getContentName({callbacks:{onComplete:function(r){d.widget.setTitle(r.contentName)}}})});d.pad3DViewer.subscribe({event:"onRootAttached"},function(p){if(p.id){var n=JSON.parse(d.widget.getValue("ENOX3DSC_DetachedRootIds"));for(var o=0;o<n.length;o++){if(n[o]===p.id){n.splice(o,1);break}}d.widget.setValue("ENOX3DSC_DetachedRootIds",JSON.stringify(n))}d.pad3DViewer.getContentName({callbacks:{onComplete:function(q){d.widget.setTitle(q.contentName)}}})});d.pad3DViewer.subscribe({event:"onRootDetached"},function(o){if(o.id){var n=JSON.parse(d.widget.getValue("ENOX3DSC_DetachedRootIds"));n.push(o.id);d.widget.setValue("ENOX3DSC_DetachedRootIds",JSON.stringify(n))}d.pad3DViewer.getContentName({callbacks:{onComplete:function(p){d.widget.setTitle(p.contentName)}}})})}m=UWA.is(m,"string")?JSON.parse(m):m;k.setApp(m,"enx3dscene",true);var f=g.Features.touchEvents&&!g.Features.pointerEvents?m.actionBarWkb.touch:m.actionBarWkb.standard;m.enx3dscene.layout_options.frmWindow_opts.workbench=f.file;m.enx3dscene.layout_options.frmWindow_opts.workbenchModule=f.module;if(d.pad3DViewer===null){i();d.pad3DViewer=new l({widget:d.widget,css_view_class:d.css_view_class,windowOptions:m.enx3dscene.layout_options.frmWindow_opts,allowAuthoring:false,authorizeSet3DStructure:true,selectiveLoading:UWA.is(k.getSetting("enopad3dviewer_selectiveLoading"),"boolean")?k.getSetting("enopad3dviewer_selectiveLoading"):k.getSetting("enopad3dviewer_selectiveLoading")==="true",enableSidePanel:true,propertiesFacet:UWA.is(k.getSetting("propertiesFacet"),"array")?k.getSetting("propertiesFacet"):[]});j()}})},onSearch:function(e){var d={searchQuery:e};this.pad3DViewer.search(d)},onDestroy:function(){this.pad3DViewer.destroy();var d=require("DS/PADUtils/PADSharedSettings");d.destroy()}};a.init(b);return a}function ENX3DSceneV2(b){var c=function(e){var d=false;if(UWA.is(e,"boolean")){d=e}else{if(UWA.is(e,"string")){d=e.toLowerCase()==="true"}}return d};var a={widget:null,pad3DViewer:null,landingPage:null,mainDiv:null,paddebug:false,init:function(d){this.pcsPrefix=d.widget.id+"_"+d.widget.title;this.widget=d.widget;this.widget.addEvent("onLoad",this.onLoad.bind(this));this.widget.addEvent("onRefresh",this.onRefresh.bind(this));this.widget.addEvent("onSearch",this.onSearch.bind(this))},onRefresh:function(){this.pad3DViewer.refresh()},onLoad:function(){var g=this;var e=-1,f=widget.preferences.length;for(var d=0;d<f&&e===-1;d++){if(widget.preferences[d].name==="storedObjectMgt"){e=d}}if(e!==-1){widget.preferences.splice(e,1)}require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","text!DS/ENX3DScene/assets/json/ENOX3DSCSettingsMgt.json","DS/ENOPAD3DViewer/PAD3DViewer","DS/Selection/CSOManager","UWA/Utils/Client"],function(n,h,p,o,k,j){function l(){if(!g.widget.getValue("x3dSharedId")&&!g.widget.getValue("x3dAppId")){g.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENXScene_appId"})}n.setSetting("lang",g.widget.lang);h.addSharedSettings(g.widget,["x3dPlatformId","maxDashSearch","autoreload"]);var q=widget.getValue("authorizeChangeControl");if(UWA.is(q,"string")&&q.toLowerCase()==="true"){n.setSetting("authorizeChangeControl",q)}g.widget.addEvent("endEdit",n.updateWidgetPreferences.bind(n));g.widget.mergePreferences(n.getWidgetPreferences());n.addEvent("onEnox3dsc_activateBI",function(r){if(g.pad3DViewer&&g.pad3DViewer.getBIController()){g.pad3DViewer.getBIController().toggleBetweenStandaloneAndSlaveMode(r===true?"STANDALONE":"SLAVE")}});n.addEvent("onEnopad3dviewer_navigate_with_wrap",function(r){if(g.pad3DViewer&&g.pad3DViewer.getController()){g.pad3DViewer.getController().setWrapUsage(r)}});n.addEvent("onEnopad3dviewer_CGRorTHB",function(r){if(g.pad3DViewer&&g.pad3DViewer.getController()){g.pad3DViewer.setDefaultStreamToLoad(r)}});n.addEvent("onDisplay_sceneGraph",function(r){if(g.pad3DViewer){g.pad3DViewer.displayTree(r)}});n.updateWidgetPreferences();if(!g.widget.getValue("ENOX3DSC_RootIds")){widget.addPreference({name:"ENOX3DSC_RootIds",type:"hidden",defaultValue:"[]"})}if(!g.widget.getValue("ENOX3DSC_DetachedRootIds")){widget.addPreference({name:"ENOX3DSC_DetachedRootIds",type:"hidden",defaultValue:"[]"})}if(!g.widget.getValue("x3dSharedId")&&!g.widget.getValue("x3dAppId")){g.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOPAD_appId"})}}function m(){g.pad3DViewer.subscribe({event:"onActionBarReady"},function(){g.landingPage.appReady();var q=false;if(n.getSetting("authorizeChangeControl")===true){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(t,u){var s=g.pad3DViewer.elements.triptych.getMainPanelContainer();var v="hide";if(n.getSetting("changeControlActivation")===true){v="show"}t.initialize2(s,u.appId(),v,n.getSetting("changeControlPosition"),function(x){if(x.isLicenseValid){g.debouncePrefSynchro=false;g._proxy=u.create({events:{onPreferenceModification:function(z){if(z.name==="changeControlActivation"){g.debouncePrefSynchro=true;g.widget.setValue(z.name,z.value);n.setSetting(z.name,z.value)}}}});var w=n.getSetting("changeControlActivation");if(g.widget.getValue("changeControlActivation")!==undefined){w=g.widget.getBool("changeControlActivation")}var y="top-right";if(sessionStorage.getItem("changeControlPosition")){y=sessionStorage.getItem("changeControlPosition3DNavigation")}else{y=n.getSetting("changeControlPosition")}t.setPosition(y);g.widget.addPreference({name:"changeControlActivation",defaultValue:w,type:"boolean",label:"changeControlActivation_label"});g.widget.addPreference({name:"changeControlPosition",defaultValue:y,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"}]});n.addEvent("onChangeControlActivation",function(z){if(!g.debouncePrefSynchro){g._proxy.preferenceModification({name:"changeControlActivation",value:z})}else{g.debouncePrefSynchro=false}if(z===true){t.show()}else{t.hide()}});n.addEvent("onChangeControlPosition",function(z){t.setPosition(z);sessionStorage.setItem("changeControlPosition3DNavigation",z)})}})})}if(g.widget.widgetDomain&&g.widget.widgetDomain.indexOf("debug_me")>0){console.warn("Debug mode activated");g.pad3DViewer.displayTree(n.getSetting("display_sceneGraph"));if(g.pad3DViewer.getBIController()){g.pad3DViewer.getBIController().toggleBetweenStandaloneAndSlaveMode(n.getSetting("enox3dsc_activateBI")===true?"STANDALONE":"SLAVE")}}if(g.pad3DViewer.getLevelSelectorCommand){g.pad3DViewer.getLevelSelectorCommand(function(s){if(s){s.displayLabels(true)}})}var r=g.widget.getValue("X3DContentId");g.widget.deleteValue("X3DContentId");if(r){setTimeout(function(){g.pad3DViewer.addRootNodesFromContent({json3DXContent:JSON.parse(r),dispatch:false})},0)}g.widget.dispatchEvent("onENOPADReady")})}p=UWA.is(p,"string")?JSON.parse(p):p;n.setApp(p,"enx3dscene",true);var i=p.actionBarWkb.welcome;p.enx3dscene.layout_options.frmWindow_opts.workbench=i.file;p.enx3dscene.layout_options.frmWindow_opts.workbenchModule=i.module;if(g.pad3DViewer===null){l();require(["DS/PADServices/views/LandingPage"],function(q){g.mainDiv=UWA.createElement("div",{"class":"appMain",styles:{width:"auto",height:"100%"}});g.landingPage=new q({widget:g.widget,readOnlyApp:true,renderDiv:g.mainDiv,onLandingPageReady:function(r){g.widget.setBody(g.mainDiv)}});g.landingPage.initialize().then(function(r){g.pad3DViewer=new o({widget:g.widget,css_view_class:g.css_view_class,windowOptions:p.enx3dscene.layout_options.frmWindow_opts,allowAuthoring:false,authorizeSet3DStructure:true,selectiveLoading:UWA.is(n.getSetting("enopad3dviewer_selectiveLoading"),"boolean")?n.getSetting("enopad3dviewer_selectiveLoading"):n.getSetting("enopad3dviewer_selectiveLoading")==="true",enableSidePanel:true,propertiesFacet:UWA.is(n.getSetting("propertiesFacet"),"array")?n.getSetting("propertiesFacet"):[],objects2Load:r});g.landingPage.setViewer(g.pad3DViewer);m()})})}})},onSearch:function(e){var d={searchQuery:e};this.pad3DViewer.search(d)},onDestroy:function(){this.landingPage.destroy();var d=require("DS/PADUtils/PADSharedSettings");d.destroy()}};a.init(b);return a};