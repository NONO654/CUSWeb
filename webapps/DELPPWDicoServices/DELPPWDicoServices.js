define("DS/DELPPWDicoServices/ModelConfigExt",["UWA/Core","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWWebServices/WebserviceUtils"],function(h,b,a){var f={_pprTypes:[],_validChildTypesMap:{},_relationsList:{},_customRelationsList:{},_retrievePPRTypes:function k(v,t){var r=this;a.webServiceRequest({url:"modeler/ppr/getPPRTypes",method:"GET",onComplete:function q(w){r._pprTypes=w;v()},onFailure:function s(w){r._pprTypes=[];t(w)},onTimeout:function u(w){r._pprTypes=[];t(w)},})},_retrieveValidChildTypes:function p(v,s){var q=this,u=widget.getBool("oneDelmiaAggregationMode");a.webServiceRequest({url:"modeler/ppr/getChildTypes",method:"GET",data:{oneDelmiaAggregationMode:u},onComplete:function t(x){q._validChildTypesMap=x;v()},onFailure:function r(x){q._validChildTypesMap=[];s(x)},onTimeout:function w(x){q._validChildTypesMap=[];s(x)}})},_retrieveModelRelations:function l(u,s){var q=this;a.getXMLValues(q.options.modelRelationsXML,function t(v){q._relationsList=v.RelationsList;u()},function r(v){s(v)})},_retrieveModelCustomRelations:function m(u,s){var q=this;a.getXMLValues(q.options.modelCustomRelationsXML,function t(w){var A,v,D,E={},y={},z,C,B=[],x=0;if(h.is(w.CustomRelationsList.RelationConfig)){z=w.CustomRelationsList.RelationConfig;z=Array.isArray(z)?z:[z];for(A=0;A<z.length;A++){v=z[A].fromType;D=z[A].toType;C=z[A]["Relation"];B=[];if(!h.is(y[v])){y[v]={}}y[v][D]=false;if(h.is(C)){C=Array.isArray(C)?C:[C];for(x=0;x<C.length;x++){if(C[x]["type"]==="Instance"){y[v][D]=h.Json.decode(C[x].write)===true}else{B.push(C[x])}}}if(!h.is(E[v])){E[v]={}}E[v][D]={Relation:B}}q._customRelationsList=E;q._processCustomInstanceConfig(y)}u()},function r(v){s(v)})},getPPRType:function o(q){if(!h.is(q)){b.debug(this.name,"type is undefined");return}return this._pprTypes[q]},_processCustomInstanceConfig:function e(s){var r=this,x,w,u,q,v,t;if(h.is(s)){for(x in s){if(s.hasOwnProperty(x)){for(w in s[x]){if(s[x].hasOwnProperty(w)){u=s[x][w];v=r._validChildTypesMap;t=r._validChildTypesMap[x];if(h.is(t)){q=t.indexOf(w);if(q>=0){if(!u){t.splice(q,1)}}else{if(u){t.push(w)}}}else{if(u){v[x]=[w]}}}}}}}},getValidChildTypes:function n(q){if(!h.is(q)){b.debug(this.name,"parentType is undefined");return}return this._validChildTypesMap[q]||[]},_filterConfiguredRelationsByMode:function d(u,v){var q=[],t=[],s,r=null;if(h.is(u)&&h.is(u.Relation)){if(!h.is(u.Relation.length)){t.push(u.Relation);u.Relation=t}for(r=0;r<u.Relation.length;r++){s=u.Relation[r];if(h.is(s[v])&&h.Json.decode(s[v])===true){q.push(s.type)}}}return q},getConfiguredRelations:function i(q,s,u){var t,r=[];if(h.is(q,"string")){t=this._relationsList[q];if(h.is(s,"string")){r=this._filterConfiguredRelationsByMode(t[s],u)}}return r},getAllConfiguredRelations:function j(r,v){var u=r?this._relationsList[r]:[],t,s,q=[];if(r){for(s in u){if(u.hasOwnProperty(s)){t=this._filterConfiguredRelationsByMode(u[s],v);q.push.apply(q,t)}}}return q},getConfiguredCustomRelations:function g(t,r,u){var q,s=this._customRelationsList;if(!h.is(t)||!h.is(r)){b.debug(this.name,"fromType or toType is undefined");return}if(h.is(s)&&h.is(s[t])&&h.is(s[t][r])){q=this._filterConfiguredRelationsByMode(s[t][r],u)}return q},getPossibleRelations:function c(s,r,t){var q;q=this.getConfiguredCustomRelations(s,r,t);if(!h.is(q)){q=this.getConfiguredRelations(this.getPPRType(s),this.getPPRType(r),t)}return q},};return f});define("DS/DELPPWDicoServices/AttributeConfigExt",["UWA/Core","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWResourceServices/ResourceUtils"],function(d,g,n,m){var a={_attributeInfo:{},_typeMaskInfo:{},_retrieveDicoAttributeInfo:function i(y,w){var t=this,x=d.Json.encode(t._modelAttrsJSON),u=function u(A,z){n.webServiceRequest({url:"dictionary/getAttributesInfo",method:"POST",onComplete:A,onFailure:z,onTimeout:z,data:x})},s=function s(A,z){n.webServiceRequest({url:"modeler/ppr/getAttributesMaskInfo",method:"POST",onComplete:A,onFailure:z,onTimeout:z,data:x})},v=function v(z){var D,A={},C={};if(d.is(z,"array")&&(z.length===2)){D=z[0].map(function B(H){var F={},E=z[1].filter(function(I){return(I.type===H.type)})[0];F.type=H.type;F.info=d.extend(E.info,H.info,true);F.info.forEach(function G(I){var J=F.type+"."+I.Name;C[J]=I.NLS;A[J]=I});return F})}g.debug(t.name,"Attributes info merged (dico and mask): ",JSON.stringify(D));m.addNlsJSON(C);t.addAttributeInfo(A);y(D)};d.Promise.all([new Promise(u),new Promise(s)]).then(v,w)},_retrieveAttrMaskInfoForOperationTypes:function b(t,s){this.getAttributeMaskInfoOfType("OPERATION",t,s)},_retrieveAttrMaskInfoForSystemTypes:function e(t,s){this.getAttributeMaskInfoOfType("SYSTEM",t,s)},_retrieveAttrMaskInfoForResourceTypes:function l(t,s){this.getAttributeMaskInfoOfType("RESOURCE",t,s)},_retrieveAttrMaskInfoForProcessTypes:function f(t,s){this.getAttributeMaskInfoOfType("PROCESS",t,s)},_retrieveAttrMaskInfoForProductTypes:function r(t,s){this.getAttributeMaskInfoOfType("PRODUCT",t,s)},_retrieveAttrMaskInfoForPartTypes:function o(t,s){this.getAttributeMaskInfoOfType("PART",t,s)},_retrieveAttrMaskInfoForPPRTypes:function k(x,v){var s=this,t=["PROCESS","RESOURCE","PRODUCT","PART","SYSTEM","OPERATION"],u=[];if(t.indexOf("PROCESS")>=0){u.push(new Promise(this._retrieveAttrMaskInfoForProcessTypes.bind(this)))}if(t.indexOf("RESOURCE")>=0){u.push(new Promise(this._retrieveAttrMaskInfoForResourceTypes.bind(this)))}if(t.indexOf("PRODUCT")>=0){u.push(new Promise(this._retrieveAttrMaskInfoForProductTypes.bind(this)))}if(t.indexOf("PART")>=0){u.push(new Promise(this._retrieveAttrMaskInfoForPartTypes.bind(this)))}if(t.indexOf("SYSTEM")>=0){u.push(new Promise(this._retrieveAttrMaskInfoForSystemTypes.bind(this)))}if(t.indexOf("OPERATION")>=0){u.push(new Promise(this._retrieveAttrMaskInfoForOperationTypes.bind(this)))}Promise.all(u).then(function y(){x()},function w(z){g.debug(s.name,"DicoUtils._retrieveAttrMaskInfoForPPRTypes FAILED !!!");v(z)})},getAttributeMaskInfoOfType:function h(u,w,t){var s=this,v=function v(x){var y;for(y in x){if(Object.prototype.hasOwnProperty.call(x,y)){s.addTypeMaskInfo(y,x[y])}}if(d.is(w,"function")){w()}};n.webServiceRequest({url:"modeler/ppr/getTypesAttributesMaskInfo",method:"POST",data:d.Json.encode([u]),onComplete:v,onFailure:t,onTimeout:t})},addAttributeInfo:function q(s){d.merge(this._attributeInfo,s)},getAttributeInfo:function p(s,u){var t;if(s){if(s.indexOf(".")===-1){Object.keys(this._attributeInfo).some(function v(w){var y=w.slice(w.lastIndexOf(".")+1,w.length),x;x=y===s;if(x){s=w}return x})}t=this._attributeInfo[s];if(t){t.FullName=s;if(u){t=t[u]}}}return t},addTypeMaskInfo:function j(t,s){this._typeMaskInfo[t]=s},getTypeMaskInfo:function c(s){return this._typeMaskInfo[s]},};return a});define("DS/DELPPWDicoServices/CustoXmlUtils",["UWA/Core"],function(b){var a=function a(){var c=[],f=function f(h){var j,g;if(h.dicoType&&h.attribute){if(c.length<=0){c.push({type:h.dicoType,attributes:[h.attribute]})}else{for(j=0;j<c.length;j++){if(h.dicoType===c[j].type){if(c[j].attributes.indexOf(h.attribute)===-1){c[j].attributes.push(h.attribute)}g=true;break}else{g=false}}if(g===false){c.push({type:h.dicoType,attributes:[h.attribute]})}}}},e=function e(n,r,h){var p=n.split("."),l,o,g={},m={},k,i={},q=function q(t,u){var j=[],s;if(!b.is(j[r])){for(s=0;s<u.length;++s){if(!b.is(t[u[s]])){t=null;break}else{t=t[u[s]]}}if(b.is(t)){j[r]={};if(b.typeOf(t)==="array"){for(s=0;s<t.length;++s){j[r][t[s][r]]=t[s]}}else{if(b.typeOf(t)==="object"){j[r][t[r]]=t}}}}return j[r]};if(b.is(h)){if(b.typeOf(h[p[0]])==="array"){for(k=0;k<h[p[0]].length;k++){m=h[p[0]][k];o=n.indexOf(".");l=n.substring(o+1,n.length);l=l.split(".");if(!b.is(m[l],"array")){m=h;i=q(m,p)}else{g=q(m,l);b.merge(i,g)}}}else{m=h;i=q(m,p)}}return i};return{retrieveAttributesInfoFromXml:function d(p){var g,l,m,n,o,h,r,i,s,k,q=function q(v){var w,x,j,u,t=["reference","instance"];for(w in v){if(v.hasOwnProperty(w)){j={};if(v[w]&&v[w]["dicoType"]){u=w.split(".");if(t.indexOf(u[u.length-1])>-1){x=u[u.length-2]}else{x=u[u.length-1]}}j={attribute:x,dicoType:v[w]["dicoType"]};f(j)}}};if(b.is(p)){if(b.is(p.uiCusto,"array")){p.uiCusto.forEach(function(j){if(b.is(j)){q(e("Config.Columns.Column","dataIndex",j));q(e("Config.Label","dataIndex",j))}})}if(b.is(p.insertFormCusto)){o=p.insertFormCusto;h=e("AttributesDescriptionList.Type","name",o);for(r in h){if(h.hasOwnProperty(r)){q(e("Section.Attribute","name",h[r]))}}}if(b.is(p.linkAttrEditCusto)){g=p.linkAttrEditCusto;for(m in g.Config){if(g.Config.hasOwnProperty(m)){if(g.Config[m].Attribute){n=g.Config[m].Attribute;if(!b.is(n,"array")){n=[n]}l=e(m+".Attribute","name",g.Config);q(l)}}}}if(b.is(p.graphViewCusto)){i=p.graphViewCusto;if(i.Config.Preferences.BOMView.Content.Type){s=i.Config.Preferences.BOMView.Content.Type;for(k=0;k<s.length;k++){q(e("Row","dataIndex",s[k]))}}}return c}}}};return a});define("DS/DELPPWDicoServices/DicoUtils",["UWA/Core","UWA/Class","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWDicoServices/ModelConfigExt","DS/DELPPWDicoServices/AttributeConfigExt","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWDicoServices/CustoXmlUtils"],function(e,u,r,h,c,q,n){var i=u.singleton(h,c,{name:"DicoUtils",_modelAttrsJSON:[],_modelTypeConfig:{},_typeHierarchy:{},init:function t(C){var B=this;C=C||{};if(!e.is(C.modelRelationsXML)||!e.is(C.modelCustomRelationsXML)){throw new Error("modelTypesPath or modelRelationsXML or modelCustomRelationsXML options not defined")}B.options=C},setup:function p(E,C){var B=this,D=B.options.modelTypesPath||"DS/DELPPWDicoServices/assets/json/ModelTypes.json";require(["text!"+D],function(F){i._modelAttrsJSON=i._retrieveAttributesInfo();i._modelTypeConfig=e.Json.decode(F);i._initPromiseExec(E,C)},function(F){C(F)})},_retrieveAttributesInfo:function a(){var B,D,C;B={uiCusto:[r.getXMLValues("CAPRESOURCE.columnConfigPath"),r.getXMLValues("ROUTINGS.columnConfigPath"),r.getXMLValues("RESOURCE.columnConfigPath"),r.getXMLValues("MANUFACTURING.columnConfigPath"),r.getXMLValues("MBOM.columnConfigPath"),r.getXMLValues("EBOM.columnConfigPath"),r.getXMLValues("ORIGIN.columnConfigPath"),r.getXMLValues("ALTERNATE.columnConfigPath"),r.getXMLValues("AUXILIARY.columnConfigPath")],insertFormCusto:r.getXMLValues("insertFormAttributeXML"),linkAttrEditCusto:r.getXMLValues("editLinkAttrsConfigXML"),graphViewCusto:r.getXMLValues("MBOM.bomViewXML")};C=new n();D=C.retrieveAttributesInfoFromXml(B);return D},_initPromiseExec:function k(F,D){var B=this;Promise.all([new Promise(i._retrieveRefDicoType.bind(B)),new Promise(i._retrieveInstDicoType.bind(B)),new Promise(i._retrieveDocDicoType.bind(B)),new Promise(i._retrieveResourceType.bind(B)),new Promise(i._retrieveDimensions.bind(B)),new Promise(i._retrievePPRTypes.bind(B)),new Promise(i._retrieveValidChildTypes.bind(B)),new Promise(i._retrieveModelRelations.bind(B)),new Promise(i._retrieveDicoAttributeInfo.bind(B)),new Promise(i._retrieveAttrMaskInfoForPPRTypes.bind(B)),]).then(function E(){new Promise(i._retrieveModelCustomRelations.bind(B)).then(function H(){F()},function G(I){D(I)})},function C(G){D(G)})},_retrieveDimensions:function l(D,C){r.webServiceRequest({url:"dictionary/dimensions",method:"GET",onComplete:function B(E){q.addDimensions(E.results);D()},onFailure:C,onTimeout:C})},_retrieveDicoType:function f(D,F,E){var B=this;r.webServiceRequest({url:"dictionary/getTypeInfo?parentInfo=true",method:"POST",data:JSON.stringify(D),onComplete:function C(G){F();Object.keys(G).forEach(function H(I){var K=[],J=e.is(G[I].parent)?G[I].parent:null;while(null!==J){K.push(J);J=e.is(G[J].parent)?G[J].parent:null}if(K.length>0){K.reverse();if(-1!==B.getReferenceTypes().indexOf(K[0])){B._modelTypeConfig.reference.types.push(I)}else{if(-1!==B.getInstanceTypes().indexOf(K[0])){B._modelTypeConfig.instance.types.push(I)}}if(-1!==B.getDocumentTypes().indexOf(K[0])){B._modelTypeConfig.document.types.push(I)}if(!e.is(G[K[0]].derivedTypes,"array")){G[K[0]].derivedTypes=[]}G[K[0]].derivedTypes.push(I)}G[I].inheritanceChain=K});q.addIcons(G);B._typeHierarchy=e.merge(B._typeHierarchy,G)},onFailure:E,onTimeout:E})},_retrieveRefDicoType:function v(C,B){this._retrieveDicoType(this.getReferenceTypes(),C,B)},_retrieveInstDicoType:function b(C,B){this._retrieveDicoType(this.getInstanceTypes(),C,B)},_retrieveDocDicoType:function y(C,B){this._retrieveDicoType(this.getDocumentTypes(),C,B)},_retrieveResourceType:function s(F,E){var B=this,D=["Resource"];r.webServiceRequest({url:"dictionary/getTypeInfo",method:"POST",data:JSON.stringify(D),onComplete:function C(I){var H=Object.keys(I).filter(function G(J){return(J!=="Resource")});I.Resource.derivedTypes=H;I.Resource.inheritanceChain=[];B._typeHierarchy.Resource=I.Resource;F()},onFailure:E,onTimeout:E})},getTypeHierarchy:function A(B){var C=e.is(this._typeHierarchy[B].derivedTypes,"array")?this._typeHierarchy[B].derivedTypes:[];return C},getReferenceTypes:function m(){return this._modelTypeConfig.reference.types},getInstanceTypes:function d(){return this._modelTypeConfig.instance.types},getDocumentTypes:function x(){return this._modelTypeConfig.document.types},getConnectionTypes:function z(){return this._modelTypeConfig.connection.types},isEntityReference:function g(B){return this.getReferenceTypes().indexOf(B)!==-1},isEntityInstance:function o(B){return this.getInstanceTypes().indexOf(B)!==-1},isEntityConnection:function w(B){return this.getConnectionTypes().indexOf(B)!==-1},isAKindOf:function j(C,F){var D=false,E=e.is(C)?(e.is(C,"string")?C:(e.is(C.get,"function")?C.get("type"):null)):null,B=(e.is(F,"string")&&(0<F.length))?i.getTypeHierarchy(F):null;if(e.is(E,"string")&&e.is(F,"string")){if(F===E){D=true}else{if(Array.isArray(B)){D=B.some(function G(H){return(E===H)},this)}}}return D}});return i});