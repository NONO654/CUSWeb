/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationCommands/CAT3DAnnotationOpenFavoriteCtxCmd",["DS/StateCommandEngine/StateCommand","DS/Visualization/PathElement","DS/StateCommandEngine/PathElementAgent","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(b,f,h,a,e,g,d,c){return b.extend({init:function(l){this._parent(l,{mode:"exclusive",isAsynchronous:true});this.setRepeatMode(false);var m,n,j,k=function(q){if(!q||!q.externalPath||!q.externalPath.length||q.externalPath[0].name!=="RootBag"){return false}for(var o=q.externalPath.length-1;o>=0;--o){var p=q.externalPath[o];if(c.isPLMNode(p)){return c.is3DLeaf(p)?new f(q.externalPath.slice(0,o+1)):false}}},i=function(o){setTimeout(function(){if(m&&m.object3D&&m.object3D.length===1){e.empty();var p=d.giveFavoriteContextManager({context:g.get()});j=p.manageFavoriteContext({path:k(m.object3D[0].pathElement),onComplete:function(){j=null;o()}}).cancel}},0)};this.buildGraph=function(){var o=g.get();o.getViewer().setDefaultPicking(false);n=true;j=null;m=new h({agentId:"CATFavoriteContextSelAgt",frameWindow:o.getFrameWindow(),engWithPSOHSO:true,withPSO:true,withHSO:true,valuedFromCSO:true,saveToCSO:false,pickingMode:"rep",prePickingMode:"rep",pickingFilter:k,prePickingFilter:k});var p=this.createInitialState("InitState"),q=this.getFinalState();this.addTransition({iInitialState:p,iFinalState:q,iEvent:m,iAction:i});this.addTransition({iInitialState:p,iFinalState:q,iCondition:function(){var r=c.getRoots(o);if(r&&r.length===1){if(r[0]&&c.is3DLeaf(r[0])){var s=o.getRootBagPath();s.addElement(r[0]);m.object3D.push({pathElement:s});return true}}},iAction:i})};this.execute=function(){if(n){a.empty();e.empty()}};this.endExecute=function(){g.get().getViewer().setDefaultPicking(true);if(j){j()}}}})});define("DS/CAT3DAnnotationCommands/panels/CAT3DAnnotationFilterPanel",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationUI/CAT3DAnnotationFilterListItem","DS/CAT3DAnnotationUI/CAT3DAnnotationFilterTolFilterItem","UWA/Controls/ThemedScroller","DS/UIKIT/SuperModal","DS/WebappsUtils/WebappsUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationSubtypes","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationSupertypes","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationTypes","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationAttributesCategories","i18n!DS/CAT3DAnnotationCommands/assets/nls/CAT3DAnnotationCommands","css!DS/CAT3DAnnotationCommands/CAT3DAnnotationCommands.css"],function(h,a,d,k,e,g,c,f,o,l,m,i,b,j){var n=a.extend({init:function(X){this._parent(X);var X=X||{};var O=X.style!==undefined?(X.style.version!==undefined?X.style.version:1):1;var Q=X.style!==undefined?(X.style.semanticUI!==undefined?X.style.semanticUI:false):false;var au;var aa,ah,Y;var V;var R;var aq;var am;var L;var E=[];var W=[];var z=[];var q=[];var y=[];var ax="AnnotSetAssemblyRoot";var at="AnnotViewsCustom";var aj="AnnotsCustom";var ay="AttributesAll";var aB=new d();var ae=[];var aw=[];var ar=[];var F=[];var K=[];var M=false;var I=false;var P;var C=new c({renderTo:document.body});this.buildPanel=function(aE){this.cleanPanel();if(aE.attrTypesFilteredByPref&&aE.attrTypesFilteredByPref.length){F=aE.attrTypesFilteredByPref.slice()}if(aE.attrTypesOrderedList&&aE.attrTypesOrderedList.length){K=aE.attrTypesOrderedList.slice()}u(aE.model);if(!au){au=h.createElement("div",{id:"CAT3DAnnotFilterMainDiv","class":"CAT3DAnnotFilterMainDiv"})}var aF=h.createElement("div",{id:"CAT3DAnnotFilterScrollerDiv"});var aC=new g().inject(au);aC.getInnerElement().setContent(aF);aC.getInnerElement().parentNode.setStyle("height","100%");var aD=h.createElement("div",{id:"CAT3DAnnotSetsSection","class":"CAT3DAnnotSectionMainDiv"}).inject(aF);E.push(new o({sectionLabel:j.AnnotSetsSectionLbl,fontIcon:"fonticon fonticon-annotationFilter",displayTooltip:false,doubleClickCB:U}));aD.appendChild(E[E.length-1].getContent());R=h.createElement("div",{"class":"CAT3DAnnotFilterSectionDiv"}).inject(aD);T(true,aD,R);Z();if(O===1){aa=h.createElement("div",{id:"CAT3DAnnotViewsSection","class":"CAT3DAnnotSectionMainDiv"}).inject(aF);E.push(new o({sectionLabel:j.AnnotViewsSectionLbl,displayTooltip:false,doubleClickCB:U}));aa.appendChild(E[E.length-1].getContent());aq=h.createElement("div",{"class":"CAT3DAnnotFilterSectionDiv"}).inject(aa);ao()}ah=h.createElement("div",{id:"CAT3DAnnotsSection","class":"CAT3DAnnotSectionMainDiv"}).inject(aF);E.push(new o({sectionLabel:j.AnnotsSectionLbl,displayTooltip:false,doubleClickCB:U}));ah.appendChild(E[E.length-1].getContent());V=h.createElement("div",{"class":"CAT3DAnnotFilterSectionDiv"}).inject(ah);ad();if(O!==1&&Q){Y=h.createElement("div",{id:"CAT3DAttributesSection","class":"CAT3DAnnotSectionMainDiv"}).inject(aF);E.push(new o({sectionLabel:j.AttributesSectionLbl,displayTooltip:false,doubleClickCB:U}));Y.appendChild(E[E.length-1].getContent());am=h.createElement("div",{"class":"CAT3DAnnotFilterSectionDiv"}).inject(Y);ac()}af();return au};this.cleanPanel=function(aC){var aD;for(aD=0;aD<W.length;aD++){W[aD].clear()}W.splice(0,W.length);for(aD=0;aD<z.length;aD++){z[aD].clear()}z.splice(0,z.length);for(aD=0;aD<q.length;aD++){q[aD].clear()}q.splice(0,q.length);for(aD=0;aD<y.length;aD++){y[aD].clear()}y.splice(0,y.length);for(aD=0;aD<E.length;aD++){E[aD].clear()}E.splice(0,E.length);if(au){while(au.firstChild){au.removeChild(au.firstChild)}}V=null;R=null;aq=null;am=null;L=null;if(aC){ax="AnnotSetAssemblyRoot";at="AnnotViewsCustom";aj="AnnotsCustom";ay="AttributesAll";ae.length=0;aw.length=0;ar.length=0;F.length=0;K.length=0;I=false;M=false;P=null}};var s=function(aE,aC){if(!aE||!aC||(aE&&aC&&aE.length!==aC.length)){return false}for(var aD=0;aD<aE.length;aD++){if(aE[aD]!==aC[aD]){return false}}return true};this.updatePanel=function(aC){if(!au||!R){return this.buildPanel(aC)}var aD=u(aC.model);if(aD.rebuildPanel){Z();ao();ad()}else{if(!s(aC.attrTypesFilteredByPref,F)||!s(aC.attrTypesOrderedList,K)){F=aC.attrTypesFilteredByPref.slice();K=aC.attrTypesOrderedList.slice()}}af();if(O!==1&&Q){ac()}if(aD.refreshViewsSection){r({name:at,forceRefresh:true})}if(aD.refreshAnnotsSection){D({name:aj,forceRefresh:true})}if(I||M){M=false;I=false;p();ak(true)}};var an=function(aE){var aC=aE.type;var aD="";if(aE.superType===11){if(aC===6){aD="Captures"}else{aD="Views"}}else{if(aC===40||aC===41||aC===42||aC===43||aC===44||aC===45||aC===46||aC===54){aD="Geometries"}else{if(aC===22||aC===23||aC===24||aC===25||aC===26||aC===27||aC===28){aD="GeomTolerances"}else{if(aC===12||aC===13||aC===14||aC===15||aC===16||aC===37||aC===38){aD="Dimensions"}else{if(aC===7||aC===8||aC===9||aC===10||aC===11){aD="GeomTolerances"}else{if(aC===19||aC===20||aC===21){aD="GeomTolerances"}else{if(aC===17||aC===18){aD="GeomTolerances"}else{if(aC===5){aD="Datums"}else{if(aC===35){aD="Datums"}else{if(aC===3){aD="Datums"}else{if(aC===4){aD="GeomTolerances"}else{if(aC===34){aD="Dimensions"}else{if(aC===36){aD="Dimensions"}else{if(aC===29){aD="Roughness"}else{if(aC===31){aD="Welds"}else{if(aC===1){aD="Notes"}else{if(aC===2){aD="Notes"}else{if(aC===30){aD="Notes"}else{if(aC===51){aD="RestrictedAreas"}}}}}}}}}}}}}}}}}}}return aD};var af=function(){if(ax!=="AnnotSetCustom"){var aC=false;for(var aF=0;aF<ae.length;aF++){var aD=ae[aF];var aE=aD.checkFlagInAllSection===undefined?aD.hasBeenEntirelyLoaded:aD.checkFlagInAllSection;if(ax==="AnnotSetAll"&&ae.length===1&&!aE){aC=true}else{if(aD.children.length){for(var aG=0;aG<aD.children.length;aG++){if(ax==="AnnotSetAll"){var aE=aD.checkFlagInAllSection===undefined?aD.hasBeenEntirelyLoaded:aD.checkFlagInAllSection;if(((ae.length===1||(ae.length>1&&aE))&&!aD.children[aG].isVisible)||(ae.length>1&&!aE&&aD.children[aG].isVisible)){aC=true;break}}else{if(ax==="AnnotSetAssemblyRoot"){if(ae.length===1){if((!aD.children[aG].isVisible&&aD.children[aG].isDirectChild)||aD.children[aG].isVisible&&!aD.children[aG].isDirectChild){aC=true;break}}else{if(ae.length>1){if((aD.checkFlagInAssySection&&aD.children[aG].isDirectChild&&!aD.children[aG].isVisible)||(aD.checkFlagInAssySection&&!aD.children[aG].isDirectChild&&aD.children[aG].isVisible)||(!aD.checkFlagInAssySection&&aD.children[aG].isVisible)){aC=true;break}}}}else{if(ax==="AnnotSetNone"){if(aD.children[aG].isVisible){aC=true;break}}}}}}}if(aC){break}}if(aC){for(var aF=0;aF<ae.length;aF++){for(var aG=0;aG<ae[aF].children.length;aG++){ae[aF].children[aG].checkFlagInCustomSection=ae[aF].children[aG].isVisible}}return G({name:"AnnotSetCustom"})}}ak(false)};var H=function(aC){if(aC.superType===11){return aC.type===6?"Capture":"View"}return aC.type};var ak=function(aK){if(aK){az()}var aL=0,aO=0;var aR=false,aG=false;for(var aQ=0;aQ<ae.length;aQ++){var aN=ae[aQ];var aI=aN.checkFlagInAllSection===undefined?aN.hasBeenEntirelyLoaded:aN.checkFlagInAllSection;if(aN.allView){aN.allView.setCheckFlag(aI)}if(aN.assyView){aN.assyView.setCheckFlag(aN.checkFlagInAssySection)}for(var aH=0;aH<aN.children.length;aH++){var aP=aN.children[aH];if(aP.view){aP.view.setCheckFlag(aP.checkFlagInCustomSection)}for(var aE=0;aE<aP.children.length;aE++){var aC=aP.children[aE];if(aC.type==="RootAttributes"){continue}for(var aM=0;aM<aC.children.length;aM++){var aD=aC.children[aM];if((aC.type==="RootViews"||aC.type==="RootCaptures")&&aP.isVisible){aL++;aR=true}else{if(aP.isVisible){aG=true}if(aD.isDisplayed&&aP.isVisible){aO++}}if(aD.view){aD.view.setCheckFlag(aD.checkFlagInCustomSection);aD.view.setDisplayFlag(aD.isDisplayed)}}}}}for(var aQ=0;aQ<aw.length;aQ++){aw[aQ].view.setDisplayFlag(aw[aQ].isDisplayed);for(var aH=0;aH<aw[aQ].types.length;aH++){aw[aQ].types[aH].view.setDisplayFlag(aw[aQ].types[aH].isDisplayed)}}for(var aQ=0;aQ<W.length;aQ++){W[aQ].update();W[aQ].setCheckFlag(W[aQ].name===ax)}for(var aQ=0;aQ<z.length;aQ++){if(z[aQ].name==="AnnotViewsAll"){z[aQ].setNbElems(aL)}z[aQ].update(z[aQ].name==="AnnotViewsCustom");z[aQ].setCheckFlag(z[aQ].name===at)}if(O===1){T(aR,aa,aq)}for(var aQ=0;aQ<q.length;aQ++){if(q[aQ].name==="AnnotsAll"){if(O===1){q[aQ].setNbElems(aO)}else{q[aQ].setNbElems(aO+aL)}}q[aQ].update(q[aQ].name==="AnnotsCustom"||q[aQ].name==="AnnotsType");if(q[aQ].name!=="AnnotsDisplayOnlyDefault"&&q[aQ].name!=="AnnotsFilterByTol"){q[aQ].setCheckFlag(q[aQ].name===aj)}else{if(q[aQ].name==="AnnotsDisplayOnlyDefault"){q[aQ].setCheckFlag(M)}else{if(q[aQ].name==="AnnotsFilterByTol"){q[aQ].setCheckFlag(I)}}}}if(O===1){T(aG,ah,V)}else{T(aG||aR,ah,V)}var aF=0,aJ=false;for(var aQ=0;aQ<ar.length;aQ++){if(ar[aQ].isDisplayed&&F.indexOf(ar[aQ].name)===-1){aF++}if((ar[aQ].view&&ar[aQ].view.isDisplayed()!==ar[aQ].isDisplayed)||(!ar[aQ].view&&ar[aQ].isDisplayed)){aJ=true}}if(aJ){ac()}for(var aQ=0;aQ<y.length;aQ++){if(y[aQ].name==="AttributesAll"){y[aQ].setNbElems(aF)}y[aQ].update(y[aQ].name==="AttributesType");y[aQ].setCheckFlag(y[aQ].name===ay)}if(O!==1&&Q){T(aF!==0,Y,am)}};var T=function(aC,aD,aE){var aF=aD.querySelector(".CATWebUXSectionHeader");aF.setStyles({color:aC?"":"rgb(190, 190, 190)"});aE.setStyles({height:aC?"auto":"",padding:aC?"5px":"0px 5px",overflow:aC?"auto":"",opacity:aC?"1":"0.5"})};this.subscribe=function(aD,aC){if(!aD||!aC){return}return aB.subscribe({event:aD},aC)};this.unsubscribe=function(aC){if(aC===null||aC===undefined){return}aB.unsubscribe(aC)};var w=function(aE,aD,aH,aI){var aJ=true;for(var aG=0;aG<aE.length;aG++){if(aE[aG].name===aD){if(aE[aG].isDisplayed===null||aE[aG].isDisplayed===false){aE[aG].isDisplayed=aI}aJ=false;break}}if(aJ){var aF=aH;if(!aF){aF=f.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/");if(aD==="3DAnnotations"){aF+="I_W3DAnnot_NodeAnnotationSet.png"}else{aF=null}}var aC={name:aD,checkFlag:true,icon:aF,isDisplayed:aI};for(var aG=0;aG<ar.length;aG++){if(ar[aG].name===aD){aC.checkFlag=ar[aG].checkFlag;break}}aE.push(aC)}};var ap=function(aE,aD,aC){if(aE.hyperlink){if((aE.hyperlink.relatedDocs&&aE.hyperlink.relatedDocs.length)||aE.hyperlink.hyperlinksAndComments||(aE.hyperlink.failureModes&&aE.hyperlink.failureModes.length)||(aE.hyperlink.requirements&&aE.hyperlink.requirements.length)){w(aD,"3DAnnotations",null,aC)}}else{if(aE.generalTolerance||(aE.tabulatedLimit&&aE.toleranceLimits)){w(aD,"3DAnnotations",null,aC)}}};var u=function(a2){var aD=[];var aH=a2.length!==ae.length;var aJ=0;var aM=[];for(var aR=0;aR<ar.length;aR++){ar[aR].isDisplayed=null}for(var aR=0;aR<a2.length;aR++){var aE=a2[aR];var aV=null;for(var aW=0;aW<ae.length;aW++){if(ae[aW].id===aE.id){aV=ae[aW];break}}if(!aV){aH=true;var aZ=[];for(var aW=0;aW<aE.children.length;aW++){var aI={};Object.assign(aI,aE.children[aW]);aI.checkFlagInCustomSection=aE.children[aW].isVisible;aZ.push(aI)}var aN=aE.type==="3DShape"||aE.type==="CATPart"||aE.type==="3DPart";if(typeof aE.hasBeenEntirelyLoaded==="boolean"){aN=aE.hasBeenEntirelyLoaded}aV={id:aE.id,name:aE.name,icon:aE.icon,children:aZ,hasBeenEntirelyLoaded:aN,checkFlagInAssySection:true}}else{if(typeof aE.hasBeenEntirelyLoaded==="boolean"){aV.hasBeenEntirelyLoaded=aE.hasBeenEntirelyLoaded}for(var aW=aV.children.length-1;aW>=0;aW--){var aS=false;for(var aF=0;aF<aE.children.length;aF++){if(aE.children[aF].id===aV.children[aW].id){aS=true;break}}if(!aS){aH=true;aV.children.splice(aW,1)}}var aT=false;for(var aW=0;aW<aE.children.length;aW++){var aY=aE.children[aW];var a0=-1;for(var aF=0;aF<aV.children.length;aF++){if(aY.id===aV.children[aF].id){a0=aF;break}}if(a0===-1){aH=true;aT=true;var aI={};Object.assign(aI,aY);aI.checkFlagInCustomSection=aY.isVisible;aV.children.push(aI);for(var aF=0;aF<aI.children.length;aF++){var aQ=aI.children[aF];for(var aO=0;aO<aQ.children.length;aO++){aQ.children[aO].checkFlagInCustomSection=aQ.children[aO].isVisible}}if(aj!=="AnnotsCustom"){aj="AnnotsCustom";aJ=aJ===0?1:3}if(at!=="AnnotViewsCustom"){at="AnnotViewsCustom";aJ=aJ===0?2:3}}else{if(aV.children[a0].referenceLabel!==aY.referenceLabel){aH=true;aV.children[a0].referenceLabel=aY.referenceLabel}if(aV.children[a0].isVisible!==aY.isVisible){if(aj!=="AnnotsCustom"){aj="AnnotsCustom";aJ=aJ===0?1:3}if(at!=="AnnotViewsCustom"){at="AnnotViewsCustom";aJ=aJ===0?2:3}aV.children[a0].isVisible=aY.isVisible;aV.children[a0].checkFlagInCustomSection=aY.isVisible}var aC=0;for(var aF=0;aF<aV.children[a0].children.length;aF++){var aQ=aV.children[a0].children[aF];var aX=aY.children[aF];for(var aO=0;aO<aQ.children.length;aO++){var a1=aQ.children[aO];var aG=aX.children[aO];var aP=false;if(a1.id===aG.id){if(a1.name!==aG.name&&a1.view){a1.view.setLabel(a1.name)}if(a1.isVisible!==aG.isVisible){aP=true;a1.isVisible=aG.isVisible;a1.checkFlagInCustomSection=aG.isVisible}}else{aP=true;aQ.children.splice(aO,1,aG);aH=true}if(aP){if((aQ.type==="RootViews"||aQ.type==="RootCaptures")&&at!=="AnnotViewsCustom"){at="AnnotViewsCustom";aC=aC===0?1:3}else{if(aQ.type!=="RootViews"&&aQ.type!=="RootCaptures"&&aj!=="AnnotsCustom"){aj="AnnotsCustom";aC=aC===0?2:3}}}}}if(aC!==0){for(var aF=0;aF<aV.children[a0].children.length;aF++){var aQ=aV.children[a0].children[aF];for(var aO=0;aO<aQ.children.length;aO++){if((aQ.type==="RootViews"||aQ.type==="RootCaptures")&&(aC===1||aC===3)){aQ.children[aO].checkFlagInCustomSection=aQ.children[aO].isVisible}else{if(aQ.type!=="RootViews"&&aQ.type!=="RootCaptures"&&(aC===2||aC===3)){aQ.children[aO].checkFlagInCustomSection=aQ.children[aO].isVisible}}}}}}}if(aT){var aL=[];for(var aW=0;aW<aE.children.length;aW++){for(var aF=0;aF<aV.children.length;aF++){if(aE.children[aW].id===aV.children[aF].id){aL.push(aV.children[aF]);break}}}aV.children=aL}}aM.push(aV);for(var aW=0;aW<aE.children.length;aW++){var aY=aE.children[aW];aV.children[aW].hyperlink=aY.hyperlink;ap(aY,aD,aY.isVisible);for(var aF=0;aF<aY.children.length;aF++){var aQ=aY.children[aF];if(aQ.type==="RootAttributes"){for(var aO=0;aO<aQ.children.length;aO++){w(aD,aQ.children[aO].category,aQ.children[aO].icon,aY.isVisible)}}else{if(aQ.type!=="RootViews"&&aQ.type!=="RootCaptures"){for(var aO=0;aO<aQ.children.length;aO++){aV.children[aW].children[aF].children[aO].hyperlink=aQ.children[aO].hyperlink;ap(aQ.children[aO],aD,aY.isVisible)}}}}}}if(O!==1&&Q){var aU=[];for(var aR=0;aR<K.length;aR++){var aK=false;for(var aW=aD.length-1;aW>=0;aW--){if(K[aR]===aD[aW].name){aU.push(aD[aW]);aD.splice(aW,1);aK=true;break}}if(!aK){for(var aW=ar.length-1;aW>=0;aW--){if(K[aR]===ar[aW].name){aU.push(ar[aW]);aU[aU.length-1].isDisplayed=false;break}}}}ar=aU}aM=aM.slice(0,aM.length);ae=[];for(var aR=0;aR<a2.length;aR++){for(var aW=0;aW<aM.length;aW++){if(aM[aW].id===a2[aR].id){ae.push(aM[aW]);break}}}az();return{rebuildPanel:aH,refreshViewsSection:aJ===2||aJ===3,refreshAnnotsSection:aJ===1||aJ===3}};var az=function(){var aG=[];for(var aQ=0;aQ<ar.length;aQ++){ar[aQ].isDisplayed=null}if(Q){for(var aQ=0;aQ<aw.length;aQ++){aw[aQ].isDisplayed=false;for(var aJ=0;aJ<aw[aQ].types.length;aJ++){aw[aQ].types[aJ].isDisplayed=false}}}for(var aQ=0;aQ<ae.length;aQ++){var aO=ae[aQ];for(var aJ=0;aJ<aO.children.length;aJ++){var aP=aO.children[aJ];ap(aP,aG,aP.isVisible);for(var aF=0;aF<aP.children.length;aF++){var aD=aP.children[aF];for(var aN=0;aN<aD.children.length;aN++){if(aD.type==="RootAttributes"){w(aG,aD.children[aN].category,aD.children[aN].icon,aP.isVisible)}else{if(aD.type!=="RootViews"&&aD.type!=="RootCaptures"){ap(aD.children[aN],aG,aP.isVisible)}}var aE=aD.children[aN];var aM=true;if(ax==="AnnotSetAll"&&ae.length>1&&(aO.checkFlagInAllSection===false||aO.checkFlagInAllSection===undefined&&!aO.hasBeenEntirelyLoaded)){aM=false}if(aM&&ax==="AnnotSetAssemblyRoot"){if((ae.length===1&&!aP.isDirectChild)||(ae.length>1&&!aO.checkFlagInAssySection)||(ae.length>1&&aO.checkFlagInAssySection&&!aP.isDirectChild)){aM=false}}if(aM&&ax==="AnnotSetCustom"&&!aP.checkFlagInCustomSection){aM=false}if(aM&&ax==="AnnotSetNone"){aM=false}if(aM&&aD.type!=="RootViews"&&aD.type!=="RootCaptures"&&v(aE)){aE.isDisplayed=false}else{aE.isDisplayed=aM}if(Q&&((O===1&&aD.type!=="RootViews"&&aD.type!=="RootCaptures")||O!==1)){var aI="";switch(aE.superType){case 1:aI="NonSemantic";break;case 2:aI="Datum";break;case 3:aI="PosOrRun";break;case 4:aI="Size";break;case 5:aI="PosOrRun";break;case 6:aI="PosOrRun";break;case 7:aI="Form";break;case 8:aI="Geometry";break;case 10:aI="RestrictedAreas";break;case 11:aI="ViewsAndCaptures";break;default:aI="";break}if(aI){var aL=-1;var aK=-1;for(var aH=0;aH<aw.length;aH++){if(aw[aH].name===aI){aL=aH;break}}if(aL===-1){aw.push({name:aI,types:[]});aL=aw.length-1}var aC=i[H(aE)];for(var aH=0;aH<aw[aL].types.length;aH++){if(aw[aL].types[aH].name===aC){aK=aH;break}}if(aK===-1&&aC){aw[aL].types.push({name:aC,type:H(aE),checkFlag:false,isDisplayed:false})}}}}}}}for(var aQ=0;aQ<aG.length;aQ++){for(var aJ=0;aJ<ar.length;aJ++){if(ar[aJ].name===aG[aQ].name){ar[aJ].isDisplayed=aG[aQ].isDisplayed;break}}}if(Q){for(var aQ=0;aQ<ae.length;aQ++){var aO=ae[aQ];for(var aJ=0;aJ<aO.children.length;aJ++){var aP=aO.children[aJ];for(var aF=0;aF<aP.children.length;aF++){var aD=aP.children[aF];for(var aN=0;aN<aD.children.length;aN++){if(((O===1&&aD.type!=="RootViews"&&aD.type!=="RootCaptures")||O!==1)){var aE=aD.children[aN];for(var aH=0;aH<aw.length;aH++){for(var aR=0;aR<aw[aH].types.length;aR++){if(aw[aH].types[aR].name===i[H(aE)]&&aE.isDisplayed){aw[aH].types[aR].isDisplayed=true;break}}}}}}}}}};var Z=function(){for(var aK=0;aK<W.length;aK++){if(W[aK].getContent().parentNode===R){W[aK].clear();R.removeChild(W[aK].getContent())}}W.splice(0,W.length);var aH;var aF;if(ae&&ae.length>1){aH=[];aF=[];for(var aK=0;aK<ae.length;aK++){aH.push(new k({id:"AnnotSetAll_"+aK,idPath:[aK],name:ae[aK].name,icon:ae[aK].icon,header:ae[aK].name,type:"checkbox",className:"AnnotFilterLeaf",displayNbElems:false,displayTitle:false,callback:N,checkFlag:ae[aK].checkFlagInAllSection===undefined?ae[aK].hasBeenEntirelyLoaded:ae[aK].checkFlagInAllSection}));ae[aK].allView=aH[aH.length-1];aF.push(new k({id:"AnnotSetAssemblyRoot_"+aK,idPath:[aK],name:ae[aK].name,icon:ae[aK].icon,header:ae[aK].name,type:"checkbox",className:"AnnotFilterLeaf",displayNbElems:false,displayTitle:false,callback:x,checkFlag:ae[aK].checkFlagInAssySection}));ae[aK].assyView=aF[aF.length-1]}}W.push(new k({id:"AnnotSetAll",name:"AnnotSetAll",type:"radio",header:j.AllSectionLbl,checkFlag:ax==="AnnotSetAll",children:aH,displayNbElems:aH!==undefined,noSelectAll:true,className:"AnnotFilterMainSection",callback:G,expandingPreference:"AnnotationSets.All"}));W.push(new k({id:"AnnotSetAssemblyRoot",name:"AnnotSetAssemblyRoot",type:"radio",header:j.AssemblyRootSectionLbl,checkFlag:ax==="AnnotSetAssemblyRoot",children:aF,displayNbElems:aF!==undefined,noSelectAll:true,className:"AnnotFilterMainSection",callback:G,expandingPreference:"AnnotationSets.AssemblyRoots"}));var aD=ae.length>1;if(aD){var aG=0;for(var aK=0;aK<ae.length;aK++){if(ae[aK].children.length){aG++}}aD=aG>1}var aE=[];for(var aK=0;aK<ae.length;aK++){var aC=true;var aJ=[];for(var aI=0;aI<ae[aK].children.length;aI++){if(!ae[aK].children[aI].checkFlagInCustomSection){aC=false}aJ.push(new k({id:"AnnotSetCustom_"+aK+"_"+aI,idPath:[aK,aI],name:ae[aK].children[aI].referenceLabel+" / "+ae[aK].children[aI].name,icon:ae[aK].children[aI].referenceIcon,header:ae[aK].children[aI].referenceLabel+" / "+ae[aK].children[aI].name,type:"checkbox",className:"AnnotFilterLeaf",displayNbElems:false,displayTitle:true,callback:aA,checkFlag:ae[aK].children[aI].checkFlagInCustomSection}));ae[aK].children[aI].view=aJ[aJ.length-1]}if(aD){if(ae[aK].children.length){aE.push(new k({id:"AnnotSetCustom_"+aK,type:"checkbox",name:ae[aK].name||(j.DefaultRootLbl+"."+aK),header:ae[aK].name||(j.DefaultRootLbl+"."+aK),noSelectAll:true,displayNbElems:true,displayTitle:true,className:"annotFilterSubSection",checkFlag:aC,children:aJ}))}}else{if(aJ.length){aE=aE.concat(aJ)}}}W.push(new k({id:"AnnotSetCustom",name:"AnnotSetCustom",type:"radio",header:j.CustomSectionLbl,displayNbElems:aE.length>0,displayTitle:false,noSelectAll:ae.length!==1,expandingPreference:"AnnotationSets.Custom",className:"AnnotFilterMainSection",children:aE,checkFlag:ax==="AnnotSetCustom",callback:G}));W.push(new k({id:"AnnotSetNone",name:"AnnotSetNone",type:"radio",header:j.NoneSectionLbl,checkFlag:ax==="AnnotSetNone",displayNbElems:false,displayTitle:false,className:"AnnotFilterMainSection",callback:G}));for(var aK=0;aK<W.length;aK++){R.appendChild(W[aK].getContent())}};var ao=function(){if(O!==1){return}for(var aQ=0;aQ<z.length;aQ++){if(z[aQ].getContent().parentNode===aq){z[aQ].clear();aq.removeChild(z[aQ].getContent())}}z.splice(0,z.length);var aL=[];var aG=[];var aH=true;var aS=true;if(ae&&ae.length){var aE=0;var aM=0;for(var aQ=0;aQ<ae.length;aQ++){var aK=ae[aQ];for(var aF=0;aF<aK.children.length;aF++){var aP=aK.children[aF];for(var aC=0;aC<aP.children.length;aC++){var aO=aP.children[aC];if(aO.type==="RootViews"){for(var aJ=0;aJ<aO.children.length;aJ++){aE++;var aI=aO.children[aJ];aI.checkFlagInCustomSection=aI.checkFlagInCustomSection!==undefined?aI.checkFlagInCustomSection:aI.isVisible;aG.push(new k({id:"AnnotViewsCustomViews_"+aQ+"_"+aF+"_"+aC+"_"+aJ,idPath:[aQ,aF,aC,aJ],isDisplayed:aI.isDisplayed,name:aI.name+" / "+aP.referenceLabel+" / "+aP.name,header:aI.name+" / "+aP.referenceLabel+" / "+aP.name,icon:aI.icon,type:"checkbox",displayNbElems:false,displayTitle:true,className:"AnnotFilterLeaf",callback:J,checkFlag:aI.checkFlagInCustomSection}));aG[aG.length-1].setDisplayFlag(aI.isDisplayed);if(aI.isDisplayed&&!aI.isVisible){aH=false}aI.view=aG[aG.length-1]}}else{if(aO.type==="RootCaptures"){for(var aJ=0;aJ<aO.children.length;aJ++){aM++;var aN=aO.children[aJ];aN.checkFlagInCustomSection=aN.checkFlagInCustomSection!==undefined?aN.checkFlagInCustomSection:aN.isVisible;aL.push(new k({id:"AnnotViewsCustomCaps_"+aQ+"_"+aF+"_"+aC+"_"+aJ,idPath:[aQ,aF,aC,aJ],name:aN.name+" / "+aP.referenceLabel+" / "+aP.name,header:aN.name+" / "+aP.referenceLabel+" / "+aP.name,icon:aN.icon,type:"checkbox",displayNbElems:false,displayTitle:true,className:"AnnotFilterLeaf",isDisplayed:aN.isDisplayed,callback:J,checkFlag:aN.checkFlagInCustomSection}));aL[aL.length-1].setDisplayFlag(aN.isDisplayed);if(aN.isDisplayed&&!aN.isVisible){aS=false}aN.view=aL[aL.length-1]}}}}}}}var aR=[];if(aG.length){var aD=false;for(var aQ=0;aQ<aG.length;aQ++){if(aG[aQ].isDisplayed()){aD=true;break}}aR.push(new k({id:"AnnotationViews.Custom.Views",name:"Views",type:"checkbox",className:"annotFilterSubSection",isDisplayed:aD,header:l.Views,children:aG,checkFlag:aH,noSelectAll:true,displayNbElems:true,displayTitle:true,expandingPreference:"AnnotationViews.Custom.Views"}))}if(aL.length){var aD=false;for(var aQ=0;aQ<aL.length;aQ++){if(aL[aQ].isDisplayed()){aD=true;break}}aR.push(new k({id:"AnnotationViews.Custom.Captures",name:"Captures",type:"checkbox",isDisplayed:aD,className:"annotFilterSubSection",header:l.Captures,children:aL,checkFlag:aS,noSelectAll:true,displayNbElems:true,displayTitle:true,expandingPreference:"AnnotationViews.Custom.Captures"}))}z.push(new k({id:"AnnotViewsAll",name:"AnnotViewsAll",type:"radio",header:j.AllSectionLbl,className:"AnnotFilterMainSection",checkFlag:at==="AnnotViewsAll",displayNbElems:true,displayTitle:false,nbElems:aG.length+aL.length,callback:r}));z.push(new k({id:"AnnotViewsCustom",name:"AnnotViewsCustom",type:"radio",header:j.CustomSectionLbl,checkFlag:at==="AnnotViewsCustom",children:aR,expandingPreference:"AnnotationViews.Custom",noSelectAll:true,displayNbElems:true,displayTitle:false,className:"AnnotFilterMainSection",callback:r}));for(var aQ=0;aQ<z.length;aQ++){aq.appendChild(z[aQ].getContent())}T(aG.length+aL.length!==0,aa,aq)};var ad=function(){for(var aO=0;aO<q.length;aO++){if(q[aO].getContent().parentNode===V){q[aO].clear();V.removeChild(q[aO].getContent())}}if(L){V.removeChild(L);L=null}q.splice(0,q.length);var aI=[];var aS=0;if(ae&&ae.length){for(var aO=0;aO<ae.length;aO++){var aU=ae[aO];for(var aX=0;aX<aU.children.length;aX++){var aY=aU.children[aX];for(var aG=0;aG<aY.children.length;aG++){var aP=aY.children[aG];if((O===1&&aP.type!=="RootViews"&&aP.type!=="RootCaptures")||O!==1){var aC=aP.children;for(var aM=0;aM<aC.length;aM++){var aL=aC[aM];aL.checkFlagInCustomSection=aL.checkFlagInCustomSection!==undefined?aL.checkFlagInCustomSection:aL.isVisible;var aV=an(aL);if(aV!==""){if(!aI[aV]){aI[aV]=[]}var aH=aV==="Captures"||aV==="Views"?J:S;var aW=aV==="Captures"||aV==="Views"?aL.name+" / "+aY.referenceLabel+" / "+aY.name:aL.name;aI[aV].push(new k({id:"AnnotsCustom_"+aO+"_"+aX+"_"+aG+"_"+aM,idPath:[aO,aX,aG,aM],name:aW,icon:aL.icon,header:aW,isDisplayed:aL.isDisplayed,type:"checkbox",displayNbElems:false,displayTitle:true,className:"AnnotFilterLeaf",callback:aH,checkFlag:aL.checkFlagInCustomSection}));aS++;aL.view=aI[aV][aI[aV].length-1];aI[aV][aI[aV].length-1].setDisplayFlag(aL.isDisplayed)}}}}}}}q.push(new k({id:"AnnotsAll",name:"AnnotsAll",type:"radio",header:j.AllSectionLbl,checkFlag:aj==="AnnotsAll",callback:D,displayNbElems:true,displayTitle:false,nbElems:aS,className:"AnnotFilterMainSection"}));if(Q){var aD=[];for(var aO=0;aO<aw.length;aO++){var aJ=aw[aO];var aK=[];var aF=true;for(var aX=0;aX<aJ.types.length;aX++){var aN=aJ.types[aX];aK.push(new k({id:"AnnotsType_"+aO+"_"+aX,idPath:[aO,aX],name:aN.name.toString(),header:aN.name.toString(),type:"checkbox",displayNbElems:false,displayTitle:true,checkFlag:aN.checkFlag,className:"AnnotFilterLeaf",callback:t}));aN.view=aK[aK.length-1]}aD.push(new k({id:"AnnotsType_"+aO,idPath:[aO],name:aJ.name.toString(),header:m[aJ.name.toString()],type:"checkbox",className:"annotFilterSubSection",expandingPreference:"Annotations.Type."+aJ.name.toString(),children:aK,checkFlag:aF,noSelectAll:true,displayTitle:true}));aJ.view=aD[aD.length-1]}q.push(new k({id:"AnnotsType",name:"AnnotsType",header:j.TypeSectionLbl,type:"radio",checkFlag:aj==="AnnotsType",noSelectAll:true,displayTitle:false,className:"AnnotFilterMainSection",children:aD,callback:D,expandingPreference:"Annotations.Type"}))}var aT=["Views","Captures","Datums","GeomTolerances","Dimensions","Roughness","Welds","Notes","RestrictedAreas","Geometries"];var aR=[];for(var aO=0;aO<aT.length;aO++){var aQ=Object.keys(aI);for(var aX=0;aX<aQ.length;aX++){if(aQ[aX]===aT[aO]){aR[aQ[aX]]=aI[aQ[aX]];break}}}var aE=[];var aQ=Object.keys(aR);for(var aO=0;aO<aQ.length;aO++){var aF=true;var aZ=false;for(var aX=0;aX<aR[aQ[aO]].length;aX++){if(!aR[aQ[aO]][aX].getCheckFlag()){aF=false}if(aR[aQ[aO]][aX].isDisplayed()){aZ=true}}aE.push(new k({id:"AnnotsCustom"+aQ[aO].toString(),name:aQ[aO].toString(),type:"checkbox",header:l[aQ[aO].toString()],className:"annotFilterSubSection",isDisplayed:aZ,checkFlag:aF,noSelectAll:true,displayNbElems:true,displayTitle:true,children:aR[aQ[aO]],expandingPreference:"Annotations.Custom."+aQ[aO].toString()}));if(aQ[aO]==="Captures"){aE[aE.length-1].addBottomSeparator()}}q.push(new k({id:"AnnotsCustom",name:"AnnotsCustom",type:"radio",header:j.CustomSectionLbl,checkFlag:aj==="AnnotsCustom",children:aE,callback:D,displayNbElems:true,noSelectAll:true,displayTitle:false,expandingPreference:"Annotations.Custom",className:"AnnotFilterMainSection"}));if(O!==1){q.push(new k({id:"AnnotsNone",name:"AnnotsNone",type:"radio",header:j.NoneSectionLbl,checkFlag:aj==="AnnotsNone",callback:D,displayNbElems:false,noSelectAll:true,displayTitle:false,className:"AnnotFilterMainSection"}))}if(Q){q.push(new e({name:"AnnotsFilterByTol",checkFlag:I,callback:ai,formulaComponents:P,className:"AnnotFilterTolItem"}));q.push(new k({id:"AnnotsDisplayOnlyDefault",name:"AnnotsDisplayOnlyDefault",header:j.DefaultAnnotationsLbl,type:"checkbox",callback:A,displayNbElems:false,displayTitle:false,checkFlag:M,className:"AnnotFilterDefaultItem"}))}for(var aO=0;aO<q.length;aO++){if(q[aO].name==="AnnotsFilterByTol"){L=h.createElement("div",{"class":"AnnotFilterSeparator"});V.appendChild(L)}V.appendChild(q[aO].getContent())}T(aS!==0,ah,V)};var ac=function(){if(O===1){return}for(var aG=0;aG<y.length;aG++){if(y[aG].getContent().parentNode===am){y[aG].clear();am.removeChild(y[aG].getContent())}}y.splice(0,y.length);var aI=[];var aF=[];var aC;for(var aG=0;aG<ar.length;aG++){ar[aG].view=null;if(F&&F.indexOf(ar[aG].name)===-1&&ar[aG].isDisplayed){var aD=b[ar[aG].name]||(b.unknownAttribute+"("+ar[aG].name+")");ar[aG].view=new k({id:"AttributesType_"+aG,idPath:[aG],name:ar[aG].name,icon:ar[aG].icon,header:aD,type:"checkbox",displayNbElems:false,displayTitle:true,checkFlag:ar[aG].checkFlag,className:"AnnotFilterLeaf",callback:B});if(!isNaN(parseFloat(ar[aG].name))){if(ar[aG].name==="2"){aC=ar[aG].view}else{aF.push(ar[aG].view)}}else{aI.push(ar[aG].view)}}}var aE=(aC?1:0)+aI.length+aF.length;y.push(new k({id:"AttributesAll",name:"AttributesAll",type:"radio",header:j.AllSectionLbl,checkFlag:ay==="AttributesAll",callback:av,displayNbElems:true,displayTitle:false,nbElems:aE,className:"AnnotFilterMainSection"}));var aH=[];if(aC){aH.push(aC)}aH=aH.concat(aI);aH=aH.concat(aF);y.push(new k({id:"AttributesType",name:"AttributesType",type:"radio",header:j.TypeSectionLbl,checkFlag:ay==="AttributesType",callback:av,children:aH,displayNbElems:false,displayTitle:false,noSelectAll:aH.length<=1,expandingPreference:"Attributes.Type",className:"AnnotFilterMainSection"}));y.push(new k({id:"AttributesNone",name:"AttributesNone",type:"radio",header:j.NoneSectionLbl,checkFlag:aj==="AttributesNone",callback:av,displayNbElems:false,noSelectAll:true,displayTitle:false,className:"AnnotFilterMainSection"}));for(var aG=0;aG<y.length;aG++){am.appendChild(y[aG].getContent())}T(aE!==0,Y,am)};var U=function(){al("onFilterPanelResized")};var v=function(aC){return(aC.hiddenByDefaultFilter||aC.hiddenByTolFilter)};var ab=function(aE){if(aE.superType===1||aE.superType===2||aE.superType===8||aE.superType===9){return false}var aC;if(aE.toleranceLimits){var aD=aE.toleranceLimits;aC=aD.max-aD.min}else{aC=aE.toleranceValue}if(aC===undefined){return false}if(P.leftOperand==="equal"){return aC===P.leftValue}else{if(P.leftOperand==="infEqual"){if(P.rightOperand==="infEqual"){return(aC>=P.leftValue)&&(aC<=P.rightValue)}else{return(aC>=P.leftValue&&aC<P.rightValue)}}else{if(P.rightOperand==="infEqual"){return(aC>P.leftValue&&aC<=P.rightValue)}else{return(aC>P.leftValue&&aC<P.rightValue)}}}};var ag=function(aC){C.confirm(j.TooManyAnnotSetsLbl,j.WarningSectionLbl,function(aD){if(aD){if(aC.onAcceptCB){aC.onAcceptCB()}}else{if(aC.onCancelCB){aC.onCancelCB()}}})};var G=function(aH){if(ax!==aH.name){var aD=ax;ax=aH.name;var aG=[];if(ax==="AnnotSetAll"){for(var aC=0;aC<W.length;aC++){W[aC].setCheckFlag(W[aC].name===ax)}if(ae.length===1&&!ae[0].hasBeenEntirelyLoaded){return ag({idPath:[0],onAcceptCB:function(){ae[0].hasBeenEntirelyLoaded=true;ae[0].checkFlagInAllSection=true;for(var aI=0;aI<W.length;aI++){W[aI].setCheckFlag(W[aI].name===ax)}var aK=[];for(var aJ=0;aJ<ae[0].children.length;aJ++){if(!ae[0].children[aJ].isVisible){ae[0].children[aJ].isVisible=true;aK.push({idPath:[0,aJ],visuFlag:true})}}ak(true);al("onAnnotationSetsLoadingRequired",[{idPath:[0]}]);if(aK.length){al("onAnnotationsVisibilityModified",aK)}},onCancelCB:function(){G({name:aD});for(var aI=0;aI<W.length;aI++){W[aI].setCheckFlag(W[aI].name===ax)}ak(true)}})}else{for(var aC=0;aC<ae.length;aC++){for(var aE=0;aE<ae[aC].children.length;aE++){ae[aC].children[aE].isVisible=ae[aC].checkFlagInAllSection===undefined?ae[aC].hasBeenEntirelyLoaded:ae[aC].checkFlagInAllSection;aG.push({idPath:[aC,aE],visuFlag:ae[aC].children[aE].isVisible})}}}}else{if(ax==="AnnotSetAssemblyRoot"){for(var aC=0;aC<ae.length;aC++){if(ae.length===1||(ae.length>1&&ae[aC].checkFlagInAssySection)){for(var aE=0;aE<ae[aC].children.length;aE++){var aF=ae[aC].children[aE].isDirectChild;if(ae[aC].children[aE].isVisible!==aF){ae[aC].children[aE].isVisible=aF;aG.push({idPath:[aC,aE],visuFlag:aF})}}}}}else{if(ax==="AnnotSetCustom"){for(var aC=0;aC<ae.length;aC++){for(var aE=0;aE<ae[aC].children.length;aE++){if(ae[aC].children[aE].isVisible!==ae[aC].children[aE].checkFlagInCustomSection){ae[aC].children[aE].isVisible=ae[aC].children[aE].checkFlagInCustomSection;aG.push({idPath:[aC,aE],visuFlag:ae[aC].children[aE].checkFlagInCustomSection})}}}}else{if(ax==="AnnotSetNone"){for(var aC=0;aC<ae.length;aC++){for(var aE=0;aE<ae[aC].children.length;aE++){if(ae[aC].children[aE].isVisible){ae[aC].children[aE].isVisible=false;aG.push({idPath:[aC,aE],visuFlag:false})}}}}}}}ak(true);al("onAnnotationsVisibilityModified",aG)}for(var aC=0;aC<W.length;aC++){W[aC].setCheckFlag(W[aC].name===ax)}};var r=function(aL){if(O!==1){return}if(at!==aL.name||aL.forceRefresh){at=aL.name;var aI=[];var aF=[];var aQ=[];for(var aS=0;aS<ae.length;aS++){var aP=ae[aS];for(var aJ=0;aJ<aP.children.length;aJ++){var aR=aP.children[aJ];for(var aE=0;aE<aR.children.length;aE++){var aC=aR.children[aE];if(aC.type==="RootViews"||aC.type==="RootCaptures"){for(var aO=0;aO<aC.children.length;aO++){var aN=aC.children[aO];if(at==="AnnotViewsAll"){aN.isVisible=true;aI.push({idPath:[aS,aJ,aE,aO],visuFlag:true});var aG=aN.tpsList;for(var aH=0;aH<aG.length;aH++){var aD=aR.children[aG[aH][0]].children[aG[aH][1]];if(v(aD)){if(!aD.isVisible){continue}aD.isVisible=false;aI.push({idPath:[aS,aJ,aE,aO],visuFlag:false})}else{if(!aD.isVisible){aD.isVisible=true;if(aj!=="AnnotsCustom"){aj="AnnotsCustom"}aI.push({idPath:[aS,aJ,aG[aH][0],aG[aH][1]],visuFlag:true});aD.checkFlagInCustomSection=true}}}}else{if(at==="AnnotViewsCustom"){aN.isVisible=aN.checkFlagInCustomSection;aI.push({idPath:[aS,aJ,aE,aO],visuFlag:aN.checkFlagInCustomSection});var aG=aN.tpsList;for(var aH=0;aH<aG.length;aH++){var aD=aR.children[aG[aH][0]].children[aG[aH][1]];if(v(aD)){if(!aD.isVisible){continue}aD.isVisible=false;aI.push({idPath:[aS,aJ,aE,aO],visuFlag:false})}else{var aM=JSON.stringify([aS,aJ,aG[aH][0],aG[aH][1]]);if(aN.checkFlagInCustomSection&&aF.indexOf(aM)===-1){var aK=aQ.indexOf(aM);if(aK!==-1){aQ.splice(aK,1)}aF.push(aM);aD.isVisible=true;aD.checkFlagInCustomSection=true}else{if(!aN.checkFlagInCustomSection&&aQ.indexOf(aM)===-1&&aF.indexOf(aM)===-1){aQ.push(aM);aD.isVisible=false;aD.checkFlagInCustomSection=false}}}}}}}}}}}if(aF.length||aQ.length){if(aj!=="AnnotsCustom"){aj="AnnotsCustom"}for(var aS=0;aS<aF.length;aS++){aI.push({idPath:JSON.parse(aF[aS]),visuFlag:true})}for(var aS=0;aS<aQ.length;aS++){aI.push({idPath:JSON.parse(aQ[aS]),visuFlag:false})}}ak(false);al("onAnnotationsVisibilityModified",aI)}for(var aS=0;aS<z.length;aS++){z[aS].setCheckFlag(z[aS].name===at)}};var D=function(aI){if(aj!==aI.name||aI.forceRefresh){aj=aI.name;var aG=[];for(var aN=0;aN<ae.length;aN++){var aK=ae[aN];for(var aH=0;aH<aK.children.length;aH++){var aM=aK.children[aH];for(var aE=0;aE<aM.children.length;aE++){var aC=aM.children[aE];if((O===1&&aC.type!=="RootViews"&&aC.type!=="RootCaptures")||O!==1){for(var aJ=0;aJ<aC.children.length;aJ++){var aD=aC.children[aJ];if(aj==="AnnotsAll"){if(v(aD)){if(!aD.isVisible){continue}aD.isVisible=false;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:false})}else{if(!aD.isVisible){aD.isVisible=true;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:true})}}}else{if(aj==="AnnotsType"){var aL=null;for(var aF=0;aF<aw.length;aF++){for(var aO=0;aO<aw[aF].types.length;aO++){if(H(aD)===aw[aF].types[aO].type){aL=aw[aF].types[aO].checkFlag;break}}if(aL!==null){break}}if(v(aD)){if(!aD.isVisible){continue}aD.isVisible=false;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:false})}else{if(aL!==aD.isVisible){aC.children[aJ].isVisible=aL;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:aL})}}}else{if(aj==="AnnotsCustom"){if(v(aD)){if(!aD.isVisible){continue}aD.isVisible=false;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:false})}else{if(aD.isVisible!==aD.checkFlagInCustomSection){aD.isVisible=aD.checkFlagInCustomSection;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:aD.checkFlagInCustomSection})}}}else{if(aj==="AnnotsNone"){if(aD.isVisible){aD.isVisible=false;aG.push({idPath:[aN,aH,aE,aJ],visuFlag:false})}}}}}}}}}}al("onAnnotationsVisibilityModified",aG)}for(var aN=0;aN<q.length;aN++){if(q[aN].name!=="AnnotsDisplayOnlyDefault"&&q[aN].name!=="AnnotsFilterByTol"){q[aN].setCheckFlag(q[aN].name===aj)}else{if(q[aN].name==="AnnotsDisplayOnlyDefault"){q[aN].setCheckFlag(M)}else{if(q[aN].name==="AnnotsFilterByTol"){q[aN].setCheckFlag(I)}}}}};var av=function(aE){if(ay!==aE.name){ay=aE.name;var aD=[];for(var aC=0;aC<ar.length;aC++){if(ay==="AttributesAll"){aD.push({name:ar[aC].name,visuFlag:true})}else{if(ay==="AttributesType"){aD.push({name:ar[aC].name,visuFlag:ar[aC].checkFlag})}else{aD.push({name:ar[aC].name,visuFlag:false})}}}al("onAttributesVisibilityModified",aD)}for(var aC=0;aC<y.length;aC++){y[aC].setCheckFlag(y[aC].name===ay)}};var N=function(aE){if(!ae[aE.idPath[0]].hasBeenEntirelyLoaded){ag({idPath:aE.idPath,onAcceptCB:function(){ae[aE.idPath[0]].hasBeenEntirelyLoaded=true;ae[aE.idPath[0]].checkFlagInAllSection=true;ak(true);var aG=[];for(var aF=0;aF<ae[aE.idPath[0]].children.length;aF++){if(!ae[aE.idPath[0]].children[aF].isVisible){ae[aE.idPath[0]].children[aF].isVisible=true;aG.push({idPath:[aE.idPath[0],aF],visuFlag:true})}}al("onAnnotationSetsLoadingRequired",[{idPath:aE.idPath}]);if(aG.length){al("onAnnotationsVisibilityModified",aG)}},onCancelCB:function(){ak(true)}})}else{ae[aE.idPath[0]].checkFlagInAllSection=aE.checkFlag;var aD=[];for(var aC=0;aC<ae[aE.idPath[0]].children.length;aC++){aD.push({idPath:[aE.idPath[0],aC],visuFlag:aE.checkFlag});ae[aE.idPath[0]].children[aC].isVisible=aE.checkFlag}ak(true);al("onAnnotationsVisibilityModified",aD)}};var x=function(aE){ae[aE.idPath[0]].checkFlagInAssySection=aE.checkFlag;var aD=[];for(var aC=0;aC<ae[aE.idPath[0]].children.length;aC++){if(ae[aE.idPath[0]].children[aC].isDirectChild){aD.push({idPath:[aE.idPath[0],aC],visuFlag:aE.checkFlag});ae[aE.idPath[0]].children[aC].isVisible=aE.checkFlag}}ak(true);al("onAnnotationsVisibilityModified",aD)};var aA=function(aC){ae[aC.idPath[0]].children[aC.idPath[1]].checkFlagInCustomSection=aC.checkFlag;ae[aC.idPath[0]].children[aC.idPath[1]].isVisible=aC.checkFlag;ak(true);al("onAnnotationsVisibilityModified",[{idPath:aC.idPath,visuFlag:aC.checkFlag}])};var J=function(aG){ae[aG.idPath[0]].children[aG.idPath[1]].children[aG.idPath[2]].children[aG.idPath[3]].checkFlagInCustomSection=aG.checkFlag;ae[aG.idPath[0]].children[aG.idPath[1]].children[aG.idPath[2]].children[aG.idPath[3]].isVisible=aG.checkFlag;var aF=[{idPath:aG.idPath,visuFlag:aG.checkFlag}];var aE=ae[aG.idPath[0]].children[aG.idPath[1]].children[aG.idPath[2]].children[aG.idPath[3]].tpsList;var aH=ae[aG.idPath[0]].children[aG.idPath[1]];for(var aD=0;aD<aE.length;aD++){var aC=aH.children[aE[aD][0]].children[aE[aD][1]];if(v(aC)){if(!aC.isVisible){continue}aC.isVisible=false;aF.push({idPath:[aG.idPath[0],aG.idPath[1],aE[aD][0],aE[aD][1]],visuFlag:false})}else{if(aC.isVisible!==aG.checkFlag){aF.push({idPath:[aG.idPath[0],aG.idPath[1],aE[aD][0],aE[aD][1]],visuFlag:aG.checkFlag});aC.isVisible=aG.checkFlag;aC.checkFlagInCustomSection=aG.checkFlag}}}if(aj!=="AnnotsCustom"){aj="AnnotsCustom"}ak(false);al("onAnnotationsVisibilityModified",aF)};var S=function(aC){ae[aC.idPath[0]].children[aC.idPath[1]].children[aC.idPath[2]].children[aC.idPath[3]].checkFlagInCustomSection=aC.checkFlag;ae[aC.idPath[0]].children[aC.idPath[1]].children[aC.idPath[2]].children[aC.idPath[3]].isVisible=aC.checkFlag;ak(false);al("onAnnotationsVisibilityModified",[{idPath:aC.idPath,visuFlag:aC.checkFlag}])};var t=function(aH){aw[aH.idPath[0]].types[aH.idPath[1]].checkFlag=aH.checkFlag;var aF=[];var aI=aw[aH.idPath[0]].types[aH.idPath[1]].type;for(var aM=0;aM<ae.length;aM++){var aK=ae[aM];for(var aG=0;aG<aK.children.length;aG++){var aL=aK.children[aG];for(var aE=0;aE<aL.children.length;aE++){var aC=aL.children[aE];for(var aJ=0;aJ<aC.children.length;aJ++){var aD=aC.children[aJ];if(H(aD)===aI){if(v(aD)){if(!aD.isVisible){continue}aD.isVisible=false;aF.push({idPath:[aM,aG,aE,aJ],visuFlag:false})}else{if(aD.isVisible!==aH.checkFlag){aD.isVisible=aH.checkFlag;aF.push({idPath:[aM,aG,aE,aJ],visuFlag:aH.checkFlag})}}}}}}}ak(false);al("onAnnotationsVisibilityModified",aF)};var p=function(){for(var aF=0;aF<ae.length;aF++){var aC=ae[aF];for(var aH=0;aH<aC.children.length;aH++){var aG=aC.children[aH];for(var aI=0;aI<aG.children.length;aI++){var aD=aG.children[aI];if(aD.type!=="RootViews"&&aD.type!=="RootCaptures"){for(var aJ=0;aJ<aD.children.length;aJ++){var aE=aD.children[aJ];if(M&&!aE.isDefaultAnnot){aE.hiddenByDefaultFilter=true}else{aE.hiddenByDefaultFilter=false}if(I&&ab(aE)===false){aE.hiddenByTolFilter=true}else{aE.hiddenByTolFilter=false}}}}}}};var ai=function(aC){I=aC.checkFlag;P=aC.formulaComponents;p();ak(true);D({name:aj,forceRefresh:true})};var A=function(aC){M=aC.checkFlag;p();ak(true);D({name:aj,forceRefresh:true})};var B=function(aC){ar[aC.idPath[0]].visuFlag=aC.checkFlag;ar[aC.idPath[0]].checkFlag=aC.checkFlag;ak(false);al("onAttributesVisibilityModified",[ar[aC.idPath[0]]])};var al=function(aD,aC){return aB.publish({event:aD,data:aC,context:this})}}});return n});define("DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd",["DS/ApplicationFrame/Command","DS/CATRelatedDataLauncher/CATRelatedDataController","DS/CAT3DAnnotationController/CAT3DAnnotationController","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions","DS/PADUtils/PADContext"],function(b,f,a,d,c){var e=b.extend({init:function(i){var i=i||{};this._parent(i,{mode:"exclusive",isAsynchronous:true});this.setRepeatMode(false);this.isAnnotDefaultCmd=true;var h=c.get();var k=this;var j=f.giveDataLauncherController({context:h});require([i.annotControllerLib||"DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance"],function(m){var l=new m({ctxViewer:h});l.setActiveState(true);a.registerAnnotationController({annotController:l,context:h})});this.beginExecute=function(){if(j){j.setActiveState(true)}};this.endExecute=function(){if(j){j.setActiveState(false)}};this.pauseExecute=function(){if(j){j.setActiveState(false)}};this.resumeExecute=function(){if(j){j.setActiveState(true)}};var g=this._destroy;this._destroy=function(){g.call(k);a.unreferenceAnnotationController({context:h});k=h=j=null}}});return e});define("DS/CAT3DAnnotationCommands/CAT3DAnnotationCommands",[],function(){});define("DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController",["UWA/Class","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationCommands/panels/CAT3DAnnotationFilterPanel","DS/CATWebUXComponents/CATWebUXPanel","DS/CAT3DAnnotationController/CAT3DAnnotationController","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader","DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController","DS/WebappsUtils/WebappsUtils","i18n!DS/CAT3DAnnotationCommands/assets/nls/CAT3DAnnotationCommands"],function(a,c,l,m,h,i,j,d,e,g){var b=a.extend({init:function(S){var G=S||{};this._parent(G);var v=i.getOption("CAT3DANN_FILTER_PANEL_VER1")?1:2;var ad=false;var R;var y;var D=G.ctxViewer;var Y;var M;var ac=200;var F=ac;var A=false;var n=[];var ab=[];var Q={};var P={};var w={};var J={};var O;var T=d.subscribe("onPreferenceModified",function(am){if(am.preference.indexOf("3DAnnotSemAttr_")!==-1){var al=am.preference.substring(am.preference.indexOf("_")+1,am.preference.length);var ai=r.getAttributeTypesFiltered();var ah;for(O=0;O<ab.length;O++){if(ab[O].name===al){ab[O].filteredByPref=!am.value;ah=true;break}}if(!ah){ab.push({name:al,filteredByPref:!am.value,filtered:false})}var ak=r.getAttributeTypesFiltered();ag();var aj=ak.length!==ai.length;if(!aj){for(O=0;O<ak.length;O++){if(ai.indexOf(ak[O])===-1){aj=true;break}}}if(aj){Z("onAttributesVisibilityModified",{attributesFiltered:ak})}}});var V=0;var r=this;var af=new c();var K=true;var W=false;var H=0;var p=0;var U=150;var E=0;var ae=true;var q=false;var x=false;var C=false;this.setActiveState=function(ah){ad=ah;if(!R||!y){var ai=setInterval(function(){y=j.giveAnnotationModelLoader({context:D});R=h.giveAnnotationController({context:D});if(R&&y&&y.getLoaderType()!=="undefined"){clearInterval(ai);r.setActiveState(ad);return}},10);return}if(!r.getDataModel){R.onAdditionalInfosRequired({controller:"AnnotFilter",cb:function(){r.setActiveState(ad)}});return}p=0;var ap;if(ad){if(!A){var al=function(){ae=true;ag(true)};x=!(R.getActiveState()&&y.getActiveState());var an=function(){if(R.getActiveState()&&y.getActiveState()){x=false;ag(true)}else{N();x=true}};Q.onLoadingComplete=D.subscribe({event:"onLoadingComplete"},al);Q.onLoadingFailure=D.subscribe({event:"onLoadingFailure"},al);Q.onLoadingCanceled=D.subscribe({event:"onLoadingCanceled"},al);Q.onRootRemovedToken=D.subscribe({event:"onRootRemoved"},function(){ae=true;U=0;ag(true)});P.onAnnotControllerActiveStateChanged=R.subscribe("onAnnotControllerActiveStateChanged",an);P.onAnnotationsLinkedDataSolved=R.subscribe("onAnnotationsLinkedDataSolved",function(ar){if(ar.succeeded===true){ag()}});w.onAnnotModelLoaderActiveStateChanged=y.subscribe("onAnnotModelLoaderActiveStateChanged",an);w.onAnnotationVisibilityModifiedToken=y.subscribe("onAnnotationVisibilityModified",function(ar){ag(ar.annotNode.getAnnotationClassType()==="tpsAnnotationSet")});w.onAnnotationSetLoadingFailedToken=y.subscribe("onAnnotationSetLoadingFailed",function(){ae=true;I(true);ag(true)});w.onAnnotationSetLoadedToken=y.subscribe("onAnnotationSetLoaded",function(){ae=true;I(true);ag(true)});w.onAnnotationSetPartiallyLoaded=y.subscribe("onAnnotationSetPartiallyLoaded",function(){ae=true;I(true);ag(true)});w.onAnnotationSetRemovedToken=y.subscribe("onAnnotationSetRemoved",function(){ae=true;ag(true)});w.onAnnotationSetBeginLoadToken=y.subscribe("onAnnotationSetBeginLoad",function(){ae=false;I(false)});w.onAnnotationSetLoadingCanceledToken=y.subscribe("onAnnotationSetLoadingCanceled",function(){ae=true;I(true);ag(true)});w.onNoAnnotationSetLoadedToken=y.subscribe("onNoAnnotationSetLoaded",function(ar){if(ar&&ar.loadingAlreadyStarted){ae=true;I(true)}ag(true)});P.onViewOrCaptureDisplayedToken=R.subscribe("onViewOrCaptureDisplayed",function(){ae=true;ag()});w.onVisuModificationToken=y.subscribe("onAnnotationParentVisibilityModified",function(){ag(true)});V=D.getViewer().onSwapVisibleSpace?D.getViewer().onSwapVisibleSpace(function(){C=D.getViewer().getVisibleSpace()===0;if(D.getViewer().getVisibleSpace()===1){ag(true)}else{N()}}):null;C=D.getViewer().getVisibleSpace()===0;var ao=o();for(ap=0;ap<ao.length;ap++){var ak=false;for(var aj=0;aj<ab.length;aj++){if(ab[aj].name===ao[ap]){ak=true;ab[aj].filteredByPref=true;break}}if(!ak){ab.push({name:ao[ap],filteredByPref:true,filtered:false})}}A=true}var am=ae;ae=true;ag(true);ae=am}else{if(A){var aq=Object.keys(Q);for(ap=0;ap<aq.length;ap++){D.unsubscribe(Q[aq[ap]])}aq=Object.keys(P);for(ap=0;ap<aq.length;ap++){R.unsubscribe(P[aq[ap]])}aq=Object.keys(w);for(ap=0;ap<aq.length;ap++){y.unsubscribe(w[aq[ap]])}if(V&&D.getViewer()){D.getViewer().unsubscribe(V)}V=0;Q={};P={};w={};N(true);A=false}if(H){clearTimeout(H);H=0}if(E){clearTimeout(E);E=0}n.splice(0,n.length);for(ap=ab.length-1;ap>=0;ap--){if(ab[ap].filtered){if(!ab[ap].filteredByPref){ab.splice(ap,1)}else{ab[ap].filtered=false}}}ae=true}Z("onAnnotationFilterActiveStateModified",{state:ad})};this.getActiveState=function(){return ad};this.setPanelVisibilityFlag=function(ah){K=ah;if(M&&n){M.setPanelVisibilityFlag(K&&n.length!==0)}};this.getPanelVisibilityFlag=function(){return K};this.clearController=function(){this.setActiveState(false);if(T){d.unsubscribe(T)}T=0;if(Y){var ai=Object.keys(J);for(var ah=0;ah<ai.length;ah++){Y.unsubscribe(J[ai[ah]])}}J={};if(M){M.clean()}R=y=D=Y=M=n=ab=af=r=null};this.getAttributeTypesFiltered=function(){var ai=[];for(var ah=0;ah<ab.length;ah++){if(ab[ah].filteredByPref||ab[ah].filtered){ai.push(ab[ah].name)}}return ai};var o=function(){var ai=d.getPreference("3DAnnotAttributesOrderedList");for(var ah=ai.length-1;ah>=0;ah--){if(d.getPreference("3DAnnotSemAttr_"+ai[ah])){ai.splice(ah,1)}}return ai};this.subscribe=function(ai,ah){if(!ai||!ah){return undefined}return af.subscribe({event:ai},ah)};this.unsubscribe=function(ah){if(!af||!ah){return}af.unsubscribe(ah)};var aa=function(ah){if(n&&n.length&&n[ah[0]]){var ai=n[ah[0]];if(ah.length===1){return ai.path}if(ai.children&&ai.children[ah[1]]){var aj=ai.children[ah[1]];if(ah.length===2){return aj.path}if(aj.path){var ak=aj.path.getChildrenPathes();if(ak&&ak.length&&ak[ah[2]]){var am=ak[ah[2]];if(ah.length===3){return am}var al=ak[ah[2]].getChildrenPathes();if(al&&al.length&&al[ah[3]]){return al[ah[3]]}}}}}return undefined};var I=function(ah){if(ad){p+=ah===true?1:-1;if(E){clearTimeout(E);E=0}if(M){M.setEnableFlag(p>=0);if(p<0){E=setTimeout(function(){if(ad&&M){M.setEnableFlag(true)}p=0},20000)}}}};var ag=function(ah){if(q||!ae||!ad||x||C||!R.getActiveState()){return}if(ah){W=ah}if(H){clearTimeout(H);H=0}H=setTimeout(function(){r._internalRefresh();U=150;H=0},U)};var N=function(ah){if(H){clearTimeout(H);H=0}if(M){F=M.getWidth();M.clean();M=null}if(Y){Y.cleanPanel(ah)}};this._internalRefresh=function(){if(!ad||!r||typeof r.getDataModel!=="function"){return}if(W){n.splice(0,n.length);if(!M){s()}r.getDataModel(function(aj){if(!ad){return}n=aj;for(var ai=n.length-1;ai>=0;ai--){var ah=y.hasAlreadyBeenLoaded(n[ai].path);n[ai].hasBeenEntirelyLoaded=ah===1||ah===2||ah===3;if(n[ai].hasBeenEntirelyLoaded&&n[ai].children.length===0){n.splice(ai,1)}}X(false);M.setPanelVisibilityFlag(K&&n.length!==0);if(n.length){M.setEnableFlag(p>=0)}})}else{X(true);if(M&&n){M.setPanelVisibilityFlag(K&&n.length!==0)}}};var s=function(){N();if(!Y){Y=new l({style:{version:v,semanticUI:R.getAnnotationControllerType()==="3DAnnotationInsight"}});J={};J.onFilterPanelResized=Y.subscribe("onFilterPanelResized",u);J.onAnnotationSetsLoadingRequired=Y.subscribe("onAnnotationSetsLoadingRequired",z);J.onAnnotationsVisibilityModified=Y.subscribe("onAnnotationsVisibilityModified",L);J.onAttributesVisibilityModified=Y.subscribe("onAttributesVisibilityModified",t)}if(!M){var ah;if(sessionStorage.getItem("CAT3DAnnotFilterExpFlag_"+widget.id)==="true"){ah=parseFloat(sessionStorage.getItem("CAT3DAnnotFilterWidth_"+widget.id))}if(!ah){ah=F!==undefined?F:ac}F=ah;var ai={id:"CAT3DAnnotFilterPanel",className:"CAT3DAnnotFilterSidePanel",title:g.FilterPanelTitle,showTitleFlag:false,icon:e.getWebappsAssetUrl("CAT3DAnnotationCommands","icons/32/")+"I_CAT3DAnnotFilter.png",frameWindow:D.getFrameWindow(),immersiveFrame:D.getFrameWindow().getImmersiveFrame(),content:Y.buildPanel({model:n,attrTypesFilteredByPref:o(),attrTypesOrderedList:d.getPreference("3DAnnotAttributesOrderedList")}),minHeight:330,minWidth:ac,width:ah,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,currentDockArea:WUXDockAreaEnum.RightDockArea,onPanelResizedCB:function(aj){if(aj.currentDockArea===WUXDockAreaEnum.RightDockArea||aj.currentDockArea===WUXDockAreaEnum.LeftDockArea){F=aj.width;if(aj.widthModifiedInteractively){sessionStorage.setItem("CAT3DAnnotFilterExpFlag_"+widget.id,"true");sessionStorage.setItem("CAT3DAnnotFilterWidth_"+widget.id,aj.width)}}}};M=new m(ai)}else{Y.buildPanel(n)}if(M&&n){M.setPanelVisibilityFlag(K&&n.length!==0)}M.setEnableFlag(p>=0)};var X=function(ak){if(!Y){return}if(ak){for(var ai=0;ai<n.length;ai++){for(var aj=0;aj<n[ai].children.length;aj++){var ah=n[ai].children[aj].path.getLastElement(true).toJSON();Object.assign(n[ai].children[aj],ah)}}}Y.updatePanel({model:n,attrTypesFilteredByPref:o(),attrTypesOrderedList:d.getPreference("3DAnnotAttributesOrderedList")})};var B=o();for(var O=0;O<B.length;O++){ab.push({name:B[O],filteredByPref:true,filtered:false})}var u=function(){if(sessionStorage){var ah=sessionStorage.getItem("CAT3DAnnotFilterExpFlag_"+widget.id);if(ah==="true"){sessionStorage.setItem("CAT3DAnnotFilterExpFlag_"+widget.id,"false");M.setWidth(ac)}else{var ai=parseFloat(sessionStorage.getItem("CAT3DAnnotFilterWidth_"+widget.id));if(ai&&ai!==ac){sessionStorage.setItem("CAT3DAnnotFilterExpFlag_"+widget.id,"true");M.setWidth(ai)}}}};var z=function(ai){var ah=aa(ai[0].idPath);y.loadFTALightModel(ah,true,true)};var L=function(ai){q=true;for(var ah=0;ah<ai.length;ah++){var aj=aa(ai[ah].idPath);if(aj){aj.getLastElement(true).setVisibility(ai[ah].visuFlag)}}D.getViewer().render();q=false};var t=function(am){var al=false;var an=r.getAttributeTypesFiltered(),aj;for(aj=0;aj<am.length;aj++){var ah=null;for(var ak=0;ak<ab.length;ak++){if(ab[ak].name===am[aj].name){ah=ak;break}}if(ah!==null){ab[ah].filtered=!am[aj].visuFlag}else{ab.push({name:am[aj].name,filtered:!am[aj].visuFlag,filteredByPref:false})}}var ai=r.getAttributeTypesFiltered();al=ai.length!==an.length;if(!al){for(aj=0;aj<ai.length;aj++){if(an.indexOf(ai[aj])===-1){al=true;break}}}if(al){Z("onAttributesVisibilityModified",{attributesFiltered:ai})}};var Z=function(ai,ah){return af.publish({event:ai,data:ah,context:this})}}});var f=[];var k=a.singleton({init:function(){},give3DAnnotFilterController:function(o){if(o&&o.context){for(var n=0;n<f.length;n++){if(f[n].context===o.context){return f[n].filterController}}}return undefined},get3DAnnotFilterController:function(o){var p;if(o&&o.context){p=this.give3DAnnotFilterController(o);if(!p){var n=new b({ctxViewer:o.context});p=Object.freeze({setActiveState:function(q){if(n){n.setActiveState(q)}},getActiveState:function(){if(n){return n.getActiveState()}return null},clearController:function(){if(n){n.clearController();n=null}},getAttributeTypesFiltered:function(){if(n){return n.getAttributeTypesFiltered()}return null},setPanelVisibilityFlag:function(q){if(n){n.setPanelVisibilityFlag(q)}},getPanelVisibilityFlag:function(){if(n){return n.getPanelVisibilityFlag()}return null},subscribe:function(r,q){if(n){return n.subscribe(r,q)}return null},unsubscribe:function(q){if(n){n.unsubscribe(q)}},setDataModelMethod:function(q){if(n&&!n.dataModelInitialized){n.getDataModel=q;n.dataModelInitialized=true;if(n.getActiveState()){n._internalRefresh()}}}});f.push({context:o.context,filterController:p})}}return p},unreference3DAnnotFilterController:function(o){if(o&&o.context){for(var n=0;n<f.length;n++){if(f[n].context===o.context){f[n].filterController.clearController();f.splice(n,1);break}}}}});return k});define("DS/CAT3DAnnotationCommands/CAT3DAnnotationFilterCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController"],function(d,c,b){var a=d.extend({init:function(h){this._parent(h,{});var k=this;var i=c.get();var g=b.get3DAnnotFilterController({context:i});var j=this.onStateChange(function(){g.setActiveState(k.getState());localStorage.setItem("CAT3DAnnotationFilterCmd",k.getState()?"true":"false")});var f=this._destroy;this._destroy=function(){if(i){b.unreference3DAnnotFilterController({context:i})}k._modelEvents.unsubscribe(j);f.call(k)};var e=localStorage.getItem("CAT3DAnnotationFilterCmd");e=e==="true"?true:(e==="false"?false:undefined);this.setState(e===false?false:true,true)},_destroy:function(){this._parent()}});return a});